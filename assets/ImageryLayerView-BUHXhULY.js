import{b as r,m as i,c as v,H as g,N as x,aV as E,b$ as u}from"./index-CzvLtnX1.js";import{i as $}from"./timeSupport-CgS5mQjm.js";import{O as b,j as N}from"./rasterProjectionHelper-B6RYh9HO.js";import{p as D}from"./popupUtils-C5Xxoh_A.js";const O=m=>{let e=class extends m{constructor(){super(...arguments),this.view=null}get timeExtent(){return $(this.layer,this.view?.timeExtent,this._get("timeExtent"))}async fetchPopupFeaturesAtLocation(o,n){const{layer:s}=this;if(!o)throw new g("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:s});const{popupEnabled:c}=s,l=D(s,n);if(!c||l==null)return[];const y=await l.getRequiredFields();x(n);const t=new E;t.timeExtent=this.timeExtent,t.geometry=o,t.outFields=y,t.outSpatialReference=o.spatialReference;const{resolution:a,spatialReference:p}=this.view,h=this.view.type==="2d"?new u(a,a,p):new u(.5*a,.5*a,p),{returnTopmostRaster:w,showNoDataRecords:d}=l.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},f={returnDomainValues:!0,returnTopmostRaster:w,pixelSize:h,showNoDataRecords:d,signal:n?.signal};return s.queryVisibleRasters(t,f).then(R=>R)}async getSourceScale(){return await N(),await this.layer.load(),b(this.layer.serviceRasterInfo,this.view.spatialReference)}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return r([i()],e.prototype,"layer",void 0),r([i()],e.prototype,"suspended",void 0),r([i({readOnly:!0})],e.prototype,"timeExtent",null),r([i()],e.prototype,"view",void 0),e=r([v("esri.views.layers.ImageryLayerView")],e),e};export{O as m};
