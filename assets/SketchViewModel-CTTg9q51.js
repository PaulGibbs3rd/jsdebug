const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/editingTools-iOy8KUDk.js","assets/index-CzvLtnX1.js","assets/SnappingVisualizer2D-DYwQ_g61.js","assets/SnappingManager-DEKGuS80.js","assets/keybindings-DIxDEOyk.js","assets/geodesicUtils-C0S8HwBT.js","assets/geometry2dUtils-C5OK12a_.js","assets/viewUtils-D5G6nsnP.js","assets/SnappingVisualizer-CMv9S1yr.js","assets/PointSnappingHint-Dmq3EHae.js","assets/editPlaneUtils-B2Nxv8Mb.js","assets/SketchTooltipInfo-dn_tVsrX.js","assets/MeshTransform-Bv7hOi4j.js","assets/memoize-DmxaQ-k8.js","assets/quantityFormatUtils-DKqV-Ju2.js","assets/angularMeasurementUtils-DI0dMEin.js","assets/directionModeIcons-B1HTO4eU.js","assets/ReactiveSet-67kD2XpC.js","assets/dehydratedFeatureComparison-BBO76xQi.js","assets/EditGeometryOperations-B_ujSqy0.js","assets/InteractiveToolBase-CXcuwHxr.js","assets/SketchOptions-CyxQazxr.js","assets/SnappingOperation-D7WosXl0.js","assets/geometryEngine-CfNZEGqf.js","assets/geometryEngineBase-C-gsyNi-.js","assets/_commonjsHelpers-DCkdB7M8.js","assets/hydrated-BSJF97b-.js","assets/GraphicsLayer-BaW3rFbI.js","assets/automaticAreaMeasurementUtils-y6XJpiYO.js","assets/geodesicLengthMeasurementUtils-1KCptDKk.js","assets/euclideanAreaMeasurementUtils-B2AM7mQd.js","assets/automaticLengthMeasurementUtils-CjX17wm-.js","assets/cimSymbolUtils-D5sHtYK8.js","assets/GraphicManipulator-Bc6SDBuo.js","assets/drapedUtils-EmUI5byW.js","assets/drawUtils-vhzN4YLk.js","assets/editingTools-BUtwfz81.js","assets/TextOverlayItem-152VUesa.js","assets/VerticesVisualElement-DqnH-H5D.js","assets/ExtendedLineVisualElement-Ds1RnamP.js","assets/EngineVisualElement-D9oh89bd.js","assets/LineVisualElement-Dmig6oYe.js","assets/line-sE7VsM4I.js","assets/LaserlinePath.glsl-7piOlJpM.js","assets/RightAngleQuadVisualElement-r2_Rd_lk.js","assets/ColorMaterial.glsl-C-PiVLm-.js","assets/TriangleMaterial-DGLj9Hvg.js","assets/ShadedColorMaterial.glsl-ftyccgmu.js","assets/interfaces-BDwT84Az.js","assets/MoveManipulation-B_C3dVDr.js","assets/dragEventPipeline3D-BgOPl69K.js","assets/lineStippleUtils-CCavR4OV.js","assets/manipulatorUtils-BJgBLxjS.js","assets/SelectedVertexTooltipInfo-BiB_E01u.js","assets/TranslateTooltipInfo-BXevcnjp.js","assets/utils-CICEYmO-.js","assets/SlicePlaneMaterial.glsl-BkhkrmoY.js","assets/sliceToolConfig-keiWzNcS.js","assets/ImageMaterial.glsl-DcxC6lC7.js","assets/DefaultLayouts-CGjC8rk2.js","assets/persistable-DWAxeq4W.js","assets/resourceExtension-DZqQPpff.js","assets/Factory-y-ZtQUmf.js","assets/ExtentScaleTooltipInfo-BKLjWYZF.js","assets/GraphicsLayerView3D-DtFiw4Go.js","assets/LayerView3D-C3wz0Xd_.js","assets/queryForSymbologySnapping-Bij8ZnaA.js","assets/GraphicsProcessor-BmJgUgo2.js","assets/ExtentSet-qWs8Lc6G.js","assets/rendererConversion-CGpNLgtM.js","assets/optimizedFeatureQueryEngineAdapter-C01vnci5.js","assets/PooledRBush-IF1bQTeP.js","assets/popupUtils-C5Xxoh_A.js","assets/Graphics3DObjectStates-DZcqh-aC.js","assets/highlightUtils-D2lMfk8z.js","assets/projectExtentUtils-dd9OO2QQ.js","assets/geometryServiceUtils-DDNHyfMa.js","assets/LayerView-DMEwuW7Q.js","assets/GraphicMover-BsMw43Jq.js","assets/featureUtils-nB1KYXwd.js","assets/utils-CtGOd0WT.js","assets/Box-D60OkrMn.js","assets/settings-BNa0iZQh.js","assets/Reshape-DdkPwIh-.js"])))=>i.map(i=>d[i]);
import{sK as ne,nh as pe,sL as le,ew as ae,mt as he,b as c,m as y,c as L,h as ce,ik as K,aB as de,ii as ue,sM as ye,aG as $,sN as ge,ex as N,aP as H,aW as V,u as D,_ as S,e_ as ve,fe as F,dr as W,bs as me,aw as _e,f2 as fe,f3 as be,f1 as we,sO as Oe,sP as Ge,fH as Ee,bD as w,q5 as Z,sQ as A,iR as q,aA as Te,H as Se,em as Y,j_ as Ae,eU as z,sR as k}from"./index-CzvLtnX1.js";import Me from"./GraphicsLayer-BaW3rFbI.js";import{P as E,l as ie,r as Ce,E as B,c as ke,a as Re,b as He}from"./SketchOptions-CyxQazxr.js";import{p as _}from"./keybindings-DIxDEOyk.js";import{q as se,I as Q,H as De}from"./SnappingManager-DEKGuS80.js";function Ie(e){return Pe(e).result}function Pe(e){if(e.graphic&&e.graphic.layer?.type!=="graphics")return{result:E.GRAPHICS_LAYER_MISSING};if(!e.operations)return{result:E.GEOMETRY_MISSING};if(ne(e.elevationInfo))return{result:E.ELEVATION_MODE_UNSUPPORTED};const t=e.operations.data.type,o=e.operations.data.geometry;return t==="point"||t==="mesh"||t==="polyline"||t==="polygon"?{result:E.SUPPORTED,geometry:o}:{result:E.GEOMETRY_TYPE_UNSUPPORTED}}function Ue(e){if(e.layer?.type!=="graphics")return E.GRAPHICS_LAYER_MISSING;if(e.geometry==null)return E.GEOMETRY_MISSING;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return E.SUPPORTED;default:return E.GEOMETRY_TYPE_UNSUPPORTED}const t=e.symbol!=null&&e.symbol.type==="point-3d"&&e.symbol.symbolLayers;return!t||!t.some(o=>o.type==="object")?E.SYMBOL_TYPE_UNSUPPORTED:pe(e)!=="on-the-ground"&&le(e)?E.ELEVATION_MODE_UNSUPPORTED:E.SUPPORTED}function J(e,t,o){if(!t||!e?.map)return;const{map:a}=e;a.layers.find(s=>s===t)||a.add(t,o)}function Ze(e,t){const o=t?.type==="subtype-sublayer"?t.parent:t;return e.allLayerViews.find(a=>{const i=a.layer;return i===o||"sublayers"in i&&i.sublayers!=null&&i.sublayers.includes(o)})}let O=class extends ae.EventedAccessor{constructor(t){super(t),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:he(this.activeComponent)}return null}addToHistory(t){this.history.redo=[],this.history.undo.push(t)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){const t=this.activeComponent;t&&(t.type!=="box"&&t.type!=="reshape"&&t.type!=="graphic-mover"||t.refresh())}set undo(t){this._set("undo",()=>{this.canUndo()&&t()})}set redo(t){this._set("redo",()=>{this.canRedo()&&t()})}};c([y()],O.prototype,"activeComponent",void 0),c([y()],O.prototype,"cancelled",void 0),c([y()],O.prototype,"history",void 0),c([y()],O.prototype,"tool",null),c([y()],O.prototype,"type",void 0),c([y()],O.prototype,"canUndo",null),c([y()],O.prototype,"canRedo",null),c([y()],O.prototype,"onEnd",void 0),c([y()],O.prototype,"undo",null),c([y()],O.prototype,"redo",null),c([y()],O.prototype,"toggleTool",void 0),c([y()],O.prototype,"addToSelection",void 0),c([y()],O.prototype,"removeFromSelection",void 0),O=c([L("esri.widgets.Sketch.support.OperationHandle")],O);let x=class extends O{};c([y()],x.prototype,"activeComponent",void 0),x=c([L("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],x);let M=class extends O{};c([y()],M.prototype,"activeComponent",void 0),M=c([L("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],M);function xe(e,t){return t==="freehandPolygon"||t==="freehandPolyline"?"freehand":e??(t==="rectangle"||t==="circle"?"hybrid":"click")}function Le(e){switch(e){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";default:return e}}var X;(function(e){e[e.ForceCollapse=-1]="ForceCollapse",e[e.Low=0]="Low",e[e.Medium=10]="Medium",e[e.High=100]="High",e[e.Max=1e3]="Max"})(X||(X={}));const ee={defaultZ:0},R={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0},tool:"transform"};let v=class extends ae.EventedAccessor{constructor(e){super(e),this._defaultSnappingManager=null,this._updatingHandles=new ce,this._internalGraphicsLayer=new Me({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new K({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new de({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new ue({color:[130,130,130,1],width:2}),this.meshSymbol=new ye({symbolLayers:new $([new ge])}),this.updateGraphics=new $,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new K({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new ie,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._originalPopupEnabled=null,this.defaultCreateOptions=ee,this.defaultUpdateOptions=R,this.snappingOptions=e?.snappingManager?.options??e?.snappingOptions??new se}initialize(){this.addHandles([N(()=>this.view?.map?.layers,"change",e=>{e.removed.includes(this.layer)&&this.cancel()}),N(()=>this.layer?.graphics,"change",e=>{if(this._operationHandle!=null)for(const t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())}),H(()=>this.layer?.elevationInfo??null,e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=e)},V),H(()=>this.view,e=>{this._defaultSnappingManager=D(this._defaultSnappingManager),e&&(this.snappingManager||(this._defaultSnappingManager=new Q({view:e,options:this.snappingOptions})),e.type==="2d"?S(()=>import("./editingTools-iOy8KUDk.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35])):e.type==="3d"&&(S(()=>import("./editingTools-BUtwfz81.js"),__vite__mapDeps([36,1,7,14,37,31,29,23,24,25,26,5,38,39,40,41,42,43,44,45,46,3,4,6,8,9,47,48,49,50,20,19,51,10,11,12,13,15,16,17,18,21,22,27,28,30,52,53,54,55,32,56,57,58,59,60,61,62,63,33,34])),S(()=>import("./GraphicsLayerView3D-DtFiw4Go.js"),__vite__mapDeps([64,1,65,66,67,68,69,70,71,72,73,74,75,76,77]))))},V),H(()=>this.view?.spatialReference,(e,t)=>{e&&t&&!e.equals(t)&&this.cancel()})]),De(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=D(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get updating(){return this._updatingHandles.updating||this.snappingManager!=null&&this.snappingManager.updating}get activeTool(){return this._operationHandle?.tool??null}get activeCreateToolDrawMode(){return this._operationHandle?.type==="create"&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){const{activeComponent:e,destroyed:t}=this,o=!t&&e&&"tooltip"in e?e.tooltip:null;return o?.visible?o:null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return this.activeComponent==null||this.activeComponent.type!=="draw-3d"&&this.activeComponent.type!=="draw-2d"?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...ee,...e})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...R,...e,reshapeOptions:{...R.reshapeOptions,...e?.reshapeOptions},highlightOptions:{...R.highlightOptions,...e?.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get snappingOptions(){return this.snappingManager?.options??this._get("snappingOptions")}set snappingOptions(e){this._defaultSnappingManager!=null&&(this._defaultSnappingManager.options=e),this._set("snappingOptions",e)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(e){if(e)this._isOverridden("snappingManager")||(this._defaultSnappingManager=D(this._defaultSnappingManager)),this._override("snappingManager",e);else{const{view:t}=this;!this._defaultSnappingManager&&t&&(this._defaultSnappingManager=new Q({options:this.snappingOptions,view:t})),this._clearOverride("snappingManager")}}get state(){const e=!(!this.view?.ready||!this.layer),t=this._operationHandle;return e&&t?"active":e?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:a,map:i}=t;a&&(t.cursor=null),i?.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const o="view-ready";this.removeHandles(o),e&&this.addHandles(ve(()=>e.ready,a=>{this.removeHandles(this._viewHandlesKey),a&&this.addHandles(this._generateViewHandles(e),this._viewHandlesKey)},V),o),this._set("view",e)}cancel(){this._moduleLoaderAbortController=F(this._moduleLoaderAbortController),this._viewReadyAbortController=F(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:e,updateGraphics:t}=this;if(e==="active"&&t.length){const{activeTool:o,layer:a}=this,i=t.toArray();a.removeMany(i),this.cancel(),this._emitDeleteEvent({graphics:i,tool:o})}}duplicate(){if(this.state==="active"&&this.updateGraphics.length){const e=this.updateGraphics.map(t=>t.clone()).toArray();return this.layer.addMany(e),this.emit("duplicate",{graphics:e,type:"duplicate"}),e}return[]}async create(e,t){this.cancel(),await this._waitViewReady();const{view:o,layer:a}=this;if(!o||this.state==="disabled")throw a||this._logMissingLayer(),W();if(o.activeTool!=null&&(o.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");J(o,this._internalGraphicsLayer);const i=await this._updatingHandles.addPromise(this._setupCreateOperation(e,t));if(i==null||this.destroyed)return void o.map.remove(this._internalGraphicsLayer);const s=()=>{if(i===this._operationHandle){const l=this.createGraphic,n=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view?.map&&this.view.map.remove(this._internalGraphicsLayer),i.cancelled||l==null||a.add(l),this._sketchContinuationFlag=!1,this.emit("create",{graphic:l,state:n?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"}),n||this._sketchContinuationFlag)return;const{creationMode:p}=this;if(p==="continuous"){if(t?.geometryToPlace)return;this._updatingHandles.addPromise(z(this.create(e,t)))}else p==="update"&&l&&this._updatingHandles.addPromise(z(this.update([l])))}};i.on("complete",s),this._operationHandle=i,o.ready&&o.focus()}async place(e,t){return this.create("mesh",{mode:"click",hasZ:e.hasZ,geometryToPlace:e,...t})}async update(e,t){this.cancel(),await this._waitViewReady();const{layer:o,view:a,state:i}=this;if(!a||i==="disabled")throw o||this._logMissingLayer(),W();a.activeTool!=null&&(a.activeTool=null);const s=Array.isArray(e)?e:[e];if(e==null||!s?.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(s.some(n=>n.layer!==o?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):n.geometry==null&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0)))return;const l=await this._updatingHandles.addPromise(this._setupUpdateOperation(s,t));this.destroyed||l==null||b(l)||(J(a,this._internalGraphicsLayer),this._setUpdateOperationHandle(l,t),this.emit("update",{graphics:s,state:"start",aborted:!1,tool:l.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){const t=this.view;if(t){e=Array.isArray(e)?e:[e];for(const o of e)o.geometry==null||o.geometry.type==="mesh"||me(o.geometry.spatialReference,t.spatialReference)||(_e(o.geometry.spatialReference,t.spatialReference)||fe()||await be(),o.geometry=we(o.geometry,t.spatialReference))}else this._logMissingView()}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!!this._operationHandle?.canUndo()}canRedo(){return!!this._operationHandle?.canRedo()}toggleUpdateTool(){this._operationHandle?.toggleTool()}async _getFirstHit(e){const t=this.view;if(!t)return this._logMissingView(),null;if(t.type==="2d"){const i=[];t.map.allLayers.forEach(l=>{l.type!=="vector-tile"&&l.type!=="imagery"||i.push(l)});const s=await t.hitTest(e,{exclude:i});return Oe(s.results)}const o=[t.map.ground];t.map.allLayers.forEach(i=>{Ge(i.type)&&o.push(i)});const a=await t.hitTest(e,{exclude:o});if(a.results.length>0){const i=a.results[0];if(i!=null&&i.type==="graphic"&&i.graphic&&(!a.ground.mapPoint||t.map.ground.opacity<1||a.ground.distance-(i.distance??0)>-Math.min(3*a.ground.distance,t.viewingMode==="global"?Ee(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return i}return null}_generateViewHandles(e){return[e.on("immediate-click",async t=>{const o=this.state==="active"&&this._operationHandle?.type==="create";this.state!=="disabled"&&!o&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(t))},w.WIDGET)]}async _handleImmediateClick(e){const t=await e.async(()=>this._getFirstHit(Z(e)));let o=null;if(t!=null){const a=t.graphic;this.updateGraphics.includes(a)||a.layer===this.layer?(e.stopPropagation(),o=a):this.view?.type!=="2d"||this._isComponentGraphic(a)||this.state!=="active"||this.cancel()}else this.state==="active"&&this.cancel();o==null||this.updateGraphics.includes(o)||await this.update([o],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}})}async _setupCreateOperation(e,t){const o=this.view;if(!o)return this._logMissingView(),null;const a={hasZ:o.type==="3d",...this.defaultCreateOptions,...t},i=await this._setupDrawGraphicTool(e,o,a);return i==null?null:(o.tools.add(i),o.activeTool=i,this._setupCreateOperationHandle(i))}async _setupDrawGraphicTool(e,t,o){if(e==="multipoint"&&t.type==="3d")return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!t)return this._logMissingView(),null;const{cursor:a,defaultZ:i,hasZ:s,geometryToPlace:l,graphicProperties:n,mode:p,preserveAspectRatio:r}=o,d=xe(p,e),g=Le(e),m=o?.optionsPerTool?.has(e)?o.optionsPerTool.get(e):{},u=m?.preserveAspectRatio??r??e!=="rectangle",h={centered:e!=="rectangle"&&!(e==="circle"&&!u),cursor:a,defaultZ:i,forceUniformSize:u,graphicProperties:{...n,attributes:{...n?.attributes}},geometryToPlace:l,geometryType:g,mode:d,graphicSymbol:this._getGraphicSymbolFromTool(e),hasZ:s,snappingManager:this.snappingManager,snapToScene:!1,view:t,...m};return t.type==="2d"?this._makeDrawGraphicTool2D(h):this._makeDrawGraphicTool3D(h)}async _makeDrawGraphicTool2D(e){const t=await this._requireModule(S(()=>import("./editingTools-iOy8KUDk.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35])));return b(t)||this.destroyed?null:new t.module.DrawGraphicTool2D({...e,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:Fe(e.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions})}async _makeDrawGraphicTool3D(e){const t=await this._requireModule(S(()=>import("./editingTools-BUtwfz81.js"),__vite__mapDeps([36,1,7,14,37,31,29,23,24,25,26,5,38,39,40,41,42,43,44,45,46,3,4,6,8,9,47,48,49,50,20,19,51,10,11,12,13,15,16,17,18,21,22,27,28,30,52,53,54,55,32,56,57,58,59,60,61,62,63,33,34])));if(b(t)||this.destroyed)return null;const{elevationInfo:o}=this.layer;return new t.module.DrawGraphicTool3D({...e,elevationInfo:o,snapToScene:!0,sketchOptions:this.sketchOptions})}_setupCreateOperationHandle(e){const t=this.view;if(!t)return this._logMissingView(),null;let o=null;const a=e.forceUniformSize,i=e.centered,s=[t.on("key-down",n=>{if(n.key===_.pan)n.stopPropagation(),n.repeat||(e.enabled=!1);else if(n.key===_.complete)n.stopPropagation(),e.completeCreateOperation();else if(n.key!==_.vertexAdd||n.repeat)n.key===_.undo?(n.stopPropagation(),l.undo()):n.key===_.redo?(n.stopPropagation(),l.redo()):n.key!==_.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"||n.repeat?n.key===_.center&&(n.repeat||(e.centered=!i,n.stopPropagation())):(e.forceUniformSize=!a,n.stopPropagation());else{const p=e.drawOperation.geometryType;p!=="polyline"&&p!=="polygon"&&p!=="multipoint"||(n.stopPropagation(),e.drawOperation.commitStagedVertex())}},w.WIDGET),t.on("key-up",n=>{n.key===_.pan?e.enabled=!0:n.key!==_.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"?n.key===_.center&&(e.centered=i,n.stopPropagation()):(e.forceUniformSize=a,n.stopPropagation())},w.WIDGET),e.on("vertex-add",n=>{switch(o=o==null?"start":"active",n.operation){case"apply":this.emit("create",{graphic:e.graphic,state:o,tool:this.activeTool,toolEventInfo:n,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("cursor-update",n=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:n.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),e.on("vertex-remove",n=>{switch(n.operation){case"apply":this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:n,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("complete",n=>{this._set("createGraphic",n.graphic),o="complete",n.aborted?l&&l.cancel():l&&l.complete()}),H(()=>this._getGraphicSymbolFromTool(e.geometryType),n=>{e.graphicSymbol=n})],l=new x({activeComponent:e,tool:e.geometryType,type:"create",onEnd:()=>{A(s),t.tools?.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return l}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol}}async _setupUpdateOperation(e,t){const{layer:o,view:a}=this;if(!a)return this._logMissingView(),null;const i={...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...t?.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...t?.highlightOptions}};let s=i.tool??R.tool;for(const l of e)o.remove(l),o.add(l);if(a.type==="3d"){if(e.length===0)return null;switch(s){case"move":return this._setupMove3DOperation(e,i,a,s);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(e[0],i,a);case"transform":return this._setupGraphicTransform3DOperation(e,i,a)}}switch(s){case"move":return this._setupMove2DOperation(e,i,a);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(e,s,i,a);case"transform":if(e.length===1){const l=e[0].geometry?.type;l!=="point"&&l!=="multipoint"||(s="reshape")}return this._setupTransformOrReshape2DOperation(e,s,i,a)}}async _setupMove3DOperation(e,t,o,a,i=!1){const s=await this._requireModule(S(()=>import("./editingTools-BUtwfz81.js"),__vite__mapDeps([36,1,7,14,37,31,29,23,24,25,26,5,38,39,40,41,42,43,44,45,46,3,4,6,8,9,47,48,49,50,20,19,51,10,11,12,13,15,16,17,18,21,22,27,28,30,52,53,54,55,32,56,57,58,59,60,61,62,63,33,34])));if(b(s))return s;const{ManipulatedObject3DGraphic:l,MoveTool3D:n}=s.module,p=new Map,r=()=>{p.forEach(u=>u.destroy()),p.clear()};for(const u of e){const h=new l({view:o,graphic:u}),G=Ce(h);if(G!==E.SUPPORTED)return r(),this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${B(G)}).`),null;p.set(u,h)}const d=new n({view:o,enableZ:t.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});o.tools.add(d),d.objects.addMany(Array.from(p.values())),i||this.updateGraphics.addMany(e);const g=[],m=new M({activeComponent:d,tool:a,type:"update",onEnd:()=>{A(g),U(o,d),r()},undo:()=>{oe(this.view,d),I(m,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a})},redo:()=>{P(m,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a})},addToSelection:u=>{this.updateGraphics.push(u);const h=new l({view:o,graphic:u});p.set(u,h),d.objects.push(h),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[u],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:u=>{const h=this.updateGraphics.indexOf(u);if(m.history.undo.forEach(T=>T.updates.splice(h,1)),m.history.redo.forEach(T=>T.updates.splice(h,1)),this.updateGraphics.remove(u),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[u],type:"selection-change"},type:"update"}),this.updateGraphics.length===0)return void m.complete();const G=p.get(u);G&&(d.objects.remove(G),G.destroy(),p.delete(u))},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1||a!=="transform")return;const u=this.updateGraphics.at(0),h=await this._setupReshape3DOperation(u,t,o,!0);h&&!b(h)&&(m.onEnd(),m.destroy(),this._setUpdateOperationHandle(h,t))}});return g.push(...this._getHandlesForComponent(m,t),o.on("immediate-click",u=>this._getCommonUpdateOperationClickHandlers(m,u,t),w.WIDGET),o.on("key-down",u=>{this._getCommonUpdateOperationKeyDownHandlers(m,u)},w.WIDGET)),m}_setupGraphicTransform3DOperation(e,t,o,a=!1){if(e.length===1&&Ue(e[0])===E.SUPPORTED){const i=e[0],s=i.geometry;if(s!=null&&(s.type==="point"||s.type==="mesh"))return this._setupPointTransform3DOperation(i,t,o);if(s!=null&&(s.type==="polygon"||s.type==="polyline"))return this._setupPolyTransform3DOperation(i,t,o,a)}return this._setupMove3DOperation(e,t,o,"transform",a)}async _setupPointTransform3DOperation(e,t,o){const a="transform",{enableRotation:i,enableScaling:s,enableZ:l}=t,n=await this._requireModule(S(()=>import("./editingTools-BUtwfz81.js"),__vite__mapDeps([36,1,7,14,37,31,29,23,24,25,26,5,38,39,40,41,42,43,44,45,46,3,4,6,8,9,47,48,49,50,20,19,51,10,11,12,13,15,16,17,18,21,22,27,28,30,52,53,54,55,32,56,57,58,59,60,61,62,63,33,34])));if(b(n))return n;const{TransformTool3D:p,ManipulatedObject3DGraphic:r}=n.module,d=new r({graphic:e,view:o}),g=new p({object:d,view:o,enableRotation:i,enableScaling:s,enableZ:l,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});o.tools.add(g),this.updateGraphics.add(e);const m=[],u=new M({activeComponent:g,tool:a,type:"update",onEnd:()=>{A(m),U(o,g),d.destroy()},undo:()=>{oe(this.view,g),I(u,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a})},redo:()=>{P(u,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a})},addToSelection:async h=>{this.updateGraphics.add(h),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[h],removed:[],type:"selection-change"},type:"update"}),u.onEnd(),u.destroy();const G=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,o,"transform",!0);b(G)||this._setUpdateOperationHandle(G,t)},removeFromSelection:h=>{this.updateGraphics.remove(h),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[h],type:"selection-change"},type:"update"}),u.complete()},toggleTool:()=>{}});return m.push(...this._getHandlesForComponent(u,t),o.on("immediate-click",h=>this._getCommonUpdateOperationClickHandlers(u,h,t),w.WIDGET),o.on("key-down",h=>{this._getCommonUpdateOperationKeyDownHandlers(u,h)},w.WIDGET)),u}async _setupPolyTransform3DOperation(e,t,o,a=!1){const i="transform",{enableRotation:s,enableScaling:l,enableZ:n,preserveAspectRatio:p}=t,r=await this._requireModule(S(()=>import("./editingTools-BUtwfz81.js"),__vite__mapDeps([36,1,7,14,37,31,29,23,24,25,26,5,38,39,40,41,42,43,44,45,46,3,4,6,8,9,47,48,49,50,20,19,51,10,11,12,13,15,16,17,18,21,22,27,28,30,52,53,54,55,32,56,57,58,59,60,61,62,63,33,34])));if(b(r))return r;const{ManipulatedObject3DGraphic:d,ExtentTransformTool:g}=r.module,m=this.view?.inputManager?.isModifierKeyDown(_.constraint),u=new d({view:o,graphic:e}),h=new g({object:u,view:o,enableRotation:s,enableScaling:l,enableZ:n,preserveAspectRatio:!!p!=!!m,sketchOptions:this.sketchOptions});o.tools.add(h),a||this.updateGraphics.add(e);const G=[],T=new M({activeComponent:h,tool:i,type:"update",onEnd:()=>{A(G),U(o,h),u.destroy()},canUndo:()=>!h.destroyed&&h.canUndo,undo:()=>{h.destroyed||(h.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i}))},canRedo:()=>!h.destroyed&&h.canRedo,redo:()=>{h.destroyed||(h.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i}))},addToSelection:async f=>{this.updateGraphics.add(f),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[f],removed:[],type:"selection-change"},type:"update"}),T.onEnd(),T.destroy();const j=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,o,"transform",!0);b(j)||this._setUpdateOperationHandle(j,t)},removeFromSelection:f=>{this.updateGraphics.remove(f),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[f],type:"selection-change"},type:"update"}),T.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1)return;const f=await this._setupReshape3DOperation(e,t,o,!0);f&&!b(f)&&(T.onEnd(),T.destroy(),this._setUpdateOperationHandle(f,t))}});return G.push(...this._getHandlesForComponent(T,t),o.on("immediate-click",f=>this._getCommonUpdateOperationClickHandlers(T,f,t),w.WIDGET),o.on("key-down",f=>this._getCommonUpdateOperationKeyDownHandlers(T,f),w.WIDGET),o.on("key-down",f=>{f.key!==_.constraint||f.repeat||(h.preserveAspectRatio=!h.preserveAspectRatio,f.stopPropagation())},w.WIDGET),o.on("key-up",f=>{f.key===_.constraint&&(h.preserveAspectRatio=!h.preserveAspectRatio,f.stopPropagation())},w.WIDGET)),T}async _setupMove2DOperation(e,t,o){const a="move";this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const i=await this._getGraphicMover(e,t,o);if(b(i))return i;const s=new M({activeComponent:i,tool:a,type:"update",onEnd:()=>{this._displayDefaultCursor(),A(p),A(n),i.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const r=this.updateGraphics.toArray();I(s,r),s.refreshComponent(),this._emitUndoEvent({graphics:r,tool:a})},redo:()=>{const r=this.updateGraphics.toArray();P(s,r),s.refreshComponent(),this._emitRedoEvent({graphics:r,tool:a})},addToSelection:async r=>{await this._updatingHandles.addPromise(this._updateSpatialReference(r)),this.updateGraphics.push(r),i.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[r],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:r=>{const d=this.updateGraphics.indexOf(r);s.history.undo.forEach(m=>m.updates.splice(d,1)),s.history.redo.forEach(m=>m.updates.splice(d,1)),this.updateGraphics.remove(r);const g=this.updateGraphics.toArray();this.emit("update",{graphics:g,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[r],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?i.graphics=g:s.complete()}});let l=!1;const n=[o.on("immediate-click",r=>this._getCommonUpdateOperationClickHandlers(s,r,t),w.WIDGET),o.on("key-down",r=>{this._getCommonUpdateOperationKeyDownHandlers(s,r),r.key!==_.constraint||r.repeat||(l=!0,i.enableMoveAllGraphics=!i.enableMoveAllGraphics)},w.WIDGET),o.on("key-up",r=>{r.key===_.constraint&&l&&(l=!1,i.enableMoveAllGraphics=!i.enableMoveAllGraphics)},w.WIDGET)],p=this._getHandlesForComponent(s,t);return s}async _setupReshape3DOperation(e,t,o,a=!1){const i="reshape",s=await this._requireModule(S(()=>import("./editingTools-BUtwfz81.js"),__vite__mapDeps([36,1,7,14,37,31,29,23,24,25,26,5,38,39,40,41,42,43,44,45,46,3,4,6,8,9,47,48,49,50,20,19,51,10,11,12,13,15,16,17,18,21,22,27,28,30,52,53,54,55,32,56,57,58,59,60,61,62,63,33,34])));if(b(s))return s;const{ManipulatedObject3DGraphic:l,ReshapeTool3D:n}=s.module,p=new l({view:o,graphic:e}),r=Ie(p);if(r!==E.SUPPORTED)return p.destroy(),this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${B(r)}).`),null;const d=t.reshapeOptions,g=new n({view:o,object:p,enableZVertex:t.enableZ&&d?.vertexOperation==="move",enableZShape:t.enableZ&&d?.shapeOperation==="move",enableMoveObject:d?.shapeOperation==="move"||d?.shapeOperation==="move-xy",enableMidpoints:d?.edgeOperation==="split",enableEdgeOffset:d?.edgeOperation==="offset",snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});o.tools.add(g),a||this.updateGraphics.add(p.graphic);const m=[],u=new M({activeComponent:g,tool:i,type:"update",onEnd:()=>{A(m),U(o,g),p.destroy()},canUndo:()=>!g.destroyed&&g.canUndo,undo:()=>{g.destroyed||(g.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i}))},canRedo:()=>!g.destroyed&&g.canRedo,redo:()=>{g.destroyed||(g.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i}))},addToSelection:async h=>{this.updateGraphics.add(h),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[h],removed:[],type:"selection-change"},type:"update"}),u.onEnd(),u.destroy();const G=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,o,"transform",!0);b(G)||this._setUpdateOperationHandle(G,t)},removeFromSelection:h=>{this.updateGraphics.remove(h),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[h],type:"selection-change"},type:"update"}),u.complete()},toggleTool:async()=>{if(t.toggleToolOnClick===!1)return;u.onEnd(),u.destroy();const h=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,o,!0);b(h)||this._setUpdateOperationHandle(h,t)}});return m.push(...this._getHandlesForComponent(u,t),o.on("immediate-click",h=>this._getCommonUpdateOperationClickHandlers(u,h,t),w.WIDGET),o.on("key-down",h=>{this._getCommonUpdateOperationKeyDownHandlers(u,h)},w.WIDGET)),u}async _setupTransformOrReshape2DOperation(e,t,o,a){this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const i=t==="transform"?await this._getBox(e,o,a):await this._getReshape(e,o,a);if(b(i))return i;const s=new M({activeComponent:i,type:"update",onEnd:()=>{A(n),A(l),s.activeComponent&&!s.activeComponent.destroyed&&s.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{I(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},redo:()=>{P(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},addToSelection:async p=>{let r=s.activeComponent;if(r?.type==="reshape"){const d=[...this.updateGraphics,p];this.updateGraphics.removeAll(),s.onEnd(),s.destroy();const g=await this._setupTransformOrReshape2DOperation(d,"transform",o,a);if(b(g))return;this._setUpdateOperationHandle(g,o)}else this.updateGraphics.add(p),r.graphics=this.updateGraphics.toArray(),r.refresh(),s.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[p],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async p=>{const r=this.updateGraphics.indexOf(p);s.history.undo.forEach(g=>g.updates.splice(r,1)),s.history.redo.forEach(g=>g.updates.splice(r,1)),this.updateGraphics.remove(p);const d=this.updateGraphics.toArray();if(d.length===0)s.complete();else{const g=d[0].geometry;d.length!==1||g==null||g.type!=="point"&&g.type!=="multipoint"?s.activeComponent.graphics=d:s.toggleTool()}this.emit("update",{graphics:d,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[p],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const p=this.updateGraphics.at(0),r=p.geometry;if(r!=null&&(s.tool==="reshape"&&(r.type==="point"||r.type==="multipoint")||s.tool==="transform"&&r.type==="extent"))return;let d=null;s.tool==="transform"?d=await this._getReshape([p],o,a):s.tool==="reshape"&&(d=await this._getBox([p],o,a)),b(d)||(s.activeComponent?.destroy(),s.activeComponent=d,s.activeComponent&&(A(n),n=this._getHandlesForComponent(s,o)))}}),l=[a.on("immediate-click",p=>this._getCommonUpdateOperationClickHandlers(s,p,o),w.WIDGET),a.on("key-down",p=>{if(this._getCommonUpdateOperationKeyDownHandlers(s,p),p.key===_.constraint&&!p.repeat&&s){const r=s.activeComponent;r&&r.type==="box"&&(r.preserveAspectRatio=!r.preserveAspectRatio)}},w.WIDGET),a.on("key-up",p=>{if(p.key===_.constraint&&s){const r=s.activeComponent;r&&r.type==="box"&&(r.preserveAspectRatio=!r.preserveAspectRatio)}},w.WIDGET)];let n=this._getHandlesForComponent(s,o);return s}async _getGraphicMover(e,t,o){const{enableMoveAllGraphics:a,highlightOptions:i}=t,s=await this._requireModule(S(()=>import("./GraphicMover-BsMw43Jq.js").then(l=>l.G),__vite__mapDeps([78,1,27,35,79,80,33,34])));return b(s)?s:new s.module.default({enableMoveAllGraphics:a,highlightsEnabled:!!i?.enabled,indicatorsEnabled:!1,graphics:e,view:o,callbacks:{onGraphicMoveStart:({dx:l,dy:n,graphic:p})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:n,mover:p,type:"move-start"},type:"update"})},onGraphicMove:({dx:l,dy:n,graphic:p})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:n,mover:p,type:"move"},type:"update"}),onGraphicMoveStop:({dx:l,dy:n,graphic:p})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:n,mover:p,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,t,o){const{enableRotation:a,enableScaling:i,highlightOptions:s,preserveAspectRatio:l}=t,n=await this._requireModule(S(()=>import("./Box-D60OkrMn.js"),__vite__mapDeps([81,1,35,78,27,79,80,33,34,82,21,15,5,11,12,4,13,14,16,17,18,19,6,20,3,7,22,23,24,25,26,63,31,29,54])));if(b(n))return n;const p=this.view?.inputManager?.isModifierKeyDown(_.constraint);return new n.module.default({graphics:e,enableRotation:a,enableScaling:i,highlightsEnabled:!!s?.enabled,preserveAspectRatio:!!l!=!!p,layer:this._internalGraphicsLayer,view:o,sketchOptions:this.sketchOptions,callbacks:{onMoveStart:r=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...r},type:"update"}),onMove:r=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...r},type:"update"}),onMoveStop:r=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...r},type:"update"}),onScaleStart:r=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...r},type:"update"}),onScale:r=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...r},type:"update"}),onScaleStop:r=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...r},type:"update"}),onRotateStart:r=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...r},type:"update"}),onRotate:r=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...r},type:"update"}),onRotateStop:r=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...r},type:"update"})}})}async _getReshape(e,t,o){const a=t.reshapeOptions?.edgeOperation==="split",i=t.reshapeOptions?.shapeOperation==="move",s=!!t.highlightOptions?.enabled,l=await this._requireModule(S(()=>import("./Reshape-DdkPwIh-.js"),__vite__mapDeps([83,1,27,2,3,4,5,6,7,8,9,35,78,79,80,33,34,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,53,28,29,30,54,31,82])));return b(l)?l:new l.module.default({enableMidpoints:a,enableMovement:i,graphic:e[0],highlightsEnabled:s,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,view:o,callbacks:{onReshapeStart:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n},type:"update"}),onReshape:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n},type:"update"}),onReshapeStop:({mover:n,type:p})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n,type:p},type:"update"}),onMoveStart:({dx:n,dy:p,mover:r,type:d})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:n,dy:p,mover:r,type:d},type:"update"}),onMove:({dx:n,dy:p,mover:r,type:d})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:n,dy:p,mover:r,type:d},type:"update"}),onMoveStop:({dx:n,dy:p,mover:r,type:d})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:n,dy:p,mover:r,type:d},type:"update"}),onVertexAdd:({added:n,type:p,vertices:r})=>{const d=n.map(g=>q(g.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:d,vertices:r,type:p},type:"update"})},onVertexRemove:({removed:n,type:p,vertices:r})=>{const d=n.map(g=>q(g.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:d,vertices:r,type:p},type:"update"})}}})}_getHandlesForComponent(e,t){const o=e.activeComponent;if(!o)return[];switch(o.type){case"graphic-mover":return[o.on("graphic-click",({graphic:a,viewEvent:i})=>{i.native?.shiftKey&&(i.stopPropagation(),e.removeFromSelection(a))}),o.on("graphic-move-start",a=>e.addToHistory(C(a.allGraphics)))];case"box":return[o.on("graphic-click",a=>this._onTransformOrReshape2DGraphicClick(e,t,a)),o.on("move-start",a=>e.addToHistory(C(a.graphics))),o.on("rotate-start",a=>e.addToHistory(C(a.graphics))),o.on("scale-start",a=>e.addToHistory(C(a.graphics)))];case"reshape":return[o.on("graphic-click",a=>this._onTransformOrReshape2DGraphicClick(e,t,a)),o.on("move-start",a=>e.addToHistory(C([a.mover]))),o.on("reshape-start",a=>e.addToHistory(C([a.graphic]))),o.on("vertex-add",a=>e.addToHistory(C([a.oldGraphic]))),o.on("vertex-remove",a=>e.addToHistory(C([a.oldGraphic])))];case"move-3d":return[o.events.on("record-undo",({updates:a})=>{e.addToHistory({updates:a})}),o.events.on("move-start",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:a.objects.length>0?a.objects[0].graphic:null,type:"move-start"},type:"update"})}),o.events.on("move",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:a.dx,dy:a.dy,mover:a.objects.length>0?a.objects[0].graphic:null,type:"move"},type:"update"})}),o.events.on("move-stop",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:a.objects.length>0?a.objects[0].graphic:null,type:"move-stop"},type:"update"})}),o.events.on("immediate-click",a=>{a.shiftKey?this._toggleSelection([a.object.graphic],e,t):e.toggleTool()})];case"transform-3d":return[o.events.on("record-undo",({updates:a})=>{e.addToHistory({updates:a})}),o.events.on("translate-start",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,dx:a.dxScreen,dy:a.dyScreen,type:"move-start"},type:"update"})}),o.events.on("translate-stop",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,dx:a.dxScreen,dy:a.dyScreen,type:"move-stop"},type:"update"})}),o.events.on("rotate-start",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,angle:a.angle,type:"rotate-start"},type:"update"})}),o.events.on("rotate-stop",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,angle:a.angle,type:"rotate-stop"},type:"update"})}),o.events.on("scale-start",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,xScale:a.xScale,yScale:a.yScale,type:"scale-start"},type:"update"})}),o.events.on("scale-stop",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,xScale:a.xScale,yScale:a.yScale,type:"scale-stop"},type:"update"})}),o.events.on("translate",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,dx:a.dxScreen,dy:a.dyScreen,type:"move"},type:"update"})}),o.events.on("rotate",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,angle:a.angle,type:"rotate"},type:"update"})}),o.events.on("scale",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,xScale:a.xScale,yScale:a.yScale,type:"scale"},type:"update"})}),o.events.on("immediate-click",a=>{a.shiftKey?this._toggleSelection([a.object.graphic],e,t):e.toggleTool()})];case"reshape-3d":return[o.events.on("reshape",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...a,mover:a.object.graphic},type:"update"})}),o.events.on("move",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...a,mover:a.object.graphic},type:"update"})}),o.events.on("vertex-add",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:a,type:"update"})}),o.events.on("vertex-remove",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:a,type:"update"})}),o.events.on("immediate-click",a=>{a.shiftKey?this._toggleSelection([a.object.graphic],e,t):e.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(e,t,o){const{graphic:a,viewEvent:i}=o;return i.native?.shiftKey&&a.layer===this.layer?(i.stopPropagation(),e.removeFromSelection(a)):t.toggleToolOnClick?(i.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;const o=this.view?.map;this._disablePopup(t);const a=()=>{if(e===this._operationHandle){const i=this.updateGraphics.toArray(),s=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),o&&o.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:i,state:"complete",aborted:e.cancelled,tool:s,toolEventInfo:null,type:"update"})}};e.on("complete",a)}async _getCommonUpdateOperationClickHandlers(e,t,o){const a=Z(t),i=await t.async(()=>this._getFirstHit(a));if(i==null)return void e.complete();if(t.native.shiftKey&&this._toggleSelection([i.graphic],e,o))return void t.stopPropagation();this.updateGraphics.includes(i.graphic)?t.stopPropagation():e.complete()}_toggleSelection(e,t,o){const a=!!o.multipleSelectionEnabled;return e.some(i=>i!=null&&!(!a||i.layer!==this.layer)&&(this.updateGraphics.includes(i)?t.removeFromSelection(i):t.addToSelection(i),!0))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const o=t.key;o===_.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):o===_.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):o===_.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&_.delete.includes(o)&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||this._operationHandle.type!=="update")return;const t=this.activeComponent,o=this.updateGraphics.toArray();t!=null&&(t.type!=="reshape"||o.length===1&&o[0].geometry?.type==="point")&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view?.map?.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=D(this._internalGraphicsLayer))}_isComponentGraphic(e){const{activeComponent:t}=this;return!(!e||t==null)&&(e.attributes?.esriSketchTool||t.type==="draw-2d"&&t.graphic===e||(t.type==="box"||t.type==="reshape")&&t.isUIGraphic(e))}_displayPointerCursor(){this.view?.container&&this.view.cursor!=="pointer"&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view?.container&&this.view.cursor!=="grabbing"&&(this.view.cursor="grabbing")}_displayDefaultCursor(){this.view?.container&&this.view.cursor!==null&&(this.view.cursor=null)}_logError(e,t,o){Te.getLogger(this).error(new Se(e,t,o))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const o=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:o}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"})}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"})}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"})}get test(){}wait(){return Y(()=>!this.updating)}_disablePopupEnabled(e){return this.view?.type!=="3d"||this.updateOnGraphicClick||(e?.toggleToolOnClick??!1)}_disablePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled==null&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled!=null&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const e=this.view;e?(F(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await Ae(Y(()=>e?.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",te("view"))}_logMissingLayer(){this._logError(Ve,te("layer"))}};c([y()],v.prototype,"_defaultSnappingManager",void 0),c([y()],v.prototype,"updating",null),c([y({readOnly:!0})],v.prototype,"_updatingHandles",void 0),c([y()],v.prototype,"_operationHandle",void 0),c([y({readOnly:!0})],v.prototype,"activeTool",null),c([y({readOnly:!0})],v.prototype,"activeCreateToolDrawMode",null),c([y()],v.prototype,"activeTooltip",null),c([y({types:k})],v.prototype,"activeFillSymbol",void 0),c([y()],v.prototype,"activeLineSymbol",void 0),c([y()],v.prototype,"activeVertexSymbol",void 0),c([y()],v.prototype,"allowDeleteKey",void 0),c([y({readOnly:!0})],v.prototype,"createGraphic",null),c([y()],v.prototype,"defaultCreateOptions",null),c([y()],v.prototype,"defaultUpdateOptions",null),c([y({type:ke,nonNullable:!0})],v.prototype,"labelOptions",null),c([y()],v.prototype,"layer",void 0),c([y({types:k})],v.prototype,"pointSymbol",void 0),c([y({types:k})],v.prototype,"polygonSymbol",void 0),c([y({types:k})],v.prototype,"polylineSymbol",void 0),c([y()],v.prototype,"meshSymbol",void 0),c([y({type:se,nonNullable:!0})],v.prototype,"snappingOptions",null),c([y()],v.prototype,"snappingManager",null),c([y({readOnly:!0})],v.prototype,"state",null),c([y({type:Re,nonNullable:!0})],v.prototype,"tooltipOptions",null),c([y({readOnly:!0})],v.prototype,"updateGraphics",void 0),c([y()],v.prototype,"updateOnGraphicClick",void 0),c([y()],v.prototype,"creationMode",void 0),c([y({type:He,nonNullable:!0})],v.prototype,"valueOptions",null),c([y({types:k})],v.prototype,"vertexSymbol",void 0),c([y({value:null})],v.prototype,"view",null),c([y({constructOnly:!0,type:ie})],v.prototype,"sketchOptions",void 0),v=c([L("esri.widgets.Sketch.SketchViewModel")],v);const Ve="sketch:missing-property",te=e=>`Property '${e}' is missing on SketchViewModel.`;function Fe(e){return e==="polygon"||e==="rectangle"||e==="circle"}function I(e,t){re("undo",e.history.undo,e.history.redo,t)}function P(e,t){re("redo",e.history.redo,e.history.undo,t)}function re(e,t,o,a){const i=t.pop();if(!i)return;const s=i.updates,l=[];a.forEach((n,p)=>{const r=s[p];r!=null&&("geometry"in r&&r.geometry!=null&&(l.push({geometry:n.geometry}),n.geometry=r.geometry),"symbol"in r&&r.symbol!=null&&(l.push({symbol:n.symbol}),n.symbol=r.symbol),"undo"in r&&(l.push(r),r[e](n)))}),o.push({updates:l})}function oe(e,t){e!=null&&t.hasGrabbedManipulators&&(e.activeTool=null)}function C(e){return{updates:e.map(({geometry:t})=>t?.type==="mesh"?{geometry:t.cloneShallow()}:{geometry:t})}}function U(e,t){e.tools?.remove(t),t.destroyed||t.destroy()}function b(e){return"requireError"in e&&e.requireError==="aborted"}const Ye=v;export{J as e,X as o,Ze as r,Ye as y};
