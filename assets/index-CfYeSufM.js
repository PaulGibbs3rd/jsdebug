const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/IdentityManager-Dv2b6ouA.js","assets/substitute-o343UI2L.js","assets/pe-wasm-Co3DzcyP.js","assets/_commonjsHelpers-DCkdB7M8.js","assets/statsWorker-frReoajJ.js","assets/utils-CIXz-gK7.js","assets/utils-BhrB4brX.js","assets/utils-BKnGA3r8.js","assets/ClassBreaksDefinition-DoCyKXSY.js","assets/geometryEngineWorker-CA-tZxOm.js","assets/geometryEngineJSON-Bvf5zUh7.js","assets/geometryEngineBase-B0ZyeKAX.js","assets/json-Wa8cmqdu.js","assets/CSVSourceWorker-DDUFQv9g.js","assets/date-Ctp1FiBW.js","assets/executeQueryForSnapping-BUybDIiM.js","assets/queryUtils-DtT3aDWa.js","assets/QueryEngine-cQ0vqxfk.js","assets/WhereClauseCache-DzuFrL5J.js","assets/WhereClause-bK2RCJcj.js","assets/TimeOnly-DNvrMvt4.js","assets/timeSupport-bCcjezcf.js","assets/QueryEngineCapabilities-B_pTbIiR.js","assets/FixedIntervalBinParameters-Bkvg0YgI.js","assets/FeatureStore-DH0gRYjl.js","assets/BoundsStore-Cmt-LIta.js","assets/PooledRBush-pKd6bsUR.js","assets/optimizedFeatureQueryEngineAdapter-HsAI-PQN.js","assets/number-CRXbdJTy.js","assets/clientSideDefaults-K90s17Gp.js","assets/EdgeProcessingWorker-bhaYY9vs.js","assets/workerHelper-rAEqZtAf.js","assets/bufferLayouts-BSMug04M.js","assets/edgeProcessing-CNLZuFc6.js","assets/ElevationSamplerWorker-BIAu7-7B.js","assets/vertexSpaceConversion-JNc9XxOX.js","assets/vec4-CjBq_Rau.js","assets/FeatureServiceSnappingSourceWorker-2S_G8aLC.js","assets/symbologySnappingCandidates-CQ03R-gE.js","assets/pbfQueryUtils-BrHmNfsd.js","assets/pbf-C_A4_SkO.js","assets/query-Dejhq4q-.js","assets/GeoJSONSourceWorker-M29BTqDC.js","assets/geojson-D7R2dVNG.js","assets/sourceUtils-Bkt2Rrd7.js","assets/MemorySourceWorker-CjZmFiXG.js","assets/objectIdUtils-4dd1rf9p.js","assets/PBFDecoderWorker-VhKqPoLQ.js","assets/FeaturePipelineWorker-CETIikGX.js","assets/AttributeStore-B7dEZ_45.js","assets/Utils-TBp02Upz.js","assets/BoundingBox-hvRvsOsN.js","assets/UpdateTracking2D-BGJ5gcc8.js","assets/CIMSymbolHelper-DLCfSN7J.js","assets/BidiEngine-QXap_35O.js","assets/rasterizingUtils-DzQCuzrR.js","assets/Rect-CUzevAry.js","assets/streamLayerUtils-CKwt2uXH.js","assets/MeshWriterRegistry-CrkTIYtU.js","assets/TechniqueType-uMFRS8dR.js","assets/PieChartMeshWriter-CU7sa4eu.js","assets/TurboLine-BVb5-kLX.js","assets/utils-EkuQTUPc.js","assets/grouping-jiGBZTNM.js","assets/QueueProcessor-w0BYbTZ1.js","assets/operatorGeodeticDensify-BVUKrUaz.js","assets/SimpleGeometryCursor-B92kdZ15.js","assets/geodeticCurveType-CirnHLSB.js","assets/normalizeUtilsSync-h4KLBvMC.js","assets/ogcFeatureUtils-z26mAO6y.js","assets/parquet-DjVsKd2P.js","assets/StreamFeatureManager-xoIFqgMD.js","assets/CircularArray-CujHzHWW.js","assets/createConnection-DWqaQvPw.js","assets/PointCloudWorker-SuqIoR2C.js","assets/PointCloudWorkerUtil-Vntf9SMa.js","assets/PointCloudUniqueValueRenderer-uh4TfjqL.js","assets/I3SBinaryReader-BfM-k3MQ.js","assets/RasterWorker-DfNo7hdb.js","assets/dataUtils-IeoIocfl.js","assets/pixelRangeUtils-Bk2sXCMF.js","assets/RasterSymbolizer-BXxgNyqN.js","assets/rasterFunctionHelper-DIlnWcTC.js","assets/rasterProjectionHelper-BOOOTgKx.js","assets/PolynomialTransform-CcTKOQmx.js","assets/SceneLayerSnappingSourceWorker-CFVaKRva.js","assets/SceneLayerWorker-BuHrcuhg.js","assets/I3SNode-ChRMRIyE.js","assets/I3SUtil-BpDzkC4H.js","assets/WFSSourceWorker-B1JtaKVu.js","assets/wfsUtils-DpYs-o2U.js","assets/xmlUtils-CtUoQO7q.js","assets/WorkerTileHandler-7CDi2FEQ.js","assets/SourceLayerData-BkDPFnTc.js","assets/StyleRepository-CWRH-5Eq.js","assets/Lyr3DWorker-3pG6dYDJ.js","assets/ILyr3DWasmPerSceneView-QwgNPJGT.js","assets/Lyr3DModule-C80vi3bH.js","assets/Feature3DPipelineWorker-D6eg8-zv.js","assets/FeaturePipelineRenderManager-MJWb-RlQ.js","assets/LodRenderer-BDw_Deqz.js","assets/Popup-BopDNomN.js","assets/AttachmentInfo-B36PqY1i.js","assets/featureUtils-BoL5pG_W.js","assets/utils-L9BGy6Hj.js","assets/cimSymbolUtils-Bu2r_l8n.js","assets/symbolUtils-DzBXc-Wp.js","assets/webStyleSymbolUtils-C0OVnxdp.js","assets/devEnvironmentUtils-CnNDiFMM.js","assets/executeQueryJSON-BaJh2giZ.js","assets/shared-BXyiOCyb.js","assets/ReactiveSet-CYtgD1tN.js","assets/vmEvent-D4Ubqkbq.js","assets/ElevationLayer-CkRfvdHZ.js","assets/ArcGISCachedService-DoFwBM7e.js","assets/TileInfoTilemapCache-DGNaGBjm.js","assets/TilemapCache-Bt1ZScRU.js","assets/LercDecoder-MmRX2Uin.js","assets/layersCreator-B9RBAQ3N.js","assets/loadUtils-C6WFbRfY.js","assets/fetchService-BOSfEGso.js","assets/associatedFeatureServiceUtils-_jAgb6wQ.js","assets/lazyLayerLoader-BelxknTZ.js","assets/portalLayers-DfUM3GYG.js","assets/arcgisLayers-D9LI0BdT.js","assets/arcadeUtils-Blultffq.js","assets/arcade-D_ze7yWt.js","assets/unitConversion-C65YkDgA.js","assets/ImmutableArray-BPVd6ESQ.js","assets/hash-CcEbRgUF.js","assets/webglDeps-CZX2TNWu.js","assets/ShaderCompiler-G2XYGDs6.js","assets/programUtils-CwiKxPbA.js","assets/ProgramTemplate-CbnhisJb.js","assets/mapViewDeps-BAxHx3N0.js","assets/FeatureCommandQueue-DEjbHgMN.js","assets/GraphShaderModule-rlKkNXTl.js","assets/heatmapTextureUtils-BwsdgbXL.js","assets/WGLContainer-DAL2R1TP.js","assets/WGLBrushVTLSymbol-D4Azmvhv.js","assets/Container-Cz9A_ioc.js","assets/EffectView-Jcs4MyZ6.js","assets/SDFHelper-E7zsDrTg.js","assets/OverrideHelper-2qszNNyl.js","assets/callExpressionWithFeature-B3Mz5oa9.js","assets/VTLMaterialManager-BVR0NtoH.js","assets/GridShader-BTckz07s.js","assets/MaterialPrograms-D1-xn8Ay.js","assets/CIMResourceManager-YgYQSCEm.js","assets/utils-BzKxuCzx.js","assets/VertexStream-Dz5KKk-8.js","assets/utils-ehcGqGxa.js","assets/GraphicsView2D-D4npPHfS.js","assets/GraphicContainer-Z_l2v49C.js","assets/AGraphicContainer-CVpmy9ro.js","assets/TechniqueInstance-suOgeU_P.js","assets/TileContainer-aWWjUWr5.js","assets/gridUtils-Beoh8Lyq.js","assets/geodesicUtils-AyGMpq1K.js","assets/TileLayerView2D-BvV1D3vv.js","assets/imageUtils-BtPvEFAN.js","assets/BitmapTechnique-DOPe8KAY.js","assets/LayerView2D-C4Cdeea2.js","assets/HighlightGraphicContainer-DYBGO2A6.js","assets/LayerView-Ck8FMSD2.js","assets/RefreshableLayerView-Bu3cytnU.js","assets/MapServiceLayerViewHelper-DgULpklP.js","assets/floorFilterUtils-DZ5C6FQv.js","assets/drapedUtils-DkjinvLd.js","assets/sublayerUtils--mHU41N0.js","assets/popupUtils-DB8vJbLy.js","assets/FeatureLayerView2D-D1H9skqr.js","assets/timeSupport-BAwZ8uOa.js","assets/AttributeBinsFeatureSet-BnlZxvtu.js","assets/AttributeBinsQuery-ROoo0rpH.js","assets/featureReductionUtils-Caulfaw_.js","assets/constants-B4mRqufT.js","assets/FeatureLayerView-D6XNYoj9.js","assets/BaseDynamicLayerView2D-CWX6hbDc.js","assets/BitmapContainer-DldF9ekB.js","assets/ExportStrategy-CzGpn-Hk.js","assets/CatalogLayerView2D-D8Y_aRyf.js","assets/CatalogLayerView-DaZ8lzgg.js","assets/CatalogDynamicGroupLayerView2D-CCXE3V5z.js","assets/CatalogDynamicGroupLayerView-Bb6eIfdM.js","assets/CatalogFootprintLayerView2D-9-K7KaJ6.js","assets/CatalogFootprintLayerView-tdRMXWTn.js","assets/GeoRSSLayerView2D-BrLHlYmT.js","assets/GraphicsLayerView2D-CK5cdsKc.js","assets/GroupLayerView2D-DL1Sx1hV.js","assets/GroupLayerView-Cu_f829f.js","assets/ImageryLayerView2D-Dx6JZv3n.js","assets/RasterVFDisplayObject-Bxgt41QC.js","assets/ImageryLayerView-BrEyZHvl.js","assets/ImageryTileLayerView2D-DJ6Vaif2.js","assets/multidimensionalUtils-CSlCUm04.js","assets/rasterUtils-EeXXbNj7.js","assets/RawBlockCache-D-OELXEs.js","assets/ImageryTileLayerView-CeTTz2Wg.js","assets/rasterFieldUtils-CEK67CIr.js","assets/KMLLayerView2D-D0SvS-Id.js","assets/kmlUtils-BEXwNTk8.js","assets/KnowledgeGraphLayerView2D-DLesJ6n1.js","assets/MapImageLayerView2D-BH-M95kr.js","assets/MapImageLayerView-CVpZmu-2.js","assets/ExportImageParameters-BX_m3R7l.js","assets/MapNotesLayerView2D-DUkJnbby.js","assets/MediaLayerView2D-Cl_1Fnot.js","assets/perspectiveUtils-l0DuCrMa.js","assets/mediaLayerUtils-BJ-DU5EY.js","assets/OverlayContainer-0XybEzL_.js","assets/MediaLayerView-gY6VXa6u.js","assets/OGCFeatureLayerView2D-Xpr8p7W-.js","assets/OGCFeatureLayerView-CN61KZvi.js","assets/RouteLayerView2D--X2QMVGw.js","assets/Stop-CO8WeqfX.js","assets/networkEnums-CgZo0FKn.js","assets/StreamLayerView2D-C72_vomw.js","assets/StreamLayerView-DtVDOfz-.js","assets/SubtypeGroupLayerView2D-B15tfu_h.js","assets/VectorTileLayerView2D-DlWvqME0.js","assets/TileInfoViewPOT-B-eG6r9q.js","assets/VideoLayerView2D-CPMoepEx.js","assets/GraphicsLayer-C8-bjLvb.js","assets/TelemetryDisplay-uEI_Isv2.js","assets/WMSLayerView2D-NiJDgoXj.js","assets/WMSLayerView-L_7ks_Aa.js","assets/ExportWMSImageParameters-5P5ztQJz.js","assets/WMTSLayerView2D-5feqDQ9I.js","assets/apng-DWgzepxw.js","assets/Lyr3DWasmPerSceneView-D4VezNWS.js","assets/TileLayerView3D-BrZG5rhS.js","assets/LayerView3D-D9EaTEMQ.js","assets/TiledLayerView3D-D3ReP93C.js","assets/fetchTile-B5SNKsmL.js","assets/ElevationLayerView3D-DOWW9NyC.js","assets/BaseDynamicLayerView3D-Bt3c_Y4F.js","assets/DynamicLayerView3D-DtduJJLA.js","assets/projectExtentUtils-BOQDrrn9.js","assets/geometryServiceUtils-D_K144mp.js","assets/ImageMaterial.glsl-CTuPf0ue.js","assets/DefaultLayouts-DCPHPEww.js","assets/TriangleMaterial-hfPtYTfz.js","assets/BuildingSceneLayerView3D-DDwl-WtT.js","assets/BuildingGroupSublayer-B7LHDrx7.js","assets/BuildingComponentSublayer-DZaUKS5P.js","assets/capabilities-B4c8vV3b.js","assets/I3SIndexInfo-WEHAOggQ.js","assets/I3SLayerDefinitions-OpChnALq.js","assets/I3SMeshView3D-BYL74V9o.js","assets/Transform-ph1b25Pb.js","assets/RenderTexture-7xa3U1ql.js","assets/I3SOverrides-biGLATyZ.js","assets/resourceUtils-B2WDZGL5.js","assets/SceneModification-BTVBweC9.js","assets/persistable-m7kW6qgj.js","assets/resourceExtension-bESjAEBg.js","assets/ExtentSet-pIH4MlfY.js","assets/rendererConversion-BFQl1ElB.js","assets/attributeUtils-Dc8--CBJ.js","assets/highlightUtils-LdbT_5Gd.js","assets/I3SQueryFeatureStore-DT7-P6c1.js","assets/TemporalSceneLayerView-UIOrdWMw.js","assets/CatalogLayerView3D-XNmvkiTX.js","assets/CatalogDynamicGroupLayerView3D-CMyFIA_4.js","assets/CatalogFootprintLayerView3D--gtl8Vrp.js","assets/FeatureLayerViewBase3D-Bcb3lxbQ.js","assets/HeatmapDensity.glsl-CYoEEW01.js","assets/dehydratedFeatureComparison-Cqp8Y6mL.js","assets/queryForSymbologySnapping-BkLDyReP.js","assets/Graphics3DFeatureProcessor-DtUsAnc3.js","assets/Graphics3DObjectStates-H05F6leY.js","assets/EventedSet-Dc4X39dS.js","assets/CSVLayerView3D-DvzVQII9.js","assets/DimensionLayerView3D-fNpB89rX.js","assets/FeatureLayerView3D-BoJiEogw.js","assets/GeoJSONLayerView3D-DQ56hrRo.js","assets/GraphicsLayerView3D-CDDjdQB5.js","assets/GraphicsProcessor-BxMyfHFl.js","assets/GroupLayerView3D-C_O_6Tns.js","assets/ImageryLayerView3D-CglwvmGm.js","assets/IntegratedMeshLayerView3D-SG95AUpZ.js","assets/IntegratedMesh3DTilesLayerView3D-D1CZHOyM.js","assets/LineOfSightLayerView3D-Byzw6EVo.js","assets/MapImageLayerView3D-BdyN6kHz.js","assets/MediaLayerView3D-Dtc8poec.js","assets/EditGeometryOperations-wQHypEHr.js","assets/geometry2dUtils-BECZf0GS.js","assets/keybindings-CtvTi62R.js","assets/SnappingManagerPool-BLObhJmV.js","assets/SnappingManager-uFSx-TIH.js","assets/viewUtils-D24sG8PY.js","assets/OGCFeatureLayerView3D-DXEUagNn.js","assets/PointCloudLayerView3D-DMSfo8Lb.js","assets/PopupSceneLayerView-BBQNRp8E.js","assets/ViewshedLayerView3D-z4eoS6BX.js","assets/VoxelLayerView3D-CKc4L2Jk.js","assets/VoxelGraphic-Dmp9dcMt.js","assets/RouteLayerView3D-Drdreyuc.js","assets/SceneLayerView3D-uebdPNIb.js","assets/SceneLayerView-BvzRdIKq.js","assets/SceneLayerGraphicsView3D-DmPsZspl.js","assets/StreamLayerView3D-DUQ_zwVD.js","assets/ImageryTileLayerView3D-Bw5RCCEN.js","assets/VectorTileLayerView3D-CnTm2Jvr.js","assets/WFSLayerView3D-NQiWoAB9.js","assets/WMSLayerView3D-C49q-ADm.js","assets/WMTSLayerView3D-D9tsQlFM.js","assets/AreaMeasurementAnalysisView3D-CBt4fWeI.js","assets/defaultUnit-mAXf9frj.js","assets/quantityFormatUtils-D4QC4M5H.js","assets/AnalysisView3D-Cy3km0qh.js","assets/interfaces-js1RL7O8.js","assets/euclideanAreaMeasurementUtils-Bq7qOqGe.js","assets/geometryEngine-DZQmjC3o.js","assets/hydrated-8eZrnzf3.js","assets/geodesicLengthMeasurementUtils-BMbcKd8T.js","assets/LineVisualElement-BWm41HKU.js","assets/line-fv3IcO5w.js","assets/Segment-DC_O0GO-.js","assets/TextOverlayItem-qJgBhmzl.js","assets/lineStippleUtils-C89mzWlO.js","assets/DimensionAnalysisView3D-CZSsMRdc.js","assets/LengthDimension-BauOAQ4D.js","assets/automaticLengthMeasurementUtils-Bwa3LUxz.js","assets/ShadedColorMaterial.glsl-r6VhJShH.js","assets/ColorMaterial.glsl-CJmBIFgr.js","assets/dragEventPipeline3D-DEevdCQY.js","assets/InteractiveToolBase-XZur83Y0.js","assets/memoize-DmxaQ-k8.js","assets/Factory-KRWEugbI.js","assets/VerticesVisualElement-BXsfgcDz.js","assets/ExtendedLineVisualElement-CBfpCsiY.js","assets/EngineVisualElement-Djb2vZdf.js","assets/LaserlinePath.glsl-TLzB8BAx.js","assets/RightAngleQuadVisualElement-COFJ4VQS.js","assets/SnappingVisualizer-yY-u8LGd.js","assets/PointSnappingHint-DFT7U_tQ.js","assets/SnappingOperation-DKQngwsY.js","assets/analysisViewUtils-35ETXRBu.js","assets/ToolIntersector-3shg3FyE.js","assets/LineMarker.glsl-CC5HJT2y.js","assets/DirectLineMeasurementAnalysisView3D-C3pmZKBF.js","assets/LineOfSightAnalysisView3D-8MtD7_PH.js","assets/featureReferenceUtils-DXgECfOo.js","assets/LineOfSightAnalysisTarget-B6SoVqVP.js","assets/manipulatorUtils-BqSExnaA.js","assets/SliceAnalysisView3D-Cj-bs9Ve.js","assets/SlicePlaneMaterial.glsl-BbzkiuB_.js","assets/sliceToolConfig-DVyCZsWF.js","assets/ViewshedAnalysisView3D-5HOauCyt.js","assets/Viewshed-KJjLXepe.js","assets/MoveManipulation-BPIm28RV.js","assets/VoxelWasmPerSceneView-C6FT9kp3.js","assets/Graphics3DSymbolLayerFactory-DIEgSJdn.js","assets/interfaces-BMKdHaUK.js","assets/MeshComponent-BPd0UQXJ.js","assets/meshProperties-C4iW0Ukm.js","assets/projectMeshVertexPositions-DhhE86nJ.js","assets/objectResourceUtils-DZ3ez92N.js","assets/indexUtils-U4gn_RPI.js","assets/loader-BRah9kOb.js","assets/TerrainTileTree3DDebugger-BfKaBqz9.js","assets/TileTreeDebugger-CxLmD3Qu.js","assets/EdgeView-Cgvof-Dj.js","assets/EdgeWorkerHandle-DIabWgL0.js","assets/FeatureTileTree3DDebugger-CqkcqBjq.js","assets/GraphicsView3D-D3uzlhQc.js","assets/layersLoader-yEVkGalG.js","assets/featureLayerUtils-BxGe0ukP.js","assets/utils-BHpvWYdX.js","assets/FeatureLayerSource-C46JMZMA.js","assets/External-DabKm9HO.js","assets/MeshTransform-CpEmJDpm.js","assets/editingSupport-BaZ1VgkJ.js","assets/QueryTask-BtI5HYT8.js","assets/executeForIds-DR-wQYDq.js","assets/queryAssociations-ItqmlWn8.js","assets/Association-BmxoHohS.js","assets/synthesizeAssociationGeometries-B7StnAHS.js","assets/index-ChDV4aA9.js","assets/usePreventDocumentScroll-CIiHealB.js","assets/math-Ctbd4j0u.js","assets/Sketch-D77YaHSD.js","assets/SketchOptions-_RdOU_mt.js","assets/angularMeasurementUtils-qlhFG6W2.js","assets/SketchViewModel-B2klnA_y.js","assets/directionModeIcons-H3VlGLqc.js","assets/MapImageLayer-HAWhrLnx.js","assets/SublayersOwner-Cgr9VTrG.js","assets/imageBitmapUtils-Bb-OpO8M.js","assets/ImageryLayer-CY0MZByG.js","assets/ImageHistogramParameters-szliXBa6.js","assets/RasterPresetRendererMixin-BQp9dAG8.js","assets/SceneLayer-D-fzgAEL.js","assets/meshSpatialReferenceScaleUtils-hzoSQEXv.js","assets/SceneService-Dkw4B1GR.js","assets/VectorTileLayer-B-ju8PYR.js","assets/TileLayer-DWDoyRiG.js"])))=>i.map(i=>d[i]);
var yVe=Object.getPrototypeOf;var vVe=Reflect.get;var sce=t=>{throw TypeError(t)};var TH=(t,e,i)=>e.has(t)||sce("Cannot "+i);var Ne=(t,e,i)=>(TH(t,e,"read from private field"),i?i.call(t):e.get(t)),Br=(t,e,i)=>e.has(t)?sce("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,i),vr=(t,e,i,r)=>(TH(t,e,"write to private field"),r?r.call(t,i):e.set(t,i),i),r0=(t,e,i)=>(TH(t,e,"access private method"),i);var nce=(t,e,i)=>vVe(yVe(t),i,e);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}})();/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const h4=globalThis,Gte=h4.ShadowRoot&&(h4.ShadyCSS===void 0||h4.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Hte=Symbol(),oce=new WeakMap;let Hxe=class{constructor(e,i,r){if(this._$cssResult$=!0,r!==Hte)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=i}get styleSheet(){let e=this.o;const i=this.t;if(Gte&&e===void 0){const r=i!==void 0&&i.length===1;r&&(e=oce.get(i)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),r&&oce.set(i,e))}return e}toString(){return this.cssText}};const _Ve=t=>new Hxe(typeof t=="string"?t:t+"",void 0,Hte),Ks=(t,...e)=>{const i=t.length===1?t[0]:e.reduce((r,s,n)=>r+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(s)+t[n+1],t[0]);return new Hxe(i,t,Hte)},bVe=(t,e)=>{if(Gte)t.adoptedStyleSheets=e.map(i=>i instanceof CSSStyleSheet?i:i.styleSheet);else for(const i of e){const r=document.createElement("style"),s=h4.litNonce;s!==void 0&&r.setAttribute("nonce",s),r.textContent=i.cssText,t.appendChild(r)}},ace=Gte?t=>t:t=>t instanceof CSSStyleSheet?(e=>{let i="";for(const r of e.cssRules)i+=r.cssText;return _Ve(i)})(t):t;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:wVe,defineProperty:xVe,getOwnPropertyDescriptor:SVe,getOwnPropertyNames:TVe,getOwnPropertySymbols:EVe,getPrototypeOf:CVe}=Object,_b=globalThis,lce=_b.trustedTypes,$Ve=lce?lce.emptyScript:"",EH=_b.reactiveElementPolyfillSupport,jR=(t,e)=>t,sU={toAttribute(t,e){switch(e){case Boolean:t=t?$Ve:null;break;case Object:case Array:t=t==null?t:JSON.stringify(t)}return t},fromAttribute(t,e){let i=t;switch(e){case Boolean:i=t!==null;break;case Number:i=t===null?null:Number(t);break;case Object:case Array:try{i=JSON.parse(t)}catch{i=null}}return i}},Aj=(t,e)=>!wVe(t,e),cce={attribute:!0,type:String,converter:sU,reflect:!1,useDefault:!1,hasChanged:Aj};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),_b.litPropertyMetadata??(_b.litPropertyMetadata=new WeakMap);let RE=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??(this.l=[])).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,i=cce){if(i.state&&(i.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((i=Object.create(i)).wrapped=!0),this.elementProperties.set(e,i),!i.noAccessor){const r=Symbol(),s=this.getPropertyDescriptor(e,r,i);s!==void 0&&xVe(this.prototype,e,s)}}static getPropertyDescriptor(e,i,r){const{get:s,set:n}=SVe(this.prototype,e)??{get(){return this[i]},set(o){this[i]=o}};return{get:s,set(o){const a=s==null?void 0:s.call(this);n==null||n.call(this,o),this.requestUpdate(e,a,r)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??cce}static _$Ei(){if(this.hasOwnProperty(jR("elementProperties")))return;const e=CVe(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(jR("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(jR("properties"))){const i=this.properties,r=[...TVe(i),...EVe(i)];for(const s of r)this.createProperty(s,i[s])}const e=this[Symbol.metadata];if(e!==null){const i=litPropertyMetadata.get(e);if(i!==void 0)for(const[r,s]of i)this.elementProperties.set(r,s)}this._$Eh=new Map;for(const[i,r]of this.elementProperties){const s=this._$Eu(i,r);s!==void 0&&this._$Eh.set(s,i)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const i=[];if(Array.isArray(e)){const r=new Set(e.flat(1/0).reverse());for(const s of r)i.unshift(ace(s))}else e!==void 0&&i.push(ace(e));return i}static _$Eu(e,i){const r=i.attribute;return r===!1?void 0:typeof r=="string"?r:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var e;this._$ES=new Promise(i=>this.enableUpdating=i),this._$AL=new Map,this._$E_(),this.requestUpdate(),(e=this.constructor.l)==null||e.forEach(i=>i(this))}addController(e){var i;(this._$EO??(this._$EO=new Set)).add(e),this.renderRoot!==void 0&&this.isConnected&&((i=e.hostConnected)==null||i.call(e))}removeController(e){var i;(i=this._$EO)==null||i.delete(e)}_$E_(){const e=new Map,i=this.constructor.elementProperties;for(const r of i.keys())this.hasOwnProperty(r)&&(e.set(r,this[r]),delete this[r]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return bVe(e,this.constructor.elementStyles),e}connectedCallback(){var e;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(e=this._$EO)==null||e.forEach(i=>{var r;return(r=i.hostConnected)==null?void 0:r.call(i)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$EO)==null||e.forEach(i=>{var r;return(r=i.hostDisconnected)==null?void 0:r.call(i)})}attributeChangedCallback(e,i,r){this._$AK(e,r)}_$ET(e,i){var n;const r=this.constructor.elementProperties.get(e),s=this.constructor._$Eu(e,r);if(s!==void 0&&r.reflect===!0){const o=(((n=r.converter)==null?void 0:n.toAttribute)!==void 0?r.converter:sU).toAttribute(i,r.type);this._$Em=e,o==null?this.removeAttribute(s):this.setAttribute(s,o),this._$Em=null}}_$AK(e,i){var n,o;const r=this.constructor,s=r._$Eh.get(e);if(s!==void 0&&this._$Em!==s){const a=r.getPropertyOptions(s),l=typeof a.converter=="function"?{fromAttribute:a.converter}:((n=a.converter)==null?void 0:n.fromAttribute)!==void 0?a.converter:sU;this._$Em=s,this[s]=l.fromAttribute(i,a.type)??((o=this._$Ej)==null?void 0:o.get(s))??null,this._$Em=null}}requestUpdate(e,i,r){var s;if(e!==void 0){const n=this.constructor,o=this[e];if(r??(r=n.getPropertyOptions(e)),!((r.hasChanged??Aj)(o,i)||r.useDefault&&r.reflect&&o===((s=this._$Ej)==null?void 0:s.get(e))&&!this.hasAttribute(n._$Eu(e,r))))return;this.C(e,i,r)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(e,i,{useDefault:r,reflect:s,wrapped:n},o){r&&!(this._$Ej??(this._$Ej=new Map)).has(e)&&(this._$Ej.set(e,o??i??this[e]),n!==!0||o!==void 0)||(this._$AL.has(e)||(this.hasUpdated||r||(i=void 0),this._$AL.set(e,i)),s===!0&&this._$Em!==e&&(this._$Eq??(this._$Eq=new Set)).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(i){Promise.reject(i)}const e=this.scheduleUpdate();return e!=null&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var r;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[n,o]of this._$Ep)this[n]=o;this._$Ep=void 0}const s=this.constructor.elementProperties;if(s.size>0)for(const[n,o]of s){const{wrapped:a}=o,l=this[n];a!==!0||this._$AL.has(n)||l===void 0||this.C(n,void 0,o,l)}}let e=!1;const i=this._$AL;try{e=this.shouldUpdate(i),e?(this.willUpdate(i),(r=this._$EO)==null||r.forEach(s=>{var n;return(n=s.hostUpdate)==null?void 0:n.call(s)}),this.update(i)):this._$EM()}catch(s){throw e=!1,this._$EM(),s}e&&this._$AE(i)}willUpdate(e){}_$AE(e){var i;(i=this._$EO)==null||i.forEach(r=>{var s;return(s=r.hostUpdated)==null?void 0:s.call(r)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&(this._$Eq=this._$Eq.forEach(i=>this._$ET(i,this[i]))),this._$EM()}updated(e){}firstUpdated(e){}};RE.elementStyles=[],RE.shadowRootOptions={mode:"open"},RE[jR("elementProperties")]=new Map,RE[jR("finalized")]=new Map,EH==null||EH({ReactiveElement:RE}),(_b.reactiveElementVersions??(_b.reactiveElementVersions=[])).push("2.1.0");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const GR=globalThis,nU=GR.trustedTypes,uce=nU?nU.createPolicy("lit-html",{createHTML:t=>t}):void 0,qxe="$lit$",z_=`lit$${Math.random().toFixed(9).slice(2)}$`,Wxe="?"+z_,AVe=`<${Wxe}>`,hS=document,QP=()=>hS.createComment(""),e3=t=>t===null||typeof t!="object"&&typeof t!="function",qte=Array.isArray,MVe=t=>qte(t)||typeof(t==null?void 0:t[Symbol.iterator])=="function",CH=`[ 	
\f\r]`,AM=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,hce=/-->/g,dce=/>/g,ww=RegExp(`>|${CH}(?:([^\\s"'>=/]+)(${CH}*=${CH}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),pce=/'/g,fce=/"/g,Zxe=/^(?:script|style|textarea|title)$/i,Yxe=t=>(e,...i)=>({_$litType$:t,strings:e,values:i}),ce=Yxe(1),t3=Yxe(2),vd=Symbol.for("lit-noChange"),Ke=Symbol.for("lit-nothing"),mce=new WeakMap,Ex=hS.createTreeWalker(hS,129);function Jxe(t,e){if(!qte(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return uce!==void 0?uce.createHTML(e):e}const OVe=(t,e)=>{const i=t.length-1,r=[];let s,n=e===2?"<svg>":e===3?"<math>":"",o=AM;for(let a=0;a<i;a++){const l=t[a];let c,h,d=-1,f=0;for(;f<l.length&&(o.lastIndex=f,h=o.exec(l),h!==null);)f=o.lastIndex,o===AM?h[1]==="!--"?o=hce:h[1]!==void 0?o=dce:h[2]!==void 0?(Zxe.test(h[2])&&(s=RegExp("</"+h[2],"g")),o=ww):h[3]!==void 0&&(o=ww):o===ww?h[0]===">"?(o=s??AM,d=-1):h[1]===void 0?d=-2:(d=o.lastIndex-h[2].length,c=h[1],o=h[3]===void 0?ww:h[3]==='"'?fce:pce):o===fce||o===pce?o=ww:o===hce||o===dce?o=AM:(o=ww,s=void 0);const m=o===ww&&t[a+1].startsWith("/>")?" ":"";n+=o===AM?l+AVe:d>=0?(r.push(c),l.slice(0,d)+qxe+l.slice(d)+z_+m):l+z_+(d===-2?a:m)}return[Jxe(t,n+(t[i]||"<?>")+(e===2?"</svg>":e===3?"</math>":"")),r]};let yW=class Xxe{constructor({strings:e,_$litType$:i},r){let s;this.parts=[];let n=0,o=0;const a=e.length-1,l=this.parts,[c,h]=OVe(e,i);if(this.el=Xxe.createElement(c,r),Ex.currentNode=this.el.content,i===2||i===3){const d=this.el.content.firstChild;d.replaceWith(...d.childNodes)}for(;(s=Ex.nextNode())!==null&&l.length<a;){if(s.nodeType===1){if(s.hasAttributes())for(const d of s.getAttributeNames())if(d.endsWith(qxe)){const f=h[o++],m=s.getAttribute(d).split(z_),g=/([.?@])?(.*)/.exec(f);l.push({type:1,index:n,name:g[2],strings:m,ctor:g[1]==="."?RVe:g[1]==="?"?PVe:g[1]==="@"?DVe:Oj}),s.removeAttribute(d)}else d.startsWith(z_)&&(l.push({type:6,index:n}),s.removeAttribute(d));if(Zxe.test(s.tagName)){const d=s.textContent.split(z_),f=d.length-1;if(f>0){s.textContent=nU?nU.emptyScript:"";for(let m=0;m<f;m++)s.append(d[m],QP()),Ex.nextNode(),l.push({type:2,index:++n});s.append(d[f],QP())}}}else if(s.nodeType===8)if(s.data===Wxe)l.push({type:2,index:n});else{let d=-1;for(;(d=s.data.indexOf(z_,d+1))!==-1;)l.push({type:7,index:n}),d+=z_.length-1}n++}}static createElement(e,i){const r=hS.createElement("template");return r.innerHTML=e,r}};function O$(t,e,i=t,r){var o,a;if(e===vd)return e;let s=r!==void 0?(o=i._$Co)==null?void 0:o[r]:i._$Cl;const n=e3(e)?void 0:e._$litDirective$;return(s==null?void 0:s.constructor)!==n&&((a=s==null?void 0:s._$AO)==null||a.call(s,!1),n===void 0?s=void 0:(s=new n(t),s._$AT(t,i,r)),r!==void 0?(i._$Co??(i._$Co=[]))[r]=s:i._$Cl=s),s!==void 0&&(e=O$(t,s._$AS(t,e.values),s,r)),e}let IVe=class{constructor(e,i){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=i}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:i},parts:r}=this._$AD,s=((e==null?void 0:e.creationScope)??hS).importNode(i,!0);Ex.currentNode=s;let n=Ex.nextNode(),o=0,a=0,l=r[0];for(;l!==void 0;){if(o===l.index){let c;l.type===2?c=new Mj(n,n.nextSibling,this,e):l.type===1?c=new l.ctor(n,l.name,l.strings,this,e):l.type===6&&(c=new LVe(n,this,e)),this._$AV.push(c),l=r[++a]}o!==(l==null?void 0:l.index)&&(n=Ex.nextNode(),o++)}return Ex.currentNode=hS,s}p(e){let i=0;for(const r of this._$AV)r!==void 0&&(r.strings!==void 0?(r._$AI(e,r,i),i+=r.strings.length-2):r._$AI(e[i])),i++}},Mj=class Kxe{get _$AU(){var e;return((e=this._$AM)==null?void 0:e._$AU)??this._$Cv}constructor(e,i,r,s){this.type=2,this._$AH=Ke,this._$AN=void 0,this._$AA=e,this._$AB=i,this._$AM=r,this.options=s,this._$Cv=(s==null?void 0:s.isConnected)??!0}get parentNode(){let e=this._$AA.parentNode;const i=this._$AM;return i!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=i.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,i=this){e=O$(this,e,i),e3(e)?e===Ke||e==null||e===""?(this._$AH!==Ke&&this._$AR(),this._$AH=Ke):e!==this._$AH&&e!==vd&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):MVe(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==Ke&&e3(this._$AH)?this._$AA.nextSibling.data=e:this.T(hS.createTextNode(e)),this._$AH=e}$(e){var n;const{values:i,_$litType$:r}=e,s=typeof r=="number"?this._$AC(e):(r.el===void 0&&(r.el=yW.createElement(Jxe(r.h,r.h[0]),this.options)),r);if(((n=this._$AH)==null?void 0:n._$AD)===s)this._$AH.p(i);else{const o=new IVe(s,this),a=o.u(this.options);o.p(i),this.T(a),this._$AH=o}}_$AC(e){let i=mce.get(e.strings);return i===void 0&&mce.set(e.strings,i=new yW(e)),i}k(e){qte(this._$AH)||(this._$AH=[],this._$AR());const i=this._$AH;let r,s=0;for(const n of e)s===i.length?i.push(r=new Kxe(this.O(QP()),this.O(QP()),this,this.options)):r=i[s],r._$AI(n),s++;s<i.length&&(this._$AR(r&&r._$AB.nextSibling,s),i.length=s)}_$AR(e=this._$AA.nextSibling,i){var r;for((r=this._$AP)==null?void 0:r.call(this,!1,!0,i);e&&e!==this._$AB;){const s=e.nextSibling;e.remove(),e=s}}setConnected(e){var i;this._$AM===void 0&&(this._$Cv=e,(i=this._$AP)==null||i.call(this,e))}},Oj=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,i,r,s,n){this.type=1,this._$AH=Ke,this._$AN=void 0,this.element=e,this.name=i,this._$AM=s,this.options=n,r.length>2||r[0]!==""||r[1]!==""?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=Ke}_$AI(e,i=this,r,s){const n=this.strings;let o=!1;if(n===void 0)e=O$(this,e,i,0),o=!e3(e)||e!==this._$AH&&e!==vd,o&&(this._$AH=e);else{const a=e;let l,c;for(e=n[0],l=0;l<n.length-1;l++)c=O$(this,a[r+l],i,l),c===vd&&(c=this._$AH[l]),o||(o=!e3(c)||c!==this._$AH[l]),c===Ke?e=Ke:e!==Ke&&(e+=(c??"")+n[l+1]),this._$AH[l]=c}o&&!s&&this.j(e)}j(e){e===Ke?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}},RVe=class extends Oj{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Ke?void 0:e}},PVe=class extends Oj{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==Ke)}},DVe=class extends Oj{constructor(e,i,r,s,n){super(e,i,r,s,n),this.type=5}_$AI(e,i=this){if((e=O$(this,e,i,0)??Ke)===vd)return;const r=this._$AH,s=e===Ke&&r!==Ke||e.capture!==r.capture||e.once!==r.once||e.passive!==r.passive,n=e!==Ke&&(r===Ke||s);s&&this.element.removeEventListener(this.name,this,r),n&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var i;typeof this._$AH=="function"?this._$AH.call(((i=this.options)==null?void 0:i.host)??this.element,e):this._$AH.handleEvent(e)}},LVe=class{constructor(e,i,r){this.element=e,this.type=6,this._$AN=void 0,this._$AM=i,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(e){O$(this,e)}};const NVe={I:Mj},$H=GR.litHtmlPolyfillSupport;$H==null||$H(yW,Mj),(GR.litHtmlVersions??(GR.litHtmlVersions=[])).push("3.3.0");const FVe=(t,e,i)=>{const r=(i==null?void 0:i.renderBefore)??e;let s=r._$litPart$;if(s===void 0){const n=(i==null?void 0:i.renderBefore)??null;r._$litPart$=s=new Mj(e.insertBefore(QP(),n),n,void 0,i??{})}return s._$AI(t),s};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const jx=globalThis;let sf=class extends RE{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var i;const e=super.createRenderRoot();return(i=this.renderOptions).renderBefore??(i.renderBefore=e.firstChild),e}update(e){const i=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=FVe(i,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),(e=this._$Do)==null||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._$Do)==null||e.setConnected(!1)}render(){return vd}};var Lxe;sf._$litElement$=!0,sf.finalized=!0,(Lxe=jx.litElementHydrateSupport)==null||Lxe.call(jx,{LitElement:sf});const AH=jx.litElementPolyfillSupport;AH==null||AH({LitElement:sf});(jx.litElementVersions??(jx.litElementVersions=[])).push("4.2.0");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ij=t=>(e,i)=>{i!==void 0?i.addInitializer(()=>{customElements.define(t,e)}):customElements.define(t,e)};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const kVe={attribute:!0,type:String,converter:sU,reflect:!1,hasChanged:Aj},zVe=(t=kVe,e,i)=>{const{kind:r,metadata:s}=i;let n=globalThis.litPropertyMetadata.get(s);if(n===void 0&&globalThis.litPropertyMetadata.set(s,n=new Map),r==="setter"&&((t=Object.create(t)).wrapped=!0),n.set(i.name,t),r==="accessor"){const{name:o}=i;return{set(a){const l=e.get.call(this);e.set.call(this,a),this.requestUpdate(o,l,t)},init(a){return a!==void 0&&this.C(o,void 0,t,a),a}}}if(r==="setter"){const{name:o}=i;return function(a){const l=this[o];e.call(this,a),this.requestUpdate(o,l,t)}}throw Error("Unsupported decorator location: "+r)};function jA(t){return(e,i)=>typeof i=="object"?zVe(t,e,i):((r,s,n)=>{const o=s.hasOwnProperty(n);return s.constructor.createProperty(n,r),o?Object.getOwnPropertyDescriptor(s,n):void 0})(t,e,i)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function zv(t){return jA({...t,state:!0,attribute:!1})}var UVe=Object.defineProperty,BVe=Object.getOwnPropertyDescriptor,Wte=(t,e,i,r)=>{for(var s=r>1?void 0:r?BVe(e,i):e,n=t.length-1,o;n>=0;n--)(o=t[n])&&(s=(r?o(e,i,s):o(s))||s);return r&&s&&UVe(e,i,s),s};let i3=class extends sf{constructor(){super(...arguments),this.view=null,this.is3D=!1}updated(t){t.has("view")&&this.view&&this.view.ui.add(this,"top-left")}setView(t){this.view=t}toggleView(){this.is3D=!this.is3D,this.dispatchEvent(new CustomEvent("view-switch",{detail:{is3D:this.is3D},bubbles:!0,composed:!0}))}render(){return ce`
      <button @click=${this.toggleView}>
        Switch to ${this.is3D?"2D":"3D"}
      </button>
    `}};i3.styles=Ks`
    :host {
      display: block;
    }
    button {
      /* Remove absolute positioning, let ArcGIS UI handle it */
      background: white;
      border: 1px solid #999;
      padding: 0.5rem 1rem;
      font-size: 14px;
      cursor: pointer;
    }
  `;Wte([jA({attribute:!1})],i3.prototype,"view",2);Wte([zv()],i3.prototype,"is3D",2);i3=Wte([Ij("view-switcher")],i3);function u(t,e,i,r){var s,n=arguments.length,o=n<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,i):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(o=(n<3?s(o):n>3?s(e,i,o):s(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o}function zHt(t,e){return function(i,r){e(i,r,t)}}function UHt(t,e,i,r){function s(n){return n instanceof i?n:new i(function(o){o(n)})}return new(i||(i=Promise))(function(n,o){function a(h){try{c(r.next(h))}catch(d){o(d)}}function l(h){try{c(r.throw(h))}catch(d){o(d)}}function c(h){h.done?n(h.value):s(h.value).then(a,l)}c((r=r.apply(t,[])).next())})}function BHt(t,e,i){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose]}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(n){return Promise.reject(n)}}),t.stack.push({value:e,dispose:r,async:i})}return e}var VVe=typeof SuppressedError=="function"?SuppressedError:function(t,e,i){var r=new Error(i);return r.name="SuppressedError",r.error=t,r.suppressed=e,r};function VHt(t){function e(n){t.error=t.hasError?new VVe(n,t.error,"An error was suppressed during disposal."):n,t.hasError=!0}var i,r=0;function s(){for(;i=t.stack.pop();)try{if(!i.async&&r===1)return r=0,t.stack.push(i),Promise.resolve().then(s);if(i.dispose){var n=i.dispose.call(i.value);if(i.async)return r|=2,Promise.resolve(n).then(s,function(o){return e(o),s()})}else r|=1}catch(o){e(o)}if(r===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return s()}let X_;function X(t){return typeof X_[t]=="function"?X_[t]=X_[t](globalThis):X_[t]}var Nxe,Fxe,kxe,zxe;X_=(Nxe=globalThis.dojoConfig)!=null&&Nxe.has||(Fxe=globalThis.esriConfig)!=null&&Fxe.has?{...(kxe=globalThis.dojoConfig)==null?void 0:kxe.has,...(zxe=globalThis.esriConfig)==null?void 0:zxe.has}:{},X.add=(t,e,i,r)=>{(r||X_[t]===void 0)&&(X_[t]=e),i&&X(t)},X.cache=X_,X.add("big-integer-warning-enabled",!0),X.add("esri-deprecation-warnings",!0),X.add("esri-tests-disable-screenshots",!1),X.add("esri-tests-use-full-window",!1),X.add("esri-tests-post-to-influx",!0),X.add("esri-cim-animations-enable-status","enabled"),X.add("esri-cim-animations-spotlight",!1),X.add("esri-cim-animations-freeze-time",!1),X.add("enable-feature:multiple-highlights",!0),(()=>{var e;X.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(X.add("host-browser",t),X.add("host-node",typeof globalThis.process=="object"&&((e=globalThis.process.versions)==null?void 0:e.node)&&globalThis.process.versions.v8),X.add("dom",t),X("host-browser")){const i=navigator,r=i.userAgent,s=i.appVersion,n=parseFloat(s);if(X.add("wp",parseFloat(r.split("Windows Phone")[1])||void 0),X.add("msapp",parseFloat(r.split("MSAppHost/")[1])||void 0),X.add("khtml",s.includes("Konqueror")?n:void 0),X.add("edge",parseFloat(r.split("Edge/")[1])||void 0),X.add("opr",parseFloat(r.split("OPR/")[1])||void 0),X.add("webkit",!X("wp")&&!X("edge")&&parseFloat(r.split("WebKit/")[1])||void 0),X.add("chrome",!X("edge")&&!X("opr")&&parseFloat(r.split("Chrome/")[1])||void 0),X.add("android",!X("wp")&&parseFloat(r.split("Android ")[1])||void 0),X.add("safari",!s.includes("Safari")||X("wp")||X("chrome")||X("android")||X("edge")||X("opr")?void 0:parseFloat(s.split("Version/")[1])),X.add("mac",s.includes("Macintosh")),!X("wp")&&/(iPhone|iPod|iPad)/.test(r)){const o=RegExp.$1.replace(/P/,"p"),a=/OS ([\d_]+)/.test(r)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replaceAll("_",""));X.add(o,l),X.add("ios",l)}X("webkit")||(!r.includes("Gecko")||X("wp")||X("khtml")||X("edge")||X.add("mozilla",n),X("mozilla")&&X.add("ff",parseFloat(r.split("Firefox/")[1]||r.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),i=/iPhone/i.test(t);e&&X.add("esri-mobile",e),i&&X.add("esri-iPhone",i),X.add("esri-geolocation",!!navigator.geolocation)}X.add("esri-wasm","WebAssembly"in globalThis),X.add("esri-performance-mode-frames-between-render",20),X.add("esri-force-performance-mode",!1),X.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),X.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),X.add("esri-atomics","Atomics"in globalThis),X.add("esri-workers","Worker"in globalThis),X.add("web-feat:cache","caches"in globalThis),X.add("esri-workers-arraybuffer-transfer",!X("safari")||Number(X("safari"))>=12),X.add("workers-pool-size",8),X.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),X.add("featurelayer-simplify-payload-size-factors",[1,1,4]),X.add("featurelayer-fast-triangulation-enabled",!0),X.add("featurelayer-animation-enabled",!0),X.add("featurelayer-snapshot-enabled",!0),X.add("featurelayer-snapshot-point-min-threshold",8e4),X.add("featurelayer-snapshot-point-max-threshold",4e5),X.add("featurelayer-snapshot-point-coverage",.1),X.add("featurelayer-query-max-depth",4),X.add("featurelayer-query-pausing-enabled",!1),X.add("featurelayer-advanced-symbols",!1),X.add("featurelayer-pbf",!0),X.add("featurelayer-pbf-statistics",!1),X.add("feature-layers-workers",!0),X.add("feature-polyline-generalization-factor",1),X.add("mapview-transitions-duration",200),X.add("mapview-essential-goto-duration",200),X.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),X.add("mapserver-pbf-version-support",10.81),X.add("mapservice-popup-identify-max-tolerance",20),X.add("request-queue-concurrency-hosted",16),X.add("request-queue-concurrency-non-hosted",4),X.add("curve-densification-coarse-segments",128),X.add("curve-densification-max-segments",2e3),X.add("curve-densification-min-segments",3),X.add("curve-densification-pixels-per-segment",16),X.add("view-readyState-waiting-delay",1e3),X.add("gradient-depth-bias",.01),X.add("gradient-depth-epsilon",1e-8),X("host-webworker")||X("host-browser")&&(X.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),X.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{X.add("esri-image-decode",!0,!0,!0)}).catch(()=>{X.add("esri-image-decode",!1,!0,!0)})}return!1}),X.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();function jHt(t){}function jVe(t){return()=>t}function GHt(t){return t}let d4=class n1{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*n1._m}getInt(){return this._seed=(n1._a*this._seed+n1._c)%n1._m,this._seed}getFloat(){return this.getInt()/(n1._m-1)}getIntRange(e,i){return Math.round(this.getFloatRange(e,i))}getFloatRange(e,i){const r=i-e;return e+this.getInt()/n1._m*r}};d4._m=2147483647,d4._a=48271,d4._c=0;const Qxe=1.5,HHt=1/Qxe,qHt=.5;function p4(t,e){return e?t.filter((i,r,s)=>s.findIndex(e.bind(null,i))===r):Array.from(new Set(t))}function eg(t,e,i){if(t==null&&e==null)return!0;if(t==null||e==null||t.length!==e.length)return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function GVe(t,e){let i=t.length!==e.length;i&&(t.length=e.length);for(let r=0;r<e.length;++r)t[r]!==e[r]&&(t[r]=e[r],i=!0);return i}function vW(t,e,i){let r,s;return i?(r=e.filter(n=>!t.some(o=>i(o,n))),s=t.filter(n=>!e.some(o=>i(o,n)))):(r=e.filter(n=>!t.includes(n)),s=t.filter(n=>!e.includes(n))),{added:r,removed:s}}function HVe(t){return t&&typeof t.length=="number"}function WHt(t,e){const i=t.length;if(i===0)return[];const r=[];for(let s=0;s<i;s+=e)r.push(t.slice(s,s+e));return r}function ZHt(t,e,i){const r=t.length;let s=0,n=r-1;for(;s<n;){const a=s+Math.floor((n-s)/2);e>t[a]?s=a+1:n=a}const o=t[s];return i?e>=t[r-1]?-1:o===e?s:s-1:o===e?s:-1}let eSe=class{constructor(){this.last=0}};const tSe=new eSe;function _W(t,e,i,r){r=r||tSe;const s=Math.max(0,r.last-10);for(let o=s;o<i;++o)if(t[o]===e)return r.last=o,o;const n=Math.min(s,i);for(let o=0;o<n;++o)if(t[o]===e)return r.last=o,o;return-1}function r3(t,e,i,r){const s=t.length,n=_W(t,e,s,r);if(n!==-1)return t[n]=t[s-1],t.pop(),e}const qd=new Set;function qVe(t,e,i=t.length,r=e.length,s,n){if(r===0||i===0)return i;qd.clear();for(let a=0;a<r;++a)qd.add(e[a]);s=s||tSe;const o=Math.max(0,s.last-10);for(let a=o;a<i;++a)if(qd.has(t[a])&&(n==null||n.push(t[a]),qd.delete(t[a]),t[a]=t[i-1],--i,--a,qd.size===0||i===0))return qd.clear(),i;for(let a=0;a<o;++a)if(qd.has(t[a])&&(n==null||n.push(t[a]),qd.delete(t[a]),t[a]=t[i-1],--i,--a,qd.size===0||i===0))return qd.clear(),i;return qd.clear(),i}function WVe(t,e){let i=0;for(let r=0;r<t.length;++r){const s=t[r];e(s,r)&&(t[i]=s,i++)}t.length=i}function JHt(t,e,i){const r=t.length;if(e>=r)return t.slice();const s=Zte(i),n=new Set,o=[];for(;o.length<e;){const a=Math.floor(s()*r);n.has(a)||(n.add(a),o.push(t[a]))}return o}function Zte(t){return t?(gce.seed=t,()=>gce.getFloat()):Math.random}const gce=new d4;function iSe(t,e){const i=Zte(e);for(let r=t.length-1;r>0;r--){const s=Math.floor(i()*(r+1)),n=t[r];t[r]=t[s],t[s]=n}return t}function MD(t,e){const i=t.indexOf(e);return i!==-1?(t.splice(i,1),e):null}function df(t,e){return t!=null}const ZVe=[];function VO(t){return t instanceof ArrayBuffer}function Yte(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int8Array"}function K_(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8Array"}function rSe(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8ClampedArray"}function Jte(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int16Array"}function Rj(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint16Array"}function Xte(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int32Array"}function Kte(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint32Array"}function OD(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float32Array"}function ID(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float64Array"}function RD(t){return"buffer"in t}const lh=1024;function XHt(t){return ID(t)||OD(t)||Xte(t)||Jte(t)||Yte(t)}function KHt(t){return ID(t)||OD(t)}function QHt(t){return ID(t)?179769e303:OD(t)?3402823e32:Kte(t)?4294967295:Rj(t)?65535:K_(t)||rSe(t)?255:Xte(t)?2147483647:Jte(t)?32767:Yte(t)?127:256}function YVe(t,e){let i;for(i in t)t.hasOwnProperty(i)&&t[i]===void 0&&delete t[i];return t}function q(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=oSe(t);if(e!=null)return e;if(oU(t))return t.clone();if(sSe(t))return t.map(q);if(nSe(t))throw new Error("Trying to clone an unclonable Accessor instance");const i={};for(const r of Object.getOwnPropertyNames(t))i[r]=q(t[r]);return i}function bW(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=oSe(t);if(e!=null)return e;if(sSe(t)){let r=!0;const s=t.map(n=>{const o=bW(n);return n!=null&&o==null&&(r=!1),o});return r?s:null}if(oU(t))return t.clone();if(t instanceof File||t instanceof Blob)return t;if(nSe(t))return null;const i=new(Object.getPrototypeOf(t)).constructor;for(const r of Object.getOwnPropertyNames(t)){const s=t[r],n=bW(s);if(s!=null&&n==null)return null;i[r]=n}return i}function oU(t){return typeof t.clone=="function"}function sSe(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function nSe(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function yce(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function oSe(t){if(Yte(t)||K_(t)||rSe(t)||Jte(t)||Rj(t)||Xte(t)||Kte(t)||OD(t)||ID(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[i,r]of t)e.set(i,q(r));return e}if(t instanceof Set){const e=new Set;for(const i of t)e.add(q(i));return e}return null}function Qte(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof(t==null?void 0:t.getTime)=="function"&&typeof(e==null?void 0:e.getTime)=="function"&&t.getTime()===e.getTime()||!1}function aSe(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&eg(t,e):t instanceof Set?e instanceof Set&&XVe(t,e):t instanceof Map?e instanceof Map&&KVe(t,e):!!yce(t)&&yce(e)&&JVe(t,e))}function JVe(t,e){if(t===null||e===null)return!1;const i=Object.keys(t);if(e===null||Object.keys(e).length!==i.length)return!1;for(const r of i)if(t[r]!==e[r]||!Object.prototype.hasOwnProperty.call(e,r))return!1;return!0}function XVe(t,e){if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function KVe(t,e){if(t.size!==e.size)return!1;for(const[i,r]of t){const s=e.get(i);if(s!==r||s===void 0&&!e.has(i))return!1}return!0}function eie(t,e,i=!1){return cSe(t,e,i)}function Pj(t,e){if(e!=null)return e[t]||lSe(t.split("."),!1,e)}function ro(t,e,i){const r=t.split("."),s=r.pop(),n=lSe(r,!0,i);n&&s&&(n[s]=e)}function vce(t,e){if(t==null&&e==null)return!1;if(t==null||e==null)return!0;if(typeof t=="object"){if(Array.isArray(t)){const i=e;if(t.length!==i.length)return!0;for(let r=0;r<t.length;r++)if(vce(t[r],i[r]))return!0;return!1}if(Object.keys(t).length!==Object.keys(e).length)return!0;for(const i in t)if(vce(t[i],e[i]))return!0;return!1}return t!==e}function lSe(t,e,i){let r=i;for(const s of t){if(r==null)return;if(!(s in r)){if(!e)return;r[s]={}}r=r[s]}return r}function cSe(t,e,i){return e?Object.keys(e).reduce((r,s)=>{let n=r[s],o=e[s];return n===o?r:n===void 0?(r[s]=q(o),r):(Array.isArray(o)||Array.isArray(r)?(n=n?Array.isArray(n)?r[s]=n.slice():r[s]=[n]:r[s]=[],o&&(Array.isArray(o)||(o=[o]),i?o.forEach(a=>{n.includes(a)||n.push(a)}):r[s]=o.slice())):o&&typeof o=="object"?r[s]=cSe(n,o,i):r.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(r[s]=o),r)},t||{}):t}var Uxe;const Rr={apiKey:void 0,applicationName:"",applicationUrl:(Uxe=globalThis.location)==null?void 0:Uxe.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!0,portalUrl:"https://www.arcgis.com",respectPrefersReducedMotion:!0,routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],internalInterceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:62e3,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(eie(Rr,globalThis.esriConfig,!0),delete Rr.has),!Rr.assetsPath){{const t="4.32";Rr.assetsPath=`https://js.arcgis.com/${t}/@arcgis/core/assets`}Rr.defaultAssetsPath=Rr.assetsPath}const QVe=/\{([^}]+)\}/g;function _ce(t){return t??""}function PD(t,e){return e?t.replaceAll(QVe,typeof e=="object"?(i,r)=>_ce(Pj(r,e)):(i,r)=>_ce(e(r))):t}function e8t(t,e){return t.replaceAll(/([.$?*|{}()[\]\\/+\-^])/g,i=>e!=null&&e.includes(i)?i:`\\${i}`)}function uSe(t){let e=0;for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return e}let bce;function t8t(t){return bce??(bce=new DOMParser),bce.parseFromString(t||"","text/html").body.innerText||""}function i8t(t,e){return new RegExp(`{${e}}`,"ig").test(t)}function eje(t,...e){let i=t[0];for(let r=0;r<e.length;++r)i+=e[r]+t[r+1];return i}const wce={info:0,warn:1,error:2,none:3};let J=class Eu{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,Eu._loggers.set(this.module,this);const i=this.module.lastIndexOf(".");i!==-1&&(this._parent=Eu.getLogger(this.module.slice(0,i)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){}static get test(){}static getLogger(e){return e=typeof e!="string"?e.declaredClass:e,Eu._loggers.get(e)||new Eu({module:e})}_log(e,i,...r){if(this._matchLevel(e)){if(i!=="always"&&!Eu._throttlingDisabled){const s=ije(r),n=this._loggedMessages[e].get(s);if(i==="once"&&n!=null||i==="oncePerTick"&&n&&n>=Eu._tickCounter)return;this._loggedMessages[e].set(s,Eu._tickCounter),Eu._scheduleTickCounterIncrement()}for(const s of Rr.log.interceptors)if(s(e,this.module,...r))return;this._inheritedWriter()(e,this.module,...r)}}_parentWithMember(e,i){let r=this;for(;r!=null;){const s=r[e];if(s!=null)return s;r=r.parent}return i}_inheritedWriter(){return this._parentWithMember("writer",tje)}_matchLevel(e){const i=Rr.log.level||"warn";return wce[this._parentWithMember("level",i)]<=wce[e]}static _scheduleTickCounterIncrement(){Eu._tickCounterScheduled||(Eu._tickCounterScheduled=!0,Promise.resolve().then(()=>{Eu._tickCounter++,Eu._tickCounterScheduled=!1}))}};function tje(t,e,...i){console[t](`[${e}]`,...i)}function ije(...t){return uSe(JSON.stringify(t,(i,r)=>typeof r!="object"||Array.isArray(r)?r:"[Object]"))}J._loggers=new Map,J._tickCounter=0,J._tickCounterScheduled=!1,J._throttlingDisabled=!1;function $m(t,e){for(const i of t.values())if(e(i))return!0;return!1}function r8t(t,e){for(const i of t.values())if(e(i))return i;return null}function tw(t,e,i){const r=t.get(e);if(r!==void 0)return r;const s=i();return t.set(e,s),s}function s8t(t){const e=new Map;return i=>(e.has(i)||e.set(i,t(i)),e.get(i))}const NC=()=>J.getLogger("esri.core.accessorSupport.ensureTypes");function rje(t){return t==null?t:new Date(t)}function sje(t){return t==null?t:!!t}function DD(t){return t==null?t:t.toString()}function rc(t,e=0){return t==null?t:(t=parseFloat(t),isNaN(t)?e:t)}function tie(t){return t==null?t:Math.round(parseFloat(t))}function nje(t){return null}function oje(t,e){return i=>{let r=t(i);return e.step!=null&&(r=Math.round(r/e.step)*e.step),e.min!=null&&(r=Math.max(e.min,r)),e.max!=null&&(r=Math.min(e.max,r)),r}}function hSe(t){return(t==null?void 0:t.constructor)&&t.constructor.__accessorMetadata__!==void 0}function aU(t,e){return e!=null&&t&&!(e instanceof t)}function dSe(t){return t&&"isCollection"in t}function xce(t){return t!=null&&t.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function aje(t,e){if(!(e!=null&&e.constructor)||!dSe(e.constructor))return wW(t,e)?e:new t(e);const i=xce(t.prototype.itemType),r=xce(e.constructor.prototype.itemType);return i?r?i===r?e:i.prototype.isPrototypeOf(r.prototype)?new t(e):(wW(t,e),e):new t(e):e}function wW(t,e){return!!hSe(e)&&(NC().error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+Dj(t)+"'"),!0)}function GA(t,e){return e==null?e:dSe(t)?aje(t,e):aU(t,e)?wW(t,e)?e:new t(e):e}function Dj(t){var e;return((e=t==null?void 0:t.prototype)==null?void 0:e.declaredClass)||"unknown"}const lje=new WeakMap;function cje(t){switch(t){case Number:return e=>rc(e);case Ii:return tie;case Boolean:return sje;case String:return DD;case Date:return rje;case HA:return nje;default:return tw(lje,t,()=>GA.bind(null,t))}}function Ds(t,e){const i=cje(t);return arguments.length===1?i:i(e)}function s3(t,e,i){return arguments.length===1?s3.bind(null,t):e&&(Array.isArray(e)?e.map(r=>t(r,i)):[t(e,i)])}function uje(t,e){return arguments.length===1?s3(i=>Ds(t,i)):s3(i=>Ds(t,i),e)}function pSe(t,e,i){return e!==0&&Array.isArray(i)?i.map(r=>pSe(t,e-1,r)):t(i)}function lU(t,e,i){if(arguments.length===2)return n=>lU(t,e,n);if(!i)return i;i=pSe(t,e,i);let r=e,s=i;for(;r>0&&Array.isArray(s);)r--,s=s[0];if(s!==void 0)for(let n=0;n<r;n++)i=[i];return i}function hje(t,e,i){return arguments.length===2?lU(r=>Ds(t,r),e):lU(r=>Ds(t,r),e,i)}function fSe(t){return!!Array.isArray(t)&&!t.some(e=>{const i=typeof e;return!(i==="string"||i==="number"||i==="function"&&t.length>1)})}function xW(t,e){if(arguments.length===2)return xW(t).call(null,e);const i=new Set,r=t.filter(a=>typeof a!="function"),s=t.filter(a=>typeof a=="function");for(const a of t)typeof a!="string"&&typeof a!="number"||i.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,h=c==="string"||c==="number";return h&&(i.has(a)||s.some(d=>c==="string"&&d===String||c==="number"&&d===Number))||c==="object"&&s.some(d=>!aU(a,d))?a:(h&&r.length?(n||(n=r.map(d=>typeof d=="string"?`'${d}'`:`${d}`).join(", ")),NC().error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(d=>Dj(d)).join(", ")),NC().error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):NC().error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function Ad(t,e){if(arguments.length===2)return Ad(t).call(null,e);const i={},r=[],s=[];for(const l in t.typeMap){const c=t.typeMap[l];i[l]=Ds(c),r.push(Dj(c)),s.push(l)}const n=()=>`'${r.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!aU(t.base,l)||l==null)return l;const c=a(l)||t.defaultKeyValue,h=i[c];if(!h)return NC().error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!aU(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!hSe(l)){const d={};for(const f in l)f!==t.key&&(d[f]=l[f]);return h(d)}return h(l)}}let Ii=class{},HA=class{};const a8t={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function dje(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function mSe(t){switch(t.type){case"native":return Ds(t.value);case"array":return s3(mSe(t.value));case"one-of":return pje(t);default:return null}}function pje(t){let e=null;return(i,r)=>TW(i,t)?i:(e==null&&(e=SW(t)),NC().error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),r&&(r.valid=!1),null)}function SW(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Ii:return"integer";case Date:return"date";case HA:return"null";default:return Dj(t.value)}case"array":return`array of ${SW(t.value)}`;case"one-of":{const e=t.values.map(i=>SW(i));return`one of ${e.slice(0,-1)} or ${e[e.length-1]}`}}return"unknown"}function TW(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case Ii:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string";case HA:return t===null}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(i=>!TW(i,e.value));case"one-of":return e.values.some(i=>TW(t,i))}}const fje={remove:()=>{}};function Pi(t){return t?{remove(){t&&(t(),t=void 0)}}:fje}function gSe(t){t.forEach(e=>e==null?void 0:e.remove())}function l8t(t){gSe(t),t.length=0}function LD(t){return Pi(()=>gSe(t))}function c8t(t){return Pi(()=>{var e;return(e=t())==null?void 0:e.remove()})}function u8t(t){return Pi(()=>t==null?void 0:t.abort())}function ySe(t){return Pi(t!=null?()=>t.destroy():void 0)}function Ml(t){return t.__accessor__??null}function mje(t,e){var i;return((i=t==null?void 0:t.metadata)==null?void 0:i[e])!=null}function f4(t,e,i){return i?cU(t,e,{policy:i,path:""}):cU(t,e,null)}function cU(t,e,i){return e?Object.keys(e).reduce((r,s)=>{const n=s;let o=null,a="merge";if(i&&(o=i.path?`${i.path}.${s}`:s,a=i.policy(o)),a==="replace"||a==="replace-arrays"&&Array.isArray(r[n]))return r[n]=e[n],r;if(r[n]===void 0)return r[n]=q(e[n]),r;let l=r[n],c=e[n];if(l===c)return r;if(Array.isArray(c)||Array.isArray(r))l=l?Array.isArray(l)?r[n]=l.slice():r[n]=[l]:r[n]=[],c&&(Array.isArray(c)||(c=[c]),c.forEach(h=>{l.includes(h)||l.push(h)}));else if(c&&typeof c=="object")if(i){const h=i.path;i.path=o,r[n]=cU(l,c,i),i.path=h}else r[n]=cU(l,c,null);else r.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(r[n]=c);return r},t||{}):t}function vSe(t){return Array.isArray(t)?t:t.split(".")}function Sce(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function gje(t){if(Array.isArray(t)){const e=[];for(const i of t)e.push(...Sce(i));return e}return Sce(t)}function _Se(t,e,i,r){const s=gje(e);if(s.length!==1){const n=s.map(o=>r(t,o,i));return LD(n)}return r(t,s[0],i)}function bSe(t,e){const i=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const s=parseInt(i,10);if(!isNaN(s))return Array.isArray(e)?e[s]:e.at(s)}const r=Ml(e);return mje(r,i)?r.get(i):e[i]}function wSe(t,e,i){if(t==null)return t;const r=bSe(e[i],t);return!r&&i<e.length-1?void 0:i===e.length-1?r:wSe(r,e,i+1)}function ND(t,e,i=0){return typeof e!="string"||e.includes(".")?wSe(t,vSe(e),i):bSe(e,t)}function Bm(t,e){return ND(t,e)}function Tce(t,e){return ND(e,t)!==void 0}function FD(t){let e=t.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!i){e=Object.create(e);for(const r in e)e[r]=q(e[r]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function Lj(t,e){const i=FD(t);let r=i[e];return r||(r=i[e]={}),r}function yje(t,e){return f4(t,e,_je)}const vje=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function _je(t){return vje.test(t)?"replace":"merge"}function bje(t,e){return t.replaceAll(/\$\{([^\s:}]*)(?::([^\s:}]+))?\}/g,(i,r)=>r===""?"$":(Pj(r,e)??"").toString())}let xSe=class{constructor(e,i,r=void 0){this.name=e,this.details=r,this.message=(i&&bje(i,r))??""}toString(){return"["+this.name+"]: "+this.message}},U=class SSe extends xSe{constructor(e,i,r){super(e,i,r)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,i)=>{if(i&&typeof i=="object"&&typeof i.toJSON=="function")return i;try{return q(i)}catch{return"[object]"}}))}}catch(e){throw J.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new SSe(e.name,e.message,e.details)}};U.prototype.type="error";function uU(t,e,i){if(t&&e)if(typeof e=="object")for(const r of Object.getOwnPropertyNames(e))uU(t,r,e[r]);else{if(e.includes(".")){const s=e.split("."),n=s.splice(-1,1)[0];return void uU(Bm(t,s),n,i)}const r=t.__accessor__;r!=null&&wje(e,r),t[e]=i}}function wje(t,e){if(X("esri-unknown-property-errors")&&!xje(t,e))throw new U("set:unknown-property",Sje(t,e))}function xje(t,e){return e.metadata[t]!=null}function Sje(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}function p(t={}){return(e,i)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${i}. Accessor does not support static properties.`);const r=Object.getOwnPropertyDescriptor(e,i),s=Lj(e,i);r&&(r.get||r.set?(s.get=r.get||s.get,s.set=r.set||s.set):"value"in r&&("value"in t&&J.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${e.constructor.name}" already defined in the metadata`,t),s.value=t.value=r.value)),t.readOnly!=null&&(s.readOnly=t.readOnly);const n=t.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let h;s.dependsOn=[l],s.get=function(){let d=Bm(this,l);if(typeof d=="function"){h||(h=l.split(".").slice(0,-1).join("."));const f=Bm(this,h);f&&(d=d.bind(f))}return d},s.readOnly||(s.set=c?function(d){this._override(i,d)}:function(d){uU(this,l,d)})}const o=t.type,a=t.types;if(!s.cast){let l;o?l=Tje(o):a&&(l=Array.isArray(a)?s3(Ad(a[0])):Ad(a)),t.cast=Eje(t.cast,l)}yje(s,t),t.range&&(s.cast=oje(s.cast,t.range))}}function TSe(t,e,i){const r=Lj(t,i);r.json||(r.json={});let s=r.json;return e!==void 0&&(s.origins||(s.origins={}),s.origins[e]||(s.origins[e]={}),s=s.origins[e]),s}function Tje(t){let e=0,i=t;if(dje(t))return mSe(t);for(;Array.isArray(i)&&i.length===1&&typeof i[0]!="string"&&typeof i[0]!="number";)i=i[0],e++;const r=i;if(fSe(r))return e===0?xW(r):lU(xW(r),e);if(e===1)return uje(r);if(e>1)return hje(r,e);const s=t;return s.from?s.from:Ds(s)}function Eje(t,e){if(t||e)return t?e?(i,r)=>e(t(i,r),r):t:e}const ESe=Symbol("Accessor-beforeDestroy");var qc;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED",t[t.DESTROYED=3]="DESTROYED"})(qc||(qc={}));var jr;(function(t){t[t.Dirty=1]="Dirty",t[t.Overridden=2]="Overridden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(jr||(jr={}));let Nj=class{constructor(e){this.accessed=void 0,this._handles=void 0,this._observer=e}destroy(){var e;(e=this.accessed)==null||e.clear(),this.clear()}onAccessed(e){this._observer!=null&&e!==this._observer&&(this.accessed==null&&(this.accessed=new Set),this.accessed.add(e))}onTrackingEnd(){this._observer!=null&&(this.clear(),this.accessed!=null&&(this._handles==null&&(this._handles=[]),this.accessed.forEach(e=>{this._handles.push(e.observe(this._observer))}),this.accessed.clear()))}clear(){if(this._handles!=null){for(let e=0;e<this._handles.length;++e)this._handles[e].remove();this._handles.length=0}}};const hU=new Nj,jO=[];let HR=hU;function Pt(t){HR.onAccessed(t)}let m4=!1,g4=!1;function mv(t,e,i){if(m4)return iie(t,e,i);let r=null;return CSe(t),r=e.call(i),$Se(),r}function Cje(t,e){return mv(hU,t,e)}function iie(t,e,i){const r=m4;m4=!0,CSe(t);let s=null;try{s=e.call(i)}catch(n){g4&&J.getLogger("esri.core.accessorSupport.tracking").error(n)}return $Se(),m4=r,s}function CSe(t){HR=t,jO.push(t)}function $Se(){const t=jO.length;if(t>1){const e=jO.pop();HR=jO[t-2],e.onTrackingEnd()}else if(t===1){const e=jO.pop();HR=hU,e.onTrackingEnd()}else HR=hU}function ASe(t,e){if(e.flags&jr.DepTrackingInitialized)return;e.flags|=jr.DepTrackingInitialized;const i=g4;g4=!1,e.flags&jr.AutoTracked?iie(e.trackingTarget,e.metadata.get,t):MSe(t,e),g4=i}const $je=[];function MSe(t,e){e.flags&jr.ExplicitlyTracking||(e.flags|=jr.ExplicitlyTracking,iie(e.trackingTarget,()=>{const i=e.metadata.dependsOn||$je;for(const r of i)if(typeof r!="string"||r.includes(".")){const s=vSe(r);for(let n=0,o=t;n<s.length&&o!=null&&typeof o=="object";++n)o=Ece(o,s[n],n!==s.length-1)}else Ece(t,r,!1)}),e.flags&=~jr.ExplicitlyTracking)}function Ece(t,e,i){const r=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const n=parseInt(r,10);if(!isNaN(n))return Array.isArray(t)?t[n]:t.at(n)}const s=Ml(t);if(s){const n=s.propertiesByName.get(r);n&&(Pt(n),ASe(t,n))}return i?t[r]:void 0}function Aje(t){if(t.json&&t.json.origins){const e=t.json.origins,i={"web-document":["web-scene","web-map"]};for(const r in i)if(e[r]){const s=e[r];i[r].forEach(n=>{e[n]=s}),delete e[r]}}}let ch=class extends xSe{constructor(e,i,r){super(e,i,r)}};ch.prototype.type="warning";function OSe(t){var e;return!!t&&((e=t.prototype)==null?void 0:e.declaredClass)&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const EW=()=>J.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function Cce(t,e,i){var r,s;t&&(!i&&!e.read||(r=e.read)!=null&&r.reader||((s=e.read)==null?void 0:s.enabled)===!1||Ije(t)&&ro("read.reader",qA(t),e))}function qA(t){var i,r;const e=t.ndimArray??0;if(e>1)return Oje(t);if(e===1)return $ce(t);if("type"in t&&RSe(t.type)){const s=(r=(i=t.type.prototype)==null?void 0:i.itemType)==null?void 0:r.Type,n=$ce(typeof s=="function"?{type:s}:{types:s});return(o,a,l)=>{const c=n(o,a,l);return c&&new t.type(c)}}return rie(t)}function rie(t){return"type"in t?Mje(t.type):Rje(t.types)}function Mje(t){return t.prototype.read?(e,i,r)=>{if(e==null)return e;const s=typeof e;if(s!=="object")return void EW().error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${s}'`);const n=new t;return n.read(e,r),n}:t.fromJSON}function ISe(t,e,i,r){return r!==0&&Array.isArray(e)?e.map(s=>ISe(t,s,i,r-1)):t(e,void 0,i)}function Oje(t){const e=rie(t),i=ISe.bind(null,e),r=t.ndimArray??0;return(s,n,o)=>{if(s==null)return s;s=i(s,o,r);let a=r,l=s;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)s=[s];return s}}function $ce(t){const e=rie(t);return(i,r,s)=>{if(i==null)return i;if(Array.isArray(i)){const o=[];for(const a of i){const l=e(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=e(i,void 0,s);return n!==void 0?[n]:void 0}}function RSe(t){if(!OSe(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?sie(e.Type):PSe(e.Type))}function Ije(t){return"types"in t?PSe(t.types):sie(t.type)}function sie(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||RSe(t))}function PSe(t){for(const e in t.typeMap)if(!sie(t.typeMap[e]))return!1;return!0}function Rje(t){let e=null;const i=t.errorContext??"type",r=t.validate;return(s,n,o)=>{if(s==null)return s;const a=typeof s;if(a!=="object")return void EW().error(`Expected JSON value of type 'object' to deserialize, but got '${a}'`);e||(e=Pje(t));const l=t.key;if(typeof l!="string")return;const c=s[l],h=c?e[c]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!h){const f=`Type '${c||"unknown"}' is not supported`;return o!=null&&o.messages&&s&&o.messages.push(new ch(`${i}:unsupported`,f,{definition:s,context:o})),void EW().error(f)}const d=new h;return d.read(s,o),r?r(d):d}}function Pje(t){var i,r;const e={};for(const s in t.typeMap){const n=t.typeMap[s],o=FD(n.prototype);if(typeof t.key=="function")continue;const a=o[t.key];if(!a)continue;if((i=a.json)!=null&&i.type&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"){e[a.json.type[0]]=n;continue}const l=(r=a.json)==null?void 0:r.write;if(!(l!=null&&l.writer)){e[s]=n;continue}const c=l.target,h=typeof c=="string"?c:t.key,d={};l.writer(s,d,h),d[h]&&(e[d[h]]=n)}return e}function Dje(t){if(t.json||(t.json={}),Mce(t.json),Oce(t.json),Ace(t.json),t.json.origins)for(const e in t.json.origins)Mce(t.json.origins[e]),Oce(t.json.origins[e]),Ace(t.json.origins[e]);return!0}function Ace(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function Mce(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function Oce(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function Ice(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const i=(t==null?void 0:t.ndimArray)??0;t&&(i===1||"type"in t&&OSe(t.type))?e.write.writer=Fje:i>1?e.write.writer=kje(i):e.types?Array.isArray(e.types)?e.write.writer=Nje(e.types[0]):e.write.writer=Lje(e.types):e.write.writer=n3}function Lje(t){return(e,i,r,s)=>e?DSe(e,t,s)?n3(e,i,r,s):void 0:n3(e,i,r,s)}function DSe(t,e,i){for(const r in e.typeMap)if(t instanceof e.typeMap[r])return!0;if(i!=null&&i.messages){const r=e.errorContext??"type",s=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;i&&i.messages&&t&&i.messages.push(new U(`${r}:unsupported`,s,{definition:t,context:i})),J.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(s)}return!1}function Nje(t){return(e,i,r,s)=>!e||!Array.isArray(e)?n3(e,i,r,s):n3(e.filter(n=>DSe(n,t,s)),i,r,s)}function n3(t,e,i,r){ro(i,dU(t,r),e)}function dU(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?pU(t):t}function pU(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function Fje(t,e,i,r){let s;t===null?s=null:t&&typeof t.map=="function"?(s=t.map(n=>dU(n,r)),typeof s.toArray=="function"&&(s=s.toArray())):s=[dU(t,r)],ro(i,s,e)}function LSe(t,e,i){return i!==0&&Array.isArray(t)?t.map(r=>LSe(r,e,i-1)):dU(t,e)}function kje(t){return(e,i,r,s)=>{let n;if(e===null)n=null;else{n=LSe(e,s,t);let o=t,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}ro(r,n,i)}}function zje(t,e){return nie(t,"any",e==null?void 0:e.origin)}function CW(t,e){return nie(t,"read",e==null?void 0:e.origin)}function NSe(t,e){return nie(t,"write",e==null?void 0:e.origin)}function nie(t,e,i){let r=t==null?void 0:t.json;if(r!=null&&r.origins&&i){let s;s=i==="link-chart"?r.origins[i]&&(e==="any"||e in r.origins[i])?r.origins[i]:r.origins["web-map"]:r.origins[i],s&&(e==="any"||e in s)&&(r=s)}return r}function Uje(t){var i;const e=Bje(t);if(t.json.origins)for(const r in t.json.origins){const s=t.json.origins[r],n=s.types?Vje(s):e;Cce(n,s,!1),s.types&&!s.write&&((i=t.json.write)!=null&&i.enabled)&&(s.write={...t.json.write}),Ice(n,s)}Cce(e,t.json,!0),Ice(e,t.json)}function Bje(t){return t.json.types?$W(t.json):t.type?FSe(t):$W(t)}function Vje(t){return t.type?FSe(t):$W(t)}function FSe(t){if(!t.type)return;let e=0,i=t.type;for(;Array.isArray(i)&&!fSe(i);)i=i[0],e++;return{type:i,ndimArray:e}}function $W(t){if(!t.types)return;let e=0,i=t.types;for(;Array.isArray(i);)i=i[0],e++;return{types:i,ndimArray:e}}function jje(t){Dje(t)&&(Aje(t),Uje(t))}const MH=new Set,OH=new Set;function A(t){return e=>{t??(t="esri.core.Accessor"),e.prototype.declaredClass=t,Hje(e);const i=[],r=[];let s=e.prototype;for(;s;)s.hasOwnProperty("initialize")&&!MH.has(s.initialize)&&(MH.add(s.initialize),i.push(s.initialize)),s.hasOwnProperty("destroy")&&!OH.has(s.destroy)&&(OH.add(s.destroy),r.push(s.destroy)),s=Object.getPrototypeOf(s);MH.clear(),OH.clear();const n=class extends e{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=i.length-1;l>=0;l--)i[l].call(this)}}),r.length){let l=!1;const c=this[ESe];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let h=0;h<r.length;h++)r[h].call(this)}}})}Object.defineProperty(this,Symbol.dispose,{enumerable:!1,configurable:!0,value(){this.destroy()}}),this.postscript()}}};n.__accessorMetadata__=FD(e.prototype),n.prototype.declaredClass=t;const o=(t||"AccessorSubclass").split(".").slice(-1)[0];return Object.defineProperty(n,"name",{value:o,configurable:!0}),n}}function Gje(t,e){return e.get==null?function(){const i=this.__accessor__,r=i.propertiesByName.get(t);if(r===void 0)return;i.mutable&&Pt(r);const s=i.store;return s.has(t)?s.get(t):r.metadata.value}:function(){const i=this.__accessor__,r=i.propertiesByName.get(t);if(r!==void 0)return r.getComputed(i)}}function Hje(t){const e=t.prototype,i=FD(e),r={};for(const s of Object.getOwnPropertyNames(i)){const n=i[s];jje(n),r[s]={enumerable:!0,configurable:!0,get:Gje(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(a.mutable)return a.initialized&&n.readOnly?Rce("read-only",s):a.lifecycle===qc.CONSTRUCTED&&n.constructOnly?Rce("construct-only",s):void a.set(s,o)}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(t.prototype,r)}const Rce=(t,e)=>{J.getLogger("esri.core.Accessor").error(`cannot assign to ${t} property '${e}'`)},qje="modulepreload",Wje=function(t){return"/"+t},Pce={},G=function(e,i,r){let s=Promise.resolve();if(i&&i.length>0){let o=function(c){return Promise.all(c.map(h=>Promise.resolve(h).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=o(i.map(c=>{if(c=Wje(c),c in Pce)return;Pce[c]=!0;const h=c.endsWith(".css"),d=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const f=document.createElement("link");if(f.rel=h?"stylesheet":qje,h||(f.as="script"),f.crossOrigin="",f.href=c,l&&f.setAttribute("nonce",l),document.head.appendChild(f),h)return new Promise((m,g)=>{f.addEventListener("load",m),f.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${c}`)))})}))}function n(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return s.then(o=>{for(const a of o||[])a.status==="rejected"&&n(a.reason);return e().catch(n)})},Dce=new WeakMap;function Zje(t,e,i=!1){const r=` DEPRECATED - ${e}`;if(!i)return void t.warn(r);let s=Dce.get(t);s||(s=new Set,Dce.set(t,s)),s.has(e)||(s.add(e),t.warn(r))}const Lce="https://www.esriurl.com/";function Yje(t,e,i,r={}){X("esri-deprecation-warnings")&&I$(t,`This widget is deprecated. Use the ${e} component instead.`,{see:[`${e} component reference: ${Lce}${i}/`,`Esri's move to web components: ${Lce}components-transition-plan/`],replacement:`<${i}></${i}>`,warnOnce:!0,...r})}function Jje(t,e,i={}){if(X("esri-deprecation-warnings")){const{moduleName:r}=i;I$(t,`Function: ${(r?r+"::":"")+e+"()"}`,i)}}function Xje(t,e,i={}){if(X("esri-deprecation-warnings")){const{moduleName:r}=i;I$(t,`Property: ${(r?r+"::":"")+e}`,i)}}function Kje(t,e,i={}){X("esri-deprecation-warnings")&&I$(t,`Multiple argument constructor: ${e}`,{warnOnce:!0,replacement:`new ${e}({ <your properties here> })`,...i})}function I$(t,e,i={}){if(X("esri-deprecation-warnings")){const{replacement:r,version:s,see:n,warnOnce:o}=i;let a=e;if(r&&(a+=`
	 Replacement: ${r}`),s&&(a+=`
	 Version: ${s}`),n)if(Array.isArray(n)){a+=`
	 See for more details:`;for(const l of n)a+=`
		${l}`}else a+=`
	 See ${n} for more details.`;Zje(t,a,o)}}function f8t(t){const e=[];return function*(){yield*e;for(const i of t)e.push(i),yield i}}function Qje(t,e){for(const i of t)if(i!=null&&e(i))return i}function o3(t){return t!=null&&typeof t[Symbol.iterator]=="function"}let fg=class{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(i=>{e+=i.length}),e}add(e,i){if(o3(e)){const r=this._getOrCreateGroup(i);for(const s of e)Fce(s)&&r.push(s)}else Fce(e)&&this._getOrCreateGroup(i).push(e);return this}forEach(e,i){if(typeof e=="function")this._groups.forEach(r=>r.forEach(e));else{const r=this._getGroup(e);r&&i&&r.forEach(i)}}has(e){return this._groups.has(iN(e))}remove(e){if(typeof e!="string"&&o3(e)){for(const i of e)this.remove(i);return this}return this.has(e)?(Nce(this._getGroup(e)),this._groups.delete(iN(e)),this):this}removeAll(){return this._groups.forEach(Nce),this._groups.clear(),this}removeReference(e){return this._groups.delete(e),this}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const i=[];return this._groups.set(iN(e),i),i}_getGroup(e){return this._groups.get(iN(e))}};function iN(t){return t||"_default_"}function Nce(t){for(const e of t)e instanceof fg?e.removeAll():e.remove()}function Fce(t){return t!=null&&(!!t.remove||t instanceof fg)}function Fj(t,e){if(t==null)throw new Error(e??"value is None")}function $e(t){return t==null||t.destroy(),null}function Dt(t){return t==null||t.dispose(),null}function Ji(t){return t==null||t.remove(),null}function fc(t){return t==null||t.abort(),null}function Lr(t){return t==null||t.release(),null}function eGe(t,e,i){return t!=null&&e!=null?i!=null?i(t,e):t.equals(e):t===e}function kce(t,e){return t==null?void 0:t[e]}function kSe(t,e){let i;return t.some((r,s)=>(i=e(r,s),i!=null)),i??void 0}function tGe(t){return(t==null?void 0:t.release)&&typeof t.release=="function"}function iGe(t){return(t==null?void 0:t.acquire)&&typeof t.acquire=="function"}let Ol=class AW{constructor(e,i,r,s=1,n=0){this._ctor=e,this._acquireFunction=i,this._releaseFunction=r,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n;for(let o=0;o<n;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...e){let i;if(AW.test.disabled)i=new this._ctor;else{if(this._pool.length===0){const r=this.allocationSize;for(let s=0;s<r;s++)this._pool[s]=new this._ctor}i=this._pool.pop()}return this._acquireFunction?this._acquireFunction(i,...e):iGe(i)&&i.acquire(...e),i}release(e){e&&!AW.test.disabled&&(this._releaseFunction?this._releaseFunction(e):tGe(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let i=e;i<this._pool.length;++i){const r=this._pool[i];this._dispose(r)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};Ol.test={disabled:!1};let rGe=class{constructor(e,i){this._observers=e,this._observer=i}remove(){MD(this._observers,this._observer)}},zSe=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return sGe;this._observers==null&&(this._observers=[]);const i=this._observers;let r=!1,s=!1;const n=i.length;for(let o=0;o<n;++o){const a=i[o];if(a.destroyed)s=!0;else if(a===e){r=!0;break}}return r||(i.push(e),s&&this._removeDestroyedObservers()),new rGe(i,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const i=e.length;let r=0;for(let s=0;s<i;++s){for(;s+r<i&&e[s+r].destroyed;)++r;if(r>0){if(!(s+r<i))break;e[s]=e[s+r]}}e.length=i-r}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const i of e)i.onCommitted();this._observers=null}}};const sGe=Pi();var Oi;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.LINK_CHART=6]="LINK_CHART",t[t.USER=7]="USER"})(Oi||(Oi={}));const MW=Oi.USER+1;function Q_(t){switch(t){case"defaults":return Oi.DEFAULTS;case"service":return Oi.SERVICE;case"portal-item":return Oi.PORTAL_ITEM;case"web-scene":return Oi.WEB_SCENE;case"web-map":return Oi.WEB_MAP;case"link-chart":return Oi.LINK_CHART;case"user":return Oi.USER;default:return null}}function fU(t){switch(t){case Oi.DEFAULTS:return"defaults";case Oi.SERVICE:return"service";case Oi.PORTAL_ITEM:return"portal-item";case Oi.WEB_SCENE:return"web-scene";case Oi.WEB_MAP:return"web-map";case Oi.LINK_CHART:return"link-chart";case Oi.USER:return"user"}}function nGe(t){return fU(t)}let zce=class extends zSe{constructor(e,i){super(),this.propertyName=e,this.metadata=i,this.trackingTarget=new Nj(this),this.flags=0,this.flags=jr.Dirty|(i.nonNullable?jr.NonNullable:0)|(i.hasOwnProperty("value")?jr.HasDefaultValue:0)|(i.get===void 0?jr.DepTrackingInitialized:0)|(i.dependsOn===void 0?jr.AutoTracked:0)}destroy(){this.flags&jr.Dirty&&this.onCommitted(),super.destroy(),this.trackingTarget.destroy()}getComputed(e){e.mutable&&Pt(this);const i=e.store,r=this.propertyName,s=this.flags,n=i.get(r);if(s&jr.Computing||~s&jr.Dirty&&i.has(r))return n;this.flags|=jr.Computing;const o=e.host;let a;s&jr.AutoTracked?a=mv(this.trackingTarget,this.metadata.get,o):(MSe(o,this),a=this.metadata.get.call(o)),this.flags|=jr.DepTrackingInitialized,i.set(r,a,Oi.COMPUTED);const l=i.get(r);return l===n?this.flags&=~jr.Dirty:Cje(this.commit,this),this.flags&=~jr.Computing,l}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}commit(){this.flags&=~jr.Dirty,this.onCommitted()}onInvalidated(){~this.flags&jr.Overridden&&(this.flags|=jr.Dirty);const e=this._observers;if(e&&e.length>0)for(const i of e)i.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onCommitted()}}},oGe=class USe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new USe;return this._values.forEach((r,s)=>{e&&e.has(s)||i.set(s,q(r))}),i}get(e){return this._values.get(e)}originOf(){return Oi.USER}keys(){return[...this._values.keys()]}set(e,i){this._values.set(e,i)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function rN(t,e,i){return t!==void 0}function Uce(t,e,i,r){return t!==void 0&&(!(i==null&&t.flags&jr.NonNullable)||(r.lifecycle,qc.INITIALIZING,!1))}let aGe=class{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.lifecycle=qc.INITIALIZING,this.store=new oGe,this.mutable=!0,this._origin=Oi.USER;const i=this.host.constructor.__accessorMetadata__;for(const r in i){const s=new zce(r,i[r]);this.propertiesByName.set(r,s)}this.metadata=i}initialize(){this.lifecycle=qc.CONSTRUCTING}constructed(){this.lifecycle=qc.CONSTRUCTED}destroy(){this.lifecycle=qc.DESTROYED,this.propertiesByName.forEach(e=>e.destroy())}get initialized(){return this.lifecycle!==qc.INITIALIZING}get(e){const i=this.propertiesByName.get(e);if(i.metadata.get)return i.getComputed(this);this.mutable&&Pt(i);const r=this.store;return r.has(e)?r.get(e):i.metadata.value}originOf(e){const i=this.store.originOf(e);if(i===void 0){const r=this.propertiesByName.get(e);if(r!==void 0&&r.flags&jr.HasDefaultValue)return"defaults"}return fU(i)}has(e){return this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const i=this.propertiesByName.get(e);if(rN(i))return this.store.has(e)?this.store.get(e):i.metadata.value}internalSet(e,i){const r=this.propertiesByName.get(e);rN(r)&&this._internalSet(r,i)}getDependsInfo(e,i,r){const s=this.propertiesByName.get(i);if(!rN(s))return"";const n=new Nj,o=mv(n,()=>{var c;return(c=s.metadata.get)==null?void 0:c.call(e)});let a=`${r}${e.declaredClass.split(".").pop()}.${i}: ${o}
`;const l=n.accessed??new Set;if(l.size===0)return a;r+="  ";for(const c of l)c instanceof zce&&(a+=`${r}${c.propertyName}: undefined
`);return a}setAtOrigin(e,i,r){const s=this.propertiesByName.get(e);if(rN(s))return this._setAtOrigin(s,i,r)}isOverridden(e){const i=this.propertiesByName.get(e);return i!==void 0&&!!(i.flags&jr.Overridden)}clearOverride(e){const i=this.propertiesByName.get(e);i&&i.flags&jr.Overridden&&(i.flags&=~jr.Overridden,i.notifyChange())}override(e,i){const r=this.propertiesByName.get(e);if(!Uce(r,e,i,this))return;const s=r.metadata.cast;if(s){const n=this._cast(s,i),{valid:o,value:a}=n;if(IH.release(n),!o)return;i=a}r.flags|=jr.Overridden,this._internalSet(r,i)}set(e,i){const r=this.propertiesByName.get(e);if(!Uce(r,e,i,this))return;const s=r.metadata.cast;if(s){const o=this._cast(s,i),{valid:a,value:l}=o;if(IH.release(o),!a)return;i=l}const n=r.metadata.set;n?n.call(this.host,i):this._internalSet(r,i)}setDefaultOrigin(e){this._origin=Q_(e)}getDefaultOrigin(){return fU(this._origin)}notifyChange(e){const i=this.propertiesByName.get(e);i!==void 0&&i.notifyChange()}invalidate(e){const i=this.propertiesByName.get(e);i!==void 0&&i.invalidate()}commit(e){const i=this.propertiesByName.get(e);i!==void 0&&i.commit()}_internalSet(e,i){const r=this.lifecycle!==qc.INITIALIZING?this._origin:Oi.DEFAULTS;this._setAtOrigin(e,i,r)}_setAtOrigin(e,i,r){const s=this.store,n=e.propertyName;s.has(n,r)&&Qte(i,s.get(n))&&~e.flags&jr.Overridden&&r===s.originOf(n)||(e.invalidate(),s.set(n,i,r),e.commit(),ASe(this.host,e))}_cast(e,i){const r=IH.acquire();return r.valid=!0,r.value=i,e&&(r.value=e.call(this.host,i,r)),r}},lGe=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const IH=new Ol(lGe);let cGe;function uGe(){return cGe}var Bce;(function(t){t[t.Ignore=0]="Ignore",t[t.Destroy=1]="Destroy",t[t.ThrowError=2]="ThrowError"})(Bce||(Bce={}));function hGe(t){t.length=0}let sc=class{constructor(e=50,i=50){this._pool=new Ol(Array,void 0,hGe,i,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return RH.acquire()}static release(e){return RH.release(e)}static prune(){RH.prune()}};const RH=new sc(100);let BSe=class extends Ol{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=null}acquire(...e){const i=super.acquire(...e);return this._set.delete(i),i}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const sN=[];function R$(t){sN.push(t),sN.length===1&&queueMicrotask(()=>{const e=sN.slice();sN.length=0;for(const i of e)i()})}let Xy=class{constructor(e,i=30){this.name=e,this._counter=0,this._samples=new Array(i)}push(e){e!=null&&(this._samples[++this._counter%this._samples.length]=e)}set(e){e!=null&&(this._samples[this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,i)=>e-i)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,i)=>e+i,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var OW;(function(t){const e=(n,o,a,l)=>{let c=o,h=o;const d=a>>>1,f=n[c-1];for(;h<=d;){h=c<<1,h<a&&l(n[h-1],n[h])<0&&++h;const m=n[h-1];if(l(m,f)<=0)break;n[c-1]=m,c=h}n[c-1]=f},i=(n,o)=>n<o?-1:n>o?1:0;function r(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)e(n,h,a,l);const c=o+1;for(let h=a-1;h>o;h--){const d=n[o];n[o]=n[h],n[h]=d,e(n,c,h,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)e(n,h,a,l),yield;const c=o+1;for(let h=a-1;h>o;h--){const d=n[o];n[o]=n[h],n[h]=d,e(n,c,h,l),yield}}t.sort=r,t.iterableSort=s})(OW||(OW={}));const Vce=OW,dGe=1.5,pGe=1.1;let ii=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new eSe,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>jce(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const i=new Array;for(let r=0;r<this._length;r++){const s=this.data[r];e(s)&&i.push(s)}return i}at(e){if((e=Math.trunc(e)||0)<0&&(e+=this._length),!(e<0||e>=this._length))return this.data[e]}includes(e,i){const r=this.data.indexOf(e,i);return r!==-1&&r<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let i=e;i<this._length;++i)this.data[i]=this._deallocator(this.data[i]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,i=e.length){for(let r=0;r<i;r++)this.data[this._length++]=e[r]}fill(e,i){for(let r=0;r<i;r++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,jce(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const i=_W(this.data,e,this.length,this._hint);if(i!==-1)return this.data.splice(i,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(_W(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,i=e.length,r){this.length=qVe(this.data,e,this.length,i,this._hint,r),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,i){if(e>=this.length||i>=this.length||e===i)return;const r=this.data[e];this.data[e]=this.data[i],this.data[i]=r}sort(e){Vce.sort(this.data,0,this.length,e)}iterableSort(e){return Vce.iterableSort(this.data,0,this.length,e)}some(e,i){for(let r=0;r<this.length;++r)if(e.call(i,this.data[r],r,this.data))return!0;return!1}find(e,i){const{data:r,length:s}=this;for(let n=0;n<s;++n)if(e.call(i,r[n]))return r[n]}filterInPlace(e,i){let r=0;for(let s=0;s<this._length;++s){const n=this.data[s];e.call(i,n,s,this.data)&&(this.data[s]=this.data[r],this.data[r]=n,r++)}if(this._deallocator)for(let s=r;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=r,this._shrink(),this}forAll(e,i){const{data:r,length:s}=this;for(let n=0;n<s;++n)e.call(i,r[n],n,r)}forEach(e,i){this.data.slice(0,this.length).forEach(e,i)}map(e,i){const r=new Array(this.length);for(let s=0;s<this.length;++s)r[s]=e.call(i,this.data[s],s,this.data);return r}reduce(e,i){let r=i;for(let s=0;s<this.length;++s)r=e(r,this.data[s],s,this.data);return r}has(e){const i=this.length,r=this.data;for(let s=0;s<i;++s)if(r[s]===e)return!0;return!1}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.data[e]}};function jce(t){t.data.length>dGe*t.length&&(t.data.length=Math.floor(t.length*pGe))}function fGe(t){return{setTimeout:(e,i)=>{const r=t.setTimeout(e,i);return Pi(()=>t.clearTimeout(r))}}}const WA=fGe(globalThis);function kj(t){return mGe(t)||VSe(t)}function mGe(t){return t!=null&&typeof t=="object"&&"on"in t&&typeof t.on=="function"}function VSe(t){return t!=null&&typeof t=="object"&&"addEventListener"in t&&typeof t.addEventListener=="function"}function ZA(t,e,i){if(!kj(t))throw new TypeError("target is not a Evented or EventTarget object");return VSe(t)?gGe(t,e,i):t.on(e,i)}function gGe(t,e,i,r){if(Array.isArray(e)){const s=e.slice();for(const n of s)t.addEventListener(n,i,r);return Pi(()=>{for(const n of s)t.removeEventListener(n,i,r)})}return t.addEventListener(e,i,r),Pi(()=>t.removeEventListener(e,i,r))}function jSe(t,e,i){if(!kj(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,i);const r=ZA(t,e,s=>{r.remove(),i.call(t,s)});return r}function bi(t="Aborted"){return new U("AbortError",t)}function gt(t,e="Aborted"){if(Sa(t))throw bi(e)}function kD(t){return t instanceof AbortSignal?t:(t==null?void 0:t.signal)??void 0}function Sa(t){const e=kD(t);return e!=null&&e.aborted}function Wc(t){if(es(t))throw t}function Gce(t){if(!es(t))throw t}function Qo(t,e){const i=kD(t);if(i!=null){if(!i.aborted)return jSe(i,"abort",()=>e());e()}}function zD(t,e){const i=kD(t);if(i!=null)return gt(i),jSe(i,"abort",()=>e(bi()))}function oie(t,e){return kD(e)==null?t:new Promise((i,r)=>{let s=Qo(e,()=>r(bi()));const n=()=>{s=Ji(s)};t.then(n,n),t.then(i,r)})}function es(t){return(t==null?void 0:t.name)==="AbortError"}async function a3(t){try{return await t}catch(e){if(!es(e))throw e;return}}async function E8t(t,e=J.getLogger("esri")){try{return await t}catch(i){es(i)||e.error(i)}}async function zj(t){if(!t)return;if(typeof t.forEach!="function"){const i=Object.keys(t),r=i.map(o=>t[o]),s=await zj(r),n={};return i.map((o,a)=>n[o]=s[a]),n}const e=t;return Promise.allSettled(e).then(i=>Array.from(e,(r,s)=>{const n=i[s];return n.status==="fulfilled"?{promise:r,value:n.value}:{promise:r,error:n.reason}}))}async function yGe(t){return(await Promise.allSettled(t)).filter(e=>e.status==="fulfilled").map(e=>e.value)}async function vGe(t){return(await Promise.allSettled(t)).filter(e=>e.status==="rejected").map(e=>e.reason)}function aie(t,e=void 0,i){const r=new AbortController;return Qo(i,()=>r.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(e)},t);Qo(r,()=>{o&&(clearTimeout(o),n(bi()))})})}function C8t(t,e,i,r){const s=i&&"abort"in i?i:null;r!=null||s||(r=i);let n=setTimeout(()=>{n=0,s==null||s.abort()},e);const o=()=>r||new U("promiseUtils:timeout","The wrapped promise did not resolve within "+e+" ms");return t.then(a=>{if(n===0)throw o();return clearTimeout(n),a},a=>{throw clearTimeout(n),n===0?o():a})}function _Ge(t,e){const i=new AbortController,r=setTimeout(()=>i.abort(),e);return Qo(t,()=>{i.abort(),clearTimeout(r)}),{...t,signal:i.signal}}function uu(t){return t&&typeof t.then=="function"}function IW(t){return uu(t)?t:Promise.resolve(t)}function UD(t,e=-1){let i,r,s,n,o=null;const a=(...l)=>{if(i){r=l,n&&n.reject(bi()),n=ta();const f=n.promise;if(o){const m=o;o=null,m.abort()}return f}if(s=n||ta(),n=null,e>0){const f=new AbortController;i=IW(t(...l,f.signal));const m=i;aie(e).then(()=>{i===m&&(n?f.abort():o=f)})}else i=1,i=IW(t(...l));const c=()=>{const f=r;r=s=i=o=null,f!=null&&a(...f)},h=i,d=s;return h.then(c,c),h.then(d.resolve,d.reject),d.promise};return a}function ta(){let t,e;const i=new Promise((s,n)=>{t=s,e=n}),r=s=>{t(s)};return r.resolve=s=>t(s),r.reject=s=>e(s),r.timeout=(s,n)=>WA.setTimeout(()=>r.reject(n),s),r.promise=i,r}function $8t(t,e){return t.then(e,e)}async function Hce(t){await Promise.resolve(),gt(t)}function A8t(t){return t}function GSe(t){return 1e3*t}function M8t(t){return t}function HSe(t){return .001*t}let bGe=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},wGe=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},RW=0,PW=0;const MM={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},DW=["prepare","preRender","render","postRender","update","finish"],LW=[],dS=new ii;let xGe=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1,qSe()}};function SGe(){Gx!=null&&(cancelAnimationFrame(Gx),Gx=requestAnimationFrame(lie))}function qSe(){Gx==null&&(RW=performance.now(),Gx=requestAnimationFrame(lie))}const mU={frameTasks:dS,willDispatch:!1,clearFrameTasks:TGe,dispatch:ZSe,executeFrameTasks:CGe,reschedule:SGe};function YA(t){const e=new wGe(t);return LW.push(e),mU.willDispatch||(mU.willDispatch=!0,R$(ZSe)),e}function tg(t){const e=new bGe(t);return dS.push(e),qSe(),new xGe(e)}let Gx=null;function TGe(t=!1){dS.forAll(e=>{e.removed=!0}),t&&WSe()}function EGe(t){PW=Math.max(0,t)}function lie(){const t=performance.now();Gx=null,Gx=dS.some(i=>!i.paused&&!i.removed)?requestAnimationFrame(lie):null,mU.executeFrameTasks(t)}function CGe(t){const e=t-RW;RW=t;const i=PW>0?PW:1e3/60,r=Math.max(0,e-i);MM.time=t,MM.frameDuration=i-r;for(let s=0;s<DW.length;s++){const n=performance.now(),o=DW[s];dS.forAll(a=>{var l;a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(MM.elapsedFrameTime=performance.now()-t,MM.deltaTime=a.ticks===0?0:e,(l=a.phases[o])==null||l.call(a,MM)))}),OGe[s].push(performance.now()-n)}WSe(),IGe.push(performance.now()-t)}const nN=new ii;function WSe(){dS.forAll(t=>{t.removed&&nN.push(t)}),dS.removeUnorderedMany(nN.data,nN.length),nN.clear()}function ZSe(){for(;LW.length;){const t=LW.shift();t.isActive&&t.callback()}mU.willDispatch=!1}function $Ge(t=1,e){const i=ta(),r=()=>{Sa(e)?i.reject(bi()):t===0?i():(--t,R$(()=>r()))};return r(),i.promise}function AGe(t){return $Ge(1,t)}async function MGe(t){await AGe(t),await new Promise(e=>requestAnimationFrame(()=>{t!=null&&t.aborted||e()}))}const OGe=DW.map(t=>new Xy(t)),IGe=new Xy("total");function qR(t,e){for(const i of t.values())if(e(i))return!0;return!1}function l3(t,e){if(!e)return t;for(const i of e)i!=null&&t.add(i);return t}function qce(t,e){return e!=null&&t.add(e),t}function cie(t,e){const i=new Set;return l3(i,t),l3(i,e),i}function RGe(t,e){const i=new Set;for(const r of e)t.has(r)&&i.add(r);return i}function P8t(t,e){if(!t||!e)return!1;if(t===e)return!0;for(const i of t)if(!e.has(i))return!1;return!0}function D8t(t,e){if(t==null&&e==null)return!0;if(t==null||e==null||t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function PGe(t,e){const i=new Set(t);for(const r of e)i.delete(r);return i}function DGe(t,e){return PGe(cie(t,e),RGe(t,e))}let LGe=0;const NGe=0;function Td(){return++LGe}let Uj=class extends Nj{constructor(e){super(new FGe(e)),this._observer&&Wce.register(this,new WeakRef(this._observer),this)}destroy(){var e,i;this._observer&&Wce.unregister(this._observer),(e=this.accessed)==null||e.clear(),this.clear(),(i=this._observer)==null||i.destroy()}},FGe=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=kGe}};const Wce=new FinalizationRegistry(t=>{var e;(e=t.deref())==null||e.destroy()});function kGe(){}let FC=!1;const gU=[];function YSe(t,e){let i=new Uj(n),r=null,s=!1;function n(){if(!i||s)return;if(FC)return void KSe(n);const a=r;i.clear(),FC=!0,s=!0,r=mv(i,t),s=!1,FC=!1,e(r,a),QSe()}function o(){i&&(i.destroy(),i=null,r=null)}return s=!0,r=mv(i,t),s=!1,Pi(o)}function JSe(t,e){let i=new Uj(s),r=null;function s(){e(r,o)}function n(){i&&(i.destroy(),i=null),r=null}function o(){return i?(i.clear(),r=mv(i,t),r):null}return o(),Pi(n)}function XSe(t,e){let i=!1,r=!1;const s=!!(e!=null&&e.sync);let n=new Uj(()=>{i||r||(r=!0,s?o():queueMicrotask(o))});function o(){r=!1,n&&!i&&(FC?KSe(o):(n.clear(),FC=!0,i=!0,mv(n,t),i=!1,FC=!1,QSe()))}function a(){n&&(n.destroy(),n=null)}return i=!0,mv(n,t),i=!1,Pi(a)}function KSe(t){gU.includes(t)||gU.unshift(t)}function QSe(){for(;gU.length;)gU.pop()()}var WR;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})(WR||(WR={}));let c3=class{constructor(){this.uid=Td(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,i,r,s,n){return this.pool.acquire(WR.Untracked,e,i,r,s,n,Qte)}static acquireTracked(e,i,r,s){return this.pool.acquire(WR.Tracked,e,i,r,null,null,s)}notify(e,i){this.type===WR.Untracked?this.callback.call(this.target,e,i,this.path,this.target):this.callback.call(null,e,i,void 0,void 0)}acquire(e,i,r,s,n,o,a){this.uid=Td(),this.removed=!1,this.type=e,this.oldValue=i,this.callback=r,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=Td(),this.removed=!0}};c3.pool=new BSe(c3);const y4=new sc,tv=new Set;let yU;function vU(t){tv.delete(t),tv.add(t),yU||(yU=YA(BGe))}function zGe(t){if(t.removed)return;const e=t.oldValue,i=t.getValue();t.equals(e,i)||(t.oldValue=i,t.notify(i,e))}function UGe(t){for(const e of tv.values())e.target===t&&(e.removed=!0)}function BGe(){let t=10;for(;yU&&t--;){yU=null;const e=VGe(),i=y4.acquire();for(const r of e){const s=r.uid;zGe(r),s===r.uid&&r.removed&&i.push(r)}for(const r of tv)r.removed&&(i.push(r),tv.delete(r));for(const r of i)c3.pool.release(r);y4.release(i),y4.release(e),NW.forEach(r=>r())}}function VGe(){const t=y4.acquire();t.length=tv.size;let e=0;for(const i of tv)t[e]=i,++e;return tv.clear(),t}const NW=new Set;function eTe(t){return NW.add(t),Pi(()=>NW.delete(t))}function jGe(t,e,i){let r=_Se(t,e,i,(s,n,o)=>{let a,l,c=JSe(()=>ND(s,n),(h,d)=>{var f;((f=s.__accessor__)==null?void 0:f.lifecycle)===qc.DESTROYED||a&&a.uid!==l?r.remove():(a||(a=c3.acquireUntracked(h,o,d,s,n),l=a.uid),vU(a))});return Pi(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,vU(a)),a=null),r=c=null})});return r}function GGe(t,e,i){const r=_Se(t,e,i,(s,n,o)=>{let a=!1;return YSe(()=>ND(s,n),(l,c)=>{s.__accessor__.lifecycle!==qc.DESTROYED?a||(a=!0,Qte(c,l)||o.call(s,l,c,n,s),a=!1):r.remove()})});return r}function HGe(t,e,i,r=!1){return t.__accessor__&&t.__accessor__.lifecycle!==qc.DESTROYED?r?GGe(t,e,i):jGe(t,e,i):Pi()}function qGe(t,e,i){let r,s,n=JSe(t,(o,a)=>{r&&r.uid!==s?n.remove():(r||(r=c3.acquireTracked(o,e,a,i),s=r.uid),vU(r))});return Pi(()=>{n.remove(),r&&(r.uid!==s||r.removed||(r.removed=!0,vU(r)),r=null),n=null})}function WGe(t,e,i){let r=!1;return YSe(t,(s,n)=>{r||(r=!0,i(n,s)||e(s,n),r=!1)})}function ZGe(t,e,i=!1,r=aSe){return i?WGe(t,e,r):qGe(t,e,r)}function Zce(t){return qR(tv,e=>e.oldValue===t)}var tTe,iTe;function YGe(t){var e;if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return(e=t.constructor)!=null&&e.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const qf=Symbol("Accessor-Handles"),FW=Symbol("Accessor-Initialized");let he=class v4{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:i,declaredClass:r,constructor:s}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}FD(o.prototype);for(const a in e){const l=e[a];o.prototype[a]=typeof l=="function"?function(...c){const h=this.inherited;let d;this.inherited=function(...f){if(n.prototype[a])return n.prototype[a].apply(this,f)};try{d=l.apply(this,c)}catch(f){throw this.inherited=h,f}return this.inherited=h,d}:e[a]}for(const a in i){const l=YGe(i[a]);p(l)(o.prototype,a)}return A(r)(o)}static freeze(e){return e instanceof v4?e.__accessor__.mutable=!1:Object.freeze(e),e}static isFrozen(e){return e instanceof v4?!e.__accessor__.mutable:Object.isFrozen(e)}constructor(...e){var r;if(this[tTe]=null,this[iTe]=!1,this.constructor===v4)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const i=new aGe(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:i}),e.length>0&&(i.ctorArgs=((r=this.normalizeCtorArgs)==null?void 0:r.apply(this,e))??e[0])}postscript(){const e=this.__accessor__,i=e.ctorArgs;e.initialize(),i&&(this.set(i),e.ctorArgs=null),e.constructed(),this.initialize(),this[FW]=!0}initialize(){}[ESe](){this[qf]=$e(this[qf])}destroy(){var e;this.destroyed||(UGe(this),this.__accessor__.destroy(),(e=uGe())==null||e.onInstanceDestroy(this))}[Symbol.dispose](){this.destroy()}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[FW]}get destroyed(){var e;return((e=this.__accessor__)==null?void 0:e.lifecycle)===qc.DESTROYED||!1}commitProperty(e){Bm(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,i){return uU(this,e,i),this}watch(e,i,r){return Jje(J.getLogger(this),"`watch` is deprecated in favor of reactiveUtils.watch",{replacement:"reactiveUtils.watch",version:"4.32",see:"https://developers.arcgis.com/javascript/latest/api-reference/esri-core-reactiveUtils.html#watch",warnOnce:!0}),HGe(this,e,i,r)}addHandles(e,i){if(this.destroyed){const r=Array.isArray(e)?e:[e];for(const s of r)s.remove();return}(this[qf]??(this[qf]=new fg)).add(e,i)}removeHandles(e){var i;(i=this[qf])==null||i.remove(e)}removeAllHandles(){var e;(e=this[qf])==null||e.removeAll()}removeHandlesReference(e){var i;(i=this[qf])==null||i.removeReference(e)}hasHandles(e){var i;return((i=this[qf])==null?void 0:i.has(e))===!0}_override(e,i){i===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,i){i==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,i){return this.__accessor__.internalSet(e,i),this}};tTe=qf,iTe=FW;const rTe=t=>{let e=class extends t{clone(){var l;const i=Ml(this);Fj(i,"unable to clone instance of non-accessor class");const r=i.metadata,s=i.store,n={},o=new Map;for(const c in r){const h=r[c],d=s==null?void 0:s.originOf(c),f=h.clonable;if(h.readOnly||f===!1||d!==Oi.USER&&d!==Oi.DEFAULTS&&d!==Oi.WEB_MAP&&d!==Oi.WEB_SCENE)continue;const m=this[c];let g=null;g=typeof f=="function"?f(m):f==="reference"?m:bW(m),m!=null&&g==null||(d===Oi.DEFAULTS?o.set(c,g):n[c]=g)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){const c=(l=Ml(a))==null?void 0:l.store;if(c)for(const[h,d]of o)c.set(h,d,Oi.DEFAULTS)}return a}};return e=u([A("esri.core.Clonable")],e),e};let GO=class extends rTe(he){};GO=u([A("esri.core.Clonable")],GO),function(t){t.ClonableMixin=rTe}(GO||(GO={}));const Nt=GO;let o1=class extends Nt{constructor(e){super(e),this.row=0,this.column=0,this.rows=1,this.columns=1}equals(e){return e!=null&&this.row===e.row&&this.rows===e.rows&&this.column===e.column&&this.columns===e.columns}};u([p({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],o1.prototype,"row",void 0),u([p({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],o1.prototype,"column",void 0),u([p({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],o1.prototype,"rows",void 0),u([p({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],o1.prototype,"columns",void 0),o1=u([A("esri.CameraLayout")],o1);const sTe=o1,Yce=new Float32Array(1);function nTe(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function ue(t,e,i){return Math.min(Math.max(t,e),i)}function u3(t){return!(t&t-1)}function U8t(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function B8t(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function ft(t,e,i){return t+(e-t)*i}function V8t(t,e,i,r,s){return ft(r,s,(t-e)/(i-e))}function At(t){return t*Math.PI/180}function Ao(t){return 180*t/Math.PI}function j8t(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function Ja(t){return Math.acos(ue(t,-1,1))}function Md(t){return Math.asin(ue(t,-1,1))}function tu(t,e,i=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=i}function oTe(t,e,i=1e-6){return!tu(t,e,i)&&t>e}function kW(t,e,i=1e-6){return!tu(t,e,i)&&t<e}function JGe(t,e,i=1e-6){return tu(t,e,i)||t>e}const _U=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function zW(t){return _U.setFloat64(0,t),_U.getBigInt64(0)}function XGe(t){return _U.setBigInt64(0,t),_U.getFloat64(0)}const _4=BigInt("1000000"),KGe=aTe(1);function aTe(t){const e=zW(t=Math.abs(t)),i=XGe(e<=_4?_4:e-_4);return Math.abs(t-i)}function G8t(t,e,i=KGe){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;if(i!=null&&aTe(Math.min(Math.abs(t),Math.abs(e)))<i)return Math.abs(t-e)<=i;const r=zW(t),s=zW(e);return r<0!=s<0?!1:!((r<s?s-r:r-s)>_4)}function QGe(t,e,i=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const r=Math.abs(t-e),s=Math.abs(t),n=Math.abs(e);if(t===0||e===0||s<1e-12&&n<1e-12){if(r>.01*i)return!1}else if(r/(s+n)>i)return!1;return!0}function e6e(t){return lTe(Math.max(-UW,Math.min(t,UW)))}function lTe(t){return Yce[0]=t,Yce[0]}function h3(t,e,i){const r=ue((i-t)/(e-t),0,1);return r*r*(3-2*r)}function H8t(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],r=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(tu(e,1)&&tu(i,1)&&tu(r,1))}function t6e(t,e){return(t%e+e)%e}const UW=lTe(34028234663852886e22);function q8t(t,e,i){if(i===void 0||+i==0)return Math[t](e);if(e=+e,i=+i,isNaN(e)||typeof i!="number"||i%1!=0)return NaN;let r=e.toString().split("e");return r=(e=Math[t](+(r[0]+"e"+(r[1]?+r[1]-i:-i)))).toString().split("e"),+(r[0]+"e"+(r[1]?+r[1]+i:i))}let Ob=class{constructor(e,i){this.min=e,this.max=i,this.range=i-e}normalize(e,i=0,r=!1){return Jce(this.range,this.min,this.max,e,i,r)}clamp(e,i=0){return ue(e-i,this.min,this.max)+i}monotonic(e,i,r){return e<i?i:i+BW(this.range,e-i,r)}minimalMonotonic(e,i,r){return Jce(this.range,e,e+this.range,i,r)}center(e,i,r){return i=this.monotonic(e,i,r),this.normalize((e+i)/2,r)}diff(e,i,r){return this.monotonic(e,i,r)-e}shortestSignedDiff(e,i){e=this.normalize(e);const r=(i=this.normalize(i))-e,s=i<e?this.minimalMonotonic(e,i)-e:i-this.minimalMonotonic(i,e);return Math.abs(r)<Math.abs(s)?r:s}contains(e,i,r){return i=this.minimalMonotonic(e,i),(r=this.minimalMonotonic(e,r))>e&&r<i}};function Jce(t,e,i,r,s=0,n=!1){return(r-=s)<e?r+=BW(t,e-r):r>i&&(r-=BW(t,r-i)),n&&r===i&&(r=e),r+s}function BW(t,e,i=0){return Math.ceil((e-i)/t)*t+i}const i6e=new Ob(0,2*Math.PI),Ib=new Ob(-Math.PI,Math.PI),Bj=new Ob(0,360);let r6e=class cTe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new cTe;return this._values.forEach((r,s)=>{e&&e.has(s)||i.set(s,q(r.value),r.origin)}),i}get(e,i){i=this._normalizeOrigin(i);const r=this._values.get(e);return i==null||(r==null?void 0:r.origin)===i?r==null?void 0:r.value:void 0}originOf(e){var i;return((i=this._values.get(e))==null?void 0:i.origin)??Oi.USER}keys(e){e=this._normalizeOrigin(e);const i=[...this._values.keys()];return e==null?i:i.filter(r=>{var s;return((s=this._values.get(r))==null?void 0:s.origin)===e})}set(e,i,r){if((r=this._normalizeOrigin(r))===Oi.DEFAULTS){const s=this._values.get(e);if((s==null?void 0:s.origin)!=null&&s.origin>r)return}this._values.set(e,new s6e(i,r))}delete(e,i){var r;(i=this._normalizeOrigin(i))!=null&&((r=this._values.get(e))==null?void 0:r.origin)!==i||this._values.delete(e)}has(e,i){var r;return(i=this._normalizeOrigin(i))!=null?((r=this._values.get(e))==null?void 0:r.origin)===i:this._values.has(e)}forEach(e){this._values.forEach(({value:i},r)=>e(i,r))}_normalizeOrigin(e){if(e!=null)return e===Oi.DEFAULTS?e:Oi.USER}},s6e=class{constructor(e,i){this.value=e,this.origin=i}};function uTe(t,e,i){e.keys().forEach(s=>{i.set(s,e.get(s),Oi.DEFAULTS)});const r=t.metadata;Object.keys(r).forEach(s=>{t.internalGet(s)&&i.set(s,t.internalGet(s),Oi.DEFAULTS)})}function n6e(t,e,i){if(!(t!=null&&t.read)||t.read.enabled===!1||!t.read.source)return!1;const r=t.read.source;if(typeof r=="string"){if(r===e||r.includes(".")&&r.indexOf(e)===0&&Tce(r,i))return!0}else for(const s of r)if(s===e||s.includes(".")&&s.indexOf(e)===0&&Tce(s,i))return!0;return!1}function o6e(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function a6e(t,e,i,r,s){let n=CW(e[i],s);o6e(n)&&(t[i]=!0);for(const o of Object.getOwnPropertyNames(e))n=CW(e[o],s),n6e(n,i,r)&&(t[o]=!0)}function l6e(t,e,i,r){const s=i.metadata,n=zje(s[e],r),o=n==null?void 0:n.default;if(o===void 0)return;const a=typeof o=="function"?o.call(t,e,r):o;a!==void 0&&i.set(e,a)}const hTe={origin:"service"};function dTe(t,e,i=hTe){if(!e||typeof e!="object")return;const r=Ml(t),s=r.metadata,n={};for(const o of Object.getOwnPropertyNames(e))a6e(n,s,o,e,i);r.setDefaultOrigin(i.origin);for(const o of Object.getOwnPropertyNames(n)){const a=CW(s[o],i).read,l=a==null?void 0:a.source;let c;c=l&&typeof l=="string"?ND(e,l):e[o],a!=null&&a.reader&&(c=a.reader.call(t,c,e,i)),c!==void 0&&r.set(o,c)}if(!i||!i.ignoreDefaults){r.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||l6e(t,o,r,i)}r.setDefaultOrigin("user")}function uie(t,e,i,r=hTe){var n;const s={...r,messages:[]};i(s),(n=s.messages)==null||n.forEach(o=>{o.type!=="warning"||t.loaded?r!=null&&r.messages&&r.messages.push(o):t.loadWarnings.push(o)})}function c6e(t,e,i,r,s){var o,a;const n={};return(a=(o=e.write)==null?void 0:o.writer)==null||a.call(t,r,n,i,s),n}function pTe(t,e,i,r,s,n){if(!(r!=null&&r.write))return!1;const o=Bm(t,i);if(!s&&r.write.overridePolicy){const a=r.write.overridePolicy.call(t,o,i,n??void 0);a!==void 0&&(s=a)}if(s||(s=r.write),!s||s.enabled===!1||s.layerContainerTypes&&(n!=null&&n.layerContainerType)&&!s.layerContainerTypes.includes(n.layerContainerType))return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new U("web-document-write:property-required",`Missing value for required property '${i}' on '${t.declaredClass}'`,{propertyName:i,target:t});return a&&(n!=null&&n.messages)?n.messages.push(a):a&&!n&&J.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||!s.alwaysWriteDefaults&&(!e.store.multipleOriginsSupported||e.store.originOf(i)===Oi.DEFAULTS)&&u6e(t,i,n,r,o)||!s.ignoreOrigin&&(n!=null&&n.origin)&&e.store.multipleOriginsSupported&&e.store.originOf(i)<Q_(n.origin))}function u6e(t,e,i,r,s){const n=r.default;if(n===void 0)return!1;if(r.defaultEquals!=null)return r.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(t,e,i??void 0);return eg(o,s)}return!1}return n===s}function h6e(t,e,i,r){const s=Ml(t),n=s.metadata,o=NSe(n[e],r);return!!o&&pTe(t,s,e,o,i,r)}function fTe(t,e,i){var n,o;if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return f4(e,t.toJSON(i));const r=Ml(t),s=r.metadata;for(const a in s){const l=NSe(s[a],i);if(!pTe(t,r,a,l,void 0,i))continue;const c=Bm(t,a),h=c6e(t,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,i);Object.keys(h).length>0&&(e=f4(e,h),(o=(n=i==null?void 0:i.resources)==null?void 0:n.pendingOperations)!=null&&o.length&&i.resources.pendingOperations.push(Promise.all(i.resources.pendingOperations).then(()=>f4(e,h,()=>"replace-arrays"))),i!=null&&i.writtenProperties&&i.writtenProperties.push({target:t,propName:a,oldOrigin:nGe(r.store.originOf(a)),newOrigin:i.origin}))}return e}const mTe=t=>{let e=class extends t{constructor(...i){super(...i);const r=Ml(this),s=r.store,n=new r6e;r.store=n,uTe(r,s,n)}read(i,r){dTe(this,i,r)}write(i,r){return fTe(this,i??{},r)}toJSON(i){return this.write({},i)}static fromJSON(i,r){return d6e.call(this,i,r)}};return e=u([A("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function d6e(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(t,e),i}let HO=class extends mTe(he){};HO=u([A("esri.core.JSONSupport")],HO),function(t){function e(i){return i&&typeof i=="object"&&"toJSON"in i&&typeof i.toJSON=="function"}t.JSONSupportMixin=mTe,t.isSerializable=e}(HO||(HO={}));const ee=HO,p6e=Object.prototype.toString;function f6e(t){const e="__accessorMetadata__"in t?Ds(t):t;return function(...i){if(i.push(e),typeof i[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return m6e.apply(this,i)}}function m6e(t,e,i,r){Lj(t,e).cast=r}function g6e(t){return(e,i)=>{Lj(e,t).cast=e[i]}}function ti(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&p6e.call(t[0])==="[object Function]"?f6e(t[0]):t.length===1&&typeof t[0]=="string"?g6e(t[0]):void 0}function ve(t,e,i){let r,s;return e===void 0||Array.isArray(e)?(s=t,i=e,r=[void 0]):(s=e,r=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;r.forEach(l=>{const c=TSe(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],i&&(c.read.source=(c.read.source||[]).concat(i))})}}function _e(t,e,i){let r,s;return e===void 0?(s=t,r=[void 0]):typeof e!="string"?(s=t,r=[void 0],i=e):(s=e,r=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;for(const l of r){const c=TSe(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),i&&(c.write.target=i),c.write.writer=a[o]}}}let ni=class{constructor(e,i={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=i,this.apiValues=[],this.jsonValues=[],this._apiToJSON=y6e(e),this.apiValues=Xce(this._apiToJSON),this.jsonValues=Xce(this._jsonToAPI),this.read=r=>this.fromJSON(r),this.write=(r,s,n)=>{const o=this.toJSON(r);o!==void 0&&ro(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const i=this._apiToJSON[e];return this._options.useNumericKeys?+i:i}return this._options.ignoreUnknown?null:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}};function y6e(t){const e={};for(const i in t)e[t[i]]=i;return e}function Xce(t){const e=[];for(const i in t)e.push(i);return e.sort(),e}function Oo(){return function(t,e){return new ni(t,{ignoreUnknown:!0,...e})}}let hie=class{constructor(e,i,r,s,n,o){this.semiMajorAxis=e,this.flattening=i,this.outerAtmosphereRimWidth=r,this.atmosphereHeight=s,this.scaleHeight=n;const a=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*a,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=o||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const Ci=new hie(6378137,1/298.257223563,3e5,1e5,.085,.006694379990137799),nf=new hie(3396190,1/169.8944472236118,23e4,6e4,.111),gv=new hie(1737400,0,0,0,0),v6e=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,_6e={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function Kce(t){const e=t==null?void 0:t.match(v6e);if(!e)return null;const[,i,r,s]=e;if(!i)return null;let n=null,o=null,a=null;const{devext:l,qaext:c,www:h}=_6e;if(r)if(n=i,s)switch(s.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=h);else switch(i.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=h);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:n}}function b6e(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}function gTe(t){const e=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,i=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,r=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;return e.test(t)?t=t.replace(e,"https://www.arcgis.com"):i.test(t)?t=t.replace(i,"https://devext.arcgis.com"):r.test(t)&&(t=t.replace(r,"https://qaext.arcgis.com")),t}function yTe(t){const e=atob(t),i=new Uint8Array(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return i.buffer}function w6e(t){const e=new Uint8Array(t);let i="";for(let r=0;r<e.length;r++)i+=String.fromCharCode(e[r]);return btoa(i)}const x6e=()=>J.getLogger("esri.core.urlUtils"),JA=Rr.request,Qce="esri/config: esriConfig.request.proxyUrl is not set.",vTe=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,_Te=/^\s*http:/i,S6e=/^\s*https:/i,T6e=/^\s*file:/i,E6e=/:\d+$/,C6e=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,$6e=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),A6e=new RegExp("^((([^[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^[:]*))(:([0-9]+))?$");let bb=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let i=this.uri.match($6e);this.scheme=i[2]||(i[1]?"":null),this.authority=i[4]||(i[3]?"":null),this.path=i[5],this.query=i[7]||(i[6]?"":null),this.fragment=i[9]||(i[8]?"":null),this.authority!=null&&(i=this.authority.match(A6e),this.user=i[3]||null,this.password=i[4]||null,this.host=i[6]||i[7],this.port=i[9]||null)}toString(){return this.uri}};const oN={},M6e=new bb(Rr.applicationUrl);let Sl=M6e;const O6e=I6e();let die=O6e;const pie=()=>Sl,Q8t=()=>die;function I6e(){const t=Sl.path,e=t.slice(0,t.lastIndexOf("/")+1);return`${`${Sl.scheme}://${Sl.host}${Sl.port!=null?`:${Sl.port}`:""}`}${e}`}function yn(t){if(!t)return null;const e={path:null,query:null},i=new bb(t),r=t.indexOf("?");return i.query===null?e.path=t:(e.path=t.slice(0,r),e.query=fie(i.query)),i.fragment&&(e.hash=i.fragment,i.query===null&&(e.path=e.path.slice(0,e.path.length-(i.fragment.length+1)))),e}function fie(t){const e=t.split("&"),i={};for(const r of e){if(!r)continue;const s=r.indexOf("=");let n,o;s<0?(n=decodeURIComponent(r),o=""):(n=decodeURIComponent(r.slice(0,s)),o=decodeURIComponent(r.slice(s+1)));let a=i[n];typeof a=="string"&&(a=i[n]=[a]),Array.isArray(a)?a.push(o):i[n]=o}return i}function d3(t,e){return t?Object.keys(t).map(i=>{const r=t[i];if(r==null)return"";const s=encodeURIComponent(i)+"=",n=e==null?void 0:e[i];return n?s+encodeURIComponent(n(r)):Array.isArray(r)?r.map(o=>ee.isSerializable(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):ee.isSerializable(r)?s+encodeURIComponent(JSON.stringify(r)):s+encodeURIComponent(r)}).filter(i=>i).join("&"):""}function bTe(t=!1){let e,i=JA.proxyUrl;if(typeof t=="string"){e=CTe(t);const r=Vj(t);r&&(i=r.proxyUrl)}else e=!!t;if(!i)throw x6e().warn(Qce),new U("urlUtils:proxy-not-set",Qce);return e&&jW()&&(i=_ie(i)),yn(i)}function eqt(t,e=!1){const i=Vj(t);let r,s;if(i){const n=mie(i.proxyUrl);r=n.path,s=n.query?fie(n.query):null}else if(e){const n=bTe(t);r=n.path,s=n.query}if(r){const n=yn(t);t=r+"?"+n.path;const o=d3({...s,...n.query});o&&(t=`${t}?${o}`)}return t}const OM={path:"",query:""};function mie(t){const e=t.indexOf("?");return e!==-1?(OM.path=t.slice(0,e),OM.query=t.slice(e+1)):(OM.path=t,OM.query=null),OM}function wTe(t){return t=(t=wU(t=U6e(t=mie(t).path),!0)).toLowerCase()}function R6e(t){const e={proxyUrl:t.proxyUrl,urlPrefix:wTe(t.urlPrefix)},i=JA.proxyRules,r=e.urlPrefix;let s=i.length;for(let n=0;n<i.length;n++){const o=i[n].urlPrefix;if(r.indexOf(o)===0){if(r.length===o.length)return-1;s=n;break}o.indexOf(r)===0&&(s=n+1)}return i.splice(s,0,e),s}function Vj(t){const e=JA.proxyRules,i=wTe(t);for(let r=0;r<e.length;r++)if(i.indexOf(e[r].urlPrefix)===0)return e[r]}function xTe(t,e){if(!t||!e)return!1;t=bU(t),e=bU(e);const i=Kce(t),r=Kce(e);return i!=null&&r!=null?i.portalHostname===r.portalHostname:i==null&&r==null&&P$(t,e,!0)}function STe(t,e){return t=bU(t),e=bU(e),wU(t)===wU(e)}function bU(t){const e=(t=Ed(t)).indexOf("/sharing");return e>0?t.slice(0,e):t.replace(/\/+$/,"")}function VW(t,e=JA.interceptors){const i=r=>r==null||r instanceof RegExp&&r.test(t)||typeof r=="string"&&t.startsWith(r);if(e){for(const r of e)if(Array.isArray(r.urls)){if(r.urls.some(i))return r}else if(i(r.urls))return r}return null}function P$(t,e,i=!1){if(!t||!e)return!1;const r=HW(t),s=HW(e);return!(!i&&r.scheme!==s.scheme)&&r.host!=null&&s.host!=null&&r.host.toLowerCase()===s.host.toLowerCase()&&r.port===s.port}function gie(t){if(typeof t=="string"){if(!rh(t))return!0;t=HW(t)}if(P$(t,Sl))return!0;const e=JA.trustedServers||[];for(let i=0;i<e.length;i++){const r=P6e(e[i]);for(let s=0;s<r.length;s++)if(P$(t,r[s]))return!0}return!1}function P6e(t){return oN[t]||(vie(t)||ig(t)?oN[t]=[new bb(Jc(t))]:oN[t]=[new bb(`http://${t}`),new bb(`https://${t}`)]),oN[t]}function Jc(t,e=die,i){return ig(t)?i!=null&&i.preserveProtocolRelative?t:Sl.scheme==="http"&&Sl.authority===ih(t).slice(2)?`http:${t}`:`https:${t}`:vie(t)?t:Od(t[0]==="/"?k6e(e):e,t)}function yie(t,e=die,i){if(t==null||!rh(t))return t;const r=Ed(t),s=r.toLowerCase(),n=Ed(e).toLowerCase().replace(/\/+$/,""),o=i?Ed(i).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return t;const a=(d,f,m)=>(m=d.indexOf(f,m))===-1?d.length:m;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return t;t=r.slice(c);const h=n.slice(c-1).replaceAll(/[^/]+/g,"").length;if(h>0)for(let d=0;d<h;d++)t=`../${t}`;else t=`./${t}`;return t}function Ed(t){return t=j6e(t=V6e(t=B6e(t=Jc(t=t.trim()))))}function Od(...t){const e=t.filter(df);if(!(e!=null&&e.length))return;const i=[];if(rh(e[0])){const s=e[0],n=s.indexOf("//");n!==-1&&(i.push(s.slice(0,n+1)),N6e(e[0])&&(i[0]+="/"),e[0]=s.slice(n+2))}else e[0][0]==="/"&&i.push("");const r=e.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<r.length;s++){const n=r[s];n===".."&&i.length>0&&i[i.length-1]!==".."?i.pop():(!n&&s===r.length-1||n&&(n!=="."||i.length===0))&&i.push(n)}return i.join("/")}function ih(t,e=!1){if(t==null||D$(t)||$f(t))return null;let i=t.indexOf("://");if(i===-1&&ig(t))i=2;else{if(i===-1)return null;i+=3}const r=t.indexOf("/",i);return r!==-1&&(t=t.slice(0,r)),e&&(t=wU(t,!0)),t}function rh(t){return ig(t)||vie(t)}function D$(t){return t!=null&&t.slice(0,5)==="blob:"}function $f(t){return t!=null&&t.slice(0,5)==="data:"}function TTe(t){const e=pS(t);return e!=null&&e.isBase64?yTe(e.data):null}function tqt(t){return w6e(t).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const D6e=/^data:(.*?)(;base64)?,(.*)$/;function pS(t){const e=t.match(D6e);if(!e)return null;const[,i,r,s]=e;return{mediaType:i,isBase64:!!r,data:s}}function ETe(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}async function iqt(t){return(await fetch(t)).blob()}function rqt(t){const e=TTe(t);if(!e)return null;const i=pS(t);return new Blob([e],{type:i.mediaType})}function ig(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function vie(t){return t!=null&&vTe.test(t)}function CTe(t){return t!=null&&S6e.test(t)||Sl.scheme==="https"&&ig(t)}function L6e(t){return t!=null&&_Te.test(t)||Sl.scheme==="http"&&ig(t)}function N6e(t){return t!=null&&T6e.test(t)}function _ie(t){return ig(t)?`https:${t}`:t.replace(_Te,"https:")}function F6e(){return Sl.scheme==="http"}function jW(){return Sl.scheme==="https"}function wU(t,e=!1){return ig(t)?t.slice(2):(t=t.replace(vTe,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function k6e(t){const e=t.indexOf("//"),i=t.indexOf("/",e+2);return i===-1?t:t.slice(0,i)}function z6e(t){let e=0;if(rh(t)){const r=t.indexOf("//");r!==-1&&(e=r+2)}const i=t.lastIndexOf("/");return i<e?t:t.slice(0,i+1)}function sqt(t,e){if(!t)return"";const i=yn(t).path.replace(/\/+$/,""),r=i.slice(i.lastIndexOf("/")+1);if(!(e!=null&&e.length))return r;const s=new RegExp(`\\.(${e.join("|")})$`,"i");return r.replace(s,"")}function U6e(t){return t.endsWith("/")?t:`${t}/`}function $Te(t){return t.replace(/\/+$/,"")}function B6e(t){if(/^https?:\/\//i.test(t)){const e=mie(t);t=(t=e.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function V6e(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function j6e(t){const e=JA.httpsDomains;if(!L6e(t))return t;const i=t.indexOf("/",7);let r;if(r=i===-1?t:t.slice(0,i),r=r.toLowerCase().slice(7),E6e.test(r)){if(!r.endsWith(":80"))return t;r=r.slice(0,-3),t=t.replace(":80","")}return F6e()&&r===Sl.authority&&!C6e.test(t)||(jW()&&r===Sl.authority||e&&e.some(s=>r===s||r.endsWith(`.${s}`))||jW()&&!Vj(t))&&(t=_ie(t)),t}function GW(t,e,i){if(!(e&&i&&t&&rh(t)))return t;const r=t.indexOf("//"),s=t.indexOf("/",r+2),n=t.indexOf(":",r+2),o=Math.min(s<0?t.length:s,n<0?t.length:n);return t.slice(r+2,o).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,r+2)}${i}${t.slice(o)}`}function HW(t){return typeof t=="string"?new bb(Jc(t)):(t.scheme||(t.scheme=Sl.scheme),t)}function ATe(t){return H6e.test(t)}function MTe(t,e){const i=yn(t),r=Object.keys(i.query||{});return r.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function bie(t,e,i){const r=yn(t),s=r.query||{};return s[e]=String(i),`${r.path}?${d3(s)}`}function PH(t,e){if(!e)return t;const i=yn(t),r=i.query||{};for(const[n,o]of Object.entries(e))o!=null&&(r[n]=o);const s=d3(r);return s?`${i.path}?${s}`:i.path}function G6e(t){if(t==null)return null;const e=t.match(OTe);return e?e[2]:null}function eue(t){if(t==null)return null;const e=t.match(OTe);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}async function nqt(t){return typeof t=="string"?pS(t)??{data:t}:new Promise((e,i)=>{const r=new FileReader;r.readAsDataURL(t),r.onload=()=>e(pS(r.result)),r.onerror=s=>i(s)})}const OTe=/([^.]*)\.([^/]*)$/,H6e=/(^data:image\/svg|\.svg$)/i,ITe="20250407",RTe="04d2b42da93678ca718b23aaf7e216985f10fa8e";Symbol.dispose??(Symbol.dispose=Symbol("Symbol.dispose")),Symbol.asyncDispose??(Symbol.asyncDispose=Symbol("Symbol.asyncDispose"));const wie="4.32";let hi,xie=wie;xie="4.32.10";function oqt(t){hi=t}function aqt(t){const e=hi==null?void 0:hi.findCredential(t);return e!=null&&e.token?bie(t,"token",e.token):t}X("host-webworker")||globalThis.$arcgis||Object.defineProperty(globalThis,"$arcgis",{configurable:!1,enumerable:!0,writable:!1,value:{}}),X("host-webworker");function XA(t,e){var r;const i=(r=e==null?void 0:e.url)==null?void 0:r.path;if(t&&i&&(t=Jc(t,i,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const s=yie(t,e.portalItem.itemUrl);s!=null&&q6e.test(s)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(s).path)}return(t=qW(t,e==null?void 0:e.portal))&&jj.test(t)?Tie(t):t}function BD(t,e,i=p3.YES){var s,n;if((t=t&&jj.test(t)?DTe(t):t)==null)return t;!rh(t)&&(e!=null&&e.blockedRelativeUrls)&&e.blockedRelativeUrls.push(t);let r=Jc(t);if(e){const o=((s=e.verifyItemRelativeUrls)==null?void 0:s.rootPath)||((n=e.url)==null?void 0:n.path);if(o){const a=qW(o,e.portal),l=qW(r,e.portal);r=yie(l,a,a),r!=null&&r!==l&&r!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=PTe(r,e==null?void 0:e.portal),rh(r)&&(r=Ed(r)),e!=null&&e.resources&&(e!=null&&e.portalItem)&&!rh(r)&&!$f(r)&&i===p3.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(r),compress:!1}),r}function Sie(t,e,i){return XA(t,i)}function fS(t,e,i,r){const s=BD(t,r);s!==void 0&&(e[i]=s)}const jj=/\/items\/([^/]+)\/resources\/(.*)/,q6e=/^\.\/resources\//;function W6e(t){const e=(t==null?void 0:t.match(jj))??null;return(e==null?void 0:e[1])??null}function Z6e(t){const e=(t==null?void 0:t.match(jj))??null;if(e==null)return null;const i=e[2],r=i.lastIndexOf("/");if(r===-1){const{path:o,extension:a}=eue(i);return{prefix:null,filename:o,extension:a}}const{path:s,extension:n}=eue(i.slice(r+1));return{prefix:i.slice(0,r),filename:s,extension:n}}function PTe(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?GW(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function qW(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const i=`${e.urlKey}.${e.customBaseUrl}`,r=pie();return P$(r,`${r.scheme}://${i}`)?GW(t,e.portalHostname,i):GW(t,i,e.portalHostname)}function Tie(t){if(!t)return t||null;let e=t;return e&&hi&&!hi.findCredential(e)&&(e=gTe(e),e=e.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),e=e.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),e=e.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),e}function DTe(t){if(!t)return t||null;let e=t;return e=e.replace(/^https?:\/\/cdn\.arcgis\.com/,"https://www.arcgis.com"),e=e.replace(/^https?:\/\/cdndev\.arcgis\.com/,"https://devext.arcgis.com"),e=e.replace(/^https?:\/\/cdnqa\.arcgis\.com/,"https://qaext.arcgis.com"),e&&hi&&!hi.findCredential(e)&&(e=gTe(e)),e}var p3;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(p3||(p3={}));const lqt=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return p3},ensureMainOnlineDomain:PTe,fromCDNUrl:DTe,fromJSON:XA,itemIdFromResourceUrl:W6e,prefixAndFilenameFromResourceUrl:Z6e,read:Sie,toCDNUrl:Tie,toJSON:BD,write:fS},Symbol.toStringTag,{value:"Module"})),LTe={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",knowledgegraphserver:"KnowledgeGraphServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer","3dtilesserver":"3DTilesServer",videoserver:"VideoServer"},NTe=Object.values(LTe),FTe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${NTe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),Y6e=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^/\\n]+)\\/(${NTe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),J6e=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function cqt(t){return FTe.test(t)}function Rb(t){if(t==null)return null;const e=yn(t),i=(e==null?void 0:e.path.match(FTe))||(e==null?void 0:e.path.match(Y6e));if(!i)return null;const[,r,s,n,o]=i,a=s.indexOf("/");return{title:Eie(a!==-1?s.slice(a+1):s),serverType:LTe[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:r}}}function X6e(t){const e=yn(t).path.match(J6e);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function Eie(t){return(t=t.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function K6e(t,e){const i=[];if(t){const r=Rb(t);r!=null&&r.title&&i.push(r.title)}if(e){const r=Eie(e);i.push(r)}if(i.length===2){if(i[0].toLowerCase().includes(i[1].toLowerCase()))return i[0];if(i[1].toLowerCase().includes(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function xU(t){let e=ih(t,!0);return!!e&&(e=e.toLowerCase(),e.endsWith(".arcgis.com")&&(e.startsWith("services")||e.startsWith("tiles")||e.startsWith("features")))}function Q6e(t,e){return t&&$Te(MTe(t,e))}function eHe(t){let{url:e}=t;if(!e)return{url:e};e=MTe(e,t.logger);const i=yn(e),r=Rb(i.path);let s;if(r!=null)r.sublayer!=null&&t.layer.layerId==null&&(s=r.sublayer),e=r.url.path;else if(t.nonStandardUrlAllowed){const n=X6e(i.path);n!=null&&(e=n.serviceUrl,s=n.sublayerId)}return{url:$Te(e),layerId:s}}function tHe(t,e,i,r,s){fS(e,r,"url",s),r.url&&t.layerId!=null&&(r.url=Od(r.url,i,t.layerId.toString()))}function uqt(t){if(!t)return!1;const e=t.toLowerCase(),i=e.includes("/services/"),r=e.includes("/mapserver/wmsserver"),s=e.includes("/imageserver/wmsserver"),n=e.includes("/wmsserver");return i&&(r||s||n)}function iHe(t){var r;if(!t)return!1;const e=new bb(Jc(t)),i=(r=e.authority)==null?void 0:r.toLowerCase();return i==="server.arcgisonline.com"||i==="services.arcgisonline.com"}const rHe=new Set(["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"]);function sHe(t){const e=ih(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!rHe.has(e)&&!t.endsWith("/sharing/rest/generateToken")}function kTe(t,e){return!(!Rr.apiKey||!sHe(t))}function zTe(t,e,i=!1,r){return new Promise((s,n)=>{if(Sa(r))return void n(tue());let o=()=>{c(),n(new Error(`Unable to load ${e}`))},a=()=>{const h=t;c(),s(h)},l=()=>{if(!t)return;const h=t;c(),h.src="",n(tue())};const c=()=>{X("esri-image-decode")||(t.removeEventListener("error",o),t.removeEventListener("load",a)),o=null,a=null,t=null,r!=null&&r.removeEventListener("abort",l),l=null,i&&URL.revokeObjectURL(e)};r!=null&&r.addEventListener("abort",l),X("esri-image-decode")?t.decode().then(a,o):(t.addEventListener("error",o),t.addEventListener("load",a))})}function tue(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}const UTe="Timeout exceeded";function nHe(){return new Error(UTe)}function hqt(t){return typeof t=="object"&&!!t&&"message"in t&&t.message===UTe}function oHe(t){Rr.request.crossOriginNoCorsDomains||(Rr.request.crossOriginNoCorsDomains={});const e=Rr.request.crossOriginNoCorsDomains;for(let i of t)i=i.toLowerCase(),/^https?:\/\//.test(i)?e[ih(i)??""]=0:(e[ih("http://"+i)??""]=0,e[ih("https://"+i)??""]=0)}function aHe(t){const e=Rr.request.crossOriginNoCorsDomains;if(e){let i=ih(t);if(i)return i=i.toLowerCase(),!P$(i,pie())&&e[i]<Date.now()-36e5}return!1}async function lHe(t){var s;const e=yn(t);t=e.path,((s=e.query)==null?void 0:s.f)==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}const i=Rr.request.crossOriginNoCorsDomains,r=ih(t);i&&r&&(i[r.toLowerCase()]=Date.now())}async function Ri(t,e){var m;t instanceof URL&&(t=t.toString()),(e==null?void 0:e.query)instanceof URLSearchParams&&(e.query=fie(e.query.toString().replaceAll("+"," ")));const i=$f(t),r=D$(t);r||i||(t=Ed(t));const s={url:t,requestOptions:{...e}},n=g=>({data:g,getAllHeaders:L$,getHeader:L$,httpStatus:200,requestOptions:s.requestOptions,url:s.url}),o=VW(t,Xh.internalInterceptors);if(o){const g=await rue(o,s);if(g!=null)return n(g)}let a=VW(t);if(a){const g=await rue(a,s);if(g!=null)return n(g);a.after||a.error||(a=null)}if(t=s.url,(e=s.requestOptions).responseType==="image"&&(X("host-webworker")||X("host-node")))throw of("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s);if(e.method==="head"){if(e.body)throw of("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(i||r)throw of("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await pHe(),SU)return SU.execute(t,e);const l=new AbortController,c=Qo(e,()=>l.abort()),h={controller:l,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:a,params:s,redoRequest:!1,useIdentity:Xh.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},d=e.useRequestQueue?vHe(h):ZW(h),f=await d.finally(()=>c==null?void 0:c.remove());return(m=a==null?void 0:a.after)==null||m.call(a,f),f}let SU;const Xh=Rr.request,BTe="FormData"in globalThis,cHe=new Set([499,498,403,401]),uHe=new Set(["COM_0056","COM_0057","SB_0008"]),hHe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],L$=()=>null,TU=Symbol();function dHe(t){const e=ih(t);e&&!Ri._corsServers.includes(e)&&Ri._corsServers.push(e)}function iue(t){const e=ih(t);return!e||e.endsWith(".arcgis.com")||Ri._corsServers.includes(e)||gie(e)}function of(t,e,i,r){let s="Error";const n={url:i.url,requestOptions:i.requestOptions,getAllHeaders:L$,getHeader:L$,ssl:!1};if(e instanceof U)return e.details?(e.details=q(e.details),e.details.url=i.url,e.details.requestOptions=i.requestOptions):e.details=n,e;if(e){const o=r&&(()=>Array.from(r.headers)),a=r&&(h=>r.headers.get(h)),l=r==null?void 0:r.status,c=e.message;c&&(s=c),o&&a&&(n.getAllHeaders=o,n.getHeader=a),n.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||l||0,n.subCode=e.subcode,n.messageCode=e.messageCode,typeof e.details=="string"?n.messages=[e.details]:n.messages=e.details,n.raw=TU in e?e[TU]:e}return es(e)?bi():new U(t,s,n)}async function pHe(){X("host-webworker")&&!SU&&(SU=await G(()=>import("./request-CjP9Ks9s.js"),[]))}async function WW(){hi||await G(()=>import("./IdentityManager-Dv2b6ouA.js"),__vite__mapDeps([0,1]))}async function fHe(t){var a;const e=t.params.url,i=t.params.requestOptions,r=t.controller.signal,s=i.body;let n=null,o=null;if(BTe&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(o=s),t.fetchOptions={cache:i.cacheBust?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},method:i.method==="head"?"HEAD":"GET",mode:"cors",priority:Xh.priority,redirect:"follow",signal:r},(n||o)&&(t.fetchOptions.body=n||o),i.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||(a=i.query)!=null&&a.token||n!=null&&n.get("token")),!t.hasToken&&kTe(e)&&(i.query||(i.query={}),i.query.token=Rr.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!VTe(e)&&!Sa(r)){let l;i.authMode==="immediate"?(await WW(),l=await hi.getCredential(e,{signal:r}),t.credential=l):i.authMode==="no-prompt"?(await WW(),l=await hi.getCredential(e,{prompt:!1,signal:r}).catch(()=>{}),t.credential=l):hi&&(l=hi.findCredential(e)),l&&(t.credentialToken=l.token,t.useSSL=!!l.ssl)}}function VTe(t){return hHe.some(e=>e.test(t))}async function mHe(t){let e=t.params.url;const i=t.params.requestOptions,r=t.fetchOptions??{},s=D$(e)||$f(e),n=i.responseType||"json",o=s?0:i.timeout!=null?i.timeout:Xh.timeout;let a=!1;if(!s){t.useSSL&&(e=_ie(e));let f={...i.query};t.credentialToken&&(f.token=t.credentialToken);let m=d3(f);X("esri-url-encodes-apostrophe")&&(m=m.replaceAll("'","%27"));const g=e.length+1+m.length;let v;a=i.method==="delete"||i.method==="post"||i.method==="put"||!!i.body||g>Xh.maxUrlLength;const _=i.useProxy||!!Vj(e);if(_){const b=bTe(e);v=b.path,!a&&v.length+1+g>Xh.maxUrlLength&&(a=!0),b.query&&(f={...b.query,...f})}if(r.method==="HEAD"&&(a||_)){if(a)throw g>Xh.maxUrlLength?of("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):of("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(_)throw of("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}if(a?(r.method=i.method==="delete"?"DELETE":i.method==="put"?"PUT":"POST",i.body?e=PH(e,f):(r.body=d3(f),r.headers||(r.headers={}),r.headers["Content-Type"]="application/x-www-form-urlencoded")):e=PH(e,f),_&&(t.useProxy=!0,e=`${v}?${e}`),f.token&&BTe&&r.body instanceof FormData&&!b6e(e)&&r.body.set("token",f.token),i.hasOwnProperty("withCredentials"))t.withCredentials=i.withCredentials;else if(!P$(e,pie())){if(gie(e))t.withCredentials=!0;else if(hi){const b=hi.findServerInfo(e);b!=null&&b.webTierAuth&&(t.withCredentials=!0)}}t.withCredentials&&(r.credentials="include",aHe(e)&&await lHe(a?PH(e,f):e))}let l,c,h=0,d=!1;o>0&&(h=setTimeout(()=>{d=!0,t.controller.abort()},o));try{if(i.responseType==="native-request-init")c=r,c.url=e,i.signal?c.signal=i.signal:delete c.signal;else if(i.responseType!=="image"||r.cache!=="default"||r.method!=="GET"||a||gHe(i.headers)||!s&&!t.useProxy&&Xh.proxyUrl&&!iue(e)){if(Ri._beforeFetch&&await Ri._beforeFetch(e,r),l=await fetch(e,r),Ri._afterFetch&&await Ri._afterFetch(l),t.useProxy||dHe(e),i.responseType==="native")c=l;else if(r.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(h&&(clearTimeout(h),h=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=sue(c,"application/xml");break;case"document":c=sue(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const f=l.headers.get("Content-Type");if(f&&/application\/json|text\/plain/i.test(f)&&c[n==="blob"?"size":"byteLength"]<=750)try{const m=await new Response(c).json();m.error&&(c=m)}catch{}}n==="image"&&c instanceof Blob&&(c=await nue(URL.createObjectURL(c),t,!0))}}else{c=await l.text();try{c=JSON.parse(c)}catch{}}}else c=await nue(e,t)}catch(f){if(f.name==="AbortError")throw d?nHe():bi("Request canceled");if(!(!l&&f instanceof TypeError&&Xh.proxyUrl)||i.body||i.method==="delete"||i.method==="head"||i.method==="post"||i.method==="put"||t.useProxy||iue(e))throw f;t.redoRequest=!0,R6e({proxyUrl:Xh.proxyUrl,urlPrefix:ih(e)??""})}finally{h&&clearTimeout(h)}return[l,c]}async function rue(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let i,r;try{r=await t.before(e)}catch(s){i=of("request:interceptor",s,e)}if((r instanceof Error||r instanceof U)&&(i=of("request:interceptor",r,e)),i)throw t.error&&t.error(i),i;return r}}function gHe(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function sue(t,e){let i;try{i=new DOMParser().parseFromString(t,e)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}Ri._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"],Ri._beforeFetch=void 0,Ri._afterFetch=void 0;const yHe=new Map;async function vHe(t){const e=bHe(t.params.url);if(!e)return ZW(t);const{QueueProcessor:i}=await G(()=>import("./QueueProcessor-w0BYbTZ1.js"),[]);return tw(yHe,e.origin,()=>{const s=e.isHosted?X("request-queue-concurrency-hosted"):X("request-queue-concurrency-non-hosted");return new i({concurrency:s,process:n=>{if(Sa(n.params.requestOptions))throw of("",bi("Request canceled"),n.params);return ZW(n)}})}).push(t)}async function ZW(t){var n,o;let e,i;await fHe(t);try{do[e,i]=await mHe(t);while(!await _He(t,e,i))}catch(a){const l=of("request:server",a,t.params,e);throw l.details.ssl=t.useSSL,(n=t.interceptor)!=null&&n.error&&t.interceptor.error(l),l}const r=t.params.url;if(i&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(r)){if(!t.hasToken&&!t.credentialToken&&((o=i.user)!=null&&o.username)&&!gie(r)){const a=ih(r,!0);a&&Xh.trustedServers.push(a)}Array.isArray(i.authorizedCrossOriginNoCorsDomains)&&oHe(i.authorizedCrossOriginNoCorsDomains)}const s=t.credential;if(s&&hi){const a=hi.findServerInfo(s.server);let l=a==null?void 0:a.owningSystemUrl;if(l){l=l.replace(/\/?$/,"/sharing");const c=hi.findCredential(l,s.userId);c&&hi._getIdenticalSvcIdx(l,c)===-1&&c.resources.unshift(l)}}return{data:i,getAllHeaders:e?()=>Array.from(e.headers):L$,getHeader:e?a=>e.headers.get(a):L$,httpStatus:(e==null?void 0:e.status)??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function _He(t,e,i){var c;if(t.redoRequest)return t.redoRequest=!1,!1;const r=t.params.requestOptions;if(!e||r.responseType==="native"||r.responseType==="native-request-init")return!0;let s,n;if(i&&(i.error&&typeof i.error=="object"?s=i.error:i.status==="error"&&Array.isArray(i.messages)&&(s={...i},s[TU]=i,s.details=i.messages)),!s&&!e.ok)throw s=new Error(`Unable to load ${e.url} status: ${e.status}`),s[TU]=i,s;let o,a=null;s&&(n=Number(s.code),a=s.hasOwnProperty("subcode")?Number(s.subcode):null,o=s.messageCode,o=o==null?void 0:o.toUpperCase());const l=r.authMode;if(n===403&&(a===4||(c=s.message)!=null&&c.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||n===498)&&n!==void 0&&cHe.has(n)&&!VTe(t.params.url)&&(n!==403||(!o||!uHe.has(o))&&(a==null||a===2&&t.credentialToken))){await WW();try{const h=await hi.getCredential(t.params.url,{error:of("request:server",s,t.params),prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=h,t.credentialToken=h.token,t.useSSL=t.useSSL||h.ssl,!1}catch(h){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;s=h}}if(s)throw s;return!0}function nue(t,e,i=!1){const r=e.controller.signal,s=new Image;return e.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=Xh.priority,s.src=t,zTe(s,t,i,r)}function bHe(t){let e,i;return typeof t=="string"?(e=ih(t,!0),i=xU(t)):(e=t.origin,i=xU(t.toString())),e==null?null:{origin:e,isHosted:i}}function wHe(t,e){return Ri(vs(t),e)}function vs(t){if(!Rr.assetsPath)throw J.getLogger("esri.assets").errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new U("assets:path-not-set","config.assetsPath is not set");return Od(Rr.assetsPath,t)}let DH,Z=null;function Cie(){return!!Z}function xHe(){return!!X("esri-wasm")}function jTe(){return DH||(DH=G(()=>import("./pe-wasm-Co3DzcyP.js"),__vite__mapDeps([2,3])).then(t=>t.p).then(({default:t})=>t({locateFile:e=>vs(`esri/geometry/support/${e}`)})).then(t=>{qTe(t)}),DH)}var YW,qs;(function(t){function e(n,o,a){Z.ensureCache.prepare();const l=hx(a),c=a===l,h=Z.ensureFloat64(l),d=Z._pe_geog_to_proj(Z.getPointer(n),o,h);return d&&U_(a,o,h,c),d}function i(n,o,a,l){switch(l){case qs.PE_TRANSFORM_P_TO_G:return r(n,o,a);case qs.PE_TRANSFORM_G_TO_P:return e(n,o,a)}return 0}function r(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){Z.ensureCache.prepare();const c=hx(a),h=a===c,d=Z.ensureFloat64(c),f=Z._pe_proj_to_geog_center(Z.getPointer(n),o,d,l);return f&&U_(a,o,d,h),f}t.geogToProj=e,t.projGeog=i,t.projToGeog=r,t.projToGeogCenter=s})(YW||(YW={})),function(t){function e(){t.PE_BUFFER_MAX=Z.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=Z.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=Z.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=Z.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=Z.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=Z.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=Z.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=Z.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=Z.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=Z.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=Z.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=Z.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=Z.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=Z.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=Z.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=Z.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=Z.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=Z.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=Z.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=Z.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_STR_FMT_WKT=Z.PeDefs.prototype.PE_STR_FMT_WKT,t.PE_STR_FMT_WKT2=Z.PeDefs.prototype.PE_STR_FMT_WKT2,t.PE_PARM_X0=Z.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=Z.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=Z.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=Z.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=Z.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=Z.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=Z.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=Z.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=Z.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=Z.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}(qs||(qs={}));let GTe=null;var JW;(function(t){const e={},i={},r=m=>{const g=m.getType();switch(g){case qs.PE_TYPE_GEOGCS:m=Z.castObject(m,Z.PeGeogcs);break;case qs.PE_TYPE_PROJCS:m=Z.castObject(m,Z.PeProjcs);break;case qs.PE_TYPE_GEOGTRAN:m=Z.castObject(m,Z.PeGeogtran);break;default:g&qs.PE_TYPE_UNIT&&(m=Z.castObject(m,Z.PeUnit))}return m};function s(){Z.PeFactory.prototype.initialize(null)}function n(m){return o(qs.PE_TYPE_COORDSYS,m)}function o(m,g){let v=null,_=e[m];if(_||(_={},e[m]=_),_.hasOwnProperty(String(g))&&(v=_[g],Z.compare(v,Z.NULL)&&(v=null)),!v){const b=Z.PeFactory.prototype.factoryByType(m,g);Z.compare(b,Z.NULL)||(v=r(b),_[g]=v)}return v}function a(m,g){let v=null,_=i[m];if(_||(_={},i[m]=_),_.hasOwnProperty(g)&&(v=_[g],Z.compare(v,Z.NULL)&&(v=null)),!v){const b=Z.PeFactory.prototype.fromString(m,g);Z.compare(b,Z.NULL)||(v=r(b),_[g]=v)}return v}function l(m){return o(qs.PE_TYPE_GEOGCS,m)}function c(m){return o(qs.PE_TYPE_GEOGTRAN,m)}function h(m){return Z.PeFactory.prototype.getCode(m)}function d(m){return o(qs.PE_TYPE_PROJCS,m)}function f(m){return o(qs.PE_TYPE_UNIT,m)}t.initialize=s,t.coordsys=n,t.factoryByType=o,t.fromString=a,t.geogcs=l,t.geogtran=c,t.getCode=h,t.projcs=d,t.unit=f})(JW||(JW={}));let HTe=null;var EU,XW,KW,QW,eZ,tZ,CU,iZ,$U,AU,rZ;function qTe(t){function e(n,o,a){n[o]=a(n[o])}Z=t,qs.init(),EU.init(),CU.init(),$U.init(),AU.init(),GTe=class extends Z.PeDouble{constructor(n=NaN){super(n)}destroy(){Z.destroy(this)}[Symbol.dispose](){this.destroy()}},HTe=class extends Z.PeGCSExtent{destroy(){Z.destroy(this)}[Symbol.dispose](){this.destroy()}};const i=[Z.PeAngunit,Z.PeDatum,Z.PeGeogcs,Z.PeGeogtran,Z.PeObject,Z.PeParameter,Z.PePrimem,Z.PeProjcs,Z.PeSpheroid,Z.PeUnit];for(const n of i)e(n.prototype,"getName",o=>function(){return o.call(this,new Array(qs.PE_NAME_MAX))});for(const n of[Z.PeGeogtran,Z.PeProjcs])e(n.prototype,"getParameters",o=>function(){const a=new Array(qs.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const h=Z.getValue(l,"*");a[c]=h?Z.wrapPointer(h,Z.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});e(Z.PeHorizon.prototype,"getCoord",n=>function(o=!1){const a=this.getSize();if(!a)return null;const l=[];return U_(l,a,n.call(this),o),l}),e(Z.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=Z._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!Z.compare(l,Z.NULL)){a=[l];const c=this.getSteps();if(c>1){const h=Z.getPointer(l);for(let d=1;d<c;d++)a.push(Z.wrapPointer(h+o*d,Z.PeGTlistExtendedGTs))}}return a}});const r=Z._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!Z.compare(l,Z.NULL)){a=[l];const c=l.getNump();if(c>1){const h=Z.getPointer(l);for(let d=1;d<c;d++)a.push(Z.wrapPointer(h+r*d,Z.PeHorizon))}}return o.set(n,a),a};e(Z.PeProjcs.prototype,"horizonGcsGenerate",s),e(Z.PeProjcs.prototype,"horizonPcsGenerate",s),Z.PeObject.prototype.toString=function(n=qs.PE_STR_OPTS_NONE){Z.ensureCache.prepare();const o=Z.getPointer(this),a=Z.ensureInt8(new Array(qs.PE_BUFFER_MAX));return Z.UTF8ToString(Z._pe_object_to_string_ext(o,n,a))},Z.PeGeogcs.prototype.destroy=function(){this.Delete(),Op(this),this.ptr=0},Z.PeGeogcs.prototype[Symbol.dispose]=function(){this.destroy()},Z.PeProjcs.prototype.destroy=function(){this.Delete(),Op(this),this.ptr=0},Z.PeProjcs.prototype[Symbol.dispose]=function(){this.destroy()}}function Op(t){if(!t)return;const e=Z.getClass(t);if(!e)return;const i=Z.getCache(e);if(!i)return;const r=Z.getPointer(t);r&&delete i[r]}function aN(t,e){const i=[],r=new Array(e);for(let s=0;s<t;s++)i.push(Z.ensureInt8(r));return i}function hx(t){return ArrayBuffer.isView(t)?t:Array.isArray(t[0])?t.flat():t}function U_(t,e,i,r=!1){if(r)for(let s=0;s<2*e;s++)t[s]=Z.getValue(i+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=t.length===0;for(let n=0;n<e;n++)s&&(t[n]=new Array(2)),t[n][0]=Z.getValue(i,"double"),t[n][1]=Z.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function i(){t.PE_GTLIST_OPTS_COMMON=Z.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=Z._pe_getPeGTlistExtendedEntrySize()}function r(s,n,o,a,l,c){let h=null;const d=new Z.PeInteger(c);try{const f=Z.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,d);if((c=d.val)&&(h=[f],c>1)){const m=Z.getPointer(f);for(let g=1;g<c;g++)h.push(Z.wrapPointer(m+e*g,Z.PeGTlistExtendedEntry))}}finally{Z.destroy(d)}return h}t.init=i,t.getGTlist=r})(EU||(EU={})),function(t){function e(i){if(i!=null&&i.length){for(const r of i)Op(r),r.getEntries().forEach(s=>{Op(s);const n=s.getGeogtran();Op(n),n.getParameters().forEach(Op),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{Op(o);const a=o.getDatum();Op(a),Op(a.getSpheroid()),Op(o.getPrimem()),Op(o.getUnit())})});Z.PeGTlistExtendedEntry.prototype.Delete(i[0])}}t.destroy=e}(XW||(XW={})),function(t){function e(i,r,s,n,o){Z.ensureCache.prepare();const a=hx(s),l=s===a,c=Z.ensureFloat64(a);let h=0;n&&(h=Z.ensureFloat64(n));const d=Z._pe_geog_to_geog(Z.getPointer(i),r,c,h,o);return d&&U_(s,r,c,l),d}t.geogToGeog=e}(KW||(KW={})),function(t){function e(n,o,a,l,c,h,d,f){Z.PeLineType.prototype.geodesic_coordinate(n,o,a,l,c,h,d,f)}function i(n,o,a,l,c,h,d,f,m){Z.PeLineType.prototype.geodetic_coordinate(n,o,a,l,c,h,d,f,m)}function r(n,o,a,l,c,h,d,f,m,g){Z.PeLineType.prototype.geodetic_distance(n,o,a,l,c,h,d,f,m,g)}function s(n,o,a,l,c,h,d,f,m){Z.PeLineType.prototype.great_elliptic_distance(n,o,a,l,c,h,d,f,m)}t.geodesicCoordinate=e,t.geodeticCoordinate=i,t.geodeticDistance=r,t.greatEllipticDistance=s}(QW||(QW={})),function(t){function e(o,a){return Z.PeMath.prototype.phi_to_eta(o,a)}function i(o,a){return Z.PeMath.prototype.eta_to_phi(o,a)}function r(o,a){return Z.PeMath.prototype.phi_to_phig(o,a)}function s(o,a,l){return Z.PeMath.prototype.q(o,a,l)}function n(o,a){return Z.PeMath.prototype.q90(o,a)}t.phiToEta=e,t.etaToPhi=i,t.phiToPhig=r,t.q=s,t.q90=n}(eZ||(eZ={})),function(t){const e=(c,h,d,f,m,g)=>{let v,_;switch(Z.ensureCache.prepare(),c){case"dd":v=Z._pe_geog_to_dd,_=qs.PE_DD_MAX;break;case"ddm":v=Z._pe_geog_to_ddm,_=qs.PE_DDM_MAX;break;case"dms":v=Z._pe_geog_to_dms,_=qs.PE_DMS_MAX}let b=0;h&&(b=Z.getPointer(h));const w=hx(f),x=Z.ensureFloat64(w),S=aN(d,_),C=v(b,d,x,m,Z.ensureInt32(S));if(C)for(let T=0;T<d;T++)g[T]=Z.UTF8ToString(S[T]);return C},i=(c,h,d,f,m)=>{let g;switch(Z.ensureCache.prepare(),c){case"dd":g=Z._pe_dd_to_geog;break;case"ddm":g=Z._pe_ddm_to_geog;break;case"dms":g=Z._pe_dms_to_geog}let v=0;h&&(v=Z.getPointer(h));const _=f.map(S=>Z.ensureString(S)),b=Z.ensureInt32(_),w=Z.ensureFloat64(new Array(2*d)),x=g(v,d,b,w);return x&&U_(m,d,w),x};function r(c,h,d,f,m){return e("dms",c,h,d,f,m)}function s(c,h,d,f){return i("dms",c,h,d,f)}function n(c,h,d,f,m){return e("ddm",c,h,d,f,m)}function o(c,h,d,f){return i("ddm",c,h,d,f)}function a(c,h,d,f,m){return e("dd",c,h,d,f,m)}function l(c,h,d,f){return i("dd",c,h,d,f)}t.geogToDms=r,t.dmsToGeog=s,t.geogToDdm=n,t.ddmToGeog=o,t.geogToDd=a,t.ddToGeog=l}(tZ||(tZ={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=Z.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=Z.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=Z.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=Z.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=Z.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function i(s,n,o,a,l,c,h){Z.ensureCache.prepare();let d=0;s&&(d=Z.getPointer(s));const f=hx(o),m=Z.ensureFloat64(f),g=aN(n,qs.PE_MGRS_MAX),v=Z.ensureInt32(g),_=Z._pe_geog_to_mgrs_extended(d,n,m,a,l,c,v);if(_)for(let b=0;b<n;b++)h[b]=Z.UTF8ToString(g[b]);return _}function r(s,n,o,a,l){Z.ensureCache.prepare();let c=0;s&&(c=Z.getPointer(s));const h=o.map(g=>Z.ensureString(g)),d=Z.ensureInt32(h),f=Z.ensureFloat64(new Array(2*n)),m=Z._pe_mgrs_to_geog_extended(c,n,d,a,f);return m&&U_(l,n,f),m}t.init=e,t.geogToMgrsExtended=i,t.mgrsToGeogExtended=r}(CU||(CU={})),function(t){function e(r,s,n,o,a,l,c){Z.ensureCache.prepare();let h=0;r&&(h=Z.getPointer(r));const d=hx(n),f=Z.ensureFloat64(d),m=aN(s,qs.PE_MGRS_MAX),g=Z.ensureInt32(m),v=Z._pe_geog_to_usng(h,s,f,o,a,l,g);if(v)for(let _=0;_<s;_++)c[_]=Z.UTF8ToString(m[_]);return v}function i(r,s,n,o){Z.ensureCache.prepare();let a=0;r&&(a=Z.getPointer(r));const l=n.map(f=>Z.ensureString(f)),c=Z.ensureInt32(l),h=Z.ensureFloat64(new Array(2*s)),d=Z._pe_usng_to_geog(a,s,c,h);return d&&U_(o,s,h),d}t.geogToUsng=e,t.usngToGeog=i}(iZ||(iZ={})),function(t){function e(){t.PE_UTM_OPTS_NONE=Z.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=Z.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=Z.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function i(s,n,o,a,l){Z.ensureCache.prepare();let c=0;s&&(c=Z.getPointer(s));const h=hx(o),d=Z.ensureFloat64(h),f=aN(n,qs.PE_UTM_MAX),m=Z.ensureInt32(f),g=Z._pe_geog_to_utm(c,n,d,a,m);if(g)for(let v=0;v<n;v++)l[v]=Z.UTF8ToString(f[v]);return g}function r(s,n,o,a,l){Z.ensureCache.prepare();let c=0;s&&(c=Z.getPointer(s));const h=o.map(g=>Z.ensureString(g)),d=Z.ensureInt32(h),f=Z.ensureFloat64(new Array(2*n)),m=Z._pe_utm_to_geog(c,n,d,a,f);return m&&U_(l,n,f),m}t.init=e,t.geogToUtm=i,t.utmToGeog=r}($U||($U={})),function(t){const e=new Map;function i(){t.PE_PCSINFO_OPTION_NONE=Z.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=Z.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=Z.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=Z.PePCSInfo.prototype.PE_POLE_POINT}function r(s,n=t.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return e.has(s)&&(a=e.get(s),a[n]&&(o=a[n])),o||(o=Z.PePCSInfo.prototype.generate(s,n),a||(a=[],e.set(s,a)),a[n]=o),o}t.init=i,t.generate=r}(AU||(AU={})),function(t){function e(){return Z.PeVersion.prototype.version_string()}t.versionString=e}(rZ||(rZ={}));const SHe=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return YW},get PeDefs(){return qs},get PeDouble(){return GTe},get PeFactory(){return JW},get PeGCSExtent(){return HTe},get PeGTTransformations(){return KW},get PeGTlistExtended(){return EU},get PeGTlistExtendedEntry(){return XW},get PeLineType(){return QW},get PeMath(){return eZ},get PeNotationDms(){return tZ},get PeNotationMgrs(){return CU},get PeNotationUsng(){return iZ},get PeNotationUtm(){return $U},get PePCSInfo(){return AU},get PeVersion(){return rZ},_init:qTe,get _pe(){return Z},isLoaded:Cie,isSupported:xHe,load:jTe},Symbol.toStringTag,{value:"Module"}));var Xc;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})(Xc||(Xc={}));let y;const O={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9895:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,10160:0,10183:0,10188:0,10194:0,10199:0,10207:0,10212:0,10217:0,10222:0,10227:0,10235:0,10240:0,10250:0,10254:0,10270:0,10275:0,10280:0,10306:0,10329:0,10471:0,10477:0,10481:2,10516:2,10592:0,10594:0,10596:0,10598:0,10601:0,10603:0,10626:0,10632:0,10665:0,20002:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2,103897:1,103978:2,103979:0,103980:2,103981:0};for(y=2e3;y<=2045;y++)O[y]=0;for(y=2056;y<=2065;y++)O[y]=0;for(y=2067;y<=2135;y++)O[y]=0;for(y=2137;y<=2154;y++)O[y]=0;for(y=2161;y<=2170;y++)O[y]=0;for(y=2172;y<=2193;y++)O[y]=0;for(y=2195;y<=2198;y++)O[y]=0;for(y=2200;y<=2203;y++)O[y]=0;for(y=2205;y<=2217;y++)O[y]=0;for(y=2222;y<=2224;y++)O[y]=1;for(y=2225;y<=2250;y++)O[y]=2;for(y=2251;y<=2253;y++)O[y]=1;for(y=2257;y<=2264;y++)O[y]=2;for(y=2274;y<=2279;y++)O[y]=2;for(y=2280;y<=2282;y++)O[y]=1;for(y=2283;y<=2289;y++)O[y]=2;for(y=2290;y<=2292;y++)O[y]=0;for(y=2308;y<=2313;y++)O[y]=0;for(y=2315;y<=2491;y++)O[y]=0;for(y=2494;y<=2866;y++)O[y]=0;for(y=2867;y<=2869;y++)O[y]=1;for(y=2870;y<=2888;y++)O[y]=2;for(y=2891;y<=2895;y++)O[y]=2;for(y=2896;y<=2898;y++)O[y]=1;for(y=2902;y<=2908;y++)O[y]=2;for(y=2915;y<=2920;y++)O[y]=2;for(y=2921;y<=2923;y++)O[y]=1;for(y=2924;y<=2930;y++)O[y]=2;for(y=2931;y<=2962;y++)O[y]=0;for(y=2964;y<=2968;y++)O[y]=2;for(y=2969;y<=2973;y++)O[y]=0;for(y=2975;y<=2991;y++)O[y]=0;for(y=2995;y<=3051;y++)O[y]=0;for(y=3054;y<=3079;y++)O[y]=0;for(y=3081;y<=3088;y++)O[y]=0;for(y=3092;y<=3101;y++)O[y]=0;for(y=3106;y<=3138;y++)O[y]=0;for(y=3146;y<=3151;y++)O[y]=0;for(y=3153;y<=3166;y++)O[y]=0;for(y=3168;y<=3172;y++)O[y]=0;for(y=3174;y<=3203;y++)O[y]=0;for(y=3294;y<=3358;y++)O[y]=0;for(y=3367;y<=3403;y++)O[y]=0;for(y=3408;y<=3416;y++)O[y]=0;for(y=3417;y<=3438;y++)O[y]=2;for(y=3441;y<=3446;y++)O[y]=2;for(y=3447;y<=3450;y++)O[y]=0;for(y=3451;y<=3459;y++)O[y]=2;for(y=3460;y<=3478;y++)O[y]=0;for(y=3554;y<=3559;y++)O[y]=0;for(y=3560;y<=3570;y++)O[y]=2;for(y=3571;y<=3581;y++)O[y]=0;for(y=3594;y<=3597;y++)O[y]=0;for(y=3601;y<=3604;y++)O[y]=0;for(y=3637;y<=3639;y++)O[y]=0;for(y=3665;y<=3667;y++)O[y]=0;for(y=3693;y<=3695;y++)O[y]=0;for(y=3701;y<=3727;y++)O[y]=0;for(y=3728;y<=3739;y++)O[y]=2;for(y=3740;y<=3751;y++)O[y]=0;for(y=3753;y<=3760;y++)O[y]=2;for(y=3761;y<=3773;y++)O[y]=0;for(y=3775;y<=3777;y++)O[y]=0;for(y=3779;y<=3781;y++)O[y]=0;for(y=3783;y<=3785;y++)O[y]=0;for(y=3788;y<=3791;y++)O[y]=0;for(y=3797;y<=3802;y++)O[y]=0;for(y=3814;y<=3816;y++)O[y]=0;for(y=3825;y<=3829;y++)O[y]=0;for(y=3832;y<=3841;y++)O[y]=0;for(y=3844;y<=3852;y++)O[y]=0;for(y=3873;y<=3885;y++)O[y]=0;for(y=3890;y<=3893;y++)O[y]=0;for(y=3907;y<=3912;y++)O[y]=0;for(y=3942;y<=3950;y++)O[y]=0;for(y=3968;y<=3970;y++)O[y]=0;for(y=3973;y<=3976;y++)O[y]=0;for(y=3986;y<=3989;y++)O[y]=0;for(y=3994;y<=3997;y++)O[y]=0;for(y=4048;y<=4051;y++)O[y]=0;for(y=4056;y<=4063;y++)O[y]=0;for(y=4093;y<=4096;y++)O[y]=0;for(y=4390;y<=4398;y++)O[y]=0;for(y=4399;y<=4413;y++)O[y]=2;for(y=4418;y<=4433;y++)O[y]=2;for(y=4455;y<=4457;y++)O[y]=2;for(y=4484;y<=4489;y++)O[y]=0;for(y=4491;y<=4554;y++)O[y]=0;for(y=4568;y<=4589;y++)O[y]=0;for(y=4652;y<=4656;y++)O[y]=0;for(y=4766;y<=4800;y++)O[y]=0;for(y=5014;y<=5016;y++)O[y]=0;for(y=5069;y<=5072;y++)O[y]=0;for(y=5105;y<=5130;y++)O[y]=0;for(y=5167;y<=5188;y++)O[y]=0;for(y=5253;y<=5259;y++)O[y]=0;for(y=5269;y<=5275;y++)O[y]=0;for(y=5292;y<=5311;y++)O[y]=0;for(y=5329;y<=5331;y++)O[y]=0;for(y=5343;y<=5349;y++)O[y]=0;for(y=5355;y<=5357;y++)O[y]=0;for(y=5387;y<=5389;y++)O[y]=0;for(y=5459;y<=5463;y++)O[y]=0;for(y=5479;y<=5482;y++)O[y]=0;for(y=5518;y<=5520;y++)O[y]=0;for(y=5530;y<=5539;y++)O[y]=0;for(y=5550;y<=5552;y++)O[y]=0;for(y=5562;y<=5583;y++)O[y]=0;for(y=5623;y<=5625;y++)O[y]=2;for(y=5631;y<=5639;y++)O[y]=0;for(y=5649;y<=5653;y++)O[y]=0;for(y=5663;y<=5680;y++)O[y]=0;for(y=5682;y<=5685;y++)O[y]=0;for(y=5875;y<=5877;y++)O[y]=0;for(y=5896;y<=5899;y++)O[y]=0;for(y=5921;y<=5940;y++)O[y]=0;for(y=6050;y<=6125;y++)O[y]=0;for(y=6244;y<=6275;y++)O[y]=0;for(y=6328;y<=6348;y++)O[y]=0;for(y=6350;y<=6356;y++)O[y]=0;for(y=6366;y<=6372;y++)O[y]=0;for(y=6381;y<=6387;y++)O[y]=0;for(y=6393;y<=6404;y++)O[y]=0;for(y=6480;y<=6483;y++)O[y]=0;for(y=6511;y<=6514;y++)O[y]=0;for(y=6579;y<=6581;y++)O[y]=0;for(y=6619;y<=6624;y++)O[y]=0;for(y=6625;y<=6627;y++)O[y]=2;for(y=6628;y<=6632;y++)O[y]=0;for(y=6634;y<=6637;y++)O[y]=0;for(y=6669;y<=6692;y++)O[y]=0;for(y=6707;y<=6709;y++)O[y]=0;for(y=6720;y<=6723;y++)O[y]=0;for(y=6732;y<=6738;y++)O[y]=0;for(y=6931;y<=6933;y++)O[y]=0;for(y=6956;y<=6959;y++)O[y]=0;for(y=7005;y<=7007;y++)O[y]=0;for(y=7057;y<=7070;y++)O[y]=2;for(y=7074;y<=7082;y++)O[y]=0;for(y=7109;y<=7118;y++)O[y]=0;for(y=7119;y<=7127;y++)O[y]=1;for(y=7374;y<=7376;y++)O[y]=0;for(y=7528;y<=7586;y++)O[y]=0;for(y=7587;y<=7645;y++)O[y]=2;for(y=7692;y<=7696;y++)O[y]=0;for(y=7755;y<=7787;y++)O[y]=0;for(y=7791;y<=7795;y++)O[y]=0;for(y=7799;y<=7801;y++)O[y]=0;for(y=7803;y<=7805;y++)O[y]=0;for(y=7825;y<=7831;y++)O[y]=0;for(y=7845;y<=7859;y++)O[y]=0;for(y=8013;y<=8032;y++)O[y]=0;for(y=8065;y<=8068;y++)O[y]=1;for(y=8518;y<=8529;y++)O[y]=2;for(y=8533;y<=8536;y++)O[y]=2;for(y=8538;y<=8540;y++)O[y]=2;for(y=8677;y<=8679;y++)O[y]=0;for(y=8836;y<=8840;y++)O[y]=0;for(y=8857;y<=8859;y++)O[y]=0;for(y=8908;y<=8910;y++)O[y]=0;for(y=9154;y<=9159;y++)O[y]=0;for(y=9205;y<=9218;y++)O[y]=0;for(y=9271;y<=9273;y++)O[y]=0;for(y=9295;y<=9297;y++)O[y]=0;for(y=9356;y<=9360;y++)O[y]=0;for(y=9404;y<=9407;y++)O[y]=0;for(y=9476;y<=9482;y++)O[y]=0;for(y=9487;y<=9494;y++)O[y]=0;for(y=9697;y<=9699;y++)O[y]=0;for(y=9821;y<=9865;y++)O[y]=0;for(y=10285;y<=10291;y++)O[y]=0;for(y=10314;y<=10317;y++)O[y]=0;for(y=10448;y<=10465;y++)O[y]=0;for(y=10731;y<=10733;y++)O[y]=0;for(y=11114;y<=11118;y++)O[y]=0;for(y=20004;y<=20032;y++)O[y]=0;for(y=20047;y<=20049;y++)O[y]=0;for(y=20062;y<=20092;y++)O[y]=0;for(y=20135;y<=20138;y++)O[y]=0;for(y=20248;y<=20258;y++)O[y]=0;for(y=20348;y<=20358;y++)O[y]=0;for(y=20436;y<=20440;y++)O[y]=0;for(y=20822;y<=20824;y++)O[y]=0;for(y=20904;y<=20932;y++)O[y]=0;for(y=20934;y<=20936;y++)O[y]=0;for(y=21004;y<=21032;y++)O[y]=0;for(y=21035;y<=21037;y++)O[y]=0;for(y=21095;y<=21097;y++)O[y]=0;for(y=21148;y<=21150;y++)O[y]=0;for(y=21207;y<=21264;y++)O[y]=0;for(y=21307;y<=21364;y++)O[y]=0;for(y=21413;y<=21423;y++)O[y]=0;for(y=21453;y<=21463;y++)O[y]=0;for(y=21473;y<=21483;y++)O[y]=0;for(y=21780;y<=21782;y++)O[y]=0;for(y=21891;y<=21894;y++)O[y]=0;for(y=21896;y<=21899;y++)O[y]=0;for(y=22171;y<=22177;y++)O[y]=0;for(y=22181;y<=22187;y++)O[y]=0;for(y=22191;y<=22197;y++)O[y]=0;for(y=22207;y<=22222;y++)O[y]=0;for(y=22229;y<=22232;y++)O[y]=0;for(y=22234;y<=22236;y++)O[y]=0;for(y=22243;y<=22250;y++)O[y]=0;for(y=22262;y<=22265;y++)O[y]=0;for(y=22307;y<=22322;y++)O[y]=0;for(y=22348;y<=22357;y++)O[y]=0;for(y=22407;y<=22422;y++)O[y]=0;for(y=22462;y<=22465;y++)O[y]=0;for(y=22521;y<=22525;y++)O[y]=0;for(y=22607;y<=22622;y++)O[y]=0;for(y=22641;y<=22646;y++)O[y]=0;for(y=22648;y<=22657;y++)O[y]=0;for(y=22707;y<=22722;y++)O[y]=0;for(y=22762;y<=22765;y++)O[y]=0;for(y=22807;y<=22822;y++)O[y]=0;for(y=22991;y<=22994;y++)O[y]=0;for(y=23028;y<=23038;y++)O[y]=0;for(y=23301;y<=23333;y++)O[y]=2;for(y=23830;y<=23853;y++)O[y]=0;for(y=23866;y<=23872;y++)O[y]=0;for(y=23877;y<=23884;y++)O[y]=0;for(y=23886;y<=23894;y++)O[y]=0;for(y=23946;y<=23948;y++)O[y]=0;for(y=24311;y<=24313;y++)O[y]=0;for(y=24342;y<=24347;y++)O[y]=0;for(y=24370;y<=24374;y++)O[y]=10;for(y=24375;y<=24381;y++)O[y]=0;for(y=24718;y<=24721;y++)O[y]=0;for(y=24817;y<=24821;y++)O[y]=0;for(y=24877;y<=24882;y++)O[y]=0;for(y=24891;y<=24893;y++)O[y]=0;for(y=25391;y<=25395;y++)O[y]=0;for(y=25828;y<=25838;y++)O[y]=0;for(y=26191;y<=26195;y++)O[y]=0;for(y=26391;y<=26393;y++)O[y]=0;for(y=26701;y<=26722;y++)O[y]=0;for(y=26729;y<=26799;y++)O[y]=2;for(y=26801;y<=26803;y++)O[y]=2;for(y=26811;y<=26813;y++)O[y]=2;for(y=26847;y<=26870;y++)O[y]=2;for(y=26891;y<=26899;y++)O[y]=0;for(y=26901;y<=26923;y++)O[y]=0;for(y=26929;y<=26946;y++)O[y]=0;for(y=26948;y<=26998;y++)O[y]=0;for(y=27037;y<=27040;y++)O[y]=0;for(y=27205;y<=27232;y++)O[y]=0;for(y=27258;y<=27260;y++)O[y]=0;for(y=27391;y<=27398;y++)O[y]=0;for(y=27561;y<=27564;y++)O[y]=0;for(y=27571;y<=27574;y++)O[y]=0;for(y=27581;y<=27584;y++)O[y]=0;for(y=27591;y<=27594;y++)O[y]=0;for(y=27700;y<=27707;y++)O[y]=0;for(y=28191;y<=28193;y++)O[y]=0;for(y=28348;y<=28358;y++)O[y]=0;for(y=28402;y<=28432;y++)O[y]=0;for(y=28462;y<=28492;y++)O[y]=0;for(y=29118;y<=29122;y++)O[y]=0;for(y=29168;y<=29172;y++)O[y]=0;for(y=29177;y<=29185;y++)O[y]=0;for(y=29187;y<=29195;y++)O[y]=0;for(y=29900;y<=29903;y++)O[y]=0;for(y=30161;y<=30179;y++)O[y]=0;for(y=30491;y<=30494;y++)O[y]=0;for(y=30729;y<=30732;y++)O[y]=0;for(y=31251;y<=31259;y++)O[y]=0;for(y=31265;y<=31268;y++)O[y]=0;for(y=31275;y<=31279;y++)O[y]=0;for(y=31281;y<=31297;y++)O[y]=0;for(y=31461;y<=31469;y++)O[y]=0;for(y=31491;y<=31495;y++)O[y]=0;for(y=31917;y<=31922;y++)O[y]=0;for(y=31965;y<=32e3;y++)O[y]=0;for(y=32001;y<=32003;y++)O[y]=2;for(y=32005;y<=32031;y++)O[y]=2;for(y=32033;y<=32060;y++)O[y]=2;for(y=32064;y<=32067;y++)O[y]=2;for(y=32074;y<=32077;y++)O[y]=2;for(y=32081;y<=32086;y++)O[y]=0;for(y=32107;y<=32130;y++)O[y]=0;for(y=32133;y<=32159;y++)O[y]=0;for(y=32164;y<=32167;y++)O[y]=2;for(y=32180;y<=32199;y++)O[y]=0;for(y=32201;y<=32260;y++)O[y]=0;for(y=32301;y<=32360;y++)O[y]=0;for(y=32401;y<=32460;y++)O[y]=0;for(y=32501;y<=32560;y++)O[y]=0;for(y=32601;y<=32662;y++)O[y]=0;for(y=32664;y<=32667;y++)O[y]=2;for(y=32701;y<=32761;y++)O[y]=0;for(y=53001;y<=53004;y++)O[y]=0;for(y=53008;y<=53019;y++)O[y]=0;for(y=53021;y<=53032;y++)O[y]=0;for(y=53034;y<=53037;y++)O[y]=0;for(y=53042;y<=53046;y++)O[y]=0;for(y=53074;y<=53080;y++)O[y]=0;for(y=54001;y<=54004;y++)O[y]=0;for(y=54008;y<=54019;y++)O[y]=0;for(y=54021;y<=54032;y++)O[y]=0;for(y=54034;y<=54037;y++)O[y]=0;for(y=54042;y<=54046;y++)O[y]=0;for(y=54048;y<=54053;y++)O[y]=0;for(y=54074;y<=54080;y++)O[y]=0;for(y=54098;y<=54101;y++)O[y]=0;for(y=102001;y<=102040;y++)O[y]=0;for(y=102042;y<=102063;y++)O[y]=0;for(y=102065;y<=102067;y++)O[y]=0;for(y=102070;y<=102117;y++)O[y]=0;for(y=102122;y<=102216;y++)O[y]=0;for(y=102221;y<=102377;y++)O[y]=0;for(y=102382;y<=102388;y++)O[y]=0;for(y=102389;y<=102398;y++)O[y]=2;for(y=102399;y<=102444;y++)O[y]=0;for(y=102445;y<=102447;y++)O[y]=2;for(y=102448;y<=102458;y++)O[y]=0;for(y=102459;y<=102468;y++)O[y]=2;for(y=102469;y<=102499;y++)O[y]=0;for(y=102500;y<=102519;y++)O[y]=1;for(y=102520;y<=102524;y++)O[y]=0;for(y=102525;y<=102529;y++)O[y]=2;for(y=102530;y<=102588;y++)O[y]=0;for(y=102590;y<=102598;y++)O[y]=0;for(y=102601;y<=102603;y++)O[y]=0;for(y=102605;y<=102628;y++)O[y]=0;for(y=102629;y<=102646;y++)O[y]=2;for(y=102648;y<=102700;y++)O[y]=2;for(y=102701;y<=102703;y++)O[y]=0;for(y=102707;y<=102730;y++)O[y]=2;for(y=102733;y<=102758;y++)O[y]=2;for(y=102767;y<=102900;y++)O[y]=0;for(y=102901;y<=102933;y++)O[y]=2;for(y=102934;y<=102950;y++)O[y]=13;for(y=102951;y<=102963;y++)O[y]=0;for(y=102965;y<=102969;y++)O[y]=0;for(y=102971;y<=102973;y++)O[y]=0;for(y=102975;y<=102989;y++)O[y]=0;for(y=102990;y<=102992;y++)O[y]=1;for(y=102997;y<=103002;y++)O[y]=0;for(y=103003;y<=103008;y++)O[y]=2;for(y=103009;y<=103011;y++)O[y]=0;for(y=103012;y<=103014;y++)O[y]=2;for(y=103019;y<=103021;y++)O[y]=0;for(y=103022;y<=103024;y++)O[y]=2;for(y=103029;y<=103031;y++)O[y]=0;for(y=103032;y<=103034;y++)O[y]=2;for(y=103065;y<=103068;y++)O[y]=0;for(y=103074;y<=103076;y++)O[y]=0;for(y=103077;y<=103079;y++)O[y]=1;for(y=103080;y<=103082;y++)O[y]=0;for(y=103083;y<=103085;y++)O[y]=2;for(y=103090;y<=103093;y++)O[y]=0;for(y=103097;y<=103099;y++)O[y]=0;for(y=103100;y<=103102;y++)O[y]=2;for(y=103107;y<=103109;y++)O[y]=0;for(y=103110;y<=103112;y++)O[y]=2;for(y=103113;y<=103116;y++)O[y]=0;for(y=103117;y<=103120;y++)O[y]=2;for(y=103153;y<=103157;y++)O[y]=0;for(y=103158;y<=103162;y++)O[y]=2;for(y=103163;y<=103165;y++)O[y]=0;for(y=103166;y<=103168;y++)O[y]=1;for(y=103169;y<=103171;y++)O[y]=2;for(y=103186;y<=103188;y++)O[y]=0;for(y=103189;y<=103191;y++)O[y]=2;for(y=103192;y<=103195;y++)O[y]=0;for(y=103196;y<=103199;y++)O[y]=2;for(y=103200;y<=103224;y++)O[y]=0;for(y=103225;y<=103227;y++)O[y]=1;for(y=103232;y<=103237;y++)O[y]=0;for(y=103238;y<=103243;y++)O[y]=2;for(y=103244;y<=103246;y++)O[y]=0;for(y=103247;y<=103249;y++)O[y]=2;for(y=103254;y<=103256;y++)O[y]=0;for(y=103257;y<=103259;y++)O[y]=2;for(y=103264;y<=103266;y++)O[y]=0;for(y=103267;y<=103269;y++)O[y]=2;for(y=103300;y<=103375;y++)O[y]=0;for(y=103381;y<=103383;y++)O[y]=0;for(y=103384;y<=103386;y++)O[y]=1;for(y=103387;y<=103389;y++)O[y]=0;for(y=103390;y<=103392;y++)O[y]=2;for(y=103397;y<=103399;y++)O[y]=0;for(y=103400;y<=103471;y++)O[y]=2;for(y=103476;y<=103478;y++)O[y]=0;for(y=103479;y<=103481;y++)O[y]=2;for(y=103486;y<=103488;y++)O[y]=0;for(y=103489;y<=103491;y++)O[y]=2;for(y=103492;y<=103495;y++)O[y]=0;for(y=103496;y<=103499;y++)O[y]=2;for(y=103528;y<=103543;y++)O[y]=0;for(y=103544;y<=103548;y++)O[y]=2;for(y=103549;y<=103551;y++)O[y]=0;for(y=103552;y<=103554;y++)O[y]=1;for(y=103555;y<=103557;y++)O[y]=2;for(y=103558;y<=103560;y++)O[y]=0;for(y=103571;y<=103573;y++)O[y]=0;for(y=103574;y<=103576;y++)O[y]=2;for(y=103577;y<=103580;y++)O[y]=0;for(y=103581;y<=103583;y++)O[y]=2;for(y=103595;y<=103694;y++)O[y]=0;for(y=103696;y<=103699;y++)O[y]=0;for(y=103700;y<=103793;y++)O[y]=2;for(y=103794;y<=103890;y++)O[y]=0;for(y=103891;y<=103896;y++)O[y]=2;for(y=103900;y<=103971;y++)O[y]=2;for(y=103972;y<=103977;y++)O[y]=0;for(y=112e3;y<=112101;y++)O[y]=0;const WTe=[102100,102113,3857,3785,900913],THe=[104905,104971],EHe=[4326,...WTe,...THe],f3=[-20037508342788905e-9,20037508342788905e-9],sZ=[-20037508342787e-6,20037508342787e-6],LH={wkTemplate:'PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',valid:f3,origin:sZ,dx:1e-5},ZTe={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:f3,origin:sZ,dx:1e-5},102100:LH,3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:f3,origin:sZ,dx:1e-5},3857:LH,4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},900913:LH};function as(t,e){if(t===e)return!0;if(t==null||e==null)return!1;const i=t.wkid,r=e.wkid;if(i!=null||r!=null){if(i===r||rg(t)&&rg(e))return!0;const o=t.latestWkid;if(o!=null&&r===o)return!0;const a=e.latestWkid;return a!=null&&i===a}let s,n;return t.wkt2&&e.wkt2?(s=t.wkt2,n=e.wkt2):t.wkt&&e.wkt&&(s=t.wkt,n=e.wkt),!(!s||!n)&&s.toUpperCase()===n.toUpperCase()}function hc(t){const e=t==null?void 0:t.wkid;return e!=null&&e>=2e3&&ZTe[e]||null}function MU(t){if(!t)return;const{wkid:e,vcsWkid:i}=t;if(e)return i?JSON.stringify({wkid:e,vcsWkid:i}):String(e);const r=t.wkt||t.wkt2;return JSON.stringify(r?i?{wkt:r,vcsWkid:i}:{wkt:r}:{})}function HS(t){if(!Xu(t))return!1;const{wkid:e}=t;if(e)return O[e]==null;const i=t.wkt2||t.wkt;return!!i&&/^\s*(?:GEOGCS|GEOGCRS|GEOGRAPHICCRS)/i.test(i)}function Gj(t){return!(KA(t)||QA(t))}function Pb(t){return(t==null?void 0:t.wkid)===4326}function dqt(t){return/^\s*(?:GEOD|GEODETIC|GEOG|GEOGRAPHIC|PROJ|PROJECTED|VERT|VERTICAL|ENG|ENGINEERING|PARAMETRIC|TIME|DERIVEDPROJ|COMPOUND|BOUND)CRS/i.test(t)}function OU(t){return(t==null?void 0:t.wkid)===Xc.CGCS2000}function rg(t){const e=t==null?void 0:t.wkid;return e!=null&&e>=2e3&&WTe.includes(e)}function m3(t){return(t==null?void 0:t.wkid)===32662}function N$(t){return t===Xc.GCSMARS2000||t===Xc.GCSMARS2000_SPHERE}function KA(t){return N$(t==null?void 0:t.wkid)}function F$(t){return t===Xc.GCSMOON2000}function QA(t){return F$(t==null?void 0:t.wkid)}function CHe(t){const e=t==null?void 0:t.wkid;return e!=null&&e>=2e3&&EHe.includes(e)}function Xu(t){if(t==null)return!1;const e=t.wkid;return e!=null&&e>=2e3||t.wkt2!=null||t.wkt!=null}const YTe={wkid:4326,wkt:PD(ZTe[4326].wkTemplate,{Central_Meridian:"0.0"})},JTe={wkid:102100,latestWkid:3857},$He={wkid:32662};function $ie(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const XTe=$ie(Ci),Hj=$ie(nf),qj=$ie(gv),KTe={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${Ci.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`},AHe=Hj.wkt.toUpperCase(),MHe=qj.wkt.toUpperCase();function yr(t){if(t!=null&&Xu(t)){const e=t.wkid,i=t.wkt2??t.wkt;if(N$(e))return nf;const r=i==null?void 0:i.toUpperCase();if(i&&r===AHe)return nf;if(F$(e)||r&&r===MHe)return gv}return Ci}function pqt(t){return N$(t)?nf:F$(t)?gv:Ci}function IU(t){return as(t,XTe)}function Db(t){return IU(t)||as(t,Hj)||as(t,qj)}const Aie=39.37,OHe=Ci.radius*Math.PI/200,QTe=/(?:LENGTH)?UNIT\[([^\]]+)]]$/i,k$=O,eEe=/UNIT\[([^\]]+)]/i,IHe=new Set([4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104025,104026,104139,104140]),RHe=Oo()({millimeter:"millimeters",centimeter:"centimeters",meter:"meters",meter_german:"german-meters",kilometer:"kilometers",decimeter:"decimeters",micrometer:"micrometers",nanometer:"nanometers","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",fathom:"fathoms",nautical_mile:"nautical-miles",chain_us:"us-chains",link_us:"us-links",mile_us:"us-miles",yard_clarke:"clarke-yards",chain_clarke:"clarke-chains",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",link_sears:"sears-links",yard_benoit_1895_a:"benoit-1895-a-yards",foot_benoit_1895_a:"benoit-1895-a-feet",chain_benoit_1895_a:"benoit-1895-a-chains",link_benoit_1895_a:"benoit-1895-a-links",yard_benoit_1895_b:"benoit-1895-b-yards",foot_benoit_1895_b:"benoit-1895-b-feet",chain_benoit_1895_b:"benoit-1895-b-chains",link_benoit_1895_b:"benoit-1895-b-links",foot_1865:"1865-feet",foot_indian:"indian-feet",foot_indian_1937:"indian-1937-feet",foot_indian_1962:"indian-1962-feet",foot_indian_1975:"indian-1975-feet",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",yard_indian_1962:"indian-1962-yards",yard_indian_1975:"indian-1975-yards",statute_mile:"statute-miles",foot_gold_coast:"gold-coast-feet",foot_british_1936:"british-1936-feet",yard:"yards",chain:"chains",link:"links",yard_sears_1922_truncated:"sears-1922-truncated-yards",foot_sears_1922_truncated:"sears-1922-truncated-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains",link_sears_1922_truncated:"sears-1922-truncated-links",yard_us:"us-yards",inch:"inches",inch_us:"us-inches",rod:"rods",rod_us:"us-rods",nautical_mile_us:"us-nautical-miles",nautical_mile_uk:"uk-nautical-miles",smoot:"smoots",vara_tx:"tx-vara",point:"points"}),Wd=t=>t*t,s0=t=>t*t*t,g3={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},meters:{inBaseUnits:1},feet:{inBaseUnits:.3048},"us-feet":{inBaseUnits:.3048006096012192},"clarke-feet":{inBaseUnits:.3047972654},fathoms:{inBaseUnits:1.8288},"nautical-miles":{inBaseUnits:1852},"german-meters":{inBaseUnits:1.0000135965},"us-chains":{inBaseUnits:20.11684023368047},"us-links":{inBaseUnits:.2011684023368047},"us-miles":{inBaseUnits:1609.347218694438},kilometers:{inBaseUnits:1e3},"clarke-yards":{inBaseUnits:.9143917962},"clarke-chains":{inBaseUnits:20.1166195164},"clarke-links":{inBaseUnits:.201166195164},"sears-yards":{inBaseUnits:.9143984146160287},"sears-feet":{inBaseUnits:.3047994715386762},"sears-chains":{inBaseUnits:20.11676512155263},"sears-links":{inBaseUnits:.2011676512155263},"benoit-1895-a-yards":{inBaseUnits:.9143992},"benoit-1895-a-feet":{inBaseUnits:.3047997333333333},"benoit-1895-a-chains":{inBaseUnits:20.1167824},"benoit-1895-a-links":{inBaseUnits:.201167824},"benoit-1895-b-yards":{inBaseUnits:.9143992042898124},"benoit-1895-b-feet":{inBaseUnits:.3047997347632708},"benoit-1895-b-chains":{inBaseUnits:20.11678249437587},"benoit-1895-b-links":{inBaseUnits:.2011678249437587},"1865-feet":{inBaseUnits:.3048008333333334},"indian-feet":{inBaseUnits:.3047995102481469},"indian-1937-feet":{inBaseUnits:.30479841},"indian-1962-feet":{inBaseUnits:.3047996},"indian-1975-feet":{inBaseUnits:.3047995},"indian-yards":{inBaseUnits:.9143985307444408},"indian-1937-yards":{inBaseUnits:.91439523},"indian-1962-yards":{inBaseUnits:.9143988},"indian-1975-yards":{inBaseUnits:.9143985},miles:{inBaseUnits:1609.344},"statute-miles":{inBaseUnits:1609.344},"gold-coast-feet":{inBaseUnits:.3047997101815088},"british-1936-feet":{inBaseUnits:.3048007491},yards:{inBaseUnits:.9144},chains:{inBaseUnits:20.1168},links:{inBaseUnits:.201168},"sears-1922-truncated-yards":{inBaseUnits:.914398},"sears-1922-truncated-feet":{inBaseUnits:.3047993333333334},"sears-1922-truncated-chains":{inBaseUnits:20.116756},"sears-1922-truncated-links":{inBaseUnits:.20116756},"us-yards":{inBaseUnits:.9144018288036576},decimeters:{inBaseUnits:.1},inches:{inBaseUnits:.0254},"us-inches":{inBaseUnits:.0254000508001016},rods:{inBaseUnits:5.0292},"us-rods":{inBaseUnits:5.029210058420118},"us-nautical-miles":{inBaseUnits:1853.248},"uk-nautical-miles":{inBaseUnits:1853.184},smoots:{inBaseUnits:1.7018},"tx-vara":{inBaseUnits:.8466683600033867},points:{inBaseUnits:.0003527777777777778},micrometers:{inBaseUnits:1e-6},nanometers:{inBaseUnits:1e-9},"50-kilometers":{inBaseUnits:5e4},"150-kilometers":{inBaseUnits:15e4}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:Wd(.001)},"square-centimeters":{inBaseUnits:Wd(.01)},"square-decimeters":{inBaseUnits:Wd(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:Wd(1e3)},"square-inches":{inBaseUnits:Wd(.0254)},"square-feet":{inBaseUnits:Wd(.3048)},"square-yards":{inBaseUnits:Wd(.9144)},"square-miles":{inBaseUnits:Wd(1609.344)},"square-nautical-miles":{inBaseUnits:Wd(1852)},"square-us-feet":{inBaseUnits:Wd(1200/3937)},acres:{inBaseUnits:.0015625*Wd(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*s0(.001)},"cubic-centimeters":{inBaseUnits:1e3*s0(.01)},"cubic-decimeters":{inBaseUnits:1e3*s0(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*s0(1e3)},"cubic-inches":{inBaseUnits:1e3*s0(.0254)},"cubic-feet":{inBaseUnits:1e3*s0(.3048)},"cubic-yards":{inBaseUnits:1e3*s0(.9144)},"cubic-miles":{inBaseUnits:1e3*s0(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},PHe=(()=>{const t={};for(const e in g3)for(const i in g3[e].units)t[i]=e;return t})();function DHe(t,e,i){return t*g3[i].units[e].inBaseUnits}function LHe(t,e,i){return t/g3[i].units[e].inBaseUnits}const tEe=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"],NHe=new Map([["meters","square-meters"],["feet","square-feet"],["us-feet","square-us-feet"]]);function mS(t){const e=PHe[t];if(!e)throw new Error("unknown type");return e}function oue(t,e=null){return e=e||mS(t),g3[e].baseUnit===t}function mr(t,e,i){if(e===i)return t;const r=mS(e);if(r!==mS(i))throw new Error("incompatible units");const s=oue(e,r)?t:DHe(t,e,r);return oue(i,r)?s:LHe(s,i,r)}function fqt(t,e,i,r=!1){if(!r&&HS(e))throw new Error("Unable to convert from an angular unit to a linear unit.");const s=qS(e);return s!==i&&(t=s?mr(t,s,i):mr(t*=Mo(e),"meters",i)),t}function mqt(t,e,i,r=!1){if(!r&&HS(i))throw new Error("Unable to convert from a linear unit to an angular unit.");const s=qS(i);return e!==s&&(t=s?mr(t,e,s):mr(t,e,"meters")/Mo(i)),t}function FHe(t){switch(t){case"metric":return"meters";case"imperial":return"feet";default:return t}}function gqt(t){return FHe(t)}function yqt(t){switch(t){case"metric":return"square-meters";case"imperial":return"square-feet";default:return t}}function vqt(t,e,i){switch(i){case"metric":return Mie(t,e);case"imperial":return Iie(t,e);default:return i}}function _qt(t,e,i){switch(i){case"metric":return Oie(t,e);case"imperial":return Rie(t,e);default:return i}}function Mie(t,e){const i=mr(t,e,"meters");return Math.abs(i)<3e3?"meters":"kilometers"}function Oie(t,e){const i=mr(t,e,"meters");return Math.abs(i)<1e5?"meters":"kilometers"}function Iie(t,e){const i=mr(t,e,"feet");return Math.abs(i)<1e3?"feet":"miles"}function Rie(t,e){const i=mr(t,e,"feet");return Math.abs(i)<1e5?"feet":"miles"}function iEe(t,e){const i=mr(t,e,"square-meters");return Math.abs(i)<3e6?"square-meters":"square-kilometers"}function rEe(t,e){const i=mr(t,e,"square-feet");return Math.abs(i)<1e6?"square-feet":"square-miles"}function bqt(t,e,i){switch(i){case"metric":return iEe(t,e);case"imperial":return rEe(t,e);default:return i}}function kHe(t,e,i){return mr(t,e,"meters")/(i*Math.PI/180)}function Pie(t){return RHe.fromJSON(t.toLowerCase())||null}function gS(t){if(t!=null&&!Gj(t))return 1;const e=Mo(t);return e>1e5?1:e}function sEe(t){return Mo(t)>=yr(t).metersPerDegree?"meters":qS(t)}function Mo(t,e=Ci.metersPerDegree){return zHe(t,!0)??e}function zHe(t,e=!1){const i=(t==null?void 0:t.wkid)??null,r=(t==null?void 0:t.wkt2)??(t==null?void 0:t.wkt)??null;let s=null;if(i){if(N$(i))return nf.metersPerDegree;if(F$(i))return gv.metersPerDegree;s=k$.values[k$[i]],!s&&e&&IHe.has(i)&&(s=OHe)}else r&&(aEe(r)?s=lue(QTe.exec(r),s):oEe(r)&&(s=lue(eEe.exec(r),s)));return s}function aue(t){return HS(t)?1:Mo(t)}function lue(t,e){return t!=null&&t[1]?nEe(t[1]):e}function nEe(t){return parseFloat(t.split(",")[1])}function qS(t){const e=(t==null?void 0:t.wkid)??null,i=(t==null?void 0:t.wkt2)??(t==null?void 0:t.wkt)??null;let r=null;if(e)r=k$.units[k$[e]];else if(i){const s=aEe(i)?QTe:oEe(i)?eEe:null;if(s){const n=s.exec(i);n!=null&&n[1]&&(r=VHe(n[1]))}}return r!=null?Pie(r):null}function wqt(t){const e=qS(t);return e!=null&&tEe.includes(e)?e:null}function UHe(t){const e=sEe(t);return e!=null&&tEe.includes(e)?e:null}function xqt(t){const e=qS(t);return e==null?null:NHe.get(e)}function oEe(t){return/^GEOCCS/i.test(t)}function aEe(t){return/^\s*(?:PROJCS|PROJCRS|PROJECTEDCRS)/i.test(t)}const BHe=1e-7;function VHe(t){const e=/[\\"']{1}([^\\"']+)/.exec(t);let i=e==null?void 0:e[1];if(!i||!Pie(i)){const r=nEe(t);i=null;const s=k$.values;for(let n=0;n<s.length;++n)if(Math.abs(r-s[n])<BHe){i=k$.units[n];break}}return i}function Sqt(t){const e=qS(t);if(e==null)return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"fathoms":case"nautical-miles":case"us-chains":case"us-links":case"us-miles":case"clarke-yards":case"clarke-chains":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"sears-links":case"benoit-1895-a-yards":case"benoit-1895-a-feet":case"benoit-1895-a-chains":case"benoit-1895-a-links":case"benoit-1895-b-yards":case"benoit-1895-b-feet":case"benoit-1895-b-chains":case"benoit-1895-b-links":case"1865-feet":case"indian-feet":case"indian-1937-feet":case"indian-1962-feet":case"indian-1975-feet":case"indian-yards":case"indian-1937-yards":case"indian-1962-yards":case"indian-1975-yards":case"statute-miles":case"gold-coast-feet":case"british-1936-feet":case"yards":case"chains":case"links":case"sears-1922-truncated-yards":case"sears-1922-truncated-feet":case"sears-1922-truncated-chains":case"sears-1922-truncated-links":case"us-yards":case"inches":case"us-inches":case"rods":case"us-rods":case"us-nautical-miles":case"uk-nautical-miles":case"smoots":case"tx-vara":case"points":return"imperial";case"millimeters":case"centimeters":case"meters":case"german-meters":case"kilometers":case"decimeters":case"micrometers":case"nanometers":case"50-kilometers":case"150-kilometers":return"metric"}return null}const jHe={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},GHe={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},HHe={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},qHe=Oo()(jHe),WHe=Oo()(GHe),Tqt=Oo()(HHe);var Wf;let Yr=Wf=class extends ee{static fromJSON(t){if(!t)return null;if((t==null?void 0:t.wkid)===102100)return Wf.WebMercator;if((t==null?void 0:t.wkid)===4326)return Wf.WGS84;const e=new Wf;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.wkt2=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return Pb(this)}get isWebMercator(){return rg(this)}get isGeographic(){return HS(this)}get isWrappable(){return CHe(this)}get metersPerUnit(){return Mo(this)}get unit(){return qS(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===Wf.WGS84)return new Wf(YTe);if(this===Wf.WebMercator)return new Wf(JTe);const t=new Wf;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):(this.wkt!=null&&(t.wkt=this.wkt),this.wkt2!=null&&(t.wkt2=this.wkt2)),this.imageCoordinateSystem&&(t.imageCoordinateSystem=q(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:i}=t.imageCoordinateSystem,{geodataXform:r}=t.imageCoordinateSystem,s=this.imageCoordinateSystem;return e==null||r?JSON.stringify(s)===JSON.stringify(t.imageCoordinateSystem):i?s.id===e&&s.referenceServiceName===i:s.id===e}return as(this,t)}toJSON(t){return this.write(void 0,t)}};Yr.GCS_NAD_1927=null,Yr.WGS84=null,Yr.WebMercator=null,Yr.PlateCarree=null,u([p({readOnly:!0})],Yr.prototype,"isWGS84",null),u([p({readOnly:!0})],Yr.prototype,"isWebMercator",null),u([p({readOnly:!0})],Yr.prototype,"isGeographic",null),u([p({readOnly:!0})],Yr.prototype,"isWrappable",null),u([p({type:Ii,json:{write:!0}})],Yr.prototype,"latestWkid",void 0),u([p({readOnly:!0})],Yr.prototype,"metersPerUnit",null),u([p({readOnly:!0})],Yr.prototype,"unit",null),u([p({type:Ii,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt==null}}}}}}})],Yr.prototype,"wkid",void 0),u([p({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid==null}}}}}}})],Yr.prototype,"wkt",void 0),u([_e("wkt"),_e("web-scene","wkt")],Yr.prototype,"writeWkt",null),u([p({type:String,json:{write:!1}})],Yr.prototype,"wkt2",void 0),u([p({type:Ii,json:{write:!0}})],Yr.prototype,"vcsWkid",void 0),u([p({type:Ii,json:{write:!0}})],Yr.prototype,"latestVcsWkid",void 0),u([p()],Yr.prototype,"imageCoordinateSystem",void 0),Yr=Wf=u([A("esri.geometry.SpatialReference")],Yr),Yr.prototype.toJSON.isDefaultToJSON=!0,Yr.GCS_NAD_1927=he.freeze(new Yr({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'})),Yr.WGS84=he.freeze(new Yr(YTe)),Yr.WebMercator=he.freeze(new Yr(JTe)),Yr.PlateCarree=he.freeze(new Yr($He));const Oe=Yr;let Zf=class extends ee{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=Oe.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,i){if(e instanceof Oe)return e;if(e!=null){const r=new Oe;return r.read(e,i),r}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,i){this.cache[e]=i}};u([p()],Zf.prototype,"type",void 0),u([p({readOnly:!0})],Zf.prototype,"cache",null),u([p({readOnly:!0})],Zf.prototype,"extent",null),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Zf.prototype,"hasM",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Zf.prototype,"hasZ",void 0),u([p({type:Oe,json:{write:!0},value:Oe.WGS84})],Zf.prototype,"spatialReference",void 0),u([ve("spatialReference")],Zf.prototype,"readSpatialReference",null),Zf=u([A("esri.geometry.Geometry")],Zf);const mg=Zf;function z$(t){if(t&&typeof t=="object"&&"type"in t&&t.type==="mesh")throw new U("Mesh geometries are not supported for this operation")}function ZHe(t){t.forEach(z$)}const YHe=57.29577951308232,JHe=.017453292519943;function cue(t){return t*YHe}function uue(t){return t*JHe}function hue(t){return t/Ci.radius}function nZ(t){return Math.PI/2-2*Math.atan(Math.exp(-t/Ci.radius))}function oZ(t){return t.wkid!=null||t.wkt!=null}const NH=[0,0];function RU(t,e,i,r,s){const n=t,o=s;if(o.spatialReference=i,"x"in n&&"x"in o)[o.x,o.y]=e(n.x,n.y,NH,r);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=e(n.xmin,n.ymin,NH,r),[o.xmax,o.ymax]=e(n.xmax,n.ymax,NH,r);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let h=0;h<a.length;h++){const d=a[h];c=[],l.push(c);for(let f=0;f<d.length;f++)c.push(e(d[f][0],d[f][1],[0,0],r)),d[f].length>2&&c[f].push(d[f][2]),d[f].length>3&&c[f].push(d[f][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=e(a[c][0],a[c][1],[0,0],r),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function b4(t,e){const i=t&&(oZ(t)?t:t.spatialReference),r=e&&(oZ(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!i||!r)&&(!!as(r,i)||rg(r)&&Pb(i)||rg(i)&&Pb(r))}function VD(t,e){if(t==null)return null;const i=t.spatialReference,r=e&&(oZ(e)?e:e.spatialReference);return b4(i,r)?as(i,r)?q(t):rg(r)?RU(t,K2,Oe.WebMercator,!1,q(t)):Pb(r)?RU(t,Wj,Oe.WGS84,!1,q(t)):null:null}function K2(t,e,i=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const r=uue(e);return i[0]=uue(t)*Ci.radius,i[1]=Ci.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function Wj(t,e,i=[0,0],r=!1){if(t===f3[0])i[0]=-180;else if(t===f3[1])i[0]=180;else{const s=cue(t/Ci.radius);i[0]=r?s:s-360*Math.floor((s+180)/360)}return i[1]=cue(Math.PI/2-2*Math.atan(Math.exp(-e/Ci.radius))),i}function iv(t,e=!1,i=q(t)){return z$(t),z$(i),RU(t,K2,Oe.WebMercator,e,i)}function Cx(t,e=!1,i=q(t)){return z$(t),z$(i),RU(t,Wj,Oe.WGS84,e,i)}function lEe(t,e){const i=t.x-e.x,r=t.y-e.y,s=t.z!=null&&e.z!=null?t.z-e.z:0;return Math.sqrt(i*i+r*r+s*s)}function XHe(t){var e;return((e=cEe(t,uEe))==null?void 0:e[0])??null}function KHe(t){var e;return((e=cEe(t,uEe))==null?void 0:e[1])??null}function cEe({x:t,y:e,spatialReference:i},r=[0,0]){if(i){if(rg(i))return Wj(t,e,r);if(HS(i))return r[0]=t,r[1]=e,r}return null}const uEe=[0,0];var w4;const FH=[0,0];function due(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let Ul=w4=class extends mg{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const i=t._get("spatialReference");e._set("spatialReference",he.isFrozen(i)?i:i.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,i,r,s){let n;if(Array.isArray(t))n=t,s=e,t=n[0],e=n[1],i=n[2],r=n[3];else if(t&&typeof t=="object"){if(n=t,t=n.x!=null?n.x:n.longitude,e=n.y!=null?n.y:n.latitude,i=n.z,r=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new Oe(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)J.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)J.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&(s!=null&&s.isWebMercator)){const a=K2(n.longitude,n.latitude,FH);t=a[0],e=a[1]}}}else due(i)?(s=i,i=null):due(r)&&(s=r,r=null);const o={x:t,y:e};return o.x==null&&o.y!=null?J.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&J.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),i!=null&&(o.z=i),r!=null&&(o.m=r),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){return KHe(this)}set latitude(t){const{spatialReference:e,x:i}=this;t!=null&&e&&(e.isWebMercator?this._set("y",K2(i,t,FH)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){return XHe(this)}set longitude(t){const{y:e,spatialReference:i}=this;t!=null&&i&&(i.isWebMercator?this._set("x",K2(t,e,FH)[0]):i.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,i){e[i]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new w4;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return w4.copy(t,this),this}equals(t){if(t==null)return!1;const{x:e,y:i,z:r,m:s,spatialReference:n}=this,{z:o,m:a}=t;let{x:l,y:c,spatialReference:h}=t;if(!n.equals(h))if(n.isWebMercator&&h.isWGS84)[l,c]=K2(l,c),h=n;else{if(!n.isWGS84||!h.isWebMercator)return!1;[l,c]=Wj(l,c),h=n}return e===l&&i===c&&r===o&&s===a&&n.wkid===h.wkid}offset(t,e,i){return this.x+=t,this.y+=e,i!=null&&(this.z=(this.z??0)+i),this}normalize(){if(!this.spatialReference)return this;const t=hc(this.spatialReference);if(!t)return this;let e=this.x;const[i,r]=t.valid,s=2*r;let n;return e>r?(n=Math.ceil(Math.abs(e-r)/s),e-=n*s):e<i&&(n=Math.ceil(Math.abs(e-i)/s),e+=n*s),this._set("x",e),this}distance(t){return lEe(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};u([p({readOnly:!0})],Ul.prototype,"cache",null),u([p({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Ul.prototype,"hasM",null),u([p({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Ul.prototype,"hasZ",null),u([p({type:Number})],Ul.prototype,"latitude",null),u([p({type:Number})],Ul.prototype,"longitude",null),u([p({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),ti(t=>isNaN(t)?t:rc(t))],Ul.prototype,"x",void 0),u([_e("x")],Ul.prototype,"writeX",null),u([ve("x")],Ul.prototype,"readX",null),u([p({type:Number,json:{write:!0}})],Ul.prototype,"y",void 0),u([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Ul.prototype,"z",void 0),u([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],Ul.prototype,"m",void 0),Ul=w4=u([A("esri.geometry.Point")],Ul),Ul.prototype.toJSON.isDefaultToJSON=!0;const Fe=Ul;let Yf=class extends Nt.ClonableMixin(ee){constructor(...e){super(...e),this.position=new Fe([0,0,0]),this.heading=0,this.tilt=0,this.fov=55,this.layout=new sTe}normalizeCtorArgs(e,i,r,s){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const n={position:e};return i!=null&&(n.heading=i),r!=null&&(n.tilt=r),s!=null&&(n.fov=s),n}return e}writePosition(e,i,r,s){const n=e.clone();n.x=rc(e.x||0),n.y=rc(e.y||0),n.z=e.hasZ?rc(e.z||0):e.z,i[r]=n.write({},s)}readPosition(e,i){const r=new Fe;return r.read(e,i),r.x=rc(r.x||0),r.y=rc(r.y||0),r.z=r.hasZ?rc(r.z||0):r.z,r}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)&&this.layout.equals(e.layout)}};u([p({type:Fe,json:{write:{isRequired:!0}}})],Yf.prototype,"position",void 0),u([_e("position")],Yf.prototype,"writePosition",null),u([ve("position")],Yf.prototype,"readPosition",null),u([p({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),ti(t=>Bj.normalize(rc(t)))],Yf.prototype,"heading",void 0),u([p({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),ti(t=>ue(rc(t),-180,180))],Yf.prototype,"tilt",void 0),u([p({type:Number,nonNullable:!0,json:{default:55,write:!0}}),ti(t=>ue(rc(t,55),1,170))],Yf.prototype,"fov",void 0),u([p({type:sTe,nonNullable:!0,json:{read:!1,write:!1}})],Yf.prototype,"layout",void 0),Yf=u([A("esri.Camera")],Yf);const ou=Yf,kH=[0,0];function jD(t,e){return e!=null&&vl(t,e.x,e.y,e.z)}function $qt(t,e){var i;if(!((i=e.points)!=null&&i.length))return!1;for(const r of e.points)if(!U$(t,r))return!1;return!0}function QHe(t,e){const{xmin:i,ymin:r,zmin:s,xmax:n,ymax:o,zmax:a}=e;return t.hasZ&&e.hasZ?vl(t,i,r,s)&&vl(t,i,o,s)&&vl(t,n,o,s)&&vl(t,n,r,s)&&vl(t,i,r,a)&&vl(t,i,o,a)&&vl(t,n,o,a)&&vl(t,n,r,a):vl(t,i,r)&&vl(t,i,o)&&vl(t,n,o)&&vl(t,n,r)}function U$(t,e){return vl(t,e[0],e[1])}function e8e(t,e){return vl(t,e[0],e[1],e[2])}function vl(t,e,i,r){return e>=t.xmin&&e<=t.xmax&&i>=t.ymin&&i<=t.ymax&&(r==null||!t.hasZ||r>=t.zmin&&r<=t.zmax)}function Die(t,e){return kH[1]=e.y,kH[0]=e.x,t8e(t,kH)}function t8e(t,e){return Lie(t.rings,e)}function Lie(t,e){if(!t)return!1;if(i8e(t))return pue(!1,t,e);let i=!1;for(let r=0,s=t.length;r<s;r++)i=pue(i,t[r],e);return i}function i8e(t){return!Array.isArray(t[0][0])}function pue(t,e,i){const[r,s]=i;let n=t,o=0;for(let a=0,l=e.length;a<l;a++){o++,o===l&&(o=0);const[c,h]=e[a],[d,f]=e[o];(h<s&&f>=s||f<s&&h>=s)&&c+(s-h)/(f-h)*(d-c)<r&&(n=!n)}return n}function r8e(t,e){return jD(t,e)}function s8e(t,e){const i=t.hasZ&&e.hasZ;let r,s,n;if(t.xmin<=e.xmin){if(r=e.xmin,t.xmax<r)return!1}else if(r=t.xmin,e.xmax<r)return!1;if(t.ymin<=e.ymin){if(s=e.ymin,t.ymax<s)return!1}else if(s=t.ymin,e.ymax<s)return!1;if(i&&e.hasZ){if(t.zmin<=e.zmin){if(n=e.zmin,t.zmax<n)return!1}else if(n=t.zmin,e.zmax<n)return!1}return!0}function n8e(t,e){const{points:i,hasZ:r}=e,s=r?e8e:U$;for(const n of i)if(s(t,n))return!0;return!1}const yS=[0,0],vS=[0,0],_S=[0,0],bS=[0,0],o8e=[yS,vS,_S,bS],hEe=[[_S,yS],[yS,vS],[vS,bS],[bS,_S]];function a8e(t,e){return l8e(t,e.rings)}function l8e(t,e){yS[0]=t.xmin,yS[1]=t.ymax,vS[0]=t.xmax,vS[1]=t.ymax,_S[0]=t.xmin,_S[1]=t.ymin,bS[0]=t.xmax,bS[1]=t.ymin;for(const i of o8e)if(Lie(e,i))return!0;for(const i of e){if(!i.length)continue;let r=i[0];if(U$(t,r))return!0;for(let s=1;s<i.length;s++){const n=i[s];if(U$(t,n)||dEe(r,n,hEe))return!0;r=n}}return!1}function c8e(t,e){yS[0]=t.xmin,yS[1]=t.ymax,vS[0]=t.xmax,vS[1]=t.ymax,_S[0]=t.xmin,_S[1]=t.ymin,bS[0]=t.xmax,bS[1]=t.ymin;const i=e.paths;for(const r of i){if(!i.length)continue;let s=r[0];if(U$(t,s))return!0;for(let n=1;n<r.length;n++){const o=r[n];if(U$(t,o)||dEe(s,o,hEe))return!0;s=o}}return!1}const sa=[0,0];function u8e(t){for(let e=0;e<t.length;e++){const i=t[e];for(let s=0;s<i.length-1;s++){const n=i[s],o=i[s+1];for(let a=e+1;a<t.length;a++)for(let l=0;l<t[a].length-1;l++){const c=t[a][l],h=t[a][l+1];if(aZ(n,o,c,h,sa)&&!(sa[0]===n[0]&&sa[1]===n[1]||sa[0]===c[0]&&sa[1]===c[1]||sa[0]===o[0]&&sa[1]===o[1]||sa[0]===h[0]&&sa[1]===h[1]))return!0}}const r=i.length;if(!(r<=4))for(let s=0;s<r-3;s++){let n=r-1;s===0&&(n=r-2);const o=i[s],a=i[s+1];for(let l=s+2;l<n;l++){const c=i[l],h=i[l+1];if(aZ(o,a,c,h,sa)&&!(sa[0]===o[0]&&sa[1]===o[1]||sa[0]===c[0]&&sa[1]===c[1]||sa[0]===a[0]&&sa[1]===a[1]||sa[0]===h[0]&&sa[1]===h[1]))return!0}}}return!1}function dEe(t,e,i){for(let r=0;r<i.length;r++)if(aZ(t,e,i[r][0],i[r][1]))return!0;return!1}function aZ(t,e,i,r,s){const[n,o]=t,[a,l]=e,[c,h]=i,[d,f]=r,m=d-c,g=n-c,v=a-n,_=f-h,b=o-h,w=l-o,x=_*v-m*w;if(x===0)return!1;const S=(m*b-_*g)/x,C=(v*b-w*g)/x;return S>=0&&S<=1&&C>=0&&C<=1&&(s&&(s[0]=n+S*(a-n),s[1]=o+S*(l-o)),!0)}function h8e(t){switch(t){case"esriGeometryEnvelope":case"extent":return s8e;case"esriGeometryMultipoint":case"multipoint":return n8e;case"esriGeometryPoint":case"point":return r8e;case"esriGeometryMultiPatch":case"multipatch":case"esriGeometryPolygon":case"polygon":return a8e;case"esriGeometryPolyline":case"polyline":return c8e}}var hp;function d8e(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function n0(t,e,i){return e==null?i:i==null?e:t(e,i)}let Fo=hp=class extends mg{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,i,r,s){return d8e(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?Oe.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:i,ymax:r,spatialReference:s??Oe.WGS84}}static fromPoint(t){return new hp({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new Fe({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new hp;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&b4(e,i)&&(t=e.isWebMercator?iv(t):Cx(t,!0)),t.type==="point"?jD(this,t):t.type==="extent"&&QHe(this,t)}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&b4(e,i)&&(t=e.isWebMercator?iv(t):Cx(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),i=this.width*e,r=this.height*e;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const s=(this.zmax-this.zmin)*e;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*e;this.mmin+=s,this.mmax-=s}return this}intersects(t){if(t==null)return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,i=t.spatialReference;return e&&i&&!as(e,i)&&b4(e,i)&&(t=e.isWebMercator?iv(t):Cx(t,!0)),h8e(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,i){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,i!=null&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=n0(Math.min,this.zmin,t.zmin),this.zmax=n0(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=n0(Math.min,this.mmin,t.mmin),this.mmax=n0(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:t!=null&&this.intersects(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=n0(Math.max,this.zmin,t.zmin),this.zmax=n0(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=n0(Math.max,this.mmin,t.mmin),this.mmax=n0(Math.min,this.mmax,t.mmax)),this):null}toJSON(t){return this.write({},t)}_shiftCM(t=hc(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,i=this._getCM(t);if(i){const r=e.isWebMercator?Cx(i):i;this.xmin-=i.x,this.xmax-=i.x,e.isWebMercator||(r.x=zH(r.x,t).x),this.spatialReference=new Oe(PD((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(t){let e=null;const[i,r]=t.valid,s=this.xmin,n=this.xmax;return s>=i&&s<=r&&n>=i&&n<=r||(e=this.center),e}_normalize(t,e,i){const r=this.spatialReference;if(!r)return this;const s=i??hc(r);if(s==null)return this;const n=this._getParts(s).map(l=>l.extent);if(n.length<2)return n[0]||this;if(n.length>2)return t?this._shiftCM(s):this.set({xmin:s.valid[0],xmax:s.valid[1]});if(t)return this._shiftCM(s);if(e)return n;let o=!0,a=!0;return n.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:n.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const h=(l.zmax-l.zmin)/2;for(let d=0;d<c.length;d++)c[d].push(h)}if(a){const h=(l.mmax-l.mmin)/2;for(let d=0;d<c.length;d++)c[d].push(h)}return c}),hasZ:o,hasM:a,spatialReference:r}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let h;t=t||hc(o);const[d,f]=t.valid;h=zH(this.xmin,t);const m=h.x,g=h.frameId;h=zH(this.xmax,t);const v=h.x,_=h.frameId,b=m===v&&a>0;if(a>2*f){const w=new hp(l<c?m:v,s,f,n,o),x=new hp(d,s,l<c?v:m,n,o),S=new hp(0,s,f,n,o),C=new hp(d,s,0,n,o),T=[],M=[];w.contains(S)&&T.push(g),w.contains(C)&&M.push(g),x.contains(S)&&T.push(_),x.contains(C)&&M.push(_);for(let I=g+1;I<_;I++)T.push(I),M.push(I);e.push({extent:w,frameIds:[g]},{extent:x,frameIds:[_]},{extent:S,frameIds:T},{extent:C,frameIds:M})}else m>v||b?e.push({extent:new hp(m,s,f,n,o),frameIds:[g]},{extent:new hp(d,s,v,n,o),frameIds:[_]}):e.push({extent:new hp(m,s,v,n,o),frameIds:[g]});this.cache._parts=e}const i=this.hasZ,r=this.hasM;if(i||r){const s={};i&&(s.zmin=this.zmin,s.zmax=this.zmax),r&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<e.length;n++)e[n].extent.set(s)}return e}};function zH(t,e){const[i,r]=e.valid,s=2*r;let n,o=0;return t>r?(n=Math.ceil(Math.abs(t-r)/s),t-=n*s,o=n):t<i&&(n=Math.ceil(Math.abs(t-i)/s),t+=n*s,o=-n),{x:t,frameId:o}}u([p({readOnly:!0})],Fo.prototype,"cache",null),u([p({readOnly:!0})],Fo.prototype,"center",null),u([p({readOnly:!0})],Fo.prototype,"extent",null),u([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Fo.prototype,"hasM",null),u([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Fo.prototype,"hasZ",null),u([p({readOnly:!0})],Fo.prototype,"height",null),u([p({readOnly:!0})],Fo.prototype,"width",null),u([p({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],Fo.prototype,"xmin",void 0),u([p({type:Number,json:{write:!0}})],Fo.prototype,"ymin",void 0),u([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Fo.prototype,"mmin",void 0),u([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Fo.prototype,"zmin",void 0),u([p({type:Number,json:{write:!0}})],Fo.prototype,"xmax",void 0),u([p({type:Number,json:{write:!0}})],Fo.prototype,"ymax",void 0),u([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Fo.prototype,"mmax",void 0),u([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Fo.prototype,"zmax",void 0),Fo=hp=u([A("esri.geometry.Extent")],Fo),Fo.prototype.toJSON.isDefaultToJSON=!0;const _i=Fo,p8e=Object.freeze(Object.defineProperty({__proto__:null,default:_i},Symbol.toStringTag,{value:"Module"}));function B$(t,e,i=!1){let{hasM:r,hasZ:s}=t;Array.isArray(e)?e.length!==4||r||s?e.length===3&&i&&!r?(s=!0,r=!1):e.length===3&&r&&s&&(r=!1,s=!1):(r=!0,s=!0):(s=!s&&e.hasZ&&(!r||e.hasM),r=!r&&e.hasM&&(!s||e.hasZ)),t.hasZ=s,t.hasM=r}var lZ;function fue(t){return(e,i)=>e==null?i:i==null?e:t(e,i)}function f8e(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let F0=lZ=class extends mg{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){var s;if(!t&&!e)return{};const i={};Array.isArray(t)?(i.points=t,i.spatialReference=e):f8e(t)?i.spatialReference=t:(t.points&&(i.points=t.points),t.spatialReference&&(i.spatialReference=t.spatialReference),t.hasZ&&(i.hasZ=t.hasZ),t.hasM&&(i.hasM=t.hasM));const r=(s=i.points)==null?void 0:s[0];return r&&(i.hasZ===void 0&&i.hasM===void 0?(i.hasZ=r.length>2,i.hasM=!1):i.hasZ===void 0?i.hasZ=r.length>3:i.hasM===void 0&&(i.hasM=r.length>3)),i}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new _i,i=this.hasZ,r=this.hasM,s=i?3:2,n=t[0],o=fue(Math.min),a=fue(Math.max);let l,c,h,d,[f,m]=n,[g,v]=n;for(let _=0,b=t.length;_<b;_++){const w=t[_],[x,S]=w;if(f=o(f,x),m=o(m,S),g=a(g,x),v=a(v,S),i&&w.length>2){const C=w[2];l=o(l,C),h=a(h,C)}if(r&&w.length>s){const C=w[s];c=o(c,C),d=a(d,C)}}return e.xmin=f,e.ymin=m,e.xmax=g,e.ymax=v,e.spatialReference=this.spatialReference,i?(e.zmin=l,e.zmax=h):(e.zmin=void 0,e.zmax=void 0),r?(e.mmin=c,e.mmax=d):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=q(this.points)}addPoint(t){return B$(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:q(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new lZ(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],i={x:e[0],y:e[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=e[2],r=3),this.hasM&&(i.m=e[r]),new Fe(i)}removePoint(t){if(!this._validateInputs(t))return null;const e=new Fe(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(B$(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};u([p({readOnly:!0})],F0.prototype,"cache",null),u([p()],F0.prototype,"extent",null),u([p({type:[[Number]],json:{write:{isRequired:!0}}})],F0.prototype,"points",void 0),u([_e("points")],F0.prototype,"writePoints",null),F0=lZ=u([A("esri.geometry.Multipoint")],F0),F0.prototype.toJSON.isDefaultToJSON=!0;const WS=F0;function Aqt(t){const e=[];for(t.reset();t.nextPath();){const i=[];for(;t.nextPoint();)i.push([t.x,t.y]);e.push(i)}return t.reset(),e}function m8e(t){const e=[];for(;t.nextPoint();)e.push([t.x,t.y]);return t.seekPathStart(),e}var rs;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})(rs||(rs={}));function Mqt(t){if(!t)return null;if(Array.isArray(t))return t;const e=t.hasZ,i=t.hasM;if(t.type==="point")return i&&e?[t.x,t.y,t.z,t.m]:e?[t.x,t.y,t.z]:i?[t.x,t.y,t.m]:[t.x,t.y];if(t.type==="polygon")return t.rings.slice();if(t.type==="polyline")return t.paths.slice();if(t.type==="multipoint")return t.points.slice();if(t.type==="extent"){const r=t.clone().normalize();if(!r)return null;let s=!1,n=!1;return r.forEach(o=>{o.hasZ&&(s=!0),o.hasM&&(n=!0)}),r.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(s&&o.hasZ){const l=.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(n&&o.hasM){const l=.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a})}return null}function Zj(t,e){const i=e[0]-t[0],r=e[1]-t[1];if(t.length>2&&e.length>2){const s=t[2]-e[2];return Math.sqrt(i*i+r*r+s*s)}return Math.sqrt(i*i+r*r)}function pEe(t,e,i){const r=t[0]+i*(e[0]-t[0]),s=t[1]+i*(e[1]-t[1]);return t.length>2&&e.length>2?[r,s,t[2]+i*(e[2]-t[2])]:[r,s]}function g8e(t,e,i,r){return y8e(t,e,i[r],i[r+1])}function y8e(t,e,i,r){const[s,n]=e,[o,a]=i,[l,c]=r,h=l-o,d=c-a,f=h*h+d*d,m=(s-o)*h+(n-a)*d,g=Math.min(1,Math.max(0,m/f));return t[0]=o+h*g,t[1]=a+d*g,t}function v8e(t,e,i,r,s,n){let o=i,a=r,l=s-o,c=n-a;if(l!==0||c!==0){const h=((t-o)*l+(e-a)*c)/(l*l+c*c);h>1?(o=s,a=n):h>0&&(o+=l*h,a+=c*h)}return l=t-o,c=e-a,l*l+c*c}function fEe(t,e){return pEe(t,e,.5)}function mEe(t){const e=t.length;let i=0;for(let r=0;r<e-1;++r)i+=Zj(t[r],t[r+1]);return i}function gEe(t,e){if(e<=0)return t[0];const i=t.length;let r=0;for(let s=0;s<i-1;++s){const n=Zj(t[s],t[s+1]);if(e-r<n){const o=(e-r)/n;return pEe(t[s],t[s+1],o)}r+=n}return t[i-1]}function eb(t,e=rs.X,i=rs.Y){let r=0;const s=t.length;let n=t[0];for(let o=1;o<s;o++){const a=t[o];r+=(a[e]-n[e])*(a[i]+n[i]),n=a}if(!yEe(t)){const o=t[0];r+=(o[e]-n[e])*(o[i]+n[i])}return r>=0}function yEe(t){const e=t.length;return e<3||eg(t[0],t[e-1])}function Oqt(t){"rings"in t&&(vEe(t),_8e(t))}function vEe(t){if(!("rings"in t))return!1;let e=!1;for(const i of t.rings)yEe(i)||(i.push(i[0].slice()),e=!0);return e}function _8e(t){if(!("rings"in t)||t.rings.length===0||eb(t.rings[0]))return!1;for(const e of t.rings)e.reverse();return!0}function Iqt(t){return t.type!=="polygon"&&t.type!=="polyline"||b8e(t.type==="polygon"?t.rings:t.paths,t.spatialReference),t}function b8e(t,e){const i=hc(e);if(!i)return;const r=i.valid[0],s=i.valid[1],n=s-r;for(const o of t){let a=1/0,l=-1/0;for(const h of o){const d=w8e(h[0],r,s);a=Math.min(a,d),l=Math.max(l,d),h[0]=d}const c=l-a;n-c<c&&o.forEach(h=>{h[0]<0&&(h[0]+=n)})}}function w8e(t,e,i){const r=i-e;return t<e?i-(e-t)%r:t>i?e+(t-e)%r:t}function Rqt(t,e){if(t===e)return!0;if(t.type!==e.type)return!1;if(t.type==="point"||t.type==="mesh"||t.type==="extent")return!0;if(t.type==="multipoint")return t.points.length===e.points.length;const[i,r]=t.type==="polyline"?[t.paths,e.paths]:[t.rings,e.rings];return i.length===r.length&&i.every((s,n)=>s.length===r[n].length)}function Pqt(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function x8e(t){return t?_Ee(t.rings,t.hasZ??!1):null}function _Ee(t,e){if(!(t!=null&&t.length))return null;const i=[],r=[],s=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=t.length;n<o;n++){const a=bEe(t[n],e,s);a&&r.push(a)}if(r.sort((n,o)=>{let a=n[2]-o[2];return a===0&&e&&(a=n[4]-o[4]),a}),r.length&&(i[0]=r[0][0],i[1]=r[0][1],e&&(i[2]=r[0][3]),(i[0]<s[0]||i[0]>s[1]||i[1]<s[2]||i[1]>s[3]||e&&(i[2]<s[4]||i[2]>s[5]))&&(i.length=0)),!i.length){const n=t[0]&&t[0].length?S8e(t[0],e):null;if(!n)return null;i[0]=n[0],i[1]=n[1],e&&n.length>2&&(i[2]=n[2])}return i}function bEe(t,e,i){let r=0,s=0,n=0,o=0,a=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,h=t.length&&e?t[0][2]:0;for(let f=0;f<t.length;f++){const m=t[f],g=t[(f+1)%t.length],[v,_,b]=m,w=v-l,x=_-c,[S,C,T]=g,M=S-l,I=C-c,D=w*I-M*x;if(o+=D,r+=(w+M)*D,s+=(x+I)*D,e&&m.length>2&&g.length>2){const P=b-h,F=T-h,L=w*F-M*P;n+=(P+F)*L,a+=L}v<i[0]&&(i[0]=v),v>i[1]&&(i[1]=v),_<i[2]&&(i[2]=_),_>i[3]&&(i[3]=_),e&&(b<i[4]&&(i[4]=b),b>i[5]&&(i[5]=b))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const d=[r/(6*o)+l,s/(6*o)+c,o];return e&&(i[4]===i[5]||a===0?(d[3]=(i[4]+i[5])/2,d[4]=0):(d[3]=n/(6*a)+h,d[4]=a)),d}function Dqt(t,e){let i=0,r=0,s=0;t.nextPoint();const n=t.pathSize?t.x:0,o=t.pathSize?t.y:0;for(let a=0;a<t.pathSize;a++){t.seekInPath(a);const l=[t.x,t.y];t.seekInPath((a+1)%t.pathSize);const c=[t.x,t.y],[h,d]=l,f=h-n,m=d-o,[g,v]=c,_=g-n,b=v-o,w=f*b-_*m;s+=w,i+=(f+_)*w,r+=(m+b)*w,h<e[0]&&(e[0]=h),h>e[1]&&(e[1]=h),d<e[2]&&(e[2]=d),d>e[3]&&(e[3]=d)}return s>0&&(s*=-1),s?(s*=.5,[i/(6*s)+n,r/(6*s)+o,s]):null}function S8e(t,e){const i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=t.length;l<c-1;l++){const h=t[l],d=t[l+1];if(h&&d){i[0]=h[0],i[1]=h[1],r[0]=d[0],r[1]=d[1],e&&h.length>2&&d.length>2&&(i[2]=h[2],r[2]=d[2]);const f=Zj(i,r);if(f){s+=f;const m=fEe(h,d);n+=f*m[0],o+=f*m[1],e&&m.length>2&&(a+=f*m[2])}}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.length?t[0]:null}function T8e(t){const{hasZ:e,totalSize:i}=t;if(i===0)return null;const r=[],s=[],n=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t.reset();t.nextPath();){const o=bEe(m8e(t),t.hasZ,n);o&&s.push(o)}if(s.sort((o,a)=>{let l=o[2]-a[2];return l===0&&e&&(l=o[4]-a[4]),l}),s.length&&(r[0]=s[0][0],r[1]=s[0][1],e&&(r[2]=s[0][3]),(r[0]<n[0]||r[0]>n[1]||r[1]<n[2]||r[1]>n[3]||e&&(r[2]<n[4]||r[2]>n[5]))&&(r.length=0)),!r.length){t.reset(),t.nextPath();const o=t.pathSize?E8e(t):null;if(!o)return null;r[0]=o[0],r[1]=o[1],e&&o.length>2&&(r[2]=o[2])}return r}function E8e(t){const{hasZ:e}=t,i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;if(t.nextPoint()){let l=t.x,c=t.y,h=t.z;for(;t.nextPoint();){const d=t.x,f=t.y,m=t.z;i[0]=l,i[1]=c,r[0]=d,r[1]=f,e&&(i[2]=h,r[2]=m);const g=Zj(i,r);if(g){s+=g;const v=fEe(i,r);n+=g*v[0],o+=g*v[1],e&&v.length>2&&(a+=g*v[2])}l=d,c=f,h=m}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.pathSize?(t.seekPathStart(),t.nextPoint(),[t.x,t.y]):null}const C8e=1e-6;function Lqt(t){let e=0;for(t.reset();t.nextPath();)e+=t.getCurrentRingArea();if(e<C8e){const s=T8e(t);return s?[s[0],s[1]]:null}const i=[0,0];if(t.reset(),!t.nextPath()||!t.nextPoint())return null;const r=[t.x,t.y];for(t.reset();t.nextPath();)A8e(i,r,t);return i[0]*=1/e,i[1]*=1/e,i[0]+=r[0],i[1]+=r[1],i}const $8e=1/3;function A8e(t,e,i){if(!i||i.pathSize<3)return null;i.nextPoint();const r=i.x,s=i.y;i.nextPoint();let n,o=i.x-r,a=i.y-s,l=0,c=0;for(;i.nextPoint();)l=i.x-r,c=i.y-s,n=.5*$8e*(l*a-c*o),t[0]+=n*(o+l),t[1]+=n*(a+c),o=l,a=c;const h=i.getCurrentRingArea(),d=[r,s];return d[0]-=e[0],d[1]-=e[1],d[0]*=h,d[1]*=h,t[0]+=d[0],t[1]+=d[1],t}function si(t=P8e){return[t[0],t[1],t[2],t[3]]}function Nqt(t){return[t[0],t[1],t[2],t[3]]}function Lb(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function Nie(t,e,i,r,s=si()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function wEe(t,e=si()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function GD(t,e,i=new _i){return i.xmin=t[0],i.ymin=t[1],i.xmax=t[2],i.ymax=t[3],i.spatialReference=e,i}function M8e(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function kC(t,e,i){if(e!=null)if("length"in e)dZ(e)?(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[2]),i[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[0]),i[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":i[0]=Math.min(t[0],e.xmin),i[1]=Math.min(t[1],e.ymin),i[2]=Math.max(t[2],e.xmax),i[3]=Math.max(t[3],e.ymax);break;case"point":i[0]=Math.min(t[0],e.x),i[1]=Math.min(t[1],e.y),i[2]=Math.max(t[2],e.x),i[3]=Math.max(t[3],e.y)}else Lb(i,t)}function UH(t,e,i=t){const r=e.length;let s=t[0],n=t[1],o=t[2],a=t[3];for(let l=0;l<r;l++){const c=e[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return i[0]=s,i[1]=n,i[2]=o,i[3]=a,i}function cZ(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function Jo(t){return t==null||t[0]>=t[2]?0:t[2]-t[0]}function El(t){return t==null||t[1]>=t[3]?0:t[3]-t[1]}function Fqt(t){return Jo(t)*El(t)}function PU(t){return Jo(t)>0&&El(t)>0}function xEe(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function kqt(t){const e=Jo(t),i=El(t);return Math.sqrt(e*e+i*i)}function O8e(t,e){return Yj(t,e[0],e[1])}function mue(t,e){const i=e[3],r=.5*(t[0]+t[2]),s=Math.abs(e[0]-r),n=.5*(t[2]-t[0]);if(s>i+n)return!1;const o=.5*(t[1]+t[3]),a=.5*(t[3]-t[1]),l=Math.abs(e[1]-o);if(l>i+a)return!1;if(s<n||l<a)return!0;const c=s-n,h=l-a;return c*c+h*h<=i*i}function zqt(t,e,i){const r=t[0],s=t[1],n=t[2],o=t[3],{x:a,y:l}=e,{x:c,y:h}=i,d=(_,b)=>(h-l)*_+(a-c)*b+(c*l-a*h)<0,f=d(r,o),m=d(n,o),g=d(n,s),v=d(r,s);return!(f===m&&m===g&&g===v&&v===f||a<r&&c<r||a>n&&c>n||l>o&&h>o||l<s&&h<s)}function Uqt(t,e){return Yj(t,e.x,e.y)}function Yj(t,e,i){return e>=t[0]&&i>=t[1]&&e<=t[2]&&i<=t[3]}function y3(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function Bqt(t,e,i){return Math.max(e[0],t[0])-i<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])-i<=Math.min(e[3],t[3])}function uZ(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function hZ(t,e,i){if(e==null)return Lb(i,t);const r=e[0],s=e[1],n=e[2],o=e[3];return i[0]=ue(t[0],r,n),i[1]=ue(t[1],s,o),i[2]=ue(t[2],r,n),i[3]=ue(t[3],s,o),i}function I8e(t,e){const i=(t[0]+t[2])/2,r=(t[1]+t[3])/2,s=Math.max(Math.abs(e[0]-i)-Jo(t)/2,0),n=Math.max(Math.abs(e[1]-r)-El(t)/2,0);return Math.sqrt(s*s+n*n)}function DU(t,e,i,r=t){return r[0]=t[0]+e,r[1]=t[1]+i,r[2]=t[2]+e,r[3]=t[3]+i,r}function Vqt(t,e,i=t){return i[0]=t[0]-e,i[1]=t[1]-e,i[2]=t[2]+e,i[3]=t[3]+e,i}function yv(t){return t?Lb(t,pZ):si(pZ)}function dZ(t){return t!=null&&t.length===4}function R8e(t){return!(Jo(t)!==0&&isFinite(t[0])||El(t)!==0&&isFinite(t[1]))}function Hx(t,e){return dZ(t)&&dZ(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const jqt=[-1/0,-1/0,1/0,1/0],pZ=[1/0,1/0,-1/0,-1/0],P8e=[0,0,0,0];function SEe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function TEe(t){return t.points!==void 0}function EEe(t){return t.x!==void 0&&t.y!==void 0}function CEe(t){return t.paths!==void 0}function $Ee(t){return t.rings!==void 0}function AEe(t){function e(i,r){return i==null?r:r==null?i:t(i,r)}return e}const tb=AEe(Math.min),ib=AEe(Math.max);function Gqt(t,e){return CEe(e)?V$(t,e.paths,!1,!1):$Ee(e)?V$(t,e.rings,!1,!1):TEe(e)?Fie(t,e.points,!1,!1,!1,!1):SEe(e)?MEe(t,e):(EEe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function Hqt(t){let e,i,r,s;for(t.reset(),e=r=1/0,i=s=-1/0;t.nextPath();){const n=D8e(t);e=Math.min(n[0],e),r=Math.min(n[1],r),i=Math.max(n[2],i),s=Math.max(n[3],s)}return si([e,r,i,s])}function D8e(t){let e,i,r,s;for(e=r=1/0,i=s=-1/0;t.nextPoint();)e=Math.min(t.x,e),r=Math.min(t.y,r),i=Math.max(t.x,i),s=Math.max(t.y,s);return si([e,r,i,s])}function qqt(t,e){return CEe(e)?V$(t,e.paths,!0,!1):$Ee(e)?V$(t,e.rings,!0,!1):TEe(e)?Fie(t,e.points,!0,!1,!0,!1):SEe(e)?MEe(t,e,!0,!1,!0,!1):(EEe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function V$(t,e,i,r){const s=i?3:2;if(!e.length||!e[0].length)return null;let n,o,a,l,[c,h]=e[0][0],[d,f]=e[0][0];for(let m=0;m<e.length;m++){const g=e[m];for(let v=0;v<g.length;v++){const _=g[v],[b,w]=_;if(c=tb(c,b),h=tb(h,w),d=ib(d,b),f=ib(f,w),i&&_.length>2){const x=_[2];n=tb(n,x),o=ib(o,x)}if(r&&_.length>s){const x=_[s];a=tb(n,x),l=ib(o,x)}}}return i?r?(t[0]=c,t[1]=h,t[2]=n,t[3]=a,t[4]=d,t[5]=f,t[6]=o,t[7]=l,t.length=8,t):(t[0]=c,t[1]=h,t[2]=n,t[3]=d,t[4]=f,t[5]=o,t.length=6,t):r?(t[0]=c,t[1]=h,t[2]=a,t[3]=d,t[4]=f,t[5]=l,t.length=6,t):(t[0]=c,t[1]=h,t[2]=d,t[3]=f,t.length=4,t)}function MEe(t,e,i,r,s,n){const o=e.xmin,a=e.xmax,l=e.ymin,c=e.ymax;let h=e.zmin,d=e.zmax,f=e.mmin,m=e.mmax;return s?(h=h||0,d=d||0,n?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=h,t[3]=f,t[4]=a,t[5]=c,t[6]=d,t[7]=m,t):(t[0]=o,t[1]=l,t[2]=h,t[3]=a,t[4]=c,t[5]=d,t)):n?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=f,t[3]=a,t[4]=c,t[5]=m,t):(t[0]=o,t[1]=l,t[2]=a,t[3]=c,t)}function Fie(t,e,i,r,s,n){const o=i?3:2,a=r&&n,l=i&&s;if(!e.length||!e[0].length)return null;let c,h,d,f,[m,g]=e[0],[v,_]=e[0];for(let b=0;b<e.length;b++){const w=e[b],[x,S]=w;if(m=tb(m,x),g=tb(g,S),v=ib(v,x),_=ib(_,S),l&&w.length>2){const C=w[2];c=tb(c,C),h=ib(h,C)}if(a&&w.length>o){const C=w[o];d=tb(c,C),f=ib(h,C)}}return s?(c=c||0,h=h||0,n?(d=d||0,f=f||0,t[0]=m,t[1]=g,t[2]=c,t[3]=d,t[4]=v,t[5]=_,t[6]=h,t[7]=f,t):(t[0]=m,t[1]=g,t[2]=c,t[3]=v,t[4]=_,t[5]=h,t)):n?(d=d||0,f=f||0,t[0]=m,t[1]=g,t[2]=d,t[3]=v,t[4]=_,t[5]=f,t):(t[0]=m,t[1]=g,t[2]=v,t[3]=_,t)}function L8e(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function N8e(t){return t.points!==void 0}function F8e(t){return t.x!==void 0&&t.y!==void 0}function k8e(t){return t.paths!==void 0}function z8e(t){return t.rings!==void 0}const kie=[];function OEe(t,e,i,r){return{xmin:t,ymin:e,xmax:i,ymax:r}}function IEe(t,e,i,r,s,n){return{xmin:t,ymin:e,zmin:i,xmax:r,ymax:s,zmax:n}}function REe(t,e,i,r,s,n){return{xmin:t,ymin:e,mmin:i,xmax:r,ymax:s,mmax:n}}function PEe(t,e,i,r,s,n,o,a){return{xmin:t,ymin:e,zmin:i,mmin:r,xmax:s,ymax:n,zmax:o,mmax:a}}function zie(t,e=!1,i=!1){return e?i?PEe(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):IEe(t[0],t[1],t[2],t[3],t[4],t[5]):i?REe(t[0],t[1],t[2],t[3],t[4],t[5]):OEe(t[0],t[1],t[2],t[3])}function Wqt(t){return t?L8e(t)?t:F8e(t)?B8e(t):z8e(t)?DEe(t):k8e(t)?LEe(t):N8e(t)?U8e(t):null:null}function U8e(t){const{hasZ:e,hasM:i,points:r}=t;return zie(Fie(kie,r,e??!1,i??!1),e,i)}function B8e(t){const{x:e,y:i,z:r,m:s}=t,n=s!=null;return r!=null?n?PEe(e,i,r,s,e,i,r,s):IEe(e,i,r,e,i,r):n?REe(e,i,s,e,i,s):OEe(e,i,e,i)}function DEe(t){const{hasZ:e,hasM:i,rings:r}=t,s=V$(kie,r,e??!1,i??!1);return s?zie(s,e,i):null}function LEe(t){const{hasZ:e,hasM:i,paths:r}=t,s=V$(kie,r,e??!1,i??!1);return s?zie(s,e,i):null}var x4;function gue(t){return!Array.isArray(t[0])}function V8e(t){var e;return typeof((e=t[0])==null?void 0:e[0])=="number"}function j8e(t){var n,o;if(!t)return;let{rings:e,hasM:i,hasZ:r,spatialReference:s}=t;switch(e??(e=[]),V8e(e)&&(e=[e]),(o=(n=e[0])==null?void 0:n[0])==null?void 0:o.length){case 4:r??(r=!0),i??(i=!0);break;case 3:r??(r=i!==!0),i??(i=!r);break;default:r??(r=!1),i??(i=!1)}return s??(s=Oe.WGS84),{...t,hasM:i,hasZ:r,rings:e,spatialReference:s}}let Uh=x4=class extends mg{static fromExtent(t){const e=t.clone().normalize(),{spatialReference:i}=t;let r=!1,s=!1;for(const o of e)o.hasZ&&(r=!0),o.hasM&&(s=!0);const n={rings:e.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(r&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:i};return r&&(n.hasZ=!0),s&&(n.hasM=!0),new x4(n)}constructor(t){super(j8e(t)),this.curveRings=void 0,this.rings=[],this.type="polygon"}get cache(){return this.commitProperty("curveRings"),this.commitProperty("hasM"),this.commitProperty("hasZ"),this.commitProperty("rings"),this.commitProperty("spatialReference"),{}}get centroid(){const t=x8e(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new Fe;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}writeCurveRings(t,e){e.curveRings=q(t)}get extent(){const t=DEe(this),{spatialReference:e}=this;return t?new _i({...t,spatialReference:e}):null}get isSelfIntersecting(){return u8e(this.rings)}writeRings(t,e){e.rings=q(this.rings)}addRing(t){if(!t)return;const e=this.rings,i=e.length;if(gue(t)){const r=[];for(let s=0,n=t.length;s<n;s++)r[s]=t[s].toArray();e[i]=r}else e[i]=t.slice();return this.notifyChange("rings"),this}clone(){const t=new x4;return t.spatialReference=this.spatialReference,t.rings=q(this.rings),t.curveRings=q(this.curveRings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,i=t.spatialReference;if(e!=null!=(i!=null)||e!=null&&i!=null&&!e.equals(i)||this.rings.length!==t.rings.length)return!1;const r=([s,n,o,a],[l,c,h,d])=>s===l&&n===c&&(o==null&&h==null||o===h)&&(a==null&&d==null||a===d);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=t.rings[s];if(!eg(n,o,r))return!1}return!0}contains(t){if(!t)return!1;const e=VD(t,this.spatialReference);return Die(this,e??t)}isClockwise(t){const e=gue(t)?t.map(i=>this.hasZ?this.hasM?[i.x,i.y,i.z,i.m]:[i.x,i.y,i.z]:[i.x,i.y]):t;return eb(e)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.rings[t][e],r=this.hasZ,s=this.hasM;return r&&!s?new Fe(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new Fe(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new Fe(i[0],i[1],i[2],i[3],this.spatialReference):new Fe(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(B$(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t].splice(e,0,i),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new Fe(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],i=this.spatialReference,r=e.map(s=>new Fe(s,i));return this.notifyChange("rings"),r}setPoint(t,e,i){return this._validateInputs(t,e)?(B$(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t][e]=i,this.notifyChange("rings"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const r=this.rings[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};u([p({readOnly:!0})],Uh.prototype,"cache",null),u([p({readOnly:!0})],Uh.prototype,"centroid",null),u([p({json:{write:!0,origins:{"portal-item":{write:!1},"web-map":{write:!1},"web-scene":{write:!1}}}})],Uh.prototype,"curveRings",void 0),u([_e("curveRings")],Uh.prototype,"writeCurveRings",null),u([p({readOnly:!0})],Uh.prototype,"extent",null),u([p({readOnly:!0})],Uh.prototype,"isSelfIntersecting",null),u([p({type:[[[Number]]],json:{write:{isRequired:!0}}})],Uh.prototype,"rings",void 0),u([_e("rings")],Uh.prototype,"writeRings",null),Uh=x4=u([A("esri.geometry.Polygon")],Uh);const Ea=Uh;Uh.prototype.toJSON.isDefaultToJSON=!0;var fZ;function G8e(t){return!Array.isArray(t[0])}function H8e(t){var e;return typeof((e=t[0])==null?void 0:e[0])=="number"}function q8e(t){var n,o;if(!t)return;let{paths:e,hasM:i,hasZ:r,spatialReference:s}=t;switch(e??(e=[]),H8e(e)&&(e=[e]),(o=(n=e[0])==null?void 0:n[0])==null?void 0:o.length){case 4:r??(r=!0),i??(i=!0);break;case 3:r??(r=i!==!0),i??(i=!r);break;default:r??(r=!1),i??(i=!1)}return s??(s=Oe.WGS84),{...t,hasM:i,hasZ:r,paths:e,spatialReference:s}}let vm=fZ=class extends mg{constructor(t){super(q8e(t)),this.curvePaths=void 0,this.paths=[],this.type="polyline"}get cache(){return this.commitProperty("curvePaths"),this.commitProperty("hasM"),this.commitProperty("hasZ"),this.commitProperty("paths"),this.commitProperty("spatialReference"),{}}writeCurvePaths(t,e){e.curvePaths=q(t)}get extent(){const t=LEe(this),{spatialReference:e}=this;return t?new _i({...t,spatialReference:e}):null}writePaths(t,e){e.paths=q(this.paths)}addPath(t){if(!t)return;const e=this.paths,i=e.length;if(G8e(t)){const r=[];for(let s=0,n=t.length;s<n;s++)r[s]=t[s].toArray();e[i]=r}else e[i]=t.slice();return this.notifyChange("paths"),this}clone(){const t=new fZ;return t.spatialReference=this.spatialReference,t.paths=q(this.paths),t.curvePaths=q(this.curvePaths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.paths[t][e],r=this.hasZ,s=this.hasM;return r&&!s?new Fe(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new Fe(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new Fe(i[0],i[1],i[2],i[3],this.spatialReference):new Fe(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(B$(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t].splice(e,0,i),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],i=this.spatialReference,r=e.map(s=>new Fe(s,i));return this.notifyChange("paths"),r}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new Fe(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(t,e,i){return this._validateInputs(t,e)?(B$(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t][e]=i,this.notifyChange("paths"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const r=this.paths[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};u([p({readOnly:!0})],vm.prototype,"cache",null),u([p({json:{write:!0,origins:{"portal-item":{write:!1},"web-map":{write:!1},"web-scene":{write:!1}}}})],vm.prototype,"curvePaths",void 0),u([_e("curvePaths")],vm.prototype,"writeCurvePaths",null),u([p({readOnly:!0})],vm.prototype,"extent",null),u([p({type:[[[Number]]],json:{write:{isRequired:!0}}})],vm.prototype,"paths",void 0),u([_e("paths")],vm.prototype,"writePaths",null),vm=fZ=u([A("esri.geometry.Polyline")],vm);const _d=vm;vm.prototype.toJSON.isDefaultToJSON=!0;function NEe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function Uie(t){return t.points!==void 0}function Bie(t){return t.x!==void 0&&t.y!==void 0}function Jj(t){return t.paths!==void 0||t.curvePaths!==void 0}function wb(t){return t.rings!==void 0||t.curveRings!==void 0}function pf(t){return t==null?null:t instanceof mg?t:Bie(t)?Fe.fromJSON(t):Jj(t)?_d.fromJSON(t):wb(t)?Ea.fromJSON(t):Uie(t)?WS.fromJSON(t):NEe(t)?_i.fromJSON(t):null}function HD(t){return t?Bie(t)?"esriGeometryPoint":Jj(t)?"esriGeometryPolyline":wb(t)?"esriGeometryPolygon":NEe(t)?"esriGeometryEnvelope":Uie(t)?"esriGeometryMultipoint":null:null}const W8e={esriGeometryPoint:Fe,esriGeometryPolyline:_d,esriGeometryPolygon:Ea,esriGeometryEnvelope:_i,esriGeometryMultipoint:WS,esriGeometryMultiPatch:Ea};function Z8e(t){return t&&W8e[t]||null}const FEe=Oo()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),yue=Oo()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"}),eM={base:mg,key:"type",typeMap:{extent:_i,multipoint:WS,point:Fe,polyline:_d,polygon:Ea}};var mZ;let k0=mZ=class extends ee{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new mZ({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};u([p({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:BH}}}}})],k0.prototype,"rotation",void 0),u([ti("rotation")],k0.prototype,"castRotation",null),u([p({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:BH}}}}})],k0.prototype,"scale",void 0),u([p({types:eM,json:{read:pf,write:!0,origins:{"web-scene":{read:pf,write:{overridePolicy:BH}}}}})],k0.prototype,"targetGeometry",void 0),u([p({type:ou,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}})],k0.prototype,"camera",void 0),k0=mZ=u([A("esri.Viewpoint")],k0);const Qr=k0;function BH(){return{enabled:!this.camera}}let Ss=class kEe{constructor(){this._emitter=new kEe.EventEmitter(this)}emit(e,i){return this._emitter.emit(e,i)}on(e,i){return this._emitter.on(e,i)}once(e,i){return this._emitter.once(e,i)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(s=null){this._target=s,this._listenersMap=null}clear(){var s;(s=this._listenersMap)==null||s.clear(),this._listenersMap=null}destroy(){this.clear()}emit(s,n){var c;let o=(c=this._listenersMap)==null?void 0:c.get(s);if(!o)return!1;const a=this._target||this;let l=!1;for(const h of o.slice()){const d="deref"in h?h.deref():h;d?d==null||d.call(a,n):l=!0}return l&&(o=o.filter(h=>!("deref"in h)||h.deref()!=null),this._listenersMap.set(s,o)),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return LD(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap??(this._listenersMap=new Map);const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),Pi(()=>{var c;const a=(c=this._listenersMap)==null?void 0:c.get(s),l=(a==null?void 0:a.indexOf(n))??-1;l>=0&&a.splice(l,1)})}once(s,n){const o=this.on(s,a=>{o.remove();const l="deref"in n?n.deref():n;l==null||l.call(null,a)});return o}hasEventListener(s){var o;const n=(o=this._listenersMap)==null?void 0:o.get(s);return n!=null&&n.length>0}}t.EventEmitter=e,t.EventedMixin=r=>{let s=class extends r{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=u([A("esri.core.Evented")],s),s};let i=class extends he{constructor(){super(...arguments),this._emitter=new Ss.EventEmitter(this)}destroy(){this._emitter.clear()}emit(r,s){return this._emitter.emit(r,s)}on(r,s){return this._emitter.on(r,s)}once(r,s){return this._emitter.once(r,s)}hasEventListener(r){return this._emitter.hasEventListener(r)}};i=u([A("esri.core.Evented.EventedAccessor")],i),t.EventedAccessor=i})(Ss);var Er;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(Er||(Er={}));function Vie(t){return(e,i)=>{e[i]=t}}let qD=class extends zSe{notify(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onInvalidated(),r.onCommitted()}}};var Fy;let Y8e=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}},J8e=class{constructor(e,i,r,s,n){this.target=e,this.added=i,this.removed=r,this.start=s,this.deleteCount=n}};const _h=new Ol(Y8e,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1});function vue(t){t&&typeof t=="object"&&"destroy"in t&&typeof t.destroy=="function"&&t.destroy()}function VH(t){return t?t instanceof My?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function jH(t){if(t!=null&&t.length)return t[0]}function X8e(t,e,i,r){const s=Math.min(t.length-i,e.length-r);let n=0;for(;n<s&&t[i+n]===e[r+n];)n++;return n}function zEe(t,e,i,r){e&&e.forEach((s,n,o)=>{t.push(s),zEe(t,i.call(r,s,n,o),i,r)})}const o0=new Set,a0=new Set,l0=new Set,GH=new Map;let K8e=0,My=Fy=class extends Ss.EventedAccessor{static isCollection(t){return t!=null&&t instanceof Fy}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._updating=!1,this._timer=null,this._observable=new qD,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:K8e++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof Fy?{items:t}:t:{}}destroy(){this._removeAllRaw(),this._timer&&this._timer.remove(),this._emitter.destroy(),this._notifications=null}*[Symbol.iterator](){yield*this.items}get items(){return Pt(this._observable),this._items}set items(t){this._emitBeforeChanges(Er.ADD)||(this._splice(0,this.length,VH(t)),this._emitAfterChanges(Er.ADD))}hasEventListener(t){return!this.destroyed&&(t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t))}on(t,e){if(this.destroyed)return Pi();if(t==="change"){const i=this._chgListeners,r={removed:!1,callback:e};return i.push(r),this._notifications&&this._notifications.push({listeners:i.slice(),items:this._items.slice(),changes:[]}),Pi(()=>{r.removed=!0,i.splice(i.indexOf(r),1)})}return this._emitter.on(t,e)}once(t,e){const i="deref"in e?()=>e.deref():()=>e,r=this.on(t,s=>{var n;(n=i())==null||n.call(null,s),r.remove()});return r}add(t,e){if(Pt(this._observable),this._emitBeforeChanges(Er.ADD))return this;const i=this.getNextIndex(e??null);return this._splice(i,0,[t]),this._emitAfterChanges(Er.ADD),this}addMany(t,e=this._items.length){if(Pt(this._observable),!(t!=null&&t.length))return this;if(this._emitBeforeChanges(Er.ADD))return this;const i=this.getNextIndex(e);return this._splice(i,0,VH(t)),this._emitAfterChanges(Er.ADD),this}at(t){if(Pt(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(Pt(this._observable),!this.length||this._emitBeforeChanges(Er.REMOVE))return[];const t=this._removeAllRaw();return this._emitAfterChanges(Er.REMOVE),t}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return Pt(this._observable),this._createNewInstance({items:this._items.map(q)})}concat(...t){Pt(this._observable);const e=t.map(VH);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(Pt(this._observable),!this.length||this._emitBeforeChanges(Er.REMOVE))return;const i=this._splice(0,this.length),r=i.length;for(let s=0;s<r;s++)t.call(e,i[s],s,i);this._emitAfterChanges(Er.REMOVE)}destroyAll(){this.drain(vue)}destroyMany(t){const e=this.removeMany(t);return e.forEach(vue),e}every(t,e){return Pt(this._observable),this._items.every(t,e)}filter(t,e){Pt(this._observable);const i=arguments.length===2?this._items.filter(t,e):this._items.filter(t);return this._createNewInstance({items:i})}find(t,e){return Pt(this._observable),this._items.find(t,e)}findIndex(t,e){return Pt(this._observable),this._items.findIndex(t,e)}flatten(t,e){Pt(this._observable);const i=[];return zEe(i,this,t,e),new Fy(i)}forEach(t,e){return Pt(this._observable),this._items.forEach(t,e)}getItemAt(t){return Pt(this._observable),this._items[t]}getNextIndex(t){Pt(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return Pt(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return Pt(this._observable),this._items.indexOf(t,e)}join(t=","){return Pt(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return Pt(this._observable),this._items.lastIndexOf(t,e)}map(t,e){Pt(this._observable);const i=this._items.map(t,e);return new Fy({items:i})}reorder(t,e=this.length-1){Pt(this._observable);const i=this.indexOf(t);if(i!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),i!==e){if(this._emitBeforeChanges(Er.MOVE))return t;this._splice(i,1),this._splice(e,0,[t]),this._emitAfterChanges(Er.MOVE)}return t}}pop(){if(Pt(this._observable),!this.length||this._emitBeforeChanges(Er.REMOVE))return;const t=jH(this._splice(this.length-1,1));return this._emitAfterChanges(Er.REMOVE),t}push(...t){return Pt(this._observable),this._emitBeforeChanges(Er.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(Er.ADD)),this.length}reduce(t,e){Pt(this._observable);const i=this._items;return arguments.length===2?i.reduce(t,e):i.reduce(t)}reduceRight(t,e){Pt(this._observable);const i=this._items;return arguments.length===2?i.reduceRight(t,e):i.reduceRight(t)}remove(t){return Pt(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(Pt(this._observable),t<0||t>=this.length||this._emitBeforeChanges(Er.REMOVE))return;const e=jH(this._splice(t,1));return this._emitAfterChanges(Er.REMOVE),e}removeMany(t){if(Pt(this._observable),!(t!=null&&t.length)||this._emitBeforeChanges(Er.REMOVE))return[];const e=t instanceof Fy?t.toArray():t,i=this._items,r=[],s=e.length;for(let n=0;n<s;n++){const o=e[n],a=i.indexOf(o);if(a>-1){const l=1+X8e(e,i,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&r.push.apply(r,c),n+=l-1}}return this._emitAfterChanges(Er.REMOVE),r}reverse(){if(Pt(this._observable),this._emitBeforeChanges(Er.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(Er.MOVE),this}shift(){if(Pt(this._observable),!this.length||this._emitBeforeChanges(Er.REMOVE))return;const t=jH(this._splice(0,1));return this._emitAfterChanges(Er.REMOVE),t}slice(t=0,e=this.length){return Pt(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return Pt(this._observable),this._items.some(t,e)}sort(t){if(Pt(this._observable),!this.length||this._emitBeforeChanges(Er.MOVE)||!this._requiresSort(t))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(Er.MOVE),this}_requiresSort(t=(e,i)=>e===i?0:e<i?-1:1){const e=this.length-1;for(let i=0;i<e;i++)if(t(this.items[i],this.items[i+1])>0)return!0;return!1}splice(t,e,...i){Pt(this._observable);const r=(e?Er.REMOVE:0)|(i.length?Er.ADD:0);if(this._emitBeforeChanges(r))return[];const s=this._splice(t,e,i)||[];return this._emitAfterChanges(r),s}toArray(){return Pt(this._observable),this._items.slice()}toJSON(){return Pt(this._observable),this.toArray()}toLocaleString(){return Pt(this._observable),this._items.toLocaleString()}toString(){return Pt(this._observable),this._items.toString()}unshift(...t){return Pt(this._observable),!t.length||this._emitBeforeChanges(Er.ADD)||(this._splice(0,0,t),this._emitAfterChanges(Er.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,i){const r=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._updating=!0,this._timer=YA(()=>this._dispatchChange())),t<0&&(t+=this.length),e){if(o=r.splice(t,e),this.hasEventListener("before-remove")){const a=_h.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),r.splice(t,0,n),t+=1,l-=1,c-=1);_h.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=_h.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);_h.release(a)}}if(i!=null&&i.length){if(s){const h=[];for(const d of i){const f=s.ensureType(d);f==null&&d!=null||h.push(f)}i=h}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(a||l){const h=_h.acquire();h.target=this,h.cancellable=!0;const d=_h.acquire();d.target=this,d.cancellable=!1;for(const f of i)a?(h.reset(f),this.emit("before-add",h),h.defaultPrevented||(c?r.push(f):r.splice(t++,0,f),this._set("length",r.length),l&&(d.reset(f),this.emit("after-add",d)))):(c?r.push(f):r.splice(t++,0,f),this._set("length",r.length),d.reset(f),this.emit("after-add",d));_h.release(d),_h.release(h)}else{if(c)for(const h of i)r.push(h);else r.splice(t,0,...i);this._set("length",r.length)}}if((i!=null&&i.length||o!=null&&o.length)&&this._notifyChangeEvent(i,o),this.hasEventListener("after-splice")){const a=new J8e(this,i,o,t,e);this.emit("after-splice",a)}return o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const i=_h.acquire();i.target=this,i.cancellable=!0,i.type=t,this.emit("before-changes",i),e=i.defaultPrevented,_h.release(i)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=_h.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),_h.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}get updating(){return this._updating}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),this._updating=!1,!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const i=e.changes;o0.clear(),a0.clear(),l0.clear();for(const{added:l,removed:c}of i){if(l)if(l0.size===0&&a0.size===0)for(const h of l)o0.add(h);else for(const h of l)a0.has(h)?(l0.add(h),a0.delete(h)):l0.has(h)||o0.add(h);if(c)if(l0.size===0&&o0.size===0)for(const h of c)a0.add(h);else for(const h of c)o0.has(h)?o0.delete(h):(l0.delete(h),a0.add(h))}const r=sc.acquire();o0.forEach(l=>{r.push(l)});const s=sc.acquire();a0.forEach(l=>{s.push(l)});const n=this._items,o=e.items,a=sc.acquire();if(l0.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),e.listeners&&(r.length||s.length||a.length)){const l={target:this,added:r,removed:s,moved:a},c=e.listeners.length;for(let h=0;h<c;h++){const d=e.listeners[h];d.removed||d.callback.call(this,l)}}sc.release(r),sc.release(s),sc.release(a)}o0.clear(),a0.clear(),l0.clear()}};My.ofType=t=>{if(!t)return Fy;if(GH.has(t))return GH.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const r in t.typeMap){const s=t.typeMap[r].prototype.declaredClass;e?e+=` | ${s}`:e=s}let i=class extends Fy{};return u([Vie({Type:t,ensureType:typeof t=="function"?Ds(t):Ad(t)})],i.prototype,"itemType",void 0),i=u([A(`esri.core.Collection<${e}>`)],i),GH.set(t,i),i},u([p()],My.prototype,"_updating",void 0),u([p()],My.prototype,"length",void 0),u([p()],My.prototype,"items",null),u([p({readOnly:!0})],My.prototype,"updating",null),My=Fy=u([A("esri.core.Collection")],My);const Ce=My;function jie(t,e,i){return zj(t.map((r,s)=>e.apply(i,[r,s])))}async function Q8e(t,e,i){return(await zj(t.map((r,s)=>e.apply(i,[r,s])))).map(r=>r.value)}function Gie(t){return{ok:!0,value:t}}function Hie(t){return{ok:!1,error:t}}function eqe(t){return t!=null&&t.ok===!0?t.value:null}function tqe(t){return t!=null&&t.ok===!1?t.error:null}async function ff(t){if(t==null)return{ok:!1,error:new Error("no promise provided")};try{return Gie(await t)}catch(e){return Hie(e)}}async function iqe(t){try{return Gie(await t)}catch(e){return Wc(e),Hie(e)}}function Xqt(t){if(t.ok===!0)return t.value;throw t.error}function gg(t,e){return new z0(t,e)}let z0=class extends he{get value(){return eqe(this._result)}get error(){return tqe(this._result)}get finished(){return this._result!=null}constructor(e,i){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=fc(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:r}=this._abortController;this.promise=e(r),this.promise.then(s=>{this._result=Gie(s),this._cleanup()},s=>{this._result=Hie(s),this._cleanup()}),this._abortHandle=Qo(i,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=Ji(this._abortHandle),this._abortController=null}};u([p()],z0.prototype,"value",null),u([p()],z0.prototype,"error",null),u([p()],z0.prototype,"finished",null),u([p()],z0.prototype,"promise",void 0),u([p()],z0.prototype,"_result",void 0),z0=u([A("esri.core.asyncUtils.ReactiveTask")],z0);function H(t,e,i={}){return qie(t,e,i,UEe)}function bn(t,e,i={}){return qie(t,e,i,BEe)}function qie(t,e,i={},r){let s=null;const n=i.once?(o,a)=>{r(o)&&(Ji(s),e(o,a))}:(o,a)=>{r(o)&&e(o,a)};if(s=ZGe(t,n,i.sync,i.equals),i.initial){const o=t();n(o,o)}return s}function so(t,e,i,r={}){let s=null,n=null,o=null;function a(){var h;s&&n&&(n.remove(),(h=r.onListenerRemove)==null||h.call(r,s),s=null,n=null)}function l(h){r.once&&r.once&&Ji(o),i(h)}const c=H(t,(h,d)=>{var f;a(),kj(h)&&(s=h,n=ZA(h,e,l),(f=r.onListenerAdd)==null||f.call(r,h))},{sync:r.sync,initial:!0});return o=Pi(()=>{c.remove(),a()}),o}function Id(t,e){return rqe(t,BEe,e)}function rqe(t,e,i){if(Sa(i))return Promise.reject(bi());const r=t();if(e!=null&&e(r))return Promise.resolve(r);let s=null;function n(){s=Ji(s)}return new Promise((o,a)=>{s=LD([Qo(i,()=>{n(),a(bi())}),qie(t,l=>{n(),o(l)},{sync:!1,once:!0},e??UEe)])})}function UEe(t){return!0}function BEe(t){return!!t}function sqe(t,e,i={}){let r=!1;const s=H(t,(n,o)=>{r||e(n,o)},i);return{remove(){s.remove()},pause(){r=!0},resume(){r=!1}}}function nqe(t,e){const i=new Ce,r=so(t,"after-splice",({added:s,start:n,deleteCount:o})=>{const a=i.splice(n,o);for(const l of a)l.remove();if(s!=null&&s.length){const l=s.map(e);i.addMany(l,n)}},{sync:!0,onListenerRemove:()=>i.drain(s=>s.remove()),onListenerAdd:s=>i.addMany(s.items.map(e))});return i.addHandles(r),i}function Qqt(t,e){const i=new Ce,r=nqe(t,a=>gg(async l=>{const c=await e(a,l);if(Sa(l))throw c.remove(),bi();return c})),s=()=>null,n=async a=>{const l=await a.promise,c=r.indexOf(a);c<0||i.splice(c,1,l)};i.addMany(r.items.map(s));for(const a of r)a3(n(a));const o=r.on("after-splice",({added:a,start:l,deleteCount:c})=>{const h=i.splice(l,c);for(const d of h)d==null||d.remove();if(a!=null&&a.length){i.addMany(a.map(s),l);for(const d of a)a3(n(d))}});return i.addHandles([ySe(r),o]),i}const Yt={sync:!0},Ut={initial:!0},Mt={sync:!0,initial:!0};let PE=class extends Ce{constructor(e){super(e),this.getCollections=null}initialize(){this.addHandles(XSe(()=>this._refresh(),Yt))}destroy(){this.getCollections=null}_refresh(){const e=this.getCollections!=null?this.getCollections():null;if(e==null)return void this.removeAll();let i=0;for(const r of e)r!=null&&(i=this._processCollection(i,r));this.splice(i,this.length)}_createNewInstance(e){return new Ce(e)}_processCollection(e,i){if(!i)return e;const r=this.itemFilterFunction??(s=>!!s);for(const s of i)if(s){if(r(s)){const n=this.indexOf(s,e);n>=0?n!==e&&this.reorder(s,e):this.add(s,e),++e}if(this.getChildrenFunction){const n=this.getChildrenFunction(s);if(Array.isArray(n))for(const o of n)e=this._processCollection(e,o);else e=this._processCollection(e,n)}}return e}};u([p()],PE.prototype,"getCollections",void 0),u([p()],PE.prototype,"getChildrenFunction",void 0),u([p()],PE.prototype,"itemFilterFunction",void 0),PE=u([A("esri.core.CollectionFlattener")],PE);const j$=PE;let LU=class{constructor(e=i=>i.values().next().value){this._peeker=e,this._observable=new qD,this._items=new Set}get length(){return Pt(this._observable),this._items.size}clear(){this.length!==0&&(this._items.clear(),this._observable.notify())}last(){if(this.length===0)return;let e;for(e of this._items);return e}peek(){if(this.length!==0)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(e){return Pt(this._observable),this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const i=this.length;return this._items.forEach(r=>{e(r)||this._items.delete(r)}),i!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){Pt(this._observable),yield*this._items}};const VEe=new FinalizationRegistry(t=>{t.close()});function oqe(t,e){VEe.register(t,e,e)}function aqe(t){VEe.unregister(t)}function jEe(t,e){return new Proxy({},{get:(i,r,s)=>(...n)=>{let o,a;const l=n[n.length-1];return lqe(l)&&(o=l.signal,a=l.transferList,n.pop()),t.apply(e?`${e}.${r.toString()}`:r.toString(),n,{transferList:a,signal:o})}})}function lqe(t){return typeof t=="object"&&!Array.isArray(t)&&t!=null&&("signal"in t||"transferList"in t||Object.keys(t).length===0)}const cqe={statsWorker:()=>G(()=>import("./statsWorker-frReoajJ.js"),__vite__mapDeps([4,5,6,7,8])),geometryEngineWorker:()=>G(()=>import("./geometryEngineWorker-CA-tZxOm.js"),__vite__mapDeps([9,10,11,3,12])),arcadeGeometryOperatorsWorker:()=>G(()=>import("./operatorsWorker-Dh8DoKw2.js"),[]),CSVSourceWorker:()=>G(()=>import("./CSVSourceWorker-DDUFQv9g.js"),__vite__mapDeps([13,14,12,15,16,17,18,19,20,21,22,5,6,7,8,23,24,25,26,27,28,29])),EdgeProcessingWorker:()=>G(()=>import("./EdgeProcessingWorker-bhaYY9vs.js"),__vite__mapDeps([30,31,32,33])),ElevationSamplerWorker:()=>G(()=>import("./ElevationSamplerWorker-BIAu7-7B.js"),__vite__mapDeps([34,26,35,36])),FeatureServiceSnappingSourceWorker:()=>G(()=>import("./FeatureServiceSnappingSourceWorker-2S_G8aLC.js"),__vite__mapDeps([37,15,16,12,17,18,19,20,21,22,5,6,7,8,23,24,25,26,27,38,39,40,41])),GeoJSONSourceWorker:()=>G(()=>import("./GeoJSONSourceWorker-M29BTqDC.js"),__vite__mapDeps([42,15,16,12,17,18,19,20,21,22,5,6,7,8,23,24,25,26,27,43,14,29,44])),LercWorker:()=>G(()=>import("./LercWorker-4kIojDR0.js"),[]),MemorySourceWorker:()=>G(()=>import("./MemorySourceWorker-CjZmFiXG.js"),__vite__mapDeps([45,46,15,16,12,17,18,19,20,21,22,5,6,7,8,23,24,25,26,27,29,44,14])),PBFDecoderWorker:()=>G(()=>import("./PBFDecoderWorker-VhKqPoLQ.js"),__vite__mapDeps([47,39,40])),FeaturePipelineWorker:()=>G(()=>import("./FeaturePipelineWorker-CETIikGX.js"),__vite__mapDeps([48,49,50,51,52,16,12,21,20,53,54,55,56,57,58,59,60,61,62,63,64,27,17,18,19,22,5,6,7,8,23,65,66,67,68,41,39,40,69,43,14,29,44,70,71,72,73])),PointCloudWorker:()=>G(()=>import("./PointCloudWorker-SuqIoR2C.js"),__vite__mapDeps([74,75,76,77])),RasterWorker:()=>G(()=>import("./RasterWorker-DfNo7hdb.js"),__vite__mapDeps([78,79,80,81,3,82,83,84])),SceneLayerSnappingSourceWorker:()=>G(()=>import("./SceneLayerSnappingSourceWorker-CFVaKRva.js"),__vite__mapDeps([85,33,32])),SceneLayerWorker:()=>G(()=>import("./SceneLayerWorker-BuHrcuhg.js").then(t=>t.b),__vite__mapDeps([86,87,88,77])),WFSSourceWorker:()=>G(()=>import("./WFSSourceWorker-B1JtaKVu.js"),__vite__mapDeps([89,15,16,12,17,18,19,20,21,22,5,6,7,8,23,24,25,26,27,43,14,44,90,91])),WorkerTileHandler:()=>G(()=>import("./WorkerTileHandler-7CDi2FEQ.js"),__vite__mapDeps([92,56,40,61,93,94,54])),Lyr3DWorker:()=>G(()=>import("./Lyr3DWorker-3pG6dYDJ.js"),__vite__mapDeps([95,96,97])),Feature3DPipelineWorker:()=>G(()=>import("./Feature3DPipelineWorker-D6eg8-zv.js"),__vite__mapDeps([98,17,18,19,20,21,16,12,22,5,6,7,8,23,26,41,39,40,99,100])),TextureCompressionWorker:()=>G(()=>import("./TextureCompressionWorker-C2AJa2h_.js"),[])},GEe="worker:port-closed";var ya;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(ya||(ya={}));let uqe=0;function HEe(){return uqe++}function hqe(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function v3(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function Wie(t,e,i,r){if(e.type===ya.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==ya.INVOKE&&e.type!==ya.RESPONSE)return void t.postMessage(e);let s;if(hqe(i)?(s=_ue(i.transferList),e.data=i.result):(s=_ue(r),e.data=i),s){if(X("ff")){for(const n of s)if("byteLength"in n&&n.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case ya.INVOKE:throw o;case ya.RESPONSE:return void Wie(t,{type:ya.RESPONSE,jobId:e.jobId,error:v3(o)})}}}t.postMessage(e,s)}else t.postMessage(e)}function _3(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function _ue(t){if(!(t!=null&&t.length))return null;if(X("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(i=>!dqe(i));return e.length?e:null}function dqe(t){var e;return t instanceof ArrayBuffer||((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="ArrayBuffer"}async function i9t(t){try{return await t}catch(e){const i=(e==null?void 0:e.name)===GEe;if(!(es(e)||i))throw e;return}}const{CLOSE:bue,ABORT:wue,INVOKE:xue,RESPONSE:IM,OPEN_PORT:Sue,ON:pqe}=ya,fqe=2;let mqe=class{constructor(e){this._invoke=e,this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._timer=null,this._process=this._process.bind(this)}push(e){e.type===ya.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},Nb=class DE{static connect(e,i){const r=new MessageChannel;let s;s=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const n=new DE(r.port1,{channel:r,client:s,schedule:i});return typeof s=="object"&&"remoteClient"in s&&(s.remoteClient=n),DE.clients.set(n,s),r.port2}static loadWorker(e){const i=cqe[e];return i?i():Promise.resolve(null)}constructor(e,i,r){this._port=e,this._jobQueue=r,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new mqe(s=>this._onInvokeMessage(s)),this._client=i.client,this._onMessage=this._onMessage.bind(this),this._channel=i.channel,this._schedule=i.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:bue}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,i,r){return this.apply(e,[i],r)}apply(e,i,r){const s=r==null?void 0:r.signal,n=r==null?void 0:r.transferList;if(!this._port)return Promise.reject(new U(GEe,`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:i}));const o=HEe();return new Promise((a,l)=>{if(Sa(s))return this._processWork(),void l(bi());const c=Qo(s,()=>{const d=this._outJobs.get(o);d&&(this._outJobs.delete(o),this._processWork(),Ji(d.abortHandle),this._post({type:wue,jobId:o}),l(bi()))}),h={resolve:a,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(o,h),this._post({type:xue,jobId:o,methodName:e,abortable:s!=null},i,n)})}createInvokeProxy(e){return jEe(this,e)}on(e,i){const r=new MessageChannel;function s(n){i(n.data)}return this._port.postMessage({type:ya.ON,eventType:e,port:r.port2},[r.port2]),r.port1.addEventListener("message",s),r.port1.start(),Pi(()=>{r.port1.postMessage({type:ya.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",s)})}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:Sue,port:e.port2}),e.port1}_processWork(){var o;if(this._outJobs.size>=fqe)return;const e=(o=this._jobQueue)==null?void 0:o.pop();if(!e)return;const{methodName:i,data:r,invokeOptions:s,resolver:n}=e;this.apply(i,r,s).then(a=>n.resolve(a)).catch(a=>n.reject(a))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{Ji(e.abortHandle),e.reject(bi(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){this._schedule!=null?this._schedule(()=>this._processMessage(e,!0)):this._processMessage(e,!1)}_processMessage(e,i){const r=_3(e);if(r)switch(r.type){case IM:this._onResponseMessage(r);break;case xue:i?this._onInvokeMessage(r):this._invokeQueue.push(r);break;case wue:this._onAbortMessage(r);break;case bue:this._onCloseMessage();break;case Sue:this._onOpenPortMessage(r);break;case pqe:this._onOnMessage(r)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,s=i.get(r);this._invokeQueue.push(e),s&&(s.controller&&s.controller.abort(),i.delete(r))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&DE.clients.get(this)===e&&e.destroy(),DE.clients.delete(this),e!=null&&e.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:i,jobId:r,data:s=[],abortable:n}=e,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,h=c[i];try{if(!h&&i&&i.includes(".")){const d=i.split(".");for(let f=0;f<d.length-1;f++)c=c[d[f]],h=c[d[f+1]]}if(typeof h!="function")throw new TypeError(`${i} is not a function`);s.push({client:this,signal:o?o.signal:null}),l=h.apply(c,s)}catch(d){return void this._post({type:IM,jobId:r,error:v3(d)})}uu(l)?(a.set(r,{controller:o,promise:l}),l.then(d=>{a.has(r)&&(a.delete(r),this._post({type:IM,jobId:r},d))},d=>{a.has(r)&&(a.delete(r),es(d)||this._post({type:IM,jobId:r,error:v3(d||{message:`Error encountered at method ${i}`})}))})):this._post({type:IM,jobId:r},l)}_onOpenPortMessage(e){new DE(e.port,{client:this._client})}_onOnMessage(e){const{port:i}=e,r=this._client.on(e.eventType,n=>{i.postMessage(n)}),s=ZA(e.port,"message",n=>{const o=_3(n);(o==null?void 0:o.type)===ya.CLOSE&&(s.remove(),r.remove(),i.close())})}_onResponseMessage(e){const{jobId:i,error:r,data:s}=e,n=this._outJobs;if(!n.has(i))return;const o=n.get(i);n.delete(i),this._processWork(),Ji(o.abortHandle),r?o.reject(U.fromJSON(JSON.parse(r))):o.resolve(s)}_post(e,i,r){return Wie(this._port,e,i,r)}};Nb.kernelInfo={buildDate:ITe,fullVersion:xie,revision:RTe},Nb.clients=new Map;let gqe=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new LU}destroy(){this.close()}get closed(){var e;return!((e=this._clients)!=null&&e.length)}open(e,i){return new Promise((r,s)=>{let n=!0;const o=a=>{gt(i.signal),n&&(n=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const l=e[a];uu(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new Nb(c,i,this._ongoingJobsQueue),o(r),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new Nb(l,i,this._ongoingJobsQueue),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(r))}})}broadcast(e,i,r){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a==null?void 0:a.invoke(e,i,r))}return s}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(bi(`Worker closing, aborting job calling '${e.methodName}'`));for(const i of this._clientPromises)i.then(r=>r==null?void 0:r.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,aqe(this)}invoke(e,i,r){return this.apply(e,[i],r)}apply(e,i,r){const s=ta();this._ongoingJobsQueue.push({methodName:e,data:i,invokeOptions:r,resolver:s});for(let n=0;n<this._clientPromises.length;n++){const o=this._clients[n];o?o.jobAdded():this._clientPromises[n].then(a=>a==null?void 0:a.jobAdded())}return s.promise}createInvokeProxy(e){return jEe(this,e)}on(e,i){return Promise.all(this._clientPromises).then(()=>LD(this._clients.map(r=>r.on(e,i))))}openPorts(){return new Promise(e=>{const i=new Array(this._clientPromises.length);let r=i.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{n&&(i[s]=n.openPort()),--r==0&&e(i)})})}get test(){}};const yqe={async request(t,e){var o,a;const i=t.options,r=i.responseType;i.signal=e==null?void 0:e.signal,i.responseType=r==="native"||r==="native-request-init"?"native-request-init":r&&["blob","json","text"].includes(r)&&((o=VW(t.url))!=null&&o.after)?r:"array-buffer";const s=await Ri(t.url,i),n={data:s.data,httpStatus:s.httpStatus,ssl:s.ssl};switch((a=s.requestOptions)==null?void 0:a.responseType){case"native-request-init":return delete n.data.signal,n;case"blob":n.data=await n.data.arrayBuffer();break;case"json":n.data=new TextEncoder().encode(JSON.stringify(n.data)).buffer;break;case"text":n.data=new TextEncoder().encode(n.data).buffer}return{result:n,transferList:[n.data]}}};let ZR;var Bxe,Vxe;const vqe=((Bxe=globalThis.esriConfig)==null?void 0:Bxe.locale)??((Vxe=globalThis.dojoConfig)==null?void 0:Vxe.locale);var jxe;const YR=(jxe=globalThis.document)==null?void 0:jxe.documentElement;function qEe(){var i;const t=YR==null?void 0:YR.getAttribute("lang"),e=(i=globalThis.navigator)==null?void 0:i.language;return vqe??t??e??"en"}function iu(){return ZR===void 0&&(ZR=qEe()),ZR}function n9t(t=iu()){const e=/^([a-zA-Z]{2,3})(?:[_-][a-zA-Z0-9]+)*$/.exec(t);return e==null?void 0:e[1].toLowerCase()}const S4=[];function WEe(t){return S4.push(t),Pi(()=>S4.splice(S4.indexOf(t),1))}const T4=[];function Zie(t){return T4.push(t),Pi(()=>T4.splice(T4.indexOf(t),1))}function Tue(){const t=qEe();ZR!==t&&([...T4].forEach(e=>e(t)),ZR=t,[...S4].forEach(e=>e(t)))}var Gxe;(Gxe=globalThis.addEventListener)==null||Gxe.call(globalThis,"languagechange",Tue),YR&&new MutationObserver(()=>{Tue()}).observe(YR,{attributeFilter:["lang"]});const mf="system",wS="unknown",Fb="UTC",_qe=Intl.DateTimeFormat().resolvedOptions().timeZone,Eue=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Bishkek"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);class ZS extends Error{}class bqe extends ZS{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class wqe extends ZS{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class xqe extends ZS{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class Q2 extends ZS{}class ZEe extends ZS{constructor(e){super(`Invalid unit ${e}`)}}class _l extends ZS{}class c0 extends ZS{constructor(){super("Zone is an abstract class")}}const Qe="numeric",gf="short",sh="long",NU={year:Qe,month:Qe,day:Qe},YEe={year:Qe,month:gf,day:Qe},Sqe={year:Qe,month:gf,day:Qe,weekday:gf},JEe={year:Qe,month:sh,day:Qe},XEe={year:Qe,month:sh,day:Qe,weekday:sh},KEe={hour:Qe,minute:Qe},QEe={hour:Qe,minute:Qe,second:Qe},e2e={hour:Qe,minute:Qe,second:Qe,timeZoneName:gf},t2e={hour:Qe,minute:Qe,second:Qe,timeZoneName:sh},i2e={hour:Qe,minute:Qe,hourCycle:"h23"},r2e={hour:Qe,minute:Qe,second:Qe,hourCycle:"h23"},s2e={hour:Qe,minute:Qe,second:Qe,hourCycle:"h23",timeZoneName:gf},n2e={hour:Qe,minute:Qe,second:Qe,hourCycle:"h23",timeZoneName:sh},o2e={year:Qe,month:Qe,day:Qe,hour:Qe,minute:Qe},a2e={year:Qe,month:Qe,day:Qe,hour:Qe,minute:Qe,second:Qe},l2e={year:Qe,month:gf,day:Qe,hour:Qe,minute:Qe},c2e={year:Qe,month:gf,day:Qe,hour:Qe,minute:Qe,second:Qe},Tqe={year:Qe,month:gf,day:Qe,weekday:gf,hour:Qe,minute:Qe},u2e={year:Qe,month:sh,day:Qe,hour:Qe,minute:Qe,timeZoneName:gf},h2e={year:Qe,month:sh,day:Qe,hour:Qe,minute:Qe,second:Qe,timeZoneName:gf},d2e={year:Qe,month:sh,day:Qe,weekday:sh,hour:Qe,minute:Qe,timeZoneName:sh},p2e={year:Qe,month:sh,day:Qe,weekday:sh,hour:Qe,minute:Qe,second:Qe,timeZoneName:sh};class YS{get type(){throw new c0}get name(){throw new c0}get ianaName(){return this.name}get isUniversal(){throw new c0}offsetName(e,i){throw new c0}formatOffset(e,i){throw new c0}offset(e){throw new c0}equals(e){throw new c0}get isValid(){throw new c0}}let HH=null;class Xj extends YS{static get instance(){return HH===null&&(HH=new Xj),HH}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return x2e(e,i,r)}formatOffset(e,i){return JR(this.offset(e),i)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let E4={};function Eqe(t){return E4[t]||(E4[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),E4[t]}const Cqe={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function $qe(t,e){const i=t.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(i),[,s,n,o,a,l,c,h]=r;return[o,s,n,a,l,c,h]}function Aqe(t,e){const i=t.formatToParts(e),r=[];for(let s=0;s<i.length;s++){const{type:n,value:o}=i[s],a=Cqe[n];n==="era"?r[a]=o:vi(a)||(r[a]=parseInt(o,10))}return r}let lN={};class au extends YS{static create(e){return lN[e]||(lN[e]=new au(e)),lN[e]}static resetCache(){lN={},E4={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=au.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return x2e(e,i,r,this.name)}formatOffset(e,i){return JR(this.offset(e),i)}offset(e){const i=new Date(e);if(isNaN(i))return NaN;const r=Eqe(this.name);let[s,n,o,a,l,c,h]=r.formatToParts?Aqe(r,i):$qe(r,i);a==="BC"&&(s=-Math.abs(s)+1);const f=Qj({year:s,month:n,day:o,hour:l===24?0:l,minute:c,second:h,millisecond:0});let m=+i;const g=m%1e3;return m-=g>=0?g:1e3+g,(f-m)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let Cue={};function Mqe(t,e={}){const i=JSON.stringify([t,e]);let r=Cue[i];return r||(r=new Intl.ListFormat(t,e),Cue[i]=r),r}let gZ={};function yZ(t,e={}){const i=JSON.stringify([t,e]);let r=gZ[i];return r||(r=new Intl.DateTimeFormat(t,e),gZ[i]=r),r}let vZ={};function Oqe(t,e={}){const i=JSON.stringify([t,e]);let r=vZ[i];return r||(r=new Intl.NumberFormat(t,e),vZ[i]=r),r}let _Z={};function Iqe(t,e={}){const{base:i,...r}=e,s=JSON.stringify([t,r]);let n=_Z[s];return n||(n=new Intl.RelativeTimeFormat(t,e),_Z[s]=n),n}let qO=null;function Rqe(){return qO||(qO=new Intl.DateTimeFormat().resolvedOptions().locale,qO)}let $ue={};function Pqe(t){let e=$ue[t];if(!e){const i=new Intl.Locale(t);e="getWeekInfo"in i?i.getWeekInfo():i.weekInfo,$ue[t]=e}return e}function Dqe(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const i=t.indexOf("-u-");if(i===-1)return[t];{let r,s;try{r=yZ(t).resolvedOptions(),s=t}catch{const l=t.substring(0,i);r=yZ(l).resolvedOptions(),s=l}const{numberingSystem:n,calendar:o}=r;return[s,n,o]}}function Lqe(t,e,i){return(i||e)&&(t.includes("-u-")||(t+="-u"),i&&(t+=`-ca-${i}`),e&&(t+=`-nu-${e}`)),t}function Nqe(t){const e=[];for(let i=1;i<=12;i++){const r=St.utc(2009,i,1);e.push(t(r))}return e}function Fqe(t){const e=[];for(let i=1;i<=7;i++){const r=St.utc(2016,11,13+i);e.push(t(r))}return e}function cN(t,e,i,r){const s=t.listingMode();return s==="error"?null:s==="en"?i(e):r(e)}function kqe(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class zqe{constructor(e,i,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const{padTo:s,floor:n,...o}=r;if(!i||Object.keys(o).length>0){const a={useGrouping:!1,...r};r.padTo>0&&(a.minimumIntegerDigits=r.padTo),this.inf=Oqe(e,a)}}format(e){if(this.inf){const i=this.floor?Math.floor(e):e;return this.inf.format(i)}else{const i=this.floor?Math.floor(e):Qie(e,3);return vo(i,this.padTo)}}}class Uqe{constructor(e,i,r){this.opts=r,this.originalZone=void 0;let s;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const o=-1*(e.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;e.offset!==0&&au.create(a).valid?(s=a,this.dt=e):(s="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,s=e.zone.name):(s="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const n={...this.opts};n.timeZone=n.timeZone||s,this.dtf=yZ(i,n)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(i=>{if(i.type==="timeZoneName"){const r=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...i,value:r}}else return i}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class Bqe{constructor(e,i,r){this.opts={style:"long",...r},!i&&b2e()&&(this.rtf=Iqe(e,r))}format(e,i){return this.rtf?this.rtf.format(e,i):u9e(i,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,i){return this.rtf?this.rtf.formatToParts(e,i):[]}}const Vqe={firstDay:1,minimalDays:4,weekend:[6,7]};class Jr{static fromOpts(e){return Jr.create(e.locale,e.numberingSystem,e.outputCalendar,e.weekSettings,e.defaultToEN)}static create(e,i,r,s,n=!1){const o=e||Pn.defaultLocale,a=o||(n?"en-US":Rqe()),l=i||Pn.defaultNumberingSystem,c=r||Pn.defaultOutputCalendar,h=bZ(s)||Pn.defaultWeekSettings;return new Jr(a,l,c,h,o)}static resetCache(){qO=null,gZ={},vZ={},_Z={}}static fromObject({locale:e,numberingSystem:i,outputCalendar:r,weekSettings:s}={}){return Jr.create(e,i,r,s)}constructor(e,i,r,s,n){const[o,a,l]=Dqe(e);this.locale=o,this.numberingSystem=i||a||null,this.outputCalendar=r||l||null,this.weekSettings=s,this.intl=Lqe(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=n,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=kqe(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),i=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&i?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:Jr.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,bZ(e.weekSettings)||this.weekSettings,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,i=!1){return cN(this,e,E2e,()=>{const r=i?{month:e,day:"numeric"}:{month:e},s=i?"format":"standalone";return this.monthsCache[s][e]||(this.monthsCache[s][e]=Nqe(n=>this.extract(n,r,"month"))),this.monthsCache[s][e]})}weekdays(e,i=!1){return cN(this,e,A2e,()=>{const r=i?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},s=i?"format":"standalone";return this.weekdaysCache[s][e]||(this.weekdaysCache[s][e]=Fqe(n=>this.extract(n,r,"weekday"))),this.weekdaysCache[s][e]})}meridiems(){return cN(this,void 0,()=>M2e,()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[St.utc(2016,11,13,9),St.utc(2016,11,13,19)].map(i=>this.extract(i,e,"dayperiod"))}return this.meridiemCache})}eras(e){return cN(this,e,O2e,()=>{const i={era:e};return this.eraCache[e]||(this.eraCache[e]=[St.utc(-40,1,1),St.utc(2017,1,1)].map(r=>this.extract(r,i,"era"))),this.eraCache[e]})}extract(e,i,r){const s=this.dtFormatter(e,i),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===r);return o?o.value:null}numberFormatter(e={}){return new zqe(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,i={}){return new Uqe(e,this.intl,i)}relFormatter(e={}){return new Bqe(this.intl,this.isEnglish(),e)}listFormatter(e={}){return Mqe(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:w2e()?Pqe(this.locale):Vqe}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}toString(){return`Locale(${this.locale}, ${this.numberingSystem}, ${this.outputCalendar})`}}let qH=null;class xa extends YS{static get utcInstance(){return qH===null&&(qH=new xa(0)),qH}static instance(e){return e===0?xa.utcInstance:new xa(e)}static parseSpecifier(e){if(e){const i=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(i)return new xa(eG(i[1],i[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${JR(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${JR(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,i){return JR(this.fixed,i)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class jqe extends YS{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function B_(t,e){if(vi(t)||t===null)return e;if(t instanceof YS)return t;if(Yqe(t)){const i=t.toLowerCase();return i==="default"?e:i==="local"||i==="system"?Xj.instance:i==="utc"||i==="gmt"?xa.utcInstance:xa.parseSpecifier(i)||au.create(t)}else return xb(t)?xa.instance(t):typeof t=="object"&&"offset"in t&&typeof t.offset=="function"?t:new jqe(t)}const Yie={arab:"[-]",arabext:"[-]",bali:"[-]",beng:"[-]",deva:"[-]",fullwide:"[-]",gujr:"[-]",hanidec:"[|||||||||]",khmr:"[-]",knda:"[-]",laoo:"[-]",limb:"[-]",mlym:"[-]",mong:"[-]",mymr:"[-]",orya:"[-]",tamldec:"[-]",telu:"[-]",thai:"[-]",tibt:"[-]",latn:"\\d"},Aue={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},Gqe=Yie.hanidec.replace(/[\[|\]]/g,"").split("");function Hqe(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);if(t[i].search(Yie.hanidec)!==-1)e+=Gqe.indexOf(t[i]);else for(const s in Aue){const[n,o]=Aue[s];r>=n&&r<=o&&(e+=r-n)}}return parseInt(e,10)}else return e}let LE={};function qqe(){LE={}}function Zd({numberingSystem:t},e=""){const i=t||"latn";return LE[i]||(LE[i]={}),LE[i][e]||(LE[i][e]=new RegExp(`${Yie[i]}${e}`)),LE[i][e]}let Mue=()=>Date.now(),Oue="system",Iue=null,Rue=null,Pue=null,Due=60,Lue,Nue=null;class Pn{static get now(){return Mue}static set now(e){Mue=e}static set defaultZone(e){Oue=e}static get defaultZone(){return B_(Oue,Xj.instance)}static get defaultLocale(){return Iue}static set defaultLocale(e){Iue=e}static get defaultNumberingSystem(){return Rue}static set defaultNumberingSystem(e){Rue=e}static get defaultOutputCalendar(){return Pue}static set defaultOutputCalendar(e){Pue=e}static get defaultWeekSettings(){return Nue}static set defaultWeekSettings(e){Nue=bZ(e)}static get twoDigitCutoffYear(){return Due}static set twoDigitCutoffYear(e){Due=e%100}static get throwOnInvalid(){return Lue}static set throwOnInvalid(e){Lue=e}static resetCaches(){Jr.resetCache(),au.resetCache(),St.resetCache(),qqe()}}class Kp{constructor(e,i){this.reason=e,this.explanation=i}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const f2e=[0,31,59,90,120,151,181,212,243,273,304,334],m2e=[0,31,60,91,121,152,182,213,244,274,305,335];function bd(t,e){return new Kp("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function Jie(t,e,i){const r=new Date(Date.UTC(t,e-1,i));t<100&&t>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const s=r.getUTCDay();return s===0?7:s}function g2e(t,e,i){return i+(WD(t)?m2e:f2e)[e-1]}function y2e(t,e){const i=WD(t)?m2e:f2e,r=i.findIndex(n=>n<e),s=e-i[r];return{month:r+1,day:s}}function Xie(t,e){return(t-e+7)%7+1}function FU(t,e=4,i=1){const{year:r,month:s,day:n}=t,o=g2e(r,s,n),a=Xie(Jie(r,s,n),i);let l=Math.floor((o-a+14-e)/7),c;return l<1?(c=r-1,l=b3(c,e,i)):l>b3(r,e,i)?(c=r+1,l=1):c=r,{weekYear:c,weekNumber:l,weekday:a,...tG(t)}}function Fue(t,e=4,i=1){const{weekYear:r,weekNumber:s,weekday:n}=t,o=Xie(Jie(r,1,e),i),a=zC(r);let l=s*7+n-o-7+e,c;l<1?(c=r-1,l+=zC(c)):l>a?(c=r+1,l-=zC(r)):c=r;const{month:h,day:d}=y2e(c,l);return{year:c,month:h,day:d,...tG(t)}}function WH(t){const{year:e,month:i,day:r}=t,s=g2e(e,i,r);return{year:e,ordinal:s,...tG(t)}}function kue(t){const{year:e,ordinal:i}=t,{month:r,day:s}=y2e(e,i);return{year:e,month:r,day:s,...tG(t)}}function zue(t,e){if(!vi(t.localWeekday)||!vi(t.localWeekNumber)||!vi(t.localWeekYear)){if(!vi(t.weekday)||!vi(t.weekNumber)||!vi(t.weekYear))throw new Q2("Cannot mix locale-based week fields with ISO-based week fields");return vi(t.localWeekday)||(t.weekday=t.localWeekday),vi(t.localWeekNumber)||(t.weekNumber=t.localWeekNumber),vi(t.localWeekYear)||(t.weekYear=t.localWeekYear),delete t.localWeekday,delete t.localWeekNumber,delete t.localWeekYear,{minDaysInFirstWeek:e.getMinDaysInFirstWeek(),startOfWeek:e.getStartOfWeek()}}else return{minDaysInFirstWeek:4,startOfWeek:1}}function Wqe(t,e=4,i=1){const r=Kj(t.weekYear),s=wd(t.weekNumber,1,b3(t.weekYear,e,i)),n=wd(t.weekday,1,7);return r?s?n?!1:bd("weekday",t.weekday):bd("week",t.weekNumber):bd("weekYear",t.weekYear)}function Zqe(t){const e=Kj(t.year),i=wd(t.ordinal,1,zC(t.year));return e?i?!1:bd("ordinal",t.ordinal):bd("year",t.year)}function v2e(t){const e=Kj(t.year),i=wd(t.month,1,12),r=wd(t.day,1,kU(t.year,t.month));return e?i?r?!1:bd("day",t.day):bd("month",t.month):bd("year",t.year)}function _2e(t){const{hour:e,minute:i,second:r,millisecond:s}=t,n=wd(e,0,23)||e===24&&i===0&&r===0&&s===0,o=wd(i,0,59),a=wd(r,0,59),l=wd(s,0,999);return n?o?a?l?!1:bd("millisecond",s):bd("second",r):bd("minute",i):bd("hour",e)}function vi(t){return typeof t>"u"}function xb(t){return typeof t=="number"}function Kj(t){return typeof t=="number"&&t%1===0}function Yqe(t){return typeof t=="string"}function Jqe(t){return Object.prototype.toString.call(t)==="[object Date]"}function b2e(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function w2e(){try{return typeof Intl<"u"&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch{return!1}}function Xqe(t){return Array.isArray(t)?t:[t]}function Uue(t,e,i){if(t.length!==0)return t.reduce((r,s)=>{const n=[e(s),s];return r&&i(r[0],n[0])===r[0]?r:n},null)[1]}function Kqe(t,e){return e.reduce((i,r)=>(i[r]=t[r],i),{})}function G$(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function bZ(t){if(t==null)return null;if(typeof t!="object")throw new _l("Week settings must be an object");if(!wd(t.firstDay,1,7)||!wd(t.minimalDays,1,7)||!Array.isArray(t.weekend)||t.weekend.some(e=>!wd(e,1,7)))throw new _l("Invalid week settings");return{firstDay:t.firstDay,minimalDays:t.minimalDays,weekend:Array.from(t.weekend)}}function wd(t,e,i){return Kj(t)&&t>=e&&t<=i}function Qqe(t,e){return t-e*Math.floor(t/e)}function vo(t,e=2){const i=t<0;let r;return i?r="-"+(""+-t).padStart(e,"0"):r=(""+t).padStart(e,"0"),r}function C_(t){if(!(vi(t)||t===null||t===""))return parseInt(t,10)}function xw(t){if(!(vi(t)||t===null||t===""))return parseFloat(t)}function Kie(t){if(!(vi(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function Qie(t,e,i=!1){const r=10**e;return(i?Math.trunc:Math.round)(t*r)/r}function WD(t){return t%4===0&&(t%100!==0||t%400===0)}function zC(t){return WD(t)?366:365}function kU(t,e){const i=Qqe(e-1,12)+1,r=t+(e-i)/12;return i===2?WD(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function Qj(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(t.year,t.month-1,t.day)),+e}function Bue(t,e,i){return-Xie(Jie(t,1,e),i)+e-1}function b3(t,e=4,i=1){const r=Bue(t,e,i),s=Bue(t+1,e,i);return(zC(t)-r+s)/7}function wZ(t){return t>99?t:t>Pn.twoDigitCutoffYear?1900+t:2e3+t}function x2e(t,e,i,r=null){const s=new Date(t),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(n.timeZone=r);const o={timeZoneName:e,...n},a=new Intl.DateTimeFormat(i,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function eG(t,e){let i=parseInt(t,10);Number.isNaN(i)&&(i=0);const r=parseInt(e,10)||0,s=i<0||Object.is(i,-0)?-r:r;return i*60+s}function S2e(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new _l(`Invalid unit value ${t}`);return e}function zU(t,e){const i={};for(const r in t)if(G$(t,r)){const s=t[r];if(s==null)continue;i[e(r)]=S2e(s)}return i}function JR(t,e){const i=Math.trunc(Math.abs(t/60)),r=Math.trunc(Math.abs(t%60)),s=t>=0?"+":"-";switch(e){case"short":return`${s}${vo(i,2)}:${vo(r,2)}`;case"narrow":return`${s}${i}${r>0?`:${r}`:""}`;case"techie":return`${s}${vo(i,2)}${vo(r,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function tG(t){return Kqe(t,["hour","minute","second","millisecond"])}const e9e=["January","February","March","April","May","June","July","August","September","October","November","December"],T2e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],t9e=["J","F","M","A","M","J","J","A","S","O","N","D"];function E2e(t){switch(t){case"narrow":return[...t9e];case"short":return[...T2e];case"long":return[...e9e];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const C2e=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],$2e=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],i9e=["M","T","W","T","F","S","S"];function A2e(t){switch(t){case"narrow":return[...i9e];case"short":return[...$2e];case"long":return[...C2e];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const M2e=["AM","PM"],r9e=["Before Christ","Anno Domini"],s9e=["BC","AD"],n9e=["B","A"];function O2e(t){switch(t){case"narrow":return[...n9e];case"short":return[...s9e];case"long":return[...r9e];default:return null}}function o9e(t){return M2e[t.hour<12?0:1]}function a9e(t,e){return A2e(e)[t.weekday-1]}function l9e(t,e){return E2e(e)[t.month-1]}function c9e(t,e){return O2e(e)[t.year<0?0:1]}function u9e(t,e,i="always",r=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(t)===-1;if(i==="auto"&&n){const d=t==="days";switch(e){case 1:return d?"tomorrow":`next ${s[t][0]}`;case-1:return d?"yesterday":`last ${s[t][0]}`;case 0:return d?"today":`this ${s[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=s[t],h=r?l?c[1]:c[2]||c[1]:l?s[t][0]:t;return o?`${a} ${h} ago`:`in ${a} ${h}`}function Vue(t,e){let i="";for(const r of t)r.literal?i+=r.val:i+=e(r.val);return i}const h9e={D:NU,DD:YEe,DDD:JEe,DDDD:XEe,t:KEe,tt:QEe,ttt:e2e,tttt:t2e,T:i2e,TT:r2e,TTT:s2e,TTTT:n2e,f:o2e,ff:l2e,fff:u2e,ffff:d2e,F:a2e,FF:c2e,FFF:h2e,FFFF:p2e};class Tl{static create(e,i={}){return new Tl(e,i)}static parseFormat(e){let i=null,r="",s=!1;const n=[];for(let o=0;o<e.length;o++){const a=e.charAt(o);a==="'"?(r.length>0&&n.push({literal:s||/^\s+$/.test(r),val:r}),i=null,r="",s=!s):s||a===i?r+=a:(r.length>0&&n.push({literal:/^\s+$/.test(r),val:r}),r=a,i=a)}return r.length>0&&n.push({literal:s||/^\s+$/.test(r),val:r}),n}static macroTokenToFormatOpts(e){return h9e[e]}constructor(e,i){this.opts=i,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,i){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...i}).format()}dtFormatter(e,i={}){return this.loc.dtFormatter(e,{...this.opts,...i})}formatDateTime(e,i){return this.dtFormatter(e,i).format()}formatDateTimeParts(e,i){return this.dtFormatter(e,i).formatToParts()}formatInterval(e,i){return this.dtFormatter(e.start,i).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,i){return this.dtFormatter(e,i).resolvedOptions()}num(e,i=0){if(this.opts.forceSimple)return vo(e,i);const r={...this.opts};return i>0&&(r.padTo=i),this.loc.numberFormatter(r).format(e)}formatDateTimeFromString(e,i){const r=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(m,g)=>this.loc.extract(e,m,g),o=m=>e.isOffsetFixed&&e.offset===0&&m.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,m.format):"",a=()=>r?o9e(e):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(m,g)=>r?l9e(e,m):n(g?{month:m}:{month:m,day:"numeric"},"month"),c=(m,g)=>r?a9e(e,m):n(g?{weekday:m}:{weekday:m,month:"long",day:"numeric"},"weekday"),h=m=>{const g=Tl.macroTokenToFormatOpts(m);return g?this.formatWithSystemDefault(e,g):m},d=m=>r?c9e(e,m):n({era:m},"era"),f=m=>{switch(m){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(e.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(e.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(e.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(e.year,6);case"G":return d("short");case"GG":return d("long");case"GGGGG":return d("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"n":return this.num(e.localWeekNumber);case"nn":return this.num(e.localWeekNumber,2);case"ii":return this.num(e.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(e.localWeekYear,4);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return h(m)}};return Vue(Tl.parseFormat(i),f)}formatDurationFromString(e,i){const r=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const h=r(c);return h?this.num(l.get(h),c.length):c},n=Tl.parseFormat(i),o=n.reduce((l,{literal:c,val:h})=>c?l:l.concat(h),[]),a=e.shiftTo(...o.map(r).filter(l=>l));return Vue(n,s(a))}}const I2e=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function tM(...t){const e=t.reduce((i,r)=>i+r.source,"");return RegExp(`^${e}$`)}function iM(...t){return e=>t.reduce(([i,r,s],n)=>{const[o,a,l]=n(e,s);return[{...i,...o},a||r,l]},[{},null,1]).slice(0,2)}function rM(t,...e){if(t==null)return[null,null];for(const[i,r]of e){const s=i.exec(t);if(s)return r(s)}return[null,null]}function R2e(...t){return(e,i)=>{const r={};let s;for(s=0;s<t.length;s++)r[t[s]]=C_(e[i+s]);return[r,null,i+s]}}const P2e=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,d9e=`(?:${P2e.source}?(?:\\[(${I2e.source})\\])?)?`,ere=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,D2e=RegExp(`${ere.source}${d9e}`),tre=RegExp(`(?:T${D2e.source})?`),p9e=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,f9e=/(\d{4})-?W(\d\d)(?:-?(\d))?/,m9e=/(\d{4})-?(\d{3})/,g9e=R2e("weekYear","weekNumber","weekDay"),y9e=R2e("year","ordinal"),v9e=/(\d{4})-(\d\d)-(\d\d)/,L2e=RegExp(`${ere.source} ?(?:${P2e.source}|(${I2e.source}))?`),_9e=RegExp(`(?: ${L2e.source})?`);function UC(t,e,i){const r=t[e];return vi(r)?i:C_(r)}function b9e(t,e){return[{year:UC(t,e),month:UC(t,e+1,1),day:UC(t,e+2,1)},null,e+3]}function sM(t,e){return[{hours:UC(t,e,0),minutes:UC(t,e+1,0),seconds:UC(t,e+2,0),milliseconds:Kie(t[e+3])},null,e+4]}function ZD(t,e){const i=!t[e]&&!t[e+1],r=eG(t[e+1],t[e+2]),s=i?null:xa.instance(r);return[{},s,e+3]}function YD(t,e){const i=t[e]?au.create(t[e]):null;return[{},i,e+1]}const w9e=RegExp(`^T?${ere.source}$`),x9e=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function S9e(t){const[e,i,r,s,n,o,a,l,c]=t,h=e[0]==="-",d=l&&l[0]==="-",f=(m,g=!1)=>m!==void 0&&(g||m&&h)?-m:m;return[{years:f(xw(i)),months:f(xw(r)),weeks:f(xw(s)),days:f(xw(n)),hours:f(xw(o)),minutes:f(xw(a)),seconds:f(xw(l),l==="-0"),milliseconds:f(Kie(c),d)}]}const T9e={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function ire(t,e,i,r,s,n,o){const a={year:e.length===2?wZ(C_(e)):C_(e),month:T2e.indexOf(i)+1,day:C_(r),hour:C_(s),minute:C_(n)};return o&&(a.second=C_(o)),t&&(a.weekday=t.length>3?C2e.indexOf(t)+1:$2e.indexOf(t)+1),a}const E9e=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function C9e(t){const[,e,i,r,s,n,o,a,l,c,h,d]=t,f=ire(e,s,r,i,n,o,a);let m;return l?m=T9e[l]:c?m=0:m=eG(h,d),[f,new xa(m)]}function $9e(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const A9e=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,M9e=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,O9e=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function jue(t){const[,e,i,r,s,n,o,a]=t;return[ire(e,s,r,i,n,o,a),xa.utcInstance]}function I9e(t){const[,e,i,r,s,n,o,a]=t;return[ire(e,a,i,r,s,n,o),xa.utcInstance]}const R9e=tM(p9e,tre),P9e=tM(f9e,tre),D9e=tM(m9e,tre),L9e=tM(D2e),N2e=iM(b9e,sM,ZD,YD),N9e=iM(g9e,sM,ZD,YD),F9e=iM(y9e,sM,ZD,YD),k9e=iM(sM,ZD,YD);function z9e(t){return rM(t,[R9e,N2e],[P9e,N9e],[D9e,F9e],[L9e,k9e])}function U9e(t){return rM($9e(t),[E9e,C9e])}function B9e(t){return rM(t,[A9e,jue],[M9e,jue],[O9e,I9e])}function V9e(t){return rM(t,[x9e,S9e])}const j9e=iM(sM);function G9e(t){return rM(t,[w9e,j9e])}const H9e=tM(v9e,_9e),q9e=tM(L2e),W9e=iM(sM,ZD,YD);function Z9e(t){return rM(t,[H9e,N2e],[q9e,W9e])}const Gue="Invalid Duration",F2e={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},Y9e={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...F2e},bh=146097/400,ST=146097/4800,J9e={years:{quarters:4,months:12,weeks:bh/7,days:bh,hours:bh*24,minutes:bh*24*60,seconds:bh*24*60*60,milliseconds:bh*24*60*60*1e3},quarters:{months:3,weeks:bh/28,days:bh/4,hours:bh*24/4,minutes:bh*24*60/4,seconds:bh*24*60*60/4,milliseconds:bh*24*60*60*1e3/4},months:{weeks:ST/7,days:ST,hours:ST*24,minutes:ST*24*60,seconds:ST*24*60*60,milliseconds:ST*24*60*60*1e3},...F2e},$x=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],X9e=$x.slice(0).reverse();function u0(t,e,i=!1){const r={values:i?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new Ir(r)}function k2e(t,e){let i=e.milliseconds??0;for(const r of X9e.slice(1))e[r]&&(i+=e[r]*t[r].milliseconds);return i}function Hue(t,e){const i=k2e(t,e)<0?-1:1;$x.reduceRight((r,s)=>{if(vi(e[s]))return r;if(r){const n=e[r]*i,o=t[s][r],a=Math.floor(n/o);e[s]+=a*i,e[r]-=a*o*i}return s},null),$x.reduce((r,s)=>{if(vi(e[s]))return r;if(r){const n=e[r]%1;e[r]-=n,e[s]+=n*t[r][s]}return s},null)}function K9e(t){const e={};for(const[i,r]of Object.entries(t))r!==0&&(e[i]=r);return e}class Ir{constructor(e){const i=e.conversionAccuracy==="longterm"||!1;let r=i?J9e:Y9e;e.matrix&&(r=e.matrix),this.values=e.values,this.loc=e.loc||Jr.create(),this.conversionAccuracy=i?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=r,this.isLuxonDuration=!0}static fromMillis(e,i){return Ir.fromObject({milliseconds:e},i)}static fromObject(e,i={}){if(e==null||typeof e!="object")throw new _l(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new Ir({values:zU(e,Ir.normalizeUnit),loc:Jr.fromObject(i),conversionAccuracy:i.conversionAccuracy,matrix:i.matrix})}static fromDurationLike(e){if(xb(e))return Ir.fromMillis(e);if(Ir.isDuration(e))return e;if(typeof e=="object")return Ir.fromObject(e);throw new _l(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,i){const[r]=V9e(e);return r?Ir.fromObject(r,i):Ir.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,i){const[r]=G9e(e);return r?Ir.fromObject(r,i):Ir.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,i=null){if(!e)throw new _l("need to specify a reason the Duration is invalid");const r=e instanceof Kp?e:new Kp(e,i);if(Pn.throwOnInvalid)throw new xqe(r);return new Ir({invalid:r})}static normalizeUnit(e){const i={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!i)throw new ZEe(e);return i}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,i={}){const r={...i,floor:i.round!==!1&&i.floor!==!1};return this.isValid?Tl.create(this.loc,r).formatDurationFromString(this,e):Gue}toHuman(e={}){if(!this.isValid)return Gue;const i=$x.map(r=>{const s=this.values[r];return vi(s)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:r.slice(0,-1)}).format(s)}).filter(r=>r);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(i)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=Qie(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const i=this.toMillis();return i<0||i>=864e5?null:(e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1},St.fromMillis(i,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Duration { values: ${JSON.stringify(this.values)} }`:`Duration { Invalid, reason: ${this.invalidReason} }`}toMillis(){return this.isValid?k2e(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const i=Ir.fromDurationLike(e),r={};for(const s of $x)(G$(i.values,s)||G$(this.values,s))&&(r[s]=i.get(s)+this.get(s));return u0(this,{values:r},!0)}minus(e){if(!this.isValid)return this;const i=Ir.fromDurationLike(e);return this.plus(i.negate())}mapUnits(e){if(!this.isValid)return this;const i={};for(const r of Object.keys(this.values))i[r]=S2e(e(this.values[r],r));return u0(this,{values:i},!0)}get(e){return this[Ir.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const i={...this.values,...zU(e,Ir.normalizeUnit)};return u0(this,{values:i})}reconfigure({locale:e,numberingSystem:i,conversionAccuracy:r,matrix:s}={}){const o={loc:this.loc.clone({locale:e,numberingSystem:i}),matrix:s,conversionAccuracy:r};return u0(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return Hue(this.matrix,e),u0(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=K9e(this.normalize().shiftToAll().toObject());return u0(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(o=>Ir.normalizeUnit(o));const i={},r={},s=this.toObject();let n;for(const o of $x)if(e.indexOf(o)>=0){n=o;let a=0;for(const c in r)a+=this.matrix[c][o]*r[c],r[c]=0;xb(s[o])&&(a+=s[o]);const l=Math.trunc(a);i[o]=l,r[o]=(a*1e3-l*1e3)/1e3}else xb(s[o])&&(r[o]=s[o]);for(const o in r)r[o]!==0&&(i[n]+=o===n?r[o]:r[o]/this.matrix[n][o]);return Hue(this.matrix,i),u0(this,{values:i},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const i of Object.keys(this.values))e[i]=this.values[i]===0?0:-this.values[i];return u0(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function i(r,s){return r===void 0||r===0?s===void 0||s===0:r===s}for(const r of $x)if(!i(this.values[r],e.values[r]))return!1;return!0}}const TT="Invalid Interval";function Q9e(t,e){return!t||!t.isValid?On.invalid("missing or invalid start"):!e||!e.isValid?On.invalid("missing or invalid end"):e<t?On.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class On{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,i=null){if(!e)throw new _l("need to specify a reason the Interval is invalid");const r=e instanceof Kp?e:new Kp(e,i);if(Pn.throwOnInvalid)throw new wqe(r);return new On({invalid:r})}static fromDateTimes(e,i){const r=RM(e),s=RM(i),n=Q9e(r,s);return n??new On({start:r,end:s})}static after(e,i){const r=Ir.fromDurationLike(i),s=RM(e);return On.fromDateTimes(s,s.plus(r))}static before(e,i){const r=Ir.fromDurationLike(i),s=RM(e);return On.fromDateTimes(s.minus(r),s)}static fromISO(e,i){const[r,s]=(e||"").split("/",2);if(r&&s){let n,o;try{n=St.fromISO(r,i),o=n.isValid}catch{o=!1}let a,l;try{a=St.fromISO(s,i),l=a.isValid}catch{l=!1}if(o&&l)return On.fromDateTimes(n,a);if(o){const c=Ir.fromISO(s,i);if(c.isValid)return On.after(n,c)}else if(l){const c=Ir.fromISO(r,i);if(c.isValid)return On.before(a,c)}}return On.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds",i){if(!this.isValid)return NaN;const r=this.start.startOf(e,i);let s;return i!=null&&i.useLocaleWeeks?s=this.end.reconfigure({locale:r.locale}):s=this.end,s=s.startOf(e,i),Math.floor(s.diff(r,e).get(e))+(s.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:i}={}){return this.isValid?On.fromDateTimes(e||this.s,i||this.e):this}splitAt(...e){if(!this.isValid)return[];const i=e.map(RM).filter(o=>this.contains(o)).sort((o,a)=>o.toMillis()-a.toMillis()),r=[];let{s}=this,n=0;for(;s<this.e;){const o=i[n]||this.e,a=+o>+this.e?this.e:o;r.push(On.fromDateTimes(s,a)),s=a,n+=1}return r}splitBy(e){const i=Ir.fromDurationLike(e);if(!this.isValid||!i.isValid||i.as("milliseconds")===0)return[];let{s:r}=this,s=1,n;const o=[];for(;r<this.e;){const a=this.start.plus(i.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push(On.fromDateTimes(r,n)),r=n,s+=1}return o}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const i=this.s>e.s?this.s:e.s,r=this.e<e.e?this.e:e.e;return i>=r?null:On.fromDateTimes(i,r)}union(e){if(!this.isValid)return this;const i=this.s<e.s?this.s:e.s,r=this.e>e.e?this.e:e.e;return On.fromDateTimes(i,r)}static merge(e){const[i,r]=e.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return r&&i.push(r),i}static xor(e){let i=null,r=0;const s=[],n=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)r+=l.type==="s"?1:-1,r===1?i=l.time:(i&&+i!=+l.time&&s.push(On.fromDateTimes(i,l.time)),i=null);return On.merge(s)}difference(...e){return On.xor([this].concat(e)).map(i=>this.intersection(i)).filter(i=>i&&!i.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()}  ${this.e.toISO()})`:TT}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Interval { start: ${this.s.toISO()}, end: ${this.e.toISO()} }`:`Interval { Invalid, reason: ${this.invalidReason} }`}toLocaleString(e=NU,i={}){return this.isValid?Tl.create(this.s.loc.clone(i),e).formatInterval(this):TT}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:TT}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:TT}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:TT}toFormat(e,{separator:i="  "}={}){return this.isValid?`${this.s.toFormat(e)}${i}${this.e.toFormat(e)}`:TT}toDuration(e,i){return this.isValid?this.e.diff(this.s,e,i):Ir.invalid(this.invalidReason)}mapEndpoints(e){return On.fromDateTimes(e(this.s),e(this.e))}}class uN{static hasDST(e=Pn.defaultZone){const i=St.now().setZone(e).set({month:12});return!e.isUniversal&&i.offset!==i.set({month:6}).offset}static isValidIANAZone(e){return au.isValidZone(e)}static normalizeZone(e){return B_(e,Pn.defaultZone)}static getStartOfWeek({locale:e=null,locObj:i=null}={}){return(i||Jr.create(e)).getStartOfWeek()}static getMinimumDaysInFirstWeek({locale:e=null,locObj:i=null}={}){return(i||Jr.create(e)).getMinDaysInFirstWeek()}static getWeekendWeekdays({locale:e=null,locObj:i=null}={}){return(i||Jr.create(e)).getWeekendDays().slice()}static months(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Jr.create(i,r,n)).months(e)}static monthsFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Jr.create(i,r,n)).months(e,!0)}static weekdays(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||Jr.create(i,r,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||Jr.create(i,r,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return Jr.create(e).meridiems()}static eras(e="short",{locale:i=null}={}){return Jr.create(i,null,"gregory").eras(e)}static features(){return{relative:b2e(),localeWeek:w2e()}}}function que(t,e){const i=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=i(e)-i(t);return Math.floor(Ir.fromMillis(r).as("days"))}function e7e(t,e,i){const r=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const h=que(l,c);return(h-h%7)/7}],["days",que]],s={},n=t;let o,a;for(const[l,c]of r)i.indexOf(l)>=0&&(o=l,s[l]=c(t,e),a=n.plus(s),a>e?(s[l]--,t=n.plus(s),t>e&&(a=t,s[l]--,t=n.plus(s))):t=a);return[t,s,a,o]}function t7e(t,e,i,r){let[s,n,o,a]=e7e(t,e,i);const l=e-s,c=i.filter(d=>["hours","minutes","seconds","milliseconds"].indexOf(d)>=0);c.length===0&&(o<e&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const h=Ir.fromObject(n,r);return c.length>0?Ir.fromMillis(l,r).shiftTo(...c).plus(h):h}const i7e="missing Intl.DateTimeFormat.formatToParts support";function Vr(t,e=i=>i){return{regex:t,deser:([i])=>e(Hqe(i))}}const r7e="",z2e=`[ ${r7e}]`,U2e=new RegExp(z2e,"g");function s7e(t){return t.replace(/\./g,"\\.?").replace(U2e,z2e)}function Wue(t){return t.replace(/\./g,"").replace(U2e," ").toLowerCase()}function Yd(t,e){return t===null?null:{regex:RegExp(t.map(s7e).join("|")),deser:([i])=>t.findIndex(r=>Wue(i)===Wue(r))+e}}function Zue(t,e){return{regex:t,deser:([,i,r])=>eG(i,r),groups:e}}function hN(t){return{regex:t,deser:([e])=>e}}function n7e(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o7e(t,e){const i=Zd(e),r=Zd(e,"{2}"),s=Zd(e,"{3}"),n=Zd(e,"{4}"),o=Zd(e,"{6}"),a=Zd(e,"{1,2}"),l=Zd(e,"{1,3}"),c=Zd(e,"{1,6}"),h=Zd(e,"{1,9}"),d=Zd(e,"{2,4}"),f=Zd(e,"{4,6}"),m=_=>({regex:RegExp(n7e(_.val)),deser:([b])=>b,literal:!0}),v=(_=>{if(t.literal)return m(_);switch(_.val){case"G":return Yd(e.eras("short"),0);case"GG":return Yd(e.eras("long"),0);case"y":return Vr(c);case"yy":return Vr(d,wZ);case"yyyy":return Vr(n);case"yyyyy":return Vr(f);case"yyyyyy":return Vr(o);case"M":return Vr(a);case"MM":return Vr(r);case"MMM":return Yd(e.months("short",!0),1);case"MMMM":return Yd(e.months("long",!0),1);case"L":return Vr(a);case"LL":return Vr(r);case"LLL":return Yd(e.months("short",!1),1);case"LLLL":return Yd(e.months("long",!1),1);case"d":return Vr(a);case"dd":return Vr(r);case"o":return Vr(l);case"ooo":return Vr(s);case"HH":return Vr(r);case"H":return Vr(a);case"hh":return Vr(r);case"h":return Vr(a);case"mm":return Vr(r);case"m":return Vr(a);case"q":return Vr(a);case"qq":return Vr(r);case"s":return Vr(a);case"ss":return Vr(r);case"S":return Vr(l);case"SSS":return Vr(s);case"u":return hN(h);case"uu":return hN(a);case"uuu":return Vr(i);case"a":return Yd(e.meridiems(),0);case"kkkk":return Vr(n);case"kk":return Vr(d,wZ);case"W":return Vr(a);case"WW":return Vr(r);case"E":case"c":return Vr(i);case"EEE":return Yd(e.weekdays("short",!1),1);case"EEEE":return Yd(e.weekdays("long",!1),1);case"ccc":return Yd(e.weekdays("short",!0),1);case"cccc":return Yd(e.weekdays("long",!0),1);case"Z":case"ZZ":return Zue(new RegExp(`([+-]${a.source})(?::(${r.source}))?`),2);case"ZZZ":return Zue(new RegExp(`([+-]${a.source})(${r.source})?`),2);case"z":return hN(/[a-z_+-/]{1,256}?/i);case" ":return hN(/[^\S\n\r]/);default:return m(_)}})(t)||{invalidReason:i7e};return v.token=t,v}const a7e={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function l7e(t,e,i){const{type:r,value:s}=t;if(r==="literal"){const l=/^\s+$/.test(s);return{literal:!l,val:l?" ":s}}const n=e[r];let o=r;r==="hour"&&(e.hour12!=null?o=e.hour12?"hour12":"hour24":e.hourCycle!=null?e.hourCycle==="h11"||e.hourCycle==="h12"?o="hour12":o="hour24":o=i.hour12?"hour12":"hour24");let a=a7e[o];if(typeof a=="object"&&(a=a[n]),a)return{literal:!1,val:a}}function c7e(t){return[`^${t.map(i=>i.regex).reduce((i,r)=>`${i}(${r.source})`,"")}$`,t]}function u7e(t,e,i){const r=t.match(e);if(r){const s={};let n=1;for(const o in i)if(G$(i,o)){const a=i[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(r.slice(n,n+l))),n+=l}return[r,s]}else return[r,{}]}function h7e(t){const e=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let i=null,r;return vi(t.z)||(i=au.create(t.z)),vi(t.Z)||(i||(i=new xa(t.Z)),r=t.Z),vi(t.q)||(t.M=(t.q-1)*3+1),vi(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),vi(t.u)||(t.S=Kie(t.u)),[Object.keys(t).reduce((n,o)=>{const a=e(o);return a&&(n[a]=t[o]),n},{}),i,r]}let ZH=null;function d7e(){return ZH||(ZH=St.fromMillis(1555555555555)),ZH}function p7e(t,e){if(t.literal)return t;const i=Tl.macroTokenToFormatOpts(t.val),r=G2e(i,e);return r==null||r.includes(void 0)?t:r}function B2e(t,e){return Array.prototype.concat(...t.map(i=>p7e(i,e)))}class V2e{constructor(e,i){if(this.locale=e,this.format=i,this.tokens=B2e(Tl.parseFormat(i),e),this.units=this.tokens.map(r=>o7e(r,e)),this.disqualifyingUnit=this.units.find(r=>r.invalidReason),!this.disqualifyingUnit){const[r,s]=c7e(this.units);this.regex=RegExp(r,"i"),this.handlers=s}}explainFromTokens(e){if(this.isValid){const[i,r]=u7e(e,this.regex,this.handlers),[s,n,o]=r?h7e(r):[null,null,void 0];if(G$(r,"a")&&G$(r,"H"))throw new Q2("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:this.tokens,regex:this.regex,rawMatches:i,matches:r,result:s,zone:n,specificOffset:o}}else return{input:e,tokens:this.tokens,invalidReason:this.invalidReason}}get isValid(){return!this.disqualifyingUnit}get invalidReason(){return this.disqualifyingUnit?this.disqualifyingUnit.invalidReason:null}}function j2e(t,e,i){return new V2e(t,i).explainFromTokens(e)}function f7e(t,e,i){const{result:r,zone:s,specificOffset:n,invalidReason:o}=j2e(t,e,i);return[r,s,n,o]}function G2e(t,e){if(!t)return null;const r=Tl.create(e,t).dtFormatter(d7e()),s=r.formatToParts(),n=r.resolvedOptions();return s.map(o=>l7e(o,t,n))}const YH="Invalid DateTime",m7e=864e13;function WO(t){return new Kp("unsupported zone",`the zone "${t.name}" is not supported`)}function JH(t){return t.weekData===null&&(t.weekData=FU(t.c)),t.weekData}function XH(t){return t.localWeekData===null&&(t.localWeekData=FU(t.c,t.loc.getMinDaysInFirstWeek(),t.loc.getStartOfWeek())),t.localWeekData}function Sw(t,e){const i={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new St({...i,...e,old:i})}function H2e(t,e,i){let r=t-e*60*1e3;const s=i.offset(r);if(e===s)return[r,e];r-=(s-e)*60*1e3;const n=i.offset(r);return s===n?[r,s]:[t-Math.min(s,n)*60*1e3,Math.max(s,n)]}function dN(t,e){t+=e*60*1e3;const i=new Date(t);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function C4(t,e,i){return H2e(Qj(t),e,i)}function Yue(t,e){const i=t.o,r=t.c.year+Math.trunc(e.years),s=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,n={...t.c,year:r,month:s,day:Math.min(t.c.day,kU(r,s))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},o=Ir.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=Qj(n);let[l,c]=H2e(a,i,t.zone);return o!==0&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function ET(t,e,i,r,s,n){const{setZone:o,zone:a}=i;if(t&&Object.keys(t).length!==0||e){const l=e||a,c=St.fromObject(t,{...i,zone:l,specificOffset:n});return o?c:c.setZone(a)}else return St.invalid(new Kp("unparsable",`the input "${s}" can't be parsed as ${r}`))}function pN(t,e,i=!0){return t.isValid?Tl.create(Jr.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(t,e):null}function KH(t,e){const i=t.c.year>9999||t.c.year<0;let r="";return i&&t.c.year>=0&&(r+="+"),r+=vo(t.c.year,i?6:4),e?(r+="-",r+=vo(t.c.month),r+="-",r+=vo(t.c.day)):(r+=vo(t.c.month),r+=vo(t.c.day)),r}function Jue(t,e,i,r,s,n){let o=vo(t.c.hour);return e?(o+=":",o+=vo(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!i)&&(o+=":")):o+=vo(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!i)&&(o+=vo(t.c.second),(t.c.millisecond!==0||!r)&&(o+=".",o+=vo(t.c.millisecond,3))),s&&(t.isOffsetFixed&&t.offset===0&&!n?o+="Z":t.o<0?(o+="-",o+=vo(Math.trunc(-t.o/60)),o+=":",o+=vo(Math.trunc(-t.o%60))):(o+="+",o+=vo(Math.trunc(t.o/60)),o+=":",o+=vo(Math.trunc(t.o%60)))),n&&(o+="["+t.zone.ianaName+"]"),o}const q2e={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},g7e={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},y7e={ordinal:1,hour:0,minute:0,second:0,millisecond:0},W2e=["year","month","day","hour","minute","second","millisecond"],v7e=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],_7e=["year","ordinal","hour","minute","second","millisecond"];function b7e(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new ZEe(t);return e}function Xue(t){switch(t.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return b7e(t)}}function w7e(t){return A4[t]||($4===void 0&&($4=Pn.now()),A4[t]=t.offset($4)),A4[t]}function Kue(t,e){const i=B_(e.zone,Pn.defaultZone);if(!i.isValid)return St.invalid(WO(i));const r=Jr.fromObject(e);let s,n;if(vi(t.year))s=Pn.now();else{for(const l of W2e)vi(t[l])&&(t[l]=q2e[l]);const o=v2e(t)||_2e(t);if(o)return St.invalid(o);const a=w7e(i);[s,n]=C4(t,a,i)}return new St({ts:s,zone:i,loc:r,o:n})}function Que(t,e,i){const r=vi(i.round)?!0:i.round,s=(o,a)=>(o=Qie(o,r||i.calendary?0:2,!0),e.loc.clone(i).relFormatter(i).format(o,a)),n=o=>i.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(i.unit)return s(n(i.unit),i.unit);for(const o of i.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(t>e?-0:0,i.units[i.units.length-1])}function ehe(t){let e={},i;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],i=Array.from(t).slice(0,t.length-1)):i=Array.from(t),[e,i]}let $4,A4={};class St{constructor(e){const i=e.zone||Pn.defaultZone;let r=e.invalid||(Number.isNaN(e.ts)?new Kp("invalid input"):null)||(i.isValid?null:WO(i));this.ts=vi(e.ts)?Pn.now():e.ts;let s=null,n=null;if(!r)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(i))[s,n]=[e.old.c,e.old.o];else{const a=xb(e.o)&&!e.old?e.o:i.offset(this.ts);s=dN(this.ts,a),r=Number.isNaN(s.year)?new Kp("invalid input"):null,s=r?null:s,n=r?null:a}this._zone=i,this.loc=e.loc||Jr.create(),this.invalid=r,this.weekData=null,this.localWeekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new St({})}static local(){const[e,i]=ehe(arguments),[r,s,n,o,a,l,c]=i;return Kue({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static utc(){const[e,i]=ehe(arguments),[r,s,n,o,a,l,c]=i;return e.zone=xa.utcInstance,Kue({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,i={}){const r=Jqe(e)?e.valueOf():NaN;if(Number.isNaN(r))return St.invalid("invalid input");const s=B_(i.zone,Pn.defaultZone);return s.isValid?new St({ts:r,zone:s,loc:Jr.fromObject(i)}):St.invalid(WO(s))}static fromMillis(e,i={}){if(xb(e))return e<-864e13||e>m7e?St.invalid("Timestamp out of range"):new St({ts:e,zone:B_(i.zone,Pn.defaultZone),loc:Jr.fromObject(i)});throw new _l(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,i={}){if(xb(e))return new St({ts:e*1e3,zone:B_(i.zone,Pn.defaultZone),loc:Jr.fromObject(i)});throw new _l("fromSeconds requires a numerical input")}static fromObject(e,i={}){e=e||{};const r=B_(i.zone,Pn.defaultZone);if(!r.isValid)return St.invalid(WO(r));const s=Jr.fromObject(i),n=zU(e,Xue),{minDaysInFirstWeek:o,startOfWeek:a}=zue(n,s),l=Pn.now(),c=vi(i.specificOffset)?r.offset(l):i.specificOffset,h=!vi(n.ordinal),d=!vi(n.year),f=!vi(n.month)||!vi(n.day),m=d||f,g=n.weekYear||n.weekNumber;if((m||h)&&g)throw new Q2("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(f&&h)throw new Q2("Can't mix ordinal dates with month/day");const v=g||n.weekday&&!m;let _,b,w=dN(l,c);v?(_=v7e,b=g7e,w=FU(w,o,a)):h?(_=_7e,b=y7e,w=WH(w)):(_=W2e,b=q2e);let x=!1;for(const P of _){const F=n[P];vi(F)?x?n[P]=b[P]:n[P]=w[P]:x=!0}const S=v?Wqe(n,o,a):h?Zqe(n):v2e(n),C=S||_2e(n);if(C)return St.invalid(C);const T=v?Fue(n,o,a):h?kue(n):n,[M,I]=C4(T,c,r),D=new St({ts:M,zone:r,o:I,loc:s});return n.weekday&&m&&e.weekday!==D.weekday?St.invalid("mismatched weekday",`you can't specify both a weekday of ${n.weekday} and a date of ${D.toISO()}`):D.isValid?D:St.invalid(D.invalid)}static fromISO(e,i={}){const[r,s]=z9e(e);return ET(r,s,i,"ISO 8601",e)}static fromRFC2822(e,i={}){const[r,s]=U9e(e);return ET(r,s,i,"RFC 2822",e)}static fromHTTP(e,i={}){const[r,s]=B9e(e);return ET(r,s,i,"HTTP",i)}static fromFormat(e,i,r={}){if(vi(e)||vi(i))throw new _l("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=r,o=Jr.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,h]=f7e(o,e,i);return h?St.invalid(h):ET(a,l,r,`format ${i}`,e,c)}static fromString(e,i,r={}){return St.fromFormat(e,i,r)}static fromSQL(e,i={}){const[r,s]=Z9e(e);return ET(r,s,i,"SQL",e)}static invalid(e,i=null){if(!e)throw new _l("need to specify a reason the DateTime is invalid");const r=e instanceof Kp?e:new Kp(e,i);if(Pn.throwOnInvalid)throw new bqe(r);return new St({invalid:r})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,i={}){const r=G2e(e,Jr.fromObject(i));return r?r.map(s=>s?s.val:null).join(""):null}static expandFormat(e,i={}){return B2e(Tl.parseFormat(e),Jr.fromObject(i)).map(s=>s.val).join("")}static resetCache(){$4=void 0,A4={}}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?JH(this).weekYear:NaN}get weekNumber(){return this.isValid?JH(this).weekNumber:NaN}get weekday(){return this.isValid?JH(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?XH(this).weekday:NaN}get localWeekNumber(){return this.isValid?XH(this).weekNumber:NaN}get localWeekYear(){return this.isValid?XH(this).weekYear:NaN}get ordinal(){return this.isValid?WH(this.c).ordinal:NaN}get monthShort(){return this.isValid?uN.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?uN.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?uN.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?uN.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,i=6e4,r=Qj(this.c),s=this.zone.offset(r-e),n=this.zone.offset(r+e),o=this.zone.offset(r-s*i),a=this.zone.offset(r-n*i);if(o===a)return[this];const l=r-o*i,c=r-a*i,h=dN(l,o),d=dN(c,a);return h.hour===d.hour&&h.minute===d.minute&&h.second===d.second&&h.millisecond===d.millisecond?[Sw(this,{ts:l}),Sw(this,{ts:c})]:[this]}get isInLeapYear(){return WD(this.year)}get daysInMonth(){return kU(this.year,this.month)}get daysInYear(){return this.isValid?zC(this.year):NaN}get weeksInWeekYear(){return this.isValid?b3(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?b3(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(e={}){const{locale:i,numberingSystem:r,calendar:s}=Tl.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:i,numberingSystem:r,outputCalendar:s}}toUTC(e=0,i={}){return this.setZone(xa.instance(e),i)}toLocal(){return this.setZone(Pn.defaultZone)}setZone(e,{keepLocalTime:i=!1,keepCalendarTime:r=!1}={}){if(e=B_(e,Pn.defaultZone),e.equals(this.zone))return this;if(e.isValid){let s=this.ts;if(i||r){const n=e.offset(this.ts),o=this.toObject();[s]=C4(o,n,e)}return Sw(this,{ts:s,zone:e})}else return St.invalid(WO(e))}reconfigure({locale:e,numberingSystem:i,outputCalendar:r}={}){const s=this.loc.clone({locale:e,numberingSystem:i,outputCalendar:r});return Sw(this,{loc:s})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const i=zU(e,Xue),{minDaysInFirstWeek:r,startOfWeek:s}=zue(i,this.loc),n=!vi(i.weekYear)||!vi(i.weekNumber)||!vi(i.weekday),o=!vi(i.ordinal),a=!vi(i.year),l=!vi(i.month)||!vi(i.day),c=a||l,h=i.weekYear||i.weekNumber;if((c||o)&&h)throw new Q2("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(l&&o)throw new Q2("Can't mix ordinal dates with month/day");let d;n?d=Fue({...FU(this.c,r,s),...i},r,s):vi(i.ordinal)?(d={...this.toObject(),...i},vi(i.day)&&(d.day=Math.min(kU(d.year,d.month),d.day))):d=kue({...WH(this.c),...i});const[f,m]=C4(d,this.o,this.zone);return Sw(this,{ts:f,o:m})}plus(e){if(!this.isValid)return this;const i=Ir.fromDurationLike(e);return Sw(this,Yue(this,i))}minus(e){if(!this.isValid)return this;const i=Ir.fromDurationLike(e).negate();return Sw(this,Yue(this,i))}startOf(e,{useLocaleWeeks:i=!1}={}){if(!this.isValid)return this;const r={},s=Ir.normalizeUnit(e);switch(s){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(s==="weeks")if(i){const n=this.loc.getStartOfWeek(),{weekday:o}=this;o<n&&(r.weekNumber=this.weekNumber-1),r.weekday=n}else r.weekday=1;if(s==="quarters"){const n=Math.ceil(this.month/3);r.month=(n-1)*3+1}return this.set(r)}endOf(e,i){return this.isValid?this.plus({[e]:1}).startOf(e,i).minus(1):this}toFormat(e,i={}){return this.isValid?Tl.create(this.loc.redefaultToEN(i)).formatDateTimeFromString(this,e):YH}toLocaleString(e=NU,i={}){return this.isValid?Tl.create(this.loc.clone(i),e).formatDateTime(this):YH}toLocaleParts(e={}){return this.isValid?Tl.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:i=!1,suppressMilliseconds:r=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const o=e==="extended";let a=KH(this,o);return a+="T",a+=Jue(this,o,i,r,s,n),a}toISODate({format:e="extended"}={}){return this.isValid?KH(this,e==="extended"):null}toISOWeekDate(){return pN(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:i=!1,includeOffset:r=!0,includePrefix:s=!1,extendedZone:n=!1,format:o="extended"}={}){return this.isValid?(s?"T":"")+Jue(this,o==="extended",i,e,r,n):null}toRFC2822(){return pN(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return pN(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?KH(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:i=!1,includeOffsetSpace:r=!0}={}){let s="HH:mm:ss.SSS";return(i||e)&&(r&&(s+=" "),i?s+="z":e&&(s+="ZZ")),pN(this,s,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():YH}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`DateTime { ts: ${this.toISO()}, zone: ${this.zone.name}, locale: ${this.locale} }`:`DateTime { Invalid, reason: ${this.invalidReason} }`}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const i={...this.c};return e.includeConfig&&(i.outputCalendar=this.outputCalendar,i.numberingSystem=this.loc.numberingSystem,i.locale=this.loc.locale),i}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,i="milliseconds",r={}){if(!this.isValid||!e.isValid)return Ir.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...r},n=Xqe(i).map(Ir.normalizeUnit),o=e.valueOf()>this.valueOf(),a=o?this:e,l=o?e:this,c=t7e(a,l,n,s);return o?c.negate():c}diffNow(e="milliseconds",i={}){return this.diff(St.now(),e,i)}until(e){return this.isValid?On.fromDateTimes(this,e):this}hasSame(e,i,r){if(!this.isValid)return!1;const s=e.valueOf(),n=this.setZone(e.zone,{keepLocalTime:!0});return n.startOf(i,r)<=s&&s<=n.endOf(i,r)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const i=e.base||St.fromObject({},{zone:this.zone}),r=e.padding?this<i?-e.padding:e.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=e.unit;return Array.isArray(e.unit)&&(s=e.unit,n=void 0),Que(i,this.plus(r),{...e,numeric:"always",units:s,unit:n})}toRelativeCalendar(e={}){return this.isValid?Que(e.base||St.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(St.isDateTime))throw new _l("min requires all arguments be DateTimes");return Uue(e,i=>i.valueOf(),Math.min)}static max(...e){if(!e.every(St.isDateTime))throw new _l("max requires all arguments be DateTimes");return Uue(e,i=>i.valueOf(),Math.max)}static fromFormatExplain(e,i,r={}){const{locale:s=null,numberingSystem:n=null}=r,o=Jr.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return j2e(o,e,i)}static fromStringExplain(e,i,r={}){return St.fromFormatExplain(e,i,r)}static buildFormatParser(e,i={}){const{locale:r=null,numberingSystem:s=null}=i,n=Jr.fromOpts({locale:r,numberingSystem:s,defaultToEN:!0});return new V2e(n,e)}static fromFormatParser(e,i,r={}){if(vi(e)||vi(i))throw new _l("fromFormatParser requires an input string and a format parser");const{locale:s=null,numberingSystem:n=null}=r,o=Jr.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});if(!o.equals(i.locale))throw new _l(`fromFormatParser called with a locale of ${o}, but the format parser was created for ${i.locale}`);const{result:a,zone:l,specificOffset:c,invalidReason:h}=i.explainFromTokens(e);return h?St.invalid(h):ET(a,l,r,`format ${i.format}`,e,c)}static get DATE_SHORT(){return NU}static get DATE_MED(){return YEe}static get DATE_MED_WITH_WEEKDAY(){return Sqe}static get DATE_FULL(){return JEe}static get DATE_HUGE(){return XEe}static get TIME_SIMPLE(){return KEe}static get TIME_WITH_SECONDS(){return QEe}static get TIME_WITH_SHORT_OFFSET(){return e2e}static get TIME_WITH_LONG_OFFSET(){return t2e}static get TIME_24_SIMPLE(){return i2e}static get TIME_24_WITH_SECONDS(){return r2e}static get TIME_24_WITH_SHORT_OFFSET(){return s2e}static get TIME_24_WITH_LONG_OFFSET(){return n2e}static get DATETIME_SHORT(){return o2e}static get DATETIME_SHORT_WITH_SECONDS(){return a2e}static get DATETIME_MED(){return l2e}static get DATETIME_MED_WITH_SECONDS(){return c2e}static get DATETIME_MED_WITH_WEEKDAY(){return Tqe}static get DATETIME_FULL(){return u2e}static get DATETIME_FULL_WITH_SECONDS(){return h2e}static get DATETIME_HUGE(){return d2e}static get DATETIME_HUGE_WITH_SECONDS(){return p2e}}function RM(t){if(St.isDateTime(t))return t;if(t&&t.valueOf&&xb(t.valueOf()))return St.fromJSDate(t);if(t&&typeof t=="object")return St.fromObject(t);throw new _l(`Unknown datetime argument: ${t}, of type ${typeof t}`)}const x7e="shortOffset";function S7e(t){return"timeZoneIANA"in t}function T7e(t){return t.startsWith("UTC")}function UU(t,e=!1){return{json:{read:{source:t,reader:(i,r)=>r[t]?M4(r[t]):null},write:!!e&&{allowNull:!0,writer(i,r){r[t]=i?E7e(i):null}}}}}function M4(t,e=mf){return t?S7e(t)?t.timeZoneIANA:C7e(t,e):e}function E7e(t){return{timeZoneIANA:t}}function C7e(t,e=mf){if(!t||!Eue.has(t.timeZone))return e;const i=Eue.get(t.timeZone);return T7e(t.timeZone)||t.respectsDaylightSaving?i:$7e(i)}function $7e(t){const e=St.local().setZone(t),i=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return i===0?"Etc/UTC":`Etc/GMT${xa.instance(-i).formatOffset(0,"narrow")}`}function o9t(t,e,i,r,s){if(e&&s==="date")return{timeZone:Fb,timeZoneName:void 0};const n=r.timeStyle||r.hour,o=i===wS;return{timeZone:o?s==="timestamp-offset"?void 0:t??Fb:i,timeZoneName:o&&n?x7e:void 0}}function A7e(t){const e=new Set(["etc/utc","etc/gmt","gmt"]),i=new Set(Intl.supportedValuesOf("timeZone").map(r=>r.toLowerCase()));return t===mf||t===wS||e.has(t.toLowerCase())||i.has(t.toLowerCase())}const M7e={year:void 0,month:void 0,day:void 0,weekday:void 0},O7e={hour:void 0,minute:void 0,second:void 0},Z2e={timeZone:Fb},Rf={year:"numeric",month:"numeric",day:"numeric"},PM={year:"numeric",month:"long",day:"numeric"},DM={year:"numeric",month:"short",day:"numeric"},LM={year:"numeric",month:"long",weekday:"long",day:"numeric"},$_={hour:"numeric",minute:"numeric"},a1={...$_,second:"numeric"},Y2e={hourCycle:"h23"},NM={...$_,...Y2e},FM={...a1,...Y2e},J2e={"short-date":Rf,"short-date-short-time":{...Rf,...$_},"short-date-short-time-24":{...Rf,...NM},"short-date-long-time":{...Rf,...a1},"short-date-long-time-24":{...Rf,...FM},"short-date-le":Rf,"short-date-le-short-time":{...Rf,...$_},"short-date-le-short-time-24":{...Rf,...NM},"short-date-le-long-time":{...Rf,...a1},"short-date-le-long-time-24":{...Rf,...FM},"long-month-day-year":PM,"long-month-day-year-short-time":{...PM,...$_},"long-month-day-year-short-time-24":{...PM,...NM},"long-month-day-year-long-time":{...PM,...a1},"long-month-day-year-long-time-24":{...PM,...FM},"day-short-month-year":DM,"day-short-month-year-short-time":{...DM,...$_},"day-short-month-year-short-time-24":{...DM,...NM},"day-short-month-year-long-time":{...DM,...a1},"day-short-month-year-long-time-24":{...DM,...FM},"long-date":LM,"long-date-short-time":{...LM,...$_},"long-date-short-time-24":{...LM,...NM},"long-date-long-time":{...LM,...a1},"long-date-long-time-24":{...LM,...FM},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":$_,"long-time":a1},I7e=Oo()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),X2e={ar:"ar-u-nu-latn-ca-gregory"};let xZ=new WeakMap;const iG=J2e["short-date-short-time"];function R7e(t){let e=xZ.get(t);if(!e){const i=iu(),r=X2e[i]||i,s=rre(t.timeZone??mf),n={...t,timeZone:s};e=new Intl.DateTimeFormat(r,n),xZ.set(t,e)}return e}function P7e(t){return J2e[t]}function rG(t,e=iG){return R7e(e).format(t)}function a9t(t,e=iG){return rG(new Date(t),{...e,...Z2e,...O7e})}function l9t(t,e=iG){return rG(new Date(`1970-01-01T${t}Z`),{...e,...Z2e,...M7e})}function c9t(t,e=iG){if(e.timeZone)return rG(new Date(t),e);const i=St.fromISO(t,{setZone:!0}),r=iu(),s=X2e[r]??r,n=i.offset===0?Fb:e.timeZone,o={...e,timeZone:n};return i.toLocaleString(o,{locale:s})}function rre(t){switch(t){case mf:return _qe;case wS:return Fb;default:return t}}Zie(()=>{xZ=new WeakMap});const D7e={ar:"ar-u-nu-latn"};let O4=new WeakMap,K2e={};function SZ(t){const e=t||K2e;if(!O4.has(e)){const i=iu(),r=D7e[iu()]||i;O4.set(e,new Intl.NumberFormat(r,t))}return O4.get(e)}function u9t(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function JD(t,e){return Object.is(t,-0)&&(t=0),SZ(e).format(t)}function h9t(t,e=iu()){var r,s;if(!t)return null;let i=the.get(e);if(!i){const n=SZ().formatToParts(12345.6),o=[...SZ({useGrouping:!1}).format(9876543210)].reverse(),a=new Map(o.map((m,g)=>[m,g])),l=new RegExp(`[${(r=n.find(m=>m.type==="group"))==null?void 0:r.value}]`,"g"),c=new RegExp(`[${(s=n.find(m=>m.type==="decimal"))==null?void 0:s.value}]`),h=new RegExp(`[${o.join("")}]`,"g"),d=/[\u200E\u200F\u202A\u202B\u202C\u202D\u202E\u2066\u2067\u2068\u2069\u061C]/g,f=/[-\u2212\u2013\u2014\u2015]/g;i=m=>{if((m=m.trim().replaceAll(l,"").replace(c,".").replace(h,v=>String(a.get(v))).replaceAll(d,"").replaceAll(f,"-"))==="")return null;const g=Number(m);return isNaN(g)?null:g},the.set(e,i)}return i(t)}Zie(()=>{O4=new WeakMap,K2e={}});const the=new Map,ihe=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,Q2e={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:"no",nl:!0,no:!0,pl:!0,pt:"pt-BR","pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,zh:"zh-CN","zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function L7e(t){return t in Q2e}function rhe(t){if(L7e(t)){const e=Q2e[t];return e===!0?t:e}return null}const ZO=[],BC=new Map;function she(t){for(const e of BC.keys())iCe(t.pattern,e)&&BC.delete(e)}function N7e(t){return ZO.includes(t)||(she(t),ZO.unshift(t)),Pi(()=>{const e=ZO.indexOf(t);e>-1&&(ZO.splice(e,1),she(t))})}async function eCe(t){const e=iu();BC.has(t)||BC.set(t,F7e(t,e));const i=BC.get(t);return i&&await k7e.add(i),i}function tCe(t){if(!ihe.test(t))return null;const e=ihe.exec(t);if(e===null)return null;const[,i,r]=e;return rhe(i+(r?"-"+r.toUpperCase():""))??rhe(i)}async function F7e(t,e){const i=[];for(const r of ZO)if(iCe(r.pattern,t))try{return await r.fetchMessageBundle(t,e)}catch(s){i.push(s)}throw i.length?new U("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:i}):new U("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function iCe(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}Zie(()=>{BC.clear()});const k7e=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=ta())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function z7e(t,e,i,r){const s=e.exec(i);if(!s)throw new U("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${e}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=tCe(r),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let h;try{h=await nhe(t(c))}catch(d){if(c===l)throw new U("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:d});try{h=await nhe(t(l))}catch(f){throw new U("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:f})}}return h}async function nhe(t){if(ohe.fetchBundleAsset!=null)return ohe.fetchBundleAsset(t);const e=await Ri(t,{responseType:"text"});return JSON.parse(e.data)}let U7e=class{constructor({base:e="",pattern:i,location:r=new URL(window.location.href)}){let s;s=typeof r=="string"?n=>new URL(n,new URL(r,window.location.href)).href:r instanceof URL?n=>new URL(n,r).href:r,this.pattern=typeof i=="string"?new RegExp(`^${i}`):i,this.getAssetUrl=s,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)\\/)?(.*)$`)}fetchMessageBundle(e,i){return z7e(this.getAssetUrl,this.matcher,e,i)}};function B7e(t){return new U7e(t)}const ohe={};N7e(B7e({pattern:"esri/",location:vs}));const ahe={};function V7e(t){var i;const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:((i=t.packages)==null?void 0:i.slice())||[],paths:{...ahe.paths,...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=ahe.baseUrl),e}let j7e=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(i=>{this[i]=(...r)=>e[i](...r)})}},I4=class{constructor(){this._dispatcher=new j7e,this._workerPostMessage({type:ya.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){R$(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,i,r){this._dispatcher.addEventListener(e,i,r)}removeEventListener(e,i,r){this._dispatcher.removeEventListener(e,i,r)}_workerPostMessage(e){R$(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const i=_3(e);if(i&&i.type===ya.OPEN){const{modulePath:r,jobId:s}=i;let n=await Nb.loadWorker(r);n||(n=await import(r));const o=Nb.connect(n);this._workerPostMessage({type:ya.OPENED,jobId:s,data:o})}}};const TZ=()=>J.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:G7e}=ya,H7e='let globalId=0;const outgoing=new Map,configuration={CONFIGURATION};self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;let s=null;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());s=()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))},t.addEventListener("abort",s)}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})})).finally((()=>{t&&t.removeEventListener("abort",s)}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\nModules version: ${r}\nAssets version: ${n??s}\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let fN,mN;const lhe="Failed to create Worker. Fallback to execute module in main thread";async function q7e(){if(!X("esri-workers"))return che(new I4);if(!fN&&!mN)try{const e=H7e.split("{CONFIGURATION}").join(W7e());fN=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){mN=e||{}}let t;if(fN)try{t=new Worker(fN,{name:"esri-worker-"+Z7e++})}catch{TZ().warn(lhe,mN),t=new I4}else TZ().warn(lhe,mN),t=new I4;return che(t)}async function che(t){return new Promise(e=>{function i(s){const n=_3(s);n&&n.type===G7e&&(t.removeEventListener("message",i),t.removeEventListener("error",r),e(t))}function r(s){s.preventDefault(),t.removeEventListener("message",i),t.removeEventListener("error",r),TZ().warn("Failed to create Worker. Fallback to execute module in main thread",s),(t=new I4).addEventListener("message",i),t.addEventListener("error",r)}t.addEventListener("message",i),t.addEventListener("error",r)})}function W7e(){let t;if(Rr.default!=null){const s={...Rr};delete s.default,t=JSON.parse(JSON.stringify(s))}else t=JSON.parse(JSON.stringify(Rr));t.assetsPath=Jc(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?Jc(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=iu(),t.has={"esri-csp-restrictions":X("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":X("esri-2d-update-debug"),"esri-2d-log-updating":X("esri-2d-log-updating"),"featurelayer-pbf":X("featurelayer-pbf"),"featurelayer-fast-triangulation-enabled":X("featurelayer-fast-triangulation-enabled"),"featurelayer-simplify-thresholds":X("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":X("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":X("featurelayer-simplify-mobile-factor"),"featurelayer-query-max-depth":X("featurelayer-query-max-depth"),"featurelayer-query-pausing-enabled":X("featurelayer-query-pausing-enabled"),"featurelayer-snapshot-enabled":X("featurelayer-snapshot-enabled"),"esri-atomics":X("esri-atomics"),"esri-shared-array-buffer":X("esri-shared-array-buffer"),"esri-tiles-debug":X("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":X("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":X("feature-polyline-generalization-factor"),"host-webworker":1},t.workers.loaderUrl&&(t.workers.loaderUrl=Jc(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=Jc(t.workers.workerPath):t.workers.workerPath=Jc(vs("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=Rr.workers.loaderConfig,i=V7e({baseUrl:e==null?void 0:e.baseUrl,locale:iu(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e==null?void 0:e.has},map:{...e==null?void 0:e.map},paths:{...e==null?void 0:e.paths},packages:(e==null?void 0:e.packages)||[]});return JSON.stringify({esriConfig:t,loaderConfig:i,kernelInfo:{buildDate:ITe,fullVersion:xie,revision:RTe}})}let Z7e=0;const{ABORT:uhe,INVOKE:Y7e,OPEN:J7e,OPENED:X7e,RESPONSE:kM}=ya;let K7e=class rCe{static async create(e){const i=await q7e();return new rCe(i,e)}constructor(e,i){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=i,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",r=>{r.preventDefault(),J.getLogger("esri.core.workers.WorkerOwner").error(r)})}terminate(){this.worker.terminate()}async open(e,i={}){const{signal:r}=i,s=HEe();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:zD(r,()=>{this._outJobs.delete(s),this._post({type:uhe,jobId:s})})};this._outJobs.set(s,a),this._post({type:J7e,jobId:s,modulePath:e})})}_onMessage(e){const i=_3(e);if(i)switch(i.type){case X7e:this._onOpenedMessage(i);break;case kM:this._onResponseMessage(i);break;case uhe:this._onAbortMessage(i);break;case Y7e:this._onInvokeMessage(i)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,s=i.get(r);s&&(s.controller&&s.controller.abort(),i.delete(r))}_onInvokeMessage(e){const{methodName:i,jobId:r,data:s,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs,l=yqe[i];let c;try{if(typeof l!="function")throw new TypeError(`${i} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(h){return void this._post({type:kM,jobId:r,error:v3(h)})}uu(c)?(a.set(r,{controller:o,promise:c}),c.then(h=>{a.has(r)&&(a.delete(r),this._post({type:kM,jobId:r},h))},h=>{a.has(r)&&(a.delete(r),h||(h={message:"Error encountered at method"+i}),es(h)||this._post({type:kM,jobId:r,error:v3(h||{message:`Error encountered at method ${i}`})}))})):this._post({type:kM,jobId:r},c)}_onOpenedMessage(e){const{jobId:i,data:r}=e,s=this._outJobs.get(i);s&&(this._outJobs.delete(i),Ji(s.abortHandle),s.resolve(r))}_onResponseMessage(e){const{jobId:i,error:r,data:s}=e,n=this._outJobs.get(i);n&&(this._outJobs.delete(i),Ji(n.abortHandle),r?n.reject(U.fromJSON(JSON.parse(r))):n.resolve(s))}_post(e,i,r){return Wie(this.worker,e,i,r)}};const hhe=X("host-browser")?Math.min(navigator.hardwareConcurrency-1,X("workers-pool-size")??8):0;let Ax=X("esri-mobile")?Math.min(hhe,3):hhe;Ax||(Ax=X("safari")&&X("mac")?7:2);let dhe=0;const R4=[];function sCe(){oCe()}async function gN(t,e){const i=new gqe,{registryTarget:r,...s}=e;return await i.open(t,s),r&&oqe(r,i),i}async function nCe(t,e={}){if(typeof t!="string")throw new U("workers:undefined-module","modulePath is missing");let i=e.strategy||"distributed";if(X("host-webworker")&&!X("esri-workers")&&(i="local"),i==="local"){let r=await Nb.loadWorker(t);r||(r=await import(t)),gt(e.signal);const s=e.client||r;return gN([Nb.connect(r,e.schedule)],{...e,client:s})}if(await oCe(),gt(e.signal),i==="dedicated"){const r=dhe++%Ax;return gN([await R4[r].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const r=Math.min(e.maxNumWorkers,Ax);if(r<Ax){const s=new Array(r);for(let n=0;n<r;++n){const o=dhe++%Ax;s[n]=R4[o].open(t,e)}return gN(s,e)}}return gN(R4.map(r=>r.open(t,e)),e)}let yN=null;async function oCe(){if(yN)return yN;new AbortController;const t=[];for(let e=0;e<Ax;e++){const i=K7e.create(e).then(r=>(R4[e]=r,r));t.push(i)}return yN=Promise.all(t),yN}function $(){return[0,0,0]}function os(t){return[t[0],t[1],t[2]]}function De(t,e,i){return[t,e,i]}function yf(t,e,i){return[t,e,i]}function H$(t,e=$()){const i=Math.min(3,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function Q7e(t,e){return new Float64Array(t,e,3)}function nM(){return $()}function sre(){return De(1,1,1)}function aCe(){return De(1,0,0)}function lCe(){return De(0,1,0)}function nre(){return De(0,0,1)}const cn=nM(),ore=sre(),are=aCe(),lre=lCe(),q$=nre();Object.freeze(Object.defineProperty({__proto__:null,ONES:ore,UNIT_X:are,UNIT_Y:lre,UNIT_Z:q$,ZEROS:cn,clone:os,create:$,createView:Q7e,freeze:yf,fromArray:H$,fromValues:De,ones:sre,unitX:aCe,unitY:lCe,unitZ:nre,zeros:nM},Symbol.toStringTag,{value:"Module"}));const m9t=Math.PI/180,g9t=/(?:SPHEROID|ELLIPSOID)\[([^\]]+)]/i,h0=Ci.radius,Jd=Ci.eccentricitySquared,eWe={a1:h0*Jd,a2:h0*Jd*h0*Jd,a3:h0*Jd*Jd/2,a4:h0*Jd*h0*Jd*2.5,a5:h0*Jd+h0*Jd*Jd/2,a6:1-Jd},y9t={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:Ci.radius,f:Ci.flattening},4490:{a:6378137,f:1/298.257222101},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:gv.radius,f:gv.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:nf.radius,f:nf.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:nf.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};var K;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.SPHERICAL_MARS_PCPF=6]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=7]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=8]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=9]="GCSMOON2000",t[t.LON_LAT=10]="LON_LAT",t[t.PLATE_CARREE=11]="PLATE_CARREE"})(K||(K={}));const YO={[K.WGS84]:{[K.CGCS2000]:ys,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:ys,[K.SPHERICAL_ECEF]:GC,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:qx,[K.PLATE_CARREE]:Wx,[K.WGS84]:ys,[K.WGS84_ECEF]:Yx},[K.CGCS2000]:{[K.CGCS2000]:ys,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:ys,[K.SPHERICAL_ECEF]:GC,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:qx,[K.PLATE_CARREE]:Wx,[K.WGS84]:ys,[K.WGS84_ECEF]:Yx},[K.GCSMARS2000]:{[K.CGCS2000]:null,[K.GCSMARS2000]:ys,[K.GCSMOON2000]:null,[K.LON_LAT]:ys,[K.SPHERICAL_ECEF]:null,[K.SPHERICAL_MARS_PCPF]:CZ,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:null,[K.WGS84]:null,[K.WGS84_ECEF]:null},[K.GCSMOON2000]:{[K.CGCS2000]:null,[K.GCSMARS2000]:null,[K.GCSMOON2000]:ys,[K.LON_LAT]:ys,[K.SPHERICAL_ECEF]:null,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:EZ,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:null,[K.WGS84]:null,[K.WGS84_ECEF]:null},[K.WEB_MERCATOR]:{[K.CGCS2000]:VC,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:VC,[K.SPHERICAL_ECEF]:uCe,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:ys,[K.PLATE_CARREE]:dCe,[K.WGS84]:VC,[K.WGS84_ECEF]:hCe},[K.WGS84_ECEF]:{[K.CGCS2000]:Jx,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:Jx,[K.SPHERICAL_ECEF]:mCe,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:gCe,[K.PLATE_CARREE]:iWe,[K.WGS84]:Jx,[K.WGS84_ECEF]:ys},[K.SPHERICAL_ECEF]:{[K.CGCS2000]:Zx,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:Zx,[K.SPHERICAL_ECEF]:ys,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:pCe,[K.PLATE_CARREE]:rWe,[K.WGS84]:Zx,[K.WGS84_ECEF]:fCe},[K.SPHERICAL_MARS_PCPF]:{[K.CGCS2000]:null,[K.GCSMARS2000]:AZ,[K.GCSMOON2000]:null,[K.LON_LAT]:AZ,[K.SPHERICAL_ECEF]:null,[K.SPHERICAL_MARS_PCPF]:ys,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:null,[K.WGS84]:null,[K.WGS84_ECEF]:null},[K.SPHERICAL_MOON_PCPF]:{[K.CGCS2000]:null,[K.GCSMARS2000]:null,[K.GCSMOON2000]:$Z,[K.LON_LAT]:$Z,[K.SPHERICAL_ECEF]:null,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:ys,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:null,[K.WGS84]:null,[K.WGS84_ECEF]:null},[K.UNKNOWN]:{[K.CGCS2000]:null,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:null,[K.SPHERICAL_ECEF]:null,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:ys,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:null,[K.WGS84]:null,[K.WGS84_ECEF]:null},[K.LON_LAT]:{[K.CGCS2000]:ys,[K.GCSMARS2000]:ys,[K.GCSMOON2000]:ys,[K.LON_LAT]:ys,[K.SPHERICAL_ECEF]:GC,[K.SPHERICAL_MARS_PCPF]:CZ,[K.SPHERICAL_MOON_PCPF]:EZ,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:qx,[K.PLATE_CARREE]:Wx,[K.WGS84]:ys,[K.WGS84_ECEF]:Yx},[K.PLATE_CARREE]:{[K.CGCS2000]:jC,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:jC,[K.SPHERICAL_ECEF]:sWe,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:nWe,[K.PLATE_CARREE]:ys,[K.WGS84]:jC,[K.WGS84_ECEF]:oWe}};function kb(t,e){var i;return(i=cCe(t,e))==null?void 0:i.projector}function cCe(t,e){if(t==null||e==null)return null;if(Og.source.spatialReference===t&&Og.dest.spatialReference===e)return Og;const i=phe(t,Og.source),r=phe(e,Og.dest);return i===K.UNKNOWN&&r===K.UNKNOWN?as(t,e)?Og.projector=ys:Og.projector=null:Og.projector=YO[i][r],Og}function v9t(t,e){switch(kb(t,e)){case ys:return"copy3";case GC:return"wgs84ToSphericalECEF";case qx:return"wgs84ToWebMercator";case Wx:return"wgs84ToPlateCarree";case Yx:return"wgs84ToWGS84ECEF";case VC:return"webMercatorToWGS84";case uCe:return"webMercatorToSphericalECEF";case hCe:return"webMercatorToWGS84ECEF";case dCe:return"webMercatorToPlateCarree";case Jx:return"wgs84ECEFToWGS84";case mCe:return"wgs84ECEFToSphericalECEF";case gCe:return"wgs84ECEFToWebMercator";case Zx:return"sphericalECEFToWGS84";case pCe:return"sphericalECEFToWebMercator";case AZ:return"sphericalMarsPCPFToMars2000";case $Z:return"sphericalMoonPCPFToMoon2000";case fCe:return"sphericalECEFToWGS84ECEF";case CZ:return"mars2000ToSphericalPCPF";case EZ:return"moon2000ToSphericalPCPF";default:return null}}function phe(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=Mo(t,1)),IU(t)?e.spatialReferenceId=K.SPHERICAL_ECEF:Pb(t)?e.spatialReferenceId=K.WGS84:rg(t)?e.spatialReferenceId=K.WEB_MERCATOR:m3(t)?e.spatialReferenceId=K.PLATE_CARREE:t.wkt===KTe.wkt?e.spatialReferenceId=K.WGS84_ECEF:t.wkid===Xc.CGCS2000?e.spatialReferenceId=K.CGCS2000:t.wkt===Hj.wkt?e.spatialReferenceId=K.SPHERICAL_MARS_PCPF:t.wkt===qj.wkt?e.spatialReferenceId=K.SPHERICAL_MOON_PCPF:KA(t)?e.spatialReferenceId=K.GCSMARS2000:QA(t)?e.spatialReferenceId=K.GCSMOON2000:e.spatialReferenceId=K.UNKNOWN):K.UNKNOWN}function ys(t,e,i,r){t!==i&&(i[r++]=t[e++],i[r++]=t[e++],i[r]=t[e])}function VC(t,e,i,r){i[r]=Z$*(t[e]/Xx),i[r+1]=Z$*(yCe-2*Math.atan(Math.exp(-t[e+1]/Xx))),i[r+2]=t[e+2]}function uCe(t,e,i,r){const s=t[e]/Xx,n=yCe-2*Math.atan(Math.exp(-t[e+1]/Xx)),o=Xx+t[e+2],a=Math.cos(n)*o;i[r]=Math.cos(s)*a,i[r+1]=Math.sin(s)*a,i[r+2]=Math.sin(n)*o}function hCe(t,e,i,r){VC(t,e,i,r),Yx(i,r,i,r)}function tWe(t,e,i,r,s){const n=.4999999*Math.PI,o=ue(W$*t[e+1],-n,n),a=Math.sin(o);i[r++]=W$*t[e]*s.radius,i[r++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),i[r]=t[e+2]}function qx(t,e,i,r){tWe(t,e,i,r,Ci)}function Wx(t,e,i,r){i[r]=t[e]*fhe,i[r+1]=t[e+1]*fhe,i[r+2]=t[e+2]}function jC(t,e,i,r){i[r]=t[e]*mhe,i[r+1]=t[e+1]*mhe,i[r+2]=t[e+2]}function dCe(t,e,i,r){VC(t,e,i,r),Wx(i,r,i,r)}function iWe(t,e,i,r){Jx(t,e,i,r),Wx(i,r,i,r)}function rWe(t,e,i,r){Zx(t,e,i,r),Wx(i,r,i,r)}function sWe(t,e,i,r){jC(t,e,i,r),GC(i,r,i,r)}function nWe(t,e,i,r){jC(t,e,i,r),qx(i,r,i,r)}function oWe(t,e,i,r){jC(t,e,i,r),Yx(i,r,i,r)}function cre(t,e,i,r,s){const n=s+t[e+2],o=W$*t[e+1],a=W$*t[e],l=Math.cos(o)*n;i[r]=Math.cos(a)*l,i[r+1]=Math.sin(a)*l,i[r+2]=Math.sin(o)*n}function EZ(t,e,i,r){cre(t,e,i,r,gv.radius)}function CZ(t,e,i,r){cre(t,e,i,r,nf.radius)}function GC(t,e,i,r){cre(t,e,i,r,Ci.radius)}function ure(t,e,i,r,s){const n=t[e],o=t[e+1],a=t[e+2],l=Math.sqrt(n*n+o*o+a*a),c=Md(a/(l===0?1:l)),h=Math.atan2(o,n);i[r++]=Z$*h,i[r++]=Z$*c,i[r]=l-s}function $Z(t,e,i,r){ure(t,e,i,r,gv.radius)}function AZ(t,e,i,r){ure(t,e,i,r,nf.radius)}function Zx(t,e,i,r){ure(t,e,i,r,Ci.radius)}function pCe(t,e,i,r){Zx(t,e,i,r),qx(i,r,i,r)}function fCe(t,e,i,r){Zx(t,e,i,r),Yx(i,r,i,r)}function aWe(t,e,i,r,s){const n=W$*t[e],o=W$*t[e+1],a=t[e+2],l=Math.sin(o),c=Math.cos(o),h=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);i[r++]=(h+a)*c*Math.cos(n),i[r++]=(h+a)*c*Math.sin(n),i[r++]=(h*(1-s.eccentricitySquared)+a)*l}function Yx(t,e,i,r){aWe(t,e,i,r,Ci)}function Jx(t,e,i,r){const s=eWe,n=t[e],o=t[e+1],a=t[e+2];let l,c,h,d,f,m,g,v,_,b,w,x,S,C,T,M,I,D,P,F,L;l=Math.abs(a),c=n*n+o*o,h=Math.sqrt(c),d=c+a*a,f=Math.sqrt(d),F=Math.atan2(o,n),m=a*a/d,g=c/d,C=s.a2/f,T=s.a3-s.a4/f,g>.3?(v=l/f*(1+g*(s.a1+C+m*T)/f),P=Math.asin(v),b=v*v,_=Math.sqrt(1-b)):(_=h/f*(1-m*(s.a5-C-g*T)/f),P=Math.acos(_),b=1-_*_,v=Math.sqrt(b)),w=1-Ci.eccentricitySquared*b,x=Ci.radius/Math.sqrt(w),S=s.a6*x,C=h-x*_,T=l-S*v,I=_*C+v*T,M=_*T-v*C,D=M/(S/w+I),P+=D,L=I+M*D/2,a<0&&(P=-P),i[r++]=Z$*F,i[r++]=Z$*P,i[r]=L}function mCe(t,e,i,r){Jx(t,e,i,r),GC(i,r,i,r)}function gCe(t,e,i,r){Jx(t,e,i,r),qx(i,r,i,r)}const Og={source:{spatialReference:null,spatialReferenceId:K.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:K.UNKNOWN,metersPerUnit:1},projector:ys},W$=At(1),Z$=Ao(1),yCe=.5*Math.PI,Xx=Ci.radius,fhe=Xx*Math.PI/180,mhe=180/(Xx*Math.PI);function Gn(t,e,i,r,s,n,o=Math.floor(t.length/3)){const a=kb(e,s);if(a==null)return!1;if(a===ys){if(t===r&&i===n)return!0;const c=i+3*o;for(let h=i,d=n;h<c;h++,d++)r[d]=t[h];return!0}const l=i+3*o;for(let c=i,h=n;c<l;c+=3,h+=3)a(t,c,r,h);return!0}const _9t=Object.freeze(Object.defineProperty({__proto__:null,projectBuffer:Gn},Symbol.toStringTag,{value:"Module"}));function ghe(t,e,i,r,s,n){return vN[0]=t,vN[1]=e,vN[2]=i,Gn(vN,r,0,s,n,0)}const vN=$();let _N=0,QH=class MZ{static fromGE(e){const i=new MZ;return i._wkt=e.wkt,i._wkid=e.wkid,i._isInverse=e.isInverse,i}constructor(e){this.uid=_N++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=_N++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=_N++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=_N++}getInverse(){const e=new MZ;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},BU=class JO{static cacheKey(e,i){var r,s,n,o,a,l;return[((r=e.wkid)==null?void 0:r.toString())??"-1",((s=e.wkt)==null?void 0:s.toString())??"",((n=e.wkt2)==null?void 0:n.toString())??"",((o=i.wkid)==null?void 0:o.toString())??"-1",((a=i.wkt)==null?void 0:a.toString())??"",((l=i.wkt2)==null?void 0:l.toString())??""].join()}static fromGE(e){const i=new JO;let r="";for(const s of e.steps){const n=QH.fromGE(s);i.steps.push(n),r+=n.uid.toString()+","}return i._cachedProjection={},i._gtlistentry=null,i._chain=r,i}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e==null?void 0:e.steps)for(const i of e.steps)i instanceof QH?this.steps.push(i):this.steps.push(new QH({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}getInverse(){const e=new JO;e.steps=[];for(let i=this.steps.length-1;i>=0;i--){const r=this.steps[i];e.steps.push(r.getInverse())}return e}getGTListEntry(){let e="";for(const i of this.steps)e+=i.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,i,r){this._cachedProjection[JO.cacheKey(e,i)]=r}getCachedGeTransformation(e,i){let r="";for(const n of this.steps)r+=n.uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=r);const s=this._cachedProjection[JO.cacheKey(e,i)];return s===void 0?null:s}};function vCe(t,e,i){if(e==null||i==null||i.vcsWkid||as(e,i)||Db(e)||Db(i))return null;const r=gS(e)/gS(i);if(r===1)return null;switch(t){case"point":case"esriGeometryPoint":return s=>lWe(s,r);case"polyline":case"esriGeometryPolyline":return s=>uWe(s,r);case"polygon":case"esriGeometryPolygon":return s=>cWe(s,r);case"multipoint":case"esriGeometryMultipoint":return s=>hWe(s,r);case"extent":case"esriGeometryEnvelope":return s=>dWe(s,r);default:return null}}function lWe(t,e){(t==null?void 0:t.z)!=null&&(t.z*=e)}function cWe(t,e){if(t)for(const i of t.rings)for(const r of i)r.length>2&&(r[2]*=e)}function uWe(t,e){if(t)for(const i of t.paths)for(const r of i)r.length>2&&(r[2]*=e)}function hWe(t,e){if(t)for(const i of t.points)i.length>2&&(i[2]*=e)}function dWe(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let af=null,zb=null,XR=null,P4={};const hre=new qD;function Uv(){return!!af&&Cie()}function _Ce(){return!!Uv()||(Pt(hre),vv(),!1)}function V_(t,e){return!t||!e||lu(t,e)||_Ce()}function bCe(t,e){return!lu(t,e)&&!Uv()}function vv(t){return XR==null&&(XR=Promise.all([jTe(),G(()=>import("./geometryEngineBase-B0ZyeKAX.js"),__vite__mapDeps([11,3])).then(e=>e.g),G(()=>import("./hydrated-8eZrnzf3.js"),[])])),XR.then(([,e,{hydratedAdapter:i}])=>{gt(t),zb=i,af=e.default,af._enableProjection(SHe),hre.notify()})}function Nd(t,e,i=null,r=null){return Array.isArray(t)?t.length===0?[]:(ZHe(t),OZ(zb,t,t[0].spatialReference,e,i,r)):(z$(t),OZ(zb,[t],t.spatialReference,e,i,r)[0])}function OZ(t,e,i,r,s=null,n=null){if(i==null||r==null)return e;if(lu(i,r,s))return e.map(o=>KR(o,i,r));if(s==null&&IU(i))return e.map(o=>KR(o,i,Oe.WGS84)).map(o=>Ub(o,r));if(s==null&&IU(r))return e.map(o=>Ub(o,Oe.WGS84)).map(o=>KR(o,Oe.WGS84,r));if(s==null){const o=BU.cacheKey(i,r);P4[o]!==void 0?s=P4[o]:((s=xCe(i,r,void 0))==null&&(s=new BU),P4[o]=s)}if(af==null||t==null)throw new sG;return n!=null?af._project(t,e,i,r,s,n):af._project(t,e,i,r,s)}function pWe(t,e){const i=wCe([t],e);return i.pending!=null?{pending:i.pending,geometry:null}:i.geometries!=null?{pending:null,geometry:i.geometries[0]}:{pending:null,geometry:null}}function wCe(t,e){if(!Uv()){for(const i of t)if(i!=null&&!as(i.spatialReference,e)&&Xu(i.spatialReference)&&Xu(e)&&!lu(i.spatialReference,e))return Pt(hre),{pending:vv(),geometries:null}}return{pending:null,geometries:t.map(i=>i==null?null:as(i.spatialReference,e)?i:Xu(i.spatialReference)&&Xu(e)?Ub(i,e):null)}}function xCe(t,e,i=null){if(t==null||e==null)return null;if(af==null||zb==null)throw new sG;const r=af._getTransformation(zb,t,e,i,i==null?void 0:i.spatialReference);return r!==null?BU.fromGE(r):null}function fWe(t,e,i=null){if(af==null||zb==null)throw new sG;const r=af._getTransformationBySuitability(zb,t,e,i,i==null?void 0:i.spatialReference);if(r!==null){const s=[];for(const n of r)s.push(BU.fromGE(n));return s}return[]}let sG=class extends U{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}};function mWe(){af=null,zb=null,XR=null,P4={}}const gWe={get loadPromise(){return XR}};function Ub(t,e){try{const i=Nd(t,e);if(i==null)return null;"xmin"in t&&"xmin"in i&&(i.zmin=t.zmin,i.zmax=t.zmax);const r=vCe(i.type,t.spatialReference,e);return r!=null&&r(i),i}catch(i){if(!(i instanceof sG))throw i;return null}}async function Bb(t,e,i){const r=t.spatialReference;return r!=null&&e!=null&&await XD(r,e,null,i),Ub(t,e)}function lu(t,e,i){return!i&&(!!as(t,e)||Xu(t)&&Xu(e)&&!!kb(t,e))}function yWe(t,e){if(as(t,e))return!0;if(!Xu(t)||!Xu(e))return!1;const i=Pb(t)||rg(t)||OU(t),r=Pb(e)||rg(e)||OU(e);return i&&r}async function XD(t,e,i,r){if(Uv())return Hce(r);if(Array.isArray(t)){for(const{source:s,dest:n,geographicTransformation:o}of t)if(s&&n&&!lu(s,n,o))return vv(r)}else if(t&&e&&!lu(t,e,i))return vv(r);return Hce(r)}function KR(t,e,i){return t?"x"in t?TCe(t,e,new Fe,i,0):"xmin"in t?ACe(t,e,new _i,i,0):"rings"in t?$Ce(t,e,new Ea,i,0):"paths"in t?CCe(t,e,new _d,i,0):"points"in t?ECe(t,e,new WS,i,0):null:null}function SCe(t,e,i=e.spatialReference,r=0){return i!=null&&t.spatialReference!=null&&TCe(t,t.spatialReference,e,i,r)!=null}function TCe(t,e,i,r,s){bl[0]=t.x,bl[1]=t.y;const n=t.z;return bl[2]=n!==void 0?n:s,Gn(bl,e,0,bl,r,0)?(i.x=bl[0],i.y=bl[1],i.spatialReference=r,n!==void 0||Db(r)?(i.z=bl[2],i.hasZ=!0):(i.z=void 0,i.hasZ=!1),t.m===void 0?(i.m=void 0,i.hasM=!1):(i.m=t.m,i.hasM=!0),i):null}function vWe(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&ECe(t,t.spatialReference,e,i,r)!=null}function ECe(t,e,i,r,s){const{points:n,hasZ:o,hasM:a}=t,l=[],c=n.length,h=[];for(const f of n)h.push(f[0],f[1],o?f[2]:s);if(!Gn(h,e,0,h,r,0,c))return null;const d=o||Db(r);for(let f=0;f<c;++f){const m=3*f,g=h[m],v=h[m+1];d&&a?l.push([g,v,h[m+2],n[f][3]]):d?l.push([g,v,h[m+2]]):a?l.push([g,v,n[f][2]]):l.push([g,v])}return i.points=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i}function _We(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&CCe(t,t.spatialReference,e,i,r)!=null}function CCe(t,e,i,r,s){const{paths:n,hasZ:o,hasM:a}=t,l=[];if(!MCe(n,o??!1,a??!1,e,l,r,s))return null;const c=o||Db(r);return i.paths=l,i.spatialReference=r,i.hasZ=c,i.hasM=a,i}function bWe(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&$Ce(t,t.spatialReference,e,i,r)!=null}function $Ce(t,e,i,r,s){const{rings:n,hasZ:o,hasM:a}=t,l=[];if(!MCe(n,o??!1,a??!1,e,l,r,s))return null;const c=o||Db(r);return i.rings=l,i.spatialReference=r,i.hasZ=c,i.hasM=a,i}function wWe(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&ACe(t,t.spatialReference,e,i,r)!=null}function ACe(t,e,i,r,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:h}=t,d=c?t.zmin:s;if(!ghe(n,o,d,e,bl,r))return null;const f=c||Db(r);i.xmin=bl[0],i.ymin=bl[1],f&&(i.zmin=bl[2]);const m=c?t.zmax:s;return ghe(a,l,m,e,bl,r)?(i.xmax=bl[0],i.ymax=bl[1],f&&(i.zmax=bl[2]),h&&(i.mmin=t.mmin,i.mmax=t.mmax),i.spatialReference=r,i):null}function MCe(t,e,i,r,s,n,o=0){const a=new Array;for(const h of t)for(const d of h)a.push(d[0],d[1],e?d[2]:o);if(!Gn(a,r,0,a,n,0))return!1;let l=0;s.length=0;const c=e||Db(n);for(const h of t){const d=new Array;for(const f of h)c&&i?d.push([a[l++],a[l++],a[l++],f[3]]):c?d.push([a[l++],a[l++],a[l++]]):i?(d.push([a[l++],a[l++],f[2]]),l++):(d.push([a[l++],a[l++]]),l++);s.push(d)}return!0}const bl=$(),w9t=Object.freeze(Object.defineProperty({__proto__:null,canProjectWithoutEngine:lu,getTransformation:xCe,getTransformations:fWe,initializeProjection:XD,isEqualBaseGCS:yWe,isLoaded:Uv,isLoadedOrLoad:_Ce,isLoadedOrLoadFor:V_,load:vv,project:Nd,projectExtent:wWe,projectMany:OZ,projectMultipoint:vWe,projectOrLoad:pWe,projectOrLoadMany:wCe,projectPoint:SCe,projectPolygon:bWe,projectPolyline:_We,projectWithZConversion:Bb,projectWithoutEngine:KR,requiresLoad:bCe,test:gWe,tryProjectWithZConversion:Ub,unload:mWe},Symbol.toStringTag,{value:"Module"}));var IZ;let Jf=IZ=class extends ee{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new IZ({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};u([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Jf.prototype,"cols",void 0),u([p({type:Ii,json:{write:!0}})],Jf.prototype,"level",void 0),u([p({type:String,json:{write:!0}})],Jf.prototype,"levelValue",void 0),u([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Jf.prototype,"origin",void 0),u([p({type:Number,json:{write:!0}})],Jf.prototype,"resolution",void 0),u([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Jf.prototype,"rows",void 0),u([p({type:Number,json:{write:!0}})],Jf.prototype,"scale",void 0),Jf=IZ=u([A("esri.layers.support.LOD")],Jf);const td=Jf;let xWe=class{constructor(e,i,r,s,n=void 0){this.id=e,this.level=i,this.row=r,this.col=s,this.extent=n}};var U0;const yhe=new ni({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let La=U0=class extends ee{static create(t={}){const{resolutionFactor:e=1,scales:i,size:r=256,spatialReference:s=Oe.WebMercator,numLODs:n=24}=t;if(!Xu(s)){const d=[];if(i)for(let f=0;f<i.length;f++){const m=i[f];d.push(new td({level:f,scale:m,resolution:m}))}else{let f=5e-4;for(let m=n-1;m>=0;m--)d.unshift(new td({level:m,scale:f,resolution:f})),f*=2}return new U0({dpi:96,lods:d,origin:new Fe(0,0,s),size:[r,r],spatialReference:s})}const o=hc(s),a=t.origin?new Fe({x:t.origin.x,y:t.origin.y,spatialReference:s}):new Fe(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/(Mo(s)*39.37*l),h=[];if(i)for(let d=0;d<i.length;d++){const f=i[d],m=f*c;h.push(new td({level:d,scale:f,resolution:m}))}else{let d=HS(s)?512/r*5916575275917094e-7:256/r*591657527591555e-6;const f=Math.ceil(n/e);h.push(new td({level:0,scale:d,resolution:d*c}));for(let m=1;m<f;m++){const g=d/2**e,v=g*c;h.push(new td({level:m,scale:g,resolution:v})),d=g}}return new U0({dpi:l,lods:h,origin:a,size:[r,r],spatialReference:s})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const i=hc(t);return t.isWrappable&&!!i&&Math.abs(i.origin[0]-e.x)<=i.dx}return!1}readOrigin(t,e){return Fe.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,i=0;const r=[],s=this._levelToLOD={};t&&(e=-1/0,i=1/0,t.forEach(n=>{r.push(n.scale),e=n.scale>e?n.scale:e,i=n.scale<i?n.scale:i,s[n.level]=n})),this._set("scales",r),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const i=Math.floor(t),r=i+1;return e[i]/(e[i]/e[r])**(t-i)}scaleToZoom(t){const e=this.scales,i=e.length-1;let r=0;for(;r<i;r++){const s=e[r],n=e[r+1];if(s<=t)return r;if(n===t)return r+1;if(s>t&&n<t)return r+Math.log(s/t)/Math.log(s/n)}return r}tileAt(t,e,i,r){const s=this.lodAt(t);if(!s)return null;let n,o;if(typeof e=="number")n=e,o=i;else if(as(e.spatialReference,this.spatialReference))n=e.x,o=e.y,r=i;else{const c=VD(e,this.spatialReference);if(c==null)return null;n=c.x,o=c.y,r=i}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return r||(r=new xWe(null,0,0,0,si())),r.level=t,r.row=Math.floor((this.origin.y-o)/l+.001),r.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(r),r}updateTileInfo(t,e=U0.ExtrapolateOptions.NONE){let i=this.lodAt(t.level);if(!i&&e===U0.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<t.level&&(i=o)}if(!i)return;const r=t.level-i.level,s=i.resolution*this.size[0]/2**r,n=i.resolution*this.size[1]/2**r;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=si()),t.extent[0]=this.origin.x+t.col*s,t.extent[1]=this.origin.y-(t.row+1)*n,t.extent[2]=t.extent[0]+s,t.extent[3]=t.extent[1]+n}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const i=this.lodAt(e.level);if(i==null)return null;const{resolution:r}=i,s=r*this.size[0],n=r*this.size[1];return t[0]=this.origin.x+e.col*s,t[1]=this.origin.y-(e.row+1)*n,t[2]=t[0]+s,t[3]=t[1]+n,t}lodAt(t){var e;return((e=this._levelToLOD)==null?void 0:e[t])??null}clone(){return U0.fromJSON(this.write({}))}getCompatibleForVTL(t){if(this.size[0]!==this.size[1]||this.size[0]===256&&t===512)return null;const e=(this.size[0]===512&&t===256?-1:0)+(this.spatialReference.isGeographic?1:0);if(this.size[0]===t&&e===0)return this;const i=[],r=this.lods.length-e;for(let s=0;s<r;s++){const n=s+e,{scale:o,resolution:a}=n>=0?this.lods[n]:{scale:2*this.lods[0].scale,resolution:2*this.lods[0].resolution};i.push(new td({level:s,scale:o,resolution:a}))}return new U0({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let i=0;i<t.length;i++){const r=t[i];this._upsampleLevels[r.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/r.resolution:0},e=r}}};u([p({type:Number,json:{write:!0}})],La.prototype,"compressionQuality",void 0),u([p({type:Number,json:{write:!0}})],La.prototype,"dpi",void 0),u([p({type:String,json:{read:yhe.read,write:yhe.write,origins:{"web-scene":{read:!1,write:!1}}}})],La.prototype,"format",void 0),u([p({readOnly:!0})],La.prototype,"isWrappable",null),u([p({type:Fe,json:{write:!0}})],La.prototype,"origin",void 0),u([ve("origin")],La.prototype,"readOrigin",null),u([p({type:[td],value:null,json:{write:!0}})],La.prototype,"lods",null),u([p({readOnly:!0})],La.prototype,"scales",void 0),u([p({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],La.prototype,"size",void 0),u([ve("size",["rows","cols"])],La.prototype,"readSize",null),u([_e("size",{cols:{type:Ii},rows:{type:Ii}})],La.prototype,"writeSize",null),u([p({type:Oe,json:{write:!0}})],La.prototype,"spatialReference",void 0),La=U0=u([A("esri.layers.support.TileInfo")],La),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(La||(La={}));const QR=La,D4={widthBreakpoint:{getValue(t){const e=t.viewSize[0],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,i=e[0],r=e[1],s=this.values;return r>=i?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},e8={xsmall:544,small:768,medium:992,large:1200};function SWe(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function t8(t,e){return e?D4[t].valueToClassName[e].split(" "):[]}const OCe=t=>{let e=class extends t{constructor(...i){super(...i),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=e8}initialize(){this.addHandles(H(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Ut))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(i){if(i!==this._get("breakpoints")){if(!SWe(i)){const r=JSON.stringify(e8,null,2);console.warn("provided breakpoints are not valid, using defaults:"+r),i=e8}this._set("breakpoints",{...i})}}_updateClassNames(){if(!this.container)return;const i=sc.acquire(),r=sc.acquire();let s,n=!1;for(s in D4){const o=this[s],a=D4[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,t8(s,o).forEach(l=>r.push(l)),t8(s,a).forEach(l=>i.push(l)))}n&&(this._applyClassNameChanges(i,r),sc.release(i),sc.release(r))}_applyClassNameChanges(i,r){const s=this.container;s&&(r.forEach(n=>s.classList.remove(n)),i.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const i=this.container;if(!i)return;let r;for(r in D4)t8(r,this[r]).forEach(s=>i.classList.remove(s))}};return u([p()],e.prototype,"breakpoints",null),u([p()],e.prototype,"orientation",void 0),u([p()],e.prototype,"widthBreakpoint",void 0),u([p()],e.prototype,"heightBreakpoint",void 0),e=u([A("esri.views.BreakpointsOwner")],e),e};function nG(t){return typeof t=="string"?document.getElementById(t):t??null}function vhe(t,e){for(;;){const i=t.firstChild;if(!i)break;e.appendChild(i)}}let rv=class extends he{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(e,i,r={}){return this._installWatch(e,i,r,H)}addWhen(e,i,r={}){return this._installWatch(e,i,r,bn)}addOnCollectionChange(e,i,{initial:r=!1,final:s=!1}={}){const n=++this._handleId;return this.addHandles([so(e,"after-changes",this._createSyncUpdatingCallback(),Yt),so(e,"change",i,{onListenerAdd:r?o=>i({added:o.toArray(),removed:[]}):void 0,onListenerRemove:s?o=>i({added:[],removed:o.toArray()}):void 0})],n),Pi(()=>this.removeHandles(n))}addPromise(e){if(e==null)return e;const i=++this._handleId;this.addHandles(Pi(()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this.hasHandles(bN)||this._set("updating",!1))}),i),this._pendingPromises.add(e),this._set("updating",!0);const r=()=>this.removeHandles(i);return e.then(r,r),e}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set("updating",!1)}_installWatch(e,i,r={},s){const n=++this._handleId;r.sync||this._installSyncUpdatingWatch(e,n);const o=s(e,i,r);return this.addHandles(o,n),Pi(()=>this.removeHandles(n))}_installSyncUpdatingWatch(e,i){const r=this._createSyncUpdatingCallback(),s=H(e,r,{sync:!0,equals:()=>!1});return this.addHandles(s,i),s}_createSyncUpdatingCallback(){return()=>{this.removeHandles(bN),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this.addHandles(YA(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this.removeHandles(bN))}),bN)}}};u([p({readOnly:!0})],rv.prototype,"updating",void 0),rv=u([A("esri.core.support.UpdatingHandles")],rv);const bN=-42;/*!
 * @esri/arcgis-html-sanitizer - v4.1.0 - Tue Dec 03 2024 09:13:28 GMT-0500 (Eastern Standard Time)
 * Copyright (c) 2024 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei() <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var VU=function(){return VU=Object.assign||function(e){for(var i,r=1,s=arguments.length;r<s;r++){i=arguments[r];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},VU.apply(this,arguments)},RZ={exports:{}},wn={},PZ={exports:{}},JS={};function ICe(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function TWe(t,e,i){}function EWe(t,e,i){}var CWe=/javascript\s*\:/img;function $We(t,e){return CWe.test(e)?"":e}JS.whiteList=ICe();JS.getDefaultWhiteList=ICe;JS.onAttr=TWe;JS.onIgnoreAttr=EWe;JS.safeAttrValue=$We;var AWe={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,s;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,s=t.length;r<s;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},zM=AWe;function MWe(t,e){t=zM.trimRight(t),t[t.length-1]!==";"&&(t+=";");var i=t.length,r=!1,s=0,n=0,o="";function a(){if(!r){var h=zM.trim(t.slice(s,n)),d=h.indexOf(":");if(d!==-1){var f=zM.trim(h.slice(0,d)),m=zM.trim(h.slice(d+1));if(f){var g=e(s,o.length,f,m,h);g&&(o+=g+"; ")}}}s=n+1}for(;n<i;n++){var l=t[n];if(l==="/"&&t[n+1]==="*"){var c=t.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,r=!1}else l==="("?r=!0:l===")"?r=!1:l===";"?r||a():l===`
`&&a()}return zM.trim(o)}var OWe=MWe,wN=JS,IWe=OWe;function _he(t){return t==null}function RWe(t){var e={};for(var i in t)e[i]=t[i];return e}function RCe(t){t=RWe(t||{}),t.whiteList=t.whiteList||wN.whiteList,t.onAttr=t.onAttr||wN.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||wN.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||wN.safeAttrValue,this.options=t}RCe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,s=i.onAttr,n=i.onIgnoreAttr,o=i.safeAttrValue,a=IWe(t,function(l,c,h,d,f){var m=r[h],g=!1;if(m===!0?g=m:typeof m=="function"?g=m(d):m instanceof RegExp&&(g=m.test(d)),g!==!0&&(g=!1),d=o(h,d),!!d){var v={position:c,sourcePosition:l,source:f,isWhite:g};if(g){var _=s(h,d,v);return _he(_)?h+":"+d:_}else{var _=n(h,d,v);if(!_he(_))return _}}});return a};var PWe=RCe;(function(t,e){var i=JS,r=PWe;function s(o,a){var l=new r(a);return l.process(o)}e=t.exports=s,e.FilterCSS=r;for(var n in i)e[n]=i[n]})(PZ,PZ.exports);var dre=PZ.exports,pre={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,s;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,s=t.length;r<s;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,i=e.exec(t);return i?i.index:-1}},DWe=dre.FilterCSS,LWe=dre.getDefaultWhiteList,jU=pre;function PCe(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var DCe=new DWe;function NWe(t,e,i){}function FWe(t,e,i){}function kWe(t,e,i){}function zWe(t,e,i){}function LCe(t){return t.replace(BWe,"&lt;").replace(VWe,"&gt;")}function UWe(t,e,i,r){if(i=BCe(i),e==="href"||e==="src"){if(i=jU.trim(i),i==="#")return"#";if(!(i.substr(0,7)==="http://"||i.substr(0,8)==="https://"||i.substr(0,7)==="mailto:"||i.substr(0,4)==="tel:"||i.substr(0,11)==="data:image/"||i.substr(0,6)==="ftp://"||i.substr(0,2)==="./"||i.substr(0,3)==="../"||i[0]==="#"||i[0]==="/"))return""}else if(e==="background"){if(xN.lastIndex=0,xN.test(i))return""}else if(e==="style"){if(bhe.lastIndex=0,bhe.test(i)||(whe.lastIndex=0,whe.test(i)&&(xN.lastIndex=0,xN.test(i))))return"";r!==!1&&(r=r||DCe,i=r.process(i))}return i=VCe(i),i}var BWe=/</g,VWe=/>/g,jWe=/"/g,GWe=/&quot;/g,HWe=/&#([a-zA-Z0-9]*);?/gim,qWe=/&colon;?/gim,WWe=/&newline;?/gim,xN=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,bhe=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,whe=/u\s*r\s*l\s*\(.*/gi;function NCe(t){return t.replace(jWe,"&quot;")}function FCe(t){return t.replace(GWe,'"')}function kCe(t){return t.replace(HWe,function(i,r){return r[0]==="x"||r[0]==="X"?String.fromCharCode(parseInt(r.substr(1),16)):String.fromCharCode(parseInt(r,10))})}function zCe(t){return t.replace(qWe,":").replace(WWe," ")}function UCe(t){for(var e="",i=0,r=t.length;i<r;i++)e+=t.charCodeAt(i)<32?" ":t.charAt(i);return jU.trim(e)}function BCe(t){return t=FCe(t),t=kCe(t),t=zCe(t),t=UCe(t),t}function VCe(t){return t=NCe(t),t=LCe(t),t}function ZWe(){return""}function YWe(t,e){typeof e!="function"&&(e=function(){});var i=!Array.isArray(t);function r(o){return i?!0:jU.indexOf(t,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(r(o))if(l.isClosing){var c="[/removed]",h=l.position+c.length;return s.push([n!==!1?n:l.position,h]),n=!1,c}else return n||(n=l.position),"[removed]";else return e(o,a,l)},remove:function(o){var a="",l=0;return jU.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function JWe(t){for(var e="",i=0;i<t.length;){var r=t.indexOf("<!--",i);if(r===-1){e+=t.slice(i);break}e+=t.slice(i,r);var s=t.indexOf("-->",r);if(s===-1)break;i=s+3}return e}function XWe(t){var e=t.split("");return e=e.filter(function(i){var r=i.charCodeAt(0);return r===127?!1:r<=31?r===10||r===13:!0}),e.join("")}wn.whiteList=PCe();wn.getDefaultWhiteList=PCe;wn.onTag=NWe;wn.onIgnoreTag=FWe;wn.onTagAttr=kWe;wn.onIgnoreTagAttr=zWe;wn.safeAttrValue=UWe;wn.escapeHtml=LCe;wn.escapeQuote=NCe;wn.unescapeQuote=FCe;wn.escapeHtmlEntities=kCe;wn.escapeDangerHtml5Entities=zCe;wn.clearNonPrintableCharacter=UCe;wn.friendlyAttrValue=BCe;wn.escapeAttrValue=VCe;wn.onIgnoreTagStripAll=ZWe;wn.StripTagBody=YWe;wn.stripCommentTag=JWe;wn.stripBlankChar=XWe;wn.cssFilter=DCe;wn.getDefaultCSSWhiteList=LWe;var oG={},A_=pre;function KWe(t){var e=A_.spaceIndex(t),i;return e===-1?i=t.slice(1,-1):i=t.slice(1,e+1),i=A_.trim(i).toLowerCase(),i.slice(0,1)==="/"&&(i=i.slice(1)),i.slice(-1)==="/"&&(i=i.slice(0,-1)),i}function QWe(t){return t.slice(0,2)==="</"}function eZe(t,e,i){var r="",s=0,n=!1,o=!1,a=0,l=t.length,c="",h="";e:for(a=0;a<l;a++){var d=t.charAt(a);if(n===!1){if(d==="<"){n=a;continue}}else if(o===!1){if(d==="<"){r+=i(t.slice(s,a)),n=a,s=a;continue}if(d===">"){r+=i(t.slice(s,n)),h=t.slice(n,a+1),c=KWe(h),r+=e(n,r.length,c,h,QWe(h)),s=a+1,n=!1;continue}if(d==='"'||d==="'")for(var f=1,m=t.charAt(a-f);m.trim()===""||m==="=";){if(m==="="){o=d;continue e}m=t.charAt(a-++f)}}else if(d===o){o=!1;continue}}return s<t.length&&(r+=i(t.substr(s))),r}var tZe=/[^a-zA-Z0-9\\_:.-]/gim;function iZe(t,e){var i=0,r=0,s=[],n=!1,o=t.length;function a(f,m){if(f=A_.trim(f),f=f.replace(tZe,"").toLowerCase(),!(f.length<1)){var g=e(f,m||"");g&&s.push(g)}}for(var l=0;l<o;l++){var c=t.charAt(l),h,d;if(n===!1&&c==="="){n=t.slice(i,l),i=l+1,r=t.charAt(i)==='"'||t.charAt(i)==="'"?i:sZe(t,l+1);continue}if(n!==!1&&l===r){if(d=t.indexOf(c,l+1),d===-1)break;h=A_.trim(t.slice(r+1,d)),a(n,h),n=!1,l=d,i=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),n===!1)if(d=rZe(t,l),d===-1){h=A_.trim(t.slice(i,l)),a(h),n=!1,i=l+1;continue}else{l=d-1;continue}else if(d=nZe(t,l-1),d===-1){h=A_.trim(t.slice(i,l)),h=xhe(h),a(n,h),n=!1,i=l+1;continue}else continue}return i<t.length&&(n===!1?a(t.slice(i)):a(n,xhe(A_.trim(t.slice(i))))),A_.trim(s.join(" "))}function rZe(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="="?e:-1}}function sZe(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="'"||i==='"'?e:-1}}function nZe(t,e){for(;e>0;e--){var i=t[e];if(i!==" ")return i==="="?e:-1}}function oZe(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function xhe(t){return oZe(t)?t.substr(1,t.length-2):t}oG.parseTag=eZe;oG.parseAttr=iZe;var aZe=dre.FilterCSS,Rp=wn,jCe=oG,lZe=jCe.parseTag,cZe=jCe.parseAttr,L4=pre;function SN(t){return t==null}function uZe(t){var e=L4.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=L4.trim(t.slice(e+1,-1));var i=t[t.length-1]==="/";return i&&(t=L4.trim(t.slice(0,-1))),{html:t,closing:i}}function hZe(t){var e={};for(var i in t)e[i]=t[i];return e}function dZe(t){var e={};for(var i in t)Array.isArray(t[i])?e[i.toLowerCase()]=t[i].map(function(r){return r.toLowerCase()}):e[i.toLowerCase()]=t[i];return e}function GCe(t){t=hZe(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=Rp.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=dZe(t.whiteList||t.allowList):t.whiteList=Rp.whiteList,t.onTag=t.onTag||Rp.onTag,t.onTagAttr=t.onTagAttr||Rp.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||Rp.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||Rp.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||Rp.safeAttrValue,t.escapeHtml=t.escapeHtml||Rp.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new aZe(t.css))}GCe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,s=i.onTag,n=i.onIgnoreTag,o=i.onTagAttr,a=i.onIgnoreTagAttr,l=i.safeAttrValue,c=i.escapeHtml,h=e.cssFilter;i.stripBlankChar&&(t=Rp.stripBlankChar(t)),i.allowCommentTag||(t=Rp.stripCommentTag(t));var d=!1;i.stripIgnoreTagBody&&(d=Rp.StripTagBody(i.stripIgnoreTagBody,n),n=d.onIgnoreTag);var f=lZe(t,function(m,g,v,_,b){var w={sourcePosition:m,position:g,isClosing:b,isWhite:Object.prototype.hasOwnProperty.call(r,v)},x=s(v,_,w);if(!SN(x))return x;if(w.isWhite){if(w.isClosing)return"</"+v+">";var S=uZe(_),C=r[v],T=cZe(S.html,function(M,I){var D=L4.indexOf(C,M)!==-1,P=o(v,M,I,D);return SN(P)?D?(I=l(v,M,I,h),I?M+'="'+I+'"':M):(P=a(v,M,I,D),SN(P)?void 0:P):P});return _="<"+v,T&&(_+=" "+T),S.closing&&(_+=" /"),_+=">",_}else return x=n(v,_,w),SN(x)?c(_):x},c);return d&&(f=d.remove(f)),f};var pZe=GCe;(function(t,e){var i=wn,r=oG,s=pZe;function n(a,l){var c=new s(l);return c.process(a)}e=t.exports=n,e.filterXSS=n,e.FilterXSS=s,function(){for(var a in i)e[a]=i[a];for(var l in r)e[l]=r[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=t.exports)})(RZ,RZ.exports);var CT=RZ.exports,fZe=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},mZe=function(){function t(e,i){var r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],article:["style"],aside:["style"],audio:["autoplay","controls","loop","muted","preload"],b:[],blockquote:["style"],br:[],code:["style"],dd:["style"],del:["style"],details:["open","style"],div:["align","aria-hidden","aria-label","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],footer:["style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],header:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],main:["style"],mark:["style"],nav:["style"],ol:[],p:["style"],pre:["style"],section:["style"],source:["media","src","type"],span:["aria-hidden","aria-label","style"],strong:[],sub:["style"],summary:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],time:["style"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.arcgisCSSWhiteList=VU(VU({},CT.getDefaultCSSWhiteList()),{"align-items":!0,"align-self":!0,flex:!0,"flex-basis":!0,"flex-direction":!0,"flex-flow":!0,"flex-grow":!0,"flex-shrink":!0,"flex-wrap":!0,float:!0,gap:!0,grid:!0,"grid-area":!0,"grid-auto-columns":!0,"grid-auto-flow":!0,"grid-auto-rows":!0,"grid-column":!0,"grid-column-end":!0,"grid-column-start":!0,"grid-row":!0,"grid-row-end":!0,"grid-row-start":!0,"grid-template":!0,"grid-template-areas":!0,"grid-template-columns":!0,"grid-template-rows":!0,"justify-content":!0,"justify-items":!0,"justify-self":!0,"line-height":!0,overflow:!0}),this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?r.sanitizeUrl(a):CT.safeAttrValue(n,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var s;e&&!i?s=e:e&&i?(s=Object.create(this.arcgisFilterOptions),s.css={whiteList:this.arcgisCSSWhiteList},Object.keys(e).forEach(function(n){if(n==="whiteList")s.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,e.whiteList||{}]);else if(n==="css"){var o=e.css.whiteList;o!=null&&e.css instanceof Object&&Object.keys(o).forEach(function(a){return s.css.whiteList[a]=o[a]})}else s[n]=e[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList,s.css={whiteList:this.arcgisCSSWhiteList}),this.xssFilterOptions=s,this._xssFilter=new CT.FilterXSS(s)}return t.prototype.sanitize=function(e,i){switch(i===void 0&&(i={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,i);default:return i.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,i){var r=(i??{}).isProtocolRequired,s=r===void 0?!0:r,n=this._trim(e.substring(0,e.indexOf(":"))),o=e==="/",a=/^#/.test(e),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?CT.escapeAttrValue(e):!n&&!s?CT.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,i,r,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,i,r,s):CT.safeAttrValue(e,i,r,s)},t.prototype.validate=function(e,i){i===void 0&&(i={});var r=this.sanitize(e,i);return{isValid:e===r,sanitized:r}},t.prototype.encodeHTML=function(e){var i=this;return String(e).replace(/[&<>"'\/]/g,function(r){return i._entityMap[r]})},t.prototype.encodeAttrValue=function(e){var i=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(r,s){return i.test(r)?r:"&#x".concat(Number(e.charCodeAt(s)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var i={};return e.forEach(function(r){Object.keys(r).forEach(function(s){Array.isArray(r[s])&&Array.isArray(i[s])?i[s]=i[s].concat(r[s]):i[s]=r[s]})}),i},t.prototype._iterateOverObject=function(e,i){var r=this;i===void 0&&(i={});try{var s=!1,n=void 0;if(Array.isArray(e))n=e.reduce(function(a,l){var c=r.validate(l,i);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(fZe(e)){var o=Object.keys(e);n=o.reduce(function(a,l){var c=e[l],h=r.validate(c,i);return h.isValid?a[l]=c:(s=!0,a[l]=h.sanitized),a},{})}else return i.allowUndefined&&typeof e>"u"?void 0:null;return s?n:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const aG=new Map;function HCe(){aG.clear()}function gZe(t){return aG.get(t)}function yZe(t,e){aG.set(t,e)}function i8(t){aG.delete(t)}function qCe(...t){const e=sc.acquire();for(let r=0;r<t.length;r++){const s=t[r],n=typeof s;if(n==="string")e.push(s);else if(Array.isArray(s))e.push.apply(e,s);else if(n==="object")for(const o in s)s[o]&&e.push(o)}const i=e.join(" ");return sc.release(e),i}const T9t=(()=>{const t=new Map,e=new ResizeObserver(r=>{var s;HCe();for(const n of r)(s=t.get(n.target))==null||s(n)}),i=(r,s,n)=>(t.set(r,s),e.observe(r,n),Pi(()=>{e.unobserve(r),t.delete(r)}));return(r,s,n)=>{let o=null;return LD([H(()=>typeof r=="function"?r():r,a=>{o==null||o.remove(),a&&(o=i(a,s,n))},Mt),Pi(()=>o==null?void 0:o.remove())])}})();function vZe(t){const e=t==null?void 0:t.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function E9t(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function C9t(t){const e="data-node-ref";this[t.getAttribute(e)]=t}const _Ze=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],bZe=_Ze.reduce((t,e)=>(t[e]=[],t),{}),wZe=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],WCe=new mZe({whiteList:bZe,onTagAttr:(t,e,i)=>{const r=`${e}="${i}"`;if(wZe.includes(e))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function xZe(t){return t==="Enter"||t===" "}async function SZe(t,e){await MGe(kD(e));const i=typeof t=="function"?t():t;i&&("setFocus"in i&&typeof i.setFocus=="function"?await i.setFocus():i instanceof HTMLElement&&i.focus())}const ZCe="http://www.w3.org/",lG=`${ZCe}2000/svg`,YCe=`${ZCe}1999/xlink`;let She=[],fre=(t,e)=>{let i={};return Object.keys(t).forEach(r=>{i[r]=t[r]}),e&&Object.keys(e).forEach(r=>{i[r]=e[r]}),i},mre=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),JCe=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},TZe=(t,e,i)=>{if(e.vnodeSelector!==""){for(let r=i;r<t.length;r++)if(mre(t[r],e))return r}return-1},r8=(t,e,i,r)=>{let s=t[e];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let o=0;o<t.length;o++)if(o!==e){let a=t[o];if(mre(a,s))throw new Error(`${i.vnodeSelector} had a ${s.vnodeSelector} child ${r==="added"?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},EZe=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},DZ=[],LZ=!1,XCe=t=>{(t.children||[]).forEach(XCe),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},The=()=>{LZ=!1,DZ.forEach(XCe),DZ.length=0},Ehe=t=>{DZ.push(t),LZ||(LZ=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(The,{timeout:16}):setTimeout(The,16))},Che=t=>{let e=t.domNode;if(t.properties){let i=t.properties.exitAnimation;if(i)return e.style.pointerEvents="none",void i(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),Ehe(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),Ehe(t))},CZe=(t,e,i)=>{if(!e)return;let r=i.eventHandlerInterceptor,s=Object.keys(e),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=e[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")FZ(t,l,!0);else if(a==="classes"){let c=Object.keys(l),h=c.length;for(let d=0;d<h;d++){let f=c[d];l[f]&&t.classList.add(f)}}else if(a==="styles"){let c=Object.keys(l),h=c.length;for(let d=0;d<h;d++){let f=c[d],m=l[f];m&&(JCe(m),i.styleApplyer(t,f,m))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(r&&(l=r(a,l,t,e)),a==="oninput"&&function(){let h=l;l=function(d){h.apply(this,[d]),d.target["oninput-value"]=d.target.value}}()),t[a]=l):i.namespace===lG?a==="href"?t.setAttributeNS(YCe,a,l):t.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?t[a]=WCe.sanitize(l):NZ(t)&&a in t?t[a]=l:t.setAttribute(a,l):t[a]=l}}};function NZ(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let GU,$Ze=(t,e,i)=>{if(e)for(let r of e)eP(r,t,void 0,i)},KCe=(t,e,i)=>{$Ze(t,e.children,i),e.text&&(t.textContent=e.text),CZe(t,e.properties,i),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,i,e.vnodeSelector,e.properties,e.children])},eP=(t,e,i,r)=>{let s,n=0,o=t.vnodeSelector,a=e.ownerDocument;if(o==="")s=t.domNode=a.createTextNode(t.text),i!==void 0?e.insertBefore(s,i):e.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let h=o.charAt(n-1),d=o.slice(n,l);h==="."?s.classList.add(d):h==="#"?s.id=d:(d==="svg"&&(r=fre(r,{namespace:lG})),r.namespace!==void 0?s=t.domNode=a.createElementNS(r.namespace,d):(s=t.domNode=t.domNode||a.createElement(d),d==="input"&&t.properties&&t.properties.type!==void 0&&s.setAttribute("type",t.properties.type)),i!==void 0?e.insertBefore(s,i):s.parentNode!==e&&e.appendChild(s)),n=l+1}}KCe(s,t,r)}},FZ=(t,e,i)=>{e&&e.split(" ").forEach(r=>{r&&t.classList.toggle(r,i)})},AZe=(t,e,i,r)=>{if(!i)return;let s=!1,n=Object.keys(i),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=i[l],h=e[l];if(l==="class")h!==c&&(FZ(t,h,!1),FZ(t,c,!0));else if(l==="classes"){let d=t.classList,f=Object.keys(c),m=f.length;for(let g=0;g<m;g++){let v=f[g],_=!!c[v];_!==!!h[v]&&(s=!0,_?d.add(v):d.remove(v))}}else if(l==="styles"){let d=Object.keys(c),f=d.length;for(let m=0;m<f;m++){let g=d[m],v=c[g];v!==h[g]&&(s=!0,v?(JCe(v),r.styleApplyer(t,g,v)):r.styleApplyer(t,g,""))}}else if(c||typeof h!="string"||(c=""),l!=="value"||NZ(t)){if(c!==h){let d=typeof c;d==="function"&&r.eventHandlerInterceptor||(r.namespace===lG?l==="href"?t.setAttributeNS(YCe,l,c):t.setAttribute(l,c):d==="string"?l==="innerHTML"?t[l]=WCe.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):NZ(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),s=!0)}}else{let d=t[l];d!==c&&(t["oninput-value"]?d===t["oninput-value"]:c!==h)&&(t[l]=c,t["oninput-value"]=void 0),c!==h&&(s=!0)}}return s},MZe=(t,e,i,r,s)=>{if(i===r)return!1;r=r||She;let n,o=(i=i||She).length,a=r.length,l=0,c=0,h=!1;for(;c<a;){let d=l<o?i[l]:void 0,f=r[c];if(d!==void 0&&mre(d,f))h=GU(d,f,s)||h,l++;else{let m=TZe(i,f,l+1);if(m>=0){for(n=l;n<m;n++)Che(i[n]),r8(i,n,t,"removed");h=GU(i[m],f,s)||h,l=m+1}else eP(f,e,l<o?i[l].domNode:void 0,s),EZe(f),r8(r,c,t,"added")}c++}if(o>l)for(n=l;n<o;n++)Che(i[n]),r8(i,n,t,"removed");return h};GU=(t,e,i)=>{let r=t.domNode,s=!1;if(t===e)return!1;let n=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let o=r.ownerDocument.createTextNode(e.text);return r.parentNode.replaceChild(o,r),e.domNode=o,s=!0,s}e.domNode=r}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(i=fre(i,{namespace:lG})),t.text!==e.text&&(n=!0,e.text===void 0?r.removeChild(r.firstChild):r.textContent=e.text),e.domNode=r,n=MZe(e,r,t.children,e.children,i)||n,n=AZe(r,t.properties,e.properties,i)||n,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[r,i,e.vnodeSelector,e.properties,e.children]);return n&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(r,e.properties,t.properties),s};let TN=(t,e)=>({getLastRender:()=>t,update:i=>{if(t.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=t;t=i,GU(r,i,e)},domNode:t.domNode});const OZe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.charAt(0)==="-"?t.style.setProperty(e,i):t.style[e]=i}};let XO=t=>fre(OZe,t),rb={append:(t,e,i)=>(i=XO(i),eP(e,t,void 0,i),TN(e,i)),insertBefore:(t,e,i)=>(i=XO(i),eP(e,t.parentNode,t,i),TN(e,i)),merge:(t,e,i)=>(i=XO(i),e.domNode=t,KCe(t,e,i),TN(e,i)),replace:(t,e,i)=>(i=XO(i),eP(e,t.parentNode,t,i),t.parentNode.removeChild(t),TN(e,i))},QCe,IZe=(t,e)=>{let i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i};QCe=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let RZe=(t,e)=>{let i=t;return e.forEach(r=>{i=i&&i.children?QCe(i.children,s=>s.domNode===r):void 0}),i},PZe=(t,e,i)=>{let r=function(s){i("domEvent",s);let n=e(),o=IZe(s.currentTarget,n.domNode);o.reverse();let a,l=RZe(n.getLastRender(),o);return t.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),i("domEventProcessed",s),a};return(s,n,o,a)=>r},$he=t=>{let e,i,r=XO(t),s=r.performanceLogger,n=!0,o=!1,a=[],l=[],c=(d,f,m)=>{let g,v=()=>g;r.eventHandlerInterceptor=PZe(e,v,s),g=d(f,m(),r),a.push(g),l.push(m)},h=()=>{if(i=void 0,n){n=!1,s("renderStart",void 0);for(let d=0;d<a.length;d++){let f=l[d]();s("rendered",void 0),a[d].update(f),s("patched",void 0)}s("renderDone",void 0),n=!0}};return e={renderNow:h,scheduleRender:()=>{i||o||(i=requestAnimationFrame(h))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),o=!0},resume:()=>{o=!1,n=!0,e.scheduleRender()},append:(d,f)=>{c(rb.append,d,f)},insertBefore:(d,f)=>{c(rb.insertBefore,d,f)},merge:(d,f)=>{c(rb.merge,d,f)},replace:(d,f)=>{c(rb.replace,d,f)},detach:d=>{for(let f=0;f<l.length;f++)if(l[f]===d)return l.splice(f,1),a.splice(f,1)[0];throw new Error("renderFunction was not found")}},e},B0=class extends he{constructor(){super(...arguments),this.items=new Ce,this._watchUpdatingTracking=new rv,this._callbacks=new Map,this._projector=$he(),this._hiddenProjector=$he()}get needsRender(){return this.items.length>0}get updating(){var e;return((e=this._watchUpdatingTracking)==null?void 0:e.updating)??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,i=>{for(const r of i.added){const s=()=>r.render();this._callbacks.set(r,s),this._projector.append(this.surface,s)}for(const r of i.removed){const s=this._projector.detach(this._callbacks.get(r));this.surface.removeChild(s.domNode),this._callbacks.delete(r)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const i=this._hiddenSurface,r=this._hiddenProjector;let s;const n=()=>(s=e.render(),s);r.append(i,n),r.renderNow();const o={left:0,top:0,right:0,bottom:0};if(s!=null&&s.domNode){const a=s.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(r.detach(n);i.firstChild;)i.removeChild(i.firstChild);return o}overlaps(e,i){const r=this.computeBoundingRect(e),s=this.computeBoundingRect(i);return Math.max(r.left,s.left)<=Math.min(r.right,s.right)&&Math.max(r.top,s.top)<=Math.min(r.bottom,s.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e,i){const r=!!(i!=null&&i.disableDecorations);if(!this.items.some(n=>n.visible&&!(r&&n.isDecoration)))return;const s=e.getContext("2d");s.save(),s.font=this._fontString(),this.items.forEach(n=>{r&&n.isDecoration||(s.save(),n.renderCanvas(s),s.restore())}),s.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};u([p({readOnly:!0})],B0.prototype,"surface",void 0),u([p({readOnly:!0})],B0.prototype,"items",void 0),u([p({readOnly:!0})],B0.prototype,"needsRender",null),u([p({readOnly:!0})],B0.prototype,"_watchUpdatingTracking",void 0),u([p({readOnly:!0})],B0.prototype,"updating",null),B0=u([A("esri.views.overlay.ViewOverlay")],B0);const Ahe=B0,s8=[0,0];function DZe(t){const e=(t.ownerDocument||window.document).defaultView,i=t.getBoundingClientRect();return s8[0]=i.left+((e==null?void 0:e.pageXOffset)??0),s8[1]=i.top+((e==null?void 0:e.pageYOffset)??0),s8}function Mhe(t){t&&(t.textContent="",t.parentNode&&t.parentNode.removeChild(t))}function LZe(t){const e=document.createElement("div");return t.appendChild(e),e}const $T=16,UM=750,NZe=512,FZe=2,e$e=t=>{let e=class extends t{constructor(...i){super(...i),this._freqInfo={freq:$T,time:UM},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([H(()=>this.cursor,r=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",r)}),H(()=>this.navigating,r=>{const{surface:s}=this;s&&s.setAttribute("data-navigating",r.toString())})])}initialize(){this.addHandles([H(()=>this.ui,(i,r)=>this._handleUIChange(i,r),Ut),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){var i;this.destroyed||((i=this.ui)==null||i.destroy(),this.container=null)}get container(){return this._get("container")??null}set container(i){const r=this._get("container"),s=nG(i);if(s||typeof i!="string"||J.getLogger(this).error("#container",`element with id '${i}' not found`),r===s)return;if(this._stopMeasuring(),r&&(r.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(Mhe(this.root),this._set("root",null)),this.userContent&&(vhe(this.userContent,r),Mhe(this.userContent),this._set("userContent",null))),!s)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);s.classList.add("esri-view");const n=document.createElement("div");n.className="esri-view-user-storage",vhe(s,n),s.appendChild(n),this._set("userContent",n);const o=document.createElement("div");o.className="esri-view-root",s.insertBefore(o,s.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new Ahe;o.appendChild(l.surface),this._set("overlay",l),this.addHandles(H(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=tg({render:()=>{var h;return(h=this.overlay)==null?void 0:h.render()}}):this._overlayRenderTaskHandle=Ji(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",s),this._startMeasuring()}get focused(){const i=document.activeElement===this.surface;return document.hasFocus()&&i}get size(){return[this.width,this.height]}blur(){var i;(i=this.surface)==null||i.blur()}focus(){var i;(i=this.surface)==null||i.focus()}pageToContainer(i,r,s){const n=this.position;return i-=n?n[0]:0,r-=n?n[1]:0,s?(s[0]=i,s[1]=r):s=[i,r],s}containerToPage(i,r,s){const n=this.position;return i+=n?n[0]:0,r+=n?n[1]:0,s?(s[0]=i,s[1]=r):s=[i,r],s}_handleUIChange(i,r){this.removeHandles("ui"),r&&r!==i&&r.destroy(),i&&(i.view=this,this.addHandles(H(()=>this.root,s=>{i.container=s?LZe(s):null},Ut),"ui")),this._set("ui",i)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const i=this._freqInfo;i.freq=$T,i.time=UM;const r=tg({prepare:o=>{const a=this._measure(),l=this._freqInfo;if(l.time+=o.deltaTime,a&&(l.freq=$T,this._get("resizing")||this._set("resizing",!0)),l.time<l.freq)return;l.time=0;const c=this._position();l.freq=c||a?$T:Math.min(UM,l.freq*FZe),!a&&l.freq>=NZe&&(r.pause(),this._get("resizing")&&this._set("resizing",!1))}}),s=new ResizeObserver(o=>{i.freq=$T,i.time=UM,r.resume()});this.container!=null&&s.observe(this.container);const n=Pi(()=>s.disconnect());this.addHandles([ZA(window,"resize",()=>{i.freq=$T,i.time=UM,r.resume()}),n,r],"measuring"),this._measure(),this._position()}_measure(){const i=this.container,r=i?i.clientWidth:0,s=i?i.clientHeight:0;if(r===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return r===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",r),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:r,height:s}),!0)}_position(){const i=this.container,r=this.position,s=i&&DZe(i);return!!s&&(!r||s[0]!==r[0]||s[1]!==r[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return u([p()],e.prototype,"container",null),u([p({readOnly:!0})],e.prototype,"focused",null),u([p({readOnly:!0})],e.prototype,"height",void 0),u([p()],e.prototype,"messagesCommon",void 0),u([p({type:Ahe})],e.prototype,"overlay",void 0),u([p({readOnly:!0})],e.prototype,"position",void 0),u([p({readOnly:!0})],e.prototype,"resizing",void 0),u([p({readOnly:!0})],e.prototype,"root",void 0),u([p({value:null,readOnly:!0})],e.prototype,"size",null),u([p({readOnly:!0})],e.prototype,"surface",void 0),u([p({readOnly:!0})],e.prototype,"suspended",void 0),u([p({nonNullable:!0})],e.prototype,"ui",void 0),u([p({readOnly:!0})],e.prototype,"userContent",void 0),u([p({readOnly:!0})],e.prototype,"width",void 0),u([p()],e.prototype,"widthBreakpoint",void 0),e=u([A("esri.views.DOMContainer")],e),e},kZe=X("mac")?"Meta":"Control",zZe=new Set(["Alt","Control","Meta","Shift","Ctrl","Primary"]),UZe=t=>zZe.has(t);let BZe=class{constructor(e,i=[]){this.eventType=e,this.keyModifiers=i}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const i=e.modifiers;for(const r of this.keyModifiers)if(!i.has(r))return!1;return!0}},ls=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const i=this._incoming[e];for(const r of i)this._incomingEventMatches.push(r.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager||(e.setEventCallback(i=>this._handleEvent(i)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,i,r){let s;typeof i=="function"?(r=i,s=[]):s=i||[];const n=typeof e=="string"?new BZe(e,s):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=h=>{const d=this._incoming[h.match.eventType];if(d){const f=d.indexOf(h);d.splice(f,1),o(),this._manager&&this._manager.updateDependencies()}},l=new VZe(n,r,{onPause:a,onRemove:a,onResume:h=>{const d=this._incoming[h.match.eventType];d&&!d.includes(h)&&(d.push(h),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const i=new jZe(e,{onEmit:(r,s,n,o)=>{var a;(a=this._manager)==null||a.emit(r.eventType,s,n,o)},onRemove:r=>{var s;delete this._outgoing[r.eventType],(s=this._manager)==null||s.updateDependencies()}});return this._outgoing[e]=i,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),i}startCapturingPointer(e){var i;(i=this._manager)==null||i.setPointerCapture(e,!0)}stopCapturingPointer(e){var i;(i=this._manager)==null||i.setPointerCapture(e,!1)}refreshHasPendingInputs(){var e;(e=this._manager)==null||e.refreshHasPendingInputs()}_onUninstall(){this._manager&&(this.onUninstall(),this._manager=null)}_handleEvent(e){var r;const i=this._incoming[e.type];if(i){for(const s of i)if(s.match.matches(e)&&((r=s.callback)==null||r.call(s,e),e.shouldStopPropagation()))break}}},VZe=class{constructor(e,i,r){this.match=e,this._callback=i,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},jZe=class{constructor(e,i){this.eventType=e,this._removed=!1,this._handler=i}emit(e,i,r){this._removed||this._handler.onEmit(this,e,i,r)}remove(){this._removed=!0,this._handler.onRemove(this)}},GZe=class extends ls{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",i=>this._update(i.data))}_update(e){const i=e.native.pointerType==="touch"?"touch":"mouse",{x:r,y:s}=e;i===this._value&&this._x===r&&this._y===s||(this._value=i,this._x=r,this._y=s,this._onChange(i,r,s))}},HZe=class{constructor(e,i){this._observable=new qD,this._value=e,this._equalityFunction=i}get value(){return Pt(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}};function Ta(t,e=aSe){return new HZe(t,e)}let qZe=class extends ls{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=Ta(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},_v=class{constructor(e,i){this._owner=i,this._properties={},this._afterDispatchHandle=null;for(const r in e){const s=e[r],n=new BSe(s,void 0,void 0,2,2);this._properties[r]={pool:n,acquired:[]}}this._afterDispatchHandle=eTe(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const i=this._properties[e];for(const r of i.acquired)Zce(r)||i.pool.release(r);i.pool.destroy(),i.pool=null,i.acquired=null}this._properties=null,this._owner=null}get(e){const i=this._owner._get(e),r=this._properties[e];let s=r.pool.acquire();for(r.acquired.push(s);s===i;)r.acquired.push(s),s=r.pool.acquire();return s}_release(){for(const e in this._properties){const i=this._properties[e];let r=0;for(const s of i.acquired)Zce(s)?i.acquired[r++]=s:i.pool.release(s);i.acquired.length=r}}},zu=class extends he{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=kZe,this._latestPointerType="mouse",this._propertiesPool=new _v({latestPointerLocation:YZe},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const i of e)this.uninstallHandlers(i);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,i,r=Vm.INTERNAL){if(this._nameToGroup[e]||i.length===0)return;const s={name:e,handlers:i.map(n=>({handler:n,active:!0,removed:!1,priorityIndex:0,groupPriority:r,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=s;for(let n=s.handlers.length-1;n>=0;n--){const o=s.handlers[n];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,c,h,d)=>{this._emitInputEvent(o.priorityIndex+1,a,l,c,d,h)},setPointerCapture:(a,l)=>{this._setPointerCapture(s,o,a,l)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const i=this._nameToGroup[e];i?(i.handlers.forEach(r=>{var s;r.removed=!0,(s=r.uninstallCallback)==null||s.call(r)}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):J.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}isModifierKeyDown(e){return this._activeKeyModifiers.has(e)}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,i=new Set;this._handlersPriority=[];for(let r=this._handlers.length-1;r>=0;r--){const s=this._handlers[r];s.priorityIndex=r,this._handlersPriority.push(s)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let r=this._handlersPriority.length-1;r>=0;r--){const s=this._handlersPriority[r];s.priorityIndex=r;let n=s.handler.hasSideEffects;if(!n){for(const o of s.handler.outgoingEventTypes)if(e.has(o)){n=!0;break}}if(n)for(const o of s.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)UZe(a)||i.add(a)}s.active=n}this._sourceEvents=e,this._keyModifiers=i,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,i,r){this._latestPointerType=e;const s=this._get("latestPointerLocation");if(s==null||s.x!==i||s.y!==r){const n=this._propertiesPool.get("latestPointerLocation");n.x=i,n.y=r,this._set("latestPointerLocation",n)}}_onEventReceived(e,i){if(e==="pointer-capture-lost"){const n=i;this._pointerCaptures.delete(n.native.pointerId)}this._updateKeyModifiers(e,i);const r=this.test.timestamp!=null?this.test.timestamp:i.native?i.native.timestamp:void 0,s=i.native?i.native.cancelable:void 0;this._emitInputEventFromSource(e,i,r,s)}_updateKeyModifiers(e,i){if(!i)return;let r=!1;const s=()=>{r||(this._activeKeyModifiers=new Set(this._activeKeyModifiers),r=!0)},n=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(s(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(s(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=i.key;this._keyModifiers.has(a)&&n(a,e==="key-down")}const o=i.native;n("Alt",!!(o!=null&&o.altKey)),n("Control",!!(o!=null&&o.ctrlKey)),n("Ctrl",!!(o!=null&&o.ctrlKey)),n("Shift",!!(o!=null&&o.shiftKey)),n("Meta",!!(o!=null&&o.metaKey)),n("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new GZe((e,i,r)=>this._setLatestPointer(e,i,r)),this._multiTouchHandler=new qZe,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],Vm.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,Vm.INTERNAL)}_setPointerCapture(e,i,r,s){const n=e.name+"-"+i.priorityIndex,o=this._pointerCaptures.get(r.pointerId)||new Set;this._pointerCaptures.set(r.pointerId,o),s?(o.add(n),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(r,!0)):o.has(n)&&(o.delete(n),o.size===0&&(this._pointerCaptures.delete(r.pointerId),this.eventSource&&this.eventSource.setPointerCapture(r,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,i,r,s){this._emitInputEvent(0,e,i,r,s)}_emitInputEvent(e,i,r,s,n,o){const a=s!==void 0?s:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=n!==void 0&&n,c={event:new WZe(i,r,a,o||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new LU,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){var i,r,s;this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:n,priorityIndex:o}=e.events.pop(),a=(i=n.data)==null?void 0:i.eventId;if(!(a!=null&&this._stoppedPropagationEventIds.has(a)))for(e.currentHandler=this._handlersPriority[o];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!n.shouldStopPropagation()&&((s=(r=e.currentHandler).eventCallback)==null||s.call(r,n)),n.shouldStopPropagation()){a!=null&&this._stoppedPropagationEventIds.add(a);break}if(n.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:n,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const i=new LU;i.push(e);const r=this._currentPropagation;if(r){for(;r.events.length;)i.push(r.events.pop());r.events=i,r.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,i){if(e.handler.hasSideEffects!==i.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==i.groupPriority)return e.groupPriority>i.groupPriority?-1:1;for(const r of e.handler.incomingEventMatches)for(const s of i.handler.incomingEventMatches){if(r.eventType!==s.eventType)continue;const n=r.keyModifiers.filter(o=>s.keyModifiers.includes(o));if(n.length===r.keyModifiers.length!=(n.length===s.keyModifiers.length))return r.keyModifiers.length>s.keyModifiers.length?-1:1}return e.priorityIndex>i.priorityIndex?-1:1}_sortHandlersPriority(e){const i=[];for(const r of e){let s=0;for(;s<i.length&&this._compareHandlerPriority(r,i[s])>=0;)s++;i.splice(s,0,r)}return i}get debug(){const e=i=>{const r=this._setPointerCapture;this._setPointerCapture=()=>{},i(),this._setPointerCapture=r};return{injectEvent:(i,r)=>{e(()=>this._onEventReceived(i,r))},disablePointerCapture:e}}};u([p({readOnly:!0})],zu.prototype,"hasPendingInputs",null),u([p({constructOnly:!0})],zu.prototype,"eventSource",void 0),u([p({constructOnly:!0})],zu.prototype,"recognizers",void 0),u([p()],zu.prototype,"_latestPointerType",void 0),u([p()],zu.prototype,"latestPointerType",null),u([p()],zu.prototype,"multiTouchActive",null),u([p({readOnly:!0})],zu.prototype,"latestPointerLocation",void 0),u([p()],zu.prototype,"_paused",void 0),u([p({readOnly:!0})],zu.prototype,"updating",null),zu=u([A("esri.views.input.InputManager")],zu);let WZe=class{constructor(e,i,r,s,n){this.type=e,this.data=i,this.timestamp=r,this.modifiers=s,this.cancelable=n,this._propagationState=M_.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=M_.STOPPED}shouldStopPropagation(){return!!(this._propagationState&M_.STOPPED)}async(e){this._propagationState|=M_.PAUSED;const i=(r,s)=>{this._propagationState&=~M_.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw r;return r};return(typeof e=="function"?e():e).then(r=>i(r,!1),r=>i(r,!0))}shouldPausePropagation(e){return!!(this._propagationState&M_.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var M_;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(M_||(M_={}));const Vm={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let ZZe=class{};const YZe=ZZe;function d0(t){return t!=null&&"open"in t&&"declaredClass"in t}function Ohe(t){return t!=null&&"declaredClass"in t&&"dockOptions"in t}const t$e=t=>{let e=class extends t{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([H(()=>[this.ui,this.popup],([i,r],s)=>{const n="popup",o="manual";if(s){const[a,l]=s;a&&d0(l)&&(l.view=null,Ohe(l)&&a.remove(l,n))}i&&d0(r)&&(r.view=this,Ohe(r)&&i.add(r,{key:n,position:o,internal:!0}))},Ut),this.on("click",i=>{this.popup&&this.popupEnabled&&(i.pointerType!=="mouse"||i.button===0)&&(d0(this.popup)?this.popup.viewModel.handleViewClick(i):i.async(async()=>{await this.setupPopup(),d0(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(i)}))},Vm.WIDGET)]),Id(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{G(()=>import("./Popup-BopDNomN.js").then(i=>i.P),__vite__mapDeps([101,1,102,103,6,104,105,106,107,108,109,41,39,40,110,20,111,112]))})}destroy(){this.destroyed||this.closePopup()}async openPopup(i){if(d0(this.popup))return this.popup.open(i);try{if(await this.setupPopup(),!this.popup)return void J.getLogger(this).error(new U("view:null-popup","Popup is null and can't be opened"));this.popup.open(i)}catch{}}closePopup(){var i;(i=this._popupSetupTask)==null||i.abort(),d0(this.popup)&&this.popup.close()}async fetchPopupFeatures(i,r){return await this.when(),this._popupHitsToFeatures(await this._getPopupHits(i,r),r)}async setupPopup(){var i;if((i=this._popupSetupTask)==null||i.abort(),this.popup&&!d0(this.popup))return this._popupSetupTask=gg(async r=>{const{default:s}=await G(()=>import("./Popup-BopDNomN.js").then(o=>o.P),__vite__mapDeps([101,1,102,103,6,104,105,106,107,108,109,41,39,40,110,20,111,112]));if(gt(r),!this.popup||d0(this.popup))return;const n=this.popup;delete n.open,delete n.close,this.popup=new s(n)}),this._popupSetupTask.promise}async _popupHitsToFeatures({location:i,hits:r},s){const n=[],o=[];let a=!1;const l=_Ge(s,X("popup-view-fetch-timeout")??XZe),c=f=>{const m=new JZe(f);return o.push(m),n.push(m.promise),m},h=f=>{const m=o.at(-1);return m&&m.layerView===f&&!a?m:c(f)};for(const f of r)"graphic"in f?(h(f.layerView).graphics.push(f.graphic),a=!1):(n.push(f.layerView.fetchPopupFeaturesAtLocation(f.mapPoint,l)),a=!0);o.map(f=>f.resolve(l));const d=yGe(n).then(f=>f.filter(m=>!!m).flat());return{pendingFeatures:n,allGraphicsPromise:d,location:i}}async _getPopupHits(i,r){const{hits:s,location:n}=await this.popupHitTest(i);gt(r);const o=[];for(const a of s)if("graphic"in a){if(this._isValidPopupGraphic(a.graphic,r)){const l=this._isValidPopupGraphicsLayerView(a.layerView)?a.layerView:void 0;o.push({graphic:a.graphic,layerView:l})}}else this._isValidPopupLocationLayerView(a.layerView)&&o.push({mapPoint:a.mapPoint,layerView:a.layerView});return{hits:o,location:n}}_isValidPopupGraphic(i,r){return i&&!!i.getEffectivePopupTemplate(r==null?void 0:r.defaultPopupTemplateEnabled)}_isValidPopupGraphicsLayerView(i){return!i||(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesFromGraphics"in i}_isValidPopupLocationLayerView(i){return(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesAtLocation"in i}};return u([p()],e.prototype,"popup",void 0),u([p()],e.prototype,"popupEnabled",void 0),e=u([A("esri.views.PopupView")],e),e};let JZe=class{constructor(e){this.layerView=e,this._resolver=ta(),this.graphics=[]}get promise(){return this._resolver.promise}resolve(e){const{layerView:i,graphics:r,_resolver:s}=this;if(!i)return s.resolve(r),s.promise;let n;return i.fetchPopupFeaturesFromGraphics(r,e).catch(o=>(n=o,null)).then(o=>{o?s.resolve(o):s.reject(n)}),s.promise}};const XZe=5e3;function vf(t,e,i=Ce){return e||(e=new i),e===t||(e.removeAll(),KZe(t)?e.addMany(t):t&&e.add(t)),e}function gre(t){return t}function KZe(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}var O_;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(O_||(O_={}));let QZe=class{constructor(){this._resolver=ta(),this._status=O_.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=O_.RESOLVED,this._cleanUp()},()=>{this._status=O_.REJECTED,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===O_.RESOLVED}isRejected(){return this._status===O_.REJECTED}isFulfilled(){return this._status!==O_.PENDING}abort(){this._resolver.reject(bi())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=ta(),i=[...this._resolvingPromises,e.promise],r=this._allPromise=Promise.all(i);r.then(()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve()},s=>{this.isFulfilled()||this._allPromise!==r||es(s)||this._resolver.reject(s)}),e.resolve()}};const i$e=t=>{let e=class extends t{constructor(...i){super(...i),this._promiseProps=new QZe,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(i,r){return this._promiseProps.promise.then(()=>this).then(i,r)}catch(i){return this.when(null,i)}addResolvingPromise(i){i&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in i?i.when():i)}};return e=u([A("esri.core.Promise")],e),e};let KO=class extends i$e(he){};KO=u([A("esri.core.Promise")],KO),function(t){t.EsriPromiseMixin=i$e}(KO||(KO={}));const iw=KO,eYe="not-loaded",tYe="loading",iYe="failed",Ihe="loaded",r$e=t=>{let e=class extends t{constructor(...i){super(...i),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(r=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=zD(n,l);this.destroyed&&l(new U("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===eYe){this._set("loadStatus",tYe);const a=this._loadController=new AbortController;s({signal:a.signal})}return r(),o}})),this.when(()=>{this._set("loadStatus",Ihe),this._loadController=null},r=>{this._set("loadStatus",iYe),this._set("loadError",r),this._loadController=null})}destroy(){this._loadController&&(this._loadController=fc(this._loadController),this._promiseProps.abort()),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===Ihe}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var i;return this.isFulfilled()||(this._set("loadError",new U("load:cancelled","Cancelled")),(i=this._loadController)==null||i.abort(),this._promiseProps.abort()),this}};return u([p({readOnly:!0})],e.prototype,"loaded",null),u([p({readOnly:!0})],e.prototype,"loadError",void 0),u([p({clonable:!1})],e.prototype,"loadStatus",void 0),u([p({type:[ch],readOnly:!0})],e.prototype,"loadWarnings",null),e=u([A("esri.core.Loadable")],e),e};let QO=class extends r$e(iw){};QO=u([A("esri.core.Loadable")],QO),function(t){function e(i){return!(!i||!i.load)}t.LoadableMixin=r$e,t.isLoadable=e}(QO||(QO={}));const Il=QO;async function KD(t,e){return await t.load(),rYe(t,e)}async function rYe(t,e){const i=[],r=(...n)=>{for(const o of n)o!=null&&(Array.isArray(o)?r(...o):Ce.isCollection(o)?o.forEach(a=>r(a)):Il.isLoadable(o)&&i.push(o))};e(r);let s=null;if(await Q8e(i,async n=>{const o=await ff(sYe(n)?n.loadAll():n.load());o.ok!==!1||s||(s=o)}),s)throw s.error;return t}function sYe(t){return"loadAll"in t&&typeof t.loadAll=="function"}let EN;function nYe(t){return EN&&!EN.destroyed||(EN=t()),EN}var kZ;const oYe=new ni({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let Ah=kZ=class extends he{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new kZ({categories:this.categories?q(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let i=[];this.categories&&(i=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let r="";if(this.extent){const o=VD(this.extent,Oe.WGS84);o!=null&&(r=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&t.extraQuery&&(s="("+s+")"+t.extraQuery);const n={categories:i,bbox:r,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>oYe.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:{...e,...n}}}};u([p()],Ah.prototype,"categories",void 0),u([p()],Ah.prototype,"disableExtraQuery",void 0),u([p({type:_i})],Ah.prototype,"extent",void 0),u([p()],Ah.prototype,"filter",void 0),u([p()],Ah.prototype,"num",void 0),u([p()],Ah.prototype,"query",void 0),u([p()],Ah.prototype,"sortField",void 0),u([p()],Ah.prototype,"sortOrder",null),u([p()],Ah.prototype,"start",void 0),Ah=kZ=u([A("esri.portal.PortalQueryParams")],Ah);const Zp=Ah;var zZ;let ao=zZ=class extends ee{constructor(t){super(t),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.sourceJSON=null,this.tags=null,this.title=null}get thumbnailUrl(){var i;const t=this.url,e=this.thumbnail;return t&&e&&this.portal?(i=this.portal)==null?void 0:i.normalizeUrl(`${t}/info/${e}?f=json`):null}get url(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?t+"/community/groups/"+this.id:null}fetchCategorySchema(t){return this.portal.request(this.url+"/categorySchema",t).then(e=>{const i=e.categorySchema||[];return i.some(r=>r.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",t):i})}fetchMembers(t){return this.portal.request(this.url+"/users",t)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}toJSON(){throw new U("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new zZ({sourceJSON:t});return e.read(t),e}queryItems(t,e){let i=Ds(Zp,t);const r=this.portal;return parseFloat(r.currentVersion)>5?(i=i||new Zp,r.queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",e)):(i=i?i.clone():new Zp,i.query="group:"+this.id+(i.query?" "+i.query:""),r.queryItems(i,e))}_fetchCategorySchemaSet(t,e){const i=this.portal;return i.fetchSelf(i.authMode,!0,e).then(r=>{const s=r.contentCategorySetsGroupQuery;if(s){const n=new Zp({disableExtraQuery:!0,num:1,query:s});return i.queryGroups(n,e)}throw new U("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(r=>{if(r.total){const s=r.results[0],n=new Zp({num:1,query:`typekeywords:"${t}"`});return s.queryItems(n,e)}throw new U("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(r=>r.total?r.results[0].fetchData("json",e).then(s=>{const n=s==null?void 0:s.categorySchema;return n!=null&&n.length?n:[]}):[])}};u([p()],ao.prototype,"access",void 0),u([p({type:Date})],ao.prototype,"created",void 0),u([p()],ao.prototype,"description",void 0),u([p()],ao.prototype,"id",void 0),u([p()],ao.prototype,"isInvitationOnly",void 0),u([p({type:Date})],ao.prototype,"modified",void 0),u([p()],ao.prototype,"owner",void 0),u([p()],ao.prototype,"portal",void 0),u([p()],ao.prototype,"snippet",void 0),u([p()],ao.prototype,"sortField",void 0),u([p()],ao.prototype,"sortOrder",void 0),u([p()],ao.prototype,"sourceJSON",void 0),u([p()],ao.prototype,"tags",void 0),u([p()],ao.prototype,"thumbnail",void 0),u([p({readOnly:!0})],ao.prototype,"thumbnailUrl",null),u([p()],ao.prototype,"title",void 0),u([p({readOnly:!0})],ao.prototype,"url",null),ao=zZ=u([A("esri.portal.PortalGroup")],ao);const UZ=ao;let l1=class extends he{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};u([p()],l1.prototype,"nextQueryParams",void 0),u([p()],l1.prototype,"queryParams",void 0),u([p()],l1.prototype,"results",void 0),u([p()],l1.prototype,"total",void 0),l1=u([A("esri.portal.PortalQueryResult")],l1);const aYe=l1;let Yg=class extends ee{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){var i;const e=(i=this.portal)==null?void 0:i.restUrl;return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new U("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};u([p({type:Date})],Yg.prototype,"created",void 0),u([p()],Yg.prototype,"id",void 0),u([p()],Yg.prototype,"portal",void 0),u([p()],Yg.prototype,"title",void 0),u([p({readOnly:!0})],Yg.prototype,"url",null),u([p()],Yg.prototype,"username",void 0),Yg=u([A("esri.portal.PortalFolder")],Yg);const lYe=Yg;var BZ;let ms=BZ=class extends ee{constructor(t){super(t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userLicenseTypeId=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?`${t}/content/users/${this.username}`:null}get url(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,i=t==null?void 0:t.data,r=t==null?void 0:t.folder,s={method:"post"};e&&(s.query=e.createPostQuery(),i!=null&&(typeof i=="string"?s.query.text=i:typeof i=="object"&&(s.query.text=JSON.stringify(i))));let n=this.userContentUrl;return r&&(n+="/"+(typeof r=="string"?r:r.id)),this.portal.request(n+"/addItem",s).then(o=>(e.id=o.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}async deleteItem(t,e=!1){let i=this.userContentUrl;t.ownerFolder&&(i+="/"+t.ownerFolder);const r=e?{permanentDelete:!0}:{};await this.portal.request(i+`/items/${t.id}/delete`,{method:"post",query:r}),t.id=null,t.portal=null}async deleteItems(t,e=!1){t=t.slice();const i=this.userContentUrl+"/deleteItems",r=[],s=t.map(n=>n.id);if(s.length){const n={method:"post",query:{items:s.join(","),permanentDelete:e}},o=await this.portal.request(i,n);for(const a of o.results){const l=t.find(d=>a.itemId===d.id),c=a.success;let h=null;c?(l.id=null,l.portal=null):a.error&&(h=new U("portal:delete-item-failed",a.error.message,a.error)),r.push({item:l,success:c,error:h})}}return r}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let i;return i=e&&e.folders?e.folders.map(r=>{const s=lYe.fromJSON(r);return s.portal=this.portal,s}):[],i})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(i=>{const r=UZ.fromJSON(i);return r.portal=this.portal,r}):[],e})}async fetchItems(t){t??(t={});let e=this.userContentUrl??"";t.folder&&(e+="/"+t.folder.id);const{default:i}=await G(()=>Promise.resolve().then(()=>s$e),void 0),r={folders:!1,inRecycleBin:!!t.inRecycleBin||null,foldersContent:!(t.folder||!t.includeSubfolderItems)||null,num:t.num||10,start:t.start||1,sortField:t.sortField||"created",sortOrder:t.sortOrder||"asc"},s=await this.portal.request(e,{query:r});let n;return s!=null&&s.items?(n=s.items.map(o=>{const a=i.fromJSON(o);return a.portal=this.portal,a}),await Promise.all(n.map(o=>o.load())),{items:n,nextStart:s.nextStart,total:s.total}):{items:[],nextStart:-1,total:0}}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new UZ({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new U("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}async restoreItem(t,e){const i=this.userContentUrl,r=e?{folderID:typeof e=="string"?e:e.id}:null;await this.portal.request(i+`/items/${t.id}/restore`,{method:"post",query:r})}toJSON(){throw new U("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new BZ({sourceJSON:t});return e.read(t),e}};u([p()],ms.prototype,"access",void 0),u([p({type:Date})],ms.prototype,"created",void 0),u([p()],ms.prototype,"culture",void 0),u([p()],ms.prototype,"description",void 0),u([p()],ms.prototype,"email",void 0),u([p()],ms.prototype,"favGroupId",void 0),u([p()],ms.prototype,"fullName",void 0),u([p({type:Date})],ms.prototype,"modified",void 0),u([p()],ms.prototype,"orgId",void 0),u([p()],ms.prototype,"portal",void 0),u([p()],ms.prototype,"preferredView",void 0),u([p()],ms.prototype,"privileges",void 0),u([p()],ms.prototype,"region",void 0),u([p()],ms.prototype,"role",void 0),u([p()],ms.prototype,"roleId",void 0),u([p()],ms.prototype,"sourceJSON",void 0),u([p()],ms.prototype,"thumbnail",void 0),u([p({readOnly:!0})],ms.prototype,"thumbnailUrl",null),u([p()],ms.prototype,"units",void 0),u([p({readOnly:!0})],ms.prototype,"userContentUrl",null),u([p({readOnly:!0})],ms.prototype,"url",null),u([p()],ms.prototype,"username",void 0),u([p()],ms.prototype,"userLicenseTypeId",void 0),u([p()],ms.prototype,"userType",void 0),ms=BZ=u([A("esri.portal.PortalUser")],ms);const yre=ms;var Cu;let BM;const Rhe={PortalGroup:()=>Promise.resolve({default:UZ}),PortalItem:()=>G(()=>Promise.resolve().then(()=>s$e),void 0),PortalUser:()=>Promise.resolve({default:yre})};let Re=Cu=class extends ee.JSONSupportMixin(Il){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.default3DBasemapQuery=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.layoutGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.hasClassificationSchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.recycleBinEnabled=!1,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=Rr.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useDefault3dBasemap=!1,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){Phe.unregister(this),this.defaultBasemap=$e(this.defaultBasemap),this.defaultDevBasemap=$e(this.defaultDevBasemap),this.defaultVectorBasemap=$e(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=Ji(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)Rr.request.trustedServers.includes(e)||Rr.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){var i;const t=(i=this.user)==null?void 0:i.orgId,e=!t||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get hasAPIKey(){return kTe(this.url)}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.slice(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=yre.fromJSON(t),e.portal=this),e}load(t){const e=G(()=>Promise.resolve().then(()=>PYe),void 0).then(({default:i})=>{gt(t),BM=i}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(i=>{var r;if(!this.hasAPIKey&&hi){const s=hi;this.credential=s.findCredential(this.restUrl),this.credential||this.authMode!==Cu.AUTH_MODE_AUTO&&this.authMode!==Cu.AUTH_MODE_NO_PROMPT||((r=this._esriIdCredentialCreateHandle)==null||r.remove(),this._esriIdCredentialCreateHandle=s.on("credential-create",cYe(new WeakRef(this))),Phe.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await G(async()=>{const{default:i}=await import("./ElevationLayer-CkRfvdHZ.js");return{default:i}},__vite__mapDeps([113,114,115,116,117]))).default;return t?t.map(i=>new e({id:i.id,url:i.url})):[]}async fetchBasemaps(t,e){const i=await this._fetchBasemaps(t,e);if((e==null?void 0:e.include3d)===!0&&this.use3dBasemaps!==!1){const r=await this._fetchBasemaps3D(t,e);i.unshift(...r)}return i}async fetchDefault3DBasemap(t){if(!this.useDefault3dBasemap||!this.default3DBasemapQuery||this.default3DBasemapQuery==="none")return null;const e=new Zp;e.query=this.default3DBasemapQuery,e.disableExtraQuery=!0;const i=(await this.queryItems(e,t)).results.find(r=>r.type==="Web Scene");return i?new BM({portalItem:i}):null}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):Sa(t)?Promise.reject(bi()):Promise.resolve([])}async fetchClassificationSchema(t){return this.hasClassificationSchema?this.request(this.restUrl+"/portals/self/classification/classificationSchema",t).then(e=>e.classificationSchema):null}fetchFeaturedGroups(t){const e=this.featuredGroups,i=new Zp({num:100,sortField:"title"});if(e!=null&&e.length){const r=[];for(const s of e)r.push(`(title:"${s.title}" AND owner:${s.owner})`);return i.query=r.join(" OR "),this.queryGroups(i,t).then(s=>s.results)}return Sa(t)?Promise.reject(bi()):Promise.resolve([])}fetchRegions(t){var i;const e=((i=this.user)==null?void 0:i.culture)||this.culture||iu();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){var i;const e=((i=this.user)==null?void 0:i.culture)||this.culture||iu();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return nYe(()=>new Cu)}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,i){const r=this.restUrl+"/portals/self",s={authMode:t,query:{culture:iu().toLowerCase()},withCredentials:!0,...i};return s.authMode==="auto"&&(s.authMode="no-prompt"),e&&(s.query.default=!0),this.request(r,s)}queryPortal(t,e,i,r){const s=Ds(Zp,e),n=o=>this.request(this.restUrl+t,{...s.toRequestOptions(this),...r}).then(a=>{const l=s.clone();return l.start=a.nextStart,new aYe({nextQueryParams:l,queryParams:s,total:a.total,results:Cu._resultsToTypedArray(o,{portal:this},a,r)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(Wc(l),a)));return i&&Rhe[i]?Rhe[i]().then(({default:o})=>(gt(r),n(o))):n()}signIn(){if(this.hasAPIKey)return this.load().then(()=>{if(!this.user)throw new U("portal:not-authenticated","Unable to authenticate user. Portal.user is missing")});if(this.authMode===Cu.AUTH_MODE_ANONYMOUS||this.authMode===Cu.AUTH_MODE_NO_PROMPT&&!hi)return Promise.reject(new U("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(i=>{i&&(this.sourceJSON=i,this.read(i))});return hi?hi.getCredential(this.restUrl,{prompt:this.authMode!==Cu.AUTH_MODE_NO_PROMPT}).then(e=>t(e)):t(this.credential)}normalizeUrl(t){var i;const e=(i=this.credential)==null?void 0:i.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,i){return this.request(t,e).then(r=>{const s=Cu._resultsToTypedArray(i,{portal:this},r);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():r)).then(()=>s,()=>s)})}request(t,e={}){const i={f:"json",...e.query},{authMode:r=this.authMode===Cu.AUTH_MODE_ANONYMOUS||this.authMode===Cu.AUTH_MODE_NO_PROMPT?this.authMode:"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=e,c={authMode:r,body:s,cacheBust:n,method:o,query:i,responseType:a,timeout:0,signal:l};return e.withCredentials&&(c.withCredentials=!0),Ri(this._normalizeSSL(t),c).then(h=>h.data)}toJSON(){throw new U("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new Cu({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new U("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}async _fetchBasemaps(t,e){const i=new Zp;i.query=t||(this.hasAPIKey?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0;const r=await this.queryGroups(i,e);if(!r.total)return[];const s=r.results[0];i.num=100,i.query='type:"Web Map" -type:"Web Application"',i.sortField=s.sortField||"name",i.sortOrder=s.sortOrder||"desc";const n=await s.queryItems(i,e);return n.total?n.results.filter(o=>o.type==="Web Map").map(o=>new BM({portalItem:o})):[]}async _fetchBasemaps3D(t,e){const i=t||this.basemapGalleryGroupQuery3D;if(!i)return[];if(this.hasAPIKey)return[];const r=new Zp({query:i,disableExtraQuery:!0}),s=await this.queryGroups(r,e);if(!s.total)return[];const n=s.results[0];r.num=100,r.query='type:"Web Scene"',r.sortField=n.sortField||"name",r.sortOrder=n.sortOrder||"desc";const o=await n.queryItems(r,e);return o.total?o.results.filter(a=>a.type==="Web Scene").map(a=>new BM({portalItem:a})):[]}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=BM.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,i,r){let s;if(i){const n=r!=null?r.signal:null;s=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(t||e)&&(s=s.map(o=>{const a=Object.assign(t?t.fromJSON(o):o,e);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};Re.AUTH_MODE_ANONYMOUS="anonymous",Re.AUTH_MODE_AUTO="auto",Re.AUTH_MODE_IMMEDIATE="immediate",Re.AUTH_MODE_NO_PROMPT="no-prompt",u([p()],Re.prototype,"access",void 0),u([p()],Re.prototype,"allSSL",void 0),u([p()],Re.prototype,"authMode",void 0),u([p()],Re.prototype,"authorizedCrossOriginDomains",void 0),u([ve("authorizedCrossOriginDomains")],Re.prototype,"readAuthorizedCrossOriginDomains",null),u([p()],Re.prototype,"basemapGalleryGroupQuery",void 0),u([p({json:{name:"3DBasemapGalleryGroupQuery"}})],Re.prototype,"basemapGalleryGroupQuery3D",void 0),u([p()],Re.prototype,"bingKey",void 0),u([p()],Re.prototype,"canListApps",void 0),u([p()],Re.prototype,"canListData",void 0),u([p()],Re.prototype,"canListPreProvisionedItems",void 0),u([p()],Re.prototype,"canProvisionDirectPurchase",void 0),u([p()],Re.prototype,"canSearchPublic",void 0),u([p()],Re.prototype,"canShareBingPublic",void 0),u([p()],Re.prototype,"canSharePublic",void 0),u([p()],Re.prototype,"canSignInArcGIS",void 0),u([p()],Re.prototype,"canSignInIDP",void 0),u([p()],Re.prototype,"colorSetsGroupQuery",void 0),u([p()],Re.prototype,"commentsEnabled",void 0),u([p({type:Date})],Re.prototype,"created",void 0),u([p()],Re.prototype,"credential",void 0),u([p()],Re.prototype,"culture",void 0),u([p()],Re.prototype,"currentVersion",void 0),u([p()],Re.prototype,"customBaseUrl",void 0),u([p()],Re.prototype,"default3DBasemapQuery",void 0),u([p()],Re.prototype,"defaultBasemap",void 0),u([ve("defaultBasemap")],Re.prototype,"readDefaultBasemap",null),u([p()],Re.prototype,"defaultDevBasemap",void 0),u([ve("defaultDevBasemap")],Re.prototype,"readDefaultDevBasemap",null),u([p({type:_i})],Re.prototype,"defaultExtent",void 0),u([p()],Re.prototype,"defaultVectorBasemap",void 0),u([ve("defaultVectorBasemap")],Re.prototype,"readDefaultVectorBasemap",null),u([p()],Re.prototype,"description",void 0),u([p()],Re.prototype,"devBasemapGalleryGroupQuery",void 0),u([p()],Re.prototype,"eueiEnabled",void 0),u([p({readOnly:!0})],Re.prototype,"extraQuery",null),u([p()],Re.prototype,"featuredGroups",void 0),u([p()],Re.prototype,"featuredItemsGroupQuery",void 0),u([p()],Re.prototype,"galleryTemplatesGroupQuery",void 0),u([p()],Re.prototype,"layoutGroupQuery",void 0),u([p()],Re.prototype,"livingAtlasGroupQuery",void 0),u([p({readOnly:!0})],Re.prototype,"hasAPIKey",null),u([p()],Re.prototype,"hasCategorySchema",void 0),u([p()],Re.prototype,"hasClassificationSchema",void 0),u([p()],Re.prototype,"helpBase",void 0),u([p()],Re.prototype,"helperServices",void 0),u([p()],Re.prototype,"helpMap",void 0),u([p()],Re.prototype,"homePageFeaturedContent",void 0),u([p()],Re.prototype,"homePageFeaturedContentCount",void 0),u([p()],Re.prototype,"httpPort",void 0),u([p()],Re.prototype,"httpsPort",void 0),u([p()],Re.prototype,"id",void 0),u([p()],Re.prototype,"ipCntryCode",void 0),u([p({readOnly:!0})],Re.prototype,"isOrganization",null),u([p()],Re.prototype,"isPortal",void 0),u([p()],Re.prototype,"isReadOnly",void 0),u([p({readOnly:!0})],Re.prototype,"itemPageUrl",null),u([p()],Re.prototype,"layerTemplatesGroupQuery",void 0),u([p()],Re.prototype,"maxTokenExpirationMinutes",void 0),u([p({type:Date})],Re.prototype,"modified",void 0),u([p()],Re.prototype,"name",void 0),u([p()],Re.prototype,"portalHostname",void 0),u([p()],Re.prototype,"portalMode",void 0),u([p()],Re.prototype,"portalProperties",void 0),u([p()],Re.prototype,"region",void 0),u([p()],Re.prototype,"recycleBinEnabled",void 0),u([p({readOnly:!0})],Re.prototype,"restUrl",null),u([p()],Re.prototype,"rotatorPanels",void 0),u([p()],Re.prototype,"showHomePageDescription",void 0),u([p()],Re.prototype,"sourceJSON",void 0),u([p()],Re.prototype,"staticImagesUrl",void 0),u([p({json:{name:"2DStylesGroupQuery"}})],Re.prototype,"stylesGroupQuery2d",void 0),u([p({json:{name:"stylesGroupQuery"}})],Re.prototype,"stylesGroupQuery3d",void 0),u([p()],Re.prototype,"supportsHostedServices",void 0),u([p()],Re.prototype,"symbolSetsGroupQuery",void 0),u([p()],Re.prototype,"templatesGroupQuery",void 0),u([p()],Re.prototype,"thumbnail",void 0),u([p({readOnly:!0})],Re.prototype,"thumbnailUrl",null),u([p()],Re.prototype,"units",void 0),u([p()],Re.prototype,"url",void 0),u([p()],Re.prototype,"urlKey",void 0),u([ve("urlKey")],Re.prototype,"readUrlKey",null),u([p()],Re.prototype,"user",void 0),u([ve("user")],Re.prototype,"readUser",null),u([p()],Re.prototype,"use3dBasemaps",void 0),u([p()],Re.prototype,"useDefault3dBasemap",void 0),u([p()],Re.prototype,"useStandardizedQuery",void 0),u([p()],Re.prototype,"useVectorBasemaps",void 0),u([p()],Re.prototype,"vectorBasemapGalleryGroupQuery",void 0),Re=Cu=u([A("esri.portal.Portal")],Re);const vn=Re,Phe=new FinalizationRegistry(t=>{t.remove()});function cYe(t){const e=hi;return()=>{const i=t.deref();i&&e.findCredential(i.restUrl)&&i.signIn().catch(()=>{})}}let Jg=class extends he{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e!=null&&e.portalItem&&e.path?{...e,path:Dhe(e.path,e.portalItem)}:e}set path(e){e!=null&&rh(e)?J.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return Dhe(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",i){const r=this.cdnUrl;if(r==null)throw new U("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(r,{responseType:e,query:{token:this.portalItem.apiKey,_ts:i!=null&&i.cacheBust?Date.now():null},signal:i==null?void 0:i.signal})}async update(e,i){const{addOrUpdateResources:r}=await G(()=>Promise.resolve().then(()=>OC),void 0);return await r(this.portalItem,[{resource:this,content:e,compress:i==null?void 0:i.compress,access:i==null?void 0:i.access}],"update",i),this}hasPath(){return this.path!=null}};function Dhe(t,e){return t==null?t:(t=t.replace(/^\/+/,""),e!=null&&rh(t)&&(t=yie(t,e.itemUrl)),t==null?void 0:t.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}u([p()],Jg.prototype,"portalItem",void 0),u([p({type:String,value:null})],Jg.prototype,"path",null),u([ti("path")],Jg.prototype,"_castPath",null),u([p({type:String,readOnly:!0})],Jg.prototype,"url",null),u([p({type:String,readOnly:!0})],Jg.prototype,"cdnUrl",null),u([p({type:String,readOnly:!0})],Jg.prototype,"itemRelativeUrl",null),Jg=u([A("esri.portal.PortalItemResource")],Jg);const uYe=Jg;let eI=class extends he{constructor(e){super(e),this.created=null,this.rating=null}};u([p({type:Date})],eI.prototype,"created",void 0),u([p()],eI.prototype,"rating",void 0),eI=u([A("esri.portal.PortalRating")],eI);const n8=eI;var c1;const hYe=new Set(["3DTiles Service","CSV","Feature Collection","Feature Service","Feed","GeoJson","Group Layer","Image Service","KML","Map Service","Media Layer","Scene Service","Stream Service","Vector Tile Service","WFS","WMS","WMTS"]),dYe=new Set(["KML","GeoJson","CSV"]);let mi=c1=class extends ee.JSONSupportMixin(Il){static from(t){return GA(c1,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.classification=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let i=t;return t==="Feature Service"||t==="Feature Collection"?i=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?i=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?i="Scene Layer":t==="Video Service"?i="Video Layer":t==="Scene Package"?i="Scene Layer Package":t==="Stream Service"?i="Feature Layer":t==="Geoprocessing Service"?i=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geoenrichment Service"?i="GeoEnrichment Service":t==="Geocoding Service"?i="Locator":t==="Microsoft Powerpoint"?i="Microsoft PowerPoint":t==="GeoJson"?i="GeoJSON":t==="Globe Service"?i="Globe Layer":t==="Vector Tile Service"?i="Tile Layer":t==="netCDF"?i="NetCDF":t==="Map Service"?i=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t!=null&&t.toLowerCase().includes("add in")?i=t.replaceAll(/(add in)/gi,"Add-In"):t==="datastore catalog service"?i="Big Data File Share":t==="Compact Tile Package"?i="Tile Package (tpkx)":t==="Raster function template"?i="Raster Function Template":t==="OGCFeatureServer"?i="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?i="Instant App":t==="Insights Page"?i="Insights Report":t==="Excalibur Imagery Project"?i="Excalibur Project":t==="3DTiles Service"?i="3D tiles layer":t==="3DTiles Package"&&(i="3D tiles package"),i}readExtent(t){return t&&t.length?new _i(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){var m;const t=((m=this.type)==null?void 0:m.toLowerCase())||"",e=this.typeKeywords||[],i="esri/images/portal/",r="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,h=!1,d=!1,f=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(n=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(o=e.includes("Table"),a=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),h=e.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":h?"utilitynetwork":n?"featureshosted":"features"):t==="map service"||t==="wms"||t==="wmts"?(c=e.includes("Spatiotemporal"),d=e.includes("Relational"),s=c||d?"mapimages":n||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages"):s=t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="video service"?e.includes("Live Stream")?"livestreamvideolayer":"videolayer":t==="geoprocessing service"?e.includes("Web Tool")?"tool":"layers":t==="geodata service"?"geodataservice":t==="3dtiles service"?e.includes("3DObject")?"3dobjecttileslayer":e.includes("IntegratedMesh")?"integratedmeshtileslayer":"3dtileslayer":"layers"):t==="web map"||t==="cityengine web scene"?s="maps":t==="web scene"?s=e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?s="instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?s="apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?s="mapsgray":t==="service definition"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="netcdf"||t==="administrative report"?s="datafiles":t==="360 vr experience"?s="360vr":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?s="appsgray":t==="arcgis pro add in"||t==="arcgis pro configuration"?s="addindesktop":t==="pdf"?s="pdf":t==="microsoft word"?s="word":t==="microsoft excel"?s="excel":t==="microsoft powerpoint"?s="ppt":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?s="datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?s="toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?s="layersgray":t==="analysis model"?s="analysismodel":t==="scene package"?s="scenepackage":t==="3dtiles package"?s="3dtileslayerpackage":t==="3dtiles service"?s="3dtileslayer":t==="mobile scene package"?s="mobilescenepackage":t==="tile package"||t==="compact tile package"?s="tilepackage":t==="task file"?s="taskfile":t==="report template"?s="report-template":t==="statistical data collection"?s="statisticaldatacollection":t==="insights workbook"?s="workbook":t==="insights model"?s="insightsmodel":t==="insights page"?s="insightspage":t==="insights theme"?s="insightstheme":t==="hub initiative"?s="hubinitiative":t==="hub page"?s="hubpage":t==="hub site application"?s="hubsite":t==="hub event"?s="hubevent":t==="hub project"?s="hubproject":t==="relational database connection"?s="relationaldatabaseconnection":t==="big data file share"?s="datastorecollection":t==="image collection"?s="imagecollection":t==="desktop style"?s="desktopstyle":t==="style"?s=e.includes("Dictionary")?"dictionarystyle":"style":t==="dashboard"?s="dashboard":t==="raster function template"?s="rasterprocessingtemplate":t==="vector tile package"?s="vectortilepackage":t==="ortho mapping project"?s="orthomappingproject":t==="ortho mapping template"?s="orthomappingtemplate":t==="solution"?s="solutions":t==="geopackage"?s="geopackage":t==="deep learning package"?s="deeplearningpackage":t==="real time analytic"?s="realtimeanalytics":t==="reality mapping project"?s="realitymappingproject":t==="big data analytic"?s="bigdataanalytics":t==="feed"?s="feed":t==="excalibur imagery project"?s="excaliburimageryproject":t==="notebook"?s="notebook":t==="storymap"?s="storymap":t==="survey123 add in"?s="survey123addin":t==="mission"?s="mission":t==="mission report"?s="missionreport":t==="mission template"?s="missiontemplate":t==="quickcapture project"?s="quickcaptureproject":t==="pro report"?s="proreport":t==="pro report template"?s="proreporttemplate":t==="urban model"?s="urbanmodel":t==="urban project"?s="urbanproject":t==="web experience"?s="experiencebuilder":t==="web experience template"?s="webexperiencetemplate":t==="experience builder widget"?s="experiencebuilderwidget":t==="experience builder widget package"?s="experiencebuilderwidgetpackage":t==="workflow"?s="workflow":t==="kernel gateway connection"?s="kernelgatewayconnection":t==="insights script"?s="insightsscript":t==="hub initiative template"?s="hubinitiativetemplate":t==="storymap theme"?s="storymaptheme":t==="knowledge graph"?s="knowledgegraph":t==="knowledge graph layer"?s="knowledgegraphlayer":t==="knowledge studio project"?s="knowledgestudio":t==="native application"?s="nativeapp":t==="native application installer"?s="nativeappinstaller":t==="web link chart"?s="linkchart":t==="knowledge graph web investigation"?s="investigation":t==="ogcfeatureserver"?s="features":t==="pro presentation"?s="propresentation":t==="pro project"?s="proproject":t==="insights workbook package"?s="insightsworkbookpackage":t==="apache parquet"?s="apacheparquet":t==="notebook code snippet library"?s="notebookcodesnippets":t==="suitability model"?s="suitabilitymodel":t==="esri classifier definition"?s="classifierdefinition":t==="esri classification schema"?s="classificationschema":t==="insights data engineering workbook"?s="dataengineeringworkbook":t==="insights data engineering model"?s="dataengineeringmodel":t==="deep learning studio project"?s="deeplearningproject":t==="discussion"?s="discussion":t==="allsource project"?s="allsourceproject":t==="api key"?s="apikey":t==="data pipeline"?s="datapipelines":t==="group layer"?(f=e.includes("Map"),s=f?"layergroup2d":"layergroup"):s=t==="media layer"?"onlinemedialayer":t==="form"?e.includes("Survey123")?"survey":"datafilesgray":t==="csv"?"csv":t==="image"?"image":"maps",s?vs(i+s+r+".png"):null}get isLayer(){return this.type!=null&&hYe.has(this.type)}get itemCdnUrl(){return Tie(this.itemUrl)}get itemPageUrl(){var e;const t=(e=this.portal)==null?void 0:e.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){var i;const t=this.itemUrl,e=this.thumbnail;return t&&e?((i=this.portal)==null?void 0:i.normalizeUrl(`${t}/info/${e}?f=json`))??null:null}get userItemUrl(){var i,r,s;const t=(i=this.portal)==null?void 0:i.restUrl;if(!t)return null;const e=this.owner||((s=(r=this.portal)==null?void 0:r.user)==null?void 0:s.username);return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=vn.getDefault()),i=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:t!=null?t.signal:null,query:{token:this.apiKey}}):{}).then(r=>{this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(i),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}},i=t instanceof n8?t.rating:t;return i==null||isNaN(i)||typeof t!="number"||(e.query.rating=i),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new n8({rating:i,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:q(this.applicationProxies),avgRating:this.avgRating,categories:q(this.categories),classification:q(this.classification),created:q(this.created),culture:this.culture,description:this.description,extent:q(this.extent),groupCategories:q(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:q(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:q(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:q(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:q(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new c1({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){var e;const t=this.toJSON();for(const i of["tags","typeKeywords","categories"])t[i]=(e=t[i])==null?void 0:e.join(", ");for(const i of["extent","classification"]){const r=t[i];r&&(t[i]=JSON.stringify(r))}return t}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return this.portal.request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await this.portal.request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new n8(e)):null}fetchRelatedItems(t,e){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},c1)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.applicationProxies&&!Object.hasOwn(t,"appProxies")&&(this.applicationProxies=null),this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t==null?void 0:t.data,i={method:"post"};i.query=this.createPostQuery();for(const r in i.query)i.query[r]===null&&(i.query[r]="");return i.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?i.query.text=e:typeof e=="object"&&(i.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,i).then(()=>this.reload())}):Promise.reject(new U("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new U("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:i}=this;await e.signIn();const{copyResources:r,folder:s,tags:n,title:o}=t||{},a={method:"post",query:{copyPrivateResources:r==="all",folder:typeof s=="string"?s:s==null?void 0:s.id,includeResources:!!r,tags:n==null?void 0:n.join(","),title:o}},{itemId:l}=await e.request(`${i}/copy`,a);return new c1({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,i=t.filename,r={method:"post"};if(typeof e=="string")$f(e)?r.query={data:e}:r.query={url:Jc(e)},i!=null&&(r.query.filename=i);else{const s=new FormData;i!=null?s.append("file",e,i):s.append("file",e),r.body=s}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,r).then(()=>this.reload())}):Promise.reject(new U("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){const{fetchResources:i}=await G(()=>Promise.resolve().then(()=>OC),void 0);return i(this,t,e)}async addResource(t,e,i){const{addOrUpdateResources:r}=await G(()=>Promise.resolve().then(()=>OC),void 0);return t.portalItem=this,await r(this,[{resource:t,content:e,compress:i==null?void 0:i.compress,access:i==null?void 0:i.access}],"add",i),t}async removeResource(t,e){const{removeResource:i}=await G(()=>Promise.resolve().then(()=>OC),void 0);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new U("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i(this,t,e)}async removeAllResources(t){const{removeAllResources:e}=await G(()=>Promise.resolve().then(()=>OC),void 0);return e(this,t)}resourceFromPath(t){return new uYe({portalItem:this,path:t})}toJSON(){var i,r;const t=this.extent,e={accessInformation:this.accessInformation,categories:q(this.categories),classification:q(this.classification),created:(i=this.created)==null?void 0:i.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:(r=this.modified)==null?void 0:r.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:q(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:q(this.typeKeywords),url:this.url};return YVe(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new c1({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};u([p({type:["private","shared","org","public"]})],mi.prototype,"access",void 0),u([p()],mi.prototype,"accessInformation",void 0),u([p({type:String})],mi.prototype,"apiKey",void 0),u([p({json:{read:{source:"appProxies"}}})],mi.prototype,"applicationProxies",void 0),u([p()],mi.prototype,"avgRating",void 0),u([p()],mi.prototype,"categories",void 0),u([p()],mi.prototype,"classification",void 0),u([p({type:Date})],mi.prototype,"created",void 0),u([p()],mi.prototype,"culture",void 0),u([p()],mi.prototype,"description",void 0),u([p({readOnly:!0})],mi.prototype,"displayName",null),u([p({type:_i})],mi.prototype,"extent",void 0),u([ve("extent")],mi.prototype,"readExtent",null),u([p()],mi.prototype,"groupCategories",void 0),u([p({readOnly:!0})],mi.prototype,"iconUrl",null),u([p()],mi.prototype,"id",void 0),u([p({readOnly:!0})],mi.prototype,"isLayer",null),u([p({type:Boolean,readOnly:!0})],mi.prototype,"isOrgItem",void 0),u([p()],mi.prototype,"itemControl",void 0),u([p({readOnly:!0})],mi.prototype,"itemPageUrl",null),u([p({readOnly:!0})],mi.prototype,"itemUrl",null),u([p()],mi.prototype,"licenseInfo",void 0),u([p({type:Date})],mi.prototype,"modified",void 0),u([p()],mi.prototype,"name",void 0),u([p()],mi.prototype,"numComments",void 0),u([p()],mi.prototype,"numRatings",void 0),u([p()],mi.prototype,"numViews",void 0),u([p()],mi.prototype,"owner",void 0),u([p()],mi.prototype,"ownerFolder",void 0),u([p({type:vn})],mi.prototype,"portal",void 0),u([p()],mi.prototype,"screenshots",void 0),u([p()],mi.prototype,"size",void 0),u([p()],mi.prototype,"snippet",void 0),u([p()],mi.prototype,"sourceJSON",void 0),u([p({type:String})],mi.prototype,"sourceUrl",void 0),u([p({type:String})],mi.prototype,"spatialReference",void 0),u([p()],mi.prototype,"tags",void 0),u([p()],mi.prototype,"thumbnail",void 0),u([p({readOnly:!0})],mi.prototype,"thumbnailUrl",null),u([p()],mi.prototype,"title",void 0),u([p()],mi.prototype,"type",void 0),u([p()],mi.prototype,"typeKeywords",void 0),u([p({type:String,json:{read(t,e){var i;if(dYe.has(e.type)){const r=(i=this.portal)==null?void 0:i.restUrl;t||(t=r&&this.id?`${r}/content/items/${this.id}/data`:null)}return t}}})],mi.prototype,"url",void 0),u([p({readOnly:!0})],mi.prototype,"userItemUrl",null),mi=c1=u([A("esri.portal.PortalItem")],mi);const nh=mi,s$e=Object.freeze(Object.defineProperty({__proto__:null,default:nh},Symbol.toStringTag,{value:"Module"}));async function pYe(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t.includes("-3d")?t.slice(0,t.indexOf("-3d")):t,i=await eCe("esri/t9n/basemaps");return i[t]||i[e]}const Y$={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return vs("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return vs("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return vs("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return vs("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return vs("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return vs("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return vs("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return vs("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return vs("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return vs("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return vs("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return vs("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return vs("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return vs("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return vs("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return vs("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return vs("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]}};let Xg=class extends he{constructor(e){super(e),this.apiKey=null,this.id=null,this.language=null,this.places=null,this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2",this.worldview=null}get languageParameter(){const e=this.language;let i=e==="local"||e==="global"?e:tCe(e??iu())??"global";return i=i==="no"?"nb":i,i}};u([p()],Xg.prototype,"apiKey",void 0),u([p()],Xg.prototype,"id",void 0),u([p()],Xg.prototype,"language",void 0),u([p()],Xg.prototype,"places",void 0),u([p()],Xg.prototype,"serviceUrl",void 0),u([p()],Xg.prototype,"worldview",void 0),Xg=u([A("esri.support.BasemapStyle")],Xg);const fYe=Xg;function mYe(t){return n$e(t)||yYe(t)}function gYe(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="feature"}function Z9t(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="graphics"}function Y9t(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="map-notes"&&"sublayers"in t}function J9t(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="knowledge-graph"&&"layers"in t}function X9t(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="link-chart"&&"layers"in t}function yYe(t){return(t==null?void 0:t.type)==="scene"}function vYe(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="subtype-group"&&"sublayers"in t}function id(t){return(t==null?void 0:t.type)==="subtype-sublayer"}function n$e(t){const e=t==null?void 0:t.type;return e==="imagery-tile"||e==="tile"||e==="open-street-map"||e==="vector-tile"||e==="web-tile"||e==="wmts"}function HC(t){const e=t==null?void 0:t.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function J$(t){return t!=null&&"type"in t&&t.type==="group"}const K9t={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function VZ(t){const e=t==null?void 0:t.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function _Ye(t){return t==="IntegratedMeshLayer"||t==="IntegratedMesh3DTilesLayer"}function w3(t){return t==="integrated-mesh"||t==="integrated-mesh-3dtiles"}function Lhe(t){return(t==null?void 0:t.type)==="voxel"}function Nhe(t){return(t==null?void 0:t.type)==="imagery-tile"}function N4(t){return(t==null?void 0:t.parent)!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function QD(t){var e;return(t==null?void 0:t.type)==="feature"&&!t.url&&((e=t.source)==null?void 0:e.type)==="memory"}function o$e(t){var i;const e=t==null?void 0:t.type;return(e==="feature"||e==="subtype-group"||e==="oriented-imagery")&&((i=t==null?void 0:t.source)==null?void 0:i.type)==="feature-layer"}function bYe(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const i=t.activeLayer.tileMatrixSets;if(i)return i}return null}async function vre(t,e){const i=hi==null?void 0:hi.findServerInfo(t);if((i==null?void 0:i.currentVersion)!=null)return i.owningSystemUrl||null;const r=t.toLowerCase().indexOf("/rest/services");if(r===-1)return null;const s=`${t.slice(0,r)}/rest/info`,n=e!=null?e.signal:null,{data:o}=await Ri(s,{query:{f:"json"},responseType:"json",signal:n});return(o==null?void 0:o.owningSystemUrl)||null}function a$e(t){if(!("capabilities"in t))return!1;switch(t.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"sublayer":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function wYe(t){return a$e(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function xYe(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function SYe(t){return!!xYe(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}const TYe=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wcs","wms","wmts"]),l$e=new Set(["catalog","csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","knowledge-graph","map-image","map-notes","media","ogc-feature","oriented-imagery","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wcs","wfs","wms","wmts"]),EYe=new Set([...l$e,"link-chart"]);function CYe(t){switch(t.layerContainerType){case"basemap":return TYe;case"operational-layers":return t.origin==="link-chart"?EYe:l$e;default:return null}}function $Ye(t,e){if(e.restrictedWebMapWriting){const i=CYe(e);return i==null||i.has(t.type)&&!QD(t)}return!0}function AYe(t,e){var i;if(e)if(QD(t)){const r=Pj("featureCollection.layers",e),s=(i=r==null?void 0:r[0])==null?void 0:i.layerDefinition;s&&Fhe(t,s)}else t.type!=="group"&&Fhe(t,e)}function Fhe(t,e){"maxScale"in t&&(e.maxScale=pU(t.maxScale)??void 0),"minScale"in t&&(e.minScale=pU(t.minScale)??void 0)}function MYe(t,e){if(AYe(t,e),e&&(e.id=t.id,"blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=pU(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(QD(t)){const i=e.featureCollection;i&&(i.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function jZ(t,e,i){if(!t.persistenceEnabled)return null;if(!("write"in t)||!t.write)return i!=null&&i.messages&&i.messages.push(new U("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(QD(t)&&!t.isTable)e=t.resourceInfo;else if($Ye(t,i)){const r={};return t.write(r,i)?r:null}return e!=null&&MYe(t,e=q(e)),e}var tI;let OYe=0,$u=tI=class extends ee.JSONSupportMixin(Il){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.style=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+OYe++,this.baseLayers=new Ce,this.referenceLayers=new Ce;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type==="elevation"&&J.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=r=>{r.parent=null};this.addHandles([this.baseLayers.on("after-add",r=>e(r.item)),this.referenceLayers.on("after-add",r=>e(r.item)),this.baseLayers.on("after-remove",r=>i(r.item)),this.referenceLayers.on("after-remove",r=>i(r.item))])}initialize(){this.when().catch(t=>{J.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.baseLayers.toArray();for(const i of t)i.destroy();const e=this.referenceLayers.toArray();for(const i of e)i.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem=$e(this.portalItem)}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",vf(t,this._get("baseLayers")))}_writeBaseLayers(t,e,i){const r=[];t&&(i={...i,layerContainerType:"basemap"},this.baseLayers.forEach(s=>{const n=jZ(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);n!=null&&r.push(n)}),this.referenceLayers.forEach(s=>{const n=jZ(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);n!=null&&(s.type!=="scene"&&(n.isReference=!0),r.push(n))})),e.baseMapLayers=r}set referenceLayers(t){this._set("referenceLayers",vf(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return KD(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(e=>oU(e)?e.clone():e),referenceLayers:this.referenceLayers.map(e=>oU(e)?e.clone():e)};return this.loaded&&(t.loadStatus="loaded"),new tI({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){var i;return t=t||{},e!=null&&e.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&((i=this.resourceInfo)!=null&&i.data.baseMapLayers)&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(r=>{const s=q(r);return s.url&&ig(s.url)&&(s.url=`https:${s.url}`),s.templateUrl&&ig(s.templateUrl)&&(s.templateUrl=`https:${s.templateUrl}`),s})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:i,style:r}=this;gt(t);const s=[];if(e){const n=e.context?e.context.url:null;if(s.push(this._loadLayersFromJSON(e.data,n,t)),e.data.id&&!e.data.title){const o=e.data.id;s.push(pYe(o).then(a=>{a&&this.read({title:a},e.context)}))}}else i?s.push(this._loadFromItem(i,t)):r&&s.push(this._loadFromStylesService(r,t));await Promise.all(s)}async _loadLayersFromJSON(t,e,i){var l,c;const r=(l=this.resourceInfo)==null?void 0:l.context,s=((c=this.portalItem)==null?void 0:c.portal)||(r==null?void 0:r.portal)||null,n=RYe[(r==null?void 0:r.origin)||""]??"web-map",{populateOperationalLayers:o}=await G(async()=>{const{populateOperationalLayers:h}=await import("./layersCreator-B9RBAQ3N.js");return{populateOperationalLayers:h}},__vite__mapDeps([118,119,120,121,122,123])),a=[];if(gt(i),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const h={context:{...r,origin:n,url:e,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},d=g=>n==="web-scene"&&g.layerType==="ArcGISSceneServiceLayer"||g.isReference,f=o(this.baseLayers,t.baseMapLayers.filter(g=>!d(g)),h);a.push(f);const m=o(this.referenceLayers,t.baseMapLayers.filter(d),h);a.push(m)}await Promise.allSettled(a)}async _loadFromItem(t,e){const i=await t.load(e),r=await i.fetchData("json",e),s=yn(t.itemUrl??"");return this._set("resourceInfo",{data:r.baseMap??{},context:{origin:IYe[t.type||""]??"web-map",portal:t.portal||vn.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||vn.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,e)}async _loadFromStylesService(t,e){const i=t.serviceUrl.endsWith("/webmaps")?t.serviceUrl.slice(0,-8):t.serviceUrl,r=`${i}/styles/${t.id}/self`,s=`${i}/webmaps/${t.id}`,[n,o]=await Promise.all([(await Ri(r,{query:{token:t.apiKey},signal:e==null?void 0:e.signal})).data,(await Ri(s,{query:{language:t.languageParameter,places:t.places,worldview:t.worldview,token:t.apiKey},signal:e==null?void 0:e.signal})).data]);this.thumbnailUrl??(this.thumbnailUrl=n.thumbnailUrl);const a=yn(s);if(this._set("resourceInfo",{data:o.baseMap??{},context:{origin:"web-map",url:a}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:o.spatialReference},this.resourceInfo.context),await this._loadLayersFromJSON(this.resourceInfo.data,a,e),t.apiKey)for(const l of[...this.baseLayers,...this.referenceLayers])"apiKey"in l&&(l.apiKey=t.apiKey)}static fromId(t){const e=Y$[t];return e?e.itemId?new tI({portalItem:{id:e.itemId,portal:{url:"https://www.arcgis.com"}}}):tI.fromJSON(e,{origin:e.is3d?"web-scene":"web-map"}):null}};u([p({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,i,r){this._writeBaseLayers(t,e,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:Ce}},writer(t,e,i,r){this._writeBaseLayers(t,e,r)}}}}}})],$u.prototype,"baseLayers",null),u([p({type:String,json:{origins:{"web-scene":{write:!0}}}})],$u.prototype,"id",void 0),u([p({type:nh})],$u.prototype,"portalItem",void 0),u([p()],$u.prototype,"referenceLayers",null),u([p({readOnly:!0})],$u.prototype,"resourceInfo",void 0),u([p({type:Oe})],$u.prototype,"spatialReference",void 0),u([p({type:fYe})],$u.prototype,"style",void 0),u([p()],$u.prototype,"thumbnailUrl",void 0),u([p({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],$u.prototype,"title",void 0),u([_e("title")],$u.prototype,"writeTitle",null),$u=tI=u([A("esri.Basemap")],$u);const IYe={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},RYe={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},sv=$u,PYe=Object.freeze(Object.defineProperty({__proto__:null,default:sv},Symbol.toStringTag,{value:"Module"})),HU={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function c$e(t){return!!HU[t]||!!HU[t.toLowerCase()]}function _re(t){return HU[t]??HU[t.toLowerCase()]}function DYe(t){return[..._re(t)]}function o8(t,e,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?t+(e-t)*r:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}function u$e(t,e,i,r=1){const s=(t%360+360)%360/360,n=i<=.5?i*(e+1):i+e-i*e,o=2*i-n;return[Math.round(255*o8(o,n,s+1/3)),Math.round(255*o8(o,n,s)),Math.round(255*o8(o,n,s-1/3)),r]}function LYe(t){const e=t.length>5,i=e?8:4,r=(1<<i)-1,s=e?1:17,n=e?t.length===9:t.length===5;let o=+("0x"+t.slice(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&r,o>>=i,a[3]=s*l/255),l=o&r,o>>=i,a[2]=s*l,l=o&r,o>>=i,a[1]=s*l,l=o&r,o>>=i,a[0]=s*l,a}const qU=2.2;function CN(t){return ue(tie(t),0,255)}function $N(t,e,i){return t=Number(t),isNaN(t)?i:t<e?e:t>i?i:t}function AN(t,e){const i=t.toString(16).padStart(2,"0");return e?i.slice(0,1):i}let Je=class ko{static blendColors(e,i,r,s=new ko){return s.r=Math.round(e.r+(i.r-e.r)*r),s.g=Math.round(e.g+(i.g-e.g)*r),s.b=Math.round(e.b+(i.b-e.b)*r),s.a=e.a+(i.a-e.a)*r,s._sanitize()}static fromRgb(e,i){const r=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s.\-,%0-9]+)\)/);if(r){const s=r[2].split(/\s*,\s*/),n=r[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),ko.fromArray(a,i)}return ko.fromArray(s.map(a=>parseFloat(a)),i)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return ko.fromArray(u$e(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),i)}return null}static fromHex(e,i=new ko){if(e[0]!=="#"||isNaN(+`0x${e.slice(1)}`))return null;switch(e.length){case 4:case 5:{const r=parseInt(e.slice(1,2),16),s=parseInt(e.slice(2,3),16),n=parseInt(e.slice(3,4),16),o=e.length===5?15:parseInt(e.slice(4),16);return ko.fromArray([r+16*r,s+16*s,n+16*n,(o+16*o)/255],i)}case 7:case 9:{const r=parseInt(e.slice(1,3),16),s=parseInt(e.slice(3,5),16),n=parseInt(e.slice(5,7),16),o=e.length===7?255:parseInt(e.slice(7),16);return ko.fromArray([r,s,n,o/255],i)}default:return null}}static fromArray(e,i=new ko){return i._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(i.a)&&(i.a=1),i._sanitize()}static fromString(e,i){const r=c$e(e)?_re(e):null;return r&&ko.fromArray(r,i)||ko.fromRgb(e,i)||ko.fromHex(e,i)}static fromJSON(e){return e!=null?new ko([e[0],e[1],e[2],(e[3]??255)/255]):void 0}static toUnitRGB(e){return e!=null?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return e!=null?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?ko.fromString(e,this):Array.isArray(e)?ko.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof ko||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(e){const i=(e==null?void 0:e.capitalize)??!1,r=(e==null?void 0:e.digits)??6,s=r===3||r===4,n=r===4||r===8,o=`#${AN(this.r,s)}${AN(this.g,s)}${AN(this.b,s)}${n?AN(Math.round(255*this.a),s):""}`;return i?o.toUpperCase():o}toCss(e=!1){const i=this.r+", "+this.g+", "+this.b;return e?`rgba(${i}, ${this.a})`:`rgb(${i})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=ko.AlphaMode.ALWAYS){const i=CN(this.r),r=CN(this.g),s=CN(this.b);return e===ko.AlphaMode.ALWAYS||this.a!==1?[i,r,s,CN(255*this.a)]:[i,r,s]}clone(){return new ko(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return e!=null&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round($N(this.r,0,255)),this.g=Math.round($N(this.g,0,255)),this.b=Math.round($N(this.b,0,255)),this.a=$N(this.a,0,1),this}_set(e,i,r,s){this.r=e,this.g=i,this.b=r,this.a=s}};Je.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(Je);function Ve(t,e={}){const i=t instanceof ni?t:new ni(t,e),{alwaysWriteDefaults:r,default:s,ignoreUnknown:n=!0,name:o,nonNullable:a,readOnly:l=!1}=e;return p({type:n?i.apiValues:String,json:{type:i.jsonValues,default:s,name:o,read:!l&&{reader:i.read},write:{writer:i.write,alwaysWriteDefaults:r}},nonNullable:a,readOnly:l})}var GZ;let F4=GZ=class extends ee{constructor(t){super(t),this.type="none"}clone(){return new GZ({type:this.type})}};u([Ve({none:"none",stayAbove:"stay-above"}),p({json:{write:{isRequired:!0}}})],F4.prototype,"type",void 0),F4=GZ=u([A("esri.ground.NavigationConstraint")],F4);const NYe=Symbol("GroundInstance");function eL(t){const e=tie(100*(1-t));return Math.max(0,Math.min(e,100))}function X$(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}var h$e,HZ;let Kg=HZ=class extends ee.JSONSupportMixin(Il){constructor(t){super(t),this[h$e]=!0,this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new Ce;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&J.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=r=>{r.parent=null};this.addHandles([this.layers.on("after-add",r=>e(r.item)),this.layers.on("after-remove",r=>i(r.item))])}initialize(){this.when().catch(t=>{es(t)||J.getLogger(this).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)$e(e);this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}get layers(){return this._get("layers")}set layers(t){this._set("layers",vf(t,this._get("layers")))}writeLayers(t,e,i,r){const s=[];t&&(r={...r,layerContainerType:"ground"},t.forEach(n=>{if("write"in n){const o={};jVe(n)().write(o,r)&&s.push(o)}else r!=null&&r.messages&&r.messages.push(new U("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),e.layers=s}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return KD(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:i}=await G(()=>import("./ElevationQuery-zyZHDyVt.js"),[]);gt(e);const r=new i,s=this.layers.filter(khe).toArray();return r.queryAll(s,t,e)}async createElevationSampler(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:i}=await G(()=>import("./ElevationQuery-zyZHDyVt.js"),[]);gt(e);const r=new i,s=this.layers.filter(khe).toArray();return r.createSamplerAll(s,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:q(this.surfaceColor),navigationConstraint:q(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new HZ({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}async _loadLayersFromJSON(t,e,i){const r=(e==null?void 0:e.origin)||"web-scene",s=(e==null?void 0:e.portal)||null,n=(e==null?void 0:e.url)||null,{populateOperationalLayers:o}=await G(async()=>{const{populateOperationalLayers:l}=await import("./layersCreator-B9RBAQ3N.js");return{populateOperationalLayers:l}},__vite__mapDeps([118,119,120,121,122,123]));gt(i);const a=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:r,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,t.layers,l))}await Promise.allSettled(a)}};function FYe(t){return t&&"createElevationSampler"in t}function khe(t){return t.type==="elevation"||FYe(t)}h$e=NYe,u([p({json:{read:!1,write:{isRequired:!0}}})],Kg.prototype,"layers",null),u([_e("layers")],Kg.prototype,"writeLayers",null),u([p({readOnly:!0})],Kg.prototype,"resourceInfo",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Ii,read:{reader:X$,source:"transparency"},write:{writer:(t,e)=>{e.transparency=eL(t)},target:"transparency"}}})],Kg.prototype,"opacity",void 0),u([p({type:Je,json:{type:[Ii],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],Kg.prototype,"surfaceColor",void 0),u([p({type:F4,json:{write:!0}})],Kg.prototype,"navigationConstraint",void 0),Kg=HZ=u([A("esri.Ground")],Kg);const x3=Kg,MN=new WeakMap;function d$e(t){return!t.destroyed&&(MN.has(t)||t.addHandles([H(()=>{const e=t.parent;return!(!e||!("type"in e))&&(e.type==="catalog-dynamic-group"||d$e(e))},e=>MN.set(t,e),Mt),Pi(()=>MN.delete(t))]),MN.get(t))}function kYe(t){return typeof t=="object"&&t!=null&&"loaded"in t&&t.loaded===!0&&"type"in t}function zYe(t){var e,i;return!(!kYe(t)||!((i=(e=wYe(t))==null?void 0:e.operations)!=null&&i.supportsEditing)||"editingEnabled"in t&&!SYe(t)||d$e(t))}const UYe=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,BYe="screenUtils.toPt: input not recognized!",p$e=96;function xS(t){return t?t/72*p$e:0}function Rd(t){return t?72*t/p$e:0}function or(t){if(typeof t=="string"){const e=t.match(UYe);if(e){const i=Number(e[1]),r=e[3]&&e[3].toLowerCase(),s=t.charAt(0)==="-",n=r==="px"?Rd(i):i;return s?-n:n}return console.warn(BYe),null}return t}function xo(t=0,e=0){return{x:t,y:e}}function Q9t(t){return t?xo(t.x,t.y):null}function ln(t=0,e=0){return[t,e]}function f$e(t=0,e=0){return[t,e]}function Qp(t=0,e=0,i=0){return[t,e,i]}function e7t(t){return t}function t7t(t){return t}function i7t(t){return t}function Yp(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}function cG(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function VYe(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function jYe(t,e,i,r,s,n,o,a,l,c,h,d,f,m,g,v){const _=new Float32Array(16);return _[0]=t,_[1]=e,_[2]=i,_[3]=r,_[4]=s,_[5]=n,_[6]=o,_[7]=a,_[8]=l,_[9]=c,_[10]=h,_[11]=d,_[12]=f,_[13]=m,_[14]=g,_[15]=v,_}function GYe(t,e){return new Float32Array(t,e,16)}const HYe=cG();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:HYe,clone:VYe,create:cG,createView:GYe,fromValues:jYe},Symbol.toStringTag,{value:"Module"}));let bre=1e-6;function To(){return bre}function qYe(t){bre=t}const tL=Math.random,WYe=Math.PI/180,ZYe=180/Math.PI;function iL(t){return t*WYe}function YYe(t){return t*ZYe}function JYe(t,e){return Math.abs(t-e)<=bre*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:tL,equals:JYe,getEpsilon:To,setEpsilon:qYe,toDegree:YYe,toRadian:iL},Symbol.toStringTag,{value:"Module"}));function _n(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function yg(t,e,i,r,s,n,o,a,l,c,h,d,f,m,g,v,_){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=h,t[10]=d,t[11]=f,t[12]=m,t[13]=g,t[14]=v,t[15]=_,t}function _f(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function mc(t,e){if(t===e){const i=e[1],r=e[2],s=e[3],n=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=n,t[11]=e[14],t[12]=s,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function wre(t,e){return $l(t,e)||_f(t),t}function $l(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=e[9],f=e[10],m=e[11],g=e[12],v=e[13],_=e[14],b=e[15],w=i*a-r*o,x=i*l-s*o,S=i*c-n*o,C=r*l-s*a,T=r*c-n*a,M=s*c-n*l,I=h*v-d*g,D=h*_-f*g,P=h*b-m*g,F=d*_-f*v,L=d*b-m*v,N=f*b-m*_;let R=w*N-x*L+S*F+C*P-T*D+M*I;return R?(R=1/R,t[0]=(a*N-l*L+c*F)*R,t[1]=(s*L-r*N-n*F)*R,t[2]=(v*M-_*T+b*C)*R,t[3]=(f*T-d*M-m*C)*R,t[4]=(l*P-o*N-c*D)*R,t[5]=(i*N-s*P+n*D)*R,t[6]=(_*S-g*M-b*x)*R,t[7]=(h*M-f*S+m*x)*R,t[8]=(o*L-a*P+c*I)*R,t[9]=(r*P-i*L-n*I)*R,t[10]=(g*T-v*S+b*w)*R,t[11]=(d*S-h*T-m*w)*R,t[12]=(a*D-o*F-l*I)*R,t[13]=(i*F-r*D+s*I)*R,t[14]=(v*x-g*C-_*w)*R,t[15]=(h*C-d*x+f*w)*R,t):null}function XYe(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=e[9],f=e[10],m=e[11],g=e[12],v=e[13],_=e[14],b=e[15];return t[0]=a*(f*b-m*_)-d*(l*b-c*_)+v*(l*m-c*f),t[1]=-(r*(f*b-m*_)-d*(s*b-n*_)+v*(s*m-n*f)),t[2]=r*(l*b-c*_)-a*(s*b-n*_)+v*(s*c-n*l),t[3]=-(r*(l*m-c*f)-a*(s*m-n*f)+d*(s*c-n*l)),t[4]=-(o*(f*b-m*_)-h*(l*b-c*_)+g*(l*m-c*f)),t[5]=i*(f*b-m*_)-h*(s*b-n*_)+g*(s*m-n*f),t[6]=-(i*(l*b-c*_)-o*(s*b-n*_)+g*(s*c-n*l)),t[7]=i*(l*m-c*f)-o*(s*m-n*f)+h*(s*c-n*l),t[8]=o*(d*b-m*v)-h*(a*b-c*v)+g*(a*m-c*d),t[9]=-(i*(d*b-m*v)-h*(r*b-n*v)+g*(r*m-n*d)),t[10]=i*(a*b-c*v)-o*(r*b-n*v)+g*(r*c-n*a),t[11]=-(i*(a*m-c*d)-o*(r*m-n*d)+h*(r*c-n*a)),t[12]=-(o*(d*_-f*v)-h*(a*_-l*v)+g*(a*f-l*d)),t[13]=i*(d*_-f*v)-h*(r*_-s*v)+g*(r*f-s*d),t[14]=-(i*(a*_-l*v)-o*(r*_-s*v)+g*(r*l-s*a)),t[15]=i*(a*f-l*d)-o*(r*f-s*d)+h*(r*l-s*a),t}function KYe(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],d=t[10],f=t[11],m=t[12],g=t[13],v=t[14],_=t[15];return(e*o-i*n)*(d*_-f*v)-(e*a-r*n)*(h*_-f*g)+(e*l-s*n)*(h*v-d*g)+(i*a-r*o)*(c*_-f*m)-(i*l-s*o)*(c*v-d*m)+(r*l-s*a)*(c*g-h*m)}function Bn(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],f=e[9],m=e[10],g=e[11],v=e[12],_=e[13],b=e[14],w=e[15];let x=i[0],S=i[1],C=i[2],T=i[3];return t[0]=x*r+S*a+C*d+T*v,t[1]=x*s+S*l+C*f+T*_,t[2]=x*n+S*c+C*m+T*b,t[3]=x*o+S*h+C*g+T*w,x=i[4],S=i[5],C=i[6],T=i[7],t[4]=x*r+S*a+C*d+T*v,t[5]=x*s+S*l+C*f+T*_,t[6]=x*n+S*c+C*m+T*b,t[7]=x*o+S*h+C*g+T*w,x=i[8],S=i[9],C=i[10],T=i[11],t[8]=x*r+S*a+C*d+T*v,t[9]=x*s+S*l+C*f+T*_,t[10]=x*n+S*c+C*m+T*b,t[11]=x*o+S*h+C*g+T*w,x=i[12],S=i[13],C=i[14],T=i[15],t[12]=x*r+S*a+C*d+T*v,t[13]=x*s+S*l+C*f+T*_,t[14]=x*n+S*c+C*m+T*b,t[15]=x*o+S*h+C*g+T*w,t}function uh(t,e,i){const r=i[0],s=i[1],n=i[2];if(e===t)t[12]=e[0]*r+e[4]*s+e[8]*n+e[12],t[13]=e[1]*r+e[5]*s+e[9]*n+e[13],t[14]=e[2]*r+e[6]*s+e[10]*n+e[14],t[15]=e[3]*r+e[7]*s+e[11]*n+e[15];else{const o=e[0],a=e[1],l=e[2],c=e[3],h=e[4],d=e[5],f=e[6],m=e[7],g=e[8],v=e[9],_=e[10],b=e[11];t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=h,t[5]=d,t[6]=f,t[7]=m,t[8]=g,t[9]=v,t[10]=_,t[11]=b,t[12]=o*r+h*s+g*n+e[12],t[13]=a*r+d*s+v*n+e[13],t[14]=l*r+f*s+_*n+e[14],t[15]=c*r+m*s+b*n+e[15]}return t}function m$e(t,e,i){const r=i[0],s=i[1],n=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Ku(t,e,i,r){let s=r[0],n=r[1],o=r[2],a=Math.sqrt(s*s+n*n+o*o);if(a<=To())return void _n(t,e);a=1/a,s*=a,n*=a,o*=a;const l=Math.sin(i),c=Math.cos(i),h=1-c,d=e[0],f=e[1],m=e[2],g=e[3],v=e[4],_=e[5],b=e[6],w=e[7],x=e[8],S=e[9],C=e[10],T=e[11],M=s*s*h+c,I=n*s*h+o*l,D=o*s*h-n*l,P=s*n*h-o*l,F=n*n*h+c,L=o*n*h+s*l,N=s*o*h+n*l,R=n*o*h-s*l,k=o*o*h+c;t[0]=d*M+v*I+x*D,t[1]=f*M+_*I+S*D,t[2]=m*M+b*I+C*D,t[3]=g*M+w*I+T*D,t[4]=d*P+v*F+x*L,t[5]=f*P+_*F+S*L,t[6]=m*P+b*F+C*L,t[7]=g*P+w*F+T*L,t[8]=d*N+v*R+x*k,t[9]=f*N+_*R+S*k,t[10]=m*N+b*R+C*k,t[11]=g*N+w*R+T*k,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15])}function K$(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],d=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*s+c*r,t[5]=o*s+h*r,t[6]=a*s+d*r,t[7]=l*s+f*r,t[8]=c*s-n*r,t[9]=h*s-o*r,t[10]=d*s-a*r,t[11]=f*s-l*r,t}function uG(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[0],o=e[1],a=e[2],l=e[3],c=e[8],h=e[9],d=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s-c*r,t[1]=o*s-h*r,t[2]=a*s-d*r,t[3]=l*s-f*r,t[8]=n*r+c*s,t[9]=o*r+h*s,t[10]=a*r+d*s,t[11]=l*r+f*s,t}function Q$(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[0],o=e[1],a=e[2],l=e[3],c=e[4],h=e[5],d=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s+c*r,t[1]=o*s+h*r,t[2]=a*s+d*r,t[3]=l*s+f*r,t[4]=c*s-n*r,t[5]=h*s-o*r,t[6]=d*s-a*r,t[7]=f*s-l*r,t}function xre(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function QYe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Pd(t,e,i){if(e===0)return _f(t);let r=i[0],s=i[1],n=i[2],o=Math.sqrt(r*r+s*s+n*n);if(o<=To())return null;o=1/o,r*=o,s*=o,n*=o;const a=Math.sin(e),l=Math.cos(e),c=1-l;return t[0]=r*r*c+l,t[1]=s*r*c+n*a,t[2]=n*r*c-s*a,t[3]=0,t[4]=r*s*c-n*a,t[5]=s*s*c+l,t[6]=n*s*c+r*a,t[7]=0,t[8]=r*n*c+s*a,t[9]=s*n*c-r*a,t[10]=n*n*c+l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function eJe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function tJe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function g$e(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function y$e(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=r+r,l=s+s,c=n+n,h=r*a,d=r*l,f=r*c,m=s*l,g=s*c,v=n*c,_=o*a,b=o*l,w=o*c;return t[0]=1-(m+v),t[1]=d+w,t[2]=f-b,t[3]=0,t[4]=d-w,t[5]=1-(h+v),t[6]=g+_,t[7]=0,t[8]=f+b,t[9]=g-_,t[10]=1-(h+m),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function iJe(t,e){const i=rJe,r=-e[0],s=-e[1],n=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=r*r+s*s+n*n+o*o;return d>0?(i[0]=2*(a*o+h*r+l*n-c*s)/d,i[1]=2*(l*o+h*s+c*r-a*n)/d,i[2]=2*(c*o+h*n+a*s-l*r)/d):(i[0]=2*(a*o+h*r+l*n-c*s),i[1]=2*(l*o+h*s+c*r-a*n),i[2]=2*(c*o+h*n+a*s-l*r)),y$e(t,e,i),t}const rJe=$();function sJe(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function v$e(t,e){const i=e[0],r=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10];return t[0]=Math.sqrt(i*i+r*r+s*s),t[1]=Math.sqrt(n*n+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+h*h),t}function _$e(t,e){const i=e[0]+e[5]+e[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),t[3]=.25*r,t[0]=(e[6]-e[9])/r,t[1]=(e[8]-e[2])/r,t[2]=(e[1]-e[4])/r):e[0]>e[5]&&e[0]>e[10]?(r=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/r,t[0]=.25*r,t[1]=(e[1]+e[4])/r,t[2]=(e[8]+e[2])/r):e[5]>e[10]?(r=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/r,t[0]=(e[1]+e[4])/r,t[1]=.25*r,t[2]=(e[6]+e[9])/r):(r=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/r,t[0]=(e[8]+e[2])/r,t[1]=(e[6]+e[9])/r,t[2]=.25*r),t}function nJe(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=e[3],l=s+s,c=n+n,h=o+o,d=s*l,f=s*c,m=s*h,g=n*c,v=n*h,_=o*h,b=a*l,w=a*c,x=a*h,S=r[0],C=r[1],T=r[2];return t[0]=(1-(g+_))*S,t[1]=(f+x)*S,t[2]=(m-w)*S,t[3]=0,t[4]=(f-x)*C,t[5]=(1-(d+_))*C,t[6]=(v+b)*C,t[7]=0,t[8]=(m+w)*T,t[9]=(v-b)*T,t[10]=(1-(d+g))*T,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function oJe(t,e,i,r,s){const n=e[0],o=e[1],a=e[2],l=e[3],c=n+n,h=o+o,d=a+a,f=n*c,m=n*h,g=n*d,v=o*h,_=o*d,b=a*d,w=l*c,x=l*h,S=l*d,C=r[0],T=r[1],M=r[2],I=s[0],D=s[1],P=s[2],F=(1-(v+b))*C,L=(m+S)*C,N=(g-x)*C,R=(m-S)*T,k=(1-(f+b))*T,W=(_+w)*T,j=(g+x)*M,B=(_-w)*M,te=(1-(f+v))*M;return t[0]=F,t[1]=L,t[2]=N,t[3]=0,t[4]=R,t[5]=k,t[6]=W,t[7]=0,t[8]=j,t[9]=B,t[10]=te,t[11]=0,t[12]=i[0]+I-(F*I+R*D+j*P),t[13]=i[1]+D-(L*I+k*D+B*P),t[14]=i[2]+P-(N*I+W*D+te*P),t[15]=1,t}function aJe(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=i+i,a=r+r,l=s+s,c=i*o,h=r*o,d=r*a,f=s*o,m=s*a,g=s*l,v=n*o,_=n*a,b=n*l;return t[0]=1-d-g,t[1]=h+b,t[2]=f-_,t[3]=0,t[4]=h-b,t[5]=1-c-g,t[6]=m+v,t[7]=0,t[8]=f+_,t[9]=m-v,t[10]=1-c-d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function b$e(t,e,i,r,s,n,o){const a=1/(i-e),l=1/(s-r),c=1/(n-o);return t[0]=2*n*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*l,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(s+r)*l,t[10]=(o+n)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*n*2*c,t[15]=0,t}function lJe(t,e,i,r,s){const n=1/Math.tan(e/2);let o;return t[0]=n/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(o=1/(r-s),t[10]=(s+r)*o,t[14]=2*s*r*o):(t[10]=-1,t[14]=-2*r),t}function cJe(t,e,i,r){const s=Math.tan(e.upDegrees*Math.PI/180),n=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(s-n)*c*.5,t[10]=r/(i-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*i/(i-r),t[15]=0,t}function w$e(t,e,i,r,s,n,o){const a=1/(e-i),l=1/(r-s),c=1/(n-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(s+r)*l,t[14]=(o+n)*c,t[15]=1,t}function hG(t,e,i,r){const s=e[0],n=e[1],o=e[2];let a=s-i[0],l=n-i[1],c=o-i[2];const h=To();if(Math.abs(a)<h&&Math.abs(l)<h&&Math.abs(c)<h)return void _f(t);let d=1/Math.sqrt(a*a+l*l+c*c);a*=d,l*=d,c*=d;const f=r[0],m=r[1],g=r[2];let v=m*c-g*l,_=g*a-f*c,b=f*l-m*a;d=Math.sqrt(v*v+_*_+b*b),d?(d=1/d,v*=d,_*=d,b*=d):(v=0,_=0,b=0);let w=l*b-c*_,x=c*v-a*b,S=a*_-l*v;d=Math.sqrt(w*w+x*x+S*S),d?(d=1/d,w*=d,x*=d,S*=d):(w=0,x=0,S=0),t[0]=v,t[1]=w,t[2]=a,t[3]=0,t[4]=_,t[5]=x,t[6]=l,t[7]=0,t[8]=b,t[9]=S,t[10]=c,t[11]=0,t[12]=-(v*s+_*n+b*o),t[13]=-(w*s+x*n+S*o),t[14]=-(a*s+l*n+c*o),t[15]=1}function x$e(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=r[0],l=r[1],c=r[2];let h=s-i[0],d=n-i[1],f=o-i[2],m=h*h+d*d+f*f;m>0&&(m=1/Math.sqrt(m),h*=m,d*=m,f*=m);let g=l*f-c*d,v=c*h-a*f,_=a*d-l*h;return m=g*g+v*v+_*_,m>0&&(m=1/Math.sqrt(m),g*=m,v*=m,_*=m),t[0]=g,t[1]=v,t[2]=_,t[3]=0,t[4]=d*_-f*v,t[5]=f*g-h*_,t[6]=h*v-d*g,t[7]=0,t[8]=h,t[9]=d,t[10]=f,t[11]=0,t[12]=s,t[13]=n,t[14]=o,t[15]=1,t}function uJe(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function hJe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function dJe(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t}function S$e(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}function pJe(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t}function fJe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t[9]=e[9]+i[9]*r,t[10]=e[10]+i[10]*r,t[11]=e[11]+i[11]*r,t[12]=e[12]+i[12]*r,t[13]=e[13]+i[13]*r,t[14]=e[14]+i[14]*r,t[15]=e[15]+i[15]*r,t}function T$e(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Sre(t,e){if(t===e)return!0;const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],d=t[9],f=t[10],m=t[11],g=t[12],v=t[13],_=t[14],b=t[15],w=e[0],x=e[1],S=e[2],C=e[3],T=e[4],M=e[5],I=e[6],D=e[7],P=e[8],F=e[9],L=e[10],N=e[11],R=e[12],k=e[13],W=e[14],j=e[15],B=To();return Math.abs(i-w)<=B*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(r-x)<=B*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(s-S)<=B*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(n-C)<=B*Math.max(1,Math.abs(n),Math.abs(C))&&Math.abs(o-T)<=B*Math.max(1,Math.abs(o),Math.abs(T))&&Math.abs(a-M)<=B*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(l-I)<=B*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(c-D)<=B*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(h-P)<=B*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(d-F)<=B*Math.max(1,Math.abs(d),Math.abs(F))&&Math.abs(f-L)<=B*Math.max(1,Math.abs(f),Math.abs(L))&&Math.abs(m-N)<=B*Math.max(1,Math.abs(m),Math.abs(N))&&Math.abs(g-R)<=B*Math.max(1,Math.abs(g),Math.abs(R))&&Math.abs(v-k)<=B*Math.max(1,Math.abs(v),Math.abs(k))&&Math.abs(_-W)<=B*Math.max(1,Math.abs(_),Math.abs(W))&&Math.abs(b-j)<=B*Math.max(1,Math.abs(b),Math.abs(j))}function Tre(t){const e=To(),i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10];return Math.abs(1-(i*i+n*n+l*l))<=e&&Math.abs(1-(r*r+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+h*h))<=e}function dG(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const mJe=Bn,gJe=S$e;Object.freeze(Object.defineProperty({__proto__:null,add:dJe,adjoint:XYe,copy:_n,determinant:KYe,equals:Sre,exactEquals:T$e,frob:hJe,fromQuat:aJe,fromQuat2:iJe,fromRotation:Pd,fromRotationTranslation:y$e,fromRotationTranslationScale:nJe,fromRotationTranslationScaleOrigin:oJe,fromScaling:QYe,fromTranslation:xre,fromXRotation:eJe,fromYRotation:tJe,fromZRotation:g$e,frustum:b$e,getRotation:_$e,getScaling:v$e,getTranslation:sJe,hasIdentityRotation:dG,identity:_f,invert:$l,invertOrIdentity:wre,isOrthoNormal:Tre,lookAt:hG,mul:mJe,multiply:Bn,multiplyScalar:pJe,multiplyScalarAndAdd:fJe,ortho:w$e,perspective:lJe,perspectiveFromFieldOfView:cJe,rotate:Ku,rotateX:K$,rotateY:uG,rotateZ:Q$,scale:m$e,set:yg,str:uJe,sub:gJe,subtract:S$e,targetTo:x$e,translate:uh,transpose:mc},Symbol.toStringTag,{value:"Module"}));const yJe=(t,e)=>{const i=yg(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return mc(i,i)},vJe=(t,e)=>{const i=yg(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return mc(i,i)},_Je=(t,e)=>{const i=1-e,r=yg(t,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return mc(r,r)},bJe=(t,e)=>{const i=Math.sin(e*Math.PI/180),r=Math.cos(e*Math.PI/180),s=yg(t,.213+.787*r-.213*i,.715-.715*r-.715*i,.072-.072*r+.928*i,0,.213-.213*r+.143*i,.715+.285*r+.14*i,.072-.072*r-.283*i,0,.213-.213*r-.787*i,.715-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,1);return mc(s,s)},wJe=(t,e)=>{const i=1-2*e,r=yg(t,i,0,0,e,0,i,0,e,0,0,i,e,0,0,0,1);return mc(r,r)},xJe=(t,e)=>{const i=yg(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return mc(i,i)},SJe=(t,e)=>{const i=1-e,r=yg(t,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return mc(r,r)};let E$e=class C$e{constructor(e,i,r){this.strength=e,this.radius=i,this.threshold=r,this.type="bloom"}interpolate(e,i,r){this.strength=Gc(e.strength,i.strength,r),this.radius=Gc(e.radius,i.radius,r),this.threshold=Gc(e.threshold,i.threshold,r)}clone(){return new C$e(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:tP(this.radius),strength:this.strength,threshold:this.threshold}}},$$e=class A$e{constructor(e){this.radius=e,this.type="blur"}interpolate(e,i,r){this.radius=Math.round(Gc(e.radius,i.radius,r))}clone(){return new A$e(this.radius)}toJSON(){return{type:"blur",radius:tP(this.radius)}}},qZ=class M$e{constructor(e,i){this.type=e,this.amount=i,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.amount=Gc(e.amount,i.amount,r),this._updateMatrix()}clone(){return new M$e(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||cG();switch(this.type){case"brightness":this._colorMatrix=yJe(e,this.amount);break;case"contrast":this._colorMatrix=vJe(e,this.amount);break;case"grayscale":this._colorMatrix=_Je(e,this.amount);break;case"invert":this._colorMatrix=wJe(e,this.amount);break;case"saturate":this._colorMatrix=xJe(e,this.amount);break;case"sepia":this._colorMatrix=SJe(e,this.amount)}}},O$e=class I$e{constructor(e,i,r,s){this.offsetX=e,this.offsetY=i,this.blurRadius=r,this.color=s,this.type="drop-shadow"}interpolate(e,i,r){this.offsetX=Gc(e.offsetX,i.offsetX,r),this.offsetY=Gc(e.offsetY,i.offsetY,r),this.blurRadius=Gc(e.blurRadius,i.blurRadius,r),this.color[0]=Math.round(Gc(e.color[0],i.color[0],r)),this.color[1]=Math.round(Gc(e.color[1],i.color[1],r)),this.color[2]=Math.round(Gc(e.color[2],i.color[2],r)),this.color[3]=Gc(e.color[3],i.color[3],r)}clone(){return new I$e(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:tP(this.offsetX),yoffset:tP(this.offsetY),blurRadius:tP(this.blurRadius),color:e}}},R$e=class P$e{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.angle=Gc(e.angle,i.angle,r),this._updateMatrix()}clone(){return new P$e(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||cG();this._colorMatrix=bJe(e,this.angle)}},D$e=class L$e{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,i,r){this.amount=Gc(e.amount,i.amount,r)}clone(){return new L$e(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function Gc(t,e,i){return t+(e-t)*i}function tP(t){return Math.round(1e3*Rd(t))/1e3}function TJe(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new qZ(t.type,0);case"saturate":case"brightness":case"contrast":return new qZ(t.type,1);case"opacity":return new D$e(1);case"hue-rotate":return new R$e(0);case"blur":return new $$e(0);case"drop-shadow":return new O$e(0,0,0,[..._re("transparent")]);case"bloom":return new E$e(0,0,1)}}function EJe(t,e){const i=t.length>e.length?t:e;return(t.length>e.length?e:t).every((r,s)=>r.type===i[s].type)}function CJe(t,e){const i=t.length>e.length?t:e,r=t.length>e.length?e:t;for(let s=r.length;s<i.length;s++)r.push(TJe(i[s]))}function $Je(t){const e=t[0];return!!e&&"type"in e}function AJe(t,e){return JSON.stringify(t??null)===JSON.stringify(e??null)}function MJe(t){var e;return((e=t.portalItem)==null?void 0:e.type)==="Web Scene"||t.referenceLayers.some(i=>i.type==="scene")}function OJe(t){var e,i;return!!((i=(e=t==null?void 0:t.portalItem)==null?void 0:e.tags)!=null&&i.some(r=>r.toLowerCase()==="beta"))}function r7t(t,e){var i,r,s,n;return!(!((r=(i=t.basemap)==null?void 0:i.referenceLayers)!=null&&r.some(o=>o.uid===e))&&!((n=(s=t.basemap)==null?void 0:s.baseLayers)!=null&&n.some(o=>o.uid===e)))}function IJe(t){let e=null;const i=ZZ(t),r=!(i!=null&&i.baseLayers.length);for(const s in Y$){const n=z$e(i,k$e(Y$[s]),{mustMatchReferences:r});if(n==="equal"){e=s;break}n==="base-layers-equal"&&(e=s)}return e}function RJe(t,e){var i,r;return t===e||((i=t==null?void 0:t.portalItem)==null?void 0:i.id)!=null&&t.portalItem.id===((r=e==null?void 0:e.portalItem)==null?void 0:r.id)?!0:z$e(ZZ(t),ZZ(e),{mustMatchReferences:!0})==="equal"}function WZ(t){return!!(t!=null&&t.baseLayers.concat(t.referenceLayers).some(N$e))}function N$e(t){if(zhe(t.url))return!0;if(t.type==="vector-tile")for(const e in t.sourceNameToSource){const i=t.sourceNameToSource[e];if(zhe(i==null?void 0:i.sourceUrl))return!0}return!1}function F$e(t,e){var n;if(e==null||t==null)return{spatialReference:null,updating:!1};if(e.loadStatus==="not-loaded")return e.load(),{spatialReference:null,updating:!0};if(e.spatialReference)return{spatialReference:e.spatialReference,updating:!1};if(e.baseLayers.length===0)return{spatialReference:null,updating:!1};const i=e.baseLayers.at(0);switch(i.loadStatus){case"not-loaded":i.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}const r=(("supportedSpatialReferences"in i?i.supportedSpatialReferences:null)||["tileInfo"in i?(n=i.tileInfo)==null?void 0:n.spatialReference:i.spatialReference]).filter(Boolean),s=t.spatialReference;return s?{spatialReference:r.find(o=>s.equals(o))??r[0]??null,updating:!1}:{spatialReference:r[0],updating:!1}}const PJe=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function zhe(t){if(!t)return!1;const e=new bb(Jc(t));return!!e.authority&&PJe.test(e.authority)}function ZZ(t){return t?!t.loaded&&t.resourceInfo?k$e(t.resourceInfo.data):{baseLayers:Uhe(t.baseLayers),referenceLayers:Uhe(t.referenceLayers)}:null}function Uhe(t){return(Ce.isCollection(t)?t.toArray():t).map(YZ)}function YZ(t){var e,i;return{type:t.type,effect:"effect"in t?t.effect:void 0,url:B$e("urlTemplate"in t&&t.urlTemplate||t.url||"styleUrl"in t&&t.styleUrl||""),minScale:"minScale"in t&&t.minScale!=null?t.minScale:0,maxScale:"maxScale"in t&&t.maxScale!=null?t.maxScale:0,opacity:t.opacity!=null?t.opacity:1,visible:t.visible==null||!!t.visible,sublayers:t.type!=="map-image"&&t.type!=="wms"||t.sublayers==null||(e=t.sublayers)==null?void 0:e.map(r=>({id:r.id,visible:r.visible})),activeLayerId:t.type==="wmts"?(i=t.activeLayer)==null?void 0:i.id:void 0}}function Bhe(t){return t.isReference||t.layerType==="ArcGISSceneServiceLayer"}function k$e(t){return t?{baseLayers:Vhe((t.baseMapLayers??[]).filter(e=>!Bhe(e))),referenceLayers:Vhe((t.baseMapLayers??[]).filter(e=>Bhe(e)))}:null}function Vhe(t){return t.map(e=>DJe(e))}function DJe(t){let e;switch(t.layerType){case"VectorTileLayer":e="vector-tile";break;case"ArcGISTiledMapServiceLayer":e="tile";break;case"ArcGISSceneServiceLayer":e="scene";break;default:e="unknown"}return{type:e,effect:t.effect,url:B$e(t.templateUrl||t.urlTemplate||t.styleUrl||t.url),minScale:t.minScale??0,maxScale:t.maxScale??0,opacity:t.opacity??1,visible:t.visibility==null||!!t.visibility,sublayers:void 0,activeLayerId:void 0}}function z$e(t,e,i){return t!=null!=(e!=null)?"not-equal":!t||!e?"equal":jhe(t.baseLayers,e.baseLayers)?jhe(t.referenceLayers,e.referenceLayers)?"equal":i.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal"}function jhe(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!U$e(t[i],e[i]))return!1;return!0}function U$e(t,e){if(t.type!==e.type||t.url!==e.url||t.minScale!==e.minScale||t.maxScale!==e.maxScale||t.visible!==e.visible||t.opacity!==e.opacity||!AJe(t.effect,e.effect))return!1;if(t.activeLayerId!=null||e.activeLayerId!=null)return t.activeLayerId===e.activeLayerId;if(t.sublayers!=null||e.sublayers!=null){if(t.sublayers==null||e.sublayers==null||t.sublayers.length!==e.sublayers.length)return!1;for(let i=0;i<t.sublayers.length;i++){const r=t.sublayers.at(i),s=e.sublayers.at(i);if((r==null?void 0:r.id)!==(s==null?void 0:s.id)||(r==null?void 0:r.visible)!==(s==null?void 0:s.visible))return!1}}return!0}function B$e(t){return t?Ed(t).replace(/^\s*https?:/i,"").toLowerCase():""}function LJe(t){if(!t)return null;const{thumbnailUrl:e}=t;if(e)return e;const i=IJe(t);return i?Y$[i].thumbnailUrl:kSe(t.baseLayers,NJe)}function NJe(t){var e;return"portalItem"in t?(e=t.portalItem)==null?void 0:e.thumbnailUrl:void 0}const a8=()=>J.getLogger("esri.support.basemapUtils");function FJe(){return{}}function kJe(t){for(const e in t){const i=t[e];$e(i),delete t[e]}}function pG(t,e){let i;if(typeof t=="string"){const r=t in Y$,s=!r&&t.includes("/");if(!r&&!s){if(Rr.apiKey)a8().warn(`Unable to find basemap definition for: ${t}. See available styles at https://developers.arcgis.com/rest/basemap-styles/`);else{const n=Object.entries(Y$).filter(([o,a])=>a.classic||a.is3d).map(([o])=>`"${o}"`).sort().join(", ");a8().warn(`Unable to find basemap definition for: ${t}. Try one of these: ${n}`)}return null}e&&(i=e[t]),i||(i=r?sv.fromId(t):new sv({style:{id:t}}),e&&(e[t]=i))}else i=Ds(sv,t);return i!=null&&i.destroyed&&(a8().warn("The provided basemap is already destroyed",{basemap:i}),i=null),i}function zJe(t,e=null){const i=pG(t);if(!i)return null;const r=i.clone();return e&&(r.baseLayers=Ghe(r.baseLayers,e.baseLayers),r.referenceLayers=Ghe(r.referenceLayers,e.referenceLayers)),r}function Ghe(t,e){const i=new Ce;return t.forEach(r=>{const s=e.find(n=>n.type!=="scene"&&U$e(YZ(r),YZ(n)))||r;i.includes(s)?i.push(r):i.push(s)}),i}function UJe(t){return new j$({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const i=[];return"tables"in e&&i.push(e.tables),"layers"in e&&i.push(e.layers),i},itemFilterFunction:e=>{const i=e.parent;return!!i&&"tables"in i&&i.tables.includes(e)}})}function l8(t){for(const e of t.values())e==null||e.destroy();t.clear()}const Hhe={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function BJe(t){let e=null;if(typeof t=="string")if(t in Hhe){const i=Hhe[t];e=new x3({resourceInfo:{data:{layers:[i]}}})}else J.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=Ds(x3,t);return e}let V$e=0;const j$e=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+V$e++})}};return e=u([A("esri.core.Identifiable")],e),e},VJe=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:V$e++})}};return e=u([A("esri.core.Identifiable.NumericIdentifiable")],e),e};let iI=class extends j$e(class{}){};iI=u([A("esri.core.Identifiable")],iI),function(t){t.IdentifiableMixin=j$e,t.NumericIdentifiableMixin=VJe}(iI||(iI={}));const XS=iI;async function jJe(t){var r;const e="portalItem"in t?t:{portalItem:t},{fromItem:i}=await G(async()=>{const{fromItem:s}=await import("./portalLayers-DfUM3GYG.js");return{fromItem:s}},__vite__mapDeps([123,121,120,119,122]));try{return await i(e)}catch(s){const n=e==null?void 0:e.portalItem,o=(n==null?void 0:n.id)||"unset",a=((r=n==null?void 0:n.portal)==null?void 0:r.url)||Rr.portalUrl;throw J.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+a+"', id: '"+o+"')",s),s}}const qhe={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8};function c8(t,e,i,r=mf){const s=new au(rre(r)),n=St.fromJSDate(t,{zone:s}),o=i==="decades"||i==="centuries"?"year":H$e(i);return i==="decades"&&(e*=10),i==="centuries"&&(e*=100),n.plus({[o]:e}).toJSDate()}function n7t(t,e,i="milliseconds"){const r=t.getTime(),s=G$e(e,i,"milliseconds");return new Date(r+s)}function Whe(t,e,i=mf){const r=new au(rre(i)),s=St.fromJSDate(t,{zone:r});if(e==="decades"||e==="centuries"){const o=s.startOf("year"),{year:a}=o,l=a-a%(e==="decades"?10:100);return o.set({year:l}).toJSDate()}const n=H$e(e);return s.startOf(n).toJSDate()}function G$e(t,e,i){return t===0?0:t*qhe[e]/qhe[i]}function o7t(t,e){return t&&e?t.intersection(e):t||e}function H$e(t){switch(t){case"milliseconds":return"millisecond";case"seconds":return"second";case"minutes":return"minute";case"hours":return"hour";case"days":return"day";case"weeks":return"week";case"months":return"month";case"years":return"year"}}var Mh;let ju=Mh=class extends ee{static get allTime(){return Zhe}static get empty(){return GJe}static fromArray(t){return new Mh({start:t[0]!=null?new Date(t[0]):t[0],end:t[1]!=null?new Date(t[1]):t[1]})}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=(t==null?void 0:t.getTime())??null}get isAllTime(){return this.equals(Mh.allTime)}get isEmpty(){return this.equals(Mh.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=(t==null?void 0:t.getTime())??null}clone(){return new Mh({end:this.end,start:this.start})}equals(t){var n,o,a,l;if(!t)return!1;const e=((n=this.start)==null?void 0:n.getTime())??this.start,i=((o=this.end)==null?void 0:o.getTime())??this.end,r=((a=t.start)==null?void 0:a.getTime())??t.start,s=((l=t.end)==null?void 0:l.getTime())??t.end;return e===r&&i===s}expandTo(t,e=mf){if(this.isEmpty||this.isAllTime)return this.clone();let i=this.start;i&&(i=Whe(i,t,e));let r=this.end;if(r){const s=Whe(r,t,e);r=r.getTime()===s.getTime()?s:c8(s,1,t,e)}return new Mh({start:i,end:r})}intersection(t){var a,l,c,h;if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return Mh.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=((a=this.start)==null?void 0:a.getTime())??-1/0,i=((l=this.end)==null?void 0:l.getTime())??1/0,r=((c=t.start)==null?void 0:c.getTime())??-1/0,s=((h=t.end)==null?void 0:h.getTime())??1/0;let n,o;return r>=e&&r<=i?n=r:e>=r&&e<=s&&(n=e),i>=r&&i<=s?o=i:s>=e&&s<=i&&(o=s),n==null||o==null||isNaN(n)||isNaN(o)?Mh.empty:new Mh({start:n===-1/0?null:new Date(n),end:o===1/0?null:new Date(o)})}offset(t,e,i=mf){if(this.isEmpty||this.isAllTime)return this.clone();const r=new Mh,{start:s,end:n}=this;return s!=null&&(r.start=c8(s,t,e,i)),n!=null&&(r.end=c8(n,t,e,i)),r}toArray(){var t,e;return this.isEmpty?[void 0,void 0]:[((t=this.start)==null?void 0:t.getTime())??null,((e=this.end)==null?void 0:e.getTime())??null]}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return Zhe.clone();const e=this.start!=null&&t.start!=null?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,i=this.end!=null&&t.end!=null?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new Mh({start:e,end:i})}};u([p({type:Date,json:{write:{allowNull:!0}}})],ju.prototype,"end",void 0),u([ve("end")],ju.prototype,"readEnd",null),u([_e("end")],ju.prototype,"writeEnd",null),u([p({readOnly:!0,json:{read:!1}})],ju.prototype,"isAllTime",null),u([p({readOnly:!0,json:{read:!1}})],ju.prototype,"isEmpty",null),u([p({type:Date,json:{write:{allowNull:!0}}})],ju.prototype,"start",void 0),u([ve("start")],ju.prototype,"readStart",null),u([_e("start")],ju.prototype,"writeStart",null),ju=Mh=u([A("esri.time.TimeExtent")],ju);const Eo=ju,Zhe=new ju,GJe=new ju({start:void 0,end:void 0});let HJe=0,Sn=class extends Ss.EventedMixin(XS.IdentifiableMixin(Il)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new _i(-180,-90,180,90,Oe.WGS84),this.id=Date.now().toString(16)+"-layer-"+HJe++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.persistenceEnabled=!1,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=Oe.WGS84,this.title=null,this.type=null,this.url=null,this.visibilityTimeExtent=null,this.visible=!0}static async fromArcGISServerUrl(e){const i=typeof e=="string"?{url:e}:e;return(await G(async()=>{const{fromUrl:r}=await import("./arcgisLayers-D9LI0BdT.js");return{fromUrl:r}},__vite__mapDeps([124,121,120,122]))).fromUrl(i)}static fromPortalItem(e){return jJe(e)}initialize(){this.when().catch(e=>{es(e)||J.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){const e=this.parent;if(e){const i=this;"layers"in e&&e.layers.includes(i)?e.layers.remove(i):"tables"in e&&e.tables.includes(i)?e.tables.remove(i):"baseLayers"in e&&e.baseLayers.includes(i)?e.baseLayers.remove(i):"referenceLayers"in e&&e.referenceLayers.includes(i)&&e.referenceLayers.remove(i),this._set("parent",null)}}get effectiveVisible(){let e=this.visible;const i=this.parent;return e&&i&&"effectiveVisible"in i&&e&&(e=i.effectiveVisible),e}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return yn(this.url)}createLayerView(e,i){return Promise.reject(new U("layer:create-layer-view","Layer does not support creating a layer view"))}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await Ri(e,{query:{f:"json"},responseType:"json"})).data;throw new U("layer:no-attribution-data","Layer does not have attribution data")}};u([p({type:String})],Sn.prototype,"attributionDataUrl",void 0),u([p({readOnly:!0})],Sn.prototype,"effectiveVisible",null),u([p({type:_i})],Sn.prototype,"fullExtent",void 0),u([p({readOnly:!0})],Sn.prototype,"hasAttributionData",null),u([p({type:String,clonable:!1})],Sn.prototype,"id",void 0),u([p({type:Boolean,nonNullable:!0})],Sn.prototype,"legendEnabled",void 0),u([p({type:["show","hide","hide-children"]})],Sn.prototype,"listMode",void 0),u([p({type:Number,range:{min:0,max:1},nonNullable:!0})],Sn.prototype,"opacity",void 0),u([p({clonable:!1})],Sn.prototype,"parent",void 0),u([p({readOnly:!0})],Sn.prototype,"parsedUrl",null),u([p({type:Boolean,readOnly:!0})],Sn.prototype,"persistenceEnabled",void 0),u([p({type:Boolean})],Sn.prototype,"popupEnabled",void 0),u([p({type:Boolean})],Sn.prototype,"attributionVisible",void 0),u([p({type:Oe})],Sn.prototype,"spatialReference",void 0),u([p({type:String})],Sn.prototype,"title",void 0),u([p({readOnly:!0,json:{read:!1}})],Sn.prototype,"type",void 0),u([p()],Sn.prototype,"url",void 0),u([p({type:Eo})],Sn.prototype,"visibilityTimeExtent",void 0),u([p({type:Boolean,nonNullable:!0})],Sn.prototype,"visible",void 0),Sn=u([A("esri.layers.Layer")],Sn);const fG=Sn;function JZ(t,e,i){let r,s;if(t)for(let n=0,o=t.length;n<o;n++){if(r=t.at(n),(r==null?void 0:r[e])===i)return r;if((r==null?void 0:r.type)==="group"&&(s=JZ(r.layers,e,i),s))return s}}const qJe=t=>{let e=class extends t{constructor(...i){super(...i),this.layers=new Ce;const r=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||J.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.addHandles([this.layers.on("before-add",o=>{if(o.item===this)return o.preventDefault(),void J.getLogger(this).error("#add()","Cannot add layer to itself.");r(o.item)}),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))])}destroy(){const i=this.layers.toArray();for(const r of i)r.destroy();this.layers.destroy()}set layers(i){this._set("layers",vf(i,this._get("layers")))}add(i,r){const s=this.layers;if(r=s.getNextIndex(r),i instanceof fG){const n=i;n.parent===this?this.reorder(n,r):s.add(n,r)}else uu(i)?i.then(n=>{this.destroyed||this.add(n,r)}):J.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(i,r){const s=this.layers;let n=s.getNextIndex(r);i.slice().forEach(o=>{o.parent!==this?(s.add(o,n),n+=1):this.reorder(o,n)})}findLayerById(i){return JZ(this.layers,"id",i)}findLayerByUid(i){return JZ(this.layers,"uid",i)}remove(i){return this.layers.remove(i)}removeMany(i){return this.layers.removeMany(i)}removeAll(){return this.layers.removeAll()}reorder(i,r){return this.layers.reorder(i,r)}layerAdded(i){}layerRemoved(i){}};return u([p()],e.prototype,"layers",null),e=u([A("esri.support.LayersMixin")],e),e},WJe=new Set(["feature","subtype-group"]);function XZ(t,e,i){if(t)for(let r=0,s=t.length;r<s;r++){const n=t.at(r);if(n[e]===i)return n;if((n==null?void 0:n.type)==="group"){const o=XZ(n.tables,e,i);if(o)return o}}}const ZJe=t=>{let e=class extends t{constructor(...i){super(...i),this.tables=new Ce,this.addHandles([this.tables.on("after-add",r=>{const s=r.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,WJe.has(s.type)||J.getLogger(this).error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",r=>{r.item.parent=null})])}destroy(){const i=this.tables.toArray();for(const r of i)r.destroy();this.tables.destroy()}set tables(i){this._set("tables",vf(i,this._get("tables")))}findTableById(i){return XZ(this.tables,"id",i)}findTableByUid(i){return XZ(this.tables,"uid",i)}};return u([p()],e.prototype,"tables",null),e=u([A("esri.support.TablesMixin")],e),e};let dp=class extends ZJe(qJe(Ss.EventedMixin(he))){constructor(e){super(e),this.allLayers=new j$({getCollections:()=>{var i,r,s;return[(i=this.basemap)==null?void 0:i.baseLayers,(r=this.ground)==null?void 0:r.layers,this.layers,(s=this.basemap)==null?void 0:s.referenceLayers]},getChildrenFunction:i=>"layers"in i?i.layers:null}),this.allTables=UJe(this),this.basemap=null,this.editableLayers=new j$({getCollections:()=>[this.allLayers],itemFilterFunction:zYe}),this.ground=new x3,this._basemapCache=FJe()}destroy(){kJe(this._basemapCache),this._basemapCache=null,this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=$e(this.basemap),$e(this.ground),this._set("ground",null)}castBasemap(e){return pG(e,this._basemapCache)}castGround(e){return BJe(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(i=>i.id===e)}findTableById(e){return this.allTables.find(i=>i.id===e)}};u([p({readOnly:!0,dependsOn:[]})],dp.prototype,"allLayers",void 0),u([p({readOnly:!0})],dp.prototype,"allTables",void 0),u([p({type:sv,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],dp.prototype,"basemap",void 0),u([ti("basemap")],dp.prototype,"castBasemap",null),u([p({readOnly:!0})],dp.prototype,"editableLayers",void 0),u([p({type:x3,nonNullable:!0})],dp.prototype,"ground",void 0),u([ti("ground")],dp.prototype,"castGround",null),u([p()],dp.prototype,"undoRedo",void 0),dp=u([A("esri.Map")],dp);const Ere=dp;let iP=class extends Ce{constructor(e){super(e),this.addHandles([this.on("before-add",i=>{i.item==null&&i.preventDefault()}),this.on("after-add",i=>this._own(i.item)),this.on("after-remove",i=>this._release(i.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(Ce.ofType(this.itemType.Type))(e):new Ce(e)}};function KZ(t,e){return{type:t,cast:gre,set(i){const r=vf(i,this._get(e),t);r.owner=this,this._set(e,r)}}}u([p()],iP.prototype,"owner",null),iP=u([A("esri.core.support.OwningCollection")],iP);var rI;const WU=Oo()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),q$e=WU.jsonValues.slice();r3(q$e,"orthometric");const rP=Oo()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let pp=rI=class extends ee{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,i){return WU.write(t,e,i)}readHeightModel(t,e,i){return WU.read(t)||(i!=null&&i.messages&&i.messages.push(YJe(t,{context:i})),null)}readHeightUnit(t,e,i){return rP.read(t)||(i!=null&&i.messages&&i.messages.push(Yhe(t,{context:i})),null)}readHeightUnitService(t,e,i){return Pie(t)||rP.read(t)||(i!=null&&i.messages&&i.messages.push(Yhe(t,{context:i})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new rI({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const i=sEe(e);return new rI({heightModel:t.heightModel,heightUnit:i??void 0,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new rI;return e.read(t,{origin:"web-scene"}),e}};function Yhe(t,e){return new ch("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function YJe(t,e){return new ch("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}u([p({type:WU.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:q$e,default:"ellipsoidal",write:{isRequired:!0}}}}})],pp.prototype,"heightModel",void 0),u([_e("web-scene","heightModel")],pp.prototype,"writeHeightModel",null),u([ve(["web-scene","service"],"heightModel")],pp.prototype,"readHeightModel",null),u([p({type:rP.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:rP.jsonValues,write:{writer:rP.write,isRequired:!0}}}}})],pp.prototype,"heightUnit",void 0),u([ve("web-scene","heightUnit")],pp.prototype,"readHeightUnit",null),u([ve("service","heightUnit")],pp.prototype,"readHeightUnitService",null),u([p({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],pp.prototype,"vertCRS",void 0),u([ve("service","vertCRS",["vertCRS","ellipsoid","geoid"])],pp.prototype,"readVertCRS",null),pp=rI=u([A("esri.geometry.HeightModelInfo")],pp);const rw=pp;let eA=class extends iP{constructor(e){super(e),this.addHandles(this.on("before-add",i=>{i.item!=null&&i.item.parent===this.owner&&(J.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),i.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};eA=u([A("esri.support.AnalysesCollection")],eA);let u8;async function JJe(){return u8==null&&(u8=G(()=>import("./WhereClauseCache-DzuFrL5J.js"),__vite__mapDeps([18,19,20])).then(t=>new t.WhereClauseCache(500,500))),u8}async function Cre(t,e){const i=await JJe(),r=i.get(t,e);if(r==null)throw i.getError(t,e);return r}function XJe(t,e){return t||(t=null),e||(e=null),t==="1=1"?e??t:e==="1=1"?t??e:t&&e?`(${t}) AND (${e})`:t??e}function KJe(t,e){return t||(t=null),e||(e=null),t==="1=1"||e==="1=1"||t===e?t==="1=1"?t:e:t&&e?`(${t}) OR (${e})`:t??e}function h7t(t,e){return e.length===0?null:`${t} IN (${QJe(e)})`}function QJe(t){return t.map(e=>typeof e=="string"?eXe(e):e).join(",")}function eXe(t){return`'${t.replaceAll("'","''")}'`}function I_(t){return typeof t=="number"}function d7t(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t}function p7t(t){return typeof t=="boolean"}function sw(t){return typeof t=="string"||t instanceof String}function W$e(t){return t==null||sw(t)}function f7t(t){return Array.isArray(t)}function tXe(t){return(t==null?void 0:t.declaredClass)==="esri.Graphic"}function m7t(t){return(t==null?void 0:t.declaredClass)==="esri.rest.support.Query"}function g7t(t){return t instanceof Date}const iXe="HH:mm",rXe="HH:mm:ss",sXe="HH:mm:ss.SSS",nXe=[sXe,rXe,iXe,"TT"],oXe="yyyy-MM-dd";function Jhe(t){if(!t||!sw(t))return null;const e=St.fromFormat(t,oXe);return e.isValid?e:null}function Xhe(t){return t&&sw(t)?kSe(nXe,e=>{const i=St.fromFormat(t,e);return i.isValid?i:null})??null:null}function Khe(t){if(!t||!sw(t))return null;const e=St.fromISO(t);return e.isValid?e:null}var ZU;(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(ZU||(ZU={}));const Z$e=new Set(["integer","small-integer","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]);function aXe(t){return t!=null&&Z$e.has(t.type)}function Y$e(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function J$e(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function X$e(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}const lXe=new Set(["single","double","esriFieldTypeSingle","esriFieldTypeDouble"]);cie(Z$e,lXe);function cXe(t,e){const i=t==null?void 0:t.domain;if(!i||i.type!=="range")return;const r="range"in i?i.range[0]:i.minValue,s="range"in i?i.range[1]:i.maxValue,n=aXe(t);return Y$e(t)||X$e(t)||J$e(t)?{...uXe(t,s,r),isInteger:n}:{min:r!=null&&typeof r=="number"?r:null,max:s!=null&&typeof s=="number"?s:null,rawMin:r,rawMax:s,isInteger:n}}function uXe(t,e,i){var r,s,n,o,a,l;return Y$e(t)?{min:(r=Jhe(i))==null?void 0:r.toMillis(),max:(s=Jhe(e))==null?void 0:s.toMillis(),rawMin:i,rawMax:e}:X$e(t)?{min:(n=Xhe(i))==null?void 0:n.toMillis(),max:(o=Xhe(e))==null?void 0:o.toMillis(),rawMin:i,rawMax:e}:J$e(t)?{min:(a=Khe(i))==null?void 0:a.toMillis(),max:(l=Khe(e))==null?void 0:l.toMillis(),rawMin:i,rawMax:e}:{max:null,min:null}}function K$e(t){if(!t)return;const e=t.match(hXe);return e!=null&&e.groups?e.groups.doubleQuoted??e.groups.singleQuoted??e.groups.dotNotation:void 0}const hXe=/^(\$feature\[(?:"(?<doubleQuoted>[^"]+)"|'(?<singleQuoted>[^']+)')\]|\$feature\.(?<dotNotation>[a-zA-Z_][a-zA-Z0-9_]*))$/i;function dXe(t){var e,i;return((i=(e=t.match(pXe))==null?void 0:e[1])==null?void 0:i.replace(/\\'/g,"'"))??null}const pXe=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;let jp=class{};function fXe(t){return t instanceof YS?t===jp.instance:(t==null?void 0:t.toString().toLowerCase())==="unknown"}function v7t(t){return fXe(t)?jp.instance:t}jp.instance=new au("Etc/UTC");var YU;(function(t){t.TimeZoneNotRecognized="TimeZoneNotRecognized"})(YU||(YU={}));const mXe={[YU.TimeZoneNotRecognized]:"Timezone identifier has not been recognized."};let gXe=class Q$e extends Error{constructor(e,i){super(PD(mXe[e],i)),this.declaredRootClass="esri.arcade.arcadedate.dateerror",Error.captureStackTrace&&Error.captureStackTrace(this,Q$e)}};function AT(t,e,i){return t<e?t-e:t>i?t-i:0}function MT(t,e,i){return t<e?e:t>i?i:t}let ON=class Wn{constructor(e){this._date=e,this.declaredRootClass="esri.arcade.arcadedate"}static fromParts(e=0,i=1,r=1,s=0,n=0,o=0,a=0,l){if(isNaN(e)||isNaN(i)||isNaN(r)||isNaN(s)||isNaN(n)||isNaN(o)||isNaN(a))return null;const c=St.local(e,i).daysInMonth;let h=St.fromObject({day:MT(r,1,c),year:e,month:MT(i,1,12),hour:MT(s,0,23),minute:MT(n,0,59),second:MT(o,0,59),millisecond:MT(a,0,999)},{zone:Tw(l)});return h=h.plus({months:AT(i,1,12),days:AT(r,1,c),hours:AT(s,0,23),minutes:AT(n,0,59),seconds:AT(o,0,59),milliseconds:AT(a,0,999)}),new Wn(h)}static get systemTimeZoneCanonicalName(){return Intl.DateTimeFormat().resolvedOptions().timeZone??"system"}static arcadeDateAndZoneToArcadeDate(e,i){const r=Tw(i);return e.isUnknownTimeZone||r===jp.instance?Wn.fromParts(e.year,e.monthJS+1,e.day,e.hour,e.minute,e.second,e.millisecond,r):new Wn(e._date.setZone(r))}static dateJSToArcadeDate(e){return new Wn(St.fromJSDate(e,{zone:"system"}))}static dateJSAndZoneToArcadeDate(e,i="system"){const r=Tw(i);return new Wn(St.fromJSDate(e,{zone:r}))}static unknownEpochToArcadeDate(e){return new Wn(St.fromMillis(e,{zone:jp.instance}))}static unknownDateJSToArcadeDate(e){return new Wn(St.fromMillis(e.getTime(),{zone:jp.instance}))}static epochToArcadeDate(e,i="system"){const r=Tw(i);return new Wn(St.fromMillis(e,{zone:r}))}static dateTimeToArcadeDate(e){return new Wn(e)}clone(){return new Wn(this._date)}changeTimeZone(e){const i=Tw(e);return Wn.dateTimeToArcadeDate(this._date.setZone(i))}static dateTimeAndZoneToArcadeDate(e,i){const r=Tw(i);return e.zone===jp.instance||r===jp.instance?Wn.fromParts(e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond,r):new Wn(e.setZone(r))}static nowToArcadeDate(e){const i=Tw(e);return new Wn(St.fromJSDate(new Date,{zone:i}))}static nowUTCToArcadeDate(){return new Wn(St.utc())}get isSystem(){return this.timeZone==="system"||this.timeZone===Wn.systemTimeZoneCanonicalName}equals(e){return this.isSystem&&e.isSystem?this.toNumber()===e.toNumber():this.isUnknownTimeZone===e.isUnknownTimeZone&&this._date.equals(e._date)}get isUnknownTimeZone(){return this._date.zone===jp.instance}get isValid(){return this._date.isValid}get hour(){return this._date.hour}get second(){return this._date.second}get day(){return this._date.day}get dayOfWeekISO(){return this._date.weekday}get dayOfWeekJS(){let e=this._date.weekday;return e>6&&(e=0),e}get millisecond(){return this._date.millisecond}get monthISO(){return this._date.month}get weekISO(){return this._date.weekNumber}get yearISO(){return this._date.weekYear}get monthJS(){return this._date.month-1}get year(){return this._date.year}get minute(){return this._date.minute}get zone(){return this._date.zone}get timeZoneOffset(){return this.isUnknownTimeZone?0:this._date.offset}get timeZone(){if(this.isUnknownTimeZone)return"unknown";if(this._date.zone.type==="system")return"system";const e=this.zone;return e.type==="fixed"?e.fixed===0?"UTC":e.formatOffset(0,"short"):e.name}stringify(){return JSON.stringify(this.toJSDate())}plus(e){return new Wn(this._date.plus(e))}diff(e,i="milliseconds"){return this._date.diff(e._date,i)[i]}toISODate(){return this._date.toISODate()}toISOString(e){return e?this._date.toISO({suppressMilliseconds:!0,includeOffset:!this.isUnknownTimeZone}):this._date.toISO({includeOffset:!this.isUnknownTimeZone})}toISOTime(e,i){return this._date.toISOTime({suppressMilliseconds:e,includeOffset:i&&!this.isUnknownTimeZone})}toFormat(e,i){return this.isUnknownTimeZone&&(e=e.replaceAll("Z","")),this._date.toFormat(e,i)}toJSDate(){return this._date.toJSDate()}toSQLValue(){return this._date.toFormat("yyyy-LL-dd HH:mm:ss")}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}toDateTime(){return this._date}toNumber(){return this._date.toMillis()}getTime(){return this._date.toMillis()}toUTC(){return new Wn(this._date.toUTC())}toLocal(){return new Wn(this._date.toLocal())}toString(){return this.toISOString(!0)}static fromReaderAsTimeStampOffset(e){if(!e)return null;const i=St.fromISO(e,{setZone:!0});return new Wn(i)}};function Tw(t,e=!0){if(t instanceof YS)return t;if(t.toLowerCase()==="system")return"system";if(t.toLowerCase()==="utc")return"UTC";if(t.toLowerCase()==="unknown")return jp.instance;if(/^[+-]?[0-9]{1,2}([:][0-9]{2})?$/.test(t)){const r=xa.parseSpecifier("UTC"+(t.startsWith("+")||t.startsWith("-")?"":"+")+t);if(r)return r}const i=au.create(t);if(!i.isValid){if(e)throw new gXe(YU.TimeZoneNotRecognized);return null}return i}const yXe=()=>J.getLogger("esri.support.arcadeOnDemand"),vXe=["geometry","scale","timeProperties"];function _7t(t,e){if(e!=null)for(const i of vXe)e.hasArcadeDependency(i)&&t.add(i);return t}let h8;function bv(){return h8||(h8=(async()=>{const t=await G(()=>import("./arcadeUtils-Blultffq.js"),__vite__mapDeps([125,126,127,128,110,20,28,19,129]));return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature,Voxel:t.Voxel}})()),h8}const _Xe=(t,e,i)=>$re.create(t,e,i,null,["$feature","$view"],[]),b7t=(t,e,i)=>$re.create(t,e,i,null,["$feature","$view"],[]),bXe=(t,e,i,r)=>$re.create(t,e,i,r,["$feature","$view"],[]);let $re=class eAe{constructor(e,i,r,s,n,o,a){this._dependencies=new Map,this.services=null,this.script=e,this.evaluate=s;const l=Array.isArray(o)?o:o==null?void 0:o.fields;this.fields=l??[],this._syntaxTree=r,this._arcade=i,this._arcadeFeature=n,this._spatialReference=a,this._dependencies.set("geometry",i.scriptTouchesGeometry(this._syntaxTree)),this._dependencies.set("scale",this._arcade.referencesMember(this._syntaxTree,"scale")),this._dependencies.set("timeProperties",this._arcade.scriptUsesViewProperties(this._syntaxTree,["timeProperties"]))}static async create(e,i,r,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await bv(),h=i instanceof Oe?i:Oe.fromJSON(i);let d;try{d=a.parseScript(e,o)}catch(I){return yXe().error(new U("arcade-bad-expression","Failed to parse arcade script",{script:e,error:I})),null}const f=n.reduce((I,D)=>({...I,[D]:null}),{});let m=null;s!=null&&(m=new c(s),m.immutable=!0,f.$config=null);const g=a.scriptUsesGeometryEngine(d),v=g&&a.enableGeometrySupport(),_=a.scriptUsesFeatureSet(d)&&a.enableFeatureSetSupport(),b=a.scriptIsAsync(d),w=b&&a.enableAsyncSupport(),x={vars:f,spatialReference:h,useAsync:!!w};await Promise.all([v,_,w]);const S=new Set;await a.loadDependentModules(S,d,null,b,g);const C=new c;C.immutable=!1,C.setField("scale",0);const T=a.compileScript(d,x),M=(I,D)=>{var F;const P=(F=I.$view)==null?void 0:F.timeZone;if("$view"in I&&I.$view){let L;if(C.setField("scale",typeof I.$view=="object"&&"scale"in I.$view?I.$view.scale:void 0),typeof I.$view=="object"&&"timeProperties"in I.$view&&I.$view.timeProperties!=null){const{currentStart:N,currentEnd:R}=I.$view.timeProperties;L=new c({currentStart:N!=null?P!=null?ON.epochToArcadeDate(N,P):ON.unknownEpochToArcadeDate(N):void 0,currentEnd:R!=null?P!=null?ON.epochToArcadeDate(R,P):ON.unknownEpochToArcadeDate(R):void 0,startIncluded:!0,endIncluded:!0})}C.setField("timeProperties",L),I.$view=C}return m&&(I.$config=m),T({vars:I,spatialReference:h,services:D,timeZone:P})};return new eAe(e,a,d,M,new l,r,h)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}references(e){return this._dependencies.get(e)??!1}};const wXe=/^([0-9_])/,xXe=/[^a-z0-9_\u0080-\uffff]+/gi;function SXe(t){return t==null?null:t.trim().replaceAll(xXe,"_").replace(wXe,"F$1")||null}const TXe=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],EXe=["field","normalizationField"];function Qhe(t,e){if(t!=null&&e!=null){for(const i of Array.isArray(t)?t:[t])if(ede(TXe,i,e),"visualVariables"in i&&i.visualVariables)for(const r of i.visualVariables)ede(EXe,r,e)}}function ede(t,e,i){if(t)for(const r of t){const s=Pj(r,e),n=s&&typeof s!="function"&&i.get(s);n&&ro(r,n.name,e)}}function tAe(t,e){var i;if(t!=null&&((i=e==null?void 0:e.fields)!=null&&i.length))if("startField"in t){const r=e.get(t.startField),s=e.get(t.endField);t.startField=(r==null?void 0:r.name)??null,t.endField=(s==null?void 0:s.name)??null}else{const r=e.get(t.startTimeField),s=e.get(t.endTimeField);t.startTimeField=(r==null?void 0:r.name)??null,t.endTimeField=(s==null?void 0:s.name)??null}}const d8=new Set;function mG(t,e){return t&&e?(d8.clear(),SS(d8,t,e),Array.from(d8).sort()):[]}function SS(t,e,i){var r;if(i)if((r=e==null?void 0:e.fields)!=null&&r.length)if(i.includes("*"))for(const{name:s}of e.fields)t.add(s);else for(const s of i)dc(t,e,s);else{if(i.includes("*"))return t.clear(),void t.add("*");for(const s of i)s!=null&&t.add(s)}}function dc(t,e,i){if(typeof i=="string")if(e){const r=e.get(i);r&&t.add(r.name)}else t.add(i)}function w7t(t,e){return e==null||t==null?[]:e.includes("*")?(t.fields??[]).map(i=>i.name):e}function x7t(t,e,i=1){if(!e||!t)return[];if(e.includes("*"))return["*"];const r=mG(t,e);return r.length/t.fields.length>=i?["*"]:r}async function Rl(t,e,i){var n;if(!i)return;let r;const s=K$e(i);if(s)r=[s];else{const{arcadeUtils:o}=await bv();r=o.extractFieldNames(i,(n=e==null?void 0:e.fields)==null?void 0:n.map(a=>a.name))}for(const o of r)dc(t,e,o)}async function Are(t,e,i){if(i&&i!=="1=1"){const r=await Cre(i,e);if(!r.isStandardized)throw new U("fieldUtils:collectFilterFields","Where clause is not standardized",{where:i});SS(t,e,r.fieldNames)}}function CXe({displayField:t,fields:e}){return t||(e!=null&&e.length?p8(e,"name-or-title")||p8(e,"unique-identifier")||p8(e,"type-or-category")||$Xe(e):null)}function $Xe(t){for(const e of t){if(!(e!=null&&e.name))continue;const i=e.name.toLowerCase();if(i.includes("name")||i.includes("title"))return e.name}return null}function p8(t,e){for(const i of t)if(i!=null&&i.valueType&&i.valueType===e)return i.name;return null}async function S7t(t,e){var r;if(!e)return;const i=(r=e.elevationInfo)==null?void 0:r.featureExpressionInfo;return i?i.collectRequiredFields(t,e.fieldsIndex):void 0}function AXe(t,e,i){i.onStatisticExpression?Rl(t,e,i.onStatisticExpression.expression):t.add(i.onStatisticField)}async function T7t(t,e,i){if(!e||!i||!("fields"in i))return;const r=[],s=i.popupTemplate;r.push(iAe(t,e,s)),i.fields&&r.push(...i.fields.map(async n=>AXe(t,e.fieldsIndex,n))),await Promise.all(r)}async function E7t(t,e){var n,o,a;const{fieldsIndex:i,trackInfo:r}=e;if(!e||!r||!i)return;const s=[(n=r.latestObservations.renderer)==null?void 0:n.collectRequiredFields(t,i),(o=r.previousObservations.renderer)==null?void 0:o.collectRequiredFields(t,i),(a=r.trackLines.renderer)==null?void 0:a.collectRequiredFields(t,i)];r.popupTemplate&&s.push(iAe(t,e,r.popupTemplate));for(const l of[r.latestObservations.labelingInfo,r.previousObservations.labelingInfo,r.trackLines.labelingInfo])if(l)for(const c of l)s.push(nAe(t,i,c));await Promise.all(s)}async function iAe(t,e,i){const r=[];i!=null&&i.expressionInfos&&r.push(...i.expressionInfos.map(n=>Rl(t,e.fieldsIndex,n.expression)));const s=i==null?void 0:i.content;if(Array.isArray(s))for(const n of s)n.type==="expression"&&n.expressionInfo&&r.push(Rl(t,e.fieldsIndex,n.expressionInfo.expression));await Promise.all(r)}async function C7t(t,e,i){e&&(e.timeInfo&&(i!=null&&i.timeExtent)&&SS(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&SS(t,e.fieldsIndex,[e.floorInfo.floorField]),(i==null?void 0:i.where)!=null&&await Are(t,e.fieldsIndex,i.where))}async function $7t(t,e,i){e&&i&&await Promise.all(i.map(r=>MXe(t,e,r)))}async function MXe(t,e,i){e&&i&&(i.valueExpression?await Rl(t,e.fieldsIndex,i.valueExpression):i.field&&dc(t,e.fieldsIndex,i.field))}function A7t(t){return t?mG(t.fieldsIndex,rAe(t)):[]}function OXe(t){if(!t)return[];const e=t.geometryFieldsInfo;return e?mG(t.fieldsIndex,[e.shapeAreaField,e.shapeLengthField]):[]}async function M7t(t,e,i){if(!e||!i)return;const r=e.fieldsIndex;await Promise.all(i.filters.map(s=>Are(t,r,s.where)))}const IXe=new Set(["oid","global-id","guid"]),RXe=new Set(["oid","global-id"]),PXe=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^shape$/i,/^shape_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/perimeter/i,/objectid/i,/_i$/i];function DXe(t){const e=new Set;sAe(t).forEach(r=>e.add(r)),OXe(t).forEach(r=>e.add(r.toLowerCase()));const i=t&&"infoFor3D"in t?t.infoFor3D:void 0;return i&&(Object.values(i.assetMapFieldRoles).forEach(r=>e.add(r.toLowerCase())),Object.values(i.transformFieldRoles).forEach(r=>e.add(r.toLowerCase()))),Array.from(e)}function rAe(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;if(!e)return[];const{creationDateField:i,creatorField:r,editDateField:s,editorField:n}=e;return[i,r,s,n].filter(Boolean)}function sAe(t){return rAe(t).map(e=>e.toLowerCase())}function LXe(t,e){var i;return t.editable&&!IXe.has(t.type)&&!sAe(e).includes(((i=t.name)==null?void 0:i.toLowerCase())??"")}function NXe(t,e){var r;const i=((r=t.name)==null?void 0:r.toLowerCase())??"";return!((e==null?void 0:e.objectIdField)!=null&&i===e.objectIdField.toLowerCase()||(e==null?void 0:e.globalIdField)!=null&&i===e.globalIdField.toLowerCase()||DXe(e).includes(i)||RXe.has(t.type)||PXe.some(s=>s.test(i)))}async function O7t(t,e){const{labelingInfo:i,fieldsIndex:r}=e;i!=null&&i.length&&await Promise.all(i.map(s=>nAe(t,r,s)))}async function nAe(t,e,i){if(!i)return;const r=i.getLabelExpression(),s=i.where;if(r.type==="arcade")await Rl(t,e,r.expression);else{const n=r.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{dc(t,e,o.slice(1,-1))})}await Are(t,e,s)}function FXe(t){const e=t.defaultValue;return e!==void 0&&aAe(t,e)?e:t.nullable?null:void 0}function I7t(t){const e=typeof t=="string"?{type:t}:t;return Mre(e)?255:e.type==="esriFieldTypeDate"||e.type==="date"?8:void 0}function oAe(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function kXe(t){return t===null||oAe(t)}function zXe(t){return t===null||Number.isInteger(t)}function UXe(){return!0}function aAe(t,e){let i;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"big-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":case"esriFieldTypeBigInteger":i=t.nullable?zXe:Number.isInteger;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=t.nullable?kXe:oAe;break;case"string":case"esriFieldTypeString":i=t.nullable?W$e:sw;break;default:i=UXe}return arguments.length===1?i:i(e)}const BXe=["integer","small-integer","big-integer"],VXe=["single","double"],jXe=["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"],GXe=["esriFieldTypeSingle","esriFieldTypeDouble"],lAe=new Set([...BXe,...jXe]),HXe=new Set([...VXe,...GXe]),qXe=cie(lAe,HXe);function cAe(t){return t!=null&&lAe.has(t.type)}function gG(t){return t!=null&&qXe.has(t.type)}function Mre(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}function uAe(t){return t!=null&&(t.type==="date"||t.type==="esriFieldTypeDate")}function R7t(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function P7t(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function WXe(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function tde(t){return t!=null&&(t.type==="oid"||t.type==="esriFieldTypeOID")}function ide(t){return t!=null&&(t.type==="global-id"||t.type==="esriFieldTypeGlobalID")}function D7t(t,e){return ZXe(t,e)===null}var JU,XU;function L7t(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function ZXe(t,e){return t==null||t.nullable&&e===null?null:aAe(t,e)?gG(t)&&!YXe(t.type,Number(e))?JU.OUT_OF_RANGE:null:XU.INVALID_TYPE}function YXe(t,e){const i=typeof t=="string"?hAe(t):t;if(!i)return!1;const r=i.min,s=i.max;return i.isInteger?Number.isInteger(e)&&e>=r&&e<=s:e>=r&&e<=s}function hAe(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return JXe;case"esriFieldTypeInteger":case"integer":return XXe;case"esriFieldTypeBigInteger":case"big-integer":return KXe;case"esriFieldTypeSingle":case"single":return QXe;case"esriFieldTypeDouble":case"double":return eKe}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(JU||(JU={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(XU||(XU={}));const JXe={min:-32768,max:32767,isInteger:!0,rawMin:-32768,rawMax:32767},XXe={min:-2147483648,max:2147483647,isInteger:!0,rawMin:-2147483648,rawMax:2147483647},KXe={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0,rawMin:-Number.MAX_SAFE_INTEGER,rawMax:Number.MAX_SAFE_INTEGER},QXe={min:-34e37,max:12e37,isInteger:!1,rawMin:-34e37,rawMax:12e37},eKe={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1,rawMin:-Number.MAX_VALUE,rawMax:Number.MAX_VALUE};function N7t(t,e,i){switch(t){case ZU.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case ZU.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case XU.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case JU.OUT_OF_RANGE:{const{min:r,max:s}=hAe(e.type);return`Value ${i} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${r} to ${s}`}}}function tKe(t,e){return!iKe(t,e,null)}function iKe(t,e,i){if(!(e!=null&&e.attributes)||!t){if(i!=null)for(const n of t??[])i.add(n);return!0}const r=new Set(Object.keys(e.attributes));let s=!1;for(const n of t)if(!r.has(n)){if(s=!0,i==null)break;i.add(n)}return s}function rKe(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}async function F7t(t,e){const i=new Set;return t!=null&&t.collectRequiredFields&&await t.collectRequiredFields(i,e),Array.from(i).sort()}function Ore(t){const e=t==null?void 0:t.match(/{[^}]+}/g);return e?e.map(i=>i.slice(1,-1).split(":")[0].trim()):[]}let k4=class extends ee{constructor(e){super(e),this.type=null}};u([p({type:["attachments","custom","fields","media","text","expression","relationship","utility-network-associations"],readOnly:!0,json:{read:!1,write:!0}})],k4.prototype,"type",void 0),k4=u([A("esri.popup.content.Content")],k4);const Bv=k4,IN=new ni({asc:"ascending",desc:"descending"});let sI=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.field=null,this.order="ascending"}};u([p({type:String,json:{write:!0}})],sI.prototype,"field",void 0),u([p({type:IN.apiValues,json:{type:IN.jsonValues,read:IN.read,write:IN.write}})],sI.prototype,"order",void 0),sI=u([A("esri.popup.support.AttachmentsOrderByInfo")],sI);const sKe=sI;let V0=class extends Nt.ClonableMixin(Bv){constructor(e){super(e),this.description=null,this.displayType="auto",this.orderByFields=null,this.title=null,this.type="attachments"}};u([p({type:String,json:{write:!0}})],V0.prototype,"description",void 0),u([p({type:["auto","preview","list"],json:{write:!0}})],V0.prototype,"displayType",void 0),u([p({type:[sKe],json:{write:!0}})],V0.prototype,"orderByFields",void 0),u([p({type:String,json:{write:!0}})],V0.prototype,"title",void 0),u([p({type:["attachments"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],V0.prototype,"type",void 0),V0=u([A("esri.popup.content.AttachmentsContent")],V0);const tA=V0;var QZ;let u1=QZ=class extends Bv{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new QZ({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?q(this.outFields):null})}};u([p()],u1.prototype,"creator",void 0),u([p()],u1.prototype,"destroyer",void 0),u([p()],u1.prototype,"outFields",void 0),u([p({type:["custom"],readOnly:!0})],u1.prototype,"type",void 0),u1=QZ=u([A("esri.popup.content.CustomContent")],u1);const nKe=u1;var eY;let NE=eY=class extends ee{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new eY({title:this.title,expression:this.expression})}};u([p({type:String,json:{write:!0}})],NE.prototype,"title",void 0),u([p({type:String,json:{write:!0}})],NE.prototype,"expression",void 0),u([p({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],NE.prototype,"returnType",void 0),NE=eY=u([A("esri.popup.ElementExpressionInfo")],NE);const oKe=NE;var tY;let nI=tY=class extends Bv{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){var t;return new tY({expressionInfo:(t=this.expressionInfo)==null?void 0:t.clone()})}};u([p({type:oKe,json:{write:!0}})],nI.prototype,"expressionInfo",void 0),u([p({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],nI.prototype,"type",void 0),nI=tY=u([A("esri.popup.content.ExpressionContent")],nI);const yG=nI;let FE=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};u([Ve(I7e)],FE.prototype,"dateFormat",void 0),u([p({type:Boolean,json:{write:!0}})],FE.prototype,"digitSeparator",void 0),u([p({type:Ii,json:{write:!0}})],FE.prototype,"places",void 0),FE=u([A("esri.popup.support.FieldInfoFormat")],FE);const z4=FE;var iY;let fp=iY=class extends ee{constructor(t){super(t),this.fieldName=null,this.format=void 0,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){var t;return new iY({fieldName:this.fieldName,format:(t=this.format)==null?void 0:t.clone(),isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};u([p({type:String,json:{write:!0}})],fp.prototype,"fieldName",void 0),u([p({type:z4,json:{write:!0}})],fp.prototype,"format",void 0),u([p({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],fp.prototype,"isEditable",void 0),u([p({type:String,json:{write:!0}})],fp.prototype,"label",void 0),u([Ve(new ni({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],fp.prototype,"stringFieldOption",void 0),u([p({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],fp.prototype,"statisticType",void 0),u([p({type:String,json:{write:!0}})],fp.prototype,"tooltip",void 0),u([p({type:Boolean,json:{write:!0}})],fp.prototype,"visible",void 0),fp=iY=u([A("esri.popup.FieldInfo")],fp);const Ire=fp;var rY;let Qg=rY=class extends Bv{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(i=>i.toJSON())}clone(){return new rY(q({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};u([p({type:Object,json:{write:!0}})],Qg.prototype,"attributes",void 0),u([p({type:String,json:{write:!0}})],Qg.prototype,"description",void 0),u([p({type:[Ire]})],Qg.prototype,"fieldInfos",void 0),u([_e("fieldInfos")],Qg.prototype,"writeFieldInfos",null),u([p({type:String,json:{write:!0}})],Qg.prototype,"title",void 0),u([p({type:["fields"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],Qg.prototype,"type",void 0),Qg=rY=u([A("esri.popup.content.FieldsContent")],Qg);const iA=Qg;let h1=class extends ee{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};u([p({type:String,json:{write:!0}})],h1.prototype,"altText",void 0),u([p({type:String,json:{write:!0}})],h1.prototype,"caption",void 0),u([p({type:String,json:{write:!0}})],h1.prototype,"title",void 0),u([p({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],h1.prototype,"type",void 0),h1=u([A("esri.popup.content.mixins.MediaInfo")],h1);const Rre=h1;var sY;let d1=sY=class extends he{constructor(t){super(t),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){var t;return new sY({color:(t=this.color)==null?void 0:t.clone(),fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};u([p()],d1.prototype,"color",void 0),u([p()],d1.prototype,"fieldName",void 0),u([p()],d1.prototype,"tooltip",void 0),u([p()],d1.prototype,"value",void 0),d1=sY=u([A("esri.popup.content.support.ChartMediaInfoValueSeries")],d1);const aKe=d1;var nY;let j0=nY=class extends ee{constructor(t){super(t),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new nY({colors:q(this.colors),fields:q(this.fields),normalizeField:this.normalizeField,series:q(this.series),tooltipField:this.tooltipField})}};u([p({type:[Je],json:{type:[[Ii]],write:!0}})],j0.prototype,"colors",void 0),u([p({type:[String],json:{write:{isRequired:!0}}})],j0.prototype,"fields",void 0),u([p({type:String,json:{write:!0}})],j0.prototype,"normalizeField",void 0),u([p({type:[aKe],json:{read:!1}})],j0.prototype,"series",void 0),u([p({type:String,json:{write:!0}})],j0.prototype,"tooltipField",void 0),j0=nY=u([A("esri.popup.content.support.ChartMediaInfoValue")],j0);const lKe=j0;let oI=class extends Rre{constructor(e){super(e),this.type=null,this.value=void 0}};u([p({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],oI.prototype,"type",void 0),u([p({type:lKe,json:{write:{isRequired:!0}}})],oI.prototype,"value",void 0),oI=u([A("esri.popup.content.mixins.ChartMediaInfo")],oI);const vG=oI,_G=Oo()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var oY;let U4=oY=class extends vG{constructor(t){super(t),this.type="bar-chart"}clone(){var t;return new oY({altText:this.altText,title:this.title,caption:this.caption,value:(t=this.value)==null?void 0:t.clone()})}};u([p({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:{writer:_G.write,isRequired:!0}}})],U4.prototype,"type",void 0),U4=oY=u([A("esri.popup.content.BarChartMediaInfo")],U4);const dAe=U4;var aY;let B4=aY=class extends vG{constructor(t){super(t),this.type="column-chart"}clone(){var t;return new aY({altText:this.altText,title:this.title,caption:this.caption,value:(t=this.value)==null?void 0:t.clone()})}};u([p({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:{writer:_G.write,isRequired:!0}}})],B4.prototype,"type",void 0),B4=aY=u([A("esri.popup.content.ColumnChartMediaInfo")],B4);const pAe=B4;var lY;let aI=lY=class extends ee{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new lY({linkURL:this.linkURL,sourceURL:this.sourceURL})}};u([p({type:String,json:{write:!0}})],aI.prototype,"linkURL",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],aI.prototype,"sourceURL",void 0),aI=lY=u([A("esri.popup.content.support.ImageMediaInfoValue")],aI);const cKe=aI;var cY;let kE=cY=class extends Rre{constructor(t){super(t),this.refreshInterval=0,this.type="image",this.value=void 0}clone(){var t;return new cY({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:(t=this.value)==null?void 0:t.clone()})}};u([p({type:Number,json:{write:!0}})],kE.prototype,"refreshInterval",void 0),u([p({type:["image"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],kE.prototype,"type",void 0),u([p({type:cKe,json:{write:{isRequired:!0}}})],kE.prototype,"value",void 0),kE=cY=u([A("esri.popup.content.ImageMediaInfo")],kE);const fAe=kE;var uY;let V4=uY=class extends vG{constructor(t){super(t),this.type="line-chart"}clone(){var t;return new uY({altText:this.altText,title:this.title,caption:this.caption,value:(t=this.value)==null?void 0:t.clone()})}};u([p({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:{writer:_G.write,isRequired:!0}}})],V4.prototype,"type",void 0),V4=uY=u([A("esri.popup.content.LineChartMediaInfo")],V4);const mAe=V4;var hY;let j4=hY=class extends vG{constructor(t){super(t),this.type="pie-chart"}clone(){var t;return new hY({altText:this.altText,title:this.title,caption:this.caption,value:(t=this.value)==null?void 0:t.clone()})}};u([p({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:{writer:_G.write,isRequired:!0}}})],j4.prototype,"type",void 0),j4=hY=u([A("esri.popup.content.PieChartMediaInfo")],j4);const gAe=j4,dY={base:Rre,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":dAe,"column-chart":pAe,"line-chart":mAe,"pie-chart":gAe,image:fAe}};var pY;let mp=pY=class extends Bv{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?fAe.fromJSON(e):e.type==="barchart"?dAe.fromJSON(e):e.type==="columnchart"?pAe.fromJSON(e):e.type==="linechart"?mAe.fromJSON(e):e.type==="piechart"?gAe.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(i=>i.toJSON())}clone(){return new pY(q({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};u([p()],mp.prototype,"activeMediaInfoIndex",void 0),u([p({type:Object,json:{write:!0}})],mp.prototype,"attributes",void 0),u([p({type:String,json:{write:!0}})],mp.prototype,"description",void 0),u([p({types:[dY]})],mp.prototype,"mediaInfos",void 0),u([ve("mediaInfos")],mp.prototype,"readMediaInfos",null),u([_e("mediaInfos")],mp.prototype,"writeMediaInfos",null),u([p({type:String,json:{write:!0}})],mp.prototype,"title",void 0),u([p({type:["media"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],mp.prototype,"type",void 0),mp=pY=u([A("esri.popup.content.MediaContent")],mp);const S3=mp;var fY;let lI=fY=class extends ee{constructor(t){super(t),this.field=null,this.order=null}clone(){return new fY({field:this.field,order:this.order})}};u([p({type:String,json:{write:!0}})],lI.prototype,"field",void 0),u([p({type:["asc","desc"],json:{write:!0}})],lI.prototype,"order",void 0),lI=fY=u([A("esri.popup.support.RelatedRecordsInfoFieldOrder")],lI);const Pre=lI;let Xf=class extends Nt.ClonableMixin(Bv){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};u([p({type:String,json:{write:!0}})],Xf.prototype,"description",void 0),u([p({type:Number,json:{type:Ii,write:!0}})],Xf.prototype,"displayCount",void 0),u([p({type:["list"],json:{write:{isRequired:!0}}})],Xf.prototype,"displayType",void 0),u([p({type:[Pre],json:{write:!0}})],Xf.prototype,"orderByFields",void 0),u([p({type:Number,json:{type:Ii,write:{isRequired:!0}}})],Xf.prototype,"relationshipId",void 0),u([p({type:String,json:{write:!0}})],Xf.prototype,"title",void 0),u([p({type:["relationship"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],Xf.prototype,"type",void 0),Xf=u([A("esri.popup.content.RelationshipContent")],Xf);const T3=Xf;var mY;let cI=mY=class extends Bv{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new mY({text:this.text})}};u([p({type:String,json:{write:!0}})],cI.prototype,"text",void 0),u([p({type:["text"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],cI.prototype,"type",void 0),cI=mY=u([A("esri.popup.content.TextContent")],cI);const E3=cI;let ey=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.title=null,this.description=null,this.type=null,this.associatedNetworkSourceId=null,this.associatedAssetGroup=null,this.associatedAssetType=null}};u([p({type:String,json:{write:!0}})],ey.prototype,"title",void 0),u([p({type:String,json:{write:!0}})],ey.prototype,"description",void 0),u([p({type:["attachment","connectivity","container","content","structure"],json:{write:!0}})],ey.prototype,"type",void 0),u([p({type:Number,json:{type:Ii,write:!0}})],ey.prototype,"associatedNetworkSourceId",void 0),u([p({type:Number,json:{type:Ii,write:!0}})],ey.prototype,"associatedAssetGroup",void 0),u([p({type:Number,json:{type:Ii,write:!0}})],ey.prototype,"associatedAssetType",void 0),ey=u([A("esri.popup.support.UtilityNetworkAssociationType")],ey);const yAe=ey;let G0=class extends Nt.ClonableMixin(Bv){constructor(e){super(e),this.description=null,this.displayCount=null,this.title=null,this.associationTypes=[],this.type="utility-network-associations"}};u([p({type:String,json:{write:!0}})],G0.prototype,"description",void 0),u([p({type:Number,json:{type:Ii,write:!0}})],G0.prototype,"displayCount",void 0),u([p({type:String,json:{write:!0}})],G0.prototype,"title",void 0),u([p({type:[yAe],json:{write:!0}})],G0.prototype,"associationTypes",void 0),u([Ve({utilityNetworkAssociations:"utility-network-associations"})],G0.prototype,"type",void 0),G0=u([A("esri.popup.content.UtilityNetworkAssociationsContent")],G0);const Dre=G0,uKe={base:null,key:"type",typeMap:{attachment:tA,media:S3,text:E3,expression:yG,field:iA,relationship:T3,utilityNetworkAssociations:Dre}},hKe={base:null,key:"type",typeMap:{attachment:tA,media:S3,text:E3,expression:yG,field:iA,relationship:T3}};var gY;let p1=gY=class extends ee{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new gY({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([p({type:String,json:{write:!0}})],p1.prototype,"name",void 0),u([p({type:String,json:{write:!0}})],p1.prototype,"title",void 0),u([p({type:String,json:{write:!0}})],p1.prototype,"expression",void 0),u([p({type:["string","number"],json:{write:!0}})],p1.prototype,"returnType",void 0),p1=gY=u([A("esri.popup.ExpressionInfo")],p1);const dKe=p1;var yY;let uI=yY=class extends ee{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new yY({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};u([p({type:Boolean,json:{write:!0}})],uI.prototype,"returnTopmostRaster",void 0),u([p({type:Boolean,json:{write:!0}})],uI.prototype,"showNoDataRecords",void 0),uI=yY=u([A("esri.popup.LayerOptions")],uI);const pKe=uI;var vY;let hI=vY=class extends ee{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new vY({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?q(this.orderByFields):null})}};u([p({type:Boolean,json:{write:!0}})],hI.prototype,"showRelatedRecords",void 0),u([p({type:[Pre],json:{write:!0}})],hI.prototype,"orderByFields",void 0),hI=vY=u([A("esri.popup.RelatedRecordsInfo")],hI);const rde=hI;var _Y;let Oh=_Y=class extends XS.IdentifiableMixin(he){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new _Y({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};u([p()],Oh.prototype,"active",void 0),u([p()],Oh.prototype,"className",void 0),u([p()],Oh.prototype,"disabled",void 0),u([p()],Oh.prototype,"icon",void 0),u([p()],Oh.prototype,"id",void 0),u([p()],Oh.prototype,"indicator",void 0),u([p()],Oh.prototype,"title",void 0),u([p()],Oh.prototype,"type",void 0),u([p()],Oh.prototype,"visible",void 0),Oh=_Y=u([A("esri.support.actions.ActionBase")],Oh);const Lre=Oh;var bY;let G4=bY=class extends Lre{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new bY({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};u([p()],G4.prototype,"image",void 0),G4=bY=u([A("esri.support.actions.ActionButton")],G4);const fKe=G4;var wY;let dI=wY=class extends Lre{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new wY({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};u([p()],dI.prototype,"image",void 0),u([p()],dI.prototype,"value",void 0),dI=wY=u([A("esri.support.actions.ActionToggle")],dI);const mKe=dI,VM="relationships/",sde="expression/",gKe=Ce.ofType({key:"type",defaultKeyValue:"button",base:Lre,typeMap:{button:fKe,toggle:mKe}}),yKe={base:Bv,key:"type",typeMap:{media:S3,custom:nKe,text:E3,attachments:tA,fields:iA,expression:yG,relationship:T3,utilityNetworkAssociations:Dre}},vAe=new Set(["attachments","fields","media","text","expression","relationship"]),vKe=new Set([...vAe,"utility-network-associations"]);let lo=class extends Nt.ClonableMixin(ee){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(i=>Ad(yKe,i)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||uu(e)?e:(J.getLogger(this).error("content error","unsupported content value",{value:e}),null)}readContent(e,i){const{popupElements:r}=i;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(i.description,i.mediaInfos,r):this._readPopupInfo(i)}writeWebSceneContent(e,i,r,s){this._writePopupTemplateContent(e,i,s)}writeWebMapContent(e,i,r,s){this._writePopupTemplateContent(e,i,s)}writeFieldInfos(e,i,r,s){const{content:n}=this,o=Array.isArray(n)?n:null;if(e){const a=o?o.filter(c=>c.type==="fields"):[],l=a.length&&a.every(c=>{var h;return(h=c.fieldInfos)==null?void 0:h.length});i.fieldInfos=e.filter(Boolean).map(c=>{const h=c.toJSON(s);return l&&(h.visible=!1),h})}if(o)for(const a of o)a.type==="fields"&&this._writeFieldsContent(a,i)}writeLayerOptions(e,i,r,s){i[r]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(s)}writeTitle(e,i){i.title=e||""}async collectRequiredFields(e,i){const r=this.expressionInfos||[];await this._collectExpressionInfoFields(e,i,[...r,...this._getContentExpressionInfos(this.content,r)]),SS(e,i,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const i=new Set;return await this.collectRequiredFields(i,e),[...i].sort()}_writePopupTemplateContent(e,i,r){typeof e!="string"?Array.isArray(e)&&(i.popupElements=e.filter(s=>(r==null?void 0:r.origin)==="web-scene"?vAe.has(s.type):vKe.has(s.type)).map(s=>s==null?void 0:s.toJSON(r)),i.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(i):s.type==="media"?this._writeMediaContent(s,i):s.type==="text"?this._writeTextContent(s,i):s.type==="relationship"&&this._writeRelationshipContent(s,i)})):i.description=e}_writeFieldsContent(e,i){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const r=q(e.fieldInfos);Array.isArray(i.fieldInfos)?r.forEach(s=>{const n=i.fieldInfos.find(o=>{var a,l;return((a=o.fieldName)==null?void 0:a.toLowerCase())===((l=s.fieldName)==null?void 0:l.toLowerCase())});n?n.visible=!0:i.fieldInfos.push(s)}):i.fieldInfos=r}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,i){var n,o;const r=((n=e.orderByFields)==null?void 0:n.map(a=>this._toFieldOrderJSON(a,e.relationshipId)))||[],s=[...((o=i.relatedRecordsInfo)==null?void 0:o.orderByFields)||[],...r];i.relatedRecordsInfo={showRelatedRecords:!0,...(s==null?void 0:s.length)&&{orderByFields:s}}}_writeTextContent(e,i){!i.description&&e.text&&(i.description=e.text)}_writeMediaContent(e,i){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const r=q(e.mediaInfos);Array.isArray(i.mediaInfos)?i.mediaInfos=[...i.mediaInfos,...r]:i.mediaInfos=r}_readPopupInfoElements(e,i,r){const s={description:!1,mediaInfos:!1};return r.map(n=>n.type==="media"?(n.mediaInfos||!i||s.mediaInfos||(n.mediaInfos=i,s.mediaInfos=!0),S3.fromJSON(n)):n.type==="text"?(n.text||!e||s.description||(n.text=e,s.description=!0),E3.fromJSON(n)):n.type==="attachments"?tA.fromJSON(n):n.type==="fields"?iA.fromJSON(n):n.type==="expression"?yG.fromJSON(n):n.type==="relationship"?T3.fromJSON(n):n.type==="utilityNetworkAssociations"?Dre.fromJSON(n):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:i,order:r}=e;if(!(i!=null&&i.startsWith(VM)))return null;const s=i.replace(VM,"").split("/");if(s.length!==2)return null;const n=parseInt(s[0],10),o=s[1];return!Number.isNaN(n)&&o?T3.fromJSON({relationshipId:n,orderByFields:[{field:o,order:r}]}):null}_toFieldOrderJSON(e,i){const{order:r,field:s}=e;return{field:`${VM}${i}/${s}`,order:r}}_readPopupInfo({description:e,mediaInfos:i,showAttachments:r,relatedRecordsInfo:s={showRelatedRecords:!1}}){const n=[];e?n.push(new E3({text:e})):n.push(new iA),Array.isArray(i)&&i.length&&n.push(S3.fromJSON({mediaInfos:i})),r&&n.push(tA.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=s;return o&&(a!=null&&a.length)&&a.forEach(l=>{const c=this._toRelationshipContent(l);c&&n.push(c)}),n.length?n:e}_getContentElementFields(e){const i=e==null?void 0:e.type;if(i==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(i==="custom")return e.outFields||[];if(i==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(i==="media"){const r=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...r.reduce((s,n)=>[...s,...this._getMediaInfoFields(n)],[])]}return i==="text"?this._extractFieldNames(e.text):i==="relationship"||i==="utility-network-associations"?[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)]:[]}_getMediaInfoFields(e){const{caption:i,title:r,value:s}=e,n=s||{},{fields:o,normalizeField:a,tooltipField:l,sourceURL:c,linkURL:h}=n,d=[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(c),...this._extractFieldNames(h),...o??[]];return a&&d.push(a),l&&d.push(l),d}_getContentExpressionInfos(e,i){return Array.isArray(e)?e.reduce((r,s)=>[...r,...s.type==="expression"&&s.expressionInfo?[s.expressionInfo]:[]],i):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((i,r)=>[...i,...this._getContentElementFields(r)],[]):[]}async _collectExpressionInfoFields(e,i,r){r&&await Promise.all(r.map(s=>Rl(e,i,s.expression)))}_getFieldInfoFields(e){return e?e.filter(({fieldName:i,visible:r})=>!(r!==void 0&&!r||!i||i.startsWith(VM)||i.startsWith(sde))).map(i=>i.fieldName):[]}_getActionsFields(e){return e?e.toArray().reduce((i,r)=>[...i,...this._getActionFields(r)],[]):[]}_getActionFields(e){const{className:i,title:r,type:s}=e,n=s==="button"||s==="toggle"?e.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(n)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){return Ore(e).filter(i=>!(i.indexOf(VM)===0||i.indexOf(sde)===0))}};u([p({type:gKe})],lo.prototype,"actions",void 0),u([p()],lo.prototype,"content",void 0),u([ti("content")],lo.prototype,"castContent",null),u([ve("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],lo.prototype,"readContent",null),u([_e("web-scene","content",{popupElements:{type:Ce.ofType(hKe)},showAttachments:{type:Boolean},mediaInfos:{type:Ce.ofType(dY)},description:{type:String},relatedRecordsInfo:{type:rde}})],lo.prototype,"writeWebSceneContent",null),u([_e("content",{popupElements:{type:Ce.ofType(uKe)},showAttachments:{type:Boolean},mediaInfos:{type:Ce.ofType(dY)},description:{type:String},relatedRecordsInfo:{type:rde}})],lo.prototype,"writeWebMapContent",null),u([p({type:[dKe],json:{write:!0}})],lo.prototype,"expressionInfos",void 0),u([p({type:[Ire]})],lo.prototype,"fieldInfos",void 0),u([_e("fieldInfos")],lo.prototype,"writeFieldInfos",null),u([p({type:pKe})],lo.prototype,"layerOptions",void 0),u([_e("layerOptions")],lo.prototype,"writeLayerOptions",null),u([p({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],lo.prototype,"lastEditInfoEnabled",void 0),u([p()],lo.prototype,"outFields",void 0),u([p()],lo.prototype,"overwriteActions",void 0),u([p()],lo.prototype,"returnGeometry",void 0),u([p({json:{type:String}})],lo.prototype,"title",void 0),u([_e("title")],lo.prototype,"writeTitle",null),lo=u([A("esri.PopupTemplate")],lo);const oM=lo,nde=new ni({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let _Ke=0,zE=class extends ee{constructor(e){super(e),this.id="sym"+_Ke++,this.type=null,this.color=new Je([0,0,0,1])}readColor(e){return(e==null?void 0:e[0])!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,i){}hash(){return JSON.stringify(this.toJSON())}clone(){}};u([p({type:nde.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:nde.write,isRequired:!0}}})],zE.prototype,"type",void 0),u([p({type:Je,json:{write:{allowNull:!0}}})],zE.prototype,"color",void 0),u([ve("color")],zE.prototype,"readColor",null),zE=u([A("esri.symbols.Symbol")],zE);const Qa=zE;var xY;let H0=xY=class extends Qa{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){Object.assign(e,t)}async collectRequiredFields(t,e){var i;if(((i=this.data)==null?void 0:i.type)==="CIMSymbolReference"){const r=this.data.primitiveOverrides;if(r){const s=r.map(n=>{const o=n.valueExpressionInfo;return o?Rl(t,e,o.expression):null});await Promise.all(s)}}}clone(){return new xY({data:q(this.data)})}hash(){return uSe(JSON.stringify(this.data)).toString()}};u([p({json:{write:!1}})],H0.prototype,"color",void 0),u([p({json:{write:!0}})],H0.prototype,"data",void 0),u([ve("data",["symbol"])],H0.prototype,"readData",null),u([_e("data",{})],H0.prototype,"writeData",null),u([Ve({CIMSymbolReference:"cim"},{readOnly:!0})],H0.prototype,"type",void 0),H0=xY=u([A("esri.symbols.CIMSymbol")],H0);const nw=H0;let UE=class extends ee{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,i,r){e||(i[r]=e)}};u([p({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],UE.prototype,"enabled",void 0),u([_e("enabled")],UE.prototype,"writeEnabled",null),u([p({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0,json:{write:{isRequired:!0}}})],UE.prototype,"type",void 0),UE=u([A("esri.symbols.Symbol3DLayer")],UE);const vg=UE;function bKe(t,e){const i=e.transparency!=null?X$(e.transparency):1,r=e.color;return r&&Array.isArray(r)?new Je([r[0]||0,r[1]||0,r[2]||0,i]):null}function wKe(t,e){e.color=t.toJSON().slice(0,3);const i=eL(t.a);i!==0&&(e.transparency=i)}function Vv(t){return{type:Je,nonNullable:t==null?void 0:t.nonNullable,json:{type:[Ii],default:null,read:{source:["color","transparency"],reader:bKe},write:{target:{color:{type:[Ii],isRequired:t==null?void 0:t.colorRequiredOnWrite},transparency:{type:Ii}},writer:wKe}}}}const sg={type:Number,cast:or,json:{write:!0}};let f1=class extends ee{constructor(e){super(e),this.color=new Je([0,0,0,1]),this.extensionLength=0,this.size=Rd(1)}clone(){}cloneProperties(){return{color:q(this.color),size:this.size,extensionLength:this.extensionLength}}};u([p({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0,isRequired:!0}}})],f1.prototype,"type",void 0),u([p(Vv({colorRequiredOnWrite:!0}))],f1.prototype,"color",void 0),u([p({...sg,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],f1.prototype,"extensionLength",void 0),u([p(sg)],f1.prototype,"size",void 0),f1=u([A("esri.symbols.edges.Edges3D")],f1);const Nre=f1;var SY;let H4=SY=class extends Nre{constructor(t){super(t),this.type="sketch"}clone(){return new SY(this.cloneProperties())}};u([Ve({sketch:"sketch"},{readOnly:!0})],H4.prototype,"type",void 0),H4=SY=u([A("esri.symbols.edges.SketchEdges3D")],H4);const xKe=H4;var TY;let q4=TY=class extends Nre{constructor(t){super(t),this.type="solid"}clone(){return new TY(this.cloneProperties())}};u([Ve({solid:"solid"},{readOnly:!0})],q4.prototype,"type",void 0),q4=TY=u([A("esri.symbols.edges.SolidEdges3D")],q4);const _Ae=q4,bAe={types:{key:"type",base:Nre,typeMap:{solid:_Ae,sketch:xKe}},json:{write:!0}};var EY;let Qu=EY=class extends ee{constructor(t){super(t),this.color=null,this.emissiveFactor=null}clone(){var e;const t={color:((e=this.color)==null?void 0:e.clone())??null,emissiveFactor:this.emissiveFactor?os(this.emissiveFactor):null};return new EY(t)}};u([p(Vv())],Qu.prototype,"color",void 0),u([p({type:[Number],json:{write:!1}})],Qu.prototype,"emissiveFactor",void 0),Qu=EY=u([A("esri.symbols.support.Symbol3DMaterial")],Qu);var CY;let q0=CY=class extends vg{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){var t,e;return new CY({edges:(t=this.edges)==null?void 0:t.clone(),enabled:this.enabled,material:(e=this.material)==null?void 0:e.clone(),castShadows:this.castShadows,size:this.size})}};u([Ve({Extrude:"extrude"},{readOnly:!0})],q0.prototype,"type",void 0),u([p({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],q0.prototype,"size",void 0),u([p({type:Qu,json:{write:!0}})],q0.prototype,"material",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],q0.prototype,"castShadows",void 0),u([p(bAe)],q0.prototype,"edges",void 0),q0=CY=u([A("esri.symbols.ExtrudeSymbol3DLayer")],q0);const wAe=q0;let W4=class extends ee{constructor(e){super(e)}clone(){throw new Error("Subclasses of LinePattern3D should implement their own clone method.")}};u([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],W4.prototype,"type",void 0),W4=u([A("esri.symbols.patterns.LinePattern3D")],W4);const xAe=W4,SKe=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var $Y;const TKe=Oo()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let pI=$Y=class extends xAe{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new $Y(t)}};u([p({type:["style"],json:{write:{isRequired:!0}}})],pI.prototype,"type",void 0),u([Ve(TKe),p({type:SKe,json:{write:{isRequired:!0}}})],pI.prototype,"style",void 0),pI=$Y=u([A("esri.symbols.patterns.LineStylePattern3D")],pI);const Fre=pI;let Z4=class extends ee{constructor(e){super(e),this.type="style"}clone(){throw new Error("Subclasses of Pattern3D should implement their own clone method.")}};u([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Z4.prototype,"type",void 0),Z4=u([A("esri.symbols.patterns.Pattern3D")],Z4);const SAe=Z4,EKe=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var AY;let fI=AY=class extends SAe{constructor(t){super(t),this.type="style",this.style="solid"}clone(){return new AY({style:this.style})}};u([p({type:["style"],json:{write:{isRequired:!0}}})],fI.prototype,"type",void 0),u([p({type:EKe,json:{read:!0,write:{isRequired:!0}}})],fI.prototype,"style",void 0),fI=AY=u([A("esri.symbols.patterns.StylePattern3D")],fI);const TAe=fI,CKe={types:{key:"type",base:SAe,typeMap:{style:TAe}},json:{write:!0}},EAe={types:{key:"type",base:xAe,typeMap:{style:Fre}},json:{write:!0}},sP=new Je("white"),$Ke=new Je([255,255,255,0]);function AKe(t){return t.r===0&&t.g===0&&t.b===0}var MY;let nP=MY=class extends Qu{constructor(t){super(t),this.colorMixMode=null}clone(){var e;const t={color:((e=this.color)==null?void 0:e.clone())??null,emissiveFactor:this.emissiveFactor?os(this.emissiveFactor):null,colorMixMode:this.colorMixMode};return new MY(t)}};u([Ve({multiply:"multiply",replace:"replace",tint:"tint"})],nP.prototype,"colorMixMode",void 0),nP=MY=u([A("esri.symbols.support.Symbol3DFillMaterial")],nP);function cc(t,e=!1){return t<=lh?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function MKe(t){return(RD(t)?t.byteLength/8:t.length)<=lh?Array.from(t):new Float64Array(t)}function Kx(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function fh(t=IAe){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function rA(t,e,i,r,s,n,o=fh()){return o[0]=t,o[1]=e,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function OKe(t,e=fh()){return IKe(t,0,t.length/3,e)}function IKe(t,e,i,r=fh()){return bG(r,IY),RKe(r,t,e,i),r}function Q7t(t,e=cc(24)){const[i,r,s,n,o,a]=t;return e[0]=i,e[1]=r,e[2]=s,e[3]=i,e[4]=r,e[5]=a,e[6]=i,e[7]=o,e[8]=s,e[9]=i,e[10]=o,e[11]=a,e[12]=n,e[13]=r,e[14]=s,e[15]=n,e[16]=r,e[17]=a,e[18]=n,e[19]=o,e[20]=s,e[21]=n,e[22]=o,e[23]=a,e}function eWt(t,e){const i=isFinite(t[2])||isFinite(t[5]);return new _i(i?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function CAe(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function tWt(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function C3(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function RKe(t,e,i=0,r=e.length/3){let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let h=0;h<r;h++)s=Math.min(s,e[i+3*h]),n=Math.min(n,e[i+3*h+1]),o=Math.min(o,e[i+3*h+2]),a=Math.max(a,e[i+3*h]),l=Math.max(l,e[i+3*h+1]),c=Math.max(c,e[i+3*h+2]);t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function f8(t,e,i){const r=e.length;let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];if(i)for(let h=0;h<r;h++){const d=e[h];s=Math.min(s,d[0]),n=Math.min(n,d[1]),o=Math.min(o,d[2]),a=Math.max(a,d[0]),l=Math.max(l,d[1]),c=Math.max(c,d[2])}else for(let h=0;h<r;h++){const d=e[h];s=Math.min(s,d[0]),n=Math.min(n,d[1]),a=Math.max(a,d[0]),l=Math.max(l,d[1])}t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function PKe(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function KS(t){return t[0]>=t[3]?0:t[3]-t[0]}function QS(t){return t[1]>=t[4]?0:t[4]-t[1]}function ow(t){return t[2]>=t[5]?0:t[5]-t[2]}function DKe(t){const e=KS(t),i=ow(t),r=QS(t);return Math.sqrt(e*e+i*i+r*r)}function kre(t,e=[0,0,0]){return e[0]=t[0]+KS(t)/2,e[1]=t[1]+QS(t)/2,e[2]=t[2]+ow(t)/2,e}function iWt(t,e=[0,0,0]){return e[0]=KS(t),e[1]=QS(t),e[2]=ow(t),e}function LKe(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function rWt(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function NKe(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function FKe(t,e){return e==null||NKe(t,e)}function kKe(t,e,i,r,s=t){return s[0]=t[0]+e,s[1]=t[1]+i,s[2]=t[2]+r,s[3]=t[3]+e,s[4]=t[4]+i,s[5]=t[5]+r,s}function sWt(t,e,i=t){const r=t[0]+KS(t)/2,s=t[1]+QS(t)/2,n=t[2]+ow(t)/2;return i[0]=r+(t[0]-r)*e,i[1]=s+(t[1]-s)*e,i[2]=n+(t[2]-n)*e,i[3]=r+(t[3]-r)*e,i[4]=s+(t[4]-s)*e,i[5]=n+(t[5]-n)*e,i}function nWt(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function $Ae(t,e,i=t){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i!==t&&(i[3]=t[3],i[4]=t[4],i[5]=t[5]),i}function AAe(t,e,i=t){return i[3]=e[0],i[4]=e[1],i[5]=e[2],i!==t&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),t}function bG(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function bf(t){return t?bG(t,IY):fh(IY)}function MAe(t,e){return e||(e=si()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function oWt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function zKe(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=Number.NEGATIVE_INFINITY,t[3]=r,t[4]=s,t[5]=Number.POSITIVE_INFINITY,t}function OY(t){return t.length===6}function OAe(t){return KS(t)===0&&QS(t)===0&&ow(t)===0}function aWt(t,e,i){if(t==null||e==null)return t===e;if(!OY(t)||!OY(e))return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function UKe(t,e,i,r,s,n){return rA(t,e,i,r,s,n,BKe)}const lWt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],IY=[1/0,1/0,1/0,-1/0,-1/0,-1/0],IAe=[0,0,0,0,0,0],BKe=fh();function cWt(t,{isPrimitive:e,width:i,depth:r,height:s}){const n=e?10:1;if(i==null&&s==null&&r==null)return[n*t[0],n*t[1],n*t[2]];const o=De(i,r,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/t[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=t[l]*a);return o}const VKe=rA(-.5,-.5,-.5,.5,.5,.5),jKe=rA(-.5,-.5,0,.5,.5,1),GKe=rA(-.5,-.5,0,.5,.5,.5);function uWt(t){switch(t){case"sphere":case"cube":case"diamond":return VKe;case"cylinder":case"cone":case"inverted-cone":return jKe;case"tetrahedron":return GKe;default:return}}const zre=["butt","square","round"],HKe=[...zre,"none"],RAe=["miter","bevel","round"];var RY;let m1=RY=class extends ee{constructor(t){super(t),this.color=new Je([0,0,0,1]),this.size=Rd(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size,pattern:this.pattern!=null?this.pattern.clone():null,patternCap:this.patternCap};return new RY(t)}};u([p(Vv({colorRequiredOnWrite:!0}))],m1.prototype,"color",void 0),u([p({...sg,json:{write:{isRequired:!0}}})],m1.prototype,"size",void 0),u([p(EAe)],m1.prototype,"pattern",void 0),u([p({type:zre,json:{default:"butt",write:{overridePolicy(){return{enabled:this.pattern!=null}}}}})],m1.prototype,"patternCap",void 0),m1=RY=u([A("esri.symbols.support.Symbol3DOutline")],m1);var Y4;let ty=Y4=class extends vg{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:this.edges!=null?this.edges.clone():null,enabled:this.enabled,material:this.material!=null?this.material.clone():null,pattern:this.pattern!=null?this.pattern.clone():null,castShadows:this.castShadows,outline:this.outline!=null?this.outline.clone():null};return new Y4(t)}static fromSimpleFillSymbol(t){var r,s,n;const e=t.outline&&t.outline.style&&t.outline.style!=="solid"?new Fre({style:t.outline.style}):null,i={size:((r=t.outline)==null?void 0:r.width)??0,color:(((s=t.outline)==null?void 0:s.color)??sP).clone(),pattern:e};return e&&((n=t.outline)!=null&&n.cap)&&(i.patternCap=t.outline.cap),new Y4({material:new nP({color:(t.color??$Ke).clone()}),pattern:t.style&&t.style!=="solid"?new TAe({style:t.style}):null,outline:i})}};u([Ve({Fill:"fill"},{readOnly:!0})],ty.prototype,"type",void 0),u([p({type:nP,json:{write:!0}})],ty.prototype,"material",void 0),u([p(CKe)],ty.prototype,"pattern",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],ty.prototype,"castShadows",void 0),u([p({type:m1,json:{write:!0}})],ty.prototype,"outline",void 0),u([p(bAe)],ty.prototype,"edges",void 0),ty=Y4=u([A("esri.symbols.FillSymbol3DLayer")],ty);const eT=ty;var PY;const qKe=Oo()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let g1=PY=class extends ee{constructor(t){super(t)}readHref(t,e,i){return t?XA(t,i):e.dataURI}writeHref(t,e,i,r){t&&($f(t)?e.dataURI=t:(e.href=BD(t,r),rh(e.href)&&(e.href=Ed(e.href))))}clone(){return new PY({href:this.href,primitive:this.primitive})}};u([p({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],g1.prototype,"href",void 0),u([ve("href")],g1.prototype,"readHref",null),u([_e("href",{href:{type:String},dataURI:{type:String}})],g1.prototype,"writeHref",null),u([Ve(qKe)],g1.prototype,"primitive",void 0),g1=PY=u([A("esri.symbols.support.IconSymbol3DLayerResource")],g1);const hWt="circle";var DY;let eC=DY=class extends he{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new DY({x:this.x,y:this.y})}};u([p({type:Number})],eC.prototype,"x",void 0),u([p({type:Number})],eC.prototype,"y",void 0),eC=DY=u([A("esri.symbols.support.Symbol3DAnchorPosition2D")],eC);var LY;let mI=LY=class extends ee{constructor(t){super(t),this.color=new Je([0,0,0,1]),this.size=Rd(1)}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size};return new LY(t)}};u([p(Vv({colorRequiredOnWrite:!0}))],mI.prototype,"color",void 0),u([p({...sg,json:{write:{isRequired:!0}}})],mI.prototype,"size",void 0),mI=LY=u([A("esri.symbols.support.Symbol3DIconOutline")],mI);var BE;const PAe="esri.symbols.IconSymbol3DLayer";let gp=BE=class extends vg{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null,this.angle=0}clone(){return new BE({anchor:this.anchor,anchorPosition:q(this.anchorPosition),enabled:this.enabled,material:q(this.material),outline:q(this.outline),resource:q(this.resource),angle:this.angle,size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||sP,i=ode(t),r=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||sP).clone()}:null;return new BE({size:t.size,angle:t.angle,resource:{primitive:ZKe(t.style)},material:{color:e},outline:r,anchor:i?"relative":void 0,anchorPosition:i})}static fromPictureMarkerSymbol(t){const e=!t.color||AKe(t.color)?sP:t.color,i=ode(t);return new BE({size:t.width<=t.height?t.height:t.width,angle:t.angle,resource:{href:t.url},material:{color:e.clone()},anchor:i?"relative":void 0,anchorPosition:i})}static fromCIMSymbol(t){return new BE({resource:{href:ETe({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};u([p({type:Qu,json:{write:!0}})],gp.prototype,"material",void 0),u([p({type:g1,json:{write:!0}})],gp.prototype,"resource",void 0),u([Ve({Icon:"icon"},{readOnly:!0})],gp.prototype,"type",void 0),u([p({...sg,json:{write:{isRequired:!0}}})],gp.prototype,"size",void 0),u([Ve({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"},{default:"center"})],gp.prototype,"anchor",void 0),u([p({type:eC,json:{type:[Number],read:{reader:t=>new eC({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],gp.prototype,"anchorPosition",void 0),u([p({type:mI,json:{write:!0}})],gp.prototype,"outline",void 0),u([p({type:Number,json:{write:!0,default:0}})],gp.prototype,"angle",void 0),gp=BE=u([A(PAe)],gp);const sb=gp;function ode(t){const e="width"in t?t.width:t.size,i="height"in t?t.height:t.size,r=ade(t.xoffset),s=ade(t.yoffset);return(r||s)&&e&&i?{x:-r/e,y:s/i}:null}function ade(t){return isFinite(t)?t:0}const WKe={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function ZKe(t){return WKe[t]||(J.getLogger(PAe).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const YKe=["begin","end","begin-end"],DAe=["arrow","circle","square","diamond","cross","x"];let y1=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return e!=null&&e.placement===this.placement&&e.style===this.style&&(this.color==null&&e.color==null||this.color!=null&&e.color!=null&&this.color.toJSON()===e.color.toJSON())}};u([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0,isRequired:!0}}})],y1.prototype,"type",void 0),u([p({type:YKe,json:{default:"begin-end",write:!0}})],y1.prototype,"placement",void 0),u([p({type:DAe,json:{default:"arrow",write:!0}})],y1.prototype,"style",void 0),u([p({type:Je,json:{type:[Ii],default:null,write:!0}})],y1.prototype,"color",void 0),y1=u([A("esri.symbols.LineStyleMarker3D")],y1);const NY=y1;var J4;let Kf=J4=class extends vg{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=Rd(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:this.material!=null?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:this.pattern!=null?this.pattern.clone():null,marker:this.marker!=null?this.marker.clone():null};return new J4(t)}static fromSimpleLineSymbol(t){var i;const e={enabled:!0,size:t.width??Rd(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style?new Fre({style:t.style}):null,material:new Qu({color:(t.color||sP).clone()}),marker:t.marker?new NY({placement:t.marker.placement,style:t.marker.style,color:((i=t.marker.color)==null?void 0:i.clone())??null}):null};return new J4(e)}};u([p({type:Qu,json:{write:!0}})],Kf.prototype,"material",void 0),u([Ve({Line:"line"},{readOnly:!0})],Kf.prototype,"type",void 0),u([p({type:RAe,json:{write:!0,default:"miter"}})],Kf.prototype,"join",void 0),u([p({type:zre,json:{write:!0,default:"butt"}})],Kf.prototype,"cap",void 0),u([p({...sg,json:{write:{isRequired:!0}}})],Kf.prototype,"size",void 0),u([p(EAe)],Kf.prototype,"pattern",void 0),u([p({types:{key:"type",base:NY,typeMap:{style:NY}},json:{write:!0}})],Kf.prototype,"marker",void 0),Kf=J4=u([A("esri.symbols.LineSymbol3DLayer")],Kf);const aM=Kf;var FY;const JKe=Oo()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let gI=FY=class extends ee{clone(){return new FY({href:this.href,primitive:this.primitive})}};u([p({type:String,json:{read:Sie,write:fS}})],gI.prototype,"href",void 0),u([Ve(JKe)],gI.prototype,"primitive",void 0),gI=FY=u([A("esri.symbols.support.ObjectSymbol3DLayerResource")],gI);const XKe="sphere";var kY;let dx=kY=class extends he{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new kY({x:this.x,y:this.y,z:this.z})}};u([p({type:Number})],dx.prototype,"x",void 0),u([p({type:Number})],dx.prototype,"y",void 0),u([p({type:Number})],dx.prototype,"z",void 0),dx=kY=u([A("esri.symbols.support.Symbol3DAnchorPosition3D")],dx);var zY;let ul=zY=class extends vg{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){var t,e,i;return new zY({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:(t=this.anchorPosition)==null?void 0:t.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:((e=this.material)==null?void 0:e.clone())??null,castShadows:this.castShadows,resource:(i=this.resource)==null?void 0:i.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};u([p({type:Qu,json:{write:!0}})],ul.prototype,"material",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],ul.prototype,"castShadows",void 0),u([p({type:gI,json:{write:!0}})],ul.prototype,"resource",void 0),u([Ve({Object:"object"},{readOnly:!0})],ul.prototype,"type",void 0),u([p({type:Number,json:{write:!0}})],ul.prototype,"width",void 0),u([p({type:Number,json:{write:!0}})],ul.prototype,"height",void 0),u([p({type:Number,json:{write:!0}})],ul.prototype,"depth",void 0),u([Ve({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"},{default:"origin"})],ul.prototype,"anchor",void 0),u([p({type:dx,json:{type:[Number],read:{reader:t=>new dx({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],ul.prototype,"anchorPosition",void 0),u([p({type:Number,json:{write:!0}})],ul.prototype,"heading",void 0),u([p({type:Number,json:{write:!0}})],ul.prototype,"tilt",void 0),u([p({type:Number,json:{write:!0}})],ul.prototype,"roll",void 0),u([p({readOnly:!0})],ul.prototype,"isPrimitive",null),ul=zY=u([A("esri.symbols.ObjectSymbol3DLayer")],ul);const Ure=ul;var UY;let Bl=UY=class extends vg{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new UY({enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};u([p({type:Qu,json:{write:!0}})],Bl.prototype,"material",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Bl.prototype,"castShadows",void 0),u([Ve({Path:"path"},{readOnly:!0})],Bl.prototype,"type",void 0),u([p({type:["circle","quad"],json:{write:!0,default:"circle"}})],Bl.prototype,"profile",void 0),u([p({type:RAe,json:{write:!0,default:"miter"}})],Bl.prototype,"join",void 0),u([p({type:HKe,json:{write:!0,default:"butt"}})],Bl.prototype,"cap",void 0),u([p({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],Bl.prototype,"width",void 0),u([ve("width",["width","size","height"])],Bl.prototype,"readWidth",null),u([p({type:Number,json:{write:!0}})],Bl.prototype,"height",void 0),u([ve("height",["height","size","width"])],Bl.prototype,"readHeight",null),u([p({type:["center","bottom","top"],json:{write:!0,default:"center"}})],Bl.prototype,"anchor",void 0),u([p({type:["heading","all"],json:{write:!0,default:"all"}})],Bl.prototype,"profileRotation",void 0),Bl=UY=u([A("esri.symbols.PathSymbol3DLayer")],Bl);const Bre=Bl,KKe=["none","underline","line-through"],QKe=["normal","italic","oblique"],eQe=["normal","lighter","bold","bolder"],LAe={type:Number,cast:t=>{const e=rc(t);return e===0?1:ue(e,.1,4)},nonNullable:!0},tQe=["left","right","center"],iQe=["baseline","top","middle","bottom"],NAe={type:tQe,nonNullable:!0},FAe={type:iQe,nonNullable:!0},pWt=8;var BY;let iy=BY=class extends ee{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return or(t)}clone(){return new BY({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};u([p({type:KKe,json:{default:"none",write:!0}})],iy.prototype,"decoration",void 0),u([p({type:String,json:{write:!0}})],iy.prototype,"family",void 0),u([p({type:Number,json:{write:{overridePolicy:(t,e,i)=>({enabled:!i||!i.textSymbol3D})}}})],iy.prototype,"size",void 0),u([ti("size")],iy.prototype,"castSize",null),u([p({type:QKe,json:{default:"normal",write:!0}})],iy.prototype,"style",void 0),u([p({type:eQe,json:{default:"normal",write:!0}})],iy.prototype,"weight",void 0),iy=BY=u([A("esri.symbols.Font")],iy);const wG=iy;var VY;let tC=VY=class extends ee{constructor(){super(...arguments),this.color=new Je([0,0,0,1]),this.size=0}clone(){const t={color:q(this.color),size:this.size};return new VY(t)}};u([p(Vv())],tC.prototype,"color",void 0),u([p(sg)],tC.prototype,"size",void 0),tC=VY=u([A("esri.symbols.support.Symbol3DHalo")],tC);let oP=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.color=null}};u([p(Vv())],oP.prototype,"color",void 0),oP=u([A("esri.symbols.support.Symbol3DTextBackground")],oP);var X4;let Ec=X4=class extends vg{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){t!=null&&this._userSize!=null&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,i,r){const s={...r,textSymbol3D:!0};e.font=t.write({},s),delete e.font.size}get size(){var t;return this._userSize!=null?this._userSize:((t=this.font)==null?void 0:t.size)!=null?this.font.size:9}set size(t){this._userSize=t,this.font!=null&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new X4({enabled:this.enabled,font:this.font&&q(this.font),halo:this.halo&&q(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:this.material!=null?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:q(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new X4({font:t.font!=null?t.font.clone():new wG,halo:rQe(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new Qu({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new oP({color:t.backgroundColor.clone()}):null})}};function rQe(t,e){return t&&e!=null&&e>0?new tC({color:q(t),size:e}):null}u([p({type:wG,json:{write:!0}})],Ec.prototype,"font",null),u([_e("font")],Ec.prototype,"writeFont",null),u([p({type:tC,json:{write:!0}})],Ec.prototype,"halo",void 0),u([p({...NAe,json:{default:"center",write:!0}})],Ec.prototype,"horizontalAlignment",void 0),u([p({...LAe,json:{default:1,write:!0}})],Ec.prototype,"lineHeight",void 0),u([p({type:Qu,json:{write:!0}})],Ec.prototype,"material",void 0),u([p({type:oP,json:{write:!0}})],Ec.prototype,"background",void 0),u([p(sg)],Ec.prototype,"size",null),u([p({type:String,json:{write:!0}})],Ec.prototype,"text",void 0),u([Ve({Text:"text"},{readOnly:!0})],Ec.prototype,"type",void 0),u([p({...FAe,json:{default:"baseline",write:!0}})],Ec.prototype,"verticalAlignment",void 0),Ec=X4=u([A("esri.symbols.TextSymbol3DLayer")],Ec);const tT=Ec;var jY;let W0=jY=class extends vg{constructor(t){super(t),this.color=GY.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new jY({color:q(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};u([p({type:Je,nonNullable:!0,json:{type:[Ii],write:(t,e,i)=>e[i]=t.toArray(Je.AlphaMode.UNLESS_OPAQUE),default:()=>GY.clone(),defaultEquals:t=>t.toCss(!0)===GY.toCss(!0)}})],W0.prototype,"color",void 0),u([Ve({Water:"water"},{readOnly:!0})],W0.prototype,"type",void 0),u([p({type:["small","medium","large"],json:{write:!0,default:"medium"}})],W0.prototype,"waterbodySize",void 0),u([p({type:Number,json:{write:!0,default:null}})],W0.prototype,"waveDirection",void 0),u([p({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],W0.prototype,"waveStrength",void 0),W0=jY=u([A("esri.symbols.WaterSymbol3DLayer")],W0);const kAe=W0,GY=new Je([0,119,190]);var HY;let v1=HY=class extends he{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new HY({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};u([p({type:String})],v1.prototype,"name",void 0),u([p({type:String})],v1.prototype,"styleUrl",void 0),u([p({type:String})],v1.prototype,"styleName",void 0),u([p({type:vn})],v1.prototype,"portal",void 0),v1=HY=u([A("esri.symbols.support.StyleOrigin")],v1);const qY=v1;var WY;let aP=WY=class extends he{constructor(){super(...arguments),this.url=""}clone(){return new WY({url:this.url})}};u([p({type:String})],aP.prototype,"url",void 0),aP=WY=u([A("esri.symbols.support.Thumbnail")],aP);const zAe={icon:sb,object:Ure,line:aM,path:Bre,fill:eT,extrude:wAe,text:tT,water:kAe},sQe=Ce.ofType({base:vg,key:"type",typeMap:zAe,errorContext:"symbol-layer"});let Qf=class extends Qa{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const i=this.__accessor__&&this.__accessor__.metadata&&this.__accessor__.metadata.symbolLayers,r=i==null?void 0:i.type,s=r||Ce;this._set("symbolLayers",new s)}get color(){return null}set color(e){this.constructed&&J.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){vf(e,this._get("symbolLayers"))}readStyleOrigin(e,i,r){if(e.styleUrl&&e.name){const s=XA(e.styleUrl,r);return new qY({styleUrl:s,name:e.name})}if(e.styleName&&e.name)return new qY({portal:(r==null?void 0:r.portal)||vn.getDefault(),styleName:e.styleName,name:e.name});r!=null&&r.messages&&r.messages.push(new ch("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:r,definition:e}))}writeStyleOrigin(e,i,r,s){if(e.styleUrl&&e.name){let n=BD(e.styleUrl,s);rh(n)&&(n=Ed(n)),i.styleOrigin={styleUrl:n,name:e.name}}else e.styleName&&e.name&&(e.portal&&(s!=null&&s.portal)&&!STe(e.portal.restUrl,s.portal.restUrl)?s!=null&&s.messages&&s.messages.push(new ch("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):i.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof vg||e&&zAe[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};u([p({json:{read:!1,write:!1}})],Qf.prototype,"color",null),u([p({type:sQe,nonNullable:!0,json:{write:!0}}),ti(gre)],Qf.prototype,"symbolLayers",null),u([p({type:qY})],Qf.prototype,"styleOrigin",void 0),u([ve("styleOrigin")],Qf.prototype,"readStyleOrigin",null),u([_e("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],Qf.prototype,"writeStyleOrigin",null),u([p({type:aP,json:{read:!1}})],Qf.prototype,"thumbnail",void 0),u([p({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],Qf.prototype,"type",void 0),Qf=u([A("esri.symbols.Symbol3D")],Qf);const rL=Qf;let yI=class extends ee{constructor(e){super(e),this.visible=!0}clone(){throw new Error("Subclasses of Callout3D should implement their own clone method.")}};u([p({type:["line"],constructOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,isRequired:!0}}})],yI.prototype,"type",void 0),u([p({readOnly:!0})],yI.prototype,"visible",void 0),yI=u([A("esri.symbols.callouts.Callout3D")],yI);const UAe=yI;var ZY;let K4=ZY=class extends ee{constructor(t){super(t),this.color=new Je("white")}clone(){return new ZY({color:q(this.color)})}};u([p(Vv({colorRequiredOnWrite:!0}))],K4.prototype,"color",void 0),K4=ZY=u([A("esri.symbols.callouts.LineCallout3DBorder")],K4);const nQe=K4;var YY;let Z0=YY=class extends UAe{constructor(t){super(t),this.type="line",this.color=new Je([0,0,0,1]),this.size=Rd(1),this.border=null}get visible(){return this.size>0&&this.color!=null&&this.color.a>0}clone(){return new YY({color:q(this.color),size:this.size,border:q(this.border)})}};u([Ve({line:"line"})],Z0.prototype,"type",void 0),u([p(Vv({colorRequiredOnWrite:!0}))],Z0.prototype,"color",void 0),u([p({...sg,json:{write:{isRequired:!0}}})],Z0.prototype,"size",void 0),u([p({type:nQe,json:{write:!0}})],Z0.prototype,"border",void 0),u([p({readOnly:!0})],Z0.prototype,"visible",null),Z0=YY=u([A("esri.symbols.callouts.LineCallout3D")],Z0);const BAe=Z0;function Vre(t){if(!t)return!1;const e=t.verticalOffset;return!(!e||e.screenLength<=0||e.maxWorldLength!=null&&e.maxWorldLength<=0)}function VAe(t){if(!t||!t.supportsCallout||!t.supportsCallout())return!1;const e=t.callout;return!!(e!=null&&e.visible)&&!!Vre(t)}function jAe(t){return t.type==="point-3d"||t.type==="label-3d"}function oQe(t){return t.horizontalAlignment==="center"}const GAe={types:{key:"type",base:UAe,typeMap:{line:BAe}},json:{write:!0}};var JY;let VE=JY=class extends ee{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new JY({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};u([p({...sg,json:{write:{isRequired:!0}}})],VE.prototype,"screenLength",void 0),u([p({type:Number,nonNullable:!0,json:{write:!0,default:0}})],VE.prototype,"minWorldLength",void 0),u([p({type:Number,json:{write:!0}})],VE.prototype,"maxWorldLength",void 0),VE=JY=u([A("esri.symbols.support.Symbol3DVerticalOffset")],VE);const jre=VE;var Q4;const HAe=Ce.ofType({base:null,key:"type",typeMap:{text:tT}});let Y0=Q4=class extends rL{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new HAe,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return VAe(this)}hasVisibleVerticalOffset(){return Vre(this)}clone(){return new Q4({styleOrigin:q(this.styleOrigin),symbolLayers:q(this.symbolLayers),thumbnail:q(this.thumbnail),callout:q(this.callout),verticalOffset:q(this.verticalOffset)})}static fromTextSymbol(t){return new Q4({symbolLayers:new Ce([tT.fromTextSymbol(t)])})}};u([p({type:jre,json:{write:!0}})],Y0.prototype,"verticalOffset",void 0),u([p(GAe)],Y0.prototype,"callout",void 0),u([p({json:{read:!1,write:!1}})],Y0.prototype,"styleOrigin",void 0),u([p({type:HAe})],Y0.prototype,"symbolLayers",void 0),u([Ve({LabelSymbol3D:"label-3d"},{readOnly:!0})],Y0.prototype,"type",void 0),Y0=Q4=u([A("esri.symbols.LabelSymbol3D")],Y0);const xG=Y0;var e5;const qAe=Ce.ofType({base:null,key:"type",typeMap:{line:aM,path:Bre}}),aQe=Ce.ofType({base:null,key:"type",typeMap:{line:aM,path:Bre}});let vI=e5=class extends rL{constructor(t){super(t),this.symbolLayers=new qAe,this.type="line-3d"}clone(){return new e5({styleOrigin:q(this.styleOrigin),symbolLayers:q(this.symbolLayers),thumbnail:q(this.thumbnail)})}static fromSimpleLineSymbol(t){return new e5({symbolLayers:new Ce([aM.fromSimpleLineSymbol(t)])})}};u([p({type:qAe,json:{type:aQe}})],vI.prototype,"symbolLayers",void 0),u([Ve({LineSymbol3D:"line-3d"},{readOnly:!0})],vI.prototype,"type",void 0),vI=e5=u([A("esri.symbols.LineSymbol3D")],vI);const iT=vI;var t5;const WAe=Ce.ofType({base:null,key:"type",typeMap:{fill:eT}});let _I=t5=class extends rL{constructor(t){super(t),this.symbolLayers=new WAe,this.type="mesh-3d"}clone(){return new t5({styleOrigin:q(this.styleOrigin),symbolLayers:q(this.symbolLayers),thumbnail:q(this.thumbnail)})}static fromSimpleFillSymbol(t){return new t5({symbolLayers:new Ce([eT.fromSimpleFillSymbol(t)])})}};u([p({type:WAe})],_I.prototype,"symbolLayers",void 0),u([Ve({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],_I.prototype,"type",void 0),_I=t5=u([A("esri.symbols.MeshSymbol3D")],_I);const sL=_I;let bI=class extends Qa{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};u([Ve({esriSLS:"simple-line"},{readOnly:!0})],bI.prototype,"type",void 0),u([p({type:Number,cast:or,json:{write:!0}})],bI.prototype,"width",void 0),bI=u([A("esri.symbols.LineSymbol")],bI);const lQe=bI;var XY;let em=XY=class extends ee{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,i,r){e[i]=(r==null?void 0:r.origin)==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return(t==null?void 0:t[0])!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,i,r){(r==null?void 0:r.origin)==="web-map"||(e[i]=t)}clone(){return new XY({color:q(this.color),placement:this.placement,style:this.style})}hash(){var t;return`${this.placement}.${(t=this.color)==null?void 0:t.hash()}.${this.style}`}};u([p({type:["begin","end","begin-end"],json:{write:!0}})],em.prototype,"placement",void 0),u([Ve({"line-marker":"line-marker"},{readOnly:!0}),p({json:{origins:{"web-map":{write:!1}}}})],em.prototype,"type",void 0),u([p({type:DAe})],em.prototype,"style",void 0),u([_e("style")],em.prototype,"writeStyle",null),u([p({type:Je,value:null,json:{write:{allowNull:!0}}})],em.prototype,"color",null),u([ve("color")],em.prototype,"readColor",null),u([_e("color")],em.prototype,"writeColor",null),em=XY=u([A("esri.symbols.LineSymbolMarker")],em);const cQe=em;var KY;const m8=new ni({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let ry=KY=class extends lQe{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,i,r,s,n){if(t&&typeof t!="string")return t;const o={};return t!=null&&(o.style=t),e!=null&&(o.color=e),i!=null&&(o.width=or(i)),r!=null&&(o.cap=r),s!=null&&(o.join=s),n!=null&&(o.miterLimit=or(n)),o}clone(){var t;return new KY({color:q(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(t=this.marker)==null?void 0:t.clone()})}hash(){var t,e;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(e=this.marker)==null?void 0:e.hash()}`}};u([Ve({esriSLS:"simple-line"},{readOnly:!0})],ry.prototype,"type",void 0),u([p({type:m8.apiValues,json:{read:m8.read,write:m8.write}})],ry.prototype,"style",void 0),u([p({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&(i==null?void 0:i.origin)==null})}}})],ry.prototype,"cap",void 0),u([p({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&(i==null?void 0:i.origin)==null})}}})],ry.prototype,"join",void 0),u([p({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":cQe}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],ry.prototype,"marker",void 0),u([p({type:Number,json:{read:!1,write:!1}})],ry.prototype,"miterLimit",void 0),ry=KY=u([A("esri.symbols.SimpleLineSymbol")],ry);const mh=ry;let wI=class extends Qa{constructor(e){super(e),this.outline=null,this.type=null}hash(){var e;return`${this.type}.${(e=this.outline)==null?void 0:e.hash()}`}};u([p({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":mh}},json:{default:null,write:!0}})],wI.prototype,"outline",void 0),u([p({type:["simple-fill","picture-fill"],readOnly:!0})],wI.prototype,"type",void 0),wI=u([A("esri.symbols.FillSymbol")],wI);const ZAe=wI;function uQe(t,e,i){return e.imageData?ETe({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):YAe(e.url,i)}function YAe(t,e){if(!rh(t)){const i=dQe(e);if(i)return Od(i,"images",t)}return XA(t,e)}function hQe(t,e,i,r){if($f(t)){const s=pS(t);if(!s)return;e.contentType=s.mediaType,e.imageData=s.data,i&&i.imageData===e.imageData&&i.url&&fS(i.url,e,"url",r)}else fS(t,e,"url",r)}const JAe={json:{read:{source:["imageData","url"],reader:uQe},write:{writer(t,e,i,r){hQe(t,e,this.source,r)}}}},XAe={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,i){const r={};return e.imageData&&(r.imageData=e.imageData),e.contentType&&(r.contentType=e.contentType),e.url&&(r.url=YAe(e.url,i)),r}}}};function dQe(t){var s,n;if(!t)return null;const{origin:e,layer:i}=t;if(e!=="service"&&e!=="portal-item")return null;const r=i==null?void 0:i.type;return r==="feature"||r==="stream"?(s=i.parsedUrl)==null?void 0:s.path:r==="map-image"||r==="tile"?(n=t.url)==null?void 0:n.path:null}var QY;let Ih=QY=class extends ZAe{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const s={};return t&&(s.url=t),e&&(s.outline=e),i!=null&&(s.width=or(i)),r!=null&&(s.height=or(r)),s}clone(){const t=new QY({color:q(this.color),height:this.height,outline:q(this.outline),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",q(this.source)),t}hash(){var t;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};u([Ve({esriPFS:"picture-fill"},{readOnly:!0})],Ih.prototype,"type",void 0),u([p(JAe)],Ih.prototype,"url",void 0),u([p({type:Number,json:{write:!0}})],Ih.prototype,"xscale",void 0),u([p({type:Number,json:{write:!0}})],Ih.prototype,"yscale",void 0),u([p({type:Number,cast:or,json:{write:!0}})],Ih.prototype,"width",void 0),u([p({type:Number,cast:or,json:{write:!0}})],Ih.prototype,"height",void 0),u([p({type:Number,cast:or,json:{write:!0}})],Ih.prototype,"xoffset",void 0),u([p({type:Number,cast:or,json:{write:!0}})],Ih.prototype,"yoffset",void 0),u([p(XAe)],Ih.prototype,"source",void 0),Ih=QY=u([A("esri.symbols.PictureFillSymbol")],Ih);const Gre=Ih;let J0=class extends Qa{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};u([p({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],J0.prototype,"angle",void 0),u([p({type:["simple-marker","picture-marker"],readOnly:!0})],J0.prototype,"type",void 0),u([p({type:Number,cast:or,json:{write:!0}})],J0.prototype,"xoffset",void 0),u([p({type:Number,cast:or,json:{write:!0}})],J0.prototype,"yoffset",void 0),u([p({cast:t=>t==="auto"?t:rc(or(t)),json:{write:!0}})],J0.prototype,"size",void 0),J0=u([A("esri.symbols.MarkerSymbol")],J0);const KAe=J0;var eJ;let yp=eJ=class extends KAe{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const r={};return t&&(r.url=t),e!=null&&(r.width=or(e)),i!=null&&(r.height=or(i)),r}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new eJ({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",q(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};u([p({json:{write:!1}})],yp.prototype,"color",void 0),u([Ve({esriPMS:"picture-marker"},{readOnly:!0})],yp.prototype,"type",void 0),u([p(JAe)],yp.prototype,"url",void 0),u([p(XAe)],yp.prototype,"source",void 0),u([p({type:Number,cast:or,json:{write:!0}})],yp.prototype,"height",void 0),u([ve("height",["height","size"])],yp.prototype,"readHeight",null),u([p({type:Number,cast:or,json:{write:!0}})],yp.prototype,"width",void 0),u([p({json:{write:!1}})],yp.prototype,"size",void 0),yp=eJ=u([A("esri.symbols.PictureMarkerSymbol")],yp);const nL=yp;var _1;const QAe=Ce.ofType({base:null,key:"type",typeMap:{icon:sb,object:Ure,text:tT}});let b1=_1=class extends rL{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new QAe,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return VAe(this)}hasVisibleVerticalOffset(){return Vre(this)}clone(){return new _1({verticalOffset:q(this.verticalOffset),callout:q(this.callout),styleOrigin:q(this.styleOrigin),symbolLayers:q(this.symbolLayers),thumbnail:q(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new _1({symbolLayers:new Ce([sb.fromSimpleMarkerSymbol(t)])})}static fromPictureMarkerSymbol(t){return new _1({symbolLayers:new Ce([sb.fromPictureMarkerSymbol(t)])})}static fromCIMSymbol(t){var r,s;if(((s=(r=t.data)==null?void 0:r.symbol)==null?void 0:s.type)!=="CIMPointSymbol")return null;const i=t.data.symbol;return new _1(i!=null&&i.callout?{symbolLayers:new Ce([sb.fromCIMSymbol(t)]),callout:new BAe({size:.5,color:new Je([0,0,0])}),verticalOffset:new jre({screenLength:40})}:{symbolLayers:new Ce([sb.fromCIMSymbol(t)])})}static fromTextSymbol(t){return new _1({symbolLayers:new Ce([tT.fromTextSymbol(t)])})}};u([p({type:jre,json:{write:!0}})],b1.prototype,"verticalOffset",void 0),u([p(GAe)],b1.prototype,"callout",void 0),u([p({type:QAe,json:{origins:{"web-scene":{write:!0}}}})],b1.prototype,"symbolLayers",void 0),u([Ve({PointSymbol3D:"point-3d"},{readOnly:!0})],b1.prototype,"type",void 0),b1=_1=u([A("esri.symbols.PointSymbol3D")],b1);const Rm=b1;var xI;const eMe=Ce.ofType({base:null,key:"type",typeMap:{extrude:wAe,fill:eT,icon:sb,line:aM,object:Ure,text:tT,water:kAe}});let SI=xI=class extends rL{constructor(t){super(t),this.symbolLayers=new eMe,this.type="polygon-3d"}initialize(){const t=e=>{e.type==="line"&&I$(J.getLogger(this),"LineSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use FillSymbol3DLayer.outline instead.",version:"4.28"}),e.type==="text"&&I$(J.getLogger(this),"TextSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use Labels instead.",version:"4.28"})};for(const e of this.symbolLayers)t(e);this.addHandles(so(()=>this.symbolLayers,"after-add",({item:e})=>t(e),Yt))}clone(){return new xI({styleOrigin:q(this.styleOrigin),symbolLayers:q(this.symbolLayers),thumbnail:q(this.thumbnail)})}static fromJSON(t){var i;const e=new xI;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.at(0).type==="fill"&&e.symbolLayers.at(1).type==="line"){const r=e.symbolLayers.at(0),s=e.symbolLayers.at(1);!s.enabled||(i=t.symbolLayers)!=null&&i[1]&&t.symbolLayers[1].enable===!1||(r.outline={size:s.size,color:s.material!=null?s.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new xI({symbolLayers:new Ce([eT.fromSimpleFillSymbol(t)])})}};u([p({type:eMe,json:{write:!0}})],SI.prototype,"symbolLayers",void 0),u([Ve({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],SI.prototype,"type",void 0),SI=xI=u([A("esri.symbols.PolygonSymbol3D")],SI);const aw=SI;var tJ;const g8=new ni({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let w1=tJ=class extends ZAe{constructor(...t){super(...t),this.color=new Je([0,0,0,.25]),this.outline=new mh,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.style=t),e&&(r.outline=e),i&&(r.color=i),r}clone(){return new tJ({color:q(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};u([p()],w1.prototype,"color",void 0),u([p()],w1.prototype,"outline",void 0),u([Ve({esriSFS:"simple-fill"},{readOnly:!0})],w1.prototype,"type",void 0),u([p({type:g8.apiValues,json:{read:g8.read,write:g8.write}})],w1.prototype,"style",void 0),w1=tJ=u([A("esri.symbols.SimpleFillSymbol")],w1);const rT=w1;var iJ;const y8=new ni({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let tm=iJ=class extends KAe{constructor(...t){super(...t),this.color=new Je([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new mh}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string")return t;const s={};return t&&(s.style=t),e!=null&&(s.size=or(e)),i&&(s.outline=i),r&&(s.color=r),s}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new iJ({angle:this.angle,color:q(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(t=this.outline)==null?void 0:t.hash()}`}};u([p()],tm.prototype,"color",void 0),u([_e("color")],tm.prototype,"writeColor",null),u([Ve({esriSMS:"simple-marker"},{readOnly:!0})],tm.prototype,"type",void 0),u([p()],tm.prototype,"size",void 0),u([p({type:y8.apiValues,json:{read:y8.read,write:y8.write}})],tm.prototype,"style",void 0),u([p({type:String,json:{write:!0}})],tm.prototype,"path",null),u([p({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":mh}},json:{default:null,write:!0}})],tm.prototype,"outline",void 0),tm=iJ=u([A("esri.symbols.SimpleMarkerSymbol")],tm);const _g=tm;var rJ;let ks=rJ=class extends Qa{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new wG,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.text=t),e&&(r.font=e),i&&(r.color=i),r}writeLineWidth(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}castLineWidth(t){return or(t)}writeLineHeight(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}clone(){return new rJ({angle:this.angle,backgroundColor:q(this.backgroundColor),borderLineColor:q(this.borderLineColor),borderLineSize:this.borderLineSize,color:q(this.color),font:this.font&&this.font.clone(),haloColor:q(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t,e,i;return`${(t=this.backgroundColor)==null?void 0:t.hash()}.${this.borderLineColor}.${this.borderLineSize}.${(e=this.color)==null?void 0:e.hash()}.${this.font&&this.font.hash()}.${(i=this.haloColor)==null?void 0:i.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};u([p({type:Je,json:{write:!0}})],ks.prototype,"backgroundColor",void 0),u([p({type:Je,json:{write:!0}})],ks.prototype,"borderLineColor",void 0),u([p({type:Number,json:{write:!0},cast:or})],ks.prototype,"borderLineSize",void 0),u([p({type:wG,json:{write:!0}})],ks.prototype,"font",void 0),u([p({...NAe,json:{write:!0}})],ks.prototype,"horizontalAlignment",void 0),u([p({type:Boolean,json:{write:!0}})],ks.prototype,"kerning",void 0),u([p({type:Je,json:{write:!0}})],ks.prototype,"haloColor",void 0),u([p({type:Number,cast:or,json:{write:!0}})],ks.prototype,"haloSize",void 0),u([p({type:Boolean,json:{write:!0}})],ks.prototype,"rightToLeft",void 0),u([p({type:Boolean,json:{write:!0}})],ks.prototype,"rotated",void 0),u([p({type:String,json:{write:!0}})],ks.prototype,"text",void 0),u([Ve({esriTS:"text"},{readOnly:!0})],ks.prototype,"type",void 0),u([p({...FAe,json:{write:!0}})],ks.prototype,"verticalAlignment",void 0),u([p({type:Number,cast:or,json:{write:!0}})],ks.prototype,"xoffset",void 0),u([p({type:Number,cast:or,json:{write:!0}})],ks.prototype,"yoffset",void 0),u([p({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],ks.prototype,"angle",void 0),u([p({type:Number,json:{write:!0}})],ks.prototype,"width",void 0),u([p({type:Number})],ks.prototype,"lineWidth",void 0),u([_e("lineWidth")],ks.prototype,"writeLineWidth",null),u([ti("lineWidth")],ks.prototype,"castLineWidth",null),u([p(LAe)],ks.prototype,"lineHeight",void 0),u([_e("lineHeight")],ks.prototype,"writeLineHeight",null),ks=rJ=u([A("esri.symbols.TextSymbol")],ks);const lM=ks;var sJ;let vp=sJ=class extends Qa{constructor(t){super(t),this.color=null,this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=this.portal!=null?this.portal:vn.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e==null?void 0:e.portal,super.read(t,e)}clone(){return new sJ({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){const e=t&&"acceptedFormats"in t?t.acceptedFormats:["web"];return this._fetchSymbol({...t,acceptedFormats:e})}async fetchCIMSymbol(t){const e=await this.fetchSymbol({...t,acceptedFormats:["cim"]});if((e==null?void 0:e.type)!=="cim")throw new U("webstylesymbol:fetchCIMSymbol","Resolved web style symbol is not of type 'cim'");return e}async _fetchSymbol(t){const e=t!=null?t.cache:null,i=e?this._fetchCacheKey:null;if(e!=null){const o=i&&e.get(i);if(o)return o.clone()}const{resolveWebStyleSymbol:r}=await G(()=>import("./webStyleSymbolUtils-C0OVnxdp.js"),__vite__mapDeps([107,108]));gt(t);const s=r(this,{portal:this.portal},t);s.catch(o=>{J.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",o)});const n=await s;return e!=null&&e.set(i,n.clone()),n}};u([p({json:{write:!1}})],vp.prototype,"color",void 0),u([p({type:String,json:{write:!0}})],vp.prototype,"styleName",void 0),u([p({type:vn,json:{write:!1}})],vp.prototype,"portal",void 0),u([p({type:String,json:{read:Sie,write:fS}})],vp.prototype,"styleUrl",void 0),u([p({type:aP,json:{read:!1}})],vp.prototype,"thumbnail",void 0),u([p({type:String,json:{write:!0}})],vp.prototype,"name",void 0),u([Ve({styleSymbolReference:"web-style"},{readOnly:!0})],vp.prototype,"type",void 0),u([p()],vp.prototype,"_fetchCacheKey",null),vp=sJ=u([A("esri.symbols.WebStyleSymbol")],vp);const Vb=vp;function bWt(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function tMe(t){switch(t==null?void 0:t.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const nb={base:Qa,key:"type",typeMap:{"simple-fill":rT,"picture-fill":Gre,"picture-marker":nL,"simple-line":mh,"simple-marker":_g,text:lM,"label-3d":xG,"line-3d":iT,"mesh-3d":sL,"point-3d":Rm,"polygon-3d":aw,"web-style":Vb,cim:nw},errorContext:"symbol"},wWt={base:Qa,key:"type",typeMap:{"picture-marker":nL,"simple-marker":_g,"point-3d":Rm,cim:nw},errorContext:"symbol"},xWt={base:Qa,key:"type",typeMap:{"simple-line":mh,"line-3d":iT,cim:nw},errorContext:"symbol"},SWt={base:Qa,key:"type",typeMap:{"simple-fill":rT,"picture-fill":Gre,"polygon-3d":aw,cim:nw},errorContext:"symbol"},pQe={base:Qa,key:"type",typeMap:{"picture-marker":nL,"simple-marker":_g,text:lM,"web-style":Vb,cim:nw},errorContext:"symbol"},fQe=qA({types:nb}),iMe={base:Qa,key:"type",typeMap:{"simple-fill":rT,"picture-fill":Gre,"picture-marker":nL,"simple-line":mh,"simple-marker":_g,text:lM,"line-3d":iT,"mesh-3d":sL,"point-3d":Rm,"polygon-3d":aw,"web-style":Vb,cim:nw},errorContext:"symbol"},mQe={base:Qa,key:"type",typeMap:{text:lM,"label-3d":xG},errorContext:"symbol"},lde={base:Qa,key:"type",typeMap:{"line-3d":iT,"mesh-3d":sL,"point-3d":Rm,"polygon-3d":aw,"web-style":Vb,cim:nw},errorContext:"symbol"},gQe={base:Qa,key:"type",typeMap:{"label-3d":xG},errorContext:"symbol"},rMe=Ad(nb);var nJ;function yQe(t){if(!t)return null;const e={};for(const i in t){const r=pf(t[i]);r&&(e[i]=r)}return Object.keys(e).length!==0?e:null}function vQe(t){if(t==null)return null;const e={};for(const i in t){const r=t[i];r&&(e[i]=r.toJSON())}return Object.keys(e).length!==0?e:null}let Cc=nJ=class extends Nt.ClonableMixin(ee){constructor(t){super(t),this.isAggregate=!1,this.layer=null,this.origin=null,this.popupTemplate=null,this.sourceLayer=null,this._version=0,Object.defineProperty(this,"uid",{value:Td(),configurable:!0}),Object.defineProperty(this,"_lastMeshTransform",{value:{},configurable:!0,writable:!0,enumerable:!1}),arguments.length>1&&Kje(J.getLogger(this),"Graphic",{version:"4.30"})}initialize(){this._watchMeshGeometryChanges()}set aggregateGeometries(t){const e=this._get("aggregateGeometries");JSON.stringify(e)!==JSON.stringify(t)&&this._set("aggregateGeometries",t)}set attributes(t){const e=this._get("attributes");e!==t&&(this._set("attributes",t),this._notifyLayer("attributes",e,t))}set geometry(t){const e=this._get("geometry");e!==t&&(this._set("geometry",t),(t==null?void 0:t.type)!=="mesh"&&this._notifyLayer("geometry",e,t))}set symbol(t){const e=this._get("symbol");e!==t&&(this._set("symbol",t),this._notifyLayer("symbol",e,t))}get version(){return this._version}set visible(t){const e=this._get("visible");e!==t&&(this._set("visible",t),this._notifyLayer("visible",e,t))}cloneShallow(){return new nJ({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible,origin:this.origin})}getEffectivePopupTemplate(t=!1){if(this.popupTemplate)return this.popupTemplate;const e=this.origin&&"layer"in this.origin?this.origin.layer:null;for(const i of[e,this.sourceLayer,this.layer])if(i){if("popupTemplate"in i&&i.popupTemplate)return i.popupTemplate;if(t&&"defaultPopupTemplate"in i&&i.defaultPopupTemplate!=null)return i.defaultPopupTemplate}return null}getAttribute(t){var e;return(e=this.attributes)==null?void 0:e[t]}setAttribute(t,e){if(this.attributes){const i=this.getAttribute(t);this.attributes[t]=e,this._notifyLayer("attributes",i,e,t)}else this.attributes={[t]:e},this._notifyLayer("attributes",void 0,e,t)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){var t;return{aggregateGeometries:vQe(this.aggregateGeometries),geometry:this.geometry!=null?this.geometry.toJSON():null,symbol:this.symbol!=null?this.symbol.toJSON():null,attributes:ee.isSerializable(this.attributes)?this.attributes.toJSON():{...this.attributes},popupTemplate:((t=this.popupTemplate)==null?void 0:t.toJSON())??null}}notifyMeshTransformChanged(t={}){const{geometry:e}=this;if((e==null?void 0:e.type)==="mesh"){const i={origin:e.origin,transform:e.transform};this._notifyLayer("origin-transform",i,i,t.action)}}_notifyLayer(t,e,i,r){if(this._version++,!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:t,oldValue:e,newValue:i};t==="origin-transform"&&(s.action=r),t==="attributes"&&(s.attributeName=r),this.layer.graphicChanged(s)}_watchMeshGeometryChanges(){this.addHandles([bn(()=>{var t,e;return((t=this.geometry)==null?void 0:t.type)==="mesh"&&this.geometry.vertexSpace.origin?{localMatrix:(e=this.geometry.transform)==null?void 0:e.localMatrix,origin:this.geometry.vertexSpace.origin}:void 0},({localMatrix:t,origin:e})=>{this._lastMeshTransform.localMatrix===t&&this._lastMeshTransform.origin===e||(this._lastMeshTransform.localMatrix=t,this._lastMeshTransform.origin=e,this.notifyMeshTransformChanged())}),bn(()=>{var t;return((t=this.geometry)==null?void 0:t.type)==="mesh"?{vertexAttributes:this.geometry.vertexAttributes}:void 0},()=>{var e;const t=this.geometry;(t==null?void 0:t.type)==="mesh"&&t.vertexSpace.origin?(this._lastMeshTransform.localMatrix=(e=t.transform)==null?void 0:e.localMatrix,this._lastMeshTransform.origin=t.vertexSpace.origin):(this._lastMeshTransform.localMatrix=void 0,this._lastMeshTransform.origin=void 0),this._notifyLayer("geometry",this.geometry,this.geometry)},{equals:(t,e)=>t===e,sync:!0})])}};u([p({value:null,json:{read:yQe}})],Cc.prototype,"aggregateGeometries",null),u([p({value:null})],Cc.prototype,"attributes",null),u([p({value:null,types:eM,json:{read:pf}})],Cc.prototype,"geometry",null),u([p({type:Boolean})],Cc.prototype,"isAggregate",void 0),u([p({clonable:"reference"})],Cc.prototype,"layer",void 0),u([p({clonable:"reference"})],Cc.prototype,"origin",void 0),u([p({type:oM})],Cc.prototype,"popupTemplate",void 0),u([p({clonable:"reference"})],Cc.prototype,"sourceLayer",void 0),u([p({value:null,types:nb})],Cc.prototype,"symbol",null),u([p({clonable:!1,json:{read:!1,write:!1}})],Cc.prototype,"_version",void 0),u([p({type:Boolean,value:!0})],Cc.prototype,"visible",null),Cc=nJ=u([A("esri.Graphic")],Cc);const Pl=Cc,cde=Object.freeze(Object.defineProperty({__proto__:null,default:Pl},Symbol.toStringTag,{value:"Module"}));let lP=class extends iP{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};u([Vie({Type:Pl,ensureType:Ds(Pl)})],lP.prototype,"itemType",void 0),lP=u([A("esri.support.GraphicsCollection")],lP);let X0=class extends he{constructor(e){super(e),this.view=null,this.baseLayerViews=new Ce,this.referenceLayerViews=new Ce,this._loadingHandle=H(()=>{var i,r;return(r=(i=this.view)==null?void 0:i.map)==null?void 0:r.basemap},i=>{i&&i.load().catch(()=>{})},Ut)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){var e;return((e=this.view)==null?void 0:e.suspended)??!0}get updating(){var i,r,s;if((i=this.view)!=null&&i.suspended)return!1;const e=(s=(r=this.view)==null?void 0:r.map)==null?void 0:s.basemap;return!!(e!=null&&e.loaded)&&(this.baseLayerViews.some(n=>n.updating)||this.referenceLayerViews.some(n=>n.updating))}};u([p({constructOnly:!0})],X0.prototype,"view",void 0),u([p({readOnly:!0})],X0.prototype,"baseLayerViews",void 0),u([p({readOnly:!0})],X0.prototype,"referenceLayerViews",void 0),u([p({readOnly:!0})],X0.prototype,"suspended",null),u([p({type:Boolean,readOnly:!0})],X0.prototype,"updating",null),X0=u([A("esri.views.BasemapView")],X0);const _Qe=X0;function bQe(t){return"tryRecycleWith"in t}function wQe(t){return t!=null&&typeof t=="object"&&"layerViews"in t}let xQe=class{constructor(e,i,r){this.layer=e,this.view=i,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=ta(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,Qo(this._controller.signal,()=>{const s=new U("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(s)})}tryRecycle(e){if(!this.done||!this.layerView||!bQe(this.layerView))return null;const i=this.layer.type,r=this._controller.signal;for(let s=0;s<e.length;s++){const n=e[s];if(n.type!==i)continue;const o=this.layerView.tryRecycleWith(n,{signal:r});if(o){e.splice(s,1),this.layer=n;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(gt(this._controller.signal),n.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),n.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,h)=>Qo(this._controller.signal,()=>h(bi())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:i,view:r}=this;i.emit("layerview-destroy",{view:r,layerView:e}),r.emit("layerview-destroy",{layer:i,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){var s,n;if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:i,view:r}=this;this._map=r.map;try{let o,a;if(await i.load({signal:e}),i.prefetchResources&&await i.prefetchResources({signal:e}),TQe(i))o=await i.createLayerView(r,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new U("layer:view-not-supported","No layerview implementation was found");const h=await this.layerViewImporter.importLayerView(i);gt(e),o="default"in h?new h.default({layer:i,view:r}):new h({layer:i,view:r})}const l=()=>{a=Ji(a),o.destroyed||o.destroy(),o.layer=null,o.parent=null,o.view=null,this.done=!0};a=Qo(e,l),gt(e);try{await o.when()}catch(h){throw l(),h}if(!((n=(s=this._map)==null?void 0:s.allLayers)==null?void 0:n.includes(i)))return l(),void this._deferred.reject(new U("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=o,i.emit("layerview-create",{view:r,layerView:o}),r.emit("layerview-create",{layer:i,layerView:o}),this.done=!0,this._deferred.resolve(o)}catch(o){i.emit("layerview-create-error",{view:r,error:o}),r.emit("layerview-create-error",{layer:i,error:o}),this.done=!0,this._deferred.reject(new U("layerview:create-error","layerview creation failed",{layer:i,error:o}))}}},Rh=class extends he{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new rv,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var r;const i=(r=this.view.map)==null?void 0:r.allLayers;if(i)for(const s of i)this.layerViewImporter.hasLayerViewModule(s)&&this.layerViewImporter.importLayerView(s)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=ta(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(YA(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var l,c,h;if(this.destroyed)return;const i=this.view.map;if(this._map!==i&&(this.clear(),this._map=i),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const r=new Set,s=[],n=this.view.ready,o=d=>{if(d!=null){for(const f of d)if(f){r.add(f);const m=this._layerLayerViewInfoMap.get(f);m&&n?m.start():m||this._recyclingInfoMap.has(f)||s.push(f),"layers"in f&&f.layers&&o(f.layers)}}};for(const d of this._rootCollectionNames)o(Bm(this,d));for(const[d,f]of this._layerLayerViewInfoMap)if(!r.has(d)){this._layerLayerViewInfoMap.delete(f.layer);const m=f.tryRecycle(s);m?(this.notifyChange("updating"),this._recyclingInfoMap.set(f.layer,f),m.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(f.layer),this._layerLayerViewInfoMap.set(f.layer,f),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(f.layer),f.destroy(),this._reschedule()})):f.destroy()}for(const[d,f]of this._recyclingInfoMap)r.has(d)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(f.layer),f.destroy());for(const d of s)this._createLayerView(d);this._refreshCollections();const a=[(l=i==null?void 0:i.ground)==null?void 0:l.layers,(c=i==null?void 0:i.basemap)==null?void 0:c.baseLayers,(h=i==null?void 0:i.basemap)==null?void 0:h.referenceLayers,i==null?void 0:i.layers].filter(d=>!!d);r.forEach(d=>"layers"in d&&a.push(d.layers)),this.addHandles(a.map(d=>this._watchUpdatingTracking.addOnCollectionChange(()=>d,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.addHandles([so(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),H(()=>{const e=this.view,i=e==null?void 0:e.map;return[i==null?void 0:i.basemap,i==null?void 0:i.ground,i==null?void 0:i.layers,e==null?void 0:e.ready]},()=>this._reschedule(),Mt)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),l8(this._recyclingInfoMap),l8(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(bi()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||$m(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const i of this._layerLayerViewInfoMap.values())i.done||++e;return e}clear(){this.destroyed||(l8(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new U("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}isCreatingLayerViewsForLayer(e,i){var n;this.commitProperty("updatingRemaining");const r=this._layerLayerViewInfoMap.get(e);if(!(r!=null&&r.done))return!0;const s=r.layerView;return!(!s||!i||s.parent===i)||!!(r.done&&s&&"layers"in e&&((n=e.layers)!=null&&n.length))&&e.layers.some(o=>this.isCreatingLayerViewsForLayer(o,s))}_refreshCollections(){for(const[e,i]of this._layersToLayerViews)this._populateLayerViewsOwners(Bm(this,e),Bm(this,i),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,i,r){if(!e||!i)return void(i&&i.removeAll());let s=0;for(const n of e){const o=this._layerLayerViewInfoMap.get(n);if(!(o!=null&&o.layerView))continue;const a=o.layerView;a.layer=n,a.parent=r,i.at(s)!==a&&i.splice(s,0,a),"layers"in n&&wQe(a)&&this._populateLayerViewsOwners(n.layers,a.layerViews,a),s+=1}s<i.length&&i.splice(s,i.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const i=new xQe(e,this.view,this.layerViewImporter);i.promise.then(()=>this._refreshCollections(),r=>{r&&(es(r)||r.name==="cancelled:layerview-create")||J.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:r}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,i),this.view.ready&&i.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};u([p()],Rh.prototype,"_workPromise",void 0),u([p({readOnly:!0})],Rh.prototype,"_watchUpdatingTracking",void 0),u([p({readOnly:!0})],Rh.prototype,"_layersToLayerViews",null),u([p({readOnly:!0})],Rh.prototype,"_rootCollectionNames",null),u([p()],Rh.prototype,"layerViewImporter",void 0),u([p()],Rh.prototype,"supportsGround",void 0),u([p({readOnly:!0})],Rh.prototype,"updating",null),u([p({readOnly:!0})],Rh.prototype,"updatingRemaining",null),u([p({constructOnly:!0})],Rh.prototype,"view",void 0),Rh=u([A("esri.views.LayerViewManager")],Rh);const SQe=Rh;function TQe(t){return t.createLayerView!==fG.prototype.createLayerView}let Au=class extends he{constructor(e){super(e),this.factor=1.5,this.offset=xo(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};u([p({type:Number})],Au.prototype,"factor",void 0),u([p({nonNullable:!0})],Au.prototype,"offset",void 0),u([p()],Au.prototype,"position",void 0),u([p({type:Number,range:{min:0}})],Au.prototype,"size",void 0),u([p()],Au.prototype,"maskUrl",void 0),u([p()],Au.prototype,"maskEnabled",void 0),u([p()],Au.prototype,"overlayUrl",void 0),u([p()],Au.prototype,"overlayEnabled",void 0),u([p({readOnly:!0})],Au.prototype,"version",null),u([p({type:Boolean})],Au.prototype,"visible",void 0),Au=u([A("esri.views.Magnifier")],Au);const sMe=Au;let i5=class{constructor(e){this._observable=new qD,this._map=new Map(e)}get size(){return Pt(this._observable),this._map.size}clear(){this._map.size>0&&(this._map.clear(),this._observable.notify())}delete(e){const i=this._map.delete(e);return i&&this._observable.notify(),i}entries(){return Pt(this._observable),this._map.entries()}forEach(e,i){Pt(this._observable),this._map.forEach((r,s)=>e.call(i,r,s,this),i)}get(e){return Pt(this._observable),this._map.get(e)}has(e){return Pt(this._observable),this._map.has(e)}keys(){return Pt(this._observable),this._map.keys()}set(e,i){return this._map.set(e,i),this._observable.notify(),this}values(){return Pt(this._observable),this._map.values()}[Symbol.iterator](){return Pt(this._observable),this._map[Symbol.iterator]()}[Symbol.dispose](){this._observable.destroy()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}};var oJ;let Mx=oJ=class extends ee{constructor(t){super(t),this.name=null,this.code=null}clone(){return new oJ({name:this.name,code:this.code})}};u([p({type:String,json:{write:{isRequired:!0}}})],Mx.prototype,"name",void 0),u([p({type:[String,Number],json:{write:{isRequired:!0}}})],Mx.prototype,"code",void 0),Mx=oJ=u([A("esri.layers.support.CodedValue")],Mx);const EQe=new ni({inherited:"inherited",codedValue:"coded-value",range:"range"});let TI=class extends ee{constructor(e){super(e),this.name=null,this.type=null}};u([p({type:String,json:{write:!0}})],TI.prototype,"name",void 0),u([Ve(EQe),p({json:{write:{isRequired:!0}}})],TI.prototype,"type",void 0),TI=u([A("esri.layers.support.Domain")],TI);const SG=TI;var aJ;let EI=aJ=class extends SG{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const i=String(t);this.codedValues.some(r=>(String(r.code)===i&&(e=r.name),!!e))}return e}clone(){return new aJ({codedValues:q(this.codedValues),name:this.name})}};u([p({type:[Mx],json:{write:{isRequired:!0}}})],EI.prototype,"codedValues",void 0),u([Ve({codedValue:"coded-value"})],EI.prototype,"type",void 0),EI=aJ=u([A("esri.layers.support.CodedValueDomain")],EI);const TG=EI;var lJ;let r5=lJ=class extends SG{constructor(t){super(t),this.type="inherited"}clone(){return new lJ}};u([Ve({inherited:"inherited"})],r5.prototype,"type",void 0),r5=lJ=u([A("esri.layers.support.InheritedDomain")],r5);const nMe=r5;var cJ;let jE=cJ=class extends SG{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new cJ({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};u([p({json:{type:[Number],read:{source:"range",reader:(t,e)=>{var i;return(i=e.range)==null?void 0:i[1]}},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,i){e[i]=[this.minValue||0,t]},isRequired:!0}}})],jE.prototype,"maxValue",void 0),u([p({json:{type:[Number],read:{source:"range",reader:(t,e)=>{var i;return(i=e.range)==null?void 0:i[0]}},write:{target:"range",writer(t,e,i){e[i]=[t,this.maxValue||0]},isRequired:!0}}})],jE.prototype,"minValue",void 0),u([Ve({range:"range"})],jE.prototype,"type",void 0),jE=cJ=u([A("esri.layers.support.RangeDomain")],jE);const oMe=jE,aMe={key:"type",base:SG,typeMap:{range:oMe,"coded-value":TG,inherited:nMe}};function EG(t){if(!(t!=null&&t.type))return null;switch(t.type){case"range":return oMe.fromJSON(t);case"codedValue":return TG.fromJSON(t);case"inherited":return nMe.fromJSON(t)}return null}const Hre=new ni({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});var uJ;const CQe=new ni({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let hl=uJ=class extends ee{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=void 0,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return(i==null?void 0:i.value)??null}readValueType(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return i?CQe.fromJSON(i.fieldValueType):null}clone(){var t;return new uJ({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:((t=this.domain)==null?void 0:t.clone())??null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};u([p({type:String,json:{write:!0}})],hl.prototype,"alias",void 0),u([p({type:[String,Number],json:{write:{allowNull:!0}}})],hl.prototype,"defaultValue",void 0),u([p()],hl.prototype,"description",void 0),u([ve("description")],hl.prototype,"readDescription",null),u([p({types:aMe,json:{read:{reader:EG},write:!0}})],hl.prototype,"domain",void 0),u([p({type:Boolean,json:{write:!0}})],hl.prototype,"editable",void 0),u([p({type:Ii,json:{write:{overridePolicy:t=>({enabled:Number.isFinite(t)})}}})],hl.prototype,"length",void 0),u([p({type:String,json:{write:!0}})],hl.prototype,"name",void 0),u([p({type:Boolean,json:{write:!0}})],hl.prototype,"nullable",void 0),u([Ve(Hre)],hl.prototype,"type",void 0),u([p()],hl.prototype,"valueType",void 0),u([ve("valueType",["description"])],hl.prototype,"readValueType",null),u([p({type:Boolean,json:{read:!1}})],hl.prototype,"visible",void 0),hl=uJ=u([A("esri.layers.support.Field")],hl);const CG=hl;var hJ;let GE=hJ=class extends ee{constructor(t){super(t),this.type="map-layer"}clone(){const{mapLayerId:t,gdbVersion:e}=this;return new hJ({mapLayerId:t,gdbVersion:e})}};u([Ve({mapLayer:"map-layer"}),p({json:{write:{isRequired:!0}}})],GE.prototype,"type",void 0),u([p({type:Ii,json:{write:{isRequired:!0}}})],GE.prototype,"mapLayerId",void 0),u([p({type:String,json:{write:!0}})],GE.prototype,"gdbVersion",void 0),GE=hJ=u([A("esri.layers.support.source.MapLayerSource")],GE);var dJ;let sy=dJ=class extends ee{constructor(t){super(t),this.type="query-table"}clone(){const{workspaceId:t,query:e,oidFields:i,spatialReference:r,geometryType:s}=this,n={workspaceId:t,query:e,oidFields:i,spatialReference:(r==null?void 0:r.clone())??void 0,geometryType:s};return new dJ(n)}};u([Ve({queryTable:"query-table"}),p({json:{write:{isRequired:!0}}})],sy.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],sy.prototype,"workspaceId",void 0),u([p({type:String,json:{write:!0}})],sy.prototype,"query",void 0),u([p({type:String,json:{write:!0}})],sy.prototype,"oidFields",void 0),u([p({type:Oe,json:{write:!0}})],sy.prototype,"spatialReference",void 0),u([Ve(FEe)],sy.prototype,"geometryType",void 0),sy=dJ=u([A("esri.layers.support.source.QueryTableDataSource")],sy);var pJ;let HE=pJ=class extends ee{constructor(t){super(t),this.type="raster"}clone(){const{workspaceId:t,dataSourceName:e}=this;return new pJ({workspaceId:t,dataSourceName:e})}};u([Ve({raster:"raster"}),p({json:{write:{isRequired:!0}}})],HE.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],HE.prototype,"dataSourceName",void 0),u([p({type:String,json:{write:!0}})],HE.prototype,"workspaceId",void 0),HE=pJ=u([A("esri.layers.support.source.RasterDataSource")],HE);var fJ;let x1=fJ=class extends ee{constructor(t){super(t),this.type="table"}clone(){const{workspaceId:t,gdbVersion:e,dataSourceName:i}=this;return new fJ({workspaceId:t,gdbVersion:e,dataSourceName:i})}};u([Ve({table:"table"}),p({json:{write:{isRequired:!0}}})],x1.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],x1.prototype,"workspaceId",void 0),u([p({type:String,json:{write:!0}})],x1.prototype,"gdbVersion",void 0),u([p({type:String,json:{write:!0}})],x1.prototype,"dataSourceName",void 0),x1=fJ=u([A("esri.layers.support.source.TableDataSource")],x1);var mJ,gJ;const $Qe=Oo()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let Mu=mJ=class extends ee{constructor(t){super(t),this.type="join-table"}readLeftTableSource(t,e,i){return ude()(t,e,i)}castLeftTableSource(t){return Ad(yJ(),t)}readRightTableSource(t,e,i){return ude()(t,e,i)}castRightTableSource(t){return Ad(yJ(),t)}clone(){const{leftTableKey:t,rightTableKey:e,leftTableSource:i,rightTableSource:r,joinType:s}=this,n={leftTableKey:t,rightTableKey:e,leftTableSource:(i==null?void 0:i.clone())??void 0,rightTableSource:(r==null?void 0:r.clone())??void 0,joinType:s};return new mJ(n)}};u([Ve({joinTable:"join-table"}),p({json:{write:{isRequired:!0}}})],Mu.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],Mu.prototype,"leftTableKey",void 0),u([p({type:String,json:{write:!0}})],Mu.prototype,"rightTableKey",void 0),u([p({json:{write:!0}})],Mu.prototype,"leftTableSource",void 0),u([ve("leftTableSource")],Mu.prototype,"readLeftTableSource",null),u([ti("leftTableSource")],Mu.prototype,"castLeftTableSource",null),u([p({json:{write:!0}})],Mu.prototype,"rightTableSource",void 0),u([ve("rightTableSource")],Mu.prototype,"readRightTableSource",null),u([ti("rightTableSource")],Mu.prototype,"castRightTableSource",null),u([Ve($Qe)],Mu.prototype,"joinType",void 0),Mu=mJ=u([A("esri.layers.support.source.JoinTableDataSource")],Mu);let v8=null;function ude(){return v8||(v8=qA({types:yJ()})),v8}let _8=null;function yJ(){return _8||(_8={key:"type",base:null,typeMap:{"data-layer":Lp,"map-layer":GE}}),_8}const AQe={key:"type",base:null,typeMap:{"join-table":Mu,"query-table":sy,raster:HE,table:x1}};let Lp=gJ=class extends ee{constructor(t){super(t),this.type="data-layer"}clone(){const{fields:t,dataSource:e}=this;return new gJ({fields:t,dataSource:e})}};u([Ve({dataLayer:"data-layer"}),p({json:{write:{isRequired:!0}}})],Lp.prototype,"type",void 0),u([p({type:[CG],json:{write:!0}})],Lp.prototype,"fields",void 0),u([p({types:AQe,json:{write:!0}})],Lp.prototype,"dataSource",void 0),Lp=gJ=u([A("esri.layers.support.source.DataLayerSource")],Lp),Lp.from=Ds(Lp);let S1=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};u([p({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.onFields!=null&&this.onFields.length>0}}}}})],S1.prototype,"onFields",void 0),u([p({type:String,json:{write:!0}})],S1.prototype,"operator",void 0),u([p({type:String,json:{write:!0}})],S1.prototype,"searchTerm",void 0),u([p({type:String,json:{write:!0}})],S1.prototype,"searchType",void 0),S1=u([A("esri.rest.support.FullTextSearch")],S1);const MQe=S1;var vJ;const hde=new ni({upperLeft:"upper-left",lowerLeft:"lower-left"});let T1=vJ=class extends ee{constructor(t){super(t),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new vJ(q({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};u([p({type:_i,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],T1.prototype,"extent",void 0),u([p({type:["view","edit"],json:{write:!0}})],T1.prototype,"mode",void 0),u([p({type:String,json:{read:hde.read,write:hde.write}})],T1.prototype,"originPosition",void 0),u([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],T1.prototype,"tolerance",void 0),T1=vJ=u([A("esri.rest.support.QuantizationParameters")],T1);const lMe=T1,OQe=new ni({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"});var _J;const dde=new ni({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let _p=_J=class extends ee{constructor(t){super(t),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(t,e){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(e.statisticParameters=q(t))}clone(){return new _J({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:q(this.statisticParameters)})}};u([p({type:Number,json:{write:!0}})],_p.prototype,"maxPointCount",void 0),u([p({type:Number,json:{write:!0}})],_p.prototype,"maxRecordCount",void 0),u([p({type:Number,json:{write:!0}})],_p.prototype,"maxVertexCount",void 0),u([p({type:String,json:{write:!0}})],_p.prototype,"onStatisticField",void 0),u([p({type:String,json:{write:!0}})],_p.prototype,"outStatisticFieldName",void 0),u([p({type:String,json:{read:{source:"statisticType",reader:dde.read},write:{target:"statisticType",writer:dde.write}}})],_p.prototype,"statisticType",void 0),u([p({type:Object})],_p.prototype,"statisticParameters",void 0),u([_e("statisticParameters")],_p.prototype,"writeStatisticParameters",null),_p=_J=u([A("esri.rest.support.StatisticDefinition")],_p);const IQe=_p;var s5;const RQe=new ni({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Rt=s5=class extends ee{static from(t){return GA(s5,t)}constructor(t){super(t),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.returnTrueCurves=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(t){return typeof t=="number"||typeof t=="object"?t:null}writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeParameterValues(t,e){if(t){const i={};for(const r in t){const s=t[r];Array.isArray(s)?i[r]=s.map(n=>n instanceof Date?n.getTime():n):s instanceof Date?i[r]=s.getTime():i[r]=s}e.parameterValues=i}}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,e.where="1=1"}writeWhere(t,e){e.where=t||"1=1"}clone(){return new s5(q({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:this.historicMoment!=null?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,returnTrueCurves:this.returnTrueCurves,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};Rt.MAX_MAX_RECORD_COUNT_FACTOR=5,u([p({json:{write:!0}})],Rt.prototype,"aggregateIds",void 0),u([p({type:Boolean,json:{write:!0}})],Rt.prototype,"cacheHint",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],Rt.prototype,"compactGeometryEnabled",void 0),u([p({json:{write:!0}})],Rt.prototype,"datumTransformation",void 0),u([ti("datumTransformation")],Rt.prototype,"castDatumTransformation",null),u([p({type:Boolean,json:{default:!1,write:!0}})],Rt.prototype,"defaultSpatialReferenceEnabled",void 0),u([p({type:Number,json:{write:!0}})],Rt.prototype,"distance",void 0),u([p({type:Lp,json:{write:!0}})],Rt.prototype,"dynamicDataSource",void 0),u([p({type:String,json:{write:!0}})],Rt.prototype,"formatOf3DObjects",void 0),u([p({type:[MQe],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.fullText!=null&&this.fullText.length>0}}}}})],Rt.prototype,"fullText",void 0),u([p({type:String,json:{write:!0}})],Rt.prototype,"gdbVersion",void 0),u([p({types:eM,json:{read:pf,write:!0}})],Rt.prototype,"geometry",void 0),u([p({type:Number,json:{write:!0}})],Rt.prototype,"geometryPrecision",void 0),u([p({type:[String],json:{write:!0}})],Rt.prototype,"groupByFieldsForStatistics",void 0),u([p({type:String,json:{write:!0}})],Rt.prototype,"having",void 0),u([p({type:Date})],Rt.prototype,"historicMoment",void 0),u([_e("historicMoment")],Rt.prototype,"writeHistoricMoment",null),u([p({type:Number,json:{write:!0}})],Rt.prototype,"maxAllowableOffset",void 0),u([p({type:Number,cast:t=>t<1?1:t>Rt.MAX_MAX_RECORD_COUNT_FACTOR?Rt.MAX_MAX_RECORD_COUNT_FACTOR:t,json:{write:{overridePolicy:t=>({enabled:t>1})}}})],Rt.prototype,"maxRecordCountFactor",void 0),u([p({type:["xyFootprint"],json:{write:!0}})],Rt.prototype,"multipatchOption",void 0),u([p({type:Number,json:{read:{source:"resultRecordCount"}}})],Rt.prototype,"num",void 0),u([p({json:{write:!0}})],Rt.prototype,"objectIds",void 0),u([p({type:[String],json:{write:!0}})],Rt.prototype,"orderByFields",void 0),u([p({type:[String],json:{write:!0}})],Rt.prototype,"outFields",void 0),u([p({type:Oe,json:{name:"outSR",write:!0}})],Rt.prototype,"outSpatialReference",void 0),u([p({type:[IQe],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.outStatistics!=null&&this.outStatistics.length>0}}}}})],Rt.prototype,"outStatistics",void 0),u([p({json:{write:!0}})],Rt.prototype,"parameterValues",void 0),u([_e("parameterValues")],Rt.prototype,"writeParameterValues",null),u([p({type:Fe,json:{write:!0}})],Rt.prototype,"pixelSize",void 0),u([p({type:lMe,json:{write:!0}})],Rt.prototype,"quantizationParameters",void 0),u([p({type:[Object],json:{write:!0}})],Rt.prototype,"rangeValues",void 0),u([p({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],Rt.prototype,"relationParameter",void 0),u([p({type:String,json:{write:!0}})],Rt.prototype,"resultType",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],Rt.prototype,"returnCentroid",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],Rt.prototype,"returnDistinctValues",void 0),u([p({type:Boolean,json:{default:!0,write:!0}})],Rt.prototype,"returnExceededLimitFeatures",void 0),u([p({type:Boolean,json:{write:!0}})],Rt.prototype,"returnGeometry",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],Rt.prototype,"returnQueryGeometry",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],Rt.prototype,"returnM",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Rt.prototype,"returnZ",void 0),u([p({type:Boolean,json:{write:!0}})],Rt.prototype,"returnTrueCurves",void 0),u([p({type:Oe,json:{write:!0}})],Rt.prototype,"sourceSpatialReference",void 0),u([Ve(OQe,{ignoreUnknown:!1,name:"spatialRel"})],Rt.prototype,"spatialRelationship",void 0),u([p({type:Number,json:{read:{source:"resultOffset"}}})],Rt.prototype,"start",void 0),u([_e("start"),_e("num")],Rt.prototype,"writeStart",null),u([p({type:String,json:{write:!0}})],Rt.prototype,"sqlFormat",void 0),u([p({type:String,json:{write:!0}})],Rt.prototype,"text",void 0),u([p({type:Eo,json:{write:!0}})],Rt.prototype,"timeExtent",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],Rt.prototype,"timeReferenceUnknownClient",void 0),u([Ve(RQe,{ignoreUnknown:!1}),p({json:{write:{overridePolicy(t){return{enabled:!!t&&this.distance!=null}}}}})],Rt.prototype,"units",void 0),u([p({type:String,json:{write:{overridePolicy(t){return{enabled:t!=null||this.start!=null&&this.start>0}}}}})],Rt.prototype,"where",void 0),u([_e("where")],Rt.prototype,"writeWhere",null),Rt=s5=u([A("esri.rest.support.Query")],Rt);const ng=Rt;function RN(t){return!!(t!=null&&typeof t=="object"&&"createQuery"in t&&t.createQuery&&"on"in t&&t.on)}let im=class extends Ss.EventedAccessor{constructor(e){super(e),this._selectionMap=new i5,this._sources=new Ce,this._trashCan=[],this._layerEditHandles=new Ce,this._vizTaskId=0,this.showHighlight=!0,this.highlightName="default"}initialize(){this.addHandles([H(()=>[this.view,this.showHighlight],()=>this._refreshVisualization()),so(()=>this.sources,"change",i=>{const r=this._selectionMap;for(const s of i.removed)r.delete(s);this._refreshListeners(),this._refreshVisualization()},{onListenerAdd:()=>this._refreshListeners()})]);const e=new Ce;this.view.when().then(()=>{this.view.map&&(this.view.map.allLayers.flatten(i=>"sublayers"in i&&i.sublayers?i.sublayers:null).forEach(i=>{(RN(i)&&!vYe(i)||id(i))&&e.add(i)}),this.sources=e)})}destroy(){this._layerEditHandles.drain(Ji)}get selections(){return Array.from(this._selectionMap.entries()).map(e=>{const[i,r]=e;return{layer:i,selection:[...r.selection]}})}get count(){let e=0;for(const i of this._selectionMap.values())e+=i.selection.length;return e}get hasSelection(){return this.count>0}get sources(){return this._sources}set sources(e){vf(e,this._sources)}async getSelectedFeatures(e,i={},r="layerView"){const{view:s,selections:n}=this,o=(e!==void 0?n.filter(a=>e.includes(a.layer)):n).filter(a=>a.selection.length>0).map(async a=>{const{layer:l,selection:c}=a,h=id(l)?l.parent:l;if(h==null||!fde(h))return null;if(r==="layer")return mde(h,c,i);if(pde(h))return null;const d=await s.whenLayerView(h).catch(()=>null);return d?mde(d,c,i):null});return(await Promise.all(o)).filter(a=>a!=null)}updateSelection(e){const i=new Map;for(const[n,o]of this._selectionMap)i.set(n,[...o.selection]);let r=!1;const s=e.current.concat(e.added);for(const n of s){const o=n.sourceLayer,a=n.getObjectId();if(this.sources.includes(o)&&(RN(o)||id(o))&&a!==null){const l=tw(i,o,()=>[]);l.includes(a)||(l.push(a),r=!0)}}for(const n of e.removed){const o=n.sourceLayer,a=n.getObjectId();if(this.sources.includes(o)&&(RN(o)||id(o))&&a!==null){const l=i.get(o),c=l==null?void 0:l.indexOf(a);c!==void 0&&c>=0&&(l==null||l.splice(c,1),r=!0)}}if(r){const{_selectionMap:n,_trashCan:o}=this,a=[];for(const[l,c]of i){const h=n.get(l);h!==void 0&&o.push(h),n.set(l,{selection:c}),a.push({layer:l,selection:c,...vW(h!==void 0?h.selection:[],c)})}this._onSelectionChange(a)}}setSelection(e,i){this._setSelection(e,i)}getSelection(e){const i=this._selectionMap.get(e);return i==null?void 0:i.selection}appendToSelection(e,i){const r=this._selectionMap.get(e),s=r!==void 0?[...r.selection]:[];for(const n of i)s.includes(n)||s.push(n);this._setSelection(e,s)}removeFromSelection(e,i){const r=this._selectionMap.get(e);if(!r)return;const s=[];for(const n of r.selection)i.includes(n)||s.push(n);this._setSelection(e,s)}toggleInSelection(e,i){const r=this._selectionMap.get(e);if(!r||r.selection.length===0)return void this._setSelection(e,i);const s=new Set(r.selection),n=new Set(i),o=DGe(s,n);this._setSelection(e,Array.from(o))}clear(){const e=this._selectionMap.values();this._trashCan.push(...e);const i=[];for(const[r,s]of this._selectionMap.entries())i.push({layer:r,added:[],removed:[...s.selection],selection:[]});this._selectionMap.clear(),this._onSelectionChange(i)}_onSelectionChange(e){this._refreshVisualization(),this.emit("selection-change",{view:this.view,changes:e})}_refreshVisualization(){var o;if(this.view==null||this.sources==null)return;for(this._vizTaskId++;this._trashCan.length>0;){const a=this._trashCan.pop();(o=a==null?void 0:a.highlightHandle)==null||o.remove()}const{sources:e,view:i,_selectionMap:r,showHighlight:s}=this,n=this._vizTaskId;for(const a of e){const l=r.get(a),c=id(a)?a.parent:a;if(c!=null&&fde(c)){if(pde(c))continue;i.whenLayerView(c).then(h=>{var d;(d=l==null?void 0:l.highlightHandle)==null||d.remove(),l!=null&&s&&n===this._vizTaskId&&"highlight"in h&&typeof h.highlight=="function"&&l.selection.length>0&&(l.highlightHandle=h.highlight(l.selection,this.highlightName))}).catch(()=>{var h;(h=l==null?void 0:l.highlightHandle)==null||h.remove()})}}}_refreshListeners(){this._layerEditHandles.drain(Ji);for(const e of this.sources){const i=id(e)?e.parent:e;if(i!=null&&RN(i)){const r=i.on("edits",s=>{this._handleEditChanges(s,e)});this._layerEditHandles.push(r)}}}_handleEditChanges(e,i){if(e.deletedFeatures!==void 0&&e.deletedFeatures.length>0&&this._selectionMap.has(i)){const r=e.deletedFeatures.filter(s=>s.error==null).map(s=>s.objectId).filter(df);this.removeFromSelection(i,r)}}_setSelection(e,i){if(!this.sources.includes(e))throw new Error(`Cannot set selection on layer ${e.title} because it is not in 'sources'`);const r=this._selectionMap.get(e);if(r===void 0||!DQe(r,{selection:i})){r!==void 0&&this._trashCan.push(r),this._selectionMap.set(e,{selection:[...i]});const s={layer:e,selection:[...i],...vW(r!==void 0?r.selection:[],i)};this._onSelectionChange([s])}}};u([p({readOnly:!0,nonNullable:!0})],im.prototype,"selections",null),u([p({readOnly:!0,nonNullable:!0})],im.prototype,"count",null),u([p({constructOnly:!0,nonNullable:!0})],im.prototype,"view",void 0),u([p({readOnly:!0,nonNullable:!0})],im.prototype,"hasSelection",null),u([p()],im.prototype,"showHighlight",void 0),u([p()],im.prototype,"sources",null),u([p()],im.prototype,"highlightName",void 0),im=u([A("esri.views.SelectionManager")],im);const pde=t=>{var e;return id(t)?((e=t.parent)==null?void 0:e.isTable)===!0:t.isTable},PQe=t=>t.layer!==void 0,fde=t=>(t==null?void 0:t.when)!==void 0,DQe=(t,e)=>{if(t==null&&e==null)return!0;if(t!=null&&e==null||t==null&&e!=null)return!1;if(t!=null&&e!=null&&t.selection!=null&&e.selection!=null){const i=[...t.selection],r=[...e.selection];if(i.length!==r.length)return!1;i.sort(),r.sort();for(let s=0;s<i.length;s++)if(i[s]!==r[s])return!1}return!0},mde=async(t,e,i={})=>{let r;if(PQe(t)){const s=t;r=s===void 0?null:await s.queryFeatures(new ng({...i,objectIds:e})).then(n=>({data:n,layer:t.layer}))}else{const s=t;r=s===void 0?null:await s.queryFeatures(new ng({...i,objectIds:e})).then(n=>({data:n,layer:s}))}return r},LQe=im;let CI=class extends Nt.ClonableMixin(he){constructor(e){super(e),this.accentColor=new Je([255,127,0]),this.textColor=new Je([255,255,255])}};u([p({type:Je,nonNullable:!0})],CI.prototype,"accentColor",void 0),u([p({type:Je,nonNullable:!0})],CI.prototype,"textColor",void 0),CI=u([A("esri.views.Theme")],CI);const bJ=CI;var gde;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(gde||(gde={}));const cMe=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],uMe={};function hMe(t){return!!uMe[t]}function NQe(t){for(const e of t)if(!hMe(e))return!1;return!0}cMe.forEach(t=>{uMe[t]=!0});let dMe=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:i,priority:r},s)=>{var n;return(n=this.inputManager)==null?void 0:n.installHandlers(s,[i],r)})}disconnect(){this.inputManager&&this._handlers.forEach((e,i)=>{var r;return(r=this.inputManager)==null?void 0:r.uninstallHandlers(i)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,i,r,s){const n=Array.isArray(e)?e:e.split(",");if(!NQe(n))return n.some(hMe)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(i)?a=i:(o=i,a=[]),typeof r=="function"?o=r:s=r,s=s??Vm.DEFAULT;const l=this._createUniqueGroupName(),c=new FQe(this.view,n,a,o);this._handlers.set(l,{handler:c,priority:s});for(const h of n){const d=this._handlerCounts.get(h)||0;this._handlerCounts.set(h,d+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),Pi(()=>this._removeHandler(l,n))}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,i){if(this._handlers.has(e)){this._handlers.delete(e);for(const r of i){const s=this._handlerCounts.get(r);s===void 0||(s===1?this._handlerCounts.delete(r):this._handlerCounts.set(r,s-1))}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},FQe=class extends ls{constructor(e,i,r,s){super(!0),this._latestDragStart=void 0,this.view=e;for(const n of i)switch(n){case"click":this.registerIncoming("click",r,o=>s(UQe(e,o)));break;case"double-click":this.registerIncoming("double-click",r,o=>s(BQe(e,o)));break;case"immediate-click":this.registerIncoming("immediate-click",r,o=>s(VQe(e,o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,o=>s(jQe(e,o)));break;case"hold":this.registerIncoming("hold",r,o=>s(GQe(e,o)));break;case"drag":this.registerIncoming("drag",r,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",r,o=>s(HQe(o)));break;case"key-up":this.registerIncoming("key-up",r,o=>s(qQe(o)));break;case"pointer-down":this.registerIncoming("pointer-down",r,o=>s(jM(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",r,o=>s(jM(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",r,o=>s(jM(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,o=>s(WQe(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,o=>s(ZQe(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,o=>s(jM(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,o=>s(jM(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",r,o=>{s(YQe(o))});break;case"focus":this.registerIncoming("focus",r,o=>{s(kQe(o))});break;case"blur":this.registerIncoming("blur",r,o=>{s(zQe(o))})}}_wrapDrag(e){const i=e.data,{x:r,y:s}=i.center,{action:n,pointerType:o,button:a}=i;if(n==="start"&&(this._latestDragStart=i),!this._latestDragStart)return;const l=i.pointer.native,c=i.buttons,{cancelable:h,timestamp:d}=e,f={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return n==="end"&&(this._latestDragStart=void 0),{type:"drag",action:n,x:r,y:s,origin:f,pointerType:o,button:a,buttons:c,radius:i.radius,angle:Ao(i.angle),native:l,timestamp:d,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}};function kQe(t){return{type:"focus",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function zQe(t){return{type:"blur",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function UQe(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:h,screenPoint:xo(n,o),mapPoint:oL(t,n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}function BQe(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"double-click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:h,mapPoint:oL(t,n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}function VQe(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:h,timestamp:d}=e;return{type:"immediate-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:d,mapPoint:oL(t,n,o),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}function jQe(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:h,timestamp:d}=e;return{type:"immediate-double-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:d,mapPoint:oL(t,n,o),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}function GQe(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:oL(t,n,o),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:h=>e.async(h),preventDefault:()=>e.preventDefault()}}function oL(t,e,i){return t.toMap(xo(e,i),{exclude:[]})}function HQe(t){const{key:e,repeat:i,native:r}=t.data,{cancelable:s,timestamp:n}=t;return{type:"key-down",key:e,repeat:i,native:r,timestamp:n,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:o=>t.async(o),preventDefault:()=>t.preventDefault()}}function qQe(t){const{key:e,native:i}=t.data,{cancelable:r,timestamp:s}=t;return{type:"key-up",key:e,native:i,timestamp:s,cancelable:r,stopPropagation:()=>t.stopPropagation(),async:n=>t.async(n),preventDefault:()=>t.preventDefault()}}function jM(t,e){const{x:i,y:r,button:s,buttons:n,native:o,eventId:a}=t.data,l=o.pointerId,c=o.pointerType,{cancelable:h,timestamp:d}=t;return{type:e,x:i,y:r,pointerId:l,pointerType:c,button:s,buttons:n,native:o,timestamp:d,eventId:a,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:f=>t.async(f),preventDefault:()=>t.preventDefault()}}function WQe(t){const{x:e,y:i,buttons:r,native:s,eventId:n}=t.data.currentEvent,{button:o}=t.data.startEvent,a=t.data.startEvent.native.pointerId,l=t.data.startEvent.native.pointerType,c=t.data.action,h={x:t.data.startEvent.x,y:t.data.startEvent.y},{cancelable:d,timestamp:f}=t;return{type:"pointer-drag",x:e,y:i,pointerId:a,pointerType:l,button:o,buttons:r,action:c,origin:h,native:s,timestamp:f,eventId:n,cancelable:d,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}function ZQe(t){const{cancelable:e,data:i,timestamp:r}=t,{x:s,y:n,deltaY:o,native:a}=i;return{type:"mouse-wheel",x:s,y:n,deltaY:o,native:a,timestamp:r,cancelable:e,stopPropagation:()=>t.stopPropagation(),async:l=>t.async(l),preventDefault:()=>t.preventDefault()}}function YQe(t){const{action:e,state:i,device:r}=t.data,{cancelable:s,timestamp:n}=t,{buttons:o,axes:a}=i;return{type:"gamepad",device:r,timestamp:n,action:e,buttons:o,axes:a,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:l=>t.async(l),preventDefault:()=>t.preventDefault()}}var $3,yde,vde;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})($3||($3={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(yde||(yde={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(vde||(vde={}));function JQe(t){return[t.on("before-add",e=>{const i=e.item;if(i==null||t.includes(i))return J.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();i.onAdd()}),t.on("after-remove",e=>{const i=e.item;i.active&&(i.view.activeTool=null),i.destroy()})]}function wJ(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag($3.USER)&&t.getEditableFlag($3.MANAGER)}function rm(t){return xo(t.x,t.y)}function NWt(t){return ln(t.x,t.y)}function pMe(t,e){var r;const i=(r=t instanceof HTMLElement?t:t.surface)==null?void 0:r.getBoundingClientRect();return i?xo(e.clientX-i.left,e.clientY-i.top):xo(0,0)}function KU(t,e){return e instanceof Event?pMe(t,e):rm(e)}function QU(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let XQe=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._externallyDragging=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,i){const r=()=>e.stopPropagation();switch(e.type){case"pointer-move":bde(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0?this._stopDrag=!0:e.action==="start"?this._externallyDragging=!0:e.action==="end"&&(this._externallyDragging=!1),this._stopDrag&&(r(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!wde(e))break;const s=rm(e),n=OT(s,e.pointerType,i.forEachTool);if(n==null)break;const o=n.manipulator,a=n.tool;o==null||a==null||!o.interactive||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._releaseManipulatorBeforeDragging(o,e,i),o!=null&&a!=null&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:s,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&i.activeTool==null&&(this._revertToNullActiveTool=!0,i.setActiveTool(n.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:s}),r());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,i);break;case"pointer-drag":{if(!wde(e))break;const s=this._grabbedManipulators.get(e.pointerId),n=s==null?void 0:s.manipulator,o=s==null?void 0:s.tool;if(n==null||o==null)break;const a=rm(e);a.x=ue(a.x,0,i.view.width),a.y=ue(a.y,0,i.view.height);const l=s.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(n.dragging=!0,c?n.events.emit("drag",{action:"update",start:l,screenPoint:a}):n.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:n,start:l}));break;case"end":n.dragging=!1,c&&n.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,i)}r();break}case"immediate-click":{const s=rm(e),n=OT(s,e.pointerType,i.forEachTool);if(KQe(e)||i.forEachTool(c=>{if((n==null||n.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let h=!1;c.manipulators.forEach(({manipulator:d})=>{d.selected&&(d.selected=!1,h=!0)}),h&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),n==null)break;const{manipulator:o,tool:a}=n;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:r}),b8(o,r);break}case"click":{const s=rm(e),n=OT(s,e.pointerType,i.forEachTool),o=n==null?void 0:n.manipulator;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a}),r();break}case"double-click":{const s=rm(e),n=OT(s,e.pointerType,i.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r}),b8(o,r);break}case"immediate-double-click":{const s=rm(e),n=OT(s,e.pointerType,i.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r}),e.pointerType==="mouse"&&b8(o,r);break}}this._onFocusChange(i.forEachTool)}_releaseManipulatorBeforeDragging(e,i,r){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:rm(i)}),this._grabbedManipulators.forEach(({manipulator:s},n)=>{s===e&&this._grabbedManipulators.delete(n)}),this._afterManipulatorRelease(r.setActiveTool)}_handlePointerEnd(e,i){var s;const r=(s=this._grabbedManipulators.get(e.pointerId))==null?void 0:s.manipulator;r!=null&&r.grabbing&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:rm(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorRelease(i.setActiveTool))}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=_de(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=_de(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const i=new Set,r=new Set;this._grabbedManipulators.forEach(({tool:s})=>{i.add(s)}),this._hoveredManipulators.forEach(({tool:s})=>{r.add(s)}),e(s=>{s.hasGrabbedManipulators=i.has(s),s.hasHoveredManipulators=r.has(s);const n=this._grabbedManipulators.values(),o=Qje(n,({tool:a})=>a===s);s.firstGrabbedManipulator=o!=null?o.manipulator:null})}clearPointers(e,{forEachTool:i,setActiveTool:r},s=!0,n){const o=(a,l)=>a===e&&(n==null||n===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},h)=>{o(a,l)&&(this._grabbedManipulators.delete(h),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),s&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorRelease(r),this._onFocusChange(i)}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((i,r)=>{this._updateHoveredStateForPointerAtScreenPosition(xo(i.x,i.y),r,i.pointerType,e)})}handleHoverEvent(e,i){const r=e.type;r!=="pointer-up"&&r!=="immediate-click"&&r!=="pointer-move"||!bde(e.pointerType)||(r!=="pointer-up"&&this._externallyDragging?this._clearHoveredManipulatorStates(e.pointerId):this._updateHoveredStateForPointerAtScreenPosition(rm(e),e.pointerId,e.pointerType,i))}_updateHoveredStateForPointerAtScreenPosition(e,i,r,s){var a;let n=OT(e,r,s);const o=(a=this._hoveredManipulators.get(i))==null?void 0:a.manipulator;n==null||n.manipulator.interactive||(n=null),n!=null&&o===n.manipulator||(o!=null&&(o.hovering=!1),n!=null?(n.manipulator.hovering=!0,this._hoveredManipulators.set(i,n)):this._hoveredManipulators.delete(i),this._onFocusChange(s))}_afterManipulatorRelease(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}_clearHoveredManipulatorStates(e){this._hoveredManipulators.forEach(({manipulator:i},r)=>{e===r&&(this._hoveredManipulators.delete(e),i.hovering=!1)})}};function _de(t){for(const{manipulator:e}of t.values())if(e!=null&&e.interactive){if(e.grabbing&&e.grabCursor)return e.grabCursor;if(e.cursor)return e.cursor}return null}function OT(t,e,i){let r=null;return i(s=>{if(s.manipulators==null||!wJ(s))return!1;const n=s.manipulators.intersect(t,e);return n!=null&&(r={tool:s,manipulator:n},!0)}),r}function bde(t){return t==="mouse"}function wde(t){return t.pointerType!=="mouse"||t.button===0}function KQe(t){return!!t.native.shiftKey}function b8(t,e){t!=null&&t.consumesClicks&&e()}const xde="attached",w8="tools",QQe=1e3;let sm=class extends he{constructor(e){super(e),this._updatingHandles=new rv,this._clock=WA,this._manipulatorState=new XQe,this.tools=new Ce,this.cursor=null,this._interacting=!1,this._interactingTimeout=QQe,this._interactingTimeoutHandle=null,this._forEachTool=i=>{for(const r of this.tools.items)if(i(r))return}}initialize(){this.addHandles([this.view.on(cMe,e=>{this._handleInputEvent(e)},Vm.TOOL),...JQe(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.activeTool=null,this.tools.drain(e=>e.destroy()),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void J.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const i=this.activeTool;this._set("activeTool",e),i!=null&&i.deactivate(),e!=null&&e.activate(),this._removeIncompleteTools(e);for(const r of this.tools){this._updateToolEditableFlag(r);const s=wJ(r);this.activeTool!=null&&s||this._manipulatorState.clearPointers(r,this._manipulatorStateEventArgs,!s)}this._updateCursor()}get updating(){return this._updatingHandles.updating||this.tools.some(e=>e.updating)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=Ji(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout(()=>this._interacting=!1,this._interactingTimeout)}attach(){var e;this.view.type==="3d"?this.addHandles([H(()=>{const{state:i}=this.view;return"camera"in i&&i.camera},()=>this._forEachManipulator(i=>i.onViewChange())),(e=this.view.elevationProvider)==null?void 0:e.on("elevation-change",i=>this._forEachManipulator(r=>r.onElevationChange(i)))],xde):this.addHandles(H(()=>this.view.extent,()=>this._forEachManipulator(i=>i.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(xde),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(i=>{i.manipulators&&i.manipulators.forEach(({manipulator:r})=>e(r,i))})}_handleInputEvent(e){let i=!1;const r={...e,stopPropagation:()=>{i=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(r):this._forEachTool(s=>{!i&&s.visible&&s.handleInputEvent(r)}),!i&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(r,this._manipulatorStateEventArgs),i||this.activeTool==null||this.activeTool.handleInputEventAfter(r),this._manipulatorState.handleHoverEvent(r,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles(w8),this._forEachTool(e=>{if(e instanceof he){const i=H(()=>[e.cursor,e.visible,e.editable],()=>{wJ(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.addHandles(i,w8)}e.manipulators&&this.addHandles([e.manipulators.on("after-remove",i=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,i.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],w8)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){var i;(i=e.setEditableFlag)==null||i.call(e,$3.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(i=>!(i.cursor==null||!i.visible)&&(e=i.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(i=>(e==null||i!==e)&&!i.created&&i.removeIncompleteOnCancel).forEach(i=>{this.tools.remove(i)})}get test(){}};u([p({constructOnly:!0,nonNullable:!0})],sm.prototype,"view",void 0),u([p({value:null})],sm.prototype,"activeTool",null),u([p({readOnly:!0,type:Ce})],sm.prototype,"tools",void 0),u([p({readOnly:!0})],sm.prototype,"cursor",void 0),u([p({readOnly:!0})],sm.prototype,"updating",null),u([p()],sm.prototype,"_interacting",void 0),u([p({readOnly:!0})],sm.prototype,"interacting",null),sm=u([A("esri.views.ToolViewManager")],sm);const eet=new Je("cyan"),tet=1,iet=.25,fMe=new Je("black"),mMe=.4,gMe=.2,ret=.25,jm="default",set="temporary",net=new Je("yellow"),oet=8;var xJ;let Ou=xJ=class extends he{constructor(t){super(t),this.name=jm,this.color=eet.clone(),this.haloColor=null,this.haloOpacity=tet,this.fillOpacity=iet,this.shadowColor=fMe.clone(),this.shadowOpacity=mMe,this.shadowDifference=gMe,this.haloWidth=2.1,this.haloBlur=.8/this.haloWidth}equals(t){return this.color.equals(t.color)&&(this.haloColor||this.color).equals(t.haloColor||t.color)&&this.haloOpacity===t.haloOpacity&&this.fillOpacity===t.fillOpacity&&this.haloWidth===t.haloWidth&&this.haloBlur===t.haloBlur&&this.shadowColor.equals(t.shadowColor)&&this.shadowOpacity===t.shadowOpacity&&this.shadowDifference===t.shadowDifference}clone(){var t,e;return new xJ({...this,color:this.color.clone(),haloColor:(t=this.haloColor)==null?void 0:t.clone(),shadowColor:(e=this.shadowColor)==null?void 0:e.clone()})}assignFrom(t){var e;this.color=t.color.clone(),this.haloColor=(e=t.haloColor)==null?void 0:e.clone(),this.haloOpacity=t.haloOpacity,this.fillOpacity=t.fillOpacity,this.shadowColor=t.shadowColor.clone(),this.shadowDifference=t.shadowDifference,this.shadowOpacity=t.shadowOpacity,this.haloBlur=t.haloBlur,this.haloWidth=t.haloWidth}};u([p({type:String,constructOnly:!0,nonNullable:!0})],Ou.prototype,"name",void 0),u([p({type:Je,nonNullable:!0})],Ou.prototype,"color",void 0),u([p({type:Je})],Ou.prototype,"haloColor",void 0),u([p({nonNullable:!0})],Ou.prototype,"haloOpacity",void 0),u([p({nonNullable:!0})],Ou.prototype,"fillOpacity",void 0),u([p({type:Je,nonNullable:!0})],Ou.prototype,"shadowColor",void 0),u([p({nonNullable:!0})],Ou.prototype,"shadowOpacity",void 0),u([p({nonNullable:!0})],Ou.prototype,"shadowDifference",void 0),u([p({nonNullable:!0})],Ou.prototype,"haloWidth",void 0),u([p({nonNullable:!0})],Ou.prototype,"haloBlur",void 0),Ou=xJ=u([A("esri.views.support.HighlightOptions")],Ou);const Gm=Ou;function aet(){return new(Ce.ofType(Gm))([new Gm({name:jm}),new Gm({name:set,color:net})])}let qE=class extends he{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":cet.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return uet[this.deviceType]}};u([p({nonNullable:!0,readOnly:!0})],qE.prototype,"nativeIndex",void 0),u([p({type:String,readOnly:!0})],qE.prototype,"deviceType",null),u([p({type:Number,readOnly:!0})],qE.prototype,"axisThreshold",null),qE=u([A("esri.views.input.gamepad.GamepadInputDevice")],qE);const qre=qE,cet=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),uet={standard:.15,spacemouse:.025,unknown:0};let $I=class extends he{constructor(...e){super(...e),this.devices=new Ce,this.enabledFocusMode="document"}};u([p({type:Ce.ofType(qre),readOnly:!0})],$I.prototype,"devices",void 0),u([p({type:["document","view","none"]})],$I.prototype,"enabledFocusMode",void 0),$I=u([A("esri.views.input.gamepad.GamepadSettings")],$I);const het=$I;let n5=class extends he{constructor(){super(...arguments),this.gamepad=new het}};u([p({readOnly:!0})],n5.prototype,"gamepad",void 0),n5=u([A("esri.views.input.Input")],n5);const det=n5,yMe=()=>Rr.respectPrefersReducedMotion&&window.matchMedia("(prefers-reduced-motion: reduce)").matches,x8=()=>p({type:["pan","rotate","zoom","none"],nonNullable:!0});let E1=class extends he{constructor(e){super(e),this.dragPrimary="pan",this.dragSecondary="rotate",this.dragTertiary="zoom",this.mouseWheel="zoom"}};u([x8()],E1.prototype,"dragPrimary",void 0),u([x8()],E1.prototype,"dragSecondary",void 0),u([x8()],E1.prototype,"dragTertiary",void 0),u([p({type:["zoom","none"],nonNullable:!0})],E1.prototype,"mouseWheel",void 0),E1=u([A("esri.views.navigation.NavigationActionMap")],E1);const Wre=E1;let K0=class extends he{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};u([p({type:Boolean,nonNullable:!0})],K0.prototype,"enabled",void 0),u([p({type:qre})],K0.prototype,"device",void 0),u([p({type:["pan","zoom"],nonNullable:!0})],K0.prototype,"mode",void 0),u([p({type:["forward-down","forward-up"],nonNullable:!0})],K0.prototype,"tiltDirection",void 0),u([p({type:Number,nonNullable:!0})],K0.prototype,"velocityFactor",void 0),K0=u([A("esri.views.navigation.gamepad.GamepadSettings")],K0);const vMe=K0;let Q0=class extends he{constructor(e){super(e),this.actionMap=new Wre,this.browserTouchPanEnabled=!0,this.gamepad=new vMe,this.momentumEnabled=!0}get effectiveMomentumEnabled(){return this.momentumEnabled&&!yMe()}get mouseWheelZoomEnabled(){return this.actionMap.mouseWheel==="zoom"}set mouseWheelZoomEnabled(e){Xje(J.getLogger(this),"mouseWheelZoomEnabled",{replacement:"actionMap.mouseWheel",version:"4.32",warnOnce:!0}),this.actionMap.mouseWheel=e?"zoom":"none"}};u([p({type:Wre,nonNullable:!0})],Q0.prototype,"actionMap",void 0),u([p({type:Boolean})],Q0.prototype,"browserTouchPanEnabled",void 0),u([p({type:vMe,nonNullable:!0})],Q0.prototype,"gamepad",void 0),u([p({type:Boolean})],Q0.prototype,"momentumEnabled",void 0),u([p({type:Boolean})],Q0.prototype,"mouseWheelZoomEnabled",null),Q0=u([A("esri.views.navigation.Navigation")],Q0);const $G=Q0;function pet(t,e){if(!t)return null;if(!SJ(t))return new U("webscene:unsupported-height-model-info","The vertical coordinate system of the scene is not supported",{heightModelInfo:t});const i=t.heightUnit,r=rw.deriveUnitFromSR(t,e).heightUnit;return i!==r?new U("webscene:incompatible-height-unit",`The vertical units of the scene (${i}) must match the horizontal units of the scene (${r})`,{verticalUnit:i,horizontalUnit:r}):null}function HWt(t,e,i){const r=_Me(t),s=e,n=fet(r,s,i);if(r){const o=rw.deriveUnitFromSR(r,t.spatialReference).heightUnit;if(!i&&o!==r.heightUnit){const a=new U("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new U("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r,error:a})}}if(!met(t)||n===Vc.Unsupported)return new U("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r});switch(n){case Vc.Units:{const o=(r==null?void 0:r.heightUnit)||"unknown",a=(s==null?void 0:s.heightUnit)||"unknown",l=new U("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new U("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case Vc.HeightModel:{const o=(r==null?void 0:r.heightModel)||"unknown",a=(s==null?void 0:s.heightModel)||"unknown",l=new U("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new U("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case Vc.CRS:{const o=(r==null?void 0:r.vertCRS)||"unknown",a=(s==null?void 0:s.vertCRS)||"unknown",l=new U("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new U("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}}return null}function fet(t,e,i){if(!SJ(t)||!SJ(e))return Vc.Unsupported;if(t==null||e==null)return Vc.Ok;if(!i&&t.heightUnit!==e.heightUnit)return Vc.Units;if(t.heightModel!==e.heightModel)return Vc.HeightModel;switch(t.heightModel){case"gravity-related-height":return Vc.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?Vc.Ok:Vc.CRS;default:return Vc.Unsupported}}var Vc;function SJ(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function met(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!xMe(t)}function _Me(t){var r;if(t.type==="integrated-mesh-3dtiles")return null;const e=t.url?Rb(t.url):void 0;return!(((r=t.spatialReference)==null?void 0:r.vcsWkid)==null&&e!=null&&e.serverType==="ImageServer")&&bMe(t)&&t.heightModelInfo?t.heightModelInfo:xMe(t)?rw.deriveUnitFromSR(yet,t.spatialReference):null}function bMe(t){return"heightModelInfo"in t}function wMe(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function xMe(t){return wMe(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):SMe(t)}function get(t){return t.layers!=null||SMe(t)||wMe(t)||bMe(t)}function SMe(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"integrated-mesh-3dtiles":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"catalog":case"catalog-footprint":case"catalog-dynamic-group":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"parquet":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"viewshed":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(Vc||(Vc={}));const yet=new rw({heightModel:"gravity-related-height"});var je;function TJ(t){return t==="global"?je.Global:je.Local}function cP(t){return t===je.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})(je||(je={}));let EJ,S8=null;async function vet(t){S8||(S8=G(()=>import("./geometryServiceUtils-D_K144mp.js"),[]).then(e=>EJ=e)),await S8,gt(t)}async function TMe(t,e,i,r){if(!t)return null;const s=t.spatialReference;return Uv()||lu(s,e)?Nd(t,e):EJ?EJ.projectGeometry(t,e,i,r):(await Promise.race([vet(r),vv(r)]),TMe(t,e,i,r))}let us=class extends he{constructor(e){super(e),this.required={extent:!1,heightModelInfo:!1,tileInfo:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=fc(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference??this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var r,s,n,o;const e=(r=this.map)==null?void 0:r.call(this),i=[];return this.priorityCollection!=null&&i.push(this.priorityCollection),i.push({parent:e==null?void 0:e.basemap,layers:(s=e==null?void 0:e.basemap)==null?void 0:s.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(n=e==null?void 0:e.ground)==null?void 0:n.layers},{parent:e==null?void 0:e.basemap,layers:(o=e==null?void 0:e.basemap)==null?void 0:o.referenceLayers}),i}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};let e;if(this._collectLayers(this.mapCollections,r=>{const s=this._getSupportedSpatialReferences(r);if(s.length>0){const n=this._narrowDownSpatialReferenceCandidates(e,s);n!=null&&(e=n)}return(e==null?void 0:e.length)===1})&&(e==null?void 0:e.length)!==1)return{updating:!0};const i=this._pickSpatialReferenceCandidate(e);return{spatialReference:(i==null?void 0:i.spatialReference)??null,viewingMode:(i==null?void 0:i.viewingMode)??null,updating:!1}}get _tileInfoTask(){var n,o;if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};const e=(n=this.map)==null?void 0:n.call(this),i=this.spatialReference;if(!i)return{updating:this._spatialReferenceTask.updating};let r;const s=this._collectLayers([{parent:e==null?void 0:e.basemap,layers:(o=e==null?void 0:e.basemap)==null?void 0:o.baseLayers},{layers:e==null?void 0:e.layers}],a=>{var l;return!(!("tileInfo"in a)||!((l=a.tileInfo)!=null&&l.spatialReference.equals(i)))&&(r=a,!0)},a=>"tileInfo"in a);return r?{tileInfo:r.tileInfo,updating:!1}:{updating:s}}get _heightModelInfoTask(){var r;if(!this.required.heightModelInfo||this.suspended&&((r=this._get("_heightModelInfoTask"))!=null&&r.heightModelInfo))return this._get("_heightModelInfoTask")??{updating:!1};let e={};const i=this._collectLayers(this.mapCollections,s=>{var o,a;const n=_Me(s);return!!n&&(e={heightModelInfo:n,vcsWkid:(o=s.spatialReference)==null?void 0:o.vcsWkid,latestVcsWkid:(a=s.spatialReference)==null?void 0:a.latestVcsWkid},!0)},s=>get(s));return{...e,updating:i}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=[],i=this._collectLayers(this.mapCollections,r=>{const s="fullExtents"in r&&r.fullExtents||(r.fullExtent!=null?[r.fullExtent]:[]),n=this.requiresExtentInSpatialReference?null:s[0],o=s.find(a=>a.spatialReference.equals(this.spatialReference))??n;if(o)return e.push({extent:o,layer:r}),!0;if(this._getSupportedSpatialReferences(r).length>0)for(const a of s)e.push({extent:a,layer:r});return!1});return{candidates:e,updating:i}}get _extentTask(){const{candidates:e,updating:i}=this._extentCandidatesTask;if(i)return{updating:i};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const r=this._pickExtentCandidate(e),s=this.spatialReference;return r.extent.equals(this._projectExtentTask.input)&&s.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=fc(this._projectExtentTask.task)),this._projectExtentTask={input:r.extent.clone(),output:null,spatialReference:s.clone(),task:gg(async n=>{try{const o=await TMe(r.extent,s,"portalItem"in r.layer?r.layer.portalItem:void 0,n);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(Sa(n))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,i){if(e==null)return i;const r=new Array;for(const s of e)for(const n of i){if(!s.spatialReference.equals(n.spatialReference))continue;const o=bet(s.viewingMode,n.viewingMode);if(o!==!1){r.push({spatialReference:s.spatialReference,viewingMode:o});break}}return r.length>0?r:null}_pickSpatialReferenceCandidate(e){const i=this.defaultSpatialReference;return e==null||e.length<1?i?{spatialReference:i,viewingMode:null}:null:(i!=null&&e.length>1&&e.some(({spatialReference:r})=>r.equals(i))&&(e=e.filter(({spatialReference:r})=>r.equals(i))),e.length>1&&e.some(({viewingMode:r})=>r!==je.Local)&&(e=e.filter(({viewingMode:r})=>r!==je.Local)),e[0])}_getSupportedSpatialReferences(e){const i="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(i.length===0)return[];const r=[];for(const s of i){const n=this.getSpatialReferenceSupport(s,e);if(n!=null){const o=n.constraints??[{spatialReference:s,viewingMode:null}];for(const{spatialReference:a,viewingMode:l}of o)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!a.equals(this.userSpatialReference)||r.push({spatialReference:a,viewingMode:l})}}return r}_pickExtentCandidate(e){const i=this.spatialReference;return e.find(({extent:r})=>i.equals(r.spatialReference))||e[0]}_collectLayers(e,i,r=()=>!0){var n;switch(this._loadMaybe((n=this.map)==null?void 0:n.call(this))){case"loading":return!0;case"failed":return!1}const s=new _et(r,i);for(const o of e)if(this._collectCollection(o,s),s.done||s.preloading===this.sourcePreloadCount)break;return s.updating}_collectCollection(e,i){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return i.updating=!0,void++i.preloading;case"failed":return}for(const r of e.layers)if(i.layerFilter(r)){switch(this._loadMaybe(r)){case"failed":continue;case"loading":i.updating=!0,++i.preloading;break;case"loaded":if(i.updating||(i.done=i.pushLayer(r)),i.done||i.preloading===this.sourcePreloadCount)break;"layers"in r&&this._collectCollection({layers:r.layers},i)}if(i.done||i.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(i=>{es(i)}),"loading"):e.loadStatus:"loaded"}};u([p()],us.prototype,"required",void 0),u([p({constructOnly:!0})],us.prototype,"map",void 0),u([p({constructOnly:!0})],us.prototype,"getSpatialReferenceSupport",void 0),u([p()],us.prototype,"defaultSpatialReference",void 0),u([p()],us.prototype,"userSpatialReference",void 0),u([p()],us.prototype,"sourcePreloadCount",void 0),u([p()],us.prototype,"priorityCollection",void 0),u([p()],us.prototype,"requiresExtentInSpatialReference",void 0),u([p()],us.prototype,"suspended",void 0),u([p({readOnly:!0})],us.prototype,"ready",null),u([p({readOnly:!0})],us.prototype,"heightModelInfoReady",null),u([p({readOnly:!0})],us.prototype,"spatialReference",null),u([p({readOnly:!0})],us.prototype,"extent",null),u([p({readOnly:!0})],us.prototype,"heightModelInfo",null),u([p({readOnly:!0})],us.prototype,"vcsWkid",null),u([p({readOnly:!0})],us.prototype,"latestVcsWkid",null),u([p({readOnly:!0})],us.prototype,"viewingMode",null),u([p({readOnly:!0})],us.prototype,"tileInfo",null),u([p({readOnly:!0})],us.prototype,"mapCollections",null),u([p({readOnly:!0})],us.prototype,"_spatialReferenceTask",null),u([p({readOnly:!0})],us.prototype,"_tileInfoTask",null),u([p({readOnly:!0})],us.prototype,"_heightModelInfoTask",null),u([p({readOnly:!0})],us.prototype,"_extentCandidatesTask",null),u([p()],us.prototype,"_extentTask",null),u([p()],us.prototype,"_projectExtentTask",void 0),us=u([A("esri.views.support.DefaultsFromMap")],us);let _et=class{constructor(e,i){this.layerFilter=e,this.pushLayer=i,this.preloading=-1,this.updating=!1,this.done=!1}};function bet(t,e){return t!=null?e!=null?t===e&&t:t:e}let WE=class extends he{constructor(e){super(e),this.featureTitleFields=!1,this.utilityNetworkFields=!1,this.globalIdField=!1}};u([p()],WE.prototype,"featureTitleFields",void 0),u([p()],WE.prototype,"utilityNetworkFields",void 0),u([p()],WE.prototype,"globalIdField",void 0),WE=u([A("esri.views.support.RequiredFieldsOptions")],WE);const wet=WE;var AI;let pt=AI=class extends Ss.EventedMixin(iw.EsriPromiseMixin(he)){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.handles=new fg,this.updatingHandles=new rv,this.allLayerViews=new j$({getCollections:()=>{var e,i,r;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,(i=this.groundView)==null?void 0:i.layerViews,this.layerViews,(r=this.basemapView)==null?void 0:r.referenceLayerViews]},getChildrenFunction:xet}),this.groundView=null,this.basemapView=null,this.displayFilterEnabled=!0,this.fatalError=null,this.graphics=new lP,this.analyses=new eA,this.typeSpecificPreconditionsReady=!0,this.layerViews=new Ce,this.magnifier=new sMe,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this._readyStateWaitingTask=null,this.supportsGround=!0,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new det,this.navigation=new $G,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new dMe(this),this.persistableViewModels=new Ce,this.requiredFieldsOptions=new wet,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this._userTimeExtent=null,this._lockedTimeExtent=null,this.theme=null,this.handles.add(H(()=>this.preconditionsReady,e=>{var r,s;const i=this.ready;if(e?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,this._lockedTimeExtent=this.timeExtent,AI.views.add(this)):(this._lockedSpatialReference=null,AI.views.remove(this)),this.notifyChange("spatialReference"),!e&&i)(r=this.toolViewManager)==null||r.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),(s=this.layerViewManager)==null||s.clear(),this._teardown();else if(e&&!i){try{this._startup()}catch(n){return void queueMicrotask(()=>{this.fatalError=new U("startup-error",null,n)})}this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach()}},Yt))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this.validate()]).then(()=>(this._isValid=!0,Id(()=>this.ready)))),this.basemapView=new _Qe({view:this}),this.layerViewManager=new SQe({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new sm({view:this}),this.selectionManager=new LQe({view:this}),this.addHandles([bn(()=>this.readyState==="map-content-error"&&!this.spatialReference,()=>{J.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),H(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},Mt),H(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},Yt),H(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},Mt)])}destroy(){var t,e;this.destroyed||(AI.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=$e(this.graphics),this.analyses=$e(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),$e(this.analysisViewManager),this.toolViewManager=$e(this.toolViewManager),this.layerViewManager=$e(this.layerViewManager),this.selectionManager=$e(this.selectionManager),this.basemapView=$e(this.basemapView),(t=this.groundView)==null||t.destroy(),(e=this.layerViews)==null||e.forEach(i=>i.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.destroy(),this.map=$e(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return J.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var t;return(t=this.toolViewManager)==null?void 0:t.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new us({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:(t,e)=>this.getSpatialReferenceSupport(t,e),...this.defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get highlights(){return this._get("highlights")??aet()}set highlights(t){this._set("highlights",vf(t,this._get("highlights"),Ce.ofType(Gm)))}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var t;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||Il.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!((t=this.defaultsFromMap)!=null&&t.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t!=null&&t.destroyed&&(J.getLogger(this).warn("#map","The provided map is already destroyed",{map:t}),t=null),Il.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",t))}get readyState(){var t,e,i,r;if(this.destroyed)return this._get("readyState");if(!this.map)return"missing-map";if("container"in this&&!this.container)return"missing-container";if(this.fatalError)return"rendering-error";if((((t=this.defaultsFromMap)==null?void 0:t.ready)??!1)&&!this.spatialReference){const s=!("loaded"in this.map)||this.map.loaded,n=this.map.ground.loaded,o=((e=this.map.basemap)==null?void 0:e.loaded)??!0;return s&&o&&n&&!((i=this.map)!=null&&i.allLayers.length)?"empty-map":(this._readyStateWaitingTask||(this._readyStateWaitingTask=gg(a=>aie(X("view-readyState-waiting-delay"),null,a)),this.addHandles(this._readyStateWaitingTask),this.addHandles(this._readyStateWaitingTask,"ready-state-task")),(r=this._readyStateWaitingTask)!=null&&r.finished?"map-content-error":"loading")}return this._readyStateWaitingTask=fc(this._readyStateWaitingTask),this.removeHandles("ready-state-task"),this.ready?"ready":"loading"}get spatialReference(){var e,i;const t=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;if(t&&((i=(e=this.defaultsFromMap)==null?void 0:e.required)!=null&&i.heightModelInfo)){const r=t.clone();return r.vcsWkid=this.defaultsFromMap.vcsWkid,r.latestVcsWkid=this.defaultsFromMap.latestVcsWkid,r}return t}set spatialReference(t){const e=!as(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeExtent(){return this._userTimeExtent??this._lockedTimeExtent??this.getDefaultTimeExtent()??null}set timeExtent(t){this._userTimeExtent=t}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??mf}set timeZone(t){this._userTimeZone=t,A7e(t)||J.getLogger(this).warn("#timeZone",`the parsed value '${t}' may not be a valid IANA time zone`)}get tools(){var t;return(t=this.toolViewManager)==null?void 0:t.tools}get initialExtent(){var t;return(t=this.defaultsFromMap)==null?void 0:t.extent}get cursor(){var t;return((t=this.toolViewManager)==null?void 0:t.cursor)??this._cursor??"default"}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new bJ}whenLayerView(t){var e;return((e=this.layerViewManager)==null?void 0:e.whenLayerView(t))??Promise.reject()}getDefaultSpatialReference(){var t;return(t=this.defaultsFromMap)==null?void 0:t.spatialReference}getDefaultHeightModelInfo(){var t;return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??((t=this.defaultsFromMap)==null?void 0:t.heightModelInfo)??null}getDefaultTimeZone(){return null}getDefaultTimeExtent(){return null}importLayerView(t){throw new U("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}async loadAsyncDependencies(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return this.getSpatialReferenceSupport(t)!=null}when(t,e){return this.isResolved()&&!this.ready&&J.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(bn(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};pt.views=new Ce,u([p()],pt.prototype,"_userSpatialReference",void 0),u([p()],pt.prototype,"activeTool",null),u([p({readOnly:!0})],pt.prototype,"allLayerViews",void 0),u([p()],pt.prototype,"groundView",void 0),u([p()],pt.prototype,"animation",null),u([p()],pt.prototype,"basemapView",void 0),u([p()],pt.prototype,"center",null),u([p()],pt.prototype,"defaultsFromMapSettings",null),u([p()],pt.prototype,"defaultsFromMap",null),u([p()],pt.prototype,"displayFilterEnabled",void 0),u([p()],pt.prototype,"fatalError",void 0),u([p({type:_i})],pt.prototype,"extent",null),u([p(KZ(lP,"graphics"))],pt.prototype,"graphics",void 0),u([p(KZ(eA,"analyses"))],pt.prototype,"analyses",void 0),u([p({readOnly:!0,type:rw})],pt.prototype,"heightModelInfo",null),u([p({type:Ce.ofType(Gm)})],pt.prototype,"highlights",null),u([p({readOnly:!0})],pt.prototype,"interacting",null),u([p({readOnly:!0})],pt.prototype,"navigating",null),u([p({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],pt.prototype,"preconditionsReady",null),u([p({readOnly:!0})],pt.prototype,"typeSpecificPreconditionsReady",void 0),u([p({type:Ce,readOnly:!0})],pt.prototype,"layerViews",void 0),u([p()],pt.prototype,"resolution",null),u([p({type:sMe})],pt.prototype,"magnifier",void 0),u([p({value:null,type:Ere})],pt.prototype,"map",null),u([p()],pt.prototype,"padding",void 0),u([p({readOnly:!0})],pt.prototype,"ready",void 0),u([p()],pt.prototype,"_readyStateWaitingTask",void 0),u([p({readOnly:!0})],pt.prototype,"readyState",null),u([p({type:Oe})],pt.prototype,"spatialReference",null),u([p()],pt.prototype,"stationary",null),u([p({readOnly:!0})],pt.prototype,"supportsGround",void 0),u([p({type:Eo})],pt.prototype,"timeExtent",null),u([p({type:String,nonNullable:!0})],pt.prototype,"timeZone",null),u([p()],pt.prototype,"tools",null),u([p()],pt.prototype,"toolViewManager",void 0),u([p({readOnly:!0})],pt.prototype,"type",void 0),u([p({type:Number})],pt.prototype,"scale",void 0),u([p({readOnly:!0})],pt.prototype,"updating",void 0),u([p({readOnly:!0})],pt.prototype,"initialExtentRequired",void 0),u([p({readOnly:!0})],pt.prototype,"initialExtent",null),u([p()],pt.prototype,"cursor",null),u([p({readOnly:!0})],pt.prototype,"input",void 0),u([p({type:$G,nonNullable:!0})],pt.prototype,"navigation",void 0),u([p()],pt.prototype,"layerViewManager",void 0),u([p()],pt.prototype,"analysisViewManager",void 0),u([p()],pt.prototype,"selectionManager",void 0),u([p()],pt.prototype,"width",void 0),u([p()],pt.prototype,"height",void 0),u([p({readOnly:!0})],pt.prototype,"resizing",void 0),u([p({value:null,readOnly:!0})],pt.prototype,"size",null),u([p({readOnly:!0})],pt.prototype,"suspended",void 0),u([p({readOnly:!0})],pt.prototype,"viewEvents",void 0),u([p({readOnly:!0})],pt.prototype,"persistableViewModels",void 0),u([p()],pt.prototype,"_isValid",void 0),u([p()],pt.prototype,"_readyCycleForced",void 0),u([p()],pt.prototype,"_lockedSpatialReference",void 0),u([p()],pt.prototype,"_userTimeZone",void 0),u([p()],pt.prototype,"_lockedTimeZone",void 0),u([p()],pt.prototype,"_userTimeExtent",void 0),u([p()],pt.prototype,"_lockedTimeExtent",void 0),u([p({type:bJ})],pt.prototype,"theme",void 0),u([p({readOnly:!0,type:bJ})],pt.prototype,"effectiveTheme",null),pt=AI=u([A("esri.views.View")],pt);const T8=globalThis.$arcgis;T8&&!T8.views&&Object.defineProperty(T8,"views",{configurable:!1,enumerable:!0,writable:!1,value:pt.views});const EMe=pt;function xet(t){return t.layerViews}function Vn(t,e){return t[0]=e[0],t[1]=e[1],t}function di(t,e,i){return t[0]=e,t[1]=i,t}function Oy(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function fd(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function CMe(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function $Me(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function Tet(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function Eet(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function Cet(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t}function $et(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t}function Aet(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function md(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function Met(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t}function wv(t,e){const i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)}function sA(t,e){const i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r}function eB(t){const e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}function AMe(t){const e=t[0],i=t[1];return e*e+i*i}function Zre(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Oet(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function A3(t,e){const i=e[0],r=e[1];let s=i*i+r*r;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s),t}function jo(t,e){return t[0]*e[0]+t[1]*e[1]}function MMe(t,e,i){const r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t}function rd(t,e,i,r){const s=e[0],n=e[1];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t}function Iet(t,e=1){const i=2*tL()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t}function Ret(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[2]*s,t[1]=i[1]*r+i[3]*s,t}function Cm(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[2]*s+i[4],t[1]=i[1]*r+i[3]*s+i[5],t}function Pet(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[3]*s+i[6],t[1]=i[1]*r+i[4]*s+i[7],t}function Det(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[4]*s+i[12],t[1]=i[1]*r+i[5]*s+i[13],t}function OMe(t,e,i,r){const s=e[0]-i[0],n=e[1]-i[1],o=Math.sin(r),a=Math.cos(r);return t[0]=s*a-n*o+i[0],t[1]=s*o+n*a+i[1],t}function Let(t,e){const i=t[0],r=t[1],s=e[0],n=e[1];let o=i*i+r*r;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(i*s+r*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function Net(t){return"vec2("+t[0]+", "+t[1]+")"}function IMe(t,e){return t[0]===e[0]&&t[1]===e[1]}function AG(t,e){const i=t[0],r=t[1],s=e[0],n=e[1],o=To();return Math.abs(i-s)<=o*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-n)<=o*Math.max(1,Math.abs(r),Math.abs(n))}function Fet(t,e,i,r,s){let n=e[0]-i[0],o=e[1]-i[1];const a=(r[0]*n+r[1]*o)*(s-1);return n=r[0]*a,o=r[1]*a,t[0]=e[0]+n,t[1]=e[1]+o,t}const ket=eB,Yre=fd,zet=CMe,Uet=$Me,Bet=wv,Vet=sA,jet=AMe;Object.freeze(Object.defineProperty({__proto__:null,add:Oy,angle:Let,ceil:Tet,copy:Vn,cross:MMe,dist:Bet,distance:wv,div:Uet,divide:$Me,dot:jo,equals:AG,exactEquals:IMe,floor:Eet,inverse:Oet,len:ket,length:eB,lerp:rd,max:$et,min:Cet,mul:zet,multiply:CMe,negate:Zre,normalize:A3,projectAndScale:Fet,random:Iet,rotate:OMe,round:Aet,scale:md,scaleAndAdd:Met,set:di,sqrDist:Vet,sqrLen:jet,squaredDistance:sA,squaredLength:AMe,str:Net,sub:Yre,subtract:fd,transformMat2:Ret,transformMat2d:Cm,transformMat3:Pet,transformMat4:Det},Symbol.toStringTag,{value:"Module"}));function Ye(){return[0,0]}function tB(t){return[t[0],t[1]]}function fn(t,e){return[t,e]}function Get(t,e){return[t,e]}function Het(t,e=Ye()){const i=Math.min(2,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function qet(t,e){return new Float64Array(t,e,2)}function Jre(){return Ye()}function RMe(){return fn(1,1)}function PMe(){return fn(1,0)}function DMe(){return fn(0,1)}const TS=Jre(),LMe=RMe(),Wet=PMe(),Zet=DMe();Object.freeze(Object.defineProperty({__proto__:null,ONES:LMe,UNIT_X:Wet,UNIT_Y:Zet,ZEROS:TS,clone:tB,create:Ye,createView:qet,freeze:Get,fromArray:Het,fromValues:fn,ones:RMe,unitX:PMe,unitY:DMe,zeros:Jre},Symbol.toStringTag,{value:"Module"}));function Yet(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Jet(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function Xet(t,e,i,r,s,n,o){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=o,t}function Xre(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5];let l=i*n-r*s;return l?(l=1/l,t[0]=n*l,t[1]=-r*l,t[2]=-s*l,t[3]=i*l,t[4]=(s*a-n*o)*l,t[5]=(r*o-i*a)*l,t):null}function Ket(t){return t[0]*t[3]-t[1]*t[2]}function NMe(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=i[0],h=i[1],d=i[2],f=i[3],m=i[4],g=i[5];return t[0]=r*c+n*h,t[1]=s*c+o*h,t[2]=r*d+n*f,t[3]=s*d+o*f,t[4]=r*m+n*g+a,t[5]=s*m+o*g+l,t}function MG(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=Math.sin(i),h=Math.cos(i);return t[0]=r*h+n*c,t[1]=s*h+o*c,t[2]=r*-c+n*h,t[3]=s*-c+o*h,t[4]=a,t[5]=l,t}function Kre(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=i[0],h=i[1];return t[0]=r*c,t[1]=s*c,t[2]=n*h,t[3]=o*h,t[4]=a,t[5]=l,t}function M3(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=i[0],h=i[1];return t[0]=r,t[1]=s,t[2]=n,t[3]=o,t[4]=r*c+n*h+a,t[5]=s*c+o*h+l,t}function FMe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t[4]=0,t[5]=0,t}function kMe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function Qre(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function Qet(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function ett(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function ttt(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t}function zMe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}function itt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t}function rtt(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t}function stt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function ntt(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=e[0],c=e[1],h=e[2],d=e[3],f=e[4],m=e[5],g=To();return Math.abs(i-l)<=g*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-c)<=g*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(s-h)<=g*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(n-d)<=g*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(o-f)<=g*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-m)<=g*Math.max(1,Math.abs(a),Math.abs(m))}const ott=NMe,att=zMe;Object.freeze(Object.defineProperty({__proto__:null,add:ttt,copy:Yet,determinant:Ket,equals:ntt,exactEquals:stt,frob:ett,fromRotation:FMe,fromScaling:kMe,fromTranslation:Qre,identity:Jet,invert:Xre,mul:ott,multiply:NMe,multiplyScalar:itt,multiplyScalarAndAdd:rtt,rotate:MG,scale:Kre,set:Xet,str:Qet,sub:att,subtract:zMe,translate:M3},Symbol.toStringTag,{value:"Module"}));function nv(){return[1,0,0,1,0,0]}function ltt(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function ctt(t,e,i,r,s,n){return[t,e,i,r,s,n]}function utt(t,e){return new Float64Array(t,e,6)}const htt=nv();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:htt,clone:ltt,create:nv,createView:utt,fromValues:ctt},Symbol.toStringTag,{value:"Module"}));const PN={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new _d({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:Oe.WebMercator}),minus180Line:new _d({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:Oe.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new _d({paths:[[[180,-180],[180,180]]],spatialReference:Oe.WGS84}),minus180Line:new _d({paths:[[[-180,-180],[-180,180]]],spatialReference:Oe.WGS84})}};function Ox(t,e){return Math.ceil((t-e)/(2*e))}function UMe(t,e){const i=uP(t);for(const r of i)for(const s of r)s[0]+=e;return t}function uP(t){return wb(t)?t.rings:t.paths}function dtt(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function BMe(t){return typeof t=="string"?yn(t):q(t)}function ptt(t,e,i){const r={};for(const s in t){if(s==="declaredClass")continue;const n=t[s];if(n!=null&&typeof n!="function")if(Array.isArray(n))r[s]=n.map(o=>ptt(o));else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(i==null?void 0:i[s]);r[s]=e?o:JSON.stringify(o)}else r[s]=e?n:JSON.stringify(n);else r[s]=n}return r}async function ftt(t,e,i,r){const s=BMe(t),n=e[0].spatialReference,o={...r,responseType:"json",query:{...s.query,f:"json",sr:MU(n),target:JSON.stringify({geometryType:HD(e[0]),geometries:e}),cutter:JSON.stringify(i)}},a=await Ri(s.path+"/cut",o),{cutIndexes:l,geometries:c=[]}=a.data;return{cutIndexes:l,geometries:c.map(h=>{const d=pf(h);return d.spatialReference=n,d})}}function mtt(t){return{geometryType:HD(t[0]),geometries:t.map(e=>e.toJSON())}}function VMe(t,e,i){const r=Z8e(e);return t.map(s=>{const n=r.fromJSON(s);return n.spatialReference=i,n})}async function gtt(t,e,i){const r=typeof t=="string"?yn(t):t,s=e[0].spatialReference,n=HD(e[0]),o={...i,query:{...r.query,f:"json",sr:MU(s),geometries:JSON.stringify(mtt(e))}},{data:a}=await Ri(r.path+"/simplify",o);return VMe(a.geometries,n,s)}const jMe=()=>J.getLogger("esri.geometry.support.normalizeUtils");function ytt(t){return t.type==="polygon"}function vtt(t){return t[0].type==="polygon"}function _tt(t){return t[0].type==="polyline"}function Sde(t){const e=[];let i=0,r=0;for(let s=0;s<t.length;s++){const n=t[s];let o=null;for(let a=0;a<n.length;a++)o=n[a],e.push(o),a===0?(i=o[0],r=i):(i=Math.min(i,o[0]),r=Math.max(r,o[0]));o&&e.push([(i+r)/2,0])}return e}function btt(t,e){if(!(t instanceof _d||t instanceof Ea)){const s="straightLineDensify: the input geometry is neither polyline nor polygon";throw jMe().error(s),new U(s)}const i=uP(t),r=[];for(const s of i){const n=[];r.push(n),n.push([s[0][0],s[0][1]]);for(let o=0;o<s.length-1;o++){const a=s[o][0],l=s[o][1],c=s[o+1][0],h=s[o+1][1],d=Math.sqrt((c-a)*(c-a)+(h-l)*(h-l)),f=(h-l)/d,m=(c-a)/d,g=d/e;if(g>1){for(let w=1;w<=g-1;w++){const x=w*e,S=m*x+a,C=f*x+l;n.push([S,C])}const v=(d+Math.floor(g-1)*e)/2,_=m*v+a,b=f*v+l;n.push([_,b])}n.push([c,h])}}return ytt(t)?new Ea({rings:r,spatialReference:t.spatialReference}):new _d({paths:r,spatialReference:t.spatialReference})}function Tde(t,e,i){if(e){const r=btt(t,1e6);t=Cx(r,!0)}return i&&(t=UMe(t,i)),t}function Ede(t,e,i){if(Array.isArray(t)){const r=t[0];if(r>e){const s=Ox(r,e);t[0]=r+s*(-2*e)}else if(r<i){const s=Ox(r,i);t[0]=r+s*(-2*i)}}else{const r=t.x;if(r>e){const s=Ox(r,e);t=t.clone().offset(s*(-2*e),0)}else if(r<i){const s=Ox(r,i);t=t.clone().offset(s*(-2*i),0)}}return t}function wtt(t,e){let i=-1;for(let r=0;r<e.cutIndexes.length;r++){const s=e.cutIndexes[r],n=e.geometries[r],o=uP(n);for(let a=0;a<o.length;a++){const l=o[a];l.some(c=>{if(c[0]<180)return!0;{let h=0;for(let f=0;f<l.length;f++){const m=l[f][0];h=m>h?m:h}h=Number(h.toFixed(9));const d=-360*Ox(h,180);for(let f=0;f<l.length;f++){const m=n.getPoint(a,f);n.setPoint(a,f,m.clone().offset(d,0))}return!0}})}if(s===i){if(vtt(t))for(const a of uP(n))t[s]=t[s].addRing(a);else if(_tt(t))for(const a of uP(n))t[s]=t[s].addPath(a)}else i=s,t[s]=n}return t}async function xtt(t,e,i){if(!Array.isArray(t))return xtt([t],e);e&&typeof e!="string"&&jMe().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const r=typeof e=="string"?e:(e==null?void 0:e.url)??Rr.geometryServiceUrl;let s,n,o,a,l,c,h,d,f=0;const m=[],g=[];for(const S of t)if(S!=null)if(s||(s=S.spatialReference,n=hc(s),o=s.isWebMercator,c=o?102100:4326,a=PN[c].maxX,l=PN[c].minX,h=PN[c].plus180Line,d=PN[c].minus180Line),n)if(S.type==="mesh")g.push(S);else if(S.type==="point")g.push(Ede(S.clone(),a,l));else if(S.type==="multipoint"){const C=S.clone();C.points=C.points.map(T=>Ede(T,a,l)),g.push(C)}else if(S.type==="extent"){const C=S.clone()._normalize(!1,!1,n);g.push(C.rings?new Ea(C):C)}else if(S.extent){const C=S.extent,T=Ox(C.xmin,l)*(2*a);let M=T===0?S.clone():UMe(S.clone(),T);C.offset(T,0);let{xmin:I,xmax:D}=C;I=Number(I.toFixed(9)),D=Number(D.toFixed(9)),C.intersects(h)&&D!==a?(f=D>f?D:f,M=Tde(M,o),m.push(M),g.push("cut")):C.intersects(d)&&I!==l?(f=D*(2*a)>f?D*(2*a):f,M=Tde(M,o,360),m.push(M),g.push("cut")):g.push(M)}else g.push(S.clone());else g.push(S);else g.push(S);let v=Ox(f,a),_=-90;const b=v,w=new _d;for(;v>0;){const S=360*v-180;w.addPath([[S,_],[S,-1*_]]),_*=-1,v--}if(m.length>0&&b>0){const S=wtt(m,await ftt(r,m,w,i)),C=[],T=[];for(let D=0;D<g.length;D++){const P=g[D];if(P!=="cut")T.push(P);else{const F=S.shift(),L=t[D];L!=null&&L.type==="polygon"&&L.rings&&L.rings.length>1&&F.rings.length>=L.rings.length?(C.push(F),T.push("simplify")):T.push(o?iv(F):F)}}if(!C.length)return T;const M=await gtt(r,C,i),I=[];for(let D=0;D<T.length;D++){const P=T[D];P!=="simplify"?I.push(P):I.push(o?iv(M.shift()):M.shift())}return I}const x=[];for(let S=0;S<g.length;S++){const C=g[S];if(C!=="cut")x.push(C);else{const T=m.shift();x.push(o===!0?iv(T):T)}}return x}function Stt(t){if(!t)return null;const e=t.extent;if(!e)return null;const i=t.spatialReference&&hc(t.spatialReference);if(!i)return e;const[r,s]=i.valid,n=2*s,{width:o}=e;let a,{xmin:l,xmax:c}=e;if([l,c]=[c,l],t.type==="extent"||o===0||o<=s||o>n||l<r||c>s)return e;switch(t.type){case"polygon":if(!(t.rings.length>1))return e;a=Sde(t.rings);break;case"polyline":if(!(t.paths.length>1))return e;a=Sde(t.paths);break;case"multipoint":a=t.points}const h=e.clone();for(let d=0;d<a.length;d++){let f=a[d][0];f<0?(f+=s,c=Math.max(f,c)):(f-=s,l=Math.min(f,l))}return h.xmin=l,h.xmax=c,h.width<o?(h.xmin-=s,h.xmax-=s,h):e}function ese(t,e,i){const r=hc(i);if(r==null)return t;const[s,n]=r.valid,o=2*n;let a=0,l=0;e>n?a=Math.ceil(Math.abs(e-n)/o):e<s&&(a=-Math.ceil(Math.abs(e-s)/o)),t>n?l=Math.ceil(Math.abs(t-n)/o):t<s&&(l=-Math.ceil(Math.abs(t-s)/o));let c=t+(a-l)*o;const h=c-e;return h>n?c-=o:h<s&&(c+=o),c}function YWt(t,e){const i=hc(e);if(i){const[r,s]=i.valid,n=s-r;if(t<r)for(;t<r;)t+=n;if(t>s)for(;t>s;)t-=n}return t}const GMe=96,HMe=39.37,Ttt=180/Math.PI;function qMe(t){return t.wkid?t:t.spatialReference||Oe.WGS84}function tse(t,e){return e.type?di(t,e.x,e.y):Vn(t,e)}function WMe(t){return Mo(t)}function OG(t,e,i=0){let r=t.width,s=t.height;if(i!==0){const a=At(i),l=Math.abs(Math.cos(a)),c=Math.abs(Math.sin(a));r=t.width*l+t.height*c,s=t.width*c+t.height*l}const n=Math.max(1,e[0]),o=Math.max(1,e[1]);return Math.max(r/n,s/o)*Rtt(t.spatialReference)}async function MI(t,e,i,r){var a,l,c;let s,n;if(!t||Array.isArray(t)&&!t.length)return null;if(Ce.isCollection(t)&&(t=t.toArray()),Array.isArray(t)&&t.length&&typeof t[0]=="object"){const h=t.every(m=>"attributes"in m),d=t.some(m=>!m.geometry);let f=t;if(h&&d&&e&&e.allLayerViews){const m=new Map;for(const b of t){const w=b.layer,x=m.get(w)||[],S=b.attributes[w.objectIdField];S!=null&&x.push(S),m.set(w,x)}const g=[];m.forEach((b,w)=>{var S;const x=(S=e.allLayerViews)==null?void 0:S.find(C=>C.layer.id===w.id);if(x&&"queryFeatures"in x){const C=w.createQuery();C.objectIds=b,C.returnGeometry=!0,g.push(x.queryFeatures(C))}});const v=await Promise.all(g),_=[];for(const b of v)if(b&&b.features&&b.features.length)for(const w of b.features)w.geometry!=null&&_.push(w.geometry);f=_}for(const m of f)r=await MI(m,e,i,r);return r}if(Array.isArray(t)&&t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number")s=new Fe(t);else if(t instanceof mg)s=t;else if("geometry"in t){if(t.geometry)s=t.geometry;else if(t.layer){const h=t.layer,d=(a=e.allLayerViews)==null?void 0:a.find(f=>f.layer.id===h.id);if(d&&"queryFeatures"in d){const f=h.createQuery();f.objectIds=[t.attributes[h.objectIdField]],f.returnGeometry=!0;const m=await d.queryFeatures(f);s=(c=(l=m==null?void 0:m.features)==null?void 0:l[0])==null?void 0:c.geometry}}}if(s==null)return null;switch(s.type){case"point":n=new _i({xmin:s.x,ymin:s.y,xmax:s.x,ymax:s.y,spatialReference:s.spatialReference});break;case"extent":case"multipoint":case"polygon":case"polyline":n=Stt(s);break;default:n=s.extent}if(!n)return null;Uv()||lu(n.spatialReference,i)||await vv();const o=Nd(n,i);if(!o)return null;if(r){const h=o.center,d=h.clone();d.x=ese(h.x,r.center.x,i),d.x!==h.x&&o.centerAt(d),r=r.union(o)}else r=o;return r}function Ett(t){var e;if(t&&(!Array.isArray(t)||typeof t[0]!="number")&&(typeof t=="object"||Array.isArray(t)&&typeof t[0]=="object")){if("layer"in t&&((e=t.layer)==null?void 0:e.minScale)!=null&&t.layer.maxScale!=null){const i=t.layer;return{min:i.minScale,max:i.maxScale}}if(Array.isArray(t)&&t.length&&t.every(i=>"layer"in i)){let i=0,r=0;for(const s of t){const n=s.layer;n!=null&&n.minScale&&n.maxScale&&(i=n.minScale<i?n.minScale:i,r=n.maxScale>r?n.maxScale:r)}return i&&r?{min:i,max:r}:null}}}function Cde(t,e){const i=qMe(t);return as(i,e)||i.imageCoordinateSystem||e.imageCoordinateSystem?t:Nd(t,e)}async function Ctt(t,e){var _;if(!t||!e)return new Qr({targetGeometry:new Fe,scale:0,rotation:0});let i=e.spatialReference;const{constraints:r,padding:s,viewpoint:n,size:o}=e,a=[s?o[0]-s.left-s.right:o[0],s?o[1]-s.top-s.bottom:o[1]];let l=null;t instanceof Qr?l=t:t.viewpoint?l=t.viewpoint:t.target&&t.target.declaredClass==="esri.Viewpoint"&&(l=t.target);let c=null;l!=null&&l.targetGeometry?c=l.targetGeometry:t instanceof _i?c=t:t instanceof mg?c=await MI(t,e,i):t&&(c=await MI(t.center,e,i)||await MI(t.target,e,i)||await MI(t,e,i)),!c&&(n!=null&&n.targetGeometry)?c=n.targetGeometry:!c&&e.extent&&(c=e.extent),i||(i=qMe(e.spatialReference||e.extent||c)),Uv()||as(c.spatialReference,i)||lu(c.spatialReference,i)||await vv();const h=Cde(c,i),d="center"in h?h.center:h;e.pickClosestTarget!==!1&&d.type==="point"&&((_=n.targetGeometry)==null?void 0:_.type)==="point"&&(d.x=ese(d.x,n.targetGeometry.x,d.spatialReference));let f=0;l?f=l.rotation:t.hasOwnProperty("rotation")?f=t.rotation:n&&(f=n.rotation);let m=0;m=(l==null?void 0:l.targetGeometry)!=null&&l.targetGeometry.type==="point"?l.scale:"scale"in t&&t.scale?t.scale:"zoom"in t&&t.zoom!==-1&&r&&r.effectiveLODs?r.zoomToScale(t.zoom):Array.isArray(c)||c.type==="point"||c.type==="extent"&&c.width===0&&c.height===0?n.scale:OG(Cde(c.extent,i),a,f);const g=Ett(t.target??t);g&&(g.min&&g.min<m?m=g.min:g.max&&g.max>m&&(m=g.max));let v=new Qr({targetGeometry:d,scale:m,rotation:f});return r&&(v=r.fit(v),r.constrainByGeometry(v),r.rotationEnabled||(v.rotation=n.rotation)),v}function Cl(t,e){const i=t.targetGeometry,r=e.targetGeometry;return i.x=r.x,i.y=r.y,i.spatialReference=r.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}function $tt(t,e,i){return i?di(t,.5*(e[0]-i.right+i.left),.5*(e[1]-i.bottom+i.top)):md(t,e,.5)}const Att=function(){const t=Ye();return function(e,i,r){const s=i.targetGeometry;tse(t,s);const n=.5*cM(i);return e.xmin=t[0]-n*r[0],e.ymin=t[1]-n*r[1],e.xmax=t[0]+n*r[0],e.ymax=t[1]+n*r[1],e.spatialReference=s.spatialReference,e}}();function Mtt(t,e,i,r,s){var n;return CJ(t,e,i.center),t.scale=OG(i,r),(n=s==null?void 0:s.constraints)==null||n.constrain(t),t}function Ott(t,e,i,r){return sse(t,e,i,r),Xre(t,t)}const ZMe=function(){const t=Ye();return function(e,i,r){return Yre(e,Ptt(e,i),$tt(t,i,r))}}(),Itt=function(){const t=nv(),e=Ye();return function(i,r,s,n){const o=cM(r),a=ise(r);return di(e,o,o),kMe(t,e),MG(t,t,a),M3(t,t,ZMe(e,s,n)),M3(t,t,[0,n.top-n.bottom]),di(i,t[4],t[5])}}();function cM(t){var e;return t.scale*YMe((e=t.targetGeometry)==null?void 0:e.spatialReference)}function YMe(t){return Xu(t)?1/(WMe(t)*HMe*GMe):1}function ise(t){return iL(t.rotation)||0}function Rtt(t){return Xu(t)?WMe(t)*HMe*GMe:1}function Ptt(t,e){return md(t,e,.5)}const rse=function(){const t=Ye(),e=Ye(),i=Ye();return function(r,s,n,o,a,l){return Zre(t,s),md(e,n,.5*l),di(i,1/o*l,-1/o*l),Qre(r,e),a&&MG(r,r,a),Kre(r,r,i),M3(r,r,t),r}}(),sse=function(){const t=Ye();return function(e,i,r,s){const n=cM(i),o=ise(i);return tse(t,i.targetGeometry),rse(e,t,r,n,o,s)}}(),Dtt=function(){const t=Ye();return function(e,i,r,s){const n=cM(i);return tse(t,i.targetGeometry),rse(e,t,r,n,0,s)}}();function JMe(t){const e=hc(t);return e?e.valid[1]-e.valid[0]:0}function Ltt(t,e){return Math.round(JMe(t)/e)}const Ntt=function(){const t=Ye(),e=Ye(),i=[0,0,0];return function(r,s,n){fd(t,r,s),A3(t,t),fd(e,r,n),A3(e,e),MMe(i,t,e);let o=Math.acos(jo(t,e)/(eB(t)*eB(e)))*Ttt;return i[2]<0&&(o=-o),isNaN(o)&&(o=0),o}}(),Ftt=function(){const t=Ye();return function(e,i,r,s){const n=e.targetGeometry;return Cl(e,i),Itt(t,i,r,s),n.x+=t[0],n.y+=t[1],e}}(),CJ=function(t,e,i){Cl(t,e);const r=t.targetGeometry;return r.x=i.x,r.y=i.y,r.spatialReference=i.spatialReference,t},ktt=function(){const t=Ye();return function(e,i,r,s,n){n||(n="center"),Yre(t,r,s),md(t,t,.5);const o=t[0],a=t[1];switch(n){case"center":di(t,0,0);break;case"left":di(t,-o,0);break;case"top":di(t,0,a);break;case"right":di(t,o,0);break;case"bottom":di(t,0,-a);break;case"top-left":di(t,-o,a);break;case"bottom-left":di(t,-o,-a);break;case"top-right":di(t,o,a);break;case"bottom-right":di(t,o,-a)}return IG(e,i,t),e}}();function JWt(t,e,i){return Cl(t,e),t.rotation+=i,t}function ztt(t,e,i){return Cl(t,e),t.rotation=i,t}const Utt=function(){const t=Ye();return function(e,i,r,s,n){return Cl(e,i),isNaN(r)||r===0||(KMe(t,s,i,n),e.scale=i.scale*r,QMe(t,t,e,n),IG(e,e,di(t,t[0]-s[0],s[1]-t[1]))),e}}();function $de(t,e,i){return Cl(t,e),t.scale=i,t}const XMe=function(){const t=Ye();return function(e,i,r,s,n,o){return Cl(e,i),isNaN(r)||r===0||(KMe(t,n,i,o),e.scale=i.scale*r,e.rotation+=s,QMe(t,t,e,o),IG(e,e,di(t,t[0]-n[0],n[1]-t[1]))),e}}(),XWt=function(){const t=Ye(),e=Ye();return function(i,r,s,n,o,a,l){return ZMe(e,a,l),Oy(t,o,e),n?XMe(i,r,s,n,t,a):Utt(i,r,s,t,a)}}(),KMe=function(){const t=nv();return function(e,i,r,s){return Cm(e,i,Ott(t,r,s,1))}}(),QMe=function(){const t=nv();return function(e,i,r,s){return Cm(e,i,sse(t,r,s,1))}}(),IG=function(){const t=Ye(),e=nv();return function(i,r,s){Cl(i,r);const n=cM(r),o=i.targetGeometry;return FMe(e,ise(r)),Kre(e,e,fn(n,n)),Cm(t,s,e),o.x+=t[0],o.y+=t[1],i}}();function eOe(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function Btt(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Vtt(t,e,i,r,s,n){const o=new Float32Array(6);return o[0]=t,o[1]=e,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function jtt(t,e){return new Float32Array(t,e,6)}function tOe(t,e,i,r){const s=e[r],n=e[r+1];t[r]=i[0]*s+i[2]*n+i[4],t[r+1]=i[1]*s+i[3]*n+i[5]}function Gtt(t,e,i,r=0,s=0,n=2){const o=s||e.length/n;for(let a=r;a<o;a++)tOe(t,e,i,a*n)}Object.freeze(Object.defineProperty({__proto__:null,clone:Btt,create:eOe,createView:jtt,fromValues:Vtt,transform:tOe,transformMany:Gtt},Symbol.toStringTag,{value:"Module"}));function sT(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function Htt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function aL(t,e,i,r,s,n,o,a,l,c){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t}function RG(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function uM(t,e){if(t===e){const i=e[1],r=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function lL(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=h*o-a*c,f=-h*n+a*l,m=c*n-o*l;let g=i*d+r*f+s*m;return g?(g=1/g,t[0]=d*g,t[1]=(-h*r+s*c)*g,t[2]=(a*r-s*o)*g,t[3]=f*g,t[4]=(h*i-s*l)*g,t[5]=(-a*i+s*n)*g,t[6]=m*g,t[7]=(-c*i+r*l)*g,t[8]=(o*i-r*n)*g,t):null}function qtt(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return t[0]=o*h-a*c,t[1]=s*c-r*h,t[2]=r*a-s*o,t[3]=a*l-n*h,t[4]=i*h-s*l,t[5]=s*n-i*a,t[6]=n*c-o*l,t[7]=r*l-i*c,t[8]=i*o-r*n,t}function Wtt(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*n-o*l)+i*(-c*s+o*a)+r*(l*s-n*a)}function cL(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],f=i[0],m=i[1],g=i[2],v=i[3],_=i[4],b=i[5],w=i[6],x=i[7],S=i[8];return t[0]=f*r+m*o+g*c,t[1]=f*s+m*a+g*h,t[2]=f*n+m*l+g*d,t[3]=v*r+_*o+b*c,t[4]=v*s+_*a+b*h,t[5]=v*n+_*l+b*d,t[6]=w*r+x*o+S*c,t[7]=w*s+x*a+S*h,t[8]=w*n+x*l+S*d,t}function ES(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],f=i[0],m=i[1];return t[0]=r,t[1]=s,t[2]=n,t[3]=o,t[4]=a,t[5]=l,t[6]=f*r+m*o+c,t[7]=f*s+m*a+h,t[8]=f*n+m*l+d,t}function PG(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],f=Math.sin(i),m=Math.cos(i);return t[0]=m*r+f*o,t[1]=m*s+f*a,t[2]=m*n+f*l,t[3]=m*o-f*r,t[4]=m*a-f*s,t[5]=m*l-f*n,t[6]=c,t[7]=h,t[8]=d,t}function DG(t,e,i){const r=i[0],s=i[1],n=i[2];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=n*e[6],t[7]=n*e[7],t[8]=n*e[8],t}function Ztt(t,e,i){const r=i[0],s=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t}function Ytt(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function Jtt(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Xtt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Ktt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function O3(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=i+i,a=r+r,l=s+s,c=i*o,h=r*o,d=r*a,f=s*o,m=s*a,g=s*l,v=n*o,_=n*a,b=n*l;return t[0]=1-d-g,t[3]=h-b,t[6]=f+_,t[1]=h+b,t[4]=1-c-g,t[7]=m-v,t[2]=f-_,t[5]=m+v,t[8]=1-c-d,t}function iOe(t,e){const i=e[0],r=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10],d=h*o-a*c,f=-h*n+a*l,m=c*n-o*l,g=i*d+r*f+s*m;if(!g)return null;const v=1/g;return t[0]=d*v,t[1]=(-h*r+s*c)*v,t[2]=(a*r-s*o)*v,t[3]=f*v,t[4]=(h*i-s*l)*v,t[5]=(-a*i+s*n)*v,t[6]=m*v,t[7]=(-c*i+r*l)*v,t[8]=(o*i-r*n)*v,t}function nse(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=e[9],f=e[10],m=e[11],g=e[12],v=e[13],_=e[14],b=e[15],w=i*a-r*o,x=i*l-s*o,S=i*c-n*o,C=r*l-s*a,T=r*c-n*a,M=s*c-n*l,I=h*v-d*g,D=h*_-f*g,P=h*b-m*g,F=d*_-f*v,L=d*b-m*v,N=f*b-m*_;let R=w*N-x*L+S*F+C*P-T*D+M*I;return R?(R=1/R,t[0]=(a*N-l*L+c*F)*R,t[1]=(l*P-o*N-c*D)*R,t[2]=(o*L-a*P+c*I)*R,t[3]=(s*L-r*N-n*F)*R,t[4]=(i*N-s*P+n*D)*R,t[5]=(r*P-i*L-n*I)*R,t[6]=(v*M-_*T+b*C)*R,t[7]=(_*S-g*M-b*x)*R,t[8]=(g*T-v*S+b*w)*R,t):null}function Qtt(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function eit(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function tit(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function iit(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t}function rOe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}function rit(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t}function sit(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t}function nit(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function oit(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],d=e[0],f=e[1],m=e[2],g=e[3],v=e[4],_=e[5],b=e[6],w=e[7],x=e[8],S=To();return Math.abs(i-d)<=S*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(r-f)<=S*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(s-m)<=S*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(n-g)<=S*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(o-v)<=S*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(a-_)<=S*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(l-b)<=S*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(c-w)<=S*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(h-x)<=S*Math.max(1,Math.abs(h),Math.abs(x))}function ait(t){const e=To(),i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8];return Math.abs(1-(i*i+n*n+l*l))<=e&&Math.abs(1-(r*r+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+h*h))<=e}const lit=cL,cit=rOe;Object.freeze(Object.defineProperty({__proto__:null,add:iit,adjoint:qtt,copy:Htt,determinant:Wtt,equals:oit,exactEquals:nit,frob:tit,fromMat2d:Ktt,fromMat4:sT,fromQuat:O3,fromRotation:Jtt,fromScaling:Xtt,fromTranslation:Ytt,identity:RG,invert:lL,isOrthoNormal:ait,mul:lit,multiply:cL,multiplyScalar:rit,multiplyScalarAndAdd:sit,normalFromMat4:nse,normalFromMat4Legacy:iOe,projection:Qtt,rotate:PG,scale:DG,scaleByVec2:Ztt,set:aL,str:eit,sub:cit,subtract:rOe,translate:ES,transpose:uM},Symbol.toStringTag,{value:"Module"}));function Qx(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function sOe(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function uit(t,e,i,r,s,n,o,a,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=i,c[3]=r,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function hit(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:sOe,create:Qx,createView:hit,fromValues:uit},Symbol.toStringTag,{value:"Module"}));function nOe(){return new Float32Array(2)}function dit(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function sd(t,e){const i=new Float32Array(2);return i[0]=t,i[1]=e,i}function pit(t,e){return new Float32Array(t,e,2)}function oOe(){return nOe()}function aOe(){return sd(1,1)}function lOe(){return sd(1,0)}function cOe(){return sd(0,1)}const fit=oOe(),mit=aOe(),git=lOe(),yit=cOe();Object.freeze(Object.defineProperty({__proto__:null,ONES:mit,UNIT_X:git,UNIT_Y:yit,ZEROS:fit,clone:dit,create:nOe,createView:pit,fromValues:sd,ones:aOe,unitX:lOe,unitY:cOe,zeros:oOe},Symbol.toStringTag,{value:"Module"}));function vit(t){return t instanceof Float32Array&&t.length>=2}function _it(t){return Array.isArray(t)&&t.length>=2}function E8(t){return vit(t)||_it(t)}var $J;const Ig=[0,0];let ny=$J=class extends ee{constructor(t){super(t),this._viewpoint2D={center:Ye(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new _i,this.id=0,this.inverseTransform=nv(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=nv(),this.transformNoRotation=nv(),this.displayMat3=Qx(),this.displayViewMat3=Qx(),this.viewMat3=Qx(),this.viewMat2d=eOe(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(t){this._set("pixelRatio",t),this._update()}set size(t){this._set("size",t),this._update()}set viewpoint(t){if(t){const e=this._viewpoint2D,i=t.targetGeometry;e.center[0]=i.x,e.center[1]=i.y,e.rotation=t.rotation,e.scale=t.scale,e.spatialReference=i.spatialReference}this._update()}get visibleArea(){const[t,e]=this.size;return[this.toMap([0,0],0,0),this.toMap([0,0],0,e),this.toMap([0,0],t,e),this.toMap([0,0],t,0)]}copy(t){const e=this.size,i=this.viewpoint;return i&&e?(this.viewpoint=Cl(i,t.viewpoint),this._set("size",Vn(e,t.size))):(this.viewpoint=t.viewpoint.clone(),this._set("size",[t.size[0],t.size[1]])),this._set("pixelRatio",t.pixelRatio),this}clone(){return new $J({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(t,e,i){return E8(e)?Cm(t,e,this.inverseTransform):(Ig[0]=e,Ig[1]=i,Cm(t,Ig,this.inverseTransform))}toScreen(t,e,i){return E8(e)?Cm(t,e,this.transform):(Ig[0]=e,Ig[1]=i,Cm(t,Ig,this.transform))}toScreenNoRotation(t,e,i){return E8(e)?Cm(t,e,this.transformNoRotation):(Ig[0]=e,Ig[1]=i,Cm(t,Ig,this.transformNoRotation))}wrapMapCoordinate(t,e){Vn(t,e);const[i]=e,[r]=this.center,{extent:s,spatialReference:n}=this;let{xmin:o,xmax:a}=s;if(n.isWrappable){const l=JMe(n)/2;o=Math.max(o,r-l),a=Math.min(a,r+l)}return(i<o||i>a)&&(t[0]=ese(i,r,n)),t}getScreenTransform(t,e){const{center:i}=this._viewpoint2D,r=this._get("pixelRatio")||1,s=this._get("size");return rse(t,i,s,e,0,r),t}_update(){const{center:t,spatialReference:e,scale:i,rotation:r}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),o=new Qr({targetGeometry:new Fe(t[0],t[1],e),scale:i,rotation:r});if(this._set("viewpoint",o),!n||!e||!i)return;this.resolution=cM(o),this.rotation=r,this.scale=i,this.spatialReference=e,Vn(this.center,t);const a=n[0]!==0?2/n[0]:0,l=n[1]!==0?-2/n[1]:0;aL(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=RG(this.viewMat3),h=sd(n[0]/2,n[1]/2),d=sd(-n[0]/2,-n[1]/2),f=iL(r);ES(c,c,h),PG(c,c,f),ES(c,c,d),cL(this.displayViewMat3,this.displayMat3,c);const m=Qre(this.viewMat2d,h);return MG(m,m,f),M3(m,m,d),Att(this.extent,o,n),sse(this.transform,o,n,s),Xre(this.inverseTransform,this.transform),Dtt(this.transformNoRotation,o,n,s),this.worldScreenWidth=Ltt(this.spatialReference,this.resolution),this._set("id",this.id+1),this.notifyChange("visibleArea"),this}};u([p({readOnly:!0})],ny.prototype,"id",void 0),u([p({value:1,json:{write:!0}})],ny.prototype,"pixelRatio",null),u([p({json:{write:!0}})],ny.prototype,"size",null),u([p()],ny.prototype,"spatialReference",void 0),u([p({type:Qr,json:{write:!0}})],ny.prototype,"viewpoint",null),u([p({readOnly:!0})],ny.prototype,"visibleArea",null),ny=$J=u([A("esri.views.2d.ViewState")],ny);const Ade=ny;var AJ,MJ;let ky=AJ=class extends he{constructor(){super(...arguments),this.left=0,this.top=0,this.right=0,this.bottom=0}clone(){return new AJ({left:this.left,top:this.top,right:this.right,bottom:this.bottom})}};u([p()],ky.prototype,"left",void 0),u([p()],ky.prototype,"top",void 0),u([p()],ky.prototype,"right",void 0),u([p()],ky.prototype,"bottom",void 0),ky=AJ=u([A("esri.views.2d.PaddedViewState.Padding")],ky);let ZE=MJ=class extends Ade{constructor(...t){super(...t),this.paddedViewState=new Ade,this._updateContent=(()=>{const e=Ye();return()=>{const i=this._get("size"),r=this._get("padding");if(!i||!r)return;const s=this.paddedViewState;di(e,r.left+r.right,r.top+r.bottom),fd(e,i,e),Vn(s.size,e);const n=s.viewpoint;n&&(this.viewpoint=n)}})(),this.addHandles(H(()=>[this.size,this.padding],()=>this._updateContent(),Yt)),this.padding=new ky,this.size=[0,0]}set padding(t){this._set("padding",t||new ky)}set viewpoint(t){if(t){this.paddedViewState.viewpoint=t;let e=t;const i=this._get("padding");i&&(e=Ftt(t.clone(),t,this._get("size"),i));const{targetGeometry:r,rotation:s,scale:n}=e,{x:o,y:a,spatialReference:l}=r,c=this._viewpoint2D;c.center[0]=o,c.center[1]=a,c.rotation=s,c.scale=n,c.spatialReference=l,this._update()}}clone(){return new MJ({padding:this.padding.clone(),size:this.size.slice(),viewpoint:this.paddedViewState.viewpoint.clone(),pixelRatio:this.pixelRatio})}};u([p()],ZE.prototype,"paddedViewState",void 0),u([p({type:ky})],ZE.prototype,"padding",null),u([p()],ZE.prototype,"viewpoint",null),ZE=MJ=u([A("esri.views.2d.PaddedViewState")],ZE);const ose=ZE;var ui;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})(ui||(ui={}));const ea=Symbol("Yield");let bit=class{constructor(){this._tasks=new Array,this._runningTasks=Ta(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(e){if(this.length===0)return ea;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,i,r){return++this._runningTasks.value,new Promise((s,n)=>this._tasks.push(new Mde(s,n,e,i,r))).finally(()=>--this._runningTasks.value)}unshift(e,i,r){return++this._runningTasks.value,new Promise((s,n)=>this._tasks.unshift(new Mde(s,n,e,i,r))).finally(()=>--this._runningTasks.value)}_process(e){var r;if(this._tasks.length===0)return!1;const i=this._tasks.shift();try{const s=Sa(i.signal);if(s&&!i.abortCallback)i.reject(bi());else{const n=s?(r=i.abortCallback)==null?void 0:r.call(i,bi()):i.callback(e);uu(n)?n.then(i.resolve,i.reject):i.resolve(n)}}catch(s){i.reject(s)}return!0}cancelAll(){const e=bi();for(const i of this._tasks)if(i.abortCallback){const r=i.abortCallback(e);i.resolve(r)}else i.reject(e);this._tasks.length=0}},Mde=class{constructor(e,i,r,s=void 0,n=void 0){this.resolve=e,this.reject=i,this.callback=r,this.signal=s,this.abortCallback=n}},OI=class extends he{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};u([p()],OI.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),u([p()],OI.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),OI=u([A("esri.views.support.debugFlags")],OI);const wit=new OI;function uOe(){return new iB.Scheduler}var lt;(function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t.MAPVIEW_FETCH_QUEUE="mapview fetch queue",t.MAPVIEW_LAYERVIEW_UPDATE="mapview layerview update",t.MAPVIEW_VECTOR_TILE_PARSING_QUEUE="mapview vector tile parsing queue",t[t.NONE=0]="NONE",t[t.TEST_PRIO=1]="TEST_PRIO"})(lt||(lt={}));const jh=0,Ode=new Map([[lt.RESOURCE_CONTROLLER_IMMEDIATE,jh],[lt.RESOURCE_CONTROLLER,4],[lt.SLIDE,jh],[lt.STREAM_DATA_LOADER,jh],[lt.ELEVATION_QUERY,jh],[lt.TERRAIN_SURFACE,1],[lt.SURFACE_GEOMETRY_UPDATES,1],[lt.LOD_RENDERER,2],[lt.GRAPHICS_CORE,2],[lt.I3S_CONTROLLER,2],[lt.POINT_CLOUD_LAYER,2],[lt.FEATURE_TILE_FETCHER,2],[lt.CLOUDS_GENERATOR,2],[lt.OVERLAY,4],[lt.STAGE,4],[lt.GRAPHICS_DECONFLICTOR,4],[lt.FILTER_VISIBILITY,4],[lt.SCALE_VISIBILITY,4],[lt.FRUSTUM_VISIBILITY,4],[lt.POINT_OF_INTEREST_FREQUENT,6],[lt.POINT_OF_INTEREST_INFREQUENT,30],[lt.LABELER,8],[lt.FEATURE_QUERY_ENGINE,8],[lt.FEATURE_TILE_TREE,16],[lt.FEATURE_TILE_TREE_ACTIVE,jh],[lt.ELEVATION_ALIGNMENT,12],[lt.ELEVATION_ALIGNMENT_SCENE,14],[lt.TEXT_TEXTURE_ATLAS,12],[lt.TEXTURE_UNLOAD,12],[lt.LINE_OF_SIGHT_TOOL,16],[lt.LINE_OF_SIGHT_TOOL_INTERACTIVE,jh],[lt.SNAPPING,jh],[lt.SHADOW_ACCUMULATOR,30],[lt.MAPVIEW_FETCH_QUEUE,jh],[lt.MAPVIEW_LAYERVIEW_UPDATE,2],[lt.MAPVIEW_VECTOR_TILE_PARSING_QUEUE,jh]]);function Ide(t){return Ode.has(t)?Ode.get(t):typeof t=="number"?t:1}const xit=6.5,Rde=1,Sit=30,Tit=1e3/30,Eit=100,Pde=.9;var iB,Ew;(function(t){class e{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(n=>n.needsUpdate)}constructor(){this._updating=Ta(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new Xy("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=ui.INTERACTING,this._tasks=new ii,this._runQueue=new ii,this._load=0,this._idleStateCallbacks=new ii,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=H(()=>wit.SCHEDULER_LOG_SLOW_TASKS,n=>this._debug=n,Ut);for(const n of Object.keys(lt))this.performanceInfo.tasks.set(lt[n],new Xy(lt[n]))}destroy(){this._tasks.toArray().forEach(n=>n.remove()),this._tasks.clear(),Ji(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(n){this._updatingChanged(),n&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this._runFrame())}))}registerTask(n,o){const a=new i(this,n,o);return this._tasks.push(a),this._updatingChanged(),this.performanceInfo.tasks.has(n)||this.performanceInfo.tasks.set(n,new Xy(n)),a}registerIdleStateCallbacks(n,o){const a={idleBegin:n,idleEnd:o};this._idleStateCallbacks.push(a),this.state===ui.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===ui.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(n){this._state!==n&&(this._state=n,this.state!==ui.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}frame(n){this._startFrameTaskTimes();const o=this._updateBudget(n);if(o){const a=this._budget.now();this._runFrame(),this._recordFrameTaskTimes(this._budget.now()-a)}else this._recordFrameTaskTimes(0);return o}_updateBudget(n){this._test&&(this._test.usedBudget=0),++this._frameNumber;let o=xit,a=n.frameDuration,l=Rde;switch(this.state){case ui.IDLE:o=0,a=Math.max(Eit,n.frameDuration),l=Sit;break;case ui.INTERACTING:a=Math.max(Tit,n.frameDuration);case ui.ANIMATING:}return a=a-n.elapsedFrameTime-o,this.state!==ui.IDLE&&a<Rde&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}_runFrame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case ui.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(n=>n.idleBegin())),this._runIdle();break;case ui.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test&&(this._test.usedBudget=this._budget.elapsed)}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(n){this._idleUpdatesStartFired&&n.idleEnd(),this._idleStateCallbacks.removeUnordered(n)}removeTask(n){this._tasks.removeUnordered(n),this._runQueue.removeUnordered(n),this._updatingChanged()}_updateTask(n){this._tasks.forAll(o=>{o.name===n&&o.setPriority(n)})}_getState(n){if(this._runQueue.some(a=>a.name===n))return Ew.SCHEDULED;let o=Ew.IDLE;return this._tasks.forAll(a=>{a.name===n&&a.needsUpdate&&(a.schedulePriority<=1?o=Ew.READY:o!==Ew.READY&&(o=Ew.WAITING))}),o}_getRuntime(n){let o=0;return this._tasks.forAll(a=>{a.name===n&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(n=>n.runtime=0)}_getRunning(){const n=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&n.set(a.name,(n.get(a.name)||0)+1)}),n.size===0)return null;let o="";return n.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const n=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*Pde+n*(1-Pde)}_schedule(){for(this._runQueue.filterInPlace(n=>!!n.needsUpdate||(n.schedulePriority=n.basePriority,!1)),this._tasks.forAll(n=>{n.basePriority===jh&&n.needsUpdate&&!this._runQueue.includes(n)&&n.blockFrame!==this._frameNumber&&this._runQueue.unshift(n)});this._runQueue.length===0;){let n=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==jh&&a.blockFrame!==this._frameNumber&&(n=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!n)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){do for(;this._runQueue.length>0;){const n=this._budget.now(),o=this._runQueue.pop();this._budget.resetProgress();try{o.task.runTask(this._budget)===ea&&(o.blockFrame=this._frameNumber)}catch(l){J.getLogger("esri.views.support.Scheduler").error(`Exception in task "${o.name}"`,l),o.blockFrame=this._frameNumber}!this._budget.hasProgressed&&o.blockFrame!==this._frameNumber&&o.needsUpdate&&(o.name,lt.I3S_CONTROLLER,o.blockFrame=this._frameNumber),o.schedulePriority=o.basePriority;const a=this._budget.now()-n;if(o.runtime+=a,this._frameTaskTimes.set(o.priority,this._frameTaskTimes.get(o.priority)+a),this._budget.remaining<=0)return void this._updatingChanged()}while(this._schedule());this._updatingChanged()}_startFrameTaskTimes(){for(const n of Object.keys(lt))this._frameTaskTimes.set(lt[n],0)}_recordFrameTaskTimes(n){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).push(o)),this.performanceInfo.total.push(n)}get test(){return this._test}}t.Scheduler=e;class i{get task(){return this._task.value}get updating(){return this._queue.running}constructor(n,o,a){this._scheduler=n,this.name=o,this.blockFrame=0,this.runtime=0,this._queue=new bit,this._handles=new fg,this._basePriority=Ide(o),this.schedulePriority=this._basePriority,this._task=Ta(a??this._queue),this._handles.add(bn(()=>this.task.running,l=>n.taskRunningChanged(l)))}remove(){this.processQueue(Kc),this._scheduler.removeTask(this),this.schedule=nA.schedule,this.reschedule=nA.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(n){if(this.name===n)return;this.name=n;const o=Ide(n);this._basePriority!==jh&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(n){this.setPriority(n)}get needsUpdate(){return this.updating||this.task.running}schedule(n,o,a){return this._queue.push(n,o,a)}reschedule(n,o,a){return this._queue.unshift(n,o,a)}processQueue(n){return this._queue.runTask(n)}}class r{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=ui.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=r})(iB||(iB={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(Ew||(Ew={}));const Kc=(()=>{const t=new iB.Budget;return t.enabled=!1,t})();let Cit=class{remove(){}processQueue(){}schedule(e,i,r){try{if(Sa(i)){const s=bi();return r?Promise.resolve(r(s)):Promise.reject(s)}return IW(e(Kc))}catch(s){return Promise.reject(s)}}reschedule(e,i,r){return this.schedule(e,i,r)}};const nA=new Cit;let $it=class{constructor(e){this.view=e,this._stationaryHandle=null,this._frameTaskHandle=null,this._updateParameters=null,this._updateRequested=!1,this._scheduler=uOe(),this._schedulerHandle=bn(()=>this._scheduler.updating,()=>this.requestFrame()),this.stationary=!0,this.prepare=()=>{var i;this._updateParameters&&(this._updateParameters.state=this.view.state,this._updateParameters.stationary=this.view.stationary,this._updateParameters.pixelRatio=window.devicePixelRatio,this._updateParameters.renderingOptions=this.view.renderingOptions,this._updateParameters.targetState.copy(this.view.state),((i=this.view.animation)==null?void 0:i.target)==null||uu(this.view.animation.target)||(this._updateParameters.targetState.viewpoint=this.view.animation.target))},this.update=i=>{var a,l,c;if(this._updateRequested=!1,(a=this.view)==null?void 0:a.destroyed)return;const{allLayerViews:r,graphicsView:s,labelManager:n,state:{id:o}}=this.view;r==null||r.forEach(this._updateLayerView,this),n!=null&&(n.lastUpdateId!==o&&(n.viewChange(),n.lastUpdateId=o),n.updateRequested&&n.processUpdate(this._updateParameters)),s!=null&&(s.lastUpdateId!==o&&(s.viewChange(),s.lastUpdateId=o),s.updateRequested&&s.processUpdate(this._updateParameters)),(l=this.view.graphicsTileStore)==null||l.setViewState(this._updateParameters.state),this.view.animation?this._scheduler.state=ui.ANIMATING:this.view.interacting?this._scheduler.state=ui.INTERACTING:this._scheduler.state=ui.IDLE,this._scheduler.frame(i)||this._updateRequested||this._scheduler.state!==ui.IDLE||((c=this._frameTaskHandle)==null||c.pause())}}destroy(){this.stop(),this._schedulerHandle.remove(),this._scheduler.destroy()}get scheduler(){return this._scheduler}start(){if(this._frameTaskHandle)return;const e=this.view;this.stationary=e.stationary,this._updateParameters={state:e.state,targetState:new ose,pixelRatio:window.devicePixelRatio,stationary:this.stationary,renderingOptions:e.renderingOptions},this._stationaryHandle=H(()=>e.stationary,i=>{this.stationary=i,this.requestFrame()}),this._frameTaskHandle=tg(this),this.requestUpdate()}stop(){var e;this._frameTaskHandle&&(this._updateRequested=!1,(e=this._stationaryHandle)==null||e.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._frameTaskHandle=null,this.stationary=!0)}requestUpdate(){this._updateRequested||(this._updateRequested=!0,this.requestFrame())}requestFrame(){this._frameTaskHandle&&this._frameTaskHandle.resume()}_updateLayerView(e){var s;if(!e.attached)return void this.requestUpdate();const i=this.view.state,r=e.lastUpdateId;r!=null&&(this.stationary||e.moving)||(e.moving=!0),r!==i.id&&e.viewChange(),this.stationary&&e.moving&&(e.moving=!1,e.moveEnd()),e.lastUpdateId=i.id,e.updateRequested&&e.processUpdate(this._updateParameters),"layerViews"in e&&((s=e.layerViews)==null||s.forEach(this._updateLayerView,this))}},e_=class extends iw{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=ta(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._resolver)==null||e.reject(new U("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._resolver)==null||e.resolve())}update(e,i){i||(i=uu(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",i)}};u([p({readOnly:!0})],e_.prototype,"done",null),u([p({readOnly:!0,type:String})],e_.prototype,"state",void 0),u([p()],e_.prototype,"target",void 0),e_=u([A("esri.views.ViewAnimation")],e_),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(e_||(e_={}));const xv=e_;let o5=class extends he{constructor(e){super(e),this._gotoTask=null}destroy(){this._gotoTask=null}async goTo(e,i){if(!e)return void J.getLogger(this).error("#goTo()","target cannot be null or undefined");const r=new xv;this.view.animation=r,await Id(()=>this.view.ready,i);const s={...i,animate:(i==null?void 0:i.animate)??!yMe(),animationMode:(i==null?void 0:i.animationMode)??"auto"},{extent:n,spatialReference:o,size:a,viewpoint:l,constraints:c,padding:h,allLayerViews:d}=this.view,f=Ctt(e,{extent:n,spatialReference:o,size:a,viewpoint:l,constraints:c,padding:h,allLayerViews:d,pickClosestTarget:(i==null?void 0:i.pickClosestTarget)??!0});return r==null||r.update(f),this._gotoTask={},s.animate?this._gotoAnimated(f,s):this._gotoImmediate(f,s)}_gotoImmediate(e,i){const r=this._gotoTask,s=this.view.animation,n=e.then(o=>{if(gt(i),r!==this._gotoTask)throw new U("view:goto-interrupted","Goto was interrupted");this.view.viewpoint=s.target=o,s.finish()});return this._cancellableGoTo(r,s,n,i)}_gotoAnimated(e,i){const r=this._gotoTask,s=this.view.animation;if(!s)return Promise.resolve();const n=e.then(o=>{if(gt(i),r!==this._gotoTask)throw new U("view:goto-interrupted","Goto was interrupted");return s.update(o),this.view.animationManager.animate(s,this.view.viewpoint,i),s.when().then(()=>{},()=>{})});return this._cancellableGoTo(r,s,n,i)}_cancellableGoTo(e,i,r,s){const n=()=>e===this._gotoTask;return oie(r,s).finally(()=>{n()&&(i.done||i.stop())})}};u([p({constructOnly:!0})],o5.prototype,"view",void 0),o5=u([A("esri.views.2d.GoToManager")],o5);function Ait(t,e){const{spatialReference:i}=e,r=[e.x,e.y];let s,n,o,a;const l=[0,0],c=Mit(t);for(let f=0;f<c.length;f++){const m=c[f];for(let g=0;g<m.length-1;g++){g8e(l,r,m,g);const v=wv(r,l);(s==null||v<s)&&(s=v,n=[...l],o=f,a=g)}}if(s==null||!n||o==null||a==null)throw new U("nearest-coordinate:failed","Failed to find the nearest coordinate");const[h,d]=n;return{coordinate:new Fe({x:h,y:d,spatialReference:i}),distance:s}}function Mit(t){switch(t.type){case"extent":return[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]];case"polygon":return t.rings;case"polyline":return t.paths}}var OJ;let px=OJ=class extends XS.NumericIdentifiableMixin(he){constructor(t){super(t),this.geometry=null,this.spatialReference=null}get normalizedGeometry(){if(this.geometry==null||!this.spatialReference)return null;if(!this.spatialReference.equals(this.geometry.spatialReference))try{return Nd(this.geometry,this.spatialReference)}catch(t){return J.getLogger(this).error("#constraints.geometry","could not project the geometry to the view's spatial reference",{geometry:this.geometry,spatialReference:this.spatialReference,error:t}),null}return this.geometry}constrain(t,e){if(this.normalizedGeometry==null)return t;const i=t.targetGeometry;if(this.normalizedGeometry.type==="extent"?jD(this.normalizedGeometry,i):Die(this.normalizedGeometry,i))return t;const{coordinate:r}=Ait(this.normalizedGeometry,i);return r&&(t.targetGeometry=r),t}clone(){var t,e;return new OJ({geometry:(t=this.geometry)==null?void 0:t.clone(),spatialReference:(e=this.spatialReference)==null?void 0:e.clone()})}};u([p({constructOnly:!0})],px.prototype,"geometry",void 0),u([p({readOnly:!0})],px.prototype,"normalizedGeometry",null),u([p({constructOnly:!0})],px.prototype,"spatialReference",void 0),px=OJ=u([A("esri.views.2d.constraints.GeometryConstraint")],px);var IJ;let II=IJ=class extends XS.NumericIdentifiableMixin(he){constructor(){super(...arguments),this.enabled=!0,this.rotationEnabled=!0}constrain(t,e){return this.enabled&&e&&(this.rotationEnabled||(t.rotation=e.rotation)),t}clone(){return new IJ({enabled:this.enabled,rotationEnabled:this.rotationEnabled})}};u([p()],II.prototype,"enabled",void 0),u([p()],II.prototype,"rotationEnabled",void 0),II=IJ=u([A("esri.views.2d.constraints.RotationConstraint")],II);const hOe=II;var RJ;let $c=RJ=class extends XS.NumericIdentifiableMixin(he){constructor(t){super(t),this._lodByScale={},this._scales=[],this.effectiveLODs=null,this.effectiveMinZoom=-1,this.effectiveMaxZoom=-1,this.effectiveMinScale=0,this.effectiveMaxScale=0,this.lods=null,this.minZoom=-1,this.maxZoom=-1,this.minScale=0,this.maxScale=0,this.snapToZoom=!0}initialize(){let t,{lods:e,minScale:i,maxScale:r,minZoom:s,maxZoom:n}=this,o=-1,a=-1,l=!1,c=!1;if(i!==0&&r!==0&&i<r&&([i,r]=[r,i]),!(e!=null&&e.length))return this._set("effectiveMinScale",i),void this._set("effectiveMaxScale",r);e=e.map(h=>h.clone()),e.sort((h,d)=>d.scale-h.scale),e.forEach((h,d)=>h.level=d);for(const h of e)!l&&i>0&&i>=h.scale&&(o=h.level,l=!0),!c&&r>0&&r>=h.scale&&(a=t?t.level:-1,c=!0),t=h;s===-1&&(s=i===0?0:o),n===-1&&(n=r===0?e.length-1:a),s=Math.max(s,0),s=Math.min(s,e.length-1),n=Math.max(n,0),n=Math.min(n,e.length-1),s>n&&([s,n]=[n,s]),i=e[s].scale,r=e[n].scale,e.splice(0,s),e.splice(n-s+1,e.length),e.forEach((h,d)=>{this._lodByScale[h.scale]=h,this._scales[d]=h.scale}),this._set("effectiveLODs",e),this._set("effectiveMinZoom",s),this._set("effectiveMaxZoom",n),this._set("effectiveMinScale",i),this._set("effectiveMaxScale",r)}constrain(t,e){if(e&&t.scale===e.scale)return t;const i=this.effectiveMinScale,r=this.effectiveMaxScale,s=t.targetGeometry,n=e&&e.targetGeometry,o=r!==0&&t.scale<r,a=i!==0&&t.scale>i;if(o||a){const l=a?i:r;if(e&&n){const c=(l-e.scale)/(t.scale-e.scale);s.x=n.x+(s.x-n.x)*c,s.y=n.y+(s.y-n.y)*c}t.scale=l}return this.snapToZoom&&this.effectiveLODs&&(t.scale=this._getClosestScale(t.scale)),t}fit(t){if(!this.effectiveLODs||!this.snapToZoom)return this.constrain(t,null);const e=this.scaleToZoom(t.scale),i=Math.abs(e-Math.floor(e));return t.scale=this.zoomToScale(i>.99?Math.round(e):Math.floor(e)),t}zoomToScale(t){if(!this.effectiveLODs)return 0;t-=this.effectiveMinZoom,t=Math.max(0,t);const e=this._scales;if(t<=0)return e[0];if(t>=e.length)return e[e.length-1];const i=Math.floor(t),r=Math.ceil(t);return e[i]+(t-i)*(e[r]-e[i])}scaleToZoom(t){if(!this.effectiveLODs)return-1;const e=this._scales;let i,r;if(t>=e[0])return this.effectiveMinZoom;if(t<=e[e.length-1])return this.effectiveMaxZoom;for(let s=0;s<e.length-1;s++){if(i=e[s],r=e[s+1],r===t)return s+this.effectiveMinZoom+1;if(i>t&&r<t)return s+this.effectiveMinZoom+1-(t-r)/(i-r)}return-1}snapToClosestScale(t){if(!this.effectiveLODs)return t;const e=this.scaleToZoom(t);return this.zoomToScale(Math.round(e))}snapToNextScale(t,e=.5){if(!this.effectiveLODs)return t*e;const i=Math.round(this.scaleToZoom(t));return this.zoomToScale(i+1)}snapToPreviousScale(t,e=2){if(!this.effectiveLODs)return t*e;const i=Math.round(this.scaleToZoom(t));return this.zoomToScale(i-1)}clone(){return new RJ({lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})}_getClosestScale(t){return this._lodByScale[t]||(t=this._scales.reduce((e,i)=>Math.abs(i-t)<=Math.abs(e-t)?i:e,this._scales[0])),this._lodByScale[t].scale}};u([p({readOnly:!0})],$c.prototype,"effectiveLODs",void 0),u([p({readOnly:!0})],$c.prototype,"effectiveMinZoom",void 0),u([p({readOnly:!0})],$c.prototype,"effectiveMaxZoom",void 0),u([p({readOnly:!0})],$c.prototype,"effectiveMinScale",void 0),u([p({readOnly:!0})],$c.prototype,"effectiveMaxScale",void 0),u([p()],$c.prototype,"lods",void 0),u([p()],$c.prototype,"minZoom",void 0),u([p()],$c.prototype,"maxZoom",void 0),u([p()],$c.prototype,"minScale",void 0),u([p()],$c.prototype,"maxScale",void 0),u([p()],$c.prototype,"snapToZoom",void 0),$c=RJ=u([A("esri.views.2d.constraints.ZoomConstraint")],$c);const dOe=$c,Oit={base:null,key:"type",typeMap:{extent:_i,polygon:Ea}};let Tn=class extends he{constructor(e){super(e),this.lods=null,this.minScale=0,this.maxScale=0,this.minZoom=-1,this.maxZoom=-1,this.rotationEnabled=!0,this.snapToZoom=!0,this.customConstraints=new Ce}destroy(){this.view=null}get effectiveLODs(){return this._zoom.effectiveLODs}get effectiveMinScale(){return this._zoom.effectiveMinScale}get effectiveMaxScale(){return this._zoom.effectiveMaxScale}get effectiveMinZoom(){return this._zoom.effectiveMinZoom}get effectiveMaxZoom(){return this._zoom.effectiveMaxZoom}set geometry(e){e?this._set("geometry",e):this._set("geometry",null)}get version(){var e,i,r;return`${(e=this._zoom)==null?void 0:e.uid}/${(i=this._rotation)==null?void 0:i.uid}/${(r=this._geometry)==null?void 0:r.uid}`}get _geometry(){var i,r;const e=this._get("_geometry");return e&&this.geometry===e.geometry&&((i=this.view)==null?void 0:i.constraintsInfo.spatialReference)===e.spatialReference?e:new px({geometry:this.geometry,spatialReference:(r=this.view)==null?void 0:r.constraintsInfo.spatialReference})}get _rotation(){return new hOe({rotationEnabled:this.rotationEnabled})}get _zoom(){var l;const e=this._get("_zoom"),i=this.lods||((l=this.view)==null?void 0:l.constraintsInfo.lods),r=this.minZoom,s=this.maxZoom,n=this.minScale,o=this.maxScale,a=this.snapToZoom;return e&&e.lods===i&&e.minZoom===r&&e.maxZoom===s&&e.minScale===n&&e.maxScale===o&&e.snapToZoom===a?e:new dOe({lods:i,minZoom:r,maxZoom:s,minScale:n,maxScale:o,snapToZoom:a})}canZoomInTo(e){const i=this.effectiveMaxScale;return i===0||e>=i}canZoomOutTo(e){const i=this.effectiveMinScale;return i===0||e<=i}constrain(e,i){return this._zoom.constrain(e,i),this._rotation.constrain(e,i),this._geometry.constrain(e,i),this.customConstraints.forEach(r=>r.constrain(e,i)),e}constrainByGeometry(e){return this._geometry.constrain(e),this.customConstraints.forEach(i=>{var r;return(r=i.applyPanConstraint)==null?void 0:r.call(i,e)}),e}fit(e){return this._zoom.fit(e)}zoomToScale(e){return this._zoom.zoomToScale(e)}scaleToZoom(e){return this._zoom.scaleToZoom(e)}snapScale(e){return this._zoom.snapToClosestScale(e)}snapToNextScale(e){return this._zoom.snapToNextScale(e)}snapToPreviousScale(e){return this._zoom.snapToPreviousScale(e)}};u([p({readOnly:!0})],Tn.prototype,"effectiveLODs",null),u([p({readOnly:!0})],Tn.prototype,"effectiveMinScale",null),u([p({readOnly:!0})],Tn.prototype,"effectiveMaxScale",null),u([p({readOnly:!0})],Tn.prototype,"effectiveMinZoom",null),u([p({readOnly:!0})],Tn.prototype,"effectiveMaxZoom",null),u([p({types:Oit,value:null})],Tn.prototype,"geometry",null),u([p({type:[td]})],Tn.prototype,"lods",void 0),u([p()],Tn.prototype,"minScale",void 0),u([p()],Tn.prototype,"maxScale",void 0),u([p()],Tn.prototype,"minZoom",void 0),u([p()],Tn.prototype,"maxZoom",void 0),u([p()],Tn.prototype,"rotationEnabled",void 0),u([p()],Tn.prototype,"snapToZoom",void 0),u([p({type:Ce})],Tn.prototype,"customConstraints",void 0),u([p()],Tn.prototype,"view",void 0),u([p({readOnly:!0})],Tn.prototype,"version",null),u([p({type:px,readOnly:!0})],Tn.prototype,"_geometry",null),u([p({type:hOe})],Tn.prototype,"_rotation",null),u([p({readOnly:!0,type:dOe})],Tn.prototype,"_zoom",null),Tn=u([A("esri.views.2d.MapViewConstraints")],Tn);const Dde=Tn;let dl=class extends he{constructor(e){super(e),this.constraints=null,this.ready=!1,this.resizeAlign="center",this.addHandles([H(()=>{var i;return(i=this.constraints)==null?void 0:i.version},i=>{this.constraints&&i&&this.ready&&(this.state.viewpoint=this.constraints.fit(this.state.paddedViewState.viewpoint))},Yt)])}get center(){if(!this.ready)return this._get("center");const{center:e,spatialReference:i}=this.state.paddedViewState;return this.state.commitProperty("id"),new Fe({x:e[0],y:e[1],spatialReference:i})}set center(e){if(e==null)return;if(!this.ready)return void this._set("center",e);let i;try{i=this._project(e,this.state.spatialReference)}catch(s){return void J.getLogger(this).error(new U("mapview:invalid-center","could not project the value in the view's spatial reference",{input:e,error:s}))}const r=this.viewpoint;CJ(r,r,i),this.viewpoint=r}get extent(){return this.ready?(this.state.commitProperty("id"),this.state.paddedViewState.extent.clone()):this._get("extent")}set extent(e){if(e==null)return;if(!e.width||!e.height)return void J.getLogger(this).error(new U("mapview:invalid-extent","invalid extent size"));if(!this.ready)return this._set("extent",e),this._set("center",void 0),this._set("viewpoint",void 0),this._set("scale",void 0),void this._set("zoom",void 0);let i;try{i=this._project(e,this.state.spatialReference)}catch(s){return void J.getLogger(this).error(new U("mapview:invalid-extent","could not project the value in the view's spatial reference",{error:s}))}const r=this.viewpoint;Mtt(r,r,i,this.state.size,{constraints:this.constraints}),this.viewpoint=r}get padding(){return this.ready?this.state.padding:this._get("padding")}set padding(e){this.ready?(this.state.padding=e,this._set("padding",this.state.padding)):this._set("padding",e)}get resolution(){return this.ready?(this.state.commitProperty("id"),this.state.resolution):0}get rotation(){return this.ready?(this.state.commitProperty("id"),this.state.rotation):this._get("rotation")}set rotation(e){if(isNaN(e))return;if(!this.ready)return void this._set("rotation",e);const i=this.viewpoint;ztt(i,i,e),this.viewpoint=i}get scale(){return this.ready?(this.state.commitProperty("id"),this.state.scale):this._get("scale")}set scale(e){if(!e||isNaN(e))return;if(!this.ready){this._set("scale",e),this._set("zoom",void 0);const r=this._get("extent");return void(r&&(this._set("extent",void 0),this._set("center",r.center)))}const i=this.viewpoint;$de(i,i,e),this.viewpoint=i}get viewpoint(){return this.ready?this.state.paddedViewState.viewpoint.clone():this._get("viewpoint")}set viewpoint(e){var n;if(e==null)return;if(!this.ready)return this._set("viewpoint",e),this._set("extent",void 0),this._set("center",void 0),this._set("zoom",void 0),void this._set("scale",void 0);let i,r;try{i=this._project(e,this.state.spatialReference),!e.scale||isNaN(e.scale)?r=new U("mapview:invalid-viewpoint",`invalid scale value of ${e.scale}`):e.targetGeometry==null&&(r=new U("mapview:invalid-viewpoint","geometry not defined"))}catch(o){r=new U("mapview:invalid-viewpoint","could not project the value in the view's spatial reference",{error:o})}if(r)return void J.getLogger(this).error(r);this._scaleBeforeChangingSpatialReference=null;const s=new Qr({targetGeometry:new Fe,scale:0,rotation:0});Cl(s,i),(n=this.constraints)==null||n.constrain(s,this.state.paddedViewState.viewpoint),this.state.viewpoint=s,this._set("viewpoint",s)}get visibleArea(){return this.ready?this.state.visibleArea:null}get zoom(){var e;return this.ready?((e=this.constraints)==null?void 0:e.scaleToZoom(this.scale))??-1:this._get("zoom")}set zoom(e){var s,n;if(!(e>=0))return;if(!this.ready){this._set("zoom",e),this._set("scale",void 0);const o=this._get("extent");return void(o&&(this._set("extent",void 0),this._set("center",o.center)))}const i=((s=this.constraints)==null?void 0:s.zoomToScale(e))??0;if(!i)return void this._set("zoom",-1);const r=this.viewpoint;$de(r,r,i),this.viewpoint=r,this._set("zoom",((n=this.constraints)==null?void 0:n.scaleToZoom(this.scale))??-1)}getUserStartupOptions(e){if(!e[0]&&!e[1])return{center:void 0,rotation:void 0,scale:void 0};const{padding:i,constraints:r}=this,s=this._get("center"),n=this._get("extent"),o=this._get("scale"),a=this._get("rotation"),l=this._get("viewpoint"),c=this._get("zoom"),h=c!=null&&r!=null&&r.zoomToScale(c)||void 0;let d,f,m;const g=l==null?void 0:l.rotation,v=l==null?void 0:l.targetGeometry;(v==null?void 0:v.type)==="extent"?d=v:(v==null?void 0:v.type)==="point"&&(f=v,m=l==null?void 0:l.scale);const _=n??d;return{center:s??f??(_==null?void 0:_.center),rotation:a??g,scale:(o??h??m??(_&&OG(_,[e[0]-i.left-i.right,e[1]-i.top-i.bottom])))||void 0}}startup(e,i,r,s){var o;const n=e.targetGeometry;try{this._project(e,r)}catch(a){J.getLogger(this).warn(new ch("mapview:startup-projection-error","projection of initial viewpoint to the view's spatial reference, defaulting to the initial viewpoint.",{center:n.toJSON(),spatialReference:r,error:a})),e.targetGeometry=s||new Fe({x:0,y:0,spatialReference:r})}(o=this.constraints)==null||o.fit(e),this._set("state",new ose({padding:this.padding,size:i,viewpoint:e})),this._set("ready",!0)}teardown(){this._set("ready",!1);const{center:[e,i],spatialReference:r,rotation:s,scale:n}=this.state.paddedViewState,o=new Fe({x:e,y:i,spatialReference:r});this._set("viewpoint",null),this._set("extent",null),this._set("center",o),this._set("zoom",-1),this._set("rotation",s),this._set("scale",n),this._set("state",null)}changeSpatialReference(e){var l;const i=this.state.paddedViewState.clone();if(this._scaleBeforeChangingSpatialReference==null)this._scaleBeforeChangingSpatialReference=i.scale;else{const c=i.viewpoint.clone();c.scale=this._scaleBeforeChangingSpatialReference,i.viewpoint=c}const r=i.clone(),[s,n]=i.center;let o=null;try{o=this._project(new Fe({x:s,y:n,spatialReference:i.spatialReference}),e)}catch(c){Cie()||J.getLogger(this).warn(new ch("mapview:spatial-reference-change","could not project the view's center to the new spatial reference",{center:o==null?void 0:o.toJSON(),spatialReference:e,error:c}))}o||(o=new Fe({x:0,y:0,spatialReference:e}));const a=CJ(new Qr({targetGeometry:new Fe,scale:0,rotation:0}),i.viewpoint,o);r.viewpoint=a;try{const h=[i.size[0]/2,i.size[1]/2],d=[h[0]+20,h[1]],f=i.toMap([0,0],d),{x:m,y:g}=this._project(new Fe({x:f[0],y:f[1],spatialReference:i.spatialReference}),e);f[0]=m,f[1]=g,r.toScreen(f,f);const v=Ntt(h,f,d),_=Math.hypot(f[0]-h[0],f[1]-h[1])/20;!Number.isFinite(_)||Math.abs(_)>4?(a.rotation=0,a.targetGeometry=new Fe({x:0,y:0,spatialReference:e})):(a.scale*=_,a.scale>X("mapview-srswitch-adjust-rotation-scale-threshold")?a.rotation=0:a.rotation+=Number.isFinite(v)?v:0)}catch{}(l=this._get("constraints"))==null||l.constrain(a,void 0),this._get("state").viewpoint=a}resize(e,i){var o;if(!this.ready)return;const r=this.state;let s=this.state.paddedViewState.viewpoint;const n=this.state.paddedViewState.size.slice();r.size=[e,i],ktt(s,s,n,this.state.paddedViewState.size,this.resizeAlign),s=((o=this.constraints)==null?void 0:o.constrain(s,void 0))??s,this.state.viewpoint=s}toMap(e){if(!this.ready)return null;const i=[0,0],[r,s]=this.state.toMap(i,[e.x,e.y]),n=this.state.spatialReference;return new Fe({x:r,y:s,spatialReference:n})}toScreen(e,i){if(!this.ready)return null;const r=this._project(e,this.state.spatialReference),s=[r.x,r.y];return(i==null?void 0:i.pickClosestTarget)===!1||this.state.paddedViewState.wrapMapCoordinate(s,s),this.state.toScreen(s,s),xo(s[0],s[1])}_project(e,i){var n;const r=(e==null?void 0:e.targetGeometry)||e;if(!i)return e;if(!r)return null;if(i.imageCoordinateSystem||(n=r.spatialReference)!=null&&n.imageCoordinateSystem||as(i,r.spatialReference))return e;const s=Nd(r,i);if(!s)throw new U("mapview:projection-not-possible","projecting input geometry to target spatial reference returned a null value",{geometry:r,spatialReference:i});return Iit(e)?(e.targetGeometry=s,e):s}};function Iit(t){return(t==null?void 0:t.declaredClass)==="esri.Viewpoint"}u([p({type:Fe})],dl.prototype,"center",null),u([p()],dl.prototype,"constraints",void 0),u([p({type:_i})],dl.prototype,"extent",null),u([p({value:{top:0,right:0,bottom:0,left:0},cast:t=>({top:0,right:0,bottom:0,left:0,...t})})],dl.prototype,"padding",null),u([p()],dl.prototype,"ready",void 0),u([p()],dl.prototype,"resizeAlign",void 0),u([p({readOnly:!0})],dl.prototype,"resolution",null),u([p({type:Number})],dl.prototype,"rotation",null),u([p({type:Number})],dl.prototype,"scale",null),u([p({readOnly:!0})],dl.prototype,"state",void 0),u([p({type:Qr})],dl.prototype,"viewpoint",null),u([p({readOnly:!0})],dl.prototype,"visibleArea",null),u([p()],dl.prototype,"zoom",null),dl=u([A("esri.views.2d.ViewStateManager")],dl);function ase(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function pOe(t,e){return e.some(i=>ase(t,i))}function lse(t,e){const{button:i,pointerType:r}=t;return r!=="touch"&&e.some(s=>s==="primary"&&i===0||s==="secondary"&&i===2||s==="tertiary"&&i===1)}function hP(t,{dragPrimary:e,dragSecondary:i,dragTertiary:r}){return[{key:"primary",value:e},{key:"secondary",value:i},{key:"tertiary",value:r}].filter(s=>s.value===t).map(s=>s.key)}let Lde=class extends ls{constructor(e,i){super(!0),this._view=e,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r,i))}_handleDoubleClick(e,i){ase(e.data,"primary")&&(e.stopPropagation(),i?this._view.mapViewNavigation.zoomOut([e.data.x,e.data.y]):this._view.mapViewNavigation.zoomIn([e.data.x,e.data.y]))}},Rit=class extends ls{constructor(e,i,r){super(!0),this.view=e,this.pointerType=i,this.registerIncoming("double-tap-drag",r,s=>this._handleDoubleTapDrag(s))}_handleDoubleTapDrag(e){const{data:i}=e,{pointerType:r}=i;if(r!==this.pointerType)return;e.stopPropagation();const{action:s,delta:n}=i,{view:o}=this,{mapViewNavigation:a}=o;switch(s){case"begin":{const{scale:l}=o;this._startScale=l,this._currentScale=l,this._previousDelta=n,a.begin();break}case"update":{if(this._previousDelta.y===n.y)return;this._previousDelta=n;const l=1.015**n.y,c=this._startScale*l,h=c/this._currentScale;a.setViewpointImmediate(h),this._currentScale=c;break}case"end":{const{constraints:l}=o,{effectiveLODs:c,snapToZoom:h}=l;if(!h||!c)return void a.end();const d=l.snapScale(this._currentScale),f=(n.y>0?Math.max(d,l.snapToPreviousScale(this._startScale)):Math.min(d,l.snapToNextScale(this._startScale)))/this._currentScale;a.zoom(f).then(()=>{a.end()});break}}}},uL=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const i=e.data,r=i.pointers.size;switch(i.action){case"start":this._currentCount=r,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){var i,r;this._startEvent=e,(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){var i,r;(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){var i,r;(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},Pit=class extends ls{constructor(e,i,r){super(!0),this.view=e,this.pointerActions=i,this.registerIncoming("drag",r,s=>this._handleDrag(s)),this.registerIncoming("pointer-down",()=>this.stopMomentumNavigation())}onInstall(e){super.onInstall(e),this._dragEventSeparator=new uL({start:(i,r)=>{this.view.mapViewNavigation.pan.begin(this.view,r.data),r.stopPropagation()},update:(i,r)=>{this.view.mapViewNavigation.pan.update(this.view,r.data),r.stopPropagation()},end:(i,r)=>{this.view.mapViewNavigation.pan.end(this.view,r.data),r.stopPropagation()},condition:(i,r)=>i===1&&pOe(r.data,this.pointerActions)})}_handleDrag(e){const i=this.view.mapViewNavigation;i.pinch.zoomMomentum||i.pinch.rotateMomentum?this.stopMomentumNavigation():this._dragEventSeparator.handle(e)}stopMomentumNavigation(){this.view.mapViewNavigation.pan.stopMomentumNavigation()}},Dit=class extends ls{constructor(e,i,r){super(!0),this._view=e,this.pointerActions=i;const s=this._view.mapViewNavigation;this._dragEventSeparator=new uL({start:(n,o)=>{s.rotate.begin(this._view,o.data),o.stopPropagation()},update:(n,o)=>{s.rotate.update(this._view,o.data),o.stopPropagation()},end:(n,o)=>{s.rotate.end(),o.stopPropagation()},condition:(n,o)=>n===1&&pOe(o.data,this.pointerActions)}),this.registerIncoming("drag",r,n=>this._dragEventSeparator.handle(n))}};function Ee(t){const e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function ne(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function se(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t}function oe(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function be(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function cse(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function fOe(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function Lit(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function mOe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function oA(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function gOe(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function yOe(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function vOe(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function _Oe(t,e=0,i=1){return t[0]=Math.min(Math.max(t[0],e),i),t[1]=Math.min(Math.max(t[1],e),i),t[2]=Math.min(Math.max(t[2],e),i),t}function Nit(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function re(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function Qn(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t}function Sr(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return Math.sqrt(i*i+r*r+s*s)}function no(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return i*i+r*r+s*s}function Xo(t){const e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}function Cd(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Fit(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function ae(t,e){const i=e[0],r=e[1],s=e[2];let n=i*i+r*r+s*s;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n),t}function fe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ct(t,e,i){const r=e[0],s=e[1],n=e[2],o=i[0],a=i[1],l=i[2];return t[0]=s*l-n*a,t[1]=n*o-r*l,t[2]=r*a-s*o,t}function kit(t,e,i){const r=e[0],s=e[1],n=e[2],o=i[0],a=i[1],l=i[2],c=s*l-n*a,h=n*o-r*l,d=r*a-s*o,f=Math.sqrt(c*c+h*h+d*d);return t[0]=c/f,t[1]=h/f,t[2]=d/f,t}function fr(t,e,i,r){const s=e[0],n=e[1],o=e[2];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t[2]=o+r*(i[2]-o),t}function zit(t,e,i,r,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),h=o*(3-2*n);return t[0]=e[0]*a+i[0]*l+r[0]*c+s[0]*h,t[1]=e[1]*a+i[1]*l+r[1]*c+s[1]*h,t[2]=e[2]*a+i[2]*l+r[2]*c+s[2]*h,t}function Uit(t,e,i,r,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,h=3*n*a,d=3*l*o,f=l*n;return t[0]=e[0]*c+i[0]*h+r[0]*d+s[0]*f,t[1]=e[1]*c+i[1]*h+r[1]*d+s[1]*f,t[2]=e[2]*c+i[2]*h+r[2]*d+s[2]*f,t}function Bit(t,e=1){const i=tL,r=2*i()*Math.PI,s=2*i()-1,n=Math.sqrt(1-s*s)*e;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t[2]=s*e,t}function ot(t,e,i){const r=e[0],s=e[1],n=e[2];return t[0]=i[0]*r+i[4]*s+i[8]*n+i[12],t[1]=i[1]*r+i[5]*s+i[9]*n+i[13],t[2]=i[2]*r+i[6]*s+i[10]*n+i[14],t}function uc(t,e,i){const r=e[0],s=e[1],n=e[2];return t[0]=r*i[0]+s*i[3]+n*i[6],t[1]=r*i[1]+s*i[4]+n*i[7],t[2]=r*i[2]+s*i[5]+n*i[8],t}function Hc(t,e,i){const r=i[0],s=i[1],n=i[2],o=i[3],a=e[0],l=e[1],c=e[2],h=s*c-n*l,d=n*a-r*c,f=r*l-s*a,m=s*f-n*d,g=n*h-r*f,v=r*d-s*h,_=2*o;return t[0]=a+h*_+2*m,t[1]=l+d*_+2*g,t[2]=c+f*_+2*v,t}function Vit(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[0],n[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),n[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function jit(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),n[1]=s[1],n[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function Git(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),n[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),n[2]=s[2],t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function bOe(t,e){ae(Nde,t),ae(Fde,e);const i=fe(Nde,Fde);return i>1?0:i<-1?Math.PI:Math.acos(i)}const Nde=$(),Fde=$();function Hit(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function to(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function aA(t,e){if(t===e)return!0;const i=t[0],r=t[1],s=t[2],n=e[0],o=e[1],a=e[2],l=To();return Math.abs(i-n)<=l*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-o)<=l*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-a)<=l*Math.max(1,Math.abs(s),Math.abs(a))}function nT(t,e,i){const r=i[0]-e[0],s=i[1]-e[1],n=i[2]-e[2];let o=r*r+s*s+n*n;return o>0?(o=1/Math.sqrt(o),t[0]=r*o,t[1]=s*o,t[2]=n*o,t):(t[0]=0,t[1]=0,t[2]=0,t)}const Fi=be,qit=cse,Wit=fOe,Ba=Sr,lA=no,ja=Ee,rB=Xo,kde=Object.freeze(Object.defineProperty({__proto__:null,abs:oA,add:oe,angle:bOe,bezier:Uit,ceil:Lit,clamp:_Oe,copy:ne,cross:ct,crossAndNormalize:kit,direction:nT,dist:Ba,distance:Sr,div:Wit,divide:fOe,dot:fe,equals:aA,exactEquals:to,floor:mOe,hermite:zit,inverse:Fit,len:ja,length:Ee,lerp:fr,max:vOe,min:yOe,mul:qit,multiply:cse,negate:Cd,normalize:ae,random:Bit,rotateX:Vit,rotateY:jit,rotateZ:Git,round:Nit,scale:re,scaleAndAdd:Qn,set:se,sign:gOe,sqrDist:lA,sqrLen:rB,squaredDistance:no,squaredLength:Xo,str:Hit,sub:Fi,subtract:be,transformMat3:uc,transformMat4:ot,transformQuat:Hc},Symbol.toStringTag,{value:"Module"}));function Xd(t){let e=t*t;return t<0&&(e*=-1),e}function Zit(t){return t.translation[0]=0,t.translation[1]=0,t.translation[2]=0,t.heading=0,t.tilt=0,t}function PJ(t,e,i){const r=i,s=t.state,n=t.device,o=e.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(r.translation[0]=Xd(s.axes[0]),r.translation[1]=Xd(s.axes[1]),r.translation[2]=Xd(s.buttons[7])-Xd(s.buttons[6]),r.heading=Xd(s.axes[2]),r.tilt=Xd(s.axes[3])):n.deviceType==="spacemouse"&&(r.translation[0]=1.2*Xd(s.axes[0]),r.translation[1]=1.2*Xd(s.axes[1]),r.translation[2]=2*-Xd(s.axes[2]),r.heading=1.2*Xd(s.axes[5]),r.tilt=1.2*Xd(s.axes[3])),r.tilt*=o,re(r.translation,r.translation,a),r}function zde(t,e){const i=e;return i.translation[0]=t[1]-t[0],i.translation[1]=t[3]-t[2],i.translation[2]=t[4]-t[5],i.heading=t[7]-t[6],i.tilt=t[8]-t[9],i.zoom=t[10]-t[11],i}function a5(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let Yit=class extends ls{constructor(e){super(!0),this._view=e,this._frameTask=null,this._watchHandles=new fg,this._currentDevice=null,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._handle=this.registerIncoming("gamepad",i=>this._handleGamePadEvent(i)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([H(()=>{var i;return(i=this._view.navigation.gamepad)==null?void 0:i.enabled},i=>{i?(this._handle.resume(),this._frameTask||(this._frameTask=tg({update:r=>this._frameUpdate(r.deltaTime)}))):(this._handle.pause(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null))},Ut)])}onUninstall(){this._watchHandles.removeAll(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null),super.onUninstall()}_handleGamePadEvent(e){var r;const i=this._view.navigation.gamepad.device;i&&e.data.device!==i||this._currentDevice&&this._currentDevice!==e.data.device||(e.data.action==="end"?(this._currentDevice=null,Zit(this._transformation)):(this._currentDevice=e.data.device,PJ(e.data,this._view.navigation.gamepad,this._transformation)),(r=this._frameTask)==null||r.resume())}_frameUpdate(e){var d;const i=this._transformation;if(a5(i))return void((d=this._frameTask)==null?void 0:d.pause());const r=this._view.viewpoint.clone(),s=this._view.navigation.gamepad.velocityFactor,n=Xit*s*e;IG(r,r,[i.translation[0]*n,-i.translation[1]*n]);const o=1+i.translation[2]*Kit*e,a=this._view.constraints.rotationEnabled?-i.heading*Jit*e:0,l=this._view.size,c=[l[0]/2,l[1]];XMe(r,r,o,a,c,l);const h=this._view.constraints.constrain(r,this._view.viewpoint);this._view.viewpoint=h}};const Jit=.06,Xit=.7,Kit=6e-4;function use(t){const e=()=>t(document.visibilityState==="visible");return document.addEventListener("visibilitychange",e),Pi(()=>document.removeEventListener("visibilitychange",e))}let Qit=class extends ls{constructor(e,i,r){super(!0),this.view=e,this.keys=i,this._isSticky=!1,this._pressedKeys=new Set,this._timeout=void 0,this._currentDirection=void 0,this._stickyKeyDuration=200,this._handleKey=s=>{const n=this._keyMap[s.data.key];if(s.modifiers.has("Meta")||s.modifiers.has("Control"))return void this._stopMovement();if(n==null)return;s.stopPropagation(),s.preventDefault();const o=s.type==="key-down";if(this._pressedKeys[o?"add":"delete"](n),o){if(this._direction===n)return;this._direction=n,this._isSticky=!1,this._setTimeout(()=>{this._isSticky&&this._handlePopKey()})}else{const a=this._timeout===void 0,l=this._pressedKeys.size>0;a||l?this._handlePopKey():this._isSticky=!0}},this._handlePopKey=()=>{this._direction=Array.from(this._pressedKeys).pop(),this._direction==null&&this._stopMovement()},this._stopMovement=()=>{this._isSticky=!1,this._direction=void 0,this._pressedKeys.clear(),this._setTimeout(void 0)},this._keyMap={[i.left]:"left",[i.right]:"right",[i.up]:"up",[i.down]:"down"},this.registerIncoming("key-down",r,this._handleKey),this.registerIncoming("key-up",r,this._handleKey),this.registerIncoming("blur",r,this._stopMovement),this._visibilityHandle=use(s=>s?null:this._stopMovement())}onUninstall(){var e;this._stopMovement(),(e=this._visibilityHandle)==null||e.remove()}get _direction(){return this._currentDirection}set _direction(e){const i=this._currentDirection!=null;if(e!=null){if(i||this.view.mapViewNavigation.begin(),this._currentDirection!==e)switch(e){case"left":this.view.mapViewNavigation.continuousPanLeft();break;case"right":this.view.mapViewNavigation.continuousPanRight();break;case"up":this.view.mapViewNavigation.continuousPanUp();break;case"down":this.view.mapViewNavigation.continuousPanDown()}}else i&&this.view.mapViewNavigation.stop();this._currentDirection=e}_setTimeout(e){clearTimeout(this._timeout),this._timeout=e===void 0?void 0:setTimeout(()=>{this._timeout=void 0,e()},this._stickyKeyDuration)}},ert=class extends ls{constructor(e,i,r){super(!0),this.view=e,this.keys=i,this._keyToDirection=new Map,this._pressed=!1,this._addKeysMapping(i),this.registerIncoming("key-down",r,s=>this._handleKeyDown(s)),this.registerIncoming("key-up",r,s=>this._handleKeyUp(s)),this.registerIncoming("blur",r,()=>this._handleStop()),this._visibilityHandle=use(s=>s?null:this._handleStop())}onUninstall(){var e;(e=this._visibilityHandle)==null||e.remove(),this._handleStop()}_addKeysMapping(e){this._addKeyMapping(e.clockwise,"clockwise"),this._addKeyMapping(e.counterClockwise,"counterClockwise"),this._addKeyMapping(e.reset,"reset")}_addKeyMapping(e,i){for(const r of e)this._keyToDirection.set(r,i)}_handleKeyDown(e){e.data.repeat||this._handleKey(e,!0)}_handleKeyUp(e){this._handleKey(e,!1)}_handleStop(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}_handleKey(e,i){const r=e.modifiers;if(r.size>0&&!r.has("Shift")||!this.view.constraints.rotationEnabled)return;const s=this._keyToDirection.get(e.data.key);if(this._pressed=s!=null,this._pressed){if(e.preventDefault(),i)switch(this.view.mapViewNavigation.begin(),s){case"clockwise":this.view.mapViewNavigation.continuousRotateClockwise();break;case"counterClockwise":this.view.mapViewNavigation.continuousRotateCounterclockwise();break;case"reset":this.view.mapViewNavigation.resetRotation()}else this._pressed=!1,this.view.mapViewNavigation.stop();e.stopPropagation()}}};var iC;(function(t){t[t.IN=0]="IN",t[t.OUT=1]="OUT"})(iC||(iC={}));let trt=class extends ls{constructor(e,i,r){super(!0),this.view=e,this.keys=i,this._keysToZoomAction={},this.registerIncoming("key-down",r,s=>this._handleKeyDown(s)),i.zoomIn.forEach(s=>this._keysToZoomAction[s]=iC.IN),i.zoomOut.forEach(s=>this._keysToZoomAction[s]=iC.OUT)}_handleKeyDown(e){this._handleKey(e)}_handleKey(e){const i=e.modifiers;if(i.size>0&&!i.has("Shift"))return;const{key:r}=e.data;if(!(r in this._keysToZoomAction))return;const s=this._keysToZoomAction[r],{mapViewNavigation:n}=this.view;let o=null;switch(s){case iC.IN:o=n.zoomIn();break;case iC.OUT:o=n.zoomOut();break;default:return}n.begin(),o.then(()=>n.end()),e.stopPropagation()}};const irt=.6;let rrt=class extends ls{constructor(e,i){super(!0),this._view=e,this._canZoom=!0,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(e){if(this._view.navigation.actionMap.mouseWheel!=="zoom"||(e.preventDefault(),e.stopPropagation(),!this._canZoom))return;const i=this._view.mapViewNavigation,{x:r,y:s,deltaY:n}=e.data,o=1/irt**(1/60*n),a=i.zoom(o,[r,s]);a&&(this._canZoom=!1,a.catch(()=>{}).then(()=>{this._canZoom=!0,i.end()}))}},srt=class extends ls{constructor(e){super(!0),this.view=e,this.registerIncoming("drag",r=>this._handleDrag(r)),this.registerIncoming("pointer-down",()=>this._stopMomentumNavigation());const i=this.view.mapViewNavigation;this._dragEventSeparator=new uL({start:(r,s)=>{i.pinch.begin(this.view,s.data),s.stopPropagation()},update:(r,s)=>{i.pinch.update(this.view,s.data),s.stopPropagation()},end:(r,s)=>{i.pinch.end(this.view),s.stopPropagation()},condition:r=>r>=2})}_handleDrag(e){this._dragEventSeparator.handle(e)}_stopMomentumNavigation(){this.view.mapViewNavigation.pinch.stopMomentumNavigation()}};function Ude(t){const e=t.native;return e?{buttons:e.buttons.map(i=>i.pressed?i.value||1:0),axes:e.axes.map(i=>art(i,t.axisThreshold))}:{buttons:[],axes:[]}}function nrt(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let i=0;i<t.axes.length;i++)if(t.axes[i]!==e.axes[i])return!1;for(let i=0;i<t.buttons.length;i++)if(t.buttons[i]!==e.buttons[i])return!1;return!0}function ort(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function art(t,e){const i=Math.abs(t);return i<e?0:Math.sign(t)*(i-e)/(1-e)}let lrt=class{constructor(e,i){this._element=e,this._input=i,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,Ude(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const r="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=r&&s,this.supported&&(Bde(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const i=new qre(e);i.deviceType!=="unknown"&&(this._inputDevices[e.index]=i,this._input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=tg({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),i=this._element.contains(document.activeElement),r=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!i;Bde(s=>{const n=this._inputDevices[s.index];if(!n)return;const o=this._latestUpdate[s.index],a=Ude(n),l=r||ort(a);o&&(o.timestamp===s.timestamp||!o.active&&l||nrt(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_emitGamepadEvent(e,i,r){const s=this._latestUpdate[e.index],n=s&&s.active;if(!n&&!r)return;const o=!n&&r?"start":n&&r?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:i,active:r},this._callback&&this._callback({device:this._inputDevices[e.index],state:i,action:o})}};function crt(t){if(!t||!t.connected)return!1;for(let e=0;e<t.axes.length;e++)if(isNaN(t.axes[e]))return!1;return!0}function Bde(t){for(const e of navigator.getGamepads())crt(e)&&t(e)}const Vde=X("edge"),urt=X("chrome"),hrt=X("ff"),drt=X("safari"),jde="esri-view-surface",IT={touchNone:`${jde}--touch-none`,touchPan:`${jde}--touch-pan`};let hse=class wOe{constructor(e,i){this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new lrt(e,i),this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>this._releasePointerCaptureSafe(e)),this._activePointerCaptures.clear(),this._gamepadSource=$e(this._gamepadSource),this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const i in this._active)if(!e||!e.has(i)){const r=this._active[i];this._element.removeEventListener(C8[i],r),delete this._active[i]}e&&e.forEach(i=>{if(!this._active[i]&&C8[i]){const r=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener(C8[i],r),this._active[i]=r}}),this._gamepadSource&&(this._gamepadSource.hasEventListeners=(e==null?void 0:e.has("gamepad"))??!1)}setPointerCapture(e,i){i?this._setPointerCaptureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?IT.touchNone:IT.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?IT.touchPan:IT.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(IT.touchNone),this._element.classList.remove(IT.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCaptureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,i){const r=pMe(this._element,e);return wOe.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),i.x=r.x,i.y=r.y,i}_handleKey(e,i){const{key:r}=i;r&&e==="key-up"&&this._keyDownState.delete(r);const s={native:i,key:r,repeat:!!r&&this._keyDownState.has(r)};r&&e==="key-down"&&this._keyDownState.add(s.key),this._callback(e,s)}_handlePointer(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(e,r)}_handlePointerPreventDefault(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(e,r)}_getDeltaFromTrackpadOrMouseWheel(e){return e.shiftKey&&X("mac")&&e.deltaY===0?e.deltaX:e.deltaY}_handleMouseWheel(e,i){let r=this._getDeltaFromTrackpadOrMouseWheel(i);switch(i.deltaMode){case 0:Vde&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}Vde?r*=.7:urt||drt?r*=.6:hrt&&(r*=1.375);const s=100,n=Math.abs(r);n>s&&(r=r/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:r});this._callback(e,o)}_handlePointerCaptureLost(e,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(e,i)}_handleDefault(e,i){const r={native:i};i.preventDefault(),this._callback(e,r)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};hse.test={disableSubpixelCoordinates:!1};const C8={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let xOe=class extends ls{constructor(){super(!0),this.registerIncoming("context-menu",e=>e.data.native.preventDefault())}};const Za={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};function sB(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function prt(t,e){const i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)}function frt(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:xo()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[x,S]=t,[C,T]=[S.x-x.x,S.y-x.y];return e.radius=Math.sqrt(C*C+T*T)/2,e.center.x=(x.x+S.x)/2,e.center.y=(x.y+S.y)/2,e}let i=0,r=0;for(let x=0;x<t.length;x++)i+=t[x].x,r+=t[x].y;i/=t.length,r/=t.length;const s=t.map(x=>x.x-i),n=t.map(x=>x.y-r);let o=0,a=0,l=0,c=0,h=0,d=0,f=0;for(let x=0;x<s.length;x++){const S=s[x],C=n[x],T=S*S,M=C*C;o+=T,a+=M,l+=S*C,c+=T*S,h+=M*C,d+=S*M,f+=C*T}const m=.5*(c+d),g=.5*(h+f),v=o*a-l*l,_=(m*a-g*l)/v,b=(o*g-l*m)/v,w=xo(_+i,b+r);return{radius:Math.sqrt(_*_+b*b+(o+a)/t.length),center:w}}function eS(t){const{native:e}=t,{pointerId:i,button:r,pointerType:s}=e;return s==="mouse"?`${i}:${r}`:`${s}`}let mrt=class extends ls{constructor(e=Za.maximumDoubleClickDelay,i=Za.maximumDoubleClickDistance,r=Za.maximumDoubleTouchDelay,s=Za.maximumDoubleTouchDistance,n=WA){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=n,this._doubleTapDragReady=!1,this._doubleTapDragActive=!1,this._dragStartCenter=xo(0,0),this._pointerState=new Map,this._doubleTapDrag=this.registerOutgoing("double-tap-drag"),this._dragEventSeparator=new uL({start:(o,a)=>this._dragStart(o,a),update:(o,a)=>this._dragUpdate(a),end:(o,a)=>this._dragEnd(a)}),this.registerIncoming("drag",o=>this._dragEventSeparator.handle(o)),this.registerIncoming("pointer-down",o=>this._handlePointerDown(o)),this.registerIncoming("pointer-up",()=>this._handlePointerUp())}onUninstall(){this._pointerState.forEach(e=>{e.doubleTapTimeout=Ji(e.doubleTapTimeout)})}get hasPendingInputs(){for(const e of this._pointerState.values())if(e.doubleTapTimeout!=null)return!0;return!1}_clearPointerDown(e){const i=this._pointerState.get(e);i&&(i.doubleTapTimeout=Ji(i.doubleTapTimeout),this._pointerState.delete(e),this.refreshHasPendingInputs())}_dragStart(e,i){if(!this._doubleTapDragReady||e!==1)return;this._doubleTapDragReady=!1,this._doubleTapDragActive=!0;const{data:r,modifiers:s}=i,{center:n}=r;this._dragStartCenter=n;const o=$8("begin",xo(0,0),r);this._doubleTapDrag.emit(o,void 0,s),i.stopPropagation()}_dragUpdate(e){if(!this._doubleTapDragActive)return;const{data:i,modifiers:r}=e,{center:s}=i,n=$8("update",xo(s.x-this._dragStartCenter.x,s.y-this._dragStartCenter.y),i);this._doubleTapDrag.emit(n,void 0,r),e.stopPropagation()}_dragEnd(e){if(!this._doubleTapDragActive)return;const{data:i,modifiers:r}=e,{center:s}=i,n=$8("end",xo(s.x-this._dragStartCenter.x,s.y-this._dragStartCenter.y),i);this._doubleTapDrag.emit(n,void 0,r),this._doubleTapDragActive=!1,e.stopPropagation()}_handlePointerDown(e){const{data:i}=e,r=eS(i),s=this._pointerState.get(r),{pointerType:n}=i.native;if(s){const o=n==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;this._clearPointerDown(r),sB(s.event.data,i)>o?this._storePointerDown(e):this._doubleTapDragReady=!0}else this._storePointerDown(e)}_handlePointerUp(){this._doubleTapDragReady=!1}_storePointerDown(e){const{data:i}=e,{pointerType:r}=i.native,s=eS(i),n=r==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._clearPointerDown(s),n);this._pointerState.set(s,{event:e,doubleTapTimeout:o}),this.refreshHasPendingInputs()}};function $8(t,e,i){const{button:r,buttons:s,pointer:n,pointers:o,pointerType:a,timestamp:l}=i;return{action:t,delta:e,button:r,buttons:s,pointer:n,pointers:o,pointerType:a,timestamp:l}}let SOe=class extends ls{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,i,r,s){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:i.buttons,timestamp:s,pointers:grt(this._activePointerMap),pointer:i,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(e){const i=e.native.pointerId,r=DN(this._activePointerMap).angle,s={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(i,s);const n=l5(s,TOe(this._activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(r)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const i=e.native.pointerId,r=this._activePointerMap.get(i);r?r.event=e:this._addPointer(e)}_removePointer(e){const i=DN(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(i)}_updatePointerAngles(e){const i=DN(this._activePointerMap);this._activePointerMap.forEach(r=>{r.initialAngle=l5(r,i)-e,r.lastAngle=l5(r,i)-e})}_emitEvent(e,i,r){const s=DN(this._activePointerMap);this._drag.emit(this._createPayload(e,i,s,r),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const i=e.data.native.pointerId,r=e.timestamp;this._activePointerMap.get(i)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,r),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const i=e.data,r=i.currentEvent,s=e.timestamp;switch(i.action){case"start":case"update":this._isDragging?this._activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this._isCurrentDragSuppressed&&this._emitEvent("update",r,s)):(this._addPointer(r),this._emitEvent("added",r,s),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(r),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",r,s))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function TOe(t){const e=[];return t.forEach(i=>{e.push(xo(i.event.x,i.event.y))}),frt(e)}function DN(t){const e=TOe(t);let i=0;return t.forEach(r=>{let s=l5(r,e),n=s-r.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=r.lastAngle+n,r.lastAngle=s;const o=s-r.initialAngle;i+=o}),i/=t.size||1,{angle:i,radius:e.radius,center:e.center}}function grt(t){const e=new Map;return t.forEach((i,r)=>e.set(r,i.event)),e}function l5(t,e){const i=t.event,r=i.x-e.center.x,s=i.y-e.center.y;return Math.atan2(s,r)}var Gde;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(Gde||(Gde={}));let EOe=class extends ls{constructor(e=Za.maximumDoubleClickDelay,i=Za.maximumDoubleClickDistance,r=Za.maximumDoubleTouchDelay,s=Za.maximumDoubleTouchDistance,n=WA){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=eS(i);if(!this._pointerState.has(r)){const s={downButton:i.native.button,x:i.x,y:i.y,immediateDoubleClick:null};this._pointerState.set(r,s),this.startCapturingPointer(i.native)}}_handlePointerUp(e){const i=e.data,r=eS(i),s=this._pointerState.get(r);if(s&&s.downButton===i.native.button){const n=s.immediateDoubleClick,o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;n?(n.timeoutHandle.remove(),sB(n,e.data)>o?this._startImmediateDoubleClick(e,s):(this._immediateDoubleClick.emit(e.data,void 0,n.modifiers),this._removeState(i))):sB(s,e.data)>o?this._removeState(i):this._startImmediateDoubleClick(e,s)}}_startImmediateDoubleClick(e,i){const r=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;i.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),r)}}_removeState(e){const i=eS(e);this._pointerState.delete(i),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}},COe=class extends ls{constructor(e=Za.maximumClickDelay,i=Za.movementUntilMouseDrag,r=Za.movementUntilPenDrag,s=Za.movementUntilTouchDrag,n=Za.holdDelay,o=WA){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=i,this._movementUntilPenDrag=r,this._movementUntilTouchDrag=s,this._holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",a=>this._handlePointerDown(a)),this.registerIncoming("pointer-up",a=>this._handlePointerLoss(a,"pointer-up")),this.registerIncoming("pointer-capture-lost",a=>this._handlePointerLoss(a,"pointer-capture-lost")),this.registerIncoming("pointer-cancel",a=>this._handlePointerLoss(a,"pointer-cancel")),this._moveHandle=this.registerIncoming("pointer-move",a=>this._handlePointerMove(a)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=Ji(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=i.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(r);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const n={startEvent:i,previousEvent:i,startTimestamp:e.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(r,n),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_handlePointerMove(e){const i=e.data,r=i.native.pointerId,s=this._pointerState.get(r);s&&(s.isDragging?this._pointerDrag.emit(LN("update",s,i),void 0,s.modifiers):prt(i,s.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(e),s.previousEvent=i)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const i=e.data,r=i.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=e.modifiers,s.isDragging=!0,r===s.startEvent.native.pointerId?this._pointerDrag.emit(LN("start",s,i)):this._pointerDrag.emit(LN("start",s,s.previousEvent),e.timestamp))})}_handlePointerLoss(e,i){const r=e.data,s=r.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(LN("end",n,i==="pointer-up"?r:n.previousEvent),void 0,n.modifiers):i==="pointer-up"&&n.downButton===r.native.button&&e.timestamp-n.startTimestamp<=this._maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(s),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}};function LN(t,e,i){return{action:t,startEvent:e.startEvent,previousEvent:e.previousEvent,currentEvent:i}}let $Oe=class extends ls{constructor(e=Za.maximumDoubleClickDelay,i=Za.maximumDoubleClickDistance,r=Za.maximumDoubleTouchDelay,s=Za.maximumDoubleTouchDistance,n=WA){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",o=>this._handleImmediateClick(o)),this.registerIncoming("pointer-down",o=>this._handlePointerDown(o))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=Ji(e.doubleClickTimer))}get hasPendingInputs(){for(const e of this._pointerState.values())if(e.doubleClickTimer!=null)return!0;return!1}_clearDoubleClickTimer(e,i){const r=this._pointerState.get(e);r&&(r.doubleClickTimer=Ji(r.doubleClickTimer),i&&this._click.emit(r.event.data,void 0,r.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const i=this._pointerState.get(e);i.pointerDownCount===1&&this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_handleImmediateClick(e){const i=e.data,{pointerType:r}=i.native,s=yrt(i);if(!this._pointerState.has(s))return void this._startClick(e);const n=this._pointerState.get(s),{data:o,modifiers:a}=n.event,l=r==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;sB(o,i)>l?(this._clearDoubleClickTimer(s,!0),this._startClick(e)):(this._clearDoubleClickTimer(s,!1),n.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const i=eS(e.data),r=this._pointerState.get(i);r&&(r.pointerDownCount+=1)}_startClick(e){const{data:i}=e,{native:{pointerType:r}}=i,s=eS(i),n=r==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(s),n);this._pointerState.set(s,{event:e,doubleClickTimer:o,pointerDownCount:1}),this.refreshHasPendingInputs()}};function yrt(t){const{pointerId:e,pointerType:i,button:r}=t.native;return i==="mouse"?`${e}:${r}`:`${i}`}const NN={counter:"Control",pan:{left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},zoom:{zoomIn:["=","+"],zoomOut:["-","_"]},rotate:{clockwise:["a","A"],counterClockwise:["d","D"],reset:["n","N"]}},Hde=Symbol("handles");let C1=class extends he{initialize(){const e=()=>{var i;return(i=this.view)==null?void 0:i.ready};this.addHandles([bn(()=>!e(),()=>this._disconnect()),bn(e,()=>this._connect())])}destroy(){this._disconnect()}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e;return((e=this._inputManager)==null?void 0:e.multiTouchActive)??!1}isModifierKeyDown(e){var i;return((i=this._inputManager)==null?void 0:i.isModifierKeyDown(e))??!1}_disconnect(){this.view.viewEvents.disconnect(),this.removeHandles(Hde),this._inputManager=$e(this._inputManager)}_connect(){const e=this.view.surface,i=new hse(e,this.view.input),r=[new EOe,new COe,new $Oe,new SOe(this.view.navigation),new mrt],s=new zu({eventSource:i,recognizers:r}),n=new Pit(this.view,["primary"]),o=new Dit(this.view,["secondary"]);s.installHandlers("prevent-context-menu",[new xOe],Vm.INTERNAL),s.installHandlers("navigation",[new srt(this.view),new Yit(this.view),new rrt(this.view),new Lde(this.view),new Lde(this.view,[NN.counter]),n,new Qit(this.view,NN.pan),new trt(this.view,NN.zoom),new ert(this.view,NN.rotate),o,new Rit(this.view,"touch")],Vm.INTERNAL),this.view.viewEvents.connect(s),this._source=i,this._inputManager=s,this.addHandles([H(()=>{var a,l;return(l=(a=this.view)==null?void 0:a.navigation)==null?void 0:l.browserTouchPanEnabled},a=>{this._source&&(this._source.browserTouchPanningEnabled=!a)},Ut),H(()=>{const{actionMap:a}=this.view.navigation;return{panActions:hP("pan",a),rotateActions:hP("rotate",a)}},({panActions:a,rotateActions:l})=>{n.pointerActions=a,o.pointerActions=l},Mt)],Hde)}get test(){}};u([p()],C1.prototype,"view",void 0),u([p()],C1.prototype,"latestPointerType",null),u([p()],C1.prototype,"latestPointerLocation",null),u([p()],C1.prototype,"multiTouchActive",null),C1=u([A("esri.views.2d.input.MapViewInputManager")],C1);const vrt=C1,qde=160;let RI=class extends he{constructor(){super(...arguments),this._timer=void 0}get stationary(){return!this._timer}flip(){this._timestamp=performance.now(),this._timer==null&&(this._timer=setInterval(()=>{performance.now()-this._timestamp>=qde&&this.clear()},qde))}clear(){this._timer&&(clearInterval(this._timer),this._timer=void 0)}};u([p()],RI.prototype,"_timer",void 0),u([p()],RI.prototype,"stationary",null),RI=u([A("esri.views.2d.support.StationaryManager")],RI);const _rt=t=>{let e=class extends t{constructor(...i){super(...i),this.fullOpacity=1,this.stateManager=new dl({constraints:new Dde({view:this})}),this.goToManager=new o5({view:this}),this.stationaryManager=new RI,this.mapViewNavigation=null,this.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!1,labelsAnimationTime:0,labelCollisionsEnabled:!1},this.frameTask=new $it(this),this.inputManager=new vrt({view:this}),this.viewEvents=new dMe(this),this.padding={top:0,right:0,bottom:0,left:0},this.addHandles([H(()=>this.viewpoint,()=>this.stationaryManager.flip(),Yt),this.on("resize",r=>this.stateManager.resize(r.width,r.height))])}get constraintsInfo(){return{lods:null,spatialReference:null}}get extent(){var i;return((i=this.stateManager)==null?void 0:i.extent)??null}set extent(i){this.stateManager.extent=i}get state(){return this.stateManager.state}get interacting(){return this.navigating}get stationary(){return!this.animation&&!this.navigating&&!this.resizing&&this.stationaryManager.stationary}set animation(i){const r=this._get("animation");if(i===r)return;if(r&&r.stop(),i!==this.animationManager.animation&&this.animationManager.stop(),!i||i.isFulfilled())return void this._set("animation",null);this._set("animation",i);const s=()=>{var n;this.destroyed||i===this._get("animation")&&(this._set("animation",null),(n=this.frameTask)==null||n.requestFrame())};i.when(s,s)}get constraints(){var i;return(i=this.stateManager)==null?void 0:i.constraints}set constraints(i){i.view=this;const r=this.stateManager.constraints;this.stateManager.constraints=i,r==null||r.destroy()}get padding(){var i;return(i=this.stateManager)==null?void 0:i.padding}set padding(i){this.stateManager&&(this.stateManager.padding=i)}get resizeAlign(){return this.stateManager.resizeAlign}set resizeAlign(i){this.stateManager.resizeAlign=i}get rotation(){return this.stateManager.rotation??0}set rotation(i){const{rotationEnabled:r}=this.constraints;this.constraints.rotationEnabled=!0,this.stateManager.rotation=i,this.constraints.rotationEnabled=r}get viewpoint(){return this.stateManager.viewpoint??null}set viewpoint(i){this.stateManager.viewpoint=i,this.frameTask.requestFrame()}on(i,r,s,n){return this.inputManager&&this.viewEvents.on(i,r,s,n)||super.on(i,r)}hasEventListener(i){return super.hasEventListener(i)||this.viewEvents.hasHandler(i)}goTo(i,r){return this.goToManager.goTo(i,r)}};return u([p({readOnly:!0})],e.prototype,"animationManager",void 0),u([p({readOnly:!0})],e.prototype,"fullOpacity",void 0),u([p()],e.prototype,"stateManager",void 0),u([p()],e.prototype,"constraintsInfo",null),u([p()],e.prototype,"extent",null),u([p()],e.prototype,"goToManager",void 0),u([p({readOnly:!0})],e.prototype,"state",null),u([p({readOnly:!0})],e.prototype,"mapViewNavigation",void 0),u([p()],e.prototype,"renderingOptions",void 0),u([p({readOnly:!0})],e.prototype,"interacting",null),u([p()],e.prototype,"stationary",null),u([p()],e.prototype,"animation",null),u([p({type:Dde})],e.prototype,"constraints",null),u([p({readOnly:!0})],e.prototype,"inputManager",void 0),u([p()],e.prototype,"padding",null),u([p()],e.prototype,"resizeAlign",null),u([p()],e.prototype,"rotation",null),u([p({readOnly:!0})],e.prototype,"viewEvents",void 0),u([p({type:Qr})],e.prototype,"viewpoint",null),e=u([A("esri.views.Viewport2DMixin")],e),e};let Wde=class{constructor(e){this._view=e,this.viewpoint=new Qr({targetGeometry:new Fe,scale:0,rotation:0})}get view(){return this._view}get size(){const[e,i]=this._view.size;return Math.sqrt(e*e+i*i)}get scale(){return this.viewpoint.scale}get rotation(){return this.viewpoint.rotation}get center(){return this.viewpoint.targetGeometry}get scaleToResolutionFactor(){return YMe(this.center.spatialReference)}pixelsPerPanAtZoom(e){return 1/(e*this.scaleToResolutionFactor)}zoomAtPixelsPerPan(e){return 1/(e*this.scaleToResolutionFactor)}pixelsPerRotate(){return this.size/2}compareTo(e,i){i.pan=lEe(this.center,e.center);let r=Math.abs(e.rotation-this.rotation);r=r>=180?360-r:r,i.rotate=At(r),i.sourceZoom=this.scale,i.targetZoom=e.scale}interpolate(e,i,r){const{pan:s,rotate:n,zoom:o,zoomOffset:a}=r,{center:l}=this;l.spatialReference=e.center.spatialReference,l.x=ft(e.center.x,i.center.x,s),l.y=ft(e.center.y,i.center.y,s),this.viewpoint.scale=ft(e.scale,i.scale+a,o);let c=e.rotation;const h=i.rotation;Math.abs(h-c)>=180&&(c+=360*(c<h?1:-1)),this.viewpoint.rotation=ft(c,h,n)}copyFrom(e){Cl(this.viewpoint,e.viewpoint),this._view=e.view}};function GM(t,e,i,r){const s=3*t,n=3*(i-t)-s,o=1-s-n,a=3*e,l=3*(r-e)-a,c=1-a-l;function h(g){return((o*g+n)*g+s)*g}function d(g){return((c*g+l)*g+a)*g}function f(g){return(3*o*g+2*n)*g+s}function m(g,v){let _,b,w,x,S,C;for(w=g,C=0;C<8;C++){if(x=h(w)-g,Math.abs(x)<v)return w;if(S=f(w),Math.abs(S)<1e-6)break;w-=x/S}if(_=0,b=1,w=g,w<_)return _;if(w>b)return b;for(;_<b;){if(x=h(w),Math.abs(x-g)<v)return w;g>x?_=w:b=w,w=.5*(b-_)+_}return w}return function(g,v=1e-6){return d(m(g,v))}}const Wh={};Wh.ease=GM(.25,.1,.25,1),Wh.linear=GM(0,0,1,1),Wh.easeIn=Wh["ease-in"]=GM(.42,0,1,1),Wh.easeOut=Wh["ease-out"]=GM(0,0,.58,1),Wh.easeInOut=Wh["ease-in-out"]=GM(.42,0,.58,1);const brt=t=>t,LG=t=>t*t,dse=t=>1-LG(1-t),wrt=t=>t<.5?LG(2*t)/2:(dse(2*(t-.5))+1)/2,pse=t=>t*t*t,AOe=t=>1-pse(1-t),MOe=t=>t<.5?pse(2*t)/2:(AOe(2*(t-.5))+1)/2,fse=t=>t*t*t*t,OOe=t=>1-fse(1-t),xrt=t=>t<.5?fse(2*t)/2:(OOe(2*(t-.5))+1)/2,mse=t=>t*t*t*t*t,IOe=t=>1-mse(1-t),Srt=t=>t<.5?mse(2*t)/2:(IOe(2*(t-.5))+1)/2,gse=t=>1-Math.cos(t*Math.PI/2),ROe=t=>1-gse(1-t),Trt=t=>t<.5?gse(2*t)/2:(ROe(2*(t-.5))+1)/2,yse=t=>2**(10*(t-1)),hL=t=>1-yse(1-t),Ert=t=>t<.5?yse(2*t)/2:(hL(2*(t-.5))+1)/2,vse=t=>-(Math.sqrt(1-t*t)-1),POe=t=>1-vse(1-t),Crt=t=>t<.5?vse(2*t)/2:(POe(2*(t-.5))+1)/2;function Fd(t){const e=2*(t-Math.sqrt((t-1)*t)),i=e/2/t;return r=>r<i?t*r*r:e*r-e+1}function kd(t,e){return(i,r)=>i<e?e*t(i/e,r):1-t((1-i)/(1-e),r)*(1-e)}const $rt=kd(Fd(1),1),Art=kd(Fd(1),0),DJ=kd(Fd(1),.5),Mrt=kd(Fd(2),1),Ort=kd(Fd(2),0),Irt=kd(Fd(2),.5),Rrt=kd(Fd(3),1),Prt=kd(Fd(3),0),Drt=kd(Fd(3),.5),Lrt=kd(Fd(4),1),Nrt=kd(Fd(4),0),Frt=kd(Fd(4),.5),LJ={linear:brt,"in-quad":LG,"out-quad":dse,"in-out-quad":wrt,"in-coast-quad":$rt,"out-coast-quad":Art,"in-out-coast-quad":DJ,"in-cubic":pse,"out-cubic":AOe,"in-out-cubic":MOe,"in-coast-cubic":Mrt,"out-coast-cubic":Ort,"in-out-coast-cubic":Irt,"in-quart":fse,"out-quart":OOe,"in-out-quart":xrt,"in-coast-quart":Rrt,"out-coast-quart":Prt,"in-out-coast-quart":Drt,"in-quint":mse,"out-quint":IOe,"in-out-quint":Srt,"in-coast-quint":Lrt,"out-coast-quint":Nrt,"in-out-coast-quint":Frt,"in-sine":gse,"out-sine":ROe,"in-out-sine":Trt,"in-expo":yse,"out-expo":hL,"in-out-expo":Ert,"in-circ":vse,"out-circ":POe,"in-out-circ":Crt,ease:t=>Wh.ease(t),"ease-in":t=>Wh.easeIn(t),"ease-out":t=>Wh.easeOut(t),"ease-in-out":t=>Wh.easeInOut(t)};let krt=class{constructor(){this.pan=0,this.rotate=0,this.fov=0,this.sourceZoom=0,this.targetZoom=0}};const nB={desiredScreenFlow:2,minDuration:500,maxDuration:8e3},DOe={maxDuration:4e3};let zrt=class LOe{constructor(e){this._createCamera=e,this.compared=new krt,this.segmentStart=0,this.segmentEnd=1,this.settings={desiredScreenFlow:nB.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new LOe(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,i,r){this.source!==e&&this.source.copyFrom(e),this.target!==i&&this.target.copyFrom(i),this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow??nB.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const i=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>To()}get hasFov(){return Math.abs(this.compared.fov)>To()}get hasRotate(){return this.compared.rotate>To()}},Urt=class{constructor(){this.pan=0,this.rotate=0,this.zoom=0,this.fov=0,this.zoomOffset=0}},Brt=class{constructor(){this.segments=new Array}get time(){return this.segments.reduce((e,i)=>e+i.time,0)}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),e*=this.time;let r=0,s=0;const n=this.definition,o=this.segments.reduce((a,l)=>a||l.definition.hasZoom,!1);for(let a=0;a<this.segments.length;a++){const l=this.segments[a],c=l.definition;if(e<=l.time||a===this.segments.length-1){if(this.segmentInterpolateComponentsAt(l,l.time===0?0:e/l.time,i),n.hasPan&&!isNaN(i.pan)&&isFinite(n.compared.pan)?i.pan=(r+c.compared.pan*i.pan)/n.compared.pan:i.pan=1,n.hasRotate&&!isNaN(i.rotate)&&isFinite(n.compared.rotate)?i.rotate=(s+c.compared.rotate*i.rotate)/n.compared.rotate:i.rotate=1,o&&!isNaN(i.zoom)&&isFinite(c.compared.targetZoom)){const{sourceZoom:h,targetZoom:d}=c.compared,f=i.zoom*(d-h)+h,m=this.segments[0].definition.compared.sourceZoom,g=this.segments[this.segments.length-1].definition.compared.targetZoom,v=Math.abs(d-m)>Math.abs(h-m)?d:h;i.zoomOffset=v-g,i.zoom=(f-m)/(v-m)}else i.zoom=1;return i}e-=l.time,r+=c.compared.pan,s+=c.compared.rotate}}segmentInterpolateComponentsAt(e,i,r){e.interpolateComponentsAt(i,r)}},A8=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,i=e.compared,r=i.sourceZoom,s=i.targetZoom;this._zoomSign=r>s?1:-1,this._panPixelsAtSource=i.pan*e.source.pixelsPerPanAtZoom(r);const n=(e.source.pixelsPerRotate()+e.target.pixelsPerRotate())/2;this._rotatePixels=i.rotate*n}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:r,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;r&&(s&&(o=(i/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(e/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(r&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(r&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(r&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,h=1+c;this._panPixelFlow=c/h*l,this._rotatePixelFlow=1/h*l}else s?this._panPixelFlow=l:r?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);if(this._time=Math.max(this.rotateTime,this.zoomTime,this.panTime),this.fovTime>this._time){const c=this.fovTime/this._time;this._time=this.fovTime,this._zoomPixelFlow/=c,this._panPixelFlow/=c,this._rotatePixelFlow/=c}}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get fovTime(){return this.definition.hasFov?Math.abs(this.definition.compared.fov)/Vrt:0}get panTime(){if(!this.definition.hasPan)return 0;if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=e*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const i=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(i*(i/r)**-e-i)/(r-i)}return e}_interpolateComponentsFov(e){if(e===0)return this.definition.segmentStart;if(e===1)return this.definition.segmentEnd;if(this.definition.hasFov){const{segmentStart:i,segmentEnd:r}=this.definition;return i+e*(r-i)}return this.definition.segmentStart}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*e*this._time)-1))/(i*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),i.zoom=this._interpolateComponentsZoom(e),i.pan=this._interpolateComponentsPan(e),i.rotate=this._interpolateComponentsRotate(e),i.zoomOffset=0,i.fov=this._interpolateComponentsFov(e)}};const Vrt=At(45);function jrt(t,e,i){const r=e-t.compared.sourceZoom,s=t.halfWindowPanAtZoom(r);return-t.halfWindowSize*(i.ascensionFactor*Math.LN2*t.compared.pan+s)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*s)}function Grt(t,e,i){const r=1/e,s=Math.log(t.compared.sourceZoom*r),n=1/t.desiredPixelFlow,o=1/Math.LN2,a=e-t.compared.sourceZoom,l=1/a,c=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(a))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*r*n*o*l*c-t.halfWindowSize*s*n*o*l+t.halfWindowSize*s*n*o*c/(a*a)}function Hrt(t,e,i){const r=e-t.compared.sourceZoom,s=1/r,n=1/e,o=Math.log(t.compared.sourceZoom*n),a=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(r))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(r*r)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function qrt(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function Wrt(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function Zrt(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function Yrt(t,e,i){return-t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function Jrt(t,e,i){return t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function Xrt(t,e,i){return-2*t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function Krt(t,e,i){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function Qrt(t,e,i){const r=Math.log(e/t.compared.targetZoom),s=1/t.desiredPixelFlow,n=1/Math.LN2,o=-e+t.compared.targetZoom,a=1/o,l=(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*r*s*n*a+t.halfWindowSize*r*s*n*l/(o*o)+t.halfWindowSize*s*n*a*l/e}function est(t,e,i){const r=e-t.compared.targetZoom,s=1/r,n=1/e,o=Math.log(e/t.compared.targetZoom),a=(t.halfWindowPanAtZoom(e)+i.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(r*r)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function tst(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function ist(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function rst(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function sst(t){const e=t.compared.sourceZoom-t.compared.targetZoom;if(e===0)return t.compared.pan*t.halfWindowSize/(t.desiredPixelFlow*t.halfWindowPanAtZoom(t.compared.sourceZoom));const i=Math.LN2*t.compared.pan,r=e,s=t.halfWindowPanAtZoom(r),n=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*s);return t.compared.sourceZoom<=t.compared.targetZoom?n*(i-s):n*(i+s)}function nst(t,e){let i=ost(t,e);const r={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},s=r.ascensionFactor===0,n=r.descensionFactor===0,o=s?qrt:jrt,a=s?Wrt:Grt,l=s?Zrt:Hrt,c=n?tst:Krt,h=n?ist:Qrt,d=n?rst:est,f=S=>o(t,S,r)+Yrt(t,S,r)+c(t,S,r),m=S=>a(t,S,r)+Jrt(t,S,r)+h(t,S,r),g=S=>l(t,S,r)+Xrt(t,S,r)+d(t,S,r);let v=f(i);const _=sst(t);let b;const w=e.maximumIterations||20,x=e.maximumDistance!=null?e.maximumDistance:1/0;for(b=0;b<w;b++){const S=e.desiredSlope??1e-6;let C=m(i);Math.abs(C)>S&&(C+=S);const T=C/g(i);if(isNaN(T)||i>=x&&T<0){if(!isFinite(x))return null;i=x,v=f(i);break}if(i-=T,i<t.compared.sourceZoom||i<t.compared.targetZoom)return null;const M=f(i);if(Math.abs(M-v)/v<=.005)break;v=M}return v>_*(1-.3)||i<t.compared.sourceZoom||i<t.compared.targetZoom?null:i}function ost(t,e){const i=Math.max(t.compared.sourceZoom,t.compared.targetZoom),r=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return r<i?e.maximumDistance!=null?i+(e.maximumDistance-i)/2:1.5*i:e.maximumDistance?Math.min(e.maximumDistance,r):r}let ast=class extends Brt{constructor(e,i){super(),this._preallocSegments=[new A8,new A8,new A8],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,i)}update(e,i){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();const r=i!=null&&i.apex?nst(e,i.apex):null;this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r?this._updateWithApex(r,i==null?void 0:i.apex):this._updateWithoutApex()}segmentInterpolateComponentsAt(e,i,r){e.interpolateComponentsAt(i,r),e===this._ascensionSegment?r.zoom=dse(r.zoom):e===this._descensionSegment&&(r.zoom=LG(r.zoom))}_updateWithApex(e,i){const[r,s,n]=this._preallocSegments,o=(i==null?void 0:i.ascensionFactor)??.5,a=Math.min(1-o,(i==null?void 0:i.ascensionFactor)!=null&&i.descensionFactor!=null?i.descensionFactor:.5),l=1-o-a;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=e,r.definition.compared.pan=this.definition.compared.pan*o,r.definition.compared.rotate=this.definition.compared.rotate*o,r.definition.segmentEnd=o,r.update(),this._ascensionSegment=r,this.segments.push(r),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=e,s.definition.compared.targetZoom=e,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.definition.segmentStart=r.definition.segmentEnd,s.definition.segmentEnd=r.definition.segmentEnd+l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=e,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.definition.segmentStart=o+l,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const lst=new Urt;let NOe=class{get time(){return this._time}get isLinear(){return this.path.segments.length===1}constructor(e){this._time=0,this._easing=DJ,this.definition=new zrt(e),this.path=new ast}update(e,i,r){this.definition.update(e,i,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings(GSe(isFinite(this.path.time)?this.path.time:0),r),this._easing=r.easing??(this._time>=1e3?DJ:hL)}cameraAt(e,i){e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const r=this.path.interpolateComponentsAt(e,lst);i.interpolate(this.definition.source,this.definition.target,r)}_normalizedEasing(e){const i=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(e,this._time)-i)/(r-i)}_applyTimeSettings(e,i){const r=i.speedFactor!=null?i.speedFactor:1,s=i.minDuration??nB.minDuration/r,n=i.maxDuration??nB.maxDuration/r;return e=i.duration!=null?i.duration:Math.min(Math.max(e/r,s),n)}};const cst=2e3,ust=64;let hst=class{constructor(e){this._view=e,this._animation=new NOe(()=>new Wde(this._view)),this._current=new Wde(this._view)}get _source(){return this._animation.definition.source}get _target(){return this._animation.definition.target}get duration(){return this._animation.time}get animation(){return this._animation}update(e,i,r={}){Cl(this._current.viewpoint,e),Cl(this._source.viewpoint,e),Cl(this._target.viewpoint,i),this._animation.update(this._source,this._target,r)}applyRatio(e,i){this._animation.cameraAt(i,this._current),Cl(e,this._current.viewpoint)}},YE=class extends he{constructor(e){super(e),this._animation=null,this._destinationViewState=new ose,this.updateFunction=null,this.easing=LJ.ease,this.viewpoint=new Qr({targetGeometry:new Fe,scale:0,rotation:0}),this._updateTask=tg({postRender:this._postRender.bind(this)}),this._updateTask.pause(),this._transition=new hst(e.view)}destroy(){this._updateTask=Ji(this._updateTask)}get animation(){return this._animation}set animation(e){this._animation=e,this.view.animation=e}animate(e,i,r){this.stop();const s=this.viewpoint;Cl(s,i);const n=e.target;this._transition.update(this.viewpoint,n,{apex:{maximumDistance:Math.min(Math.min(i.scale,n.scale)*ust,this.view.constraints.effectiveMinScale),desiredSlope:5e-8},duration:r==null?void 0:r.duration,maxDuration:(r==null?void 0:r.animationMode)==="auto"?1/0:(r==null?void 0:r.maxDuration)??DOe.maxDuration,speedFactor:r==null?void 0:r.speedFactor,easing:(typeof(r==null?void 0:r.easing)=="string"?LJ[r.easing]:r==null?void 0:r.easing)||this.easing}),(r==null?void 0:r.animationMode)==="auto"&&(this._destinationViewState.copy(this.view.state),this._destinationViewState.viewpoint=n,dst(this._transition.animation,r,this.view.state,this._destinationViewState)||this._transition.update(this.viewpoint,n,{duration:0}));const o=()=>{this.animation===e&&this._updateTask&&(e.state==="finished"&&(this._transition.applyRatio(this.viewpoint,1),this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())),this.animation=null,this.updateFunction=null)};return e.when(o,o),this._startTime=performance.now(),this._updateTask.resume(),this.animation=e,e}animateContinuous(e,i){this.stop(),this.updateFunction=i,this.viewpoint=e;const r=new xv({target:e.clone()}),s=()=>{this.animation===r&&this._updateTask&&(this.animation=null,this.updateFunction=null)};return r.when(s,s),this._startTime=performance.now(),this._updateTask.resume(),this.animation=r,r}stop(){this.animation&&(this.animation.stop(),this.animation=null,this.updateFunction=null)}_postRender(e){var r,s;const i=this.animation;if(i&&i.state!==xv.State.STOPPED){if(this.updateFunction)this.updateFunction(this.viewpoint,e.deltaTime),(r=this.animation)==null||r.update(this.viewpoint);else{const n=performance.now()-this._startTime,o=this._transition.duration,a=o>0?n/o:1,l=a>=1;this._transition.applyRatio(this.viewpoint,a),l&&((s=this.animation)==null||s.finish())}this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())}else this._updateTask.pause()}};function dst(t,e,i,r){if((e==null?void 0:e.duration)!=null)return!0;const{time:s,isLinear:n}=t,o=(e==null?void 0:e.speedFactor)||1;if(s>((e==null?void 0:e.maxDuration)??DOe.maxDuration/o))return!1;if(n){const l=Ye(),c=xo(...r.toScreen(l,...i.center)),h=xo(...i.toScreen(l,...r.center)),d=h!=null&&h.x>-1*i.size[0]&&h.x<(1.5+.5)*i.size[0]&&h.y>-1*i.size[1]&&h.y<(1.5+.5)*i.size[1],f=c!=null&&c.x>-1*r.size[0]&&c.x<(1.5+.5)*r.size[0]&&c.y>-1*r.size[1]&&c.y<(1.5+.5)*r.size[1];if(s>cst/o&&!d&&!f)return!1}return!0}u([p()],YE.prototype,"easing",void 0),u([p()],YE.prototype,"view",void 0),u([p()],YE.prototype,"viewpoint",void 0),YE=u([A("esri.views.2d.AnimationManager")],YE);const pst=YE;function As(){return Promise.all([G(()=>import("./webglDeps-CZX2TNWu.js"),__vite__mapDeps([130,131,132,133])),G(()=>import("./mapViewDeps-BAxHx3N0.js"),__vite__mapDeps([134,135,53,54,55,56,51,59,136,52,137,138,50,139,131,133,140,141,57,64,142,60,61,62,143,144,145,132,146,72,49,16,12,21,20,147,148,40,149,63,150,151,58,152,68,153,154,155,156,157,158]))])}const HM=()=>As().then(()=>G(()=>import("./TileLayerView2D-BvV1D3vv.js"),__vite__mapDeps([159,52,53,54,55,56,51,143,144,141,138,50,139,131,133,140,146,136,135,59,137,57,64,72,49,16,12,21,20,40,60,61,62,152,68,160,161,156,162,163,154,155,164,165,166,167,168,169,170]))),Cw=()=>As().then(()=>G(()=>import("./FeatureLayerView2D-D1H9skqr.js").then(t=>t.F),__vite__mapDeps([171,141,172,173,174,16,12,23,162,140,155,52,50,51,156,138,139,131,133,135,53,54,55,56,59,136,137,57,64,72,175,142,176,70,177,167,170,164,165]))),Zde={"base-dynamic":()=>As().then(()=>G(()=>import("./BaseDynamicLayerView2D-CWX6hbDc.js"),__vite__mapDeps([178,179,138,50,51,139,131,133,140,141,161,136,59,162,180,164,165]))),"base-tile":HM,"bing-maps":HM,catalog:()=>As().then(()=>G(()=>import("./CatalogLayerView2D-D8Y_aRyf.js"),__vite__mapDeps([181,162,140,141,182,164]))),"catalog-dynamic-group":()=>As().then(()=>G(()=>import("./CatalogDynamicGroupLayerView2D-CCXE3V5z.js"),__vite__mapDeps([183,162,140,141,184,164]))),"catalog-footprint":()=>As().then(()=>G(()=>import("./CatalogFootprintLayerView2D-9-K7KaJ6.js"),__vite__mapDeps([185,171,141,172,173,174,16,12,23,162,140,155,52,50,51,156,138,139,131,133,135,53,54,55,56,59,136,137,57,64,72,175,142,176,70,177,167,170,164,165,186]))),csv:Cw,"geo-rss":()=>As().then(()=>G(()=>import("./GeoRSSLayerView2D-BrLHlYmT.js"),__vite__mapDeps([187,162,140,141,153,154,155,52,50,51,156,138,139,131,133,135,53,54,55,56,59,136,137,57,64,152,143,144,49,16,12,21,20,68,164]))),feature:Cw,geojson:Cw,parquet:Cw,graphics:()=>As().then(()=>G(()=>import("./GraphicsLayerView2D-CK5cdsKc.js"),__vite__mapDeps([188,162,140,141,153,154,155,52,50,51,156,138,139,131,133,135,53,54,55,56,59,136,137,57,64,152,143,144,49,16,12,21,20,68,164]))),group:()=>As().then(()=>G(()=>import("./GroupLayerView2D-DL1Sx1hV.js"),__vite__mapDeps([189,162,140,141,190,164]))),imagery:()=>As().then(()=>G(()=>import("./ImageryLayerView2D-Dx6JZv3n.js"),__vite__mapDeps([191,192,79,80,139,138,50,51,131,133,140,141,162,152,53,54,55,56,143,144,49,52,16,12,21,20,135,59,136,137,57,64,68,163,154,155,156,179,161,180,83,193,172,170,164,165]))),"imagery-tile":()=>As().then(()=>G(()=>import("./ImageryTileLayerView2D-DJ6Vaif2.js"),__vite__mapDeps([194,195,192,79,80,139,138,50,51,131,133,140,141,162,196,150,62,156,197,83,198,199,172,170,164,165]))),kml:()=>As().then(()=>G(()=>import("./KMLLayerView2D-D0SvS-Id.js"),__vite__mapDeps([200,201,161,136,59,179,138,50,51,139,131,133,140,141,162,153,154,155,52,156,135,53,54,55,56,137,57,64,152,143,144,49,16,12,21,20,68,164,83,150,62,147,132,196]))),"knowledge-graph":()=>As().then(()=>G(()=>import("./KnowledgeGraphLayerView2D-DLesJ6n1.js"),__vite__mapDeps([202,162,140,141,164]))),"link-chart":()=>As().then(()=>G(()=>import("./KnowledgeGraphLayerView2D-DLesJ6n1.js"),__vite__mapDeps([202,162,140,141,164]))),"knowledge-graph-sublayer":Cw,"map-image":()=>As().then(()=>G(()=>import("./MapImageLayerView2D-BH-M95kr.js"),__vite__mapDeps([203,179,138,50,51,139,131,133,140,141,161,136,59,162,152,53,54,55,56,143,144,49,52,16,12,21,20,135,137,57,64,68,163,154,155,156,180,164,204,205,167,169,172,165,166,168,170]))),"map-notes":()=>As().then(()=>G(()=>import("./MapNotesLayerView2D-DUkJnbby.js"),__vite__mapDeps([206,162,140,141,153,154,155,52,50,51,156,138,139,131,133,135,53,54,55,56,59,136,137,57,64,152,143,144,49,16,12,21,20,68,164]))),media:()=>As().then(()=>G(()=>import("./MediaLayerView2D-Cl_1Fnot.js"),__vite__mapDeps([207,208,68,52,53,54,55,56,51,143,144,141,138,50,139,131,133,140,146,136,135,59,137,57,64,72,49,16,12,21,20,40,60,61,62,152,209,149,63,210,151,162,164,211]))),"ogc-feature":()=>As().then(()=>G(()=>import("./OGCFeatureLayerView2D-Xpr8p7W-.js"),__vite__mapDeps([212,171,141,172,173,174,16,12,23,162,140,155,52,50,51,156,138,139,131,133,135,53,54,55,56,59,136,137,57,64,72,175,142,176,70,177,167,170,164,165,213]))),"open-street-map":HM,"oriented-imagery":Cw,route:()=>As().then(()=>G(()=>import("./RouteLayerView2D--X2QMVGw.js"),__vite__mapDeps([214,215,216,162,140,141,153,154,155,52,50,51,156,138,139,131,133,135,53,54,55,56,59,136,137,57,64,152,143,144,49,16,12,21,20,68,164]))),stream:()=>As().then(()=>G(()=>import("./StreamLayerView2D-C72_vomw.js"),__vite__mapDeps([217,171,141,172,173,174,16,12,23,162,140,155,52,50,51,156,138,139,131,133,135,53,54,55,56,59,136,137,57,64,72,175,142,176,70,177,167,170,164,165,218]))),"subtype-group":()=>As().then(()=>G(()=>import("./SubtypeGroupLayerView2D-B15tfu_h.js"),__vite__mapDeps([219,171,141,172,173,174,16,12,23,162,140,155,52,50,51,156,138,139,131,133,135,53,54,55,56,59,136,137,57,64,72,175,142,176,70,177,167,170,164,165]))),tile:HM,"vector-tile":()=>As().then(()=>G(()=>import("./VectorTileLayerView2D-DlWvqME0.js"),__vite__mapDeps([220,221,56,40,55,156,138,50,51,139,131,133,140,141,26,93,94,162,164,165]))),video:()=>As().then(()=>G(()=>import("./VideoLayerView2D-CPMoepEx.js"),__vite__mapDeps([222,223,224,210,138,50,51,139,131,133,140,141,135,53,54,55,56,59,136,52,137,57,64,151,162,153,154,155,156,152,143,144,49,16,12,21,20,68,164]))),wcs:()=>As().then(()=>G(()=>import("./ImageryTileLayerView2D-DJ6Vaif2.js"),__vite__mapDeps([194,195,192,79,80,139,138,50,51,131,133,140,141,162,196,150,62,156,197,83,198,199,172,170,164,165]))),"web-tile":HM,wfs:Cw,wms:()=>As().then(()=>G(()=>import("./WMSLayerView2D-NiJDgoXj.js"),__vite__mapDeps([225,179,138,50,51,139,131,133,140,141,161,136,59,162,180,164,165,226,227,172]))),wmts:()=>As().then(()=>G(()=>import("./WMTSLayerView2D-5feqDQ9I.js"),__vite__mapDeps([228,160,161,136,59,156,138,50,51,139,131,133,140,141,162,164,165]))),"line-of-sight":null,"base-elevation":null,"building-scene":null,dimension:null,elevation:null,"integrated-mesh":null,"integrated-mesh-3dtiles":null,"point-cloud":null,viewshed:null,voxel:null,scene:null,unknown:null,unsupported:null};function fst(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",i=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new U(`${i}:view-not-supported`,`${e} is not supported in 2D`)}const Yde={hasLayerViewModule:t=>Zde[t.type]!=null,importLayerView:t=>{const e=Zde[t.type];if(e==null)throw fst(t);return e(t)}};let og=class $1{static getId(e,i,r,s){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${i}/${r}/${s}`}constructor(e,i,r,s){this.set(e,i,r,s)}get key(){return this}get id(){return this.toString()}get normalizedId(){return`${this.level}/${this.row}/${this.col}`}set id(e){this.set(e)}get hash(){const e=4095&this.row,i=4095&this.col,r=63&this.level;return(3&this.world)<<30|i<<22|e<<8|r}acquire(e,i,r,s){this.set(e,i,r,s)}contains(e){const i=e.level-this.level;return i>=0&&this.row===e.row>>i&&this.col===e.col>>i&&this.world===e.world}containsChild(e){const i=e.level-this.level;return i>0&&this.row===e.row>>i&&this.col===e.col>>i&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new $1(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,i,r,s){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[n,o,a,l]=e.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+i,this.col=+r,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new $1(this.level-1,this.row>>1,this.col>>1,this.world)}getNormalizedNeighbor(e,i,r){const s=this.clone();return s.col+=e,s.row+=i,r.normalizeKey(s),s}getChildKeys(){const e=this.level+1,i=this.row<<1,r=this.col<<1,s=this.world;return[new $1(e,i,r,s),new $1(e,i,r+1,s),new $1(e,i+1,r,s),new $1(e,i+1,r+1,s)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};og.pool=new Ol(og,null,null,25,50);function RT(t,e){return[t,e]}function $w(t,e,i){return t[0]=e,t[1]=i,t}function mst(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}const Kd=new og("0/0/0/0");let gst=class FOe{static create(e,i,r=null){const s=hc(e.spatialReference),n=i.origin||RT(e.origin.x,e.origin.y),o=RT(e.size[0]*i.resolution,e.size[1]*i.resolution),a=RT(-1/0,-1/0),l=RT(1/0,1/0),c=RT(1/0,1/0);r!=null&&($w(a,Math.max(0,Math.floor((r.xmin-n[0])/o[0])),Math.max(0,Math.floor((n[1]-r.ymax)/o[1]))),$w(l,Math.max(0,Math.floor((r.xmax-n[0])/o[0])),Math.max(0,Math.floor((n[1]-r.ymin)/o[1]))),$w(c,l[0]-a[0]+1,l[1]-a[1]+1));const{cols:h,rows:d}=i;let f,m,g,v;return!r&&h&&d&&($w(a,h[0],d[0]),$w(l,h[1],d[1]),$w(c,h[1]-h[0]+1,d[1]-d[0]+1)),e.isWrappable?(f=RT(Math.ceil(Math.round((s.valid[1]-s.valid[0])/i.resolution)/e.size[0]),c[1]),m=!0,g=s.origin,v=s.valid):(f=c,m=!1),new FOe(i.level,i.resolution,i.scale,n,a,l,c,o,f,m,g,v)}constructor(e,i,r,s,n,o,a,l,c,h,d,f){this.level=e,this.resolution=i,this.scale=r,this.origin=s,this.first=n,this.last=o,this.size=a,this.norm=l,this.worldSize=c,this.wrap=h,this._spatialReferenceOrigin=d,this._spatialReferenceValid=f}normalizeCol(e){if(!this.wrap)return e;const i=this.worldSize[0];return e<0?i-1-Math.abs((e+1)%i):e%i}normalizeKey(e){if(!this.wrap)return;const i=this.worldSize[0],r=e.col;r<0?(e.col=r+i,e.world-=1):r>=i&&(e.col=r-i,e.world+=1)}denormalizeCol(e,i){return this.wrap?this.worldSize[0]*i+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){const i=this.origin[0]+e*this.norm[0],r=this._spatialReferenceOrigin,s=this._spatialReferenceValid;return this.wrap&&r&&s?i===r[0]?s[0]:this.origin[0]===r[0]&&e===this.worldSize[0]?s[1]:i:i}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,i,r=!1){Kd.set(i);const s=r?Kd.col:this.denormalizeCol(Kd.col,Kd.world),n=Kd.row;return mst(e,this.getXForColumn(s),this.getYForRow(n+1),this.getXForColumn(s+1),this.getYForRow(n)),e}getTileCoords(e,i,r=!1){Kd.set(i);const s=r?Kd.col:this.denormalizeCol(Kd.col,Kd.world);return Array.isArray(e)?$w(e,this.getXForColumn(s),this.getYForRow(Kd.row)):(e.x=this.getXForColumn(s),e.y=this.getYForRow(Kd.row)),e}},I3=class{constructor(){this.spans=[]}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}*keys(){const e=this.lodInfo;for(const{row:i,colFrom:r,colTo:s}of this.spans)for(let n=r;n<=s;n++){const o=e.getWorldForColumn(n);yield new og(e.level,i,e.normalizeCol(n),o)}}forEach(e,i){const{spans:r,lodInfo:s}=this,{level:n}=s;if(r.length!==0)for(const{row:o,colFrom:a,colTo:l}of r)for(let c=a;c<=l;c++)e.call(i,n,o,s.normalizeCol(c),s.getWorldForColumn(c))}};I3.pool=new Ol(I3);let M8=class{constructor(e,i,r){this.row=e,this.colFrom=i,this.colTo=r}};const Fs=new og("0/0/0/0");let yst=class kOe{static create(e,i){e[1]>i[1]&&([e,i]=[i,e]);const[r,s]=e,[n,o]=i,a=n-r,l=o-s,c=l!==0?a/l:0,h=(Math.ceil(s)-s)*c,d=(Math.floor(s)-s)*c;return new kOe(r,Math.floor(s),Math.ceil(o),c,a<0?h:d,a<0?d:h,a<0?n:r,a<0?r:n)}constructor(e,i,r,s,n,o,a,l){this.x=e,this.ymin=i,this.ymax=r,this.invM=s,this.leftAdjust=n,this.rightAdjust=o,this.leftBound=a,this.rightBound=l}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}};const pu=[[0,0],[0,0],[0,0],[0,0]],vst=1e-6;let _st=class{constructor(e,i=null,r=e.lods[0].level,s=e.lods[e.lods.length-1].level){this.tileInfo=e,this.fullExtent=i,this.scales=[],this._infoByScale={},this._infoByLevel={};const n=e.lods.filter(a=>a.level>=r&&a.level<=s);this.minScale=n[0].scale,this.maxScale=n[n.length-1].scale;const o=this._lodInfos=n.map(a=>gst.create(e,a,i));n.forEach((a,l)=>{this._infoByLevel[a.level]=o[l],this._infoByScale[a.scale]=o[l],this.scales[l]=a.scale},this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel[typeof e=="number"?e:e.level]}getTileBounds(e,i,r=!1){Fs.set(i);const s=this._infoByLevel[Fs.level];return s?s.getTileBounds(e,Fs,r):e}getTileCoords(e,i,r=!1){Fs.set(i);const s=this._infoByLevel[Fs.level];return s?s.getTileCoords(e,Fs,r):e}getTileCoverage(e,i=192,r=!0,s="closest"){if(!r&&(e.scale>this.minScale||e.scale<this.maxScale))return null;const n=s==="closest"?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),o=I3.pool.acquire(n),a=this._wrap;let l,c,h,d=1/0,f=-1/0;const m=o.spans;pu[0][0]=pu[0][1]=pu[1][1]=pu[3][0]=-i,pu[1][0]=pu[2][0]=e.size[0]+i,pu[2][1]=pu[3][1]=e.size[1]+i;for(const b of pu)e.toMap(b,b),b[0]=n.getColumnForX(b[0]),b[1]=n.getRowForY(b[1]);const g=[];let v=3;for(let b=0;b<4;b++){if(pu[b][1]===pu[v][1]){v=b;continue}const w=yst.create(pu[b],pu[v]);d=Math.min(w.ymin,d),f=Math.max(w.ymax,f),g[w.ymin]===void 0&&(g[w.ymin]=[]),g[w.ymin].push(w),v=b}if(d==null||f==null||f-d>100)return null;let _=[];for(l=d;l<f;){g[l]!=null&&(_=_.concat(g[l])),c=1/0,h=-1/0;for(let b=_.length-1;b>=0;b--){const w=_[b];c=Math.min(c,w.getLeftCol()),h=Math.max(h,w.getRightCol())}if(c=Math.floor(c),h=Math.floor(h),l>=n.first[1]&&l<=n.last[1])if(a)if(n.size[0]<n.worldSize[0]){const b=Math.floor(h/n.worldSize[0]);for(let w=Math.floor(c/n.worldSize[0]);w<=b;w++)m.push(new M8(l,Math.max(n.getFirstColumnForWorld(w),c),Math.min(n.getLastColumnForWorld(w),h)))}else m.push(new M8(l,c,h));else c>n.last[0]||h<n.first[0]||(c=Math.max(c,n.first[0]),h=Math.min(h,n.last[0]),m.push(new M8(l,c,h)));l+=1;for(let b=_.length-1;b>=0;b--){const w=_[b];w.ymax>=l?w.incrRow():_.splice(b,1)}}return o}getTileParentId(e){Fs.set(e);const i=this._infoByLevel[Fs.level],r=this._lodInfos.indexOf(i)-1;return r<0?null:(this._getTileIdAtLOD(Fs,this._lodInfos[r],Fs),Fs.id)}getTileResolution(e){const i=this._infoByLevel[typeof e=="object"?e.level:e];return i?i.resolution:-1}getTileScale(e){const i=this._infoByLevel[e.level];return i?i.scale:-1}intersects(e,i){Fs.set(i);const r=this._infoByLevel[Fs.level],s=e.lodInfo;if(s.resolution>r.resolution){this._getTileIdAtLOD(Fs,s,Fs);const o=s.denormalizeCol(Fs.col,Fs.world);for(const a of e.spans)if(a.row===Fs.row&&a.colFrom<=o&&a.colTo>=o)return!0}if(s.resolution<r.resolution){const[o,a,l,c]=e.spans.reduce((v,_)=>(v[0]=Math.min(v[0],_.row),v[1]=Math.max(v[1],_.row),v[2]=Math.min(v[2],_.colFrom),v[3]=Math.max(v[3],_.colTo),v),[1/0,-1/0,1/0,-1/0]),h=r.denormalizeCol(Fs.col,Fs.world),d=s.getColumnForX(r.getXForColumn(h)),f=s.getRowForY(r.getYForRow(Fs.row)),m=s.getColumnForX(r.getXForColumn(h+1))-1,g=s.getRowForY(r.getYForRow(Fs.row+1))-1;return!(d>c||m<l||f>a||g<o)}const n=s.denormalizeCol(Fs.col,Fs.world);return e.spans.some(o=>o.row===Fs.row&&o.colFrom<=n&&o.colTo>=n)}normalizeBounds(e,i,r){if(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],this._wrap){const s=hc(this.tileInfo.spatialReference),n=-r*(s.valid[1]-s.valid[0]);e[0]+=n,e[2]+=n}return e}getSmallestInfoForScale(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>i[0])return this._infoByScale[i[0]];for(let r=1;r<i.length-1;r++)if(e>i[r]+vst)return this._infoByScale[i[r-1]];return this._infoByScale[i[i.length-1]]}getClosestInfoForScale(e){const i=this.scales;return this._infoByScale[e]||(e=i.reduce((r,s)=>Math.abs(s-e)<Math.abs(r-e)?s:r,i[0])),this._infoByScale[e]}scaleToLevel(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let r=i.length-1;r>=0;r--)if(e<i[r])return r===i.length-1?this._infoByScale[i[i.length-1]].level:this._infoByScale[i[r]].level+(i[r]-e)/(i[r]-i[r+1]);return this._infoByScale[i[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}zoomToScale(e){return this.tileInfo.zoomToScale(e)}_getTileIdAtLOD(e,i,r){const s=this._infoByLevel[r.level];return e.set(r),i.resolution<s.resolution?null:(i.resolution===s.resolution||(e.level=i.level,e.col=Math.floor(r.col*s.resolution/i.resolution+.01),e.row=Math.floor(r.row*s.resolution/i.resolution+.01)),e)}},bst=class{constructor(e,i){this.item=e,this.controller=i,this.promise=null}},wst=class{constructor(e){this._schedule=null,this._task=null,this._deferreds=new i5,this._controllers=new i5,this._processingItems=new i5,this._pausedSignal=Ta(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new LU(e.peeker),this.process=e.process;const i=e.scheduler;e.priority&&i&&(this._task=i.registerTask(e.priority,this))}destroy(){this.clear(),this._schedule=Ji(this._schedule),this._task=Ji(this._task)}get updating(){var e;return!!((e=this._task)!=null&&e.updating)||this.running}get length(){return this._processingItems.size+this._queue.length}abort(e){const i=this._controllers.get(e);i&&i.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(i=>e.push(i)),this._controllers.clear(),e.forEach(i=>i.abort()),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach((i,r)=>e(r))}get(e){const i=this._deferreds.get(e);return i?i.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,i){const r=this.get(e);if(r)return r;const s=new AbortController;let n=null;i&&(n=Qo(i,()=>s.abort()));const o=()=>{const h=this._processingItems.get(e);h&&h.controller.abort(),a(),c.reject(bi())},a=()=>{l.remove(),n!=null&&n.remove(),this._removeItem(e),this._queue.remove(e),this._scheduleNext()},l=zD(s.signal,o),c=ta();return this._deferreds.set(e,c),this._controllers.set(e,s),c.promise.then(a,a),this._queue.push(e),this._scheduleNext(),c.promise}last(){return this._queue.last()}lastPromise(){const e=this.last();return e?this.get(e):null}peek(){return this._queue.peek()}popLast(){var i;const e=this._queue.popLast();return e&&((i=this._deferreds.get(e))==null||i.reject(bi()),this._removeItem(e)),e}reset(){const e=Array.from(this._processingItems.values());this._processingItems.clear();for(const i of e)this._queue.push(i.item),i.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_removeItem(e){this._deferreds.delete(e),this._controllers.delete(e),this._processingItems.delete(e)}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=YA(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(i))}_processError(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(i))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(e==null)return;let i;const r=new AbortController,s=new bst(e,r);this._processingItems.set(e,s);try{i=this.process(e,r.signal)}catch(n){this._processError(s,n)}uu(i)?(s.promise=i,i.then(n=>this._processResult(s,n),n=>this._processError(s,n))):this._processResult(s,i)}get test(){}};const Jde=[0,0];let oy=class extends he{constructor(e){super(e),this._keyToItem=new Map,this._tilesByScale=new Map,this.concurrency=6}initialize(){const{concurrency:e,process:i,scheduler:r,priority:s}=this;this._queue=new wst({concurrency:e,scheduler:r,priority:s,process:(n,o)=>{const a=this._keyToItem.get(n);return i(a,{signal:o})},peeker:n=>this._peek(n)})}destroy(){this.clear(),this._queue=$e(this._queue)}get length(){return this._queue?this._queue.length:0}abort(e){const i=typeof e=="string"?e:e.id;this._queue.abort(i)}clear(){this._queue.clear(),this._keyToItem.clear(),this._tilesByScale.clear()}has(e){return typeof e=="string"?this._keyToItem.has(e):this._keyToItem.has(e.id)}pause(){this._queue.pause()}push(e){const i=e.key.id;if(this._queue.has(i))return this._queue.get(i);const r=this._queue.push(i),s=this.tileInfoView.getTileScale(e.key),n=tw(this._tilesByScale,s,()=>new Set),o=()=>{n.delete(e.key),n.size===0&&this._tilesByScale.delete(s),this._keyToItem.delete(i)};return n.add(e.key),this._keyToItem.set(i,e),r.then(o,o),r}reset(){this._queue.reset()}resume(){this._queue.resume()}_peek(e){if(!this.state)return e.values().next().value;const i=new Set;for(const o of e)i.add(this._keyToItem.get(o).key);const r=this.state.scale;let s,n=Number.POSITIVE_INFINITY;for(const[o,a]of this._tilesByScale)if(qR(a,l=>i.has(l))){const l=Math.abs(o-r);l<n&&(s=a,n=l)}return this._getClosestTileKey(s,e).id}_getClosestTileKey(e,i){const r=this.tileInfoView,s=this.state.center;let n,o=Number.POSITIVE_INFINITY;for(const a of e)if(i.has(a.id)){r.getTileCoords(Jde,a);const l=wv(Jde,s);l<o&&(o=l,n=a)}return n}};u([p({constructOnly:!0})],oy.prototype,"concurrency",void 0),u([p({constructOnly:!0})],oy.prototype,"priority",void 0),u([p({constructOnly:!0})],oy.prototype,"process",void 0),u([p({constructOnly:!0})],oy.prototype,"scheduler",void 0),u([p()],oy.prototype,"state",void 0),u([p({constructOnly:!0})],oy.prototype,"tileInfoView",void 0),oy=u([A("esri.views.2d.tiling.TileQueue")],oy);const VZt=oy;let xst=class{constructor(e,i,r){this.maxSize=e,this._tileInfoView=i,this._removedFunc=r,this._tilePerId=new Map,this._tileKeysPerLevel=[]}clear(){this._tilePerId.clear(),this._tileKeysPerLevel=[]}has(e){return this._tilePerId.has(e)}get(e){return this._tilePerId.get(e)}pop(e){const i=this._tilePerId.get(e);if(!i)return;const r=i.key.level,s=this._tileKeysPerLevel[r];Xde(this._tilePerId,e);for(let n=0;n<s.length;n++)if(s[n].id===e){s.splice(n,1);break}return i.visible=!0,i}add(e){e.visible=!1;const i=e.key,r=i.id;if(this._tilePerId.has(r))return;this._tilePerId.set(r,e);const s=i.level;this._tileKeysPerLevel[s]||(this._tileKeysPerLevel[s]=[]),this._tileKeysPerLevel[s].push(i)}prune(e,i,r){let s=this._tilePerId.size;if(s<=this.maxSize)return;let n=this._tileKeysPerLevel.length-1;for(;s>this.maxSize&&n>=0;)n!==e&&(s=this._pruneAroundCenterTile(s,i,r,n)),n--;s>this.maxSize&&(s=this._pruneAroundCenterTile(s,i,r,e))}_pruneAroundCenterTile(e,i,r,s){const n=this._tileKeysPerLevel[s];if(!n||n.length===0)return e;const{size:o,origin:a}=this._tileInfoView.tileInfo,l=r*o[0],c=r*o[1],h=[0,0],d=[0,0];for(n.sort((f,m)=>(h[0]=a.x+l*(f.col+.5),h[1]=a.y-c*(f.row+.5),d[0]=a.x+l*(m.col+.5),d[1]=a.y-c*(m.row+.5),sA(h,i)-sA(d,i)));n.length>0;){const f=n.pop();if(this._removeTile(f.id),--e===this.maxSize)break}return e}_removeTile(e){const i=this._tilePerId.get(e);this._removedFunc&&i&&this._removedFunc(i),Xde(this._tilePerId,e)}};function Xde(t,e){t.delete(e)}const Aw=new og(0,0,0,0),Rg=new Map,qM=[],O8=[];let GZt=class{constructor(e){this._previousScale=Number.POSITIVE_INFINITY,this.cachePolicy="keep",this.coveragePolicy="closest",this.resampling=!0,this.tileIndex=new Map,this.tiles=[],this.buffer=192,this.acquireTile=e.acquireTile,this.releaseTile=e.releaseTile,this.tileInfoView=e.tileInfoView,e.resampling!=null&&(this.resampling=e.resampling),e.cachePolicy&&(this.cachePolicy=e.cachePolicy),e.coveragePolicy&&(this.coveragePolicy=e.coveragePolicy),e.buffer!=null&&(this.buffer=e.buffer),e.cacheSize&&(this._tileCache=new xst(e.cacheSize,this.tileInfoView,i=>{this.releaseTile(i)}))}destroy(){this.tileIndex.clear()}update(e){var b,w;const{resampling:i,tileIndex:r}=this,{scale:s,center:n,resolution:o}=e.state,{minScale:a,maxScale:l}=this.tileInfoView,c=!e.stationary&&s>this._previousScale;if(this._previousScale=s,!i&&(s>a||s<l))return this.tiles.length=0,void this.clear();const h=this.tileInfoView.getTileCoverage(e.state,this.buffer,this.resampling,this.coveragePolicy);if(!h)return this.tiles.length=0,void this.clear();const{spans:d,lodInfo:f}=h,{level:m}=f;this.tiles.length=0,r.forEach(x=>x.visible=!0);let g=0,v=0;if(d.length>0)for(const{row:x,colFrom:S,colTo:C}of d)for(let T=S;T<=C;T++){g++;const M=Aw.set(m,x,f.normalizeCol(T),f.getWorldForColumn(T)).id;let I=r.get(M);if(I)I.isReady?(Rg.set(M,I),v++):c||this._addParentTile(M,Rg);else{if((b=this._tileCache)!=null&&b.has(M)){if(I=this._tileCache.pop(M),this.tileIndex.set(M,I),I.isReady){Rg.set(M,I),v++;continue}}else I=this.acquireTile(Aw),this.tileIndex.set(M,I);c||this._addParentTile(M,Rg)}}const _=v===g;for(const[x,S]of r){if(Rg.has(x))continue;Aw.set(x);const C=this.tileInfoView.intersects(h,Aw),T=this.cachePolicy==="purge"?Aw.level!==m:Aw.level>m;!C||!c&&_?!T&&C||qM.push(S):S.isReady?T&&this.cachePolicy==="purge"&&this._hasReadyAncestor(Aw,m)?qM.push(S):O8.push(S):T&&qM.push(S)}for(const x of O8)x.isReady&&Rg.set(x.key.id,x);for(const x of qM)this._tileCache?this._tileCache.add(x):this.releaseTile(x),r.delete(x.key.id);for(const x of Rg.values())this.tiles.push(x);for(const x of r.values())Rg.has(x.key.id)||(x.visible=!1);(w=this._tileCache)==null||w.prune(m,n,o),I3.pool.release(h),O8.length=0,qM.length=0,Rg.clear()}clear(){const{tileIndex:e}=this;for(const i of e.values())this.releaseTile(i);e.clear()}refresh(e){var i;for(const r of this.tileIndex.values())e(r);(i=this._tileCache)==null||i.clear()}updateCacheSize(e){this._tileCache&&(this._tileCache.maxSize=e)}_addParentTile(e,i){var n;let r=e,s=null;for(;r=this.tileInfoView.getTileParentId(r),r;)if(this.tileIndex.has(r)){if(s=this.tileIndex.get(r),s==null?void 0:s.isReady){i.has(s.key.id)||i.set(s.key.id,s);break}}else if((n=this._tileCache)!=null&&n.has(r)&&(s=this._tileCache.pop(r),this.tileIndex.set(r,s),s==null?void 0:s.isReady)){i.has(s.key.id)||i.set(s.key.id,s);break}}_hasReadyAncestor(e,i){const r=si();this.tileInfoView.getTileBounds(r,e,!0);for(const s of this.tileIndex.values())if(s.isReady&&s.key.level>=i&&s.key.level<e.level){const n=si();if(this.tileInfoView.getTileBounds(n,s.key,!0),uZ(n,r))return!0}return!1}};function Sst(t,e,i,r,s){zOe(t,e,i||0,r||t.length-1,s||Tst)}function zOe(t,e,i,r,s){for(;r>i;){if(r-i>600){var n=r-i+1,o=e-i+1,a=Math.log(n),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(n-l)/n)*(o-n/2<0?-1:1);zOe(t,e,Math.max(i,Math.floor(e-o*l/n+c)),Math.min(r,Math.floor(e+(n-o)*l/n+c)),s)}var h=t[e],d=i,f=r;for(WM(t,i,e),s(t[r],h)>0&&WM(t,i,r);d<f;){for(WM(t,d,f),d++,f--;s(t[d],h)<0;)d++;for(;s(t[f],h)>0;)f--}s(t[i],h)===0?WM(t,i,f):WM(t,++f,r),f<=e&&(i=f+1),e<=f&&(r=f-1)}}function WM(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function Tst(t,e){return t<e?-1:t>e?1:0}function oB(t,e){if(!(this instanceof oB))return new oB(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&(typeof e=="function"?this.toBBox=e:this._initFormat(e)),this.clear()}function Est(t,e,i){if(!i)return e.indexOf(t);for(var r=0;r<e.length;r++)if(i(t,e[r]))return r;return-1}function PT(t,e){PI(t,0,t.children.length,e,t)}function PI(t,e,i,r,s){s||(s=JE(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var n,o=e;o<i;o++)n=t.children[o],DI(s,t.leaf?r(n):n);return s}function DI(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function Kde(t,e){return t.minX-e.minX}function Qde(t,e){return t.minY-e.minY}function I8(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function FN(t){return t.maxX-t.minX+(t.maxY-t.minY)}function Cst(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function $st(t,e){var i=Math.max(t.minX,e.minX),r=Math.max(t.minY,e.minY),s=Math.min(t.maxX,e.maxX),n=Math.min(t.maxY,e.maxY);return Math.max(0,s-i)*Math.max(0,n-r)}function R8(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function kN(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function JE(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function epe(t,e,i,r,s){for(var n,o=[e,i];o.length;)(i=o.pop())-(e=o.pop())<=r||(n=e+Math.ceil((i-e)/r/2)*r,Sst(t,n,e,i,s),o.push(e,n,n,i))}oB.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,i=[],r=this.toBBox;if(!kN(t,e))return i;for(var s,n,o,a,l=[];e;){for(s=0,n=e.children.length;s<n;s++)o=e.children[s],kN(t,a=e.leaf?r(o):o)&&(e.leaf?i.push(o):R8(t,a)?this._all(o,i):l.push(o));e=l.pop()}return i},collides:function(t){var e=this.data,i=this.toBBox;if(!kN(t,e))return!1;for(var r,s,n,o,a=[];e;){for(r=0,s=e.children.length;r<s;r++)if(n=e.children[r],kN(t,o=e.leaf?i(n):n)){if(e.leaf||R8(t,o))return!0;a.push(n)}e=a.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,i=t.length;e<i;e++)this.insert(t[e]);return this}var r=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var s=this.data;this.data=r,r=s}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(t){return t!=null&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=JE([]),this},remove:function(t,e){if(t==null)return this;for(var i,r,s,n,o=this.data,a=this.toBBox(t),l=[],c=[];o||l.length;){if(o||(o=l.pop(),r=l[l.length-1],i=c.pop(),n=!0),o.leaf&&(s=Est(t,o.children,e))!==-1)return o.children.splice(s,1),l.push(o),this._condense(l),this;n||o.leaf||!R8(o,a)?r?(i++,o=r.children[i],n=!1):o=null:(l.push(o),c.push(i),i=0,r=o,o=o.children[0])}return this},toBBox:function(t){return t},compareMinX:Kde,compareMinY:Qde,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},_build:function(t,e,i,r){var s,n=i-e+1,o=this._maxEntries;if(n<=o)return PT(s=JE(t.slice(e,i+1)),this.toBBox),s;r||(r=Math.ceil(Math.log(n)/Math.log(o)),o=Math.ceil(n/Math.pow(o,r-1))),(s=JE([])).leaf=!1,s.height=r;var a,l,c,h,d=Math.ceil(n/o),f=d*Math.ceil(Math.sqrt(o));for(epe(t,e,i,f,this.compareMinX),a=e;a<=i;a+=f)for(epe(t,a,c=Math.min(a+f-1,i),d,this.compareMinY),l=a;l<=c;l+=d)h=Math.min(l+d-1,c),s.children.push(this._build(t,l,h,r-1));return PT(s,this.toBBox),s},_chooseSubtree:function(t,e,i,r){for(var s,n,o,a,l,c,h,d;r.push(e),!e.leaf&&r.length-1!==i;){for(h=d=1/0,s=0,n=e.children.length;s<n;s++)l=I8(o=e.children[s]),(c=Cst(t,o)-l)<d?(d=c,h=l<h?l:h,a=o):c===d&&l<h&&(h=l,a=o);e=a||e.children[0]}return e},_insert:function(t,e,i){var r=this.toBBox,s=i?t:r(t),n=[],o=this._chooseSubtree(s,this.data,e,n);for(o.children.push(t),DI(o,s);e>=0&&n[e].children.length>this._maxEntries;)this._split(n,e),e--;this._adjustParentBBoxes(s,n,e)},_split:function(t,e){var i=t[e],r=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,r);var n=this._chooseSplitIndex(i,s,r),o=JE(i.children.splice(n,i.children.length-n));o.height=i.height,o.leaf=i.leaf,PT(i,this.toBBox),PT(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(i,o)},_splitRoot:function(t,e){this.data=JE([t,e]),this.data.height=t.height+1,this.data.leaf=!1,PT(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,i){var r,s,n,o,a,l,c,h;for(l=c=1/0,r=e;r<=i-e;r++)o=$st(s=PI(t,0,r,this.toBBox),n=PI(t,r,i,this.toBBox)),a=I8(s)+I8(n),o<l?(l=o,h=r,c=a<c?a:c):o===l&&a<c&&(c=a,h=r);return h},_chooseSplitAxis:function(t,e,i){var r=t.leaf?this.compareMinX:Kde,s=t.leaf?this.compareMinY:Qde;this._allDistMargin(t,e,i,r)<this._allDistMargin(t,e,i,s)&&t.children.sort(r)},_allDistMargin:function(t,e,i,r){t.children.sort(r);var s,n,o=this.toBBox,a=PI(t,0,e,o),l=PI(t,i-e,i,o),c=FN(a)+FN(l);for(s=e;s<i-e;s++)n=t.children[s],DI(a,t.leaf?o(n):n),c+=FN(a);for(s=i-e-1;s>=e;s--)n=t.children[s],DI(l,t.leaf?o(n):n),c+=FN(l);return c},_adjustParentBBoxes:function(t,e,i){for(var r=i;r>=0;r--)DI(e[r],t)},_condense:function(t){for(var e,i=t.length-1;i>=0;i--)t[i].children.length===0?i>0?(e=t[i-1].children).splice(e.indexOf(t[i]),1):this.clear():PT(t[i],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};function Ast(t,{timeZone:e,timeExtent:i}){return{$view:{scale:t,timeZone:e,timeProperties:{currentStart:i==null?void 0:i.start,currentEnd:i==null?void 0:i.end}}}}let tpe=class UOe{constructor(e,i){this.key=new og(0,0,0,0),this.bounds=si(),this.objectIds=new Set,this.key.set(i);const r=e.getLODInfoAt(this.key);this.tileInfoView=e,this.tileInfoView.getTileBounds(this.bounds,this.key,!0),this.resolution=r.resolution,this.level=r.level,this.scale=r.scale,this.minScale=e.zoomToScale(r.level-1),this.maxScale=e.zoomToScale(r.level+1)}get lod(){return this.tileInfoView.getLODInfoAt(this.key)}get id(){return this.key.id}get extent(){return GD(this.bounds,this.tileInfoView.tileInfo.spatialReference)}get transform(){return{originPosition:"upperLeft",scale:[this.resolution,this.resolution],translate:[this.bounds[0],this.bounds[3]]}}createArcadeEvaluationOptions(e){return Ast(this.scale,e)}createChildTiles(){const e=this.key.getChildKeys(),i=sc.acquire();for(let r=0;r<e.length;r++)i[r]=new UOe(this.tileInfoView,e[r]);return i}getQuantizationParameters(){return lMe.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})}};const Mw={added:[],removed:[]},P8=new Set,Mst=new og(0,0,0,0);function Ost(t,e){const i=hc(e);if(!i)return null;const[r,s]=i.valid;return t[2]>s?[si([t[0],t[1],s,t[3]]),si([r,t[1],r+t[2]-s,t[3]])]:t[0]<r?[si([r,t[1],t[2],t[3]]),si([s-(r-t[0]),t[1],s,t[3]])]:null}let Ist=class extends Ss{constructor(e){super(),this._tiles=new Map,this._index=oB(9,X("esri-csp-restrictions")?i=>({minX:i.bounds[0],minY:i.bounds[1],maxX:i.bounds[2],maxY:i.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this.tiles=[],this.tileScheme=e}destroy(){this.clear()}clear(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}has(e){return this._tiles.has(e)}get(e){return this._tiles.get(e)}getIntersectingTiles(e){if(!e||Jo(e)===0||El(e)===0)return[];const i=Ost(e,this.tileScheme.spatialReference);return i!=null?[...new Set([...this.boundsIntersections(i[0]),...this.boundsIntersections(i[1])])]:this.boundsIntersections(e)}boundsIntersections(e){return this._index.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]})}updateTiles(e){const i={added:[],removed:[]};for(const r of e.added)if(!this.has(r)){const s=new tpe(this.tileScheme,r);this._tiles.set(r,s),this._index.insert(s),i.added.push(s)}for(const r of e.removed)if(this.has(r)){const s=this.get(r);this._tiles.delete(r),this._index.remove(s),i.removed.push(s)}this.tiles.length=0,this._tiles.forEach(r=>this.tiles.push(r)),(i.added.length||i.removed.length)&&this.emit("update",i)}setViewState(e){const i=this.tileScheme.getTileCoverage(e,0);if(!i)return;const{spans:r,lodInfo:s}=i,{level:n}=s;if(r.length>0)for(const{row:o,colFrom:a,colTo:l}of r)for(let c=a;c<=l;c++){const h=Mst.set(n,o,s.normalizeCol(c),s.getWorldForColumn(c)).id;if(P8.add(h),!this.has(h)){const d=new tpe(this.tileScheme,h);this._tiles.set(h,d),this._index.insert(d),this.tiles.push(d),Mw.added.push(d)}}for(let o=this.tiles.length-1;o>=0;o--){const a=this.tiles[o];P8.has(a.id)||(this._tiles.delete(a.id),this.tiles.splice(o,1),this._index.remove(a),Mw.removed.push(a))}(Mw.added.length||Mw.removed.length)&&this.emit("update",Mw),I3.pool.release(i),P8.clear(),Mw.added.length=0,Mw.removed.length=0}};const WZt=1e-30,ipe=512,zN=16777216,ZZt=8,YZt=29,JZt=24,XZt=4,KZt=0,QZt=0,eYt=0,tYt=1,iYt=2,rYt=3,sYt=4,nYt=5,oYt=6,aYt=12,lYt=13,cYt=5,Rst=6,uYt=5,hYt=6;var rpe;(function(t){t[t.FilterFlags=0]="FilterFlags",t[t.Animation=1]="Animation",t[t.GPGPU=2]="GPGPU",t[t.VV=3]="VV",t[t.DD0=4]="DD0",t[t.DD1=5]="DD1",t[t.DD2=6]="DD2",t[t.LocalTimeOrigin=7]="LocalTimeOrigin"})(rpe||(rpe={}));const BOe=6,Pst=1<<BOe,dYt=Pst<<1,pYt=1.05,fYt=3,mYt=1,gYt=3,yYt=3,vYt=5,_Yt=6,bYt=1.15,Dst=4,wYt=128,Lst=256,xYt=Lst-2*Dst,SYt=2,TYt=128,EYt=1,CYt=10,$Yt=1024,AYt=128,MYt=4,OYt=1,IYt=1<<20,RYt=.75,PYt=10,DYt=.75,LYt=256,NYt=32,FYt=512,kYt=0,zYt=1,Nst=1,UYt=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],BYt=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],ZM=256;var Mi,Gi,Bt,Sv,ht,eh,cA,ki,Ui,tr,gi,ar,ns,Tt,rt,Xa,ga,Js,Zu,za;(function(t){t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL",t[t.COLOR=16384]="COLOR"})(Mi||(Mi={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Gi||(Gi={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(Bt||(Bt={})),function(t){t[t.ADD=32774]="ADD",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(Sv||(Sv={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER"}(ht||(ht={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(eh||(eh={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(cA||(cA={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.HALF_FLOAT=5131]="HALF_FLOAT"}(ki||(ki={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(Ui||(Ui={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(tr||(tr={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(gi||(gi={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(ar||(ar={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(ns||(ns={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(Tt||(Tt={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(rt||(rt={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(Xa||(Xa={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(ga||(ga={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(Js||(Js={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(Zu||(Zu={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(za||(za={}));const D8=33984;var Ws,nr,Ga;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.TransformFeedback=7]="TransformFeedback",t[t.Sync=8]="Sync",t[t.UNCOUNTED=9]="UNCOUNTED",t[t.LinesOfCode=9]="LinesOfCode",t[t.Uniform=10]="Uniform",t[t.COUNT=11]="COUNT"})(Ws||(Ws={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(nr||(nr={})),function(t){t[t.NONE=0]="NONE",t[t.BACK=1029]="BACK"}(Ga||(Ga={}));const CS=33306;var bs,spe,npe,ope,aB,NJ,ape;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(bs||(bs={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(spe||(spe={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(npe||(npe={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(ope||(ope={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(aB||(aB={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(NJ||(NJ={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(ape||(ape={}));const Fst=()=>J.getLogger("esri.views.webgl.checkWebGLError");function kst(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const lB=!!X("enable-feature:webgl-debug");function Np(){return lB}function FJ(){return lB}function nd(t){if(Np()){const e=t.getError();if(e){const i=kst(t,e),r=new Error().stack;Fst().error(new U("webgl-error","WebGL error occurred",{message:i,stack:r}))}}}var Tv;(function(t){t[t.Texture=0]="Texture",t[t.RenderBuffer=1]="RenderBuffer"})(Tv||(Tv={}));function zst(t){switch(t){case ki.BYTE:case ki.UNSIGNED_BYTE:return 1;case ki.SHORT:case ki.UNSIGNED_SHORT:case ki.HALF_FLOAT:return 2;case ki.FLOAT:case ki.INT:case ki.UNSIGNED_INT:return 4}}function VOe(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function uA(t,e){var i;return(((i=t.vertexBuffers.get(e))==null?void 0:i.usedMemory)??0)/Ust(t.layout.get(e))}function Ust(t){return t[0].stride}function jOe(t,e,i,r,s=0){var o;const n=t.gl;t.bindBuffer(i);for(const a of r){const l=e.get(a.name);if(l==null){console.warn(`There is no location for vertex attribute '${a.name}' defined.`);continue}const c=s*a.stride;if(a.count<=4)n.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),n.enableVertexAttribArray(l),a.divisor>0&&t.gl.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let h=0;h<3;h++)n.vertexAttribPointer(l+h,3,a.type,a.normalized,a.stride,a.offset+12*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&t.gl.vertexAttribDivisor(l+h,a.divisor);else if(a.count===16)for(let h=0;h<4;h++)n.vertexAttribPointer(l+h,4,a.type,a.normalized,a.stride,a.offset+16*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&((o=t.gl)==null||o.vertexAttribDivisor(l+h,a.divisor));else console.error("Unsupported vertex attribute element count: "+a.count);if(Np()){const h=VOe(t),d=zst(a.type),f=a.offset,m=Math.round(d/f)!==d/f?`. Offset not a multiple of stride. DataType requires ${d} bytes, but descriptor has an offset of ${f}`:"";h&&console.error(`Unable to bind vertex attribute "${a.name}" with baseInstanceOffset ${c}${m}:`,h,a)}}}function Bst(t,e,i,r){var n,o,a;const s=t.gl;t.bindBuffer(i);for(const l of r){const c=e.get(l.name);if(l.count<=4)s.disableVertexAttribArray(c),l.divisor&&l.divisor>0&&((n=t.gl)==null||n.vertexAttribDivisor(c,0));else if(l.count===9)for(let h=0;h<3;h++)s.disableVertexAttribArray(c+h),l.divisor&&l.divisor>0&&((o=t.gl)==null||o.vertexAttribDivisor(c+h,0));else if(l.count===16)for(let h=0;h<4;h++)s.disableVertexAttribArray(c+h),l.divisor&&l.divisor>0&&((a=t.gl)==null||a.vertexAttribDivisor(c+h,0));else console.error("Unsupported vertex attribute element count: "+l.count)}t.unbindBuffer(ht.ARRAY_BUFFER)}function _se(t){switch(t){case Tt.ALPHA:case Tt.LUMINANCE:case Tt.RED:case Tt.RED_INTEGER:case rt.R8:case rt.R8I:case rt.R8UI:case rt.R8_SNORM:case ga.STENCIL_INDEX8:return 1;case Tt.LUMINANCE_ALPHA:case Tt.RG:case Tt.RG_INTEGER:case rt.RGBA4:case rt.R16F:case rt.R16I:case rt.R16UI:case rt.RG8:case rt.RG8I:case rt.RG8UI:case rt.RG8_SNORM:case rt.RGB565:case rt.RGB5_A1:case ga.DEPTH_COMPONENT16:return 2;case Tt.DEPTH_COMPONENT:case Tt.RGB:case Tt.RGB_INTEGER:case rt.RGB8:case rt.RGB8I:case rt.RGB8UI:case rt.RGB8_SNORM:case rt.SRGB8:case ga.DEPTH_COMPONENT24:return 3;case Tt.DEPTH_STENCIL:case Tt.DEPTH24_STENCIL8:case Tt.RGBA:case Tt.RGBA_INTEGER:case rt.RGBA8:case rt.R32F:case rt.R11F_G11F_B10F:case rt.RG16F:case rt.R32I:case rt.R32UI:case rt.RG16I:case rt.RG16UI:case rt.RGBA8I:case rt.RGBA8UI:case rt.RGBA8_SNORM:case rt.SRGB8_ALPHA8:case rt.RGB9_E5:case rt.RGB10_A2UI:case rt.RGB10_A2:case ga.DEPTH_STENCIL:case ga.DEPTH_COMPONENT32F:case ga.DEPTH24_STENCIL8:return 4;case ga.DEPTH32F_STENCIL8:return 5;case rt.RGB16F:case rt.RGB16I:case rt.RGB16UI:return 6;case rt.RG32F:case rt.RG32I:case rt.RG32UI:case rt.RGBA16F:case rt.RGBA16I:case rt.RGBA16UI:return 8;case rt.RGB32F:case rt.RGB32I:case rt.RGB32UI:return 12;case rt.RGBA32F:case rt.RGBA32I:case rt.RGBA32UI:return 16;case bs.COMPRESSED_RGB_S3TC_DXT1_EXT:case bs.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case bs.COMPRESSED_RGBA_S3TC_DXT3_EXT:case bs.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case bs.COMPRESSED_R11_EAC:case bs.COMPRESSED_SIGNED_R11_EAC:case bs.COMPRESSED_RGB8_ETC2:case bs.COMPRESSED_SRGB8_ETC2:case bs.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case bs.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case bs.COMPRESSED_RG11_EAC:case bs.COMPRESSED_SIGNED_RG11_EAC:case bs.COMPRESSED_RGBA8_ETC2_EAC:case bs.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}let Ar=class{constructor(e=0,i=e){this.width=e,this.height=i,this.target=ns.TEXTURE_2D,this.pixelFormat=Tt.RGBA,this.dataType=Xa.UNSIGNED_BYTE,this.samplingMode=gi.LINEAR,this.wrapMode=ar.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.shouldCompress=!1,this.depth=1,this.isImmutable=!1}};function Vst(t){return t.width<=0||t.height<=0?0:Math.round(t.width*t.height*t.depth*(t.hasMipmap?4/3:1)*(t.internalFormat==null?4:_se(t.internalFormat))*(t.target===ns.TEXTURE_CUBE_MAP?6:1))}const jst=()=>J.getLogger("esri/views/webgl/textureUtils");function UN(t){(t.width!=null&&t.width<0||t.height!=null&&t.height<0||t.depth!=null&&t.depth<0)&&jst().error("Negative dimension parameters are not allowed!")}function Gst(t){return t in rt}function GOe(t){return t in bs}function XE(t){return t!=null&&"type"in t&&t.type==="compressed"}function Hst(t){return!!t.descriptor.internalFormat&&GOe(t.descriptor.internalFormat)}function qst(t){return t!=null&&"byteLength"in t}function lpe(t){return t!=null&&!XE(t)&&!qst(t)}function DT(t){return t===ns.TEXTURE_3D||t===ns.TEXTURE_2D_ARRAY}function cpe(t,e,i,r=1){let s=Math.max(e,i);return t===ns.TEXTURE_3D&&(s=Math.max(s,r)),Math.floor(Math.log2(s))+1}function BN(t){if(t.internalFormat!=null)return t.internalFormat===Tt.DEPTH_STENCIL?Tt.DEPTH24_STENCIL8:t.internalFormat;switch(t.dataType){case Xa.FLOAT:switch(t.pixelFormat){case Tt.RGBA:return rt.RGBA32F;case Tt.RGB:return rt.RGB32F;default:throw new U("Unable to derive format")}case Xa.UNSIGNED_BYTE:switch(t.pixelFormat){case Tt.RGBA:return rt.RGBA8;case Tt.RGB:return rt.RGB8}}return t.internalFormat=t.pixelFormat===Tt.DEPTH_STENCIL?Tt.DEPTH24_STENCIL8:t.pixelFormat}function Wst(t){let e="width"in t?t.width:t.codedWidth,i="height"in t?t.height:t.codedHeight;return t instanceof HTMLVideoElement&&(e=t.videoWidth,i=t.videoHeight),{width:e,height:i,depth:1}}let Zst=class HOe extends Ar{constructor(e,i){switch(super(),this.context=e,Object.assign(this,i),this.internalFormat){case rt.R16F:case rt.R16I:case rt.R16UI:case rt.R32F:case rt.R32I:case rt.R32UI:case rt.R8_SNORM:case rt.R8:case rt.R8I:case rt.R8UI:this.pixelFormat=Tt.RED}}static validate(e,i){return new HOe(e,i)}};const p0=()=>J.getLogger("esri/views/webgl/Texture");let pi=class Vl{constructor(e,i=null,r=null){if(this.type=Tv.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,this._compressionAbortController=Ta(null),"context"in e)this._descriptor=e,r=i;else{const s=Zst.validate(e,i);if(!s)throw new U("Texture descriptor invalid");this._descriptor=s}this._descriptor.target===ns.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return Vst(this._descriptor)}get cachedMemory(){return this.usedMemory}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}get isCompressing(){return this._compressionAbortController.value!==null}dispose(){this.abortCompression(),this._glName&&this._descriptor.context.instanceCounter.decrement(Ws.Texture,this),this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(e,i){const r=this._descriptor;if(r.width!==e||r.height!==i){if(this._wasImmutablyAllocated)throw new U("Immutable textures can't be resized!");r.width=e,r.height=i,this._descriptor.target===ns.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}enableCompression(e){this._descriptor.shouldCompress=e}setData(e){this.abortCompression(),!XE(e)&&this._descriptor.internalFormat&&this._descriptor.internalFormat in bs&&(this._descriptor.internalFormat=void 0),this._setData(e),!XE(e)&&this._descriptor.shouldCompress&&this._compressOnWorker(e)}updateData(e,i,r,s,n,o,a=0){o||p0().error("An attempt to use uninitialized data!"),this._glName||p0().error("An attempt to update uninitialized texture!");const l=this._descriptor;l.internalFormat=BN(l);const{context:c,pixelFormat:h,dataType:d,target:f,isImmutable:m}=l;if(m&&!this._wasImmutablyAllocated)throw new U("Cannot update immutable texture before allocation!");const g=c.bindTexture(this,Vl.TEXTURE_UNIT_FOR_UPDATES,!0);(i<0||r<0||i+s>l.width||r+n>l.height)&&p0().error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:v}=c;a&&(s&&n||p0().warn("Must pass width and height if `UNPACK_SKIP_ROWS` is used"),v.pixelStorei(v.UNPACK_SKIP_ROWS,a)),lpe(o)?v.texSubImage2D(f,e,i,r,s,n,h,d,o):XE(o)?v.compressedTexSubImage2D(f,e,i,r,s,n,l.internalFormat,o.levels[e]):v.texSubImage2D(f,e,i,r,s,n,h,d,o),a&&v.pixelStorei(v.UNPACK_SKIP_ROWS,0),c.bindTexture(g,Vl.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,i,r,s,n,o,a,l){l||p0().error("An attempt to use uninitialized data!"),this._glName||p0().error("An attempt to update an uninitialized texture!");const c=this._descriptor;c.internalFormat=BN(c);const{context:h,pixelFormat:d,dataType:f,isImmutable:m,target:g}=c;if(m&&!this._wasImmutablyAllocated)throw new U("Cannot update immutable texture before allocation!");DT(g)||p0().warn("Attempting to set 3D texture data on a non-3D texture");const v=h.bindTexture(this,Vl.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(Vl.TEXTURE_UNIT_FOR_UPDATES),(i<0||r<0||s<0||i+n>c.width||r+o>c.height||s+a>c.depth)&&p0().error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:_}=h;if(XE(l))l=l.levels[e],_.compressedTexSubImage3D(g,e,i,r,s,n,o,a,c.internalFormat,l);else{const b=l;_.texSubImage3D(g,e,i,r,s,n,o,a,d,f,b)}h.bindTexture(v,Vl.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(e.width===0||e.height===0)return;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new U("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,UN(e)}e.samplingMode===gi.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=gi.LINEAR_MIPMAP_NEAREST):e.samplingMode===gi.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=gi.NEAREST_MIPMAP_NEAREST);const i=this._descriptor.context.bindTexture(this,Vl.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Vl.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(i,Vl.TEXTURE_UNIT_FOR_UPDATES)}clearMipmap(){const e=this._descriptor;if(e.hasMipmap){if(this._wasImmutablyAllocated)throw new U("Cannot delete mipmaps to immutable texture after allocation");e.hasMipmap=!1,this._samplingModeDirty=!0,UN(e)}e.samplingMode===gi.LINEAR_MIPMAP_NEAREST?(this._samplingModeDirty=!0,e.samplingMode=gi.LINEAR):e.samplingMode===gi.NEAREST_MIPMAP_NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=gi.NEAREST)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,UN(this._descriptor),this._wrapModeDirty=!0)}applyChanges(){this._samplingModeDirty&&(this._applySamplingMode(),this._samplingModeDirty=!1),this._wrapModeDirty&&(this._applyWrapMode(),this._wrapModeDirty=!1)}abortCompression(){this.isCompressing&&(this._compressionAbortController.value=fc(this._compressionAbortController.value))}_setData(e,i){var l;const r=this._descriptor,s=(l=r.context)==null?void 0:l.gl;if(!s)return;nd(s),this._glName||(this._glName=s.createTexture(),this._glName&&r.context.instanceCounter.increment(Ws.Texture,this)),UN(r);const n=r.context.bindTexture(this,Vl.TEXTURE_UNIT_FOR_UPDATES);r.context.setActiveTexture(Vl.TEXTURE_UNIT_FOR_UPDATES),this._configurePixelStorage(),nd(s);const o=i??r.target,a=DT(o);if(lpe(e))this._setDataFromTexImageSource(e,o);else{const{width:c,height:h,depth:d}=r;if(c==null||h==null)throw new U("Width and height must be specified!");if(a&&d==null)throw new U("Depth must be specified!");if(r.internalFormat=BN(r),r.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(o,r.internalFormat,r.hasMipmap,c,h,d),XE(e)){if(!GOe(r.internalFormat))throw new U("Attempting to use compressed data with an uncompressed format!");this._setDataFromCompressedSource(e,r.internalFormat,o)}else this._texImage(o,0,r.internalFormat,c,h,d,e),nd(s),r.hasMipmap&&this.generateMipmap()}this._applySamplingMode(),this._applyWrapMode(),this._applyAnisotropicFilteringParameters(),nd(s),r.context.bindTexture(n,Vl.TEXTURE_UNIT_FOR_UPDATES)}_setDataCubeMap(e=null){for(let i=ns.TEXTURE_CUBE_MAP_POSITIVE_X;i<=ns.TEXTURE_CUBE_MAP_NEGATIVE_Z;i++)this._setData(e,i)}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:i,flipped:r,preMultiplyAlpha:s}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,i),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_setDataFromTexImageSource(e,i){const{gl:r}=this._descriptor.context,s=this._descriptor;s.internalFormat=BN(s);const n=DT(i),{width:o,height:a,depth:l}=Wst(e);s.width&&s.height,s.width||(s.width=o),s.height||(s.height=a),n&&s.depth,n&&(s.depth=l),s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(i,s.internalFormat,s.hasMipmap,o,a,l),this._texImage(i,0,s.internalFormat,o,a,l,e),nd(r),s.hasMipmap&&(this.generateMipmap(),nd(r))}_setDataFromCompressedSource(e,i,r){const s=this._descriptor,{width:n,height:o,depth:a}=s,l=e.levels,c=cpe(r,n,o,a),h=Math.min(c,l.length)-1;this._descriptor.context.gl.texParameteri(s.target,s.context.gl.TEXTURE_MAX_LEVEL,h),this._forEachMipmapLevel((d,f,m,g)=>{const v=l[Math.min(d,l.length-1)];this._compressedTexImage(r,d,i,f,m,g,v)},h)}_texStorage(e,i,r,s,n,o){const{gl:a}=this._descriptor.context;if(!Gst(i))throw new U("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=r?cpe(e,s,n,o):1;if(DT(e)){if(o==null)throw new U("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,i,s,n,o)}else a.texStorage2D(e,l,i,s,n);this._wasImmutablyAllocated=!0}_texImage(e,i,r,s,n,o,a){const l=this._descriptor.context.gl,c=DT(e),{isImmutable:h,pixelFormat:d,dataType:f}=this._descriptor;if(h){if(a!=null){const m=a;if(c){if(o==null)throw new U("Missing depth dimension for 3D texture upload");l.texSubImage3D(e,i,0,0,0,s,n,o,d,f,m)}else l.texSubImage2D(e,i,0,0,s,n,d,f,m)}}else{const m=a;if(c){if(o==null)throw new U("Missing depth dimension for 3D texture upload");l.texImage3D(e,i,r,s,n,o,0,d,f,m)}else l.texImage2D(e,i,r,s,n,0,d,f,m)}}_compressedTexImage(e,i,r,s,n,o,a){const l=this._descriptor.context.gl,c=DT(e);if(this._descriptor.isImmutable){if(a!=null)if(c){if(o==null)throw new U("Missing depth dimension for 3D texture upload");l.compressedTexSubImage3D(e,i,0,0,0,s,n,o,r,a)}else l.compressedTexSubImage2D(e,i,0,0,s,n,r,a)}else if(c){if(o==null)throw new U("Missing depth dimension for 3D texture upload");l.compressedTexImage3D(e,i,r,s,n,o,0,a)}else l.compressedTexImage2D(e,i,r,s,n,0,a)}async _compressOnWorker(e){var s,n;if(!Vl.compressionWorkerHandle||!Vl.compressionWorkerHandle.isCompressible(e))return;const i=(s=this._descriptor.context)==null?void 0:s.gl.getExtension("WEBGL_compressed_texture_etc"),r=(n=this._descriptor.context)==null?void 0:n.gl.getExtension("WEBGL_compressed_texture_s3tc");if(i||r){const o=new AbortController;this._compressionAbortController.value=o;const a={data:await createImageBitmap(e),flipped:this.descriptor.flipped,width:e.width,height:e.height,hasMipmap:this._descriptor.hasMipmap,hasETC:!!i,hasS3TC:!!r};Vl.compressionWorkerHandle.invoke(a,this._compressionAbortController.value.signal).then(l=>{l&&this.isCompressing&&this.glName&&(this._descriptor.internalFormat=l.internalFormat,this._setData(l.compressedTexture)),o===this._compressionAbortController.value&&(this._compressionAbortController.value=null)}).catch(l=>{es(l)||o!==this._compressionAbortController.value||(this._compressionAbortController.value=null)})}}_forEachMipmapLevel(e,i=1/0){let{width:r,height:s,depth:n,hasMipmap:o,target:a}=this._descriptor;const l=a===ns.TEXTURE_3D;if(r==null||s==null||l&&n==null)throw new U("Missing texture dimensions for mipmap calculation");for(let c=0;e(c,r,s,n),o&&(r!==1||s!==1||l&&n!==1)&&!(c>=i);++c)r=Math.max(1,r>>1),s=Math.max(1,s>>1),l&&(n=Math.max(1,n>>1))}_applySamplingMode(){var n;const e=this._descriptor,i=(n=e.context)==null?void 0:n.gl;let r=e.samplingMode,s=e.samplingMode;r===gi.LINEAR_MIPMAP_NEAREST||r===gi.LINEAR_MIPMAP_LINEAR?(r=gi.LINEAR,e.hasMipmap||(s=gi.LINEAR)):r!==gi.NEAREST_MIPMAP_NEAREST&&r!==gi.NEAREST_MIPMAP_LINEAR||(r=gi.NEAREST,e.hasMipmap||(s=gi.NEAREST)),i.texParameteri(e.target,i.TEXTURE_MAG_FILTER,r),i.texParameteri(e.target,i.TEXTURE_MIN_FILTER,s)}_applyWrapMode(){var r;const e=this._descriptor,i=(r=e.context)==null?void 0:r.gl;typeof e.wrapMode=="number"?(i.texParameteri(e.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(e.target,i.TEXTURE_WRAP_T,e.wrapMode)):(i.texParameteri(e.target,i.TEXTURE_WRAP_S,e.wrapMode.s),i.texParameteri(e.target,i.TEXTURE_WRAP_T,e.wrapMode.t))}_applyAnisotropicFilteringParameters(){const e=this._descriptor,i=e.context.capabilities.textureFilterAnisotropic;i&&e.context.gl.texParameterf(e.target,i.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}};pi.TEXTURE_UNIT_FOR_UPDATES=0,pi.compressionWorkerHandle=null;const L8=()=>J.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient");function Yst(t,e){e.fillColor[0]=t.color.r/255,e.fillColor[1]=t.color.g/255,e.fillColor[2]=t.color.b/255,e.fillColor[3]=t.color.a,t.haloColor?(e.outlineColor[0]=t.haloColor.r/255,e.outlineColor[1]=t.haloColor.g/255,e.outlineColor[2]=t.haloColor.b/255,e.outlineColor[3]=t.haloColor.a):(e.outlineColor[0]=e.fillColor[0],e.outlineColor[1]=e.fillColor[1],e.outlineColor[2]=e.fillColor[2],e.outlineColor[3]=e.fillColor[3]),e.fillColor[3]*=t.fillOpacity,e.outlineColor[3]*=t.haloOpacity,e.fillColor[0]*=e.fillColor[3],e.fillColor[1]*=e.fillColor[3],e.fillColor[2]*=e.fillColor[3],e.outlineColor[0]*=e.outlineColor[3],e.outlineColor[1]*=e.outlineColor[3],e.outlineColor[2]*=e.outlineColor[3],e.outlineWidth=(1-t.haloBlur)*t.haloWidth,e.outerHaloWidth=t.haloBlur*t.haloWidth/2,e.innerHaloWidth=t.haloBlur*t.haloWidth/2,e.outlinePosition=0}const Jst=[0,0,0,0];let qOe=class{constructor(){this.type="single",this._highlightOptions=new Gm,this._convertedHighlightOptions={fillColor:[0,0,0,0],outlineColor:[0,0,0,0],outlinePosition:0,outlineWidth:0,innerHaloWidth:0,outerHaloWidth:0},this._optionsShadeTexKey="",this._texelData=new Uint8Array(4*ZM),this._minMaxDistance=[0,0]}setHighlightOptions(e){this._highlightOptions=e}applyHighlightOptions(e,i){this._updateGradientTexture(e),e.bindTexture(this._shadeTex,Rst),i.setUniform2fv("u_minMaxDistance",this._minMaxDistance)}destroy(){var e;(e=this._shadeTex)==null||e.dispose(),this._shadeTex=null}getReasonsWithGradients(){return[{activeReasons:(1<<BOe)-1,activeGradient:this}]}_updateGradientTexture(e){const i=Xst(this._highlightOptions);if(i===this._optionsShadeTexKey)return;this._optionsShadeTexKey=i,Yst(this._highlightOptions,this._convertedHighlightOptions);const r=this._convertedHighlightOptions,s=r.outlinePosition-r.outlineWidth/2-r.outerHaloWidth,n=r.outlinePosition-r.outlineWidth/2,o=r.outlinePosition+r.outlineWidth/2,a=r.outlinePosition+r.outlineWidth/2+r.innerHaloWidth,l=Math.sqrt(Math.PI/2)*Nst,c=Math.abs(s)>l?Math.round(10*(Math.abs(s)-l))/10:0,h=Math.abs(a)>l?Math.round(10*(Math.abs(a)-l))/10:0;let d;c&&!h?L8().error("The outer rim of the highlight is "+c+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!c&&h?L8().error("The inner rim of the highlight is "+h+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):c&&h&&L8().error("The highlight is "+Math.max(c,h)+"px away from the edge of the feature; consider reducing some width values.");const f=[void 0,void 0,void 0,void 0];function m(v,_,b){f[0]=(1-b)*v[0]+b*_[0],f[1]=(1-b)*v[1]+b*_[1],f[2]=(1-b)*v[2]+b*_[2],f[3]=(1-b)*v[3]+b*_[3]}const{_texelData:g}=this;for(let v=0;v<ZM;++v)d=s+v/(ZM-1)*(a-s),d<s?(f[0]=0,f[1]=0,f[2]=0,f[3]=0):d<n?m(Jst,r.outlineColor,(d-s)/(n-s)):d<o?[f[0],f[1],f[2],f[3]]=r.outlineColor:d<a?m(r.outlineColor,r.fillColor,(d-o)/(a-o)):[f[0],f[1],f[2],f[3]]=r.fillColor,g[4*v]=255*f[0],g[4*v+1]=255*f[1],g[4*v+2]=255*f[2],g[4*v+3]=255*f[3];if(this._minMaxDistance[0]=s,this._minMaxDistance[1]=a,!this._shadeTex){const v=new Ar;v.wrapMode=ar.CLAMP_TO_EDGE,v.width=ZM,v.height=1,this._shadeTex=new pi(e,v)}this._shadeTex.updateData(0,0,0,ZM,1,this._texelData)}};function Xst(t){return`${t.color};${t.haloColor};${t.haloOpacity};${t.fillOpacity};${t.haloWidth};${t.haloBlur}`}let Kst=class{constructor(){this.type="multi",this.gradients=[]}setHighlightOptions(e){for(let i=0;i<e.length;i++)this.gradients[i]||(this.gradients[i]=new qOe),this.gradients[i].setHighlightOptions(e[i]);for(let i=e.length+1;i<this.gradients.length;i++)this.gradients[i].destroy();this.gradients.length=e.length}destroy(){for(const e of this.gradients)e.destroy()}getReasonsWithGradients(){let e=1;const i=[];for(let r=0;r<this.gradients.length;r++){const s=this.gradients[r];i.push({activeReasons:e,activeGradient:s}),e<<=1}return i}};var upe,hpe,dpe,ppe,fpe,mpe,cB,gpe,ype;(function(t){t[t.FILL=0]="FILL",t[t.LINE=1]="LINE",t[t.MARKER=2]="MARKER",t[t.TEXT=3]="TEXT",t[t.LABEL=4]="LABEL"})(upe||(upe={})),function(t){t[t.NONE=0]="NONE",t[t.MAP=1]="MAP",t[t.LABEL=2]="LABEL",t[t.LABEL_ALPHA=4]="LABEL_ALPHA",t[t.HITTEST=8]="HITTEST",t[t.HIGHLIGHT=16]="HIGHLIGHT",t[t.CLIP=32]="CLIP",t[t.DEBUG=64]="DEBUG",t[t.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES"}(hpe||(hpe={})),function(t){t[t.SIZE=0]="SIZE",t[t.COLOR=1]="COLOR",t[t.OPACITY=2]="OPACITY",t[t.ROTATION=3]="ROTATION"}(dpe||(dpe={})),function(t){t[t.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE",t[t.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE",t[t.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE",t[t.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"}(ppe||(ppe={})),function(t){t[t.SPRITE=0]="SPRITE",t[t.GLYPH=1]="GLYPH"}(fpe||(fpe={})),function(t){t[t.DEFAULT=0]="DEFAULT",t[t.SIMPLE=1]="SIMPLE",t[t.DOT_DENSITY=2]="DOT_DENSITY",t[t.OUTLINE_FILL=3]="OUTLINE_FILL",t[t.OUTLINE_FILL_SIMPLE=4]="OUTLINE_FILL_SIMPLE",t[t.HEATMAP=5]="HEATMAP",t[t.PIE_CHART=6]="PIE_CHART"}(mpe||(mpe={})),function(t){t[t.All=0]="All",t[t.Highlight=1]="Highlight",t[t.InsideEffect=2]="InsideEffect",t[t.OutsideEffect=3]="OutsideEffect"}(cB||(cB={})),function(t){t[t.BATCHING=0]="BATCHING",t[t.STRICT_ORDER=1]="STRICT_ORDER",t[t.STRICT_MARKERS_AND_TEXT=2]="STRICT_MARKERS_AND_TEXT"}(gpe||(gpe={})),function(t){t[t.FILL=0]="FILL",t[t.LINE=1]="LINE",t[t.MARKER=2]="MARKER",t[t.TEXT=3]="TEXT"}(ype||(ype={}));const WOe={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:{write:!1,test:{ref:t=>t.stencilRef,compare:Ui.EQUAL,mask:255,op:{fail:tr.KEEP,zFail:tr.KEEP,zPass:tr.REPLACE}}}},Qst={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:!1},ent={...WOe,color:{write:[!0,!0,!0,!0],blendMode:"delete"}};function tnt({pixelRatio:t,state:e,displayLevel:i,requiredLevel:r},s){const n=1/2**(i-s.key.level),o=1/2**(r-s.key.level);return{displayMat3:e.displayMat3,displayViewMat3:e.displayViewMat3,displayViewScreenMat3:s.transforms.displayViewScreenMat3,viewMat3:e.viewMat3,tileMat3:s.transforms.tileMat3,displayZoomFactor:n,requiredZoomFactor:o,tileOffset:[s.x,s.y],currentScale:e.scale,currentZoom:i,metersPerSRUnit:Mo(e.spatialReference),rotation:e.rotation,pixelRatio:t}}function ZOe(t){var e;return((e=t.passOptions)==null?void 0:e.type)==="highlight"}function YOe(t){var e;return((e=t.passOptions)==null?void 0:e.type)==="hittest"}function int(t){if(!YOe(t))return null;const{position:e,distance:i,smallSymbolDistance:r,smallSymbolSizeThreshold:s}=t.passOptions;return{position:e,distance:i,smallSymbolDistance:r,smallSymbolSizeThreshold:s}}function rnt(t){if(!ZOe(t))return null;const{activeReasons:e,highlightAll:i}=t.passOptions;return{activeReasons:e,highlightAll:i?1:0}}function HYt(t,e,i){const r={};for(const s in i)i[s]instanceof Function?r[s]=i[s](t,e):r[s]=i[s];return r}function qYt(t,e){const{attributeView:i,context:r}=t;return{storage:i.getUniforms(r),view:tnt(t,e),hittestRequest:int(t),highlight:rnt(t)}}function WYt(t){return{inside:t.selection===cB.InsideEffect,outside:t.selection===cB.OutsideEffect}}function snt(t){return YOe(t)?Qst:ZOe(t)&&t.passOptions.stepType==="clear"?ent:WOe}function ZYt(t){const{row:e,col:i}=t.key,r=i*ipe,s=e*ipe;return{tileOffsetFromLocalOrigin:[r%zN,s%zN],maxIntsToLocalOrigin:[Math.floor(r/zN),Math.floor(s/zN)]}}const nnt=new ni({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function YYt(t){return nnt.toJSON(t)}function JYt(t){const{bandCount:e,attributeTable:i,colormap:r,pixelType:s}=t.raster.rasterInfo;return e===1&&(i!=null||r!=null||s==="u8"||s==="s8")}function ont(t,e){return e==null?(t==null||t.destroy(),null):((t==null?void 0:t.type)==="single"&&Array.isArray(e)&&(t.destroy(),t=null),(t==null?void 0:t.type)!=="multi"||Array.isArray(e)||(t.destroy(),t=null),t||(t=Array.isArray(e)?new Kst:new qOe),Array.isArray(e)?t.type==="multi"&&t.setHighlightOptions(e):t.type==="single"&&t.setHighlightOptions(e),t)}function XYt(t,e,i,r){const{painter:s,highlightGradient:n}=t,{highlight:o}=s.effects;if(!n)return;const a=t.passOptions,l=n.getReasonsWithGradients();for(let c=0;c<l.length;c++){const h={...t,passOptions:{type:"highlight",activeGradient:l[c].activeGradient,activeReasons:l[c].activeReasons,stepType:"burn",highlightAll:e}};if(o.bind(h),i(h),c<l.length-1){let f=0;for(let m=c+1;m<l.length;m++)f|=l[m].activeReasons;i({...t,passOptions:{type:"highlight",activeGradient:l[c].activeGradient,activeReasons:f,stepType:"clear",highlightAll:e}})}const d={...t,passOptions:{type:"highlight",activeGradient:l[c].activeGradient,activeReasons:l[c].activeReasons,stepType:"draw",highlightAll:e}};s.setPipelineState(snt(t)),s.updatePipelineState(t.context),o.draw(d),o.unbind()}t.passOptions=a}function KYt(t){if(!t)return[];let e=tXe(t)?[t]:Ce.isCollection(t)?t.toArray():Array.isArray(t)?t:[];return e=e==null?void 0:e.filter(df),((e==null?void 0:e.length)??0)===0?[]:e}const VN=t=>parseFloat(t)/100;function ant(t,e,i){const r=typeof t.left=="string"?VN(t.left)*e:t.left,s=typeof t.right=="string"?VN(t.right)*e:t.right,n=typeof t.top=="string"?VN(t.top)*i:t.top,o=typeof t.bottom=="string"?VN(t.bottom)*i:t.bottom,a=n;return{xmin:r,xmax:Math.max(e-s,r),ymin:a,ymax:Math.max(i-o,n)}}function JOe(t,e,i,r){switch(e.type){case"rect":{const{width:s,height:n}=t,{xmin:o,xmax:a,ymin:l,ymax:c}=ant(e,s,n),{x:h,y:d}=i;return h>o&&h<a&&d>l&&d<c}case"path":return e.path.length===0||!Array.isArray(e.path[0][0])||Lie(e.path,[i.x,i.y]);case"geometry":return e.geometry==null||(e.geometry.type==="polygon"?Die(e.geometry,r):jD(e.geometry,r))}}function lnt(t){if(!t.highlights)return null;const e=t.highlights.findIndex(i=>i.name==="default");return e===-1?null:t.highlights.items[e]}function cnt(t,e){if(!t.highlights){if(!e)return;t.highlights=new Ce([new Gm])}const i=t.highlights.findIndex(r=>r.name==="default");e?t.highlights.items[i].assignFrom(e):(t.highlights.removeAt(i),t.highlights.length===0&&(t.highlights=null))}async function unt(t,e,i){const r=QU(e)?KU(t,e):e;if(!t.ready||isNaN(r.x)||isNaN(r.y))return{screenPoint:r,results:[]};let s=new Set;const n=new Set;let o=!1,a=null,l=null;i!=null&&i.include?_pe(i.include,vpe(t,f=>{s.add(f),N8(f,m=>n.add(m))},(f,m)=>{n.add(f),s.add(m)},f=>{a||(a=new Set),a.add(f)},f=>s.add(f),()=>o=!0)):(o=!0,s=new Set(t.allLayerViews),s.forEach(f=>{N8(f,m=>n.add(m))})),i!=null&&i.exclude&&_pe(i.exclude,vpe(t,f=>{s.delete(f),N8(f,m=>n.delete(m))},f=>n.delete(f),f=>{l||(l=new Set),l.add(f)}));const c=t.toMap(r),h=t.allLayerViews.filter(f=>!f.suspended&&s.has(f)&&f.clips.every(m=>JOe(t,m,r,c))).reverse();let d=[...o?t.graphicsView.hitTest(c).map(f=>({type:"graphic",graphic:f,layer:null,mapPoint:c})):[],...await Promise.all(h.map(f=>f.hitTest(c,r)).toArray())].filter(df).flat().filter(df);return d=d.filter(f=>{var m;return f.type!=="graphic"||((m=f.layer)==null?void 0:m.type)!=="subtype-group"||n.has(f.graphic.layer)}),a&&(d=d.filter(f=>!("graphic"in f)||!f.graphic||(a==null?void 0:a.has(kJ(f.graphic))))),l&&(d=d.filter(f=>!("graphic"in f)||!f.graphic||!(l!=null&&l.has(kJ(f.graphic))))),{screenPoint:r,results:d}}function vpe(t,e,i,r,s,n){return o=>{if(o instanceof Pl){if(o.layer===t)n==null||n();else{const a=t.allLayerViews.find(l=>l.layer===o.layer);a&&(s==null||s(a))}r(kJ(o))}else if(!("layer"in o&&"element"in o))if(o.type==="subtype-sublayer"){const a=t.allLayerViews.find(l=>l.layer===o.parent);a&&i(o,a)}else{const a=t.allLayerViews.find(l=>l.layer===o);a&&e(a)}}}function _pe(t,e){if(t)if(o3(t))for(const i of t)if(o3(i))for(const r of i)e(r);else e(i);else e(t)}function kJ(t){var i,r;const e=t.getObjectId();return e?`${((i=t.layer)==null?void 0:i.uid)??((r=t.sourceLayer)==null?void 0:r.uid)??"MapView"}/${e}`:`"MapView/${t.uid}`}function N8({layer:t},e){(t==null?void 0:t.type)==="subtype-group"&&t.sublayers.forEach(i=>{e(i)})}let YM=null,uB=!0;function c5(t,e,i){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(uB)try{return new ImageData(t,e)}catch{uB=!1}return XOe(t,e,i)}function QYt(t,e,i,r){if(!e||!i)throw new Error("Cannot construct image data without dimensions");if(uB)try{return new ImageData(t,e,i)}catch{uB=!1}const s=XOe(e,i,r);return s.data.set(t,0),s}function hnt(){return YM||(YM=document.createElement("canvas"),YM.width=1,YM.height=1),YM}function XOe(t,e,i){return i||(i=hnt()),i.getContext("2d").createImageData(t,e)}async function dnt(t,e){const i=window.URL.createObjectURL(t);try{const{data:r}=await Ri(i,{...e,responseType:"image"});return r}catch(r){throw es(r)?r:new U("invalid-image",`Could not fetch requested image at ${i}`)}finally{window.URL.revokeObjectURL(i)}}async function eJt(t,e){const{arrayBuffer:i,mediaType:r}=await pnt(t,e),s=r==="image/png";if(r==="image/gif"){const{isAnimatedGIF:n,parseGif:o}=await G(()=>import("./gif-DCBIVu3u.js"),[]);if(n(i))return o(i,e)}if(s){const{isAnimatedPNG:n,parseApng:o}=await G(()=>import("./apng-DWgzepxw.js"),__vite__mapDeps([229,3]));if(n(i))return o(i,e)}return dnt(new Blob([i],{type:r}),e)}async function pnt(t,e){var s;const i=pS(t);if(i!=null&&i.isBase64)return{arrayBuffer:yTe(i.data),mediaType:i.mediaType};const r=await Ri(t,{responseType:"array-buffer",...e});return{arrayBuffer:r.data,mediaType:((s=r.getHeader)==null?void 0:s.call(r,"Content-Type"))??""}}const bpe=2048,fnt=1.5,mnt=8;function KOe(t,e){const{format:i,quality:r,rotation:s,disableDecorations:n}=t||{},o=bse(t,e.padding),a=bnt(t,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:l,height:c}=_nt(t,a),h=aIe(i),d=lIe[h];return{format:h,quality:ue(r??d,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!!(t!=null&&t.ignoreBackground),ignorePadding:!!(t!=null&&t.ignorePadding)}}function gnt(t,e){const i=KOe(t,e),r=i.area,s=i.width/r.width,n=bse(i,e.padding),o=n.left+n.right,a=n.top+n.bottom,l=e.width-o,c=e.height-a,h=Math.floor(l*s+o),d=Math.floor(c*s+a),f=(t==null?void 0:t.layers)??[],m=i.ignoreBackground,g=i.ignorePadding;return{framebufferWidth:h,framebufferHeight:d,region:{x:Math.floor(r.x*s)+n.left,y:Math.floor(r.y*s)+n.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:s,layers:f,disableDecorations:i.disableDecorations,ignoreBackground:m,ignorePadding:g,objectAndLayerIdColor:!1}}function QOe(t,e,i){const{ctx:r,canvas:s}=tIe(t,i),n=r.getImageData(0,0,t.width,t.height),o=rIe(s,e);return iIe(s),{dataUrl:o,data:n}}function eIe(t,e){const{ctx:i,canvas:r}=tIe(t,e),s=i.getImageData(0,0,t.width,t.height);return iIe(r),s}function tIe(t,e){const i=ynt();e.premultipliedAlpha&&Tnt(t),i.width=t.width,i.height=t.height;const r=i.getContext("2d",{willReadFrequently:!0});return r.putImageData(t,0,0),e.flipY&&Snt(r),{ctx:r,canvas:i}}function iIe(t){t.width=0,t.height=0}function ynt(){return F8==null&&(F8=document.createElement("canvas")),F8}let F8=null;function rIe(t,e){const i=Ent[e.format],r=e.quality/100;return t.toDataURL(i,r)}function sIe(t,e){const i=aIe(t),r=lIe[i];return{format:i,quality:ue(e??r,0,100)}}function nIe(t,e){return e/Math.max(t[0],t[1])}function oIe(t,e,i,r=0,s=0,n=t.width-r,o=t.height-s,a=!1){const{data:l}=t,{width:c,height:h,data:d}=e,f=n/c,m=o/h,g=Math.ceil(f/2),v=Math.ceil(m/2),_=t.width;for(let b=0;b<h;b++)for(let w=0;w<c;w++){const x=4*(w+(a?h-b-1:b)*c);let S=0,C=0,T=0,M=0,I=0,D=0;const P=(b+.5)*m;for(let F=Math.floor(b*m);F<(b+1)*m;F++){const L=Math.abs(P-(F+.5))/v,N=(w+.5)*f,R=L*L;for(let k=Math.floor(w*f);k<(w+1)*f;k++){const W=Math.abs(N-(k+.5))/g,j=Math.sqrt(R+W*W);if(j>=1)continue;let B=2*j*j*j-3*j*j+1;const te=4*(r+k+(s+F)*_);D+=B*l[te+3],C+=B,!i&&l[te+3]<255&&(B=B*l[te+3]/255),T+=B*l[te],M+=B*l[te+1],I+=B*l[te+2],S+=B}}d[x]=T/S,d[x+1]=M/S,d[x+2]=I/S,d[x+3]=D/C}return e}function vnt(t,e,i){if(!e)return t;const{framebufferWidth:r,framebufferHeight:s,pixelRatio:n,region:o}=t,a=bse(t,i),l=a.left+a.right,c=a.top+a.bottom,h=r-l,d=s-c,f=Math.min(mnt,Math.min((bpe-l)/h,(bpe-c)/d));return f<fnt?t:{...t,framebufferWidth:Math.round(h*f)+l,framebufferHeight:Math.round(d*f)+c,pixelRatio:n*f,resample:{region:{x:Math.round((o.x-a.left)*f)+a.left,y:Math.round((o.y-a.top)*f)+a.top,width:Math.round(o.width*f),height:Math.round(o.height*f)},width:r,height:s}}}function _nt(t,e){if(!t)return e;const i=t.width,r=t.height;if(i!=null&&r!=null)return{width:Math.floor(i),height:Math.floor(r)};if(i==null&&r==null)return e;const s=e.width/e.height;return r==null?{width:Math.floor(i),height:Math.floor(i/s)}:{width:Math.floor(r*s),height:Math.floor(r)}}function bnt(t,e){const i={x:0,y:0,width:e.width,height:e.height};if(t!=null&&t.area){t.area.x!=null&&(i.x=Math.floor(t.area.x)),t.area.y!=null&&(i.y=Math.floor(t.area.y));const r=t.area.width!=null?Math.floor(t.area.width):null,s=t.area.height!=null?Math.floor(t.area.height):null;if(i.width=e.width-i.x,i.height=e.height-i.y,r!=null&&s!=null)i.width=Math.min(i.width,r),i.height=Math.min(i.height,s);else if(r==null&&s!=null){const n=Math.min(i.width,r);i.height=n/i.width*i.height,i.width=n}else if(r!=null&&s==null){const n=Math.min(i.height,s);i.width=n/i.height*i.width,i.height=n}}return wnt(xnt(i,t),e)}function wnt(t,e){const i=Math.floor(Math.max(t.x,0)),r=Math.floor(Math.max(t.y,0)),s={x:i,y:r,width:Math.floor(Math.min(t.width,e.width-i)),height:Math.floor(Math.min(t.height,e.height-r))},n=s.width/s.height,o=t.width/t.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),h=s.height-c;return{x:s.x,y:Math.floor(s.y+h/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function xnt(t,e){if((e==null?void 0:e.width)==null||e.height==null)return t;const i=e.width/e.height,r=t.width/t.height;if(r===i)return t;if(r<i){const n=Math.floor(t.height*i);return t.x-=(n-t.width)/2,t.width=n,t}const s=Math.floor(t.width/i);return t.y-=(s-t.height)/2,t.height=s,t}function bse(t,e){return!e||t!=null&&t.ignorePadding?$nt:e}function aIe(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return Cnt}}function Snt(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function Tnt(t){const e=t.data,i=e.length;for(let r=0;r<i;r+=4){const s=e[r+3];if(s!==255&&s>0){const n=255/s;e[r]=e[r]*n,e[r+1]=e[r+1]*n,e[r+2]=e[r+2]*n}}}const Ent={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},wpe=98,Cnt="png",lIe={png:100,jpg:wpe,jpeg:wpe},$nt={top:0,right:0,bottom:0,left:0},JM=Object.freeze(Object.defineProperty({__proto__:null,completeUserSettings:KOe,createEmptyImageData:c5,encode:QOe,encodeData:eIe,getFormatAndQuality:sIe,getMaximumResolutionScale:nIe,resampleHermite:oIe,screenshotSuperSampleSettings:vnt,toDataUrl:rIe,toRenderSettings:gnt},Symbol.toStringTag,{value:"Module"})),cIe={flipY:!0,premultipliedAlpha:!0};async function Ant(t,e){const i=await uIe(t,e),{format:r,quality:s}=sIe(e==null?void 0:e.format,e==null?void 0:e.quality);return QOe(i,{format:r,quality:s},cIe)}async function Mnt(t,e){const i=await uIe(t,e);return eIe(i,cIe)}function uIe(t,e){const i=Rnt(e||{},Int(t.stage,t.size),t.size,t.padding),r=Ont(e,t.allLayerViews);return t.stage.takeScreenshot(i,r,t.backgroundColor,e==null?void 0:e.rotation)}function Ont(t={},e){if(!t.layers)return;const i=[];return t.layers.forEach(r=>{const s=e.find(n=>n.layer.id===r.id);s!=null&&s.container&&i.push(s.container)}),i}function Int(t,e){return Math.min(4,nIe(e,Math.min(4096,t.context.parameters.maxTextureSize)))}function Rnt(t,e,i,r){t.ignorePadding&&(r={left:0,right:0,top:0,bottom:0});let s=null;t.width!=null&&t.height!=null?s=[t.width,t.height]:t.width==null&&t.height!=null?s=[t.height,t.height]:t.width!=null&&t.height==null?s=[t.width,t.width]:t.width==null&&t.height==null&&(s=null);const n=i[0]-(r.left+r.right),o=i[1]-(r.top+r.bottom);let a,l,c=t.area||{x:0,y:0,width:n,height:o};if(s){const h=n/o,d=s[0]/s[1];if(d>h){const f=c.width/d;c={x:c.x,y:Math.round(c.y+(c.height-f)/2),width:c.width,height:Math.round(f)}}else{const f=c.height*d;c={x:Math.round(c.x+(c.width-f)/2),y:c.y,width:Math.round(f),height:c.height}}}else s=[c.width,c.height];return s[0]>c.width?(a=Math.min(s[0]/c.width,e),l=s[0]/c.width/a):(a=1,l=s[0]/c.width),{cropArea:{x:Math.round((c.x+r.left)*a),y:Math.round((c.y+r.top)*a),width:Math.round(c.width*a),height:Math.round(c.height*a)},outputScale:l,resolutionScale:a}}const Pnt=t=>t.includes("Brush");let hIe=class{constructor(){this._names=new Map}begin(e){this._names.has(e)||(this._names.set(e,!1),Pnt(e)&&this.record("Esri.FirstDraw"),performance.mark(`Esri.${e}.Start`))}end(e){this._names.has(e)&&!this._names.get(e)&&(this._names.set(e,!0),performance.mark(`Esri.${e}.End`))}record(e){this._names.has(e)||(this._names.set(e,!0),performance.mark(`Esri.${e}`))}};function dIe(t,e){const i=e.debugRendererInfo&&t.getExtension("WEBGL_debug_renderer_info");return i?{getUnmaskedRendererWebGL:()=>t.getParameter(i.UNMASKED_RENDERER_WEBGL)}:null}let xpe;function Dnt(){return xpe??(xpe=Fnt()),xpe}let Lnt=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1,this.unmaskedRenderer="unloaded"}};function Nnt(t){if(typeof WebGL2RenderingContext>"u")return null;const e=document.createElement("canvas");if(!e)return null;let i=e.getContext("webgl2",{failIfMajorPerformanceCaveat:!0});if(i==null&&(i=e.getContext("webgl2"),i!=null&&(t.majorPerformanceCaveat=!0)),i==null)return i;t.available=!0,t.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const r=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return r&&(t.supportsHighPrecisionFragment=r.precision>0),i}function Fnt(){var i;const t=new Lnt,e=Nnt(t);return e==null||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null,t.unmaskedRenderer=((i=dIe(e,{debugRendererInfo:!0}))==null?void 0:i.getUnmaskedRendererWebGL())??"unknown"),t}function pIe(t){const e=Dnt();return e.available?t==="3d"&&e.majorPerformanceCaveat?new U("webgl:major-performance-caveat-detected",`Your WebGL implementation (${e.unmaskedRenderer}) doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.`):e.supportsHighPrecisionFragment?e.supportsVertexShaderSamplers?null:new U("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new U("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new U("webgl:required","WebGL2 is required but not supported.",new Error().stack)}function knt(t){return t&&"nodeType"in t}function znt(t){return t&&typeof t.render=="function"}const Spe={component:"esri-component"};let A1=class extends he{constructor(){super(...arguments),this.widget=null}destroy(){var e;this.node=null,(e=this.widget)==null||e.destroy()}get id(){var e,i;return this._get("id")??((e=this.widget)==null?void 0:e.id)??((i=this.node)==null?void 0:i.id)}set id(e){this._set("id",e)}set node(e){const i=this._get("node");e!==i&&(e&&e.classList.add(Spe.component),i&&i.classList.remove(Spe.component),this._set("node",e))}castNode(e){var i;return(i=this.widget)==null||i.destroy(),e?typeof e=="string"||knt(e)?(this._set("widget",null),nG(e)):(znt(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};u([p()],A1.prototype,"id",null),u([p()],A1.prototype,"node",null),u([ti("node")],A1.prototype,"castNode",null),u([p({readOnly:!0})],A1.prototype,"widget",void 0),A1=u([A("esri.views.ui.Component")],A1);const dP=A1,fIe="calcite-mode-";function Unt(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"")}function Bnt(){return Unt().startsWith("dark")}function Vnt(){return`${fIe}${Bnt()?"dark":"light"}`}function jnt(t){Gnt(t),t.classList.add(Vnt())}function Gnt(t){Array.from(t.classList).forEach(e=>{e.startsWith(fIe)&&t.classList.remove(e)})}const Hnt={left:0,top:0,bottom:0,right:0},mIe={bottom:30,top:15,right:15,left:15},Pg="esri-ui",_c={ui:Pg,corner:`${Pg}-corner`,innerContainer:`${Pg}-inner-container`,manualContainer:`${Pg}-manual-container`,cornerContainer:`${Pg}-corner-container`,topLeft:`${Pg}-top-left`,topRight:`${Pg}-top-right`,bottomLeft:`${Pg}-bottom-left`,bottomRight:`${Pg}-bottom-right`};function qnt(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function jN(t){return t===0?"0":`${t}px`}function k8(t){const e=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(e===null||e===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function z8(t,{top:e,bottom:i,left:r,right:s}){t.style.top=e,t.style.bottom=i,t.style.left=r,t.style.right=s}let nm=class extends Ss.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._removeWidgetHandleKey=Symbol("componentOnRemoveSymbol"),this._locale=iu(),this.view=null,this._applyViewPadding=()=>{const i=this.container;i&&z8(i,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const i=this._innerContainer;i&&z8(i,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([H(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,Ut),H(()=>this.padding,this._applyUIPadding,Ut),H(()=>[this.container,this._locale],([e,i])=>{e&&e.setAttribute("lang",i)},Ut),WEe(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentMap.clear()}set container(e){const i=this._get("container");e!==i&&(e&&(e.classList.add(_c.ui),jnt(e),this._attachContainers(e)),i&&(i.classList.remove(_c.ui),z8(i,{top:"",bottom:"",left:"",right:""}),i.textContent=""),this._set("container",e))}get height(){var n;const e=((n=this.view)==null?void 0:n.height)??0;if(e===0)return e;const i=this._getViewPadding(),{top:r,bottom:s}=i;return Math.max(e-r-s,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...mIe,...e}}get width(){var n;const e=((n=this.view)==null?void 0:n.width)??0;if(e===0)return e;const i=this._getViewPadding(),{left:r,right:s}=i;return Math.max(e-r-s,0)}add(e,i){let r,s,n;if(Array.isArray(e))return void e.forEach(a=>this.add(a,i));const o=k8(e);o&&({index:r,position:i,component:e,key:s}=o),i&&typeof i=="object"&&({index:r,key:s,position:i,internal:n}=i),!e||i&&!this._isValidPosition(i)||this._add(e,i,r,s,n)}remove(e,i){var s,n;if(!e)return;if(Array.isArray(e))return e.map(o=>this.remove(o,i));const r=this._find(e);if(r){if(this._componentMap.has(r)&&((s=this._componentMap.get(r))==null?void 0:s.key)!==i)return;const o=this._components.indexOf(r),a=r.node.parentNode;return a==null||a.removeChild(r.node),this._componentMap.delete(r),(n=r.widget)==null||n.removeHandlesReference(this._removeWidgetHandleKey),this._components.splice(o,1)[0]}}empty(e,i={removeInternal:!1}){if(Array.isArray(e)){for(const n of e)this.empty(n,i);return}const r=this._positionNameToContainerLookup[e??"manual"],s=Array.prototype.slice.call(r.children).map(n=>this._findByNode(n)).filter(n=>{var o;return n==null?!1:!(((o=this._componentMap.get(n))==null?void 0:o.internal)??!1)||i.removeInternal});for(const n of s)this.remove(n)}move(e,i){if(Array.isArray(e)&&e.forEach(o=>this.move(o,i)),!e)return;let r;const s=k8(e)||k8(i);if(s&&(r=s.index,i=s.position,e=s.component||e),i&&!this._isValidPosition(i))return;const n=this.remove(e);n&&this.add(n,{position:i,index:r})}find(e){if(!e)return null;const i=this._findById(e);return i&&(i.widget||i.node)}getComponents(e,i={includeInternal:!1}){return e?Array.isArray(e)?e.flatMap(r=>this._getComponentsAtPosition(r,i)):this._getComponentsAtPosition(e,i):this._components.filter(r=>{var s;return i.includeInternal||!((s=this._componentMap.get(r))!=null&&s.internal)}).map(({widget:r,node:s})=>r??s)}getPosition(e){for(const i in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[i].contains(e))return i;return null}_add(e,i,r,s,n){e instanceof dP||(e=new dP({node:e}));const{widget:o}=e;o!=null&&o instanceof he&&o.addHandles(Pi(()=>{queueMicrotask(()=>this.remove(e))}),this._removeWidgetHandleKey),this._place({component:e,position:i,index:r}),this._components.push(e),this._componentMap.set(e,{key:s,internal:n})}_find(e){return e?e instanceof dP?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){var e;return((e=this.view)==null?void 0:e.padding)??Hnt}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(_c.innerContainer,_c.cornerContainer);const i=document.createElement("div");i.classList.add(_c.innerContainer,_c.manualContainer);const r=document.createElement("div");r.classList.add(_c.topLeft,_c.corner),e.appendChild(r);const s=document.createElement("div");s.classList.add(_c.topRight,_c.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(_c.bottomLeft,_c.corner),e.appendChild(n);const o=document.createElement("div");o.classList.add(_c.bottomRight,_c.corner),e.appendChild(o),this._innerContainer=e,this._manualContainer=i;const a=vZe();this._cornerNameToContainerLookup={"top-left":r,"top-right":s,"bottom-left":n,"bottom-right":o,"top-leading":a?s:r,"top-trailing":a?r:s,"bottom-leading":a?o:n,"bottom-trailing":a?n:o},this._positionNameToContainerLookup={manual:i,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){var c,h;const i=e.position??"manual",{component:r,index:s}=e,n=this._positionNameToContainerLookup[i],o=s!=null&&s>-1;if(qnt(r.widget)&&r.widget.startup(),!o)return void n.appendChild(r.node);const a=Array.from(n.children);if(s===0){const{firstChild:d}=n;return void(d?(c=d.parentNode)==null?void 0:c.insertBefore(r.node,d):n.appendChild(r.node))}if(s>=a.length)return void n.appendChild(r.node);const l=a[s];(h=l.parentNode)==null||h.insertBefore(r.node,l)}_toPixelPosition(e){return{top:jN(e.top),left:jN(e.left),right:jN(e.right),bottom:jN(e.bottom)}}_findByComponent(e){return this._components.find(i=>i===e)??null}_findById(e){return this._components.find(({id:i})=>i===e)??null}_findByNode(e){return this._components.find(({node:i})=>i===e)??null}_getComponentsAtPosition(e,i){const r=this._positionNameToContainerLookup[e];return Array.prototype.slice.call(r.children).map(s=>this._findByNode(s)).filter(df).filter(s=>{var n;return i.includeInternal||!((n=this._componentMap.get(s))!=null&&n.internal)}).map(({widget:s,node:n})=>s??n)}};u([p()],nm.prototype,"_locale",void 0),u([p()],nm.prototype,"container",null),u([p()],nm.prototype,"height",null),u([p({value:mIe})],nm.prototype,"padding",null),u([ti("padding")],nm.prototype,"castPadding",null),u([p()],nm.prototype,"view",void 0),u([p()],nm.prototype,"width",null),nm=u([A("esri.views.ui.UI")],nm);const Wnt=nm,Znt="randomUUID"in crypto;function dL(){if(Znt)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=i=>t[i].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}function nJt(){return`{${dL().toUpperCase()}}`}function Ynt(){return`{${dL()}}`}function Jnt(t){const e=t.toUpperCase();return t[0]!=="{"?`{${e}}`:e}const Xnt={handleInterceptedEvent:(t,e,i,r)=>(t.scheduleRender(),e.properties[`on${r.type}`].apply(e.properties.bind||i,[r]))},Knt={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.charAt(0)==="-"?t.style.setProperty(e,i):t.style[e]=i}},Qnt=t=>({...Knt,...t}),eot=(t,e)=>{const i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i},tot=(t,e)=>t.find(e),Tpe=(t,e,i=!1)=>{let r=t;return e.forEach((s,n)=>{const o=r!=null&&r.children?tot(r.children,a=>a.domNode===s):void 0;i&&!o&&n!==e.length-1||(r=o)}),r},iot=t=>{let e;const i={...Xnt,...t},r=Qnt(i),s=r.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],h=(f,m,g)=>{var b;let v;r.eventHandlerInterceptor=(w,x,S,C)=>function(T){let M;s("domEvent",T);const I=eot(T.currentTarget,v.domNode),D=I.some(F=>{var L;return customElements.get((L=F==null?void 0:F.tagName)==null?void 0:L.toLowerCase())});if(T.eventPhase===Event.CAPTURING_PHASE||!D)I.reverse(),M=Tpe(v.getLastRender(),I);else{const F=T.composedPath(),L=F.slice(F.indexOf(T.currentTarget),F.indexOf(v.domNode)).reverse();M=Tpe(v.getLastRender(),L,!0)}let P;return M&&(P=i.handleInterceptedEvent(e,M,this,T)),s("domEventProcessed",T),P},(b=i.postProcessProjectionOptions)==null||b.call(i,r);const _=g();v=f(m,_,r),r.eventHandlerInterceptor=void 0,l.push(v),c.push(g),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(v,_)};let d=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let f=0;f<l.length;f++){const m=c[f]();s("rendered",void 0);try{l[f].update(m)}catch(g){console.error(g)}s("patched",void 0)}s("renderDone",void 0),o=!0}};return i.modifyDoRenderImplementation&&(d=i.modifyDoRenderImplementation(d,l,c)),e={renderNow:d,scheduleRender:()=>{n||a||(n=requestAnimationFrame(d))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(f,m)=>{h(rb.append,f,m)},insertBefore:(f,m)=>{h(rb.insertBefore,f,m)},merge:(f,m)=>{h(rb.merge,f,m)},replace:(f,m)=>{h(rb.replace,f,m)},detach:f=>{for(let m=0;m<c.length;m++)if(c[m]===f)return c.splice(m,1),l.splice(m,1)[0];throw new Error("renderFunction was not found")}},e};class R3{constructor(){this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}}const rot=(t,e)=>{let i=t;for(;i;){if(i===e)return!0;if(!i.parentNode)return!1;i.parentNode instanceof ShadowRoot?i=i.parentNode.host:i=i.parentNode}return!1},sot=(t,e,i)=>{const r=not(e).subscribe;return r(s=>{s.some(o=>rot(t,o.target))&&i()})},U8={},not=t=>{const e=t.join(","),i=U8[e];if(i!==void 0)return i;const r=new Set,s=new MutationObserver(o=>r.forEach(a=>a(o)));globalThis.document&&s.observe(document.documentElement,{attributes:!0,attributeFilter:t,subtree:!0});const n={subscribe:o=>(r.add(o),()=>{r.delete(o),r.size===0&&(s.disconnect(),U8[e]=void 0)})};return U8[e]=n,n},oot=(t,e)=>{var r,s;let i=t;for(;i;){const n=(r=i.closest)==null?void 0:r.call(i,e);if(n)return n;const o=(s=i.getRootNode)==null?void 0:s.call(i);if(o===globalThis.document)return null;i=o.host}return null},aot=(t,e,i)=>{const r=oot(t,`[${e}]`);return(r==null?void 0:r.getAttribute(e))??i},pn=(t,e,...i)=>{try{return t==null?void 0:t.call(e,...i)}catch(r){console.error(r,t)}},zJ=async(t,e,...i)=>{try{return await(t==null?void 0:t.call(e,...i))}catch(r){console.error(r,t)}},lot="ar,bg,bs,ca,cs,da,de,el,en,es,et,fi,fr,he,hr,hu,id,it,ja,ko,lt,lv,nl,nb,no,pl,pt-BR,pt-PT,ro,ru,sk,sl,sr,sv,th,tr,uk,vi,zh-CN,zh-HK,zh-TW".split(","),cot=new Set(lot),hB="en",uot={pt:"pt-PT",nb:"no",nn:"no",zh:"zh-CN"},hot=async(t,e,i="")=>{const r=`${e}/${i}`,s=`${r}${t}.json`;return B8[s]??(B8[s]=gIe(t,r)),await B8[s]},B8={},gIe=async(t,e)=>{const i=`${e}${t}.json`;try{const r=await fetch(i);if(r.ok)return await r.json()}catch(r){return console.error(r),{}}return t===hB?{}:await gIe(hB,e)},yIe=t=>{var i;const e=aot(t,"lang",((i=globalThis.navigator)==null?void 0:i.language)||hB);return{lang:e,t9nLocale:vIe(e)}},vIe=t=>{const[e,i]=t.split("-"),r=e.toLowerCase();let s=r;return i&&(s=`${r}-${i.toUpperCase()}`),s=uot[s]??s,cot.has(s)?s:i?vIe(r):hB},dot=(t,e,i,r)=>{let s;const n=()=>pot(t,e(),r).then(o=>{((s==null?void 0:s.lang)!==o.lang||s.t9nLocale!==o.t9nLocale||s.t9nStrings!==o.t9nStrings)&&i(o),s=o}).catch(console.error);return queueMicrotask(n),sot(t,["lang"],n)},pot=async(t,e,i=t.localName.split("-").slice(1).join("-"))=>{const{lang:r,t9nLocale:s}=yIe(t),n=`${e}/${i}/t9n`,a=i===null?{}:await hot(s,n,"messages.");return{lang:r,t9nLocale:s,t9nStrings:a}},fot=t=>t.replace(mot,(e,i)=>`${i===0?"":"-"}${e.toLowerCase()}`),mot=/[A-Z]+(?![a-z])|[A-Z]/gu,got=(t,e)=>{const i=e/yot;let r=0;const s=setInterval(()=>{r+=i,r>=e&&(clearInterval(s),t())},i);return s},yot=4,wse=Symbol.for("controller"),vot=t=>typeof t=="object"&&t!==null&&(wse in t||"hostConnected"in t||"hostDisconnected"in t||"hostUpdate"in t||"hostUpdated"in t),_ot=t=>typeof(t==null?void 0:t.then)=="function";let LI;const rC=t=>{LI!==t&&(LI=t,queueMicrotask(()=>LI===t?LI=void 0:0))},NG=t=>LI;let M1=[];const _Ie=t=>{if(t===void 0){M1=[];return}const e=M1.indexOf(t);M1=e===-1?[...M1,t]:M1.slice(0,e+1),queueMicrotask(()=>M1=[])},bIe=()=>M1;let sC;const bot=t=>{sC!==t&&(sC=t,queueMicrotask(()=>sC===t?sC=void 0:0))},wot=()=>{const t=sC;return sC=void 0,t},xot=async(t,e)=>{const i=xse(t);if(i===void 0)return t;if(await i.ready,typeof e=="function"){const r=i.watchExports(s=>e(s,r))}return i.exports},Sot=async t=>{const e=xse(t);return await e.ready,e},xse=t=>{const i=NG().manager.X(t);if(i!==void 0)return i;if(vot(t))return t;const r=wot();if(r!==void 0)return r};let UJ=!1;const Tot=t=>{UJ=!0;try{return t()}finally{UJ=!1}},Eot=(t,e,i)=>{const r=Object.keys(t),s=r.length;ob===void 0&&queueMicrotask(Sse),ob??(ob=new Map);let n=ob.get(t);return n===void 0&&(n={callbacks:[],keyCount:s},ob.set(t,n)),n.keyCount!==s&&(n.callbacks.forEach(o=>o(r)),n.callbacks=[],n.keyCount=s),n.callbacks.push(o=>{const a=c=>pn(e,null,c),l=o[s];l===void 0?a(void 0):t[l]===i?a(l):a(void 0)}),i};let ob;const Sse=()=>{ob==null||ob.forEach(({callbacks:t},e)=>{const i=Object.keys(e);t.forEach(r=>r(i))}),ob=void 0},Cot=(t,e,i)=>{const r=t.manager;return r.V!==Ke&&r.V!==i&&r.S(void 0,void 0),r.T.length===0&&queueMicrotask(()=>r.S(void 0,void 0)),r.V=i,r.T.push((s,n)=>pn(e,void 0,i===n?s:void 0)),i},wIe=(t=[NG(),...bIe()],e,i)=>{const r=Array.isArray(t)?t:[t];let s=r.length+1;const n=o=>{s-=1,o!==void 0&&(s=Math.min(s,0)),s===0&&e(o)};r.forEach(o=>Eot(o,a=>n(a===void 0?void 0:{key:a,host:o,isReactive:!1}),i));for(const o of r)if("manager"in o&&o.manager.component===o){Cot(o,a=>n(a===void 0?void 0:{key:a,host:o,isReactive:!0}),i);break}return i},$ot=(t="",e={},i=NG())=>{const r={emit:s=>{t===""&&Sse();const n=new CustomEvent(t,{detail:s,cancelable:!0,bubbles:!0,composed:!0,...e});return i.el.dispatchEvent(n),n}};return t===""&&wIe(void 0,s=>t=s.key,r),r},Gt=$ot.bind(null,"");var xIe;xIe=wse;var v$,_$,zx,b$,w$,x$,S$,T$,J_,Ux,kc,Tm,Hy,E$,u5;class Tse{constructor(e){Br(this,E$);Br(this,v$);Br(this,_$);Br(this,zx);Br(this,b$);Br(this,w$);Br(this,x$);Br(this,S$);Br(this,T$);Br(this,J_);Br(this,Ux);Br(this,kc);Br(this,Tm);Br(this,Hy);vr(this,v$,[]),vr(this,_$,[]),vr(this,zx,[]),vr(this,b$,[]),vr(this,w$,[]),vr(this,x$,[]),vr(this,S$,[]),vr(this,T$,[]),vr(this,J_,[]),vr(this,Ux,!1),this.P=new R3,this.connectedCalled=!1,this.loadedCalled=!1,this[xIe]=!0,vr(this,Hy,[]);const i=this,r=e??NG();vr(i,kc,r),i.ready=i.P.promise,vr(i,Tm,Cpe(i)),i.component=r,Ne(i,kc).addController(i),Ne(i,kc).manager===void 0||(_Ie(i),queueMicrotask(()=>i.catchUpLifecycle()))}catchUpLifecycle(){const{manager:e}=Ne(this,kc);e.connectedCalled&&!this.connectedCalled&&this.triggerConnected(),Ne(e,Ux)&&this.triggerLoad().then(()=>e.loadedCalled&&this.triggerLoaded()).catch(console.error)}get exports(){return Ne(this,Tm)}set exports(e){const i=Ne(this,Tm);i!==e&&(vr(this,Tm,e),Ne(this,Hy).forEach(pn),this.connectedCalled&&this.O!==!1&&Ne(this,kc).requestUpdate(this.O,i)),this.P.resolve(e)}setProvisionalExports(e,i=!0){vr(this,Tm,i?Cpe(e):e),Ne(this,Hy).forEach(pn)}watchExports(e){const i=()=>e(Ne(this,Tm));return Ne(this,Hy).push(i),()=>void Ne(this,Hy).splice(Ne(this,Hy).indexOf(i),1)}get use(){return rC(Ne(this,kc)),xot}get useRef(){return rC(Ne(this,kc)),Sot}get useRefSync(){return rC(Ne(this,kc)),xse}controllerRemoved(){Ne(this,kc).el.isConnected&&this.triggerDisconnected(),this.triggerDestroy()}onConnected(e){Ne(this,v$).push(e)}onDisconnected(e){Ne(this,_$).push(e)}onLoad(e){Ne(this,zx).push(e)}onLoaded(e){Ne(this,b$).push(e)}onUpdate(e){Ne(this,w$).push(e)}onUpdated(e){Ne(this,x$).push(e)}onDestroy(e){Ne(this,S$).push(e)}onLifecycle(e){Ne(this,T$).push(e),this.connectedCalled&&Ne(this,kc).el.isConnected&&r0(this,E$,u5).call(this,e)}triggerConnected(){const e=this;e.hostConnected&&pn(e.hostConnected,e),Ne(e,v$).forEach(pn),e.triggerLifecycle(),e.connectedCalled=!0}triggerDisconnected(){const e=this;e.hostDisconnected&&pn(e.hostDisconnected,e),Ne(e,_$).forEach(pn),Ne(e,J_).forEach(pn),vr(e,J_,[])}async triggerLoad(){if(Ne(this,Ux))return;vr(this,Ux,!0);const e=this;e.hostLoad&&await zJ(e.hostLoad,e),Ne(this,zx).length>0&&await Promise.allSettled(Ne(this,zx).map(zJ)),this.P.resolve(Ne(this,Tm))}triggerLoaded(){this.loadedCalled||(this.hostLoaded&&pn(this.hostLoaded,this),Ne(this,b$).forEach(pn),this.loadedCalled=!0)}triggerUpdate(e){this.hostUpdate&&pn(this.hostUpdate,this,e),Ne(this,w$).forEach(Epe,e)}triggerUpdated(e){this.hostUpdated&&pn(this.hostUpdated,this,e),Ne(this,x$).forEach(Epe,e)}triggerDestroy(){this.hostDestroy&&pn(this.hostDestroy,this),Ne(this,S$).forEach(pn)}triggerLifecycle(){this.hostLifecycle&&r0(this,E$,u5).call(this,()=>this.hostLifecycle()),Ne(this,T$).forEach(r0(this,E$,u5),this)}}v$=new WeakMap,_$=new WeakMap,zx=new WeakMap,b$=new WeakMap,w$=new WeakMap,x$=new WeakMap,S$=new WeakMap,T$=new WeakMap,J_=new WeakMap,Ux=new WeakMap,kc=new WeakMap,Tm=new WeakMap,Hy=new WeakMap,E$=new WeakSet,u5=function(e){rC(Ne(this,kc));const i=pn(e);(Array.isArray(i)?i:[i]).forEach(s=>{typeof s=="function"?Ne(this,J_).push(s):typeof s=="object"&&typeof s.remove=="function"&&Ne(this,J_).push(s.remove)})};function Epe(t){pn(t,void 0,this)}const Aot=Tse,Cpe=t=>{if(typeof t!="object"&&typeof t!="function"||t===null)return t;const e={get(r,s,n){if(!((s==="exports"||s==="_exports")&&s in r&&r[s]===i)&&(s in r||s in Promise.prototype||typeof s=="symbol"))return typeof r=="function"?r[s]:Reflect.get(r,s,n)}},i=new Proxy(t,e);return i},Mot=1,Oot=2,Iot=4,Rot=8,Pot=16,Dot=32,Lot=64,SIe=t=>{var i,r;let e=t;for(;e=e.parentNode??e.host;)if((i=e==null?void 0:e.constructor)!=null&&i.lumina){const s=e;return(r=s.manager)!=null&&r.loadedCalled||(s.J??s._offspring).push(t),(s.I??s._postLoad).promise}return!1},$pe={};function TIe(){}const h5=Object.defineProperty,Not=globalThis.HTMLElement??TIe;var zc,qy,C$,ED,BJ;const Kle=class Kle extends Not{constructor(){var s,n;super();Br(this,ED);Br(this,zc);Br(this,qy);Br(this,C$);vr(this,qy,{}),vr(this,C$,[]),this.I=new R3,this.H=new R3,this.J=[];const i=this,r=i.constructor;i._offspring=i.J,i._postLoad=i.I,(s=r.C)==null||s.forEach(o=>{Object.hasOwn(i,o)&&(Ne(i,qy)[o]=i[o],delete i[o])}),r.A?r0(n=i,ED,BJ).call(n,{a:r.A}):r.B.then(async o=>{var a,l;await r.K.p,r0(l=i,ED,BJ).call(l,await(((a=o.default)==null?void 0:a.then(c=>typeof c=="function"?{a:c}:c))??o))}).catch(o=>{i.H.reject(o),setTimeout(()=>{throw o})})}static F(){for(const i of this.C??[])h5(this.prototype,i,{configurable:!0,enumerable:!0,get(){return Ne(this,qy)[i]},set(r){Ne(this,qy)[i]=r}});for(const i of this.E??[])h5(this.prototype,i,{async value(...r){return Ne(this,zc)||await this.H.promise,await Ne(this,zc)[i](...r)},configurable:!0});for(const i of this.D??[])h5(this.prototype,i,{value(...r){return Ne(this,zc)[i](...r)},configurable:!0})}get manager(){var i;return(i=Ne(this,zc))==null?void 0:i.manager}attributeChangedCallback(i,r,s){var n;(n=Ne(this,zc))==null||n.attributeChangedCallback(i,r,s),Ne(this,zc)||Ne(this,C$).push(i)}connectedCallback(){var i,r;Ne(this,zc)?(r=(i=Ne(this,zc)).connectedCallback)==null||r.call(i):queueMicrotask(()=>this.G=SIe(this))}disconnectedCallback(){var i,r;(r=(i=Ne(this,zc))==null?void 0:i.disconnectedCallback)==null||r.call(i)}async componentOnReady(){return await this.H.promise,this}addController(){}requestUpdate(){var i;(i=Ne(this,zc))==null||i.requestUpdate()}};zc=new WeakMap,qy=new WeakMap,C$=new WeakMap,ED=new WeakSet,BJ=function(i){var f;const r=this.constructor,s=r.L,n=Ne(this,qy),o=Object.values(i).find(m=>m.L===s),a=`${s}--lazy`;let l=o;for(;l&&!Object.hasOwn(l,"lumina");)l=Object.getPrototypeOf(l);kot(l),!r.A&&(r.A=o,customElements.define(a,o)),o.N=this;const h=document.createElement(a);o.N=void 0,vr(this,zc,h),vr(this,qy,h),Ne(this,C$).forEach(m=>h.attributeChangedCallback(m,null,this.getAttribute(m))),Object.entries(n).forEach(Fot,h);const d=this.isConnected;(d||this.G)&&((f=h.connectedCallback)==null||f.call(h),d||h.disconnectedCallback())},Kle.lumina=!0;let Ape=Kle;function Fot([t,e]){this[t]=e}const kot=t=>{const e=t.prototype,i=Element.prototype;Object.hasOwn(e,"isConnected")||(e.setAttribute=function(s,n){i.setAttribute.call(this.el,s,n)},e.removeAttribute=function(s){i.removeAttribute.call(this.el,s)},h5(e,"isConnected",{get(){return Reflect.get(i,"isConnected",this.el)}}))};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const zy={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4},pL=t=>(...e)=>({_$litDirective$:t,values:e});let fL=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,i,r){this._$Ct=e,this._$AM=i,this._$Ci=r}_$AS(e,i){return this.update(e,i)}update(e,i){return this.render(...i)}};/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const zot=pL(class extends fL{constructor(t){var e;if(super(t),t.type!==zy.ATTRIBUTE||t.name!=="class"||((e=t.strings)==null?void 0:e.length)>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(t){return" "+Object.keys(t).filter(e=>t[e]).join(" ")+" "}update(t,[e]){var r,s;if(this.st===void 0){this.st=new Set,t.strings!==void 0&&(this.nt=new Set(t.strings.join(" ").split(/\s/).filter(n=>n!=="")));for(const n in e)e[n]&&!((r=this.nt)!=null&&r.has(n))&&this.st.add(n);return this.render(e)}const i=t.element.classList;for(const n of this.st)n in e||(i.remove(n),this.st.delete(n));for(const n in e){const o=!!e[n];o===this.st.has(n)||(s=this.nt)!=null&&s.has(n)||(o?(i.add(n),this.st.add(n)):(i.remove(n),this.st.delete(n)))}return vd}});/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const EIe="important",Uot=" !"+EIe,Bot=pL(class extends fL{constructor(t){var e;if(super(t),t.type!==zy.ATTRIBUTE||t.name!=="style"||((e=t.strings)==null?void 0:e.length)>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(t){return Object.keys(t).reduce((e,i)=>{const r=t[i];return r==null?e:e+`${i=i.includes("-")?i:i.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${r};`},"")}update(t,[e]){const{style:i}=t.element;if(this.ft===void 0)return this.ft=new Set(Object.keys(e)),this.render(e);for(const r of this.ft)e[r]==null&&(this.ft.delete(r),r.includes("-")?i.removeProperty(r):i[r]=null);for(const r in e){const s=e[r];if(s!=null){this.ft.add(r);const n=typeof s=="string"&&s.endsWith(Uot);r.includes("-")||n?i.setProperty(r,n?s.slice(0,-11):s,n?EIe:""):i[r]=s}}return vd}});/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{I:Vot}=NVe,CIe=t=>t.strings===void 0,Mpe=()=>document.createComment(""),aJt=(t,e,i)=>{var n;const r=t._$AA.parentNode,s=e===void 0?t._$AB:e._$AA;if(i===void 0){const o=r.insertBefore(Mpe(),s),a=r.insertBefore(Mpe(),s);i=new Vot(o,a,t,t.options)}else{const o=i._$AB.nextSibling,a=i._$AM,l=a!==t;if(l){let c;(n=i._$AQ)==null||n.call(i,t),i._$AM=t,i._$AP!==void 0&&(c=t._$AU)!==a._$AU&&i._$AP(c)}if(o!==s||l){let c=i._$AA;for(;c!==o;){const h=c.nextSibling;r.insertBefore(c,s),c=h}}}return i},lJt=(t,e,i=t)=>(t._$AI(e,i),t),jot={},$Ie=(t,e=jot)=>t._$AH=e,cJt=t=>t._$AH,uJt=t=>{var r;(r=t._$AP)==null||r.call(t,!1,!0);let e=t._$AA;const i=t._$AB.nextSibling;for(;e!==i;){const s=e.nextSibling;e.remove(),e=s}};/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ope=pL(class extends fL{constructor(t){if(super(t),t.type!==zy.PROPERTY&&t.type!==zy.ATTRIBUTE&&t.type!==zy.BOOLEAN_ATTRIBUTE)throw Error("The `live` directive is not allowed on child or event bindings");if(!CIe(t))throw Error("`live` bindings can only contain a single expression")}render(t){return t}update(t,[e]){if(e===vd||e===Ke)return e;const i=t.element,r=t.name;if(t.type===zy.PROPERTY){if(e===i[r])return vd}else if(t.type===zy.BOOLEAN_ATTRIBUTE){if(!!e===i.hasAttribute(r))return vd}else if(t.type===zy.ATTRIBUTE&&i.getAttribute(r)===e+"")return vd;return $Ie(t),e}});var Wy,Dp,$$;class Got extends Aot{constructor(i){super(i);Br(this,Wy);Br(this,Dp);Br(this,$$);this.destroyed=!1,this.R=!1,this.V=Ke,this.T=[],vr(this,$$,new WeakMap),vr(this,Dp,i),this.exports=void 0,this.hasDestroy=VJ in i&&typeof i.destroy=="function",sf.prototype.addController.call(i,{hostConnected:()=>{if(this.destroyed){const r=i.el.localName;throw i.el.remove(),new Error(`The ${r} component has already been destroyed. It cannot be used again. If you meant to disconnect and reconnect a component without automatic destroy, set the ${VJ} prop.`)}Ne(this,Wy)!==void 0&&clearTimeout(Ne(this,Wy)),Sse();for(const r of i.M)"triggerConnected"in r?r.triggerConnected():pn(r.hostConnected,r)},hostDisconnected:()=>{for(const r of i.M)"triggerDisconnected"in r?r.triggerDisconnected():pn(r.hostDisconnected,r);this.hasDestroy&&!this.destroyed&&this.U()},hostUpdate:()=>{for(const r of i.M)"triggerUpdate"in r?r.triggerUpdate(this.Q):pn(r.hostUpdate,r,this.Q)},hostUpdated:()=>{for(const r of i.M)"triggerUpdated"in r?r.triggerUpdated(this.Q):pn(r.hostUpdated,r,this.Q);this.Q=void 0}}),queueMicrotask(()=>this.R=!0),rC(i)}async destroy(){if(!this.destroyed){Ne(this,Dp).el.isConnected&&(this.hasDestroy=!1,Ne(this,Dp).el.remove()),vr(this,Wy,void 0),this.destroyed=!0;for(const i of Ne(this,Dp).M)"triggerDestroy"in i?i.triggerDestroy():pn(i.hostDestroy,i);Ne(this,Dp).M.splice(0)}}U(){Ne(this,Wy)!==void 0&&clearTimeout(Ne(this,Wy)),!Ne(this,Dp).el.isConnected&&!Ne(this,Dp).autoDestroyDisabled&&vr(this,Wy,got(()=>void Ne(this,Dp).destroy(),Hot))}S(i,r){const s=this.T;this.V=Ke,this.T=[],s.forEach(n=>n(i,r))}W(i,r){(typeof r=="object"&&r!==null||typeof r=="function")&&Ne(this,$$).set(r,i)}X(i){if(typeof i=="object"&&i!==null||typeof i=="function")return Ne(this,$$).get(i)}}Wy=new WeakMap,Dp=new WeakMap,$$=new WeakMap;let Hot=1e3;const VJ="autoDestroyDisabled";var Bx,CD,$D,Vx,Em,VA,AIe,MIe;const YP=class YP extends sf{constructor(){super();Br(this,VA);Br(this,Bx);Br(this,CD);Br(this,$D);Br(this,Vx);Br(this,Em);this.M=[],this.manager=new Got(this);const i=this,r=i.constructor,s=r.N,n=r.K.o,o=YP.prototype.shouldUpdate;vr(i,Vx,(s==null?void 0:s.H)??new R3),i.I=(s==null?void 0:s.I)??new R3,i.J=(s==null?void 0:s.J)??[],i._offspring=i.J,i._postLoad=i.I,i.el=s??i,vr(i,$D,i.enableUpdating),i.enableUpdating=TIe,i.shouldUpdate!==o&&(vr(i,CD,i.shouldUpdate),i.shouldUpdate=o),n&&(vr(i,Bx,new Map),r.elementProperties.forEach((a,l)=>Ne(i,Bx).set(l,n())))}static finalizeStyles(i){var n;const r=super.finalizeStyles(i),s=this.shadowRootOptions===$pe;return((n=this.K)==null?void 0:n.commonStyles)===void 0||s?r:[this.K.commonStyles,...r]}static createProperty(i,r){const s=typeof r=="number"?r:Array.isArray(r)?r[0]:0,n=Array.isArray(r)?r[1]:void 0,o=(n==null?void 0:n.hasChanged)??Aj,a={attribute:s&Mot&&typeof i=="string"?fot(i):!1,reflect:!!(s&Oot),type:s&Iot?Boolean:s&Rot?Number:void 0,state:!!(s&Pot),readOnly:!!(s&Dot),noAccessor:!!(s&Lot),c:!1,...n,hasChanged(l,c){const h=o(l,c);return a.c=h,h}};super.createProperty(i,a)}static getPropertyDescriptor(i,r,s){const n=this.K,o=super.getPropertyDescriptor(i,r,s);return s.d=o,{...o,get(){var a,l;return(a=n.t)==null||a.call(n,Ne(this,Bx).get(i)),(l=o.get)==null?void 0:l.call(this)},set(a){var c,h;const l=this.manager;if(s.readOnly&&!UJ&&(l.R||l.connectedCalled))throw Error(`Cannot assign to read-only property "${i}" of ${this.el.localName}. Trying to assign "${a}"`);o.set.call(this,a??void 0),s.c&&((h=(c=Ne(this,Bx))==null?void 0:c.get(i))==null||h.notify()),l.T.length>0&&(l==null||l.S(i,a))}}}connectedCallback(){var s,n;if(this.el.hasAttribute("defer-hydration"))return;const i=(n=(s=this.constructor.K).c)==null?void 0:n.call(s,()=>this.requestUpdate());vr(this,Em,i);const r=!this.manager.connectedCalled;super.connectedCallback(),r?queueMicrotask(()=>r0(this,VA,MIe).call(this).catch(o=>{Ne(this,Vx).reject(o),setTimeout(()=>{throw o})})):i&&this.requestUpdate()}disconnectedCallback(){var i;super.disconnectedCallback(),(i=Ne(this,Em))==null||i.destroy(),vr(this,Em,void 0)}createRenderRoot(){const i=this.el.shadowRoot,r=this.constructor,s=r.shadowRootOptions,o=i??(s===$pe?this.el:this.el.attachShadow(s));if(i)return sf.prototype.createRenderRoot.call(this),i;if(this.isConnected){const a=o.getRootNode();a.adoptedStyleSheets=[...a.adoptedStyleSheets,...r.elementStyles.map(l=>"styleSheet"in l?l.styleSheet:l)]}return o}shouldUpdate(i){var r;return this.manager.Q=i,((r=Ne(this,CD))==null?void 0:r.call(this,i))??!0}update(i){Ne(this,Em)?r0(this,VA,AIe).call(this,i):super.update(i)}listen(i,r,s){const n=(r==null?void 0:r.bind(this))??r;this.manager.onLifecycle(()=>(this.el.addEventListener(i,n,s),()=>this.el.removeEventListener(i,n,s)))}listenOn(i,r,s,n){const o=(s==null?void 0:s.bind(this))??s;this.manager.onLifecycle(()=>(i.addEventListener(r,o,n),()=>i.removeEventListener(r,o,n)))}async componentOnReady(){return await Ne(this,Vx).promise,this}addController(i){var r;this.M.push(i),!(wse in i)&&this.renderRoot&&this.el.isConnected&&((r=i.hostConnected)==null||r.call(i))}removeController(i){var r;this.M.splice(this.M.indexOf(i),1),(r=i.controllerRemoved)==null||r.call(i)}};Bx=new WeakMap,CD=new WeakMap,$D=new WeakMap,Vx=new WeakMap,Em=new WeakMap,VA=new WeakSet,AIe=function(i){try{Ne(this,Em).clear(),this.constructor.K.r(Ne(this,Em),()=>nce(YP.prototype,this,"update").call(this,i))}catch(r){throw Ne(this,Em).clear(),r}},MIe=async function(){var n,o;const i=this.el.G??SIe(this.el);i&&await i;const r=[];for(const a of this.M)"triggerLoad"in a?r.push(a.triggerLoad()):r.push(zJ(a.hostLoad,a));await Promise.all(r),await((n=this.load)==null?void 0:n.call(this)),this.manager.hasDestroy&&this.manager.onUpdate(a=>a.has(VJ)&&this.manager.U()),Ne(this,$D).call(this,!0),this.performUpdate(),this.I.resolve(),await Promise.resolve();const s=this.J.filter(a=>{var l;return!((l=a.manager)!=null&&l.loadedCalled)});s.length&&await Promise.allSettled(s.map(async a=>await a.componentOnReady())),this.J.length=0,this.el.setAttribute(this.constructor.K.hydratedAttribute,"");for(const a of this.M)"triggerLoaded"in a?a.triggerLoaded():pn(a.hostLoaded,a);(o=this.loaded)==null||o.call(this),Ne(this,Vx).resolve()},YP.lumina=!0;let Hn=YP;const qot=t=>{let e;const i=s=>{var n;e=new URL(s,((n=globalThis.location)==null?void 0:n.href)||void 0).href},r={...t,getAssetPath(s){var o;const n=new URL(s,e);return n.origin!==((o=globalThis.location)==null?void 0:o.origin)?n.href:n.pathname},setAssetPath:i,customElement(s,n){n.K=r,n.L=s,customElements.get(s)||customElements.define(s,n)}};return i(t.defaultAssetPath),r},ge=t=>typeof t=="object"&&t!=null?zot(t):t,OIe=t=>typeof t=="object"&&t!=null?Bot(t):t,Pp=Ke;function FG(t,e,i){i==null?t.removeAttribute(e):t.setAttribute(e,i)}const P3={toAttribute:t=>t===!0?"":t===!1?null:t};/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const IIe="calcite-mode-auto",RIe="calcite-mode-dark",Wot="calcite-mode-light",pP={autoMode:IIe,darkMode:RIe,lightMode:Wot,rtl:"calcite--rtl"},dB={filter:250,nextTick:0,resize:150,reposition:100},hJt=10,dJt=25;function Ipe(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,i=()=>t.contains(RIe)||t.contains(IIe)&&e?"dark":"light",r=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),s=o=>{n!==o&&r(o),n=o};let n=i();r(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>s(o.matches?"dark":"light")),new MutationObserver(()=>s(i())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}const ov=globalThis.calciteConfig,Zot=(ov==null?void 0:ov.focusTrapStack)||[],Yot=(ov==null?void 0:ov.logLevel)||"info",Rpe="3.2.1",Jot="2025-05-29",Xot="618973fec";function Kot(){if(ov&&ov.version)return;console.info(`Using Calcite Components ${Rpe} [Date: ${Jot}, Revision: ${Xot}]`);const t=ov||globalThis.calciteConfig||{};Object.defineProperty(t,"version",{value:Rpe,writable:!1}),globalThis.calciteConfig=t}function Qot(){document.readyState==="interactive"?Ipe():document.addEventListener("DOMContentLoaded",()=>Ipe(),{once:!0}),Kot()}Qot();const eat=qot({defaultAssetPath:"https://js.arcgis.com/calcite-components/3.2.1/",hydratedAttribute:"calcite-hydrated"}),{customElement:Io,getAssetPath:PIe,setAssetPath:tat}=eat;/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */let DIe=!1;const iat=t=>{DIe=!0,tat(t)};let LIe;function rat(){DIe||iat(Jc(vs(LIe)))}function mL(t){var i;const e=[];for(const r of Object.keys(t))customElements.get(`calcite-${r}`)||e.push((i=t[r])==null?void 0:i.call(t));return e.length>0?Promise.all(e):null}LIe="components/assets";const NIe=Symbol("widget"),FIe=Symbol("widget-test-data"),sat=[],nat={},pB=new WeakMap;function kIe(t,e){let i=e.children;if(i!=null&&i.length)for(let s=0;s<i.length;++s)i[s]=kIe(t,i[s]);else i=sat;const r=e.vnodeSelector;if(fB(r)){const s=e.properties||nat,n=s.key||r,o={key:n,afterCreate:oat,afterUpdate:aat,afterRemoved:zIe,parentWidget:t,widgetConstructor:r,widgetProperties:{...s,key:n,children:i}};return{vnodeSelector:r.vnodeSelector,properties:o,children:void 0,text:void 0,domNode:null}}return e}function oat(t,e,i,{parentWidget:r,widgetConstructor:s,widgetProperties:n}){var a;const o=new s(n);o.container=t,pB.set(t,o),(a=o.afterCreate)==null||a.call(o,o,t),r.addHandles(Pi(()=>zIe(t))),queueMicrotask(()=>{o[FIe].projector.renderNow()})}function aat(t,e,i,{widgetProperties:r}){var n;const s=pB.get(t);s&&(s.set(r),(n=s.afterUpdate)==null||n.call(s,s,t))}function zIe(t){var i;const e=pB.get(t);e&&((i=e.afterRemoved)==null||i.call(e,e,t),e.destroy(),pB.delete(t))}function fB(t){return typeof t=="function"&&t[NIe]}const Ppe=new Set;function lat(t){Ppe.add(t),t.finally(()=>Ppe.delete(t))}var UIe;const cat="esri.widgets.Widget";let uat=0;function BIe(t,e){const i=Object.prototype.hasOwnProperty;for(const r in e)i.call(e,r)&&i.call(t,r)&&(t[r]!=null&&e[r]!=null&&typeof t[r]=="object"&&typeof e[r]=="object"?BIe(t[r],e[r]):t[r]=e[r]);return t}const hat=iot({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,i=/capture$/i;t.eventHandlerInterceptor=(r,s,n,o)=>{const a=e==null?void 0:e(r,s,n,o),l=i.test(r);if(!((r=r.replace(i,"")).toLowerCase()in n)||l){const c=r[2].toLowerCase()+r.slice(3),h=m=>a==null?void 0:a.call(n,m);n.addEventListener(c,h,l);const d=()=>n.removeEventListener(c,h,l),f=o.afterRemoved;o.afterRemoved=m=>{f==null||f(m),d()}}return a}},handleInterceptedEvent(t,e,i,r){const{eventPhase:s,type:n}=r,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=e.properties;(l&&a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,l&&a in l))&&(HCe(),t.scheduleRender(),l[a].call(l.bind||i,r))}});let V8=!1,co=class extends iw.EsriPromiseMixin(Ss.EventedAccessor){constructor(e,i){super(e,i),this._attached=!1,this._projector=hat,this._readyForTrueRender=!1,this.key=this,this.autoRenderingEnabled=!0,this._loadLocale=UD(async()=>{var l;if((l=this._messageBundleProps)!=null&&l.length){const c=await Promise.allSettled(this._messageBundleProps.map(async({bundlePath:h,propertyName:d})=>{if(this.destroyed)return;let f=await eCe(h);this.uiStrings&&Object.keys(this.uiStrings)&&(f=BIe(q(f),this.uiStrings)),this[d]=f}));if(this.destroyed)return;for(const h of c)h.status==="rejected"&&J.getLogger(this).error("widget-intl:locale-error",this.declaredClass,h.reason)}await this.loadLocale()}),rat();const r="esri-widget-uid-"+dL(),s=this.render.bind(this);this._trackingTarget=new Uj(()=>{this.autoRenderingEnabled&&this.scheduleRender()});const n=()=>({vnodeSelector:"div",properties:{key:`${r}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}),o=()=>{var d,f;if(!this._readyForTrueRender||this.destroyed)return null;const l=s()??n(),c=l.properties??(l.properties={});if(c.key??(c.key=r),fB(l.vnodeSelector)){if(!this.visible)return n()}else this.visible?c.styles||(c.styles={}):(c.class="",c.styles={display:"none"}),(d=c.styles).display??(d.display="");let h=0;return(f=l.children)==null||f.forEach(m=>{var g;fB(m.vnodeSelector)||(m.properties??(m.properties={}),(g=m.properties).key??(g.key=`${this.id}--${h++}`))}),kIe(this,l)};this.render=()=>{if(V8)return o();let l=gZe(this)??null;if(l)return l;this._trackingTarget.clear(),V8=!0;try{l=mv(this._trackingTarget,o)}catch(c){throw J.getLogger(this).error(c),c}finally{V8=!1}return l&&yZe(this,l),l};const a=this.beforeFirstRender();a?this._resourcesFetch=a.then(()=>{this._readyForTrueRender=!0,this._postInitialize()}):(this._resourcesFetch=Promise.resolve().then(()=>{this._postInitialize()}),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),lat(this._resourcesFetch)}normalizeCtorArgs(e,i){const r={...e};return i&&(r.container=i),r}postInitialize(){}beforeFirstRender(){var i;const e=this.loadDependencies();return(i=this._messageBundleProps)!=null&&i.length||e?Promise.all([e,this._loadLocale()]).then(()=>{}).catch(Gce):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||($e(this._trackingTarget),$e(this.viewModel),this._detach(this.container),this._set("container",null),this._emitter.clear(),this.render=()=>null,this._projector=null,i8(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return nG(e)}get domNode(){return this.container}set domNode(e){this.container=e}get icon(){return null}set icon(e){this._overrideIfSome("icon",e)}get id(){var e;return this._get("id")||((e=this.container)==null?void 0:e.id)||Date.now().toString(16)+"-widget-"+uat++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(UIe=NIe,FIe)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(i8(this),this._projector.scheduleRender())}classes(...e){return qCe.apply(this,e)}renderNow(){i8(this),this._projector.renderNow()}_postInitialize(){var i;if(this.destroyed)return;this.scheduleRender(),(i=this._delegatedEventNames)!=null&&i.length&&this.addHandles(H(()=>this.viewModel,(r,s)=>{s&&this.removeHandles("delegated-events"),r&&kj(r)&&this.addHandles(this._delegatedEventNames.map(n=>ZA(r,n,o=>{this.emit(n,o)})),"delegated-events")},Mt)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(Gce),this.scheduleRender()};this.addHandles([WEe(e),H(()=>this.uiStrings,e),bn(()=>this.container,r=>{this.destroyed||this._attach(r)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){var i;this._attached&&(this._projector.detach(this.render),this._attached=!1),(i=e==null?void 0:e.parentNode)==null||i.removeChild(e)}};co[UIe]=!0,co.vnodeSelector="div",u([p()],co.prototype,"_readyForTrueRender",void 0),u([p({value:null})],co.prototype,"container",null),u([ti("container")],co.prototype,"castContainer",null),u([p()],co.prototype,"icon",null),u([p()],co.prototype,"id",null),u([p()],co.prototype,"label",null),u([p()],co.prototype,"renderable",null),u([p()],co.prototype,"uiStrings",void 0),u([p()],co.prototype,"viewModel",void 0),u([p({value:!0})],co.prototype,"visible",null),u([p()],co.prototype,"key",void 0),u([p()],co.prototype,"children",void 0),u([p()],co.prototype,"afterCreate",void 0),u([p()],co.prototype,"afterUpdate",void 0),u([p()],co.prototype,"afterRemoved",void 0),co=u([A(cat)],co);const oT=co;let d5,p5=null;const qC=new Map;async function fJt(t){p5==null&&(d5==null&&(d5=G(()=>import("./Lyr3DWasmPerSceneView-D4VezNWS.js"),__vite__mapDeps([230,96,97]))),p5=await d5);const e=t.view;let i=qC.get(e);i||(i=new p5.default({view:e}),qC.set(e,i));const r=!!e._stage.renderView.renderingContext.capabilities.compressedTextureS3TC,s=!!e._stage.renderView.renderingContext.capabilities.compressedTextureETC;return await i.initializeWasm(r,s),i.add3DTilesLayerView(t)}function dat(t){return qC.get(t)}function mJt(t){const e=t.view,i=qC.get(e);i&&i.remove3DTilesLayerView(t)<1&&(qC.delete(e),qC.size===0&&(d5=null,p5=null))}function Dpe(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function pat(t,e){return t.length!==e.length||t.some((i,r)=>i.text!==e[r].text)}function XM(t,e,i){!i||!e||t.find(r=>r.layerView===e&&r.text===i)||t.push({text:i,layerView:e})}function fat(t){return t.type==="bing-maps"}const Dg=[];let KE=class extends he{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new Ce,this.view=null,this._allLayerViewsChange=i=>{var s;this.removeHandles("suspension"),this.removeHandles("visible-geometry-changed");const r=(s=this.view)==null?void 0:s.allLayerViews;r&&(this.addHandles(r.map(n=>H(()=>{var o;return[n.suspended,(o=n.layer)==null?void 0:o.attributionVisible]},()=>this._updateAttributionItems())).toArray(),"suspension"),r.forEach(n=>{n.declaredClass==="esri.views.3d.layers.Tiles3DLayerView3D"&&this.addHandles(n.on("visible-geometry-changed",()=>this._updateAttributionItems()),"visible-geometry-changed")})),i!=null&&i.removed&&i.removed.forEach(n=>{this._pendingAttributions.delete(n),this._fetchedAttributionData.delete(n)}),this._updateAttributionItems()},this.addHandles([so(()=>{var i;return(i=this.view)==null?void 0:i.allLayerViews},"change",i=>this._allLayerViewsChange(i),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),bn(()=>{var i;return((i=this.view)==null?void 0:i.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){var e;return(e=this.view)!=null&&e.ready?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,i=e==null?void 0:e.allLayerViews;if(Dg.length=0,!e||!i)return void this._clear();i.forEach(s=>{var a,l;if(s.suspended||!((a=s.layer)!=null&&a.attributionVisible))return;const n=s.layer;if(Dpe(n,"user"))return void XM(Dg,s,n.copyright);if(n.hasAttributionData){if(this._fetchedAttributionData.has(s)){const c=this._fetchedAttributionData.get(s);return void(c?XM(Dg,s,this._getDynamicAttribution(c,e,n)):Dpe(n)&&XM(Dg,s,n.copyright))}return void this._fetchAttributionData(s)}const o="portalItem"in n?(l=n.portalItem)==null?void 0:l.accessInformation:void 0;XM(Dg,s,o||n.copyright)});const r=i.find(s=>{var n;return((n=s.layer)==null?void 0:n.type)==="integrated-mesh-3dtiles"});if(this.view&&r){const s=dat(this.view);if(s){const n=s.getAttributionText();for(let o=0;o<n.length;++o)XM(Dg,r,n[o])}}pat(this.items,Dg)&&(this.items.removeAll(),this.items.addMany(Dg)),Dg.length=0,this.notifyChange("state")}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const i=await ff(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const r=i.ok?this._createContributionIndex(i.value,fat(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,r)}this._updateAttributionItems()}_createContributionIndex(e,i){const r=e.contributors,s={};if(!r)return s;for(let n=0;n<r.length;n++){const o=r[n],a=o.coverageAreas;if(!a)return;for(const l of a){const c=l.bbox,h=l.zoomMin-(i&&l.zoomMin?1:0),d=l.zoomMax-(i&&l.zoomMax?1:0),f=new _i({xmin:c[1],ymin:c[0],xmax:c[3],ymax:c[2],spatialReference:Oe.WGS84}),m={extent:iv(f),attribution:o.attribution||"",score:l.score!=null?l.score:100,id:n};for(let g=h;g<=d;g++)s[g]??(s[g]=[]),s[g].push(m)}}return s.maxKey=Math.max.apply(null,Object.keys(s)),s}_getDynamicAttribution(e,i,r){var h;const{extent:s,scale:n}=i;let o=((h=r.tileInfo)==null?void 0:h.scaleToZoom(n))??0;if(o=Math.min(e.maxKey??0,Math.round(o)),!s||o==null||o<=-1)return"";const a=e[o],l=VD(s.center.clone().normalize(),Oe.WebMercator),c=new Set;return a?a.filter(d=>{const f=d.id,m=!c.has(f)&&l&&d.extent&&jD(d.extent,l);return m&&c.add(f),m}).sort((d,f)=>f.score-d.score||d.objectId-f.objectId).map(d=>d.attribution).join(", "):""}};u([p({readOnly:!0,type:Ce})],KE.prototype,"items",void 0),u([p({readOnly:!0})],KE.prototype,"state",null),u([p()],KE.prototype,"view",void 0),KE=u([A("esri.widgets.Attribution.AttributionViewModel")],KE);const VIe=KE,Yo={button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",empty:"esri-widget__content--empty",heading:"esri-widget__heading",interactive:"esri-interactive",loaderAnimation:"esri-widget__loader-animation",panel:"esri-widget--panel",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button"};function jIe(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${String(e)}'`);return{value:gat(t[e])}}}function mat(t){const e=t==null?void 0:t.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function gat(t){return function(e,...i){mat(e)?xZe(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...i)}}function Ev(t){return(e,i)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:i})}}var yat=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},GIe=function(t,e){for(var i=0,r=t.length;i<r;i++){var s=t[i];Array.isArray(s)?GIe(s,e):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=yat(s)),e.push(s))}},vat=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(i.length===1&&typeof i[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:i[0],domNode:null};var s=[];return GIe(i,s),{vnodeSelector:t,properties:e||void 0,children:s,text:void 0,domNode:null}};function ei(t,e,...i){return typeof t!="function"||fB(t)?vat(t,e??null,...i):t(e,...i)}function yJt(...t){return t}const LT="esri-attribution",NT={base:LT,poweredBy:`${LT}__powered-by`,sources:`${LT}__sources`,open:`${LT}--open`,sourcesOpen:`${LT}__sources--open`,link:`${LT}__link`};let jl=class extends oT{constructor(e,i){super(e,i),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(r=>r.forEach(({target:s})=>this._checkSourceTextOverflow(s))),this.itemDelimiter=" | ",this.messages=null,this.viewModel=new VIe}initialize(){this.addHandles(so(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,i)=>(e.includes(i.text)||e.push(i.text),e),[]).join(this.itemDelimiter)}get icon(){return"description"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[NT.open]:this._isOpen};return ei("div",{bind:this,class:this.classes(NT.base,Yo.widget,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return ei("div",{class:NT.poweredBy},"Powered by"," ",ei("a",{class:NT.link,href:"https://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const e=this._isOpen,i=this._isInteractive,r=i?0:void 0,{attributionText:s}=this,n={[NT.sourcesOpen]:e,[Yo.interactive]:i};return ei("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(NT.sources,n),innerHTML:s,tabIndex:r})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let i=!1;const{clientHeight:r,clientWidth:s,scrollWidth:n}=e,o=n>s,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(i=!0),this._isOpen){const l=r<this._prevSourceNodeHeight;this._prevSourceNodeHeight=r,l&&(this._isOpen=!1,i=!0)}i&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};u([p()],jl.prototype,"_isOpen",void 0),u([p()],jl.prototype,"_isInteractive",null),u([p()],jl.prototype,"_attributionTextOverflowed",void 0),u([p()],jl.prototype,"_prevSourceNodeHeight",void 0),u([p({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],jl.prototype,"attributionText",null),u([p()],jl.prototype,"icon",null),u([p()],jl.prototype,"itemDelimiter",void 0),u([p()],jl.prototype,"label",null),u([p(),Ev("esri/widgets/Attribution/t9n/Attribution")],jl.prototype,"messages",void 0),u([p()],jl.prototype,"view",null),u([p({type:VIe})],jl.prototype,"viewModel",void 0),u([jIe()],jl.prototype,"_toggleState",null),jl=u([A("esri.widgets.Attribution")],jl);const _at=jl;function bat(){const t=X("mapview-essential-goto-duration");return t==null?t:t}function wat(t){var e,i;return((e=t==null?void 0:t.spatialReference)==null?void 0:e.isWebMercator)||((i=t==null?void 0:t.spatialReference)==null?void 0:i.isGeographic)||!1}const xat=t=>{let e=class extends t{constructor(...i){super(...i),this.goToOverride=null,this.view=null}callGoTo(i){const{view:r}=this;return Fj(r),this.goToOverride?this.goToOverride(r,i):r.goTo(i.target,i.options)}};return u([p()],e.prototype,"goToOverride",void 0),u([p()],e.prototype,"view",void 0),e=u([A("esri.widgets.support.GoTo")],e),e};let O1=class extends xat(he){constructor(e){super(e),this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._watchForView(Ut)}destroy(){this.view=null}get canShowNorth(){return wat(this.view)}get state(){var e;return!((e=this.view)!=null&&e.ready)||this.view.type==="2d"&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){var e,i;(e=this.view)!=null&&e.ready&&(((i=this.view)==null?void 0:i.type)==="2d"?this.callGoTo({target:{rotation:0},options:{animationMode:"always",duration:bat()}}):this.callGoTo({target:{heading:0}}))}_updateForRotation(e){e!=null&&this._set("orientation",{z:e})}_updateForCamera(e){if(!e)return;const i=-e.heading;this._set("orientation",{x:0,y:0,z:i})}_updateRotationWatcher(e){this.removeAllHandles(),this._watchForView(),e&&this.addHandles(e.type==="2d"?H(()=>e==null?void 0:e.rotation,this._updateForRotation,Ut):H(()=>e==null?void 0:e.camera,this._updateForCamera,Ut))}_watchForView(e){this.addHandles(H(()=>this.view,this._updateRotationWatcher,e))}};u([p({readOnly:!0})],O1.prototype,"canShowNorth",null),u([p({readOnly:!0})],O1.prototype,"orientation",void 0),u([p({readOnly:!0})],O1.prototype,"state",null),u([p()],O1.prototype,"view",void 0),O1=u([A("esri.widgets.Compass.CompassViewModel")],O1);const HIe=O1,Lpe="esri-compass",Npe={base:Lpe,iconContainer:`${Lpe}__icon-container`};let ay=class extends oT{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new HIe,this._reset=()=>{this.viewModel.reset()},this._toRotationTransform=r=>({transform:`rotateZ(${r.z}deg)`})}loadDependencies(){return mL({button:()=>G(()=>Promise.resolve().then(()=>Nle),void 0),icon:()=>G(()=>Promise.resolve().then(()=>oBe),void 0)})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return this.viewModel.state==="rotation"?"arrow-up":"compass-needle"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:i}=this.viewModel,{messages:r}=this;return ei("div",{class:this.classes(Npe.base,Yo.widget)},ei("calcite-button",{class:Yo.widgetButton,disabled:i==="disabled",kind:"neutral",label:r.reset,onclick:this._reset,round:!0,scale:"s",title:r.reset},ei("div",{"aria-hidden":"true",class:Npe.iconContainer,title:r.reset},ei("calcite-icon",{icon:this.icon,styles:this._toRotationTransform(e)}))))}};u([p()],ay.prototype,"goToOverride",null),u([p()],ay.prototype,"icon",null),u([p()],ay.prototype,"label",null),u([p(),Ev("esri/widgets/Compass/t9n/Compass")],ay.prototype,"messages",void 0),u([p()],ay.prototype,"view",null),u([p({type:HIe})],ay.prototype,"viewModel",void 0),ay=u([A("esri.widgets.Compass")],ay);const Sat=ay,Fpe="esri-navigation-toggle",kpe={base:Fpe,isLayoutHorizontal:`${Fpe}--horizontal`};let QE=class extends he{constructor(e){super(e),this._navigationMode="pan",this.view=null}initialize(){this.addHandles(bn(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.navigation)==null?void 0:i.actionMap},()=>this._updateNavigationActionMap()))}destroy(){this.view=null}get state(){var e,i;return(e=this.view)!=null&&e.ready&&((i=this.view)==null?void 0:i.type)==="3d"?"ready":"disabled"}get navigationMode(){return this._navigationMode}set navigationMode(e){this._navigationMode=e,this._updateNavigationActionMap()}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate")}_updateNavigationActionMap(){var r,s;const e=(s=(r=this.view)==null?void 0:r.navigation)==null?void 0:s.actionMap;if(!e)return;const i=this._navigationMode==="pan";e.dragPrimary=i?"pan":"rotate",e.dragSecondary=i?"rotate":"pan"}};u([p({readOnly:!0})],QE.prototype,"state",null),u([p()],QE.prototype,"_navigationMode",void 0),u([p()],QE.prototype,"view",void 0),QE=u([A("esri.widgets.NavigationToggle.NavigationToggleViewModel")],QE);const qIe=QE;let ly=class extends oT{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new qIe,this.toggle=()=>this.viewModel.toggle(),this._panButton=null,this._rotateButton=null,this._toggle=()=>{var s;const r=((s=this.viewModel)==null?void 0:s.navigationMode)==="pan"?this._rotateButton:this._panButton;SZe(r),this.toggle()}}loadDependencies(){return mL({button:()=>G(()=>Promise.resolve().then(()=>Nle),void 0)})}get icon(){return"move"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){var s,n;const e=((s=this.viewModel)==null?void 0:s.state)==="disabled",i=((n=this.viewModel)==null?void 0:n.navigationMode)==="pan",r=this.messages.toggle;return ei("div",{class:this.classes(kpe.base,Yo.widget,{[kpe.isLayoutHorizontal]:this.layout==="horizontal"})},ei("calcite-button",{afterCreate:o=>{this._panButton=o},appearance:i?"outline-fill":"solid",class:Yo.widgetButton,disabled:e,iconStart:"move",kind:"neutral",label:r,onclick:this._toggle,tabIndex:i?void 0:-1,title:r}),ei("calcite-button",{afterCreate:o=>{this._rotateButton=o},appearance:i?"solid":"outline-fill",class:Yo.widgetButton,disabled:e,iconStart:"rotate",kind:"neutral",label:r,onclick:this._toggle,tabIndex:i?-1:void 0,title:r}))}};u([p()],ly.prototype,"icon",null),u([p()],ly.prototype,"label",null),u([p({value:"vertical"})],ly.prototype,"layout",null),u([p(),Ev("esri/widgets/NavigationToggle/t9n/NavigationToggle")],ly.prototype,"messages",void 0),u([p()],ly.prototype,"view",null),u([p({type:qIe})],ly.prototype,"viewModel",void 0),ly=u([A("esri.widgets.NavigationToggle")],ly);const Tat=ly;let I1=class extends he{get canZoomIn(){var r,s,n;if(!((r=this.view)==null?void 0:r.ready))return!1;const i=(n=(s=this.view)==null?void 0:s.constraints)==null?void 0:n.effectiveMaxScale;return i===0||this._scale>i}get canZoomOut(){var s;const{view:e}=this;if(!(e==null?void 0:e.ready))return!1;const r=(s=e.constraints)==null?void 0:s.effectiveMinScale;return r===0||this._scale<r}get _scale(){var i,r,s;const e=(r=(i=this.view)==null?void 0:i.animation)==null?void 0:r.target;return(e&&"then"in e||e==null?void 0:e.scale)??((s=this.view)==null?void 0:s.scale)??0}};u([p({readOnly:!0})],I1.prototype,"canZoomIn",null),u([p({readOnly:!0})],I1.prototype,"canZoomOut",null),u([p()],I1.prototype,"view",void 0),u([p()],I1.prototype,"_scale",null),I1=u([A("esri.widgets.Zoom.ZoomConditions2D")],I1);const Eat=I1;let e2=class extends he{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};u([p({readOnly:!0})],e2.prototype,"canZoomIn",null),u([p({readOnly:!0})],e2.prototype,"canZoomOut",null),u([p()],e2.prototype,"view",void 0),e2=u([A("esri.widgets.Zoom.ZoomConditions3D")],e2);const Cat=e2;let t_=class extends he{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){var e;return this._zoomConditions!=null&&((e=this._zoomConditions)==null?void 0:e.canZoomOut)}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new Eat({view:e}):e.type==="3d"&&(this._zoomConditions=new Cat({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){const e=this.view;this.canZoomIn&&e&&(e.type==="2d"?e.mapViewNavigation.zoomIn():a3(e.goTo({zoomFactor:2})))}zoomOut(){const e=this.view;this.canZoomOut&&e&&(e.type==="2d"?e.mapViewNavigation.zoomOut():a3(e.goTo({zoomFactor:.5})))}};u([p()],t_.prototype,"_zoomConditions",void 0),u([p()],t_.prototype,"canZoomIn",null),u([p()],t_.prototype,"canZoomOut",null),u([p({readOnly:!0})],t_.prototype,"state",null),u([p()],t_.prototype,"view",null),t_=u([A("esri.widgets.Zoom.ZoomViewModel")],t_);const WIe=t_,zpe={base:"esri-zoom",horizontalLayout:"esri-zoom--horizontal"};let cy=class extends oT{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new WIe,this.zoomIn=()=>this.viewModel.zoomIn(),this.zoomOut=()=>this.viewModel.zoomOut()}loadDependencies(){return mL({button:()=>G(()=>Promise.resolve().then(()=>Nle),void 0)})}get icon(){return"magnifying-glass-plus"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e={[zpe.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:i,canZoomOut:r}=this.viewModel,{zoomIn:s,zoomOut:n}=this.messages;return ei("div",{class:this.classes(zpe.base,Yo.widget,e)},ei("calcite-button",{class:Yo.widgetButton,disabled:!i,iconStart:"plus",kind:"neutral",label:s,onclick:this.zoomIn,title:s}),ei("calcite-button",{class:Yo.widgetButton,disabled:!r,iconStart:"minus",kind:"neutral",label:n,onclick:this.zoomOut,title:n}))}};u([p()],cy.prototype,"icon",null),u([p()],cy.prototype,"label",null),u([p({value:"vertical"})],cy.prototype,"layout",null),u([p(),Ev("esri/widgets/Zoom/t9n/Zoom")],cy.prototype,"messages",void 0),u([p()],cy.prototype,"view",null),u([p({type:WIe})],cy.prototype,"viewModel",void 0),cy=u([A("esri.widgets.Zoom")],cy);const $at=cy;function Aat(t){return(t==null?void 0:t.view)!==void 0}let f5=class extends Wnt{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=i=>{this.components.forEach(r=>{const s=this._find(r),n=s==null?void 0:s.widget;Aat(n)&&(n.view=i)})},this._componentsWatcher=(i,r)=>{this._removeComponents(r),this._addComponents(i),this._adjustPadding(i)}}initialize(){this.addHandles([H(()=>this.components,this._componentsWatcher,Ut),H(()=>this.view,this._updateViewAwareWidgets,Ut)])}_add(e,i,r,s,n){let o=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;o=this._createComponent(e)}super._add(o,i,r,s,n)}_removeComponents(e){e.forEach(i=>{const r=this._find(i);r&&(this.remove(r),r.destroy())})}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:i}=this.padding;this.padding=i}}_addComponents(e){this.constructed&&e.forEach(i=>this.add(this._createComponent(i),this._defaultPositionLookup[i]))}_createComponent(e){const i=this._createWidget(e);return new dP({id:e,node:i})}_createWidget(e){const i=this.view;switch(e){case"attribution":return new _at({view:i});case"compass":return new Sat({view:i});case"navigation-toggle":return new Tat({view:i});case"zoom":return new $at({view:i})}}};u([p()],f5.prototype,"components",void 0),f5=u([A("esri.views.ui.DefaultUI")],f5);const kG=f5;let m5=class extends kG{constructor(e){super(e),this.components=["attribution","zoom"]}};u([p()],m5.prototype,"components",void 0),m5=u([A("esri.views.ui.2d.DefaultUI2D")],m5);const ZIe=m5;let gL=class jJ{constructor(e,i,r=""){this.major=e,this.minor=i,this._context=r}lessThan(e,i){return this.major<e||e===this.major&&this.minor<i}greaterEqual(e,i){return!this.lessThan(e,i)}validate(e){if(this.major!==e.major){const i=this._context&&this._context+":",r=this._context&&this._context+" ";throw new U(i+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new jJ(this.major,this.minor,this._context)}static parse(e,i=""){const[r,s]=e.split("."),n=/^\s*\d+\s*$/;if(!(r!=null&&r.match)||!n.test(r))throw new U((i&&i+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!(s!=null&&s.match)||!n.test(s))throw new U((i&&i+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(r,10),a=parseInt(s,10);return new jJ(o,a,i)}},WC=class extends gL{constructor(e,i){super(e,i,"webmap")}};function j8(t){return t!=null&&typeof t=="object"&&"declaredClass"in t&&t.declaredClass==="esri.WebMap"}const YIe=new WC(2,33);var GJ;let g5=GJ=class extends ee{constructor(t){super(t),this.color=new Je([0,0,0,1])}clone(){return new GJ(q({color:this.color}))}};u([p({type:Je,json:{write:!0}})],g5.prototype,"color",void 0),g5=GJ=u([A("esri.webmap.background.ColorBackground")],g5);const zG=g5;let JIe,XIe,KIe,QIe,eRe,tRe,iRe;async function Mat(){const[,{GraphicsView2D:t,GraphicContainer:e,LabelManager:i,MapViewNavigation:r,MagnifierView2D:s,GridView2D:n,Stage:o}]=await Promise.all([G(()=>import("./webglDeps-CZX2TNWu.js"),__vite__mapDeps([130,131,132,133])),G(()=>import("./mapViewDeps-BAxHx3N0.js"),__vite__mapDeps([134,135,53,54,55,56,51,59,136,52,137,138,50,139,131,133,140,141,57,64,142,60,61,62,143,144,145,132,146,72,49,16,12,21,20,147,148,40,149,63,150,151,58,152,68,153,154,155,156,157,158]))]);XIe=t,KIe=e,QIe=i,eRe=r,tRe=s,iRe=n,JIe=o}let Zi=class extends _rt(OCe(t$e(e$e(EMe)))){constructor(e){super(e),this._magnifierView=null,this._gridView=null,this.stage=null,this._resolveWhenReady=[],this.rootLayerViews=new j$({getCollections:()=>{var i,r;return[(i=this.basemapView)==null?void 0:i.baseLayerViews,this.layerViews,(r=this.basemapView)==null?void 0:r.referenceLayerViews]},getChildrenFunction:()=>null}),this.featuresTilingScheme=null,this.graphicsView=null,this.labelManager=null,this.navigation=new $G({actionMap:new Wre({dragTertiary:"none"})}),this.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!0,labelsAnimationTime:125,labelCollisionsEnabled:!0},this.supersampleScreenshotsEnabled=!0,this.supportsGround=!1,this.floors=new Ce,this.grid=null,this.map=null,this.spatialReferenceLocked=!1,this.timeline=new hIe,this.type="2d",this.view2dType=null,this.ui=new ZIe,this.test={takeScreenshot:async i=>Mnt(this._getScreenshotView(i),i)},this.padding={top:0,right:0,bottom:0,left:0},sCe()}destroy(){this.layerViewManager.clear(),this._set("preconditionsReady",!1),this.frameTask=$e(this.frameTask),this.goToManager.destroy(),this.rootLayerViews.destroy(),this.inputManager.destroy(),this._set("inputManager",null)}get graphicsTileStore(){return new Ist(this.featuresTilingScheme)}get constraintsInfo(){var r,s;const e=(r=this.defaultsFromMap)==null?void 0:r.tileInfo,i=this.spatialReference;return{lods:(s=e==null?void 0:e.spatialReference)!=null&&s.equals(i)?e.lods:null,spatialReference:i}}get initialExtentRequired(){var a;if(!this.stateManager)return!1;const{scale:e,constraints:i,center:r,viewpoint:s,extent:n}=this;let o=this.zoom;return!(this.map&&"initialViewProperties"in this.map&&((a=this.map.initialViewProperties)!=null&&a.viewpoint))&&!n&&(i!=null&&i.effectiveLODs||(o=-1),(!r||e===0&&o===-1)&&((s==null?void 0:s.targetGeometry)==null||s.targetGeometry.type!=="extent"&&!s.scale))}get defaultsFromMapSettings(){return{required:{extent:!1,heightModelInfo:!1,tileInfo:!0},requiresExtentInSpatialReference:this.spatialReferenceLocked}}get scheduler(){return this.frameTask.scheduler}get typeSpecificPreconditionsReady(){const e=this._getDefaultViewpoint();if(!e)return!1;const i=e.targetGeometry,r=this.spatialReference;return V_(i.spatialReference,r)}get background(){return j8(this.map)?this.map.initialViewProperties.background:null}set background(e){this._override("background",e)}get center(){var e;return((e=this.stateManager)==null?void 0:e.center)??null}set center(e){this.stateManager.center=e}get highlightOptions(){return lnt(this)}set highlightOptions(e){cnt(this,e)}get padding(){var e;return(e=this.stateManager)==null?void 0:e.padding}set padding(e){this.stateManager&&(this.stateManager.padding=e)}get rendering(){var e;return((e=this.stage)==null?void 0:e.renderRequested)??!1}get resolution(){return this.stateManager.resolution??0}get scale(){var e;return((e=this.stateManager)==null?void 0:e.scale)??0}set scale(e){this.stateManager&&(this.stateManager.scale=e)}get tileInfo(){var e;return(e=this.featuresTilingScheme)==null?void 0:e.tileInfo}get updating(){var r,s,n,o;const e=!(!this.magnifier.visible||this.magnifier.position===null||!((r=this._magnifierView)!=null&&r.updatingHandles.updating)),i=!this.destroyed&&(!this.layerViewManager||!this.labelManager||!this.graphicsView||this.layerViewManager.updating===!0||this.labelManager.updating===!0||this.graphicsView.updating===!0||this.allLayerViews.some(a=>!a.destroyed&&!("layerViews"in a)&&a.updating===!0)||e);if(X("esri-2d-log-updating")){const a=this.allLayerViews.reduce((l,c)=>({...l,[`${c.layer.id}(${c.layer.type})`]:!c.destroyed&&!("layerViews"in c)&&c.updating}),{});console.log(`Updating MapView: ${i}
-> Null LayerViewManager: ${!this.layerViewManager}
-> Null LabelManager: ${!this.labelManager}
-> Null GraphicsView: ${!this.graphicsView}
-> layerViewManager.updating: ${(s=this.layerViewManager)==null?void 0:s.updating}
-> labelManager.updating: ${(n=this.labelManager)==null?void 0:n.updating}
-> graphicsView.updating: ${(o=this.graphicsView)==null?void 0:o.updating}
-> allLayerViews: ${JSON.stringify(a)}
-> updatingMagnifier: ${e}
`)}return i}get visibleArea(){const e=this.stateManager.visibleArea;return e&&new Ea({rings:[e.map(i=>[i[0],i[1]])],spatialReference:this.spatialReference})}get zoom(){return this.stateManager.zoom??-1}set zoom(e){this.stateManager.zoom=e}get navigating(){var e;return((e=this.mapViewNavigation)==null?void 0:e.interacting)??!1}async hitTest(e,i){return unt(this,e,i)}async takeScreenshot(e){return Ant(this._getScreenshotView(e),e)}toMap(e){if(!this.ready)return null;const i=QU(e)?KU(this,e):e;return this.stateManager.toMap(i)}toScreen(e,i){return this.stateManager.toScreen(e,i)}whenLayerView(e){return super.whenLayerView(e)}graphicChanged(e){this.graphicsView&&this.graphicsView.graphicUpdateHandler(e)}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var e;return this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties.spatialReference||((e=this.defaultsFromMap)==null?void 0:e.spatialReference)||null}getDefaultTimeZone(){return j8(this.map)?this.map.initialViewProperties.timeZone:null}getDefaultTimeExtent(){return j8(this.map)?this.map.initialViewProperties.timeExtent:null}hasLayerViewModule(e){return Yde.hasLayerViewModule(e)}importLayerView(e){return Yde.importLayerView(e)}pixelSizeAt(){return this.ready?this.resolution:(J.getLogger(this).error("#pixelSizeAt()","Map view cannot be used before it is ready"),null)}async popupHitTest(e){var c;const i=this.toMap(e),r=await this.hitTest(e),s=this.allLayerViews.toArray().filter(h=>h.clips.every(d=>JOe(this,d,e,i))).reverse(),n=new globalThis.Map(s.map(h=>[h.layer.uid,h])),o=[];let a=0,l=0;for(;a<r.results.length||l<s.length;){const h=r.results.at(a);if(h&&h.type!=="graphic"){++a;continue}const d=n.get((c=(h==null?void 0:h.layer)??(h==null?void 0:h.graphic.layer))==null?void 0:c.uid);if((!h||d)&&l<s.length&&s.at(l)!==d){const f=s.at(l);"fetchPopupFeaturesAtLocation"in f&&o.push({mapPoint:i,layerView:f}),++l}else h&&(o.push({graphic:h.graphic,layerView:d}),++a)}return{hits:o,location:i}}requestUpdate(){this.ready&&this.frameTask.requestUpdate()}async validate(){let e=pIe(this.type);if(X("safari")&&X("safari")<9&&(e=new U("mapview:browser-not-supported","This browser is not supported by MapView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:X("safari")})),e!=null)throw J.getLogger(this).warn("#validate()",e.message),e}loadAsyncDependencies(){return Mat()}_getDefaultViewpoint(){var _;const{constraints:e,initialExtent:i,map:r,padding:s,size:n}=this;if(!e)return null;const o=r&&"initialViewProperties"in r?r.initialViewProperties:void 0,a=this.stateManager.getUserStartupOptions(this.size),l=o==null?void 0:o.viewpoint,c=((_=l==null?void 0:l.targetGeometry)==null?void 0:_.extent)??i,h=c==null?void 0:c.center,d=(l==null?void 0:l.rotation)??0,f=(l==null?void 0:l.scale)||c&&OG(c,[n[0]-s.left-s.right,n[1]-s.top-s.bottom]),m=a.center??h,g=a.rotation??d,v=a.scale??f;return m&&v?new Qr({targetGeometry:m,scale:v,rotation:g}):null}_startup(){var a;this.timeline.begin("MapView Startup");const e=this._getDefaultViewpoint();this.stateManager.startup(e,this.size,this.spatialReference,(a=this.defaultsFromMap.extent)==null?void 0:a.center),this.graphics.owner=this;const i=new JIe(this.surface,{canvas:this.renderCanvas,contextOptions:{disabledExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions},renderingOptions:this.renderingOptions,timeline:this.timeline});this.stage=i,this._magnifierView=new tRe,this._magnifierView.magnifier=this.magnifier,this._gridView=new iRe;const r=new QIe({view:this});this._set("labelManager",r);const s=new pst({view:this});this._set("animationManager",s);const n=new eRe({view:this,animationManager:s});this._set("mapViewNavigation",n),this._setupSpatialReferenceDependentProperties(),this.addHandles([this.rootLayerViews.on("change",()=>this._updateStageChildren()),i.on("webgl-error",l=>this.fatalError=l.error),H(()=>this.stationary,l=>i.stationary=l,Mt),H(()=>this.background,l=>{i.backgroundColor=l==null?void 0:l.color,this._magnifierView.backgroundColor=l==null?void 0:l.color},Mt),H(()=>this.magnifier,l=>this._magnifierView.magnifier=l,Mt),H(()=>this.grid,l=>this._gridView.grid=l,Mt),H(()=>this.renderingOptions,l=>i.renderingOptions=l,Mt),H(()=>this.highlights.items.map(l=>({name:l.name,options:{fillColor:l.color,haloColor:l.haloColor,fillOpacity:l.fillOpacity,haloOpacity:l.haloOpacity,haloWidth:l.haloWidth,haloBlur:l.haloBlur}})),()=>{i.highlightGradient=ont(i.highlightGradient,this.highlights.items)},Mt),H(()=>this.state.id,()=>i.state=this.state,Mt)],"map-view"),this._updateStageChildren();const o=this._resolveWhenReady;this._resolveWhenReady=[],o.forEach(l=>l(this)),this.timeline.end("MapView Startup"),this.frameTask.start(),this._set("ready",!0)}_teardown(){this._destroySpatialReferenceDependentProperties(),this.removeHandles("map-view"),this.mapViewNavigation.destroy(),this._set("mapViewNavigation",null),this.animation=null,this.animationManager.destroy(),this._set("animationManager",null),this.layerViewManager.clear(),this.labelManager.destroy(),this._magnifierView.destroy(),this._gridView.destroy(),this.stage.destroy(),this.stage=null,this._set("graphicsView",null),this._magnifierView=null,this._gridView=null,this._set("labelManager",null),this._set("mapViewNavigation",null),this.graphics.owner=null,this.frameTask.stop(),this.stationaryManager.clear(),this._set("ready",!1),this.stateManager.teardown()}_updateStageChildren(){this.stage.removeAllChildren(),this.rootLayerViews.forEach(i=>{this.stage.addChild(i.container)});const e=this.graphicsView;this.stage.addChild(e.container),this.stage.addChild(this._magnifierView),this.stage.addChild(this._gridView)}_setupSpatialReferenceDependentProperties(){const e=new _st(QR.create({spatialReference:this.spatialReference,size:512,numLODs:36}));this._set("featuresTilingScheme",e);const i=new XIe({view:this,graphics:this.graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new KIe(e)});this._set("graphicsView",i)}_destroySpatialReferenceDependentProperties(){const e=this.graphicsView;this._set("graphicsView",null),e.destroy(),this._set("featuresTilingScheme",null)}_getScreenshotView(e){var o;const{allLayerViews:i,padding:r,size:s,stage:n}=this;return{allLayerViews:i,backgroundColor:e!=null&&e.ignoreBackground?null:(o=this.background)==null?void 0:o.color,padding:r,size:s,stage:n}}_spatialReferenceChanged(e){if(this.ready){this.frameTask.stop();for(const i of this.allLayerViews)i.processDetach();this._destroySpatialReferenceDependentProperties(),this.stateManager.changeSpatialReference(e),this.stage.state=this.state,this._setupSpatialReferenceDependentProperties();for(const i of this.allLayerViews)i.processAttach();this.frameTask.requestFrame(),this.frameTask.start(),this._updateStageChildren()}}};Zi.type="2d",u([p({constructOnly:!0})],Zi.prototype,"deactivatedWebGLExtensions",void 0),u([p({constructOnly:!0})],Zi.prototype,"debugWebGLExtensions",void 0),u([p({readOnly:!0})],Zi.prototype,"featuresTilingScheme",void 0),u([p({readOnly:!0})],Zi.prototype,"graphicsTileStore",null),u([p()],Zi.prototype,"graphicsView",void 0),u([p()],Zi.prototype,"constraintsInfo",null),u([p()],Zi.prototype,"initialExtentRequired",null),u([p()],Zi.prototype,"labelManager",void 0),u([p({type:$G,nonNullable:!0})],Zi.prototype,"navigation",void 0),u([p({constructOnly:!0})],Zi.prototype,"renderCanvas",void 0),u([p()],Zi.prototype,"renderingOptions",void 0),u([p({constructOnly:!0})],Zi.prototype,"supersampleScreenshotsEnabled",void 0),u([p({readOnly:!0})],Zi.prototype,"supportsGround",void 0),u([p()],Zi.prototype,"defaultsFromMapSettings",null),u([p({readOnly:!0})],Zi.prototype,"typeSpecificPreconditionsReady",null),u([p({type:zG})],Zi.prototype,"background",null),u([p()],Zi.prototype,"center",null),u([p({type:Ce})],Zi.prototype,"floors",void 0),u([p()],Zi.prototype,"grid",void 0),u([p({type:Gm})],Zi.prototype,"highlightOptions",null),u([p()],Zi.prototype,"map",void 0),u([p()],Zi.prototype,"padding",null),u([p({readOnly:!0})],Zi.prototype,"rendering",null),u([p({readOnly:!0})],Zi.prototype,"resolution",null),u([p()],Zi.prototype,"scale",null),u([p({constructOnly:!0})],Zi.prototype,"spatialReferenceLocked",void 0),u([p({readOnly:!0})],Zi.prototype,"tileInfo",null),u([p({type:hIe,readOnly:!0})],Zi.prototype,"timeline",void 0),u([p({readOnly:!0})],Zi.prototype,"type",void 0),u([p({readOnly:!0})],Zi.prototype,"updating",null),u([p({readOnly:!0})],Zi.prototype,"view2dType",void 0),u([p({readOnly:!0})],Zi.prototype,"visibleArea",null),u([p()],Zi.prototype,"zoom",null),u([p({readOnly:!0})],Zi.prototype,"navigating",null),u([p(),ti(t=>t instanceof kG?t:GA(ZIe,t))],Zi.prototype,"ui",void 0),Zi=u([A("esri.views.View2D")],Zi);const Oat=Zi;let y5=class extends Oat{constructor(e){super(e),this.view2dType="map"}};u([p({readOnly:!0})],y5.prototype,"view2dType",void 0),y5=u([A("esri.views.MapView")],y5);const Iat=y5;function rRe(t,e){const i=Ml(t),r=Ml(e),s=i.store,n=r.store,o=r.metadata;for(const a in o){const l=o[a],c=s.originOf(a),h=n.originOf(a);if(!l.readOnly&&h!==Oi.DEFAULTS)if(c===Oi.DEFAULTS)t.set(a,n.get(a));else{const d=s.get(a),f=n.get(a);d&&f&&f instanceof he&&d instanceof he&&d instanceof f.constructor&&rRe(d,f)}}}function Ese(t,e,i,r){return t!=null&&(as(e,r)?(Lb(i,t),!0):(bc[0]=t[0],bc[1]=t[1],bc[2]=0,!!Gn(bc,e,0,bc,r,0)&&(i[0]=bc[0],i[1]=bc[1],bc[0]=t[2],bc[1]=t[3],bc[2]=0,!!Gn(bc,e,0,bc,r,0)&&(i[2]=bc[0],i[3]=bc[1],!0))))}const bc=$();function gc(t,e,i,r){if(lu(t.spatialReference,i)){GN[0]=t.x,GN[1]=t.y;const n=t.z;return GN[2]=n??r??0,Gn(GN,t.spatialReference,0,e,i,0)}const s=Ub(t,i);return!!s&&(e[0]=s==null?void 0:s.x,e[1]=s==null?void 0:s.y,e[2]=(s==null?void 0:s.z)??r??0,!0)}async function mB(t,e,i,r,s){return await XD(t.spatialReference,i,null,s),gc(t,e,i,r)}const GN=$();let jv=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&R$(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*Upe);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,Upe));e++)this._items.push(this._allocator())}};const Upe=1024;function qe(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function sRe(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function Cse(t,e,i,r,s,n,o,a,l,c,h,d,f,m,g,v){return[t,e,i,r,s,n,o,a,l,c,h,d,f,m,g,v]}function Rat(t,e){return new Float64Array(t,e,16)}const eo=qe();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:eo,clone:sRe,create:qe,createView:Rat,fromValues:Cse},Symbol.toStringTag,{value:"Module"}));function Ts(){return[1,0,0,0,1,0,0,0,1]}function nRe(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function oRe(t,e,i,r,s,n,o,a,l){return[t,e,i,r,s,n,o,a,l]}function Pat(t,e){return new Float64Array(t,e,9)}const aT=Ts();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:aT,clone:nRe,create:Ts,createView:Pat,fromValues:oRe},Symbol.toStringTag,{value:"Module"}));function zd(){return[0,0,0,1]}function Dat(t){return[t[0],t[1],t[2],t[3]]}function Lat(t,e,i,r){return[t,e,i,r]}const $se=zd();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:$se,clone:Dat,create:zd,fromValues:Lat},Symbol.toStringTag,{value:"Module"}));function yi(){return[0,0,0,0]}function UG(t){return[t[0],t[1],t[2],t[3]]}function Yi(t,e,i,r){return[t,e,i,r]}function D3(t,e,i,r){return[t,e,i,r]}function Ase(t,e=yi()){const i=Math.min(4,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function Nat(t,e){return new Float64Array(t,e,4)}function aRe(){return yi()}function lRe(){return Yi(1,1,1,1)}function cRe(){return Yi(1,0,0,0)}function uRe(){return Yi(0,1,0,0)}function hRe(){return Yi(0,0,1,0)}function dRe(){return Yi(0,0,0,1)}const an=aRe(),Mse=lRe(),Fat=cRe(),kat=uRe(),zat=hRe(),Uat=dRe();Object.freeze(Object.defineProperty({__proto__:null,ONES:Mse,UNIT_W:Uat,UNIT_X:Fat,UNIT_Y:kat,UNIT_Z:zat,ZEROS:an,clone:UG,create:yi,createView:Nat,freeze:D3,fromArray:Ase,fromValues:Yi,ones:lRe,unitW:dRe,unitX:cRe,unitY:uRe,unitZ:hRe,zeros:aRe},Symbol.toStringTag,{value:"Module"}));let hM=class R1{constructor(e){this._create=e,this._items=new Array,this._itemsPtr=0}get(){return this._itemsPtr===0&&R$(()=>this._reset()),this._itemsPtr>=this._items.length&&this._items.push(this._create()),this._items[this._itemsPtr++]}_reset(){const e=2*this._itemsPtr;this._items.length>e&&(this._items.length=e),this._itemsPtr=0}static createVec2f64(){return new R1(Ye)}static createVec3f64(){return new R1($)}static createVec4f64(){return new R1(yi)}static createMat3f64(){return new R1(Ts)}static createMat4f64(){return new R1(qe)}static createQuatf64(){return new R1(zd)}get test(){}};const PJt=hM.createVec2f64(),Le=hM.createVec3f64(),Ose=hM.createVec4f64();hM.createMat3f64();const Ise=hM.createMat4f64(),Bat=hM.createQuatf64();function Gv(t){return t?{origin:os(t.origin),vector:os(t.vector)}:{origin:$(),vector:$()}}function pRe(t,e){const i=Gat.get();return i.origin=t,i.vector=e,i}function DJt(t,e=Gv()){return Vat(t.origin,t.vector,e)}function Vat(t,e,i=Gv()){return ne(i.origin,t),ne(i.vector,e),i}function v5(t,e,i=Gv()){return ne(i.origin,t),be(i.vector,e,t),i}function fRe(t,e){const i=be(Le.get(),e,t.origin),r=fe(t.vector,i),s=fe(t.vector,t.vector),n=ue(r/s,0,1),o=be(Le.get(),re(Le.get(),t.vector,n),i);return fe(o,o)}function LJt(t,e,i){return HJ(t,e,0,1,i)}function NJt(t,e,i){return oe(i,t.origin,re(i,t.vector,e))}function HJ(t,e,i,r,s){const{vector:n,origin:o}=t,a=be(Le.get(),e,o),l=fe(n,a)/Xo(n);return re(s,n,ue(l,i,r)),oe(s,s,t.origin)}function FJt(t,e){if(mRe(t,pRe(e.origin,e.direction),!1,gB)){const{tA:i,pB:r,distance2:s}=gB;if(i>=0&&i<=1)return s;if(i<0)return no(t.origin,r);if(i>1)return no(oe(Le.get(),t.origin,t.vector),r)}return null}function jat(t,e,i){return!!mRe(t,e,!0,gB)&&(ne(i,gB.pA),!0)}function mRe(t,e,i,r){const n=t.origin,o=oe(Le.get(),n,t.vector),a=e.origin,l=oe(Le.get(),a,e.vector),c=Le.get(),h=Le.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],h[0]=l[0]-a[0],h[1]=l[1]-a[1],h[2]=l[2]-a[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const d=Le.get();if(d[0]=o[0]-n[0],d[1]=o[1]-n[1],d[2]=o[2]-n[2],Math.abs(d[0])<1e-6&&Math.abs(d[1])<1e-6&&Math.abs(d[2])<1e-6)return!1;const f=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],m=h[0]*d[0]+h[1]*d[1]+h[2]*d[2],g=c[0]*d[0]+c[1]*d[1]+c[2]*d[2],v=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],_=(d[0]*d[0]+d[1]*d[1]+d[2]*d[2])*v-m*m;if(Math.abs(_)<1e-6)return!1;let b=(f*m-g*v)/_,w=(f+m*b)/v;i&&(b=ue(b,0,1),w=ue(w,0,1));const x=Le.get(),S=Le.get();return x[0]=n[0]+b*d[0],x[1]=n[1]+b*d[1],x[2]=n[2]+b*d[2],S[0]=a[0]+w*h[0],S[1]=a[1]+w*h[1],S[2]=a[2]+w*h[2],r.tA=b,r.tB=w,r.pA=x,r.pB=S,r.distance2=no(x,S),!0}const gB={tA:0,tB:0,pA:$(),pB:$(),distance2:0},Gat=new jv(()=>Gv());function xd(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Hat(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function ss(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}function Rse(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function gRe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function yRe(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function vRe(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function qat(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function Wat(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function Zat(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t}function Yat(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t}function Jat(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function hA(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function Xat(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}function _Re(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return Math.sqrt(i*i+r*r+s*s+n*n)}function yB(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return i*i+r*r+s*s+n*n}function Pse(t){const e=t[0],i=t[1],r=t[2],s=t[3];return Math.sqrt(e*e+i*i+r*r+s*s)}function BG(t){const e=t[0],i=t[1],r=t[2],s=t[3];return e*e+i*i+r*r+s*s}function Kat(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function Qat(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function bRe(t,e){const i=e[0],r=e[1],s=e[2],n=e[3];let o=i*i+r*r+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),t[0]=i*o,t[1]=r*o,t[2]=s*o,t[3]=n*o),t}function wRe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function VG(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=e[3];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t[2]=o+r*(i[2]-o),t[3]=a+r*(i[3]-a),t}function elt(t,e=1){const i=tL;let r,s,n,o,a,l;do r=2*i()-1,s=2*i()-1,a=r*r+s*s;while(a>=1);do n=2*i()-1,o=2*i()-1,l=n*n+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return t[0]=e*r,t[1]=e*s,t[2]=e*n*c,t[3]=e*o*c,t}function eu(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3];return t[0]=i[0]*r+i[4]*s+i[8]*n+i[12]*o,t[1]=i[1]*r+i[5]*s+i[9]*n+i[13]*o,t[2]=i[2]*r+i[6]*s+i[10]*n+i[14]*o,t[3]=i[3]*r+i[7]*s+i[11]*n+i[15]*o,t}function tlt(t,e,i){const r=e[0],s=e[1],n=e[2],o=i[0],a=i[1],l=i[2],c=i[3],h=c*r+a*n-l*s,d=c*s+l*r-o*n,f=c*n+o*s-a*r,m=-o*r-a*s-l*n;return t[0]=h*c+m*-o+d*-l-f*-a,t[1]=d*c+m*-a+f*-o-h*-l,t[2]=f*c+m*-l+h*-a-d*-o,t[3]=e[3],t}function ilt(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function tS(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function $S(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],h=To();return Math.abs(i-o)<=h*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=h*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=h*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=h*Math.max(1,Math.abs(n),Math.abs(c))}const rlt=gRe,slt=yRe,nlt=vRe,olt=_Re,alt=yB,llt=Pse,clt=BG,xRe=Object.freeze(Object.defineProperty({__proto__:null,add:Rse,ceil:qat,copy:xd,copyVec3:Hat,dist:olt,distance:_Re,div:nlt,divide:vRe,dot:wRe,equals:$S,exactEquals:tS,floor:Wat,inverse:Qat,len:llt,length:Pse,lerp:VG,max:Yat,min:Zat,mul:slt,multiply:yRe,negate:Kat,normalize:bRe,random:elt,round:Jat,scale:hA,scaleAndAdd:Xat,set:ss,sqrDist:alt,sqrLen:clt,squaredDistance:yB,squaredLength:BG,str:ilt,sub:rlt,subtract:gRe,transformMat4:eu,transformQuat:tlt},Symbol.toStringTag,{value:"Module"}));function kJt(t,e,i){const r=fe(t,e)/fe(t,t);return re(i,t,r)}function Sb(t,e){return fe(t,e)/Ee(t)}function Dse(t,e){const i=fe(t,e)/(Ee(t)*Ee(e));return-Ja(i)}function SRe(t,e,i){ae(HN,t),ae(G8,e);const r=fe(HN,G8),s=Ja(r),n=ct(HN,HN,G8);return fe(n,i)<0?2*Math.PI-s:s}const HN=$(),G8=$();function L3(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],i=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],r=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,i,r))}function zJt(t,e){const i=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),r=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),s=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return se(t,i,r,s),t}function UJt(t,e,i){i=i||t;const r=fe(t,e);se(i,t[0]-r*e[0],t[1]-r*e[1],t[2]-r*e[2]),ae(i,i)}function ult(t,e,i){Math.abs(t[0])>Math.abs(t[1])?se(e,0,1,0):se(e,1,0,0),ct(i,t,e),ct(e,i,t),ae(i,i),ae(e,e)}function qN(t,e,i,r,s,n){const o=t+(e-t)*s;return o+(i+(r-i)*s-o)*n}function TRe(t,e,i,r=$()){const s=Ee(t),n=Ee(e),o=fe(t,e)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-i)*s+i*n)/Math.sin(a),c=l/s*Math.sin((1-i)*a),h=l/n*Math.sin(i*a);return re(Ix,t,c),re(Rx,e,h),oe(r,Ix,Rx)}return fr(r,t,e,i)}function BJt(t,e,i,r=$(),s=$()){const n=Ee(t),o=Ee(e),a=fe(t,e)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),h=Math.sin(i*l),d=Math.sin((1-i)*l),f=(1-i)*n+i*o;{const m=f/c,g=m/o*h;re(Ix,t,m/n*d),re(Rx,e,g),oe(r,Ix,Rx)}{const m=1/n*(-Math.cos((1-i)*l)*l*f+d*(-n+o));re(Ix,t,m);const g=1/o*(Math.cos(i*l)*l*f+h*(-n+o));re(Rx,e,g),oe(s,Ix,Rx),re(s,s,1/c)}return s}return fr(r,t,e,i),be(s,e,t),ae(s,s),s}function jG(t,e,i){t=ae(Ix,t),e=ae(Rx,e);const r=Ja(fe(t,e));if(i){const s=ct(hlt,t,e);if(fe(s,i)<0)return-r}return r}function _5(t){const e=t.length;return i=>{if(i<=t[0][0])return t[0][1];if(i>=t[e-1][0])return t[e-1][1];let r=1;for(;i>t[r][0];)r++;const s=t[r-1][0],n=t[r][0],o=(n-i)/(n-s);return o*t[r-1][1]+(1-o)*t[r][1]}}function VJt(t,e,i,r){be(Bpe,e,t),be(Vpe,i,t),ct(r,Bpe,Vpe),ae(r,r),r[3]=-fe(t,r)}function jJt(t,e){if(se(e,0,0,0),t.length>0){for(let i=0;i<t.length;++i)oe(e,e,t[i]);re(e,e,1/t.length)}}const Bpe=$(),Vpe=$(),hlt=$(),Ix=$(),Rx=$();function Gr(t=NI){return[t[0],t[1],t[2],t[3]]}function dlt(t=NI[0],e=NI[1],i=NI[2],r=NI[3]){return Uy(t,e,i,r,Ose.get())}function Lse(t,e){return Uy(e[0],e[1],e[2],e[3],t)}function GJt(t){return t}function Uy(t,e,i,r,s=Gr()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function ERe(t,e,i){return ne(i,t),i[3]=e,i}function dA(t,e,i){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function Gp(t,e,i,r=Gr()){const s=i[0]-e[0],n=i[1]-e[1],o=i[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],h=n*c-o*l,d=o*a-s*c,f=s*l-n*a,m=h*h+d*d+f*f,g=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return r[0]=h*g,r[1]=d*g,r[2]=f*g,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function Nse(t,e,i,r=0,s=Math.floor(i*(1/3)),n=Math.floor(i*(2/3))){if(i<3)return!1;e(KM,r);let o=s,a=!1;for(;o<i-1&&!a;)e(FT,o),o++,a=!to(KM,FT);if(!a)return!1;for(o=Math.max(o,n),a=!1;o<i&&!a;)e(fx,o),o++,be(WN,KM,FT),ae(WN,WN),be(ZN,FT,fx),ae(ZN,ZN),a=!to(KM,fx)&&!to(FT,fx)&&Math.abs(fe(WN,ZN))<plt;return a?(Gp(KM,FT,fx,t),!0):(r!==0||s!==1||n!==2)&&Nse(t,e,i,0,1,2)}function HJt(t,e,i=!0){const r=e.length/3;return Nse(t,(s,n)=>se(s,e[3*n+0],e[3*n+1],e[3*n+2]),i?r-1:r)}const plt=.99619469809,KM=$(),FT=$(),fx=$(),WN=$(),ZN=$();function qJ(t,e,i){return e!==t&&Lse(t,e),t[3]=-fe(t,i),t}function flt(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function WJ(t,e,i,r){return ct(fx,e,t),dA(i,fx,r)}function qJt(t,e,i,r){return GG(yL(t,e,be(Le.get(),i,e),blt,r))}function dM(t,e,i){return e!=null&&GG(yL(t,e.origin,e.direction,wlt,i))}function CRe(t,e,i){return GG(yL(t,e.origin,e.vector,lf.NONE,i))}function mlt(t,e,i){return GG(yL(t,e.origin,e.vector,lf.CLAMP,i))}function vB(t,e){return on(t,e)>=0}function glt(t,e){const i=fe(t,e.ray.direction),r=-on(t,e.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const s=r/i;return i>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function ylt(t,e){const i=fe(t,e.ray.direction),r=-on(t,e.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const s=r/i;return i>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function vlt(t,e,i){const r=re(Le.get(),t,-t[3]),s=_lt(t,be(Le.get(),e,r),Le.get());return oe(i,s,r),i}function WJt(t,e,i,r){const s=t,n=Le.get(),o=Le.get();ult(s,n,o);const a=be(Le.get(),i,e),l=Sb(n,a),c=Sb(o,a),h=Sb(s,a);return se(r,l,c,h)}function _lt(t,e,i){const r=re(Le.get(),t,fe(t,e));return be(i,e,r),i}function ZJt(t,e){return Math.abs(on(t,e))}function on(t,e){return fe(t,e)+t[3]}var nc;function GG(t){return t===nc.INTERSECTS_INSIDE_OUT||t===nc.INTERSECTS_OUTSIDE_IN}function yL(t,e,i,r,s){const n=fe(t,i),o=on(t,e);if(n===0)return o>=0?nc.INSIDE:nc.OUTSIDE;let a=-o/n;return r&lf.CLAMP&&(a=ue(a,0,1)),!(r&lf.INFINITE_MIN)&&a<0||!(r&lf.INFINITE_MAX)&&a>1?o>=0?nc.INSIDE:nc.OUTSIDE:(oe(s,e,re(s,i,a)),o>=0?nc.INTERSECTS_INSIDE_OUT:nc.INTERSECTS_OUTSIDE_IN)}(function(t){t[t.INTERSECTS_INSIDE_OUT=0]="INTERSECTS_INSIDE_OUT",t[t.INTERSECTS_OUTSIDE_IN=1]="INTERSECTS_OUTSIDE_IN",t[t.INSIDE=2]="INSIDE",t[t.OUTSIDE=3]="OUTSIDE"})(nc||(nc={}));const NI=[0,0,1,0];var lf;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(lf||(lf={}));const blt=lf.INFINITE_MIN|lf.INFINITE_MAX,wlt=lf.INFINITE_MAX;function Nn(t){return t?jpe(os(t.origin),os(t.direction)):jpe($(),$())}function jpe(t,e){return{origin:t,direction:e}}function YJt(t,e){return eg(t.origin,e.origin)&&eg(t.direction,e.direction)}function wf(t,e){const i=Tlt.get();return i.origin=t,i.direction=e,i}function _B(t,e=Nn()){return Fse(t.origin,t.direction,e)}function $Re(t,e,i=Nn()){return ne(i.origin,t),be(i.direction,e,t),i}function Fse(t,e,i=Nn()){return ne(i.origin,t),ne(i.direction,e),i}function xlt(t,e){const i=ct(Le.get(),ae(Le.get(),t.direction),be(Le.get(),e,t.origin));return fe(i,i)}function Slt(t,e,i){const r=fe(t.direction,be(i,e,t.origin));return oe(i,t.origin,re(i,t.direction,r)),i}function JJt(t,e,i,r){const s=t.origin,n=e.origin,o=t.direction,a=e.direction,l=fe(ae(q8,o),ae(Gpe,a));if(Math.abs(l)>=1)return null;const c=ct(q8,o,a),h=Fi(H8,n,s),d=aL(Hpe,o[0],o[1],o[2],-a[0],-a[1],-a[2],c[0],c[1],c[2]),f=lL(Hpe,d);if(f==null)return[i,r];const m=fe(se(q8,f[0],f[3],f[6]),h),g=fe(se(Gpe,f[1],f[4],f[7]),h);return oe(i,s,re(H8,o,m)),oe(r,n,re(H8,a,g)),[i,r]}const Tlt=new jv(()=>Nn()),H8=$(),q8=$(),Gpe=$(),Hpe=Ts(),W8=()=>J.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let Elt=class{constructor(){this.plane=Gr(),this.origin=$(),this.basis1=$(),this.basis2=$()}};const ARe=Elt;function lw(t=zRe){return{plane:Gr(t.plane),origin:os(t.origin),basis1:os(t.basis1),basis2:os(t.basis2)}}function Clt(t,e,i){const r=Ult.get();return r.origin=t,r.basis1=e,r.basis2=i,r.plane=dlt(0,0,0,0),HG(r),r}function lT(t,e=lw()){return kse(t.origin,t.basis1,t.basis2,e)}function $lt(t,e){ne(e.origin,t.origin),ne(e.basis1,t.basis1),ne(e.basis2,t.basis2),Lse(e.plane,t.plane)}function kse(t,e,i,r=lw()){return ne(r.origin,t),ne(r.basis1,e),ne(r.basis2,i),HG(r),klt(r,"fromValues()"),r}function HG(t){WJ(t.basis2,t.basis1,t.origin,t.plane)}function MRe(t,e,i){t!==i&&lT(t,i);const r=re(Le.get(),Cv(t),e);return oe(i.origin,i.origin,r),i.plane[3]-=e,i}function Alt(t,e,i){return ORe(e,i),MRe(i,Vse(t,t.origin),i),i}function Mlt(t,e){const i=t.basis1[0],r=t.basis2[1],[s,n]=t.origin;return Nie(s-i,n-r,s+i,n+r,e)}function ORe(t,e=lw()){const i=(t[2]-t[0])/2,r=(t[3]-t[1])/2;return se(e.origin,t[0]+i,t[1]+r,0),se(e.basis1,i,0,0),se(e.basis2,0,r,0),Uy(0,0,1,0,e.plane),e}function zse(t,e,i){return!!dM(t.plane,e,i)&&FRe(t,i)}function Olt(t,e,i){if(zse(t,e,i))return i;const r=IRe(t,e,Le.get());return oe(i,e.origin,re(Le.get(),e.direction,Sr(e.origin,r)/Ee(e.direction))),i}function IRe(t,e,i){const r=bB.get();kRe(t,e,r,bB.get());let s=Number.POSITIVE_INFINITY;for(const n of Gse){const o=jse(t,n,qG.get()),a=Le.get();if(CRe(r,o,a)){const l=nT(Le.get(),e.origin,a),c=Math.abs(Ja(fe(e.direction,l)));c<s&&(s=c,ne(i,a))}}return s===Number.POSITIVE_INFINITY?PRe(t,e,i):i}function RRe(t,e){return(e-t)/e}function PRe(t,e,i){if(zse(t,e,i))return i;const r=bB.get(),s=bB.get();kRe(t,e,r,s);let n=Number.POSITIVE_INFINITY;for(const o of Gse){const a=jse(t,o,qG.get()),l=Le.get();if(mlt(r,a,l)){const c=xlt(e,l);if(!vB(s,l))continue;c<n&&(n=c,ne(i,l))}}return Use(t,e.origin)<n&&DRe(t,e.origin,i),i}function DRe(t,e,i){const r=vlt(t.plane,e,Le.get()),s=HJ(qpe(t,t.basis1),r,-1,1,Le.get()),n=HJ(qpe(t,t.basis2),r,-1,1,Le.get());return be(i,oe(Le.get(),s,n),t.origin),i}function LRe(t,e,i){const{origin:r,basis1:s,basis2:n}=t,o=be(Le.get(),e,r),a=Sb(s,o),l=Sb(n,o),c=Sb(Cv(t),o);return se(i,a,l,c)}function Use(t,e){const i=LRe(t,e,Le.get()),{basis1:r,basis2:s}=t,n=Ee(r),o=Ee(s),a=Math.max(Math.abs(i[0])-n,0),l=Math.max(Math.abs(i[1])-o,0),c=i[2];return a*a+l*l+c*c}function Ilt(t,e){return Math.sqrt(Use(t,e))}function Rlt(t,e){let i=Number.NEGATIVE_INFINITY;for(const r of Gse){const s=jse(t,r,qG.get()),n=fRe(s,e);n>i&&(i=n)}return Math.sqrt(i)}function Bse(t,e){return vB(t.plane,e)&&FRe(t,e)}function Plt(t,e,i,r){return Flt(t,i,r)}function Vse(t,e){const i=-t.plane[3];return Sb(Cv(t),e)-i}function Dlt(t,e,i,r){const s=Vse(t,e),n=re(zlt,Cv(t),i-s);return oe(r,e,n),r}function Llt(t,e){return to(t.basis1,e.basis1)&&to(t.basis2,e.basis2)&&to(t.origin,e.origin)}function NRe(t,e,i){return t!==i&&lT(t,i),$l(kT,e),mc(kT,kT),ot(i.basis1,t.basis1,kT),ot(i.basis2,t.basis2,kT),ot(i.plane,t.plane,kT),ot(i.origin,t.origin,e),qJ(i.plane,i.plane,i.origin),i}function Nlt(t,e,i,r){return t!==r&&lT(t,r),Pd(Z8,e,i),ot(r.basis1,t.basis1,Z8),ot(r.basis2,t.basis2,Z8),HG(r),r}function Cv(t){return t.plane}function Flt(t,e,i){switch(e){case rs.X:ne(i,t.basis1),ae(i,i);break;case rs.Y:ne(i,t.basis2),ae(i,i);break;case rs.Z:ne(i,Cv(t))}return i}function FRe(t,e){const i=be(Le.get(),e,t.origin),r=Xo(t.basis1),s=Xo(t.basis2),n=fe(t.basis1,i),o=fe(t.basis2,i);return-n-r<0&&n-r<0&&-o-s<0&&o-s<0}function qpe(t,e){const i=qG.get();return ne(i.origin,t.origin),ne(i.vector,e),i}function jse(t,e,i){const{basis1:r,basis2:s,origin:n}=t,o=re(Le.get(),r,e.origin[0]),a=re(Le.get(),s,e.origin[1]);oe(i.origin,o,a),oe(i.origin,i.origin,n);const l=re(Le.get(),r,e.direction[0]),c=re(Le.get(),s,e.direction[1]);return re(i.vector,oe(l,l,c),2),i}function klt(t,e){Math.abs(fe(t.basis1,t.basis2)/(Ee(t.basis1)*Ee(t.basis2)))>1e-6&&W8().warn(e,"Provided basis vectors are not perpendicular"),Math.abs(fe(t.basis1,Cv(t)))>1e-6&&W8().warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-fe(Cv(t),t.origin)-t.plane[3])>1e-6&&W8().warn(e,"Plane offset is not consistent with plane origin")}function kRe(t,e,i,r){const s=Cv(t);WJ(s,e.direction,e.origin,i),WJ(i,s,e.origin,r)}const zRe={plane:Gr(),origin:De(0,0,0),basis1:De(1,0,0),basis2:De(0,1,0)},bB=new jv(Gr),qG=new jv(Gv),zlt=$(),Ult=new jv(()=>lw()),Gse=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],kT=qe(),Z8=qe(),Blt=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:ARe,altitudeAt:Vse,axisAt:Plt,cameraFrustumCoverage:RRe,closestPoint:PRe,closestPointOnSilhouette:IRe,copy:lT,copyWithoutVerify:$lt,create:lw,distance:Ilt,distance2:Use,distanceToSilhouette:Rlt,elevate:MRe,equals:Llt,extrusionContainsPoint:Bse,fromAABoundingRect:ORe,fromValues:kse,getExtent:Mlt,intersectRay:zse,intersectRayClosestSilhouette:Olt,normal:Cv,projectPoint:DRe,projectPointLocal:LRe,rotate:Nlt,setAltitudeAt:Dlt,setExtent:Alt,transform:NRe,up:zRe,updateUnboundedPlane:HG,wrap:Clt},Symbol.toStringTag,{value:"Module"})),Vlt=new Oe(XTe),nC=new Oe(Hj),oC=new Oe(qj),KJt=new Oe(KTe);function jb(t){const e=Wpe.get(t);if(e)return e;let i=Vlt;if(t)if(t===nC)i=nC;else if(t===oC)i=oC;else{const r=t.wkid,s=t.latestWkid;if(r!=null||s!=null)N$(r)||N$(s)?i=nC:(F$(r)||F$(s))&&(i=oC);else{const n=t.wkt2??t.wkt;if(n){const o=n.toUpperCase();o===jlt?i=nC:o===Glt&&(i=oC)}}}return Wpe.set(t,i),i}const Wpe=new Map,jlt=nC.wkt.toUpperCase(),Glt=oC.wkt.toUpperCase();function Zpe(t,e){const i=Ee(t),r=Md(t[2]/i),s=Math.atan2(t[1]/i,t[0]/i);return se(e,i,r,s),e}const URe=Ls();function Ls(){return yi()}const Hlt=$S,qlt=$S;function AS(t,e){return xd(e,t)}function BRe(t,e){return Yi(t[0],t[1],t[2],e)}function Wlt(t){return t}function Zlt(t){t[0]=t[1]=t[2]=t[3]=0}function pM(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function Hm(t){return t[3]}function Ylt(t){return t}function VRe(t,e,i,r){return Yi(t,e,i,r)}function Jlt(t,e,i){return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),i[3]=t[3]+e,i}function Xlt(t,e,i){return t!==i&&AS(t,i),i}function Klt(t,e){return e}function cw(t,e,i){if(e==null||!jRe(t,e,wB))return!1;let{t0:r,t1:s}=wB;if((r<0||s<r&&s>0)&&(r=s),r<0)return!1;if(i){const{origin:n,direction:o}=e;i[0]=n[0]+o[0]*r,i[1]=n[1]+o[1]*r,i[2]=n[2]+o[2]*r}return!0}function Qlt(t,e,i){const r=$Re(e,i);if(!jRe(t,r,wB))return[];const{origin:s,direction:n}=r,{t0:o,t1:a}=wB,l=c=>{const h=$();return Qn(h,s,n,c),qse(t,h,h)};return Math.abs(o-a)<To()?[l(o)]:[l(o),l(a)]}const wB={t0:0,t1:0};function jRe(t,e,i){const{origin:r,direction:s}=e,n=ect;n[0]=r[0]-t[0],n[1]=r[1]-t[1],n[2]=r[2]-t[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2];if(o===0)return!1;const a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);return i.t0=(-a-c)/(2*o),i.t1=(-a+c)/(2*o),!0}const ect=$();function ZJ(t,e){return cw(t,e,null)}function tct(t,e,i){if(cw(t,e,i))return i;const r=fM(t,e,Le.get());return oe(i,e.origin,re(Le.get(),e.direction,Sr(e.origin,r)/Ee(e.direction))),i}function fM(t,e,i){const r=Le.get(),s=Ise.get();ct(r,e.origin,e.direction);const n=Hm(t);ct(i,r,e.origin),re(i,i,1/Ee(i)*n);const o=HRe(t,e.origin),a=Dse(e.origin,i);return Pd(s,a+o,r),ot(i,i,s),i}function Hse(t,e,i,r){const s=Hm(t),n=s*s,o=e+.5*Math.PI,a=i*i+n-2*Math.cos(o)*i*s,l=Math.sqrt(a),c=a-n;if(c<=0)return .5;const h=Math.sqrt(c),d=Math.acos(h/l)-Math.asin(s/(l/Math.sin(o)));return Math.min(1,(d+.5*r)/r)}function ict(t,e,i){return cw(t,e,i)?i:(Slt(e,t,i),qse(t,i,i))}function qse(t,e,i){const r=be(Le.get(),e,t),s=re(Le.get(),r,t[3]/Ee(r));return oe(i,s,t)}function GRe(t,e){const i=be(Le.get(),e,t),r=Xo(i),s=t[3]*t[3];return Math.sqrt(Math.abs(r-s))}function HRe(t,e){const i=be(Le.get(),e,t),r=Ee(i),s=Hm(t),n=s+Math.abs(s-r);return Ja(s/n)}const Y8=$();function qRe(t,e,i,r){const s=be(Y8,e,t);switch(i){case rs.X:{const n=Zpe(s,Y8)[2];return se(r,-Math.sin(n),Math.cos(n),0)}case rs.Y:{const n=Zpe(s,Y8),o=n[1],a=n[2],l=Math.sin(o);return se(r,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case rs.Z:return ae(r,s);default:return}}function WRe(t,e){const i=be(YJ,e,t);return Ee(i)-t[3]}function rct(t,e,i,r){const s=WRe(t,e),n=qRe(t,e,rs.Z,YJ),o=re(YJ,n,i-s);return oe(r,e,o)}function sct(t,e){const i=no(t,e),r=Hm(t);return i<=r*r}function nct(t,e,i=yi()){const r=Sr(t,e),s=t[3],n=e[3];return r+n<s?(xd(i,t),i):r+s<n?(xd(i,e),i):(fr(i,t,e,(r+n-s)/(2*r)),i[3]=(r+s+n)/2,i)}const YJ=$(),WG=Ls(),oct=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:URe,altitudeAt:WRe,angleToSilhouette:HRe,axisAt:qRe,cameraFrustumCoverage:Hse,clear:Zlt,closestPoint:ict,closestPointOnSilhouette:fM,containsPoint:sct,copy:AS,create:Ls,distanceToSilhouette:GRe,elevate:Jlt,equals:qlt,exactEquals:Hlt,fromCenterAndRadius:BRe,fromRadius:pM,fromValues:VRe,getCenter:Ylt,getExtent:Klt,getRadius:Hm,intersectLine:Qlt,intersectRay:cw,intersectRayClosestSilhouette:tct,intersectsRay:ZJ,projectPoint:qse,setAltitudeAt:rct,setExtent:Xlt,tmpSphere:WG,union:nct,wrap:Wlt},Symbol.toStringTag,{value:"Module"}));function act(t){const{value:e,operations:i}=t;return{operations:i,value:i.create(e)}}function lct(t,e,i){return t.operations.setExtent(t.value,e,i.value),i}function cct(t,e){return t.operations.getExtent(t.value,e),e}function uct(t){return{operations:t,value:t.create()}}function ZRe(t,e,i=uct(t)){return i.operations=t,t.copy(e,i.value),i}function hct(t){return ZRe(oct,VRe(0,0,0,yr(t).radius))}const Ype=2**50;function dct(){return ZRe(Blt,kse([0,0,0],[Ype,0,0],[0,Ype,0]))}function pct(t,e,i){return t.operations.axisAt(t.value,e,rs.Z,i)}function fct(t,e,i,r){return t.operations.axisAt(t.value,e,i,r)}function mct(t,e,i){return t.operations.intersectRay(t.value,e,i)}function gct(t,e,i){return t.operations.intersectRayClosestSilhouette(t.value,e,i)}function yct(t,e){return t.operations.altitudeAt(t.value,e)}function YRe(t,e,i,r){return t.operations.setAltitudeAt(t.value,e,i,r)}function vct(t,e,i,r){return e!==r&&_n(r,e),se(zT,r[12],r[13],r[14]),YRe(t,zT,i,zT),r[12]=zT[0],r[13]=zT[1],r[14]=zT[2],r}function J8(t,e,i){return t.operations.elevate(t.value,e,i.value)}const zT=$();function Jpe(t,e,i,r,s){return s[0]=fe(t,e),s[1]=fe(t,i),s[2]=fe(t,r),s}function JJ(t,e,i,r,s){ne(i,t),ne(YN,e),ae(YN,YN),ct(r,YN,i),ct(s,r,i)}function _ct(t,e){return t?jb(e):e.isGeographic?Oe.PlateCarree:e}const YN=$(),Wse=96;function QJt(t,e){const i=t.extent,r=t.width,s=Mo(i==null?void 0:i.spatialReference);return i&&r?i.width/r*s*Aie*Wse:0}function bct(t,e){return t/(Mo(e)*Aie*Wse)}function wct(t){return t/(Aie*Wse)}function eXt(t,e,i){return xct(t,e)&&Sct(t,i)}function xct(t,e){return e===0||tu(t,e)||t<e}function Sct(t,e){return e===0||tu(t,e)||t>e}function Tct(t,e){return tu(t,e)?0:(t||Number.POSITIVE_INFINITY)>(e||Number.POSITIVE_INFINITY)?1:-1}function pA(t,e,i){i=i||2;var r,s,n,o,a,l,c,h=e&&e.length,d=h?e[0]*i:t.length,f=JRe(t,0,d,i,!0),m=[];if(!f||f.next===f.prev)return m;if(h&&(f=Mct(t,e,f,i)),t.length>80*i){r=n=t[0],s=o=t[1];for(var g=i;g<d;g+=i)(a=t[g])<r&&(r=a),(l=t[g+1])<s&&(s=l),a>n&&(n=a),l>o&&(o=l);c=(c=Math.max(n-r,o-s))!==0?1/c:0}return N3(f,m,i,r,s,c),m}function JRe(t,e,i,r,s){var n,o;if(s===QJ(t,e,i,r)>0)for(n=e;n<i;n+=r)o=Xpe(n,t[n],t[n+1],o);else for(n=i-r;n>=e;n-=r)o=Xpe(n,t[n],t[n+1],o);if(o&&ZG(o,o.next)){var a=o.next;k3(o),o=a}return o}function Gb(t,e){if(!t)return t;e||(e=t);var i,r=t;do if(i=!1,r.steiner||!ZG(r,r.next)&&gn(r.prev,r,r.next)!==0)r=r.next;else{var s=r.prev;if(k3(r),(r=e=s)===r.next)break;i=!0}while(i||r!==e);return e}function N3(t,e,i,r,s,n,o){if(t){!o&&n&&Dct(t,r,s,n);for(var a,l,c=t;t.prev!==t.next;)if(a=t.prev,l=t.next,n?Cct(t,r,s,n):Ect(t))e.push(a.i/i),e.push(t.i/i),e.push(l.i/i),k3(t),t=l.next,c=l.next;else if((t=l)===c){o?o===1?N3(t=$ct(Gb(t),e,i),e,i,r,s,n,2):o===2&&Act(t,e,i,r,s,n):N3(Gb(t),e,i,r,s,n,1);break}}}function Ect(t){var e=t.prev,i=t,r=t.next;if(gn(e,i,r)>=0)return!1;for(var s=t.next.next;s!==t.prev;){if(aC(e.x,e.y,i.x,i.y,r.x,r.y,s.x,s.y)&&gn(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function Cct(t,e,i,r){var s=t.prev,n=t,o=t.next;if(gn(s,n,o)>=0)return!1;for(var a=s.x<n.x?s.x<o.x?s.x:o.x:n.x<o.x?n.x:o.x,l=s.y<n.y?s.y<o.y?s.y:o.y:n.y<o.y?n.y:o.y,c=s.x>n.x?s.x>o.x?s.x:o.x:n.x>o.x?n.x:o.x,h=s.y>n.y?s.y>o.y?s.y:o.y:n.y>o.y?n.y:o.y,d=XJ(a,l,e,i,r),f=XJ(c,h,e,i,r),m=t.prevZ,g=t.nextZ;m&&m.z>=d&&g&&g.z<=f;){if(m!==t.prev&&m!==t.next&&aC(s.x,s.y,n.x,n.y,o.x,o.y,m.x,m.y)&&gn(m.prev,m,m.next)>=0||(m=m.prevZ,g!==t.prev&&g!==t.next&&aC(s.x,s.y,n.x,n.y,o.x,o.y,g.x,g.y)&&gn(g.prev,g,g.next)>=0))return!1;g=g.nextZ}for(;m&&m.z>=d;){if(m!==t.prev&&m!==t.next&&aC(s.x,s.y,n.x,n.y,o.x,o.y,m.x,m.y)&&gn(m.prev,m,m.next)>=0)return!1;m=m.prevZ}for(;g&&g.z<=f;){if(g!==t.prev&&g!==t.next&&aC(s.x,s.y,n.x,n.y,o.x,o.y,g.x,g.y)&&gn(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0}function $ct(t,e,i){var r=t;do{var s=r.prev,n=r.next.next;!ZG(s,n)&&XRe(s,r,r.next,n)&&F3(s,n)&&F3(n,s)&&(e.push(s.i/i),e.push(r.i/i),e.push(n.i/i),k3(r),k3(r.next),r=t=n),r=r.next}while(r!==t);return Gb(r)}function Act(t,e,i,r,s,n){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&Fct(o,a)){var l=KRe(o,a);return o=Gb(o,o.next),l=Gb(l,l.next),N3(o,e,i,r,s,n),void N3(l,e,i,r,s,n)}a=a.next}o=o.next}while(o!==t)}function Mct(t,e,i,r){var s,n,o,a=[];for(s=0,n=e.length;s<n;s++)(o=JRe(t,e[s]*r,s<n-1?e[s+1]*r:t.length,r,!1))===o.next&&(o.steiner=!0),a.push(Nct(o));for(a.sort(Oct),s=0;s<a.length;s++)i=Gb(i=Ict(a[s],i),i.next);return i}function Oct(t,e){return t.x-e.x}function X8(t){if(t.next.prev===t)return t;let e=t;for(;;){const i=e.next;if(i.prev===e||i===e||i===t)break;e=i}return e}function Ict(t,e){var i=Rct(t,e);if(!i)return e;var r=KRe(i,t),s=Gb(i,i.next);let n=X8(r);return Gb(n,n.next),s=X8(s),X8(e===i?s:e)}function Rct(t,e){var i,r=e,s=t.x,n=t.y,o=-1/0;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){var a=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=s&&a>o){if(o=a,a===s){if(n===r.y)return r;if(n===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!i)return null;if(s===o)return i;var l,c=i,h=i.x,d=i.y,f=1/0;r=i;do s>=r.x&&r.x>=h&&s!==r.x&&aC(n<d?s:o,n,h,d,n<d?o:s,n,r.x,r.y)&&(l=Math.abs(n-r.y)/(s-r.x),F3(r,t)&&(l<f||l===f&&(r.x>i.x||r.x===i.x&&Pct(i,r)))&&(i=r,f=l)),r=r.next;while(r!==c);return i}function Pct(t,e){return gn(t.prev,t,e.prev)<0&&gn(e.next,t,t.next)<0}function Dct(t,e,i,r){var s=t;do s.z===null&&(s.z=XJ(s.x,s.y,e,i,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,Lct(s)}function Lct(t){var e,i,r,s,n,o,a,l,c=1;do{for(i=t,t=null,n=null,o=0;i;){for(o++,r=i,a=0,e=0;e<c&&(a++,r=r.nextZ);e++);for(l=c;a>0||l>0&&r;)a!==0&&(l===0||!r||i.z<=r.z)?(s=i,i=i.nextZ,a--):(s=r,r=r.nextZ,l--),n?n.nextZ=s:t=s,s.prevZ=n,n=s;i=r}n.nextZ=null,c*=2}while(o>1);return t}function XJ(t,e,i,r,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*s)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*s)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Nct(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function aC(t,e,i,r,s,n,o,a){return(s-o)*(e-a)-(t-o)*(n-a)>=0&&(t-o)*(r-a)-(i-o)*(e-a)>=0&&(i-o)*(n-a)-(s-o)*(r-a)>=0}function Fct(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!kct(t,e)&&(F3(t,e)&&F3(e,t)&&zct(t,e)&&(gn(t.prev,t,e.prev)||gn(t,e.prev,e))||ZG(t,e)&&gn(t.prev,t,t.next)>0&&gn(e.prev,e,e.next)>0)}function gn(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function ZG(t,e){return t.x===e.x&&t.y===e.y}function XRe(t,e,i,r){var s=XN(gn(t,e,i)),n=XN(gn(t,e,r)),o=XN(gn(i,r,t)),a=XN(gn(i,r,e));return s!==n&&o!==a||!(s!==0||!JN(t,i,e))||!(n!==0||!JN(t,r,e))||!(o!==0||!JN(i,t,r))||!(a!==0||!JN(i,e,r))}function JN(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function XN(t){return t>0?1:t<0?-1:0}function kct(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&XRe(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function F3(t,e){return gn(t.prev,t,t.next)<0?gn(t,e,t.next)>=0&&gn(t,t.prev,e)>=0:gn(t,e,t.prev)<0||gn(t,t.next,e)<0}function zct(t,e){var i=t,r=!1,s=(t.x+e.x)/2,n=(t.y+e.y)/2;do i.y>n!=i.next.y>n&&i.next.y!==i.y&&s<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==t);return r}function KRe(t,e){var i=new KJ(t.i,t.x,t.y),r=new KJ(e.i,e.x,e.y),s=t.next,n=e.prev;return t.next=e,e.prev=t,i.next=s,s.prev=i,r.next=i,i.prev=r,n.next=r,r.prev=n,r}function Xpe(t,e,i,r){var s=new KJ(t,e,i);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function k3(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function KJ(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function QJ(t,e,i,r){for(var s=0,n=e,o=i-r;n<i;n+=r)s+=(t[o]-t[n])*(t[n+1]+t[o+1]),o=n;return s}pA.deviation=function(t,e,i,r){var s=e&&e.length,n=s?e[0]*i:t.length,o=Math.abs(QJ(t,0,n,i));if(s)for(var a=0,l=e.length;a<l;a++){var c=e[a]*i,h=a<l-1?e[a+1]*i:t.length;o-=Math.abs(QJ(t,c,h,i))}var d=0;for(a=0;a<r.length;a+=3){var f=r[a]*i,m=r[a+1]*i,g=r[a+2]*i;d+=Math.abs((t[f]-t[g])*(t[m+1]-t[f+1])-(t[f]-t[m])*(t[g+1]-t[f+1]))}return o===0&&d===0?0:Math.abs((d-o)/o)},pA.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,s=0;s<t.length;s++){for(var n=0;n<t[s].length;n++)for(var o=0;o<e;o++)i.vertices.push(t[s][n][o]);s>0&&(r+=t[s-1].length,i.holes.push(r))}return i};function QRe(t,e,i){const r=Math.sin(t),s=Math.cos(t),n=Math.sin(e),o=Math.cos(e),a=i;return a[0]=-r,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*r,a[9]=o*r,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function Uct(t,e,i){return QRe(t,e,i),mc(i,i),i}function cT(t,e,i,r){const s=cCe(t,r);if(s==null)return!1;const n=s.source.spatialReferenceId,o=s.dest.spatialReferenceId;if(n===o&&!K8(o)&&(n!==K.UNKNOWN||as(t,r)))return xre(i,e),!0;if(K8(o)){const l=YO[n][K.LON_LAT],c=YO[K.LON_LAT][o];return l!=null&&c!=null&&(l(e,0,f0,0),c(f0,0,m0,0),QRe(KN*f0[0],KN*f0[1],i),i[12]=m0[0],i[13]=m0[1],i[14]=m0[2],!0)}const a=K8(n);if((o===K.WEB_MERCATOR||o===K.PLATE_CARREE||o===K.WGS84||o===K.CGCS2000)&&(n===K.WGS84||a||n===K.WEB_MERCATOR||n===K.CGCS2000)){const l=YO[n][K.LON_LAT],c=YO[K.LON_LAT][o];return l!=null&&c!=null&&(l(e,0,f0,0),c(f0,0,m0,0),a?Uct(KN*f0[0],KN*f0[1],i):_f(i),i[12]=m0[0],i[13]=m0[1],i[14]=m0[2],!0)}return!1}function K8(t){return t===K.SPHERICAL_ECEF||t===K.SPHERICAL_MARS_PCPF||t===K.SPHERICAL_MOON_PCPF||t===K.WGS84_ECEF}const KN=At(1),f0=$(),m0=$();function MS(t){if(Array.isArray(t)){if(t.length<lh)return t}else if(t.length<lh)return Array.from(t);let e=!0,i=!0;return t.some((r,s)=>(e=e&&r===0,i=i&&r===s,!e&&!i)),e?_L(t.length):i?vL(t.length):RD(t)&&t.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT?t:Bct(t)}function Bct(t){let e=!0;for(const i of t){if(i>=65536)return RD(t)?t:new Uint32Array(t);i>=256&&(e=!1)}return e?new Uint8Array(t):new Uint16Array(t)}function z3(t){return t<=lh?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}function tXt(t){return t<=lh?new Array(t):new Uint32Array(t)}let FI=Zse(131072);const ePe=[0],Q8=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function vL(t){return t===1?ePe:t<lh?Array.from(new Uint16Array(Q8.buffer,0,t)):t<Q8.length?new Uint16Array(Q8.buffer,0,t):(t>FI.length&&(FI=Zse(Math.max(2*FI.length,t))),new Uint32Array(FI.buffer,0,t))}function Zse(t){const e=new Uint32Array(t);for(let i=0;i<e.length;i++)e[i]=i;return e}let kI=new Uint8Array(65536);function _L(t){if(t===1)return ePe;if(t<lh)return new Array(t).fill(0);if(t>kI.length){const e=Math.max(2*kI.length,t);kI=new Uint8Array(e)}return new Uint8Array(kI.buffer,0,t)}function Vct(){FI=Zse(131072),kI=new Uint8Array(65536)}function jct(t,e,i){YG(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function YG(t,e,i,r=3,s=r){if(t.length/r!==Math.ceil(e.length/s))return t;const n=t.length/r,o=i[0],a=i[1],l=i[2],c=i[4],h=i[5],d=i[6],f=i[8],m=i[9],g=i[10],v=i[12],_=i[13],b=i[14];let w=0,x=0;for(let S=0;S<n;S++){const C=e[w],T=e[w+1],M=e[w+2];t[x]=o*C+c*T+f*M+v,t[x+1]=a*C+h*T+m*M+_,t[x+2]=l*C+d*T+g*M+b,w+=s,x+=r}return t}function tPe(t,e,i){iPe(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function iPe(t,e,i,r=3,s=r){if(t.length/r!==Math.ceil(e.length/s))return;const n=t.length/r,o=i[0],a=i[1],l=i[2],c=i[3],h=i[4],d=i[5],f=i[6],m=i[7],g=i[8];let v=0,_=0;for(let b=0;b<n;b++){const w=e[v],x=e[v+1],S=e[v+2];t[_]=o*w+c*x+f*S,t[_+1]=a*w+h*x+m*S,t[_+2]=l*w+d*x+g*S,v+=s,_+=r}}function Gct(t,e,i){rPe(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function rPe(t,e,i,r=3,s=r){const n=Math.min(t.length/r,e.length/s);let o=0,a=0;for(let l=0;l<n;l++)t[a]=i*e[o],t[a+1]=i*e[o+1],t[a+2]=i*e[o+2],o+=s,a+=r;return t}function Hct(t,e,i,r){sPe(t.typedBuffer,e.typedBuffer,i,r,t.typedBufferStride,e.typedBufferStride)}function sPe(t,e,i,r,s=3,n=s){const o=Math.min(t.length/s,e.length/n);let a=0,l=0;const c=1/qU;for(let h=0;h<o;h++)t[l]=r*(i*e[a])**c,t[l+1]=r*(i*e[a+1])**c,t[l+2]=r*(i*e[a+2])**c,a+=n,l+=s}function qct(t,e,i,r=3,s=r){const n=t.length/r;if(n!==Math.ceil(e.length/s))return t;let o=0,a=0;for(let l=0;l<n;l++)t[a]=e[o]+i[0],t[a+1]=e[o+1]+i[1],t[a+2]=e[o+2]+i[2],o+=s,a+=r;return t}function Wct(t,e){nPe(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function nPe(t,e,i=3,r=i){const s=Math.min(t.length/i,e.length/r);let n=0,o=0;for(let a=0;a<s;a++){const l=e[n],c=e[n+1],h=e[n+2],d=l*l+c*c+h*h;if(d>0){const f=1/Math.sqrt(d);t[o]=f*l,t[o+1]=f*c,t[o+2]=f*h}n+=r,o+=i}}function Zct(t,e,i){const r=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;let l=0,c=0;for(let h=0;h<r;h++)s[c]=o[l]>>i,s[c+1]=o[l+1]>>i,s[c+2]=o[l+2]>>i,l+=a,c+=n}Object.freeze(Object.defineProperty({__proto__:null,linearToSRGB:sPe,linearToSRGBView:Hct,normalize:nPe,normalizeView:Wct,scale:rPe,scaleView:Gct,shiftRight:Zct,transformMat3:iPe,transformMat3View:tPe,transformMat4:YG,transformMat4View:jct,translate:qct},Symbol.toStringTag,{value:"Module"}));const fA={unknown:1,inches:mr(1,"meters","inches"),feet:mr(1,"meters","feet"),"us-feet":mr(1,"meters","us-feet"),yards:mr(1,"meters","yards"),miles:mr(1,"meters","miles"),"nautical-miles":mr(1,"meters","nautical-miles"),millimeters:mr(1,"meters","millimeters"),centimeters:mr(1,"meters","centimeters"),decimeters:mr(1,"meters","decimeters"),meters:mr(1,"meters","meters"),kilometers:mr(1,"meters","kilometers"),"decimal-degrees":1/kHe(1,"meters",Ci.radius)};function Yct(t){return!!t&&fA[t]!=null}function oPe(t){return 1/(fA[t]||1)}function Jct(){const t=Object.keys(fA);return MD(t,"decimal-degrees"),t.sort(),t}const Xct=Jct();function uT(t,e,i,r){return{x:t,y:e,z:i,hasZ:i!=null,hasM:!1,spatialReference:r,type:"point"}}function iXt(t,e,i,r,s){t.x=e,t.y=i,t.z=r,t.hasZ=r!=null,t.spatialReference=s}function aPe(t){return"declaredClass"in t}function Kpe(t){return"declaredClass"in t}function Kct(t){return"declaredClass"in t}function Qct(t,e){return t?Kct(t)?t:new Pl({layer:e,sourceLayer:e,visible:t.visible,symbol:q(t.symbol),attributes:q(t.attributes),geometry:lPe(t.geometry)}):null}function lPe(t){return t==null?null:aPe(t)?t:pf(eut(t))}function eut(t){const{wkid:e,wkt:i,wkt2:r,latestWkid:s}=t.spatialReference,n={wkid:e,wkt:i,wkt2:r,latestWkid:s};switch(t.type){case"point":{const{x:o,y:a,z:l,m:c}=t;return{x:o,y:a,z:l,m:c,spatialReference:n}}case"polygon":{const{rings:o,hasZ:a,hasM:l}=t;return{rings:Qpe(o),hasZ:a,hasM:l,spatialReference:n}}case"polyline":{const{paths:o,hasZ:a,hasM:l}=t;return{paths:Qpe(o),hasZ:a,hasM:l,spatialReference:n}}case"extent":{const{xmin:o,xmax:a,ymin:l,ymax:c,zmin:h,zmax:d,mmin:f,mmax:m,hasZ:g,hasM:v}=t;return{xmin:o,xmax:a,ymin:l,ymax:c,zmin:h,zmax:d,mmin:f,mmax:m,hasZ:g,hasM:v,spatialReference:n}}case"multipoint":{const{points:o,hasZ:a,hasM:l}=t;return{points:uPe(o)?cPe(o):o,hasZ:a,hasM:l,spatialReference:n}}default:return}}function Qpe(t){return tut(t)?t.map(e=>cPe(e)):t}function cPe(t){return t.map(e=>Array.from(e))}function tut(t){for(const e of t)if(e.length!==0)return uPe(e);return!1}function uPe(t){return t.length>0&&(OD(t[0])||ID(t[0]))}function iut(t,e){if(!t)return null;let i;if(Kpe(t)){if(e==null)return t.clone();if(Kpe(e))return e.copy(t)}return e!=null?(i=e,i.x=t.x,i.y=t.y,i.spatialReference=t.spatialReference,t.hasZ?(i.z=t.z,i.hasZ=t.hasZ):(i.z=void 0,i.hasZ=!1),t.hasM?(i.m=t.m,i.hasM=!0):(i.m=void 0,i.hasM=!1)):(i=uT(t.x,t.y,t.z,t.spatialReference),t.hasM&&(i.m=t.m,i.hasM=!0)),i}function rXt(t){const{wkid:e,wkt:i,wkt2:r,latestWkid:s}=t,n={wkid:e,wkt:i,wkt2:r,latestWkid:s};return Oe.fromJSON(n)}const rut=()=>J.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function sut(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function sXt(t){const e=t==null?void 0:t.expression;if(typeof e=="string"){const i=fPe(e);if(i!=null)return{cachedResult:i}}return null}async function nXt(t,e,i,r){const s=t==null?void 0:t.expression;if(typeof s!="string")return null;const n=fPe(s);if(n!=null)return{cachedResult:n};const o=await bv();gt(i);const a=o.arcadeUtils,l=a.createSyntaxTree(s);return a.dependsOnView(l)?(r!=null&&r.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:e}),modules:o}}}function hPe(t,e,i){return t.arcadeUtils.createFeature(e.attributes,e.geometry,i)}function dPe(t,e){if(t!=null&&!pPe(t)){if(!e||!t.arcade)return void rut().errorOncePerTick("Arcade support required but not provided");const i=e;i._geometry&&(i._geometry=lPe(i._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function nut(t){if(t!=null){if(pPe(t))return t.cachedResult;const e=t.arcade;let i=e==null?void 0:e.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof i!="number"&&(t.cachedResult=0,i=0),i}return 0}function oXt(t,e=!1){let i=t==null?void 0:t.featureExpressionInfo;const r=i==null?void 0:i.expression;return e||r==="0"||(i=null),i??null}const out={cachedResult:0};function pPe(t){return t.cachedResult!=null}function fPe(t){return t==="0"?0:null}let xB=class mPe{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=oPe(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,i){const r=this.calculateOffsetRenderUnits(i);return this.featureExpressionInfoContext!=null?r:e+r}calculateOffsetRenderUnits(e){let i=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return r!=null&&(i+=nut(r)*this._metersPerElevationInfoUnit),i/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=Yct(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,i,r){if(e==null)return void(this._featureExpressionInfoContext=null);const s=e==null?void 0:e.arcade;s&&i!=null&&r!=null?(this._featureExpressionInfoContext=sut(e),dPe(this._featureExpressionInfoContext,hPe(s.modules,i,r))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const i=new mPe;return e!=null&&i.setFromElevationInfo(e),i}};function aut(t,e,i){return{objectId:t,target:e,distance:i,type:"vertex"}}function efe(t,e,i,r,s,n=!1){return{objectId:t,target:e,distance:i,type:"edge",start:r,end:s,draped:n}}let Yse=class{constructor(e,i){this.renderer=e,this.symbol=i}};var av,Wo;function lC(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function U3(t){return t!=null&&!isNaN(t)&&isFinite(t)}function gPe(t){return t.valueExpression?av.Expression:t.field&&typeof t.field=="string"?av.Field:av.Unknown}function lut(t,e){const i=e||gPe(t),r=t.valueUnit||"unknown";return i===av.Unknown?Wo.Constant:t.stops?Wo.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?Wo.ClampedLinear:r==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?Wo.Proportional:Wo.Additive:Wo.Identity:Wo.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(av||(av={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(Wo||(Wo={}));const yPe=()=>J.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),JG=t=>yPe().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${t}`),XG=()=>yPe().error("Use of arcade expressions requires an arcade context"),tfe=new Pl,b5=Math.PI,vPe=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function _Pe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="color"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void JG("ColorVariable");const s=typeof e=="number",n=s?null:e,o=n==null?void 0:n.attributes;let a=s?e:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let d=r.cache.compiledFunc;if(!l&&!h){const g=r.stops;return g&&g[0]&&g[0].color}if(typeof a!="number")if(h){if((i==null?void 0:i.arcade)==null)return void XG();const g={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},v=i.arcade.arcadeUtils,_=v.getViewInfo(g),b=v.createExecContext(n,_,i.timeZone);if(!d){const w=v.createSyntaxTree(r.valueExpression);d=v.createFunction(w),r.cache.compiledFunc=d}a=v.executeFunction(d,b)}else o&&(a=o[l]);const f=r.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const g=Xse(a,c);if(g){const v=g[0],_=g[1],b=v===_?r.stops[v].color:Je.blendColors(r.stops[v].color,r.stops[_].color,g[2],i!=null?i.color:void 0);return new Je(b)}}}function bPe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="opacity"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void JG("OpacityVariable");const s=typeof e=="number",n=s?null:e,o=n==null?void 0:n.attributes;let a=s?e:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let d=r.cache.compiledFunc;if(!l&&!h){const g=r.stops;return g&&g[0]&&g[0].opacity}if(typeof a!="number")if(h){if((i==null?void 0:i.arcade)==null)return void XG();const g={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},v=i.arcade.arcadeUtils,_=v.getViewInfo(g),b=v.createExecContext(n,_,i.timeZone);if(!d){const w=v.createSyntaxTree(r.valueExpression);d=v.createFunction(w),r.cache.compiledFunc=d}a=v.executeFunction(d,b)}else o&&(a=o[l]);const f=r.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const g=Xse(a,c);if(g){const v=g[0],_=g[1];if(v===_)return r.stops[v].opacity;{const b=r.stops[v].opacity;return b+(r.stops[_].opacity-b)*g[2]}}}}function wPe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(m=>m.type==="rotation"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void JG("RotationVariable");const s=r.axis||"heading",n=s==="heading"&&r.rotationType==="arithmetic"?90:0,o=s==="heading"&&r.rotationType==="arithmetic"?-1:1,a=typeof e=="number"?null:e,l=a==null?void 0:a.attributes,c=r.field,{hasExpression:h}=r.cache;let d=r.cache.compiledFunc,f=0;if(!c&&!h)return f;if(h){if((i==null?void 0:i.arcade)==null)return void XG();const m={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},g=i.arcade.arcadeUtils,v=g.getViewInfo(m),_=g.createExecContext(a,v,i.timeZone);if(!d){const b=g.createSyntaxTree(r.valueExpression);d=g.createFunction(b),r.cache.compiledFunc=d}f=g.executeFunction(d,_)}else l&&(f=l[c]||0);return f=typeof f!="number"||isNaN(f)?null:n+o*f,f}function cut(t,e,i){const r=typeof e=="number",s=r?null:e,n=s==null?void 0:s.attributes;let o=r?e:null;const{isScaleDriven:a}=t.cache;let l=t.cache.compiledFunc;if(a){const h=i!=null?i.scale:void 0,d=i!=null?i.view:void 0;o=h==null||d==="3d"?uut(t):h}else if(!r)switch(t.inputValueType){case av.Expression:{if((i==null?void 0:i.arcade)==null)return void XG();const h={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},d=i.arcade.arcadeUtils,f=d.getViewInfo(h),m=d.createExecContext(s,f,i.timeZone);if(!l){const g=d.createSyntaxTree(t.valueExpression);l=d.createFunction(g),t.cache.compiledFunc=l}o=d.executeFunction(l,m);break}case av.Field:n&&(o=n[t.field]);break;case av.Unknown:o=null}if(!U3(o))return null;if(r||!t.normalizationField)return o;const c=n?parseFloat(n[t.normalizationField]):null;return U3(c)&&c!==0?o/c:null}function uut(t){let e=null,i=null;const r=t.stops;return r?(e=r[0].value,i=r[r.length-1].value):(e=t.minDataValue||0,i=t.maxDataValue||0),(e+i)/2}function KG(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(n=>n.type==="size"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void JG("SizeVariable");const s=SPe(cut(r,e,i),r,e,i,r.cache.ipData);return s==null||isNaN(s)?0:s}function ru(t,e,i){return t==null?null:lC(t)?KG(t,e,i):U3(t)?t:null}function xPe(t,e,i){return U3(i)&&t>i?i:U3(e)&&t<e?e:t}function hut(t,e,i,r){return t+((ru(e.minSize,i,r)||e.minDataValue)??0)}function dut(t,e,i){const r=t.stops;let s=(r==null?void 0:r.length)&&r[0].size;return s==null&&(s=t.minSize),ru(s,e,i)}function put(t,e,i,r){const s=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),n=ru(e.minSize,i,r),o=ru(e.maxSize,i,r),a=r!=null?r.shape:void 0;if(t<=e.minDataValue)return n;if(t>=e.maxDataValue)return o;if(n==null||o==null)return null;if(e.scaleBy==="area"&&a){const l=a==="circle",c=l?b5*(n/2)**2:n*n,h=c+s*((l?b5*(o/2)**2:o*o)-c);return l?2*Math.sqrt(h/b5):Math.sqrt(h)}return n+s*(o-n)}function fut(t,e,i,r){const s=r!=null?r.shape:void 0,n=t/e.minDataValue,o=ru(e.minSize,i,r),a=ru(e.maxSize,i,r);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,xPe(l,o,a)}function mut(t,e,i,r,s){var l,c,h;const[n,o,a]=Xse(t,s);if(n===o)return ru((l=e.stops)==null?void 0:l[n].size,i,r);{const d=ru((c=e.stops)==null?void 0:c[n].size,i,r);return d+(ru((h=e.stops)==null?void 0:h[o].size,i,r)-d)*a}}function gut(t,e,i,r){const s=((r==null?void 0:r.resolution)??1)*fA[e.valueUnit],n=ru(e.minSize,i,r),o=ru(e.maxSize,i,r),{valueRepresentation:a}=e;let l=null;return l=a==="area"?2*Math.sqrt(t/b5)/s:a==="radius"||a==="distance"?2*t/s:t/s,xPe(l,n,o)}function SPe(t,e,i,r,s){switch(e.transformationType){case Wo.Additive:return hut(t,e,i,r);case Wo.Constant:return dut(e,i,r);case Wo.ClampedLinear:return put(t,e,i,r);case Wo.Proportional:return fut(t,e,i,r);case Wo.Stops:return mut(t,e,i,r,s);case Wo.RealWorldSize:return gut(t,e,i,r);case Wo.Identity:return t;case Wo.Unknown:return null}}function yut(t,e,i){const{isScaleDriven:r}=t.cache;if(!(r&&i==="3d"||e))return null;const s={scale:e,view:i};let n=ru(t.minSize,tfe,s),o=ru(t.maxSize,tfe,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function Jse(t,e,i){if(!t.visualVariables)return;const r=[],s=[],n=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=_Pe(l,e,i);r.push({variable:l,value:c})}),n.forEach(l=>{const c=bPe(l,e,i);r.push({variable:l,value:c})}),a.forEach(l=>{const c=wPe(l,e,i);r.push({variable:l,value:c})}),o.forEach(l=>{const c=KG(l,e,i);r.push({variable:l,value:c})}),r.filter(l=>l.value!=null)}function Xse(t,e){if(!e)return;let i=0,r=e.length-1;return e.some((s,n)=>t<s?(r=n,!0):(i=n,!1)),[i,r,(t-e[i])/(e[r]-e[i])]}function vut(t,e,i){const r=["proportional","proportional","proportional"];for(const s of t){const n=s.useSymbolValue?"symbol-value":KG(s,e,i);switch(s.axis){case"width":r[0]=n;break;case"depth":r[1]=n;break;case"height":r[2]=n;break;case"width-and-depth":r[0]=n,r[1]=n;break;case"all":case void 0:case null:r[0]=n,r[1]=n,r[2]=n;break;default:s.axis}}return r}const lXt=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:vut,getColor:_Pe,getOpacity:bPe,getRotationAngle:wPe,getSize:KG,getSizeForValue:SPe,getSizeFromNumberOrVariable:ru,getSizeRangeAtScale:yut,getVisualVariableValues:Jse,viewScaleRE:vPe},Symbol.toStringTag,{value:"Module"}));function _ut(t,e){if(t.symbol!=null)return t.symbol;const i=e==null?void 0:e.renderer;return i!=null&&i.type!=="dot-density"?i.getSymbol(t,e):null}function cXt(t,e){const i=_ut(t,e);if(i==null)return null;const r=e==null?void 0:e.renderer,s=new Yse(r,i);if(r==null||!("visualVariables"in r)||!r.visualVariables)return s;const n=Jse(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)switch(a.type){case"color":s.color=l.toRgba();break;case"size":if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=h;break;case"depth":o[1]=h;break;case"height":o[2]=h;break;case"width-and-depth":o[0]=o[1]=h;break;default:o[0]=o[1]=o[2]=h}}break;case"opacity":s.opacity=l;break;case"rotation":switch(a.axis){case"tilt":s.tilt=l;break;case"roll":s.roll=l;break;default:s.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function but(t,e){var i;return t.symbol!=null?t.symbol:((i=e==null?void 0:e.renderer)==null?void 0:i.getSymbolAsync(t,e))??null}async function uXt(t,e){const i=await but(t,e);if(!i)return null;const r=e==null?void 0:e.renderer,s=new Yse(r,i);if(!r||!("visualVariables"in r)||!r.visualVariables)return s;const n=Jse(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)if(a.type==="color")s.color=Je.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=h:c==="depth"?o[1]=h:c==="height"?o[2]=h:o[0]=o[1]=c==="width-and-depth"?h:o[2]=h}else a.type==="opacity"?s.opacity=l:a.type==="rotation"&&a.axis==="tilt"?s.tilt=l:a.type==="rotation"&&a.axis==="roll"?s.roll=l:a.type==="rotation"&&(s.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function wut(t,e=0){const i=t[e];return typeof i=="number"&&isFinite(i)?i:null}function hXt(t){for(let e=0;e<3;e++){const i=t[e];if(typeof i=="number")return isFinite(i)?i:0}return 0}function SB(t){return t.type==="point"}let TPe=class{constructor(e,i=null,r=0){this.array=e,this.spatialReference=i,this.offset=r}};function EPe(t){return"array"in t}function Pm(t,e,i="ground"){if(SB(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,i);if(EPe(e)){let r=e.offset;return t.getElevation(e.array[r++],e.array[r++],e.array[r]||0,e.spatialReference??t.spatialReference,i)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,i)}var z;function xut(t){return t===z.POSITION}(function(t){t.POSITION="position",t.NORMAL="normal",t.NORMALCOMPRESSED="normalCompressed",t.UV0="uv0",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.ROTATION="rotation",t.TANGENT="tangent",t.OFFSET="offset",t.PERSPECTIVEDIVIDE="perspectiveDivide",t.CENTEROFFSETANDDISTANCE="centerOffsetAndDistance",t.LENGTH="length",t.PREVPOSITION="prevPosition",t.NEXTPOSITION="nextPosition",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.INSTANCEMODELORIGINHI="instanceModelOriginHi",t.INSTANCEMODELORIGINLO="instanceModelOriginLo",t.INSTANCEMODEL="instanceModel",t.INSTANCEMODELNORMAL="instanceModelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMAL2COMPRESSED="normal2Compressed",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.START_UP="startUp",t.END_UP="endUp",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})(z||(z={}));function Sut(t,e,i,r,s,n,o,a,l,c,h){const d=Out[h.mode];let f,m,g=0;if(Gn(t,e,i,r,l.spatialReference,s,a))return d!=null&&d.requiresAlignment(h)?(g=d.applyElevationAlignmentBuffer(r,s,n,o,a,l,c,h),f=n,m=o):(f=r,m=s),Gn(f,l.spatialReference,m,n,c.spatialReference,o,a)?g:void 0}function Kse(t,e,i,r,s){const n=(SB(t)?t.z:EPe(t)?t.array[t.offset+2]:t[2])||0;switch(i.mode){case"on-the-ground":{const o=Pm(e,t,"ground")??0;return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=Pm(e,t,"ground")??0,a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=Pm(e,t,"scene")??0,a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=i.geometryZWithOffset(n,r),a=Pm(e,t,"ground")??0;return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return void(s.z=0)}}function pXt(t,e,i,r){return Kse(t,e,i,r,cC),cC.z}function Tut(t,e,i){return e==="on-the-ground"&&i==="on-the-ground"?t.staysOnTheGround:e===i||e!=="on-the-ground"&&i!=="on-the-ground"?e==null||i==null?t.definedChanged:qm.UPDATE:t.onTheGroundChanged}function ife(t){return t==="relative-to-ground"||t==="relative-to-scene"}function rfe(t){return t!=="absolute-height"}function CPe(t,e,i,r,s){Kse(e,i,s,r,cC),$Pe(t,cC.verticalDistanceToGround);const n=cC.sampledElevation,o=_n(Iut,t.transformation);return QN[0]=e.x,QN[1]=e.y,QN[2]=cC.z,cT(e.spatialReference,QN,o,r.spatialReference)?t.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function $Pe(t,e){for(let i=0;i<t.geometries.length;++i){const r=t.geometries[i].getMutableAttribute(z.CENTEROFFSETANDDISTANCE);r&&r.data[3]!==e&&(r.data[3]=e,t.geometryVertexAttributeUpdated(t.geometries[i],z.CENTEROFFSETANDDISTANCE))}}function Eut(t,e,i,r,s,n){let o=0;const a=n.spatialReference;e*=3,r*=3;for(let l=0;l<s;++l){const c=t[e],h=t[e+1],d=t[e+2],f=n.getElevation(c,h,d,a,"ground")??0;o+=f,i[r]=c,i[r+1]=h,i[r+2]=f,e+=3,r+=3}return o/s}function Cut(t,e,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,d=n.spatialReference;e*=3,r*=3;for(let f=0;f<s;++f){const m=t[e],g=t[e+1],v=t[e+2],_=n.getElevation(m,g,v,d,"ground")??0;l+=_,i[r]=m,i[r+1]=g,i[r+2]=h==null?v+_+c:_+c,e+=3,r+=3}return l/s}function $ut(t,e,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,d=n.spatialReference;e*=3,r*=3;for(let f=0;f<s;++f){const m=t[e],g=t[e+1],v=t[e+2],_=n.getElevation(m,g,v,d,"scene")??0;l+=_,i[r]=m,i[r+1]=g,i[r+2]=h==null?v+_+c:_+c,e+=3,r+=3}return l/s}function Aut(t){const e=t.meterUnitOffset,i=t.featureExpressionInfoContext;return e!==0||i!=null}function Mut(t,e,i,r,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;e*=3,r*=3;for(let h=0;h<s;++h){const d=t[e],f=t[e+1],m=t[e+2];i[r]=d,i[r+1]=f,i[r+2]=c==null?m+l:l,e+=3,r+=3}return 0}let Qse=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var qm;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(qm||(qm={}));const Out={"absolute-height":{applyElevationAlignmentBuffer:Mut,requiresAlignment:Aut},"on-the-ground":{applyElevationAlignmentBuffer:Eut,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:Cut,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:$ut,requiresAlignment:()=>!0}},Iut=qe(),cC=new Qse,QN=$();var eX;let t2=eX=class extends Nt.ClonableMixin(ee){constructor(t){super(t),this.type="georeferenced",this.origin=null}};t2.absolute=new eX,u([Ve({georeferenced:"georeferenced"},{readOnly:!0})],t2.prototype,"type",void 0),u([p({type:[Number],nonNullable:!1,json:{write:!0}})],t2.prototype,"origin",void 0),t2=eX=u([A("esri.geometry.support.MeshGeoreferencedVertexSpace")],t2);const Rut=t2;let zI=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.type="local",this.origin=$()}};u([Ve({local:"local"},{readOnly:!0})],zI.prototype,"type",void 0),u([p({type:[Number],nonNullable:!0,json:{write:!0}})],zI.prototype,"origin",void 0),zI=u([A("esri.geometry.support.MeshLocalVertexSpace")],zI);const Put=zI;function gXt(t){return t.origin==null}function APe(t){return t.origin!=null}function yXt(t){return APe(t.vertexSpace)}function Dut(t,e){if(!APe(t))return null;const[i,r,s]=t.origin;return new Fe({x:i,y:r,z:s,spatialReference:e})}function vXt(t,e){const{x:i,y:r,z:s,spatialReference:n}=t,o=[i,r,s??0];return((e==null?void 0:e.vertexSpace)??Lut(n))==="local"?new Put({origin:o}):new Rut({origin:o})}function Lut(t){return t.isGeographic||t.isWebMercator?"local":"georeferenced"}function _Xt(t,e){return t.type===e.type&&(t.origin===e.origin||t.origin!=null&&e.origin!=null&&to(t.origin,e.origin))}function QG(t,e){if(t.type==="point")return g0(t,e,!1);if(aPe(t))switch(t.type){case"extent":return g0(t.center,e,!1);case"polygon":return g0(t.centroid,e,!1);case"polyline":return g0(sfe(t),e,!0);case"mesh":return g0(Dut(t.vertexSpace,t.spatialReference)??t.extent.center,e,!1);case"multipoint":return}else switch(t.type){case"extent":return g0(Nut(t),e,!0);case"polygon":return g0(Fut(t),e,!0);case"polyline":return g0(sfe(t),e,!0);case"multipoint":return}}function sfe(t){const e=t.paths[0];if(!e||e.length===0)return null;const i=gEe(e,mEe(e)/2);return uT(i[0],i[1],i[2],t.spatialReference)}function Nut(t){return uT(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function Fut(t){const e=t.rings[0];if(!e||e.length===0)return null;const i=_Ee(t.rings,!!t.hasZ);return uT(i[0],i[1],i[2],t.spatialReference)}function g0(t,e,i){const r=i?t:iut(t);return e&&t?SCe(t,r,e)?r:null:r}function bXt(t){if(!t)return 0;switch(t.type){case"point":return t.z;case"extent":return t.zmax;case"polygon":return t.hasZ?t.rings.reduce((e,i)=>i.reduce((r,s)=>Math.max(r,s[2]),e),-1/0):void 0;case"polyline":return t.hasZ?t.paths.reduce((e,i)=>i.reduce((r,s)=>Math.max(r,s[2]),e),-1/0):void 0;case"mesh":return t.extent.zmax;case"multipoint":return}}function wXt(t,e,i,r=0){if(t){e||(e=si());const s=t;let n=.5*s.width*(i-1),o=.5*s.height*(i-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),ss(e,s.xmin-n-r,s.ymin-o-r,s.xmax+n+r,s.ymax+o+r),e}return null}function eq(t,e,i=null){const r=UG(Mse);return t!=null&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),e!=null?r[3]=e:t!=null&&t.length>3&&(r[3]=t[3]),i&&(r[0]*=i,r[1]*=i,r[2]*=i,r[3]*=i),r}function xXt(t,e,i,r,s,n){for(let o=0;o<3;++o)n[o]=(t==null?void 0:t[o])!=null?t[o]:(i==null?void 0:i[o])!=null?i[o]:s[o];return n[3]=e??r??s[3],n}function SXt(t=ore,e,i,r=1){const s=new Array(3);if(e==null||i==null)s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=t[a],c=l!=null,h=a===0&&!n&&!c,d=i[a];let f;l==="symbol-value"||h?f=d!==0?e[a]/d:1:c&&l!=="proportional"&&isFinite(l)&&(f=d!==0?l/d:1),f!=null&&(s[a]=f,n=f,o=Math.max(o,Math.abs(f)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=r;return H$(s)}function kut(t){return t.isPrimitive!=null}function zut(t){return Uut(kut(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function Uut(t){const e=i=>i==null||i>=0;return Array.isArray(t)?t.every(e):e(t)}function TXt(t,e,i,r=qe()){return t&&Q$(r,r,-t/180*Math.PI),e&&K$(r,r,e/180*Math.PI),i&&uG(r,r,i/180*Math.PI),r}function But(t,e,i){if(i.minDemResolution!=null)return i.minDemResolution;const r=Mo(e),s=KS(t)*r,n=QS(t)*r,o=ow(t)*(e.isGeographic?1:r);return s===0&&n===0&&o===0?i.minDemResolutionForPoints:.01*Math.max(s,n,o)}var Al,mA,$t,Hb,hh,OS,Fn,ab;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})(Al||(Al={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(mA||(mA={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}($t||($t={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(Hb||(Hb={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(hh||(hh={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee"}(OS||(OS={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(Fn||(Fn={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(ab||(ab={}));var od;(function(t){t[t.TRANSPARENT=0]="TRANSPARENT",t[t.OPAQUE=1]="OPAQUE"})(od||(od={}));let Vut=class{constructor(e,i,r){this.baseMaterial=e,this.edgeMaterial=i,this.hasSlicePlane=r}},ene=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,i,r,s,n,o,a,l=null){this.graphics3DSymbolLayer=e,this.stageObject=i,this._uniqueGeometries=r,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const i=e.stage;i.addMany(this._uniqueMaterials),i.addMany(this._uniqueGeometries),i.add(this.stageObject)}destroy(){var i,r;if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1),(i=e.renderer.edgeView)==null||i.removeObject(this.stageObject),this.stageObject.dispose(),(r=this._sharedResource)==null||r.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,i){const{stageObject:r,_edgeState:s,_stageLayer:n}=this;if(s==null)return;const o=nfe(s.baseMaterial);s.edgeMaterial.objectTransparency!==o&&(s.edgeMaterial.objectTransparency=o,this.resetEdgeObject(i)),n.stage.renderer.withEdgeView(a=>a.updateAllComponentOpacities(r,[e]))}updateHighlights(e){}slicePlaneEnabledChanged(e,i){const{stageObject:r,_edgeState:s,_stageLayer:n}=this;s!=null&&n.stage.renderer.withEdgeView(o=>{o.updateAllComponentMaterials(r,s.edgeMaterial,e,!i),s.hasSlicePlane=e})}setVisibility(e){const{_edgeState:i,stageObject:r,_stageLayer:s}=this;s!=null&&this.visible!==e&&(this._visible=e,r.visible=e,e&&!this._addedToStage&&(s.add(r),this._addedToStage=!0),i!=null&&s.stage.renderer.withEdgeView(n=>{n.hasObject(r)?n.updateObjectVisibility(r,e):e&&this._addOrUpdateEdgeObject(i,n,!1)}))}get visible(){return this._visible}alignWithElevation(e,i,r,s){if(this.elevationAligner==null)return;r!=null&&dPe(this.elevationContext.featureExpressionInfoContext,r);const n=(o,a)=>Kse(o,e,this.elevationContext,i,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,i),this.resetEdgeObject(s)}alignWithAbsoluteElevation(e,i,r){const s=(n,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,s,i),this.resetEdgeObject(r)}getCenterObjectSpace(e=$()){return ne(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=fh()){const i=this.stageObject.boundingVolumeObjectSpace;return $Ae(e,i.min),AAe(e,i.max),e}computeAttachmentOrigin(e){const i=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=i[12],e.render.origin[1]+=i[13],e.render.origin[2]+=i[14],e.render.num++;else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(Lg)&&(ot(Lg,Lg,i),oe(e.render.origin,e.render.origin,Lg),e.render.num++)}async getProjectedBoundingBox(e,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=jut,l=OAe(o)?1:a.length;for(let h=0;h<l;h++){const d=a[h];y0[0]=o[d[0]],y0[1]=o[d[1]],y0[2]=o[d[2]],ot(y0,y0,this.stageObject.transformation),Ow[3*h]=y0[0],Ow[3*h+1]=y0[1],Ow[3*h+2]=y0[2]}if(!e(Ow,0,l))return null;bf(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let d=0;d<3;d++)o[d]=Math.min(o[d],Ow[h+d]),o[d+3]=Math.max(o[d+3],Ow[h+d]);c&&r.push({location:Ow.slice(h,h+3),screenSpaceBoundingRect:c})}if(i!=null&&i.service&&this.elevationContext.mode!=="absolute-height"){kre(o,Lg);const h=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let d=0;if(i.useViewElevation)d=i.service.getElevation(Lg[0],Lg[1],h)??0;else try{const f=But(o,i.service.spatialReference,i);d=await i.service.queryElevation(Lg[0],Lg[1],s,f,h)??0}catch{}kKe(o,0,0,-this.alignedSampledElevation+d)}return o}addObjectState(e){e.stateType===OS.Highlight&&e.addObject(this.stageObject,this.stageObject.highlight(e.highlightName)),e.stateType===OS.MaskOccludee&&e.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeByObject(this.stageObject)}resetEdgeObject(e){const{_edgeState:i,stageObject:r,_stageLayer:s,_visible:n}=this;i!=null&&s.stage.renderer.withEdgeView(o=>{n?this._addOrUpdateEdgeObject(i,o,e):o.removeObject(r)})}_addOrUpdateEdgeObject(e,i,r){const s=nfe(e.baseMaterial);e.edgeMaterial.objectTransparency=s,i.addOrUpdateObject3D(this.stageObject,e.edgeMaterial,e.hasSlicePlane,!r).then(()=>{var n;return(n=this._stageLayer)==null?void 0:n.sync()})}};function nfe(t){return t.parameters.transparent?od.TRANSPARENT:od.OPAQUE}const Ow=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],y0=$(),Lg=$(),jut=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],Gut=3,Hut=3,qut=10;function Zc(){return new Float32Array(3)}function tX(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function wr(t,e,i){const r=new Float32Array(3);return r[0]=t,r[1]=e,r[2]=i,r}function Wut(t,e){return new Float32Array(t,e,3)}function MPe(){return Zc()}function OPe(){return wr(1,1,1)}function IPe(){return wr(1,0,0)}function RPe(){return wr(0,1,0)}function PPe(){return wr(0,0,1)}const Zut=MPe(),Yut=OPe(),Jut=IPe(),Xut=RPe(),Kut=PPe();Object.freeze(Object.defineProperty({__proto__:null,ONES:Yut,UNIT_X:Jut,UNIT_Y:Xut,UNIT_Z:Kut,ZEROS:Zut,clone:tX,create:Zc,createView:Wut,fromValues:wr,ones:OPe,unitX:IPe,unitY:RPe,unitZ:PPe,zeros:MPe},Symbol.toStringTag,{value:"Module"}));function oh(t,e=!1){return t<=lh?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function $Xt(t){return Array.isArray(t)?t.length<lh?t:new Float32Array(t):t.length<lh?Array.from(t):t}function ofe(t){return(Array.isArray(t)?t.length:t.byteLength/8)<=lh?Array.from(t):new Float32Array(t)}function AXt(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}let e6=class{constructor(e,i,r=i){this.data=e,this.size=i,this.stride=r}},Qt=class extends e6{constructor(e,i,r,s=!1,n=r){super(e,r,n),this.indices=i,this.exclusive=s}};var iX;(function(t){function e(o,a){const l=o[a],c=o[a+1],h=o[a+2];return Math.sqrt(l*l+c*c+h*h)}function i(o,a){const l=o[a],c=o[a+1],h=o[a+2],d=1/Math.sqrt(l*l+c*c+h*h);o[a]*=d,o[a+1]*=d,o[a+2]*=d}function r(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,h,d=a){(h=h||o)[d]=o[a]+l[c],h[d+1]=o[a+1]+l[c+1],h[d+2]=o[a+2]+l[c+2]}function n(o,a,l,c,h,d=a){(h=h||o)[d]=o[a]-l[c],h[d+1]=o[a+1]-l[c+1],h[d+2]=o[a+2]-l[c+2]}t.length=e,t.normalize=i,t.scale=r,t.add=s,t.subtract=n})(iX||(iX={}));var zn;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(zn||(zn={}));function Qut(t){if(t.length<lh)return Array.from(t);if(Array.isArray(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return Rj(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}const il=yi();let eht=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function Zt(t,e="Assertion"){if(!t){const i=new Error(e).stack;throw new eht(`${e} at ${i}`)}}function UT(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function DPe(t,e,i,r){let s,n=(i[0]-t[0])/e[0],o=(r[0]-t[0])/e[0];n>o&&(s=n,n=o,o=s);let a=(i[1]-t[1])/e[1],l=(r[1]-t[1])/e[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(i[2]-t[2])/e[2],h=(r[2]-t[2])/e[2];return c>h&&(s=c,c=h,h=s),!(n>h||c>o)&&(h<o&&(o=h),!(o<0))}function eF(t,e,i,r,s,n=Ye()){const o=(r[s]-i[s])*(e[0]-t[0])-(r[0]-i[0])*(e[s]-t[s]),a=(r[0]-i[0])*(t[s]-i[s])-(r[s]-i[s])*(t[0]-i[0]);if(o===0)return!1;const l=a/o;return n[0]=t[0]+l*(e[0]-t[0]),n[1]=t[s]+l*(e[s]-t[s]),!0}function afe(t,e,i,r,s){il[0]=t[0],il[1]=t[1],il[2]=t[2],il[3]=1,eu(il,il,e),s.length>2&&(s[2]=-il[2]),eu(il,il,i),Zt(il[3]!==0),s[0]=il[0]/il[3],s[1]=il[1]/il[3],s[2]=il[2]/il[3],s[0]=(.5*s[0]+.5)*r[2]+r[0],s[1]=(.5*s[1]+.5)*r[3]+r[1]}function tht(t,e){return Math.log(t)/Math.log(e)}function iht(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}let LPe=class NPe{constructor(e,i,r){this.primitiveIndices=e,this._numIndexPerPrimitive=i,this.position=r,this._children=void 0,Zt(e.length>=1),Zt(r.size===3||r.size===4);const{data:s,size:n,indices:o}=r;Zt(o.length%this._numIndexPerPrimitive==0),Zt(o.length>=e.length*this._numIndexPerPrimitive);const a=e.length;let l=n*o[this._numIndexPerPrimitive*e[0]];Iw.clear(),Iw.push(l);const c=De(s[l],s[l+1],s[l+2]),h=os(c);for(let m=0;m<a;++m){const g=this._numIndexPerPrimitive*e[m];for(let v=0;v<this._numIndexPerPrimitive;++v){l=n*o[g+v],Iw.push(l);let _=s[l];c[0]=Math.min(_,c[0]),h[0]=Math.max(_,h[0]),_=s[l+1],c[1]=Math.min(_,c[1]),h[1]=Math.max(_,h[1]),_=s[l+2],c[2]=Math.min(_,c[2]),h[2]=Math.max(_,h[2])}}this.bbMin=c,this.bbMax=h;const d=fr($(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(h[0]-c[0],h[1]-c[1]),h[2]-c[2]);let f=this.radius*this.radius;for(let m=0;m<Iw.length;++m){l=Iw.at(m);const g=s[l]-d[0],v=s[l+1]-d[1],_=s[l+2]-d[2],b=g*g+v*v+_*_;if(b<=f)continue;const w=Math.sqrt(b),x=.5*(w-this.radius);this.radius=this.radius+x,f=this.radius*this.radius;const S=x/w;d[0]+=g*S,d[1]+=v*S,d[2]+=_*S}this.center=d,Iw.clear()}getChildren(){if(this._children||no(this.bbMin,this.bbMax)<=1)return this._children;const e=fr($(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,r=new Uint8Array(i),s=new Array(8);for(let h=0;h<8;++h)s[h]=0;const{data:n,size:o,indices:a}=this.position;for(let h=0;h<i;++h){let d=0;const f=this._numIndexPerPrimitive*this.primitiveIndices[h];let m=o*a[f],g=n[m],v=n[m+1],_=n[m+2];for(let b=1;b<this._numIndexPerPrimitive;++b){m=o*a[f+b];const w=n[m],x=n[m+1],S=n[m+2];w<g&&(g=w),x<v&&(v=x),S<_&&(_=S)}g<e[0]&&(d|=1),v<e[1]&&(d|=2),_<e[2]&&(d|=4),r[h]=d,++s[d]}let l=0;for(let h=0;h<8;++h)s[h]>0&&++l;if(l<2)return;const c=new Array(8);for(let h=0;h<8;++h)c[h]=s[h]>0?new Uint32Array(s[h]):void 0;for(let h=0;h<8;++h)s[h]=0;for(let h=0;h<i;++h){const d=r[h];c[d][s[d]++]=this.primitiveIndices[h]}this._children=new Array;for(let h=0;h<8;++h)c[h]!==void 0&&this._children.push(new NPe(c[h],this._numIndexPerPrimitive,this.position));return this._children}static prune(){Iw.prune()}};const Iw=new ii({deallocator:null});let bL=class{constructor(){this.id=Td()}};function rht(t){return t?{p0:os(t.p0),p1:os(t.p1),p2:os(t.p2)}:{p0:$(),p1:$(),p2:$()}}function PXt(t,e,i){const r=e[0]-t[0],s=e[1]-t[1],n=i[0]-t[0],o=i[1]-t[1];return .5*Math.abs(r*o-s*n)}function sht(t,e,i){return be(tq,e,t),be(lfe,i,t),.5*Ee(ct(tq,tq,lfe))}new jv(Gv);new jv(()=>rht());const tq=$(),lfe=$();function nht(t,e){if(!t)return!1;const{size:i,data:r,indices:s}=t;se(e,0,0,0),se(Zh,0,0,0);let n=0,o=0;for(let a=0;a<s.length-2;a+=3){const l=s[a]*i,c=s[a+1]*i,h=s[a+2]*i;se(yo,r[l],r[l+1],r[l+2]),se(Zy,r[c],r[c+1],r[c+2]),se(tF,r[h],r[h+1],r[h+2]);const d=sht(yo,Zy,tF);d?(oe(yo,yo,Zy),oe(yo,yo,tF),re(yo,yo,1/3*d),oe(e,e,yo),n+=d):(oe(Zh,Zh,yo),oe(Zh,Zh,Zy),oe(Zh,Zh,tF),o+=3)}return(o!==0||n!==0)&&(n!==0?(re(e,e,1/n),!0):o!==0&&(re(e,Zh,1/o),!0))}function oht(t,e){if(!t)return!1;const{size:i,data:r,indices:s}=t;se(e,0,0,0);let n=-1,o=0;for(let a=0;a<s.length;a++){const l=s[a]*i;n!==l&&(e[0]+=r[l],e[1]+=r[l+1],e[2]+=r[l+2],o++),n=l}return o>1&&re(e,e,1/o),o>0}function aht(t,e,i){if(!t)return!1;se(i,0,0,0),se(Zh,0,0,0);let r=0,s=0;const{size:n,data:o,indices:a}=t,l=a.length-1,c=l+(e?2:0);for(let h=0;h<c;h+=2){const d=h<l?h+1:0,f=a[h<l?h:l]*n,m=a[d]*n;yo[0]=o[f],yo[1]=o[f+1],yo[2]=o[f+2],Zy[0]=o[m],Zy[1]=o[m+1],Zy[2]=o[m+2],re(yo,oe(yo,yo,Zy),.5);const g=Ba(yo,Zy);g>0?(oe(i,i,re(yo,yo,g)),r+=g):r===0&&(oe(Zh,Zh,yo),s++)}return r!==0?(re(i,i,1/r),!0):s!==0&&(re(i,Zh,1/s),!0)}const yo=$(),Zy=$(),tF=$(),Zh=$();let FPe=class{constructor(){this.uid=Td()}},kPe=class extends FPe{constructor(e){super(),this.highlightName=e,this.channel=OS.Highlight}},lht=class extends FPe{constructor(){super(...arguments),this.channel=OS.MaskOccludee}},$a=class zPe extends bL{constructor(e,i,r=null,s=zn.Mesh,n=null,o=-1){super(),this.material=e,this.mapPositions=r,this.type=s,this.objectAndLayerIdColor=n,this.edgeIndicesLength=o,this.highlights=new Set,this._highlightOptionsCounts=new Map,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(const[a,l]of i)this._attributes.set(a,{...l,indices:MS(l.indices)}),a===z.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(a).indices.length:this.edgeIndicesLength)}instantiate(e={}){const i=new zPe(e.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach((r,s)=>{r.exclusive=!1,i._attributes.set(s,r)}),i._boundingInfo=this._boundingInfo,i.transformation=e.transformation||this.transformation,i}get attributes(){return this._attributes}getMutableAttribute(e){let i=this._attributes.get(e);return i&&!i.exclusive&&(i={...i,exclusive:!0,data:Qut(i.data)},this._attributes.set(e,i)),i}setAttributeData(e,i){const r=this._attributes.get(e);r&&this._attributes.set(e,{...r,exclusive:!0,data:i})}get indexCount(){var i;const e=(i=this._attributes.values().next().value)==null?void 0:i.indices;return(e==null?void 0:e.length)??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===zn.Mesh?this._computeAttachmentOriginTriangles(e):this.type===zn.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(this._transformation!=null&&ot(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const i=this.attributes.get(z.POSITION);return nht(i,e)}_computeAttachmentOriginLines(e){const i=this.attributes.get(z.POSITION);return aht(i,cht(this.material.parameters,i),e)}_computeAttachmentOriginPoints(e){const i=this.attributes.get(z.POSITION);return oht(i,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.attributes.get(z.POSITION);if(!e||e.indices.length===0)return null;const i=this.type===zn.Mesh?3:1;Zt(e.indices.length%i==0,"Indexing error: "+e.indices.length+" not divisible by "+i);const r=vL(e.indices.length/i);return new LPe(r,i,e)}get transformation(){return this._transformation??eo}set transformation(e){this._transformation=e&&e!==eo?sRe(e):null}get highlightNames(){return this._highlightOptionsCounts}get hasHighlights(){return this._highlightOptionsCounts.size>0}foreachHighlightOptions(e){this._highlightOptionsCounts.forEach((i,r)=>e(r))}allocateIdAndHighlight(e){const i=new kPe(e);return this.addHighlight(i)}addHighlight(e){this.highlights.add(e);const{highlightName:i}=e,r=(this._highlightOptionsCounts.get(i)??0)+1;return this._highlightOptionsCounts.set(i,r),e}removeHighlight(e){if(this.highlights.delete(e)){const{highlightName:i}=e,r=this._highlightOptionsCounts.get(i)??0;r<=1?this._highlightOptionsCounts.delete(i):this._highlightOptionsCounts.set(i,r-1)}}};function cht(t,e){return!(!("isClosed"in t)||!t.isClosed)&&e.indices.length>2}const BT=iX,iq=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],uht=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],hht=[0,0,1,0,1,1,0,1],dht=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],UPe=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)UPe[6*t+e]=t;const P1=new Array(36);for(let t=0;t<6;t++)P1[6*t]=0,P1[6*t+1]=1,P1[6*t+2]=2,P1[6*t+3]=2,P1[6*t+4]=3,P1[6*t+5]=0;function pht(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(24);for(let r=0;r<8;r++)i[3*r]=iq[r][0]*e[0],i[3*r+1]=iq[r][1]*e[1],i[3*r+2]=iq[r][2]*e[2];return new $a(t,[[z.POSITION,new Qt(i,dht,3,!0)],[z.NORMAL,new Qt(uht,UPe,3)],[z.UV0,new Qt(hht,P1,2)]])}const rq=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],fht=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],mht=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],ght=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function yht(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(18);for(let r=0;r<6;r++)i[3*r]=rq[r][0]*e[0],i[3*r+1]=rq[r][1]*e[1],i[3*r+2]=rq[r][2]*e[2];return new $a(t,[[z.POSITION,new Qt(i,mht,3,!0)],[z.NORMAL,new Qt(fht,ght,3)]])}const w5=wr(-.5,0,-.5),x5=wr(.5,0,-.5),S5=wr(0,0,.5),T5=wr(0,.5,0),VT=Zc(),jT=Zc(),ZC=Zc(),YC=Zc(),JC=Zc();be(VT,w5,T5),be(jT,w5,x5),ct(ZC,VT,jT),ae(ZC,ZC),be(VT,x5,T5),be(jT,x5,S5),ct(YC,VT,jT),ae(YC,YC),be(VT,S5,T5),be(jT,S5,w5),ct(JC,VT,jT),ae(JC,JC);const sq=[w5,x5,S5,T5],vht=[0,-1,0,ZC[0],ZC[1],ZC[2],YC[0],YC[1],YC[2],JC[0],JC[1],JC[2]],_ht=[0,1,2,3,1,0,3,2,1,3,0,2],bht=[0,0,0,1,1,1,2,2,2,3,3,3];function wht(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(12);for(let r=0;r<4;r++)i[3*r]=sq[r][0]*e[0],i[3*r+1]=sq[r][1]*e[1],i[3*r+2]=sq[r][2]*e[2];return new $a(t,[[z.POSITION,new Qt(i,_ht,3,!0)],[z.NORMAL,new Qt(vht,bht,3)]])}function FXt(t,e,i,r,s={uv:!0}){const n=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(i)),h=Math.max(2,Math.floor(r)),d=(c+1)*(h+1),f=oh(3*d),m=oh(3*d),g=oh(2*d),v=[];let _=0;for(let x=0;x<=h;x++){const S=[],C=x/h,T=a+C*l,M=Math.cos(T);for(let I=0;I<=c;I++){const D=I/c,P=n+D*o,F=Math.cos(P)*M,L=Math.sin(T),N=-Math.sin(P)*M;f[3*_]=F*e,f[3*_+1]=L*e,f[3*_+2]=N*e,m[3*_]=F,m[3*_+1]=L,m[3*_+2]=N,g[2*_]=D,g[2*_+1]=C,S.push(_),++_}v.push(S)}const b=new Array;for(let x=0;x<h;x++)for(let S=0;S<c;S++){const C=v[x][S],T=v[x][S+1],M=v[x+1][S+1],I=v[x+1][S];x===0?(b.push(C),b.push(M),b.push(I)):x===h-1?(b.push(C),b.push(T),b.push(M)):(b.push(C),b.push(T),b.push(M),b.push(M),b.push(I),b.push(C))}const w=[[z.POSITION,new Qt(f,b,3,!0)],[z.NORMAL,new Qt(m,b,3,!0)]];return s.uv&&w.push([z.UV0,new Qt(g,b,2,!0)]),s.offset&&(w[0][0]=z.OFFSET,w.push([z.POSITION,new Qt(Float64Array.from(s.offset),_L(b.length),3,!0)])),new $a(t,w)}function xht(t,e,i,r){const s=BPe(e,i,r);return new $a(t,s)}function BPe(t,e,i){const r=t;let s,n;if(i)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const c=r*(1+Math.sqrt(5))/2;s=[-r,c,0,r,c,0,-r,-c,0,r,-c,0,0,-r,c,0,r,c,0,-r,-c,0,r,-c,c,0,-r,c,0,r,-c,0,-r,-c,0,r],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let c=0;c<s.length;c+=3)BT.scale(s,c,t/BT.length(s,c));let o={};function a(c,h){c>h&&([c,h]=[h,c]);const d=c.toString()+"."+h.toString();if(o[d])return o[d];let f=s.length;return s.length+=3,BT.add(s,3*c,s,3*h,s,f),BT.scale(s,f,t/BT.length(s,f)),f/=3,o[d]=f,f}for(let c=0;c<e;c++){const h=n.length,d=new Array(4*h);for(let f=0;f<h;f+=3){const m=n[f],g=n[f+1],v=n[f+2],_=a(m,g),b=a(g,v),w=a(v,m),x=4*f;d[x]=m,d[x+1]=_,d[x+2]=w,d[x+3]=g,d[x+4]=b,d[x+5]=_,d[x+6]=v,d[x+7]=w,d[x+8]=b,d[x+9]=_,d[x+10]=b,d[x+11]=w}n=d,o={}}const l=ofe(s);for(let c=0;c<l.length;c+=3)BT.normalize(l,c);return[[z.POSITION,new Qt(ofe(s),n,3,!0)],[z.NORMAL,new Qt(l,n,3,!0)]]}function kXt(t,e={}){const{normal:i,position:r,color:s,rotation:n,size:o,centerOffsetAndDistance:a,uvs:l,featureAttribute:c,objectAndLayerIdColor:h=null}=e,d=r?os(r):$(),f=i?os(i):De(0,0,1),m=s?[255*s[0],255*s[1],255*s[2],s.length>3?255*s[3]:255]:[255,255,255,255],g=o!=null&&o.length===2?o:[1,1],v=n!=null?[n]:[0],_=_L(1),b=[[z.POSITION,new Qt(d,_,3,!0)],[z.NORMAL,new Qt(f,_,3,!0)],[z.COLOR,new Qt(m,_,4,!0)],[z.SIZE,new Qt(g,_,2)],[z.ROTATION,new Qt(v,_,1,!0)]];if(l&&b.push([z.UV0,new Qt(l,_,l.length)]),a!=null){const w=[a[0],a[1],a[2],a[3]];b.push([z.CENTEROFFSETANDDISTANCE,new Qt(w,_,4)])}if(c){const w=[c[0],c[1],c[2],c[3]];b.push([z.FEATUREATTRIBUTE,new Qt(w,_,4)])}return new $a(t,b,null,zn.Point,h)}const Sht=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function zXt(t,e=Sht){const i=new Array(12);for(let c=0;c<4;c++)for(let h=0;h<3;h++)i[3*c+h]=e[c][h];const r=[0,1,2,2,3,0],s=[0,0,1],n=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[z.POSITION,new Qt(i,r,3,!0)],[z.NORMAL,new Qt(s,n,3,!0)],[z.UV0,new Qt(o,r,2,!0)],[z.COLOR,new Qt(a,n,4,!0)]];return new $a(t,l)}function Tht(t,e,i,r,s=!0,n=!0){let o=0;const a=e,l=t;let c=wr(0,o,0),h=wr(0,o+l,0),d=wr(0,-1,0),f=wr(0,1,0);r&&(o=l,h=wr(0,0,0),c=wr(0,o,0),d=wr(0,1,0),f=wr(0,-1,0));const m=[h,c],g=[d,f],v=i+2,_=Math.sqrt(l*l+a*a);if(r)for(let C=i-1;C>=0;C--){const T=C*(2*Math.PI/i),M=wr(Math.cos(T)*a,o,Math.sin(T)*a);m.push(M);const I=wr(l*Math.cos(T)/_,-a/_,l*Math.sin(T)/_);g.push(I)}else for(let C=0;C<i;C++){const T=C*(2*Math.PI/i),M=wr(Math.cos(T)*a,o,Math.sin(T)*a);m.push(M);const I=wr(l*Math.cos(T)/_,a/_,l*Math.sin(T)/_);g.push(I)}const b=new Array,w=new Array;if(s){for(let C=3;C<m.length;C++)b.push(1),b.push(C-1),b.push(C),w.push(0),w.push(0),w.push(0);b.push(m.length-1),b.push(2),b.push(1),w.push(0),w.push(0),w.push(0)}if(n){for(let C=3;C<m.length;C++)b.push(C),b.push(C-1),b.push(0),w.push(C),w.push(C-1),w.push(1);b.push(0),b.push(2),b.push(m.length-1),w.push(1),w.push(2),w.push(g.length-1)}const x=oh(3*v);for(let C=0;C<v;C++)x[3*C]=m[C][0],x[3*C+1]=m[C][1],x[3*C+2]=m[C][2];const S=oh(3*v);for(let C=0;C<v;C++)S[3*C]=g[C][0],S[3*C+1]=g[C][1],S[3*C+2]=g[C][2];return[[z.POSITION,new Qt(x,b,3,!0)],[z.NORMAL,new Qt(S,w,3,!0)]]}function cfe(t,e,i,r,s,n=!0,o=!0){return new $a(t,Tht(e,i,r,s,n,o))}function Eht(t,e,i,r,s,n,o){const a=s?tX(s):wr(1,0,0),l=n?tX(n):wr(0,0,0);o??(o=!0);const c=Zc();ae(c,a);const h=Zc();re(h,c,Math.abs(e));const d=Zc();re(d,h,-.5),oe(d,d,l);const f=wr(0,1,0);Math.abs(1-fe(c,f))<.2&&se(f,0,0,1);const m=Zc();ct(m,c,f),ae(m,m),ct(f,m,c);const g=2*r+(o?2:0),v=r+(o?2:0),_=oh(3*g),b=oh(3*v),w=oh(2*g),x=new Array(3*r*(o?4:2)),S=new Array(3*r*(o?4:2));o&&(_[3*(g-2)]=d[0],_[3*(g-2)+1]=d[1],_[3*(g-2)+2]=d[2],w[2*(g-2)]=0,w[2*(g-2)+1]=0,_[3*(g-1)]=_[3*(g-2)]+h[0],_[3*(g-1)+1]=_[3*(g-2)+1]+h[1],_[3*(g-1)+2]=_[3*(g-2)+2]+h[2],w[2*(g-1)]=1,w[2*(g-1)+1]=1,b[3*(v-2)]=-c[0],b[3*(v-2)+1]=-c[1],b[3*(v-2)+2]=-c[2],b[3*(v-1)]=c[0],b[3*(v-1)+1]=c[1],b[3*(v-1)+2]=c[2]);const C=(P,F,L)=>{x[P]=F,S[P]=L};let T=0;const M=Zc(),I=Zc();for(let P=0;P<r;P++){const F=P*(2*Math.PI/r);re(M,f,Math.sin(F)),re(I,m,Math.cos(F)),oe(M,M,I),b[3*P]=M[0],b[3*P+1]=M[1],b[3*P+2]=M[2],re(M,M,i),oe(M,M,d),_[3*P]=M[0],_[3*P+1]=M[1],_[3*P+2]=M[2],w[2*P]=P/r,w[2*P+1]=0,_[3*(P+r)]=_[3*P]+h[0],_[3*(P+r)+1]=_[3*P+1]+h[1],_[3*(P+r)+2]=_[3*P+2]+h[2],w[2*(P+r)]=P/r,w[2*P+1]=1;const L=(P+1)%r;C(T++,P,P),C(T++,P+r,P),C(T++,L,L),C(T++,L,L),C(T++,P+r,P),C(T++,L+r,L)}if(o){for(let P=0;P<r;P++){const F=(P+1)%r;C(T++,g-2,v-2),C(T++,P,v-2),C(T++,F,v-2)}for(let P=0;P<r;P++){const F=(P+1)%r;C(T++,P+r,v-1),C(T++,g-1,v-1),C(T++,F+r,v-1)}}const D=[[z.POSITION,new Qt(_,x,3,!0)],[z.NORMAL,new Qt(b,S,3,!0)],[z.UV0,new Qt(w,x,2,!0)]];return new $a(t,D)}function UXt(t,e,i,r,s,n){r=r||10,s=s==null||s,Zt(e.length>1);const o=[[0,0,0]],a=[],l=[];for(let c=0;c<r;c++){a.push([0,-c-1,-(c+1)%r-1]);const h=c/r*2*Math.PI;l.push([Math.cos(h)*i,Math.sin(h)*i])}return Cht(t,l,e,o,a,s,n)}function Cht(t,e,i,r,s,n,o=wr(0,0,0)){const a=e.length,l=oh(i.length*a*3+(6*r.length||0)),c=oh(i.length*a*3+(r?6:0)),h=new Array,d=new Array;let f=0,m=0;const g=$(),v=$(),_=$(),b=$(),w=$(),x=$(),S=$(),C=$(),T=$(),M=$(),I=$(),D=$(),P=$(),F=Gr();se(T,0,1,0),be(v,i[1],i[0]),ae(v,v),n?(oe(C,i[0],o),ae(_,C)):se(_,0,0,1),ufe(v,_,T,T,w,_,hfe),ne(b,_),ne(D,w);for(let B=0;B<r.length;B++)re(x,w,r[B][0]),re(C,_,r[B][2]),oe(x,x,C),oe(x,x,i[0]),l[f++]=x[0],l[f++]=x[1],l[f++]=x[2];c[m++]=-v[0],c[m++]=-v[1],c[m++]=-v[2];for(let B=0;B<s.length;B++)h.push(s[B][0]>0?s[B][0]:-s[B][0]-1+r.length),h.push(s[B][1]>0?s[B][1]:-s[B][1]-1+r.length),h.push(s[B][2]>0?s[B][2]:-s[B][2]-1+r.length),d.push(0),d.push(0),d.push(0);let L=r.length;const N=r.length-1;for(let B=0;B<i.length;B++){let te=!1;B>0&&(ne(g,v),B<i.length-1?(be(v,i[B+1],i[B]),ae(v,v)):te=!0,oe(M,g,v),ae(M,M),oe(I,i[B-1],b),dA(i[B],M,F),dM(F,wf(I,g),C)?(be(C,C,i[B]),ae(_,C),ct(w,M,_),ae(w,w)):ufe(M,b,D,T,w,_,hfe),ne(b,_),ne(D,w)),n&&(oe(C,i[B],o),ae(P,C));for(let le=0;le<a;le++)if(re(x,w,e[le][0]),re(C,_,e[le][1]),oe(x,x,C),ae(S,x),c[m++]=S[0],c[m++]=S[1],c[m++]=S[2],oe(x,x,i[B]),l[f++]=x[0],l[f++]=x[1],l[f++]=x[2],!te){const de=(le+1)%a;h.push(L+le),h.push(L+a+le),h.push(L+de),h.push(L+de),h.push(L+a+le),h.push(L+a+de);for(let Ae=0;Ae<6;Ae++){const We=h.length-6;d.push(h[We+Ae]-N)}}L+=a}const R=i[i.length-1];for(let B=0;B<r.length;B++)re(x,w,r[B][0]),re(C,_,r[B][1]),oe(x,x,C),oe(x,x,R),l[f++]=x[0],l[f++]=x[1],l[f++]=x[2];const k=m/3;c[m++]=v[0],c[m++]=v[1],c[m++]=v[2];const W=L-a;for(let B=0;B<s.length;B++)h.push(s[B][0]>=0?L+s[B][0]:-s[B][0]-1+W),h.push(s[B][2]>=0?L+s[B][2]:-s[B][2]-1+W),h.push(s[B][1]>=0?L+s[B][1]:-s[B][1]-1+W),d.push(k),d.push(k),d.push(k);const j=[[z.POSITION,new Qt(l,h,3,!0)],[z.NORMAL,new Qt(c,d,3,!0)]];return new $a(t,j)}function BXt(t,e,i,r){Zt(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),Zt(e[0].length===3,"createPolylineGeometry(): malformed vertex"),Zt(i==null||i.length===e.length,"createPolylineGeometry: need same number of points and normals"),Zt(i==null||i[0].length===3,"createPolylineGeometry(): malformed normal");const s=cc(3*e.length),n=new Array(2*(e.length-1));let o=0,a=0;for(let c=0;c<e.length;c++){for(let h=0;h<3;h++)s[o++]=e[c][h];c>0&&(n[a++]=c-1,n[a++]=c)}const l=[[z.POSITION,new Qt(s,n,3,!0)]];if(i){const c=oh(3*i.length);let h=0;for(let d=0;d<e.length;d++)for(let f=0;f<3;f++)c[h++]=i[d][f];l.push([z.NORMAL,new Qt(c,n,3,!0)])}return r&&l.push([z.COLOR,new Qt(r,vL(r.length/4),4)]),new $a(t,l,null,zn.Line)}function VXt(t,e,i,r,s,n=0){const o=new Array(18),a=[[-i,n,s/2],[r,n,s/2],[0,e+n,s/2],[-i,n,-s/2],[r,n,-s/2],[0,e+n,-s/2]],l=[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5];for(let c=0;c<6;c++)o[3*c]=a[c][0],o[3*c+1]=a[c][1],o[3*c+2]=a[c][2];return new $a(t,[[z.POSITION,new Qt(o,l,3,!0)]])}function jXt(t,e){const i=t.getMutableAttribute(z.POSITION).data;for(let r=0;r<i.length;r+=3){const s=i[r],n=i[r+1],o=i[r+2];se(GT,s,n,o),ot(GT,GT,e),i[r]=GT[0],i[r+1]=GT[1],i[r+2]=GT[2]}}function $ht(t,e=t){const i=t.attributes,r=i.get(z.POSITION).data,s=i.get(z.NORMAL).data;if(s){const n=e.getMutableAttribute(z.NORMAL).data;for(let o=0;o<s.length;o+=3){const a=s[o+1];n[o+1]=-s[o+2],n[o+2]=a}}if(r){const n=e.getMutableAttribute(z.POSITION).data;for(let o=0;o<r.length;o+=3){const a=r[o+1];n[o+1]=-r[o+2],n[o+2]=a}}}function nq(t,e,i,r,s){return!(Math.abs(fe(e,t))>s)&&(ct(i,t,e),ae(i,i),ct(r,i,t),ae(r,r),!0)}function ufe(t,e,i,r,s,n,o){return nq(t,e,s,n,o)||nq(t,i,s,n,o)||nq(t,r,s,n,o)}const hfe=.99619469809,GT=$();function Aht(t){return 32+t.length}const VPe=16;function tne(t){if(!t)return 0;let e=By;for(const i in t)t.hasOwnProperty(i)&&(e+=ine(t[i],!1));return e}function TB(t){if(!t)return 0;if(typeof t[0]=="number")return t6(t);if(Array.isArray(t))return Mht(t);let e=By;for(const i in t)t.hasOwnProperty(i)&&(e+=ine(t[i]));return e}function Mht(t){const e=t.length;if(e===0||typeof t[0]=="number")return jPe(t,8);let i=GPe;for(let r=0;r<e;r++)i+=ine(t[r]);return i}function ine(t,e=!0){switch(typeof t){case"object":return e?TB(t):By;case"string":return Aht(t);case"number":return VPe;case"boolean":return 4;default:return 8}}function t6(...t){return t.reduce((e,i)=>e+(i?RD(i)?i.byteLength+rne:Array.isArray(i)?jPe(i,VPe):0:0),0)}function jPe(t,e){return GPe+t.length*e}const By=32,GPe=16,rne=145;var Xr,Co;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL",t[t.TILES3D=8]="TILES3D"})(Xr||(Xr={}));let Oht=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=Co.ALL,this.normalRequired=!0,this.excludeLabels=!1}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(Co||(Co={}));let Iht=class{constructor(e,i,r){this.object=e,this.geometryId=i,this.triangleNr=r}},Rht=class extends Iht{constructor(e,i,r,s){super(e,i,r),this.center=s!=null?os(s):null}},HPe=class{constructor(e){this.layerUid=e}},wL=class extends HPe{constructor(e,i){super(e),this.graphicUid=i}};function dh(t){return(t==null?void 0:t.dist)!=null}function dfe(t){return(e,i,r)=>(fr(pfe,e,i,r),!Bse(t,pfe))}function i6(t){return dh(t)&&t.intersector===Xr.OBJECT&&!!t.target}function r6(t){return dh(t)&&t.intersector===Xr.HUD&&!!t.target&&"center"in t.target&&t.target.center!=null}const pfe=$();function Pht(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function EB(t,e,i){i*=.5;const r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function sne(t,e){const i=2*Math.acos(e[3]),r=Math.sin(i/2);return r>To()?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),i}function s6(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=i[0],l=i[1],c=i[2],h=i[3];return t[0]=r*h+o*a+s*c-n*l,t[1]=s*h+o*l+n*a-r*c,t[2]=n*h+o*c+r*l-s*a,t[3]=o*h-r*a-s*l-n*c,t}function Dht(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+o*a,t[1]=s*l+n*a,t[2]=n*l-s*a,t[3]=o*l-r*a,t}function Lht(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l-n*a,t[1]=s*l+o*a,t[2]=n*l+r*a,t[3]=o*l-s*a,t}function Nht(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+s*a,t[1]=s*l-r*a,t[2]=n*l+o*a,t[3]=o*l-n*a,t}function Fht(t,e){const i=e[0],r=e[1],s=e[2];return t[0]=i,t[1]=r,t[2]=s,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-s*s)),t}function E5(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=e[3];let l,c,h,d,f,m=i[0],g=i[1],v=i[2],_=i[3];return c=s*m+n*g+o*v+a*_,c<0&&(c=-c,m=-m,g=-g,v=-v,_=-_),1-c>To()?(l=Math.acos(c),h=Math.sin(l),d=Math.sin((1-r)*l)/h,f=Math.sin(r*l)/h):(d=1-r,f=r),t[0]=d*s+f*m,t[1]=d*n+f*g,t[2]=d*o+f*v,t[3]=d*a+f*_,t}function kht(t){const e=tL,i=e(),r=e(),s=e(),n=Math.sqrt(1-i),o=Math.sqrt(i);return t[0]=n*Math.sin(2*Math.PI*r),t[1]=n*Math.cos(2*Math.PI*r),t[2]=o*Math.sin(2*Math.PI*s),t[3]=o*Math.cos(2*Math.PI*s),t}function zht(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=i*i+r*r+s*s+n*n,a=o?1/o:0;return t[0]=-i*a,t[1]=-r*a,t[2]=-s*a,t[3]=n*a,t}function Tb(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function qPe(t,e){const i=e[0]+e[4]+e[8];let r;if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;r=Math.sqrt(e[3*s+s]-e[3*n+n]-e[3*o+o]+1),t[s]=.5*r,r=.5/r,t[3]=(e[3*n+o]-e[3*o+n])*r,t[n]=(e[3*n+s]+e[3*s+n])*r,t[o]=(e[3*o+s]+e[3*s+o])*r}return t}function Uht(t,e,i,r){const s=.5*Math.PI/180;e*=s,i*=s,r*=s;const n=Math.sin(e),o=Math.cos(e),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),h=Math.cos(r);return t[0]=n*l*h-o*a*c,t[1]=o*a*h+n*l*c,t[2]=o*l*c-n*a*h,t[3]=o*l*h+n*a*c,t}function Bht(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const Vht=xd,WPe=ss,jht=Rse,Ght=s6,Hht=hA,qht=wRe,Wht=VG,ZPe=Pse,Zht=ZPe,YPe=BG,Yht=YPe,nne=bRe,Jht=tS,Xht=$S;function Kht(t,e,i){const r=fe(e,i);return r<-.999999?(ct(Pf,Qht,e),ja(Pf)<1e-6&&ct(Pf,edt,e),ae(Pf,Pf),EB(t,Pf,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(ct(Pf,e,i),t[0]=Pf[0],t[1]=Pf[1],t[2]=Pf[2],t[3]=1+r,nne(t,t))}const Pf=$(),Qht=De(1,0,0),edt=De(0,1,0);function tdt(t,e,i,r,s,n){return E5(ffe,e,s,n),E5(mfe,i,r,n),E5(t,ffe,mfe,2*n*(1-n)),t}const ffe=zd(),mfe=zd();function idt(t,e,i,r){const s=rdt;return s[0]=i[0],s[3]=i[1],s[6]=i[2],s[1]=r[0],s[4]=r[1],s[7]=r[2],s[2]=-e[0],s[5]=-e[1],s[8]=-e[2],nne(t,qPe(t,s))}const rdt=Ts();Object.freeze(Object.defineProperty({__proto__:null,add:jht,calculateW:Fht,conjugate:Tb,copy:Vht,dot:qht,equals:Xht,exactEquals:Jht,fromEuler:Uht,fromMat3:qPe,getAxisAngle:sne,identity:Pht,invert:zht,len:Zht,length:ZPe,lerp:Wht,mul:Ght,multiply:s6,normalize:nne,random:kht,rotateX:Dht,rotateY:Lht,rotateZ:Nht,rotationTo:Kht,scale:Hht,set:WPe,setAxes:idt,setAxisAngle:EB,slerp:E5,sqlerp:tdt,sqrLen:Yht,squaredLength:YPe,str:Bht},Symbol.toStringTag,{value:"Module"}));const gA=1e-6,QM=$(),iF=$();function sdt(t,e){const{data:i,size:r}=t,s=i.length/r;if(s<=0)return;const n=new fdt(t);sX(QM,n.minProj,n.maxProj),UI(QM,QM,.5),ad(iF,n.maxProj,n.minProj);const o=rX(iF),a=new mdt;a.quality=o,s<14&&(t=new e6(new Float64Array(n.buffer,112,42),3));const l=$(),c=$(),h=$(),d=$(),f=$(),m=$(),g=$();switch(ndt(n,t,g,l,c,h,d,f,m,a)){case 1:return void _fe(QM,iF,e);case 2:return void ddt(t,d,e)}odt(t,g,l,c,h,d,f,m,a),JPe(t,a.b0,a.b1,a.b2,KC,QC);const v=$();ad(v,QC,KC),a.quality=rX(v),a.quality<o?XPe(a.b0,a.b1,a.b2,KC,QC,v,e):_fe(QM,iF,e)}function ndt(t,e,i,r,s,n,o,a,l,c){return adt(t,r,s),nX(r,s)<gA?1:(ad(o,r,s),pa(o,o),ldt(e,r,o,n)<gA?2:(ad(a,s,n),pa(a,a),ad(l,n,r),pa(l,l),ld(i,a,o),pa(i,i),D1(e,i,o,a,l,c),0))}const eO=$(),tO=$(),wh=$(),xh=$(),Sh=$(),v0=$(),_0=$(),b0=$();function odt(t,e,i,r,s,n,o,a,l){cdt(t,e,i,eO,tO),eO[0]!==void 0&&(ad(wh,eO,i),pa(wh,wh),ad(xh,eO,r),pa(xh,xh),ad(Sh,eO,s),pa(Sh,Sh),ld(v0,xh,n),pa(v0,v0),ld(_0,Sh,o),pa(_0,_0),ld(b0,wh,a),pa(b0,b0),D1(t,v0,n,xh,wh,l),D1(t,_0,o,Sh,xh,l),D1(t,b0,a,wh,Sh,l)),tO[0]!==void 0&&(ad(wh,tO,i),pa(wh,wh),ad(xh,tO,r),pa(xh,xh),ad(Sh,tO,s),pa(Sh,Sh),ld(v0,xh,n),pa(v0,v0),ld(_0,Sh,o),pa(_0,_0),ld(b0,wh,a),pa(b0,b0),D1(t,v0,n,xh,wh,l),D1(t,_0,o,Sh,xh,l),D1(t,b0,a,wh,Sh,l))}function adt(t,e,i){let r=nX(t.maxVert[0],t.minVert[0]),s=0;for(let n=1;n<7;++n){const o=nX(t.maxVert[n],t.minVert[n]);o>r&&(r=o,s=n)}th(e,t.minVert[s]),th(i,t.maxVert[s])}const Th=[0,0,0];function ldt(t,e,i,r){const{data:s,size:n}=t;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){Th[0]=s[l]-e[0],Th[1]=s[l+1]-e[1],Th[2]=s[l+2]-e[2];const c=i[0]*Th[0]+i[1]*Th[1]+i[2]*Th[2],h=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],d=Th[0]*Th[0]+Th[1]*Th[1]+Th[2]*Th[2]-c*c/h;d>o&&(o=d,a=l)}return th(r,s,a),o}const Jn=Ye();function cdt(t,e,i,r,s){hdt(t,e,Jn,s,r);const n=QPe(i,e);Jn[1]-gA<=n&&(r[0]=void 0),Jn[0]+gA>=n&&(s[0]=void 0)}const gfe=$(),yfe=$(),vfe=$(),HT=$(),qT=$(),rF=$();function D1(t,e,i,r,s,n){if(KPe(e)<gA)return;ld(gfe,i,e),ld(yfe,r,e),ld(vfe,s,e),XC(t,e,Jn),qT[1]=Jn[0],HT[1]=Jn[1],rF[1]=HT[1]-qT[1];const o=[i,r,s],a=[gfe,yfe,vfe];for(let l=0;l<3;++l){XC(t,o[l],Jn),qT[0]=Jn[0],HT[0]=Jn[1],XC(t,a[l],Jn),qT[2]=Jn[0],HT[2]=Jn[1],rF[0]=HT[0]-qT[0],rF[2]=HT[2]-qT[2];const c=rX(rF);c<n.quality&&(th(n.b0,o[l]),th(n.b1,e),th(n.b2,a[l]),n.quality=c)}}const udt=$();function XC(t,e,i){const{data:r,size:s}=t;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<r.length;n+=s){const o=r[n]*e[0]+r[n+1]*e[1]+r[n+2]*e[2];i[0]=Math.min(i[0],o),i[1]=Math.max(i[1],o)}}function hdt(t,e,i,r,s){const{data:n,size:o}=t;th(r,n),th(s,r),i[0]=QPe(udt,e),i[1]=i[0];for(let a=o;a<n.length;a+=o){const l=n[a]*e[0]+n[a+1]*e[1]+n[a+2]*e[2];l<i[0]&&(i[0]=l,th(r,n,a)),l>i[1]&&(i[1]=l,th(s,n,a))}}function _fe(t,e,i){i.center=t,i.halfSize=re(e,e,.5),i.quaternion=$se}const Ng=$(),WT=$(),iO=$(),KC=$(),QC=$(),bfe=$();function ddt(t,e,i){th(Ng,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?Ng[0]=0:Math.abs(e[1])>Math.abs(e[2])?Ng[1]=0:Ng[2]=0,KPe(Ng)<gA&&(Ng[0]=Ng[1]=Ng[2]=1),ld(WT,e,Ng),pa(WT,WT),ld(iO,e,WT),pa(iO,iO),JPe(t,e,WT,iO,KC,QC),ad(bfe,QC,KC),XPe(e,WT,iO,KC,QC,bfe,i)}function JPe(t,e,i,r,s,n){XC(t,e,Jn),s[0]=Jn[0],n[0]=Jn[1],XC(t,i,Jn),s[1]=Jn[0],n[1]=Jn[1],XC(t,r,Jn),s[2]=Jn[0],n[2]=Jn[1]}const Rw=$(),rO=$(),sF=$(),Df=oRe(1,0,0,0,1,0,0,0,1),pdt=zd();function XPe(t,e,i,r,s,n,o){Df[0]=t[0],Df[1]=t[1],Df[2]=t[2],Df[3]=e[0],Df[4]=e[1],Df[5]=e[2],Df[6]=i[0],Df[7]=i[1],Df[8]=i[2],o.quaternion=gdt(pdt,Df),sX(Rw,r,s),UI(Rw,Rw,.5),UI(rO,t,Rw[0]),UI(sF,e,Rw[1]),sX(rO,rO,sF),UI(sF,i,Rw[2]),o.center=oe(rO,rO,sF),o.halfSize=re(Rw,n,.5)}const fu=7;let fdt=class{constructor(e){this.minVert=new Array(fu),this.maxVert=new Array(fu);const i=64*fu;this.buffer=new ArrayBuffer(i);let r=0;this.minProj=new Float64Array(this.buffer,r,fu),r+=8*fu,this.maxProj=new Float64Array(this.buffer,r,fu),r+=8*fu;for(let l=0;l<fu;++l)this.minVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<fu;++l)this.maxVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<fu;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(fu),n=new Array(fu),{data:o,size:a}=e;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<fu;++l){let c=s[l];th(this.minVert[l],o,c),c=n[l],th(this.maxVert[l],o,c)}}},mdt=class{constructor(){this.b0=De(1,0,0),this.b1=De(0,1,0),this.b2=De(0,0,1),this.quality=0}};function rX(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function sX(t,e,i){t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2]}function ad(t,e,i){t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2]}function UI(t,e,i){t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}function th(t,e,i=0){t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2]}function ld(t,e,i){const r=e[0],s=e[1],n=e[2],o=i[0],a=i[1],l=i[2];t[0]=s*l-n*a,t[1]=n*o-r*l,t[2]=r*a-s*o}function pa(t,e){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(i>0){const r=1/Math.sqrt(i);t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}}function KPe(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function nX(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return i*i+r*r+s*s}function QPe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function gdt(t,e){const i=e[0]+e[4]+e[8];if(i>0){let r=Math.sqrt(i+1);t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r}else{let r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);const s=(r+1)%3,n=(r+2)%3;let o=Math.sqrt(e[3*r+r]-e[3*s+s]-e[3*n+n]+1);t[r]=.5*o,o=.5/o,t[3]=(e[3*s+n]-e[3*n+s])*o,t[s]=(e[3*s+r]+e[3*r+s])*o,t[n]=(e[3*n+r]+e[3*r+n])*o}return t}let e3e=class C5{constructor(e=cn,i=Cdt,r=$se){this._data=[e[0],e[1],e[2],i[0],i[1],i[2],r[0],r[1],r[2],r[3]]}clone(){const e=new C5;return e._data=this._data.slice(),e}invalidate(){this._data[3]=-1}get isValid(){return this._data[3]>=0}static fromData(e){const i=new C5;return i._data=e.slice(),i}static fromJSON(e){return new C5(e.center,e.halfSize,e.quaternion)}copy(e){this._data=e.data.slice()}get center(){return se(Le.get(),this._data[0],this._data[1],this._data[2])}get centerX(){return this._data[0]}get centerY(){return this._data[1]}get centerZ(){return this._data[2]}getCenter(e){return e[0]=this._data[0],e[1]=this._data[1],e[2]=this._data[2],e}set center(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2]}setCenter(e,i,r){this._data[0]=e,this._data[1]=i,this._data[2]=r}get halfSize(){return se(Le.get(),this._data[3],this._data[4],this._data[5])}get halfSizeX(){return this._data[3]}get halfSizeY(){return this._data[4]}get halfSizeZ(){return this._data[5]}getHalfSize(e){return e[0]=this._data[3],e[1]=this._data[4],e[2]=this._data[5],e}set halfSize(e){this._data[3]=e[0],this._data[4]=e[1],this._data[5]=e[2]}get quaternion(){return WPe(Bat.get(),this._data[6],this._data[7],this._data[8],this._data[9])}getQuaternion(e){return e[0]=this._data[6],e[1]=this._data[7],e[2]=this._data[8],e[3]=this._data[9],e}set quaternion(e){this._data[6]=e[0],this._data[7]=e[1],this._data[8]=e[2],this._data[9]=e[3]}get data(){return this._data}getCorners(e){const i=is,r=this._data;i[0]=r[6],i[1]=r[7],i[2]=r[8],i[3]=r[9];for(let s=0;s<8;++s){const n=e[s];n[0]=(1&s?-1:1)*r[3],n[1]=(2&s?-1:1)*r[4],n[2]=(4&s?-1:1)*r[5],Hc(n,n,i),n[0]+=r[0],n[1]+=r[1],n[2]+=r[2]}}doesIntersectFrustumConservativeApproximation(e){return this.intersectPlane(e[0])<=0&&this.intersectPlane(e[1])<=0&&this.intersectPlane(e[2])<=0&&this.intersectPlane(e[3])<=0&&this.intersectPlane(e[4])<=0&&this.intersectPlane(e[5])<=0}get radius(){const e=this._data[3],i=this._data[4],r=this._data[5];return Math.sqrt(e*e+i*i+r*r)}intersectSphere(e){fi[0]=this._data[0]-e[0],fi[1]=this._data[1]-e[1],fi[2]=this._data[2]-e[2];const i=this.getQuaternion(Yy);return Tb(is,i),Hc(fi,fi,is),oA(fi,fi),Fg[0]=Math.min(fi[0],this._data[3]),Fg[1]=Math.min(fi[1],this._data[4]),Fg[2]=Math.min(fi[2],this._data[5]),lA(Fg,fi)<e[3]*e[3]}intersectSphereWithMBS(e,i=this.radius){const r=this._data;fi[0]=r[0]-e[0],fi[1]=r[1]-e[1],fi[2]=r[2]-e[2];const s=e[3],n=s+i;return!(rB(fi)>n*n)&&(is[0]=-r[6],is[1]=-r[7],is[2]=-r[8],is[3]=r[9],Hc(fi,fi,is),oA(fi,fi),Fg[0]=Math.min(fi[0],r[3]),Fg[1]=Math.min(fi[1],r[4]),Fg[2]=Math.min(fi[2],r[5]),lA(Fg,fi)<s*s)}intersectPlane(e){const i=e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3],r=this.projectedRadius(e);return i>r?1:i<-r?-1:0}intersectRay(e,i,r=0){const s=this._data,n=is;n[0]=-s[6],n[1]=-s[7],n[2]=-s[8],n[3]=s[9],fi[0]=e[0]-s[0],fi[1]=e[1]-s[1],fi[2]=e[2]-s[2];const o=Hc(fi,fi,is),a=Hc(Fg,i,is);let l=-1/0,c=1/0;const h=this.getHalfSize(e$);for(let d=0;d<3;d++){const f=o[d],m=a[d],g=h[d]+r;if(Math.abs(m)>1e-6){const v=(g-f)/m,_=(-g-f)/m;l=Math.max(l,Math.min(v,_)),c=Math.min(c,Math.max(v,_))}else if(f>g||f<-g)return!1}return l<=c}projectedArea(e,i,r,s){const n=this.getQuaternion(Yy);Tb(is,n),fi[0]=e[0]-this._data[0],fi[1]=e[1]-this._data[1],fi[2]=e[2]-this._data[2],Hc(fi,fi,is);const o=this.getHalfSize(e$),a=fi[0]<-o[0]?-1:fi[0]>o[0]?1:0,l=fi[1]<-o[1]?-1:fi[1]>o[1]?1:0,c=fi[2]<-o[2]?-1:fi[2]>o[2]?1:0,h=Math.abs(a)+Math.abs(l)+Math.abs(c);if(h===0)return 1/0;const d=h===1?4:6,f=6*(a+3*l+9*c+13);O3(i2,n),DG(i2,i2,o);const m=this.getCenter(Jp);for(let _=0;_<d;_++){const b=_dt[f+_];se(fi,((1&b)<<1)-1,(2&b)-1,((4&b)>>1)-1),uc(fi,fi,i2),oe(Pw,m,fi),Pw[3]=1,eu(Pw,Pw,i);const w=1/Math.max(1e-6,Pw[3]);Qd[2*_]=Pw[0]*w,Qd[2*_+1]=Pw[1]*w}const g=2*d-2;let v=Qd[0]*(Qd[3]-Qd[g+1])+Qd[g]*(Qd[1]-Qd[g-1]);for(let _=2;_<g;_+=2)v+=Qd[_]*(Qd[_+3]-Qd[_-1]);return Math.abs(v)*r*s*.125}projectedRadius(e){const i=this.getQuaternion(Yy);return Tb(is,i),Hc(fi,e,is),Math.abs(fi[0]*this._data[3])+Math.abs(fi[1]*this._data[4])+Math.abs(fi[2]*this._data[5])}minimumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]-this.projectedRadius(e)}maximumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]+this.projectedRadius(e)}toAaBoundingBox(e){const i=this.getQuaternion(Yy),r=O3(i2,i),s=this._data[3]*Math.abs(r[0])+this._data[4]*Math.abs(r[3])+this._data[5]*Math.abs(r[6]),n=this._data[3]*Math.abs(r[1])+this._data[4]*Math.abs(r[4])+this._data[5]*Math.abs(r[7]),o=this._data[3]*Math.abs(r[2])+this._data[4]*Math.abs(r[5])+this._data[5]*Math.abs(r[8]);e[0]=this._data[0]-s,e[1]=this._data[1]-n,e[2]=this._data[2]-o,e[3]=this._data[0]+s,e[4]=this._data[1]+n,e[5]=this._data[2]+o}transform(e,i,r,s=0,n=jb(r),o=jb(i),a=kb(i,o)){if(r===n)i.isGeographic?Sdt(this,e,i,s,o):xdt(this,e,i,s,o,a);else if(i.isWGS84&&(r.isWebMercator||m3(r)))bdt(i,this,r,e,s);else if(i.isWebMercator&&m3(r))wdt(i,this,r,e,s);else{const l=this.getCenter(Jp);l[2]+=s,Gn(l,i,0,l,r,0),e.center=l,this!==e&&(e.quaternion=this.getQuaternion(Yy),e.halfSize=this.getHalfSize(e$))}}};const is=zd(),Yy=zd(),ydt=zd(),fi=$(),Fg=$(),Pw=yi();function vdt(t,e=new e3e){return sdt(t,e),e}const Qd=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],_dt=(()=>{const t=new Int8Array(162);let e=0;const i=r=>{for(let s=0;s<r.length;s++)t[e+s]=r[s];e+=6};return i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4]),t})();function t3e(t,e,i,r,s){const n=t.getQuaternion(Yy);s.quaternion=n,Tb(is,n);const o=t.getCenter(Jp),a=t.getHalfSize(e$);if(r===je.Global){Hc(Nr,o,is),oA(Fp,Nr),yOe(gu,Fp,a),Fi(gu,Fp,gu);const l=Ee(gu);oe(gu,Fp,a);const c=Ee(gu);if(l<i)s.center=o,se(Nr,i,i,i),s.halfSize=oe(Nr,a,Nr);else{const h=c>0?1+e/c:1,d=l>0?1+i/l:1,f=(d+h)/2,m=(d-h)/2;re(gu,Fp,m),s.halfSize=Qn(gu,gu,a,f),re(gu,Fp,f),Qn(gu,gu,a,m),gOe(Nr,Nr),cse(Nr,gu,Nr);const g=t.getQuaternion(ydt);s.center=Hc(Nr,Nr,g)}}else{s.center=Qn(Nr,o,q$,(i+e)/2);const l=Hc(Nr,q$,is);oA(l,l),s.halfSize=Qn(Fp,a,l,(i-e)/2)}return s}function bdt(t,e,i,r,s){e.getCenter(Jp),Jp[2]+=s;const n=jb(i);Gn(Jp,t,0,Jp,n,0),i3e(n,e,Jp,i,r)}function wdt(t,e,i,r,s){e.getCenter(Jp),Jp[2]+=s,i3e(t,e,Jp,i,r)}function i3e(t,e,i,r,s){const n=e.getQuaternion(Yy),o=O3(i2,n),a=e.getHalfSize(e$);for(let l=0;l<8;++l){for(let c=0;c<3;++c)Am[c]=a[c]*(l&1<<c?-1:1);for(let c=0;c<3;++c){let h=i[c];for(let d=0;d<3;++d)h+=Am[d]*o[3*d+c];$5[3*l+c]=h}}Gn($5,t,0,$5,r,0,8),vdt(Tdt,s)}function xdt(t,e,i,r,s=jb(i),n=kb(i,s)){t.getCorners(wfe),t.getCenter(Am),Am[2]+=r,cT(i,Am,mu,s),e.setCenter(mu[12],mu[13],mu[14]);const o=2*Math.sqrt(1+mu[0]+mu[5]+mu[10]);is[0]=(mu[6]-mu[9])/o,is[1]=(mu[8]-mu[2])/o,is[2]=(mu[1]-mu[4])/o,is[3]=.25*o;const a=t.getQuaternion(Yy);e.quaternion=s6(is,is,a),Tb(is,is),se(Fp,0,0,0);const l=e.getCenter(Edt);for(const c of wfe)c[2]+=r,n(c,0,c,0),Fi(Nr,c,l),Hc(Nr,Nr,is),oA(Nr,Nr),vOe(Fp,Fp,Nr);e.halfSize=Fp}function Sdt(t,e,i,r,s=jb(i)){const n=yr(i),o=1+Math.max(0,r)/(n.radius+t.centerZ);t.getCenter(Am),Am[2]+=r,Gn(Am,i,0,Am,s,0),e.center=Am;const a=t.getQuaternion(Yy);e.quaternion=a,Tb(is,a),se(Nr,0,0,1),Hc(Nr,Nr,is);const l=t.getHalfSize(e$);se(Nr,l[0]*Math.abs(Nr[0]),l[1]*Math.abs(Nr[1]),l[2]*Math.abs(Nr[2])),re(Nr,Nr,n.inverseFlattening),oe(Nr,l,Nr),e.halfSize=re(Nr,Nr,o)}const $5=new Array(24),Tdt=new e6($5,3),Am=$(),Jp=$(),Edt=$(),e$=$(),i2=Ts(),mu=qe(),wfe=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Nr=$(),Fp=$(),gu=$(),Cdt=yf(-1,-1,-1);let $dt=class{constructor(){this._transform=qe(),this._transformInverse=new nF({value:this._transform},$l,qe),this._transformInverseTranspose=new nF(this._transformInverse,mc,qe),this._transformTranspose=new nF({value:this._transform},mc,qe),this._transformInverseRotation=new nF({value:this._transform},iOe,Ts)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){_n(this._transform,e)}multiplyTransform(e){Bn(this._transform,this._transform,e)}set(e){_n(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,i){this.setTransformMatrix(e),this.multiplyTransform(i),this._invalidateLazyTransforms()}},nF=class{constructor(e,i,r){this._original=e,this._update=i,this._dirty=!0,this._transform=r()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},Adt=class{constructor(e=0){this.offset=e,this.tmpVertex=$()}applyToVertex(e,i,r){const s=se(one,e,i,r),n=oe(r3e,s,this.localOrigin),o=this.offset/Ee(n);return Qn(this.tmpVertex,s,n,o),this.tmpVertex}applyToAabb(e){const i=Rdt,r=Pdt,s=Ddt;for(let l=0;l<3;++l)i[l]=e[0+l]+this.localOrigin[l],r[l]=e[3+l]+this.localOrigin[l],s[l]=i[l];const n=this.applyToVertex(i[0],i[1],i[2]);for(let l=0;l<3;++l)e[l]=n[l],e[l+3]=n[l];const o=l=>{const c=this.applyToVertex(l[0],l[1],l[2]);for(let h=0;h<3;++h)e[h]=Math.min(e[h],c[h]),e[h+3]=Math.max(e[h+3],c[h])};for(let l=1;l<8;++l){for(let c=0;c<3;++c)s[c]=l&1<<c?r[c]:i[c];o(s)}let a=0;for(let l=0;l<3;++l)i[l]*r[l]<0&&(a|=1<<l);if(a!==0&&a!==7){for(let l=0;l<8;++l)if(!(a&l)){for(let c=0;c<3;++c)s[c]=a&1<<c?0:l&1<<c?i[c]:r[c];o(s)}}for(let l=0;l<3;++l)e[l]-=this.localOrigin[l],e[l+3]-=this.localOrigin[l];return e}},Mdt=class{constructor(e=0){this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=$(),this._tmpMbs=Ls(),this._tmpObb=new e3e,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Ee(e)}applyToVertex(e,i,r){const s=se(one,e,i,r),n=se(r3e,e,i,r+this.componentLocalOriginLength),o=this._totalOffset/Ee(n);return Qn(this._tmpVertex,s,n,o),this._tmpVertex}applyToAabb(e){const i=this.componentLocalOriginLength,r=e[0],s=e[1],n=e[2]+i,o=e[3],a=e[4],l=e[5]+i,c=Math.abs(r),h=Math.abs(s),d=Math.abs(n),f=Math.abs(o),m=Math.abs(a),g=Math.abs(l),v=.5*(1+Math.sign(r*o))*Math.min(c,f),_=.5*(1+Math.sign(s*a))*Math.min(h,m),b=.5*(1+Math.sign(n*l))*Math.min(d,g),w=Math.max(c,f),x=Math.max(h,m),S=Math.max(d,g),C=Math.sqrt(v*v+_*_+b*b),T=Math.sign(c+r),M=Math.sign(h+s),I=Math.sign(d+n),D=Math.sign(f+o),P=Math.sign(m+a),F=Math.sign(g+l),L=this._totalOffset;if(C<L)return e[0]-=(1-T)*L,e[1]-=(1-M)*L,e[2]-=(1-I)*L,e[3]+=D*L,e[4]+=P*L,e[5]+=F*L,e;const N=L/Math.sqrt(w*w+x*x+S*S),R=L/C,k=R-N,W=-k;return e[0]+=r*(T*W+R),e[1]+=s*(M*W+R),e[2]+=n*(I*W+R),e[3]+=o*(D*k+N),e[4]+=a*(P*k+N),e[5]+=l*(F*k+N),e}applyToMbs(e){const i=Ee(e),r=this._totalOffset/i;return Qn(this._tmpMbs,e,e,r),this._tmpMbs[3]=e[3]+e[3]*this._totalOffset/i,this._tmpMbs}applyToObb(e){return t3e(e,this._totalOffset,this._totalOffset,je.Global,this._tmpObb),this._tmpObb}},Odt=class{constructor(e=0){this.offset=e,this.sphere=Ls(),this.tmpVertex=$()}applyToVertex(e,i,r){const s=this.objectTransform.transform,n=se(one,e,i,r),o=ot(n,n,s),a=this.offset/Ee(o);Qn(o,o,o,a);const l=this.objectTransform.inverse;return ot(this.tmpVertex,o,l),this.tmpVertex}applyToMinMax(e,i){const r=this.offset/Ee(e);Qn(e,e,e,r);const s=this.offset/Ee(i);Qn(i,i,i,s)}applyToAabb(e){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e}applyToBoundingSphere(e){const i=Ee(e),r=this.offset/i;return Qn(this.sphere,e,e,r),this.sphere[3]=e[3]+e[3]*this.offset/i,this.sphere}};const xfe=new Odt;function oX(t){return t!=null?(xfe.offset=t,xfe):null}const Sfe=new Mdt;function Tfe(t){return t!=null?(Sfe.offset=t,Sfe):null}const Efe=new Adt;function Idt(t){return t!=null?(Efe.offset=t,Efe):null}const qb="terrain",one=$(),r3e=$(),Rdt=$(),Pdt=$(),Ddt=$(),yA=1e-5;let Ldt=class{constructor(e){this.options=new Oht,this._results=new Ndt,this.transform=new $dt,this.tolerance=yA,this.verticalOffset=null,this._ray=Nn(),this._rayEnd=$(),this._rayBeginTransformed=$(),this._rayEndTransformed=$(),this.viewingMode=e??je.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,i,r){this.resetWithRay($Re(e,i,this._ray),r)}resetWithRay(e,i){this.camera=i,e!==this._ray&&_B(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===je.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,oe(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,i,r,s,n){var a;this.point=i,this.filterPredicate=s,this.tolerance=r??yA;const o=oX(this.verticalOffset);if(e&&e.length>0){const l=n?c=>{n(c)&&this.intersectObject(c)}:c=>{this.intersectObject(c)};for(const c of e){const h=(a=c.getSpatialQueryAccelerator)==null?void 0:a.call(c);h!=null?(o!=null?h.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,l,o):h.forEachAlongRay(this._ray.origin,this._ray.direction,l),this.options.selectionMode&&this.options.hud&&h.forEachDegenerateObject(l)):c.objects.forAll(d=>l(d))}}this.sortResults()}intersectObject(e){const i=e.geometries;if(!i)return;const r=e.effectiveTransformation,s=oX(this.verticalOffset);for(const n of i){if(!n.visible)continue;const{material:o,id:a}=n;if(!o.visible)continue;this.transform.setAndInvalidateLazyTransforms(r,n.transformation),ot(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),ot(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;s!=null&&(s.objectTransform=this.transform),o.intersect(n,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,h,d,f,m,g)=>{if(c>=0){if(this.filterPredicate!=null&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const v=f?this._results.hud:this._results,_=f?b=>{const w=new Rht(e,a,d,g);b.set(Xr.HUD,w,c,h,eo,m)}:b=>b.set(Xr.OBJECT,{object:e,geometryId:a,triangleNr:d},c,h,l,m);if((v.min.drapedLayerOrder==null||m>=v.min.drapedLayerOrder)&&(v.min.dist==null||c<v.min.dist)&&_(v.min),this.options.store!==Co.MIN&&(v.max.drapedLayerOrder==null||m<v.max.drapedLayerOrder)&&(v.max.dist==null||c>v.max.dist)&&_(v.max),this.options.store===Co.ALL)if(f){const b=new aX(this._ray);_(b),this._results.hud.all.push(b)}else{const b=new t$(this._ray);_(b),this._results.all.push(b)}}})}}sortResults(e=this._results.all){e.sort((i,r)=>i.dist!==r.dist?(i.dist??0)-(r.dist??0):i.drapedLayerOrder!==r.drapedLayerOrder?Cfe(i.drapedLayerOrder,r.drapedLayerOrder):Cfe(i.drapedLayerGraphicOrder,r.drapedLayerGraphicOrder))}};function Cfe(t,e){return(e??-Number.MAX_VALUE)-(t??-Number.MAX_VALUE)}function ph(t){return new Ldt(t)}let Ndt=class{constructor(){this.min=new t$(Nn()),this.max=new t$(Nn()),this.hud={min:new aX(Nn()),max:new aX(Nn()),all:new Array},this.ground=new t$(Nn()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},t$=class{get ray(){return this._ray}get distanceInRenderSpace(){return this.dist!=null?(re(oF,this.ray.direction,this.dist),Ee(oF)):null}withinDistance(e){return!!dh(this)&&this.distanceInRenderSpace<=e}getIntersectionPoint(e){return!!dh(this)&&(re(oF,this.ray.direction,this.dist),oe(e,this.ray.origin,oF),!0)}getTransformedNormal(e){return ne(sO,this.normal),sO[3]=0,eu(sO,sO,this.transformation),ne(e,sO),ae(e,e)}constructor(e){this.intersector=Xr.OBJECT,this.normal=$(),this.transformation=qe(),this._ray=Nn(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=Xr.OBJECT,_B(e,this._ray)}set(e,i,r,s,n,o,a){this.intersector=e,this.dist=r,ne(this.normal,s??q$),_n(this.transformation,n??eo),this.target=i,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){_B(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,ne(this.normal,e.normal),_n(this.transformation,e.transformation)}},aX=class extends t${constructor(){super(...arguments),this.intersector=Xr.HUD}};function ane(t){return new t$(t)}const oF=$(),sO=yi();let Fdt=class extends wL{constructor(e,i,r,s,n){super(e,i),this.layerUid=e,this.graphicUid=i,this.triangleNr=r,this.baseBoundingSphere=s,this.numLodLevels=n}};function lne(t){return dh(t)&&t.intersector===Xr.LOD&&!!t.target}let kdt=class{constructor(e,i,r,s){this.material=e,this.bufferWriter=e.createBufferWriter(),this.vertexBufferLayout=this.bufferWriter.vertexBufferLayout,this.buffer=i,this.elementCount=r,this.boundingInfo=s}get numTriangles(){return this.elementCount/3}get numVertices(){return this.elementCount}computeUsedMemory(){return this.buffer.byteLength+rne}getRenderGeometry(){return this}intersect(e,i,r,s,n,o,a,l){const c=this.bufferWriter,h=this.buffer;c.intersect(h,e,r,s,(d,f,m,g,v)=>s3e(d,f,m,v,e,i,o,a,n,l))}},zdt=class{constructor(e){this.engineGeometry=e}get material(){return this.engineGeometry.material}get numVertices(){return this.engineGeometry.attributes.get(z.POSITION).indices.length}get numTriangles(){return this.engineGeometry.indexCount/3}get boundingInfo(){return this.engineGeometry.boundingInfo}computeUsedMemory(){return Array.from(this.engineGeometry.attributes.values()).reduce((e,i)=>e+t6(i.data,i.indices),0)}getRenderGeometry(){const e=this.material,i=this.engineGeometry,r=i.attributes,s=i.boundingInfo,n=e.createBufferWriter(),o=n.vertexBufferLayout,a=n.elementCount(r),l=o.createBuffer(a);return n.write(null,null,r,null,l,0),new kdt(e,l.buffer,a,s)}intersect(e,i,r,s,n,o,a,l){const c=this.engineGeometry;this.material.intersect(c,e.transform.transform,e,r,s,(h,d,f,m,g)=>s3e(h,d,f,g,e,i,o,a,n,l))}};function s3e(t,e,i,r,s,n,o,a,l,c){if(t<0||n&&!n(s.rayBegin,s.rayEnd,t))return;const h=new Fdt(o.layerUid,o.graphicUid(l),i,a,c);if((s.results.min.drapedLayerOrder==null||r>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||t<s.results.min.dist)&&s.results.min.set(Xr.LOD,h,t,e,s.transform.transform,r),s.options.store!==Co.MIN&&(s.results.max.drapedLayerOrder==null||r>=s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||t>s.results.max.dist)&&s.results.max.set(Xr.LOD,h,t,e,s.transform.transform,r),s.options.store===Co.ALL){const d=ane(s.results.min.ray);d.set(Xr.LOD,h,t,e,s.transform.transform,r),s.results.all.push(d)}}let Udt=class{constructor(e,i=null){this.geometry=e,this.textures=i}get material(){return this.geometry.material}get numTriangles(){return this.geometry.numTriangles}},Bdt=class{constructor(e,i,r){this.components=e,this.minScreenSpaceRadius=i,this.pivotOffset=r;const s=p4(this.components.map(n=>n.geometry));this.numVertices=s.reduce((n,o)=>n+o.numVertices,0)}},Vdt=class{constructor(e){this.levels=e,this.levels.sort((i,r)=>i.minScreenSpaceRadius===r.minScreenSpaceRadius?i.numVertices-r.numVertices:i.minScreenSpaceRadius-r.minScreenSpaceRadius)}getMaterials(){const e=[];return this.levels.forEach(i=>i.components.forEach(r=>e.push(r.geometry.material))),p4(e)}getTextures(){const e=new Array;return this.levels.forEach(i=>i.components.forEach(r=>{r.textures!=null&&e.push(...r.textures)})),p4(e)}getGeometries(){const e=new Array;return this.levels.forEach(i=>i.components.forEach(r=>{e.push(r.geometry)})),p4(e)}getEngineGeometries(){return this.getGeometries().map(e=>e.engineGeometry).filter(e=>e!=null)}computeUsedMemory(){const e=this.getGeometries(),i=this.getTextures(),r=e.reduce((s,n)=>s+n.computeUsedMemory(),0);return i.reduce((s,n)=>s+n.memoryEstimate,0)+r}};function dKt(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function jdt(t,e){const i=(r,s,n=!1)=>new Vdt(r.map(o=>{const a=s(o.tesselation);return n&&$ht(a),new Bdt([new Udt(new zdt(a))],o.minScreenSpaceRadius)}));switch(t){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>xht(e,.5,r,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>pht(e,1));case"cone":return i(oq,r=>cfe(e,1,.5,r,!1),!0);case"inverted-cone":return i(oq,r=>cfe(e,1,.5,r,!0),!0);case"cylinder":return i(oq,r=>Eht(e,1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>wht(e,1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>yht(e,1),!0);default:return}}const oq=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];let kp=class{constructor(e){this.estimated=!1,this.verticesPerFeature=e.verticesPerFeature??0,this.verticesPerCoordinate=e.verticesPerCoordinate??0,this.drawCallsPerFeature=e.drawCallsPerFeature??0,this.memory=e.memory??new n3e}},cne=class extends kp{constructor(e){super(e),this.estimated=!0}},Gdt=class extends kp{constructor(e,i){super(i),this.numComplexities=e}},Hdt=class extends cne{constructor(e,i){super(i),this.numComplexities=e}},n3e=class{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}};function qdt(t){return t.type==="fill"}function Wdt(t){return t.type==="extrude"}function une(t,e,i=0){const r=ue(t,0,Jdt);for(let s=0;s<4;s++)e[i+s]=Math.floor(256*Xdt(r*Zdt[s]))}function hne(t,e=0){let i=0;for(let r=0;r<4;r++)i+=t[e+r]*Ydt[r];return i}const Zdt=[1,256,65536,16777216],Ydt=[1/256,1/65536,1/16777216,1/4294967296],Jdt=hne(new Uint8ClampedArray([255,255,255,255]));function Xdt(t){return t-Math.floor(t)}var kn;function vKt(t){switch(t){case"multiply":default:return kn.Multiply;case"ignore":return kn.Ignore;case"replace":return kn.Replace;case"tint":return kn.Tint}}function Kdt(t,e,i){if(t==null||e===kn.Ignore)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const r=ue(Math.round(t[3]*CB),0,CB),s=r===0||e===kn.Tint?0:e===kn.Replace?Qdt:ept;i[0]=ue(Math.round(t[0]*ZT),0,ZT),i[1]=ue(Math.round(t[1]*ZT),0,ZT),i[2]=ue(Math.round(t[2]*ZT),0,ZT),i[3]=r+s}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(kn||(kn={}));const ZT=255,CB=85,Qdt=CB,ept=2*CB;function E(t,...e){let i="";for(let r=0;r<e.length;r++)i+=t[r]+e[r];return i+=t[t.length-1],i}function Te(t,e,i=""){return t?e:i}(function(t){function e(r){return Math.round(r).toString()}function i(r){return r.toPrecision(8)}t.int=e,t.float=i})(E);function o3e(t){t.vertex.code.add(E`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${E.int(kn.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${E.int(kn.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${E.int(kn.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${E.int(kn.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}var Y;function aq(t){return t===Y.Shadow||t===Y.ShadowHighlight||t===Y.ShadowExcludeHighlight||t===Y.ViewshedShadow}function tpt(t){return npt(t)||t===Y.Normal}function $fe(t){return lX(t)||t===Y.Normal}function n6(t){return t===Y.Highlight||t===Y.ObjectAndLayerIdColor}function ipt(t){return xL(t)||n6(t)}function xL(t){return t===Y.Color}function ws(t){return xL(t)||dne(t)}function _Kt(t){return xL(t)||t===Y.ObjectAndLayerIdColor}function bKt(t){return ws(t)||t===Y.ObjectAndLayerIdColor}function rpt(t){return xL(t)||t===Y.Highlight}function wKt(t){return rpt(t)||o6(t)}function spt(t){return xL(t)||n6(t)}function A5(t){return ws(t)||n6(t)}function npt(t){return spt(t)||o6(t)}function lX(t){return A5(t)||o6(t)}function o6(t){return t===Y.Depth}function dne(t){return t===Y.ColorEmission}(function(t){t[t.Color=0]="Color",t[t.ColorEmission=1]="ColorEmission",t[t.Depth=2]="Depth",t[t.Normal=3]="Normal",t[t.Shadow=4]="Shadow",t[t.ShadowHighlight=5]="ShadowHighlight",t[t.ShadowExcludeHighlight=6]="ShadowExcludeHighlight",t[t.ViewshedShadow=7]="ViewshedShadow",t[t.Highlight=8]="Highlight",t[t.ObjectAndLayerIdColor=9]="ObjectAndLayerIdColor",t[t.COUNT=10]="COUNT"})(Y||(Y={}));function uw(t){t.code.add(E`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}`),t.code.add(E`const vec4 RGBA_TO_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgbaTofloat(vec4 rgba) {
return dot(rgba, RGBA_TO_FLOAT_FACTORS);
}`),t.code.add(E`const vec4 uninterpolatedRGBAToFloatFactors = vec4(
1.0 / 256.0,
1.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0 / 256.0
);
float uninterpolatedRGBAToFloat(vec4 rgba) {
return (dot(round(rgba * 255.0), uninterpolatedRGBAToFloatFactors) - 0.5) * 2.0;
}`)}var Lt;(function(t){t[t.Bind=0]="Bind",t[t.Pass=1]="Pass",t[t.Draw=2]="Draw"})(Lt||(Lt={}));let lr=class{constructor(e,i,r,s,n=null){if(this.name=e,this.type=i,this.arraySize=n,this.bind={[Lt.Bind]:null,[Lt.Pass]:null,[Lt.Draw]:null},s)switch(r){case void 0:break;case Lt.Bind:this.bind[Lt.Bind]=s;break;case Lt.Pass:this.bind[Lt.Pass]=s;break;case Lt.Draw:this.bind[Lt.Draw]=s}}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},B3=class extends lr{constructor(e,i){super(e,"vec4",Lt.Draw,(r,s,n)=>r.setUniform4fv(e,i(s,n)))}},opt=class extends lr{constructor(e,i){super(e,"int",Lt.Draw,(r,s,n)=>r.setUniform1i(e,i(s,n)))}},ag=class extends lr{constructor(e,i){super(e,"sampler2D",Lt.Draw,(r,s,n)=>r.bindTexture(e,i(s,n)))}};function Dd(){return!!X("enable-feature:objectAndLayerId-rendering")}var Wm;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})(Wm||(Wm={}));const pne=429496.7296;function apt(t,e){une(t/pne*.5+.5,e)}function lpt(t,e){switch(e.componentData){case Wm.Varying:return cpt(t,e);case Wm.Uniform:return upt(t,e);case Wm.COUNT:return;default:e.componentData}}function cpt(t,e){const{vertex:i,fragment:r}=t;i.include(uw),i.uniforms.add(new ag("componentColorTex",n=>n.componentParameters.texture.texture)),t.attributes.add(z.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const s=e.output===Y.ObjectAndLayerIdColor;s&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(o3e),i.constants.add("stride","float",Dd()?3:2),i.code.add(E`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),i.code.add(E`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);
    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

  float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);
    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return uninterpolatedRGBAToFloat(encodedElevation) * ${E.float(pne)};
  }

  ${s?E`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);
            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:E`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),r.code.add(E`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${s?E`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function upt(t,e){const{vertex:i,fragment:r}=t;t.varyings.add("vExternalColor","vec4"),i.uniforms.add(new B3("externalColor",n=>n.componentParameters.externalColor)).code.add(E`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);const s=e.output===Y.ObjectAndLayerIdColor;r.uniforms.add(new opt("externalColorMixMode",n=>n.componentParameters.externalColorMixMode)).code.add(E`
    void readExternalColor(out vec4 color, out int colorMixMode) {
      color = vExternalColor;
      colorMixMode = externalColorMixMode;
    }

    void outputObjectAndLayerIdColor() {
      ${Te(s,"fragColor = vec4(0, 0, 0, 0);")}
    }
  `)}function mM(t,e){switch(e.normalType){case kr.Compressed:t.attributes.add(z.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(E`vec3 decompressNormal(vec2 normal) {
float z = 1.0 - abs(normal.x) - abs(normal.y);
return vec3(normal + sign(normal) * min(z, 0.0), z);
}
vec3 normalModel() {
return decompressNormal(normalCompressed);
}`);break;case kr.Attribute:t.attributes.add(z.NORMAL,"vec3"),t.vertex.code.add(E`vec3 normalModel() {
return normal;
}`);break;case kr.ScreenDerivative:t.fragment.code.add(E`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case kr.COUNT:}}var kr;(function(t){t[t.Attribute=0]="Attribute",t[t.Compressed=1]="Compressed",t[t.ScreenDerivative=2]="ScreenDerivative",t[t.COUNT=3]="COUNT"})(kr||(kr={}));function fne({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(E`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(E`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let su=class extends lr{constructor(e,i){super(e,"vec3",Lt.Draw,(r,s,n,o)=>r.setUniform3fv(e,i(s,n,o)))}},$r=class extends lr{constructor(e,i){super(e,"vec3",Lt.Pass,(r,s,n)=>r.setUniform3fv(e,i(s,n)))}},$B=class extends lr{constructor(e,i){super(e,"mat3",Lt.Draw,(r,s,n)=>r.setUniformMatrix3fv(e,i(s,n)))}},Ud=class extends lr{constructor(e,i){super(e,"mat3",Lt.Pass,(r,s,n)=>r.setUniformMatrix3fv(e,i(s,n)))}},$o=class extends lr{constructor(e,i){super(e,"mat4",Lt.Bind,(r,s)=>r.setUniformMatrix4fv(e,i(s)))}};function IKt(t,e){const i=t.vertex;i.include(uw),t.include(mM,e);const{silhouette:r,legacy:s,spherical:n}=e;i.uniforms.add(new ag("componentDataTex",f=>f.componentDataTexture)),t.attributes.add(z.COMPONENTINDEX,"float"),i.constants.add("lineWidthFractionFactor","float",8),i.constants.add("extensionLengthOffset","float",128),i.code.add(E`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = ${E.float(3)}  * componentIndex + fieldOffset;
      float texSize = float(textureSize(componentDataTex, 0).x);
      float colIndex = mod(fieldIndex, texSize);
      float rowIndex = floor(fieldIndex / texSize);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      vec3 normal;
      vec3 normal2;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, ${E.float(0)});
      vec2 otherIndex = _componentTextureCoords(componentIndex, ${E.float(1)});
      vec2 verticalOffsetIndex = _componentTextureCoords(float(componentIndex), ${E.float(2)} );
      vec3 normal = normalModel();
      vec3 normal2 = ${r?E`decompressNormal(normal2Compressed)`:E`normal`};

      vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
      vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
      float verticalOffset = uninterpolatedRGBAToFloat(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) * ${E.float(pne)};

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        normal, normal2,
        otherValue.x * (255.0 / ${E.float(8)} ),
        otherValue.y * 255.0 - ${E.float(128)},
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `),s?i.code.add(E`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(i.uniforms.add(new $B("transformNormalGlobalFromModel",f=>f.transformNormalGlobalFromModel)),i.code.add(E`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),r?(t.attributes.add(z.NORMAL2COMPRESSED,"vec2"),i.code.add(E`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(normalize(data.normal + data.normal2));
}`)):i.code.add(E`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(data.normal);
}`),s?i.code.add(E`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(i.include(fne,e),i.uniforms.add(new Ud("transformViewFromCameraRelativeRS",f=>f.transformViewFromCameraRelativeRS),new $B("transformWorldFromModelRS",f=>f.transformWorldFromModelRS),new su("transformWorldFromModelTL",f=>f.transformWorldFromModelTL),new su("transformWorldFromModelTH",f=>f.transformWorldFromModelTH),new $r("transformWorldFromViewTL",f=>f.transformWorldFromViewTL),new $r("transformWorldFromViewTH",f=>f.transformWorldFromViewTH)),i.code.add(E`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${n?"normalize(transformWorldFromModelTL + rotatedModelPosition);":"vec3(0.0, 0.0, 1.0);"}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),i.uniforms.add(new $o("transformProjFromView",f=>f.camera.projectionMatrix)).code.add(E`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),i.code.add(E`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function RKt(t){return t===vA.Sketch||t===vA.Mixed}var vA,Afe;(function(t){t[t.Solid=0]="Solid",t[t.Sketch=1]="Sketch",t[t.Mixed=2]="Mixed",t[t.COUNT=3]="COUNT"})(vA||(vA={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(Afe||(Afe={}));function hpt(t){return t&&t.enabled&&(Wdt(t)||qdt(t))&&t.edges!=null}function dpt(t){return t&&t.enabled&&t.edges||null}function ppt(t,e){return fpt(dpt(t),e)}function fpt(t,e){if(t==null)return null;const i=t.color!=null?Ase(Je.toUnitRGBA(t.color)):Yi(0,0,0,0),r=xS(t.size),s=xS(t.extensionLength);switch(t.type){case"solid":return mpt({color:i,size:r,extensionLength:s,...e});case"sketch":return gpt({color:i,size:r,extensionLength:s,...e});default:return}}function mpt(t){return{...ypt,...t,type:vA.Solid}}function gpt(t){return{...vpt,...t,type:vA.Sketch}}const ypt={color:Yi(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:od.OPAQUE,hasSlicePlane:!1},vpt={color:Yi(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:od.OPAQUE,hasSlicePlane:!1};let mne=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<9;s++)i[s]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[r++]=i[s]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};mne.ElementCount=9;let gne=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<16;s++)i[s]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[r++]=i[s]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){this.copyFromTypedBuffer(e,i.typedBuffer,r*i.typedBufferStride)}copyFromTypedBuffer(e,i,r){const s=this.typedBuffer;let n=e*this.typedBufferStride;for(let o=0;o<16;++o)s[n++]=i[r++]}get buffer(){return this.typedBuffer.buffer}};gne.ElementCount=16;let Hv=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.stride=s,this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,i){this.typedBuffer[e*this.typedBufferStride]=i}get buffer(){return this.typedBuffer.buffer}};Hv.ElementCount=1;let qv=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,di(i,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e]=i[1]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e]=r}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};qv.ElementCount=2;let Wv=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,se(i,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e]=i[2]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,s){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e]=s}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};Wv.ElementCount=3;let Zv=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.start=r,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,ss(i,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e++]=i[2],this.typedBuffer[e]=i[3]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,s,n){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e++]=s,this.typedBuffer[e]=n}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};Zv.ElementCount=4;let a6=class a3e extends Hv{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}static fromTypedArray(e,i){return new a3e(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};a6.ElementType="f32";let l6=class cX extends qv{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(cX,e,i)}static fromTypedArray(e,i){return new cX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};l6.ElementType="f32";let IS=class uX extends Wv{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(uX,e,i)}static fromTypedArray(e,i){return new uX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};IS.ElementType="f32";let V3=class hX extends Zv{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(hX,e,i)}static fromTypedArray(e,i){return new hX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};V3.ElementType="f32";let yne=class dX extends mne{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(dX,e,i)}static fromTypedArray(e,i){return new dX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};yne.ElementType="f32";let vne=class pX extends mne{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(pX,e,i)}static fromTypedArray(e,i){return new pX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};vne.ElementType="f64";let _ne=class fX extends gne{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(fX,e,i)}static fromTypedArray(e,i){return new fX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};_ne.ElementType="f32";let bne=class mX extends gne{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(mX,e,i)}static fromTypedArray(e,i){return new mX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};bne.ElementType="f64";let wne=class gX extends Hv{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(gX,e,i)}static fromTypedArray(e,i){return new gX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};wne.ElementType="f64";let xne=class yX extends qv{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(yX,e,i)}static fromTypedArray(e,i){return new yX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};xne.ElementType="f64";let Sne=class vX extends Wv{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(vX,e,i)}static fromTypedArray(e,i){return new vX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Sne.ElementType="f64";let Tne=class _X extends Zv{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(_X,e,i)}static fromTypedArray(e,i){return new _X(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Tne.ElementType="f64";let Ene=class bX extends Hv{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(bX,e,i)}static fromTypedArray(e,i){return new bX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Ene.ElementType="u8";let Cne=class wX extends qv{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(wX,e,i)}static fromTypedArray(e,i){return new wX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Cne.ElementType="u8";let l3e=class xX extends Wv{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(xX,e,i)}static fromTypedArray(e,i){return new xX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};l3e.ElementType="u8";let lg=class SX extends Zv{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(SX,e,i)}static fromTypedArray(e,i){return new SX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};lg.ElementType="u8";let $ne=class TX extends Hv{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(TX,e,i)}static fromTypedArray(e,i){return new TX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};$ne.ElementType="u16";let c3e=class EX extends qv{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(EX,e,i)}static fromTypedArray(e,i){return new EX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};c3e.ElementType="u16";let u3e=class CX extends Wv{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(CX,e,i)}static fromTypedArray(e,i){return new CX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};u3e.ElementType="u16";let Ane=class $X extends Zv{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer($X,e,i)}static fromTypedArray(e,i){return new $X(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Ane.ElementType="u16";let Mne=class AX extends Hv{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(AX,e,i)}static fromTypedArray(e,i){return new AX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Mne.ElementType="u32";let h3e=class MX extends qv{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(MX,e,i)}static fromTypedArray(e,i){return new MX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};h3e.ElementType="u32";let d3e=class OX extends Wv{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(OX,e,i)}static fromTypedArray(e,i){return new OX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};d3e.ElementType="u32";let p3e=class IX extends Zv{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(IX,e,i)}static fromTypedArray(e,i){return new IX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};p3e.ElementType="u32";let One=class RX extends Hv{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(RX,e,i)}static fromTypedArray(e,i){return new RX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};One.ElementType="i8";let Ine=class PX extends qv{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(PX,e,i)}static fromTypedArray(e,i){return new PX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Ine.ElementType="i8";let f3e=class DX extends Wv{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(DX,e,i)}static fromTypedArray(e,i){return new DX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};f3e.ElementType="i8";let m3e=class LX extends Zv{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(LX,e,i)}static fromTypedArray(e,i){return new LX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};m3e.ElementType="i8";let g3e=class NX extends Hv{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(NX,e,i)}static fromTypedArray(e,i){return new NX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};g3e.ElementType="i16";let c6=class FX extends qv{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(FX,e,i)}static fromTypedArray(e,i){return new FX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};c6.ElementType="i16";let y3e=class kX extends Wv{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(kX,e,i)}static fromTypedArray(e,i){return new kX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};y3e.ElementType="i16";let v3e=class zX extends Zv{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(zX,e,i)}static fromTypedArray(e,i){return new zX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};v3e.ElementType="i16";let _3e=class UX extends Hv{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(UX,e,i)}static fromTypedArray(e,i){return new UX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};_3e.ElementType="i32";let b3e=class BX extends qv{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(BX,e,i)}static fromTypedArray(e,i){return new BX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};b3e.ElementType="i32";let w3e=class VX extends Wv{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(VX,e,i)}static fromTypedArray(e,i){return new VX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};w3e.ElementType="i32";let x3e=class jX extends Zv{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(jX,e,i)}static fromTypedArray(e,i){return new jX(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};x3e.ElementType="i32";function Mfe(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}let Ofe=class S3e{constructor(e,i){this.layout=e,this.buffer=typeof i=="number"?new ArrayBuffer(i*e.stride):i;for(const r of e.fields.keys()){const s=e.fields.get(r);this[r]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,i){const r=this[e];return r&&r.elementCount===i.ElementCount&&r.elementType===i.ElementType?r:null}slice(e,i){return new S3e(this.layout,this.buffer.slice(e*this.stride,i*this.stride))}copyFrom(e,i=0,r=0,s=e.count){const n=this.stride;if(n%4==0){const o=new Uint32Array(e.buffer,i*n,s*n/4);new Uint32Array(this.buffer,r*n,s*n/4).set(o)}else{const o=new Uint8Array(e.buffer,i*n,s*n);new Uint8Array(this.buffer,r*n,s*n).set(o)}return this}get cachedMemory(){return this.byteLength}dispose(){}},_pt=class T3e{constructor(e){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach(i=>this._fields.set(i[0],{...i[1],constructor:wpt(i[1].constructor)})))}freeze(){return this}vec2f(e,i){return this._appendField(e,l6,i),this}vec2f64(e,i){return this._appendField(e,xne,i),this}vec3f(e,i){return this._appendField(e,IS,i),this}vec3f64(e,i){return this._appendField(e,Sne,i),this}vec4f(e,i){return this._appendField(e,V3,i),this}vec4f64(e,i){return this._appendField(e,Tne,i),this}mat3f(e,i){return this._appendField(e,yne,i),this}mat3f64(e,i){return this._appendField(e,vne,i),this}mat4f(e,i){return this._appendField(e,_ne,i),this}mat4f64(e,i){return this._appendField(e,bne,i),this}vec4u8(e,i){return this._appendField(e,lg,i),this}f32(e,i){return this._appendField(e,a6,i),this}f64(e,i){return this._appendField(e,wne,i),this}u8(e,i){return this._appendField(e,Ene,i),this}u16(e,i){return this._appendField(e,$ne,i),this}i8(e,i){return this._appendField(e,One,i),this}vec2i8(e,i){return this._appendField(e,Ine,i),this}vec2i16(e,i){return this._appendField(e,c6,i),this}vec2u8(e,i){return this._appendField(e,Cne,i),this}vec4u16(e,i){return this._appendField(e,Ane,i),this}u32(e,i){return this._appendField(e,Mne,i),this}_appendField(e,i,r){if(this._fields.has(e))return void Zt(!1,`${e} already added to vertex buffer layout`);const s=i.ElementCount*Mfe(i.ElementType),n=this._stride;this._stride+=s,this._fields.set(e,{size:s,constructor:i,offset:n,optional:r})}createBuffer(e){return new Ofe(this,e)}createView(e){return new Ofe(this,e)}clone(){const e=new T3e;return e._stride=this._stride,e._fields=new Map,this._fields.forEach((i,r)=>e._fields.set(r,i)),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach(i=>e=Math.max(e,Mfe(i.constructor.ElementType))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}};function Bd(){return new _pt}let zKt=class{constructor(e){this.fields=new Array,e.fields.forEach((i,r)=>{const s={...i,constructor:E3e(i.constructor)};this.fields.push([r,s])}),this.stride=e.stride}};const bpt=[a6,l6,IS,V3,yne,_ne,wne,xne,Sne,Tne,vne,bne,Ene,Cne,l3e,lg,$ne,c3e,u3e,Ane,Mne,h3e,d3e,p3e,One,Ine,f3e,m3e,g3e,c6,y3e,v3e,_3e,b3e,w3e,x3e];function E3e(t){return`${t.ElementType}_${t.ElementCount}`}function wpt(t){return C3e.get(t)}const C3e=new Map;bpt.forEach(t=>C3e.set(E3e(t),t));var Ys;function Ky(t,e){switch(e.textureCoordinateType){case Ys.Default:return t.attributes.add(z.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(E`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case Ys.Compressed:return t.attributes.add(z.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(E`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case Ys.Atlas:return t.attributes.add(z.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(z.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(E`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case Ys.None:return void t.vertex.code.add(E`void forwardTextureCoordinates() {}`);case Ys.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(Ys||(Ys={}));function xpt(t){t.fragment.code.add(E`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function u6(t,e){const{textureCoordinateType:i}=e;if(i===Ys.None||i===Ys.COUNT)return;t.include(Ky,e);const r=i===Ys.Atlas;r&&t.include(xpt),t.fragment.code.add(E`
    vec4 textureLookup(sampler2D tex, vec2 uv) {
      return ${r?"textureAtlasLookup(tex, uv, vuvRegion)":"texture(tex, uv)"};
    }
  `)}let It=class extends lr{constructor(e,i){super(e,"sampler2D",Lt.Pass,(r,s,n)=>r.bindTexture(e,i(s,n)))}},Rne=class{constructor(e){this._material=e.material,this._techniques=e.techniques,this._output=e.output}dispose(){}get _stippleTextures(){return this._techniques.context.stippleTextures}get _markerTextures(){return this._techniques.context.markerTextures}getTechnique(e,i){return this._techniques.get(e,this._material.getConfiguration(this._output,i))}ensureResources(e){return Hb.LOADED}},Spt=class{};const cr=Spt,Tpt=new cr;let $3e=class extends Rne{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textures=e.textures,this.updateTexture(e.textureId),this._acquire(e.normalTextureId,i=>this._textureNormal=i),this._acquire(e.emissiveTextureId,i=>this._textureEmissive=i),this._acquire(e.occlusionTextureId,i=>this._textureOcclusion=i),this._acquire(e.metallicRoughnessTextureId,i=>this._textureMetallicRoughness=i)}dispose(){super.dispose(),this._texture=Lr(this._texture),this._textureNormal=Lr(this._textureNormal),this._textureEmissive=Lr(this._textureEmissive),this._textureOcclusion=Lr(this._textureOcclusion),this._textureMetallicRoughness=Lr(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?Hb.LOADED:Hb.LOADING}get textureBindParameters(){return new A3e(this._texture!=null?this._texture.glTexture:null,this._textureNormal!=null?this._textureNormal.glTexture:null,this._textureEmissive!=null?this._textureEmissive.glTexture:null,this._textureOcclusion!=null?this._textureOcclusion.glTexture:null,this._textureMetallicRoughness!=null?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){this._texture!=null&&e===this._texture.id||(this._texture=Lr(this._texture),this._textureId=e,this._acquire(this._textureId,i=>this._texture=i))}_acquire(e,i){if(e==null)return void i(null);const r=this._textures.acquire(e);if(uu(r))return++this._numLoading,void r.then(s=>{if(this._disposed)return Lr(s),void i(null);i(s)}).finally(()=>--this._numLoading);i(r)}},Ept=class extends cr{constructor(e=null){super(),this.textureEmissive=e}},A3e=class extends Ept{constructor(e=null,i=null,r=null,s=null,n=null,o,a){super(r),this.texture=e,this.textureNormal=i,this.textureOcclusion=s,this.textureMetallicRoughness=n,this.scale=o,this.normalTextureTransformMatrix=a}};var Ko;(function(t){t[t.None=0]="None",t[t.Value=1]="Value",t[t.Texture=2]="Texture",t[t.COUNT=3]="COUNT"})(Ko||(Ko={}));function Cpt(t,e){if(!ws(e.output))return;const{emissionSource:i,hasEmissiveTextureTransform:r,bindType:s}=e,n=i===Ko.Texture;n&&(t.include(u6,e),t.fragment.uniforms.add(s===Lt.Pass?new It("texEmission",a=>a.textureEmissive):new ag("texEmission",a=>a.textureEmissive)));const o=i===Ko.Value||n;o&&t.fragment.uniforms.add(s===Lt.Pass?new $r("emissionFactor",a=>a.emissiveFactor):new su("emissionFactor",a=>a.emissiveFactor)),t.fragment.code.add(E`
    vec4 getEmissions() {
      vec4 emissions = ${o?"vec4(emissionFactor, 1.0)":"vec4(0.0)"};
      ${Te(n,`emissions *= textureLookup(texEmission, ${r?"emissiveUV":"vuv0"});
         emissions.w = emissions.rgb == vec3(0.0) ? 0.0: emissions.w;`)}
      return emissions;
    }
  `)}function $pt(t,e){const i=t.fragment;switch(i.code.add(E`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case io.None:i.code.add(E`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case io.View:i.code.add(E`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case io.WindingOrder:i.code.add(E`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case io.COUNT:}}var io;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(io||(io={}));function WKt({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:i,roughnessFactor:r,emissiveTexture:s,emissiveFactor:n,occlusionTexture:o}){return t==null&&e==null&&s==null&&(n==null||to(n,cn))&&o==null&&(r==null||r===1)&&(i==null||i===1)}function ZKt({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:i,roughnessFactor:r,emissiveTexture:s,emissiveFactor:n,occlusionTexture:o}){return t==null&&e==null&&s==null&&(n==null||to(n,cn))&&o==null&&(r==null||r===1)&&(i==null||i===1||i===0)}const M3e=yf(1,1,.5),YKt=yf(0,.6,.2),JKt=yf(0,1,.2);var Ct;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Simplified=5]="Simplified",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(Ct||(Ct={}));function Pne(t,e){const i=e.pbrMode,r=t.fragment;if(i!==Ct.Schematic&&i!==Ct.Disabled&&i!==Ct.Normal)return void r.code.add(E`void applyPBRFactors() {}`);if(i===Ct.Disabled)return void r.code.add(E`void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`);if(i===Ct.Schematic)return void r.code.add(E`vec3 mrr = vec3(0.0, 0.6, 0.2);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`);const{hasMetallicRoughnessTexture:s,hasMetallicRoughnessTextureTransform:n,hasOcclusionTexture:o,hasOcclusionTextureTransform:a,bindType:l}=e;(s||o)&&t.include(u6,e),r.code.add(E`vec3 mrr;
float occlusion;`),s&&r.uniforms.add(l===Lt.Pass?new It("texMetallicRoughness",c=>c.textureMetallicRoughness):new ag("texMetallicRoughness",c=>c.textureMetallicRoughness)),o&&r.uniforms.add(l===Lt.Pass?new It("texOcclusion",c=>c.textureOcclusion):new ag("texOcclusion",c=>c.textureOcclusion)),r.uniforms.add(l===Lt.Pass?new $r("mrrFactors",c=>c.mrrFactors):new su("mrrFactors",c=>c.mrrFactors)),r.code.add(E`
    ${Te(s,E`void applyMetallicRoughness(vec2 uv) {
            vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
            mrr[0] *= metallicRoughness.b;
            mrr[1] *= metallicRoughness.g;
          }`)}

    ${Te(o,"void applyOcclusion(vec2 uv) { occlusion *= textureLookup(texOcclusion, uv).r; }")}

    float getBakedOcclusion() {
      return ${o?"occlusion":"1.0"};
    }

    void applyPBRFactors() {
      mrr = mrrFactors;
      occlusion = 1.0;

      ${Te(s,`applyMetallicRoughness(${n?"metallicRoughnessUV":"vuv0"});`)}
      ${Te(o,`applyOcclusion(${a?"occlusionUV":"vuv0"});`)}
    }
  `)}const bg=new Map([[z.POSITION,0],[z.NORMAL,1],[z.NORMALCOMPRESSED,1],[z.UV0,2],[z.COLOR,3],[z.COLORFEATUREATTRIBUTE,3],[z.SIZE,4],[z.TANGENT,4],[z.CENTEROFFSETANDDISTANCE,5],[z.SYMBOLCOLOR,5],[z.FEATUREATTRIBUTE,6],[z.INSTANCEFEATUREATTRIBUTE,6],[z.INSTANCECOLOR,7],[z.OBJECTANDLAYERIDCOLOR,7],[z.INSTANCEOBJECTANDLAYERIDCOLOR,7],[z.ROTATION,8],[z.INSTANCEMODEL,8],[z.INSTANCEMODELNORMAL,12],[z.INSTANCEMODELORIGINHI,11],[z.INSTANCEMODELORIGINLO,15]]);function O3e(t,e){return new P3e(t,L3e,e)}function Apt(t,e){const{curvatureDependent:i,scaleStart:r,scaleFallOffRange:s}=L3e;return new P3e(t,{curvatureDependent:{min:{curvature:i.min.curvature,tiltAngle:i.min.tiltAngle,scaleFallOffFactor:lq.curvatureDependent.min.scaleFallOffFactor},max:{curvature:i.max.curvature,tiltAngle:i.max.tiltAngle,scaleFallOffFactor:lq.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:s,minPixelSize:lq.minPixelSize},e)}function Mpt(t){return Math.abs(t*t*t)}function I3e(t,e,i){const r=i.parameters;return cq.scale=Math.min(r.divisor/(e-r.offset),1),cq.factor=Mpt(t),cq}function Dne(t,e){return ft(t*Math.max(e.scale,e.minScaleFactor),t,e.factor)}function Opt(t,e,i){const r=I3e(t,e,i);return r.minScaleFactor=0,Dne(1,r)}function Ife(t,e,i,r){r.scale=Opt(t,e,i),r.factor=0,r.minScaleFactor=i.minScaleFactor}function R3e(t,e,i=[0,0]){const r=Math.min(Math.max(e.scale,e.minScaleFactor),1);return i[0]=t[0]*r,i[1]=t[1]*r,i}function Ipt(t,e,i,r){return Dne(t,I3e(e,i,r))}let P3e=class D3e{get minScaleFactor(){return this._fontHeight!=null?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(e,i,r,s=Rpt(),n){this._viewingMode=e,this._description=i,this._ellipsoidRadius=r,this.parameters=s,this._fontHeight=n,this._viewingMode===je.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overrideFontHeight(e){return e!==this._fontHeight?new D3e(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,i,r){const{scaleStart:s,scaleFallOffRange:n}=this._description,{fovY:o,distance:a}=e,l=this._calculateCurvatureDependentParameters(e,i),c=this._coverageCompensation(e,i,l),{tiltAngle:h,scaleFallOffFactor:d}=l,f=Math.sin(h)*a,m=.5*Math.PI-h-o*(.5-s*c),g=f/Math.cos(m),v=m+o*n*c,_=(g-d*(f/Math.cos(v)))/(1-d);return r.camera.fovY=e.fovY,r.camera.distance=e.distance,r.offset=_,r.divisor=g-_,r}_calculateCurvatureDependentParametersLocal(e,i,r=Rfe){return r.tiltAngle=this._description.curvatureDependent.min.tiltAngle,r.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,r}_calculateCurvatureDependentParametersGlobal(e,i,r=Rfe){const s=this._description.curvatureDependent,n=1+e.distance/i,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=ue((o-a)/(l-a),0,1),[h,d]=[s.min,s.max];return r.tiltAngle=ft(h.tiltAngle,d.tiltAngle,c),r.scaleFallOffFactor=ft(h.scaleFallOffFactor,d.scaleFallOffFactor,c),r}_surfaceCoverageCompensationLocal(e,i,r){return RRe(r.tiltAngle,e.fovY)}_surfaceCoverageCompensationGlobal(e,i,r){return pM(Pfe,i),Hse(Pfe,r.tiltAngle,e.distance,e.fovY)}};const L3e={curvatureDependent:{min:{curvature:At(10),tiltAngle:At(12),scaleFallOffFactor:.5},max:{curvature:At(70),tiltAngle:At(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},lq={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function Rpt(){return{camera:{distance:0,fovY:0},divisor:0,offset:0}}const cq={scale:0,factor:0,minScaleFactor:0},Rfe={tiltAngle:0,scaleFallOffFactor:0},Pfe=Ls();function N3e(t,e,i,r,s){let n=(i.screenLength||0)*t.pixelRatio;s!=null&&(n=Ipt(n,r,e,s));const o=n*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return ue(o*e,i.minWorldLength||0,i.maxWorldLength!=null?i.maxWorldLength:1/0)}function Dfe(t,e){let i=!1;for(const r in e){const s=e[r];s!==void 0&&(Array.isArray(s)?Array.isArray(t[r])&&eg(s,t[r])||(t[r]=s.slice(),i=!0):t[r]!==s&&(i=!0,t[r]=s))}return i}const Ppt={multiply:1,ignore:2,replace:3,tint:4};let h6=class extends bL{constructor(e,i){super(),this.type=zn.Material,this.supportsEdges=!1,this._renderPriority=0,this.vertexAttributeLocations=bg,this._pp0=De(0,0,1),this._pp1=De(0,0,0),this._parameters=new i,Dfe(this._parameters,e),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e,i=!0){Dfe(this._parameters,e)&&(this.validateParameters(this._parameters),i&&this._parametersChanged())}validateParameters(e){}shouldRender(e){return this.visible&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bind.decorations)&&!!(this.parameters.renderOccluded&e.renderOccludedMask)}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this._parametersChanged())}_parametersChanged(){var e;(e=this.repository)==null||e.materialChanged(this)}queryRenderOccludedState(e){return this.visible&&this.parameters.renderOccluded===e}get hasEmissions(){return!1}intersectDraped(e,i,r,s,n,o){return this._pp0[0]=this._pp1[0]=s[0],this._pp0[1]=this._pp1[1]=s[1],this.intersect(e,i,r,this._pp0,this._pp1,n)}};var Cr;(function(t){t[t.None=0]="None",t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(Cr||(Cr={}));let Dpt=class extends cr{constructor(){super(...arguments),this.renderOccluded=Cr.Occlude,this.isDecoration=!1}};var Ti;(function(t){t[t.NONE=0]="NONE",t[t.ColorAlpha=1]="ColorAlpha",t[t.FrontFace=2]="FrontFace",t[t.COUNT=3]="COUNT"})(Ti||(Ti={}));function hT(t,e,i=Sv.ADD,r=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function hw(t,e,i,r,s=Sv.ADD,n=Sv.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:i,dstAlpha:r,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const Lpt=hT(Bt.ZERO,Bt.ONE_MINUS_SRC_ALPHA),Lne=hT(Bt.ONE,Bt.ZERO),Npt=hT(Bt.ONE,Bt.ONE),gM=hT(Bt.ONE,Bt.ONE_MINUS_SRC_ALPHA),Ld=hw(Bt.SRC_ALPHA,Bt.ONE,Bt.ONE_MINUS_SRC_ALPHA,Bt.ONE_MINUS_SRC_ALPHA),Nne={face:eh.BACK,mode:cA.CCW},Fpt={face:eh.FRONT,mode:cA.CCW},F3e=t=>t===Al.Back?Nne:t===Al.Front?Fpt:null,SL={zNear:0,zFar:1},Di={r:!0,g:!0,b:!0,a:!0};function kpt(t){return Wpt.intern(t)}function zpt(t){return Zpt.intern(t)}function Upt(t){return Ypt.intern(t)}function Bpt(t){return Jpt.intern(t)}function Vpt(t){return Xpt.intern(t)}function jpt(t){return Kpt.intern(t)}function Gpt(t){return Qpt.intern(t)}function Hpt(t){return eft.intern(t)}function qpt(t){return tft.intern(t)}function wi(t){return ift.intern(t)}let wg=class{constructor(e,i){this._makeKey=e,this._makeRef=i,this._interns=new Map}intern(e){if(!e)return null;const i=this._makeKey(e),r=this._interns;return r.has(i)||r.set(i,this._makeRef(e)),r.get(i)??null}};function xg(t){return"["+t.join(",")+"]"}const Wpt=new wg(k3e,t=>({__tag:"Blending",...t}));function k3e(t){return t?xg([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const Zpt=new wg(z3e,t=>({__tag:"Culling",...t}));function z3e(t){return t?xg([t.face,t.mode]):null}const Ypt=new wg(U3e,t=>({__tag:"PolygonOffset",...t}));function U3e(t){return t?xg([t.factor,t.units]):null}const Jpt=new wg(B3e,t=>({__tag:"DepthTest",...t}));function B3e(t){return t?xg([t.func]):null}const Xpt=new wg(V3e,t=>({__tag:"StencilTest",...t}));function V3e(t){return t?xg([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const Kpt=new wg(j3e,t=>({__tag:"DepthWrite",...t}));function j3e(t){return t?xg([t.zNear,t.zFar]):null}const Qpt=new wg(G3e,t=>({__tag:"ColorWrite",...t}));function G3e(t){return t?xg([t.r,t.g,t.b,t.a]):null}const eft=new wg(H3e,t=>({__tag:"StencilWrite",...t}));function H3e(t){return t?xg([t.mask]):null}const tft=new wg(q3e,t=>({__tag:"DrawBuffers",...t}));function q3e(t){return t?xg(t.buffers):null}const ift=new wg(rft,t=>({blending:kpt(t.blending),culling:zpt(t.culling),polygonOffset:Upt(t.polygonOffset),depthTest:Bpt(t.depthTest),stencilTest:Vpt(t.stencilTest),depthWrite:jpt(t.depthWrite),colorWrite:Gpt(t.colorWrite),stencilWrite:Hpt(t.stencilWrite),drawBuffers:qpt(t.drawBuffers)}));function rft(t){return t?xg([k3e(t.blending),z3e(t.culling),U3e(t.polygonOffset),B3e(t.depthTest),V3e(t.stencilTest),j3e(t.depthWrite),G3e(t.colorWrite),H3e(t.stencilWrite),q3e(t.drawBuffers)]):null}let sft=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._setDrawBuffers(e.drawBuffers),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(e){this._drawBuffers=this._setSubState(e,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(e,i,r,s){return(r||e!==i)&&(s(e),this._pipelineInvalid=!0),e}};const W3e=hw(Bt.ONE,Bt.ZERO,Bt.ONE,Bt.ONE_MINUS_SRC_ALPHA);function nft(t){return t===Ti.FrontFace?null:W3e}function Fne(t){switch(t){case Ti.NONE:return Ld;case Ti.ColorAlpha:return W3e;case Ti.FrontFace:case Ti.COUNT:return null}}function Z3e(t){if(t.draped)return null;switch(t.oitPass){case Ti.NONE:case Ti.FrontFace:return t.writeDepth?SL:null;case Ti.ColorAlpha:case Ti.COUNT:return null}}const oft=5e5,kne={factor:-1,units:-2};function aft(t){return t?kne:null}function zne(t,e=Ui.LESS){return t===Ti.NONE||t===Ti.FrontFace?e:Ui.LEQUAL}function d6(t,e){const i=dne(e);return t===Ti.ColorAlpha?i?{buffers:[nr.COLOR_ATTACHMENT0,nr.COLOR_ATTACHMENT1,nr.COLOR_ATTACHMENT2]}:{buffers:[nr.COLOR_ATTACHMENT0,nr.COLOR_ATTACHMENT1]}:i?{buffers:[nr.COLOR_ATTACHMENT0,nr.COLOR_ATTACHMENT1]}:null}let p6=class{constructor(e=!1,i=!0){this.isVerticalRay=e,this.normalRequired=i}};const aF=fh();function lft(t,e,i,r,s,n){if(!t.visible)return;const o=Fi(Q3e,r,i),a=(c,h,d)=>{n(c,d,h,!1)},l=new p6(!1,e.options.normalRequired);if(t.boundingInfo){Zt(t.type===zn.Mesh);const c=e.tolerance;Y3e(t.boundingInfo,i,o,c,s,l,a)}else{const c=t.attributes.get(z.POSITION),h=c.indices;X3e(i,o,0,h.length/3,h,c.data,c.stride,s,l,a)}}const cft=$();function Y3e(t,e,i,r,s,n,o){if(t==null)return;const a=_ft(i,cft);if($Ae(aF,t.bbMin),AAe(aF,t.bbMax),s!=null&&s.applyToAabb(aF),K3e(aF,e,a,r)){const{primitiveIndices:l,position:c}=t,h=l?l.length:c.indices.length/3;if(h>bft){const d=t.getChildren();if(d!==void 0){for(const f of d)Y3e(f,e,i,r,s,n,o);return}}pft(e,i,0,h,c.indices,c.data,c.stride,l,s,n,o)}}const lb=$();function uft(t,e,i,r,s,n,o,a,l){const{data:c,stride:h}=n;X3e(t,Fi(Q3e,e,t),i,r,s,c,h,o,a,l)}function J3e(t,e,i,r,s,n,o,a,l,c=null,h=0){const d=t[0],f=t[1],m=t[2],g=e[0],v=e[1],_=e[2];for(let b=i;b<r;++b){const w=h+(c?c[b]:b),x=3*w,S=o*s[x],C=n[S],T=n[S+1],M=n[S+2],I=o*s[x+1],D=n[I],P=n[I+1],F=n[I+2],L=o*s[x+2],N=D-C,R=P-T,k=F-M,W=n[L]-C,j=n[L+1]-T,B=n[L+2]-M,te=v*B-j*_,le=_*W-B*g,de=g*j-W*v,Ae=N*te+R*le+k*de;if(Math.abs(Ae)<=m6)continue;const We=d-C,Ue=f-T,it=m-M,Et=We*te+Ue*le+it*de;if(Ae>0){if(Et<0||Et>Ae)continue}else if(Et>0||Et<Ae)continue;const Jt=Ue*k-R*it,wt=it*N-k*We,vt=We*R-N*Ue,Ft=g*Jt+v*wt+_*vt;if(Ae>0){if(Ft<0||Et+Ft>Ae)continue}else if(Ft>0||Et+Ft<Ae)continue;const xt=(W*Jt+j*wt+B*vt)/Ae;xt>=0&&l(xt,w,a?f6(N,R,k,W,j,B,lb):null)}}function hft(t,e,i,r,s,n,o,a){const l=t[0],c=t[1],h=t[2],d=e[0],f=e[1],m=e[2];for(let g=i;g<r;++g){const v=3*g,_=v+1,b=v+2,w=n*v,x=s[w],S=s[w+1],C=s[w+2],T=n*_,M=n*b,I=s[T]-x,D=s[T+1]-S,P=s[T+2]-C,F=s[M]-x,L=s[M+1]-S,N=s[M+2]-C,R=f*N-L*m,k=m*F-N*d,W=d*L-F*f,j=I*R+D*k+P*W;if(Math.abs(j)<=m6)continue;const B=l-x,te=c-S,le=h-C,de=B*R+te*k+le*W;if(j>0){if(de<0||de>j)continue}else if(de>0||de<j)continue;const Ae=te*P-D*le,We=le*I-P*B,Ue=B*D-I*te,it=d*Ae+f*We+m*Ue;if(j>0){if(it<0||de+it>j)continue}else if(it>0||de+it<j)continue;const Et=(F*Ae+L*We+N*Ue)/j;Et>=0&&a(Et,g,o?f6(I,D,P,F,L,N,lb):null)}}function dft(t,e,i,r,s,n,o,a,l,c,h,d=null,f=0){const m=t[0],g=t[1],v=t[2],_=e[0],b=e[1],w=e[2];for(let x=i;x<r;++x){const S=f+(d?d[x]:x),C=3*S,T=o*s[C],M=n[T],I=n[T+1],D=n[T+2],P=o*s[C+1],F=n[P],L=n[P+1],N=n[P+2],R=o*s[C+2],k=n[R],W=n[R+1],j=n[R+2],B=D-l,te=a/Math.sqrt(M*M+I*I+B*B),le=M+M*te,de=I+I*te,Ae=D+B*te,We=N-l,Ue=a/Math.sqrt(F*F+L*L+We*We),it=F+F*Ue,Et=L+L*Ue,Jt=N+We*Ue,wt=j-l,vt=a/Math.sqrt(k*k+W*W+wt*wt),Ft=it-le,xt=Et-de,zt=Jt-Ae,ut=k+k*vt-le,_t=W+W*vt-de,me=j+wt*vt-Ae,ye=b*me-_t*w,we=w*ut-me*_,ke=_*_t-ut*b,Ge=Ft*ye+xt*we+zt*ke;if(Math.abs(Ge)<=m6)continue;const Ot=m-le,He=g-de,yt=v-Ae,Se=Ot*ye+He*we+yt*ke;if(Ge>0){if(Se<0||Se>Ge)continue}else if(Se>0||Se<Ge)continue;const ze=He*zt-xt*yt,bt=yt*Ft-zt*Ot,qi=Ot*xt-Ft*He,ji=_*ze+b*bt+w*qi;if(Ge>0){if(ji<0||Se+ji>Ge)continue}else if(ji>0||Se+ji<Ge)continue;const ur=(ut*ze+_t*bt+me*qi)/Ge;ur>=0&&h(ur,S,c?f6(Ft,xt,zt,ut,_t,me,lb):null)}}function pft(t,e,i,r,s,n,o,a,l,c,h){const d=t[0],f=t[1],m=t[2],g=e[0],v=e[1],_=e[2],{normalRequired:b}=c;for(let w=i;w<r;++w){const x=a[w],S=3*x,C=o*s[S];let T=n[C],M=n[C+1],I=n[C+2];const D=o*s[S+1];let P=n[D],F=n[D+1],L=n[D+2];const N=o*s[S+2];let R=n[N],k=n[N+1],W=n[N+2];l!=null&&([T,M,I]=l.applyToVertex(T,M,I,w),[P,F,L]=l.applyToVertex(P,F,L,w),[R,k,W]=l.applyToVertex(R,k,W,w));const j=P-T,B=F-M,te=L-I,le=R-T,de=k-M,Ae=W-I,We=v*Ae-de*_,Ue=_*le-Ae*g,it=g*de-le*v,Et=j*We+B*Ue+te*it;if(Math.abs(Et)<=m6)continue;const Jt=d-T,wt=f-M,vt=m-I,Ft=Jt*We+wt*Ue+vt*it;if(Et>0){if(Ft<0||Ft>Et)continue}else if(Ft>0||Ft<Et)continue;const xt=wt*te-B*vt,zt=vt*j-te*Jt,ut=Jt*B-j*wt,_t=g*xt+v*zt+_*ut;if(Et>0){if(_t<0||Ft+_t>Et)continue}else if(_t>0||Ft+_t<Et)continue;const me=(le*xt+de*zt+Ae*ut)/Et;me>=0&&h(me,x,b?f6(j,B,te,le,de,Ae,lb):null)}}function X3e(t,e,i,r,s,n,o,a,l,c){const h=e,d=wft,f=Math.abs(h[0]),m=Math.abs(h[1]),g=Math.abs(h[2]),v=f>=m?f>=g?0:2:m>=g?1:2,_=v,b=h[_]<0?2:1,w=(v+b)%3,x=(v+(3-b))%3,S=h[w]/h[_],C=h[x]/h[_],T=1/h[_],M=fft,I=mft,D=gft,{normalRequired:P}=l;for(let F=i;F<r;++F){const L=3*F,N=o*s[L];se(d[0],n[N+0],n[N+1],n[N+2]);const R=o*s[L+1];se(d[1],n[R+0],n[R+1],n[R+2]);const k=o*s[L+2];se(d[2],n[k+0],n[k+1],n[k+2]),a&&(ne(d[0],a.applyToVertex(d[0][0],d[0][1],d[0][2],F)),ne(d[1],a.applyToVertex(d[1][0],d[1][1],d[1][2],F)),ne(d[2],a.applyToVertex(d[2][0],d[2][1],d[2][2],F))),Fi(M,d[0],t),Fi(I,d[1],t),Fi(D,d[2],t);const W=M[w]-S*M[_],j=M[x]-C*M[_],B=I[w]-S*I[_],te=I[x]-C*I[_],le=D[w]-S*D[_],de=D[x]-C*D[_],Ae=le*te-de*B,We=W*de-j*le,Ue=B*j-te*W;if((Ae<0||We<0||Ue<0)&&(Ae>0||We>0||Ue>0))continue;const it=Ae+We+Ue;if(it===0)continue;const Et=Ae*(T*M[_])+We*(T*I[_])+Ue*(T*D[_]);if(Et*Math.sign(it)<0)continue;const Jt=Et/it;Jt>=0&&c(Jt,F,P?yft(d):null)}}const fft=$(),mft=$(),gft=$();function f6(t,e,i,r,s,n,o){return se(AB,t,e,i),se(MB,r,s,n),ct(o,AB,MB),ae(o,o),o}function yft(t){return Fi(AB,t[1],t[0]),Fi(MB,t[2],t[0]),ct(lb,AB,MB),ae(lb,lb),lb}const AB=$(),MB=$();function vft(t,e,i){return se(i,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function _ft(t,e){return se(e,1/t[0],1/t[1],1/t[2])}function K3e(t,e,i,r){return Une(t,e,i,r,1/0)}function Une(t,e,i,r,s){const n=(t[0]-r-e[0])*i[0],o=(t[3]+r-e[0])*i[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(t[1]-r-e[1])*i[1],h=(t[4]+r-e[1])*i[1];if(l=Math.min(l,Math.max(c,h)),l<0||(a=Math.max(a,Math.min(c,h)),a>l))return!1;const d=(t[2]-r-e[2])*i[2],f=(t[5]+r-e[2])*i[2];return l=Math.min(l,Math.max(d,f)),!(l<0)&&(a=Math.max(a,Math.min(d,f)),!(a>l)&&a<s)}const bft=1e3,m6=1e-7,Q3e=$(),wft=[$(),$(),$()];var xe;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.OPAQUE_MATERIAL_WITHOUT_NORMALS=3]="OPAQUE_MATERIAL_WITHOUT_NORMALS",t[t.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_MATERIAL_WITHOUT_NORMALS=5]="TRANSPARENT_MATERIAL_WITHOUT_NORMALS",t[t.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_MATERIAL_WITHOUT_DEPTH=7]="TRANSPARENT_MATERIAL_WITHOUT_DEPTH",t[t.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS",t[t.HUD_MATERIAL=12]="HUD_MATERIAL",t[t.LABEL_MATERIAL=13]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=14]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=15]="LINE_CALLOUTS_HUD_DEPTH",t[t.OVERLAY=16]="OVERLAY",t[t.DRAPED_MATERIAL=17]="DRAPED_MATERIAL",t[t.DRAPED_WATER=18]="DRAPED_WATER",t[t.VOXEL=19]="VOXEL",t[t.MAX_SLOTS=20]="MAX_SLOTS"})(xe||(xe={}));function xft(t,e,i,r=1){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(i*=a,r===1)for(let c=0;c<l;++c)o[i]=s[n[c]],i+=a;else for(let c=0;c<l;++c){const h=s[n[c]];for(let d=0;d<r;d++)o[i]=h,i+=a}}function Lfe(t,e,i){const{data:r,indices:s}=t,n=e.typedBuffer,o=e.typedBufferStride,a=s.length;i*=o;for(let l=0;l<a;++l){const c=2*s[l];n[i]=r[c],n[i+1]=r[c+1],i+=o}}function eDe(t,e,i,r){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(i*=a,r==null||r===1)for(let c=0;c<l;++c){const h=3*n[c];o[i]=s[h],o[i+1]=s[h+1],o[i+2]=s[h+2],i+=a}else for(let c=0;c<l;++c){const h=3*n[c];for(let d=0;d<r;++d)o[i]=s[h],o[i+1]=s[h+1],o[i+2]=s[h+2],i+=a}}function j3(t,e,i,r=1){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(i*=a,r===1)for(let c=0;c<l;++c){const h=4*n[c];o[i]=s[h],o[i+1]=s[h+1],o[i+2]=s[h+2],o[i+3]=s[h+3],i+=a}else for(let c=0;c<l;++c){const h=4*n[c];for(let d=0;d<r;++d)o[i]=s[h],o[i+1]=s[h+1],o[i+2]=s[h+2],o[i+3]=s[h+3],i+=a}}function Nfe(t,e,i){const r=t.typedBuffer,s=t.typedBufferStride;e*=s;for(let n=0;n<i;++n)r[e]=0,r[e+1]=0,r[e+2]=0,r[e+3]=0,e+=s}function Bne(t,e,i,r,s=1){if(!e)return void eDe(t,i,r,s);const{data:n,indices:o}=t,a=i.typedBuffer,l=i.typedBufferStride,c=o.length,h=e[0],d=e[1],f=e[2],m=e[4],g=e[5],v=e[6],_=e[8],b=e[9],w=e[10],x=e[12],S=e[13],C=e[14];r*=l;let T=0,M=0,I=0;const D=dG(e)?P=>{T=n[P]+x,M=n[P+1]+S,I=n[P+2]+C}:P=>{const F=n[P],L=n[P+1],N=n[P+2];T=h*F+m*L+_*N+x,M=d*F+g*L+b*N+S,I=f*F+v*L+w*N+C};if(s===1)for(let P=0;P<c;++P)D(3*o[P]),a[r]=T,a[r+1]=M,a[r+2]=I,r+=l;else for(let P=0;P<c;++P){D(3*o[P]);for(let F=0;F<s;++F)a[r]=T,a[r+1]=M,a[r+2]=I,r+=l}}function Vne(t,e,i,r,s=1){if(!e)return void eDe(t,i,r,s);const{data:n,indices:o}=t,a=e,l=i.typedBuffer,c=i.typedBufferStride,h=o.length,d=a[0],f=a[1],m=a[2],g=a[4],v=a[5],_=a[6],b=a[8],w=a[9],x=a[10],S=!Tre(a),C=1e-6,T=1-C;r*=c;let M=0,I=0,D=0;const P=dG(a)?F=>{M=n[F],I=n[F+1],D=n[F+2]}:F=>{const L=n[F],N=n[F+1],R=n[F+2];M=d*L+g*N+b*R,I=f*L+v*N+w*R,D=m*L+_*N+x*R};if(s===1)if(S)for(let F=0;F<h;++F){P(3*o[F]);const L=M*M+I*I+D*D;if(L<T&&L>C){const N=1/Math.sqrt(L);l[r]=M*N,l[r+1]=I*N,l[r+2]=D*N}else l[r]=M,l[r+1]=I,l[r+2]=D;r+=c}else for(let F=0;F<h;++F)P(3*o[F]),l[r]=M,l[r+1]=I,l[r+2]=D,r+=c;else for(let F=0;F<h;++F){if(P(3*o[F]),S){const L=M*M+I*I+D*D;if(L<T&&L>C){const N=1/Math.sqrt(L);M*=N,I*=N,D*=N}}for(let L=0;L<s;++L)l[r]=M,l[r+1]=I,l[r+2]=D,r+=c}}function Sft(t,e,i,r,s=1){if(!e)return void j3(t,i,r,s);const{data:n,indices:o}=t,a=e,l=i.typedBuffer,c=i.typedBufferStride,h=o.length,d=a[0],f=a[1],m=a[2],g=a[4],v=a[5],_=a[6],b=a[8],w=a[9],x=a[10],S=!Tre(a),C=1e-6,T=1-C;if(r*=c,s===1)for(let M=0;M<h;++M){const I=4*o[M],D=n[I],P=n[I+1],F=n[I+2],L=n[I+3];let N=d*D+g*P+b*F,R=f*D+v*P+w*F,k=m*D+_*P+x*F;if(S){const W=N*N+R*R+k*k;if(W<T&&W>C){const j=1/Math.sqrt(W);N*=j,R*=j,k*=j}}l[r]=N,l[r+1]=R,l[r+2]=k,l[r+3]=L,r+=c}else for(let M=0;M<h;++M){const I=4*o[M],D=n[I],P=n[I+1],F=n[I+2],L=n[I+3];let N=d*D+g*P+b*F,R=f*D+v*P+w*F,k=m*D+_*P+x*F;if(S){const W=N*N+R*R+k*k;if(W<T&&W>C){const j=1/Math.sqrt(W);N*=j,R*=j,k*=j}}for(let W=0;W<s;++W)l[r]=N,l[r+1]=R,l[r+2]=k,l[r+3]=L,r+=c}}function tDe(t,e,i,r,s=1){const{data:n,indices:o}=t,a=i.typedBuffer,l=i.typedBufferStride,c=o.length;if(r*=l,e!==n.length||e!==4)if(s!==1)if(e!==4)for(let h=0;h<c;++h){const d=3*o[h];for(let f=0;f<s;++f)a[r]=n[d],a[r+1]=n[d+1],a[r+2]=n[d+2],a[r+3]=255,r+=l}else for(let h=0;h<c;++h){const d=4*o[h];for(let f=0;f<s;++f)a[r]=n[d],a[r+1]=n[d+1],a[r+2]=n[d+2],a[r+3]=n[d+3],r+=l}else{if(e===4){for(let h=0;h<c;++h){const d=4*o[h];a[r]=n[d],a[r+1]=n[d+1],a[r+2]=n[d+2],a[r+3]=n[d+3],r+=l}return}for(let h=0;h<c;++h){const d=3*o[h];a[r]=n[d],a[r+1]=n[d+1],a[r+2]=n[d+2],a[r+3]=255,r+=l}}else{a[r]=n[0],a[r+1]=n[1],a[r+2]=n[2],a[r+3]=n[3];const h=new Uint32Array(i.typedBuffer.buffer,i.start),d=l/4,f=h[r/=4];r+=d;const m=c*s;for(let g=1;g<m;++g)h[r]=f,r+=d}}function Tft(t,e,i){const{data:r,indices:s}=t,n=e.typedBuffer,o=e.typedBufferStride,a=s.length,l=r[0];i*=o;for(let c=0;c<a;++c)n[i]=l,i+=o}function iDe(t,e,i,r,s=1){const n=e.typedBuffer,o=e.typedBufferStride;if(r*=o,s===1)for(let a=0;a<i;++a)n[r]=t[0],n[r+1]=t[1],n[r+2]=t[2],n[r+3]=t[3],r+=o;else for(let a=0;a<i;++a)for(let l=0;l<s;++l)n[r]=t[0],n[r+1]=t[1],n[r+2]=t[2],n[r+3]=t[3],r+=o}function Eft(t,e,i,r,s,n,o){var a;for(const l of i.fields.keys()){const c=t.get(l),h=c==null?void 0:c.indices;if(c&&h)Cft(l,c,r,s,n,o);else if(l===z.OBJECTANDLAYERIDCOLOR&&e!=null){const d=(a=t.get(z.POSITION))==null?void 0:a.indices;if(d){const f=d.length;iDe(e,n.getField(l,lg),f,o)}}}}function Cft(t,e,i,r,s,n){switch(t){case z.POSITION:{Zt(e.size===3);const o=s.getField(t,IS);Zt(!!o,`No buffer view for ${t}`),o&&Bne(e,i,o,n);break}case z.NORMAL:{Zt(e.size===3);const o=s.getField(t,IS);Zt(!!o,`No buffer view for ${t}`),o&&Vne(e,r,o,n);break}case z.NORMALCOMPRESSED:{Zt(e.size===2);const o=s.getField(t,c6);Zt(!!o,`No buffer view for ${t}`),o&&Lfe(e,o,n);break}case z.UV0:{Zt(e.size===2);const o=s.getField(t,l6);Zt(!!o,`No buffer view for ${t}`),o&&Lfe(e,o,n);break}case z.COLOR:case z.SYMBOLCOLOR:{const o=s.getField(t,lg);Zt(!!o,`No buffer view for ${t}`),Zt(e.size===3||e.size===4),!o||e.size!==3&&e.size!==4||tDe(e,e.size,o,n);break}case z.COLORFEATUREATTRIBUTE:{const o=s.getField(t,a6);Zt(!!o,`No buffer view for ${t}`),Zt(e.size===1),o&&e.size===1&&Tft(e,o,n);break}case z.TANGENT:{Zt(e.size===4);const o=s.getField(t,V3);Zt(!!o,`No buffer view for ${t}`),o&&Sft(e,i,o,n);break}case z.PROFILERIGHT:case z.PROFILEUP:case z.PROFILEVERTEXANDNORMAL:case z.FEATUREVALUE:{Zt(e.size===4);const o=s.getField(t,V3);Zt(!!o,`No buffer view for ${t}`),o&&j3(e,o,n)}}}let $ft=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.get(z.POSITION).indices.length}write(e,i,r,s,n,o){Eft(r,s,this.vertexBufferLayout,e,i,n,o)}intersect(e,i,r,s,n){const o=this.vertexBufferLayout.createView(e).getField(z.POSITION,IS);if(o==null)return;const a=Fi(Aft,s,r),l=0,c=o.elementCount/3,h=i.options.normalRequired,d=(f,m,g)=>{n(f,g,m,!1)};hft(r,a,l,c,o.typedBuffer,o.typedBufferStride,h,d)}};const Aft=$();function g6(t){t.attributes.add(z.POSITION,"vec3"),t.vertex.code.add(E`vec3 positionModel() { return position; }`)}let jne=class extends lr{constructor(e,i){super(e,"mat4",Lt.Pass,(r,s,n)=>r.setUniformMatrix4fv(e,i(s,n)))}};function fP(t,e){t.include(g6);const i=t.vertex;i.include(fne,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),i.uniforms.add(new $r("transformWorldFromViewTH",r=>r.transformWorldFromViewTH),new $r("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new Ud("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new jne("transformProjFromView",r=>r.transformProjFromView),new $B("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new su("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new su("transformWorldFromModelTL",r=>r.transformWorldFromModelTL)),i.code.add(E`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),i.code.add(E`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?E`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:E`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new $r("transformWorldFromViewTL",r=>r.transformWorldFromViewTL)),i.code.add(E`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(E`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let Mft=class extends cr{constructor(){super(...arguments),this.transformWorldFromViewTH=$(),this.transformWorldFromViewTL=$(),this.transformViewFromCameraRelativeRS=Ts(),this.transformProjFromView=qe()}},Oft=class extends cr{constructor(){super(...arguments),this.transformWorldFromModelRS=Ts(),this.transformWorldFromModelTH=$(),this.transformWorldFromModelTL=$()}};function y6(t,e){switch(e.normalType){case kr.Attribute:case kr.Compressed:t.include(mM,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add(new $B("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel),new Ud("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)),t.vertex.code.add(E`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case kr.ScreenDerivative:t.vertex.code.add(E`void forwardNormal() {}`);break;default:e.normalType;case kr.COUNT:}}let rDe=class extends Mft{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Ts()}},sDe=class extends Oft{constructor(){super(...arguments),this.transformNormalGlobalFromModel=Ts(),this.toMapSpace=yi()}},Bi=class{constructor(e,i){this._module=e,this._load=i}get(){return this._module}async reload(){return this._module=await this._load(),this._module}},Ffe=class{constructor(e,i,r){this._context=e,this._locations=r,this._textures=new Map,this._freeTextureUnits=new ii({deallocator:null}),this._glProgram=e.programCache.acquire(i.generate("vertex",!0),i.generate("fragment",!0),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bind=i.generateBind(this),this.bindPass=i.generateBindPass(this),this.bindDraw=i.generateBindDraw(this),this._fragmentUniforms=Np()?i.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(e,i){this._glProgram.setUniform1i(e,i?1:0)}setUniform1i(e,i){this._glProgram.setUniform1i(e,i)}setUniform1f(e,i){this._glProgram.setUniform1f(e,i)}setUniform2fv(e,i){this._glProgram.setUniform2fv(e,i)}setUniform3fv(e,i){this._glProgram.setUniform3fv(e,i)}setUniform4fv(e,i){this._glProgram.setUniform4fv(e,i)}setUniformMatrix3fv(e,i){this._glProgram.setUniformMatrix3fv(e,i)}setUniformMatrix4fv(e,i){this._glProgram.setUniformMatrix4fv(e,i)}setUniform1fv(e,i){this._glProgram.setUniform1fv(e,i)}setUniform1iv(e,i){this._glProgram.setUniform1iv(e,i)}setUniform2iv(e,i){this._glProgram.setUniform2iv(e,i)}setUniform3iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform4iv(e,i){this._glProgram.setUniform4iv(e,i)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,i){if((i==null?void 0:i.glName)==null){const s=this._textures.get(e);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(e)),null}let r=this._textures.get(e);return r==null?(r=this._allocTextureUnit(i),this._textures.set(e,r)):r.texture=i,this._context.useProgram(this),this.setUniform1i(e,r.unit),this._context.bindTexture(i,r.unit),r.unit}rebindTextures(){var e;this._context.useProgram(this),this._textures.forEach((i,r)=>{this._context.bindTexture(i.texture,i.unit),this.setUniform1i(r,i.unit)}),(e=this._fragmentUniforms)==null||e.forEach(i=>{i.type!=="sampler2D"&&i.type!=="samplerCube"||this._textures.has(i.name)||console.error(`Texture sampler ${i.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};const Ift=()=>J.getLogger("esri.views.3d.webgl.ShaderTechnique");let Hi=class{constructor(e,i,r,s=bg){this.locations=s,this.primitiveType=Gi.TRIANGLES,this.key=i.key,this._program=new Ffe(e.rctx,r.get().build(i),s),this._pipeline=this.initializePipeline(i),this.reload=async n=>{n&&await r.reload(),this.key.equals(i.key)||Ift().warn("Configuration was changed after construction, cannot reload shader.",r),Dt(this._program),this._program=new Ffe(e.rctx,r.get().build(i),s),this._pipeline=this.initializePipeline(i)}}destroy(){this._program=Dt(this._program),this._pipeline=null}get program(){return this._program}get compiled(){return this.program.compiled}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}getPipeline(e,i){return this._pipeline}initializePipeline(e){return wi({blending:gM,colorWrite:Di})}};const Rft={func:Ui.LESS},kfe={func:Ui.ALWAYS},OB={mask:255},Pft={mask:0},Dft=t=>({function:{func:Ui.NOTEQUAL,ref:t,mask:t},operation:{fail:tr.KEEP,zFail:tr.KEEP,zPass:tr.KEEP}}),Lft=t=>({function:{func:Ui.ALWAYS,ref:t,mask:t},operation:{fail:tr.KEEP,zFail:tr.KEEP,zPass:tr.REPLACE}}),Gne={function:{func:Ui.ALWAYS,ref:hh.OutlineVisualElementMask,mask:hh.OutlineVisualElementMask},operation:{fail:tr.KEEP,zFail:tr.KEEP,zPass:tr.ZERO}},GX={function:{func:Ui.ALWAYS,ref:hh.OutlineVisualElementMask,mask:hh.OutlineVisualElementMask},operation:{fail:tr.KEEP,zFail:tr.KEEP,zPass:tr.REPLACE}},Nft={function:{func:Ui.EQUAL,ref:hh.OutlineVisualElementMask,mask:hh.OutlineVisualElementMask},operation:{fail:tr.KEEP,zFail:tr.KEEP,zPass:tr.KEEP}},Fft={function:{func:Ui.NOTEQUAL,ref:hh.OutlineVisualElementMask,mask:hh.OutlineVisualElementMask},operation:{fail:tr.KEEP,zFail:tr.KEEP,zPass:tr.KEEP}};let $v=class extends lr{constructor(e,i){super(e,"vec2",Lt.Bind,(r,s)=>r.setUniform2fv(e,i(s)))}};function HX(t){t.varyings.add("linearDepth","float")}function Hne(t){t.vertex.uniforms.add(new $v("nearFar",e=>e.camera.nearFar))}function nDe(t){t.vertex.code.add(E`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function v6(t,e){const{vertex:i}=t;switch(e.output){case Y.Color:case Y.ColorEmission:if(e.receiveShadows)return HX(t),void i.code.add(E`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case Y.Shadow:case Y.ShadowHighlight:case Y.ShadowExcludeHighlight:case Y.ViewshedShadow:return t.include(fP,e),HX(t),Hne(t),nDe(t),void i.code.add(E`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}i.code.add(E`void forwardLinearDepth() {}`)}function oDe(t){t.vertex.code.add(E`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}let dQt=class extends cr{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function kft(t,e){cDe(t,e,new $r("slicePlaneOrigin",(i,r)=>qne(e,i,r)),new $r("slicePlaneBasis1",(i,r)=>{var s;return _A(e,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new $r("slicePlaneBasis2",(i,r)=>{var s;return _A(e,i,r,(s=r.slicePlane)==null?void 0:s.basis2)}))}function cb(t,e){cDe(t,e,new su("slicePlaneOrigin",(i,r)=>qne(e,i,r)),new su("slicePlaneBasis1",(i,r)=>{var s;return _A(e,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new su("slicePlaneBasis2",(i,r)=>{var s;return _A(e,i,r,(s=r.slicePlane)==null?void 0:s.basis2)}))}function aDe(t,e){lDe(t,e,new su("slicePlaneOrigin",(i,r)=>qne(e,i,r)),new su("slicePlaneBasis1",(i,r)=>{var s;return _A(e,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new su("slicePlaneBasis2",(i,r)=>{var s;return _A(e,i,r,(s=r.slicePlane)==null?void 0:s.basis2)}))}const zft=E`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
bool rejectBySlice(vec3 pos) {
return sliceByPlane(pos);
}`;function lDe(t,e,...i){e.hasSlicePlane?(t.uniforms.add(...i),t.code.add(zft)):t.code.add("bool rejectBySlice(vec3 pos) { return false; }")}function cDe(t,e,...i){lDe(t,e,...i),e.hasSlicePlane?t.code.add(`
    void discardBySlice(vec3 pos) {
      if (sliceByPlane(pos)) {
        discard;
      }
    }

    vec4 applySliceOutline(vec4 color, vec3 pos) {
      SliceFactors factors = calculateSliceFactors(pos);

      factors.front /= 2.0 * fwidth(factors.front);
      factors.side0 /= 2.0 * fwidth(factors.side0);
      factors.side1 /= 2.0 * fwidth(factors.side1);
      factors.side2 /= 2.0 * fwidth(factors.side2);
      factors.side3 /= 2.0 * fwidth(factors.side3);

      // return after calling fwidth, to avoid aliasing caused by discontinuities in the input to fwidth
      if (sliceByFactors(factors)) {
        return color;
      }

      float outlineFactor = (1.0 - step(0.5, factors.front))
        * (1.0 - step(0.5, factors.side0))
        * (1.0 - step(0.5, factors.side1))
        * (1.0 - step(0.5, factors.side2))
        * (1.0 - step(0.5, factors.side3));

      return mix(color, vec4(vec3(0.0), color.a), outlineFactor * 0.3);
    }

    vec4 applySlice(vec4 color, vec3 pos) {
      return sliceEnabled() ? applySliceOutline(color, pos) : color;
    }
  `):t.code.add(E`void discardBySlice(vec3 pos) { }
vec4 applySlice(vec4 color, vec3 pos) { return color; }`)}function uDe(t,e,i){return t.instancedDoublePrecision?se(Uft,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function hDe(t,e){return t!=null?be(IB,e.origin,t):e.origin}function dDe(t,e,i){return t.hasSliceTranslatedView?e!=null?uh(Bft,i.camera.viewMatrix,e):i.camera.viewMatrix:null}function qne(t,e,i){if(i.slicePlane==null)return cn;const r=uDe(t,e,i),s=hDe(r,i.slicePlane),n=dDe(t,r,i);return n!=null?ot(IB,s,n):s}function _A(t,e,i,r){if(r==null||i.slicePlane==null)return cn;const s=uDe(t,e,i),n=hDe(s,i.slicePlane),o=dDe(t,s,i);return o!=null?(oe(nO,r,n),ot(IB,n,o),ot(nO,nO,o),be(nO,nO,IB)):r}const Uft=$(),IB=$(),nO=$(),Bft=qe();function ub(t){nDe(t),t.vertex.code.add(E`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(E`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let Ka=class extends lr{constructor(e,i){super(e,"vec3",Lt.Bind,(r,s)=>r.setUniform3fv(e,i(s)))}},Un=class extends lr{constructor(e,i){super(e,"float",Lt.Bind,(r,s)=>r.setUniform1f(e,i(s)))}},Wne=class extends lr{constructor(e,i){super(e,"mat4",Lt.Draw,(r,s,n)=>r.setUniformMatrix4fv(e,i(s,n)))}};function Wb(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",cn):t.uniforms.add(new su("cameraPosition",(i,r)=>se(pDe,r.camera.viewInverseTransposeMatrix[3]-i.origin[0],r.camera.viewInverseTransposeMatrix[7]-i.origin[1],r.camera.viewInverseTransposeMatrix[11]-i.origin[2])))}function Qy(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add(new $o("proj",r=>r.camera.projectionMatrix),new Wne("view",(r,s)=>uh(zfe,s.camera.viewMatrix,r.origin)),new su("localOrigin",r=>r.origin));const i=({camera:r})=>se(pDe,r.viewInverseTransposeMatrix[3],r.viewInverseTransposeMatrix[7],r.viewInverseTransposeMatrix[11]);t.uniforms.add(new $o("proj",r=>r.camera.projectionMatrix),new $o("view",r=>uh(zfe,r.camera.viewMatrix,i(r))),new Ka("localOrigin",r=>i(r)))}const zfe=qe(),pDe=$();function RB(t){t.uniforms.add(new $o("viewNormal",e=>e.camera.viewInverseTransposeMatrix))}function TL(t){t.uniforms.add(new Un("pixelRatio",e=>e.camera.pixelRatio/e.overlayStretch))}function qX(t,e,i){for(let r=0;r<i;++r)e[2*r]=t[r],e[2*r+1]=t[r]-e[2*r]}function Vft(t,e){const i=t.length;for(let r=0;r<i;++r)uC[0]=t[r],e[r]=uC[0];return e}function jft(t,e){const i=t.length;for(let r=0;r<i;++r)uC[0]=t[r],uC[1]=t[r]-uC[0],e[r]=uC[1];return e}const uC=new Float32Array(2),Ufe=Ts();function fDe(t,e){const i=e.hasModelTransformation,r=e.instancedDoublePrecision;i&&(t.vertex.uniforms.add(new jne("model",n=>n.modelTransformation??eo)),t.vertex.uniforms.add(new Ud("normalLocalOriginFromModel",n=>(nse(Ufe,n.modelTransformation??eo),Ufe)))),e.instanced&&r&&(t.attributes.add(z.INSTANCEMODELORIGINHI,"vec3"),t.attributes.add(z.INSTANCEMODELORIGINLO,"vec3"),t.attributes.add(z.INSTANCEMODEL,"mat3"),t.attributes.add(z.INSTANCEMODELNORMAL,"mat3"));const s=t.vertex;r&&(s.include(fne,e),s.uniforms.add(new Ka("viewOriginHi",n=>Vft(se(lF,n.camera.viewInverseTransposeMatrix[3],n.camera.viewInverseTransposeMatrix[7],n.camera.viewInverseTransposeMatrix[11]),lF)),new Ka("viewOriginLo",n=>jft(se(lF,n.camera.viewInverseTransposeMatrix[3],n.camera.viewInverseTransposeMatrix[7],n.camera.viewInverseTransposeMatrix[11]),lF)))),s.code.add(E`
    vec3 getVertexInLocalOriginSpace() {
      return ${i?r?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":r?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${r?E`
          // Negated inputs are intentionally the first two arguments. The other way around the obfuscation in dpAdd() stopped
          // working for macOS 14+ and iOS 17+.
          // Issue: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(-instanceModelOriginHi, -instanceModelOriginLo, viewOriginHi, viewOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),s.code.add(E`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${i?r?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":r?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `),e.output===Y.Normal&&(RB(s),s.code.add(E`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${i?r?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":r?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `)),e.hasVertexTangents&&s.code.add(E`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${i?r?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":r?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)}const lF=$();let dw=class extends lr{constructor(e,i){super(e,"int",Lt.Pass,(r,s,n)=>r.setUniform1i(e,i(s,n)))}};function mDe(t,e){e.hasSymbolColors?(t.include(o3e),t.attributes.add(z.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(E`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new dw("colorMixMode",i=>Ppt[i.colorMixMode])),t.vertex.code.add(E`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function _6(t,e){e.hasVertexColors?(t.attributes.add(z.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(E`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(E`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(E`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function Zne(t){t.vertex.code.add(E`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(E`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),t.vertex.code.add(E`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(E`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(E`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(E`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function Gft(t){t.uniforms.add(new $r("screenSizePerspective",e=>gDe(e.screenSizePerspective)))}function b6(t){t.uniforms.add(new $r("screenSizePerspectiveAlignment",e=>gDe(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function gDe(t){return se(Hft,t.parameters.divisor,t.parameters.offset,t.minScaleFactor)}const Hft=$();let pc=class extends lr{constructor(e,i){super(e,"vec4",Lt.Pass,(r,s,n)=>r.setUniform4fv(e,i(s,n)))}};function yDe(t,e){const i=t.vertex;e.hasVerticalOffset?(vDe(i),e.hasScreenSizePerspective&&(t.include(Zne),b6(i),Wb(t.vertex,e)),i.code.add(E`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?E`vec3 worldNormal = normalize(worldPos + localOrigin);`:E`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?E`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:E`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(E`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const qft=yi();function vDe(t){t.uniforms.add(new pc("verticalOffset",(e,i)=>{const{minWorldLength:r,maxWorldLength:s,screenLength:n}=e.verticalOffset,o=Math.tan(.5*i.camera.fovY)/(.5*i.camera.fullViewport[3]),a=i.camera.pixelRatio||1;return ss(qft,n*a,o,r,s)}))}function Yne(t,e){if(e.output!==Y.ObjectAndLayerIdColor)return t.vertex.code.add(E`void forwardObjectAndLayerIdColor() {}`),void t.fragment.code.add(E`void outputObjectAndLayerIdColor() {}`);const i=e.objectAndLayerIdColorInstanced;t.varyings.add("objectAndLayerIdColorVarying","vec4"),t.attributes.add(i?z.INSTANCEOBJECTANDLAYERIDCOLOR:z.OBJECTANDLAYERIDCOLOR,"vec4"),t.vertex.code.add(E`
    void forwardObjectAndLayerIdColor() {
      objectAndLayerIdColorVarying = ${i?"instanceObjectAndLayerIdColor":"objectAndLayerIdColor"} * 0.003921568627451;
    }`),t.fragment.code.add(E`void outputObjectAndLayerIdColor() {
fragColor = objectAndLayerIdColorVarying;
}`)}function _De(t){t.code.add(E`const float MAX_RGBA4_FLOAT =
15.0 / 16.0 +
15.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 / 16.0;
const vec4 FIXED_POINT_FACTORS_RGBA4 = vec4(1.0, 16.0, 16.0 * 16.0, 16.0 * 16.0 * 16.0);
vec4 floatToRgba4(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA4_FLOAT);
vec4 fixedPointU4 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS_RGBA4) * 16.0);
const float toU4AsFloat = 1.0 / 15.0;
return fixedPointU4 * toU4AsFloat;
}
const vec4 RGBA4_2_FLOAT_FACTORS = vec4(
15.0 / (16.0),
15.0 / (16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0 * 16.0)
);
float rgba4ToFloat(vec4 rgba) {
return dot(rgba, RGBA4_2_FLOAT_FACTORS);
}`)}function Jne(t,e){switch(e.output){case Y.Shadow:case Y.ShadowHighlight:case Y.ShadowExcludeHighlight:case Y.ViewshedShadow:t.fragment.include(_De),t.fragment.code.add(E`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth) {
fragColor = floatToRgba4(_calculateFragDepth(_linearDepth));
}`)}}function w6(t){const{fragment:e}=t;e.code.add(E`uint readChannelBits(uint channel, int highlightLevel) {
int llc = (highlightLevel & 3) << 1;
return (channel >> llc) & 3u;
}
uint readChannel(vec2 texel, int highlightLevel) {
int lic = (highlightLevel >> 2) & 1;
return uint(texel[lic] * 255.0);
}
uint readLevelBits(vec2 texel, int highlightLevel) {
return readChannelBits(readChannel(texel, highlightLevel), highlightLevel);
}`)}let Wft=class extends lr{constructor(e,i){super(e,"ivec2",Lt.Bind,(r,s)=>r.setUniform2iv(e,i(s)))}},Xne=class extends lr{constructor(e,i){super(e,"int",Lt.Bind,(r,s)=>r.setUniform1i(e,i(s)))}},oo=class extends lr{constructor(e,i){super(e,"sampler2D",Lt.Bind,(r,s)=>r.bindTexture(e,i(s)))}};function EL(t,e){const{fragment:i}=t;e.output===Y.Highlight?(i.uniforms.add(new oo("depthTexture",r=>r.mainDepth),new oo("highlightTexture",r=>r.highlightMixTexture),new Xne("highlightLevel",r=>r.highlightLevel??0),new Wft("highlightMixOrigin",r=>r.highlightMixOrigin)),t.outputs.add("fragHighlight","vec2",0),t.include(w6),i.code.add(E`vec2 getAccumulatedHighlight() {
return texelFetch(highlightTexture, ivec2(gl_FragCoord.xy) - highlightMixOrigin, 0).rg;
}
void outputHighlight(bool occluded) {
if (highlightLevel == 0) {
uint bits = occluded ? 3u : 1u;
fragHighlight = vec2(float(bits) / 255.0, 0.0);
} else {
int ll = (highlightLevel & 3) << 1;
int li = (highlightLevel >> 2) & 3;
uint bits;
if (occluded) {
bits = 3u << ll;
} else {
bits = 1u << ll;
}
vec2 combinedHighlight = getAccumulatedHighlight();
uint accumulatedI = uint(combinedHighlight[li] * 255.0);
combinedHighlight[li] = float(bits | accumulatedI) / 255.0;
fragHighlight = combinedHighlight;
}
}
bool isHighlightOccluded() {
float sceneDepth = texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x;
return gl_FragCoord.z > sceneDepth + 5e-7;
}
void calculateOcclusionAndOutputHighlight() {
outputHighlight(isHighlightOccluded());
}`),e.canHaveOverlay&&i.code.add(E`void calculateOcclusionAndOutputHighlightOverlay(vec2 highlightToAdd) {
uint levelBits = readLevelBits(highlightToAdd, highlightLevel);
if ((levelBits & 1u) == 0u) { discard; }
outputHighlight(isHighlightOccluded());
}`)):i.code.add(E`void calculateOcclusionAndOutputHighlight() {}`)}let Zft=class extends lr{constructor(e,i,r){super(e,"vec4",Lt.Pass,(s,n,o)=>s.setUniform4fv(e,i(n,o)),r)}},gd=class extends lr{constructor(e,i,r){super(e,"float",Lt.Pass,(s,n,o)=>s.setUniform1fv(e,i(n,o)),r)}},zs=class extends he{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};u([p()],zs.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),u([p()],zs.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),u([p()],zs.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),u([p()],zs.prototype,"DECONFLICTOR_SHOW_GRID",void 0),u([p()],zs.prototype,"LABELS_SHOW_BORDER",void 0),u([p()],zs.prototype,"TEXT_SHOW_BASELINE",void 0),u([p()],zs.prototype,"TEXT_SHOW_BORDER",void 0),u([p()],zs.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),u([p()],zs.prototype,"OVERLAY_SHOW_CENTER",void 0),u([p()],zs.prototype,"SHOW_POI",void 0),u([p()],zs.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),u([p()],zs.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),u([p()],zs.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),u([p()],zs.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),u([p()],zs.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),u([p()],zs.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),u([p()],zs.prototype,"I3S_TREE_SHOW_TILES",void 0),u([p()],zs.prototype,"I3S_SHOW_MODIFICATIONS",void 0),u([p()],zs.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),u([p()],zs.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),u([p()],zs.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),u([p()],zs.prototype,"LINE_WIREFRAMES",void 0),zs=u([A("esri.views.3d.support.debugFlags")],zs);const xs=new zs;var qa,Bfe;(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(qa||(qa={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(Bfe||(Bfe={}));let Kne=class{constructor(e){this.field=e}},Yft=class extends Kne{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[qa.Undefined,qa.Undefined,qa.Undefined]}},Jft=class extends Kne{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}},Xft=class extends Kne{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},Kft=class{};function oO(t){return t!=null}function Qft(t,e,i,r=qe()){const s=t||0,n=e||0,o=i||0;return s!==0&&Q$(r,r,-s/180*Math.PI),n!==0&&K$(r,r,n/180*Math.PI),o!==0&&uG(r,r,o/180*Math.PI),r}function w0(t,e,i,r,s){var a;const n=t.minSize,o=t.maxSize;if(t.useSymbolValue){const l=r.symbolSize[i];return e.minSize[i]=l,e.maxSize[i]=l,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=qa.DefinedSize,!0}if(oO(t.field))return oO(t.stops)?t.stops.length===2&&I_(t.stops[0].size)&&I_(t.stops[1].size)?(Vfe(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,i),e.type[i]=qa.DefinedSize,!0):!1:I_(n)&&I_(o)&&oO(t.minDataValue)&&oO(t.maxDataValue)?(Vfe(n,o,t.minDataValue,t.maxDataValue,e,i),e.type[i]=qa.DefinedSize,!0):t.valueUnit==="unknown"?!1:fA[t.valueUnit]!=null?(e.minSize[i]=-1/0,e.maxSize[i]=1/0,e.offset[i]=0,e.factor[i]=1/fA[t.valueUnit],e.type[i]=qa.DefinedSize,!0):!1;if(!oO(t.field)){if((a=t.stops)!=null&&a[0]&&I_(t.stops[0].size))return e.minSize[i]=t.stops[0].size,e.maxSize[i]=t.stops[0].size,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=qa.DefinedSize,!0;if(I_(n))return e.minSize[i]=n,e.maxSize[i]=n,e.offset[i]=n,e.factor[i]=0,e.type[i]=qa.DefinedSize,!0}return!1}function Vfe(t,e,i,r,s,n){const o=Math.abs(r-i)>0?(e-t)/(r-i):0;s.minSize[n]=o>0?t:e,s.maxSize[n]=o>0?e:t,s.offset[n]=t-i*o,s.factor[n]=o}function emt(t,e,i,r){if(t.normalizationField||t.valueRepresentation||!W$e(t.field))return null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return null}else e.size.field=t.field}else e.size=new Yft(t.field);let s;switch(t.axis){case"width":return s=w0(t,e.size,0,i),s?e:null;case"height":return s=w0(t,e.size,2,i),s?e:null;case"depth":return s=w0(t,e.size,1,i),s?e:null;case"width-and-depth":return s=w0(t,e.size,0,i),s&&w0(t,e.size,1,i),s?e:null;case null:case void 0:case"all":return s=w0(t,e.size,0,i),s=s&&w0(t,e.size,1,i),s=s&&w0(t,e.size,2,i),s?e:null;default:return`${t.axis}`,null}}function tmt(t,e,i){for(let s=0;s<3;++s){let n=e.unitInMeters;t.type[s]===qa.DefinedSize&&(n*=e.modelSize[s],t.type[s]=qa.DefinedScale),t.minSize[s]=t.minSize[s]/n,t.maxSize[s]=t.maxSize[s]/n,t.offset[s]=t.offset[s]/n,t.factor[s]=t.factor[s]/n}let r;if(t.type[0]!==qa.Undefined)r=0;else if(t.type[1]!==qa.Undefined)r=1;else{if(t.type[2]===qa.Undefined)return!1;r=2}for(let s=0;s<3;++s)t.type[s]===qa.Undefined&&(t.minSize[s]=t.minSize[r],t.maxSize[s]=t.maxSize[r],t.offset[s]=t.offset[r],t.factor[s]=t.factor[r],t.type[s]=t.type[r]);return!0}function jfe(t,e,i){t[4*e]=i.r/255,t[4*e+1]=i.g/255,t[4*e+2]=i.b/255,t[4*e+3]=i.a}function imt(t,e,i){if(t.normalizationField)return null;if(sw(t.field)){if(!t.stops)return null;{if(t.stops.length>8)return null;e.color=new Jft(t.field);const r=t.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];e.color.values[s]=n.value,jfe(e.color.colors,s,n.color)}}}else{if(!(t.stops&&t.stops.length>=0))return null;{const r=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.color.values[s]=1/0,jfe(e.color.colors,s,r)}}return e}function rmt(t,e,i){if(t.normalizationField)return null;if(sw(t.field)){if(!t.stops)return null;{if(t.stops.length>8)return null;e.opacity=new Xft(t.field);const r=t.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];e.opacity.values[s]=n.value,e.opacity.opacityValues[s]=n.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return null;{const r=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.opacity.values[s]=1/0,e.opacity.opacityValues[s]=r}}return e}function uq(t,e,i){const r=i===2&&t.rotationType==="arithmetic";e.offset[i]=r?90:0,e.factor[i]=r?-1:1,e.type[i]=1}function smt(t,e,i){if(!sw(t.field))return null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return uq(t,e.rotation,0),e;case"roll":return uq(t,e.rotation,1),e;case null:case void 0:case"heading":return uq(t,e.rotation,2),e;default:return`${t.axis}`,null}}let OQt=class{constructor(e,i=[1,1,1],r=[1,1,1],s=1,n=[0,0,0],o=[1,1,1],a=[0,0,0]){this.supports=e,this.modelSize=i,this.symbolSize=r,this.unitInMeters=s,this.anchor=n,this.scale=o,this.rotation=a}};function bDe(t,e,i){if(!t)return null;const r=t.reduce((s,n)=>{if(!s)return s;if(n.valueExpression)return null;switch(n.type){case"size":return e.supports.size?emt(n,s,e,i):s;case"color":return e.supports.color?imt(n,s):s;case"opacity":return e.supports.opacity?rmt(n,s):null;case"rotation":return e.supports.rotation?smt(n,s,i):s;default:return null}},new Kft);return!(t.length>0&&r)||r.size||r.color||r.opacity||r.rotation?r!=null&&r.size&&!tmt(r.size,e)?null:r:null}let nmt=class{constructor(e,i,r){this.visualVariables=e,this.materialParameters=i,this.requiresShaderTransformation=r}};function PQt(t,e){if(!t||xs.TESTS_DISABLE_FAST_UPDATES)return null;const i=bDe(t.visualVariables,e);return i?new nmt(i,xDe(i,e),!!i.size):null}function DQt(t,e,i){if(!e||!t)return!1;const r=t.visualVariables,s=bDe(e.visualVariables,i);return!!s&&!!(cF(r.size,s.size,"size")&&cF(r.color,s.color,"color")&&cF(r.rotation,s.rotation,"rotation")&&cF(r.opacity,s.opacity,"opacity"))&&(t.visualVariables=s,t.materialParameters=xDe(s,i),t.requiresShaderTransformation=!!s.size,!0)}function cF(t,e,i){if(!!t!=!!e||t&&t.field!==(e==null?void 0:e.field))return!1;if(t&&i==="rotation"){const r=t,s=e;for(let n=0;n<3;n++)if(r.type[n]!==s.type[n]||r.offset[n]!==s.offset[n]||r.factor[n]!==s.factor[n])return!1}return!0}let wDe=class extends cr{constructor(e){super(),this.vvSize=(e==null?void 0:e.size)??null,this.vvColor=(e==null?void 0:e.color)??null,this.vvOpacity=(e==null?void 0:e.opacity)??null}};function xDe(t,e){const i=new wDe(t);return i.vvSize&&(i.vvSymbolAnchor=e.anchor,_f(mP),Qft(e.rotation[2],e.rotation[0],e.rotation[1],mP),i.vvSymbolRotationMatrix=i.vvSymbolRotationMatrix||Ts(),sT(i.vvSymbolRotationMatrix,mP)),i}function NQt(t,e,i){if(!t.vvSize)return i;_n(x0,i);const r=t.vvSymbolRotationMatrix;yg(mP,r[0],r[1],r[2],0,r[3],r[4],r[5],0,r[6],r[7],r[8],0,0,0,0,1),Bn(x0,x0,mP);for(let s=0;s<3;++s){const n=t.vvSize.offset[s]+e[0]*t.vvSize.factor[s];Gfe[s]=ue(n,t.vvSize.minSize[s],t.vvSize.maxSize[s])}return m$e(x0,x0,Gfe),uh(x0,x0,t.vvSymbolAnchor),x0}function omt(t,e,i){if(!e.vvSize)return se(t,1,1,1),t;for(let r=0;r<3;++r){const s=e.vvSize.offset[r]+i[0]*e.vvSize.factor[r];t[r]=ue(s,e.vvSize.minSize[r],e.vvSize.maxSize[r])}return t}function hq(t,e){const i=t==null?0:e.attributes[t];return typeof i=="number"&&isFinite(i)?i:0}const x0=qe(),Gfe=$(),mP=qe();let amt=class extends wDe{constructor(){super(...arguments),this.renderOccluded=Cr.Occlude,this.isDecoration=!1}};const dq=8;function iS(t,e){const{vertex:i,attributes:r}=t;e.hasVvInstancing&&(e.vvSize||e.vvColor)&&r.add(z.INSTANCEFEATUREATTRIBUTE,"vec4"),e.vvSize?(i.uniforms.add(new $r("vvSizeMinSize",s=>s.vvSize.minSize)),i.uniforms.add(new $r("vvSizeMaxSize",s=>s.vvSize.maxSize)),i.uniforms.add(new $r("vvSizeOffset",s=>s.vvSize.offset)),i.uniforms.add(new $r("vvSizeFactor",s=>s.vvSize.factor)),i.uniforms.add(new Ud("vvSymbolRotationMatrix",s=>s.vvSymbolRotationMatrix)),i.uniforms.add(new $r("vvSymbolAnchor",s=>s.vvSymbolAnchor)),i.code.add(E`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(E`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?E`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(E`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(i.constants.add("vvColorNumber","int",dq),i.uniforms.add(new gd("vvColorValues",s=>s.vvColor.values,dq),new Zft("vvColorColors",s=>s.vvColor.colors,dq)),i.code.add(E`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVvInstancing?E`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):i.code.add(E`vec4 vvColor() { return vec4(1.0); }`)}let SDe=class extends lr{constructor(e,i){super(e,"float",Lt.Draw,(r,s,n)=>r.setUniform1f(e,i(s,n)))}},mt=class extends lr{constructor(e,i){super(e,"float",Lt.Pass,(r,s,n)=>r.setUniform1f(e,i(s,n)))}};const Kr=1/255.5;function hC(t,e){TDe(t,e,new mt("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function lmt(t,e){TDe(t,e,new SDe("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function TDe(t,e,i){const r=t.fragment,s=e.alphaDiscardMode,n=s===Fn.Blend;s!==Fn.Mask&&s!==Fn.MaskBlend||r.uniforms.add(i),r.code.add(E`
    void discardOrAdjustAlpha(inout vec4 color) {
      ${s===Fn.Opaque?"color.a = 1.0;":`if (color.a < ${n?E.float(Kr):"textureAlphaCutoff"}) {
              discard;
             } ${Te(s===Fn.Mask,"else { color.a = 1.0; }")}`}
    }
  `)}function EDe(t,e){const{vertex:i,fragment:r}=t,s=e.hasColorTexture&&e.alphaDiscardMode!==Fn.Opaque,{output:n,normalType:o,hasColorTextureTransform:a}=e;switch(n){case Y.Depth:Qy(i,e),t.include(ub,e),t.fragment.include(cb,e),t.include(Ky,e),s&&r.uniforms.add(new It("tex",l=>l.texture)),i.main.add(E`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();`),t.include(hC,e),r.main.add(E`
        discardBySlice(vpos);
        ${Te(s,E`vec4 texColor = texture(tex, ${a?"colorUV":"vuv0"});
                discardOrAdjustAlpha(texColor);`)}`);break;case Y.Shadow:case Y.ShadowHighlight:case Y.ShadowExcludeHighlight:case Y.ViewshedShadow:case Y.ObjectAndLayerIdColor:Qy(i,e),t.include(ub,e),t.include(Ky,e),t.include(iS,e),t.include(Jne,e),t.fragment.include(cb,e),t.include(Yne,e),Hne(t),t.varyings.add("depth","float"),s&&r.uniforms.add(new It("tex",l=>l.texture)),i.main.add(E`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
forwardTextureCoordinates();
forwardObjectAndLayerIdColor();`),t.include(hC,e),r.main.add(E`
        discardBySlice(vpos);
        ${Te(s,E`vec4 texColor = texture(tex, ${a?"colorUV":"vuv0"});
                discardOrAdjustAlpha(texColor);`)}
        ${n===Y.ObjectAndLayerIdColor?E`outputObjectAndLayerIdColor();`:E`outputDepth(depth);`}`);break;case Y.Normal:{Qy(i,e),t.include(ub,e),t.include(mM,e),t.include(y6,e),t.include(Ky,e),t.include(iS,e),s&&r.uniforms.add(new It("tex",c=>c.texture)),o===kr.ScreenDerivative&&t.varyings.add("vPositionView","vec3");const l=o===kr.Attribute||o===kr.Compressed;i.main.add(E`
        vpos = getVertexInLocalOriginSpace();
        ${l?E`vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:E`vPositionView = (view * vec4(vpos, 1.0)).xyz;`}
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, vpos);
        forwardTextureCoordinates();`),t.fragment.include(cb,e),t.include(hC,e),r.main.add(E`
        discardBySlice(vpos);
        ${Te(s,E`vec4 texColor = texture(tex, ${a?"colorUV":"vuv0"});
                discardOrAdjustAlpha(texColor);`)}

        ${o===kr.ScreenDerivative?E`vec3 normal = screenDerivativeNormal(vPositionView);`:E`vec3 normal = normalize(vNormalWorld);
                    if (gl_FrontFacing == false){
                      normal = -normal;
                    }`}
        fragColor = vec4(0.5 + 0.5 * normal, 1.0);`);break}case Y.Highlight:Qy(i,e),t.include(ub,e),t.include(Ky,e),t.include(iS,e),s&&r.uniforms.add(new It("tex",l=>l.texture)),i.main.add(E`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();`),t.fragment.include(cb,e),t.include(hC,e),t.include(EL,e),r.main.add(E`
        discardBySlice(vpos);
        ${Te(s,E`vec4 texColor = texture(tex, ${a?"colorUV":"vuv0"});
                discardOrAdjustAlpha(texColor);`)}
        calculateOcclusionAndOutputHighlight();`)}}let yc=class extends lr{constructor(e,i){super(e,"vec2",Lt.Pass,(r,s,n)=>r.setUniform2fv(e,i(s,n)))}};function CDe(t,e){const i=t.fragment;e.hasVertexTangents?(t.attributes.add(z.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===io.WindingOrder?i.code.add(E`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(E`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):i.code.add(E`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),e.textureCoordinateType!==Ys.None&&(t.include(u6,e),i.uniforms.add(e.bindType===Lt.Pass?new It("normalTexture",r=>r.textureNormal):new ag("normalTexture",r=>r.textureNormal)),e.hasNormalTextureTransform&&(i.uniforms.add(new yc("scale",r=>r.scale??LMe)),i.uniforms.add(new Ud("normalTextureTransformMatrix",r=>r.normalTextureTransformMatrix??aT))),i.code.add(E`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;`),e.hasNormalTextureTransform&&i.code.add(E`mat3 normalTextureRotation = mat3(normalTextureTransformMatrix[0][0]/scale[0], normalTextureTransformMatrix[0][1]/scale[1], 0.0,
normalTextureTransformMatrix[1][0]/scale[0], normalTextureTransformMatrix[1][1]/scale[1], 0.0,
0.0, 0.0, 0.0 );
rawNormal.xy = (normalTextureRotation * vec3(rawNormal.x, rawNormal.y, 1.0)).xy;`),i.code.add(E`return tangentSpace * rawNormal;
}`))}var rr,dt;(function(t){t.OPAQUE="opaque-color",t.TRANSPARENT="transparent-color",t.COMPOSITE="composite-color",t.FINAL="final-color"})(rr||(rr={})),function(t){t.SSAO="ssao",t.LASERLINES="laserline-color",t.ANTIALIASING="aa-color",t.HIGHLIGHTS="highlight-color",t.MAGNIFIER="magnifier-color",t.OCCLUDED="occluded-color",t.VIEWSHED="viewshed-color",t.OPAQUE_ENVIRONMENT="opaque-environment-color",t.TRANSPARENT_ENVIRONMENT="transparent-environment-color",t.FOCUSAREA="focus-area"}(dt||(dt={}));var gr,Ho;(function(t){t[t.RED=0]="RED",t[t.RG=1]="RG",t[t.RGBA4=2]="RGBA4",t[t.RGBA=3]="RGBA",t[t.RGBA_MIPMAP=4]="RGBA_MIPMAP",t[t.R16F=5]="R16F",t[t.RGBA16F=6]="RGBA16F"})(gr||(gr={})),function(t){t[t.DEPTH_STENCIL_TEXTURE=0]="DEPTH_STENCIL_TEXTURE",t[t.DEPTH16_BUFFER=1]="DEPTH16_BUFFER"}(Ho||(Ho={}));let L1=class extends he{constructor(e){super(e),this.view=null,this.consumes={required:[]},this.produces=rr.COMPOSITE,this.requireGeometryDepth=!1,this._dirty=!0}initialize(){this.addHandles([H(()=>this.view.ready,e=>{var i;e&&((i=this.view._stage)==null||i.renderer.addRenderNode(this))},Ut)])}destroy(){var e,i;(i=(e=this.view._stage)==null?void 0:e.renderer)==null||i.removeRenderNode(this)}precompile(){}render(){throw new U("RenderNode:render-function-not-implemented","render() is not implemented.")}get camera(){return this.view.state.camera.clone()}get sunLight(){return this.bindParameters.lighting.legacy}get gl(){return this.view._stage.renderView.renderingContext.gl}get techniques(){return this.view._stage.renderView.techniques}acquireOutputFramebuffer(){var r,s,n;const e=(s=(r=this._frameBuffer)==null?void 0:r.getTexture())==null?void 0:s.descriptor,i=this.view._stage.renderer.fboCache.acquire((e==null?void 0:e.width)??640,(e==null?void 0:e.height)??480,this.produces);return(n=i.fbo)==null||n.initializeAndBind(),i}bindRenderTarget(){var e,i;return(i=(e=this._frameBuffer)==null?void 0:e.fbo)==null||i.initializeAndBind(),this._frameBuffer}requestRender(e){var i;e===$t.UPDATE&&((i=this.view._stage)==null||i.renderView.requestRender(e)),this._dirty=!0}resetWebGLState(){var e;this.renderingContext.resetState(),this.renderingContext.bindFramebuffer((e=this._frameBuffer)==null?void 0:e.fbo)}get fboCache(){return this.view._stage.renderer.fboCache}get bindParameters(){return this.renderContext.bind}get renderingContext(){return this.view._stage.renderView.renderingContext}get renderContext(){var e;return(e=this.view._stage)==null?void 0:e.renderer.renderContext}updateAnimation(e){return!!this._dirty&&(this._dirty=!1,!0)}doRender(e){this._frameBuffer=e.find(({name:i})=>i===this.produces);try{return this.render(e)}finally{this._frameBuffer=null}}};u([p({constructOnly:!0})],L1.prototype,"view",void 0),u([p({constructOnly:!0})],L1.prototype,"consumes",void 0),u([p()],L1.prototype,"produces",void 0),u([p({readOnly:!0})],L1.prototype,"techniques",null),L1=u([A("esri.views.3d.webgl.RenderNode")],L1);const Af=L1,$De=3e5,PB=5e5;function ia(t,e=!0){t.attributes.add(z.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.main.add(E`
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?E`uv = position * 0.5 + vec2(0.5);`:""}
  `)}function Sg(t){t.uniforms.add(new $v("zProjectionMap",e=>cmt(e.camera))),t.code.add(E`float linearizeDepth(float depth) {
float depthNdc = depth * 2.0 - 1.0;
float c1 = zProjectionMap[0];
float c2 = zProjectionMap[1];
return -(c1 / (depthNdc + c2 + 1e-7));
}`),t.code.add(E`float depthFromTexture(sampler2D depthTexture, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
float depth = texelFetch(depthTexture, iuv, 0).r;
return depth;
}`),t.code.add(E`float linearDepthFromTexture(sampler2D depthTexture, vec2 uv) {
return linearizeDepth(depthFromTexture(depthTexture, uv));
}`)}function cmt(t){const e=t.projectionMatrix;return di(umt,e[14],e[10])}const umt=Ye();let Qne=class extends lr{constructor(e,i){super(e,"vec2",Lt.Draw,(r,s,n,o)=>r.setUniform2fv(e,i(s,n,o)))}};const eoe=()=>J.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let ADe=class{constructor(){this._includedModules=new Map}include(e,i){this._includedModules.has(e)?this._includedModules.get(e):(this._includedModules.set(e,i),e(this.builder,i))}},Vi=class extends ADe{constructor(){super(...arguments),this.vertex=new Hfe,this.fragment=new Hfe,this.attributes=new fmt,this.varyings=new mmt,this.extensions=new WX,this.outputs=new YX}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e,i=!1){const r=this.extensions.generateSource(e),s=this.attributes.generateSource(e),n=this.varyings.generateSource(e),o=e==="vertex"?this.vertex:this.fragment,a=o.uniforms.generateSource(),l=o.code.generateSource(),c=o.main.generateSource(i),h=e==="vertex"?vmt:ymt,d=o.constants.generateSource(),f=this.outputs.generateSource(e);return`#version 300 es
${r.join(`
`)}
${h}
${d.join(`
`)}
${a.join(`
`)}
${s.join(`
`)}
${n.join(`
`)}
${f.join(`
`)}
${l.join(`
`)}
${c.join(`
`)}`}generateBind(e){const i=new Map;this.vertex.uniforms.entries.forEach(n=>{const o=n.bind[Lt.Bind];o&&i.set(n.name,o)}),this.fragment.uniforms.entries.forEach(n=>{const o=n.bind[Lt.Bind];o&&i.set(n.name,o)});const r=Array.from(i.values()),s=r.length;return n=>{for(let o=0;o<s;++o)r[o](e,n)}}generateBindPass(e){const i=new Map;this.vertex.uniforms.entries.forEach(n=>{const o=n.bind[Lt.Pass];o&&i.set(n.name,o)}),this.fragment.uniforms.entries.forEach(n=>{const o=n.bind[Lt.Pass];o&&i.set(n.name,o)});const r=Array.from(i.values()),s=r.length;return(n,o)=>{for(let a=0;a<s;++a)r[a](e,n,o)}}generateBindDraw(e){const i=new Map;this.vertex.uniforms.entries.forEach(n=>{const o=n.bind[Lt.Draw];o&&i.set(n.name,o)}),this.fragment.uniforms.entries.forEach(n=>{const o=n.bind[Lt.Draw];o&&i.set(n.name,o)});const r=Array.from(i.values()),s=r.length;return(n,o,a)=>{for(let l=0;l<s;++l)r[l](e,a,n,o)}}},hmt=class{constructor(e){this._stage=e,this._entries=new Map}add(...e){for(const i of e)this._add(i);return this._stage}get(e){return this._entries.get(e)}_add(e){if(e!=null){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new U(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else eoe().error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(e=>e.arraySize!=null?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},dmt=class{constructor(e){this._stage=e,this._bodies=new Array}add(e){return this._bodies.push(e),this._stage}generateSource(e){if(this._bodies.length>0)return[`void main() {
 ${this._bodies.join(`
`)||""} 
}`];if(e)throw new U("Shader does not contain main function body.");return[]}},pmt=class{constructor(e){this._stage=e,this._entries=new Array}add(e){return this._entries.push(e),this._stage}generateSource(){return this._entries}},Hfe=class extends ADe{constructor(){super(...arguments),this.uniforms=new hmt(this),this.main=new dmt(this),this.code=new pmt(this),this.constants=new gmt(this)}get builder(){return this}},fmt=class{constructor(){this._entries=new Array}add(e,i){this._entries.push([e,i])}generateSource(e){return e==="fragment"?[]:this._entries.map(i=>`in ${i[1]} ${i[0]};`)}},mmt=class{constructor(){this._entries=new Map}add(e,i){this._entries.has(e)?eoe().warn(`Ignoring duplicate varying ${i} ${e}`):this._entries.set(e,i)}generateSource(e){const i=new Array;return this._entries.forEach((r,s)=>i.push(e==="vertex"?`out ${r} ${s};`:`in ${r} ${s};`)),i}},WX=class ZX{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const i=e==="vertex"?ZX.ALLOWLIST_VERTEX:ZX.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(r=>i.includes(r)).map(r=>`#extension ${r} : enable`)}};WX.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],WX.ALLOWLIST_VERTEX=[];let YX=class JX{constructor(){this._entries=new Map}add(e,i,r=0){const s=this._entries.get(r);(s==null?void 0:s.name)!==e||(s==null?void 0:s.type)!==i?this._entries.set(r,{name:e,type:i}):eoe().warn(`Fragment shader output location ${r} occupied`)}generateSource(e){if(e==="vertex")return[];this._entries.size===0&&this._entries.set(0,{name:JX.DEFAULT_NAME,type:JX.DEFAULT_TYPE});const i=new Array;return this._entries.forEach((r,s)=>i.push(`layout(location = ${s}) out ${r.type} ${r.name};`)),i}};YX.DEFAULT_TYPE="vec4",YX.DEFAULT_NAME="fragColor";let gmt=class En{constructor(e){this._stage=e,this._entries=new Set}add(e,i,r){let s="ERROR_CONSTRUCTOR_STRING";switch(i){case"float":s=En._numberToFloatStr(r);break;case"int":s=En._numberToIntStr(r);break;case"bool":s=r.toString();break;case"vec2":s=`vec2(${En._numberToFloatStr(r[0])},                            ${En._numberToFloatStr(r[1])})`;break;case"vec3":s=`vec3(${En._numberToFloatStr(r[0])},                            ${En._numberToFloatStr(r[1])},                            ${En._numberToFloatStr(r[2])})`;break;case"vec4":s=`vec4(${En._numberToFloatStr(r[0])},                            ${En._numberToFloatStr(r[1])},                            ${En._numberToFloatStr(r[2])},                            ${En._numberToFloatStr(r[3])})`;break;case"ivec2":s=`ivec2(${En._numberToIntStr(r[0])},                             ${En._numberToIntStr(r[1])})`;break;case"ivec3":s=`ivec3(${En._numberToIntStr(r[0])},                             ${En._numberToIntStr(r[1])},                             ${En._numberToIntStr(r[2])})`;break;case"ivec4":s=`ivec4(${En._numberToIntStr(r[0])},                             ${En._numberToIntStr(r[1])},                             ${En._numberToIntStr(r[2])},                             ${En._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${i}(${Array.prototype.map.call(r,n=>En._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${i} ${e} = ${s};`),this._stage}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const ymt=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp int;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump int;
  precision mediump sampler2D;
#endif`,vmt=`precision highp float;
precision highp sampler2D;`,pq=4;function MDe(){const t=new Vi,e=t.fragment;t.include(ia);const i=(pq+1)/2,r=1/(2*i*i);return e.include(Sg),e.uniforms.add(new It("depthMap",s=>s.depthTexture),new ag("tex",s=>s.colorTexture),new Qne("blurSize",s=>s.blurSize),new mt("projScale",(s,n)=>{const o=n.camera.distance;return o>5e4?Math.max(0,s.projScale-(o-5e4)):s.projScale})),e.code.add(E`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${E.float(r)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),t.outputs.add("fragBlur","float"),e.main.add(E`
    float b = 0.0;
    float w_total = 0.0;

    float center_d = linearDepthFromTexture(depthMap, uv);

    float sharpness = -0.05 * projScale / center_d;
    for (int r = -${E.int(pq)}; r <= ${E.int(pq)}; ++r) {
      float rf = float(r);
      vec2 uvOffset = uv + rf * blurSize;
      blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
    }
    fragBlur = b / w_total;`),t}const _mt=Object.freeze(Object.defineProperty({__proto__:null,build:MDe},Symbol.toStringTag,{value:"Module"}));let qfe=class extends Hi{constructor(e,i){super(e,i,new Bi(_mt,()=>G(()=>Promise.resolve().then(()=>V6t),void 0)))}initializePipeline(){return wi({colorWrite:Di})}};const bmt="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";let wmt=class extends cr{constructor(){super(...arguments),this.projScale=1}},xmt=class extends wmt{constructor(){super(...arguments),this.intensity=1}},Smt=class extends cr{},Tmt=class extends Smt{constructor(){super(...arguments),this.blurSize=Ye()}},Va=class extends lr{constructor(e,i){super(e,"vec4",Lt.Bind,(r,s)=>r.setUniform4fv(e,i(s)))}};function x6(t){t.fragment.uniforms.add(new Va("projInfo",e=>Emt(e.camera))),t.fragment.uniforms.add(new $v("zScale",e=>Cmt(e.camera))),t.fragment.code.add(E`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function Emt(t){const e=t.projectionMatrix;return e[11]===0?ss(Wfe,2/(t.fullWidth*e[0]),2/(t.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):ss(Wfe,-2/(t.fullWidth*e[0]),-2/(t.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const Wfe=yi();function Cmt(t){return t.projectionMatrix[11]===0?di(Zfe,0,1):di(Zfe,1,0)}const Zfe=Ye(),Yfe=16;function ODe(){const t=new Vi,e=t.fragment;return t.include(ia),t.include(x6),e.include(Sg),e.uniforms.add(new Un("radius",i=>S6(i.camera))).code.add(E`vec3 sphere[16] = vec3[16](
vec3(0.186937, 0.0, 0.0),
vec3(0.700542, 0.0, 0.0),
vec3(-0.864858, -0.481795, -0.111713),
vec3(-0.624773, 0.102853, -0.730153),
vec3(-0.387172, 0.260319, 0.007229),
vec3(-0.222367, -0.642631, -0.707697),
vec3(-0.01336, -0.014956, 0.169662),
vec3(0.122575, 0.1544, -0.456944),
vec3(-0.177141, 0.85997, -0.42346),
vec3(-0.131631, 0.814545, 0.524355),
vec3(-0.779469, 0.007991, 0.624833),
vec3(0.308092, 0.209288,0.35969),
vec3(0.359331, -0.184533, -0.377458),
vec3(0.192633, -0.482999, -0.065284),
vec3(0.233538, 0.293706, -0.055139),
vec3(0.417709, -0.386701, 0.442449)
);
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),e.code.add(E`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add(new It("normalMap",i=>i.normalTexture),new It("depthMap",i=>i.depthTexture),new mt("projScale",i=>i.projScale),new It("rnm",i=>i.noiseTexture),new yc("rnmScale",(i,r)=>di(Jfe,r.camera.fullWidth/i.noiseTexture.descriptor.width,r.camera.fullHeight/i.noiseTexture.descriptor.height)),new mt("intensity",i=>i.intensity),new $v("screenSize",i=>di(Jfe,i.camera.fullWidth,i.camera.fullHeight))),t.outputs.add("fragOcclusion","float"),e.main.add(E`
      float depth = depthFromTexture(depthMap, uv);

      // Early out if depth is out of range, such as in the sky
      if (depth >= 1.0 || depth <= 0.0) {
        fragOcclusion = 1.0;
        return;
      }

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      if(norm4.a != 1.0) {
        fragOcclusion = 1.0;
        return;
      }
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;

      float currentPixelDepth = linearizeDepth(depth);
      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy, currentPixelDepth);

      float sum = 0.0;
      vec3 tapPixelPos;

      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${E.int(Yfe)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        // don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap);

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum += aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${E.int(Yfe)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A * A * A * A) / 2.2;

      fragOcclusion = A;`),t}function S6(t){return Math.max(10,20*t.computeScreenPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const Jfe=Ye(),$mt=Object.freeze(Object.defineProperty({__proto__:null,build:ODe,getRadius:S6},Symbol.toStringTag,{value:"Module"}));let Xfe=class extends Hi{constructor(e,i){super(e,i,new Bi($mt,()=>G(()=>Promise.resolve().then(()=>j6t),void 0)))}initializePipeline(){return wi({colorWrite:Di})}};const BI=2;let r2=class extends Af{constructor(e){super(e),this.consumes={required:["normals"]},this.produces=dt.SSAO,this.isEnabled=()=>!1,this._enableTime=0,this._passParameters=new xmt,this._drawParameters=new Tmt}initialize(){const e=Uint8Array.from(atob(bmt),r=>r.charCodeAt(0)),i=new Ar;i.wrapMode=ar.CLAMP_TO_EDGE,i.pixelFormat=Tt.RGB,i.wrapMode=ar.REPEAT,i.hasMipmap=!0,i.width=32,i.height=32,this._passParameters.noiseTexture=new pi(this.renderingContext,i,e),this.techniques.precompile(Xfe),this.techniques.precompile(qfe),this.addHandles(H(()=>this.isEnabled(),()=>this._enableTime=0))}destroy(){this._passParameters.noiseTexture=Dt(this._passParameters.noiseTexture)}render(e){const i=this.bindParameters,r=e.find(({name:M})=>M==="normals"),s=r==null?void 0:r.getTexture(),n=r==null?void 0:r.getTexture(CS),o=this.fboCache,a=i.camera,l=a.fullViewport[2],c=a.fullViewport[3],h=Math.round(l/BI),d=Math.round(c/BI),f=this.techniques.get(Xfe),m=this.techniques.get(qfe);if(!f.compiled||!m.compiled)return this._enableTime=performance.now(),this.requestRender($t.UPDATE),o.acquire(h,d,dt.SSAO,gr.RED);this._enableTime===0&&(this._enableTime=performance.now());const g=this.renderingContext,v=this.view.qualitySettings.fadeDuration,_=a.relativeElevation,b=ue((PB-_)/(PB-$De),0,1),w=v>0?Math.min(v,performance.now()-this._enableTime)/v:1,x=w*b;this._passParameters.normalTexture=s,this._passParameters.depthTexture=n,this._passParameters.projScale=1/a.computeScreenPixelSizeAtDist(1),this._passParameters.intensity=4*Amt/S6(a)**6*x;const S=o.acquire(l,c,"ssao input",gr.RG);g.bindFramebuffer(S.fbo),g.setViewport(0,0,l,c),g.bindTechnique(f,i,this._passParameters,this._drawParameters),g.screen.draw();const C=o.acquire(h,d,"ssao blur",gr.RED);g.bindFramebuffer(C.fbo),this._drawParameters.colorTexture=S.getTexture(),di(this._drawParameters.blurSize,0,BI/c),g.bindTechnique(m,i,this._passParameters,this._drawParameters),g.setViewport(0,0,h,d),g.screen.draw(),S.release();const T=o.acquire(h,d,dt.SSAO,gr.RED);return g.bindFramebuffer(T.fbo),g.setViewport(0,0,l,c),g.setClearColor(1,1,1,0),g.clear(Mi.COLOR),this._drawParameters.colorTexture=C.getTexture(),di(this._drawParameters.blurSize,BI/l,0),g.bindTechnique(m,i,this._passParameters,this._drawParameters),g.setViewport(0,0,h,d),g.screen.draw(),g.setViewport4fv(a.fullViewport),C.release(),w<1&&this.requestRender($t.UPDATE),T}};u([p()],r2.prototype,"consumes",void 0),u([p()],r2.prototype,"produces",void 0),u([p({constructOnly:!0})],r2.prototype,"isEnabled",void 0),r2=u([A("esri.views.3d.webgl-engine.effects.ssao.SSAO")],r2);const Amt=.5;function T6(t,e){const i=t.fragment;e.receiveAmbientOcclusion?(i.uniforms.add(new oo("ssaoTex",r=>{var s;return(s=r.ssao)==null?void 0:s.getTexture()})),i.constants.add("blurSizePixelsInverse","float",1/BI),i.code.add(E`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):i.code.add(E`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function IDe(t,e){const i=t.fragment,r=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;r===0?(i.uniforms.add(new Ka("lightingAmbientSH0",({lighting:s})=>se(Kfe,s.sh.r[0],s.sh.g[0],s.sh.b[0]))),i.code.add(E`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===1?(i.uniforms.add(new Va("lightingAmbientSH_R",({lighting:s})=>ss(kg,s.sh.r[0],s.sh.r[1],s.sh.r[2],s.sh.r[3])),new Va("lightingAmbientSH_G",({lighting:s})=>ss(kg,s.sh.g[0],s.sh.g[1],s.sh.g[2],s.sh.g[3])),new Va("lightingAmbientSH_B",({lighting:s})=>ss(kg,s.sh.b[0],s.sh.b[1],s.sh.b[2],s.sh.b[3]))),i.code.add(E`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===2&&(i.uniforms.add(new Ka("lightingAmbientSH0",({lighting:s})=>se(Kfe,s.sh.r[0],s.sh.g[0],s.sh.b[0])),new Va("lightingAmbientSH_R1",({lighting:s})=>ss(kg,s.sh.r[1],s.sh.r[2],s.sh.r[3],s.sh.r[4])),new Va("lightingAmbientSH_G1",({lighting:s})=>ss(kg,s.sh.g[1],s.sh.g[2],s.sh.g[3],s.sh.g[4])),new Va("lightingAmbientSH_B1",({lighting:s})=>ss(kg,s.sh.b[1],s.sh.b[2],s.sh.b[3],s.sh.b[4])),new Va("lightingAmbientSH_R2",({lighting:s})=>ss(kg,s.sh.r[5],s.sh.r[6],s.sh.r[7],s.sh.r[8])),new Va("lightingAmbientSH_G2",({lighting:s})=>ss(kg,s.sh.g[5],s.sh.g[6],s.sh.g[7],s.sh.g[8])),new Va("lightingAmbientSH_B2",({lighting:s})=>ss(kg,s.sh.b[5],s.sh.b[6],s.sh.b[7],s.sh.b[8]))),i.code.add(E`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==Ct.Normal&&e.pbrMode!==Ct.Schematic||i.code.add(E`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const Kfe=$(),kg=yi();function cg(t){t.uniforms.add(new Ka("mainLightDirection",e=>e.lighting.mainLight.direction))}function Av(t){t.uniforms.add(new Ka("mainLightIntensity",e=>e.lighting.mainLight.intensity))}function Mmt(t){cg(t.fragment),Av(t.fragment),t.fragment.code.add(E`vec3 applyShading(vec3 shadingNormalWorld, float shadow) {
float dotVal = clamp(dot(shadingNormalWorld, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadow) * dotVal);
}`)}function Omt(t){const e=t.fragment.code;e.add(E`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(E`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(E`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function CL(t){const e=3.141592653589793,i=.3183098861837907;t.vertex.constants.add("PI","float",e),t.fragment.constants.add("PI","float",e),t.fragment.constants.add("LIGHT_NORMALIZATION","float",i),t.fragment.constants.add("INV_PI","float",i),t.fragment.constants.add("HALF_PI","float",1.570796326794897),t.fragment.constants.add("TWO_PI","float",6.28318530717958)}function toe(t,e){const i=t.fragment.code;t.include(CL),e.pbrMode!==Ct.Normal&&e.pbrMode!==Ct.Schematic&&e.pbrMode!==Ct.Simplified&&e.pbrMode!==Ct.TerrainWithWater||(i.add(E`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(E`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==Ct.Normal&&e.pbrMode!==Ct.Schematic||(t.include(Omt),i.add(E`struct PBRShadingInfo
{
float NdotV;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(E`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(E`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(E`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function Imt(t,e){const i=t.fragment.code;t.include(CL),i.add(E`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),i.add(E`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(E`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(E`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(E`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze) * strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}`)}let DB=class extends lr{constructor(e,i){super(e,"bool",Lt.Bind,(r,s)=>r.setUniform1b(e,i(s)))}},ioe=class{constructor(e=nM()){this.intensity=e}},RDe=class{constructor(e=nM(),i=De(.57735,.57735,.57735)){this.intensity=e,this.direction=i}},LB=class{constructor(e=nM(),i=De(.57735,.57735,.57735),r=!0,s=1,n=1){this.intensity=e,this.direction=i,this.castShadows=r,this.specularStrength=s,this.environmentStrength=n}},PDe=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function Rmt(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e[r];return i}function fq(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e;return i}function i$(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]+e[r];return i}function DDe(t){return(t+1)*(t+1)}function Pmt(t){return ue(Math.floor(Math.sqrt(t)-1),0,2)}function LDe(t,e,i){const r=t[0],s=t[1],n=t[2],o=i||[];return o.length=DDe(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*r,o[2]=.4886025119*n,o[3]=.4886025119*s),e>=2&&(o[4]=1.09254843059*r*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*r*n,o[8]=.54627421529*(r*r-s*s)),o}function Dmt(t,e){const i=DDe(t),r=e||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let s=0;s<i;s++)r.r[s]=r.g[s]=r.b[s]=0;return r}function Lmt(t,e){const i=Pmt(e.r.length);for(const r of t)Cd(XX,r.direction),LDe(XX,i,Jy),Rmt(Jy,M5),fq(Jy,r.intensity[0],YT),i$(e.r,YT),fq(Jy,r.intensity[1],YT),i$(e.g,YT),fq(Jy,r.intensity[2],YT),i$(e.b,YT);return e}function Nmt(t,e){LDe(XX,0,Jy);for(const i of t)e.r[0]+=Jy[0]*M5[0]*i.intensity[0]*4*Math.PI,e.g[0]+=Jy[0]*M5[0]*i.intensity[1]*4*Math.PI,e.b[0]+=Jy[0]*M5[0]*i.intensity[2]*4*Math.PI;return e}function Fmt(t,e,i,r){Dmt(e,r),se(i.intensity,0,0,0);let s=!1;const n=kmt,o=zmt,a=Umt;n.length=0,o.length=0,a.length=0;for(const l of t)l instanceof LB&&!s?(ne(i.direction,l.direction),ne(i.intensity,l.intensity),i.specularStrength=l.specularStrength,i.environmentStrength=l.environmentStrength,i.castShadows=l.castShadows,s=!0):l instanceof LB||l instanceof RDe?n.push(l):l instanceof ioe?o.push(l):l instanceof PDe&&a.push(l);Lmt(n,r),Nmt(o,r);for(const l of a)i$(r.r,l.r),i$(r.g,l.g),i$(r.b,l.b)}const kmt=[],zmt=[],Umt=[],Jy=[0],YT=[0],XX=$(),M5=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let Qfe=class{constructor(){this.color=$(),this.intensity=1}},Bmt=class{constructor(){this.direction=$(),this.ambient=new Qfe,this.diffuse=new Qfe}};const NDe=.4;let mq=class{constructor(){this._shOrder=2,this._legacy=new Bmt,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new PDe,this._mainLight=new LB($(),De(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){Fmt(e,this._shOrder,this._mainLight,this._sphericalHarmonics),ne(this._legacy.direction,this._mainLight.direction);const i=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*i,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*i,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*i,re(this._legacy.diffuse.color,this._mainLight.intensity,i),ne(uF,this._legacy.diffuse.color),re(uF,uF,NDe*this.globalFactor),oe(this._legacy.ambient.color,this._legacy.ambient.color,uF)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),ne(this._mainLight.direction,e.mainLight.direction),ne(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,i,r){if(fr(this._mainLight.intensity,e.mainLight.intensity,i.mainLight.intensity,r),this._mainLight.environmentStrength=ft(e.mainLight.environmentStrength,i.mainLight.environmentStrength,r),this._mainLight.specularStrength=ft(e.mainLight.specularStrength,i.mainLight.specularStrength,r),ne(this._mainLight.direction,i.mainLight.direction),this._mainLight.castShadows=i.mainLight.castShadows,this.globalFactor=ft(e.globalFactor,i.globalFactor,r),this.noonFactor=ft(e.noonFactor,i.noonFactor,r),e.sh.r.length===i.sh.r.length)for(let s=0;s<i.sh.r.length;s++)this._sphericalHarmonics.r[s]=ft(e.sh.r[s],i.sh.r[s],r),this._sphericalHarmonics.g[s]=ft(e.sh.g[s],i.sh.g[s],r),this._sphericalHarmonics.b[s]=ft(e.sh.b[s],i.sh.b[s],r);else for(let s=0;s<i.sh.r.length;s++)this._sphericalHarmonics.r[s]=i.sh.r[s],this._sphericalHarmonics.g[s]=i.sh.g[s],this._sphericalHarmonics.b[s]=i.sh.b[s]}};const uF=$();function E6(t){t.constants.add("ambientBoostFactor","float",NDe)}function bA(t){t.uniforms.add(new Un("lightingGlobalFactor",e=>e.lighting.globalFactor))}function wA(t,e){const i=t.fragment;switch(t.include(T6,e),e.pbrMode!==Ct.Disabled&&t.include(toe,e),t.include(IDe,e),t.include(CL),i.code.add(E`
    const float GAMMA_SRGB = ${E.float(qU)};
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===Ct.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),E6(i),bA(i),cg(i),i.code.add(E`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?E`normalize(vPosWorld)`:E`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),Av(i),i.code.add(E`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case Ct.Disabled:case Ct.WaterOnIntegratedMesh:case Ct.Water:t.include(Mmt),i.code.add(E`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {
vec3 mainLighting = applyShading(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case Ct.Normal:case Ct.Schematic:i.code.add(E`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec4 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(E`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?i.uniforms.add(new DB("hasFillLights",r=>r.enableFillLights)):i.constants.add("hasFillLights","bool",!1),i.code.add(E`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
float NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
vec3 mainLightIrradianceComponent = NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.uniforms.add(new Un("lightingSpecularStrength",r=>r.lighting.mainLight.specularStrength),new Un("lightingEnvironmentStrength",r=>r.lighting.mainLight.environmentStrength)).code.add(E`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
float NdotH = clamp(dot(normal, h), 0.0, 1.0);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
float normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));
inputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),i.code.add(E`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = _emission.rgb == vec3(0.0) ? _emission.rgb : pow(_emission.rgb, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode!==Ct.Schematic||e.hasColorTexture?E`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`:E`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case Ct.Simplified:case Ct.TerrainWithWater:cg(i),Av(i),i.code.add(E`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluatePBRSimplifiedLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case Ct.COUNT:}}let Vmt=class extends lr{constructor(e,i,r){super(e,"mat4",Lt.Draw,(s,n,o,a)=>s.setUniformMatrix4fv(e,i(n,o,a)),r)}},jmt=class extends lr{constructor(e,i,r){super(e,"mat4",Lt.Pass,(s,n,o)=>s.setUniformMatrix4fv(e,i(n,o)),r)}},Gmt=class extends cr{constructor(){super(...arguments),this.modelTransformation=eo}},roe=class extends Gmt{constructor(){super(...arguments),this.origin=$()}};function $L(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new jmt("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),FDe(t))}function soe(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new Vmt("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),FDe(t))}function FDe(t){const e=t.fragment;e.include(_De),e.uniforms.add(new oo("shadowMap",i=>i.shadowMap.depthTexture),new Xne("numCascades",i=>i.shadowMap.numCascades),new Va("cascadeDistances",i=>i.shadowMap.cascadeDistances)).code.add(E`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {
float xScale = float(textureSize.y) / float(textureSize.x);
return vec2((float(i) + lvpos.x) * xScale, lvpos.y);
}
float readShadowMapDepth(ivec2 uv, sampler2D _depthTex) {
return rgba4ToFloat(texelFetch(_depthTex, uv, 0));
}
float posIsInShadow(ivec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, ivec2 texSize, sampler2D _depthTex) {
vec2 st = fract(uv * vec2(texSize) + vec2(0.5));
ivec2 base = ivec2(uv * vec2(texSize) - vec2(0.5));
float s00 = posIsInShadow(ivec2(base.x, base.y), lvpos, _depthTex);
float s10 = posIsInShadow(ivec2(base.x + 1, base.y), lvpos, _depthTex);
float s11 = posIsInShadow(ivec2(base.x + 1, base.y + 1), lvpos, _depthTex);
float s01 = posIsInShadow(ivec2(base.x, base.y + 1), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
ivec2 size = textureSize(shadowMap, 0);
vec2 uv = cascadeCoordinates(i, size, lvpos);
return filterShadow(uv, lvpos, size, shadowMap);
}`)}function AL(t,{occlusionPass:e,terrainDepthTest:i,cullAboveTerrain:r}){const s=t.vertex,n=t.fragment;if(!i)return s.code.add("void forwardViewPosDepth(vec3 pos) {}"),void n.code.add(`${e?"bool":"void"} discardByTerrainDepth() { ${Te(e,"return false;")}}`);t.varyings.add("viewPosDepth","float"),s.code.add(`void forwardViewPosDepth(vec3 pos) {
    viewPosDepth = pos.z;
  }`),n.include(Sg),n.uniforms.add(new oo("terrainDepthTexture",o=>{var a;return(a=o.terrainDepth)==null?void 0:a.attachment})).code.add(E`
    ${e?"bool":"void"} discardByTerrainDepth() {
      float depth = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0).r;
      float linearDepth = linearizeDepth(depth);
      ${e?"return viewPosDepth < linearDepth && depth < 1.0;":`if(viewPosDepth ${r?">":"<="} linearDepth) discard;`}
    }`)}function Hmt(t,e){e.hasColorTextureTransform?(t.varyings.add("colorUV","vec2"),t.vertex.uniforms.add(new Ud("colorTextureTransformMatrix",i=>i.colorTextureTransformMatrix??aT)).code.add(E`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(E`void forwardColorUV(){}`)}function qmt(t,e){e.hasNormalTextureTransform&&e.textureCoordinateType!==Ys.None?(t.varyings.add("normalUV","vec2"),t.vertex.uniforms.add(new Ud("normalTextureTransformMatrix",i=>i.normalTextureTransformMatrix??aT)).code.add(E`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(E`void forwardNormalUV(){}`)}function Wmt(t,e){e.hasEmissionTextureTransform&&e.textureCoordinateType!==Ys.None?(t.varyings.add("emissiveUV","vec2"),t.vertex.uniforms.add(new Ud("emissiveTextureTransformMatrix",i=>i.emissiveTextureTransformMatrix??aT)).code.add(E`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(E`void forwardEmissiveUV(){}`)}function Zmt(t,e){e.hasOcclusionTextureTransform&&e.textureCoordinateType!==Ys.None?(t.varyings.add("occlusionUV","vec2"),t.vertex.uniforms.add(new Ud("occlusionTextureTransformMatrix",i=>i.occlusionTextureTransformMatrix??aT)).code.add(E`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(E`void forwardOcclusionUV(){}`)}function Ymt(t,e){e.hasMetallicRoughnessTextureTransform&&e.textureCoordinateType!==Ys.None?(t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.uniforms.add(new Ud("metallicRoughnessTextureTransformMatrix",i=>i.metallicRoughnessTextureTransformMatrix??aT)).code.add(E`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(E`void forwardMetallicRoughnessUV(){}`)}function yM(t){t.code.add(E`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function noe(t){t.include(yM),t.code.add(E`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in macOS using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${E.int(kn.Multiply)}) {
        return allMixed;
      }
      if (mode == ${E.int(kn.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${E.int(kn.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in macOS using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${E.int(kn.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${E.int(kn.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function C6(t,e){t.include(EL,e),t.include(Cpt,e),t.fragment.include(yM);const i=e.output===Y.ObjectAndLayerIdColor,r=dne(e.output),s=ws(e.output)&&e.oitPass===Ti.ColorAlpha,n=ws(e.output)&&e.oitPass!==Ti.ColorAlpha,o=e.discardInvisibleFragments;let a=0;(n||r||s)&&t.outputs.add("fragColor","vec4",a++),r&&t.outputs.add("fragEmission","vec4",a++),s&&t.outputs.add("fragAlpha","float",a++),t.fragment.code.add(E`
    void outputColorHighlightOID(vec4 finalColor, const in vec3 vWorldPosition) {
      ${Te(i,"finalColor.a = 1.0;")}

      ${Te(o,`if (finalColor.a < ${E.float(Kr)}) { discard; }`)}

      finalColor = applySlice(finalColor, vWorldPosition);
      ${Te(s,E`fragColor = premultiplyAlpha(finalColor);
             fragAlpha = finalColor.a;`)}
      ${Te(n,"fragColor = finalColor;")}
      ${Te(r,"fragEmission = finalColor.a * getEmissions();")}
      calculateOcclusionAndOutputHighlight();
      ${Te(i,"outputObjectAndLayerIdColor();")}
    }
  `)}function kDe(t){const e=new Vi,{vertex:i,fragment:r,varyings:s}=e,{output:n,normalType:o,offsetBackfaces:a,instancedColor:l,spherical:c,receiveShadows:h,snowCover:d,pbrMode:f,textureAlphaPremultiplied:m,instancedDoublePrecision:g,hasVertexColors:v,hasVertexTangents:_,hasColorTexture:b,hasNormalTexture:w,hasNormalTextureTransform:x,hasColorTextureTransform:S}=t;if(Qy(i,t),e.include(g6),s.add("vpos","vec3"),e.include(iS,t),e.include(fDe,t),e.include(yDe,t),e.include(Hmt,t),!ws(n))return e.include(EDe,t),e;e.include(qmt,t),e.include(Wmt,t),e.include(Zmt,t),e.include(Ymt,t),Wb(i,t),e.include(mM,t),e.include(ub,t);const C=o===kr.Attribute||o===kr.Compressed;return C&&a&&e.include(oDe),e.include(CDe,t),e.include(y6,t),l&&e.attributes.add(z.INSTANCECOLOR,"vec4"),s.add("vPositionLocal","vec3"),e.include(Ky,t),e.include(v6,t),e.include(mDe,t),e.include(_6,t),i.uniforms.add(new pc("externalColor",T=>T.externalColor)),s.add("vcolorExt","vec4"),e.include(AL,t),i.main.add(E`
    forwardNormalizedVertexColor();
    vcolorExt = externalColor;
    ${Te(l,"vcolorExt *= instanceColor * 0.003921568627451;")}
    vcolorExt *= vvColor();
    vcolorExt *= getSymbolColor();
    forwardColorMixMode();

    vpos = getVertexInLocalOriginSpace();
    vPositionLocal = vpos - view[3].xyz;
    vpos = subtractOrigin(vpos);
    ${Te(C,"vNormalWorld = dpNormal(vvLocalNormal(normalModel()));")}
    vpos = addVerticalOffset(vpos, localOrigin);
    ${Te(_,"vTangent = dpTransformVertexTangent(tangent);")}
    gl_Position = transformPosition(proj, view, vpos);
    ${Te(C&&a,"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);")}

    forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
    forwardLinearDepth();
    forwardTextureCoordinates();
    forwardColorUV();
    forwardNormalUV();
    forwardEmissiveUV();
    forwardOcclusionUV();
    forwardMetallicRoughnessUV();

    if (vcolorExt.a < ${E.float(Kr)}) {
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
    }
  `),e.include(wA,t),e.include(T6,t),e.include(hC,t),e.include(g?$L:soe,t),e.fragment.include(cb,t),e.include(C6,t),Wb(r,t),r.uniforms.add(i.uniforms.get("localOrigin"),new $r("ambient",T=>T.ambient),new $r("diffuse",T=>T.diffuse),new mt("opacity",T=>T.opacity),new mt("layerOpacity",T=>T.layerOpacity)),b&&r.uniforms.add(new It("tex",T=>T.texture)),e.include(Pne,t),e.include(toe,t),r.include(noe),e.include($pt,t),E6(r),bA(r),Av(r),r.main.add(E`
    discardBySlice(vpos);
    discardByTerrainDepth();
    ${b?E`
            vec4 texColor = texture(tex, ${S?"colorUV":"vuv0"});
            ${Te(m,"texColor.rgb /= texColor.a;")}
            discardOrAdjustAlpha(texColor);`:E`vec4 texColor = vec4(1.0);`}
    shadingParams.viewDirection = normalize(vpos - cameraPosition);
    ${o===kr.ScreenDerivative?E`vec3 normal = screenDerivativeNormal(vPositionLocal);`:E`shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
    applyPBRFactors();
    float ssao = evaluateAmbientOcclusionInverse() * getBakedOcclusion();

    vec3 posWorld = vpos + localOrigin;

      float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
      float shadow = ${h?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), readShadowMap(vpos, linearDepth))":Te(c,"lightingGlobalFactor * (1.0 - additionalAmbientScale)","0.0")};

    vec3 matColor = max(ambient, diffuse);
    vec3 albedo = mixExternalColor(${Te(v,"vColor.rgb *")} matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
    float opacity_ = layerOpacity * mixExternalOpacity(${Te(v,"vColor.a * ")} opacity, texColor.a, vcolorExt.a, int(colorMixMode));
    ${w?`mat3 tangentSpace = computeTangentSpace(${_?"normal":"normal, vpos, vuv0"});
            vec3 shadingNormal = computeTextureNormal(tangentSpace, ${x?"normalUV":"vuv0"});`:"vec3 shadingNormal = normal;"}
    vec3 normalGround = ${c?"normalize(posWorld);":"vec3(0.0, 0.0, 1.0);"}

    ${Te(d,E`
          float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
          albedo = mix(albedo, vec3(1), snow);
          shadingNormal = mix(shadingNormal, normal, snow);
          ssao = mix(ssao, 1.0, snow);`)}

    vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

    ${f===Ct.Normal||f===Ct.Schematic?E`
            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
            ${Te(d,E`mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);`)}
            vec4 emission = ${d?"mix(getEmissions(), vec4(0.0), snow)":"getEmissions()"};
            vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:E`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
    vec4 finalColor = vec4(shadedColor, opacity_);
    outputColorHighlightOID(finalColor, vpos);
  `),e}const Jmt=Object.freeze(Object.defineProperty({__proto__:null,build:kDe},Symbol.toStringTag,{value:"Module"}));let Xmt=class extends rDe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=M3e,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=Al.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=cn,this.instancedDoublePrecision=!1,this.normalType=kr.Attribute,this.receiveShadows=!0,this.receiveAmbientOcclusion=!0,this.castShadows=!0,this.ambient=yf(.2,.2,.2),this.diffuse=yf(.8,.8,.8),this.externalColor=Yi(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=$(),this.hasSlicePlane=!1,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=mA.Less,this.textureAlphaMode=Fn.Blend,this.textureAlphaCutoff=Kr,this.textureAlphaPremultiplied=!1,this.renderOccluded=Cr.Occlude,this.isDecoration=!1}},vei=class extends sDe{constructor(){super(...arguments),this.origin=$(),this.slicePlaneLocalOrigin=this.origin}},zDe=class extends Hi{constructor(e,i,r=new Bi(Jmt,()=>G(()=>Promise.resolve().then(()=>G6t),void 0))){super(e,i,r),this.type="DefaultMaterialTechnique"}_makePipeline(e,i){const{oitPass:r,output:s,transparent:n,cullFace:o,customDepthTest:a,hasOccludees:l,enableOffset:c}=e,h=r===Ti.NONE,d=r===Ti.FrontFace;return wi({blending:ws(s)&&n?Fne(r):null,culling:Qmt(e)?F3e(o):null,depthTest:{func:zne(r,Kmt(a))},depthWrite:Z3e(e),drawBuffers:s===Y.Depth?{buffers:[Ga.NONE]}:d6(r,s),colorWrite:Di,stencilWrite:l?OB:null,stencilTest:l?i?GX:Gne:null,polygonOffset:h||d?null:aft(c)})}initializePipeline(e){return this._occludeePipelineState=this._makePipeline(e,!0),this._makePipeline(e,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};function Kmt(t){return t===mA.Lequal?Ui.LEQUAL:Ui.LESS}function Qmt(t){return t.cullFace!==Al.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}let egt=class{constructor(e){this._bits=[...e]}equals(e){return eg(this._bits,e.bits)}get code(){return this._code??(this._code=String.fromCharCode(...this._bits)),this._code}get bits(){return this._bits}},hu=class extends cr{constructor(){var e;super(),this._parameterBits=((e=this._parameterBits)==null?void 0:e.map(()=>0))??[],this._parameterNames??(this._parameterNames=[])}get key(){return this._key??(this._key=new egt(this._parameterBits)),this._key}decode(e=this.key){const i=this._parameterBits;this._parameterBits=[...e.bits];const r=this._parameterNames.map(s=>`    ${s}: ${this[s]}`).join(`
`);return this._parameterBits=i,r}};function ie(t={}){return(e,i)=>{var c,h;e.hasOwnProperty("_parameterNames")||Object.defineProperty(e,"_parameterNames",{value:((c=e._parameterNames)==null?void 0:c.slice())??[],configurable:!0,writable:!0}),e.hasOwnProperty("_parameterBits")||Object.defineProperty(e,"_parameterBits",{value:((h=e._parameterBits)==null?void 0:h.slice())??[0],configurable:!0,writable:!0}),e._parameterNames.push(i);const r=t.count||2,s=Math.ceil(Math.log2(r)),n=e._parameterBits;let o=0;for(;n[o]+s>16;)o++,o>=n.length&&n.push(0);const a=n[o],l=(1<<s)-1<<a;n[o]+=s,t.count?Object.defineProperty(e,i,{get(){return(this._parameterBits[o]&l)>>a},set(d){if(this[i]!==d){if(this._key=null,this._parameterBits[o]=this._parameterBits[o]&~l|+d<<a&l,typeof d!="number")throw new U(`Configuration value for ${i} must be a number, got ${typeof d}`);if(t.count==null)throw new U(`Configuration value for ${i} must provide a count option`)}}}):Object.defineProperty(e,i,{get(){return!!((this._parameterBits[o]&l)>>a)},set(d){if(this[i]!==d&&(this._key=null,this._parameterBits[o]=this._parameterBits[o]&~l|+d<<a&l,typeof d!="boolean"))throw new U(`Configuration value for ${i} must be boolean, got ${typeof d}`)}})}}let KX=class extends hu{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}};u([ie()],KX.prototype,"instancedDoublePrecision",void 0),u([ie()],KX.prototype,"hasModelTransformation",void 0);let Zm=class extends KX{constructor(){super(...arguments),this.output=Y.Color,this.oitPass=Ti.NONE,this.hasSlicePlane=!1,this.bindType=Lt.Pass,this.writeDepth=!0}};u([ie({count:Y.COUNT})],Zm.prototype,"output",void 0),u([ie({count:Ti.COUNT})],Zm.prototype,"oitPass",void 0),u([ie()],Zm.prototype,"hasSlicePlane",void 0);let Ki=class extends Zm{constructor(e,i){super(),this.spherical=e,this.doublePrecisionRequiresObfuscation=i,this.alphaDiscardMode=Fn.Opaque,this.doubleSidedMode=io.None,this.pbrMode=Ct.Disabled,this.cullFace=Al.None,this.normalType=kr.Attribute,this.customDepthTest=mA.Less,this.emissionSource=Ko.None,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1,this.occlusionPass=!1,this.hasVvInstancing=!0,this.useCustomDTRExponentForWater=!1,this.useFillLights=!0}get textureCoordinateType(){return this.hasColorTexture||this.hasMetallicRoughnessTexture||this.emissionSource===Ko.Texture||this.hasOcclusionTexture||this.hasNormalTexture?Ys.Default:Ys.None}get objectAndLayerIdColorInstanced(){return this.instanced}get discardInvisibleFragments(){return this.transparent}};u([ie({count:Fn.COUNT})],Ki.prototype,"alphaDiscardMode",void 0),u([ie({count:io.COUNT})],Ki.prototype,"doubleSidedMode",void 0),u([ie({count:Ct.COUNT})],Ki.prototype,"pbrMode",void 0),u([ie({count:Al.COUNT})],Ki.prototype,"cullFace",void 0),u([ie({count:kr.COUNT})],Ki.prototype,"normalType",void 0),u([ie({count:mA.COUNT})],Ki.prototype,"customDepthTest",void 0),u([ie({count:Ko.COUNT})],Ki.prototype,"emissionSource",void 0),u([ie()],Ki.prototype,"hasVertexColors",void 0),u([ie()],Ki.prototype,"hasSymbolColors",void 0),u([ie()],Ki.prototype,"hasVerticalOffset",void 0),u([ie()],Ki.prototype,"hasColorTexture",void 0),u([ie()],Ki.prototype,"hasMetallicRoughnessTexture",void 0),u([ie()],Ki.prototype,"hasOcclusionTexture",void 0),u([ie()],Ki.prototype,"hasNormalTexture",void 0),u([ie()],Ki.prototype,"hasScreenSizePerspective",void 0),u([ie()],Ki.prototype,"hasVertexTangents",void 0),u([ie()],Ki.prototype,"hasOccludees",void 0),u([ie()],Ki.prototype,"hasModelTransformation",void 0),u([ie()],Ki.prototype,"offsetBackfaces",void 0),u([ie()],Ki.prototype,"vvSize",void 0),u([ie()],Ki.prototype,"vvColor",void 0),u([ie()],Ki.prototype,"receiveShadows",void 0),u([ie()],Ki.prototype,"receiveAmbientOcclusion",void 0),u([ie()],Ki.prototype,"textureAlphaPremultiplied",void 0),u([ie()],Ki.prototype,"instanced",void 0),u([ie()],Ki.prototype,"instancedColor",void 0),u([ie()],Ki.prototype,"writeDepth",void 0),u([ie()],Ki.prototype,"transparent",void 0),u([ie()],Ki.prototype,"enableOffset",void 0),u([ie()],Ki.prototype,"terrainDepthTest",void 0),u([ie()],Ki.prototype,"cullAboveTerrain",void 0),u([ie()],Ki.prototype,"snowCover",void 0),u([ie()],Ki.prototype,"hasColorTextureTransform",void 0),u([ie()],Ki.prototype,"hasEmissionTextureTransform",void 0),u([ie()],Ki.prototype,"hasNormalTextureTransform",void 0),u([ie()],Ki.prototype,"hasOcclusionTextureTransform",void 0),u([ie()],Ki.prototype,"hasMetallicRoughnessTextureTransform",void 0);function UDe(t){const e=new Vi,{vertex:i,fragment:r,varyings:s}=e,{output:n,offsetBackfaces:o,instancedColor:a,pbrMode:l,snowCover:c,spherical:h}=t,d=l===Ct.Normal||l===Ct.Schematic;if(Qy(i,t),e.include(g6),s.add("vpos","vec3"),e.include(iS,t),e.include(fDe,t),e.include(yDe,t),e.include(AL,t),ws(n)&&(Wb(e.vertex,t),e.include(mM,t),e.include(ub,t),o&&e.include(oDe),a&&e.attributes.add(z.INSTANCECOLOR,"vec4"),s.add("vNormalWorld","vec3"),s.add("localvpos","vec3"),e.include(Ky,t),e.include(v6,t),e.include(mDe,t),e.include(_6,t),i.uniforms.add(new pc("externalColor",f=>f.externalColor)),s.add("vcolorExt","vec4"),i.main.add(E`
      forwardNormalizedVertexColor();
      vcolorExt = externalColor;
      ${Te(a,"vcolorExt *= instanceColor * 0.003921568627451;")}
      vcolorExt *= vvColor();
      vcolorExt *= getSymbolColor();
      forwardColorMixMode();

      bool alphaCut = vcolorExt.a < ${E.float(Kr)};
      vpos = getVertexInLocalOriginSpace();
      localvpos = vpos - view[3].xyz;
      vpos = subtractOrigin(vpos);
      vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
      vpos = addVerticalOffset(vpos, localOrigin);
      vec4 basePosition = transformPosition(proj, view, vpos);

      forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
      forwardLinearDepth();
      forwardTextureCoordinates();

      gl_Position = alphaCut ? vec4(1e38, 1e38, 1e38, 1.0) :
      ${Te(o,"offsetBackfacingClipPosition(basePosition, vpos, vNormalWorld, cameraPosition);","basePosition;")}
    `)),ws(n)){const{hasColorTexture:f,hasColorTextureTransform:m,receiveShadows:g}=t;e.include(wA,t),e.include(T6,t),e.include(hC,t),e.include(t.instancedDoublePrecision?$L:soe,t),e.fragment.include(cb,t),e.include(C6,t),Wb(e.fragment,t),cg(r),E6(r),bA(r),r.uniforms.add(i.uniforms.get("localOrigin"),i.uniforms.get("view"),new $r("ambient",v=>v.ambient),new $r("diffuse",v=>v.diffuse),new mt("opacity",v=>v.opacity),new mt("layerOpacity",v=>v.layerOpacity)),f&&r.uniforms.add(new It("tex",v=>v.texture)),e.include(Pne,t),e.include(toe,t),r.include(noe),Av(r),r.main.add(E`
      discardBySlice(vpos);
      discardByTerrainDepth();
      vec4 texColor = ${f?`texture(tex, ${m?"colorUV":"vuv0"})`:" vec4(1.0)"};
      ${Te(f,`${Te(t.textureAlphaPremultiplied,"texColor.rgb /= texColor.a;")}
        discardOrAdjustAlpha(texColor);`)}
      vec3 viewDirection = normalize(vpos - cameraPosition);
      applyPBRFactors();
      float ssao = evaluateAmbientOcclusionInverse();
      ssao *= getBakedOcclusion();

      float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
      vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
      float shadow = ${g?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), readShadowMap(vpos, linearDepth))":h?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};
      vec3 matColor = max(ambient, diffuse);
      ${t.hasVertexColors?E`vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
             float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:E`vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
             float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
      ${Te(c,"albedo = mix(albedo, vec3(1), 0.9);")}
      ${E`vec3 shadingNormal = normalize(vNormalWorld);
             albedo *= 1.2;
             vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
             float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
             float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
             float treeRadialFalloff = vColor.r;
             float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
             additionalLight += backLightFactor * mainLightIntensity;`}
      ${Te(d,`vec3 normalGround = ${h?"normalize(vpos + localOrigin)":"vec3(0.0, 0.0, 1.0)"};`)}
      ${d?E`float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                 ${Te(c,E`mrr = vec3(0.0, 1.0, 0.04);`)}
            vec4 emission = ${c?"vec4(0.0)":"getEmissions()"};
            vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:E`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
      vec4 finalColor = vec4(shadedColor, opacity_);
      outputColorHighlightOID(finalColor, vpos);`)}return e.include(EDe,t),e}const tgt=Object.freeze(Object.defineProperty({__proto__:null,build:UDe},Symbol.toStringTag,{value:"Module"}));let igt=class extends zDe{constructor(e,i){super(e,i,new Bi(tgt,()=>G(()=>Promise.resolve().then(()=>H6t),void 0))),this.type="RealisticTreeTechnique"}},NB=class extends h6{constructor(e,i){super(e,sgt),this.materialType="default",this.supportsEdges=!0,this.produces=new Map([[xe.OPAQUE_MATERIAL,r=>($fe(r)||aq(r))&&!this.parameters.transparent],[xe.TRANSPARENT_MATERIAL,r=>($fe(r)||aq(r))&&this.parameters.transparent&&this.parameters.writeDepth],[xe.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,r=>(tpt(r)||aq(r))&&this.parameters.transparent&&!this.parameters.writeDepth]]),this._vertexBufferLayout=ogt(this.parameters),this._configuration=new Ki(i.spherical,i.doublePrecisionRequiresObfuscation)}isVisibleForOutput(e){return e!==Y.Shadow&&e!==Y.ShadowExcludeHighlight&&e!==Y.ShadowHighlight||this.parameters.castShadows}get visible(){const e=this.parameters;if(e.layerOpacity<Kr)return!1;const{hasInstancedColor:i,hasVertexColors:r,hasSymbolColors:s,vvColor:n}=e,o=i||n||s,a=e.colorMixMode==="replace",l=e.opacity>=Kr;if(r&&o)return a||l;const c=e.externalColor&&e.externalColor[3]>=Kr;return r?a?c:l:o?a||l:a?c:l}get hasEmissions(){return!!this.parameters.emissiveTextureId||!to(this.parameters.emissiveFactor,cn)}getConfiguration(e,i){const r=this.parameters,{treeRendering:s,doubleSided:n,doubleSidedType:o}=r;return this._configuration.output=e,this._configuration.hasNormalTexture=!s&&!!r.normalTextureId,this._configuration.hasColorTexture=!!r.textureId,this._configuration.hasVertexTangents=!s&&r.hasVertexTangents,this._configuration.instanced=r.isInstanced,this._configuration.instancedDoublePrecision=r.instancedDoublePrecision,this._configuration.vvSize=!!r.vvSize,this._configuration.hasVerticalOffset=r.verticalOffset!=null,this._configuration.hasScreenSizePerspective=r.screenSizePerspective!=null,this._configuration.hasSlicePlane=r.hasSlicePlane,this._configuration.alphaDiscardMode=r.textureAlphaMode,this._configuration.normalType=s?kr.Attribute:r.normalType,this._configuration.transparent=r.transparent,this._configuration.writeDepth=r.writeDepth,r.customDepthTest!=null&&(this._configuration.customDepthTest=r.customDepthTest),this._configuration.hasOccludees=i.hasOccludees,this._configuration.cullFace=r.hasSlicePlane?Al.None:r.cullFace,this._configuration.cullAboveTerrain=i.cullAboveTerrain,this._configuration.hasModelTransformation=!s&&r.modelTransformation!=null,this._configuration.hasVertexColors=r.hasVertexColors,this._configuration.hasSymbolColors=r.hasSymbolColors,this._configuration.doubleSidedMode=s?io.WindingOrder:n&&o==="normal"?io.View:n&&o==="winding-order"?io.WindingOrder:io.None,this._configuration.instancedColor=r.hasInstancedColor,ws(e)?(this._configuration.terrainDepthTest=i.terrainDepthTest,this._configuration.receiveShadows=r.receiveShadows,this._configuration.receiveAmbientOcclusion=r.receiveAmbientOcclusion&&i.ssao!=null):(this._configuration.terrainDepthTest=!1,this._configuration.receiveShadows=this._configuration.receiveAmbientOcclusion=!1),this._configuration.vvColor=!!r.vvColor,this._configuration.textureAlphaPremultiplied=!!r.textureAlphaPremultiplied,this._configuration.pbrMode=r.usePBR?r.isSchematic?Ct.Schematic:Ct.Normal:Ct.Disabled,this._configuration.hasMetallicRoughnessTexture=!s&&!!r.metallicRoughnessTextureId,this._configuration.emissionSource=s?Ko.None:r.emissiveTextureId!=null?Ko.Texture:r.usePBR?Ko.Value:Ko.None,this._configuration.hasOcclusionTexture=!s&&!!r.occlusionTextureId,this._configuration.offsetBackfaces=!(!r.transparent||!r.offsetTransparentBackfaces),this._configuration.oitPass=i.oitPass,this._configuration.enableOffset=i.camera.relativeElevation<oft,this._configuration.snowCover=ngt(i),this._configuration.hasColorTextureTransform=!!r.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!r.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!r.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!r.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!r.metallicRoughnessTextureTransformMatrix,this._configuration}intersect(e,i,r,s,n,o){if(this.parameters.verticalOffset!=null){const a=r.camera;se(yq,i[12],i[13],i[14]);let l=null;switch(r.viewingMode){case je.Global:l=ae(eme,yq);break;case je.Local:l=ne(eme,cgt)}let c=0;const h=be(ugt,yq,a.eye),d=Ee(h),f=re(h,h,1/d);let m=null;this.parameters.screenSizePerspective&&(m=fe(l,f)),c+=N3e(a,d,this.parameters.verticalOffset,m??0,this.parameters.screenSizePerspective),re(l,l,c),uc(gq,l,r.transform.inverseRotation),s=be(agt,s,gq),n=be(lgt,n,gq)}lft(e,r,s,n,oX(r.verticalOffset),o)}createGLMaterial(e){return new rgt(e)}createBufferWriter(){return new $ft(this._vertexBufferLayout)}},rgt=class extends $3e{constructor(e){super({...e,...e.material.parameters})}beginSlot(e){this._material.setParameters({receiveShadows:e.shadowMap.enabled});const i=this._material.parameters;this.updateTexture(i.textureId);const r=e.camera.viewInverseTransposeMatrix;return se(i.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.getTechnique(i.treeRendering?igt:zDe,e)}},sgt=class extends Xmt{constructor(){super(...arguments),this.treeRendering=!1,this.hasVertexTangents=!1}};function ngt(t){return t.weather!=null&&t.weatherVisible&&t.weather.type==="snowy"&&t.weather.snowCover==="enabled"}function ogt(t){const e=Bd().vec3f(z.POSITION);return t.normalType===kr.Compressed?e.vec2i16(z.NORMALCOMPRESSED,{glNormalized:!0}):e.vec3f(z.NORMAL),t.hasVertexTangents&&e.vec4f(z.TANGENT),(t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId)&&e.vec2f(z.UV0),t.hasVertexColors&&e.vec4u8(z.COLOR),t.hasSymbolColors&&e.vec4u8(z.SYMBOLCOLOR),Dd()&&e.vec4u8(z.OBJECTANDLAYERIDCOLOR),e}const agt=$(),lgt=$(),cgt=De(0,0,1),eme=$(),gq=$(),yq=$(),ugt=$(),BDe=new cne({});function Oei(t){return t.type==="web-style"?BDe:ooe(t.symbolLayers.toArray().map(e=>VDe(t,e)))}function ooe(t){let e=0,i=0,r=0,s=!1,n=0;const o=new n3e;for(const a of t)a!=null&&(e+=a.verticesPerFeature,i+=a.verticesPerCoordinate,r+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,s=s||a.estimated,++n);return s?new Hdt(n,{verticesPerFeature:e,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:o}):new Gdt(n,{verticesPerFeature:e,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:o})}function Iei(t){const e=ooe(t);return e.numComplexities>0&&(e.verticesPerFeature/=e.numComplexities,e.verticesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities),e}const vq={};function VDe(t,e){var s,n;const i=hgt(t,e),r=hpt(e)?2:0;switch(e.type){case"extrude":return new kp({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:r,memory:i});case"fill":if(t.type==="mesh-3d")return new kp({drawCallsPerFeature:r,memory:i});if(e.outline!=null&&e.outline.size>0)return new kp({verticesPerFeature:-12,verticesPerCoordinate:9,memory:i});case"water":return new kp({verticesPerFeature:-6,verticesPerCoordinate:3,memory:i});case"line":return new kp({verticesPerFeature:-6,verticesPerCoordinate:6,memory:i});case"object":return(s=e.resource)!=null&&s.href?new cne({verticesPerFeature:100,memory:i}):{...dgt(((n=e.resource)==null?void 0:n.primitive)??XKe),memory:i};case"path":{let o=0,a=0;switch(e.profile){case"circle":o=qut;break;case"quad":o=4;break;default:return void(e.profile,void 0)}switch(e.join){case"round":a=Gut;break;case"miter":case"bevel":a=1;break;default:return}const l=2*o,c=o*a*2,h=c+l;let d=-2*c-l;switch(e.cap){case"none":break;case"butt":case"square":d+=2*(o-1);break;case"round":d+=2*(o*(Hut-1)*2+o);break;default:return}return new kp({verticesPerFeature:d,verticesPerCoordinate:h,memory:i})}case"text":case"icon":return new kp({verticesPerFeature:6,memory:i});default:return}}function hgt(t,e){const i=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?Dl.EXTRUDE_EDGES:Dl.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?Dl.FILL_OUTLINE:Dl.FILL;case"water":return Dl.FILL;case"line":return e.join==="round"?Dl.LINE_ROUND:Dl.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return Dl.PATH_ROUND_CIRCLE;case"quad":return Dl.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return Dl.PATH_MITER_CIRCLE;case"quad":return Dl.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return i?Dl.OBJECT_POINT:Dl.OBJECT_POLYGON;case"icon":case"text":return i?Dl.ICON_POINT:Dl.ICON_POLYGON;default:return}}function dgt(t){const e=vq[t];if(e)return e;const i=pgt(jdt(t,new NB({},{spherical:!0,doublePrecisionRequiresObfuscation:!0})).levels);return vq[t]=new kp({verticesPerFeature:i}),vq[t]}function pgt(t){return t.reduce((e,i,r)=>e+i.numVertices*(1/10**r),0)/t.reduce((e,i,r)=>e+1/10**r,0)}const Dl={ICON_POINT:{bytesPerFeature:2346.460896195398,bytesPerFeatureLabel:3484.7516349999996,resourceBytes:0,draped:{bytesPerFeature:2007.3528529826217,bytesPerFeatureLabel:3522.702025}},ICON_POLYGON:{bytesPerFeature:3677.214053765355,bytesPerFeatureLabel:3502.5355950000003,resourceBytes:0,draped:{bytesPerFeature:3030.3700096053935,bytesPerFeatureLabel:3550.247175}},OBJECT_POINT:{bytesPerFeature:569.2092700798497,bytesPerFeatureLabel:3183.0256999999992,resourceBytes:0,draped:{bytesPerFeature:569.2092700798497,bytesPerFeatureLabel:3183.0256999999992}},OBJECT_POLYGON:{bytesPerFeature:1252.202280530861,bytesPerFeatureLabel:3125.853350000001,resourceBytes:0,draped:{bytesPerFeature:1252.202280530861,bytesPerFeatureLabel:3125.853350000001}},LINE_MITER:{bytesPerFeature:3252.89170349711,bytesPerFeatureLabel:3554.3931949999997,resourceBytes:0,draped:{bytesPerFeature:2843.5793737736867,bytesPerFeatureLabel:3538.2547083333334}},LINE_ROUND:{bytesPerFeature:3384.080501909172,bytesPerFeatureLabel:3522.6055950000004,resourceBytes:0,draped:{bytesPerFeature:2833.1897218657587,bytesPerFeatureLabel:3532.0680950000005}},PATH_MITER_CIRCLE:{bytesPerFeature:38490.63544346431,bytesPerFeatureLabel:3660.7835999999998,resourceBytes:0,draped:{bytesPerFeature:38490.63544346431,bytesPerFeatureLabel:3660.7835999999998}},PATH_ROUND_CIRCLE:{bytesPerFeature:42934.88589895749,bytesPerFeatureLabel:3729.49955,resourceBytes:0,draped:{bytesPerFeature:42934.88589895749,bytesPerFeatureLabel:3729.49955}},PATH_MITER_QUAD:{bytesPerFeature:25392.923576583788,bytesPerFeatureLabel:3647.05925,resourceBytes:0,draped:{bytesPerFeature:25392.923576583788,bytesPerFeatureLabel:3647.05925}},PATH_ROUND_QUAD:{bytesPerFeature:40448.297252606244,bytesPerFeatureLabel:3646.8303499999997,resourceBytes:0,draped:{bytesPerFeature:40448.297252606244,bytesPerFeatureLabel:3646.8303499999997}},FILL:{bytesPerFeature:3419.9079008788176,bytesPerFeatureLabel:3564.2132483333335,resourceBytes:0,draped:{bytesPerFeature:2910.096178654882,bytesPerFeatureLabel:3554.8655816666665}},FILL_OUTLINE:{bytesPerFeature:5018.088812445781,bytesPerFeatureLabel:3524.8219616666665,resourceBytes:0,draped:{bytesPerFeature:4278.49006198517,bytesPerFeatureLabel:3532.068368333334}},EXTRUDE:{bytesPerFeature:7963.8889768932695,bytesPerFeatureLabel:3628.5106350000005,resourceBytes:0,draped:{bytesPerFeature:7963.8889768932695,bytesPerFeatureLabel:3628.5106350000005}},EXTRUDE_EDGES:{bytesPerFeature:3111.7648563053044,bytesPerFeatureLabel:2658.4350683333337,resourceBytes:0,draped:{bytesPerFeature:3111.7648563053044,bytesPerFeatureLabel:2658.4350683333337}}};var lv,j_;(function(t){t[t.RecreateSymbol=0]="RecreateSymbol",t[t.RecreateGraphics=1]="RecreateGraphics",t[t.FastUpdate=2]="FastUpdate"})(lv||(lv={})),function(t){t[t.Slow=0]="Slow",t[t.Fast=1]="Fast",t[t.Mixed=2]="Mixed",t[t.Loading=3]="Loading",t[t.Undefined=4]="Undefined"}(j_||(j_={}));let aoe=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=Kh.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,i){return this._loadStatus===Kh.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===Kh.FAILED?(i&&i(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=Kh.LOADED},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=Kh.FAILED,!es(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(e,i).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=fc(this._abortController):this._loadStatus===Kh.LOADING&&(this._loadStatus=Kh.FAILED),this._loader=null}};var Kh;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(Kh||(Kh={}));const S0=()=>J.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let jDe=class extends aoe{constructor(e,i,r,s){super(r.schedule),this.symbol=e,this.symbolLayer=i,this._context=r,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1,rotation:!1},this._materials=[],this.logger=S0(),this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new xB,this.complexity=this.computeComplexity(),this.ignoreDrivers=s.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=tme(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}get usedMemory(){const e=this.complexity;return e==null?0:(this.draped?e.memory.draped:e.memory).bytesPerFeature}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const i=this._drivenProperties,r=tme(e);return r.color!==i.color||r.opacity!==i.opacity||r.opacityAlwaysOpaque!==i.opacityAlwaysOpaque||r.size!==i.size||r.rotation!==i.rotation}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,i,r,s){const n=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=`${s} geometry failed to be created`;n?!this._logGeometryValidationWarnings(i,r,s)&&o&&o.length===0&&r==="rings"&&i.length>0&&i[0].length>2&&S0().warnOncePerTick(`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):S0().warnOncePerTick(`${a} (failed to project geometry to view spatial reference)`)}updateFocus(e,i){}_logGeometryValidationWarnings(e,i,r){const s=`${r} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(S0().warnOncePerTick(`${s} (no ${i} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(S0().warnOncePerTick(`${s} (${i} should be defined as a 2D array)`),!0)}_validateGeometry(e,i=null,r=null){if(i!=null&&!i.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${e.type}`),!1;switch(e.type){case"point":{const s=e;if(!isFinite(s.x)||!isFinite(s.y))return S0().warn("point coordinate is not a valid number, graphic skipped"),!1;break}case"polygon":vEe(e)&&S0().warnOnce("Fixed a non-closed polygon ring.")}return!0}_defaultElevationInfoNoZ(){return fgt}_defaultElevationInfoZ(){return mgt}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,i=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||i.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,i=new xB){const r=e.geometry,s=this.getDefaultElevationInfo(r);i.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,i.mode=this.getGeometryElevationMode(r,s),i.offsetMeters=this._elevationContext.meterUnitOffset??s.offset??0;const n=!this._elevationOptions.supportsOnTheGround&&i.mode==="on-the-ground";n&&(i.mode="relative-to-ground",i.offsetMeters=0);const o=n?out:this._elevationContext.featureExpressionInfoContext;return i.updateFeatureExpressionInfoContext(o,e,this._context.layer),i}prepareSymbolLayerPatch(e){}updateGeometry(e,i){return!1}updateTransform(e,i,r,s){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,i=ime){const r=this.draped?1:this._getLayerOpacity();return this._drivenProperties.opacity?r:e?r*e.a:i.hasIntrinsicColor?r:0}_getCombinedOpacityAndColor(e,i=ime){const r=this._getCombinedOpacity(e,i);if(this._drivenProperties.color)return eq(null,r);const s=e!=null?Je.toUnitRGB(e):ore;return eq(s,r)}_getVertexOpacityAndColor(e,i=null){const r=this._drivenProperties.color?e.color:null,s=this._drivenProperties.opacity?e.opacity:null,n=eq(r,s);return i&&(n[0]*=i,n[1]*=i,n[2]*=i,n[3]*=i),n}isFastUpdatesEnabled(){return this._fastUpdates!=null}computeComplexity(){return VDe(this.symbol,this.symbolLayer)}globalPropertyChanged(e,i,r){switch(e){case"opacity":return this.layerOpacityChanged(i,r),!0;case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(i,r,s)!==qm.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(i,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,i,r){let s=qm.UPDATE;return e.forEach(n=>{const o=i(n);if(o!=null){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=r(o.elevationContext.mode)}else s=qm.RECREATE}),s}applyRendererDiff(e,i){return lv.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const i=this._fastUpdates.visualVariables,r=i.size?hq(i.size.field,e):0,s=i.color?hq(i.color.field,e):0,n=i.opacity?hq(i.opacity.field,e):0;return Yi(r,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&S0().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>{var i,r,s,n,o,a,l,c;return{size:((r=(i=this._fastUpdates)==null?void 0:i.visualVariables.size)==null?void 0:r.field)??null,color:((n=(s=this._fastUpdates)==null?void 0:s.visualVariables.color)==null?void 0:n.field)??null,opacity:((a=(o=this._fastUpdates)==null?void 0:o.visualVariables.opacity)==null?void 0:a.field)??null,rotation:((c=(l=this._fastUpdates)==null?void 0:l.visualVariables.rotation)==null?void 0:c.field)??null}};return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function tme(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1,rotation:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(i=>{switch(i.type){case"color":if(e.color=!0,i.stops)for(let r=0;r<i.stops.length;r++){const s=i.stops[r].color;s&&(e.opacity=!0,s.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0;break;case"rotation":e.rotation=!0}}),e}const fgt={mode:"on-the-ground",offset:0,unit:"meters"},mgt={mode:"absolute-height",offset:0,unit:"meters"},ime={hasIntrinsicColor:!1};function GDe(t,e,i){const r=ggt(rme,t,e,i)?rme:[0,0,1];return Math.abs(r[2])>Math.cos(At(80))?rs.Z:Math.abs(r[1])>Math.abs(r[0])?rs.Y:rs.X}function ggt(t,e,i,r){const s=(o=>!Array.isArray(o[0]))(e)?(o,a)=>e[3*o+a]:(o,a)=>e[o][a],n=r?Mo(r)/gS(r):1;return Nse(t,(o,a)=>se(o,s(a,0)*n,s(a,1)*n,s(a,2)),i)}const rme=Gr();function Dei(t,e,i){const r=(e.length>0?e[0]:t.length/3)-1,s=GDe(t,r,i);if(s!==rs.Z){t=t.slice();for(let n=0;n<t.length;n+=3)t[n+s]=t[n+2]}return pA(t,e,3)}function Lei(t){const e=[[z.POSITION,new Qt(t.attributeData.position,t.indices,3,!0)]],i=_L(t.indices.length);return t.attributeData.colorFeature!=null?e.push([z.COLORFEATUREATTRIBUTE,new Qt([t.attributeData.colorFeature],i,1,!0)]):t.attributeData.color&&e.push([z.COLOR,new Qt(t.attributeData.color,i,4,!0)]),t.attributeData.uvMapSpace&&e.push([z.UVMAPSPACE,new Qt(t.attributeData.uvMapSpace,t.indices,4,!0)]),t.attributeData.boundingRect&&e.push([z.BOUNDINGRECT,new Qt(t.attributeData.boundingRect,t.indices,9,!0)]),new $a(t.material,e,t.mapPositions,zn.Mesh,t.attributeData.objectAndLayerIdColor)}function Nei(t,e=null){const i=[[z.POSITION,new Qt(t.attributeData.position,t.indices,3,!0)],[z.UV0,new Qt(t.attributeData.uv0,t.indices,2,!0)]];return new $a(t.material,i,t.mapPositions,zn.Mesh,e)}function ygt(t){switch(t.type){case"extent":if(t instanceof _i)return Ea.fromExtent(t);break;case"polygon":return t}return null}let Fei=class{constructor(e,i,r){this.renderData=e,this.layerUid=i,this.graphicUid=r,this.outGeometries=new Array}};function sme(t,e,i){const r=Array.isArray(t),s=r?t.length/e:t.byteLength/(4*e),n=r?t:new Uint32Array(t,0,s*e),o=(i==null?void 0:i.minReduction)??0,a=(i==null?void 0:i.originalIndices)||null,l=a?a.length:0,c=(i==null?void 0:i.componentOffsets)||null;let h=0;if(c)for(let T=0;T<c.length-1;T++){const M=c[T+1]-c[T];M>h&&(h=M)}else h=s;const d=Math.floor(1.1*h)+1;(Lf==null||Lf.length<2*d)&&(Lf=new Uint32Array(nTe(2*d)));for(let T=0;T<2*d;T++)Lf[T]=0;let f=0;const m=!!c&&!!a,g=m?l:s;let v=z3(s);const _=new Uint32Array(l),b=1.96;let w=o!==0?Math.ceil(4*b*b/(o*o)*o*(1-o)):g,x=1,S=c?c[1]:g;for(let T=0;T<g;T++){if(T===w){const L=1-f/T;if(L+b*Math.sqrt(L*(1-L)/T)<o)return null;w*=2}if(T===S){for(let L=0;L<2*d;L++)Lf[L]=0;if(a)for(let L=c[x-1];L<c[x];L++)_[L]=v[a[L]];S=c[++x]}const M=m?a[T]:T,I=M*e,D=bgt(n,I,e);let P=D%d,F=f;for(;Lf[2*P+1]!==0;){if(Lf[2*P]===D){const L=Lf[2*P+1]-1;if(vgt(n,I,L*e,e)){F=v[L];break}}P++,P>=d&&(P-=d)}F===f&&(Lf[2*P]=D,Lf[2*P+1]=M+1,f++),v[M]=F}if(o!==0&&1-f/s<o)return null;if(m){for(let T=c[x-1];T<_.length;T++)_[T]=v[a[T]];v=MS(_)}const C=r?new Array(f):new Uint32Array(f*e);f=0;for(let T=0;T<g;T++)v[T]===f&&(_gt(n,(m?a[T]:T)*e,C,f*e,e),f++);if(a&&!m){const T=new Uint32Array(l);for(let M=0;M<T.length;M++)T[M]=v[a[M]];v=MS(T)}return{buffer:Array.isArray(C)?C:C.buffer,indices:v,uniqueCount:f}}function vgt(t,e,i,r){for(let s=0;s<r;s++)if(t[e+s]!==t[i+s])return!1;return!0}function _gt(t,e,i,r,s){for(let n=0;n<s;n++)i[r+n]=t[e+n]}function bgt(t,e,i){let r=0;for(let s=0;s<i;s++)r=t[e+s]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let Lf=null;function zei(t){const e=loe(t.rings,t.hasZ,xA.CCW_IS_HOLE,t.spatialReference),i=new Array;let r=0,s=0;for(const a of e.polygons){const l=a.count,c=a.index,h=Kx(e.position,3*c,3*l),d=a.holeIndices.map(m=>m-c),f=MS(pA(h,d,3));i.push({position:h,faces:f}),r+=h.length,s+=f.length}const n=wgt(i,r,s),o=Array.isArray(n.position)?sme(n.position,3,{originalIndices:n.faces}):sme(n.position.buffer,6,{originalIndices:n.faces});return n.position=MKe(new Float64Array(o.buffer)),n.faces=o.indices,n}function wgt(t,e,i){if(t.length===1)return t[0];const r=cc(e),s=new Array(i);let n=0,o=0,a=0;for(const l of t){for(let c=0;c<l.position.length;c++)r[n++]=l.position[c];for(const c of l.faces)s[o++]=c+a;a=n/3}return{position:r,faces:MS(s)}}function loe(t,e,i,r){const s=t.length,n=new Array(s),o=new Array(s),a=new Array(s);let l=0;for(let g=0;g<s;++g)l+=t[g].length;let c=0,h=0,d=0;const f=cc(3*l);let m=0;for(let g=s-1;g>=0;g--){const v=t[g],_=i===xA.CCW_IS_HOLE&&xgt(v,e,r);if(_&&s!==1)n[c++]=v;else{let b=v.length;for(let x=0;x<c;++x)b+=n[x].length;const w={index:m,pathLengths:new Array(c+1),count:b,holeIndices:new Array(c)};w.pathLengths[0]=v.length,v.length>0&&(a[d++]={index:m,count:v.length}),m=_?hF(v,v.length-1,-1,f,m,v.length,e):hF(v,0,1,f,m,v.length,e);for(let x=0;x<c;++x){const S=n[x];w.holeIndices[x]=m,w.pathLengths[x+1]=S.length,S.length>0&&(a[d++]={index:m,count:S.length}),m=hF(S,0,1,f,m,S.length,e)}c=0,w.count>0&&(o[h++]=w)}}for(let g=0;g<c;++g){const v=n[g];v.length>0&&(a[d++]={index:m,count:v.length}),m=hF(v,0,1,f,m,v.length,e)}return o.length=h,a.length=d,{position:f,polygons:o,outlines:a}}function hF(t,e,i,r,s,n,o){s*=3;for(let a=0;a<n;++a){const l=t[e];r[s++]=l[0],r[s++]=l[1],r[s++]=o&&l[2]?l[2]:0,e+=i}return s/3}function xgt(t,e,i){if(!e)return!eb(t);const r=t.length-1;switch(GDe(t,r,i)){case rs.X:return!eb(t,rs.Y,rs.Z);case rs.Y:return!eb(t,rs.X,rs.Z);case rs.Z:return!eb(t,rs.X,rs.Y)}}var xA;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(xA||(xA={}));var dC,FB,QX;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})(dC||(dC={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}(FB||(FB={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}(QX||(QX={}));var Dn,cd,Rs;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})(Dn||(Dn={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(cd||(cd={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(Rs||(Rs={}));let Sgt=class{constructor(e,i){this.vec3=e,this.id=i}};function kB(t,e,i,r){return new Sgt(De(t,e,i),r)}let nme=class{constructor(){this._extent=si(),this.resolution=0,this.renderLocalOrigin=kB(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new Tgt}get extent(){return this._extent}setupGeometryViewsCyclical(e){this.setupGeometryView();const i=.001*e.range;if(this._extent[0]-i<=e.min){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];DU(this._extent,e.range,0,r)}if(this._extent[2]+i>=e.max){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];DU(this._extent,-e.range,0,r)}}setupGeometryView(){this.canvasGeometries.numViews=1,Lb(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const i=this.canvasGeometries.extents[e];if(i[0]!==i[2]&&i[1]!==i[3])return!0}return!1}},Tgt=class{constructor(){this.extents=[si(),si(),si()],this.numViews=0}};var sr;(function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.WaterNormal=3]="WaterNormal",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"})(sr||(sr={}));let Egt=class{constructor(e,i,r){this._fbos=e,this._format=i,this._name=r}get valid(){var e;return((e=this._handle)==null?void 0:e.getTexture())!=null}dispose(){this._handle=Lr(this._handle)}get texture(){var e;return(e=this._handle)==null?void 0:e.getTexture()}bind(e,i,r){var s,n,o,a;this._handle&&((s=this._handle.fbo)==null?void 0:s.width)===i&&((n=this._handle.fbo)==null?void 0:n.height)===r||((o=this._handle)==null||o.release(),this._handle=this._fbos.acquire(i,r,this._name,this._format)),e.bindFramebuffer((a=this._handle)==null?void 0:a.fbo)}generateMipMap(){var e,i,r,s,n;(r=(i=(e=this._handle)==null?void 0:e.getTexture())==null?void 0:i.descriptor)!=null&&r.hasMipmap&&((n=(s=this._handle)==null?void 0:s.getTexture())==null||n.generateMipmap())}},JT=class{constructor(e,i,r,s,n=gr.RGBA_MIPMAP){this.output=r,this.content=s,this.fbo=new Egt(e,n,i)}get valid(){return this.fbo.valid}},Cgt=class{constructor(e){this.targets=[new JT(e,"overlay color",Y.Color,sr.Color),new JT(e,"overlay IM color",Y.Color,sr.ColorNoRasterImage),new JT(e,"overlay highlight",Y.Highlight,sr.Highlight,gr.RG),new JT(e,"overlay water",Y.Normal,sr.WaterNormal),new JT(e,"overlay occluded",Y.Color,sr.Occluded)],Dd()&&this.targets.push(new JT(e,"overlay olid",Y.ObjectAndLayerIdColor,sr.ObjectAndLayerIdColor,gr.RGBA))}getTexture(e){var i;return(i=this.targets[e])==null?void 0:i.fbo.texture}dispose(){for(const e of this.targets)e.fbo.dispose()}computeValidity(){return this.targets.reduce((e,i,r)=>i.valid?e|=1<<r:e,0)}};function $6(t){return t?{ray:Nn(t.ray),c0:t.c0,c1:t.c1}:{ray:Nn(),c0:0,c1:Number.MAX_VALUE}}function $gt(t,e=$6()){return _B(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function Agt(t,e,i=$6()){const r=Ee(t.vector);return Fse(t.origin,e,i.ray),i.c0=0,i.c1=r,i}function qei(t,e){return HDe(t,t.c0,e)}function Wei(t,e){return HDe(t,t.c1,e)}function HDe(t,e,i){return oe(i,t.ray.origin,re(i,t.ray.direction,e))}new jv(()=>$6());function zB(t){return t?[Gr(t[0]),Gr(t[1]),Gr(t[2]),Gr(t[3]),Gr(t[4]),Gr(t[5])]:[Gr(),Gr(),Gr(),Gr(),Gr(),Gr()]}function qDe(){return[$(),$(),$(),$(),$(),$(),$(),$()]}function eK(t,e){for(let i=0;i<vM;i++)Lse(t[i],e[i]);return t}function WDe(t,e,i,r=Dgt){const s=Bn(Ise.get(),e,t);$l(s,s);for(let n=0;n<Rgt;++n){const o=eu(Ose.get(),Pgt[n],s);se(r[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}ZDe(i,r)}function ZDe(t,e){Gp(e[Wt.FAR_BOTTOM_LEFT],e[Wt.NEAR_BOTTOM_LEFT],e[Wt.NEAR_TOP_LEFT],t[bo.LEFT]),Gp(e[Wt.NEAR_BOTTOM_RIGHT],e[Wt.FAR_BOTTOM_RIGHT],e[Wt.FAR_TOP_RIGHT],t[bo.RIGHT]),Gp(e[Wt.FAR_BOTTOM_LEFT],e[Wt.FAR_BOTTOM_RIGHT],e[Wt.NEAR_BOTTOM_RIGHT],t[bo.BOTTOM]),Gp(e[Wt.NEAR_TOP_LEFT],e[Wt.NEAR_TOP_RIGHT],e[Wt.FAR_TOP_RIGHT],t[bo.TOP]),Gp(e[Wt.NEAR_BOTTOM_LEFT],e[Wt.NEAR_BOTTOM_RIGHT],e[Wt.NEAR_TOP_RIGHT],t[bo.NEAR]),Gp(e[Wt.FAR_BOTTOM_RIGHT],e[Wt.FAR_BOTTOM_LEFT],e[Wt.FAR_TOP_LEFT],t[bo.FAR])}function hb(t,e){for(let i=0;i<vM;i++){const r=t[i];if(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=e[3])return!1}return!0}function Mgt(t,e){return YDe(t,$gt(e,JDe.get()))}function Zei(t,e){for(let i=0;i<vM;i++){const r=t[i];if(!ylt(r,e))return!1}return!0}function Ogt(t,e,i){return YDe(t,Agt(e,i,JDe.get()))}function pC(t,e){for(let i=0;i<vM;i++)if(on(t[i],e)>0)return!1;return!0}function YDe(t,e){for(let i=0;i<vM;i++)if(!glt(t[i],e))return!1;return!0}var bo,Wt;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(bo||(bo={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(Wt||(Wt={}));const Igt={bottom:[Wt.FAR_BOTTOM_RIGHT,Wt.NEAR_BOTTOM_RIGHT,Wt.NEAR_BOTTOM_LEFT,Wt.FAR_BOTTOM_LEFT],near:[Wt.NEAR_BOTTOM_LEFT,Wt.NEAR_BOTTOM_RIGHT,Wt.NEAR_TOP_RIGHT,Wt.NEAR_TOP_LEFT],far:[Wt.FAR_BOTTOM_RIGHT,Wt.FAR_BOTTOM_LEFT,Wt.FAR_TOP_LEFT,Wt.FAR_TOP_RIGHT],right:[Wt.NEAR_BOTTOM_RIGHT,Wt.FAR_BOTTOM_RIGHT,Wt.FAR_TOP_RIGHT,Wt.NEAR_TOP_RIGHT],left:[Wt.FAR_BOTTOM_LEFT,Wt.NEAR_BOTTOM_LEFT,Wt.NEAR_TOP_LEFT,Wt.FAR_TOP_LEFT],top:[Wt.FAR_TOP_LEFT,Wt.NEAR_TOP_LEFT,Wt.NEAR_TOP_RIGHT,Wt.FAR_TOP_RIGHT]},vM=6,Rgt=8,Pgt=[Yi(-1,-1,-1,1),Yi(1,-1,-1,1),Yi(1,1,-1,1),Yi(-1,1,-1,1),Yi(-1,-1,1,1),Yi(1,-1,1,1),Yi(1,1,1,1),Yi(-1,1,1,1)],JDe=new jv($6),Dgt=qDe();function Lgt(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/e)}function Ngt(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/i)}function Fgt(t,e,i){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}function kgt(t,e,i){return 2*Math.atan(i*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}let tK=class{constructor(){this.adds=new ii,this.removes=new ii,this.updates=new ii({allocator:e=>e||new zgt,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},zgt=class{},Ugt=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var zp,ai;function XDe(t){const e=new Map,i=r=>{let s=e.get(r);return s||(s=new Ugt,e.set(r,s)),s};return t.removes.forAll(r=>{_q(r)&&i(r.material).removes.push(r)}),t.adds.forAll(r=>{_q(r)&&i(r.material).adds.push(r)}),t.updates.forAll(r=>{_q(r.renderGeometry)&&i(r.renderGeometry.material).updates.push(r)}),e}function _q(t){return t.geometry.indexCount>=1}(function(t){t[t.Default=0]="Default",t[t.Screenshot=1]="Screenshot",t[t.ObjectAndLayerID=2]="ObjectAndLayerID"})(zp||(zp={})),function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"}(ai||(ai={}));var iK;let oi=iK=class extends he{constructor(t){super(t),this._ray=Nn(),this._viewport=Yi(0,0,1,1),this._padding=Yi(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=fn(1,1e3),this._viewDirty=!0,this._viewMatrix=qe(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=qe(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=qe(),this._frustumDirty=!0,this._frustum=zB(),this._fullViewport=yi(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=$(),this._up=$(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get rows(){return this._rows}set rows(t){this._rows=Math.max(1,t)}get columns(){return this._columns}set columns(t){this._columns=Math.max(1,t)}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return be(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){_n(this._viewMatrix,t),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),se($(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),se($(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),se($(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=hA(yi(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&$S(t,e)?e:t}get screenPadding(){if(this.pixelRatio===1)return this._padding;const t=hA(yi(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&$S(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[ai.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[ai.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[ai.RIGHT]+this._padding[ai.LEFT]}set fullWidth(t){this.width=t-(this._padding[ai.RIGHT]+this._padding[ai.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[ai.TOP]+this._padding[ai.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[ai.TOP]+this._padding[ai.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[ai.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[ai.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){tS(this._padding,t)||(this._viewport[0]+=t[ai.LEFT]-this._padding[ai.LEFT],this._viewport[1]+=t[ai.BOTTOM]-this._padding[ai.BOTTOM],this._viewport[2]-=t[ai.RIGHT]+t[ai.LEFT]-(this._padding[ai.RIGHT]+this._padding[ai.LEFT]),this._viewport[3]-=t[ai.TOP]+t[ai.BOTTOM]-(this._padding[ai.TOP]+this._padding[ai.BOTTOM]),xd(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Bn(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return $l(qe(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||qe()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return Fgt(this._fov,this.width,this.height)}set fovX(t){this._fov=Lgt(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return kgt(this._fov,this.width,this.height)}set fovY(t){this._fov=Ngt(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Sr(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&($l(this._viewInverseTransposeMatrix,this.viewMatrix),mc(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const{near:e,far:i}=this;return 2*e*i/(i+e-t*(i-e))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}get _projectionMatrixInternal(){const t=this.width,e=this.height,i=this.near*Math.tan(this.fovY/2)*2,r=i*this._aspect,s=i/this.rows,n=r/this.columns,o=-r/2+this.column*n,a=o+n,l=-i/2+this.row*s,c=l+s,h=b$e(qe(),o*(1+2*this._padding[ai.LEFT]/t),a*(1+2*this._padding[ai.RIGHT]/t),l*(1+2*this._padding[ai.BOTTOM]/e),c*(1+2*this._padding[ai.TOP]/e),this.near,this.far),d=this._get("projectionMatrix");return d&&Sre(d,h)?d:h}copyFrom(t){ne(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,xd(this._viewport,t.viewport),this.notifyChange("_viewport"),xd(this._padding,t.padding),this.notifyChange("_padding"),Vn(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.row=t.row,this.column=t.column,this.rows=t.rows,this.columns=t.columns,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(_n(this._viewMatrix,t.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(eK(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(_n(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),xd(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up,this.fov=t.fov}clone(){return new iK().copyFrom(this)}equals(t){return to(this.eye,t.eye)&&to(this.center,t.center)&&to(this.up,t.up)&&tS(this._viewport,t.viewport)&&tS(this._padding,t.padding)&&IMe(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation&&this.row===t.row&&this.column===t.column&&this.rows===t.rows&&this.columns===t.columns}almostEquals(t){const e=Math.max(1,1/this.pixelRatio,1/t.pixelRatio);if(Math.abs(t.fov-this._fov)>=.001||yB(t.screenPadding,this.screenPadding)>=e||yB(this.screenViewport,t.screenViewport)>=e||this.row!==t.row||this.column!==t.column||this.rows!==t.rows||this.columns!==t.columns)return!1;Fi(Oa,t.eye,t.center),Fi(bq,this.eye,this.center);const i=fe(Oa,bq),r=rB(Oa),s=rB(bq),n=5e-4;return i*i>=(1-1e-10)*r*s&&lA(t.eye,this.eye)<Math.max(r,s)*n*n}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(Sb(this.viewForward,be(Oa,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=ln()){return t[0]=(this.padding[ai.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[ai.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,i=.5){return t[0]=this.padding[ai.LEFT]+this.width*e,t[1]=this.padding[ai.BOTTOM]+this.height*i,t[2]=.5,t}setGLViewport(t){const e=this.viewport,i=this.padding;t.setViewport(e[0]-i[3],e[1]-i[2],e[2]+i[1]+i[3],e[3]+i[0]+i[2])}applyProjection(t,e){t!==Li&&ne(Li,t),Li[3]=1,eu(Li,Li,this.projectionMatrix);const i=Math.abs(Li[3]);re(Li,Li,1/i);const r=this.fullViewport;e[0]=ft(0,r[0]+r[2],.5+.5*Li[0]),e[1]=ft(0,r[1]+r[3],.5+.5*Li[1]),e[2]=.5*(Li[2]+1),e[3]=i}unapplyProjection(t,e){const i=this.fullViewport;Li[0]=(t[0]/(i[0]+i[2])*2-1)*t[3],Li[1]=(t[1]/(i[1]+i[3])*2-1)*t[3],Li[2]=(2*t[2]-1)*t[3],Li[3]=t[3],this.inverseProjectionMatrix!=null&&(eu(Li,Li,this.inverseProjectionMatrix),e[0]=Li[0],e[1]=Li[1],e[2]=Li[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,wq),this.renderToScreen(wq,e),e}projectToRenderScreen(t,e){if(Li[0]=t[0],Li[1]=t[1],Li[2]=t[2],Li[3]=1,eu(Li,Li,this.viewProjectionMatrix),Li[3]===0)return null;const i=Li;re(i,i,1/Math.abs(Li[3]));const r=this.fullViewport,s=ft(0,r[0]+r[2],.5+.5*i[0]),n=ft(0,r[1]+r[3],.5+.5*i[1]);return"x"in e?(e.x=s,e.y=n):(e[0]=s,e[1]=n,e.length>2&&(e[2]=.5*(i[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,wq),e)}unprojectFromRenderScreen(t,e){if(Bn(dF,this.projectionMatrix,this.viewMatrix),!$l(dF,dF))return null;const i=this.fullViewport;return Li[0]=2*(t[0]-i[0])/i[2]-1,Li[1]=2*(t[1]-i[1])/i[3]-1,Li[2]=2*t[2]-1,Li[3]=1,eu(Li,Li,dF),Li[3]===0?null:(e[0]=Li[0]/Li[3],e[1]=Li[1]/Li[3],e[2]=Li[2]/Li[3],e)}constrainWindowSize(t,e,i,r){const s=t*this.pixelRatio,n=e*this.pixelRatio,o=Math.max(s-i/2,0),a=Math.max(this.fullHeight-n-r/2,0),l=-Math.min(s-i/2,0),c=-Math.min(this.fullHeight-n-r/2,0),h=i-l- -Math.min(this.fullWidth-s-i/2,0),d=r-c- -Math.min(n-r/2,0);return[Math.round(o),Math.round(a),Math.round(h),Math.round(d)]}computeUp(t){t===je.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const i=t[0]*this.pixelRatio,r=this.fullHeight-t[1]*this.pixelRatio;return e[0]=i,e[1]=r,e}renderToScreen(t,e){const i=t[0]/this.pixelRatio,r=(this.fullHeight-t[1])/this.pixelRatio;e[0]=i,e[1]=r}_computeUpGlobal(){be(Oa,this.center,this.eye);const t=Ee(this.center);t<1?(se(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(fe(Oa,this.center))>.9999*Ee(Oa)*t||(ct(this._up,Oa,this.center),ct(this._up,this._up,Oa),ae(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){nT(Oa,this.eye,this.center),Math.abs(Oa[2])<=.9999&&(re(Oa,Oa,Oa[2]),se(this._up,-Oa[0],-Oa[1],1-Oa[2]),ae(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,i=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?to(t,e)||(ne(e,t),this._markViewDirty(),i.length&&this.notifyChange(i)):J.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(WDe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(hG(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};u([p()],oi.prototype,"_viewport",void 0),u([p()],oi.prototype,"_padding",void 0),u([p()],oi.prototype,"_fov",void 0),u([p()],oi.prototype,"_nearFar",void 0),u([p()],oi.prototype,"_viewDirty",void 0),u([p()],oi.prototype,"_viewMatrix",void 0),u([p()],oi.prototype,"_pixelRatio",void 0),u([p()],oi.prototype,"pixelRatio",null),u([p()],oi.prototype,"row",void 0),u([p()],oi.prototype,"column",void 0),u([p()],oi.prototype,"_rows",void 0),u([p()],oi.prototype,"rows",null),u([p()],oi.prototype,"_columns",void 0),u([p()],oi.prototype,"columns",null),u([p()],oi.prototype,"eye",null),u([p()],oi.prototype,"center",null),u([p()],oi.prototype,"_center",void 0),u([p()],oi.prototype,"up",null),u([p()],oi.prototype,"_up",void 0),u([p()],oi.prototype,"viewMatrix",null),u([p({readOnly:!0})],oi.prototype,"viewForward",null),u([p({readOnly:!0})],oi.prototype,"viewUp",null),u([p({readOnly:!0})],oi.prototype,"viewRight",null),u([p({readOnly:!0})],oi.prototype,"nearFar",null),u([p()],oi.prototype,"near",null),u([p()],oi.prototype,"far",null),u([p()],oi.prototype,"viewport",null),u([p({readOnly:!0})],oi.prototype,"screenViewport",null),u([p({readOnly:!0})],oi.prototype,"screenPadding",null),u([p()],oi.prototype,"x",null),u([p()],oi.prototype,"y",null),u([p()],oi.prototype,"width",null),u([p()],oi.prototype,"height",null),u([p()],oi.prototype,"fullWidth",null),u([p()],oi.prototype,"fullHeight",null),u([p({readOnly:!0})],oi.prototype,"_aspect",null),u([p()],oi.prototype,"padding",null),u([p({readOnly:!0})],oi.prototype,"projectionMatrix",null),u([p({readOnly:!0})],oi.prototype,"inverseProjectionMatrix",null),u([p()],oi.prototype,"fov",null),u([p()],oi.prototype,"fovX",null),u([p()],oi.prototype,"fovY",null),u([p()],oi.prototype,"viewInverseTransposeMatrix",null),u([p({readOnly:!0})],oi.prototype,"_projectionMatrixInternal",null),u([p()],oi.prototype,"relativeElevation",void 0),oi=iK=u([A("esri.views.3d.webgl.RenderCamera")],oi);const qr=oi,Li=yi(),dF=qe(),Oa=$(),bq=$(),wq=Qp();var Wa;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight",t[t.ViewshedShadowMap=3]="ViewshedShadowMap"})(Wa||(Wa={}));function Kei(t){t.fragment.code.add(E`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function Bgt(t){t.fragment.code.add(E`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function ML(t){t.fragment.code.add(E`
    const float GAMMA = ${E.float(qU)};
    const float INV_GAMMA = ${E.float(1/qU)};

    vec4 delinearizeGamma(vec4 color) {
      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.a);
    }

    vec3 linearizeGamma(vec3 color) {
      return pow(color, vec3(GAMMA));
    }
  `)}function Vgt(t,e){if(!e.screenSpaceReflections)return;const i=t.fragment;i.include(Sg),i.uniforms.add(new $v("nearFar",r=>r.camera.nearFar),new oo("depthMap",r=>{var s;return(s=r.depth)==null?void 0:s.attachment}),new $o("proj",r=>r.camera.projectionMatrix),new Un("invResolutionHeight",r=>1/r.camera.height),new $o("reprojectionMatrix",r=>r.ssr.reprojectionMatrix)).code.add(E`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);
    float dDepthBefore = 0.0;

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        float weight = dDepth / (dDepth - dDepthBefore);
        vec2 Pf = mix(P - dP, P, 1.0 - weight);
        if (abs(Pf.y - projectedCoordStart.y) > invResolutionHeight) {
          return vec3(Pf, depth);
        }
        else {
          return vec3(P, depth);
        }
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
      dDepthBefore = dDepth;
    }
    return vec3(P, 0.0);
  }
  `)}var Yu,Mv;function jgt(t){return t!=null&&!t.running}(function(t){t[t.Idle=0]="Idle",t[t.Rendering=1]="Rendering",t[t.Ready=2]="Ready",t[t.Fading=3]="Fading"})(Yu||(Yu={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA",t[t.COUNT=2]="COUNT"}(Mv||(Mv={}));function Yv(t=Ggt){return[t[0],t[1],t[2],t[3]]}function xq(t,e,i=Yv()){return ne(i,t),i[3]=e,i}function ome(t,e,i){return ct(i,t,e),ae(i,i),i[3]=-bOe(t,e),i}function Qei(t,e=Yv()){const i=_$e(VI,t);return KDe(e,Ao(sne(e,i))),e}function ame(t,e,i=Yv()){return EB(VI,t,lme(t)),EB(cme,e,lme(e)),s6(VI,cme,VI),KDe(i,Ao(sne(i,VI)))}function eti(t,e,i,r=Yv()){return xq(are,t,pF),xq(lre,e,ume),xq(q$,i,hme),ame(pF,ume,pF),ame(pF,hme,r),r}function tti(t){return t}function iti(t){return t[3]}function lme(t){return At(t[3])}function KDe(t,e){return t[3]=e,t}const Ggt=[0,0,1,0],VI=zd(),cme=zd();Yv();const pF=Yv(),ume=Yv(),hme=Yv();var rK;let jI=rK=class extends ee{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new rK({cloudCover:this.cloudCover})}};u([Ve({cloudy:"cloudy"}),p({json:{write:{isRequired:!0}}})],jI.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],jI.prototype,"cloudCover",void 0),jI=rK=u([A("esri.views.3d.environment.CloudyWeather")],jI);const Hgt=jI;var sK;let GI=sK=class extends ee{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new sK({fogStrength:this.fogStrength})}};u([Ve({foggy:"foggy"}),p({json:{write:{isRequired:!0}}})],GI.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],GI.prototype,"fogStrength",void 0),GI=sK=u([A("esri.views.3d.environment.FoggyWeather")],GI);const qgt=GI;var nK;let s2=nK=class extends ee{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new nK({cloudCover:this.cloudCover,precipitation:this.precipitation})}};u([Ve({rainy:"rainy"}),p({json:{write:{isRequired:!0}}})],s2.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],s2.prototype,"cloudCover",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],s2.prototype,"precipitation",void 0),s2=nK=u([A("esri.views.3d.environment.RainyWeather")],s2);const Wgt=s2;var oK;let N1=oK=class extends ee{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new oK({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};u([Ve({snowy:"snowy"}),p({json:{write:{isRequired:!0}}})],N1.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],N1.prototype,"cloudCover",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],N1.prototype,"precipitation",void 0),u([p({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],N1.prototype,"snowCover",void 0),N1=oK=u([A("esri.views.3d.environment.SnowyWeather")],N1);const Zgt=N1;var aK;let HI=aK=class extends ee{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new aK({cloudCover:this.cloudCover})}};u([Ve({sunny:"sunny"}),p({json:{write:{isRequired:!0}}})],HI.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],HI.prototype,"cloudCover",void 0),HI=aK=u([A("esri.views.3d.environment.SunnyWeather")],HI);const UB=HI,coe={key:"type",base:UB,typeMap:{sunny:UB,cloudy:Hgt,rainy:Wgt,snowy:Zgt,foggy:qgt}},Ygt=Object.keys(coe.typeMap);function Jgt(t,e){return!!Ygt.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const r$=1e4,Xgt=1e5;let Kgt=class{constructor(){this.startTime=0,this._data=Ta(null),this._readChannels=Mv.RG,this.parallax=new dme,this.parallaxNew=new dme,this._anchorPoint=$(),this._fadeState=Ta(Pr.HIDE),this._fadeFactor=Ta(1)}get data(){return this._data.value}set data(e){this._data.value=e}get readChannels(){return this._readChannels}get fadeState(){return this._fadeState.value}get fadeFactor(){return this._fadeFactor.value}get opacity(){switch(this.fadeState){case Pr.HIDE:return 0;case Pr.FADE_OUT:return 1-this.fadeFactor;case Pr.FADE_IN:return this.fadeFactor;case Pr.SHOW:case Pr.CROSS_FADE:return 1}}fade(e,i,r){this.isFading&&this.fadeFactor<1&&(this._fadeFactor.value=r?ue((i-this.startTime)/(eyt*r),0,1):1,this.fadeFactor===1&&this._endFade()),this._evaluateState(e,i),this._updateParallax(e)}_evaluateState(e,i){const r=e.relativeElevation,s=this._updateAnchorPoint(e);(r>1.7*r$||r<-1e4||s>fme)&&this.opacity>0?this._startFade(Pr.HIDE,i):this.isFading||(r>r$||r<-.35*r$||s>tyt*fme?this.opacity>0&&this._startFade(Pr.FADE_OUT,i):jgt(this.data)&&(this.opacity===0?this._startFade(Pr.FADE_IN,i):this.data.state===Yu.Ready&&(this.fadeState===Pr.SHOW?this._startFade(Pr.CROSS_FADE,i):this._startFade(Pr.SHOW,i))))}_updateParallax(e){const i=Xo(e.eye);this.parallax.radiusCurvatureCorrection=.84*Math.sqrt(Math.max(i-Ci.radius*Ci.radius,0))/Math.sqrt(i),ome(pme,this.parallax.anchorPoint,XT),Ku(this.parallax.transform,eo,XT[3],XT),ome(pme,this.parallaxNew.anchorPoint,XT),Ku(this.parallaxNew.transform,eo,XT[3],XT)}_updateAnchorPoint(e){var i;return ae(this._anchorPoint,e.eye),re(this._anchorPoint,this._anchorPoint,Ci.radius),this.fadeState===Pr.HIDE&&((i=this.data)==null?void 0:i.state)===Yu.Ready?(ne(this.parallax.anchorPoint,this._anchorPoint),0):Ee(be(Qgt,this.parallax.anchorPoint,this._anchorPoint))}requestFade(){this._fadeFactor.value=0}_startFade(e,i){switch(this._fadeState.value=e,this.startTime=i,e){case Pr.CROSS_FADE:this.requestFade(),this._switchReadChannels(),ne(this.parallaxNew.anchorPoint,this._anchorPoint);break;case Pr.FADE_IN:this.requestFade(),this._switchReadChannels(),ne(this.parallax.anchorPoint,this._anchorPoint),ne(this.parallaxNew.anchorPoint,this._anchorPoint);break;case Pr.FADE_OUT:this.requestFade();break;case Pr.SHOW:this._switchReadChannels(),ne(this.parallax.anchorPoint,this._anchorPoint),ne(this.parallaxNew.anchorPoint,this._anchorPoint),this._endFade();break;case Pr.HIDE:this._endFade()}}_endFade(){switch(this._fadeFactor.value=1,this.data&&this.data.state!==Yu.Ready&&(this.data.state=Yu.Idle),this.fadeState){case Pr.CROSS_FADE:ne(this.parallax.anchorPoint,this.parallaxNew.anchorPoint),this._fadeState.value=Pr.SHOW;break;case Pr.FADE_IN:this._fadeState.value=Pr.SHOW;break;case Pr.FADE_OUT:this._fadeState.value=Pr.HIDE;break;case Pr.SHOW:case Pr.HIDE:break;default:this.fadeState}}_switchReadChannels(){var e;((e=this.data)==null?void 0:e.state)===Yu.Ready&&(this._readChannels=1-this._readChannels,this.data.state=Yu.Fading)}get isFading(){return this.fadeState===Pr.FADE_OUT||this.fadeState===Pr.FADE_IN||this.fadeState===Pr.CROSS_FADE}};var Pr;(function(t){t[t.HIDE=0]="HIDE",t[t.FADE_IN=1]="FADE_IN",t[t.SHOW=2]="SHOW",t[t.CROSS_FADE=3]="CROSS_FADE",t[t.FADE_OUT=4]="FADE_OUT"})(Pr||(Pr={}));let dme=class{constructor(){this.anchorPoint=$(),this.radiusCurvatureCorrection=0,this.transform=qe()}};const pme=De(0,0,1),XT=Yv(),Qgt=$(),eyt=1.25,tyt=.5,fme=2e5;let iyt=class extends lr{constructor(e,i){super(e,"samplerCube",Lt.Bind,(r,s)=>r.bindTexture(e,i(s)))}};function QDe(t){const e=t.fragment;e.constants.add("radiusCloudsSquared","float",ryt).code.add(E`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos) {
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusCloudsSquared;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
return (cameraPosition + dir * pointIntDist) - spherePos;
}`),e.uniforms.add(new Un("radiusCurvatureCorrection",({clouds:l})=>l.parallax.radiusCurvatureCorrection)).code.add(E`vec3 correctForPlanetCurvature(vec3 dir) {
dir.z = dir.z * (1.0 - radiusCurvatureCorrection) + radiusCurvatureCorrection;
return dir;
}`),e.code.add(E`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec) {
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),cg(e),Av(e);const i=De(.28,.175,.035);e.constants.add("RIM_COLOR","vec3",i),e.code.add(E`
    vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds) {
      float upDotLight = dot(cameraPosition, mainLightDirection);
      float dirDotLight = max(dot(worldSpaceRay, mainLightDirection), 0.0);
      float sunsetTransition = clamp(pow(max(upDotLight, 0.0), ${E.float(.3)}), 0.0, 1.0);

      // Base color of the clouds that depends on lighting of the sun and sky
      vec3 ambientLight = calculateAmbientIrradiance(cameraPosition,  0.0);
      vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
      vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));

      // Rim light around the edge of the clouds simulating scattering of the direct lun light
      float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
      float rimLightIntensity = 0.5 + 0.5 * pow(max(upDotLight, 0.0), 0.35);
      vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, ${E.float(140)})) * scatteringMod;

      // Brighten the clouds around the sun at the sunsets
      float additionalLight = ${E.float(.2)} * pow(dirDotLight, ${E.float(10)}) * (1. - pow(sunsetTransition, ${E.float(.3)})) ;

      return vec3(baseCloudColor * (1.0 + additionalLight) + directSunScattering);
    }
  `),e.uniforms.add(new DB("readChannelsRG",l=>l.clouds.readChannels===Mv.RG),new iyt("cubeMap",l=>{var c,h;return((h=(c=l.clouds.data)==null?void 0:c.cubeMap)==null?void 0:h.colorTexture)??null})).code.add(E`vec4 sampleCloud(vec3 rayDir, bool readOtherChannel) {
vec4 s = texture(cubeMap, rayDir);
bool readRG = readChannelsRG ^^ readOtherChannel;
s = readRG ? vec4(vec3(s.r), s.g) : vec4(vec3(s.b), s.a);
return length(s) == 0.0 ? vec4(s.rgb, 1.0) : s;
}`),e.uniforms.add(new Ka("anchorPoint",l=>l.clouds.parallax.anchorPoint),new Ka("anchorPointNew",l=>l.clouds.parallaxNew.anchorPoint),new $o("rotationClouds",l=>l.clouds.parallax.transform),new $o("rotationCloudsNew",l=>l.clouds.parallaxNew.transform),new Un("cloudsOpacity",l=>l.clouds.opacity),new Un("fadeFactor",l=>l.clouds.fadeFactor),new DB("crossFade",l=>l.clouds.fadeState===Pr.CROSS_FADE)).code.add(E`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition) {
vec3 intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPoint);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = sampleCloud(worldRayRotatedCorrected, crossFade);
vec3 cameraPositionN = normalize(cameraPosition);
vec4 cloudColor = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
if(crossFade) {
intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPointNew);
worldRayRotated = rotateDirectionToAnchorPoint(rotationCloudsNew, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = sampleCloud(worldRayRotatedCorrected, false);
vec4 cloudColorNew = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorNew, fadeFactor);
}
float totalTransmittance = length(cloudColor.rgb) == 0.0 ?
1.0 :
clamp(cloudColor.a * cloudsOpacity + (1.0 - cloudsOpacity), 0.0 , 1.0);
return vec4(cloudColor.rgb, totalTransmittance);
}`)}const ryt=(Ci.radius+Xgt)**2;function A6(t){t.code.add(E`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}`)}function syt(t,e){t.include(Imt,e),t.include(ML),t.include(Bgt),e.cloudReflections&&t.include(QDe),t.include(Vgt,e);const i=t.fragment;i.include(A6),i.constants.add("fresnelSky","vec3",[.02,1,15]),i.constants.add("fresnelMaterial","vec2",[.02,.1]),i.constants.add("roughness","float",.015),i.constants.add("foamIntensityExternal","float",1.7),i.constants.add("ssrIntensity","float",.65),i.constants.add("ssrHeightFadeStart","float",$De),i.constants.add("ssrHeightFadeEnd","float",PB),i.constants.add("waterDiffusion","float",.92),i.constants.add("waterSeaColorMod","float",.8),i.constants.add("correctionViewingPowerFactor","float",.4),i.constants.add("skyZenitColor","vec3",[.52,.68,.9]),i.constants.add("skyColor","vec3",[.67,.79,.9]),i.constants.add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(E`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add(new Un("lightingSpecularStrength",r=>r.lighting.mainLight.specularStrength),new Un("lightingEnvironmentStrength",r=>r.lighting.mainLight.environmentStrength)),i.code.add(E`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
float NdotL = clamp(dot(n, l), 0.0, 1.0);
specular = lightingSpecularStrength * NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.cloudReflections&&i.uniforms.add(new Un("cloudsOpacity",r=>r.clouds.opacity)).code.add(E`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * cloudsOpacity;`),e.screenSpaceReflections?i.uniforms.add(new $o("view",r=>r.camera.viewMatrix),new oo("lastFrameColorTexture",r=>{var s;return(s=r.ssr.lastFrameColor)==null?void 0:s.getTexture()}),new Un("fadeFactorSSR",r=>r.ssr.fadeFactor)).code.add(E`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view * vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`):i.code.add(E`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.cloudReflections?e.screenSpaceReflections?i.code.add(E`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(E`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(E`return waterRenderedColor;
}`)}var Dm;function nyt(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new B3("overlayTexOffset",(s,n)=>oyt(s,n)),new B3("overlayTexScale",(s,n)=>ayt(s,n))),r.constants.add("overlayOpacity","float",1),r.uniforms.add(new It("ovColorTex",(s,n)=>tLe(s,n))),eLe(t,e)}function aO(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new mme("overlayTexOffset"),new mme("overlayTexScale")),r.uniforms.add(new mt("overlayOpacity",s=>s.overlayOpacity),new It("ovColorTex",(s,n)=>{var o;return(o=n.overlay)==null?void 0:o.getTexture(s.overlayContent)})),eLe(t,e)}function eLe(t,e){const i=e.pbrMode===Ct.Water||e.pbrMode===Ct.WaterOnIntegratedMesh||e.pbrMode===Ct.TerrainWithWater;i&&t.include(syt,e);const{vertex:r,fragment:s}=t;t.varyings.add("vtcOverlay","vec4"),r.code.add(E`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),s.code.add(E`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),s.code.add(E`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),s.code.add(E`vec4 getOverlayColorTexel() {
vec4 texCoords = vtcOverlay;
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y) * texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w) * texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),s.code.add(E`vec2 getAllOverlayHighlightValuesEncoded() {
vec4 texCoords = vtcOverlay;
vec2 uvInner = texCoords.xy;
vec2 uvOuter = texCoords.zw;
bool isValidInner = isValid(uvInner, fwidth(uvInner));
bool isValidOuter = isValid(uvOuter, vec2(0.0, 0.0));
vec2 texelCoordInner = uvInner * vec2(0.5, 1.0);
vec2 texelCoordOuter = uvOuter * vec2(0.5, 1.0) + vec2(0.5,0.0);
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec2 texelValueInner = texelFetch(ovColorTex, ivec2(texelCoordInner * texDim), 0).rg;
vec2 texelValueOuter = texelFetch(ovColorTex, ivec2(texelCoordOuter * texDim), 0).rg;
return
isValidInner ? texelValueInner :
isValidOuter ? texelValueOuter :
vec2(0.0);
}`),i&&(cg(s),Av(s),s.code.add(E`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function tLe(t,e){var i,r,s;return t.identifier===Wa.Material&&ws(t.output)?(i=e.overlay)==null?void 0:i.getTexture(sr.ColorNoRasterImage):t.identifier===Wa.Material&&t.output===Y.ObjectAndLayerIdColor?(r=e.overlay)==null?void 0:r.getTexture(sr.ObjectAndLayerIdColor):t.identifier===Wa.Highlight?(s=e.overlay)==null?void 0:s.getTexture(sr.Highlight):null}function oyt(t,e){var s,n,o,a;const i=(n=(s=e.overlay)==null?void 0:s.overlays[Dn.INNER])==null?void 0:n.extent;PU(i)&&(Mm[0]=t.toMapSpace[0]/Jo(i)-i[0]/Jo(i),Mm[1]=t.toMapSpace[1]/El(i)-i[1]/El(i));const r=(a=(o=e.overlay)==null?void 0:o.overlays[Dn.OUTER])==null?void 0:a.extent;return PU(r)&&(Mm[2]=t.toMapSpace[0]/Jo(r)-r[0]/Jo(r),Mm[3]=t.toMapSpace[1]/El(r)-r[1]/El(r)),Mm}function ayt(t,e){var s,n,o,a;const i=(n=(s=e.overlay)==null?void 0:s.overlays[Dn.INNER])==null?void 0:n.extent;PU(i)&&(Mm[0]=t.toMapSpace[2]/Jo(i),Mm[1]=t.toMapSpace[3]/El(i));const r=(a=(o=e.overlay)==null?void 0:o.overlays[Dn.OUTER])==null?void 0:a.extent;return PU(r)&&(Mm[2]=t.toMapSpace[2]/Jo(r),Mm[3]=t.toMapSpace[3]/El(r)),Mm}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(Dm||(Dm={}));const Mm=yi();let mme=class extends lr{constructor(e){super(e,"vec4")}},uoe=class extends cr{constructor(){super(...arguments),this.color=De(1,1,1)}};function iLe(){const t=new Vi;return t.include(ia),t.fragment.uniforms.add(new It("tex",e=>e.texture),new $r("uColor",e=>e.color)),t.fragment.main.add(E`vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);`),t}const lyt=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:uoe,build:iLe},Symbol.toStringTag,{value:"Module"})),rLe={required:[]},cyt={required:[Y.Depth]};let sLe=class extends he{precompile(e){return!!this.acquireTechniques(e)}consumes(){return rLe}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}modify(e){}get numGeometries(){return 0}get hasOccludees(){return!1}get hasEmissions(){return!1}forEachGeometry(e){}queryRenderOccludedState(e){return!1}},OL=class extends sLe{},uti=class extends sLe{},gme=class extends lr{constructor(e,i){super(e,"ivec2",Lt.Pass,(r,s,n)=>r.setUniform2iv(e,i(s,n)))}},hoe=class extends cr{};function nLe(){const t=new Vi,{outputs:e,fragment:i}=t;return t.include(ia),i.uniforms.add(new ag("textureInput",r=>r.input)),i.constants.add("outlineWidth","int",Math.ceil(G3)),i.constants.add("cellSize","int",db),e.add("fragGrid","vec2"),i.main.add(E`ivec2 inputTextureSize = textureSize(textureInput, 0);
ivec2 cellBottomLeftCornerInput = ivec2(floor(gl_FragCoord.xy) * vec2(cellSize));
ivec2 coordMid =  cellBottomLeftCornerInput + ivec2(cellSize >> 1);
uvec2 centreTexel = uvec2( texelFetch(textureInput, coordMid, 0).rg * 255.0) & uvec2(0x55u);
float marginSquare = float(outlineWidth*outlineWidth);
uvec2 outputValue = centreTexel & uvec2(0x55u);
for(int y = -outlineWidth; y <= cellSize + outlineWidth; y+=2) {
int dy = y < 0 ? -y : y > cellSize ? y-cellSize : 0;
int xMargin = dy > 0 ? int(ceil(sqrt(marginSquare - float(dy*dy)))) : outlineWidth;
for(int x = -xMargin; x <= cellSize + xMargin; x+=2) {
ivec2 coord = cellBottomLeftCornerInput + ivec2(x, y);
uvec2[4] texels = uvec2[4] (
uvec2(texelFetch(textureInput,coord+ivec2(0,0),0).rg * 255.0) & uvec2(0x55u),
uvec2(texelFetch(textureInput,coord+ivec2(1,0),0).rg * 255.0) & uvec2(0x55u),
uvec2(texelFetch(textureInput,coord+ivec2(0,1),0).rg * 255.0) & uvec2(0x55u),
uvec2(texelFetch(textureInput,coord+ivec2(1,1),0).rg * 255.0) & uvec2(0x55u)
);
if (texels[0] == texels[1] && texels[1] == texels[2] && texels[2] == texels[3] && texels[3] ==  centreTexel) {
continue;
}
for (int i=0; i<4; ++i){
outputValue |= ((texels[i] ^ centreTexel) << 1);
outputValue |= texels[i];
}
}
}
fragGrid = vec2(outputValue) / 255.0;`),t}const db=32,G3=9,doe=.4,uyt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:hoe,blurSize:doe,build:nLe,gridCellPixelSize:db,outlineSize:G3},Symbol.toStringTag,{value:"Module"}));function M6(t){const{vertex:e}=t;e.uniforms.add(new It("coverageTexture",i=>i.coverageTexture),new gme("highlightRenderCellCount",i=>di(yme,i.horizontalCellCount,i.verticalCellCount)),new gme("highlightTextureResolution",({highlightTexture:i})=>di(yme,i.descriptor.width,i.descriptor.height)),new dw("highlightLevel",i=>i.highlightLevel)).constants.add("cellSize","int",db),t.varyings.add("sUV","vec2"),t.varyings.add("vOutlinePossible","float"),e.code.add(E`const ivec2 cellVertices[4] = ivec2[4](ivec2(0,0), ivec2(1,0), ivec2(0,1), ivec2(1,1));`).main.add(E`int cellIndex = gl_InstanceID;
int cellX = cellIndex % highlightRenderCellCount[0];
int cellY = (cellIndex - cellX) / highlightRenderCellCount[0];
ivec2 cellPos = ivec2(cellX, cellY);
uvec2 covTexel = uvec2(texelFetch(coverageTexture, cellPos, 0).rg * 255.0);
int channelIndex = (highlightLevel >> 2) & 3;
uint channelValue = covTexel[channelIndex];
int highlightIndex = (highlightLevel & 3) << 1;
bool covered = ((channelValue >> highlightIndex) & 1u) == 1u;
if (!covered) {
gl_Position = vec4(0.0);
return;
}
vOutlinePossible = (((channelValue >> highlightIndex) & 2u) == 2u) ? 1.0 : 0.0;
ivec2 iPosInCell = cellVertices[gl_VertexID];
vec2 sPos = vec2(cellPos * cellSize + iPosInCell * (cellSize));
vec2 vPos = sPos / vec2(highlightTextureResolution);
sUV = vPos;
gl_Position = vec4(2.0 * vPos - vec2(1.0), 0.0, 1.0);`)}const yme=Ye();function oLe(){const t=new Vi;t.include(M6);const{fragment:e}=t;return e.uniforms.add(new It("highlightTexture",i=>i.highlightTexture),new It("highlightOptionsTexture",i=>i.highlightOptionsTexture),new mt("pixelRatio",i=>i.pixelRatio),new mt("occludedIntensityFactor",i=>i.occludedFactor),new Xne("maxHighlightLevel",i=>i.highlights.length-1)),e.constants.add("pixelSampleScale","float",1),t.include(w6),e.code.add(E`const float pascal17[9] = float[9](12870.0, 11440.0, 8008.0, 4368.0, 1820.0, 560.0, 120.0, 16.0, 1.0);
const float denom17 =  65536.0;
float colorWeight[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
float colorOcclusion[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
float weights[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
void applyTexel(vec2 texel, float weight) {
if (texel != vec2(0.0)){
int maxChannel = (maxHighlightLevel >> 2) & 1;
for (int channelIndex = 0; channelIndex <= maxChannel; ++channelIndex){
uint channel = readChannel(texel, channelIndex << 2);
int firstIndex = channelIndex << 2;
int maxIndex  = min(firstIndex + 3, maxHighlightLevel);
for (int highlightIndex = firstIndex; highlightIndex <= maxIndex; ++highlightIndex ) {
uint v = readChannelBits(channel, highlightIndex);
if ((v & 1u) == 1u){
colorWeight[highlightIndex] += weight;
if ((v & 2u) == 2u){
colorOcclusion[highlightIndex] += weight;
}
}
}
}
}
}
vec2 readTexel(ivec2 iuv, int du, int dv) {
return texelFetch(highlightTexture, iuv + ivec2(du, dv), 0).rg;
}
void readAndApplyTexel(ivec2 iuv, int du, int dv, float weight) {
vec2 texel = readTexel(iuv, du, dv);
applyTexel(texel, weight);
}
void readAndApply2TexelsU(ivec2 iuv, int du, int dv, float weight) {
readAndApplyTexel(iuv, -du, dv, weight);
readAndApplyTexel(iuv, +du, dv, weight);
}
float getWeight(int pixelDistance) {
float scaledDistance = float(pixelDistance) * pixelSampleScale / pixelRatio;
float d0f = floor(scaledDistance);
int d0 = int(d0f);
if (d0 >= 8){
return 0.0;
}
float w0 = pascal17[d0];
float w1 = pascal17[d0+1];
float f =  scaledDistance - d0f;
return mix(w0, w1, f);
}`),e.main.add(E`vec2 highlightTextureSize = vec2(textureSize(highlightTexture,0));
ivec2 iuv = ivec2(sUV * highlightTextureSize);
vec2 centerTexel = texelFetch(highlightTexture, iuv, 0).rg;
bool outlinePossible = false;
if (vOutlinePossible > 0.0){
for (int highlightLevel=0; highlightLevel<= maxHighlightLevel; ++highlightLevel) {
if ((readLevelBits(centerTexel,highlightLevel) & 1u) == 0u) {
outlinePossible = true;
break;
}
}
}
if (outlinePossible) {
int maxPixelDistance = clamp(int(8.0 * pixelRatio / pixelSampleScale), 2, 16);
float weightSum = 0.0;
for(int y = 0; y <= maxPixelDistance; ++y) {
float w = getWeight(y);
weights[y] = w;
weightSum += w * (y == 0 ? 1.0 : 2.0);
}
for(int y = 0; y <= maxPixelDistance; ++y) {
weights[y] = weights[y] / weightSum;
}
float weight0 = weights[0];
applyTexel(centerTexel, weight0 * weight0);
for(int y = 0; y <= maxPixelDistance; y += 1) {
float yFactor = weights[y];
if (y != 0) {
float xFactor = weight0;
float weight = xFactor * yFactor;
if (weight > 0.0) {
readAndApplyTexel(iuv, 0, +y, weight);
readAndApplyTexel(iuv, 0, -y, weight);
}
}
for(int x = 1; x <= maxPixelDistance; x += 1) {
float xFactor = weights[x];
float weight = xFactor * yFactor;
if (weight > 0.0) {
readAndApply2TexelsU(iuv, x, +y, weight);
if (y != 0){
readAndApply2TexelsU(iuv, x, -y, weight);
}
}
}
}
} else {
applyTexel(centerTexel, 1.0);
}
int frontColorIndex = 999;
int maxColorIndex = 0;
for (int i = 0; i <= maxHighlightLevel; ++i) {
if (colorWeight[i] > 0.0){
frontColorIndex = min(frontColorIndex, i);
maxColorIndex = max(maxColorIndex, i);
}
}
if (frontColorIndex == 999){
fragColor = vec4(0.0);
return;
}
vec4 accumulatedColor = vec4(0.0);
for (int curColorIndex = frontColorIndex; curColorIndex <= maxColorIndex; ++curColorIndex) {
float curColorWeight = colorWeight[curColorIndex];
if (curColorWeight <= 0.01){
continue;
}
uint vc = readLevelBits(centerTexel, curColorIndex);
bool centerFilled = (vc & 1u) == 1u;
bool centerOccluded = (vc & 3u) == 3u;
float curColorOcclusion = colorOcclusion[curColorIndex];
bool occluded = centerFilled ? centerOccluded : curColorOcclusion > 0.5 * curColorWeight;
int colorChannel = centerFilled ? 0 : 1;
vec4 colorBase = texelFetch(highlightOptionsTexture, ivec2(curColorIndex, colorChannel), 0);
float occlusionFactor = occluded ? occludedIntensityFactor : 1.0;
float outlineFactor = centerFilled ? 1.0 : smoothstep(0.0, 0.03, curColorWeight);
float intensity = colorBase.a * occlusionFactor * outlineFactor;
vec3 currentColor = colorBase.rgb;
float a0 = accumulatedColor.a;
float a1 = intensity;
float alpha = clamp(a0 + a1 - a0 * a1, 0.0, 1.0);
if (alpha > 0.001){
vec3 blendedColor = ((1.0 - a1) * a0 * accumulatedColor.rgb + a1 * currentColor) / alpha;
accumulatedColor = vec4(blendedColor, alpha);
}
}
fragColor = accumulatedColor;`),t}const hyt=Object.freeze(Object.defineProperty({__proto__:null,build:oLe},Symbol.toStringTag,{value:"Module"}));let vme=class extends Hi{constructor(e,i){super(e,i,new Bi(hyt,()=>G(()=>Promise.resolve().then(()=>q6t),void 0)))}initializePipeline(){return wi({blending:Ld,colorWrite:Di})}},_me=class extends Hi{constructor(e,i){super(e,i,new Bi(uyt,()=>G(()=>Promise.resolve().then(()=>W6t),void 0)))}initializePipeline(){return wi({colorWrite:Di})}},dyt=class extends cr{constructor(){super(...arguments),this.occludedFactor=ret,this.verticalCellCount=0,this.horizontalCellCount=0,this.highlightLevel=0,this.pixelRatio=1}};function aLe(){const t=new Vi;t.include(M6),t.include(w6);const{fragment:e}=t;return t.outputs.add("fragSingleHighlight","vec2",0),e.uniforms.add(new It("highlightTexture",i=>i.highlightTexture),new dw("highlightLevel",i=>i.highlightLevel)),e.main.add(E`ivec2 iuv = ivec2(gl_FragCoord.xy);
vec2 inputTexel = texelFetch(highlightTexture, iuv, 0).rg;
uint bits = readLevelBits(inputTexel, highlightLevel);
bool hasHighlight = (bits & 1u) == 1u;
bool hasOccluded  = (bits & 2u) == 2u;
fragSingleHighlight = vec2(hasHighlight ? 1.0 : 0.0, hasOccluded ? 1.0 : 0.0);`),t}const pyt=Object.freeze(Object.defineProperty({__proto__:null,build:aLe},Symbol.toStringTag,{value:"Module"}));let bme=class extends Hi{constructor(e,i){super(e,i,new Bi(pyt,()=>G(()=>Promise.resolve().then(()=>Z6t),void 0)))}initializePipeline(){return wi({colorWrite:Di})}};function lLe(){const t=new Vi;t.include(M6);const{fragment:e}=t;return e.uniforms.add(new It("blurInput",i=>i.singleHighlightBlurTexture),new Qne("blurSize",i=>i.blurSize),new It("highlightTexture",i=>i.highlightTexture),new It("highlightOptionsTexture",i=>i.highlightOptionsTexture),new dw("highlightLevel",i=>i.highlightLevel),new mt("occludedIntensityFactor",i=>i.occludedFactor)),e.constants.add("inner","float",1-(G3-doe)/G3),t.include(w6),e.main.add(E`vec2 highlightTextureSize = vec2(textureSize(highlightTexture,0));
vec2 uv = sUV;
vec2 center = texture(blurInput, uv).rg;
vec2 blurredHighlightValue = (vOutlinePossible == 0.0)
? center
: center * 0.204164
+ texture(blurInput, uv + blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv - blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv + blurSize * 3.294215).rg * 0.093913
+ texture(blurInput, uv - blurSize * 3.294215).rg * 0.093913;
float highlightIntensity = blurredHighlightValue.r;
float occlusionWeight = blurredHighlightValue.g;
if (highlightIntensity <= 0.01) {
discard;
}
vec4 fillColor    = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 0), 0);
vec4 outlineColor = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 1), 0);
vec2 centerTexel = texelFetch(highlightTexture, ivec2(uv * highlightTextureSize), 0).rg;
uint centerBits = readLevelBits(centerTexel, highlightLevel);
bool centerFilled = (centerBits & 1u) == 1u;
bool centerOccluded = (centerBits & 3u) == 3u;
bool occluded = centerOccluded || (0.5 * highlightIntensity < occlusionWeight);
float occlusionFactor = occluded ? occludedIntensityFactor : 1.0;
float outlineFactor = centerFilled ? 1.0 : smoothstep(0.0, inner, highlightIntensity);
float fillFactor = centerFilled ? 1.0 : 0.0;
vec4 baseColor = mix(outlineColor, fillColor, fillFactor);
float intensity = baseColor.a * occlusionFactor * outlineFactor;
fragColor = vec4(baseColor.rgb, intensity);`),t}const fyt=Object.freeze(Object.defineProperty({__proto__:null,build:lLe},Symbol.toStringTag,{value:"Module"}));let wme=class extends Hi{constructor(e,i){super(e,i,new Bi(fyt,()=>G(()=>Promise.resolve().then(()=>Y6t),void 0)))}initializePipeline(){return wi({blending:Ld,colorWrite:Di})}},poe=class extends cr{constructor(){super(...arguments),this.blurSize=Ye()}};function cLe(){const t=new Vi;return t.include(M6),t.outputs.add("fragSingleHighlight","vec2",0),t.fragment.uniforms.add(new Qne("blurSize",e=>e.blurSize),new ag("blurInput",e=>e.blurInput)).main.add(E`vec2 highlightTextureSize = vec2(textureSize(blurInput,0));
vec2 center = texture(blurInput, sUV).rg;
if (vOutlinePossible == 0.0) {
fragSingleHighlight = center;
} else {
vec2 sum = center * 0.204164;
sum += texture(blurInput, sUV + blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, sUV - blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, sUV + blurSize * 3.294215).rg * 0.093913;
sum += texture(blurInput, sUV - blurSize * 3.294215).rg * 0.093913;
fragSingleHighlight = sum;
}`),t}const myt=Object.freeze(Object.defineProperty({__proto__:null,SingleHighlightBlurDrawParameters:poe,build:cLe},Symbol.toStringTag,{value:"Module"}));let xme=class extends Hi{constructor(e,i){super(e,i,new Bi(myt,()=>G(()=>Promise.resolve().then(()=>J6t),void 0)))}initializePipeline(){return wi({colorWrite:Di})}},xf=class{constructor(e,i,r,s,n,o=!1,a=0){this.name=e,this.count=i,this.type=r,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}};const gyt=[],yyt=[new xf(z.POSITION,3,ki.FLOAT,0,12)],uLe=[new xf(z.POSITION,2,ki.FLOAT,0,8)],vyt=[new xf(z.POSITION,2,ki.FLOAT,0,16),new xf(z.UV0,2,ki.FLOAT,8,16)],Sq=()=>J.getLogger("esri.views.webgl.VertexArrayObject");let IL=class{constructor(e,i,r,s,n=null){this._context=e,this._locations=i,this._layout=r,this._buffers=s,this._indexBuffer=n,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Array.from(this._buffers.values()).reduce((e,i)=>e+i.usedMemory,this._indexBuffer!=null?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(this._buffers.size+(this._indexBuffer?1:0))*rne}get cachedMemory(){return this.usedMemory}dispose(){this._context?(this._context.getBoundVAO()===this&&this._context.bindVAO(null),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this._indexBuffer=Dt(this._indexBuffer),this.disposeVAOOnly()):(this._glName||this._buffers.size>0)&&Sq().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(Ws.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:e}=this._context,i=e.createVertexArray();e.bindVertexArray(i),this._bindLayout(),e.bindVertexArray(null),this._glName=i,this._context.instanceCounter.increment(Ws.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:e,_layout:i,_indexBuffer:r}=this;e||Sq().error("Vertex buffer dictionary is empty!");const s=this._context.gl;this._buffers.forEach((n,o)=>{const a=i.get(o);a?jOe(this._context,this._locations,n,a):Sq().error("Vertex element descriptor is empty!")}),r!=null&&s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}},Tg=class extends IL{};const Sme=()=>J.getLogger("esri.views.webgl.BufferObject");let jn=class F1{static createIndex(e,i,r){return new F1(e,ht.ELEMENT_ARRAY_BUFFER,i,r)}static createVertex(e,i,r){return new F1(e,ht.ARRAY_BUFFER,i,r)}static createUniform(e,i,r){return new F1(e,ht.UNIFORM_BUFFER,i,r)}static createPixelPack(e,i=Js.STREAM_READ,r){const s=new F1(e,ht.PIXEL_PACK_BUFFER,i);return r&&s.setSize(r),s}static createPixelUnpack(e,i=Js.STREAM_DRAW,r){return new F1(e,ht.PIXEL_UNPACK_BUFFER,i,r)}static createTransformFeedback(e,i=Js.STATIC_DRAW,r){const s=new F1(e,ht.TRANSFORM_FEEDBACK_BUFFER,i);return s.setSize(r),s}constructor(e,i,r,s){this._context=e,this.bufferType=i,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(Ws.BufferObject,this),this._glName=this._context.gl.createBuffer(),nd(this._context.gl),s&&this.setData(s)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){if(this.bufferType===ht.ELEMENT_ARRAY_BUFFER){if(this._indexType===ki.UNSIGNED_INT)return 4*this._size;if(this._indexType===ki.UNSIGNED_SHORT)return 2*this._size}return this._size}get _isVAOAware(){return this.bufferType===ht.ELEMENT_ARRAY_BUFFER||this.bufferType===ht.ARRAY_BUFFER}dispose(){var e;(e=this._context)!=null&&e.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(Ws.BufferObject,this),this._context=null):this._glName&&Sme().warn("Leaked WebGL buffer object")}setSize(e,i=null){if(this.bufferType===ht.ELEMENT_ARRAY_BUFFER&&i!=null)switch(this._indexType=i,i){case ki.UNSIGNED_SHORT:e*=2;break;case ki.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let i=e.byteLength;this.bufferType===ht.ELEMENT_ARRAY_BUFFER&&(K_(e)?this._indexType=ki.UNSIGNED_BYTE:Rj(e)?(i/=2,this._indexType=ki.UNSIGNED_SHORT):Kte(e)&&(i/=4,this._indexType=ki.UNSIGNED_INT)),this._setBufferData(i,e)}_setBufferData(e,i=null){this._size=e;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;i!=null?s.bufferData(this.bufferType,i,this.usage):s.bufferData(this.bufferType,e,this.usage),nd(s),this._isVAOAware&&this._context.bindVAO(r)}setSubData(e,i,r,s){if(!e)return;const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:o}=this._context;o.bufferSubData(this.bufferType,i*e.BYTES_PER_ELEMENT,e,r,s-r),nd(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(e,i=0,r,s){if(r<0||s<0)return;const n=_yt(e)?e.BYTES_PER_ELEMENT:1;if(n*((r??0)+(s??0))>e.byteLength)return;i+n*(s??0)>this.usedMemory&&Sme().warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this.bufferType===ht.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,ht.TRANSFORM_FEEDBACK_BUFFER),o.getBufferSubData(ht.TRANSFORM_FEEDBACK_BUFFER,i,e,r,s),this._context.unbindBuffer(ht.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,ht.COPY_READ_BUFFER),o.getBufferSubData(ht.COPY_READ_BUFFER,i,e,r,s),this._context.unbindBuffer(ht.COPY_READ_BUFFER))}async getSubDataAsync(e,i=0,r,s){await this._context.clientWaitAsync(),this.getSubData(e,i,r,s)}};function _yt(t){return HVe(t)}let qI=class extends Af{constructor(){super(...arguments),this.produces=dt.HIGHLIGHTS,this.consumes={required:[dt.HIGHLIGHTS,"highlights"]},this._useMultipleHighlights=!1,this._downsampleDrawParameters=new hoe,this._passParameters=new dyt,this._singleHighlightBlurDrawParameters=new poe,this._grid=new byt}initialize(){this.addHandles([H(()=>this._updateOptionsTexture(),()=>{},Ut)])}destroy(){this._grid.coverage=Lr(this._grid.coverage),this._grid.vao=Dt(this._grid.vao),this._passParameters.highlightOptionsTexture=Lr(this._passParameters.highlightOptionsTexture)}_updateOptionsTexture(){if(this._passParameters.highlightOptionsTexture==null){const e=new Ar(16,2);e.internalFormat=Tt.RGBA,e.samplingMode=gi.NEAREST,this._passParameters.highlightOptionsTexture=new pi(this.renderingContext,e,null)}this._passParameters.highlightOptionsTexture.setData(wyt(this.view.state.highlights)),this.requestRender($t.UPDATE)}precompile(){this.techniques.precompile(_me),this._useMultipleHighlights?this.techniques.precompile(vme):(this.techniques.precompile(bme),this.techniques.precompile(xme),this.techniques.precompile(wme))}render(e){const i=e.find(({name:m})=>m===dt.HIGHLIGHTS),{techniques:r,bindParameters:s,_passParameters:n,renderingContext:o}=this;if(!s.decorations)return i;const a=r.get(_me);if(!a.compiled)return this.requestRender($t.UPDATE),i;const l=e.find(({name:m})=>m==="highlights").getTexture(),c=()=>{var _;this._gridUpdateResources(l);const m=this._gridComputeCoverage(a,l,s),{horizontalCellCount:g,verticalCellCount:v}=m;return n.horizontalCellCount=g,n.verticalCellCount=v,n.coverageTexture=(_=m.coverage)==null?void 0:_.getTexture(),m},h=m=>{const g=m.verticalCellCount*m.horizontalCellCount;o.bindVAO(m.vao),o.drawElementsInstanced(Gi.TRIANGLES,6,ki.UNSIGNED_BYTE,0,g)},{camera:d}=s,f=()=>{o.bindFramebuffer(i.fbo),o.setViewport4fv(d.fullViewport)};return this._useMultipleHighlights?this._renderMultiple(l,c,h,f):this._renderSingle(l,c,h,f),n.highlightTexture=null,n.coverageTexture=null,i}_renderMultiple(e,i,r,s){const{techniques:n,bindParameters:o,_passParameters:a,renderingContext:l}=this,c=n.get(vme);if(!c.compiled)return void this.requestRender($t.UPDATE);const h=i();a.highlightTexture=e,a.pixelRatio=o.camera.pixelRatio,l.bindTechnique(c,o,a),s(),r(h)}_renderSingle(e,i,r,s){var D;const{fboCache:n,techniques:o,bindParameters:a,_passParameters:l,renderingContext:c}=this,h=o.get(bme),d=o.get(xme),f=o.get(wme);if(!f.compiled||!d.compiled||!h.compiled)return void this.requestRender($t.UPDATE);const m=i(),{width:g,height:v}=e.descriptor;l.highlightTexture=e;const{camera:_}=a,{fullWidth:b,fullHeight:w,pixelRatio:x}=_,S=Math.ceil(b/x),C=Math.ceil(w/x),{_singleHighlightBlurDrawParameters:T}=this,M=this.view._stage.renderView.renderer,{highlights:I}=a;for(let P=0;P<I.length;++P){const{name:F}=I[P];if(!M.hasHighlightOptions(F))continue;l.highlightLevel=P,c.setClearColor(0,0,0,0);const L=n.acquire(g,v,"single highlight",gr.RG);c.bindFramebuffer(L.fbo),c.setViewport(0,0,g,v),c.clear(Mi.COLOR),c.bindTechnique(h,a,l),r(m),T.blurInput=L.getTexture(),di(T.blurSize,1/S,0);const N=n.acquire(S,C,"single highlight blur h",gr.RG);c.unbindTexture((D=N.fbo)==null?void 0:D.colorTexture),c.bindFramebuffer(N.fbo),c.setViewport(0,0,S,C),c.clear(Mi.COLOR),c.bindTechnique(d,a,l,T),r(m),L.release(),di(T.blurSize,0,1/C),l.singleHighlightBlurTexture=N.getTexture(),s(),c.bindTechnique(f,a,l,T),r(m),N.release()}}_gridUpdateResources(e){const i=this._grid,{width:r,height:s}=e.descriptor;if(i.horizontalCellCount=Math.ceil(r/db),i.verticalCellCount=Math.ceil(s/db),i.vao)return;const n=this.renderingContext,o=jn.createIndex(n,Js.STATIC_DRAW,Tyt);i.vao=new Tg(n,bg,new Map([["geometry",gyt]]),new Map([["geometry",jn.createVertex(n,Js.STATIC_DRAW)]]),o)}_gridComputeCoverage(e,i,r){var h;const s=this.renderingContext,n=this._grid,o=i.descriptor,a=Math.ceil(o.width/db),l=Math.ceil(o.height/db);this._downsampleDrawParameters.input=i,(h=n.coverage)==null||h.release();const c=this.fboCache.acquire(a,l,"highlight coverage",gr.RG);return n.coverage=c,s.bindFramebuffer(c.fbo),s.bindTechnique(e,r,this._passParameters,this._downsampleDrawParameters),s.setViewport(0,0,a,l),s.screen.draw(),n}get test(){}};u([p()],qI.prototype,"produces",void 0),u([p()],qI.prototype,"consumes",void 0),qI=u([A("esri.views.3d.webgl-engine.effects.highlight.Highlight")],qI);let byt=class{constructor(){this.coverage=null,this.vao=null,this.verticalCellCount=0,this.horizontalCellCount=0,this.viewportWidth=0,this.viewportHeight=0}};function wyt(t){const e=new Uint8Array(128);let i=0;for(const r of t){const s=4*i,n=4*i+64;++i;const{color:o}=r,a=r.haloColor??o;e[s+0]=o.r,e[s+1]=o.g,e[s+2]=o.b,e[s+3]=r.fillOpacity*o.a*255,e[n+0]=a.r,e[n+1]=a.g,e[n+2]=a.b,e[n+3]=r.haloOpacity*a.a*255}return e}let xyt=0;function Syt(t){let e=0;for(const r of t){const{name:s}=r;e+=s.length;const{color:n,fillOpacity:o,haloColor:a,haloOpacity:l}=r;e+=n.r+n.g+n.b+n.a+o,e+=a?a.r+a.g+a.b+a.a+l:0}const i=t.at(0);if(i){const{shadowOpacity:r,shadowDifference:s,shadowColor:n}=i;e+=r+s+n.r+n.g+n.b+n.a}return xyt+++(e>=0?0:1)}const Tyt=new Uint8Array([0,1,2,2,1,3]);function hLe(t,e,i,r,s,n=0){const o=r.highlights,a=o.length>1?e.acquire(i.width,i.height,"highlight mix",gr.RG):null;if(a){const c=t.getBoundFramebufferObject();t.bindFramebuffer(a.fbo),t.clearFramebuffer(an),t.bindFramebuffer(c)}const l=a==null?void 0:a.getTexture();r.highlightMixTexture=l,di(r.highlightMixOrigin,n,0),o.forEach((c,h)=>{h>0&&(t.bindTexture(l,pi.TEXTURE_UNIT_FOR_UPDATES),t.gl.copyTexSubImage2D(ns.TEXTURE_2D,0,0,0,n,0,i.width,i.height),t.bindTexture(null,pi.TEXTURE_UNIT_FOR_UPDATES)),t.clear(Mi.DEPTH),r.highlightLevel=h,s()}),r.highlightLevel=null,r.highlightMixTexture=null,a==null||a.release()}let Ov=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,i){var r;return(r=this._outer.get(e))==null?void 0:r.get(i)}getInner(e){return this._outer.get(e)}set(e,i,r){const s=this._outer.get(e);s?s.set(i,r):this._outer.set(e,new Map([[i,r]]))}delete(e,i){const r=this._outer.get(e);r&&(r.delete(i),r.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((i,r)=>e(i,r))}forAll(e){for(const i of this._outer.values())for(const r of i.values())e(r)}},dLe=class{constructor(e,i,r,s){this._textures=e,this._techniques=i,this.materialChanged=r,this.requestRender=s,this._id2glMaterialRef=new Ov}dispose(){this._textures.destroy()}acquire(e,i,r){this._ownMaterial(e);const s=e.produces.get(i);if(!(s!=null&&s(r)))return null;let n=this._id2glMaterialRef.get(r,e.id);if(n==null){const o=e.createGLMaterial({material:e,techniques:this._techniques,textures:this._textures,output:r});n=new Eyt(o),this._id2glMaterialRef.set(r,e.id,n)}return n.ref(),n.glMaterial}release(e,i){const r=this._id2glMaterialRef.get(i,e.id);r!=null&&(r.unref(),r.referenced||(Dt(r.glMaterial),this._id2glMaterialRef.delete(i,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&J.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},Eyt=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,Zt(this._refCnt>=0)}get referenced(){return this._refCnt>0}};function Cyt(t,e){return t==null&&(t=[]),t.push(e),t}function $yt(t,e){if(t==null)return null;const i=t.filter(r=>r!==e);return i.length===0?null:i}function Mti(t,e,i,r,s){fF[0]=t.get(e,0),fF[1]=t.get(e,1),fF[2]=t.get(e,2),qX(fF,Dw,3),i.set(s,0,Dw[0]),r.set(s,0,Dw[1]),i.set(s,1,Dw[2]),r.set(s,1,Dw[3]),i.set(s,2,Dw[4]),r.set(s,2,Dw[5])}const fF=$(),Dw=new Float32Array(6);let foe=class extends bL{get geometries(){return this._geometries}get transformation(){return this._transformation??eo}set transformation(e){this._transformation=_n(this._transformation??qe(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(e){this._shaderTransformation=e?_n(this._shaderTransformation??qe(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}constructor(e={}){super(),this.type=zn.Object,this._shaderTransformation=null,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new pLe),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){Zt(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._emit("geometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const i=this._geometries.splice(e,1)[0];i&&(this._emit("geometryRemoved",{object:this,geometry:i}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(e,i,r=!1){this._emit("attributesChanged",{object:this,geometry:e,attribute:i,sync:r}),xut(i)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const i of this._geometries)i.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new lht;for(const i of this._geometries)i.occludees=Cyt(i.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const i of this._geometries)i.occludees=$yt(i.occludees,e);this._emit("occlusionChanged",this)}highlight(e){const i=new kPe(e);for(const r of this._geometries)r.addHighlight(i);return this._emit("highlightChanged",this),i}removeHighlight(e){for(const i of this._geometries)i.removeHighlight(e);this._emit("highlightChanged",this)}removeStateID(e){e.channel===OS.Highlight?this.removeHighlight(e):this.removeOcclude(e)}getCombinedStaticTransformation(e,i){return Bn(i,this.transformation,e.transformation)}getCombinedShaderTransformation(e,i=qe()){return Bn(i,this.effectiveTransformation,e.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new Tme,this._validateBoundingVolume(this._bvWorldSpace,gP.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new Tme,this._validateBoundingVolume(this._bvObjectSpace,gP.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,i){const r=i===gP.ObjectSpace;for(const s of this._geometries){const n=s.boundingInfo;n&&Ayt(n,e,r?s.transformation:this.getCombinedShaderTransformation(s))}fr(e.bounds,e.min,e.max,.5);for(const s of this._geometries){const n=s.boundingInfo;if(n==null)continue;const o=r?s.transformation:this.getCombinedShaderTransformation(s),a=L3(o);ot(Eme,n.center,o);const l=Sr(Eme,e.bounds),c=n.radius*a;e.bounds[3]=Math.max(e.bounds[3],l+c)}}_invalidateBoundingVolume(){var i;const e=(i=this._bvWorldSpace)==null?void 0:i.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,i){this._parentLayer&&this._parentLayer.events.emit(e,i)}get test(){}},pLe=class{constructor(){this.min=De(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=De(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},Tme=class extends pLe{constructor(){super(...arguments),this.bounds=Ls()}};function Ayt(t,e,i){const r=t.bbMin,s=t.bbMax;if(dG(i)){const n=se(Myt,i[12],i[13],i[14]);oe(yu,r,n),oe(ep,s,n);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],yu[o]),e.max[o]=Math.max(e.max[o],ep[o])}else if(ot(yu,r,i),to(r,s))for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],yu[n]),e.max[n]=Math.max(e.max[n],yu[n]);else{ot(ep,s,i);for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],yu[n],ep[n]),e.max[n]=Math.max(e.max[n],yu[n],ep[n]);for(let n=0;n<3;++n){ne(yu,r),ne(ep,s),yu[n]=s[n],ep[n]=r[n],ot(yu,yu,i),ot(ep,ep,i);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],yu[o],ep[o]),e.max[o]=Math.max(e.max[o],yu[o],ep[o])}}}const Myt=$(),yu=$(),ep=$(),Eme=$();var gP;(function(t){t[t.WorldSpace=0]="WorldSpace",t[t.ObjectSpace=1]="ObjectSpace"})(gP||(gP={}));const Oyt=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];let Lm=class lK{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,i){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new go,this._objectCount=0,i&&(i.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),i.maximumDepth!==void 0&&(this._maximumDepth=i.maximumDepth))}destroy(){this._degenerateObjects.clear(),go.clearPool(),cK[0]=null,k1.prune(),z1.prune()}add(e,i=e.length){this._objectCount+=i,this._grow(e,i);const r=go.acquire();for(let s=0;s<i;s++){const n=e[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(r.init(this._root),this._add(n,r))}go.release(r)}remove(e,i=null){this._objectCount-=e.length;const r=go.acquire();for(const s of e){const n=i??AS(this.objectToBoundingSphere(s),zyt);WI(n[3])?(r.init(this._root),Iyt(s,n,r)):this._degenerateObjects.delete(s)}go.release(r),this._shrink()}update(e,i){if(!WI(i[3])&&this._isDegenerate(e))return;const r=kyt(e);this.remove(r,i),this.add(r)}forEachAlongRay(e,i,r){const s=wf(e,i);Lw(this._root,n=>{if(!Pyt(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),!0})}forEachAlongRayWithVerticalOffset(e,i,r,s){const n=wf(e,i);Lw(this._root,o=>{if(!Dyt(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),!0})}forEach(e){Lw(this._root,i=>{const r=i.node;return r.terminals.forAll(e),r.residents!==null&&r.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,i,r,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=Tq(e,i),h=d=>{if(--n,!s(d))return;const f=this.objectToBoundingSphere(d);if(!hb(r,f))return;const m=R_(e,i,f),g=m-f[3],v=m+f[3];g<o&&(o=g,a=v,l=d)};return Cme(this._root,d=>{if(n<=0||!hb(r,d.bounds)||(re(Eh,c,d.halfSize),oe(Eh,Eh,d.bounds),R_(e,i,Eh)>a))return!1;const f=d.node;return f.terminals.forAll(m=>h(m)),f.residents!==null&&f.residents.forAll(m=>h(m)),!0},e,i),l}forEachInDepthRange(e,i,r,s,n,o,a){let l=-1/0,c=1/0;const h={setRange:v=>{r===lK.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,v.near),c=Math.min(c,v.far)):(l=Math.max(l,-v.far),c=Math.min(c,-v.near))}};h.setRange(s);const d=R_(i,r,e),f=Tq(i,r),m=Tq(i,-r),g=v=>{if(!a(v))return;const _=this.objectToBoundingSphere(v),b=_,w=R_(i,r,b)-d,x=w-_[3],S=w+_[3];x>c||S<l||!hb(o,_)||n(v,h)};Cme(this._root,v=>{if(!hb(o,v.bounds)||(re(Eh,f,v.halfSize),oe(Eh,Eh,v.bounds),R_(i,r,Eh)-d>c)||(re(Eh,m,v.halfSize),oe(Eh,Eh,v.bounds),R_(i,r,Eh)-d<l))return!1;const _=v.node;return _.terminals.forAll(b=>g(b)),_.residents!==null&&_.residents.forAll(b=>g(b)),!0},i,r)}forEachNode(e){Lw(this._root,i=>e(i.node,i.bounds,i.halfSize,i.depth))}forEachNeighbor(e,i){const r=Hm(i),s=i,n=l=>{const c=this.objectToBoundingSphere(l),h=Hm(c),d=r+h;return!(no(c,s)-d*d<=0)||e(l)};let o=!0;const a=l=>{o&&(o=n(l))};Lw(this._root,l=>{const c=Hm(l.bounds),h=r+c;if(no(l.bounds,s)-h*h>0)return!1;const d=l.node;return d.terminals.forAll(a),o&&d.residents!==null&&d.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsObject(e,i){const r=this.objectToBoundingSphere(i);return!(r[3]>0)||ZJ(r,e)}_intersectsObjectWithOffset(e,i,r){const s=this.objectToBoundingSphere(i);return!(s[3]>0)||ZJ(r.applyToBoundingSphere(s),e)}_add(e,i){i.advanceTo(this.objectToBoundingSphere(e))?i.node.terminals.push(e):(i.node.residents.push(e),i.node.residents.length>this._maximumObjectsPerNode&&i.depth<this._maximumDepth&&this._split(i))}_split(e){const i=e.node.residents;e.node.residents=null;for(let r=0;r<i.length;r++){const s=go.acquire().init(e);this._add(i.at(r),s),go.release(s)}}_grow(e,i){if(i!==0&&($me(e,i,r=>this.objectToBoundingSphere(r),zg),WI(zg[3])&&!this._fitsInsideTree(zg)))if(fLe(this._root.node))AS(zg,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const r=this._rootBoundsForRootAsSubNode(zg);this._placingRootViolatesMaxDepth(r)?this._rebuildTree(zg,r):this._growRootAsSubNode(r),go.release(r)}}_rebuildTree(e,i){ne(Cq,i.bounds),Cq[3]=i.halfSize,$me([e,Cq],2,s=>s,$q);const r=go.acquire().init(this._root);this._root.initFrom(null,$q,$q[3]),this._root.increaseHalfSize(1.25),Lw(r,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),go.release(r)}_placingRootViolatesMaxDepth(e){const i=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return Lw(this._root,s=>(r=Math.max(r,s.depth),r+i<=this._maximumDepth)),r+i>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const i=e[3],r=e;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=n[l]-o-(r[l]-i),h=r[l]+i-(n[l]+o),d=Math.max(0,Math.ceil(c/(2*o))),f=Math.max(0,Math.ceil(h/(2*o)))+1,m=2**Math.ceil(Math.log(d+f)*Math.LOG2E);s=Math.max(s,m),mF[l].min=d,mF[l].max=f}for(let l=0;l<3;l++){let c=mF[l].min,h=mF[l].max;const d=(s-(c+h))/2;c+=Math.ceil(d),h+=Math.floor(d);const f=n[l]-o-c*o*2;Eq[l]=f+(h+c)*o}const a=s*o;return Eq[3]=a*gLe,go.acquire().initFrom(null,Eq,a,0)}_growRootAsSubNode(e){const i=this._root.node;ne(zg,this._root.bounds),zg[3]=this._root.halfSize,this._root.init(e),e.advanceTo(zg,null,!0),e.node.children=i.children,e.node.residents=i.residents,e.node.terminals=i.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const i=this._root.node.children;let r=0,s=0;for(;s<i.length&&e==null;)r=s++,e=i[r];for(;s<i.length;)if(i[s++])return-1;return r}_isDegenerate(e){return!WI(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const i=this._root.bounds,r=this._root.halfSize;return e[3]<=r&&e[0]>=i[0]-r&&e[0]<=i[0]+r&&e[1]>=i[1]-r&&e[1]<=i[1]+r&&e[2]>=i[2]-r&&e[2]<=i[2]+r}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:i,_objectCount:r}=this,s=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:i,objectCount:r,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:s}}}_nodeToJSON(e){var n,o;const i=e.children.map(a=>a?this._nodeToJSON(a):null),r=(n=e.residents)==null?void 0:n.map(a=>this.objectToBoundingSphere(a)),s=(o=e.terminals)==null?void 0:o.map(a=>this.objectToBoundingSphere(a));return{children:i,residents:r,terminals:s}}static fromJSON(e){const i=new lK(r=>r,{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return i._objectCount=e.objectCount,i._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),i}},go=class n2{constructor(){this.bounds=Ls(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,i,r,s=this.depth){return this.node=e??n2.createEmptyNode(),i&&AS(i,this.bounds),this.halfSize=r,this.depth=s,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*gLe}advance(e){let i=this.node.children[e];i||(i=n2.createEmptyNode(),this.node.children[e]=i),this.node=i,this.halfSize/=2,this.depth++;const r=mLe[e];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,i,r=!1){for(;;){if(this.isTerminalFor(e))return i&&i(this,-1),!0;if(this.isLeaf()){if(!r)return i&&i(this,-1),!1;this.node.residents=null}const s=this._childIndex(e);i&&i(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const i=this.bounds;return(i[0]<e[0]?1:0)+(i[1]<e[1]?2:0)+(i[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new ii({shrink:!0}),residents:new ii({shrink:!0})}}static acquire(){return n2._pool.acquire()}static release(e){n2._pool.release(e)}static clearPool(){n2._pool.prune()}};function Lw(t,e){let i=go.acquire().init(t);const r=[i];for(;r.length!==0;){if(i=r.pop(),e(i)&&!i.isLeaf())for(let s=0;s<i.node.children.length;s++)i.node.children[s]&&r.push(go.acquire().init(i).advance(s));go.release(i)}}function Cme(t,e,i,r=Lm.DepthOrder.FRONT_TO_BACK){let s=go.acquire().init(t);const n=[s];for(Fyt(i,r,Mme);n.length!==0;){if(s=n.pop(),e(s)&&!s.isLeaf())for(let o=7;o>=0;--o){const a=Mme[o];s.node.children[a]&&n.push(go.acquire().init(s).advance(a))}go.release(s)}}function Iyt(t,e,i){k1.clear();const r=i.advanceTo(e,(s,n)=>{k1.push(s.node),k1.push(n)})?i.node.terminals:i.node.residents;if(r.removeUnordered(t),r.length===0)for(let s=k1.length-2;s>=0&&Ryt(k1.data[s],k1.data[s+1]);s-=2);}function Ryt(t,e){return e>=0&&(t.children[e]=null),!!fLe(t)&&(t.residents===null&&(t.residents=new ii({shrink:!0})),!0)}function Pyt(t,e){return BB(e.bounds,2*-e.halfSize,Gu),BB(e.bounds,2*e.halfSize,Hu),DPe(t.origin,t.direction,Gu,Hu)}function Dyt(t,e,i){return BB(e.bounds,2*-e.halfSize,Gu),BB(e.bounds,2*e.halfSize,Hu),i.applyToMinMax(Gu,Hu),DPe(t.origin,t.direction,Gu,Hu)}function fLe(t){if(t.terminals.length!==0)return!1;if(t.residents!==null)return t.residents.length===0;for(let e=0;e<t.children.length;e++)if(t.children[e])return!1;return!0}function Lyt(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function Nyt(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function BB(t,e,i){i[0]=t[0]+e,i[1]=t[1]+e,i[2]=t[2]+e}function $me(t,e,i,r){if(e===1){const s=i(t[0]);AS(s,r)}else{Gu[0]=1/0,Gu[1]=1/0,Gu[2]=1/0,Hu[0]=-1/0,Hu[1]=-1/0,Hu[2]=-1/0;for(let s=0;s<e;s++){const n=i(t[s]);WI(n[3])&&(Lyt(Gu,n),Nyt(Hu,n))}fr(r,Gu,Hu,.5),r[3]=Math.max(Hu[0]-Gu[0],Hu[1]-Gu[1],Hu[2]-Gu[2])/2}}function Fyt(t,e,i){if(!z1.length)for(let r=0;r<8;++r)z1.push({index:0,distance:0});for(let r=0;r<8;++r){const s=mLe[r];z1.data[r].index=r,z1.data[r].distance=R_(t,e,s)}z1.sort((r,s)=>r.distance-s.distance);for(let r=0;r<8;++r)i[r]=z1.data[r].index}function Tq(t,e){let i,r=1/0;for(let s=0;s<8;++s){const n=R_(t,e,Ame[s]);n<r&&(r=n,i=Ame[s])}return i}function R_(t,e,i){return e*(t[0]*i[0]+t[1]*i[1]+t[2]*i[2])}function WI(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}go._pool=new Ol(go),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(Lm);const mLe=[De(-1,-1,-1),De(1,-1,-1),De(-1,1,-1),De(1,1,-1),De(-1,-1,1),De(1,-1,1),De(-1,1,1),De(1,1,1)],Ame=[De(-1,-1,-1),De(-1,-1,1),De(-1,1,-1),De(-1,1,1),De(1,-1,-1),De(1,-1,1),De(1,1,-1),De(1,1,1)],gLe=Math.sqrt(3),cK=[null];function kyt(t){return cK[0]=t,cK}const Eq=Ls(),Eh=$(),Gu=$(),Hu=$(),k1=new ii,zyt=Ls(),zg=Ls(),Cq=Ls(),$q=Ls(),mF=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],z1=new ii,Mme=[0,0,0,0,0,0,0,0];var Eb;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(Eb||(Eb={}));let yLe=class extends bL{constructor(e,i,r=""){super(),this.stage=e,this.apiLayerUid=r,this.type=zn.Layer,this.events=new Ss,this.visible=!0,this.sliceable=!1,this._objectsAdded=new ii,this._handles=new fg,this._objects=new ii,this._pickable=!0,this.visible=(i==null?void 0:i.visible)??!0,this._pickable=(i==null?void 0:i.pickable)??!0,this.updatePolicy=(i==null?void 0:i.updatePolicy)??Eb.ASYNC,this._disableOctree=(i==null?void 0:i.disableOctree)??!1,e.add(this);for(const s of Oyt)this._handles.add(this.events.on(s,n=>e.handleEvent(s,n)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}get objects(){return this._objects}set pickable(e){this._pickable=e}get pickable(){return this._pickable&&this.visible}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),this._octree!=null&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),this._octree!=null&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const i of e)i.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),this._octree!=null&&this._objectsAdded.pushArray(e)}removeMany(e){const i=new Array;if(this._objects.removeUnorderedMany(e,e.length,i),i.length!==0){for(const r of i)r.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:i}),this._octree!=null){for(let r=0;r<i.length;)this._objectsAdded.removeUnordered(i[r])?(i[r]=i[i.length-1],i.length-=1):++r;this._octree.remove(i)}}}sync(){this.updatePolicy!==Eb.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,i){this._octree==null||this._objectsAdded.includes(e)||this._octree.update(e,i)}getSpatialQueryAccelerator(){return this._octree==null&&this._objects.length>50&&!this._disableOctree?(this._octree=new Lm(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):this._octree!=null&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}invalidateSpatialQueryAccelerator(){this._octree=$e(this._octree),this._objectsAdded.clear()}};function VB(t){return t!=null&&t.type===zn.Layer}var RS,H3;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})(RS||(RS={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(H3||(H3={}));let vu=class extends Zm{constructor(){super(...arguments),this.space=RS.Screen,this.anchor=H3.Center,this.occluder=!1,this.writeDepth=!1,this.hideOnShortSegments=!1,this.hasCap=!1,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.textureCoordinateType=Ys.None,this.emissionSource=Ko.None,this.discardInvisibleFragments=!0,this.occlusionPass=!1,this.hasVvInstancing=!0,this.hasSliceTranslatedView=!0,this.objectAndLayerIdColorInstanced=!1}get draped(){return this.space===RS.Draped}};u([ie({count:RS.COUNT})],vu.prototype,"space",void 0),u([ie({count:H3.COUNT})],vu.prototype,"anchor",void 0),u([ie()],vu.prototype,"occluder",void 0),u([ie()],vu.prototype,"writeDepth",void 0),u([ie()],vu.prototype,"hideOnShortSegments",void 0),u([ie()],vu.prototype,"hasCap",void 0),u([ie()],vu.prototype,"hasTip",void 0),u([ie()],vu.prototype,"vvSize",void 0),u([ie()],vu.prototype,"vvColor",void 0),u([ie()],vu.prototype,"vvOpacity",void 0),u([ie()],vu.prototype,"hasOccludees",void 0),u([ie()],vu.prototype,"terrainDepthTest",void 0),u([ie()],vu.prototype,"cullAboveTerrain",void 0);const Ome=8;function Uyt(t,e){const i=t.vertex;i.uniforms.add(new mt("intrinsicWidth",r=>r.width)),e.vvSize?(t.attributes.add(z.SIZEFEATUREATTRIBUTE,"float"),i.uniforms.add(new $r("vvSizeMinSize",r=>r.vvSize.minSize),new $r("vvSizeMaxSize",r=>r.vvSize.maxSize),new $r("vvSizeOffset",r=>r.vvSize.offset),new $r("vvSizeFactor",r=>r.vvSize.factor)),i.code.add(E`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add(z.SIZE,"float"),i.code.add(E`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add(z.OPACITYFEATUREATTRIBUTE,"float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add(new gd("vvOpacityValues",r=>r.vvOpacity.values,Ome),new gd("vvOpacityOpacities",r=>r.vvOpacity.opacityValues,Ome)),i.code.add(E`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):i.code.add(E`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.include(iS,e),t.attributes.add(z.COLORFEATUREATTRIBUTE,"float"),i.code.add(E`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(t.attributes.add(z.COLOR,"vec4"),i.code.add(E`vec4 getColor(){
return applyOpacity(color);
}`))}let vLe=class{constructor(e,i,r){this._createTexture=e,this._parametersKey=i,this._repository=new Map,this._orphanCache=r.newCache(`procedural-texture-repository:${Td()}`,s=>s.dispose())}destroy(){for(const{texture:e}of this._repository.values())e.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(e,i=null){const r=this._acquire(e);return this.release(i),r}release(e){if(e==null)return;const i=this._parametersKey(e),r=this._repository.get(i);if(r&&(r.refCount--,r.refCount===0)){this._repository.delete(i);const{texture:s}=r;this._orphanCache.put(i,s)}}_acquire(e){if(e==null)return null;const i=this._parametersKey(e),r=this._repository.get(i);if(r)return r.refCount++,r.texture;const s=this._orphanCache.pop(i)??this._createTexture(e),n=new Byt(s);return this._repository.set(i,n),s}},Byt=class{constructor(e){this.texture=e,this.refCount=1}};function Vyt(t,e){return new vLe(i=>{const{encodedData:r,textureSize:s}=jyt(i),n=new Ar;return n.internalFormat=Tt.RGBA,n.width=s,n.height=1,n.wrapMode=ar.REPEAT,new pi(t,n,r)},i=>`${i.pattern.join(",")}-r${i.pixelRatio}`,e)}function jyt(t){const e=moe(t),i=1/t.pixelRatio,r=_Le(t),s=bLe(t),n=(Math.floor(.5*(s-1))+.5)*i,o=[];let a=1;for(const f of e){for(let m=0;m<f;m++){const g=a*(Math.min(m,f-1-m)+.5)*i/n*.5+.5;o.push(g)}a=-a}const l=Math.round(e[0]/2),c=[...o.slice(l),...o.slice(0,l)],h=new Uint8Array(4*r);let d=0;for(const f of c)une(f,h,d),d+=4;return{encodedData:h,textureSize:r}}function moe(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function _Le(t){if(t==null)return 1;const e=moe(t);return Math.floor(e.reduce((i,r)=>i+r))}function bLe(t){return moe(t).reduce((e,i)=>Math.max(e,i))}function Gyt(t){return t==null?an:t.length===4?t:ss(Hyt,t[0],t[1],t[2],1)}const Hyt=yi();function qyt(t,e){if(!e.stippleEnabled)return void t.fragment.code.add(E`float getStippleAlpha() { return 1.0; }
void discardByStippleAlpha(float stippleAlpha, float threshold) {}
vec4 blendStipple(vec4 color, float stippleAlpha) { return color; }`);const i=!(e.draped&&e.stipplePreferContinuous),{vertex:r,fragment:s}=t;s.include(uw),e.draped||(Wb(r,e),r.uniforms.add(new Un("worldToScreenPerDistanceRatio",({camera:n})=>1/n.perScreenPixelRatio)).code.add(E`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),t.varyings.add("vStippleDistanceLimits","vec2"),t.varyings.add("vStipplePatternStretch","float"),r.code.add(E`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${E.float(Zyt)};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),r.code.add(E`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),r.code.add(E`
    if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
  `),TL(r),r.code.add(E`float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
float segmentLengthScreenRounded = flooredRepetitions * patternLength;
float stretch = repetitions / flooredRepetitions;
vStipplePatternStretch = max(0.75, stretch);
return vec2(0.0, segmentLengthScreenRounded);
}
return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
}`),s.uniforms.add(new It("stipplePatternTexture",n=>n.stippleTexture),new mt("stipplePatternSDFNormalizer",n=>Wyt(n.stipplePattern)),new mt("stipplePatternPixelSizeInv",n=>1/wLe(n))),e.stippleOffColorEnabled&&s.uniforms.add(new pc("stippleOffColor",n=>Gyt(n.stippleOffColor))),s.code.add(E`float getStippleSDF(out bool isClamped) {
float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;
float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;
u = fract(u);
float encodedSDF = rgbaTofloat(texture(stipplePatternTexture, vec2(u, 0.5)));
float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;
return (sdf - 0.5) * vStipplePatternStretch + 0.5;
}
float getStippleSDF() {
bool ignored;
return getStippleSDF(ignored);
}
float getStippleAlpha() {
bool isClamped;
float stippleSDF = getStippleSDF(isClamped);
float antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);
return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
}`),s.code.add(E`
    void discardByStippleAlpha(float stippleAlpha, float threshold) {
     ${Te(!e.stippleOffColorEnabled,"if (stippleAlpha < threshold) { discard; }")}
    }

    vec4 blendStipple(vec4 color, float stippleAlpha) {
      return ${e.stippleOffColorEnabled?"mix(color, stippleOffColor, stippleAlpha)":"vec4(color.rgb, color.a * stippleAlpha)"};
    }
  `)}function Wyt(t){return t?(Math.floor(.5*(bLe(t)-1))+.5)/t.pixelRatio:1}function wLe(t){const e=t.stipplePattern;return e?_Le(t.stipplePattern)/e.pixelRatio:1}const Zyt=.4;async function Iv(t,e){const{data:i}=await Ri(t,{responseType:"image",...e});return i}function Yyt(){return Ime??(Ime=(async()=>{const t=await G(()=>import("./basis_transcoder-zaOuheTe.js"),[]),e=await t.default({locateFile:i=>vs(`esri/libs/basisu/${i}`)});return e.initializeBasis(),e})()),Ime}let Ime;var mx;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(mx||(mx={}));let cf=null,gF=null;async function xLe(){return gF==null&&(gF=Yyt(),cf=await gF),gF}function Jyt(t,e){if(cf==null)return t.byteLength;const i=new cf.BasisFile(new Uint8Array(t)),r=TLe(i)?SLe(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),e):0;return i.close(),i.delete(),r}function Xyt(t,e){if(cf==null)return t.byteLength;const i=new cf.KTX2File(new Uint8Array(t)),r=ELe(i)?SLe(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),e):0;return i.close(),i.delete(),r}function SLe(t,e,i,r,s){const n=_se(e?bs.COMPRESSED_RGBA8_ETC2_EAC:bs.COMPRESSED_RGB8_ETC2),o=s&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(i*r*n*o)}function TLe(t){return t.getNumImages()>=1&&!t.isUASTC()}function ELe(t){return t.getFaces()>=1&&t.isETC1S()}async function Kyt(t,e,i){cf==null&&(cf=await xLe());const r=new cf.BasisFile(new Uint8Array(i));if(!TLe(r))return null;r.startTranscoding();const s=CLe(t,e,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(n,o)=>r.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>r.transcodeImage(a,0,n,o,0,0));return r.close(),r.delete(),s}async function Qyt(t,e,i){cf==null&&(cf=await xLe());const r=new cf.KTX2File(new Uint8Array(i));if(!ELe(r))return null;r.startTranscoding();const s=CLe(t,e,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(n,o)=>r.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>r.transcodeImage(a,n,0,0,o,0,-1,-1));return r.close(),r.delete(),s}function CLe(t,e,i,r,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[h,d]=l?r?[mx.ETC2_RGBA,bs.COMPRESSED_RGBA8_ETC2_EAC]:[mx.ETC1_RGB,bs.COMPRESSED_RGB8_ETC2]:c?r?[mx.BC3_RGBA,bs.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[mx.BC1_RGB,bs.COMPRESSED_RGB_S3TC_DXT1_EXT]:[mx.RGBA32,Tt.RGBA],f=e.hasMipmap?i:Math.min(1,i),m=[];for(let g=0;g<f;g++)m.push(new Uint8Array(o(g,h))),a(g,h,m[g]);return e.internalFormat=d,e.hasMipmap=m.length>1,e.samplingMode=e.hasMipmap?gi.LINEAR_MIPMAP_LINEAR:gi.LINEAR,e.width=s,e.height=n,new pi(t,e,{type:"compressed",levels:m})}const yF=()=>J.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),evt=542327876,tvt=131072,ivt=4;function goe(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function rvt(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const svt=goe("DXT1"),nvt=goe("DXT3"),ovt=goe("DXT5"),avt=31,lvt=0,cvt=1,uvt=2,hvt=3,dvt=4,pvt=7,fvt=20,mvt=21;function gvt(t,e,i){const r=yvt(i,e.hasMipmap??!1);if(r==null)throw new Error("DDS texture data is null");const{textureData:s,internalFormat:n,width:o,height:a}=r;return e.samplingMode=s.levels.length>1?gi.LINEAR_MIPMAP_LINEAR:gi.LINEAR,e.hasMipmap=s.levels.length>1,e.internalFormat=n,e.width=o,e.height=a,new pi(t,e,s)}function yvt(t,e){const i=new Int32Array(t.buffer,t.byteOffset,avt);if(i[lvt]!==evt)return yF().error("Invalid magic number in DDS header"),null;if(!(i[fvt]&ivt))return yF().error("Unsupported format, must contain a FourCC code"),null;const r=i[mvt];let s,n;switch(r){case svt:s=8,n=bs.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case nvt:s=16,n=bs.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case ovt:s=16,n=bs.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return yF().error("Unsupported FourCC code:",rvt(r)),null}let o=1,a=i[dvt],l=i[hvt];(3&a||3&l)&&(yF().warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,h=l;let d,f;i[uvt]&tvt&&e!==!1&&(o=Math.max(1,i[pvt]));let m=t.byteOffset+i[cvt]+4;const g=[];for(let v=0;v<o;++v)f=(a+3>>2)*(l+3>>2)*s,d=new Uint8Array(t.buffer,m,f),g.push(d),m+=f,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:g},internalFormat:n,width:c,height:h}}const jB=16;function cv(t){return Math.ceil(t/jB)*jB}function vvt(t){return Math.floor(t/jB)*jB}function _vt(t,e){let n=t.width*t.height;if(n<4096)return t instanceof ImageData?$Le(t):t;let o=t.width,a=t.height;do o=Math.ceil(o/2),a=Math.ceil(a/2),n=o*a;while(n>1048576||e!=null&&(o>e||a>e));return yoe(t,o,a)}function bvt(t,e){const i=Math.max(t.width,t.height);if(i<=e)return t;const r=e/i;return yoe(t,Math.round(t.width*r),Math.round(t.height*r))}function yoe(t,e,i){if(t instanceof ImageData)return yoe($Le(t),e,i);const r=document.createElement("canvas");return r.width=e,r.height=i,r.getContext("2d").drawImage(t,0,0,r.width,r.height),r}function $Le(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");if(i==null)throw new U("Failed to create 2d context from HTMLCanvasElement");return i.putImageData(t,0,0),e}let voe=class extends bL{constructor(e,i){super(),this._data=e,this.type=zn.Texture,this.events=new Ss,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this._parameters={...xvt,...i},this._startPreload(e)}dispose(){this.unload(),this._data=this.frameUpdate=void 0}_startPreload(e){e!=null&&(e instanceof HTMLVideoElement?(this.frameUpdate=i=>this._frameUpdate(e,i),this._startPreloadVideoElement(e)):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(D$(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const i=!e.paused;if(e.src=e.src,i&&e.autoplay){const r=()=>{e.removeEventListener("canplay",r),e.play()};e.addEventListener("canplay",r)}}}_startPreloadImageElement(e){$f(e.src)||D$(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}_createDescriptor(e){const i=new Ar;return i.wrapMode=this._parameters.wrap??ar.REPEAT,i.flipped=!this._parameters.noUnpackFlip,i.samplingMode=this._parameters.mipmap?gi.LINEAR_MIPMAP_LINEAR:gi.LINEAR,i.hasMipmap=!!this._parameters.mipmap,i.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,i.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?e.parameters.maxMaxAnisotropy:1),i}get glTexture(){return this._glTexture}get memoryEstimate(){var e;return((e=this._glTexture)==null?void 0:e.usedMemory)||wvt(this._data,this._parameters)}load(e){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const i=this._data;return i==null?(this._glTexture=new pi(e,this._createDescriptor(e),null),this._glTexture):(this._parameters.reloadable||(this._data=void 0),typeof i=="string"?this._loadFromURL(e,i):i instanceof Image?this._loadFromImageElement(e,i):i instanceof HTMLVideoElement?this._loadFromVideoElement(e,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this._loadFromImage(e,i):K_(i)&&this._parameters.encoding===ab.DDS_ENCODING?this._loadFromDDSData(e,i):VO(i)&&this._parameters.encoding===ab.DDS_ENCODING?this._loadFromDDSData(e,new Uint8Array(i)):(VO(i)||K_(i))&&this._parameters.encoding===ab.KTX2_ENCODING?this._loadFromKTX2(e,i):(VO(i)||K_(i))&&this._parameters.encoding===ab.BASIS_ENCODING?this._loadFromBasis(e,i):K_(i)?this._loadFromPixelData(e,i):VO(i)?this._loadFromPixelData(e,new Uint8Array(i)):null)}_frameUpdate(e,i){return this._glTexture==null||e.readyState<yP.HAVE_CURRENT_DATA||i===e.currentTime?i:(this._glTexture.setData(e),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),e.currentTime)}_loadFromDDSData(e,i){return this._glTexture=gvt(e,this._createDescriptor(e),i),this._glTexture}_loadFromKTX2(e,i){return this._loadAsync(()=>Qyt(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromBasis(e,i){return this._loadAsync(()=>Kyt(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromPixelData(e,i){Zt(this._parameters.width>0&&this._parameters.height>0);const r=this._createDescriptor(e);return r.pixelFormat=this._parameters.components===1?Tt.LUMINANCE:this._parameters.components===3?Tt.RGB:Tt.RGBA,r.width=this._parameters.width??0,r.height=this._parameters.height??0,this._glTexture=new pi(e,r,i),this._glTexture}_loadFromURL(e,i){return this._loadAsync(async r=>{const s=await Iv(i,{signal:r});return gt(r),this._loadFromImage(e,s)})}_loadFromImageElement(e,i){return i.complete?this._loadFromImage(e,i):this._loadAsync(async r=>{const s=await zTe(i,i.src,!1,r);return gt(r),this._loadFromImage(e,s)})}_loadFromVideoElement(e,i){return i.readyState>=yP.HAVE_CURRENT_DATA?this._loadFromImage(e,i):this._loadFromVideoElementAsync(e,i)}_loadFromVideoElementAsync(e,i){return this._loadAsync(r=>new Promise((s,n)=>{const o=()=>{i.removeEventListener("loadeddata",a),i.removeEventListener("error",l),Ji(c)},a=()=>{i.readyState>=yP.HAVE_CURRENT_DATA&&(o(),s(this._loadFromImage(e,i)))},l=h=>{o(),n(h||new U("Failed to load video"))};i.addEventListener("loadeddata",a),i.addEventListener("error",l);const c=Qo(r,()=>l(bi()))}))}_loadFromImage(e,i){let r=i;if(!(r instanceof HTMLVideoElement)){const{maxTextureSize:o}=e.parameters;r=this._parameters.downsampleUncompressed?_vt(r,o):bvt(r,o)}const s=ALe(r);this._parameters.width=s.width,this._parameters.height=s.height;const n=this._createDescriptor(e);return n.pixelFormat=this._parameters.components===3?Tt.RGB:Tt.RGBA,n.width=s.width,n.height=s.height,n.shouldCompress=this._parameters.shouldCompress,this._glTexture=new pi(e,n,r),this._glTexture}_loadAsync(e){const i=new AbortController;this._loadingController=i;const r=e(i.signal);this._loadingPromise=r;const s=()=>{this._loadingController===i&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(s,s),r}unload(){if(this._glTexture=Dt(this._glTexture),this._loadingController!=null){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}get parameters(){return this._parameters}};function wvt(t,e){if(t==null)return 0;if(VO(t)||K_(t))return e.encoding===ab.KTX2_ENCODING?Xyt(t,!!e.mipmap):e.encoding===ab.BASIS_ENCODING?Jyt(t,!!e.mipmap):t.byteLength;const{width:i,height:r}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?ALe(t):e;return(e.mipmap?4/3:1)*i*r*(e.components||4)||0}function ALe(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}var yP;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(yP||(yP={}));const xvt={wrap:{s:ar.REPEAT,t:ar.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1,shouldCompress:!1},MLe=128,fC=.5,kti=D3(fC/2,fC/2,1-fC/2,1-fC/2);function zti(t){return t==="cross"||t==="x"}function Uti(t,e=MLe,i=e*fC,r=0){const s=OLe(t,e,i,r);return new voe(s,{mipmap:!1,wrap:{s:ar.CLAMP_TO_EDGE,t:ar.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0,reloadable:!0})}function OLe(t,e=MLe,i=e*fC,r=0){switch(t){case"circle":default:return Svt(e,i);case"square":return Tvt(e,i);case"cross":return Cvt(e,i,r);case"x":return $vt(e,i,r);case"kite":return Evt(e,i);case"triangle":return Avt(e,i);case"arrow":return Mvt(e,i)}}function Svt(t,e){const i=t/2-.5;return RL(t,PLe(i,i,e/2))}function Tvt(t,e){return ILe(t,e,!1)}function Evt(t,e){return ILe(t,e,!0)}function Cvt(t,e,i=0){return RLe(t,e,!1,i)}function $vt(t,e,i=0){return RLe(t,e,!0,i)}function Avt(t,e){return RL(t,DLe(t/2,e,e/2))}function Mvt(t,e){const i=e,r=e/2,s=t/2,n=.8*i,o=PLe(s,(t-e)/2-n,Math.sqrt(n*n+r*r)),a=DLe(s,i,r);return RL(t,(l,c)=>Math.max(a(l,c),-o(l,c)))}function ILe(t,e,i){return i&&(e/=Math.SQRT2),RL(t,(r,s)=>{let n=r-.5*t+.25,o=.5*t-s-.75;if(i){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*e})}function RLe(t,e,i,r=0){e-=r,i&&(e*=Math.SQRT2);const s=.5*e;return RL(t,(n,o)=>{let a,l=n-.5*t,c=.5*t-o-1;if(i){const h=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=h}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=r/2,a})}function PLe(t,e,i){return(r,s)=>{const n=r-t,o=s-e;return Math.sqrt(n*n+o*o)-i}}function DLe(t,e,i){const r=Math.sqrt(e*e+i*i);return(s,n)=>{const o=Math.abs(s-t)-i,a=n-t+e/2+.75,l=(e*o+i*a)/r,c=-a;return Math.max(l,c)}}function RL(t,e){const i=new Uint8Array(4*t*t);for(let r=0;r<t;r++)for(let s=0;s<t;s++){const n=s+t*r;let o=e(s,r);o=o/t+.5,une(o,i,4*n)}return i}const vP=64,LLe=vP/2,NLe=LLe/5,Ovt=vP/NLe,Bti=.25;function Ivt(t,e){const i=OLe(t,vP,LLe,NLe),r=new Ar;return r.internalFormat=Tt.RGBA,r.width=vP,r.height=vP,r.wrapMode=ar.CLAMP_TO_EDGE,new pi(e,r,i)}function Rvt(t,e){const i=t.vertex;TL(i),i.uniforms.get("markerScale")==null&&i.constants.add("markerScale","float",1),i.constants.add("markerSizePerLineWidth","float",Ovt).code.add(E`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===RS.World&&(i.constants.add("maxSegmentLengthFraction","float",.45),i.uniforms.add(new Un("perRenderPixelRatio",r=>r.camera.perRenderPixelRatio)),i.code.add(E`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}var PS;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(PS||(PS={}));let Cn=class extends Zm{constructor(){super(...arguments),this.capType=PS.BUTT,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.occluder=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.wireframe=!1,this.discardInvisibleFragments=!1,this.objectAndLayerIdColorInstanced=!1,this.textureCoordinateType=Ys.None,this.emissionSource=Ko.None,this.occlusionPass=!1,this.hasVvInstancing=!0,this.hasSliceTranslatedView=!0}};u([ie({count:PS.COUNT})],Cn.prototype,"capType",void 0),u([ie()],Cn.prototype,"hasPolygonOffset",void 0),u([ie()],Cn.prototype,"writeDepth",void 0),u([ie()],Cn.prototype,"draped",void 0),u([ie()],Cn.prototype,"stippleEnabled",void 0),u([ie()],Cn.prototype,"stippleOffColorEnabled",void 0),u([ie()],Cn.prototype,"stipplePreferContinuous",void 0),u([ie()],Cn.prototype,"roundJoins",void 0),u([ie()],Cn.prototype,"applyMarkerOffset",void 0),u([ie()],Cn.prototype,"vvSize",void 0),u([ie()],Cn.prototype,"vvColor",void 0),u([ie()],Cn.prototype,"vvOpacity",void 0),u([ie()],Cn.prototype,"falloffEnabled",void 0),u([ie()],Cn.prototype,"innerColorEnabled",void 0),u([ie()],Cn.prototype,"hasOccludees",void 0),u([ie()],Cn.prototype,"occluder",void 0),u([ie()],Cn.prototype,"terrainDepthTest",void 0),u([ie()],Cn.prototype,"cullAboveTerrain",void 0),u([ie()],Cn.prototype,"wireframe",void 0),u([ie()],Cn.prototype,"discardInvisibleFragments",void 0),u([ie()],Cn.prototype,"objectAndLayerIdColorInstanced",void 0);const q3=1;function FLe(t){const e=new Vi,{attributes:i,varyings:r,vertex:s,fragment:n}=e,{applyMarkerOffset:o,draped:a,output:l,capType:c,stippleEnabled:h,falloffEnabled:d,roundJoins:f,wireframe:m,innerColorEnabled:g}=t;e.include(CL),e.include(Uyt,t),e.include(qyt,t),e.include(Yne,t),e.include(AL,t);const v=o&&!a;v&&(s.uniforms.add(new mt("markerScale",C=>C.markerScale)),e.include(Rvt,{space:RS.World})),Qy(s,t),s.uniforms.add(new $o("inverseProjectionMatrix",C=>C.camera.inverseProjectionMatrix),new $v("nearFar",C=>C.camera.nearFar),new mt("miterLimit",C=>C.join!=="miter"?0:C.miterLimit),new Va("viewport",C=>C.camera.fullViewport)),s.constants.add("LARGE_HALF_FLOAT","float",65500),i.add(z.POSITION,"vec3"),i.add(z.PREVPOSITION,"vec3"),i.add(z.NEXTPOSITION,"vec3"),i.add(z.SUBDIVISIONFACTOR,"float"),i.add(z.UV0,"vec2"),r.add("vColor","vec4"),r.add("vpos","vec3"),r.add("vLineDistance","float"),r.add("vLineWidth","float");const _=h;_&&r.add("vLineSizeInv","float");const b=c===PS.ROUND,w=h&&b,x=d||w;x&&r.add("vLineDistanceNorm","float"),b&&(r.add("vSegmentSDF","float"),r.add("vReverseSegmentSDF","float")),s.code.add(E`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),s.code.add(E`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),s.code.add(E`void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
float vnp = nearFar[0] * 0.99;
if(pos.z > -nearFar[0]) {
if (!isStartVertex) {
if(prev.z < -nearFar[0]) {
pos = mix(prev, pos, interp(vnp, prev, pos));
next = pos;
} else {
pos = vec4(0.0, 0.0, 0.0, 1.0);
}
} else {
if(next.z < -nearFar[0]) {
pos = mix(pos, next, interp(vnp, pos, next));
prev = pos;
} else {
pos = vec4(0.0, 0.0, 0.0, 1.0);
}
}
} else {
if (prev.z > -nearFar[0]) {
prev = mix(pos, prev, interp(vnp, pos, prev));
}
if (next.z > -nearFar[0]) {
next = mix(next, pos, interp(vnp, next, pos));
}
}
forwardViewPosDepth(pos.xyz);
pos = projectAndScale(pos);
next = projectAndScale(next);
prev = projectAndScale(prev);
}`),TL(s),s.constants.add("aaWidth","float",h?0:1).main.add(E`
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;
      float lineSize = getSize();

      if (lineSize < 1.0) {
        coverage = lineSize; // convert sub-pixel coverage to alpha
        lineSize = 1.0;
      }
      lineSize += aaWidth;

      float lineWidth = lineSize * pixelRatio;
      vLineWidth = lineWidth;
      ${_?E`vLineSizeInv = 1.0 / lineSize;`:""}

      vec4 pos  = view * vec4(position, 1.0);
      vec4 prev = view * vec4(prevPosition, 1.0);
      vec4 next = view * vec4(nextPosition, 1.0);
  `),v&&s.main.add(E`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),s.main.add(E`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(h||b)&&s.main.add(E`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${b?E`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),s.main.add(E`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = perpendicular(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),f?s.main.add(E`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = perpendicular(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = perpendicular(endDir);

        float factor = ${h?E`min(1.0, subdivisionFactor * ${E.float((q3+2)/(q3+1))})`:E`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):s.main.add(E`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = perpendicular(joinDisplacementDir);`);const S=c!==PS.BUTT;return s.main.add(E`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = perpendicular(joinDisplacementDir);

      ${S?E`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),s.main.add(E`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;
    float lineDistNorm = sign(uv0.y) * pos.w;

    vLineDistance =  lineWidth * lineDistNorm;
    ${x?E`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),b&&s.main.add(E`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),h&&(a?s.uniforms.add(new Un("worldToScreenRatio",C=>1/C.screenToPCSRatio)):s.main.add(E`vec3 segmentCenter = mix((nextPosition + position) * 0.5, (position + prevPosition) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),s.main.add(E`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(nextPosition - position, position - prevPosition, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),a?s.main.add(E`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):s.main.add(E`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),s.uniforms.add(new mt("stipplePatternPixelSize",C=>wLe(C))),s.main.add(E`float patternLength = lineSize * stipplePatternPixelSize;
vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);
if (segmentLengthScreenDouble >= 0.001) {
vec2 stippleDisplacement = pos.xy - segmentOrigin;
float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);
vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
}
vStippleDistanceLimits *= pos.w;
vStippleDistance *= pos.w;
vStippleDistanceLimits = isJoin ?
vStippleDistanceLimits :
isStartVertex ?
vec2(-1e34, vStippleDistanceLimits.y) :
vec2(vStippleDistanceLimits.x, 1e34);`)),s.main.add(E`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${m&&!a?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }`),e.fragment.include(cb,t),e.include(C6,t),n.include(yM),n.main.add(E`discardBySlice(vpos);
discardByTerrainDepth();`),m?n.main.add(E`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(b&&n.main.add(E`
        float sdf = min(vSegmentSDF, vReverseSegmentSDF);
        vec2 fragmentPosition = vec2(
          min(sdf, 0.0),
          vLineDistance
        ) * gl_FragCoord.w;

        float fragmentRadius = length(fragmentPosition);
        float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
        float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

        if (capCoverage < ${E.float(Kr)}) {
          discard;
        }
      `),w?n.main.add(E`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${E.float(Kr)}, stippleCoverage);
      `):n.main.add(E`float stippleAlpha = getStippleAlpha();`),l!==Y.ObjectAndLayerIdColor&&n.main.add(E`discardByStippleAlpha(stippleAlpha, ${E.float(Kr)});`),n.uniforms.add(new pc("intrinsicColor",C=>C.color)),n.main.add(E`vec4 color = intrinsicColor * vColor;`),g&&(n.uniforms.add(new pc("innerColor",C=>C.innerColor??C.color),new mt("innerWidth",(C,T)=>C.innerWidth*T.camera.pixelRatio)),n.main.add(E`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),n.main.add(E`vec4 finalColor = blendStipple(color, stippleAlpha);`),d&&(n.uniforms.add(new mt("falloff",C=>C.falloff)),n.main.add(E`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)),h||n.main.add(E`float featherStartDistance = max(vLineWidth - 2.0, 0.0);
float value = abs(vLineDistance) * gl_FragCoord.w;
float feather = (value - featherStartDistance) / (vLineWidth - featherStartDistance);
finalColor.a *= 1.0 - clamp(feather, 0.0, 1.0);`)),n.main.add(E`outputColorHighlightOID(finalColor, vpos);`),e}const Pvt=Object.freeze(Object.defineProperty({__proto__:null,build:FLe,ribbonlineNumRoundJoinSubdivisions:q3},Symbol.toStringTag,{value:"Module"}));let Dvt=class extends Hi{constructor(e,i){super(e,i,new Bi(Pvt,()=>G(()=>Promise.resolve().then(()=>X6t),void 0)),kLe),this.primitiveType=i.wireframe?Gi.LINES:Gi.TRIANGLE_STRIP}_makePipelineState(e,i){const{oitPass:r,output:s,hasOccludees:n,hasPolygonOffset:o}=e,a=r===Ti.NONE,l=r===Ti.FrontFace;return wi({blending:ws(s)?Fne(r):null,depthTest:{func:zne(r)},depthWrite:Z3e(e),drawBuffers:s===Y.Depth?{buffers:[Ga.NONE]}:d6(r,s),colorWrite:Di,stencilWrite:n?OB:null,stencilTest:n?i?GX:Gne:null,polygonOffset:a||l?o?Rme:null:kne})}initializePipeline(e){if(e.occluder){const i=e.hasPolygonOffset?Rme:null;this._occluderPipelineTransparent=wi({blending:Ld,polygonOffset:i,depthTest:kfe,depthWrite:null,colorWrite:Di,stencilWrite:null,stencilTest:Fft,drawBuffers:e.output===Y.Depth?{buffers:[Ga.NONE]}:null}),this._occluderPipelineOpaque=wi({blending:Ld,polygonOffset:i,depthTest:kfe,depthWrite:null,colorWrite:Di,stencilWrite:Pft,stencilTest:Nft,drawBuffers:e.output===Y.Depth?{buffers:[Ga.NONE]}:null}),this._occluderPipelineMaskWrite=wi({blending:null,polygonOffset:i,depthTest:Rft,depthWrite:null,colorWrite:null,stencilWrite:OB,stencilTest:GX,drawBuffers:e.output===Y.Depth?{buffers:[Ga.NONE]}:null})}return this._occludeePipeline=this._makePipelineState(e,!0),this._makePipelineState(e,!1)}getPipeline(e,i){if(e)return this._occludeePipeline;switch(i){case xe.TRANSPARENT_OCCLUDER_MATERIAL:return this._occluderPipelineTransparent??super.getPipeline();case xe.OCCLUDER_MATERIAL:return this._occluderPipelineOpaque??super.getPipeline();default:return this._occluderPipelineMaskWrite??super.getPipeline()}}};const Rme={factor:0,units:-4},kLe=new Map([[z.POSITION,0],[z.PREVPOSITION,1],[z.NEXTPOSITION,2],[z.SUBDIVISIONFACTOR,3],[z.UV0,4],[z.COLOR,5],[z.COLORFEATUREATTRIBUTE,5],[z.SIZE,6],[z.SIZEFEATUREATTRIBUTE,6],[z.OPACITYFEATUREATTRIBUTE,7],[z.OBJECTANDLAYERIDCOLOR,8]]);var Lc;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(Lc||(Lc={}));let Lvt=class extends h6{constructor(e){super(e,Fvt),this._configuration=new Cn,this.vertexAttributeLocations=kLe,this.produces=new Map([[xe.OPAQUE_MATERIAL,i=>n6(i)||ws(i)&&this.parameters.renderOccluded===Cr.OccludeAndTransparentStencil],[xe.OPAQUE_MATERIAL_WITHOUT_NORMALS,i=>o6(i)],[xe.OCCLUDER_MATERIAL,i=>lX(i)&&this.parameters.renderOccluded===Cr.OccludeAndTransparentStencil],[xe.TRANSPARENT_OCCLUDER_MATERIAL,i=>lX(i)&&this.parameters.renderOccluded===Cr.OccludeAndTransparentStencil],[xe.TRANSPARENT_MATERIAL,i=>ws(i)&&this.parameters.writeDepth&&this.parameters.renderOccluded!==Cr.OccludeAndTransparentStencil],[xe.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,i=>ws(i)&&!this.parameters.writeDepth&&this.parameters.renderOccluded!==Cr.OccludeAndTransparentStencil],[xe.DRAPED_MATERIAL,i=>ipt(i)]])}getConfiguration(e,i){this._configuration.output=e,this._configuration.oitPass=i.oitPass,this._configuration.draped=i.slot===xe.DRAPED_MATERIAL;const r=this.parameters.stipplePattern!=null&&e!==Y.Highlight;return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&this.parameters.stippleOffColor!=null,this._configuration.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=this.parameters.markerParameters!=null&&zvt(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&this.parameters.innerColor!=null,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.hasOccludees=i.hasOccludees,this._configuration.occluder=this.parameters.renderOccluded===Cr.OccludeAndTransparentStencil,this._configuration.terrainDepthTest=i.terrainDepthTest&&ws(e),this._configuration.cullAboveTerrain=i.cullAboveTerrain,this._configuration.wireframe=this.parameters.wireframe,this._configuration}get visible(){var e;return this.parameters.color[3]>=Kr||this.parameters.stipplePattern!=null&&(((e=this.parameters.stippleOffColor)==null?void 0:e[3])??0)>Kr}intersectDraped({attributes:e,screenToWorldRatio:i},r,s,n,o,a){if(!s.options.selectionMode)return;const l=e.get(z.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const b=e.get(z.SIZEFEATUREATTRIBUTE).data[0];c*=ue(this.parameters.vvSize.offset[0]+b*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const h=n[0],d=n[1],f=(c/2+4)*i;let m=Number.MAX_VALUE,g=0;const v=e.get(z.POSITION).data,_=uK(this.parameters,e)?v.length-2:v.length-5;for(let b=0;b<_;b+=3){const w=v[b],x=v[b+1],S=(b+3)%v.length,C=h-w,T=d-x,M=v[S]-w,I=v[S+1]-x,D=ue((M*C+I*T)/(M*M+I*I),0,1),P=M*D-C,F=I*D-T,L=P*P+F*F;L<m&&(m=L,g=b/3)}m<f*f&&o(a.dist,a.normal,g,!1)}intersect(e,i,r,s,n,o){if(!r.options.selectionMode||!e.visible)return;if(!iht(i))return void J.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=e.attributes,l=a.get(z.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSize){const w=a.get(z.SIZEFEATUREATTRIBUTE).data[0];c*=ue(this.parameters.vvSize.offset[0]+w*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else a.has(z.SIZE)&&(c*=a.get(z.SIZE).data[0]);const h=r.camera,d=Uvt;Vn(d,r.point);const f=c*h.pixelRatio/2+4*h.pixelRatio;se(lO[0],d[0]-f,d[1]+f,0),se(lO[1],d[0]+f,d[1]+f,0),se(lO[2],d[0]+f,d[1]-f,0),se(lO[3],d[0]-f,d[1]-f,0);for(let w=0;w<4;w++)if(!h.unprojectFromRenderScreen(lO[w],Ug[w]))return;Gp(h.eye,Ug[0],Ug[1],Mq),Gp(h.eye,Ug[1],Ug[2],Oq),Gp(h.eye,Ug[2],Ug[3],Iq),Gp(h.eye,Ug[3],Ug[0],Rq);let m=Number.MAX_VALUE,g=0;const v=uK(this.parameters,a)?l.length-2:l.length-5;for(let w=0;w<v;w+=3){Ll[0]=l[w]+i[12],Ll[1]=l[w+1]+i[13],Ll[2]=l[w+2]+i[14];const x=(w+3)%l.length;if(Nl[0]=l[x]+i[12],Nl[1]=l[x+1]+i[13],Nl[2]=l[x+2]+i[14],on(Mq,Ll)<0&&on(Mq,Nl)<0||on(Oq,Ll)<0&&on(Oq,Nl)<0||on(Iq,Ll)<0&&on(Iq,Nl)<0||on(Rq,Ll)<0&&on(Rq,Nl)<0)continue;if(h.projectToRenderScreen(Ll,Fw),h.projectToRenderScreen(Nl,kw),Fw[2]<0&&kw[2]>0){be(Nf,Ll,Nl);const C=h.frustum,T=-on(C[bo.NEAR],Ll)/fe(Nf,C[bo.NEAR]);re(Nf,Nf,T),oe(Ll,Ll,Nf),h.projectToRenderScreen(Ll,Fw)}else if(Fw[2]>0&&kw[2]<0){be(Nf,Nl,Ll);const C=h.frustum,T=-on(C[bo.NEAR],Nl)/fe(Nf,C[bo.NEAR]);re(Nf,Nf,T),oe(Nl,Nl,Nf),h.projectToRenderScreen(Nl,kw)}else if(Fw[2]<0&&kw[2]<0)continue;Fw[2]=0,kw[2]=0;const S=fRe(v5(Fw,kw,Lme),d);S<m&&(m=S,ne(Pme,Ll),ne(Dme,Nl),g=w/3)}const _=r.rayBegin,b=r.rayEnd;if(m<f*f){let w=Number.MAX_VALUE;if(jat(v5(Pme,Dme,Lme),v5(_,b,Bvt),Nw)){be(Nw,Nw,_);const x=Ee(Nw);re(Nw,Nw,1/x),w=x/Sr(_,b)}o(w,Nw,g,!1)}}get _layout(){const e=Bd().vec3f(z.POSITION).vec3f(z.PREVPOSITION).vec3f(z.NEXTPOSITION).f32(z.SUBDIVISIONFACTOR).vec2f(z.UV0);return this.parameters.vvSize?e.f32(z.SIZEFEATUREATTRIBUTE):e.f32(z.SIZE),this.parameters.vvColor?e.f32(z.COLORFEATUREATTRIBUTE):e.vec4f(z.COLOR),this.parameters.vvOpacity&&e.f32(z.OPACITYFEATUREATTRIBUTE),Dd()&&e.vec4u8(z.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new kvt(this._layout,this.parameters)}createGLMaterial(e){return new Nvt(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),e.markerParameters!=null&&(e.markerScale=e.markerParameters.width/e.width)}},Nvt=class extends Rne{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextures.release(this._stipplePattern),this._stipplePattern=null}beginSlot(e){const i=this._material.parameters.stipplePattern;return this._stipplePattern!==i&&(this._material.setParameters({stippleTexture:this._stippleTextures.swap(i,this._stipplePattern)}),this._stipplePattern=i),this.getTechnique(Dvt,e)}},Fvt=class extends amt{constructor(){super(...arguments),this.width=0,this.color=Mse,this.join="miter",this.cap=PS.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.wireframe=!1}get transparent(){var e;return this.color[3]<1||this.stipplePattern!=null&&(((e=this.stippleOffColor)==null?void 0:e[3])??0)<1}},kvt=class{constructor(e,i){this.vertexBufferLayout=e,this._parameters=i,this.numJoinSubdivisions=0;const r=i.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=q3+r}}_isClosed(e){return uK(this._parameters,e)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const r=e.get(z.POSITION).indices.length/2+1,s=this._isClosed(e);let n=s?2:2*2;return n+=((s?r:r-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this._parameters.wireframe&&(n=2+4*(n-2)),n}write(e,i,r,s,n,o){var k,W,j;const a=Vvt,l=jvt,c=Gvt,h=r.get(z.POSITION),d=h.indices,f=h.data.length/3,m=(k=r.get(z.DISTANCETOSTART))==null?void 0:k.data;d&&d.length!==2*(f-1)&&console.warn("RibbonLineMaterial does not support indices");const g=((W=r.get(z.SIZEFEATUREATTRIBUTE))==null?void 0:W.data[0])??((j=r.get(z.SIZE))==null?void 0:j.data[0])??1;let v=[1,1,1,1],_=0;const b=this.vertexBufferLayout.fields.has(z.COLORFEATUREATTRIBUTE);b?_=r.get(z.COLORFEATUREATTRIBUTE).data[0]:r.has(z.COLOR)&&(v=r.get(z.COLOR).data);const w=this.vertexBufferLayout.fields.has(z.OPACITYFEATUREATTRIBUTE),x=w?r.get(z.OPACITYFEATUREATTRIBUTE).data[0]:0,S=new Float32Array(n.buffer),C=Dd()?new Uint8Array(n.buffer):null,T=this.vertexBufferLayout.stride/4;let M=o*T;const I=M;let D=0;const P=m?(B,te,le)=>D=m[le]:(B,te,le)=>D+=Sr(B,te),F=(B,te,le,de,Ae,We,Ue)=>{if(S[M++]=te[0],S[M++]=te[1],S[M++]=te[2],S[M++]=B[0],S[M++]=B[1],S[M++]=B[2],S[M++]=le[0],S[M++]=le[1],S[M++]=le[2],S[M++]=de,S[M++]=Ue,S[M++]=Ae,S[M++]=g,b)S[M++]=_;else{const it=Math.min(4*We,v.length-4);S[M++]=v[it],S[M++]=v[it+1],S[M++]=v[it+2],S[M++]=v[it+3]}w&&(S[M++]=x),Dd()&&(s&&(C[4*M]=s[0],C[4*M+1]=s[1],C[4*M+2]=s[2],C[4*M+3]=s[3]),M++)};M+=T,se(l,h.data[0],h.data[1],h.data[2]),e&&ot(l,l,e);const L=this._isClosed(r);if(L){const B=h.data.length-3;se(a,h.data[B],h.data[B+1],h.data[B+2]),e&&ot(a,a,e)}else se(c,h.data[3],h.data[4],h.data[5]),e&&ot(c,c,e),F(l,l,c,1,Lc.LEFT_CAP_START,0,0),F(l,l,c,1,Lc.RIGHT_CAP_START,0,0),ne(a,l),ne(l,c);const N=L?0:1,R=L?f:f-1;for(let B=N;B<R;B++){const te=(B+1)%f*3;se(c,h.data[te],h.data[te+1],h.data[te+2]),e&&ot(c,c,e),P(a,l,B),F(a,l,c,0,Lc.LEFT_JOIN_END,B,D),F(a,l,c,0,Lc.RIGHT_JOIN_END,B,D);const le=this.numJoinSubdivisions;for(let de=0;de<le;++de){const Ae=(de+1)/(le+1);F(a,l,c,Ae,Lc.LEFT_JOIN_END,B,D),F(a,l,c,Ae,Lc.RIGHT_JOIN_END,B,D)}F(a,l,c,1,Lc.LEFT_JOIN_START,B,D),F(a,l,c,1,Lc.RIGHT_JOIN_START,B,D),ne(a,l),ne(l,c)}L?(se(c,h.data[3],h.data[4],h.data[5]),e&&ot(c,c,e),D=P(a,l,R),F(a,l,c,0,Lc.LEFT_JOIN_END,N,D),F(a,l,c,0,Lc.RIGHT_JOIN_END,N,D)):(D=P(a,l,R),F(a,l,l,0,Lc.LEFT_CAP_END,R,D),F(a,l,l,0,Lc.RIGHT_CAP_END,R,D)),Aq(S,I+T,S,I,T),M=Aq(S,M-T,S,M,T),this._parameters.wireframe&&this._addWireframeVertices(n,I,M,T)}_addWireframeVertices(e,i,r,s){const n=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT,r-i);let a=0;const l=c=>a=Aq(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}};function Aq(t,e,i,r,s){for(let n=0;n<s;n++)i[r++]=t[e++];return r}function uK(t,e){return t.isClosed?e.get(z.POSITION).indices.length>2:!1}function zvt(t){return t.anchor===H3.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const Ll=$(),Nl=$(),Nf=$(),Nw=$(),Uvt=$(),Fw=Qp(),kw=Qp(),Pme=$(),Dme=$(),Lme=Gv(),Bvt=Gv(),Vvt=$(),jvt=$(),Gvt=$(),lO=[Qp(),Qp(),Qp(),Qp()],Ug=[$(),$(),$(),$()],Mq=Gr(),Oq=Gr(),Iq=Gr(),Rq=Gr();let zLe=class{constructor(e){this._originSR=e,this._rootOriginId="root/"+Td(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const i=this._origins.get(this._rootOriginId);if(i==null){const h=kB(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,h),h}const r=this._gridSize,s=Math.round(e[0]/r),n=Math.round(e[1]/r),o=Math.round(e[2]/r),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*r;if(be(Lo,e,i.vec3),Lo[0]=Math.abs(Lo[0]),Lo[1]=Math.abs(Lo[1]),Lo[2]=Math.abs(Lo[2]),Lo[0]<c&&Lo[1]<c&&Lo[2]<c){if(l){const h=Math.max(...Lo);if(be(Lo,e,l.vec3),Lo[0]=Math.abs(Lo[0]),Lo[1]=Math.abs(Lo[1]),Lo[2]=Math.abs(Lo[2]),Math.max(...Lo)<h)return l}return i}return l||(l=kB(s*r,n*r,o*r,a),this._origins.set(a,l)),l}_drawOriginBox(e,i=Yi(1,1,0,1)){const r=window.view,s=r._stage,n=i.toString();if(!this._objects.has(n)){this._material=new Lvt({width:2,color:i}),s.add(this._material);const m=new yLe(s,{pickable:!1}),g=new foe({castShadow:!1});s.add(g),m.add(g),this._objects.set(n,g)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),h=new Array,d=.5*this._gridSize;for(let m=0;m<l;m++)c[3*m]=e[0]+(1&a[m]?d:-d),c[3*m+1]=e[1]+(2&a[m]?d:-d),c[3*m+2]=e[2]+(4&a[m]?d:-d),m>0&&h.push(m-1,m);Gn(c,this._originSR,0,c,r.renderSpatialReference,0,l);const f=new $a(this._material,[[z.POSITION,new Qt(c,h,3,!0)]],null,zn.Line);s.add(f),o.addGeometry(f)}get test(){}};const Lo=$();var fa;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})(fa||(fa={}));var rS;(function(t){t[t.Immediate=0]="Immediate",t[t.FadeWithWeather=1]="FadeWithWeather"})(rS||(rS={}));let Hvt=class{constructor(e,i){this.width=e,this.height=i}},_oe=class{constructor(e){this.shadowMap=e,this.slot=xe.OPAQUE_MATERIAL,this.slicePlane=null,this.hasOccludees=!1,this.enableFillLights=!0,this.oitPass=Ti.NONE,this.alignPixelEnabled=!1,this.decorations=!0,this.overlayStretch=1,this.viewshedEnabled=!1,this._camera=new qr,this._inverseViewport=Ye(),this._oldLighting=new mq,this._newLighting=new mq,this._fadedLighting=new mq,this._lighting=this._newLighting,this.ssr=new qvt,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.highlights=new Array,this.highlightOrderMap=new Map,this.highlightMixOrigin=Ye(),this.highlightMixTexture=null,this.hudRenderStyle=fa.Occluded,this.hudOccludedFragmentOpacity=1,this.clouds=new Kgt,this.shadowHighlightsVisible=!1}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}fadeLighting(){switch(this.clouds.fadeFactor){case 0:this._lighting=this._oldLighting;break;default:this._fadedLighting.lerpLighting(this._oldLighting,this._newLighting,this.clouds.fadeFactor),this._lighting=this._fadedLighting;break;case 1:this._lighting=this._newLighting,this._oldLighting.copyFrom(this._newLighting)}}updateLighting(e,i,r,s){this._oldLighting.copyFrom(this.lighting),this._newLighting.noonFactor=i,this._newLighting.globalFactor=r,this._newLighting.set(e),s===rS.FadeWithWeather&&this.clouds.requestFade(),this.fadeLighting()}get highlight(){return this.highlightLevel==null?null:this.highlights[this.highlightLevel]}},qvt=class{constructor(){this.fadeFactor=1,this.reprojectionMatrix=qe()}},ULe=class{constructor(e,i){this.rctx=e,this.lastFrameCamera=new qr,this.output=Y.Color,this.renderOccludedMask=s$,this.bind=new _oe(i),this.bind.alignPixelEnabled=!0}},Wvt=class extends ULe{constructor(e,i,r){super(e,i),this.techniques=r,this.time=0}};const s$=Cr.Occlude|Cr.OccludeAndTransparent|Cr.OccludeAndTransparentStencil;let ZI=class extends qr{constructor(){super(...arguments),this._projectionMatrix=qe()}get projectionMatrix(){return this._projectionMatrix}};u([p()],ZI.prototype,"_projectionMatrix",void 0),u([p({readOnly:!0})],ZI.prototype,"projectionMatrix",null),ZI=u([A("esri.views.3d.webgl-engine.lib.CascadeCamera")],ZI);var DS;(function(t){t[t.Highlight=0]="Highlight",t[t.ExcludeHighlight=1]="ExcludeHighlight"})(DS||(DS={}));let vF=class{constructor(){this.camera=new ZI,this.lightMat=qe()}},Zvt=class{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}},boe=class{constructor(e,i){this._fbos=e,this._viewingMode=i,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new Zvt,this._projectionView=qe(),this._projectionViewInverse=qe(),this._modelViewLight=qe(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=yi(),this._cascades=[new vF,new vF,new vF,new vF],this._lastOrigin=null,this._maxTextureWidth=Math.min(X("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){var e;return(e=this._handle)==null?void 0:e.getTexture()}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return ss(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeOffscreenBuffers(){this._handle=Lr(this._handle),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=ue(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}get cascades(){for(let e=0;e<this._numCascades;++e)Dq[e]=this._cascades[e];return Dq.length=this._numCascades,Dq}start(e,i,r,s,n){Zt(this.enabled);const{near:o,far:a}=e0t(r);this._computeCascadeDistances(o,a,s),this._textureHeight=this._computeTextureHeight(e,n,s),this._setupMatrices(e,i);const{viewMatrix:l,projectionMatrix:c}=e;for(let h=0;h<this._numCascades;++h)this._constructCascade(h,c,l,i);this._lastOrigin=null,this.clear()}finish(){var e;Zt(this.enabled),(e=this._handle)==null||e.detachDepth()}getShadowMapMatrices(e){if(!this._lastOrigin||!to(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||$(),ne(this._lastOrigin,e);for(let i=0;i<this._numCascades;++i){uh(Bme,this._cascades[i].lightMat,e);for(let r=0;r<16;++r)Vme[16*i+r]=Bme[r]}}return Vme}moveSnapshot(e){var i,r;Zt(this.enabled),(i=this._handle)==null||i.detachDepth(),(r=this._snapshots[e])==null||r.release(),this._snapshots[e]=this._handle,this._handle=null,this.clear()}copySnapshot(e){var l,c,h,d;const i=(c=(l=this._handle)==null?void 0:l.getTexture())==null?void 0:c.descriptor;if(!this.enabled||!i)return;(h=this._snapshots[e])==null||h.release();const{width:r,height:s}=i,n=e===DS.Highlight?"shadow highlight snapshot":"shadow no highlight snapshot";this._snapshots[e]=this._fbos.acquire(r,s,n,gr.RGBA4);const o=this._fbos.rctx;this._bindFbo();const a=o.bindTexture((d=this._snapshots[e])==null?void 0:d.getTexture(),pi.TEXTURE_UNIT_FOR_UPDATES);o.gl.copyTexSubImage2D(ns.TEXTURE_2D,0,0,0,0,0,r,s),o.bindTexture(a,pi.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(e){var i;return this.enabled?(i=this._snapshots[e])==null?void 0:i.getTexture():null}clear(){const e=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),e.setClearColor(1,1,1,1),e.clear(Mi.COLOR|Mi.DEPTH)}_computeTextureHeight(e,i,r){const s=Math.min(window.devicePixelRatio,i)/e.pixelRatio,n=r?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,o=cv(Math.floor(Math.max(e.fullWidth,e.fullHeight)*s*n)),a=Math.min(this._maxTextureWidth,this._numCascades*o);return vvt(a/this._numCascades)}_ensureFbo(){var e,i,r,s,n;((i=(e=this._handle)==null?void 0:e.fbo)==null?void 0:i.width)===this._textureWidth&&((r=this._handle)==null?void 0:r.fbo.height)===this._textureHeight||((s=this._handle)==null||s.release(),this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",gr.RGBA4)),(n=this._handle)==null||n.acquireDepth(Ho.DEPTH16_BUFFER)}_discardSnapshot(e){this._snapshots[e]=Lr(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){var e;this._fbos.rctx.bindFramebuffer((e=this._handle)==null?void 0:e.fbo)}_constructCascade(e,i,r,s){const n=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],l=(i[10]*o+i[14])/Math.abs(i[11]*o+i[15]),c=(i[10]*a+i[14])/Math.abs(i[11]*a+i[15]);Zt(l<c);for(let m=0;m<8;++m){ss(Nme,m%4==0||m%4==3?-1:1,m%4==0||m%4==1?-1:1,m<4?l:c,1);const g=Yh[m];eu(g,Nme,this._projectionViewInverse),g[0]/=g[3],g[1]/=g[3],g[2]/=g[3]}Cd(Pq,Yh[0]),n.camera.viewMatrix=uh(Yvt,this._modelViewLight,Pq);for(let m=0;m<8;++m)ot(Yh[m],Yh[m],n.camera.viewMatrix);let h=Yh[0][2],d=Yh[0][2];for(let m=1;m<8;++m)h=Math.min(h,Yh[m][2]),d=Math.max(d,Yh[m][2]);h-=200,d+=200,n.camera.near=-d,n.camera.far=-h,Qvt(r,s,h,d,n.camera),Bn(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const f=this._textureHeight;n.camera.viewport=[e*f,0,f,f]}_setupMatrices(e,i){Bn(this._projectionView,e.projectionMatrix,e.viewMatrix),$l(this._projectionViewInverse,this._projectionView);const r=this._viewingMode===je.Global?e.eye:se(Pq,0,0,1);hG(this._modelViewLight,[0,0,0],[-i[0],-i[1],-i[2]],r)}_computeCascadeDistances(e,i,r){const s=r?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(tht(i/e,4)),s);const n=(i-e)/this._numCascades,o=(i/e)**(1/this._numCascades);let a=e,l=e;for(let c=0;c<this._numCascades+1;++c)this._cascadeDistances[c]=ft(a,l,this.settings.splitSchemeLambda),a*=o,l+=n}get test(){}};const Yvt=qe(),Nme=yi(),Yh=[];for(let t=0;t<8;++t)Yh.push(yi());const Fme=Ye(),kme=Ye(),Jvt=Ye(),zme=Ye(),Ume=Ye(),Pq=$(),Dq=[],Bme=qe(),Vme=eo.concat(eo,eo,eo,eo),_u=Ye(),KT=Ye(),zw=[Ye(),Ye(),Ye(),Ye()],qn=Ye(),Lq=Ye(),T0=Ye(),cO=Ye(),QT=Ye(),eE=Ye(),_F=Ye();function Xvt(t,e,i,r,s,n,o,a){di(_u,0,0);for(let C=0;C<4;++C)Oy(_u,_u,t[C]);md(_u,_u,.25),di(KT,0,0);for(let C=4;C<8;++C)Oy(KT,KT,t[C]);md(KT,KT,.25),rd(zw[0],t[4],t[5],.5),rd(zw[1],t[5],t[6],.5),rd(zw[2],t[6],t[7],.5),rd(zw[3],t[7],t[4],.5);let l=0,c=sA(zw[0],_u);for(let C=1;C<4;++C){const T=sA(zw[C],_u);T<c&&(c=T,l=C)}fd(qn,zw[l],t[l+4]);const h=qn[0];let d,f;qn[0]=-qn[1],qn[1]=h,fd(Lq,KT,_u),jo(Lq,qn)<0&&Zre(qn,qn),rd(qn,qn,Lq,i),A3(qn,qn),d=f=jo(fd(T0,t[0],_u),qn);for(let C=1;C<8;++C){const T=jo(fd(T0,t[C],_u),qn);T<d?d=T:T>f&&(f=T)}Vn(r,_u),md(T0,qn,d-e),Oy(r,r,T0);let m=-1,g=1,v=0,_=0;for(let C=0;C<8;++C){fd(cO,t[C],r),A3(cO,cO);const T=qn[0]*cO[1]-qn[1]*cO[0];T>0?T>m&&(m=T,v=C):T<g&&(g=T,_=C)}UT(m>0,"leftArea"),UT(g<0,"rightArea"),md(QT,qn,d),Oy(QT,QT,_u),md(eE,qn,f),Oy(eE,eE,_u),_F[0]=-qn[1],_F[1]=qn[0];const b=eF(r,t[_],eE,Oy(T0,eE,_F),1,s),w=eF(r,t[v],eE,T0,1,n),x=eF(r,t[v],QT,Oy(T0,QT,_F),1,o),S=eF(r,t[_],QT,T0,1,a);UT(b,"rayRay"),UT(w,"rayRay"),UT(x,"rayRay"),UT(S,"rayRay")}function Ni(t,e){return 3*e+t}const jme=Ye();function wc(t,e){return di(jme,t[e],t[e+3]),jme}const Fl=Ye(),et=Ts();function Kvt(t,e,i,r,s){fd(Fl,i,r),md(Fl,Fl,.5),et[0]=Fl[0],et[1]=Fl[1],et[2]=0,et[3]=Fl[1],et[4]=-Fl[0],et[5]=0,et[6]=Fl[0]*Fl[0]+Fl[1]*Fl[1],et[7]=Fl[0]*Fl[1]-Fl[1]*Fl[0],et[8]=1,et[Ni(0,2)]=-jo(wc(et,0),t),et[Ni(1,2)]=-jo(wc(et,1),t);let n=jo(wc(et,0),i)+et[Ni(0,2)],o=jo(wc(et,1),i)+et[Ni(1,2)],a=jo(wc(et,0),r)+et[Ni(0,2)],l=jo(wc(et,1),r)+et[Ni(1,2)];n=-(n+a)/(o+l),et[Ni(0,0)]+=et[Ni(1,0)]*n,et[Ni(0,1)]+=et[Ni(1,1)]*n,et[Ni(0,2)]+=et[Ni(1,2)]*n,n=1/(jo(wc(et,0),i)+et[Ni(0,2)]),o=1/(jo(wc(et,1),i)+et[Ni(1,2)]),et[Ni(0,0)]*=n,et[Ni(0,1)]*=n,et[Ni(0,2)]*=n,et[Ni(1,0)]*=o,et[Ni(1,1)]*=o,et[Ni(1,2)]*=o,et[Ni(2,0)]=et[Ni(1,0)],et[Ni(2,1)]=et[Ni(1,1)],et[Ni(2,2)]=et[Ni(1,2)],et[Ni(1,2)]+=1,n=jo(wc(et,1),e)+et[Ni(1,2)],o=jo(wc(et,2),e)+et[Ni(2,2)],a=jo(wc(et,1),i)+et[Ni(1,2)],l=jo(wc(et,2),i)+et[Ni(2,2)],n=-.5*(n/o+a/l),et[Ni(1,0)]+=et[Ni(2,0)]*n,et[Ni(1,1)]+=et[Ni(2,1)]*n,et[Ni(1,2)]+=et[Ni(2,2)]*n,n=jo(wc(et,1),e)+et[Ni(1,2)],o=jo(wc(et,2),e)+et[Ni(2,2)],a=-o/n,et[Ni(1,0)]*=a,et[Ni(1,1)]*=a,et[Ni(1,2)]*=a,s[0]=et[0],s[1]=et[1],s[2]=0,s[3]=et[2],s[4]=et[3],s[5]=et[4],s[6]=0,s[7]=et[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=et[6],s[13]=et[7],s[14]=0,s[15]=et[8]}function Qvt(t,e,i,r,s){const n=1/Yh[0][3],o=1/Yh[4][3];Zt(n<o);let a=n+Math.sqrt(n*o);const l=Math.sin(Ja(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,Xvt(Yh,a,l,Fme,kme,Jvt,zme,Ume),Kvt(Fme,kme,zme,Ume,s.projectionMatrix),s.projectionMatrix[10]=2/(i-r),s.projectionMatrix[14]=-(i+r)/(i-r)}function e0t(t){let{near:e,far:i}=t;return e<2&&(e=2),i<2&&(i=2),e>=i&&(e=2,i=4),{near:e,far:i}}let Gme=class extends Hi{constructor(e,i){super(e,i,new Bi(lyt,()=>G(()=>Promise.resolve().then(()=>K6t),void 0)))}initializePipeline(e){return e.hasAlpha?wi({blending:Ld,colorWrite:Di}):wi({colorWrite:Di})}},BLe=class extends hu{constructor(){super(...arguments),this.hasAlpha=!1}};u([ie()],BLe.prototype,"hasAlpha",void 0);let woe=class extends cr{constructor(){super(...arguments),this.overlayIndex=Dn.INNER,this.opacity=1}};function VLe(){const t=new Vi;return t.include(ia),t.fragment.uniforms.add(new It("tex",e=>e.texture)),t.fragment.uniforms.add(new dw("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new mt("opacity",e=>e.opacity)),t.fragment.main.add(E`vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;`),t}const t0t=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:woe,build:VLe},Symbol.toStringTag,{value:"Module"}));let Hme=class extends Hi{constructor(e,i){super(e,i,new Bi(t0t,()=>G(()=>Promise.resolve().then(()=>Q6t),void 0)))}},om=class extends OL{constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new woe,this.hasHighlights=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new ii,this._passParameters=new uoe,this._materials=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new qr,this.events=new Ss,this.longitudeCyclical=null,this.produces=new Map([[xe.DRAPED_MATERIAL,i=>i!==Y.Highlight||this.hasHighlights],[xe.DRAPED_WATER,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const e=this._view,i=e._stage,r=i.renderer.fboCache,{waterTextures:s,textures:n}=i.renderView;this._renderContext=new ULe(this._rctx,new boe(r,e.state.viewingMode)),this.addHandles([H(()=>s.updating,()=>this.events.emit("content-changed"),Mt),H(()=>this.spatialReference,l=>this._localOriginFactory=new zLe(l),Mt),so(()=>e.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0),H(()=>Syt(e.state.highlights),()=>this._sortedDrapeSourceRenderersDirty=!0,Ut),H(()=>e.state.highlights,l=>{this._bindParameters.highlights=l,this._bindParameters.highlightOrderMap=e.state.highlightOrderMap,this._updateHighlights()},Ut),e.resourceController.scheduler.registerTask(lt.STAGE,this)]),this._materials=new dLe(n,this._techniques,()=>{this.notifyChange("rendersOccludedDraped"),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed"));const{_bindParameters:o,_camera:a}=this;a.near=1,a.far=1e4,a.relativeElevation=null,o.slot=xe.DRAPED_MATERIAL,o.mainDepth=null,o.camera=a,o.oitPass=Ti.NONE,o.updateLighting([new ioe(sre())],0,0,rS.Immediate)}destroy(){this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._passParameters.texture=Dt(this._passParameters.texture),this.disposeOverlays()}get _bindParameters(){return this._renderContext.bind}get _rctx(){return this._stage.renderView.renderingContext}get _view(){return this.parent.view}get _stage(){return this.parent.view._stage}get spatialReference(){return this.parent.spatialReference}get _techniques(){return this._stage.renderView.techniques}get rctx(){return this._rctx}get materials(){return this._materials}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}get pluginContext(){return this._pluginContext}initializeRenderContext(e){this._pluginContext=e,this._techniques.precompile(Hme)}uninitializeRenderContext(){}acquireTechniques(){return[]}render(){}get updating(){return this._sortedDrapeSourceRenderersDirty||$m(this._renderers,e=>e.updating)}get hasOverlays(){return this._overlays!=null&&this._renderTargets!=null}getMaterialRenderer(e){for(const i of this._renderers.values()){const r=i.getMaterialRenderer(e);if(r)return r}return null}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map(e=>e.drapeSource.layer).filter(e=>!!e)}_updateHighlights(){const e=this._view.state;this._renderers.forEach(i=>i.updateHighlights(e.highlightOrderMap))}createDrapeSourceRenderer(e,i,r){const s=this._renderers.get(e);s!=null&&s.destroy();const n=new i({...r,rendererContext:this,drapeSource:e});return this._renderers.set(e,n),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles(H(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),n}removeDrapeSourceRenderer(e){if(e==null)return;const i=this._renderers.get(e);i!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),i.destroy())}computeValidity(){var e;return((e=this._renderTargets)==null?void 0:e.computeValidity())??0}releaseRenderTargets(){var e;(e=this._renderTargets)==null||e.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&qR(e,i=>i.drapeTargetType===QX.WithoutRasterImage)}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=qR(e,i=>i.drapeSourceType===dC.Features),this._hasDrapedRasterSource=qR(e,i=>i.drapeSourceType===dC.RasterImage)):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,i,r=this._bindParameters.overlayStretch){this._overlays==null&&(this._renderTargets=new Cgt(this._stage.renderer.fboCache),this._overlays=[new nme,new nme]),this.ensureDrapeTargets(e),this.ensureDrapeSources(i),this._bindParameters.overlayStretch=r}disposeOverlays(){this._overlays=null,this._renderTargets=Dt(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){var i,r;if(e!=null)return e===sr.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?(i=this._renderTargets)==null?void 0:i.getTexture(sr.Color):(r=this._renderTargets)==null?void 0:r.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,i){let r=!1;for(const[s,n]of this._renderers){if(e.done)break;(s.destroyed||i(s))&&n.commitChanges(this._view.state.highlightOrderMap)&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=$m(this._renderers,s=>s.hasHighlights),this.notifyChange("rendersOccludedDraped"))}hasHighlightOptions(e){return $m(this._renderers,i=>i.hasHighlightOptions(e))}processSyncDrapeSources(){this._processDrapeSources(Kc,e=>e.updatePolicy===Eb.SYNC)}get isEmpty(){return!xs.OVERLAY_DRAW_DEBUG_TEXTURE&&!$m(this._renderers,e=>!e.isEmpty)}get hasWater(){const e=$m(this._renderers,i=>i.hasWater);return e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water")),this._hasWater}get rendersOccludedDraped(){const e=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=_P,++this._techniques.precompiling;const i=this._sortedRenderers.some(({renderer:r})=>r.precompile(this._renderContext));return--this._techniques.precompiling,this._renderContext.renderOccludedMask=e,i}renders(e){if(xs.OVERLAY_DRAW_DEBUG_TEXTURE&&e!==sr.Occluded&&e!==sr.Highlight)return!0;++this._techniques.precompiling;const i=this._sortedRenderers.some(({renderer:r})=>r.precompile(this._renderContext));return--this._techniques.precompiling,i}get mode(){var e;return this.isEmpty?Dm.Disabled:this.hasWater&&this.renders(sr.WaterNormal)?Dm.EnabledWithWater:(e=this._renderTargets)!=null&&e.getTexture(sr.Color)?Dm.Enabled:Dm.Disabled}updateAnimation(e){let i=!1;return this._renderers.forEach(r=>i=r.updateAnimation(e)||i),i&&this.parent.requestRender($t.BACKGROUND),i}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}precompileShaders(e){if(this._renderTargets){this._bindParameters.alignPixelEnabled=e.alignPixelEnabled,++this._techniques.precompiling;for(const i of this._renderTargets.targets){if(i.content===sr.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const r=i.output;this._renderContext.output=r,this._bindParameters.slot=r===Y.Normal?xe.DRAPED_WATER:xe.DRAPED_MATERIAL,i.content===sr.Occluded&&(this._renderContext.renderOccludedMask=_P),this._sortedRenderers.forAll(({drapeSource:s,renderer:n})=>{i.content===sr.ColorNoRasterImage&&s.drapeSourceType===dC.RasterImage||n.precompile(this._renderContext)}),this._renderContext.renderOccludedMask=s$}--this._techniques.precompiling}}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const i of this._overlays)this.longitudeCyclical?i.setupGeometryViewsCyclical(this.longitudeCyclical):i.setupGeometryView();this._bindParameters.alignPixelEnabled=e.alignPixelEnabled;for(const i of this._renderTargets.targets){if(i.content===sr.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const r=this._drawTarget(Dn.INNER,i),s=this._drawTarget(Dn.OUTER,i);(r||s)&&i.fbo.generateMipMap()}}}_drawTarget(e,i){const r=this._overlays[e],s=r.canvasGeometries;if(s.numViews===0)return!1;const n=this._view.state.contentPixelRatio;this._screenToWorldRatio=n*r.mapUnitsPerPixel/this._bindParameters.overlayStretch;const o=i.output;if(this.isEmpty||o===Y.Normal&&!this.hasWater||!r.hasSomeSizedView())return!1;const{_rctx:a,_camera:l,_renderContext:c,_bindParameters:h}=this;if(l.pixelRatio=r.pixelRatio*n,c.output=o,h.screenToWorldRatio=this._screenToWorldRatio,h.screenToPCSRatio=this._screenToWorldRatio*this.parent.worldToPCSRatio,h.slot=o===Y.Normal?xe.DRAPED_WATER:xe.DRAPED_MATERIAL,i.content===sr.Occluded&&(c.renderOccludedMask=_P),!this.renders(i.content))return c.renderOccludedMask=s$,!1;const{resolution:d}=r,f=e===Dn.INNER?0:d;if(a.setViewport(f,0,d,d),this._bindTargetFBO(i),e===Dn.INNER&&(a.setClearColor(0,0,0,0),a.clear(Mi.COLOR)),xs.OVERLAY_DRAW_DEBUG_TEXTURE&&i.content!==sr.Occluded&&i.content!==sr.Highlight){this._techniques.precompile(Gme,hK);const m=this._techniques.get(Gme,hK);for(let g=0;g<s.numViews;g++)this._setViewParameters(s.extents[g],r),this._ensureDebugPatternResources(r.resolution,r0t[e]),a.bindTechnique(m,h,this._passParameters),a.screen.draw()}if(i.output===Y.Highlight){const{fboCache:m}=this._stage.renderer,g=this._resolution;this._bindTargetFBO(i),hLe(a,m,{width:g,height:g},h,()=>this._renderAllGeometry(e,i),f)}else this._renderAllGeometry(e,i);return a.bindFramebuffer(null),c.renderOccludedMask=s$,!0}_renderAllGeometry(e,i){const r=this._overlays[e],s=r.canvasGeometries;this._sortedRenderers.forAll(({drapeSource:n,renderer:o})=>{if(i.content===sr.ColorNoRasterImage&&n.drapeSourceType===dC.RasterImage)return;const{fullOpacity:a}=n,l=a!=null&&a<1&&i.output===Y.Color&&this._bindTemporaryFBO();for(let c=0;c<s.numViews;c++)this._setViewParameters(s.extents[c],r),o.render(this._renderContext);if(l){this._bindTargetFBO(i),this._overlayParameters.texture=l.getTexture(),this._overlayParameters.opacity=a,this._overlayParameters.overlayIndex=e;const c=this._techniques.get(Hme);this._rctx.bindTechnique(c,this._bindParameters,this._overlayParameters),this._rctx.screen.draw(),l.release()}})}_bindTargetFBO(e){const i=this._resolution,r=2*i;e.fbo.bind(this._rctx,r,i)}_bindTemporaryFBO(){const e=this._resolution,i=2*e,r=this._stage.renderer.fboCache,s=r.acquire(i,e,"overlay tmp");return r.rctx.bindFramebuffer(s.fbo),r.rctx.clear(Mi.COLOR),s}get _resolution(){var e;return((e=this._overlays)==null?void 0:e[Dn.INNER].resolution)??0}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,i,r,s){var o;this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let n=0;for(const{renderer:a}of this._sortedRenderers)n=((o=a.intersect)==null?void 0:o.call(a,e,i,r,s,n))??n}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this._view.map.allLayers,i=e.length;this._renderers.forEach((r,s)=>{const n=e.indexOf(s.layer),o=n>=0,a=s.renderGroup??(o?FB.MapLayer:FB.ViewLayer),l=i*a+(o?n:0);this._sortedRenderers.push(new i0t(s,r,l))}),this._sortedRenderers.sort((r,s)=>r.index-s.index)}_setViewParameters(e,i){const r=this._camera;r.viewport=[0,0,i.resolution,i.resolution],w$e(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),xre(r.viewMatrix,[-e[0],-e[1],0])}_ensureDebugPatternResources(e,i){if(se(this._passParameters.color,i[0],i[1],i[2]),this._passParameters.texture)return;const r=new Uint8Array(e*e*4);let s=0;for(let o=0;o<e;o++)for(let a=0;a<e;a++){const l=Math.floor(a/10),c=Math.floor(o/10);l<2||c<2||10*l>e-20||10*c>e-20?(r[s++]=255,r[s++]=255,r[s++]=255,r[s++]=255):(r[s++]=255,r[s++]=255,r[s++]=255,r[s++]=1&l&&1&c?1&a^1&o?0:255:1&l^1&c?0:128)}const n=new Ar(e);n.samplingMode=gi.NEAREST,this._passParameters.texture=new pi(this._rctx,n,r)}get test(){}};u([p()],om.prototype,"hasHighlights",void 0),u([p()],om.prototype,"_sortedDrapeSourceRenderersDirty",void 0),u([p({constructOnly:!0})],om.prototype,"parent",void 0),u([p({readOnly:!0})],om.prototype,"_techniques",null),u([p({type:Boolean,readOnly:!0})],om.prototype,"updating",null),u([p()],om.prototype,"isEmpty",null),u([p({readOnly:!0})],om.prototype,"rendersOccludedDraped",null),om=u([A("esri.views.3d.terrain.OverlayRenderer")],om);let i0t=class{constructor(e,i,r){this.drapeSource=e,this.renderer=i,this.index=r}};const r0t=[[1,.5,.5],[.5,.5,1]],s0t=-2,_P=Cr.OccludeAndTransparent,hK=new BLe;hK.hasAlpha=!0;function jLe(t,e,i,r){const s=loe(t.rings,!!t.hasZ&&r.mode!=="on-the-ground",xA.CCW_IS_HOLE,t.spatialReference),n=cc(s.position.length),o=Sut(s.position,t.spatialReference,0,n,0,s.position,0,s.position.length/3,e,i,r),a=o!=null;return new a0t(s.position,n,HLe(s.polygons,s.position,n),GLe(s.outlines,s.position,n),a,o)}function uii(t,e){const i=loe(t.rings,!1,xA.CCW_IS_HOLE),r=Gn(i.position,t.spatialReference,0,i.position,e,0);for(let s=2;s<i.position.length;s+=3)i.position[s]=s0t;return{position:i.position,polygons:HLe(i.polygons,i.position),outlines:GLe(i.outlines,i.position),projectionSuccess:r}}function GLe(t,e,i=null){return t.filter(({count:r})=>r>1).map(({index:r,count:s})=>{const n=3*r,o=3*s;return i!=null?new qLe(r,s,Kx(e,n,o),Kx(i,n,o)):new xoe(r,s,Kx(e,n,o))})}function HLe(t,e,i=null){const r=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of t){if(n<=1)continue;const l=3*s,c=3*n,h=o.map(f=>f-s),d=i!=null?new n0t(s,n,Kx(e,3*s,3*n),Kx(i,l,c),h,a):new o0t(s,n,Kx(e,3*s,3*n),h,a);r.push(d)}return r}let xoe=class{constructor(e,i,r){this.index=e,this.count=i,this.position=r}},qLe=class extends xoe{constructor(e,i,r,s){super(e,i,r),this.mapPositions=s}},n0t=class extends qLe{constructor(e,i,r,s,n,o){super(e,i,r,s),this.holeIndices=n,this.pathLengths=o}},o0t=class extends xoe{constructor(e,i,r,s,n){super(e,i,r),this.holeIndices=s,this.pathLengths=n}},a0t=class{constructor(e,i,r,s,n,o){this.position=e,this.mapPositions=i,this.polygons=r,this.outlines=s,this.projectionSuccess=n,this.sampledElevation=o}};function Soe(t){return t.mapPositions!=null}function Zb(t,e,i,r,s,n=2){const o=1/(Math.abs(i)+Math.abs(r)+Math.abs(s)),a=i*o,l=r*o,c=s<=0?(a>=0?1:-1)*(1-Math.abs(l)):a,h=s<=0?(l>=0?1:-1)*(1-Math.abs(a)):l,d=e*n;t[d]=qme(c),t[d+1]=qme(h)}function l0t(t){const e=t.length/3,i=new Int16Array(2*e);let r=0;for(let s=0;s<e;++s)Zb(i,s,t[r++],t[r++],t[r++]);return i}function gii(t,e){const i=t.length/3,r=new Int16Array(2*i);let s=0;const n=$();for(let o=0;o<i;++o)n[0]=t[s++],n[1]=t[s++],n[2]=t[s++],uc(n,n,e),Zb(r,o,n[0],n[1],n[2]);return r}function c0t(t,e,i,r=2){const s=i*r,n=Wme(e[s]),o=Wme(e[s+1]),a=1-Math.abs(n)-Math.abs(o);t[2]=a,a<0?(t[0]=(n>=0?1:-1)*(1-Math.abs(o)),t[1]=(o>=0?1:-1)*(1-Math.abs(n))):(t[0]=n,t[1]=o),ae(t,t)}function qme(t){return ue(Math.round(32767*t),-32767,32767)}function Wme(t){return ue(t/32767,-1,1)}const u0t=["polygon","extent"];let yii=class extends jDe{constructor(e,i,r,s){super(e,i,r,s),this.ensureDrapedStatus(!1)}async doLoad(){var c,h,d,f;if(!this._drivenProperties.size){const m=zut(this._getSymbolSize());if(m)throw new U("graphics3dextrudesymbollayer:invalid-size",m)}const e=(h=(c=this.symbolLayer)==null?void 0:c.material)==null?void 0:h.color,i=this._getCombinedOpacityAndColor(e),r=H$(i),s=i[3],n=s<1||this.needsDrivenTransparentPass,o=(f=(d=this.symbolLayer)==null?void 0:d.material)==null?void 0:f.emissiveFactor,a=o?_Oe(os(o)):cn,l={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:r,ambient:r,opacity:s,transparent:n,cullFace:n?Al.None:Al.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,emissiveFactor:a,offsetTransparentBackfaces:!0,normalType:kr.Compressed};this._materials[Uu.Main]=new NB(l,this._context),this._materials[Uu.Bottom]=new NB({...l,cullFace:Al.Back},this._context),this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,u0t,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(i);return this._createAs3DShape(i,e.renderingInfo,r,s,i.uid)}layerOpacityChanged(e,i){var a,l,c,h;const r=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,s=this._getCombinedOpacity(r),n=s<1||this.needsDrivenTransparentPass;(c=this._materials[Uu.Main])==null||c.setParameters({opacity:s,transparent:n}),(h=this._materials[Uu.Bottom])==null||h.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();e.forEach(d=>{var f;return(f=i(d))==null?void 0:f.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,rfe)}slicePlaneEnabledChanged(e,i){var r,s;return(r=this._materials[Uu.Main])==null||r.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),(s=this._materials[Uu.Bottom])==null||s.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(n=>{const o=i(n);o!=null&&o.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){var i,r;const e={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0};return(i=this._materials[Uu.Main])==null||i.setParameters(e),(r=this._materials[Uu.Bottom])==null||r.setParameters(e),!0}_getExtrusionSize(e){let i;return i=e.size&&this._drivenProperties.size?wut(e.size,2)??0:this._getSymbolSize(),i/=this._context.renderCoordsHelper.unitInMeters,i}applyRendererDiff(e,i){return this._drivenPropertiesChanged(i)?lv.RecreateSymbol:lv.RecreateGraphics}async queryForSnapping(e,i,r,s){const n=this._getExtrusionSize(r)*this._context.renderCoordsHelper.unitInMeters/gS(i),{objectId:o,target:a}=e,l=q(a);switch(l.z=(l.z??0)+n,e.type){case"edge":{const{start:c,end:h}=e,d=q(c),f=q(h);return d.z=(d.z??0)+n,f.z=(f.z??0)+n,[efe(o,l,1/0,d,f)]}case"vertex":return[aut(o,l,1/0),efe(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,i,r,s,n){const o=ygt(e.geometry);if(o==null)return null;if(o.rings.length===0||!o.rings.some(P=>P.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=jLe(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=QG(o);if(l==null)return null;const c=new Array,h=new Array,d=fh(),f=qe(),m=$(),g=this._context.renderCoordsHelper.viewingMode===je.Global;g||this._context.renderCoordsHelper.worldUpAtPosition(null,m),cT(o.spatialReference,[l.x,l.y,0],f,this._context.renderCoordsHelper.spatialReference);const v=qe();$l(v,f);const _=Ts();nse(_,v);const{polygons:b,mapPositions:w,position:x}=a,S=new Map,C=this._materials[Uu.Main];for(const P of b){const F=P.count;if(this._context.clippingExtent&&(OKe(P.mapPositions,d),!FKe(d,this._context.clippingExtent)))continue;const L=pA(P.mapPositions,P.holeIndices,3);if(L.length===0)continue;const N=L.length,R=6*F,k=z3(R+N),W=z3(N),j=cc(3*R),B=cc(3*R),te=cc(3*R),le=cc(R);WLe(x,w,L,P,j,te,B,le,k,W,this._getExtrusionSize(i),m,g),YG(j,j,v);const de=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),Ae=new _0t(j,te,l0t(B),le),We=Zme(C,k,k.length-W.length,Ae,r,de),Ue=F,it=F,Et=2*P.count,Jt=new b0t(Ue,it,Et,N/3);ZLe(We,Jt,f),S.set(We,Jt),c.push(We,Zme(this._materials[Uu.Bottom],W,0,Ae,r,de)),h.push(Ae.heights)}if(c.length===0)return null;const T=new foe({geometries:c,layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0});T.transformation=f;const M=ppt(this.symbolLayer,{opacity:this._getLayerOpacity()}),I=M?new Vut(this._materials[Uu.Main],M,this._context.slicePlaneEnabled):null,D=new ene(this,T,c,null,null,(P,F,L,N,R)=>p0t(P,F,L,N,R,h,S),s,I);return D.alignedSampledElevation=a.sampledElevation,D.needsElevationUpdates=rfe(s.mode),D}};function Zme(t,e,i,r,s,n){const o=_L(e.length),a=[[z.POSITION,new Qt(r.positions,e,3,!0)],[z.NORMALCOMPRESSED,new Qt(r.normals,e,2,!0)],[z.COLOR,new Qt(s,o,4,!0)]];return new $a(t,a,r.elevation,zn.Mesh,n,i)}function WLe(t,e,i,r,s,n,o,a,l,c,h,d,f){{const m=i.length/3,g=2*r.count;h0t(t,e,r.index,r.count,i,0,m,s,n,o,a,l,c,g,h,d,f)}{let m=0,g=2*r.count,v=0;const _=r.pathLengths[0];Yme(s,n,a,o,m,_,r.count,g,l,v,h),g+=4*_,v+=2*_,m+=_;for(let b=1;b<r.pathLengths.length;++b){const w=r.pathLengths[b];Yme(s,n,a,o,m,w,r.count,g,l,v,h),g+=4*w,v+=2*w,m+=w}}}function h0t(t,e,i,r,s,n,o,a,l,c,h,d,f,m,g,v,_){ne(Iu,v);{const b=g>0?1:-1;let w=3*i,x=0,S=3*x,C=r,T=3*C;for(let M=0;M<r;++M){const I=t[w],D=t[w+1],P=t[w+2];_&&(Iu[0]=I,Iu[1]=D,Iu[2]=P,ae(Iu,Iu)),a[S+0]=I,a[S+1]=D,a[S+2]=P;const F=e[w+0],L=e[w+1],N=e[w+2];l[S+0]=F,l[S+1]=L,l[S+2]=N,c[S+0]=-b*Iu[0],c[S+1]=-b*Iu[1],c[S+2]=-b*Iu[2],h[x]=0,a[T+0]=I+g*Iu[0],a[T+1]=D+g*Iu[1],a[T+2]=P+g*Iu[2],l[T+0]=F,l[T+1]=L,l[T+2]=N,h[C]=g,S+=3,T+=3,w+=3,x+=1,C+=1}}{let b=3*n,w=0,x=3*m;const S=g<0?tge:ege,C=g<0?ege:tge;for(let T=0;T<o;++T)f[w]=s[b+S[0]],f[w+1]=s[b+S[1]],f[w+2]=s[b+S[2]],d[x]=s[b+C[0]]+r,d[x+1]=s[b+C[1]]+r,d[x+2]=s[b+C[2]]+r,w+=3,x+=3,b+=3}}function bF(t,e,i,r,s,n,o){r[n]=r[o],o*=3,t[n*=3]=t[o],t[n+1]=t[o+1],t[n+2]=t[o+2],e[n]=e[o],e[n+1]=e[o+1],e[n+2]=e[o+2],i[n]=s[0],i[n+1]=s[1],i[n+2]=s[2]}const uO=$();function Yme(t,e,i,r,s,n,o,a,l,c,h){let d=s,f=s+1,m=s+o,g=s+o+1,v=a,_=a+1,b=a+2*n,w=a+2*n+1;h<0&&(d=s+o+1,g=s);let x=3*c;for(let S=0;S<n;++S)S===n-1&&(f=s,h>0?g=s+o:d=s+o),d0t(t,d,f,m,uO),bF(t,e,r,i,uO,v,d),bF(t,e,r,i,uO,_,f),bF(t,e,r,i,uO,b,m),bF(t,e,r,i,uO,w,g),l[x]=v,l[x+1]=b,l[x+2]=w,l[x+3]=v,l[x+4]=w,l[x+5]=_,x+=6,d++,f++,m++,g++,v+=2,_+=2,b+=2,w+=2}const Nq=$(),Jme=$(),Xme=$(),Kme=$(),Qme=$();function d0t(t,e,i,r,s){e*=3,i*=3,r*=3,se(Nq,t[e++],t[e++],t[e++]),se(Jme,t[i++],t[i++],t[i++]),se(Xme,t[r++],t[r++],t[r++]),be(Kme,Jme,Nq),be(Qme,Xme,Nq),ct(s,Qme,Kme),ae(s,s)}const tE=$();function p0t(t,e,i,r,s,n,o){const a=t.stageObject,l=a.geometries,c=l.length,h=e.mode!=="absolute-height";let d=0;const f=a.transformation,m=wre(qe(),f);for(let g=0;g<c;g+=2){const v=l[g];if(!Soe(v))continue;const _=v.getMutableAttribute(z.POSITION).data,b=n[g/2],w=new TPe(v.mapPositions),x=_.length/3;let S=!1,C=0;{let T=0;for(let M=0;M<x;M++){tE[0]=_[T],tE[1]=_[T+1],tE[2]=_[T+2],r(w,wF),h&&(C+=wF.sampledElevation),xs.TESTS_DISABLE_OPTIMIZATIONS?(se(gl,w.array[w.offset],w.array[w.offset+1],wF.z+b[T/3]),i!=null&&s.toRenderCoords(gl,i,gl),ot(gl,gl,m)):(se(gl,_[T],_[T+1],_[T+2]),ot(gl,gl,f),s.setAltitude(gl,wF.z+b[T/3]),ot(gl,gl,m)),_[T]=gl[0],_[T+1]=gl[1],_[T+2]=gl[2];const I=f0t/s.unitInMeters;(Math.abs(tE[0]-_[T])>=I||Math.abs(tE[1]-_[T+1])>=I||Math.abs(tE[2]-_[T+2])>=I)&&(S=!0),w.offset+=3,T+=3}}if(S){const T=o.get(v);T&&ZLe(v,T,f),a.geometryVertexAttributeUpdated(l[g],z.NORMALCOMPRESSED),v.invalidateBoundingInfo(),a.geometryVertexAttributeUpdated(l[g],z.POSITION),l[g+1].invalidateBoundingInfo(),a.geometryVertexAttributeUpdated(l[g+1],z.POSITION)}d+=C/x}return d/c}function ZLe(t,e,i){const r=t.getMutableAttribute(z.POSITION),s=t.getMutableAttribute(z.NORMALCOMPRESSED).data,{topVertexStart:n,topVertexCount:o,topFaceStart:a,topFaceCount:l}=e,c=r.data,h=o,d=t.attributes.get(z.POSITION).indices,f=a+l,m=n+o,g=cc(3*h);for(let S=0;S<h;++S){const C=3*S;g[C+0]=0,g[C+1]=0,g[C+2]=0}const v=m0t,_=g0t,b=y0t,w=v0t,x=Iu;for(let S=a;S<f;++S){const C=3*S;for(let T=0;T<3;++T){const M=d[C+T];w[T]=M;const I=3*M;se(gl,c[I+0],c[I+1],c[I+2]),ot(v[T],gl,i)}Fi(_,v[1],v[0]),Fi(b,v[2],v[0]),ct(x,_,b),ae(x,x);for(let T=0;T<3;++T){const M=3*(w[T]-n);g[M+0]+=x[0],g[M+1]+=x[1],g[M+2]+=x[2]}}for(let S=n;S<m;++S){const C=3*(S-n),T=g[C+0],M=g[C+1],I=g[C+2],D=Math.sqrt(T*T+M*M+I*I);Zb(s,S,T/D,M/D,I/D)}}const gl=$(),Iu=$(),wF=new Qse,ege=[0,2,1],tge=[0,1,2],f0t=.01,m0t=[$(),$(),$()],g0t=$(),y0t=$(),v0t=[0,0,0];var Uu;(function(t){t[t.Main=0]="Main",t[t.Bottom=1]="Bottom"})(Uu||(Uu={}));let _0t=class{constructor(e,i,r,s){this.positions=e,this.elevation=i,this.normals=r,this.heights=s}},b0t=class{constructor(e,i,r,s){this.topVertexStart=e,this.topVertexCount=i,this.topFaceStart=r,this.topFaceCount=s}},Toe=class extends cr{};function YLe(){const t=new Vi;return t.include(ia),t.outputs.add("fragColor","vec4",0),t.fragment.uniforms.add(new It("colorTexture",e=>e.color),new It("focusArea",e=>e.focusArea),new dw("focusAreaEffectMode",e=>e.effect??1)).main.add(E`float mask = texture( focusArea, uv, 0.0 ).r;
vec4 color = texture( colorTexture, uv, 0.0 );
vec4 colorDeSaturate = vec4(color.r * 0.25 + color.g * 0.5 + color.b * 0.25);
if (focusAreaEffectMode == 1) {
fragColor = mask > 0.0 ? color : 0.55 * colorDeSaturate + 0.45;
} else {
fragColor = mask > 0.0 ? color : 0.33 * mix(color, colorDeSaturate, 0.);
}`),t}const w0t=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaColorPassParameters:Toe,build:YLe},Symbol.toStringTag,{value:"Module"}));let ige=class extends Hi{constructor(e,i){super(e,i,new Bi(w0t,()=>G(()=>Promise.resolve().then(()=>eHt),void 0)))}initializePipeline(){return wi({colorWrite:Di})}},o2=class extends Af{constructor(e){super({...e,view:e.focusAreas.view}),this.consumes={required:[rr.COMPOSITE,dt.FOCUSAREA]},this.produces=rr.COMPOSITE,this._passParameters=new Toe}precompile(){this.techniques.precompile(ige)}render(e){const i=this.techniques.get(ige),r=e.find(({name:d})=>d===rr.COMPOSITE);if(!i.compiled)return this.requestRender(),r;const s=this.bindParameters,n=s.camera,o=n.fullViewport[2],a=n.fullViewport[3],l=e.find(({name:d})=>d===dt.FOCUSAREA),c=this.fboCache.acquire(o,a,this.produces),h=this.renderingContext;return h.gl.clear(h.gl.STENCIL_BUFFER_BIT),h.bindFramebuffer(c.fbo),this._passParameters.color=r.getTexture(),this._passParameters.focusArea=l.getTexture(),this._passParameters.effect=x0t[this.focusAreas.style],h.bindTechnique(i,s,this._passParameters),h.screen.draw(),c.attachDepth(r.getAttachment(this.gl.DEPTH_STENCIL_ATTACHMENT)),c}};var bP;u([p()],o2.prototype,"consumes",void 0),u([p()],o2.prototype,"produces",void 0),u([p({constructOnly:!0})],o2.prototype,"focusAreas",void 0),o2=u([A("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaColorNode")],o2),function(t){t[t.NONE=0]="NONE",t[t.BRIGHT=1]="BRIGHT",t[t.DARK=2]="DARK"}(bP||(bP={}));const x0t={none:bP.NONE,bright:bP.BRIGHT,dark:bP.DARK};let Eoe=class extends cr{constructor(){super(...arguments),this.origin=cn}};function JLe(){const t=new Vi;return t.attributes.add(z.POSITION,"vec3"),t.outputs.add("fragColor","vec4",0),t.vertex.uniforms.add(new $o("proj",e=>e.camera.projectionMatrix),new Wne("view",(e,i)=>uh(S0t,i.camera.viewMatrix,e.origin))).main.add(E`gl_Position = proj * view * vec4(position, 1.0);`),t.fragment.main.add(E`fragColor = vec4(1., 0., 0., 1.);`),t}const S0t=qe(),T0t=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaMaskDrawParameters:Eoe,build:JLe},Symbol.toStringTag,{value:"Module"}));let rge=class extends Hi{constructor(e,i){super(e,i,new Bi(T0t,()=>G(()=>Promise.resolve().then(()=>tHt),void 0)))}initializePipeline(){return wi({colorWrite:Di,depthTest:{func:Ui.LEQUAL}})}},a2=class extends Af{constructor(e){super({...e,view:e.focusAreas.view}),this.consumes={required:[dt.FOCUSAREA,rr.TRANSPARENT]},this.produces=dt.FOCUSAREA,this._vaos=new Array,this._counts=new Array,this._origins=new Array,this._maskParameters=new Eoe}initialize(){this.updateGeometries()}destroy(){this._vaos.forEach(e=>e.dispose()),this._vaos.length=this._counts.length=this._origins.length=0}precompile(){this.techniques.precompile(rge)}render(e){const i=this.techniques.get(rge),r=this.bindParameters,s=r.camera,n=s.fullViewport[2],o=s.fullViewport[3],a=this.fboCache.acquire(n,o,dt.FOCUSAREA,gr.RGBA);if(!i.compiled||!this._vaos)return this.requestRender(),a;const l=e.find(({name:d})=>d===rr.TRANSPARENT),c=this.renderingContext;a.attachDepth(l.getAttachment(this.gl.DEPTH_STENCIL_ATTACHMENT)),c.bindFramebuffer(a.fbo),c.clear(Mi.COLOR|Mi.STENCIL),c.setViewport(0,0,n,o),c.gl.clearStencil(0),c.gl.clear(c.gl.STENCIL_BUFFER_BIT),c.setClearStencil(0);const h=c.bindTechnique(i,r);c.setFaceCullingEnabled(!1),c.setStencilTestEnabled(!0),c.setStencilOpSeparate(eh.FRONT,tr.KEEP,tr.INCR_WRAP,tr.KEEP),c.setStencilOpSeparate(eh.BACK,tr.KEEP,tr.DECR_WRAP,tr.KEEP),c.setDepthWriteEnabled(!1);for(let d=0;d<this._vaos.length;d++){const f=this._vaos[d],m=this._counts[d];this._maskParameters.origin=this._origins[d],h.bindDraw(r,Tpt,this._maskParameters),c.bindVAO(f),c.setStencilWriteMask(255),c.setStencilFunction(Ui.ALWAYS,0,255),c.setColorMask(!1,!1,!1,!1),c.drawArrays(Gi.TRIANGLES,0,m),c.setStencilWriteMask(0),c.setStencilFunction(Ui.NOTEQUAL,0,255),c.setColorMask(!0,!0,!0,!0),c.drawArrays(Gi.TRIANGLES,0,m)}return a}updateGeometries(){if(!this.view._stage)return;this._vaos.forEach(i=>i.dispose()),this._vaos.length=this._counts.length=this._origins.length=0;const e=this.focusAreas.geometries;for(const i of e){const r=new Array,s=i.indicesBottom;for(let l=0;l<s.length;l++)r.push(i.positions[3*(s[l]-1)]),r.push(i.positions[3*(s[l]-1)+1]),r.push(i.positions[3*(s[l]-1)+2]);const n=i.indicesExtruded;for(let l=0;l<n.length;l++)r.push(i.positions[3*n[l]]),r.push(i.positions[3*n[l]+1]),r.push(i.positions[3*n[l]+2]);const o=new Float32Array(r),a=new Tg(this.renderingContext,bg,new Map([["geometry",yyt]]),new Map([["geometry",jn.createVertex(this.renderingContext,Js.STATIC_DRAW,o)]]));this._vaos.push(a),this._counts.push(s.length+n.length),this._origins.push(i.origin)}this.requestRender()}};u([p()],a2.prototype,"consumes",void 0),u([p()],a2.prototype,"produces",void 0),u([p({constructOnly:!0})],a2.prototype,"focusAreas",void 0),a2=u([A("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaMaskNode")],a2);let E0t=class{constructor(e,i,r,s,n,o){this.positions=e,this.indicesBottom=i,this.indicesExtruded=r,this.height=s,this.origin=n,this.color=o}};var sge;(function(t){t[t.NONE=0]="NONE",t[t.BRIGHT=1]="BRIGHT",t[t.DARK=2]="DARK"})(sge||(sge={}));const Uw=0,C0t=5e6,xF=.42,Bw=.32;function Aii(t,e){if(t){if(e==="bright"){const i=(t[0]+t[1]+t[2])/3;return[i*Bw+(1-Bw),i*Bw+(1-Bw),i*Bw+(1-Bw),t[3]*Bw]}return e==="dark"?[t[0]*xF,t[1]*xF,t[2]*xF,t[3]*xF]:t}}let i_=class extends he{constructor(e){super(e),this.style="dark",this.geometries=new Array,this._areas=new Ce,this._elevationContext=new xB}initialize(){this.addHandles([H(()=>this.style,()=>this._updateRenderNodes(),Mt)]),this.addHandles([H(()=>this.activePolygons,()=>this._updateFocusAreaGeometries(),Mt)])}get activePolygons(){const e=new Ce;for(const i of this.areas)if(i.enabled)for(const r of i.geometries)e.push(r);return e}add(e){this.areas.add(e),this._updateFocusAreaGeometries()}addMany(e){this.areas.addMany(e),this._updateFocusAreaGeometries()}remove(e){this.areas.remove(e),this._updateFocusAreaGeometries()}removeMany(e){this.areas.removeMany(e),this._updateFocusAreaGeometries()}removeAll(){this.areas.removeAll(),this._updateFocusAreaGeometries()}containsGeometry(e){let i=!0;const r=new Fe(e);return i=this.areas.some(s=>!!s.enabled&&!!(s!=null&&s.geometries.length)&&s.geometries.some(n=>n.contains(r))),i}get areas(){return this._areas}_updateFocusAreaGeometries(){this._extrudePolygons(),this._updateRenderNodes()}_extrudePolygons(){var o,a;if(!this.view.renderCoordsHelper)return;this.geometries.length=0;const e=C0t-Uw,i=$(),r=this.view.renderCoordsHelper.viewingMode===je.Global,s=qe(),n=qe();r||this.view.renderCoordsHelper.worldUpAtPosition([0,0,0],i);for(const l of this.areas)if(l.enabled)for(const c of l.geometries){const h=QG(c);if(h==null)continue;cT(c.spatialReference,[h.x,h.y,0],s,this.view.renderCoordsHelper.spatialReference);const d=ae($0t,[s[12]-Uw*i[0],s[13]-Uw*i[1],s[14]-Uw*i[2]]);n[12]=-s[12],n[13]=-s[13],n[14]=-s[14];const f=jLe(c,this.view.elevationProvider,this.view.renderCoordsHelper,this._elevationContext),{polygons:m,mapPositions:g,position:v}=f;for(const _ of m){const b=_.count,w=pA(_.mapPositions,_.holeIndices,3);if(w.length===0)continue;const x=w.length,S=6*b,C=z3(S+x),T=z3(x),M=cc(3*S),I=cc(3*S),D=cc(3*S),P=cc(S);WLe(v,g,w,_,M,D,I,P,C,T,e,i,r),YG(M,M,n);const F=new E0t(M,T,C,e,[s[12]+Uw*d[0],s[13]+Uw*d[1],s[14]+Uw*d[2]],(o=l.outline)==null?void 0:o.color);this.geometries.push(F)}}(a=this._maskRenderNode)==null||a.updateGeometries()}_updateRenderNodes(){this.view._stage&&(this.style==="none"||this.geometries.length===0?(this._maskRenderNode=$e(this._maskRenderNode),this._colorRenderNode=$e(this._colorRenderNode)):(this._maskRenderNode??(this._maskRenderNode=new a2({focusAreas:this})),this._colorRenderNode??(this._colorRenderNode=new o2({focusAreas:this}))))}};u([p()],i_.prototype,"activePolygons",null),u([p()],i_.prototype,"style",void 0),u([p()],i_.prototype,"geometries",void 0),u([p({constructOnly:!0})],i_.prototype,"view",void 0),u([p()],i_.prototype,"_areas",void 0),i_=u([A("esri.views.FocusAreas")],i_);const $0t=$();function vc(t,e,i,r,s){return!(e==null||r==null||t.length<2)&&(hO.x=t[0],hO.y=t[1],hO.z=t[2],hO.spatialReference=e,gc(hO,i,r,s))}const hO=uT(0,0,0,Oe.WGS84);function dT(t,e,i){return!!vc(t,e,SF,i.spatialReference)&&(i.x=SF[0],i.y=SF[1],i.z=SF[2],!0)}async function XLe(t,e,i,r){return await XD(e,i.spatialReference,null,r),dT(t,e,i)}const SF=$();function KLe(t,e,i,r){return t.renderCoordsHelper.fromRenderCoords(e.eye,GB,r)!=null&&O8e(i,GB)}function O6(t,e){return t.elevationProvider?t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground")??0:0}function pT(t,e,i,r){const s=t.state.camera.clone();e&&i&&r&&(s.eye=e,s.center=i,s.up=r),A0t(t,s.ray,E0)||ne(E0,s.center);const n=t.state.constraints,o=n.minimumPoiDistance;if(no(s.eye,E0)<o){const a=n.collision.enabled;ne(Vw,s.viewForward),re(Vw,Vw,o),a?s.eye=be(GB,E0,Vw):oe(E0,s.eye,Vw);const l=t.renderCoordsHelper,c=l.getAltitude(s.eye),h=n.collision.elevationMargin;a&&c<h&&(be(Vw,E0,s.eye),s.eye=l.setAltitude(GB,h,s.eye),oe(E0,s.eye,Vw))}return s.center=E0,s}function nge(t,e,i){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const r=O6(t,e),s=t.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(e,i,t.renderDataExtent,r,O0t),o=n*n;return no(e,i)>o}function A0t(t,e,i){let r=oge[t.viewingMode];r||(r=ph(t.state.viewingMode),r.options.backfacesTerrain=!t.state.isGlobal,r.options.invisibleTerrain=!0,oge[t.viewingMode]=r);const{isGlobal:s}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,r,i)||nge(t,e.origin,i))||!(!t.renderCoordsHelper.intersectManifold(e,0,i)||nge(t,e.origin,i))||!!s&&M0t(e,i,yr(t.spatialReference).radius)}function M0t(t,e,i){const r=fe(t.origin,t.origin)-i*i,s=r>0?Math.sqrt(r)/3:1;return re(e,t.direction,s/Ee(t.direction)),oe(e,e,t.origin),!0}const oge={},GB=$(),E0=$(),Vw=$(),O0t={near:0,far:0};function I0t(t,e){const i=[],r=[];return TF(i,t,e,Nm.LEFT),TF(r,i,e,Nm.BOTTOM),TF(i,r,e,Nm.RIGHT),TF(r,i,e,Nm.TOP),r}function TF(t,e,i,r){const s=R0t(i,r);if(t.length=0,e.length){s(EF,e[0],e[0])===Ju.INSIDE&&dO(t,e[0]);for(let n=0;n<e.length;n++){const o=e[n===e.length-1?0:n+1];switch(s(EF,e[n],o)){case Ju.INSIDE:dO(t,o);break;case Ju.INSIDE_OUT:dO(t,tB(EF));break;case Ju.OUTSIDE_IN:dO(t,tB(EF)),dO(t,o);case Ju.OUTSIDE:}}}}function dO(t,e){t.length!==0&&AG(t.at(-1),e)||t.push(e)}function R0t(t,e){const i=e===Nm.LEFT||e===Nm.RIGHT?0:1,r=t[e],s=e===Nm.LEFT||e===Nm.BOTTOM?mC.MIN:mC.MAX,n=i===0?1:0;return(o,a,l)=>{if(a[i]<r&&l[i]<r)return s===mC.MIN?Ju.OUTSIDE:Ju.INSIDE;if(a[i]>r&&l[i]>r)return s===mC.MIN?Ju.INSIDE:Ju.OUTSIDE;const c=(l[n]-a[n])/(l[i]-a[i]),h=a[n]+c*(r-a[i]);return o[i]=r,o[n]=h,(a[i]<r?1:-1)*s>0?Ju.OUTSIDE_IN:Ju.INSIDE_OUT}}var mC,Ju,Nm;(function(t){t[t.MIN=1]="MIN",t[t.MAX=-1]="MAX"})(mC||(mC={})),function(t){t[t.OUTSIDE=0]="OUTSIDE",t[t.INSIDE=1]="INSIDE",t[t.OUTSIDE_IN=2]="OUTSIDE_IN",t[t.INSIDE_OUT=3]="INSIDE_OUT"}(Ju||(Ju={})),function(t){t[t.LEFT=0]="LEFT",t[t.BOTTOM=1]="BOTTOM",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP"}(Nm||(Nm={}));const EF=Ye();let HB=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}get origin(){return this._origin}constructor(e){this.renderCoordsHelper=e,this.frustum=zB(),this._points=qDe(),this.lines=new Array(12),this._origin=$(),this._direction=$(),this._altitude=null;for(let i=0;i<12;i++)this.lines[i]={origin:null,direction:$(),endpoint:null}}update(e){WDe(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),ne(this._origin,e.eye),ne(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let i=0;i<this._points.length;i++)ne(this._points[i],e[i]);ZDe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return hb(this.frustum,e)}intersectsRay(e){return Mgt(this.frustum,e)}intersectsLineSegment(e,i){return Ogt(this.frustum,e,i)}intersectsPoint(e){return pC(this.frustum,e)}_updateLines(){const e=this._points;for(let i=0;i<4;i++){const r=i+4;Fq(this.lines[i],e[i],e[r]),Fq(this.lines[i+4],e[i],i===3?e[0]:e[i+1]),Fq(this.lines[i+8],e[r],i===3?e[4]:e[r+1])}}};var Vy;function Fq(t,e,i){t.origin=e,t.endpoint=i,nT(t.direction,e,i)}HB.planePointIndices=Igt,HB.nearFarLineIndices=[[Wt.NEAR_BOTTOM_LEFT,Wt.FAR_BOTTOM_LEFT],[Wt.NEAR_BOTTOM_RIGHT,Wt.FAR_BOTTOM_RIGHT],[Wt.NEAR_TOP_RIGHT,Wt.FAR_TOP_RIGHT],[Wt.NEAR_TOP_LEFT,Wt.FAR_TOP_LEFT]],function(t){t[t.NEAR_FAR_BOTTOM_LEFT=0]="NEAR_FAR_BOTTOM_LEFT",t[t.NEAR_FAR_BOTTOM_RIGHT=1]="NEAR_FAR_BOTTOM_RIGHT",t[t.NEAR_FAR_TOP_RIGHT=2]="NEAR_FAR_TOP_RIGHT",t[t.NEAR_FAR_TOP_LEFT=3]="NEAR_FAR_TOP_LEFT",t[t.NEAR_BOTTOM=4]="NEAR_BOTTOM",t[t.NEAR_RIGHT=5]="NEAR_RIGHT",t[t.NEAR_TOP=6]="NEAR_TOP",t[t.NEAR_LEFT=7]="NEAR_LEFT",t[t.FAR_BOTTOM=8]="FAR_BOTTOM",t[t.FAR_RIGHT=9]="FAR_RIGHT",t[t.FAR_TOP=10]="FAR_TOP",t[t.FAR_LEFT=11]="FAR_LEFT"}(Vy||(Vy={}));const P0t=$(),CF=$();function Coe(){return{direction:$(),up:$()}}function QLe(t,e,i,r,s){let n=ae(P0t,t),o=fe(n,r);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(fe(e,r)),o<.99?(ne(n,e),a&&re(n,n,-1)):n=null);let l=0;if(n){re(CF,r,fe(r,n)),be(n,n,CF);const h=fe(n,s)/(Ee(n)*Ee(s));ct(CF,n,s),l=(fe(CF,r)>0?1:-1)*Ao(Ja(h))}const c=Ao(Ja(-fe(r,t)/Ee(t)));return i?(i.heading=l,i.tilt=c,i):{heading:l,tilt:c}}function eNe(t,e,i,r){be(age,i,e),CRe(r,pRe(e,age),t)||t===i||ne(t,i)}const age=$(),tNe=De(0,1,0),iNe=De(0,0,1),pO=qe(),Bg=$(),Vg=$();function rNe(t,e,i,r=Coe()){const{direction:s,up:n}=r;return g$e(pO,-At(e)),K$(pO,pO,At(i)),ot(s,iNe,pO),re(s,s,-1),ot(n,tNe,pO),r}function D0t(t,e,i,r){return QLe(e,i,r,iNe,tNe)}function L0t(t,e,i,r){const s=rNe(t,i,r),n=$();return re(n,s.direction,-e),oe(n,n,t),{up:s.up,eye:n,heading:i,tilt:r}}function N0t(t){return Ao(t)}function F0t(t){return At(t)}function k0t(t,e,i,r,s){const n=t.renderSpatialReference,o=t.spatialReference??e.spatialReference;return gc(e,Bg,n),gc(e,Vg,n),Bg[0]-=i/2,Vg[0]+=i/2,Bg[1]-=r/2,Vg[1]+=r/2,vc(Bg,n,Bg,o),vc(Vg,n,Vg,o),s?(s.xmin=Bg[0],s.ymin=Bg[1],s.xmax=Vg[0],s.ymax=Vg[1],s.spatialReference=o):s=new _i(Bg[0],Bg[1],Vg[0],Vg[1],o),s}function z0t(t,e){const i=t.frustum,{renderCoordsHelper:r}=t,s=r.getAltitude(e),n=t.spatialReference,o=t.state.camera.eye,a=[],l=i.planes[bo.FAR];for(let c=0;c<4;c++){const h=i.lines[c];r.intersectInfiniteManifold(wf(h.origin,h.direction),s,Hp)||U0t(Hp,i,r,h.endpoint,s),eNe(Hp,o,Hp,l),a.push(fn(Hp[0],Hp[1]))}return B0t(I0t(a,r.extent),r,n)}function U0t(t,e,i,r,s){const n=e.lines[Vy.FAR_LEFT].direction,o=(s-i.getAltitude(r))/n[2];Qn(t,r,n,o)}function B0t(t,e,i){const r=t.map(s=>(se(Hp,s[0],s[1],0),e.fromRenderCoords(Hp,Hp,i),[Hp[0],Hp[1]]));return r.length<=2?new Ea({spatialReference:i}):(r.push(r[0].slice()),eb(r)||r.reverse(),new Ea({rings:[r],spatialReference:i}))}const Hp=$(),V0t=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:D0t,eyeForCenterWithHeadingTilt:L0t,eyeTiltToLookAtTilt:F0t,headingTiltToDirectionUp:rNe,lookAtTiltToEyeTilt:N0t,toArea:z0t,toExtent:k0t},Symbol.toStringTag,{value:"Module"}));function Rv(t,e,i){t.worldUpAtPosition(e,lge),be(kq,i,e);const r=Ee(kq);return r===0?0:Ja(fe(kq,lge)/r)}const lge=$(),kq=$();function cge(t,e,i){if(e.longitude==null||e.latitude==null||i.longitude==null||i.latitude==null)throw new Error("Invalid points: no lon/lat");return j0t(t,e.longitude,e.latitude,i.longitude,i.latitude)}function j0t(t,e,i,r,s){const n=At(i),o=At(s),a=n-o,l=At(e)-At(r),c=Math.sin(a/2),h=Math.sin(l/2),d=2*Md(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*h*h))*t;return Math.round(1e4*d)/1e4}function G0t(t,e,i){const r=e.spatialReference,s=yr(r),n=new Fe(e.x,t.y,r),o=new Fe(i.x,t.y,r),a=new Fe(t.x,e.y,r),l=new Fe(t.x,i.y,r);return{lon:cge(s.radius,n,o),lat:cge(s.radius,a,l)}}function H0t(t,e,i){const r=e/i,s=At(t),n=Math.sin(r/2),o=Math.cos(s),a=2*Md(Math.sqrt(n*n/(o*o)));return Ao(a)}function q0t(t,e){return t/15}function uge(t,e){const i=t==null?void 0:t[0];if(i==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=q0t(i);const r=e.hours%1;e.hours-=r,e.minutes=60*r;const s=e.minutes%1;return e.minutes-=s,e.seconds=Math.round(60*s),e}const sNe=De(0,0,1),nNe=ae($(),De(1,1,1)),W0t=new Ob(-180,180),fO=qe(),P_=$(),iE=$();function oNe(t,e,i,r=Coe()){ct(P_,t,sNe),fe(P_,P_)===0&&ct(P_,t,nNe),Pd(fO,-At(e),t),Ku(fO,fO,-At(i),P_);const{up:s,direction:n}=r;return ct(s,P_,t),ae(s,s),ot(s,s,fO),ae(n,t),Cd(n,n),ot(n,n,fO),r}function Z0t(t,e,i,r){const s=P_,n=iE;return ae(s,t),ct(iE,s,sNe),fe(iE,iE)===0&&ct(iE,s,nNe),ct(n,iE,s),QLe(e,i,r,s,n)}function Y0t(t,e,i,r){const s={eye:$(),up:null,tilt:r,heading:i},n=P_;n[0]=t[0],n[1]=t[2],n[2]=-t[1];const o=e,a=At(i),l=At(r),c=Math.sin(a),h=Math.cos(a),d=Math.sin(l),f=Math.cos(l),m=Ee(n);let g;if(Math.abs(l)<1e-8)g=o+m;else{const W=m/d,j=Md(o/W),B=Math.PI-l-j;g=W*Math.sin(B)}const v=f*o,_=o*o*(d*d),b=h*h*_,w=g-v,x=w*w,S=b*(b+x-n[1]*n[1]);if(S<0)return re(s.eye,n,g/m),s.tilt=0,$F(s,t);const C=Math.sqrt(S),T=n[1]*w,M=b+x;let I;if(I=h>0?-C+T:C+T,Math.abs(M)<1e-8)return m<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):re(s.eye,n,g/m),s.tilt=0,zq(s.eye),$F(s,t);s.eye[1]=I/M;const D=c*c*_,P=d*o,F=h*P*s.eye[1],L=s.eye[1]*s.eye[1],N=1-L,R=Math.sqrt(N),k=b*L+D-2*F*R*w+N*x;return Math.abs(k)<1e-8?(re(s.eye,n,g/m),s.tilt=0,zq(s.eye),$F(s,t)):(s.eye[0]=(N*(g*n[0]-v*n[0])-P*R*(n[0]*s.eye[1]*h+n[2]*c))/k,s.eye[2]=(N*(g*n[2]-v*n[2])-P*R*(n[2]*s.eye[1]*h-n[0]*c))/k,re(s.eye,s.eye,g),zq(s.eye),$F(s,t))}function zq(t){const e=t[1];t[1]=-t[2],t[2]=e}function $F(t,e){const i=oNe(e,t.heading,t.tilt);return t.up=i.up,t}function J0t(t,e,i){const r=Ee(e),s=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-t)),n=Md(i/(s/Math.sin(t)));return Ao(t-n)}function X0t(t,e,i){const r=At(t),s=Ee(e);return Md(i/(s/Math.sin(r)))+r}function K0t(t,e,i,r,s){let n,o,a,l;const c=e.latitude,h=yr(t.spatialReference).radius,d=e.longitude,f=H0t(c,i,h)/2;n=d-f,o=d+f;const m=At(c),g=(1+Math.sin(m))/(1-Math.sin(m)),v=(g+1)*Math.tan(r/h/2),_=v*v;function b(x){const S=Math.PI/2;return(x=i6e.normalize(x,-S))>S&&(x=Math.PI-x),x}if(a=1.5*Math.PI-2*Math.atan(.5*(v+Math.sqrt(4*g+_))),l=a+r/h,a=b(a),l=b(l),l<a){const x=l;l=a,a=x}if(a=Math.max(Ao(a),-90),l=Math.min(Ao(l),90),o=W0t.monotonic(n,o),o-n>180){const x=(o-n-180)/2;n+=x,o-=x}const w=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:Oe.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=w):s=new _i(n,a,o,l,w),t.spatialReference&&t.spatialReference.isWebMercator&&iv(s,!1,s),s}function Q0t(t,e){const i=t.frustum,{renderCoordsHelper:r}=t,s=r.getAltitude(e),n=t.spatialReference,o=r.referenceEllipsoid.radius,a=t.state.camera,l=a.eye,c=1+Sr(l,e)/(o+s),h=Math.sqrt(c*c-1),{minCurvature:d,maxCurvature:f,minSamples:m,maxSamples:g}=r_t,v=i_t(t),_=ue((h-d)/(f-d),0,1),b=Math.round(ft(m,g,_)),w=a.aboveGround,x=i.planes[bo.FAR],S=[],C=dA(cn,s_t,Gr()),T=dA(cn,n_t,Gr());ss(Uq,0,0,0,0);const M=D=>{};for(let D=0;D<4;D++){const P=D===Vy.NEAR_FAR_BOTTOM_RIGHT&&!w||D===Vy.NEAR_FAR_TOP_LEFT&&w?1-v:0,F=D===Vy.NEAR_FAR_BOTTOM_RIGHT&&w||D===Vy.NEAR_FAR_TOP_LEFT&&!w?v:1,L=i.lines[D],N=i.lines[D===3?0:D+1];for(let R=0;R<b;R++){const k=R/b,W=D===Vy.NEAR_FAR_BOTTOM_RIGHT?1-(1-k)**2:D===Vy.NEAR_FAR_TOP_LEFT?k**2:k,j=R===0?0:ft(P,F,W),B=fr(a_t,L.origin,N.origin,j),te=TRe(L.direction,N.direction,j,o_t);r.intersectManifoldClosestSilhouette(wf(B,te),s,Ql),eNe(Ql,l,Ql,x),S.push(os(Ql)),S.length!==0&&M(lA(S.at(-1),Ql));const le=(vB(C,Ql)?1:0)|(vB(T,Ql)?2:0);Uq[le]=1}}S.length>2&&M(lA(S[0],S.at(-1)));const I=e_t(BG(Uq)>1?t_t(aNe(S,C),T):[S],r,n);return new Ea({rings:I,spatialReference:n})}function e_t(t,e,i){const r=2*To();return t.map(s=>{const n=[];let o=!1;for(const a of s)e.fromRenderCoords(a,Ql,i),Math.abs(a[0])<r&&Math.abs(a[1])<r?(n.push([null,Ql[1]]),n.push([null,Ql[1]]),o=!0):n.push([Ql[0],Ql[1]]);if(o)for(let a=0;a<n.length;a++){const l=n[a];if(l[0]!=null)continue;const c=n[a+1],h=n.at(a===0?-1:a-1);l[0]=h[0],a++;const d=n.at(a===n.length-1?0:a+1);c[0]=d[0]}return n.push(n[0]),eb(n)||n.reverse(),n})}function t_t(t,e){const i=[];for(const r of t)i.push(...aNe(r,e));return i}function aNe(t,e){const i=[],r=[],s=To();for(let o=0;o<t.length;o++){const a=t[o],l=o===t.length-1?t[0]:t[o+1],c=v5(a,l,l_t),h=yL(e,c.origin,c.vector,lf.NONE,Ql);switch(h){case nc.INSIDE:i.push(a);break;case nc.OUTSIDE:r.push(a);break;case nc.INTERSECTS_INSIDE_OUT:case nc.INTERSECTS_OUTSIDE_IN:{const[d,f,m]=h===nc.INTERSECTS_INSIDE_OUT?[1,i,r]:[-1,r,i],g=e,v=Qn($(),Ql,g,d*s),_=Qn($(),Ql,g,d*-s);f.push(a),f.push(v),m.push(_)}}}const n=[];return i.length&&n.push(i),r.length&&n.push(r),n}function i_t(t){const{renderCoordsHelper:e,state:{camera:i}}=t,{center:r,eye:s}=i,n=Math.abs(e.getAltitude(r)),o=Math.abs(Math.PI/2-Rv(e,r,s));return pM(hge,e.referenceEllipsoid.radius+n),Hse(hge,o,i.distance,i.fovY)}const r_t={minCurvature:At(5),maxCurvature:At(50),minSamples:1,maxSamples:6},s_t=De(1,0,0),n_t=De(0,1,0),o_t=$(),a_t=$(),Ql=$(),hge=Ls(),l_t=Gv(),Uq=yi(),c_t=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:Z0t,eyeForCenterWithHeadingTilt:Y0t,eyeTiltToLookAtTilt:X0t,headingTiltToDirectionUp:oNe,lookAtTiltToEyeTilt:J0t,toArea:Q0t,toExtent:K0t},Symbol.toStringTag,{value:"Module"}));function SA(t,e){return t!=null&&(e==null||(e===je.Local?!t.isGeographic||t.isWGS84||t.wkid===Xc.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===Xc.CGCS2000||t.wkid===Xc.GCSMARS2000||t.wkid===Xc.GCSMARS2000_SPHERE||t.wkid===Xc.GCSMOON2000))}const $oe=()=>J.getLogger("esri.views.3d.support.cameraUtils"),lNe=96*39.37,dK=1,u_t=8,h_t=5,cNe=1,d_t={heading:0,tilt:0},wP=$(),p_t=new Ob(-20037508342788905e-9,20037508342788905e-9),f_t=new Ob(-180,180);var So;function pw(t){return t.spatialReference??Oe.WGS84}function fw({state:t}){return t.isGlobal?c_t:V0t}function m_t(t,e,i,r,s){return fw(t).headingTiltToDirectionUp(e,i,r,s)}function Sm(t,e){if(e==null)return null;const i=t.renderSpatialReference,r=fw(t).headingTiltToDirectionUp,s=$();if(!gc(e.position,s,i))return null;const n=r(s,e.heading,e.tilt);re(n.direction,n.direction,t.state.camera.distance),oe(n.direction,n.direction,s);const o=pT(t,s,n.direction,n.up);return o.fov=At(e.fov),o.row=e.layout.row,o.rows=e.layout.rows,o.column=e.layout.column,o.columns=e.layout.columns,o}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})(So||(So={}));const rE=$();function TA(t,e,i){const r=t.renderSpatialReference,s=PL(t,e.eye,e.viewForward,e.up,d_t);let n=pw(t);return vc(e.eye,r,rE,n)||(n=Oe.WGS84,vc(e.eye,r,rE,n)),i==null?i=new ou(new Fe(rE,n),s.heading,s.tilt,Ao(e.fov)):(i.position.x=rE[0],i.position.y=rE[1],i.position.z=rE[2],i.position.spatialReference=n,i.heading=s.heading,i.tilt=s.tilt,i.fov=Ao(e.fov)),i.layout.row=e.row,i.layout.rows=e.rows,i.layout.column=e.column,i.layout.columns=e.columns,i}function W3(t,e){const{camera:i}=t.state,{unitInMeters:r}=t.renderCoordsHelper;return e/=r,i.width/2/i.pixelRatio/(lNe/e)/Math.tan(i.fovX/2)}function LS(t,e){const{camera:i}=t.state,{unitInMeters:r}=t.renderCoordsHelper,s=e*Math.tan(i.fovX/2),n=i.width/2/i.pixelRatio;return lNe/(n/s)*r}function uNe(t,e,i,r){const s=r.levelAtScale(e),n=hNe(PL(t,i.eye,i.viewForward,i.up).tilt),o=Math.max(s-n,0);return r.scaleAtLevel(o)}function dge(t,e,i){const r=i.levelAtScale(t),s=hNe(e);return i.scaleAtLevel(r+s)}function hNe(t){return 2*((t>90?180-t:t)/90)**2}function g_t(t,e,i=0){var o;const r=(o=t.basemapTerrain)==null?void 0:o.tilingScheme;if(!r)return 0;const s=yr(t.spatialReference).radius,n=t.state.viewingMode===je.Local?e.eye[2]:Ee(e.eye)-s;return uNe(t,LS(t,Math.abs(n-i)),e,r)}function y_t(t,e,i=0){const r=Sm(t,e);return r?g_t(t,r,i):0}const v_t=1,__t=100;function b_t(t,e,i,r,s){var g;if(e===0)return 0;const n=Sr(i.eye,r),o=(g=t.basemapTerrain)==null?void 0:g.tilingScheme;if(!o)return $oe().error("#scaleToTargetDistance()","Cannot compute distance from scale without a tiling scheme"),n;let a=n;const l=PL(t,i.eye,i.viewForward,i.up),c=l.tilt>90;if(t.state.isLocal){const v=(W3(t,dge(e,l.tilt,o))-Math.abs(i.eye[2]-s[2]))/Math.cos(At(l.tilt));return a=c?a-v:a+v,a}let h=1/0,d=0,f=Z3(t,l.heading,l.tilt,r,n,So.ADJUST);if(!f)return a;const m=Ee(s);for(;h>v_t&&d<__t;){const v=Ee(f.eye),_=c?180-f.tilt:f.tilt,b=At(_),w=Math.sin(b)*v,x=Math.cos(b)*v,S=W3(t,dge(e,f.tilt,o)),C=c?m-S:m+S,T=Md(w/C),M=Math.cos(T)*C-x,I=Sr(f.eye,r);a=c?I-M:I+M,f=Z3(t,l.heading,l.tilt,r,a,So.ADJUST);const D=Moe(t,f,Ao(i.fov));if(!f||!D)return a;const P=y_t(t,D,m-yr(t.spatialReference).radius);h=Math.abs(e-P),++d}return a}async function w_t(t,e,i,r,s,n){return I6(t,e,W3(t,i),r,s,n)}function x_t(t,e,i,r,s,n){return Moe(t,Z3(t,r.heading,r.tilt,e,i,s),r.fov,n)}async function I6(t,e,i,r,s,n){const o=await pNe(t,r.heading,r.tilt,e,i,s,n);return gt(n),ENe(t,o,r.fov,n)}function PL(t,e,i,r,s){return fw(t).directionToHeadingTilt(e,i,r,s)}function dNe(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,wP,t.spatialReference)&&t.elevationProvider&&(Pm(t.elevationProvider,wP)??0)>wP[2]-cNe)}async function S_t(t,e,i){if(dNe(t,e))return!0;const{elevationProvider:r,spatialReference:s,renderCoordsHelper:n}=t;if(r==null||!n.fromRenderCoords(e,wP,s))return!1;const[o,a,l]=wP,c=await r.queryElevation(o,a,l,s,"ground",i)??0;return gt(i),c>l-cNe}async function T_t(t,e,i){const r=$();if(e==null)return ne(r,t.state.camera.center);if(e instanceof Fe){const{renderSpatialReference:s,basemapTerrain:n,elevationProvider:o}=t,a=e.spatialReference;if(await mB(e,r,s,0,{signal:i}),gt(i),e.z==null&&n!=null&&o!=null){const l=await o.queryElevation(e.x,e.y,e.z??0,a,"ground",i);gt(i),l!=null&&t.renderCoordsHelper.setAltitude(r,l)}return r}return ne(r,e)}function E_t(t,e){const i=$();if(e==null)return ne(i,t.state.camera.center);if(e instanceof Fe){if(!gc(e,i,t.renderSpatialReference))return null;const{basemapTerrain:r,elevationProvider:s}=t;if(e.z==null&&r!=null&&s!=null){const n=Pm(s,e);n!=null&&t.renderCoordsHelper.setAltitude(i,n)}return i}return ne(i,e)}function Z3(t,e,i,r,s,n){return fNe(t,e,i,r instanceof Fe?r:null,E_t(t,r),s,n)}async function pNe(t,e,i,r,s,n,o){const a=r instanceof Fe?r:null,l=await T_t(t,r,o);return gt(o),mNe(t,e,i,a,l,s,n,o)}function fNe(t,e,i,r,s,n,o){if(s==null||!r&&(r=new Fe({spatialReference:pw(t)}),!dT(s,t.renderSpatialReference,r)))return null;const a=gNe(t,e,i,s,n,o);if(yNe(t,i,o)&&dNe(t,a.eye)){const{tilt:l,mode:c}=vNe(t,i,s,n);return fNe(t,e,l,r,s,n,c)}return _Ne(a,s)}async function mNe(t,e,i,r,s,n,o,a){r||(r=new Fe({spatialReference:pw(t)}),await XLe(s,t.renderSpatialReference,r,{signal:a})||(r=null)),gt(a);const l=gNe(t,e,i,s,n,o);if(yNe(t,i,o)&&await S_t(t,l.eye,a)){gt(a);const{tilt:c,mode:h}=vNe(t,i,s,n);return mNe(t,e,c,r,s,n,h,a)}return _Ne(l,s)}function gNe(t,e,i,r,s,n){const o=A_t(t,e,i,r,s=Math.max(s,t.state.constraints.minimumPoiDistance),n);return(0,fw(t).eyeForCenterWithHeadingTilt)(r,s,o.heading,o.tilt)}function yNe(t,e,i){const r=t.map.ground.navigationConstraint;return i===So.ADJUST&&t.state.isGlobal&&e>0&&(r==null||r.type==="stay-above")}function vNe(t,e,i,r){const s=TNe(t,i,r,O_t(t,r,e,i));return{tilt:s,mode:e-s<1?So.LOCKED:So.ADJUST}}function _Ne(t,e){return{...t,center:os(e)}}function bNe(t,e){const{state:i,spatialReference:r}=t,s=e.spatialReference;return i.isGlobal&&SA(s,je.Global)||i.isLocal&&r.equals(s)}function wNe(t,e){let i,r,s;if(t.state.isGlobal){const h=new Fe(e.xmin,e.ymin,e.spatialReference),d=new Fe(e.xmax,e.ymax,e.spatialReference),f=e.spatialReference.isGeographic?f_t:p_t;i=new Fe({x:f.center(h.x,d.x),y:(d.y+h.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const m=yr(e.spatialReference),g=G0t(i,h,d);r=g.lon,s=g.lat,f.diff(h.x,d.x)>f.range/2&&(r+=m.halfCircumference),r=Math.min(r,m.halfCircumference),s=Math.min(s,m.halfCircumference)}else{const h=t.renderSpatialReference??e.spatialReference;h.equals(e.spatialReference)||(e=Nd(e,h)),r=e.xmax-e.xmin,s=e.ymax-e.ymin;const d=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;i=new Fe({x:e.xmin+.5*r,y:e.ymin+.5*s,z:d,spatialReference:h})}const n=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,o=t.state.camera,a=1/Math.tan(o.fovX/2),l=1/Math.tan(o.fovY/2),c=1/Math.tan(o.fov/2);return{center:i,distance:Math.max(.5*r*a,.5*s*l,.5*n*c)/dK}}async function xNe(t,e,i,r,s,n){const o=bNe(t,e)?e:await Bb(e,t.spatialReference,{signal:n});gt(n);const{center:a,distance:l}=wNe(t,o),c=await pNe(t,i,r,a,l,s,n);return gt(n),ENe(t,c,t.camera.fov,n)}function O5(t,e,i,r,s,n){let o;try{o=bNe(t,e)?e:Nd(e,t.spatialReference)}catch{return null}const{center:a,distance:l}=wNe(t,o),c=Z3(t,i,r,a,l,s);return c==null?null:Moe(t,c,t.camera.fov,n)}function SNe(t,e,i){const r=t.renderSpatialReference,s=new Fe({spatialReference:pw(t)});if(!dT(i,r,s))return null;const n=Math.tan(e.fovX/2),o=Math.tan(e.fovY/2),a=Ba(e.eye,i),l=2*a*n*dK,c=2*a*o*dK;return fw(t).toExtent(t,s,l,c)}function C_t(t,e){return fw(t).toArea(t,e)}function $_t(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(i/r)/Math.LN2>u_t)return!0;const s=e,n=t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;return Sr(s,n)/(Math.tan(.5*t.state.camera.fov)*r)>h_t}function A_t(t,e,i,r,s,n){let o=0;return n===So.ADJUST&&$_t(t,r,s)?(e=0,o=M_t(t,s,i,r)):o=Aoe(t,r,s,i),o=t.state.constraints.clampTilt(s,o),{heading:e,tilt:i=TNe(t,r,s,o)}}const qB=.7;function M_t(t,e,i,r){const s=Aoe(t,r,e,i);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);n.max=Math.min(n.max,.5*Math.PI);const o=n.min*(1-qB)+n.max*qB;return Math.min(s,o)}function O_t(t,e,i,r){let s=Aoe(t,r,e,i);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);return s=Math.min(s,.5*Math.PI),n.min*(1-qB)+s*qB}function TNe(t,e,i,r){return fw(t).lookAtTiltToEyeTilt(r,e,i)}function Aoe(t,e,i,r){return fw(t).eyeTiltToLookAtTilt(r,e,i)}function Moe(t,e,i,r){if(e==null)return null;const s=t.renderSpatialReference,n=new Fe({spatialReference:pw(t)});return dT(e.eye,s,n)?(r??(r=new ou),r.position=n,r.heading=e.heading,r.tilt=e.tilt,r.fov=i,r):null}async function ENe(t,e,i,r){const s=t.renderSpatialReference,n=new Fe({spatialReference:pw(t)});return await XLe(e.eye,s,n,{signal:r}),gt(r),new ou(n,e.heading,e.tilt,i)}function I_t(t,e){var r;const i=(r=t.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.levelAtScale(e);$oe().error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function CNe(t,e){var r;const i=(r=t.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.scaleAtLevel(e);$oe().error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}const Ooe=()=>J.getLogger("esri.layers.support.ElevationSampler");let $Ne=class{queryElevation(e){return ANe(e.clone(),this)}on(){return Pi()}projectIfRequired(e,i){return MNe(e,i)}},R_t=class extends $Ne{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){super(),this.tile=e,this.noDataValue=r;const s=e.tile.extent;this.extent=GD(s,i.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=s;const n=Mo(i.spatialReference),o=i.lodAt(e.tile.level).resolution*n;this.demResolution={min:o,max:o}}contains(e){const i=this.projectIfRequired(e,this.spatialReference);return i!=null&&this.containsAt(i.x,i.y)}containsAt(e,i){return Yj(this._aaExtent,e,i)}elevationAt(e,i){if(!this.containsAt(e,i)){const r=this.extent,s=`${r.xmin}, ${r.ymin}, ${r.xmax}, ${r.ymax}`;return Ooe().warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${s})`),this.noDataValue}return this.tile.sample(e,i)??this.noDataValue}},Pii=class extends $Ne{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){let s;super(),typeof i=="number"?(this.noDataValue=i,s=null):(s=i,this.noDataValue=r),this.samplers=s?e.map(o=>new R_t(o,s,this.noDataValue)):e;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=GD(si(),s.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,i){let r,s=!1;for(const n of this.samplers)if(n.containsAt(e,i)&&(s=!0,r=n.elevationAt(e,i),r!==n.noDataValue))return r;return r??(s||Ooe().warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler`),this.noDataValue)}};function ANe(t,e){const i=MNe(t,e.spatialReference);if(!i)return null;switch(t.type){case"point":P_t(t,i,e);break;case"polyline":D_t(t,i,e);break;case"multipoint":L_t(t,i,e)}return t}function MNe(t,e){if(t==null)return null;const i=t.spatialReference;if(i.equals(e))return t;const r=VD(t,e);return r||Ooe().error(`Cannot project geometry spatial reference (wkid:${i.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),r}function P_t(t,e,i){t.z=i.elevationAt(e.x,e.y)}function D_t(t,e,i){Om.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s],o=e.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];Om.x=c[0],Om.y=c[1],r&&(l[3]=l[2]),l[2]=i.elevationAt(Om.x,Om.y)}}t.hasZ=!0}function L_t(t,e,i){Om.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let s=0;s<t.points.length;s++){const n=t.points[s],o=e.points[s];Om.x=o[0],Om.y=o[1],r&&(n[3]=n[2]),n[2]=i.elevationAt(Om.x,Om.y)}t.hasZ=!0}const Om=new Fe,N_t=12;let oc=class Ac{constructor(e){const i=Ac.checkUnsupported(e);if(i!=null)throw i;const r=e;this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=HS(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;const s=r.lods.reduce((c,h)=>(h.level<c.minLod.level&&(c.minLod=h),c.max=Math.max(c.max,h.level),c),{minLod:r.lods[0],max:-1/0}),n=s.minLod,o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*r.size[0],a*r.size[1]]},a/=2,l/=2}clone(){return new Ac(this.toTileInfo())}toTileInfo(){return new QR({dpi:this.dpi,origin:new Fe({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,i)=>new td({level:i,scale:e.scale,resolution:e.resolution}))})}getExtent(e,i,r,s){const n=this.levels[e],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+r*o,s[2]=this.origin[0]+(r+1)*o,s[3]=this.origin[1]-i*a,s[1]=this.origin[1]-(i+1)*a}convertExtentToRadians(e,i){this._isWebMercator?(i[0]=hue(e[0]),i[1]=nZ(e[1]),i[2]=hue(e[2]),i[3]=nZ(e[3])):this._isGCS&&(i[0]=At(e[0]),i[1]=At(e[1]),i[2]=At(e[2]),i[3]=At(e[3]))}getExtentGeometry(e,i,r,s=new _i){return this.getExtent(e,i,r,Ff),s.spatialReference=this.spatialReference,s.xmin=Ff[0],s.ymin=Ff[1],s.xmax=Ff[2],s.ymax=Ff[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(e){if(e==null)return!1;let i=!1;for(;this.levels.length<=e;){const{resolution:r,scale:s}=this.levels[this.levels.length-1],n=r/2*this.pixelSize;this.levels.push({resolution:r/2,scale:s/2,tileSize:[n,n]}),i=!0}return i}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const i=this.levels[0].scale;return e>=i?0:Math.log(i/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e,i=1/0){if(Ac.checkUnsupported(e))return!1;const r=new Ac(e);if(!r.spatialReference.equals(this.spatialReference)||r.pixelSize!==this.pixelSize)return!1;const s=Math.min(this.levels.length-1,r.levels.length-1,i),n=this.levels[s].resolution;let o=.5*n;return!tu(r.origin[0],this.origin[0],o)||!tu(r.origin[1],this.origin[1],o)?!1:(o=.5*n/2**s/this.pixelSize*N_t,tu(n,r.levels[s].resolution,o))}rootTilesInExtent(e,i=null,r=1/0){const s=new Array,n=this.levels[0].tileSize;if(e==null||n[0]===0||n[1]===0)return s;Ac.computeRowColExtent(e,n,this.origin,Ff);let o=Ff[1],a=Ff[3],l=Ff[0],c=Ff[2];const h=c-l,d=a-o;if(h*d>r){const f=Math.floor(Math.sqrt(r));d>f&&(o=o+Math.floor(.5*d)-Math.floor(.5*f),a=o+f),h>f&&(l=l+Math.floor(.5*h)-Math.floor(.5*f),c=l+f)}for(let f=o;f<a;f++)for(let m=l;m<c;m++)s.push([0,f,m]);return i!=null&&(i[0]=this.origin[0]+l*n[0],i[1]=this.origin[1]-a*n[1],i[2]=this.origin[0]+c*n[0],i[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(e,i,r,s){const n=.001*(e[2]-e[0]+(e[3]-e[1]));s[0]=Math.max(0,Math.floor((e[0]+n-r[0])/i[0])),s[2]=Math.max(0,Math.ceil((e[2]-n-r[0])/i[0])),s[1]=Math.max(0,Math.floor((r[1]-e[3]+n)/i[1])),s[3]=Math.max(0,Math.ceil((r[1]-e[1]-n)/i[1]))}static isPowerOfTwo(e){const i=e.lods,r=i[0].resolution*2**i[0].level;return!i.some(s=>!QGe(s.resolution,r/2**s.level))}static hasGapInLevels(e){const i=e.lods.map(r=>r.level);i.sort((r,s)=>r-s);for(let r=1;r<i.length;r++)if(i[r]!==i[0]+r)return!0;return!1}static tileSizeSupported(e){const i=e.size[1];return i===e.size[0]&&!(i&i-1)&&i>=128&&i<=512}static hasOriginPerLODs(e){const i=e.origin;return e.lods.some(r=>r.origin!=null&&(r.origin[0]!==i.x||r.origin[1]!==i.y))}static getMissingTileInfoError(){return new U("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return e==null?Ioe():e.lods.length<1?new U("tilingscheme:generic","Tiling scheme must have at least one level"):Ac.isPowerOfTwo(e)?Ac.hasGapInLevels(e)?new U("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):Ac.tileSizeSupported(e)?Ac.hasOriginPerLODs(e)?new U("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new U("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new U("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,i){const r=e[2]-e[0],s=e[3]-e[1],n=Mo(i),o=1.2*Math.max(r,s),a=256,l=o/a,c=l*n*(96/.0254),h=new Ac(new QR({size:[a,a],origin:new Fe({x:e[0]-.5*(o-r),y:e[3]+.5*(o-s)}),lods:[new td({level:0,resolution:l,scale:c})],spatialReference:i}));return h.ensureMaxLod(20),h}static makeWebMercatorAuxiliarySphere(e){const i=new Ac(Ac.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(e),i}static makeGCSWithTileSize(e,i=256,r=16){const s=256/i,n=new Ac(new QR({size:[i,i],origin:new Fe({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new td({level:0,resolution:.703125*s,scale:295497598570834e-6*s})]}));return n.ensureMaxLod(r),n}get test(){}};function Ioe(){return new U("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}oc.WebMercatorAuxiliarySphereTileInfo=new QR({size:[256,256],origin:new Fe({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:Oe.WebMercator}),spatialReference:Oe.WebMercator,lods:[new td({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),oc.WebMercatorAuxiliarySphere=oc.makeWebMercatorAuxiliarySphere(19);const Ff=si(),gC=64,YI=512,F_t=2.5,Roe=e6e(UW/10),ONe=2,INe=si();oc.WebMercatorAuxiliarySphere.getExtent(0,0,0,INe);const k_t=si([-180,-90,180,90]),z_t="Cannot extend surface to encompass all layers because it would result in too many root tiles.",U_t="Surface extent is too large for tile resolution at level 0.",In=4;let r_=class extends Ss.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=Roe}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if((e==null?void 0:e.extent)==null||e.spatialReference==null)return null;const i=GD(e.extent,e.spatialReference);return i.zmin=e.visibleElevationBounds.min,i.zmax=e.visibleElevationBounds.max,i}get spatialReference(){var e;return((e=this.view.basemapTerrain)==null?void 0:e.spatialReference)??Oe.WGS84}elevationAt(e,i){var r;if(this.extent==null||!vl(this.extent,e,i)){const s=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return J.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${s})`),this.noDataValue}return((r=this.view.elevationProvider)==null?void 0:r.getElevation(e,i,0,this.spatialReference,"ground"))??this.noDataValue}queryElevation(e){return ANe(e.clone(),this)}};u([p({readOnly:!0})],r_.prototype,"demResolution",void 0),u([p({readOnly:!0})],r_.prototype,"extent",null),u([p({readOnly:!0})],r_.prototype,"noDataValue",void 0),u([p()],r_.prototype,"spatialReference",null),u([p({constructOnly:!0})],r_.prototype,"view",void 0),r_=u([A("esri.views.support.GroundViewElevationSampler")],r_);const B_t=r_;let uy=class extends he{constructor(e){super(e),this.view=null,this.layerViews=new Ce}initialize(){this.addHandles(bn(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.ground},e=>e.load())),this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null);for(const e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new B_t({view:this.view}):null:null}get extent(){const e=this.view;return e&&e.type!=="2d"&&e.ready?SNe(e,e.state.camera,e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation):null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){var e;return((e=this.view)==null?void 0:e.suspended)??!0}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map(e=>H(()=>e.updating,()=>this._updateUpdating(),Yt)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};u([p({readOnly:!0})],uy.prototype,"elevationSampler",null),u([p({readOnly:!0})],uy.prototype,"extent",null),u([p({type:Boolean,readOnly:!0})],uy.prototype,"updating",null),u([p({constructOnly:!0})],uy.prototype,"view",void 0),u([p({type:Ce,readOnly:!0})],uy.prototype,"layerViews",void 0),u([p({readOnly:!0})],uy.prototype,"suspended",null),uy=u([A("esri.views.GroundView")],uy);const V_t=uy,mO=()=>G(()=>import("./TileLayerView3D-BrZG5rhS.js"),__vite__mapDeps([231,232,233,234,164,165,166,167,168,169,170])),pge=()=>G(()=>import("./ElevationLayerView3D-DOWW9NyC.js"),__vite__mapDeps([235,117,232,233,164])),fge={"base-dynamic":()=>G(()=>import("./BaseDynamicLayerView3D-Bt3c_Y4F.js"),__vite__mapDeps([236,237,232,238,239,240,241,242,164,165])),"base-elevation":pge,"base-tile":mO,"bing-maps":mO,"building-scene":()=>G(()=>import("./BuildingSceneLayerView3D-DDwl-WtT.js"),__vite__mapDeps([243,244,245,246,247,248,88,77,170,19,20,249,250,251,252,253,87,111,254,255,256,257,258,27,26,86,259,260,261,262,21,16,12,172,17,18,22,5,6,7,8,23,232,164])),catalog:()=>G(()=>import("./CatalogLayerView3D-XNmvkiTX.js"),__vite__mapDeps([263,232,182,164])),"catalog-dynamic-group":()=>G(()=>import("./CatalogDynamicGroupLayerView3D-CMyFIA_4.js"),__vite__mapDeps([264,232,184,164])),"catalog-footprint":()=>G(()=>import("./CatalogFootprintLayerView3D--gtl8Vrp.js"),__vite__mapDeps([265,266,267,172,238,239,268,104,105,269,270,129,257,258,27,26,170,271,259,167,17,18,19,20,21,16,12,22,5,6,7,8,23,260,24,25,137,232,41,39,40,272,177,176,164,165,186])),csv:()=>G(()=>import("./CSVLayerView3D-DvzVQII9.js"),__vite__mapDeps([273,266,267,172,238,239,268,104,105,269,270,129,257,258,27,26,170,271,259,167,17,18,19,20,21,16,12,22,5,6,7,8,23,260,24,25,137,232,41,39,40,272,177,176,164,165])),dimension:()=>G(()=>import("./DimensionLayerView3D-fNpB89rX.js"),__vite__mapDeps([274,232,164])),elevation:pge,feature:()=>G(()=>import("./FeatureLayerView3D-BoJiEogw.js"),__vite__mapDeps([275,266,267,172,238,239,268,104,105,269,270,129,257,258,27,26,170,271,259,167,17,18,19,20,21,16,12,22,5,6,7,8,23,260,24,25,137,232,41,39,40,272,177,176,164,165])),geojson:()=>G(()=>import("./GeoJSONLayerView3D-DQ56hrRo.js"),__vite__mapDeps([276,266,267,172,238,239,268,104,105,269,270,129,257,258,27,26,170,271,259,167,17,18,19,20,21,16,12,22,5,6,7,8,23,260,24,25,137,232,41,39,40,272,177,176,164,165])),graphics:()=>G(()=>import("./GraphicsLayerView3D-CDDjdQB5.js"),__vite__mapDeps([277,232,269,278,257,258,27,26,170,271,260,238,239,164])),group:()=>G(()=>import("./GroupLayerView3D-C_O_6Tns.js"),__vite__mapDeps([279,190,164])),imagery:()=>G(()=>import("./ImageryLayerView3D-CglwvmGm.js"),__vite__mapDeps([280,237,232,238,239,240,241,242,164,165,193,172,83,170])),"integrated-mesh":()=>G(()=>import("./IntegratedMeshLayerView3D-SG95AUpZ.js"),__vite__mapDeps([281,249,250,251,252,253,87,88,77,111,254,255,256,257,258,27,26,170,86,259,260,232,164])),"integrated-mesh-3dtiles":()=>G(()=>import("./IntegratedMesh3DTilesLayerView3D-D1CZHOyM.js"),__vite__mapDeps([282,250,251,96,232,164])),"line-of-sight":()=>G(()=>import("./LineOfSightLayerView3D-Byzw6EVo.js"),__vite__mapDeps([283,232,164])),"map-image":()=>G(()=>import("./MapImageLayerView3D-BdyN6kHz.js"),__vite__mapDeps([284,237,232,238,239,240,241,242,164,165,204,205,167,169,172,166,168,170])),media:()=>G(()=>import("./MediaLayerView3D-Dtc8poec.js").then(t=>t.M),__vite__mapDeps([285,208,68,232,286,287,288,289,290,158,291,240,241,242,164,211])),"ogc-feature":()=>G(()=>import("./OGCFeatureLayerView3D-DXEUagNn.js"),__vite__mapDeps([292,266,267,172,238,239,268,104,105,269,270,129,257,258,27,26,170,271,259,167,17,18,19,20,21,16,12,22,5,6,7,8,23,260,24,25,137,232,41,39,40,272,177,176,164,165,213])),"open-street-map":mO,"oriented-imagery":()=>G(()=>import("./FeatureLayerView3D-BoJiEogw.js"),__vite__mapDeps([275,266,267,172,238,239,268,104,105,269,270,129,257,258,27,26,170,271,259,167,17,18,19,20,21,16,12,22,5,6,7,8,23,260,24,25,137,232,41,39,40,272,177,176,164,165])),"point-cloud":()=>G(()=>import("./PointCloudLayerView3D-DMSfo8Lb.js"),__vite__mapDeps([293,232,88,77,75,76,260,294,170,164])),viewshed:()=>G(()=>import("./ViewshedLayerView3D-z4eoS6BX.js"),__vite__mapDeps([295,232,164])),voxel:()=>G(()=>import("./VoxelLayerView3D-CKc4L2Jk.js"),__vite__mapDeps([296,232,297,294,170,164])),route:()=>G(()=>import("./RouteLayerView3D-Drdreyuc.js"),__vite__mapDeps([298,215,216,232,278,257,258,27,26,170,271,260,238,239,272,164])),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?G(()=>import("./SceneLayerView3D-uebdPNIb.js"),__vite__mapDeps([299,111,19,20,167,249,250,251,252,253,87,88,77,254,255,256,257,258,27,26,170,86,259,260,232,300,262,21,16,12,172,164,261,17,18,22,5,6,7,8,23,294])):G(()=>import("./SceneLayerGraphicsView3D-DmPsZspl.js"),__vite__mapDeps([301,252,251,253,87,88,77,111,232,270,129,257,258,27,26,170,271,259,167,17,18,19,20,21,16,12,22,5,6,7,8,23,260,300,262,172,164,294])),stream:()=>G(()=>import("./StreamLayerView3D-DUQ_zwVD.js"),__vite__mapDeps([302,71,72,57,73,41,39,40,272,267,172,238,239,268,104,105,269,270,129,257,258,27,26,170,271,259,167,17,18,19,20,21,16,12,22,5,6,7,8,23,260,24,25,137,232,164,218])),tile:mO,"imagery-tile":()=>G(()=>import("./ImageryTileLayerView3D-Bw5RCCEN.js"),__vite__mapDeps([303,83,232,233,196,198,199,172,170,164,165,168])),"vector-tile":()=>G(()=>import("./VectorTileLayerView3D-CnTm2Jvr.js"),__vite__mapDeps([304,221,56,40,55,139,145,131,132,94,232,233,164])),wcs:()=>G(()=>import("./ImageryTileLayerView3D-Bw5RCCEN.js"),__vite__mapDeps([303,83,232,233,196,198,199,172,170,164,165,168])),"web-tile":mO,wfs:()=>G(()=>import("./WFSLayerView3D-NQiWoAB9.js"),__vite__mapDeps([305,266,267,172,238,239,268,104,105,269,270,129,257,258,27,26,170,271,259,167,17,18,19,20,21,16,12,22,5,6,7,8,23,260,24,25,137,232,41,39,40,272,177,176,164,165])),wms:()=>G(()=>import("./WMSLayerView3D-C49q-ADm.js"),__vite__mapDeps([306,237,232,238,239,240,241,242,164,165,226,227,172])),wmts:()=>G(()=>import("./WMTSLayerView3D-D9tsQlFM.js"),__vite__mapDeps([307,232,233,234,164,165])),parquet:null,"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};function j_t(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",i=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new U(`${i}:view-not-supported`,`${e} is not supported in 3D`)}const mge={hasLayerViewModule:t=>fge[t.type]!=null,importLayerView:t=>{const e=fge[t.type];if(e==null)throw j_t(t);return e(t)}},gge="analyses-owner-handles";var yC,gx;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(yC||(yC={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(gx||(gx={}));let U1=class extends he{constructor(e){super(e),this._allAnalysisViews=new Ce,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=yge(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null},viewshed:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(bi("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(bi()),this._attachedToViewResolver=yge()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const i=this._items.get(e);if(i==null||i.state.list===gx.REMOVED)throw new U("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return i.createAnalysisViewTask.promise}_connectOwners(){this.addHandles(this._connectAnalysesCollection(this.view.analyses),gge)}_disconnectOwners(){this.removeHandles(gge),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const s of e)this._addAnalysis(s);const i=e.on("after-add",s=>this._addAnalysis(s.item)),r=e.on("after-remove",s=>this._removeAnalysis(s.item));return Pi(()=>{i.remove(),r.remove();for(const s of e)this._removeAnalysis(s)})}_addAnalysis(e){const i=this._items.get(e);if(i==null){const r={state:{view:yC.PENDING,list:gx.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,r),r.createAnalysisViewTask=gg(s=>this._createAnalysisViewPromise(r,s))}else i.state.list=gx.ADDED}_removeAnalysis(e){const i=this._items.get(e);i!=null?(i.state.list=gx.REMOVED,this._scheduleUpdate()):J.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=YA(()=>this._update()))}_update(){this._scheduledUpdateHandle=Ji(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===gx.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case yC.PENDING:e.createAnalysisViewTask=fc(e.createAnalysisViewTask);break;case yC.CREATED:e.view!=null&&(this._allAnalysisViews.remove(e.view),e.view=$e(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,i){const r=e.analysis,s=r.type,n=this._analysisModules[s];if(this._creatingViewCount+=1,n.module==null)try{n.module=await this._loadAnalysisModule(s)}catch(l){throw this._creatingViewCount-=1,l}if(Sa(i))throw this._creatingViewCount-=1,bi("AnalysisView creation aborted");const o=new n.module.default({analysis:r,view:this.view});let a=!0;Qo(i,()=>{a&&(this._creatingViewCount-=1,o.destroy())});try{await o.when()}catch(l){throw a=!1,o.destroyed||(this._creatingViewCount-=1,o.destroy()),l}if(Sa(i))throw bi();return a=!1,e.view=o,e.state.view=yC.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return G(()=>import("./AreaMeasurementAnalysisView3D-CBt4fWeI.js"),__vite__mapDeps([308,309,310,311,312,313,314,11,3,315,158,316,317,318,286,287,319,291,320,241,242,321]));case"dimension":return G(()=>import("./DimensionAnalysisView3D-CZSsMRdc.js"),__vite__mapDeps([322,311,323,310,319,291,317,318,320,324,316,314,11,3,315,158,325,326,242,327,328,286,287,240,241,329,330,331,332,333,334,335,290,288,336,337,321,338,268,289,339,340,341]));case"direct-line-measurement":return G(()=>import("./DirectLineMeasurementAnalysisView3D-C3pmZKBF.js"),__vite__mapDeps([342,309,310,311,312,317,318,316,314,11,3,315,158,291,319,320,335,333,326,242,321]));case"line-of-sight":return G(()=>import("./LineOfSightAnalysisView3D-8MtD7_PH.js"),__vite__mapDeps([343,311,344,317,318,345,255,256,325,326,242,346,334,339,328,286,287]));case"slice":return G(()=>import("./SliceAnalysisView3D-Cj-bs9Ve.js"),__vite__mapDeps([347,311,348,349,325,326,242,240,241,255,256,317,318,245,246,247,248,88,77,170,330,327,328,286,287,339,340,321]));case"viewshed":return G(()=>import("./ViewshedAnalysisView3D-5HOauCyt.js"),__vite__mapDeps([350,344,311,317,318,351,325,326,242,327,328,286,287,352,332,333,334,321,349,339,288,340]))}}};function yge(){const t=ta();return t.promise.catch(()=>{}),t}u([p()],U1.prototype,"updating",null),u([p({constructOnly:!0})],U1.prototype,"view",void 0),u([p()],U1.prototype,"_allAnalysisViews",void 0),u([p()],U1.prototype,"_creatingViewCount",void 0),U1=u([A("esri.views.3d.analysis.AnalysisViewManager3D")],U1);const G_t=U1;let hy=class extends he{constructor(e){super(e),this.collision=new JI,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===je.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==je.Local?this._set("altitude",e):J.getLogger(this).warn("Altitude constraint is ignored in local scenes")}get mode(){return this.state.viewingMode}clampAltitude(e){return this.altitude?ue(e,this.altitude.min,this.altitude.max):e}clampTilt(e,i){if(!this.tilt)return i;const r=this.tilt(e);return ue(i,r.min,r.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===je.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(i,r=Bq)=>(r.min=ma.min,r.max=e,r)}_createDefaultTiltLocal(){const e=this.collision.enabled?_5([[4e3,ma.max],[1e4,At(88)],[6e6,At(88)]]):()=>ma.max;return(i,r=Bq)=>(r.min=ma.min,r.max=e(i),r)}_createDefaultTiltGlobal(){const e=this.collision.enabled?_5([[4e3,ma.max],[5e4,At(88)],[6e6,At(88)],[2e7,ma.min]]):_5([[3e5,ma.max],[3e6,At(88)],[6e6,At(88)],[2e7,ma.min]]);return(i,r=Bq)=>(r.min=ma.min,r.max=e(i),r)}};function H_t(t){return{min:-2e5,max:4*t.radius}}u([p()],hy.prototype,"altitude",null),u([p({readOnly:!0})],hy.prototype,"collision",void 0),u([p()],hy.prototype,"distance",void 0),u([p({readOnly:!0})],hy.prototype,"minimumPoiDistance",void 0),u([p()],hy.prototype,"tilt",void 0),u([p({constructOnly:!0})],hy.prototype,"state",void 0),hy=u([A("esri.views.3d.state.Constraints")],hy);const vge=H_t(Ci),ma={min:At(.5),max:At(179.5)},Bq={min:0,max:0};let JI=class extends he{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};u([p({type:Boolean})],JI.prototype,"enabled",void 0),u([p({type:Number})],JI.prototype,"elevationMargin",void 0),JI=u([A("esri.views.3d.state.Constraints.CollisionConstraint")],JI);let vC=class extends Nt{constructor(){super(...arguments),this.min=vge.min,this.max=vge.max}};u([p({type:Number})],vC.prototype,"min",void 0),u([p({type:Number})],vC.prototype,"max",void 0),vC=u([A("esri.views.3d.constraints.AltitudeConstraint")],vC);let Iy=class extends Nt{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,i){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==i&&this._set("far",i))}};u([p({type:Number,value:1e-8})],Iy.prototype,"near",null),u([ti("near")],Iy.prototype,"castNear",null),u([p({type:Number,value:1e-8})],Iy.prototype,"far",null),u([ti("far")],Iy.prototype,"castFar",null),u([p({type:["auto","manual"]})],Iy.prototype,"mode",void 0),Iy=u([A("esri.views.3d.constraints.ClipDistanceConstraint")],Iy);const pK={min:Ao(ma.min),max:Ao(ma.max)};let yx=class extends Nt{constructor(e){super(e),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return ue(e,pK.min,pK.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};u([p({type:["auto","manual"]})],yx.prototype,"mode",void 0),u([p({type:Number,value:pK.max})],yx.prototype,"max",null),u([ti("max")],yx.prototype,"castMax",null),yx=u([A("esri.views.3d.constraints.TiltConstraint")],yx);let vx=class extends Nt{constructor(e){super(e),this.tilt=new yx,this.altitude=new vC,this.clipDistance=new Iy}};u([p({type:yx})],vx.prototype,"tilt",void 0),u([p({type:vC})],vx.prototype,"altitude",void 0),u([p({type:Iy})],vx.prototype,"clipDistance",void 0),vx=u([A("esri.views.3d.constraints.Constraints")],vx);function _ge(t){return as(t,nC)||KA(t)?{wkid:Xc.GCSMARS2000}:as(t,oC)||QA(t)?{wkid:Xc.GCSMOON2000}:Oe.WGS84}var ac;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(ac||(ac={}));let fK=class extends hu{constructor(){super(...arguments),this.steps=ac.SIXTEEN,this.writeTextureChannels=Mv.RG}};u([ie({count:ac.COUNT})],fK.prototype,"steps",void 0),u([ie({count:Mv.COUNT})],fK.prototype,"writeTextureChannels",void 0);let gO=class{constructor(e,i,r,s,n,o,a,l,c=.5){this.coverage=e,this.density=i,this.absorption=r,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}};const da={sunny:new gO([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],ac.SIXTEEN),cloudy:new gO([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],ac.TWOHUNDRED,.6),rainy:new gO([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],ac.TWOHUNDRED,.4),snowy:new gO([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],ac.HUNDRED,.65),foggy:new gO([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],ac.SIXTEEN)};da.default=da.sunny;const Qh=X("esri-mobile")?64:128,q_t=Qh/128,Ip=Math.ceil(Math.sqrt(Qh)),uv=(Qh+2)*Ip,W_t=1e5,AF=128,Z_t=uv/1560;function R6(t){t.code.add(E`vec2 sphereIntersect(vec3 start, vec3 dir, float distance) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * distance;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`)}let Poe=class extends cr{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.viewMatrix=Ts()}};const n$=X("esri-mobile")?1024:2048;function RNe(t){const e=new Vi;e.include(ia,!1);const i=e.fragment;return i.include(R6),i.uniforms.add(new mt("cloudRadius",r=>r.cloudRadius),new mt("power",r=>ft(35,120,r.absorption)),new mt("sigmaE",r=>1+r.absorption),new mt("density",r=>ft(0,.3,r.density)),new mt("cloudSize",r=>ft(0,.02,Math.max(.01,1-r.cloudSize))),new mt("detailSize",r=>ft(0,.2,Math.max(.01,1-r.detailSize))),new mt("smoothness",r=>ft(0,.5,1-r.smoothness)),new mt("cloudHeight",r=>ft(0,1500,r.cloudHeight)),new mt("coverage",r=>r.coverage),new Ud("view",r=>r.viewMatrix),new It("cloudShapeTexture",r=>r.noiseTexture!=null?r.noiseTexture.textureAtlas:null),new yc("cloudVariables",r=>di(Y_t,r.coverage,r.absorption))),i.constants.add("halfCubeMapSize","float",.5*n$),i.code.add(E`
    const int STEPS = ${t.steps===ac.SIXTEEN?E`16`:t.steps===ac.HUNDRED?E`100`:E`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),i.code.add(E`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${E.float(uv)};
      const float dataWidth = ${E.float(uv)};
      const float tileRows = ${E.float(Ip)};
      const vec3 atlasDimensions = vec3(${E.float(Qh)}, ${E.float(Qh)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${E.float(q_t)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${E.float(Z_t)} * p) / ${E.float(uv)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),i.code.add(E`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),i.code.add(E`float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}
float multipleOctaves(float extinction, float mu, float stepL) {
float attenuation = 1.0;
float contribution = 1.0;
float phaseAttenuation = 1.0;
float luminance = 0.0;
for (int i = 0; i < 4; i++) {
float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
attenuation *= 0.2;
contribution *= 0.6;
phaseAttenuation *= 0.5;
}
return luminance;
}`),i.code.add(E`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),i.code.add(E`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),i.main.add(E`if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
float cloudDistance = cloudRadius + cloudStart;
float rayStartDistance = dot(viewPos, viewPos) - (cloudDistance * cloudDistance);
vec2 rayStartIntersect = sphereIntersect(viewPos, rayDir, rayStartDistance);
float rayEndDistance = dot(viewPos, viewPos) - ((cloudDistance + cloudHeight) * (cloudDistance + cloudHeight));
vec2 rayEndIntersect = sphereIntersect(viewPos, rayDir, rayEndDistance);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);`),e}const Y_t=Ye(),J_t=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:Poe,build:RNe,cubeMapSize:n$},Symbol.toStringTag,{value:"Module"}));let Vq=class extends Hi{constructor(e,i){super(e,i,new Bi(J_t,()=>G(()=>Promise.resolve().then(()=>iHt),void 0)))}initializePipeline(e){return wi({blending:hT(Bt.CONSTANT_COLOR,Bt.ONE_MINUS_CONSTANT_COLOR,Sv.ADD,e.writeTextureChannels===Mv.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:Ui.LEQUAL},colorWrite:Di})}};var Ym;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})(Ym||(Ym={}));let I5=class extends hu{constructor(){super(...arguments),this.mode=Ym.Full}};u([ie({count:Ym.COUNT})],I5.prototype,"mode",void 0);let Doe=class extends cr{constructor(){super(...arguments),this.weatherTile=fn(0,0)}};function PNe(t){const e=new Vi;return e.include(ia,!1),e.fragment.code.add(E`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===Ym.Full&&(e.fragment.code.add(E`float saturate(float x) {
return clamp(x, 0.0, 1.0);
}`),e.fragment.code.add(E`vec3 modulo(vec3 m, float n) {
return mod(mod(m, n) + n, n);
}
vec3 hash(vec3 p3, float frequency) {
p3 = modulo(p3, frequency);
p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
p3 += dot(p3, p3.yxz + 33.33);
return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
}`),e.fragment.code.add(E`vec3 fade(vec3 t) {
return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
}`),e.fragment.code.add(E`
    float gradientNoise(vec3 p, float frequency) {
      vec3 i = floor(p);
      vec3 f = fract(p);
      vec3 u = fade(f);
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequency = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequency;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${E.float(Ip)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${E.float(8)});

      float worley0 = worley(p, ${E.float(2)} * 2.0);
      float worley1 = worley(p, ${E.float(2)} * 8.0);
      float worley2 = worley(p, ${E.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${E.float(2)});
      float worley1 = worley(p, ${E.float(2)} * 2.0);
      float worley2 = worley(p, ${E.float(2)} * 4.0);
      float worley3 = worley(p, ${E.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `)),e.fragment.uniforms.add(new yc("weatherTile",i=>i.weatherTile)).code.add(E`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${E.float(AF)});

      // Get global coordinates of p
      p += weatherTile * ${E.float(AF)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${E.float(W_t)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),t.mode===Ym.Full?e.fragment.main.add(E`
      float padWidth = 1.0;
      float paddedSize = ${E.float(Qh)} + 2.0 * padWidth;
      float tileCount = ${E.float(Ip)} * ${E.float(Ip)};
      vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

      bool padCell = false;
      if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
        padCell = true;
      }

      if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
        padCell = true;
      }

      bool startPadX = false;
      bool startPadY = false;
      bool endPadX = false;
      bool endPadY = false;

      if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
        startPadX = true;
      }

      if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
        startPadY = true;
      }

      if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
        endPadX = true;
      }

      if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
        endPadY = true;
      }

      vec2 padding = vec2(2.0 * padWidth) * tile;
      vec2 uv;

      if (padCell) {
        vec2 pixel = gl_FragCoord.xy - padWidth - padding;

        if (startPadX) {
          pixel.x += ${E.float(Qh)};
        }

        if (startPadY) {
          pixel.y += ${E.float(Qh)};
        }

        if (endPadX) {
          pixel.x -= ${E.float(Qh)};
        }

        if (endPadY) {
          pixel.y -= ${E.float(Qh)};
        }

        uv = vec2(pixel.xy / ${E.float(Qh)});
      } else {
        vec2 pixel = gl_FragCoord.xy - padWidth - padding;
        uv = vec2(pixel.xy / ${E.float(Qh)});
      }

      vec3 p_ = get3Dfrom2D(uv);
      vec3 p = p_;
      p.z /= (${E.float(Ip)} * ${E.float(Ip)});

      float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
      float worleyNoise = getTextureForPointWorley(p);

      fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

      p_ = mod(p_ + 1.0, ${E.float(Ip)} * ${E.float(Ip)});
      p = p_;
      p.z /= (${E.float(Ip)} * ${E.float(Ip)});

      worleyPerlinNoise = getTextureForPointPerlinWorley(p);
      worleyNoise = getTextureForPointWorley(p);

      fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

      vec2 mapUV = ${E.float(AF)} * (gl_FragCoord.xy / ${E.float(uv)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);
      fragColor.ba = vec2(0.0, map);
      `):e.fragment.main.add(E`
      vec2 mapUV = ${E.float(AF)} * (gl_FragCoord.xy / ${E.float(uv)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);
      fragColor = vec4(map);
    `),e}const X_t=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:Doe,build:PNe},Symbol.toStringTag,{value:"Module"}));let jq=class extends Hi{constructor(e,i){super(e,i,new Bi(X_t,()=>G(()=>Promise.resolve().then(()=>rHt),void 0)))}initializePipeline(e){return wi({blending:e.mode===Ym.Full?Lne:hw(Bt.ZERO,Bt.ONE,Bt.ONE,Bt.ZERO),depthTest:{func:Ui.ALWAYS},colorWrite:Di})}},DNe=class{constructor(e,i,r=i){this.internalFormat=e,this.width=i,this.height=r,this.multisampled=!1,this.samples=1}};function K_t(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*_se(t.internalFormat)}let LNe=class{constructor(e,i){this._context=e,this._descriptor=i,this.type=Tv.RenderBuffer,this._context.instanceCounter.increment(Ws.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=i;a?r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,o,s,n):r.renderbufferStorage(r.RENDERBUFFER,o,s,n),this._context.bindRenderbuffer(null)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,i=this._context.parameters.maxSamples;return e?Math.min(e,i):i}get usedMemory(){return K_t(this._descriptor)}resize(e,i){const r=this._descriptor;if(r.width===e&&r.height===i)return;r.width=e,r.height=i;const s=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):s.renderbufferStorage(s.RENDERBUFFER,r.internalFormat,r.width,r.height),this._context.bindRenderbuffer(null)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(Ws.Renderbuffer,this),this._context=null)}};const Q_t=()=>J.getLogger("esri.views.webgl.FramebufferObject");let Eg=class XI{constructor(e,i,r=null){this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(Ws.FramebufferObject,this);const s=R5(i)?i:new pi(this._context,i);if(this._colorAttachments.set(nr.COLOR_ATTACHMENT0,s),this._validateTextureDescriptor(s.descriptor),this._validateColorAttachmentPoint(nr.COLOR_ATTACHMENT0),r!=null)if(tbt(r))this._depthStencilTexture=R5(r)?r:new pi(this._context,r),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const n=ebt(r)?r:new LNe(this._context,r);this._depthStencilBuffer=n,this._validateRenderBufferDescriptor(n.descriptor)}}dispose(){var i,r;if(this._colorAttachments.size===0&&!this._glName)return;const e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((s,n)=>{var o;return(o=this.detachColorTexture(n))==null?void 0:o.dispose()}),(i=this.detachDepthStencilBuffer())==null||i.dispose(),(r=this.detachDepthStencilTexture())==null||r.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(Ws.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(nr.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){var i;const e=this._colorAttachments.get(nr.COLOR_ATTACHMENT0);return((i=e==null?void 0:e.descriptor)==null?void 0:i.width)??0}get height(){var i;const e=this._colorAttachments.get(nr.COLOR_ATTACHMENT0);return((i=e==null?void 0:e.descriptor)==null?void 0:i.height)??0}get usedMemory(){var e;return[...this._colorAttachments].reduce((i,[r,s])=>i+s.usedMemory,((e=this.depthStencil)==null?void 0:e.usedMemory)??0)}getColorTexture(e){const i=this._colorAttachments.get(e);return i&&R5(i)?i:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(e,i=nr.COLOR_ATTACHMENT0){var s;if(!e)return;this._validateColorAttachmentPoint(i);const r=e.descriptor;this._validateTextureDescriptor(r),(s=this.detachColorTexture(i))==null||s.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,i)),this._colorAttachments.set(i,e)}detachColorTexture(e=nr.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(e);if(i){if(this._initialized){const r=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e),this._context.bindFramebuffer(r)}return this._colorAttachments.delete(e),i}}setColorTextureTarget(e,i=nr.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(i);r&&this._framebufferTexture2D(r.glName,i,e)}attachDepthStencil(e){if(e)switch(e.type){case Tv.Texture:return this._attachDepthStencilTexture(e);case Tv.RenderBuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){var r;if(e==null)return;const i=e.descriptor;i.pixelFormat!==Tt.DEPTH_STENCIL&&i.pixelFormat!==Tt.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),i.dataType!==Xa.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._validateTextureDescriptor(i),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,CS)),(r=this._depthStencilTexture)==null||r.dispose(),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;if(e&&this._initialized){const i=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,CS),this._context.bindFramebuffer(i)}return this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){if(e==null)return;const i=e.descriptor;if(this._validateRenderBufferDescriptor(i),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,s=this._getGLAttachmentPoint(i);r.framebufferRenderbuffer(za.FRAMEBUFFER,s,r.RENDERBUFFER,e.glName)}this._depthStencilBuffer=e}detachDepthStencilBuffer(){const e=this._depthStencilBuffer;if(e&&this._initialized){const i=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);const r=this._context.gl,s=this._getGLAttachmentPoint(e.descriptor);r.framebufferRenderbuffer(za.FRAMEBUFFER,s,r.RENDERBUFFER,null),this._context.bindFramebuffer(i)}return this._depthStencilBuffer=null,e}copyToTexture(e,i,r,s,n,o,a){(e<0||i<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=a.descriptor;a.descriptor.target!==ns.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),((l==null?void 0:l.width)==null||(l==null?void 0:l.height)==null||e+r>this.width||i+s>this.height||n+r>l.width||o+s>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,h=c.bindTexture(a,pi.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(pi.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(ns.TEXTURE_2D,0,n,o,e,i,r,s),c.bindTexture(h,pi.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,i,r,s,n,o,a){(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,i,r,s,n,o,a)}async readPixelsAsync(e,i,r,s,n,o,a){const{gl:l}=this._context,c=jn.createPixelPack(this._context,Js.STREAM_READ,a.byteLength);this._context.bindBuffer(c);const h=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),l.readPixels(e,i,r,s,n,o,0),this._context.unbindBuffer(ht.PIXEL_PACK_BUFFER),this._context.bindFramebuffer(h),await c.getSubDataAsync(a),c.dispose()}resize(e,i){var s,n;if(this.width===e&&this.height===i)return;const r={width:e,height:i};Px(r,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(o=>o.resize(r.width,r.height)),(s=this._depthStencilTexture)==null||s.resize(r.width,r.height),this._initialized&&(Px(r,this._context.parameters.maxRenderbufferSize),(n=this._depthStencilBuffer)==null||n.resize(r.width,r.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=za.FRAMEBUFFER){const i=this._context.gl;if(this._initialized)return void i.bindFramebuffer(e,this.glName);this._glName&&i.deleteFramebuffer(this._glName);const r=i.createFramebuffer();if(i.bindFramebuffer(e,r),this._colorAttachments.forEach((s,n)=>this._framebufferTexture2D(s.glName,n,bge(s),e)),this._depthStencilBuffer){const s=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);i.framebufferRenderbuffer(e,s,i.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,i.DEPTH_STENCIL_ATTACHMENT,bge(this._depthStencilTexture),e);Np()&&i.checkFramebufferStatus(e)!==i.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=r,this._initialized=!0}_framebufferTexture2D(e,i=nr.COLOR_ATTACHMENT0,r=ns.TEXTURE_2D,s=za.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,i,r,e,n)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const i=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(za.FRAMEBUFFER,i,e.RENDERBUFFER,null)}this._depthStencilBuffer=Dt(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=Dt(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==ns.TEXTURE_2D&&e.target!==ns.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),Px(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){Px(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case ga.DEPTH_COMPONENT16:case ga.DEPTH_COMPONENT24:case ga.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case ga.DEPTH24_STENCIL8:case ga.DEPTH32F_STENCIL8:case ga.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case ga.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(XI._MAX_COLOR_ATTACHMENTS===-1){const{gl:r}=this._context;XI._MAX_COLOR_ATTACHMENTS=r.getParameter(r.MAX_COLOR_ATTACHMENTS)}const i=e-nr.COLOR_ATTACHMENT0;i+1>XI._MAX_COLOR_ATTACHMENTS&&J.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${i+1}. Implementation supports up to ${XI._MAX_COLOR_ATTACHMENTS} color attachments`)}};function R5(t){return t!=null&&"type"in t&&t.type===Tv.Texture}function ebt(t){return t!=null&&"type"in t&&t.type===Tv.RenderBuffer}function tbt(t){return R5(t)||t!=null&&"pixelFormat"in t}function Px(t,e){const i=Math.max(t.width,t.height);if(i>e){Q_t().warn(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const r=e/i;return t.width=Math.round(t.width*r),t.height=Math.round(t.height*r),!1}return!0}function bge(t){return t.descriptor.target===ns.TEXTURE_CUBE_MAP?ns.TEXTURE_CUBE_MAP_POSITIVE_X:ns.TEXTURE_2D}Eg._MAX_COLOR_ATTACHMENTS=-1;let P5=class extends he{constructor(e){super(e),this._needsRender=!0,this._passParameters=new Doe,this._configuration=new I5,this._fbo=new Eg(e.context.renderContext.rctx,new Ar(uv)),e.context.techniques.precompile(jq,new I5);const i=new I5;i.mode=Ym.WeatherMap,e.context.techniques.precompile(jq,i)}get textureAtlas(){if(this._texture&&!this._needsRender)return this._texture;this._configuration.mode=this._texture?Ym.WeatherMap:Ym.Full;const e=this.context.techniques.get(jq,this._configuration);return e.compiled&&(this._texture=this._render(e)),this._texture}updateWeatherMap(e){AG(this._passParameters.weatherTile,e)||(Vn(this._passParameters.weatherTile,e),this._needsRender=!0)}destroy(){this._fbo=Dt(this._fbo)}_render(e){if(!this._fbo)return null;const i=this.context.renderContext.rctx,r=i.getViewport();return i.setViewport(0,0,uv,uv),i.bindFramebuffer(this._fbo),i.bindTechnique(e,this.context.renderContext.bind,this._passParameters),i.screen.draw(),i.setViewport(r.x,r.y,r.width,r.height),this._needsRender=!1,this._fbo.colorTexture}};u([p({constructOnly:!0})],P5.prototype,"context",void 0),P5=u([A("esri.views.3d.environment.NoiseTextureAtlas")],P5);let Gl=class extends he{constructor(e){super(e),this._state=Ta(Yu.Idle),this._passParameters=new Poe,this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this._tilesPerFace=1,this.coverage=ft(da.default.coverage[0],da.default.coverage[1],.5),this.density=ft(da.default.density[0],da.default.density[1],.5),this.absorption=ft(da.default.absorption[0],da.default.absorption[1],.5),this.cloudSize=ft(da.default.cloudSize[0],da.default.cloudSize[1],.5),this.detailSize=ft(da.default.detailSize[0],da.default.detailSize[1],.5),this.smoothness=ft(da.default.smoothness[0],da.default.smoothness[1],.5),this.cloudHeight=ft(da.default.cloudHeight[0],da.default.cloudHeight[1],.5),this.raymarchingSteps=da.default.raymarchingSteps,this._viewMatrix=qe(),this._dirty=!0,this.running=!0,this._configuration=new fK}initialize(){const e=yr(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius;const i=()=>this.setDirty();this.addHandles([this.view.resourceController.scheduler.registerTask(lt.CLOUDS_GENERATOR,this),H(()=>this.coverage,i,Ut),H(()=>this.density,i,Ut),H(()=>this.absorption,i,Ut),H(()=>this.cloudSize,i,Ut),H(()=>this.detailSize,i,Ut),H(()=>this.smoothness,i,Ut),H(()=>this.cloudHeight,i,Ut),H(()=>this.raymarchingSteps,i,Ut)]);const r=tB(this._computeWeatherTile());let s=0;this.addHandles(H(()=>{const n=this._computeWeatherTile();return AG(r,n)||(++s,Vn(r,n)),s},i))}destroy(){this.destroyCubeMap(),this._passParameters.noiseTexture=$e(this._passParameters.noiseTexture)}_precompileTechniques(){this._configuration.steps=this.raymarchingSteps,this._configuration.writeTextureChannels=Mv.RG,this.context.techniques.precompile(Vq,this._configuration),this._configuration.writeTextureChannels=Mv.BA,this.context.techniques.precompile(Vq,this._configuration)}_acquireTechnique(){switch(this.raymarchingSteps){case ac.SIXTEEN:this._tilesPerFace=1;break;case ac.HUNDRED:this._tilesPerFace=4;break;case ac.COUNT:case ac.TWOHUNDRED:this._tilesPerFace=8;break;default:this.raymarchingSteps}return this._configuration.writeTextureChannels=1-this.parameters.readChannels,this._configuration.steps=this.raymarchingSteps,this.context.techniques.get(Vq,this._configuration)}_computeWeatherTile(){var l,c;const{camera:e,environment:i}=this.view,{latitude:r,longitude:s}=e.position;if(r==null||s==null)return TS;di(tp,(r+90)/180,(s+180)/360);const n=Math.floor(this._weatherTileCount*Math.abs(2*tp[0]-1));tp[0]=Math.floor(2*this._weatherTileCount*tp[0]),tp[1]=Math.floor(4*(this._weatherTileCount-n)*tp[1]);let o=0,a=0;if(((l=i==null?void 0:i.lighting)==null?void 0:l.type)!=="virtual"&&((c=i==null?void 0:i.lighting)==null?void 0:c.date)!=null){const h=new Date(i.lighting.date);h.setUTCHours(i.lighting.date.getUTCHours()+(i.lighting.displayUTCOffset??0)),o=31*h.getUTCMonth()+h.getUTCDate(),a=h.getUTCFullYear()}return tp[0]=(tp[0]+o)%(2*this._weatherTileCount),tp[1]=(tp[1]+a%100)%(4*this._weatherTileCount),tp}get state(){return this._state.value}set state(e){this._state.value=e}get usedMemory(){var e,i,r;return(((e=this._fbo)==null?void 0:e.usedMemory)??0)+(((r=(i=this._passParameters.noiseTexture)==null?void 0:i.textureAtlas)==null?void 0:r.usedMemory)??0)}_ensureNoiseTexture(){var e;return(e=this._passParameters).noiseTexture??(e.noiseTexture=new P5({context:this.context})),this._passParameters.noiseTexture}_ensureFrameBufferCube(e){const i=this.context.renderContext.rctx;if(this._fbo==null){const r=new Ar(e);r.target=ns.TEXTURE_CUBE_MAP,r.wrapMode=ar.CLAMP_TO_EDGE,this._fbo=new Eg(i,r),this.parameters.data=this}return i.unbindTexture(this._fbo.colorTexture),this._fbo}get cubeMap(){return this._fbo}get parameters(){return this.context.renderContext.bind.clouds}destroyCubeMap(){this._fbo=Dt(this._fbo),this.parameters.data=null}applyPreset(e,i){const r=e.median,s=n=>{const o=ft(n[0],n[1],r);return i<.5?ft(n[0],o,2*i):ft(o,n[1],2*(i-.5))};this.coverage=s(e.coverage),this.density=s(e.density),this.absorption=s(e.absorption),this.cloudSize=s(e.cloudSize),this.detailSize=s(e.detailSize),this.smoothness=s(e.smoothness),this.cloudHeight=s(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps,this._precompileTechniques()}setDirty(){this._dirty=this.running=!0}runTask(e){if(this.state===Yu.Fading)return ea;this._dirty&&(this._faceIndex=this._tileIndex=0,this.state=Yu.Rendering,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._ensureNoiseTexture().updateWeatherMap(this._computeWeatherTile()),this._dirty=!1);const i=this._acquireTechnique();if(!this._ensureNoiseTexture().textureAtlas||!i.compiled)return ea;const r=ibt[this._faceIndex],s=rbt[this._faceIndex];x$e(this._viewMatrix,sbt,r,s),sT(this._passParameters.viewMatrix,this._viewMatrix);const n=this.context.renderContext.rctx,o=n.getViewport(),a=n$/this._tilesPerFace,l=this._tileIndex*a;n.setViewport(0,l,n$,a);const c=this._ensureFrameBufferCube(n$);n.bindFramebuffer(c),n.bindTechnique(i,this.context.renderContext.bind,this._passParameters);const h=ns.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return c.setColorTextureTarget(h),n.screen.draw(),n.gl.flush(),n.setViewport(o.x,o.y,o.width,o.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this._faceIndex=this._tileIndex=0,this.state=Yu.Ready,this.running=!1):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),ea}};u([p({constructOnly:!0})],Gl.prototype,"context",void 0),u([p({constructOnly:!0})],Gl.prototype,"view",void 0),u([p({constructOnly:!0})],Gl.prototype,"requestRender",void 0),u([p()],Gl.prototype,"coverage",void 0),u([p()],Gl.prototype,"density",void 0),u([p()],Gl.prototype,"absorption",void 0),u([p()],Gl.prototype,"cloudSize",void 0),u([p()],Gl.prototype,"detailSize",void 0),u([p()],Gl.prototype,"smoothness",void 0),u([p()],Gl.prototype,"cloudHeight",void 0),u([p()],Gl.prototype,"raymarchingSteps",void 0),u([p()],Gl.prototype,"running",void 0),Gl=u([A("esri.views.3d.environment.CloudsRenderer")],Gl);const ibt=[wr(1,0,0),wr(-1,0,0),wr(0,1,0),wr(0,-1,0),wr(0,0,1)],rbt=[wr(0,1,0),wr(0,1,0),wr(0,0,-1),wr(0,0,1),wr(0,1,0)],sbt=nM(),tp=Jre();var Pv;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})(Pv||(Pv={}));let NNe=class extends hu{constructor(){super(...arguments),this.type=Pv.Rain}};u([ie({count:Pv.COUNT})],NNe.prototype,"type",void 0);function FNe(t){const e=new Vi;return e.attributes.add(z.POSITION,"vec3"),e.attributes.add(z.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new Ka("cameraPosition",i=>i.camera.eye),new $r("offset",(i,r)=>nbt(i,r)),new mt("width",i=>i.width),new mt("time",i=>i.time),new $o("proj",i=>i.camera.projectionMatrix),new $o("view",i=>i.camera.viewMatrix)),e.varyings.add("vUv","vec2"),e.vertex.code.add(E`vec3 hash31(float p){
vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
p3 += dot(p3, p3.yzx + 33.33);
return fract((p3.xxy + p3.yzz) * p3.zyx);
}
float hash11(float p){
p = fract(p * 0.1031);
p *= p + 33.33;
p *= p + p;
return fract(p);
}
vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
}`),e.vertex.main.add(E`
      vUv = position.xz;
      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundredths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===Pv.Rain?E`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:E`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
  `),e.fragment.uniforms.add(new mt("opacity",i=>i.opacity),new Ka("particleColor",i=>obt(i,t))),e.fragment.main.add(E`
    float d = length(vUv - vec2(0.5));

    ${t.type===Pv.Rain?E`d = 0.35 * smoothstep(0.5, 0.0, d);`:E`d = smoothstep(0.5, 0.1, d);`}
    fragColor = opacity * vec4(particleColor * d, d);
  `),e}function nbt(t,e){const i=e.camera.eye,r=.5*t.width,s=1/t.width,n=mOe(mK,se(mK,(i[0]+r)*s,(i[1]+r)*s,(i[2]+r)*s));return Fi(n,i,re(n,n,t.width))}function obt(t,e){const i=e.type===Pv.Rain?lbt:abt,r=re(mK,i,cbt),s=t.camera.eye;ae(wge,s);const n=Math.max(0,fe(wge,t.lighting.mainLight.direction));return fr(r,r,i,n)}const mK=$(),wge=$(),abt=De(1,1,1),lbt=De(.85,.85,.85),cbt=.7,ubt=Object.freeze(Object.defineProperty({__proto__:null,build:FNe},Symbol.toStringTag,{value:"Module"}));let hbt=class extends cr{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=0}},xge=class extends Hi{constructor(e,i){super(e,i,new Bi(ubt,()=>G(()=>Promise.resolve().then(()=>sHt),void 0)),new Map([[z.POSITION,0],[z.INSTANCEFEATUREATTRIBUTE,1]]))}initializePipeline(){return wi({blending:gM,depthTest:{func:Ui.LEQUAL},colorWrite:Di})}};function Jv(t,e=0){const i=t.stride;return Array.from(t.fields.keys()).map(r=>{var c;const s=t.fields.get(r),n=s.constructor.ElementCount,o=dbt(s.constructor.ElementType),a=s.offset,l=((c=s.optional)==null?void 0:c.glNormalized)??!1;return new xf(r,n,o,a,i,l,e)})}function dbt(t){const e=pbt[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const pbt={u8:ki.UNSIGNED_BYTE,u16:ki.UNSIGNED_SHORT,u32:ki.UNSIGNED_INT,i8:ki.BYTE,i16:ki.SHORT,i32:ki.INT,f32:ki.FLOAT};let l2=class extends Af{constructor(e){super(e),this.consumes={required:[dt.TRANSPARENT_ENVIRONMENT]},this.produces=dt.TRANSPARENT_ENVIRONMENT,this._rainSpeed=.1,this._snowSpeed=.01,this._numParticles=0,this._passParameters=new hbt,this._configuration=new NNe;const{view:i,type:r}=e;this._configuration.type=r==="rainy"?Pv.Rain:Pv.Snow,i._stage.renderView.techniques.precompile(xge,this._configuration),this._passParameters.time=0,this._passParameters.radius=yr(i.spatialReference).radius,this.addHandles(H(()=>i.environment.weather,s=>{s.type===r&&this.addHandles(H(()=>s.precipitation,n=>this._adjustParticles(n),Mt))},Mt)),this.addHandles(H(()=>{var s;return((s=i._stage)==null?void 0:s.renderer.renderContext.bind.clouds.fadeFactor)??1},s=>{this._passParameters.opacity=s,s===1&&(this.removeHandles("opacity"),this.addHandles(H(()=>{var n;return((n=i._stage)==null?void 0:n.renderer.renderContext.bind.clouds.opacity)??1},n=>this._passParameters.opacity=n,Mt),"opacity"))},Yt),"opacity")}_adjustParticles(e){const r=e<.5?ft(0,.35,2*e):ft(.35,1,2*(e-.5));this._numParticles=Sge*r}destroy(){this._numParticles=0,this._vao=Dt(this._vao),this._instanceIdBuffer=Dt(this._instanceIdBuffer)}fadeOut(e){this.removeAllHandles(),this.addHandles(H(()=>{var i;return((i=this.renderContext)==null?void 0:i.bind.clouds.fadeFactor)??1},i=>{this._passParameters.opacity=1-i,i===1&&(this.removeAllHandles(),e())}),"opacity")}updateAnimation(e){const i=(this.type==="rainy"?this._rainSpeed:this._snowSpeed)*HSe(e.time)%1e5;return this._passParameters.time!==i&&(this._passParameters.time=i,!0)}render(e){const i=this.renderingContext;this._instanceIdBuffer??(this._instanceIdBuffer=this._createInstanceIndices(i));const r=Math.round(this._numParticles*this._passParameters.opacity),s=e.find(({name:a})=>a===dt.TRANSPARENT_ENVIRONMENT);if(r<1)return s;const n=this.techniques.get(xge,this._configuration);if(!n.compiled)return this.requestRender($t.UPDATE),s;const o=i.bindTechnique(n,this.bindParameters,this._passParameters);return this._vao??(this._vao=fbt(i,n.locations)),i.bindVAO(this._vao),o.assertCompatibleVertexAttributeLocations(this._vao),jOe(i,n.locations,this._instanceIdBuffer,Tge,0),i.drawArraysInstanced(Gi.TRIANGLES,0,3,r),Bst(i,n.locations,this._instanceIdBuffer,Tge),s}_createInstanceIndices(e){const i=[];for(let r=0;r<Sge;r++)i.push(r);return jn.createVertex(e,Js.STATIC_DRAW,new Float32Array(i))}};function fbt(t,e){const i=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new Tg(t,e,new Map([["geometry",Jv(mbt)]]),new Map([["geometry",jn.createVertex(t,Js.STATIC_DRAW,i)]]))}u([p()],l2.prototype,"consumes",void 0),u([p()],l2.prototype,"produces",void 0),u([p({constructOnly:!0})],l2.prototype,"type",void 0),l2=u([A("esri.views.3d.environment.Precipitation")],l2);const Sge=25e4,mbt=Bd().vec3f(z.POSITION),Tge=Jv(Bd().f32(z.INSTANCEFEATUREATTRIBUTE),1);let B1=class extends OL{constructor(e){super(e),this.produces=new Map([]),this._clouds=Ta(null),this._incarnation=0,this._precipitation=null}initialize(){this.view._stage.addRenderPlugin(this)}destroy(){var e,i;this.removeHandles(),this.uninitializeRenderContext(),(i=(e=this.view)==null?void 0:e._stage)==null||i.removeRenderPlugin(this),this._set("view",null)}get updating(){var e;return!!((e=this._clouds.value)!=null&&e.running)}get weatherAvailable(){return Ee(this.view.state.camera.eye)-yr(this.view.spatialReference).radius<=r$}get usedMemory(){var e;return((e=this._clouds.value)==null?void 0:e.usedMemory)??0}_fadeOutPrecipitation(){var e;this._precipitation&&((e=this._precipitationOutgoing)==null||e.destroy(),this._precipitationOutgoing=this._precipitation,this._precipitationOutgoing.fadeOut(()=>{this._precipitationOutgoing=$e(this._precipitationOutgoing)}),this._precipitation=null,++this._incarnation)}get weather(){var e,i;return(i=(e=this.view)==null?void 0:e.environmentManager)!=null&&i.weatherEnabled?this.view.environment.weather:null}initializeRenderContext(e){this._context=e;const i=this.view,r=()=>this._requestRender();this.addHandles([H(()=>this._precipitation,r,Yt),H(()=>{var s;return(s=this._clouds.value)==null?void 0:s.state},r,Yt),H(()=>i.state.mode,r,Yt),H(()=>this._updateClouds(),r,Yt),H(()=>this._updatePrecipitation(),r,Yt),H(()=>this.weather,s=>this._initWeather(s))])}uninitializeRenderContext(){this._context=null,this._clouds.value=$e(this._clouds.value),this._precipitation=$e(this._precipitation),this._precipitationOutgoing=$e(this._precipitationOutgoing)}prepareRender(e){const{bind:i,time:r}=e;if(this.view.viewingMode!=="local"&&i.clouds.data){i.clouds.fade(i.camera,r,this.view.qualitySettings.fadeDuration);const s=this._clouds.value;s&&s.state===Yu.Idle&&s.coverage===0&&!s.running&&s.destroyCubeMap()}}acquireTechniques(){return[]}render(){}_requestRender(){var e;(e=this._context)==null||e.requestRender()}_initWeather(e){const i=this._context;if(!e||!i)return void(this._clouds.value=$e(this._clouds.value));if(this._clouds.value)return;const r=this.view;this._clouds.value=new Gl({context:i,view:r,requestRender:()=>this._requestRender()})}_updateClouds(){const e=this.view.environment.weather;return e==null||this._clouds.value==null||this._clouds.value.applyPreset(da[e.type],gbt(e)),++this._incarnation}_updatePrecipitation(){var s;const e=this.view.environment.weather;if(e.type===((s=this._precipitation)==null?void 0:s.type))return this._incarnation;this._fadeOutPrecipitation();const i=e.type==="rainy"||e.type==="snowy",r=this._context;return i&&r&&(this._precipitation=new l2({view:this.view,type:e.type}),++this._incarnation),this._incarnation}get test(){}hasHighlightOptions(e){return!1}};function gbt(t){switch(t.type){case"rainy":case"snowy":case"cloudy":case"sunny":return t.cloudCover;case"foggy":return t.fogStrength}}u([p({constructOnly:!0})],B1.prototype,"view",void 0),u([p({type:Boolean,readOnly:!0})],B1.prototype,"updating",null),u([p()],B1.prototype,"weatherAvailable",null),u([p()],B1.prototype,"_context",void 0),B1=u([A("esri.views.3d.environment.EnvironmentRenderer")],B1);var P6=Math.PI,Zs=Math.sin,Zo=Math.cos,Loe=Math.tan,kNe=Math.asin,Noe=Math.atan2,zNe=Math.acos,Xn=P6/180,UNe=864e5,BNe=2440588,VNe=2451545,ybt={dec:0,ra:0};function vbt(t){return t.valueOf()/UNe-.5+BNe}function MF(t){return new Date((t+.5-BNe)*UNe)}function D5(t){return vbt(t)-VNe}var WB=23.4397*Xn;function jNe(t,e){return Noe(Zs(t)*Zo(WB)-Loe(e)*Zs(WB),Zo(t))}function Foe(t,e){return kNe(Zs(e)*Zo(WB)+Zo(e)*Zs(WB)*Zs(t))}function GNe(t,e,i){return Noe(Zs(t),Zo(t)*Zs(e)-Loe(i)*Zo(e))}function HNe(t,e,i){return kNe(Zs(e)*Zs(i)+Zo(e)*Zo(i)*Zo(t))}function qNe(t,e){return Xn*(280.16+360.9856235*t)-e}function WNe(t){return Xn*(357.5291+.98560028*t)}function ZNe(t){return Xn*(1.9148*Zs(t)+.02*Zs(2*t)+3e-4*Zs(3*t))}function YNe(t,e){return t+e+102.9372*Xn+P6}function JNe(t,e){var i=WNe(t),r=YNe(i,ZNe(i));return e||(e={dec:0,ra:0}),e.dec=Foe(r,0),e.ra=jNe(r,0),e}var ec={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(t,e,i,r){var s=Xn*-i,n=Xn*e,o=D5(t),a=JNe(o,ybt),l=qNe(o,s)-a.ra;return r||(r={azimuth:0,altitude:0}),r.azimuth=GNe(l,n,a.dec),r.altitude=HNe(l,n,a.dec),r}},L5=[[-.83,"sunrise","sunset"]];ec.addTime=function(t,e,i){L5.push([t,e,i])};var XNe=9e-4;function _bt(t,e){return Math.round(t-XNe-e/(2*P6))}function Ege(t,e,i){return XNe+(t+e)/(2*P6)+i}function Cge(t,e,i){return VNe+t+.0053*Zs(e)-.0069*Zs(2*i)}function bbt(t,e,i){return zNe((Zs(t)-Zs(e)*Zs(i))/(Zo(e)*Zo(i)))}function $ge(t){var e=Xn*(134.963+13.064993*t),i=Xn*(93.272+13.22935*t),r=Xn*(218.316+13.176396*t)+6.289*Xn*Zs(e),s=5.128*Xn*Zs(i),n=385001-20905*Zo(e);return{ra:jNe(r,s),dec:Foe(r,s),dist:n}}ec.getTimes=function(t,e,i){var r=Xn*-i,s=Xn*e,n=_bt(D5(t),r),o=Ege(0,r,n),a=WNe(o),l=ZNe(a),c=YNe(a,l),h=Foe(c,0),d=Cge(o,a,c);function f(S){return Cge(Ege(bbt(S,s,h),r,n),a,c)}function m(S){var C=(Zs(S)-Zs(s)*Zs(h))/(Zo(s)*Zo(h));return C<-1?ec.PolarException.MIDNIGHT_SUN:C>1?ec.PolarException.POLAR_NIGHT:ec.PolarException.NORMAL}var g,v,_,b,w,x={solarNoon:MF(d),nadir:MF(d-.5),polarException:ec.PolarException.NORMAL};for(g=0,v=L5.length;g<v;g+=1)w=d-((b=f((_=L5[g])[0]*Xn))-d),x[_[1]]=MF(w),x[_[2]]=MF(b);return x.polarException=m(L5[0][0]*Xn),x},ec.getMoonPosition=function(t,e,i){var r=Xn*-i,s=Xn*e,n=D5(t),o=$ge(n),a=qNe(n,r)-o.ra,l=HNe(a,s,o.dec);return l+=.017*Xn/Loe(l+10.26*Xn/(l+5.1*Xn)),{azimuth:GNe(a,s,o.dec),altitude:l,distance:o.dist}},ec.getMoonFraction=function(t){var e=D5(t),i=JNe(e),r=$ge(e),s=149598e3,n=zNe(Zs(i.dec)*Zs(r.dec)+Zo(i.dec)*Zo(r.dec)*Zo(i.ra-r.ra)),o=Noe(s*Zs(n),r.dist-s*Zo(n));return(1+Zo(o))/2};const wl={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let OF=class{constructor(e,i){this.direct=e,this.ambient=i}};function wbt(t,e,i,r,s,n){se(n.ambient.color,1,1,1),n.ambient.intensity=wl.global.ambient,se(n.direct.color,1,1,1),n.direct.intensity=wl.global.direct;const o=e[2],a=ue((Math.abs(o)-wl.local.altitude)/(wl.global.altitude-wl.local.altitude),0,1);let l;if(n.globalFactor=a,t!=null&&(l=ec.getTimes(t,e[1],e[0])),a<1){let c;if(t!=null)c=Abt(t,l,r);else{const h=QNe(r);c={direct:{intensity:wl.local.directAtNoon*h.direct,color:De(1,1,1)},ambient:{intensity:wl.local.ambientAtNoon*h.ambient,color:De(1,1,1)},timeOfDay:"early afternoon"}}fr(n.ambient.color,c.ambient.color,n.ambient.color,a),n.ambient.intensity=ft(c.ambient.intensity,n.ambient.intensity,a),fr(n.direct.color,c.direct.color,n.direct.color,a),n.direct.intensity=ft(c.direct.intensity,n.direct.intensity,a),n.specularStrength=r==="rainy"||r==="snowy"||r==="foggy"?0:1,n.environmentStrength=r==="rainy"?.7:r==="snowy"||r==="foggy"?.75:1}n.noonFactor=t!=null?$bt(t,l):1,t!=null?xbt(t,e,i,n.direct.directionToLightSource):KNe(s,i,n.direct.directionToLightSource)}function KNe(t,e,i){e===je.Global?ae(Wq,t.eye):se(Wq,0,0,1),re(Zq,t.viewForward,-1);const r=jG(Zq,Wq),s=Math.max(r-2*Yq,0),n=.85*s/(s+1),o=Math.max(Yq,r-Yq-n);Pd(zge,-o,t.viewRight),ot(i,Zq,zge),oe(i,i,re(Mbt,t.viewRight,Obt)),ae(i,i)}function xbt(t,e,i,r){const s=Cbt,n=_f(Ebt);if(i===je.Global)ec.getPosition(t,0,0,s),se(r,0,0,-1),K$(n,n,-s.azimuth),uG(n,n,-s.altitude),ot(r,r,n);else{const o=wl.planarDirection,a=o.globalAngles,l=e[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=ue(c,0,1),c<1?(ec.getPosition(t,e[1],e[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),se(r,0,-1,0),Q$(n,n,-s.azimuth),K$(n,n,-s.altitude),ot(r,r,n)}}function Sbt(t,e){if(e===je.Global)return!0;const i=wl.planarDirection;return Math.abs(t)<i.localAltitude}const Tbt=De(.5773502691896258,-.5773502691896258,.5773502691896258);let Age=class{constructor(){this.ambient={color:De(1,1,1),intensity:.55},this.direct={color:De(1,1,1),intensity:.55,directionToLightSource:os(Tbt)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const Ebt=qe(),Cbt={azimuth:0,altitude:0};function $bt(t,e){const i=t.valueOf();let r,s;e.polarException===ec.PolarException.MIDNIGHT_SUN?(r=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=r+432e6):e.polarException===ec.PolarException.POLAR_NIGHT?(r=i-2,s=i-1):(r=e.sunrise.valueOf(),s=e.sunset.valueOf());const n=r+(s-r)/2;return 1-ue(Math.abs(i-n)/432e5,0,1)}function QNe(t){switch(t){case"disabled":case"sunny":case"cloudy":return new OF(1,1);case"rainy":return new OF(.4,1.2);case"snowy":return new OF(.5,1.3);case"foggy":return new OF(.2,1.6)}}function Mge(t,e){const i=(t[0]+t[1]+t[2])/3;t[0]+=(i-t[0])*e,t[1]+=(i-t[1])*e,t[2]+=(i-t[2])*e}const Gq=De(.01,.01,.01),gK=De(1,.6,.5),yK=De(1,.98,.98),Oge=De(1,1,1),Hq=De(.8,.8,1),vK=De(.8,.8,1),_K=De(.98,.98,1),Ige=De(1,1,1),qq=fn(.01,wl.local.ambientAtNight),bK=fn(wl.local.directAtTwilight,wl.local.ambientAtTwilight),wK=fn(.9*wl.local.directAtNoon,wl.local.ambientAtNoon),Rge=fn(wl.local.directAtNoon,wl.local.ambientAtNoon),Pge=wK,Dge=yK,Lge=_K,Nge=bK,Fge=gK,kge=vK;function Abt(t,e,i){const r=t.valueOf();let s,n;e.polarException===ec.PolarException.MIDNIGHT_SUN?(s=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=s+432e6):e.polarException===ec.PolarException.POLAR_NIGHT?(s=r-2,n=r-1):(s=e.sunrise.valueOf(),n=e.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,h=a+l,d=.06*o,f=s-d/2,m=s+d/2,g=n-d/2,v=n+d/2,_=Ye(),b=$(),w=$();let x="";if(r<f||r>v)Vn(_,qq),ne(b,Gq),ne(w,Hq),x="night";else if(r<m){const T=(r-f)/(m-f);rd(_,qq,bK,T),fr(b,Gq,gK,T),fr(w,Hq,vK,T),x="sun rising"}else if(r<c){const T=(r-m)/(c-m);rd(_,bK,wK,T),fr(b,gK,yK,T),fr(w,vK,_K,T),x="early morning"}else if(r<a){const T=(r-c)/(a-c);rd(_,wK,Rge,T),fr(b,yK,Oge,T),fr(w,_K,Ige,T),x="late morning"}else if(r<h){const T=(r-a)/(h-a);rd(_,Rge,Pge,T),fr(b,Oge,Dge,T),fr(w,Ige,Lge,T),x="early afternoon"}else if(r<g){const T=(r-h)/(g-h);rd(_,Pge,Nge,T),fr(b,Dge,Fge,T),fr(w,Lge,kge,T),x="late afternoon"}else if(r<v){const T=(r-g)/(v-g);rd(_,Nge,qq,T),fr(b,Fge,Gq,T),fr(w,kge,Hq,T),x="sun setting"}let S=0;switch(i){case"rainy":case"foggy":S=.8;break;case"snowy":S=.5}S>0&&(Mge(b,S),Mge(w,S));const C=QNe(i);return{direct:{intensity:_[0]*C.direct,color:b},ambient:{intensity:_[1]*C.ambient,color:w},timeOfDay:x}}const zge=qe(),Wq=$(),Zq=$(),Mbt=$(),Yq=.25,Obt=.2;let Ph=class extends Ss.EventedAccessor{constructor(){super(),this._tmpLightParameters=new Age,this._defaultLightParameters=new Age,this._tmpDate=new Date,this._tmpTz={hours:0,minutes:0,seconds:0},this._viewHandlesKey="viewHandles",this._trackingEnabled=!1,this._mainLight=new LB,this._ambientLight=new ioe,this._moonLight=new RDe,this._disableProjectionEngineAutoLoad=!1,this._disableWeather=!1,this._renderer=null,this._referencePositionGeographic=null,this._resetReferencePosition()}destroy(){this.disconnectView()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!!((e=this._renderer)!=null&&e.updating)||!this._canProjectCameraPosition}get weatherEnabled(){var e,i,r;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((r=(i=this._view)==null?void 0:i.state)==null?void 0:r.viewingMode)===je.Global&&Gj(this._view.spatialReference)}get _weatherAvailable(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherAvailable)}get referencePositionGeographic(){return this._referencePositionGeographic}get _canProjectCameraPosition(){var r,s,n,o;const e=((o=(n=(s=(r=this._view)==null?void 0:r.stateManager)==null?void 0:s.camera)==null?void 0:n.position)==null?void 0:o.spatialReference)??Oe.WGS84,i=_ge(e);return this._disableProjectionEngineAutoLoad||V_(e,i)}connectView(e){if(this._renderer)return;this._renderer=new B1({view:e});const i=()=>this._updateRenderParameters(),r=()=>this._cameraHandler();this.addHandles([H(()=>e.environment.lighting,s=>this._updateLightingHandler(s),Yt),H(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,s=>this._lightingDateHandler(s),Yt),H(()=>e.environment.lighting.directShadowsEnabled,i,Yt),H(()=>e.qualitySettings.ambientOcclusion,i,Yt),H(()=>e.qualitySettings.reflections,i,Yt),H(()=>e.spatialReference,()=>this._resetReferencePosition(!0),Yt),H(()=>[e.environment.weather.type,this.weatherEnabled],()=>this._updateLighting(null,rS.FadeWithWeather),Yt),H(()=>e.environment,s=>s.setComputeWeatherAvailable(()=>this._weatherAvailable),Mt),H(()=>e.viewingMode,()=>this._resetReferencePosition(!0),Mt),H(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),Mt),H(()=>e.state.camera,r,Mt),bn(()=>this._canProjectCameraPosition,r,Yt)],this._viewHandlesKey),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this.removeHandles(this._viewHandlesKey),this._resetReferencePosition(),this._renderer=$e(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const i=this._view.environment.lighting;(i==null?void 0:i.type)!=="virtual"&&(i.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const i=this._view.environment.lighting;if((i==null?void 0:i.type)!=="virtual"){if(e){if(!i.positionTimezoneInfo.autoUpdated&&(this._preupdateTracking(e),this._referencePositionGeographic!=null)){const r=uge(this._referencePositionGeographic,this._tmpTz);r!=null&&(i.autoUpdate(null,r),this._trackingEnabled&&(i.positionTimezoneInfo.autoUpdated=!0))}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const i=this._view;if(!i.ready)return;const r=i.stateManager.camera;if(!r)return;const{position:s}=r,n=s.spatialReference??Oe.WGS84,o=_ge(n),a=this._referencePositionGeographic??$();if(!gc(s,a,o))return this._referencePositionGeographic=null,void this._updateLighting();this._referencePositionGeographic=a,this.notifyChange("referencePositionGeographic"),this._autoUpdateTimezone(a,e)||this._updateLighting(e)}_updateLighting(e,i=rS.Immediate){const r=this._view,{lighting:s}=r.environment,n=s.type==="virtual",o=this._referencePositionGeographic,a=o!=null?this._tmpLightParameters:this._defaultLightParameters;if(o){e??(e=n?null:s.date);const m=this._weatherAvailable?r.environment.weather.type:"disabled";wbt(e,o,r.state.viewingMode,m,r.state.camera,a)}else n&&KNe(r.state.camera,r.state.viewingMode,a.direct.directionToLightSource);const l=this._mainLight,c=a.direct;re(l.intensity,c.color,c.intensity*Math.PI),ne(l.direction,c.directionToLightSource),l.specularStrength=a.specularStrength,l.environmentStrength=a.environmentStrength;const h=this._ambientLight;re(h.intensity,a.ambient.color,a.ambient.intensity);const d=this._moonLight;fr(d.intensity,Ibt,Rbt,a.globalFactor);const f=(1-.5*a.globalFactor)*(1-.4*a.noonFactor*(1-a.globalFactor));re(d.intensity,d.intensity,f),ne(d.direction,c.directionToLightSource),this._view._stage.renderer.updateLighting([l,h,d],a.noonFactor,a.globalFactor,this._weatherAvailable?i:rS.Immediate),this._updateRenderParameters()}_autoUpdateTimezone(e,i=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;const r=this._tmpDate;r.setTime((i||this._view.environment.lighting.date).getTime());const s=uge(e,this._tmpTz);if(s==null)return!1;let n=this._view.environment.lighting.positionTimezoneInfo;if(n.autoUpdated){if(n.hours===s.hours&&n.minutes===s.minutes&&n.seconds===s.seconds)return!1}else n=s;const o=r.getUTCHours()-(s.hours-n.hours),a=r.getUTCMinutes()-(s.minutes-n.minutes),l=r.getUTCSeconds()-(s.seconds-n.seconds);return r.setUTCHours(o),r.setUTCMinutes(a),r.setUTCSeconds(l),!i&&this._view.environment.lighting.autoUpdate(r,s)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const i=this._referencePositionGeographic==null||Sbt(this._referencePositionGeographic[2],this._view.state.viewingMode);e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&i,environment:this._view.environment,weatherVisible:this._weatherAvailable,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._referencePositionGeographic=null,e&&this._cameraHandler()}get test(){}};u([p({type:Boolean,readOnly:!0})],Ph.prototype,"updating",null),u([p()],Ph.prototype,"_disableProjectionEngineAutoLoad",void 0),u([p()],Ph.prototype,"_disableWeather",void 0),u([p()],Ph.prototype,"weatherEnabled",null),u([p()],Ph.prototype,"_weatherAvailable",null),u([p()],Ph.prototype,"referencePositionGeographic",null),u([p()],Ph.prototype,"_renderer",void 0),u([p()],Ph.prototype,"_referencePositionGeographic",void 0),u([p()],Ph.prototype,"_canProjectCameraPosition",null),Ph=u([A("esri.views.3d.environment.EnvironmentManager")],Ph);const Ibt=De(.22,.22,.33),Rbt=De(.22,.22,.22);var xK;let Dh=xK=class extends ee{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,i){e[i]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,i){t&&(e[i]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new xK(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};u([p({readOnly:!0,type:["sun"],json:{write:!0}})],Dh.prototype,"type",void 0),u([p({type:Date,json:{type:Number,write:{target:"datetime"}}})],Dh.prototype,"date",void 0),u([ve("date",["datetime"])],Dh.prototype,"readDate",null),u([_e("date")],Dh.prototype,"writeDate",null),u([p({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Dh.prototype,"directShadowsEnabled",void 0),u([ve("directShadowsEnabled",["directShadows"])],Dh.prototype,"readDirectShadowsEnabled",null),u([_e("directShadowsEnabled")],Dh.prototype,"writedirectShadowsEnabled",null),u([p({type:Number,json:{write:!0}})],Dh.prototype,"displayUTCOffset",void 0),u([_e("displayUTCOffset")],Dh.prototype,"writeDisplayUTCOffset",null),Dh=xK=u([A("esri.webscene.SunLighting")],Dh);const NS=Dh;var c2;let s_=c2=class extends Ss.EventedMixin(NS){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),i=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new c2(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const i=c2.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let r=null;t!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(r=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(r=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const s=c2.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==s&&(IF.target=this,IF.timezoneOffset=s,this.emit("timezone-will-change",IF),IF.target=null),t!=null)return isNaN(t.getTime())||r!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new c2({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([p({type:Boolean})],s_.prototype,"cameraTrackingEnabled",void 0),u([p({type:Date})],s_.prototype,"defaultDate",null),u([p({type:Date})],s_.prototype,"date",null),s_=c2=u([A("esri.views.3d.environment.SunLighting")],s_),function(t){function e({hours:i,minutes:r,seconds:s}){return Math.round(i+r/60+s/3600)}t.calculateTimezoneOffset=e}(s_||(s_={}));const IF={target:null,timezoneOffset:0},V1=s_;var SK;let KI=SK=class extends ee{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new SK(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};u([p({readOnly:!0,type:["virtual"],json:{write:{isRequired:!0}}})],KI.prototype,"type",void 0),u([p({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],KI.prototype,"directShadowsEnabled",void 0),KI=SK=u([A("esri.webscene.VirtualLighting")],KI);const DL=KI;var N5;let F5=N5=class extends Ss.EventedMixin(DL){constructor(t){super(t),this.cameraTrackingEnabled=!0}clone(){return new N5({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new N5(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([p({type:Boolean})],F5.prototype,"cameraTrackingEnabled",void 0),F5=N5=u([A("esri.views.3d.environment.VirtualLighting")],F5);const QI=F5,Pbt={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:V1,virtual:QI}},eFe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:NS,virtual:DL}};let k5=class extends ee{constructor(e){super(e)}clone(){throw new Error("Subclasses of Background should implement their own clone method.")}};u([p({readOnly:!0,json:{read:!1}})],k5.prototype,"type",void 0),k5=u([A("esri.webscene.background.Background")],k5);const tFe=k5;var TK;let eR=TK=class extends tFe{constructor(t){super(t),this.type="color",this.color=new Je([0,0,0,1])}clone(){return new TK(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};u([Ve({color:"color"},{readOnly:!0})],eR.prototype,"type",void 0),u([p(Vv({nonNullable:!0}))],eR.prototype,"color",void 0),eR=TK=u([A("esri.webscene.background.ColorBackground")],eR);const iFe=eR,Uge={base:tFe,key:"type",typeMap:{color:iFe}};function Dbt(t){return(e,i,r)=>{if(!e)return e;for(const s in t.typeMap)if(e.type===s){const n=new t.typeMap[s];return n.read(e,r),n}}}const Lbt={types:Uge,json:{read:Dbt(Uge),write:{overridePolicy:(t,e,i)=>({enabled:!(i!=null&&i.isPresentation)})}}};var EK;const Bge=(t,e,i)=>({enabled:!(i!=null&&i.isPresentation)});let n_=EK=class extends ee{constructor(t){super(t),this.lighting=new NS,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){Jgt(t==null?void 0:t.type,J.getLogger(this))&&this._set("weather",t)}clone(){return new EK(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?DL.prototype.clone.call(this.lighting):NS.prototype.clone.call(this.lighting),background:q(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};u([p({types:eFe,nonNullable:!0,json:{write:!0}})],n_.prototype,"lighting",void 0),u([p(Lbt)],n_.prototype,"background",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Bge}}})],n_.prototype,"atmosphereEnabled",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Bge}}})],n_.prototype,"starsEnabled",void 0),u([p({types:coe,nonNullable:!0,json:{write:!0},value:new UB})],n_.prototype,"weather",null),n_=EK=u([A("esri.webscene.Environment")],n_);const EA=n_;var tR;let j1=tR=class extends EA{constructor(t){super(t),this.lighting=this.castLighting(),this._computeWeatherAvailable=void 0,this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new tR({...e,lighting:e.lighting?e.lighting.type==="virtual"?QI.fromWebsceneLighting(e.lighting):V1.fromWebsceneLighting(e.lighting):void 0})}get weatherAvailable(){var t;return((t=this._computeWeatherAvailable)==null?void 0:t.call(this))??!1}setComputeWeatherAvailable(t){this._computeWeatherAvailable=t}castLighting(t){return this._convertLightingWithDestroy(t)}applyLighting(t){this.lighting=this._convertLightingWithDestroy(t)}_convertLightingWithDestroy(t){const e=this._convertLighting(t);return e!==t&&this.addHandles(ySe(e)),e}_convertLighting(t){var e,i;return t?t instanceof V1||t instanceof QI?t:t instanceof NS?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new V1({...t.cloneConstructProperties(),...(e=this.lighting)==null?void 0:e.cloneNonPersistentConstructProperties()}):t instanceof DL?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new QI({...t.cloneConstructProperties(),...(i=this.lighting)==null?void 0:i.cloneNonPersistentConstructProperties()}):Ad(Pbt,t):new V1}clone(){return new tR({lighting:this.lighting.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:q(this.background)})}cloneWithWebsceneEnvironment(t){return new tR({weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:q(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):V1.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):QI.fromWebsceneLighting(t.lighting);default:return t.lighting,V1.fromWebsceneLighting(t.lighting)}}};u([p({nonNullable:!0})],j1.prototype,"lighting",void 0),u([p()],j1.prototype,"_computeWeatherAvailable",void 0),u([p({readOnly:!0})],j1.prototype,"weatherAvailable",null),u([ti("lighting")],j1.prototype,"castLighting",null),j1=tR=u([A("esri.views.3d.environment.SceneViewEnvironment")],j1);const u2=j1;var Fr;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(Fr||(Fr={}));var ri;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(ri||(ri={}));var ug;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})(ug||(ug={}));let gh=class{constructor(e=Fr.ALL,i=ri.NONE,r=0,s=null,n=null,o=ug.TUMBLE){this.selection=e,this.interactionType=i,this.interactionFactor=r,this.interactionStartCamera=s,this.interactionDirection=n,this.tiltMode=o}};function Y3(t,e){return!!(t&e)}function ZB(t,e,i,r,s,n){t!==0&&(i?(n.min=Math.min(n.min,e),n.max=Math.max(n.max,e)):r!=null?(n.min-=Math.max(0,(e-n.min)*(1-r)),n.max+=Math.max(0,(e-n.max)*(1-r))):s&&(n.min-=Math.max(0,e-n.min-s),n.max+=Math.max(0,e-n.max-s)))}const fT=new gh(Fr.NONE);function rFe(t,e,i,r){return e=e||t.viewForward,ne(r,e),re(r,r,Math.sign(fe(e,i))),r}function hri(t,e,i,r){return Ubt(t,e,i,kbt(r,e,i,!0))}function Nbt(t,e,i,r){const s=fe(i,be(t,r,e));return oe(t,e,re(t,i,s))}const Fbt={dir:$(),len:0,clip:Ye()};function kbt(t,e,i,r){const s=Fbt;return t?(i&&r&&(s.len=Sr(e,i)),ne(s.dir,t)):(s.len=Sr(e,i),be(s.dir,i,e),re(s.dir,s.dir,1/s.len)),s}function zbt(t,e,i){const r=fe(t,i.dir),s=-on(t,e);if(s<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return s>0;if((s<0||r<0)&&!(s<0&&r<0))return!0;const n=s/r;return r>0?n<i.clip[1]&&(i.clip[1]=n):n>i.clip[0]&&(i.clip[0]=n),i.clip[0]<=i.clip[1]}function Ubt(t,e,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let s=0;s<t.length;s++)if(!zbt(t[s],e,r))return!1;return!0}function Bbt(t,e,i=fT){const r=koe(t,e,i);if(r===0)return!1;const s=t.renderCoordsHelper,n=s.getAltitude(e.eye)+r,o=rFe(e,i.interactionDirection,Gbt(t,e,Math.sign(r),Zbt),Wbt),a=ne(Ybt,e.viewForward),l=s.intersectInfiniteManifold(wf(e.eye,o),n,Jq);return e.eye=l??s.setAltitude(Jq,n,e.eye),e.center=Nbt(Jq,e.eye,a,e.center),!0}function koe(t,e,i=fT){if(!Vbt(t,i)||!t.state.constraints.altitude)return 0;const r=Hbt(t.state.constraints.altitude,qbt);jbt(t,i,r);const s=t.renderCoordsHelper.getAltitude(e.eye),n=ue(s,r.min,r.max)-s;return Math.abs(n)<=1e-6?0:n}function Vbt(t,e){const i=t.state.constraints.altitude;return!(!t.state.isGlobal||!i)&&(e.interactionType!==ri.TUMBLE||!Y3(e.selection,Fr.TILT))}function jbt(t,e,i){const r=e.interactionType;if(r===ri.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=r===ri.TUMBLE||r===ri.ZOOM,c=koe(t,o),h=c===0?0:t.renderCoordsHelper.getAltitude(o.eye);i.min=s,i.max=n,ZB(c,h,l,a,.05*h,i)}function Gbt(t,e,i,r){return t.renderCoordsHelper.worldUpAtPosition(e.eye,r),re(r,r,i),r}function Hbt(t,e){return e.min=t.min,e.max=t.max,e}const qbt={min:0,max:0},Wbt=$(),Zbt=$(),Ybt=$(),Jq=$();function zoe(t,e,i=fT){if(!t.state.isLocal)return 0;const r=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;RF.min=0,RF.max=r,Xbt(t,i,RF);const s=Uoe(t,e),n=RF.max-s;return n>=-1e-6?0:n}function Jbt(t,e,i=fT){const r=zoe(t,e,i);if(r===0)return!1;const s=t.pointsOfInterest.surfaceOrigin;if(!s.renderLocation)return!1;const n=Uoe(t,e)+r,o=ne(Qbt,e.eye),a=rFe(e,i.interactionDirection,Kbt(e,s.renderLocation,iwt),twt);if(!cw(BRe(s.renderLocation,n),wf(e.eye,a),PF))return!1;e.eye=PF;const l=be(ewt,e.eye,o);e.center=oe(PF,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),h=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,PF);return h!=null&&(e.center=h),!0}function Xbt(t,e,i){const r=e.interactionType;if(r===ri.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=r===ri.ZOOM||r===ri.PAN,c=zoe(t,o),h=c===0?0:Uoe(t,o);i.min=s,i.max=n,ZB(c,h,l,a,.05*h,i)}function Uoe(t,e){const i=t.pointsOfInterest.surfaceOrigin;return i.renderLocation?Sr(e.eye,i.renderLocation):0}function Kbt(t,e,i){return nT(i,t.eye,e)}const RF={min:0,max:0},Qbt=$(),ewt=$(),twt=$(),iwt=$(),PF=$();function _M(t,e,i=Sd.EYE){const r=t.state.constraints;if(!r.collision.enabled)return!1;const s=O6(t,e.eye),n=t.renderCoordsHelper.getAltitude(e.eye),o=s+r.collision.elevationMargin;if(n>=o)return!1;const a=Ee(e.eye);if(be(DF,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(rwt,o,e.eye),i===Sd.EYE_AND_CENTER)e.center=oe(DF,e.eye,DF);else if(i===Sd.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;e.center=re(DF,e.center,l)}return!0}var Sd;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(Sd||(Sd={}));const DF=$(),rwt=$();function sFe(t,e,i,r=!0){yO.eyeCenterDistance=0,yO.requiresTwoSteps=!1;const s=Boe(t,e,i,fT,yO);if(s===0)return!1;switch(Pd(LF,-s,e.viewRight),i.tiltMode){case ug.LOOK_AROUND:ot(C0,e.viewForward,LF),re(C0,C0,yO.eyeCenterDistance),e.center=oe(G_,e.eye,C0);break;case ug.TUMBLE:be(C0,e.center,e.eye),ot(C0,C0,LF),e.eye=be(G_,e.center,C0);break;default:i.tiltMode}return e.up=ot(G_,e.up,LF),!yO.requiresTwoSteps||!r||sFe(t,e,i,!1)}function Boe(t,e,i,r=fT,s){if(!t.state.constraints.tilt)return 0;const n=Math.min(e.relativeElevation*z5,e.distance),o=t.state.constraints.tilt(n,pwt);return dwt(t,i,o),r.interactionType===ri.TUMBLE&&Y3(r.selection,Fr.ALTITUDE)&&nFe(t,r.interactionStartCamera,o),i.tiltMode===ug.LOOK_AROUND||r.tiltMode===ug.LOOK_AROUND?nwt(t,e,o,s):swt(t,e,o)}function swt(t,e,i){const r=Rv(t.renderCoordsHelper,e.center,e.eye),s=r-ue(r,i.min,i.max);return J3(s)?s:0}function nwt(t,e,i,r){switch(r&&(r.requiresTwoSteps=!1),t.viewingMode){case"global":return awt(t,e,i,r);case"local":return owt(t,e,i,r)}}function owt(t,e,i,r){const s=Rv(t.renderCoordsHelper,e.center,e.eye),n=ue(s,i.min,i.max),o=s-n;if(!J3(o))return 0;if(r){const a=Math.abs(t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude),l=t.renderCoordsHelper.getAltitude(e.eye)-a,c=Math.max(Math.cos(n),1e-4);Math.abs(c)>1e-4?r.eyeCenterDistance=l/c:r.eyeCenterDistance=e.distance}return o}function awt(t,e,i,r){const s=lwt(t,e,fwt),n=ue(s.tiltAtCenter,i.min,i.max);if(!J3(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=cwt(s),a=uwt(s,o)):(o=s.constraints.clampTilt(s.distance,s.tiltAtCenter),r&&o<Math.PI/2&&(r.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=hwt(s,o)),r&&(r.eyeCenterDistance=CK(s,o)),a}function lwt(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=r+yr(t.spatialReference).radius,n=t.renderCoordsHelper.intersectManifold(e.ray,r,G_);return i.distance=Math.min(e.relativeElevation*z5,e.distance),i.centerIsOnSurface=!1,n!=null?(i.distance=Math.min(e.relativeElevation*z5,Sr(e.eye,n)),i.tiltAtCenter=Rv(t.renderCoordsHelper,n,e.eye),i.centerIsOnSurface=!0):t.state.isLocal?i.tiltAtCenter=Rv(t.renderCoordsHelper,e.center,e.eye):(fM(pM(WG,s),e.ray,G_),i.distance=Math.min(e.relativeElevation*z5,Sr(e.eye,G_)),i.tiltAtCenter=Ja(-fe(e.viewForward,ae(G_,G_)))),i.radius=s,i.eyeRadius=Ee(e.eye),i.constraints=t.state.constraints,i}function J3(t){return Math.abs(t)>1e-9}function cwt(t){const{constraints:e,distance:i,tiltAtCenter:r}=t;let s=r,n=e.clampTilt(i,r);const o=CK(t,n);if(e.clampTilt(o,r)===n)return n;let a=0;for(;a<10&&J3(n-s);){const l=(s+n)/2,c=CK(t,l);J3(e.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function CK(t,e){if(!t.centerIsOnSurface)return t.distance;const i=Math.PI-ue(e,0,Math.PI),r=Md(t.radius/t.eyeRadius*Math.sin(i)),s=Math.PI-i-r,n=Math.sin(s)/Math.sin(i);if(t.eyeRadius<t.radius&&n>1){const o=Math.PI-r,a=Math.PI-i-o;return Math.sin(a)/Math.sin(i)*t.eyeRadius}return n*t.eyeRadius}function uwt(t,e){const i=Md(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),r=Md(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?i-r:r-i}function hwt(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function dwt(t,e,i){if(e.interactionType===ri.NONE)return;const{interactionStartCamera:r,interactionFactor:s}=e;if(!r)return;const{min:n,max:o}=i,a=Boe(t,r,fT,e),l=a===0?0:Rv(t.renderCoordsHelper,r.center,r.eye);i.min=n,i.max=o,e.interactionType===ri.TUMBLE?(Y3(e.selection,Fr.ALTITUDE)&&nFe(t,r,i),ZB(a,l,!0,s,Vge,i)):ZB(a,l,!1,s,Vge,i)}function nFe(t,e,i){const r=t.state.constraints;if(t.state.isLocal||!r.altitude||!e)return;const s=Xo(e.center),n=Math.sqrt(s),o=e.distance,a=yr(t.spatialReference).radius,l=r.altitude.min+a,c=r.altitude.max+a,h=(l*l-o*o-s)/(-2*n*o),d=(c*c-o*o-s)/(-2*n*o);i.min=Math.max(i.min,Math.min(Math.PI-Ja(d),i.max)),i.max=Math.min(i.max,Math.PI-Ja(h))}const C0=$(),LF=qe(),G_=$(),Vge=At(5),z5=30,pwt={min:0,max:0},fwt={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,distance:0,tiltAtCenter:0},yO={eyeCenterDistance:0,requiresTwoSteps:!1};function Ps(t,e,i=vwt,r=e){r!==e&&r.copyFrom(e),r.computeUp(t.state.viewingMode);let s=!1;for(let a=0;a<_wt;a++){let l=0;for(const c of ywt)if(Y3(i.selection,c.type)){const h=Math.abs(c.error(t,r,i));c.apply(t,r,i)&&(s=!0,l+=h)}if(l===0)break}const n=Y3(i.selection,Fr.COLLISION),o=mwt(i.interactionType,t);return n&&_M(t,r,o)&&(s=!0),s&&r.computeUp(t.state.viewingMode),s}function mwt(t,e){switch(t){case ri.PAN:return Sd.EYE_AND_CENTER;case ri.ASCEND:return e.state.isGlobal?Sd.EYE_AND_CENTER_SCALE:Sd.EYE_AND_CENTER;default:return Sd.EYE}}function ud(t){const e=Math.min(1,t/150);return MOe(e)}function gwt(t,e,i){return Boe(t,e,i)*e.distance}const ywt=[{type:Fr.TILT,error:gwt,apply:sFe},{type:Fr.ALTITUDE,error:koe,apply:Bbt},{type:Fr.DISTANCE,error:zoe,apply:Jbt}],vwt=new gh,_wt=5;let jge=class{get pitch(){return this._pitch}get yaw(){return this._yaw}get distance(){return this._distance}get fov(){return this._fov}get size(){return this._size}constructor(e){this.viewingMode=e,this.center=$(),this._pitch=0,this._yaw=0,this._distance=0,this.direction=os(Gge),this._fov=55,this._size=1}pixelsPerPanAtZoom(e){return this._size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this._size/2/(this._zoomToPanScale*e)}pixelsPerRotate(){const e=Math.max(Math.cos(Math.abs(this._pitch)),.5);return this._size/2/e}compareTo(e,i){if(this.viewingMode===je.Global){const n=(Ee(this.center)+Ee(e.center))/2;i.pan=jG(this.center,e.center)*n}else i.pan=Sr(this.center,e.center);let r=Math.abs(e._yaw-this._yaw);r>=Math.PI&&(r=2*Math.PI-r);const s=Math.abs(e._pitch-this._pitch);i.rotate=Math.max(r,s),i.fov=e.fov-this.fov,i.sourceZoom=this._distance,i.targetZoom=e._distance}interpolate(e,i,r){this.viewingMode===je.Global?TRe(e.center,i.center,r.pan,this.center):fr(this.center,e.center,i.center,r.pan),this._distance=isFinite(i.distance)?ft(e.distance,i.distance+r.zoomOffset,r.zoom):e.distance,this._pitch=ft(e.pitch,i.pitch,r.rotate);let s=e._yaw;const n=i._yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this._yaw=ft(s,n,r.rotate),this._fov=ft(e.fov,i.fov,r.fov)}copyFrom(e){ne(this.center,e.center),this._pitch=e.pitch,this._yaw=e.yaw,this._distance=e.distance,ne(this.direction,e.direction),this._size=e.size,this._fov=e.fov,this._zoomToPanScale=Math.atan(.5*this._fov),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const i=this._lookAtOrientation(e.center,Hge);ne(this.center,e.center),be(na,e.center,e.eye),uc(na,na,i),uc(A0,e.up,i),this._distance=Ee(na),this._distance!==0&&(na[0]/=this._distance,na[1]/=this._distance,na[2]/=this._distance),this._pitch=bwt(na),this._yaw=wwt(na,A0),this._size=Math.sqrt(e.width*e.width+e.height*e.height),this._fov=e.fov,this._zoomToPanScale=Math.atan(.5*this._fov)}copyToRenderCamera(e){const i=this._lookAtOrientation(this.center,Hge);uM(i,i),this._axisAngleVec3(U5,this._pitch-Math.PI/2,Gge,na),this._axisAngleVec3(Dx,this._yaw,na,na),this._axisAngleVec3(U5,this._pitch-Math.PI/2,Dx,A0),this._axisAngleVec3(Dx,this._yaw,A0,A0),re(na,na,this._distance),uc(na,na,i),uc(A0,A0,i),e.center=this.center,e.eye=be(na,this.center,na),e.up=A0,e.fov=this._fov}_axisAngleVec3(e,i,r,s){const n=Math.cos(i),o=Math.sin(i);return re(bu,r,n),ct(Uc,e,r),re(Uc,Uc,o),re($0,e,(1-n)*fe(e,r)),oe(s,oe(s,bu,Uc),$0)}_lookAtOrientation(e,i=Ts()){return this._upAtLookAt(e,$0),ct(bu,this.direction,$0),ae(bu,bu),bu[0]===0&&bu[1]===0&&bu[2]===0&&ne(bu,U5),ct(Uc,$0,bu),ae(Uc,Uc),i[0]=bu[0],i[1]=Uc[0],i[2]=$0[0],i[3]=bu[1],i[4]=Uc[1],i[5]=$0[1],i[6]=bu[2],i[7]=Uc[2],i[8]=$0[2],i}_upAtLookAt(e,i){return this.viewingMode===je.Local?ne(i,Dx):ae(i,e)}};function bwt(t){return Math.PI-jG(Dx,t)}function wwt(t,e){const i=xwt;return Math.abs(e[2])<.5?(ne(i,e),t[2]>0&&re(i,i,-1)):ne(i,t),ct(Uc,i,Dx),ae(Uc,Uc),jG(U5,Uc,Dx)}const bu=$(),Uc=$(),$0=$(),na=$(),A0=$(),xwt=$(),Dx=q$,Gge=lre,U5=are,Hge=Ts();let Swt=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new NOe(()=>new jge(e)),this._current=new jge(e)}update(e,i,r){const{source:s,target:n}=this._animation.definition,o=be(Twt,i.center,e.center),a=Ee(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),ne(s.direction,o),ne(n.direction,o),s.copyFromRenderCamera(e),n.copyFromRenderCamera(i),this._current.copyFrom(s),this._animation.update(s,n,r),this.currentTime=0,e.almostEquals(i)&&(this.currentTime=this._animation.time)}cameraAt(e,i){this._animation.cameraAt(e,this._current),this._current.copyToRenderCamera(i)}step(e,i){this.finished||(this.currentTime=this.currentTime+GSe(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,i)}};const Twt=$();var Hr;(function(t){t[t.Ready=0]="Ready",t[t.Rejected=1]="Rejected",t[t.Running=2]="Running",t[t.Stopped=3]="Stopped",t[t.Finished=4]="Finished"})(Hr||(Hr={}));let jy=class extends he{constructor(e){super(e),this.state=Hr.Ready}get running(){return this.state===Hr.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=Hr.Stopped,!0)}finishController(){this.state=Hr.Finished}get steppingFinished(){return!1}};u([p({constructOnly:!0})],jy.prototype,"view",void 0),u([p({readOnly:!0})],jy.prototype,"running",null),u([p()],jy.prototype,"state",void 0),u([p({readOnly:!0})],jy.prototype,"isInteractive",null),jy=u([A("esri.views.3d.state.controllers.CameraController")],jy);let X3=class extends jy{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(bi()),this._asyncResult=null),this.state===Hr.Finished||this.state===Hr.Stopped?(Fj(e),this.state===Hr.Finished?e.resolve():e.reject(bi())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=Hr.Running,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!this.viewAnimation||this.state!==Hr.Ready&&this.state!==Hr.Running||(this.viewAnimation.state===xv.State.FINISHED?this.finish():this.viewAnimation.state===xv.State.STOPPED&&(this.state=Hr.Stopped))}onControllerEnd(e){this.viewAnimation==null||this.viewAnimation.done||(this.state===Hr.Finished?this.viewAnimation.finish():this.state===Hr.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===Hr.Finished?this._asyncResult.resolve():this._asyncResult.reject(bi()))}finish(){this.finishController()}};X3=u([A("esri.views.3d.state.controllers.AnimationController")],X3);let Lx=class extends X3{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.type="point-to-point",this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new Swt(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new xv}get isInteractive(){return this.mode==="interaction"}begin(e,i){this._hasTarget=!0;const r=this.animationSettings(i);NF.copyFrom(this.view.state.camera);const s=ph(this.view.state.viewingMode);this._intersectionHelper.intersectRay(NF.ray,s,qge)&&(NF.center=qge),this.animation.update(NF,e,r),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,i){this._hasTarget&&this.animation.step(e,i)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?LJ[e.easing]:e.easing}}};u([p({constructOnly:!0})],Lx.prototype,"mode",void 0),u([p({readOnly:!0})],Lx.prototype,"isInteractive",null),Lx=u([A("esri.views.3d.state.controllers.PointToPointAnimationController")],Lx);const NF=new qr,qge=$();function Wge(t){return t!=null&&"type"in t&&t.type==="point-to-point"}function D6(t=Cwt){return[t[0],t[1],t[2],t[3]]}function K3(t,e){return Ewt(t[0],t[1],t[2],e,Ose.get())}function Ewt(t,e,i,r,s=D6()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function Voe(t,e,i){return ct(i,t,e),ae(i,i),i[3]=Dse(t,e),i}const Cwt=[0,0,1,0];function yri(t,e,i=Nn()){return joe(t,Yp(e),i),ae(i.direction,i.direction),i}function joe(t,e,i){return $wt(t,t.screenToRender(e,Le.get()),i)}function $wt(t,e,i){const r=Vn(Le.get(),e);if(r[2]=0,!t.unprojectFromRenderScreen(r,i.origin))return null;const s=Vn(Le.get(),e);s[2]=1;const n=t.unprojectFromRenderScreen(s,Le.get());return n==null?null:(be(i.direction,n,i.origin),i)}function bM(t,e,i){return Goe(t,t.screenToRender(e,Le.get()),i)}function Goe(t,e,i){ne(i.origin,t.eye);const r=se(Le.get(),e[0],e[1],1),s=t.unprojectFromRenderScreen(r,Le.get());return s==null?null:(be(i.direction,s,i.origin),i)}function Hoe(t,e,i,r){const s=bM(e,i,Awt);return cw(t,s,r)}const Awt=Nn();var CA;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})(CA||(CA={}));const oFe=30,YB=[1,3e8],LL=80,aFe=8,lFe=200,cFe=1508e5,uFe=5,hFe=50,Mwt=5,Owt=10,Xq=90,mT={exclude:new Set([qb])};function sS(t,e,i){return i[0]=e[0]/(t.fullWidth/t.pixelRatio),i[1]=e[1]/(t.fullHeight/t.pixelRatio),i}function $K(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function Yb(t,e,i){const r=Pd(Ise.get(),i[3],i);r==null||T$e(r,eo)||(be(pr,t.eye,e),ot(pr,pr,r),t.eye=oe(pr,pr,e),be(pr,t.center,e),ot(pr,pr,r),t.center=oe(pr,pr,e),t.up=ot(pr,t.up,r))}function Iwt(t,e,i,r){return dM(t,joe(e,i,Zoe),r)}function AK(t,e,i,r){return dM(t,bM(e,i,Zoe),r)}function qoe(t,e,i,r){const s=Le.get();let n=1-i;be(s,e,t.eye);const o=Ee(s);let a=o*(1-n);n>=0&&a<r&&(a=r,n=-(a-o)/o),Math.abs(o-a)<1e-6||(re(s,s,n),t.eye=oe(pr,t.eye,s),t.center=fr(pr,t.center,e,n))}function dFe(t,e,i){e.getScreenCenter(Zge),Hoe(t,e,Zge,pr)&&(e.center=pr);const r=e.distance,s=r*i;if(Math.abs(r-s)<1e-6)return;const n=re(Le.get(),e.viewForward,s);e.eye=be(pr,e.center,n)}const Zge=ln();function Kq(t,e){se(e,0,0,0);for(const i of t)oe(e,e,i);re(e,e,1/t.length)}function B5(t,e,i,r){return Math.sin(t/Ee(e))*(i+r.radius)}function Yge(t,e,i,r){return B5(Math.PI/2,e,i,r)+(t-Math.PI/2)}var ba;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(ba||(ba={}));const Jge={Elevation:3e4,Angle:At(16)},pFe=At(80);function fFe(t,e,i,r,s,n){const o=$(),a=Ls();let l=!0,c=!0;return t.intersectScreen(i,o,n)?a[3]=Ee(o):(c=!1,e.aboveGround&&s!==CA.Ellipsoid?a[3]=Math.max(Ee(e.center),.9*r.radius):a[3]=Ee(e.eye)-e.relativeElevation,s===CA.Silhouette?Q3(a,e,i,o):l=Hoe(a,e,i,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function NL(t,e,i,r){const s=t.relativeElevation;if(s>Jge.Elevation&&r==="global")return ba.Horizontal;bM(t,e,e9);const n=Math.sign(s),o=i.worldUpAtPosition(t.eye,pr);return-n*fe(o,e9.direction)<Math.sin(Jge.Angle)*Ee(e9.direction)?ba.Vertical:ba.Horizontal}function mFe(t,e,i){be(Qq,i,e),t.eye=be(pr,t.eye,Qq),t.center=be(pr,t.center,Qq)}const Qq=$();function Q3(t,e,i,r){const s=bM(e,i,Zoe);return s!=null&&(fM(t,s,FF),cw(t,s,r)?!(no(FF,s.origin)<no(r,s.origin))||(ne(r,FF),!1):(be(sE,e.eye,e.center),ae(sE,sE),ERe(sE,-fe(ae(sE,sE),FF),Xge),dM(Xge,s,r),!1))}const FF=$(),sE=$(),Xge=Gr();function gFe(t,e,i,r,s,n){let o=0;if(ct(KB,t,e),be(BF,t,e),Ee(t)<=s||!r.aboveGround){ct(i,BF,r.eye);const a=fe(t,e)/(Ee(t)*Ee(e));if(a<.9999)o=Ja(a);else{const c=Ee(ct($(),t,e))/(Ee(t)*Ee(e));o=Md(c)}const l=Math.cos(ue(Ib.normalize(At(n)),0,pFe));o=-o-Math.max(0,Ee(e)-s)/(l*s)}else be(Kge,r.eye,r.center),ct(i,BF,Kge),o=-Ee(BF)/s;return ae(i,i),re(i,i,Ee(KB)),o}const Kge=$();function Qge(t,e,i,r){let s,n;const o=Math.cos(ue(Ib.normalize(At(r)),0,pFe));return s=e>i?-(e-i)/(o*i):e<-i?Math.PI-(e+i)/(o*i):Ja(e/i),n=t>i?-(t-i)/(o*i):t<-i?Math.PI-(t+i)/(o*i):Ja(t/i),(n-s)*i}function Rwt(t,e,i,r,s,n,o,a,l,c){const h=Qge(t[2],e[2],n[3],a),d=l?Qge(t[0],e[0],n[3],180):e[0]-t[0],f=Math.sin(o)*d-Math.cos(o)*h,m=Math.cos(o)*d+Math.sin(o)*h;ae(pr,s);const g=l?f/Math.sqrt(Math.abs(n[3]**2-fe(i,pr)**2)):f/n[3],v=m/Math.sqrt(Math.abs(n[3]**2-fe(i,r)**2));di(c,g,v)}function yFe(t,e,i,r,s,n,o,a,l,c){ct(KB,t,e),JJ(n.up,n.eye,kF,zF,UF),JJ([0,0,1],n.eye,hv,Cb,wFe),ne(i,Cb),ne(r,hv),ae(i,i),re(i,i,Ee(KB)),Jpe(t,ae(zF,zF),ae(UF,UF),ae(kF,kF),eye),Jpe(e,zF,UF,kF,tye),Rwt(eye,tye,t,hv,Cb,o,a,l,c,s)}function Pwt(t,e,i,r,s,n,o){Pd(JB,s,r),Pd(XB,o,n),Bn(_C,JB,XB),be(e,t,i),ot(e,e,_C),oe(e,e,i)}function vFe(t,e,i,r,s,n){Pd(JB,r,i),Pd(XB,n,s),Bn(_C,JB,XB),be(pr,t.eye,e),ot(pr,pr,_C),t.eye=oe(pr,pr,e),be(pr,t.center,e),ot(pr,pr,_C),t.center=oe(pr,pr,e),be(pr,t.up,e),ot(pr,pr,_C),t.up=oe(pr,pr,e)}const jw={Pole:.95,Angle:At(18),Tilt:45,TiltHysteresisMargin:1e-7};let nE=!1;function Woe(t,e,i,r,s,n){const o=Math.abs(r)>Math.PI-jw.Angle||Math.abs(r)<jw.Angle,a=(Math.abs(t[2])<i*jw.Pole||Math.abs(e)>i)&&n;return o&&a?!nE&&s<jw.Tilt-jw.TiltHysteresisMargin?nE=!0:nE&&s>jw.Tilt+jw.TiltHysteresisMargin&&(nE=!1):nE=!1,nE}function _Fe(t,e,i,r,s,n){if(n)Voe(i,r,iye),Yb(e,t,iye);else{const o=gFe(i,r,rye,e,t[3],s);Yb(e,t,K3(rye,o))}}function bFe(t,e,i,r,s,n,o){const a=o?20:1,l=1e-12;let c,h;ne(Gw,r),VF.copyFrom(e);for(let d=0;d<a&&no(i,Gw)>l&&(c=no(i,Gw),yFe(i,Gw,Cb,hv,vO,VF,t,s,n,o),vFe(VF,t,hv,vO[1],Cb,vO[0]),Pwt(Gw,Gw,t,hv,vO[1],Cb,vO[0]),h=no(i,Gw),h<c||d===0);d++)e.copyFrom(VF)}function Dwt(t,e,i,r,s,n,o){Woe(i,fe(e.up,i),t[3],-Ib.normalize(At(s)),n,e.aboveGround)?bFe(t,e,i,r,-Ib.normalize(At(s)),n,o):_Fe(t,e,i,r,n,o)}function Lwt(t,e,i,r,s,n){const{eye:o}=t;JJ([0,0,1],o,hv,Cb,wFe);const a=e.translation[0]*i.pan,l=s.mode==="zoom"?0:e.translation[1]*i.pan,c=Math.max(Math.sqrt(Math.abs(1-fe(t.center,hv)**2/Ee(t.center)**2)),.5),h=(Math.sin(n)*l+Math.cos(n)*a)/c,d=-Math.cos(n)*l+Math.sin(n)*a;switch(Ku(r.pan.matrix,r.pan.matrix,h,hv),r.pan.enabled=!0,s.mode){case"pan":Ku(r.pan.matrix,r.pan.matrix,d,Cb),r.pan.enabled=!0;break;case"zoom":r.zoom=-e.translation[1]*i.zoom}}function Nwt(t,e,i,r,s){const{eye:n,viewRight:o}=t,a=ct(Le.get(),o,n),l=e.translation[0]*i.pan;switch(l!==0&&(Ku(r.pan.matrix,r.pan.matrix,-l,a),r.pan.enabled=!0),s.mode){case"pan":{const c=e.translation[1]*i.pan;c!==0&&(Ku(r.pan.matrix,r.pan.matrix,c,o),r.pan.enabled=!0);break}case"zoom":r.zoom=-e.translation[1]*i.zoom}}function Fwt(t,e,i,r,s,n,o,a,l){Woe(t.center,fe(t.up,t.center),Ee(t.center),-Ib.normalize(At(n)),o,e.aboveGround)?Lwt(e,i,r,a,l,-Ib.normalize(At(s))):Nwt(e,i,r,a,l)}const hv=$(),Cb=$(),wFe=$(),kF=$(),zF=$(),UF=$(),eye=$(),tye=$(),vO=Ye(),iye=D6(),JB=qe(),XB=qe(),_C=qe(),Gw=$(),pr=$(),BF=$(),VF=new qr,KB=$(),rye=$(),Zoe={origin:$(),direction:$()},e9={origin:$(),direction:$()},sye=.6,t9=4,kwt=60;let QB=class extends Lx{constructor(){super(...arguments),this._zoomLocation=$(),this._tmpCamera=new qr,this._tmpViewDir=$(),this._tmpRayDir=Nn(),this._targetOnSphere=$(),this._tmpCenter=$(),this._beginCamera=new qr,this._constraintOptions=new gh(Fr.ALL_EXCEPT_COLLISION,ri.ZOOM,null,this._beginCamera),this._sphere=Ls()}initialize(){this._intersector=ph(this.view.state.viewingMode)}step(e,i){if(!this.running)return;const r=this.view.state;this.animation.finished?this._beginCamera.copyFrom(r.camera):this.animation.cameraAt(1,this._beginCamera);let s=!1,n=!1;this._intersectionHelper.intersectScreen(i,this._zoomLocation,this.view.map.ground.opacity===0?mT:{})&&(s=e>0,n=!0),this._tmpCamera.copyFrom(r.camera),s?this._intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this._intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ne(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,i,n),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:hL}}_updateCamera(e,i,r,s){const n=NL(e,r,this.view.renderCoordsHelper,this.view.viewingMode),o=Math.abs(this.view.camera.position.z),a=this._zoomLocation;ae(GF,e.eye),re(GF,GF,-1),bM(e,r,this._tmpRayDir),ae(this._tmpRayDir.direction,this._tmpRayDir.direction);const l=ue(Math.min(aFe,1/Math.abs(fe(GF,this._tmpRayDir.direction)))*o,lFe,cFe);if(n===ba.Horizontal){let c=sye**i;this._sphere[3]=Ee(a),be(this._tmpViewDir,e.center,e.eye);const h=Math.min(Ee(this._tmpViewDir),l);let d=h*c;if(c<=1&&d<t9&&(d=t9,c=d/h),Math.abs(h-d)<1e-6)return;const f=Ee(e.center);if(this._sphere[3]!==f){const m=this._sphere[3]+c*(f-this._sphere[3]);e.center=re(jF,e.center,m/f)}re(this._tmpViewDir,this._tmpViewDir,-c),e.eye=oe(jF,e.center,this._tmpViewDir),Ps(this.view,e,this._constraintOptions),no(a,e.center)>1e-12&&Hoe(this._sphere,e,r,this._targetOnSphere)&&Dwt(this._sphere,e,a,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let c=sye**Math.abs(i);const h=i>0?1:-1;be(this._tmpViewDir,a,e.eye);const d=Ee(this._tmpViewDir),f=this.view._stage.renderView.getMinimalDepthForArea(null,r[0],r[1],this.view.state.camera,kwt);let m=f??l;m=s&&i>0?Math.min(m,d):m,re(this._tmpRayDir.direction,this._tmpRayDir.direction,m),oe(a,this._tmpRayDir.origin,this._tmpRayDir.direction);let g=m*c;const v=Math.max(t9,1.01*e.nearFar[0]);if(i>0&&g<v&&(g=v,c=g/m),Math.abs(m-g)<1e-6)return;re(this._tmpRayDir.direction,this._tmpRayDir.direction,h*(1-c)),e.eye=oe(jF,e.eye,this._tmpRayDir.direction),e.center=oe(jF,e.center,this._tmpRayDir.direction)}_M(this.view,e)}};QB=u([A("esri.views.3d.state.controllers.ZoomStepControllerGlobal")],QB);const jF=$(),GF=$();let V5,j5=null;const o$=new Map;async function _ri(t){j5==null&&(V5==null&&(V5=G(()=>import("./VoxelWasmPerSceneView-C6FT9kp3.js"),__vite__mapDeps([353,297]))),j5=await V5);const e=t.view;let i=o$.get(e);return i||(i=new j5.default({view:e}),o$.set(e,i)),i.addVoxelLayer(t)}function eD(t){return o$.get(t)}function bri(t){const e=t.view,i=o$.get(e);i&&i.removeVoxelLayer(t)<1&&(o$.delete(e),o$.size===0&&(V5=null,j5=null))}const zwt=.6,Uwt=4,Bwt=60;let eV=class extends Lx{constructor(){super(...arguments),this._zoomLocation=$(),this._tmpCamera=new qr,this._tmpRayDir=$(),this._tmpCenter=$(),this._beginCamera=new qr,this._constraintOptions=new gh(Fr.ALL,ri.ZOOM,null,this._beginCamera)}step(e,i){if(!this.running)return;const r=this.view.state;this.animation.finished?this._beginCamera.copyFrom(r.camera):this.animation.cameraAt(1,this._beginCamera),this._tmpCamera.copyFrom(r.camera);const s=ph(this.view.state.viewingMode);let n=!1;e>0?(n=this._intersectionHelper.intersectScreenFreePointFallback(i,this._zoomLocation,this.view.map.ground.opacity===0?mT:{}),this._intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this._intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ne(this._zoomLocation,this._tmpCamera.center);const o=zwt**e;let a=this.view._stage.renderView.getMinimalDepthForArea(eD(this.view),i[0],i[1],this.view.state.camera,Bwt);be(HF,this._tmpCamera.eye,this._zoomLocation),ae(HF,HF);const l=ue(Math.min(aFe,1/Math.abs(fe(Vwt,HF)))*Math.abs(this.view.camera.position.z),lFe,cFe);if(a=a??l,a){const c=$();be(c,this._zoomLocation,this._tmpCamera.eye),(a<Ee(c)||!n)&&(ae(c,c),oe(this._zoomLocation,this._tmpCamera.eye,re(c,c,a)))}this._updateCamera(this._tmpCamera,o,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:hL}}_updateCamera(e,i,r){be(this._tmpRayDir,r,e.eye);const s=Ee(this._tmpRayDir);let n=s*i;const o=i<=1,a=Math.max(Uwt,1.01*e.nearFar[0]);n!==0&&(o&&n<a&&(n=a,i=n/s),Math.abs(s-n)<1e-6||(re(this._tmpRayDir,this._tmpRayDir,i),e.eye=be(nye,r,this._tmpRayDir),e.center=fr(nye,e.center,r,1-i),Ps(this.view,e,this._constraintOptions)))}};eV=u([A("esri.views.3d.state.controllers.ZoomStepControllerLocal")],eV);const nye=$(),Vwt=De(0,0,1),HF=$();let jwt=class extends ls{constructor(e,i){super(!0),this._view=e,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r))}_handleDoubleClick(e){const i=e.data;if(ase(i,"primary")){const r=this._view.state.isGlobal?new QB({view:this._view,mode:"animation"}):new eV({view:this._view,mode:"animation"});this._view.state.switchCameraController(r),r.step(Math.log(.5)/Math.log(.6),ln(i.x,i.y)),e.stopPropagation()}}};function Yoe(t){return ue((t-1e5)/9e5,0,1)}const oye=1e4,G5=De(parseFloat(5802e-9.toFixed(6)),parseFloat(13558e-9.toFixed(6)),parseFloat(331e-7.toFixed(6))),i9=3,r9=De(i9*parseFloat(65e-8.toFixed(6)),i9*parseFloat(1881e-9.toFixed(6)),i9*parseFloat(85e-9.toFixed(6))),Gwt=3996e-9,Hwt=De(parseFloat(Number(G5[0]+r9[0]).toFixed(6)),parseFloat(Number(G5[1]+r9[1]).toFixed(6)),parseFloat(Number(G5[2]+r9[2]).toFixed(6)));function qwt(t,e,i){return t===je.Global?new Zwt(i):new Wwt(e,i)}let Wwt=class{constructor(e,i){this._elevationProvider=e,this._referenceEllipsoid=yr(i),this._unitInMeters=Mo(i,this._referenceEllipsoid.metersPerDegree)}compute(e,i,r,s,n){var x;n||(n={near:0,far:0});let o=e[2]*this._unitInMeters;const a=o,l=o-s,c=(x=this._elevationProvider)==null?void 0:x.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const h={x:(r=r??new _i({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},d=Math.max(h.x,h.y,h.z);be(Hw,i,e),oE[0]=Hw[0]>0?r.xmax:r.xmin,oE[1]=Hw[1]>0?r.ymax:r.ymin,oE[2]=Hw[2]>0?d/2:-d/2,be(oE,oE,e),ae(Hw,Hw);const f=1.1*fe(oE,Hw)*this._unitInMeters,m=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),g=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),v=g*Xwt*this._unitInMeters,_=g*Kwt*this._unitInMeters,b=ue((o-_)/(v-_),0,1)**3,w=Math.min(ft(m,f,b),m)*Math.max(Math.log(Math.abs(l)),1);return xFe(Math.min(w,Math.max(34064e4,d))/this._unitInMeters,H5,this._unitInMeters,n)}},Zwt=class{constructor(e){this._referenceEllipsoid=yr(e)}compute(e,i,r,s,n){n||(n={near:0,far:0});const o=Ee(e),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,s),c=Math.abs(a-s),h=Math.max(c,Math.abs(a)),d=Math.sqrt(h*(h+2*l)),f=o+this._referenceEllipsoid.radius,m=1.2*ft(d,f,Yoe(h)),g=(Math.log(h)-aye)/(Ywt-aye);return xFe(m,ue(H5-g*(H5-lye),lye,H5),1,n)}};function xFe(t,e,i,r){const s=Jwt/i,n=t/e;return n>s?(r.far=t,r.near=n):(r.near=s,r.far=r.near*e),r}const aye=7.983,Ywt=16.994,H5=2e4,lye=100,Jwt=2,Xwt=.001,Kwt=1e-4,oE=$(),Hw=$();let q5=class extends he{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const i=this.view.state.camera;e.spatialReference!=null&&KLe(this.view,i,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>_M(this.view,e,Sd.EYE_AND_CENTER))}};u([p({constructOnly:!0})],q5.prototype,"view",void 0),q5=u([A("esri.views.3d.state.SurfaceCollisionConstraint")],q5);let iR=class extends he{constructor(e){super(e),this.nearFarHeuristic=qwt(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([H(()=>{var e,i,r,s;return[(i=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:i.near,(s=(r=this.view.constraints)==null?void 0:r.clipDistance)==null?void 0:s.far]},()=>this._clipDistanceNearFarChanged()),H(()=>{var e,i;return(i=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:i.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),H(()=>this.view.renderDataExtent,()=>this._updateNearFar(),Yt),H(()=>{var e,i,r,s;return[(i=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:i.min,(s=(r=this.view.constraints)==null?void 0:r.altitude)==null?void 0:s.max]},()=>this._updateAltitude(),Yt),H(()=>{var e,i;return(i=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:i.max},()=>this._updateTiltMax(),Yt),H(()=>{var e,i;return(i=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:i.mode},()=>this._updateTilt(),Yt),H(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),Yt),H(()=>{var e,i,r,s,n,o;return[(r=(i=(e=this.view.map)==null?void 0:e.ground)==null?void 0:i.navigationConstraint)==null?void 0:r.type,(o=(n=(s=this.view.state)==null?void 0:s.constraints)==null?void 0:n.collision)==null?void 0:o.enabled]},()=>this._updateCollision(),Yt)]),this.view.state.isLocal&&this.addHandles(H(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),Ut)),this._updateNearFar(),this.view.state.viewingMode!==je.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new q5({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var i;const e=(i=this.view.constraints)==null?void 0:i.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(r=>cye(r,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const i=this.view.constraints&&this.view.constraints.clipDistance;(i?i.mode:"auto")==="manual"?cye(e,i):this._updateCameraNearFarAuto(e,i)}_updateCameraNearFarAuto(e,i){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,O6(this.view,e.eye),e),i&&i.autoUpdate(e.near,e.far)}_updateCollision(){var s,n,o;const e=(o=(n=(s=this.view.map)==null?void 0:s.ground)==null?void 0:n.navigationConstraint)==null?void 0:o.type,i=!e||e==="stay-above",r=this.view.state.constraints.collision;if(i!==r.enabled){r.enabled=i,i&&this._reapplyConstraints(Fr.COLLISION);const a=this.view.constraints&&this.view.constraints.tilt;a&&a.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==je.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const i=this.view.state.constraints;i.tilt=i.createConstantMaxTilt(At(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const i=this.view.state.constraints;if(i.tilt){const r=i.tilt(this.view.state.camera.distance).max;e.autoUpdate(Ao(r))}}_updateLocalSurfaceDistance(e){if(e==null)return;let i=Math.max(e.width,e.height);if(i<=0)return;e.zmax!=null&&e.zmin!=null&&(i=Math.max(i,e.zmax-e.zmin));const r=this.view.state,s=3*i/Math.atan(r.camera.fov/2);s!==r.constraints.distance&&(r.constraints.distance=s)}_reapplyConstraints(e=Fr.ALL){this.view.state.updateCamera(i=>Ps(this.view,i,new gh(e,ri.NONE,null)))}};function cye(t,e){e&&(t.near=e.near,t.far=e.far)}u([p({constructOnly:!0})],iR.prototype,"view",void 0),u([p({readOnly:!0})],iR.prototype,"surfaceCollisionConstraint",void 0),iR=u([A("esri.views.3d.state.ConstraintsManager")],iR);let xP=class extends jy{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=Hr.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(e.spatialReference==null||KLe(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),_M(this.view,e,Sd.EYE_AND_CENTER)||this.constraintEnabled||(this.state=Hr.Stopped)})}};u([p({constructOnly:!0})],xP.prototype,"desiredCamera",null),xP=u([A("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],xP);const Qwt=.66;function SFe(t){return 360-Bj.normalize(t)}function L6(t){return Bj.normalize(360-t)}function TFe(t,e,i){const r=e.camera;if(r!=null)return e1t(r,pw(t));const{targetGeometry:s}=e;if(s==null)return null;const{camera:n,mode:o}=CFe(t,e.rotation,i);if(s.type==="point")return i1t(t,e,s,n,o);const a=s.extent;return a==null?null:O5(t,a,n.heading,n.tilt,o)}async function EFe(t,e,i,r){const s=e.camera;if(s!=null)return t1t(s,pw(t),r);const{targetGeometry:n}=e;if(n==null)throw new Error("Viewpoint has no targetGeometry!");const{camera:o,mode:a}=CFe(t,e.rotation,i);if(n.type==="point")return r1t(t,e,n,o,a,r);const l=n.extent;if(l==null)throw new Error("Target geometry has no extent!");return xNe(t,l,o.heading,o.tilt,a,r)}function e1t(t,e){const i=t.position;let r;try{r=Ub(i,e)}catch{return null}if(!r)return null;const s=t.clone();return s.position=r.clone(),s}async function t1t(t,e,i){const r=t.position,s=await Bb(r,e,{signal:i});gt(i);const n=t.clone();return n.position=s.clone(),n}function CFe(t,e,i){const r=TA(t,t.state.camera);let s=So.ADJUST;return e!=null&&(r.heading=SFe(e),s=So.LOCKED),i!=null&&(r.tilt=i),{camera:r,mode:s}}function i1t(t,e,i,r,s){const n=t.spatialReference;let o;try{o=Ub(i.clone(),n)}catch{return null}if(!o)return null;const a=e.scale!=null?W3(t,e.scale):t.state.camera.distance;return x_t(t,o,a,r,s)}async function r1t(t,e,i,r,s,n){const o=t.spatialReference,a=await Bb(i.clone(),o,{signal:n});gt(n);const l=e.scale!=null?W3(t,e.scale):t.state.camera.distance;return I6(t,a,l,r,s,n)}function $Fe(t,e,i=null){return i==null&&(i=new Qr),Xoe(t,null,e.clone(),i)}async function AFe(t,e,i){const r=p1t(t,e);if(!r)throw new U("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new ou({fov:t.camera.fov}),n=new Qr({camera:s});if(r.target instanceof Qr)return qw(await o1t(t,r.target,r,i,n));if(r.target instanceof ou)return qw(await OFe(t,r.target,i,n));const o=r.scale!=null||r.zoom!=null;if(r.target instanceof _i){const c=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return qw(o||c?await MK(t,r,r.target.center,s,i,n):await u1t(t,r,r.target,s,i,n))}const a=new m1t,l=o?s1t(t,r):void 0;if(await MFe(t,r.target,l,a,i),isFinite(a.boundingBox[0])){let c;if(kre(a.boundingBox,Is),qu.x=Is[0],qu.y=Is[1],qu.z=Is[2],qu.spatialReference=t.spatialReference,isFinite(qu.z)&&a.hasZ?c=OAe(a.boundingBox):(qu.z=void 0,c=R8e(MAe(a.boundingBox,g1t))),o||c)return qw(await MK(t,r,qu,s,i,n));const h=f1t(t,a.screenSpaceObjects);return qw(await d1t(t,r,qu,a.boundingBox,h,s,i,n))}return r.position?qw(await l1t(t,r,s,n,i)):qw(await c1t(t,r,s,i,n))}function Joe(t,e){return e.scale==null&&e.zoom!=null?CNe(t,e.zoom):e.scale}function s1t(t,e){const i=Joe(t,e);return i?wct(i):void 0}function N6(t,e){let i=!1;return e.heading!=null?(t.heading=e.heading,i=!0):e.rotation!=null&&(t.heading=SFe(e.rotation),i=!0),e.tilt!=null&&(t.tilt=e.tilt,i=!0),e.fov!=null&&(t.fov=e.fov),i}function Xoe(t,e,i,r){const s=t.spatialReference||Oe.WGS84;if(e??(e=Sm(t,i)),e==null)return r;const n=new Fe({spatialReference:s});return dT(e.center,t.renderSpatialReference,n)&&(r.targetGeometry=n,r.scale=LS(t,e.distance),r.rotation=L6(i.heading),r.camera=i),r}async function tV(t,e,i,r){var d;const s=()=>new U("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw s();e.type==="mesh"&&(e=e.extent);const n=t.basemapTerrain.spatialReference;if(!e.hasZ&&t.basemapTerrain){let f;switch(e.type){case"point":f=e;break;case"multipoint":case"polyline":f=(d=e.extent)==null?void 0:d.center;break;case"extent":f=e.center;break;case"polygon":f=e.centroid}f!=null&&n&&t.elevationProvider?(f=await Bb(f,n,{signal:r}),Is[2]=Pm(t.elevationProvider,f)??0):Is[2]=0}const o=y1t[e.type],a=new Array;if(o(e,e.hasZ?f=>{a.push([f[0],f[1],f[2]])}:f=>{a.push([f[0],f[1]])},Is),a.length===0)throw s();const l=e.spatialReference,c=t.spatialReference,h=await Bb(new WS({spatialReference:l,hasZ:e.hasZ,hasM:!1,points:a}),c,{signal:r});if(e.hasZ&&(i.hasZ=!0),e.hasZ)for(const[f,m,g]of h.points)Is[0]=f,Is[1]=m,Is[2]=g,C3(i.boundingBox,Is);else for(const[f,m]of h.points)Is[0]=f,Is[1]=m,C3(i.boundingBox,Is)}async function n1t(t,e,i,r,s){const n=await ff(t.whenViewForGraphic(e));if(n.ok===!1||n.value==null||!("whenGraphicBounds"in n.value))return void await tV(t,e.geometry,r,s);const o=n.value,a=await ff(o.whenGraphicBounds(e,{minDemResolution:i}));if(a.ok===!1||!a.value)return void await tV(t,e.geometry,r,s);const{screenSpaceObjects:l,boundingBox:c}=a.value;CAe(r.boundingBox,c),l&&l.forEach(h=>{r.screenSpaceObjects.push(h)}),isFinite(c[2])&&(r.hasZ=!0)}async function MFe(t,e,i,r,s){var n;if(Array.isArray(e)&&e.length===2){const o=e[0],a=e[1];if(typeof o=="number"&&typeof a=="number")return qu.x=o,qu.y=a,qu.z=void 0,qu.spatialReference=(n=t.spatialReference)!=null&&n.isGeographic?t.spatialReference:Oe.WGS84,void await tV(t,qu,r,s)}e&&"map"in e&&typeof e.map=="function"?await Promise.allSettled(e.map(o=>MFe(t,o,i,r,s))):e instanceof mg?await tV(t,e,r,s):e instanceof Pl&&await n1t(t,e,i,r,s)}async function o1t(t,e,i,r,s){if(e.camera)return OFe(t,e.camera,r,s);s.scale=e.scale,s.rotation=e.rotation,s.targetGeometry=e.targetGeometry!=null?e.targetGeometry.clone():null,s.camera=null,i.heading!=null?s.rotation=L6(i.heading):i.rotation!=null&&(s.rotation=i.rotation);const n=Joe(t,i);return n!=null&&(s.scale=n),s.camera=await EFe(t,s,i.tilt,r),s}async function OFe(t,e,i,r){const s=t.spatialReference,n=await Bb(e.position,s,{signal:i}),o=e.clone();return o.position=n,Xoe(t,null,o,r)}async function a1t(t,e,i,r,s,n,o){const a=t.renderSpatialReference;return await mB(e,s9,a,0,{signal:o}),await mB(i,WF,a,0,{signal:o}),n.targetGeometry=new Fe(e),s.position=new Fe(i),be(iV,s9,WF),PL(t,WF,iV,r.up,s),n.scale=LS(t,Sr(WF,s9)),n.rotation=L6(s.heading),n.camera=s,n}async function MK(t,e,i,r,s,n){n.targetGeometry=i.clone();const o=pT(t);if(e.position)return a1t(t,n.targetGeometry,e.position,o,r,n,s);if(e.zoomFactor){const l=o.distance/e.zoomFactor,c=re(Is,o.viewForward,-l);o.eye=oe(Is,o.center,c),n.scale=LS(t,l)}TA(t,o,r);const a=N6(r,e)?So.LOCKED:So.ADJUST;if(!e.zoomFactor){const l=Joe(t,e);if(l==null){await mB(n.targetGeometry,Is,t.renderSpatialReference,0,{signal:s});const c=pC(o.frustum,Is)?Sr(o.eye,Is):o.distance;n.camera=await I6(t,n.targetGeometry,c,r,a),n.scale=LS(t,c)}else n.scale=l,n.camera=await w_t(t,n.targetGeometry,n.scale,r,a,s)}return n}async function l1t(t,e,i,r,s){const n=pT(t);ne(iV,n.viewForward),PL(t,n.eye,iV,n.up,n9);const o=t.spatialReference,{position:a}=e;if(a){const l=await Bb(a,o,{signal:s});i.position=l}else i.position=new Fe;return i.heading=e.heading!=null?e.heading:n9.heading,i.tilt=e.tilt!=null?e.tilt:n9.tilt,Xoe(t,null,i,r)}async function c1t(t,e,i,r,s){if(e.heading!=null||e.rotation!=null||e.scale!=null||e.tilt!=null||e.zoom!=null||e.zoomFactor!=null){const n=pT(t),{spatialReference:o,renderSpatialReference:a}=t,l=new Fe({spatialReference:o});return dT(n.center,a,l)?MK(t,e,l,i,r,s):s}return s.scale=t.scale,s.camera=t.camera.clone(),N6(s.camera,e),s}async function u1t(t,e,i,r,s,n){n.targetGeometry=i.clone();const o=pT(t);TA(t,o,r);const a=N6(r,e)?So.LOCKED:So.ADJUST;return n.camera=await xNe(t,i,r.heading,r.tilt,a,s),n}function h1t(t,e,i,r,s){let n=0;i.z!=null?n=i.z:t.basemapTerrain&&t.elevationProvider&&(n=Pm(t.elevationProvider,i)),se(Is,i.x,i.y,n),cT(t.spatialReference,Is,uye,t.renderSpatialReference),sT(qF,uye),uM(qF,qF),bf(_O);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let g=0;g<o.length;g++){const v=o[g];let _=r[v[2]];isFinite(_)||(_=n),se(Is,r[v[0]],r[v[1]],_),vc(Is,t.spatialReference,Is,t.renderSpatialReference),C3(_O,uc(Is,Is,qF))}const a=KS(_O),l=ow(_O),c=QS(_O),h=1/Math.tan(e.fovX/2),d=1/Math.tan(e.fovY/2),f=.5*Math.sqrt(a*a+c*c)*Math.max(d,h)+.5*l,m=.5*l*d+.5*Math.max(a,c);return Math.max(f,m)/s}async function d1t(t,e,i,r,s,n,o,a){a.targetGeometry=i.clone();const l=pT(t),c=h1t(t,l,i,r,s);TA(t,l,n);const h=N6(n,e)?So.LOCKED:So.ADJUST;return a.camera=await I6(t,a.targetGeometry,c,n,h,o),a.scale=LS(t,c),a}function p1t(t,e){if(!e||!t.spatialReference)return null;const i={target:void 0};return"declaredClass"in e||Array.isArray(e)?i.target=e:(Object.assign(i,e),!i.target&&"center"in e&&e.center&&(i.target=e.center)),i}function qw(t){return(t==null?void 0:t.camera)!=null&&(t.rotation=L6(t.camera.heading)),t}function f1t(t,e){const i=Qwt;if(!e.length)return i;let r=Number.NEGATIVE_INFINITY;for(let s=0;s<e.length;s++){const n=e[s].screenSpaceBoundingRect;r=Math.max(r,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return i-r/Math.min(t.width,t.height)*2}class m1t{constructor(){this.hasZ=!1,this.boundingBox=bf(),this.screenSpaceObjects=new Array}}const Is=$(),uye=qe(),qF=Ts(),_O=fh(),g1t=si(),iV=$(),WF=$(),s9=$(),n9={heading:0,tilt:0},qu=new Fe,y1t={point(t,e,i){i[0]=t.x,i[1]=t.y,t.z!=null&&(i[2]=t.z),e(i)},polygon(t,e,i){const r=t.hasZ;for(let s=0;s<t.rings.length;s++){const n=t.rings[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),e(i)}},polyline(t,e,i){const r=t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),e(i)}},multipoint(t,e,i){const r=t.points,s=t.hasZ;for(let n=0;n<r.length;n++)i[0]=r[n][0],i[1]=r[n][1],s&&(i[2]=r[n][2]),e(i)},extent(t,e,i){t.zmin!=null&&t.zmax!=null?(e(se(i,t.xmin,t.ymin,t.zmin)),e(se(i,t.xmax,t.ymin,t.zmin)),e(se(i,t.xmin,t.ymax,t.zmin)),e(se(i,t.xmax,t.ymax,t.zmin)),e(se(i,t.xmin,t.ymin,t.zmax)),e(se(i,t.xmax,t.ymin,t.zmax)),e(se(i,t.xmin,t.ymax,t.zmax)),e(se(i,t.xmax,t.ymax,t.zmax))):(e(se(i,t.xmin,t.ymin,i[2])),e(se(i,t.xmax,t.ymin,i[2])),e(se(i,t.xmin,t.ymax,i[2])),e(se(i,t.xmax,t.ymax,i[2])))}},v1t=Object.freeze(Object.defineProperty({__proto__:null,create:AFe,fromCamera:$Fe,toCameraAsync:EFe,toCameraSync:TFe},Symbol.toStringTag,{value:"Module"}));let _1t=class{constructor(e,i,r){this._target=e,this._options=i,this.view=r,this.state="pending",this._animationController=null,this.promise=new Promise((s,n)=>{this._resolveCallback=s,this._rejectCallback=n;const o=new AbortController;this._options.signal!=null&&Qo(this._options.signal,()=>this.abort()),this._abortController=o,this._waitForReady()})}_resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}_reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.running&&this._animationController.stopController(),this._reject(bi())}async _waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await Id(()=>this.view.ready,this._abortController.signal)}catch(e){return this._reject(e)}this._createViewPoint()}async _createViewPoint(){if(this.state!=="finished"){this.state="wait-for-viewpoint",this._animationController=this._options.animate?this._getAnimationController():null;try{const e=await AFe(this.view,this._target,this._abortController.signal);if(this.state==="finished")return;const i=e?this._getCameraFromViewpoint(e):null;if(i==null)return;if(this._options.animate){if(this._animationController==null)return;this._startAnimation(i,this._animationController)}else this.view.stateManager.setStateCamera(i.camera,{applyConstraints:!i.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this._resolve()}catch(e){this._reject(e)}}}_getCameraFromViewpoint(e){var n;const i=!!(this._target instanceof Qr&&this._target.camera||this._target instanceof ou),r=e.camera;if(r==null)return null;if(!this.view.stateManager.isCompatible(r)){const o=r.position,a=o&&o.spatialReference,l=a?a.wkid:"none",c=(n=this.view.spatialReference)==null?void 0:n.wkid;return this._reject(new U("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${l}, view: ${c})`,{camera:r})),null}const s=Sm(this.view,r);return s==null?(this._reject(new U("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:s,isFullySpecified:i}}_startAnimation(e,i){this.state="wait-for-animation-finish";const r=i.viewAnimation;if(r==null)return void this._reject(new U("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(e.viewpoint,"running"),!i.running||i.viewAnimation==null||i.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==i)return this.abort();let s;e.isFullySpecified?(s=new xP({view:this.view,desiredCamera:e.camera}),_M(this.view,e.camera,Sd.EYE_AND_CENTER)):Ps(this.view,e.camera),i.begin(e.camera,this._options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.running?Wge(a)&&a.viewAnimation!=null&&a.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=s):i.viewAnimation!=null&&i.viewAnimation.target===e.viewpoint&&i.state===Hr.Finished&&(this.view.state.cameraController=s))},o=a=>{if(this.view.state!=null)switch(i.state){case Hr.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._resolve()}break;case Hr.Ready:case Hr.Rejected:case Hr.Running:case Hr.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._reject(a)}}};r.when(n,a=>o(a)),i.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let e=null,i=null;const r=this.view.state.cameraController;return Wge(r)&&(r.updateStateFromViewAnimation(),r.running&&(e=r,i=e.viewAnimation)),e==null&&(e=new Lx({view:this.view,mode:"animation"}),i=e.viewAnimation,this.view.state.switchCameraController(e),e.state===Hr.Rejected)?(i==null||i.stop(),this._reject(new U("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null):e}};var Hs;function hye(t=!X("disable-feature:high-quality-idle"),e=null){const i=new Ov;return t?(i.set(ui.IDLE,Hs.Antialiasing,e!=="low"),i.set(ui.IDLE,Hs.HighResolutionAtmosphere,e!=="low"),i.set(ui.IDLE,Hs.HighQualityTransparency,!0),i.set(ui.IDLE,Hs.SSAO,!0),i.set(ui.IDLE,Hs.WaterReflection,!0),i.set(ui.IDLE,Hs.PhysicalPixelRendering,!0)):(i.set(ui.ANIMATING,Hs.HighResolutionShadows,!0),i.set(ui.ANIMATING,Hs.HighResolutionViewshed,!0),i.set(ui.INTERACTING,Hs.HighResolutionShadows,!0),i.set(ui.INTERACTING,Hs.HighResolutionViewshed,!0)),i.set(ui.IDLE,Hs.HighResolutionShadows,!0),i.set(ui.IDLE,Hs.HighResolutionViewshed,!0),i.set(ui.IDLE,Hs.HighResolutionVoxel,!0),i}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighResolutionVoxel=2]="HighResolutionVoxel",t[t.HighResolutionAtmosphere=3]="HighResolutionAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.HighResolutionShadows=6]="HighResolutionShadows",t[t.HighResolutionViewshed=7]="HighResolutionViewshed",t[t.PhysicalPixelRendering=8]="PhysicalPixelRendering"})(Hs||(Hs={}));let Us=class extends he{constructor(e){super(e),this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._idleTimeout=dye,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:i=>this._devicePixelRatioOverride=i,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},get updatingIgnoreRenderState(){return this.renderState!=null},get idleTimeoutEnabled(){return this.viewStateManager._idleTimeout>0},set idleTimeoutEnabled(i){this.viewStateManager._idleTimeout=i?dye:0}},this._propertiesPool=new _v({frustum:HB},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new b1t}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([so(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),H(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},(e,i)=>this._cameraChangedHandler(e,i),Yt)]),bn(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([tg({prepare:()=>this._prepareFrame()}),H(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(YF)}),so(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=$e(this._propertiesPool)}get camera(){const e=this._get("camera");if(!this.ready)return e;const i=TA(this.view,this.view.state.camera,o9);return i&&e&&i.equals(e)?e:i.clone()}set camera(e){var i,r;this._updatePropertyBeforeReady("camera",e)||((i=this.view.elevationProvider)==null||i.enableCache(!0),this.setStateCamera(Sm(this.view,e),{applyConstraints:!1})||J.getLogger(this).error("#camera=","Invalid camera",e),(r=this.view.elevationProvider)==null||r.enableCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const i=TA(this.view,this.view.state.contentCamera,o9);return i&&e&&i.equals(e)?e:i.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const i=Sm(this.view,e);i!=null?(this._updateElevation(i),this.view.state.contentCamera=i):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(a9),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const i=this.zoom,r=this.view.state.camera.distance**2,s=H$(this.view.state.camera.center),n=e.sticky?this.contentCamera.clone():null;return this.addHandles([H(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(a9),this.test.contentCameraResetState.clear())}),H(()=>this.zoom,o=>{o!==void 0&&i!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(o-i)/2),Math.abs(o-i)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n))}),H(()=>this.view.state.camera,o=>{const a=no(s,o.center);this.test.contentCameraResetState.set("camera.center",a/r),a>r?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)})],a9),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){var i;this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():J.getLogger(this).error("#center=","Invalid center",e):J.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((i=this.view.spatialReference)==null?void 0:i.wkid)+")",e):J.getLogger(this).error("#center=","Center may not be null or undefined"))}get visibleArea(){if(!this.ready){const e=this._get("extent");return e?Ea.fromExtent(e):null}return C_t(this.view,this.view.pointsOfInterest.focus.renderLocation)}get extent(){if(!this.ready)return this._get("extent");const e=this.view,i=SNe(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return i??this._get("extent")}set extent(e){var i;this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||J.getLogger(this).error("#extent=","Invalid extent",e):J.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((i=this.view.spatialReference)==null?void 0:i.wkid)+")",e):J.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get constraintsManager(){return this._constraintsManager}get _initialViewpoint(){var i;const e=this.view.map;return e&&"initialViewProperties"in e?(i=e.initialViewProperties)==null?void 0:i.viewpoint:void 0}get hasInitialView(){return!!this._initialViewpoint}get scale(){if(!this.ready)return this._get("scale");const e=this.view.basemapTerrain.tilingScheme,i=this.view.pointsOfInterest.cameraOnSurface.scale;return e&&i?uNe(this.view,i,this.view.state.contentCamera,e):this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||J.getLogger(this).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,i=e.padding,r=e.pixelRatio,s=this._get("padding"),n=Math.round(i[ai.TOP]/r),o=Math.round(i[ai.RIGHT]/r),a=Math.round(i[ai.BOTTOM]/r),l=Math.round(i[ai.LEFT]/r);return s!=null&&s.top===n&&s.right===o&&s.bottom===a&&s.left===l?s:{top:n,right:o,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,ZF),this.view.state.updateCamera(i=>i.padding=ZF))}_paddingToArray(e,i,r){e?ss(r,e.top||0,e.right||0,e.bottom||0,e.left||0):ss(r,0,0,0,0);for(let s=0;s<4;s++)r[s]=Math.round(r[s]*i)}get screenCenter(){const e=this.padding;return xo((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?$Fe(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){var i;if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||J.getLogger(this).error("#viewpoint=","Invalid viewpoint",e);else{const r=e.camera!=null?e.camera.position:e.targetGeometry,s=r!=null&&r.spatialReference;J.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(s?s.wkid:"none")+", view: "+((i=this.view.spatialReference)==null?void 0:i.wkid)+")",e)}else J.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?I_t(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||J.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){var s;if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),i=(this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e)*this.view.resolutionScale;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*i),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*i);const r=(s=this.view._stage.renderView.renderingContext)==null?void 0:s.parameters.maxTextureSize;return r&&Px(this._tmpCanvasSize,r),this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth*.5+this._tmpCanvasSize.height/this.view.surface.clientHeight*.5:i,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){var e,i;return((i=(e=this.view)==null?void 0:e._stage)==null?void 0:i.renderer.isFeatureEnabled(Hs.PhysicalPixelRendering))??!1}get _usePhysicalPixelRenderingAny(){var i,r;const e=(r=(i=this.view)==null?void 0:i._stage)==null?void 0:r.renderer;return e&&(e.isFeatureEnabled(Hs.PhysicalPixelRendering,ui.IDLE)||e.isFeatureEnabled(Hs.PhysicalPixelRendering,ui.INTERACTING)||e.isFeatureEnabled(Hs.PhysicalPixelRendering,ui.ANIMATING))}preinit(e){var i,r,s;return!(this._isOverridden("center")&&!V_(this.center.spatialReference,e))&&!(this._isOverridden("camera")&&!V_(this.camera.position.spatialReference,e))&&!(this._isOverridden("extent")&&!V_(this.extent.spatialReference,e))&&!!(!this._isOverridden("viewpoint")||V_((i=this.viewpoint.targetGeometry)==null?void 0:i.spatialReference,e)&&V_((s=(r=this.viewpoint.camera)==null?void 0:r.position)==null?void 0:s.spatialReference,e))}init(){this._constraintsManager=new iR({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const i of e)this.set(i.name,i.value);if(!this._cameraSetByUser){const i=this._initialViewpoint||this.view.initialExtent;i&&this.isCompatible(i)?this._setInitialView(i):this.view.state.viewingMode===je.Local&&this.addHandles(bn(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(YF),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),YF)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(YF),this._constraintsManager=$e(this._constraintsManager))}async goTo(e,i){return i={animate:!0,...i},this._gotoOperation!=null&&this._gotoOperation.abort(i.animate),this._gotoOperation=new _1t(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation.promise}debugSetCameraOnContent(){this.setStateCamera(pT(this.view),{applyConstraints:!1})}step(e){const i=this.view.state,r=i==null?void 0:i.cameraController;r&&(i.updateCamera(s=>r.stepController(e,s)),r.steppingFinished&&r.finishController())}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,i=[];for(const{propertyName:r,overrides:s}of x1t){const n=e.has(r),o=this._isOverridden(r);!n&&o&&i.push({name:r,value:this._get(r)}),this._clearOverride(r),(n||o)&&s.forEach(a=>e.add(a))}return i}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof ou)return void this.setStateCamera(Sm(this.view,e),{applyConstraints:!1});if(e instanceof Qr){if(e.targetGeometry instanceof _i){const n=O5(this.view,e.targetGeometry,0,.5,So.LOCKED);return void(n!=null&&this.setStateCamera(Sm(this.view,n),{applyConstraints:!0}))}const r={applyConstraints:!e.camera},s=this._viewpointToCamera(e);return void this.setStateCamera(s,r)}const i=O5(this.view,e,0,.5,So.LOCKED);i!=null&&this.setStateCamera(Sm(this.view,i),{applyConstraints:!0})}_updatePropertyBeforeReady(e,i){return!this.ready&&(this._override(e,i),i&&w1t.has(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof Qr?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof ou?this.isCompatible(e.position):e.spatialReference&&!bCe(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=S1t){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,i,r=M0){const{heading:s,tilt:n}=this._getPreservingHeadingTilt(),o=Z3(this.view,s,n,e,i,So.ADJUST);return o==null?null:(r.copyFrom(this.view.state.camera),r.eye=o.eye,r.center=o.center,r.up=o.up,r)}_centerToCamera(e){let i;if(e.hasZ)i=this.view.state.camera.distance;else{const{centerOnContent:r}=this.view.pointsOfInterest;r.runTask(),i=r.distance}return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:i,tilt:r}=this._getPreservingHeadingTilt(),s=O5(this.view,e,i,r,So.ADJUST,o9);return s?Sm(this.view,s):null}_scaleToCamera(e){if(e==null)return null;const i=this.view,r=i.pointsOfInterest.centerOnContent;r.runTask();const s=r.renderLocation,n=i.pointsOfInterest.cameraOnSurface.renderLocation,o=b_t(i,e,i.state.contentCamera,s,n);return this._centerPointAtDistanceToCamera(s,o)}_zoomToCamera(e){return this._scaleToCamera(CNe(this.view,e))}_viewpointToCamera(e){return Sm(this.view,TFe(this.view,e))}setStateCamera(e,i){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,i.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(r=>{i.positionAndOrientationOnly?(r.eye=e.eye,r.center=e.center,r.up=e.up,r.fov=e.fov):r.copyFrom(e),i.applyConstraints&&Ps(this.view,r)}),i.applyConstraints||(this.view.state.cameraController=new xP({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:i}=this.view;if(!e||!i)return;this._windowDevicePixelRatio=window.devicePixelRatio;const r=this._computeCanvasSize();if(r.width!==0&&r.height!==0&&(i.width===r.width&&i.height===r.height||(i.width=r.width,i.height=r.height),this.view.state)){const s=this.view.state.camera;s.fullWidth===r.width&&s.fullHeight===r.height&&s.pixelRatio===r.pixelRatio||(M0.copyFrom(s),M0.pixelRatio!==r.pixelRatio&&(this._paddingToArray(this.padding,r.pixelRatio,ZF),M0.padding=ZF),M0.fullWidth=r.width,M0.fullHeight=r.height,M0.pixelRatio=r.pixelRatio,this.view.state.camera=M0),this._updateViewState()}}_updateElevation(e){var n,o;const i=(n=this.view.basemapTerrain)==null?void 0:n.spatialReference,r=((o=this.view.renderCoordsHelper)==null?void 0:o.getAltitude(e.eye))??0,s=i?O6(this.view,e.eye):0;e.relativeElevation=r-s}_updateViewState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=ui.ANIMATING:this.view.interacting?this.view.state.mode=ui.INTERACTING:(this.view.state.mode===ui.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<this._idleTimeout?this.view.state.mode=ui.INTERACTING:this.view.state.mode=ui.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,i){e&&i&&e.almostEquals(i)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};u([p({type:ou,dependsOn:["view.state.camera","ready"]})],Us.prototype,"camera",null),u([p({type:ou,dependsOn:["view.state.contentCamera","ready"]})],Us.prototype,"contentCamera",null),u([p({type:Fe})],Us.prototype,"center",null),u([p()],Us.prototype,"visibleArea",null),u([p({type:_i})],Us.prototype,"extent",null),u([p({readOnly:!0})],Us.prototype,"frustum",null),u([p()],Us.prototype,"_constraintsManager",void 0),u([p({readOnly:!0})],Us.prototype,"constraintsManager",null),u([p()],Us.prototype,"_initialViewpoint",null),u([p({readOnly:!0})],Us.prototype,"hasInitialView",null),u([p({readOnly:!0,type:Boolean})],Us.prototype,"ready",void 0),u([p({type:Number})],Us.prototype,"scale",null),u([p()],Us.prototype,"padding",null),u([p({readOnly:!0})],Us.prototype,"screenCenter",null),u([p({constructOnly:!0})],Us.prototype,"view",void 0),u([p({type:Qr})],Us.prototype,"viewpoint",null),u([p({type:Number})],Us.prototype,"zoom",null),u([p({readOnly:!0})],Us.prototype,"_rasterPixelRatio",null),u([p({readOnly:!0})],Us.prototype,"_usePhysicalPixelRendering",null),u([p({readOnly:!0})],Us.prototype,"_usePhysicalPixelRenderingAny",null),u([p()],Us.prototype,"_windowDevicePixelRatio",void 0),u([p()],Us.prototype,"_devicePixelRatioOverride",void 0),Us=u([A("esri.views.3d.state.ViewStateManager")],Us);let b1t=class{constructor(){this.width=0,this.height=0,this.pixelRatio=1}};const w1t=new Set(["camera","viewpoint","extent","scale","center","zoom"]),x1t=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],S1t={heading:0,tilt:0},o9=new ou,M0=new qr,ZF=yi(),YF="pending-initial-view",a9="content-camera-reset",dye=300,pye=100;let ef=class extends jy{constructor(){super(...arguments),this.startCamera=new qr,this.currentCamera=new qr,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<pye}stepController(e,i){i.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(i)}onControllerStart(e){this.state=Hr.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),pye),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};u([p({readOnly:!0})],ef.prototype,"isInteractive",null),u([p()],ef.prototype,"_lastInteraction",void 0),ef=u([A("esri.views.3d.state.controllers.InteractiveController")],ef);var jc;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})(jc||(jc={}));let SP=class extends ef{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=jc.CENTER,this._rotScale=0,this._lastPoint=Ye(),this._tmpWorldUp=$(),this._tmpViewDir=$(),this._tmpRotCurPoint=Ye(),this._tmpTransf=qe(),this._tmpAxis=$(),this._tmpPivotPoint=$(),this._pivotPos=$(),this._constraintOptions=new gh(Fr.ALL,ri.TUMBLE,0,this.startCamera)}initialize(){this._rotScale=this.pivot===jc.CENTER?3:1.5}begin(e){if(this.running){switch(this.pivot){case jc.EYE:ne(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=ri.LOOK_AROUND,this._constraintOptions.tiltMode=ug.LOOK_AROUND,this._constraintOptions.selection=Fr.NONE;break;case jc.CENTER:{const i=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?mT:{});i||ne(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,i),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=ri.TUMBLE,this._constraintOptions.tiltMode=ug.TUMBLE,this._constraintOptions.selection=Fr.ALL&~Fr.DISTANCE;break}}sS(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,i){const r=this.startCamera,s=$();be(s,this._pivotPos,r.eye);const n=Ee(s),o=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(r.eye,fye);let a=Math.max(Math.min(Mwt,1/Math.abs(fe(fye,r.viewForward)))*o,Owt);i&&(a=Math.min(n,a));const l=ln(r.width/r.pixelRatio*.5,r.height/r.pixelRatio*.5),c=NL(this.startCamera,l,this.view.renderCoordsHelper,this.view.viewingMode);let h=this.view._stage.renderView.getMinimalDepthForArea(eD(this.view),r.fullWidth/r.pixelRatio*.5,r.fullHeight/r.pixelRatio*.5,r,2.5*Xq,Xq),d=this.view._stage.renderView.getMinimalDepthForArea(eD(this.view),e[0],e[1],r,Xq);h==null&&d==null||(h=h??d??0,d=d==null||c===ba.Horizontal?h:d,a=h>d?d:h,a=i?Math.min(a,n):a),ae(s,s),ne(this._pivotPos,oe(this._tmpPivotPoint,r.eye,re(this._tmpPivotPoint,s,a)))}update(e){if(this.running){switch(this.pivot){case jc.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case jc.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}Ps(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.running&&this.finishController()}_applyRotation(e,i,r,s){this.view.renderCoordsHelper.worldUpAtPosition(s,this._tmpWorldUp),sS(e,i,this._tmpRotCurPoint);let n=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,o=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;be(this._tmpViewDir,r,s);const a=Ee(this._tmpViewDir),l=Ja(fe(this._tmpViewDir,this._tmpWorldUp)/a);if(this.pivot===jc.EYE){n*=-.5;const c=.5*Math.PI-l,h=.5*Math.PI*.99;n=c-Math.max(-h,Math.min(h,c+n))}return n=ue(n+l,ma.min,ma.max)-l,ct(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===jc.CENTER&&(o=-o),Pd(this._tmpTransf,o,this._tmpWorldUp),Ku(this._tmpTransf,this._tmpTransf,n,this._tmpAxis),ot(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=ot(l9,e.up,this._tmpTransf),oe(l9,s,this._tmpViewDir),Vn(this._lastPoint,this._tmpRotCurPoint),l9}};u([p()],SP.prototype,"pivot",void 0),SP=u([A("esri.views.3d.state.controllers.RotateController")],SP);const l9=$(),fye=$();let c9=class extends ls{constructor(e,i,r,s){super(!0),this._view=e,this.pointerActions=i,this._pivot=r,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(e){const i=e.data;if(i.pointers.size>1||!lse(e.data,this.pointerActions))return;const r=ln(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new SP({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};var tD;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(tD||(tD={}));function T1t(t,e){return{type:mS(e),value:t,unit:e}}function Dri(t){return{value:t}}function E1t(t,e){return{type:mS(e),value:t,unit:e}}function C1t(t,e){return{type:mS(e),value:t,unit:e}}function F6(t,e,i="arithmetic"){return{type:mS(e),value:t,unit:e,rotationType:i}}function Lri(t,e){const i=$1t(t,e);return t.type==="angle"?F6(i,e,t.rotationType):T1t(i,e)}function $1t(t,e){return mr(t.value,t.unit,e)}function Nri(t,e){return t==null?e:e==null||t.value>mr(e.value,e.unit,t.unit)?t:e}function Fri(t,e){return t==null?null:{...t,value:t.value*e}}function A1t(t,e,i){if(e===i)return t;switch(i){case"arithmetic":case"geographic":return 90-t}}const kri=E1t(0,"meters"),zri=C1t(0,"square-meters");F6(0,"radians");const Uri=F6(0,"degrees"),Bri=F6(0,"degrees","geographic");function IFe(t,e,i){return t.units[e][i]}function gT(t,e,i,r=2,s="abbr"){return`${JD(e,{minimumFractionDigits:r,maximumFractionDigits:r,signDisplay:e>0?"never":"exceptZero"})} ${IFe(t,i,s)}`}function k6(t,e,i,r=2,s="abbr"){return`${JD(e,{minimumFractionDigits:r,maximumFractionDigits:r,signDisplay:"exceptZero"})} ${IFe(t,i,s)}`}function Vri(t,e,i,r=2,s="abbr"){const n=Mie(e,i);return gT(t,mr(e,i,n),n,r,s)}function jri(t,e,i,r=2,s="abbr"){const n=Mie(e,i);return k6(t,mr(e,i,n),n,r,s)}function Gri(t,e,i,r=2,s="abbr"){const n=Oie(e,i);return gT(t,mr(e,i,n),n,r,s)}function Hri(t,e,i,r=2,s="abbr"){const n=Oie(e,i);return k6(t,mr(e,i,n),n,r,s)}function qri(t,e,i,r=2,s="abbr"){const n=Iie(e,i);return gT(t,mr(e,i,n),n,r,s)}function Wri(t,e,i,r=2,s="abbr"){const n=Iie(e,i);return k6(t,mr(e,i,n),n,r,s)}function Zri(t,e,i,r=2,s="abbr"){const n=Rie(e,i);return gT(t,mr(e,i,n),n,r,s)}function Yri(t,e,i,r=2,s="abbr"){const n=Rie(e,i);return k6(t,mr(e,i,n),n,r,s)}function Jri(t,e,i,r=2,s="abbr"){const n=iEe(e,i);return gT(t,mr(e,i,n),n,r,s)}function Xri(t,e,i,r=2,s="abbr"){const n=rEe(e,i);return gT(t,mr(e,i,n),n,r,s)}const M1t=(t,e)=>({style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:e,minimumFractionDigits:e,signDisplay:t>0?"never":"exceptZero"});function O1t(t,e,i,r,s,n=Bj,o=!0){let a=n.normalize(A1t(mr(t,e,"degrees"),i,r),0,o);const l=M1t(a,s??2);return a=I1t(a,l),JD(a,l)}const mye=new Map;function I1t(t,e){const i=JSON.stringify(e);let r=mye.get(i);return r||(r=new Intl.NumberFormat("en-US",e),mye.set(i,r)),/^[-+]?360\.?0*?$/.test(r.format(t))?0:t}const gye=["B","kB","MB","GB","TB"];function Kri(t,e){let i=(e=Math.round(e))===0?0:Math.floor(Math.log(e)/Math.log(tD.KILOBYTES));i=ue(i,0,gye.length-1);const r=JD(e/tD.KILOBYTES**i,{maximumFractionDigits:2});return PD(t.units.bytes[gye[i]],{fileSize:r})}const JF="esri-fov-overlay",XF={base:JF,outer:`${JF}-outer`,reset:`${JF}-reset`,text:`${JF}-text`};let dy=class extends oT{constructor(e){super(e),this.onReset=()=>{},this._messagesCommon=null,this._messagesUnits=null,this.fov=null}render(){return ei("div",{class:XF.outer},ei("div",{class:XF.base},ei("p",{class:XF.text},this._overlay),ei("p",{class:XF.reset,onclick:this.onReset,title:this._messagesCommon.reset},this._reset)))}get _overlay(){const{fov:e,_messagesUnits:i}=this;if(!i||e==null)return"";const r=O1t(Ao(e),"degrees","arithmetic","arithmetic",0),s=R1t/(2*Math.tan(e/2));return`${r} | ${gT(i,s,"millimeters",0,"abbr")} |`}get _reset(){return this._messagesUnits&&this.fov!=null?"":""}};u([p()],dy.prototype,"onReset",void 0),u([p(),Ev("esri/t9n/common")],dy.prototype,"_messagesCommon",void 0),u([p(),Ev("esri/core/t9n/Units")],dy.prototype,"_messagesUnits",void 0),u([p()],dy.prototype,"fov",void 0),u([p()],dy.prototype,"_overlay",null),u([p()],dy.prototype,"_reset",null),dy=u([A("esri.widgets.FovOverlay")],dy);const R1t=Math.sqrt(1872);let a$=class extends ef{constructor(e){super(e),this.onStop=null,this._timeOutId=void 0,this._onReset=()=>{this._startSize=this._lastDrag=null,this._setFov(P1t),this.updateTimeout()},this._center=$(),this._viewForward=$(),this._constraints=new gh(Fr.ALL,ri.ZOOM)}begin(e){N1t(e)?this._showOverlay().fov=e.fov:(this._lastDrag=e[1],this._startSize=null,this._ensureStartSize(this.view.state.camera))}updateTimeout(){clearTimeout(this._timeOutId),this._timeOutId=setTimeout(this.onStop,1500)}update(e){if(this._lastDrag==null)return this._lastDrag=e[1],this._startSize=null,void this._ensureStartSize(this.view.state.camera);const i=-(this._lastDrag-e[1])/2;this._lastDrag=e[1],this.step(i)}step(e){if(!this.running)return void(this._startSize=this._lastDrag=null);const i=this.view.state,r=this.currentCamera.copyFrom(i.camera),s=Ao(r.fov)+e,n=At(ue(s,D1t,L1t));n!==r.fov?this._setFov(n):this._showOverlay().fov=r.fov}finish(){this.running&&(this._startSize=this._lastDrag=null,this.finishController())}destroy(){this.hideOverlay()}onControllerEnd(e){super.onControllerEnd(e),this._startSize=this._lastDrag=null,this.hideOverlay()}_showOverlay(){return this._overlay||(this._overlay=new dP({id:"esri.FovOverlay",node:new dy({onReset:this._onReset})}),this.view.ui.add(this._overlay)),this._overlay.widget}hideOverlay(){this._overlay&&(this.view.ui.remove(this._overlay),this._overlay=$e(this._overlay))}_setFov(e){const i=this.view.state,r=this.currentCamera.copyFrom(i.camera),s=this._ensureStartSize(r)/Math.tan(e/2),n=oe(u9,this._center,re(u9,this._viewForward,-s));r.eye=n,r.fov=e,this._constraints.interactionStartCamera=i.camera,this._constraints.interactionFactor=ud(this.currentCamera.height-i.camera.height),Ps(this.view,this.currentCamera,this._constraints),this.begin(r),this.commitCamera()}_ensureStartSize(e){if(this._startSize==null){ne(this._viewForward,e.viewForward);const i=this.view._stage.renderView.getMinimalDepthForArea(null,e.fullWidth/e.pixelRatio*.5,e.fullHeight/e.pixelRatio*.5,e,LL),r=Sr(e.eye,this.view.pointsOfInterest.centerOnContent.renderLocation),s=i??r;oe(this._center,e.eye,re(u9,this._viewForward,s)),this._startSize=s*Math.tan(e.fov/2)}return this._startSize}};u([p()],a$.prototype,"onStop",void 0),a$=u([A("esri.views.3d.state.controllers.FovController")],a$);const P1t=At(new ou().fov),D1t=10,L1t=150,u9=$();function N1t(t){return!Array.isArray(t)}let OK=class extends ef{constructor(){super(...arguments),this._pickPoint=$(),this._tmpP0=Ye(),this._panAxisAngle=D6(),this._tmpRayDir=$(),this._tmpRayDirPick=$(),this._targetOnSphere=$(),this._navMode=ba.Horizontal,this._tmpRay={origin:$(),direction:$()},this.dragBeginPoint=ln(),this._normalizedAnchorPoint=Ye(),this._constraintOptions=new gh(Fr.ALL_EXCEPT_COLLISION,ri.ZOOM,0,this.startCamera),this._sphere=Ls(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.running)return;Vn(this.dragBeginPoint,e),sS(this.startCamera,e,this._normalizedAnchorPoint);const i=yr(this.view.spatialReference),r=fFe(this._intersectionHelper,this.startCamera,e,i,CA.Ellipsoid,this.view.map.ground.opacity===0?mT:{});if(this._navMode=NL(this.startCamera,e,this.view.renderCoordsHelper,this.view.viewingMode),this._navMode===ba.Horizontal)this._hasPickPoint=!!r.scenePickPoint,this._pickPoint=r.scenePickPoint??this._pickPoint,this._sphere=r.sphere;else{let s;bM(this.startCamera,e,this._tmpRay),ae(this._tmpRay.direction,this._tmpRay.direction),r.scenePickPoint!=null&&(be(this._tmpRayDirPick,this.startCamera.eye,r.scenePickPoint),s=Ee(this._tmpRayDirPick));const n=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,yye);let o=ue(Math.min(oFe,1/Math.abs(fe(yye,this._tmpRay.direction)))*n,YB[0],YB[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,LL);o=a??o,o=s!=null?Math.min(o,s):o,this._hasPickPoint=!0,re(this._tmpRay.direction,this._tmpRay.direction,o),oe(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}}update(e){if(this.running){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===ba.Horizontal){be(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const i=Ee(this._tmpRayDir);sS(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=i*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&s<n&&(s=n),Math.abs(i-s)<1e-6)return;if(this._hasPickPoint&&s<i){const o=1-(1-s/i)*(1-this._sphere[3]/Ee(this.currentCamera.center));this.currentCamera.center=re(KF,this.currentCamera.center,o)}re(this._tmpRayDir,this._tmpRayDir,-s/i),this.currentCamera.eye=oe(KF,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=ud(wv(this.dragBeginPoint,e)),Ps(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(Q3(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),Voe(this._pickPoint,this._targetOnSphere,this._panAxisAngle),Yb(this.currentCamera,this._sphere,this._panAxisAngle))}else{const i=Ee(this._tmpRay.direction);sS(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=i*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&s<n&&(s=n),Math.abs(i-s)<1e-6)return;re(this._tmpRayDir,this._tmpRay.direction,1-s/i),this.currentCamera.eye=oe(KF,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=oe(KF,this.currentCamera.center,this._tmpRayDir)}_M(this.view,this.currentCamera),this.commitCamera()}}finish(){this.running&&this.finishController()}};OK=u([A("esri.views.3d.state.controllers.ZoomControllerGlobal")],OK);const KF=$(),yye=$();let IK=class extends ef{constructor(){super(...arguments),this._tmpP=$(),this._tmpDir=$(),this._tmpN=$(),this._tmpP0=Ye(),this._tmpPoi=$(),this._tmpRayDir=$(),this.dragBeginPoint=ln(),this._normalizedAnchorPoint=Ye(),this._constraintOptions=new gh(Fr.ALL,ri.ZOOM,0,this.startCamera,$()),this._plane=Gr()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.running)return;Vn(this.dragBeginPoint,e),sS(this.startCamera,e,this._normalizedAnchorPoint);const i=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?mT:{});be(this._tmpDir,this._tmpP,this.startCamera.eye);const r=Ee(this._tmpDir);ae(this._tmpDir,this._tmpDir);const s=Math.abs(this.view.camera.position.z);let n=ue(Math.min(oFe,1/Math.abs(fe(F1t,this._tmpDir)))*s,YB[0],YB[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(eD(this.view),e[0],e[1],this.view.state.camera,LL);n=o??n,n=i?Math.min(n,r):n,re(this._tmpDir,this._tmpDir,n),oe(this._tmpP,this.startCamera.eye,this._tmpDir),be(this._tmpN,this.startCamera.eye,this.startCamera.center),ae(this._tmpN,this._tmpN),this._tmpN[1]<0&&Cd(this._tmpN,this._tmpN),dA(this._tmpP,this._tmpN,this._plane)}update(e){if(!this.running)return;Iwt(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||ne(this._tmpPoi,this.currentCamera.center),sS(this.currentCamera,e,this._tmpP0);let i=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);Vn(this._normalizedAnchorPoint,this._tmpP0),be(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const r=Ee(this._tmpRayDir);let s=r*(1-i);this._constraintOptions.interactionDirection&&(ne(this._constraintOptions.interactionDirection,this._tmpRayDir),re(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(i)/r));const n=this.view.state.constraints.minimumPoiDistance;i>=0&&s<n&&(s=n,i=-(s-r)/r),Math.abs(r-s)<1e-6||(re(this._tmpRayDir,this._tmpRayDir,i),this.currentCamera.eye=oe(Ww,this.currentCamera.eye,this._tmpRayDir),fr(Ww,this.currentCamera.center,this._tmpPoi,i),this._tmpPoi[2]>this.startCamera.center[2]?Ww[2]=Math.max(this.startCamera.center[2],Ww[2]):Ww[2]=Math.min(this.startCamera.center[2],Ww[2]),this.currentCamera.center=Ww,this._constraintOptions.interactionFactor=ud(wv(this.dragBeginPoint,e)),Ps(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}finish(){this.running&&this.finishController()}};IK=u([A("esri.views.3d.state.controllers.ZoomControllerLocal")],IK);const Ww=$(),F1t=De(0,0,1);let k1t=class extends ls{constructor(e,i,r){super(!0),this._view=e,this.pointerActions=i,this._fovModifier=r,this.registerIncoming("drag",[r],s=>this._handleZoom(s)),this.registerIncoming("drag",s=>this._handleZoom(s))}_handleZoom(e){var s,n;const i=e.data;if(i.pointers.size>1||!lse(e.data,this.pointerActions))return;const r=ln(i.center.x,i.center.y);switch(i.action){case"start":{(s=this._cameraController)==null||s.finish();const o=this._view,a=e.modifiers.has(this._fovModifier);this._cameraController=a?new a$({view:o,onStop:()=>this._stopController()}):o.state.isGlobal?new OK({view:o}):new IK({view:o}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break}case"update":(n=this._cameraController)==null||n.update(r);break;case"end":this._cameraController instanceof a$?this._cameraController.updateTimeout():this._stopController()}e.stopPropagation()}_stopController(){var e;(e=this._cameraController)==null||e.finish(),this._cameraController=null}},Nx=class extends ef{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new qr,this._headingStart=0,this._constraintOptions=new gh(Fr.ALL,ri.NONE,0,new qr,null,ug.LOOK_AROUND)}handleEventGamepad(e){const i=PJ(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||a5(i))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,zde(this._keysButtonState,this._transformation)}directionActive(e){return this._keysButtonState[e]===1}countActiveDirections(){return this._keysButtonState.reduce((e,i)=>i>0?e+1:e,0)}deactivateDirection(e){this._keysButtonState[e]=0;const i=zde(this._keysButtonState,this._transformation);a5(i)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const i=this.view.pointsOfInterest.cameraOnSurface.location.z,r=1;this._filteredSurfaceElevation+=r*(i-this._filteredSurfaceElevation)*e}stepController(e,i){var r;this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(i),this._updateCameraCenter(),(r=this._constraintOptions.interactionStartCamera)==null||r.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,Zw),this._applyDisabledMovementTypes(Zw),this._applyPan(Zw.pan),this._applyRotate(Zw.rotate),this._applyZoom(Zw.zoom),this._applyAscend(Zw.ascend),this._constraintOptions.interactionType=ri.NONE,this._constraintOptions.selection=Fr.COLLISION,Ps(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,i)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const i=this.currentCamera;be(kl,i.center,i.eye),ot(kl,kl,e.matrix),i.center=oe(kl,kl,i.eye),i.up=ot(kl,i.up,e.matrix),this._constraintOptions.interactionType=ri.LOOK_AROUND,this._constraintOptions.selection=Fr.ALL_EXCEPT_COLLISION,Ps(this.view,i,this._constraintOptions)}_applyPan(e,i=this.currentCamera){e.enabled&&(i.eye=ot(kl,i.eye,e.matrix),i.center=ot(kl,i.center,e.matrix),this.view.state.isGlobal&&(i.up=ot(kl,i.up,e.matrix)),this._constraintOptions.interactionType=ri.PAN,this._constraintOptions.selection=Fr.ALL,Ps(this.view,i,this._constraintOptions))}_applyZoom(e){if(!e)return;const i=this.currentCamera.viewForward;this.currentCamera.eye=oe(kl,this.currentCamera.eye,re(Le.get(),i,e)),ne(bO,i),Cd(bO,bO),this._constraintOptions.interactionDirection=bO,this._constraintOptions.interactionType=ri.ZOOM,this._constraintOptions.selection=Fr.ALL_EXCEPT_COLLISION,Ps(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const i=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Le.get());if(this._constraintOptions.interactionDirection=ne(bO,i),this.view.state.isGlobal){const r=Ee(this.currentCamera.eye),s=(r+e)/r;this.currentCamera.eye=re(kl,this.currentCamera.eye,s),this.currentCamera.center=re(kl,this.currentCamera.center,s)}else{const r=re(Le.get(),i,e);this.currentCamera.eye=oe(kl,this.currentCamera.eye,r),this.currentCamera.center=oe(kl,this.currentCamera.center,r)}this._updateCameraCenter(),this._constraintOptions.interactionType=ri.ASCEND,this._constraintOptions.selection=Fr.COLLISION,Ps(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=Fr.ALL_EXCEPT_COLLISION,Ps(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,i,r){H1t(r);const s=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(s,i,r):this._calculateControlTransformationGlobal(s,i,r)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,i=this.view.renderCoordsHelper,r=this.currentCamera.ray;this.currentCamera.center=i.intersectManifoldClosestSilhouette(r,e,kl)}_calculateControlTransformationLocal(e,i,r){const{viewRight:s,viewForward:n}=i,o=this._transformation,a=this.view.navigation.gamepad,l=se(Le.get(),n[0],n[1],0);ae(l,l);const c=o.translation[0]*e.pan;if(c!==0){const v=re(Le.get(),s,c);uh(r.pan.matrix,r.pan.matrix,v),r.pan.enabled=!0}switch(a.mode){case"pan":{const v=-o.translation[1]*e.pan;if(v!==0){const _=re(Le.get(),l,v);uh(r.pan.matrix,r.pan.matrix,_),r.pan.enabled=!0}r.zoom=o.zoom*e.zoom;break}case"zoom":r.zoom=(-o.translation[1]+o.zoom)*e.zoom;break;default:a.mode}const h=o.translation[2]*e.ascend;r.ascend=h;const d=-o.heading*e.rotate;d!==0&&(Ku(r.rotate.matrix,r.rotate.matrix,d,this.view.renderCoordsHelper.worldUpAtPosition(i.eye,Le.get())),r.rotate.enabled=!0);const f=o.tilt*e.rotate,m=Rv(this.view.renderCoordsHelper,i.center,i.eye),g=ue(m+f,ma.min,ma.max)-m;g&&(Ku(r.rotate.matrix,r.rotate.matrix,g,s),r.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,i,r){const{eye:s,viewRight:n}=i,o=this._transformation,a=this.view.navigation.gamepad,l=ct(Le.get(),n,s);ae(l,l),Cd(l,l),Fwt(this.startCamera,i,o,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,r,a),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(Zw.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,h=o.translation[2]*e.ascend;r.ascend=h;const d=-o.heading*e.rotate;d!==0&&(Ku(r.rotate.matrix,r.rotate.matrix,d,this._tmpCamera.eye),r.rotate.enabled=!0);const f=o.tilt*e.rotate,m=this._clampTiltDeltaGlobalToValidRange(f,i.ray,c);m!==0&&(Ku(r.rotate.matrix,r.rotate.matrix,m,this._tmpCamera.viewRight),r.rotate.enabled=!0),r.zoom+=o.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,i,r){const s=yr(this.view.spatialReference),n=B5(ma.min,i.origin,r,s);let o=0,a=0;const l=Le.get();if(this.view.renderCoordsHelper.intersectManifold(i,r,l)){const c=Rv(this.view.renderCoordsHelper,l,i.origin);o=B5(c,i.origin,r,s),a=B5(ma.max,i.origin,r,s)}else{fM(pM(WG,r+s.radius),i,l);const c=Math.PI+Dse(i.direction,l);o=Yge(c,i.origin,r,s),a=Yge(ma.max,i.origin,r,s)}return ue(o+e,n,a)-o}_getPointAbsoluteSurfaceElevation(e,i,r){const{renderCoordsHelper:s}=this.view,n=s.getAltitude(e),o=i+Math.abs(n-i);return s.setAltitude(r,o,e),o}_clampedDistanceToSurface(e,i){const{renderCoordsHelper:r}=this.view,{camera:s}=this.view.state,{direction:n}=m_t(this.view,i,0,RFe,G1t),o=r.intersectManifoldClosestSilhouette(wf(i,n),e,Le.get()),a=Sr(i,o),l=r.intersectManifoldClosestSilhouette(wf(i,nT(Le.get(),i,s.center)),e,Le.get()),c=Sr(i,l);return Math.min(a,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:i,state:r}=this.view,{camera:s,isGlobal:n}=r,o=i.intersectManifoldClosestSilhouette(s.ray,this._filteredSurfaceElevation,Le.get());if(n){const a=be(Le.get(),e,o),l=Ee(a);re(a,a,1/l);const c=ae(Le.get(),e),h=Ja(fe(c,a));return l*Math.sin(Math.min(U1t,h))}{const a=ne(Le.get(),e);return i.setAltitude(a,this._filteredSurfaceElevation),Sr(o,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:B1t}_computeVelocities(e){const i=this._filteredSurfaceElevation,r=i+yr(this.view.spatialReference).radius,{camera:s,isGlobal:n}=this.view.state,o=Le.get(),a=this._getPointAbsoluteSurfaceElevation(s.eye,i,o),l=this._clampedDistanceToSurface(i,o),c=s.width/2,h=vye*s.width,d=vye*s.width,f=l*Math.tan(.5*s.fovX)/c,m=f/r,g=f/this._computeHeadingRotateRadius(o),v=a-i;return{pan:(n?m:f)*h*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(h*e/c)*v-v),zoom:2**(h*e/c)*l-l,rotate:ue(g*d,V1t,j1t)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&_f(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&_f(e.rotate.matrix))}static activatesFor(e,i){const r=PJ(i,e.navigation.gamepad,z1t);return!(i.action==="end"||a5(r))}};u([p({constructOnly:!0})],Nx.prototype,"gamepadDevice",void 0),u([p({constructOnly:!0})],Nx.prototype,"disableMovements",void 0),Nx=u([A("esri.views.3d.state.controllers.GamepadKeyboardController")],Nx);const z1t={translation:[0,0,0],heading:0,tilt:0,zoom:0},RFe=80,U1t=At(RFe),vye=.75,B1t=5,V1t=At(30),j1t=At(80),Zw={zoom:0,ascend:0,pan:{enabled:!1,matrix:qe()},rotate:{enabled:!1,matrix:qe()}},kl=$(),bO=$(),G1t=Coe();function H1t(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,_f(t.pan.matrix),t.rotate.enabled=!1,_f(t.rotate.matrix)}let q1t=class extends ls{constructor(e){super(!0),this._view=e,this._watchHandles=new fg,this._handle=this.registerIncoming("gamepad",i=>this._handleEventGamepad(i)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([H(()=>this._view.navigation.gamepad.enabled,i=>{i?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},Ut),H(()=>this._view.navigation.gamepad.device,i=>{this._cameraControllerGamepad&&i&&this._cameraControllerGamepad.gamepadDevice!==i&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){var s;const i=this._view.navigation.gamepad.device;if(i&&e.data.device!==i)return;const r=(s=this._cameraControllerGamepad)==null?void 0:s.running;if(r||Nx.activatesFor(this._view,e.data)){if(!r){const n=new Nx({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(n),n.state!==Hr.Rejected&&(this._cameraControllerGamepad=n)}this._cameraControllerGamepad&&this._cameraControllerGamepad.running&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};var Nc;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(Nc||(Nc={}));let W1t=class extends ls{constructor(e,i){super(!0),this._view=e,this._keyToDirection=new Map,this._keyToAction=new Map,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:je.Local},this._stickyKeyTimeoutHandle=void 0,this._stickyKeyDuration=200,this._addKeysMapping(i),this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleStop()),this._visibilityHandle=use(r=>r?null:this._handleStop())}onUninstall(){var e;(e=this._visibilityHandle)==null||e.remove(),this._handleStop()}setStickyKeyDuration(e){this._stickyKeyDuration=e}_addKeysMapping(e){this._addKeyMapping(e.pan.left,Nc.LEFT),this._addKeyMapping(e.pan.right,Nc.RIGHT),this._addKeyMapping(e.pan.forward,Nc.FORWARD),this._addKeyMapping(e.pan.backward,Nc.BACKWARD),this._addKeyMapping(e.pan.up,Nc.UP),this._addKeyMapping(e.pan.down,Nc.DOWN),this._addKeyMapping(e.lookAround.headingLeft,Nc.HEADINGLEFT),this._addKeyMapping(e.lookAround.headingRight,Nc.HEADINGRIGHT),this._addKeyMapping(e.lookAround.tiltUp,Nc.TILTUP),this._addKeyMapping(e.lookAround.tiltDown,Nc.TILTDOWN),this._addKeyMapping(e.zoom.zoomIn,Nc.ZOOMIN),this._addKeyMapping(e.zoom.zoomOut,Nc.ZOOMOUT),this._addKeyAction(e.reset.heading,()=>this._resetHeading()),this._addKeyAction(e.reset.tilt,()=>this._resetTilt())}_addKeyMapping(e,i){for(const r of this._eachKey(e))this._keyToDirection.set(r,i)}*_eachKey(e){typeof e=="string"?yield e:yield*e}_addKeyAction(e,i){for(const r of this._eachKey(e))this._keyToAction.set(r,i)}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToAction.get(e.data.key);if(i!=null)return e.stopPropagation(),void i();const r=this._keyToDirection.get(e.data.key);if(r!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.running||(this._cameraControllerKeyboard=new Nx({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.running)){if(e.stopPropagation(),this._cameraControllerKeyboard.directionActive(r)||(this._cameraControllerKeyboard.activateDirection(r),this._cameraControllerKeyboard.countActiveDirections()>1||!this._isPanning(r)))return;this._stickyKeyDuration>0&&(this._stickyKeyTimeoutHandle=setTimeout(()=>{var s;this._stickyKeyTimeoutHandle=void 0,this._stickyDirection!=null&&this._stickyDirection!==void 0&&((s=this._cameraControllerKeyboard)==null||s.deactivateDirection(this._stickyDirection),this._stickyDirection=void 0)},this._stickyKeyDuration))}}_handleStop(){var e;(e=this._cameraControllerKeyboard)!=null&&e.running&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){var s,n,o;if(e.data.native.ctrlKey||e.data.native.metaKey||!((s=this._cameraControllerKeyboard)!=null&&s.running))return;const i=this._keyToDirection.get(e.data.key);if(i==null)return;e.stopPropagation();const r=this._stickyKeyTimeoutHandle===void 0;this._stickyKeyTimeoutHandle===void 0||((n=this._cameraControllerKeyboard)==null?void 0:n.countActiveDirections())!==1?((o=this._cameraControllerKeyboard)==null||o.deactivateDirection(i),r&&(this._stickyDirection=void 0)):this._stickyDirection=i}_isPanning(e){return e<=3}_resetHeading(){this._view.goTo({heading:0}).catch(()=>{})}_resetTilt(){this._view.goTo({tilt:0}).catch(()=>{})}},Z1t=class extends ls{constructor(e,i){super(!0),this._view=e,this.registerIncoming("mouse-wheel",[i],r=>this._handleFov(r)),this.registerIncoming("mouse-wheel",r=>this._handleZoom(r))}_handleZoom(e){var r;if(!this._mouseWheelZoomEnabled)return;const i=e.data;(r=this._zoomController)!=null&&r.running||(this._stopFovController(),this._zoomController=this._view.state.isGlobal?new QB({view:this._view,mode:"interaction"}):new eV({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._zoomController)),this._zoomController.step(-i.deltaY/60,ln(i.x,i.y)),e.preventDefault(),e.stopPropagation()}_handleFov(e){var i,r,s;this._mouseWheelZoomEnabled&&((i=this._fovController)!=null&&i.running||((r=this._zoomController)==null||r.finish(),(s=this._fovController)==null||s.hideOverlay(),this._fovController=new a$({view:this._view,onStop:()=>this._stopFovController()}),this._view.state.switchCameraController(this._fovController),this._fovController.state!==Hr.Rejected)?(this._fovController.updateTimeout(),this._fovController.step(e.data.deltaY/20),e.preventDefault(),e.stopPropagation()):this._stopFovController())}get _mouseWheelZoomEnabled(){return this._view.navigation.actionMap.mouseWheel==="zoom"}_stopFovController(){var e;(e=this._fovController)==null||e.finish(),this._fovController=null}},rV=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},FS=class extends X3{constructor(){super(...arguments),this._beginCamera=new qr,this._elapsedTimeSec=0,this.constraintOptions=new gh(Fr.ALL,ri.PAN,0,this._beginCamera)}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new xv}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),super.onControllerStart(e)}stepController(e,i){i.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,i),Ps(this.view,i,this.constraintOptions)}};FS=u([A("esri.views.3d.state.controllers.momentum.MomentumController")],FS);let TP=class extends FS{constructor(e){super(e),this.interactionType=ri.PAN,this._tmpPan=$()}momentumStep(e,i){const r=this.momentum.value(e);re(this._tmpPan,this.momentum.direction,r),i.eye=be(_ye,i.eye,this._tmpPan),i.center=be(_ye,i.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};u([p({constructOnly:!0})],TP.prototype,"momentum",void 0),TP=u([A("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],TP);const _ye=$(),Y1t=$(),QF=$();let W5=class extends FS{constructor(e){super(e),this.interactionType=ri.PAN}momentumStep(e,i){const r=this.momentum.value1(e),s=this.momentum.value2(e);ne(QF,i.eye),ae(QF,QF),ct(this.momentum.axis2,QF,this.momentum.axis1),vFe(i,Y1t,this.momentum.axis1,r,this.momentum.axis2,s)}};u([p({constructOnly:!0})],W5.prototype,"momentum",void 0),W5=u([A("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],W5);let _x=class extends FS{set center(e){this._set("center",os(e))}set axis(e){this._set("axis",os(e))}constructor(e){super(e),this.interactionType=ri.TUMBLE}momentumStep(e,i){const r=this.momentum.value(e);Yb(i,this.center,K3(this.axis,r))}};u([p({constructOnly:!0})],_x.prototype,"momentum",void 0),u([p({constructOnly:!0})],_x.prototype,"center",null),u([p({constructOnly:!0})],_x.prototype,"axis",null),_x=u([A("esri.views.3d.state.controllers.momentum.RotationMomentumController")],_x);let bC=class extends FS{set zoomCenter(e){this._set("zoomCenter",os(e))}constructor(e){super(e),this.interactionType=ri.ZOOM,this.constraintOptions.interactionDirection=$()}momentumStep(e,i){const{interactionDirection:r}=this.constraintOptions;if(!r)return;ne(r,i.eye);const s=this.momentum.valueDelta(0,e);qoe(i,this.zoomCenter,s,this.view.state.constraints.minimumPoiDistance),nT(r,i.eye,r)}};u([p({constructOnly:!0})],bC.prototype,"momentum",void 0),u([p({constructOnly:!0})],bC.prototype,"zoomCenter",null),bC=u([A("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],bC);let G1=class extends FS{set screenCenter(e){this._set("screenCenter",ln(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",os(e))}constructor(e){super(e),this.interactionType=ri.ZOOM,this.radius=0,this._tmpSceneCenter=$(),this._tmpZoomAxisAngle=D6(),this._sphere=Ls()}initialize(){this._sphere[3]=this.radius}momentumStep(e,i){const r=this.momentum.valueDelta(0,e);dFe(this._sphere,i,r),this.constraintOptions.interactionType=ri.ZOOM,Ps(this.view,i,this.constraintOptions),Q3(this._sphere,i,this.screenCenter,this._tmpSceneCenter),Voe(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),Yb(i,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=ri.PAN}};u([p({constructOnly:!0})],G1.prototype,"momentum",void 0),u([p({constructOnly:!0})],G1.prototype,"screenCenter",null),u([p({constructOnly:!0})],G1.prototype,"sceneCenter",null),u([p({constructOnly:!0})],G1.prototype,"radius",void 0),G1=u([A("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],G1);let qp=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const i=this.computeDelta(e);this._updateDelta(i)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},z6=class{constructor(e,i,r){this._initialVelocity=e,this._stopVelocity=i,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,i){const r=this.value(e);return this.value(e+i)-r}valueFromInitialVelocity(e,i){i=Math.min(i,this.duration);const r=1-this.friction;return e*(r**i-1)/Math.log(r)}},J1t=class extends z6{constructor(e,i,r,s,n){super(e,i,r),this._sceneVelocity=s,this.direction=n}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},PFe=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._time=new qp(.6),this._screen=[new qp(.4),new qp(.4)],this._scene=[new qp(.6),new qp(.6),new qp(.6)],this._tmpDirection=$()}add(e,i,r){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(r)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(i[0]),this._scene[1].update(i[1]),this._scene[2].update(i[2]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?0:Math.sqrt(e*e+i*i),s=this._time.filteredDelta,n=s==null||r==null?0:r/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,i,r){se(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const s=Ee(this._tmpDirection);s>0&&re(this._tmpDirection,this._tmpDirection,1/s);const n=this._time.filteredDelta;return new J1t(e,i,r,n==null?0:s/n,this._tmpDirection)}},bye=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const wye=1e-5;let X1t=class extends z6{constructor(e,i,r,s,n,o=0,a){super(e,i,r),this._angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},K1t=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._tmpAxis1=$(),this._tmpAxis2=$(),this._tmpAngles=Ye(),this._time=new qp(.3),this._screen=[new qp(.4),new qp(.4)],this._angle1=new bye(.6),this._angle2=new bye(.6),this._axis1=$(),this._axis2=$(),this._lastScene=$()}addMomentumDirectRotation(e,i,r,s,n,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;let a=gFe(this._lastScene,i,this._tmpAxis2,s,n,o);this._angle2.update(0),Xo(this._tmpAxis2)<wye?a=0:ae(this._axis1,this._tmpAxis2),this._angle1.update(a),ne(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}addMomentumPreserveHeading(e,i,r,s,n,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;yFe(this._lastScene,i,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,s,n,o,a,!1),Xo(this._tmpAxis2)<wye?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),ae(this._axis1,this._tmpAxis1),ae(this._axis2,this._tmpAxis2)),ne(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?null:Math.sqrt(e*e+i*i),s=this._time.filteredDelta,n=r==null||s==null?0:r/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,i,r){const s=this._time.filteredDelta,n=this._angle1.filteredValue,o=this._angle2.filteredValue,a=s==null||o==null?0:o/s;return new X1t(e,i,r,s==null||n==null?0:n/s,this._axis1,a,this._axis2)}},DFe=class{constructor(e=2.5,i=.01,r=.95,s=12){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this._maxVelocity=s,this.enabled=!0,this.value=new qp(.8),this.time=new qp(.3)}add(e,i){if(this.enabled&&i!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(i)<.01)return;if(this.value.hasFilteredDelta()){const r=this.value.computeDelta(e);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(i),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=ue(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,i,r){return new z6(e,i,r)}},LFe=class extends DFe{constructor(e=3,i=.01,r=.95,s=12){super(e,i,r,s)}add(e,i){const r=this.value.lastValue;if(r!=null){let s=e-r;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;e=r+s}super.add(e,i)}},Q1t=class extends z6{constructor(e,i,r){super(e,i,r)}value(e){const i=super.value(e);return Math.exp(i)}valueDelta(e,i){const r=super.value(e),s=super.value(e+i)-r;return Math.exp(s)}},NFe=class extends DFe{constructor(e=2.5,i=.01,r=.95,s=12){super(e,i,r,s)}add(e,i){super.add(Math.log(e),i)}createMomentum(e,i,r){return new Q1t(e,i,r)}},RK=class extends ef{constructor(){super(...arguments),this._smoothRotation=new rV(.05),this._rotationAxis=$(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=Gr(),this._beginRadius=0,this._smoothScaling=new rV(.05),this._zoomCenterScreen=ln(),this._zoomMomentumEstimator=new NFe,this._rotationMomentumEstimator=new LFe,this._panSphericalMomentumEstimator=new K1t,this._panPlanarMomentumEstimator=new PFe,this._adjustedSphere=Ls(),this._tmp3d=$(),this._tmpScreenPointArray=ln(),this._beginScreenPoint=ln(),this._beginScenePoint=$(),this._screenPickPoint=ln(),this._scenePickPoint=$(),this._navMode=ba.Horizontal,this._sphere=Ls(),this._pointerCount=0,this._tmpInteractionDirection=$(),this._beginCamera=new qr,this._constraintOptions=new gh(Fr.ALL,ri.NONE,0,this._beginCamera)}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.running)return;this._zoomMomentumEstimator.enabled=this._rotationMomentumEstimator.enabled=this._panPlanarMomentumEstimator.enabled=this._panSphericalMomentumEstimator.enabled=this.view.navigation.momentumEnabled,this._beginHeading=-Ib.normalize(At(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),Yp(e.center,this._screenPickPoint),Vn(this._beginScreenPoint,this._screenPickPoint);const i=yr(this.view.spatialReference),r=fFe(this._intersectionHelper,this.startCamera,this._screenPickPoint,i,CA.Silhouette,this.view.map.ground.opacity===0?mT:{});r.scenePickPoint!=null&&(this._scenePickPoint=r.scenePickPoint,this._sphere=r.sphere,ne(this._beginScenePoint,this._scenePickPoint),this._navMode=NL(this.startCamera,this._screenPickPoint,this.view.renderCoordsHelper,this.view.viewingMode),this._navMode===ba.Vertical&&this._preparePlanarPanMode(e,r.hasGeometryIntersection),this._beginCamera.copyFrom(this.startCamera))}update(e){if(!this.running)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1;this._navMode===ba.Horizontal?(i&&this._zoomSpherical(e),this._panningSpherical(e),i&&this._rotateSpherical(e)):(i&&this._zoomPlanar(e),this._panningPlanar(e),i&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return this._navMode===ba.Horizontal?new G1({view:this.view,momentum:i,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new bC({view:this.view,momentum:i,zoomCenter:this._beginScenePoint});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new _x({view:this.view,momentum:r,center:this._sphere,axis:this._rotationAxis});if(this._navMode===ba.Horizontal){const s=this._panSphericalMomentumEstimator.evaluateMomentum();if(s)return new W5({view:this.view,momentum:s})}else{const s=this._panPlanarMomentumEstimator.evaluateMomentum();if(s)return new TP({view:this.view,momentum:s})}return null}_preparePlanarPanMode(e,i){const r=Cd(this._tmp3d,this.startCamera.viewForward);dA(this._scenePickPoint,r,this._panningPlane);const s=ln(this._screenPickPoint[0],0),n=$(),o=Ee(this.startCamera.eye);this._adjustedSphere[3]=o<this._sphere[3]?o-100:this._sphere[3],Q3(this._adjustedSphere,this.startCamera,s,n);const a=Qp();this.startCamera.projectToRenderScreen(n,a);const l=$(),c=$(),h=$();be(l,this._scenePickPoint,this.currentCamera.eye);const d=Ee(l);ae(l,l);const f=uFe*Math.max(Math.abs(this.view.camera.position.z),hFe),m=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,LL);let g=m??f;g=i?Math.min(g,d):g,ne(h,oe(c,this.currentCamera.eye,re(c,l,g))),this._panningPlane[3]=-fe(this._panningPlane,h),this.startCamera.center=oe(c,this.startCamera.eye,re(c,this.startCamera.viewForward,g));const v=Yp(e.center,this._tmpScreenPointArray);AK(this._panningPlane,this.startCamera,v,this._beginScenePoint)}_zoomSpherical(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),dFe(this._sphere,this.currentCamera,this._smoothScaling.value),Yp(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=ri.ZOOM,this._constraintOptions.interactionFactor=ud(e.radius-this._beginRadius),Ps(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const i=Yp(e.center,this._tmpScreenPointArray);Q3(this._sphere,this.currentCamera,i,this._tmp3d),Woe(this._beginScenePoint,fe(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera.aboveGround)?(bFe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(_Fe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=ri.PAN,this._constraintOptions.interactionFactor=ud(wv(this._screenPickPoint,i)),Ps(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){ae(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||Cd(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value,r=i+$K(e.angle-i),s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(r);const n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),Yb(this.currentCamera,this._sphere,K3(this._rotationAxis,n)),this._constraintOptions.interactionType=ri.TUMBLE,this._constraintOptions.interactionFactor=ud(e.radius*r),Ps(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const i=Yp(e.center,this._tmpScreenPointArray);AK(this._panningPlane,this.currentCamera,i,this._tmp3d)&&(mFe(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(i,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=ri.PAN,this._constraintOptions.interactionFactor=ud(wv(this._beginScreenPoint,i)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),Ps(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),qoe(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=ri.ZOOM,this._constraintOptions.interactionFactor=ud(e.radius-this._beginRadius),Ps(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){ne(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||Cd(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value;let r=e.angle-i;r=$K(r);const s=i+r,n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(s);const o=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp),Yb(this.currentCamera,this._sphere,K3(this._rotationAxis,o)),this._constraintOptions.interactionType=ri.TUMBLE,this._constraintOptions.interactionFactor=ud(e.radius*o),Ps(this.view,this.currentCamera,this._constraintOptions)}};RK=u([A("esri.views.3d.state.controllers.PinchAndPanControllerGlobal")],RK);const xye=De(0,0,1);let PK=class extends ef{constructor(){super(...arguments),this._rotationValueSmooth=new rV(.05),this._scalingValueSmooth=new rV(.05),this._planeHorizontal=Gr(),this._planeVertical=Gr(),this._rotationMomentumEstimator=new LFe,this._panMomentumEstimator=new PFe(300,12,.9),this._zoomMomentumEstimator=new NFe,this._beginRadius=0,this._beginCenter=$(),this._beginAngle=0,this._tmpPoints=[],this._navMode=ba.Horizontal,this._beginCenterScreen=ln(),this._tmpCentroid3d=$(),this._tmpCentroid2d=ln(),this._tmp2d=ln(),this._pointerCount=0,this._beginCamera=new qr,this._constraintOptions=new gh(Fr.ALL,ri.NONE,0,this._beginCamera)}begin(e){if(!this.running)return;const i=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=i,this._rotationMomentumEstimator.enabled=i,this._panMomentumEstimator.enabled=i,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),Yp(e.center,this._beginCenterScreen),ERe(xye,0,this._planeHorizontal);const r=$(),s=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,r,this.view.map.ground.opacity===0?mT:{}),n=$();Cd(n,this.startCamera.viewForward);const o=$();ne(o,xye);const a=fe(n,o);this._navMode=NL(this.startCamera,this._beginCenterScreen,this.view.renderCoordsHelper,this.view.viewingMode);const l=Math.min(uFe,1/Math.abs(fe(o,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),hFe);qJ(this._planeHorizontal,this._planeHorizontal,r),this.startCamera.aboveGround||flt(this._planeHorizontal,this._planeHorizontal);const c=$(),h=$(),d=$();be(c,r,this.currentCamera.eye);const f=Ee(c);if(ae(c,c),this._navMode===ba.Vertical){re(o,o,a),be(this._planeVertical,n,o),ae(this._planeVertical,this._planeVertical),qJ(this._planeVertical,this._planeVertical,r);const m=this.view._stage.renderView.getMinimalDepthForArea(eD(this.view),this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,LL);let g=m??l;g=s?Math.min(g,f):g,ne(d,oe(h,this.currentCamera.eye,re(h,c,g))),this._planeVertical[3]=-fe(this._planeVertical,d),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),Kq(this._tmpPoints,this._beginCenter)}else{const m=s?f:l;ne(d,oe(h,this.currentCamera.eye,re(h,c,m))),this._planeHorizontal[3]=-fe(this._planeHorizontal,d),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),Kq(this._tmpPoints,this._beginCenter)}this._beginCamera.copyFrom(this.startCamera)}update(e){if(!this.running)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1,r=this._navMode===ba.Horizontal?this._planeHorizontal:this._planeVertical,s=this._beginCenter;if(i){const n=this._beginRadius/e.radius,o=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=o,this._scalingValueSmooth.update(n),qoe(this.currentCamera,s,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=ri.ZOOM,this._constraintOptions.interactionFactor=ud(Math.abs(e.radius-this._beginRadius)),Ps(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,r,this.currentCamera,this._tmpPoints),Kq(this._tmpPoints,this._tmpCentroid3d),Yp(e.center,this._tmpCentroid2d),mFe(this.currentCamera,s,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=ri.PAN,this._constraintOptions.interactionFactor=ud(wv(this._beginCenterScreen,this._tmpCentroid2d)),Ps(this.view,this.currentCamera,this._constraintOptions),i){const n=s,o=this._rotationValueSmooth.value,a=o+$K(e.angle-o),l=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=l,this._rotationValueSmooth.update(a);const c=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(c,.001*e.timestamp);const h=this._planeHorizontal;Yb(this.currentCamera,n,K3(h,c)),this._constraintOptions.interactionType=ri.TUMBLE,this._constraintOptions.interactionFactor=ud(Math.abs(e.radius*c)),Ps(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return new bC({view:this.view,momentum:i,zoomCenter:this._beginCenter});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new _x({view:this.view,momentum:r,center:this._beginCenter,axis:this._planeHorizontal});const s=this._panMomentumEstimator.evaluateMomentum();return s?new TP({view:this.view,momentum:s}):null}_computePlanePoints(e,i,r,s){s.length=e.size;const n=this._tmp2d;let o=0;return e.forEach(a=>{n[0]=a.x,n[1]=a.y,s[o]===void 0&&(s[o]=$()),AK(i,r,n,s[o]),o+=1}),s}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};PK=u([A("esri.views.3d.state.controllers.PinchAndPanControllerLocal")],PK);let Sye=class extends ls{constructor(e,i,r){super(!0),this._view=e,this.pointerActions=i,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!lse(e.data,this.pointerActions))return;const i=e.timestamp-this._lastEndTimestamp,r=40,s=this._momentum&&this._momentum.running&&i<r;switch(e.data.action){case"start":case"update":if(s)break;this._controller&&this._controller.running?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,i){var r;if((r=this._controller)!=null&&r.running){this._lastEndTimestamp=e.timestamp;const s=this._controller.end(e.data);i&&s&&(this._momentum=s,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new RK({view:this._view}):new PK({view:this._view})}},ext=class extends ls{constructor(e,i){super(!0),this.view=e,this.registerIncoming("pointer-down",i,()=>this.view.state.stopActiveCameraController())}},txt=class extends ls{constructor(e,i=!1){super(!0),this._view=e,this._invert=i,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(e){var s,n,o;const i=this._invert?-1:1,r=ln(0,e.data.delta*i);switch(e.data.action){case"begin":(s=this._cameraController)==null||s.end(),this._cameraController=new SP({view:this._view,pivot:jc.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":(n=this._cameraController)==null||n.update(r);break;case"end":(o=this._cameraController)==null||o.end(),this._cameraController=null}}},ixt=class extends ls{constructor(e=20,i=40){super(!1),this._threshold=e,this._maxDelta=i,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new uL({start:(r,s)=>this._observeStart(r,s),update:(r,s,n)=>this._observeUpdate(r,s,n),end:(r,s)=>this._observeEnd(s)}),this.registerIncoming("drag",r=>this._dragEventSeparator.handle(r))}get failed(){return this._state==="failed"}_observeStart(e,i){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),i.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,i,r){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void i.stopPropagation()):void(this._checkMovementWithinLimits(i.data,r.data)?this._checkVerticalThresholdReached(i.data,r.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=i.data.center,this._artificalDrag.emit({action:"end",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),i.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,i){let r=-1/0,s=1/0,n=-1/0,o=1/0;for(const{x:v,y:_}of i.pointers.values())r=Math.max(r,v),s=Math.min(s,v),n=Math.max(n,_),o=Math.min(o,_);let a=-1/0,l=1/0,c=-1/0,h=1/0;for(const{x:v,y:_}of e.pointers.values())a=Math.max(a,v),l=Math.min(l,v),c=Math.max(c,_),h=Math.min(h,_);const d=r-s,f=n-o,m=a-l,g=c-h;return Math.abs(e.center.x-i.center.x)<this._threshold&&Math.abs(m-d)<=this._maxDelta&&Math.abs(g-f)<=this._maxDelta}_checkVerticalThresholdReached(e,i){let r=Math.abs(e.center.y-i.center.y);return e.pointers.forEach((s,n)=>{const o=i.pointers.get(n);r=Math.min(r,Math.abs(s.y-o.y))}),r>=this._threshold}},am=class extends he{constructor(){super(...arguments),this.mode="default",this._updateMode=({mode:e,dragPrimary:i,dragSecondary:r,dragTertiary:s})=>{e==="pro"&&(r="zoom",s=i==="pan"?"rotate":"pan");const n={dragPrimary:i,dragSecondary:r,dragTertiary:s};this._modeDragPan&&(this._modeDragPan.pointerActions=hP("pan",n)),this._modeDragRotate&&(this._modeDragRotate.pointerActions=hP("rotate",n)),this._modeDragZoom&&(this._modeDragZoom.pointerActions=hP("zoom",n))}}destroy(){this.disconnect()}get primaryDragAction(){return this.view.navigation.actionMap.dragPrimary}set primaryDragAction(e){const{actionMap:i}=this.view.navigation;i.dragPrimary=e,i.dragSecondary=e==="pan"?"rotate":"pan"}get updating(){var e;return!!((e=this._inputManager)!=null&&e.updating)}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e;return((e=this._inputManager)==null?void 0:e.multiTouchActive)??!1}disconnect(){this.removeAllHandles(),this.view.viewEvents.disconnect(),this._modeDragPan=null,this._modeDragRotate=null,this._modeDragZoom=null,this._modeKeyboardNavigation=null,this._inputManager=$e(this._inputManager),this._source=$e(this._source)}connect(){const e=this.view;this._source=new hse(this.view.surface,e.input);const i=[new EOe,new COe,new $Oe,new SOe(this.view.navigation),new ixt],r=new zu({eventSource:this._source,recognizers:i});this._inputManager=r,r.installHandlers("prevent-context-menu",[new xOe],Vm.INTERNAL);const s={fov:"Shift",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:["u","U"],down:["j","J"]},lookAround:{headingLeft:["a","A"],headingRight:["d","D"],tiltUp:["w","W"],tiltDown:["s","S"],modifier:"b"},zoom:{zoomIn:["+","="],zoomOut:["-","_"]},reset:{heading:["n","N"],tilt:["p","P"]}};this._modeDragPan=new Sye(e,["primary"]),this._modeDragRotate=new c9(e,["secondary"],jc.CENTER),this._modeDragZoom=new k1t(e,["tertiary"],s.fov),this._modeKeyboardNavigation=new W1t(e,s),r.installHandlers("navigation",[new ext(e),new jwt(e),new q1t(e),new Z1t(e,s.fov),new c9(e,["primary"],jc.EYE,[s.lookAround.modifier]),new c9(e,["secondary"],jc.CENTER,[s.lookAround.modifier]),new Sye(e,["tertiary"],[s.lookAround.modifier]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,this._modeKeyboardNavigation,new txt(e)],Vm.INTERNAL),this.view.viewEvents.connect(r),this.addHandles([H(()=>{var n;return(n=this.view.navigation)==null?void 0:n.browserTouchPanEnabled},n=>{this._source.browserTouchPanningEnabled=!n},Ut),H(()=>{const{actionMap:n}=this.view.navigation,{dragPrimary:o,dragSecondary:a,dragTertiary:l}=n;return{mode:this.mode,dragPrimary:o,dragSecondary:a,dragTertiary:l}},this._updateMode,Mt)])}isModifierKeyDown(e){var i;return((i=this._inputManager)==null?void 0:i.isModifierKeyDown(e))??!1}get test(){}};u([p()],am.prototype,"view",void 0),u([p({type:["default","pro"]})],am.prototype,"mode",void 0),u([p({readOnly:!0})],am.prototype,"updating",null),u([p()],am.prototype,"latestPointerType",null),u([p()],am.prototype,"latestPointerLocation",null),u([p()],am.prototype,"multiTouchActive",null),u([p()],am.prototype,"_inputManager",void 0),am=u([A("esri.views.3d.input.SceneInputManager")],am);const rxt=am;let Wu,l$,DK=!1,LK=!1,NK=!1,FK=!1,EP=null;function sxt(t,e){if(!LK||!l$)return;FFe();const i=l$;let r=0;for(let s=0;s<t.accBinsNumX;s++)for(let n=0;n<t.accBinsNumY;n++){const o=t.accBins[s][t.accBinsNumY-1-n];r+=o.length;const a=s*t.accBinsSizeX,l=(s+1)*t.accBinsSizeX,c=n*t.accBinsSizeY,h=(n+1)*t.accBinsSizeY;i.fillText(o.length.toFixed(),a+5,c+15),kFe(a,l,c,h,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+e.size,70,50),i.fillText("total numTests: "+t.accNumTests,70,30)}function nxt(t){NK=xs.DECONFLICTOR_SHOW_VISIBLE,FK=xs.DECONFLICTOR_SHOW_INVISIBLE,DK=NK||FK,LK=xs.DECONFLICTOR_SHOW_GRID,EP=null,DK||LK?EP=()=>oxt(t):Wu&&(Wu.parentElement.removeChild(Wu),Wu=null)}function FFe(){EP&&(EP(),EP=null)}function oxt(t){Wu==null&&(Wu=document.createElement("canvas"),Wu.setAttribute("id","debugCanvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(Wu));const{state:e}=t,{camera:i,pixelRatio:r}=e,{width:s,height:n}=i,o=s*r,a=n*r;Wu.setAttribute("width",`${o}px`),Wu.setAttribute("height",`${a}px`),Wu.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),l$=Wu.getContext("2d"),l$.clearRect(0,0,s,n),l$.font="12px Arial"}function kFe(t,e,i,r,s){FFe();const n=Wu.height,o=l$;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(t,n-i),o.lineTo(e,n-i),o.stroke(),o.lineTo(e,n-r),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.closePath()}function axt(t,e){DK&&(e&&NK||!e&&FK)&&kFe(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var wa,wo;(function(t){t[t.USER=1]="USER",t[t.SCALE_RANGE=2]="SCALE_RANGE",t[t.FILTER=4]="FILTER",t[t.DECONFLICTION=8]="DECONFLICTION",t[t.ALL_GRAPHIC=15]="ALL_GRAPHIC",t[t.ALL_LABEL=255]="ALL_LABEL"})(wa||(wa={})),function(t){t[t.GRAPHIC=1]="GRAPHIC",t[t.LABEL=16]="LABEL"}(wo||(wo={}));function lxt(t){return t instanceof Float32Array&&t.length>=16}function cxt(t){return Array.isArray(t)&&t.length>=16}function uxt(t){return lxt(t)||cxt(t)}const zFe=.5;function UFe(t,e){t.include(Zne),t.attributes.add(z.POSITION,"vec3"),t.attributes.add(z.NORMAL,"vec3"),t.attributes.add(z.CENTEROFFSETANDDISTANCE,"vec4");const i=t.vertex;Qy(i,e),Wb(i,e),i.uniforms.add(new Va("viewport",r=>r.camera.fullViewport),new mt("polygonOffset",r=>r.shaderPolygonOffset),new Un("cameraGroundRelative",r=>r.camera.aboveGround?1:-1)),e.hasVerticalOffset&&vDe(i),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add(E`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(E`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${e.terrainDepthTest?E.float(0):E`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),e.draped&&!e.hasVerticalOffset||RB(i),e.draped||(i.uniforms.add(new Un("perDistancePixelRatio",r=>Math.tan(r.camera.fovY/2)/(r.camera.fullViewport[2]/2))),i.code.add(E`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${E.float(zFe)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),e.screenCenterOffsetUnitsEnabled&&TL(i),e.hasScreenSizePerspective&&b6(i),i.code.add(E`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?E`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled?"":E`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}let BFe=class{constructor(){this.factor=new Tye,this.factorAlignment=new Tye}},Tye=class{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}};function U6(t){t.uniforms.add(new DB("alignPixelEnabled",e=>e.alignPixelEnabled)),t.code.add(E`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),t.code.add(E`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}function hxt(t,e){const{vertex:i,fragment:r}=t;t.include(AL,e),i.include(U6),i.main.add(E`vec4 posProjCenter;
if (dot(position, position) > 0.0) {
ProjectHUDAux projectAux;
vec4 posProj = projectPositionHUD(projectAux);
posProjCenter = alignToPixelCenter(posProj, viewport.zw);
forwardViewPosDepth(projectAux.posView);
vec3 vpos = projectAux.posModel;
if (rejectBySlice(vpos)) {
posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
}
} else {
posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
}
gl_Position = posProjCenter;
gl_PointSize = 1.0;`),r.main.add(E`fragColor = vec4(1);
if(discardByTerrainDepth()) {
fragColor.g = 0.5;
}`)}function VFe(t){t.vertex.uniforms.add(new Un("renderTransparentlyOccludedHUD",e=>e.hudRenderStyle===fa.Occluded?1:e.hudRenderStyle===fa.NotOccluded?0:.75),new Va("viewport",e=>e.camera.fullViewport),new oo("hudVisibilityTexture",e=>{var i;return(i=e.hudVisibility)==null?void 0:i.getTexture()})),t.vertex.include(U6),t.vertex.code.add(E`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}function jFe(t){const e=new Vi,i=t.signedDistanceFieldEnabled;e.include(UFe,t),e.vertex.include(aDe,t);const{occlusionPass:r,output:s,oitPass:n}=t;if(r)return e.include(hxt,t),e;const{vertex:o,fragment:a}=e;e.include(Zne),e.include(iS,t),e.include(Yne,t),e.include(VFe),a.include(uw),a.include(yM),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2");const l=s===Y.Highlight,c=l&&t.occlusionTestEnabled;c&&e.varyings.add("voccluded","float"),o.uniforms.add(new Va("viewport",g=>g.camera.fullViewport),new yc("screenOffset",(g,v)=>di(Z5,2*g.screenOffset[0]*v.camera.pixelRatio,2*g.screenOffset[1]*v.camera.pixelRatio)),new yc("anchorPosition",g=>iD(g)),new pc("materialColor",g=>g.color),new mt("materialRotation",g=>g.rotation)),TL(o),i&&(o.uniforms.add(new pc("outlineColor",g=>g.outlineColor)),a.uniforms.add(new pc("outlineColor",g=>Eye(g)?g.outlineColor:an),new mt("outlineSize",g=>Eye(g)?g.outlineSize:0))),t.horizonCullingEnabled&&o.uniforms.add(new B3("pointDistanceSphere",(g,v)=>{const _=v.camera.eye,b=g.origin;return Yi(b[0]-_[0],b[1]-_[1],b[2]-_[2],Ci.radius)})),t.pixelSnappingEnabled&&o.include(U6),t.hasScreenSizePerspective&&(Gft(o),b6(o)),t.debugDrawLabelBorder&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(z.UV0,"vec2"),e.attributes.add(z.COLOR,"vec4"),e.attributes.add(z.SIZE,"vec2"),e.attributes.add(z.ROTATION,"float"),e.attributes.add(z.FEATUREATTRIBUTE,"vec4"),o.code.add(t.horizonCullingEnabled?E`bool behindHorizon(vec3 posModel) {
vec3 camToEarthCenter = pointDistanceSphere.xyz - localOrigin;
vec3 camToPos = pointDistanceSphere.xyz + posModel;
float earthRadius = pointDistanceSphere.w;
float a = dot(camToPos, camToPos);
float b = dot(camToPos, camToEarthCenter);
float c = dot(camToEarthCenter, camToEarthCenter) - earthRadius * earthRadius;
return  b > 0.0 && b < a && b * b  > a * c;
}`:E`bool behindHorizon(vec3 posModel) { return false; }`),o.main.add(E`
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }

      if (behindHorizon(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }

      vec2 inputSize;
      ${Te(t.hasScreenSizePerspective,E`
          inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
          vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);`,E`
          inputSize = size;
          vec2 screenOffsetScaled = screenOffset;`)}
      ${Te(t.vvSize,E`inputSize *= vvScale(featureAttribute).xx;`)}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${Te(t.occlusionTestEnabled,E`
      bool visible = testHUDVisibility(posProj);
      if (!visible) {
        vtc = vec2(0.0);
        ${Te(t.debugDrawLabelBorder,"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);")}
        return;
      }`)}
      ${Te(c,E`voccluded = visible ? 0.0 : 1.0;`)}
    `);const h=E`
      vec2 uv01 = floor(uv0);
      vec2 uv = uv0 - uv01;
      quadOffset.xy = (uv01 - anchorPosition) * 2.0 * combinedSize;

      ${Te(t.hasRotation,E`
          float angle = radians(materialRotation + rotation);
          float cosAngle = cos(angle);
          float sinAngle = sin(angle);
          mat2 rotate = mat2(cosAngle, -sinAngle, sinAngle,  cosAngle);

          quadOffset.xy = rotate * quadOffset.xy;
        `)}

      quadOffset.xy = (quadOffset.xy + screenOffsetScaled) / viewport.zw * posProj.w;
  `,d=t.pixelSnappingEnabled?i?E`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:E`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:E`posProj += quadOffset;`;o.main.add(E`
    ${h}
    ${t.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${Te(s===Y.ObjectAndLayerIdColor,E`vcolor.a = 1.0;`)}

    bool alphaDiscard = vcolor.a < ${E.float(Kr)};
    ${Te(i,`alphaDiscard = alphaDiscard && outlineColor.a < ${E.float(Kr)};`)}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${d}
      gl_Position = posProj;
    }

    vtc = uv;

    ${Te(t.debugDrawLabelBorder,E`debugBorderCoords = vec4(uv01, 1.5 / combinedSize);`)}
    vsize = inputSize;
  `),a.uniforms.add(new It("tex",g=>g.texture)),t.occludedFragmentFade&&(a.uniforms.add(new oo("depthMap",g=>g.mainDepth)),a.uniforms.add(new Un("occludedOpacity",g=>g.hudOccludedFragmentOpacity)));const f=t.debugDrawLabelBorder?E`(isBorder > 0.0 ? 0.0 : ${E.float(Kr)})`:E.float(Kr),m=E`
    ${Te(t.debugDrawLabelBorder,E`float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`)}

    ${Te(t.sampleSignedDistanceFieldTexelCenter,E`
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;`,E`vec2 samplePos = vtc;`)}

    ${i?E`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgbaTofloat(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${f} ||
          fillPixelColor.a + outlinePixelColor.a < ${E.float(Kr)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        ${Te(!l,E`fragColor = vec4(compositeColor, compositeAlpha);`)}
      } else {
        if (fillAlphaFactor < ${f}) {
          discard;
        }

        ${Te(!l,E`fragColor = premultiplyAlpha(fillPixelColor);`)}
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:E`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${f}) {
            discard;
          }
          ${Te(!l,E`fragColor = texColor * premultiplyAlpha(vcolor);`)}
          `}

    ${Te(t.occludedFragmentFade&&!l,E`
        float zSample = texelFetch(depthMap, ivec2(gl_FragCoord.xy), 0).x;
        if (zSample < gl_FragCoord.z) {
          fragColor *= occludedOpacity;
        }
        `)}

    ${Te(!l&&t.debugDrawLabelBorder,E`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`)}
  `;switch(s){case Y.Color:case Y.ColorEmission:e.outputs.add("fragColor","vec4",0),s===Y.ColorEmission&&e.outputs.add("fragEmission","vec4",1),n===Ti.ColorAlpha&&e.outputs.add("fragAlpha","float",s===Y.ColorEmission?2:1),a.main.add(E`
        ${m}
        ${Te(n===Ti.FrontFace,E`fragColor.rgb /= fragColor.a;`)}
        ${Te(s===Y.ColorEmission,E`fragEmission = vec4(0.0);`)}
        ${Te(n===Ti.ColorAlpha,E`fragAlpha = fragColor.a;`)}`);break;case Y.ObjectAndLayerIdColor:a.main.add(E`
        ${m}
        outputObjectAndLayerIdColor();`);break;case Y.Highlight:e.include(EL,t),a.main.add(E`
        ${m}
        outputHighlight(${Te(c,E`voccluded == 1.0`,E`false`)});`)}return e}function Eye(t){return t.outlineColor[3]>0&&t.outlineSize>0}function iD(t){return t.textureIsSignedDistanceField?dxt(t.anchorPosition,t.distanceFieldBoundingBox,Z5):Vn(Z5,t.anchorPosition),Z5}function dxt(t,e,i){di(i,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1])}const Z5=Ye(),pxt=Object.freeze(Object.defineProperty({__proto__:null,build:jFe,calculateAnchorPosition:iD},Symbol.toStringTag,{value:"Module"}));let fxt=class extends Hi{constructor(e,i){super(e,i,new Bi(pxt,()=>G(()=>Promise.resolve().then(()=>nHt),void 0))),this.primitiveType=i.occlusionPass?Gi.POINTS:Gi.TRIANGLES}initializePipeline(e){const{oitPass:i,hasPolygonOffset:r,draped:s,output:n,depthTestEnabled:o,occlusionPass:a}=e,l=i===Ti.NONE,c=i===Ti.ColorAlpha,h=n===Y.Highlight,d=o&&!s&&!c&&!a&&!h;return wi({blending:ws(n)?l?gM:nft(i):null,depthTest:o&&!s?{func:Ui.LEQUAL}:null,depthWrite:d?SL:null,drawBuffers:d6(i,n),colorWrite:Di,polygonOffset:r?mxt:null})}};const mxt={factor:0,units:-4};let $n=class extends Zm{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hasRotation=!1,this.debugDrawLabelBorder=!1,this.hasPolygonOffset=!1,this.depthTestEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.occlusionPass=!1,this.occludedFragmentFade=!1,this.objectAndLayerIdColorInstanced=!1,this.horizonCullingEnabled=!0,this.isFocused=!0,this.textureCoordinateType=Ys.None,this.emissionSource=Ko.None,this.discardInvisibleFragments=!0,this.hasVvInstancing=!1}};u([ie()],$n.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([ie()],$n.prototype,"occlusionTestEnabled",void 0),u([ie()],$n.prototype,"signedDistanceFieldEnabled",void 0),u([ie()],$n.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),u([ie()],$n.prototype,"vvSize",void 0),u([ie()],$n.prototype,"vvColor",void 0),u([ie()],$n.prototype,"hasVerticalOffset",void 0),u([ie()],$n.prototype,"hasScreenSizePerspective",void 0),u([ie()],$n.prototype,"hasRotation",void 0),u([ie()],$n.prototype,"debugDrawLabelBorder",void 0),u([ie()],$n.prototype,"hasPolygonOffset",void 0),u([ie()],$n.prototype,"depthTestEnabled",void 0),u([ie()],$n.prototype,"pixelSnappingEnabled",void 0),u([ie()],$n.prototype,"draped",void 0),u([ie()],$n.prototype,"terrainDepthTest",void 0),u([ie()],$n.prototype,"cullAboveTerrain",void 0),u([ie()],$n.prototype,"occlusionPass",void 0),u([ie()],$n.prototype,"occludedFragmentFade",void 0),u([ie()],$n.prototype,"objectAndLayerIdColorInstanced",void 0),u([ie()],$n.prototype,"horizonCullingEnabled",void 0),u([ie()],$n.prototype,"isFocused",void 0);let Koe=class extends h6{constructor(e,i){super(e,Ext),this.produces=new Map([[xe.HUD_MATERIAL,r=>A5(r)&&!this.parameters.drawAsLabel],[xe.LABEL_MATERIAL,r=>A5(r)&&this.parameters.drawAsLabel],[xe.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[xe.DRAPED_MATERIAL,r=>this.parameters.draped&&A5(r)]]),this._visible=!0,this._configuration=new $n(i)}getConfiguration(e,i){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.draped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.hasRotation=this.parameters.hasRotation,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=i.slot===xe.OCCLUSION_PIXELS,this._configuration.occludedFragmentFade=this.parameters.occludedFragmentFade,this._configuration.horizonCullingEnabled=this.parameters.horizonCullingEnabled,this._configuration.isFocused=this.parameters.isFocused,this._configuration.depthTestEnabled=this.parameters.depthEnabled||i.slot===xe.OCCLUSION_PIXELS,ws(e)&&(this._configuration.debugDrawLabelBorder=!!xs.LABELS_SHOW_BORDER),this._configuration.oitPass=i.oitPass,this._configuration.terrainDepthTest=i.terrainDepthTest,this._configuration.cullAboveTerrain=i.cullAboveTerrain,this._configuration}intersect(e,i,r,s,n,o){const{options:{selectionMode:a,hud:l,excludeLabels:c},point:h,camera:d}=r,{parameters:f}=this;if(!a||!l||c&&f.isLabel||!e.visible||!h)return;const{scaleX:m,scaleY:g}=this._getScreenScale(e,d.pixelRatio);sT(d9,i),e.attributes.has(z.FEATUREATTRIBUTE)&&vxt(d9);const v=e.attributes.get(z.POSITION),_=e.attributes.get(z.SIZE),b=e.attributes.get(z.NORMAL),w=e.attributes.get(z.ROTATION),x=e.attributes.get(z.CENTEROFFSETANDDISTANCE);Zt(v.size>=3);const S=iD(f),C=this.parameters.centerOffsetUnits==="screen";for(let T=0;T<v.data.length/v.size;T++){const M=T*v.size;se(Ia,v.data[M],v.data[M+1],v.data[M+2]),ot(Ia,Ia,i),ot(Ia,Ia,d.viewMatrix);const I=T*x.size;if(se(wu,x.data[I],x.data[I+1],x.data[I+2]),!C&&(Ia[0]+=wu[0],Ia[1]+=wu[1],wu[2]!==0)){const P=wu[2];ae(wu,Ia),be(Ia,Ia,re(wu,wu,P))}const D=T*b.size;if(se(wO,b.data[D],b.data[D+1],b.data[D+2]),Cye(wO,d9,d,f9),this._applyVerticalOffsetTransformationView(Ia,f9,d,h9),d.applyProjection(Ia,rl),rl[0]>-1){C&&(wu[0]||wu[1])&&(rl[0]+=wu[0]*d.pixelRatio,wu[1]!==0&&(rl[1]+=Dne(wu[1],h9.factorAlignment)*d.pixelRatio),d.unapplyProjection(rl,Ia)),rl[0]+=this.parameters.screenOffset[0]*d.pixelRatio,rl[1]+=this.parameters.screenOffset[1]*d.pixelRatio,rl[0]=Math.floor(rl[0]),rl[1]=Math.floor(rl[1]);const P=T*_.size;xc[0]=_.data[P],xc[1]=_.data[P+1],R3e(xc,h9.factor,xc);const F=xxt*d.pixelRatio;let L=0;f.textureIsSignedDistanceField&&(L=Math.min(f.outlineSize,.5*xc[0])*d.pixelRatio/2),xc[0]*=m,xc[1]*=g;const N=T*w.size,R=f.rotation+w.data[N];if($ye(h,rl[0],rl[1],xc,F,L,R,f,S)){const k=r.ray;if(ot(Aye,Ia,$l(bxt,d.viewMatrix)),rl[0]=h[0],rl[1]=h[1],d.unprojectFromRenderScreen(rl,Ia)){const W=$();ne(W,k.direction);const j=1/Ee(W);re(W,W,j),o(Sr(k.origin,Ia)*j,W,-1,!0,1,Aye)}}}}}intersectDraped(e,i,r,s,n,o){const a=e.attributes.get(z.POSITION),l=e.attributes.get(z.SIZE),c=e.attributes.get(z.ROTATION),h=this.parameters,d=iD(h),{scaleX:f,scaleY:m}=this._getScreenScale(e,e.screenToWorldRatio),g=Sxt*e.screenToWorldRatio;for(let v=0;v<a.data.length/a.size;v++){const _=v*a.size,b=a.data[_],w=a.data[_+1],x=v*l.size;xc[0]=l.data[x],xc[1]=l.data[x+1];let S=0;h.textureIsSignedDistanceField&&(S=Math.min(h.outlineSize,.5*xc[0])*e.screenToWorldRatio/2),xc[0]*=f,xc[1]*=m;const C=v*c.size,T=h.rotation+c.data[C];$ye(s,b,w,xc,g,S,T,h,d)&&n(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new $xt}_updateScaleInfo(e,i,r){const s=this.parameters;s.screenSizePerspective!=null?Ife(r,i,s.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),s.screenSizePerspectiveAlignment!=null?Ife(r,i,s.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,i,r,s,n,o,a){const l=Cye(i,r,n,f9);return this._applyVerticalGroundOffsetView(e,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(e,i,r,s,n){return this._applyCenterOffsetNDC(e,i,r,s),n!=null&&ne(n,s),this._applyPolygonOffsetNDC(s,i,r,s),s}_applyPolygonOffsetView(e,i,r,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(r);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return ne(n,e);const c=ue(Math.abs(i.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/s.viewport[2];return re(n,e,l>0?h:1/h),n}_applyVerticalGroundOffsetView(e,i,r,s){const n=Ee(e),o=r.aboveGround?1:-1,a=r.computeRenderPixelSizeAtDist(n)*zFe,l=re(Ia,i.normal,o*a);return oe(s,e,l),s}_applyVerticalOffsetTransformationView(e,i,r,s){var c;const n=this.parameters;if(!((c=n.verticalOffset)!=null&&c.screenLength)){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const h=Ee(e);this._updateScaleInfo(s,h,i.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return e}const o=Ee(e),a=n.screenSizePerspectiveAlignment??n.screenSizePerspective,l=N3e(r,o,n.verticalOffset,i.cosAngle,a);return this._updateScaleInfo(s,o,i.cosAngle),re(i.normal,i.normal,l),oe(e,e,i.normal)}_applyCenterOffsetView(e,i,r){const s=this.parameters.centerOffsetUnits!=="screen";return r!==e&&ne(r,e),s&&(r[0]+=i[0],r[1]+=i[1],i[2]&&(ae(wO,r),oe(r,r,re(wO,wO,i[2])))),r}_applyCenterOffsetNDC(e,i,r,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==e&&ne(s,e),n||(s[0]+=i[0]/r.fullWidth*2,s[1]+=i[1]/r.fullHeight*2),s}_applyPolygonOffsetNDC(e,i,r,s){const n=this.parameters.shaderPolygonOffset;if(e!==s&&ne(s,e),n){const o=r.aboveGround?1:-1,a=o*Math.sign(i[3]);s[2]-=(a||o)*n}return s}set visible(e){this._visible=e}get visible(){const{color:e,outlineSize:i,outlineColor:r}=this.parameters,s=e[3]>=Kr||i>=Kr&&r[3]>=Kr;return this._visible&&s}createGLMaterial(e){return new gxt(e)}calculateRelativeScreenBounds(e,i,r=si()){return yxt(this.parameters,e,i,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}_getScreenScale(e,i){const r=e.attributes.get(z.FEATUREATTRIBUTE);if(r==null)return{scaleX:i,scaleY:i};const s=Ase(r.data,wxt);return omt(p9,this.parameters,s),{scaleX:p9[0]*i,scaleY:p9[1]*i}}},gxt=class extends $3e{constructor(e){super({...e,...e.material.parameters})}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.getTechnique(fxt,e)}};function yxt(t,e,i,r){r[0]=t.anchorPosition[0]*-e[0]+t.screenOffset[0]*i,r[1]=t.anchorPosition[1]*-e[1]+t.screenOffset[1]*i}function Cye(t,e,i,r){return uxt(e)&&(e=sT(_xt,e)),uc(r.normal,t,e),ot(r.normal,r.normal,i.viewInverseTransposeMatrix),r.cosAngle=fe(GFe,Txt),r}function vxt(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=1/Math.sqrt(e*e+i*i+r*r),d=1/Math.sqrt(s*s+n*n+o*o),f=1/Math.sqrt(a*a+l*l+c*c);return t[0]=e*h,t[1]=i*h,t[2]=r*h,t[3]=s*d,t[4]=n*d,t[5]=o*d,t[6]=a*f,t[7]=l*f,t[8]=c*f,t}function $ye(t,e,i,r,s,n,o,a,l){let c=e-s-r[0]*l[0],h=c+r[0]+2*s,d=i-s-r[1]*l[1],f=d+r[1]+2*s;const m=a.distanceFieldBoundingBox;return a.textureIsSignedDistanceField&&m!=null&&(c+=r[0]*m[0],d+=r[1]*m[1],h-=r[0]*(1-m[2]),f-=r[1]*(1-m[3]),c-=n,h+=n,d-=n,f+=n),di(Mye,e,i),OMe(xO,t,Mye,At(o)),xO[0]>c&&xO[0]<h&&xO[1]>d&&xO[1]<f}const h9=new BFe,Ia=$(),wO=$(),rl=yi(),GFe=$(),Aye=$(),xO=Ye(),Mye=Ye(),d9=Ts(),_xt=Ts(),bxt=qe(),wu=$(),p9=$(),wxt=yi(),f9={normal:GFe,cosAngle:0},xxt=1,Sxt=2,xc=[0,0],Txt=De(0,0,1);let Ext=class extends A3e{constructor(){super(...arguments),this.renderOccluded=Cr.Occlude,this.isDecoration=!1,this.color=D3(1,1,1,1),this.polygonOffset=!1,this.anchorPosition=fn(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=D3(1,1,1,1),this.outlineSize=0,this.distanceFieldBoundingBox=yi(),this.rotation=0,this.hasRotation=!1,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.occludedFragmentFade=!1,this.horizonCullingEnabled=!1,this.centerOffsetUnits="world",this.drawAsLabel=!1,this.depthEnabled=!0,this.isFocused=!0,this.focusEffect="none",this.draped=!1,this.isLabel=!1}};const HFe=Bd().vec3f(z.POSITION).vec3f(z.NORMAL).vec2f(z.UV0).vec4u8(z.COLOR).vec2f(z.SIZE).f32(z.ROTATION).vec4f(z.CENTEROFFSETANDDISTANCE).vec4f(z.FEATUREATTRIBUTE),Cxt=HFe.clone().vec4u8(z.OBJECTANDLAYERIDCOLOR);class $xt{constructor(){this.vertexBufferLayout=Dd()?Cxt:HFe}elementCount(e){return 6*e.get(z.POSITION).indices.length}write(e,i,r,s,n,o){var w,x;Bne(r.get(z.POSITION),e,n.position,o,6),Vne(r.get(z.NORMAL),i,n.normal,o,6);const a=(w=r.get(z.UV0))==null?void 0:w.data;let l=0,c=0,h=1,d=1;a&&a.length>=4&&(l=a[0],c=a[1],h=a[2],d=a[3]),h=Math.min(1.99999,h+1),d=Math.min(1.99999,d+1);let f=r.get(z.POSITION).indices.length,m=o;const g=n.uv0;for(let S=0;S<f;++S)g.set(m,0,l),g.set(m,1,c),m++,g.set(m,0,h),g.set(m,1,c),m++,g.set(m,0,h),g.set(m,1,d),m++,g.set(m,0,h),g.set(m,1,d),m++,g.set(m,0,l),g.set(m,1,d),m++,g.set(m,0,l),g.set(m,1,c),m++;tDe(r.get(z.COLOR),4,n.color,o,6);const{data:v,indices:_}=r.get(z.SIZE);f=_.length;const b=n.size;m=o;for(let S=0;S<f;++S){const C=v[2*_[S]],T=v[2*_[S]+1];for(let M=0;M<6;++M)b.set(m,0,C),b.set(m,1,T),m++}if(xft(r.get(z.ROTATION),n.rotation,o,6),r.get(z.CENTEROFFSETANDDISTANCE)?j3(r.get(z.CENTEROFFSETANDDISTANCE),n.centerOffsetAndDistance,o,6):Nfe(n.centerOffsetAndDistance,o,6*f),r.get(z.FEATUREATTRIBUTE)?j3(r.get(z.FEATUREATTRIBUTE),n.featureAttribute,o,6):Nfe(n.featureAttribute,o,6*f),s!=null){const S=(x=r.get(z.POSITION))==null?void 0:x.indices;if(S){const C=S.length,T=n.getField(z.OBJECTANDLAYERIDCOLOR,lg);iDe(s,T,C,o,6)}}}}const kf=$(),ek=$(),aE=yi(),SO=yi(),m9=$(),Oye=qe(),Axt=Ls(),g9=Nn(),Mxt=$(),Oxt=si();class Ixt{constructor(){this.aabr=si(),this.distance=0,this.distanceToTerrain=0,this.culled=!1,this.visible=!1}}class Rxt{constructor(e,i){this.graphics3DGraphic=e,this.slicePlaneEnabled=i,this.info={}}}var Fc;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(Fc||(Fc={}));class Pxt{constructor(){this.camera=new qr,this.slicePlane=lw(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),lT(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let bx=class extends he{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._viewState=new Pxt,this._state=Fc.Idle,this._active=new Map,this._visible=new Map,this._iterators=new Fxt,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0,this._updatingHandles=new rv}destroy(){this._updatingHandles.destroy(),this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==Fc.Idle||this._dirty||this._updatingHandles.updating}get updatingProgress(){if(!this.updating)return 1;const t=this._state/Fc.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case Fc.Idle:this._startUpdate(),t.madeProgress();case Fc.Process:if(this._state=Fc.Process,!this._processActiveGraphics(t))return;case Fc.Sort:if(this._state=Fc.Sort,!this._sortVisibleGraphics(t))return;case Fc.Deconflict:if(this._state=Fc.Deconflict,!this._deconflictVisibleGraphics(t))return;default:sxt(this,this._visible),this._state=Fc.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(i=>this.addToActiveGraphics(i)):t.forEach(i=>this.removeFromActiveGraphics(i)),this.setDirty()}layerSupportsDeconfliction(t){if(t==null||t.type!=="object3d")return!1;const e=t.stageObject;if(((e==null?void 0:e.geometries.length)??0)!==1)return!1;const i=e==null?void 0:e.geometries[0];return(i==null?void 0:i.material)instanceof Koe}_startUpdate(){nxt(this.view),this._dirty=!1,this._viewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._viewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new Ixt,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),Dxt(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_createTerrainIntersector(){const t=ph(this.view.state.viewingMode);t.options.store=Co.MIN;const e=this.view.basemapTerrain,i=this.view.state.camera;return mc(Oye,this._viewState.camera.viewInverseTransposeMatrix),r=>{ot(ek,r,Oye),t.reset(i.eye,ek,i),e.intersect(t,null,i.eye,ek);const s=t.results.ground.dist;return s!=null?s*Sr(ek,i.eye):0}}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),i=this._viewState.camera.inverseProjectionMatrix,r=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._viewState.camera.relativeElevation>0,s=X("enable-feature:non-occluded-hud")&&this.view.map.ground.opacity>0?this._createTerrainIntersector():null,n=r?Axt:null;let o=0;for(n!=null&&(ot(n,cn,this._viewState.camera.viewMatrix),n[3]=yr(this.view.spatialReference).radius,o=GRe(n,cn));!t.done;){t.madeProgress();const a=e.next();if(a.done===!0)return this._resetActiveGraphicsIterator(),!0;const l=a.value,c=l==null?void 0:l.info[this.visibilityGroup];c&&(this._collectGraphics3DGraphics(l,i,n,o,s),c.culled?(this._setGraphicVisibility(l,!1),this._visible.delete(l.graphics3DGraphic.graphic.uid)):this._visible.set(l.graphics3DGraphic.graphic.uid,l))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const i=e.next();if(t.madeProgress(),i.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),i=this.visibilityGroup===wo.LABEL;for(;!t.done;){t.madeProgress();const r=e.next();if(r.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=r.value,n=s.info[this.visibilityGroup];if(!n||n.culled){this._setGraphicVisibility(s,!1);continue}const o=s.graphics3DGraphic,a=!i||o.isVisible();n.visible=a&&!this._isConflicted(s),n.visible&&this._addToBins(s),this._setGraphicVisibility(s,n.visible),axt(n,n.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=Iye(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=Iye(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=Lxt(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,i,r,s){const n=t.graphics3DGraphic;if(n.destroyed)return;const o=t.info[this.visibilityGroup];if(!n.isVisible(wo.GRAPHIC,wa.DECONFLICTION))return void(o.culled=!0);const a=this.getGraphicsLayers(n);yv(o.aabr);let l=null;for(const c of a){if(!this.layerSupportsDeconfliction(c))continue;const h=c.stageObject.geometries[0].material;if(l==null){if(l=Bxt,this._getProjectionInfo(c,e,l),l.isOutsideScreen||this._isCulledBySlice(t,kf)||i!=null&&Uxt(l,i,r))return void(o.culled=!0);l.distanceToTerrain=(s==null?void 0:s(l.positionView))??0}this._expandBoundingRect(o,c,h,l)}l==null?o.culled=!0:(o.distance=l.distance,o.distanceToTerrain=l.distanceToTerrain,o.culled=!1)}_getProjectionInfo(t,e,i){const r=this._viewState.camera,s=t.stageObject,n=s.geometries[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;ot(kf,a,r.viewMatrix);const l=n.attributes,c=l.get(z.NORMAL).data,h=l.get(z.CENTEROFFSETANDDISTANCE).data;o.applyShaderOffsetsView(kf,c,s.transformation,h,r,i.scaleInfo,kf),ss(aE,kf[0],kf[1],kf[2],1),eu(SO,aE,r.projectionMatrix),re(i.positionNDC,SO,1/SO[3]),o.applyShaderOffsetsNDC(i.positionNDC,h,r,i.positionNDC,m9),i.distanceWithoutPolygonOffset=r.depthNDCToWorld(m9[2]),i.distance=m9[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:r.depthNDCToWorld(i.positionNDC[2]),ss(SO,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),eu(aE,SO,e),hA(aE,aE,1/aE[3]),se(i.positionView,kf[0],kf[1],kf[2])}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._viewState.slicePlaneEnabled&&Bse(this._viewState.slicePlane,e)}_expandBoundingRect(t,e,i,{positionNDC:r,scaleInfo:s}){const{fullWidth:n,fullHeight:o,pixelRatio:a}=this._viewState.camera,l=e.getScreenSize(kxt);R3e(l,s.factor,l),l[0]*=a,l[1]*=a;const c=DU(i.calculateRelativeScreenBounds(l,s.factorAlignment.scale*a,Oxt),ft(0,n,.5+.5*r[0]),ft(0,o,.5+.5*r[1])),h=this.marginFactor;if(h!==0){const d=h*Math.min(Jo(c),El(c));c[0]-=d,c[1]-=d,c[2]+=d,c[3]+=d}kC(t.aabr,c,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,i=t.info[this.visibilityGroup];let r=!0;for(let s=Math.floor(i.aabr[0]/this._accBinsSizeX);s<=Math.floor(i.aabr[2]/this._accBinsSizeX);s++)if(!(s<0||s>=this._accBinsNumX))for(let n=Math.floor(i.aabr[1]/this._accBinsSizeY);n<=Math.floor(i.aabr[3]/this._accBinsSizeY);n++){if(n<0||n>=this._accBinsNumY)continue;r=!1;const o=this._accBins[s][n];for(let a=0;a<o.length;a++){const l=o.data[a],c=l.info[this.visibilityGroup];if(c&&c.visible&&l.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,y3(c.aabr,i.aabr)))return!0}}return r}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let i=0;i<this._accBinsNumX;i++){this._accBins.push([]);const r=this._accBins[this._accBins.length-1];for(let s=0;s<this._accBinsNumY;s++)r.push(new ii)}}else for(let i=0;i<this._accBinsNumX;i++)for(let r=0;r<this._accBinsNumY;r++)this._accBins[i][r].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],i=Math.floor(e.aabr[0]/this._accBinsSizeX),r=Math.floor(e.aabr[2]/this._accBinsSizeX),s=Math.floor(e.aabr[1]/this._accBinsSizeY),n=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let o=i;o<=r;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(t)}_setGraphicVisibility(t,e){const i=t.graphics3DGraphic;i.destroyed||(i.setVisibilityFlag(this.visibilityGroup,wa.DECONFLICTION,e),this.visibilityGroup===wo.LABEL&&this.view.labeler.setLabelGraphicVisibility(i,e))}};function Dxt(t,e){const i=t.graphics3DGraphic;i.destroyed||i.setVisibilityFlag(e,wa.DECONFLICTION,!0)}function*Iye(t){if(Map.prototype.entries){const e=t.entries();for(let i=e.next();!i.done;i=e.next())yield i.value[1]}else yield*t.values()}function*Lxt(t,e,i){e.clear(),t.forEach((s,n)=>{var l;const o=e.pushNew();o.id=n,o.visible=s.graphics3DGraphic.getVisibilityFlag(i,wa.DECONFLICTION);const a=(l=s.info)==null?void 0:l[i];o.prio=s.graphics3DGraphic.deconflictionPriority,o.distance=a?a.distance:Number.MAX_VALUE,o.behindTerrain=!!a&&a.distanceToTerrain!==0&&a.distance>a.distanceToTerrain}),yield;const r=e.iterableSort((s,n)=>s.behindTerrain!==n.behindTerrain?+s.behindTerrain-+n.behindTerrain:s.prio!==n.prio?n.prio-s.prio:s.distance!==n.distance?s.distance-n.distance:s.visible!==n.visible?+n.visible-+s.visible:s.id-n.id);for(let s=r.next();!s.done;s=r.next())yield;e.forAll(s=>{const n=t.get(s.id);n&&(t.delete(s.id),t.set(s.id,n))}),e.clear()}u([p({constructOnly:!0})],bx.prototype,"view",void 0),u([p({type:Boolean,readOnly:!0})],bx.prototype,"updating",null),u([p({readOnly:!0})],bx.prototype,"_updatingHandles",void 0),bx=u([A("esri.views.3d.layers.graphics.Deconflictor")],bx);class Nxt{constructor(){this.id=0,this.visible=!1,this.behindTerrain=!1,this.prio=0,this.distance=0}}class Fxt{constructor(e=null,i=null,r=null){this.active=e,this.visible=i,this.sort=r,this.sortArray=new ii({allocator:s=>s||new Nxt})}}const kxt=Ye();class zxt{constructor(){this.positionView=$(),this.positionNDC=$(),this.distance=0,this.distanceToTerrain=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new BFe}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1||e[2]>=1}}function Uxt(t,e,i){return ne(g9.direction,t.positionView),se(g9.origin,0,0,0),!!cw(e,g9,Mxt)&&t.distanceWithoutPolygonOffset>i}const Bxt=new zxt,Vxt=2e3;let Y5=class extends bx{constructor(e){super(e),this.visibilityGroup=wo.LABEL,this.marginFactor=.05,this._lastDeconfliction=0}initialize(){this._updatingHandles.add(()=>{var e,i,r;return(((r=(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.ground)==null?void 0:r.opacity)??0)===0},()=>this.setDirty())}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return ea;const i=performance.now();if(e.state!==ui.IDLE&&i-this._lastDeconfliction<Vxt)return ea;super.runTask(e),this.state===Fc.Idle&&(this._lastDeconfliction=i)}enabledChanged(e,i){this.modifyGraphics(i,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};u([p({constructOnly:!0})],Y5.prototype,"parent",void 0),Y5=u([A("esri.views.3d.layers.graphics.LabelDeconflictor")],Y5);let kK=class extends bx{constructor(){super(...arguments),this._contexts=new Map,this.visibilityGroup=wo.GRAPHIC,this._marginFactor=-.1,this.test={overrideMarginFactor:e=>{this._marginFactor=e,this.setDirty()}}}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._updatingHandles.add(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.state)==null?void 0:i.camera},()=>{this._updateViewState(),this.setDirty()}),this._updatingHandles.add(()=>{var e,i,r;return((r=(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.ground)==null?void 0:r.opacity)===1},()=>this.setDirty()),this._updatingHandles.add(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},Ut),this._frameTask=this.view.resourceController.scheduler.registerTask(lt.GRAPHICS_DECONFLICTOR,this),this._labels=new Y5({view:this.view,parent:this})}destroy(){this._labels=$e(this._labels),this._frameTask=Ji(this._frameTask)}get marginFactor(){return this._marginFactor}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}_updateViewState(){var e;(e=this.view)!=null&&e.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;e!=null&&NRe(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){for(const e of this._contexts.keys())if(e.symbolCreationContext.slicePlaneEnabled)return void this.setDirty()}addGraphicsOwner(e){const i=this._getGraphicsContext(e);return{addGraphic:r=>this._addGraphic(e,i,r),removeGraphic:r=>this._removeGraphic(i,r),labelingInfoChange:()=>this._labels.enabledChanged(e,i),featureReductionChange:()=>this.enabledChanged(e,i),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,i),clear:()=>i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic)),remove:()=>this._removeGraphicsOwner(e),setDirty:()=>this.setDirty()}}_removeGraphicsOwner(e){const i=this._contexts.get(e);i&&(i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,i,r){const s=r.graphic.uid,n=new Rxt(r,e.symbolCreationContext.slicePlaneEnabled);i.set(s,n),y9(e)&&this.addToActiveGraphics(n),e.labelsEnabled&&this._labels.addToActiveGraphics(n);const o=!this._graphicSupportsDeconfliction(r)||!y9(e);r.setVisibilityFlag(wo.GRAPHIC,wa.DECONFLICTION,o)}_removeGraphic(e,i){const r=i.graphic.uid,s=e.get(r);s&&(this.removeFromActiveGraphics(s),this._labels.removeFromActiveGraphics(s),e.delete(r),this.setDirty())}enabledChanged(e,i){const r=y9(e);r||jxt(e),this.modifyGraphics(i,r)}_slicePlaneEnabledChanged(e,i){const r=e.symbolCreationContext.slicePlaneEnabled;i.forEach(s=>s.slicePlaneEnabled=r),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const i=e.layers;if(!(i!=null&&i.length))return!1;for(const r of i)if(this.layerSupportsDeconfliction(r))return!0;return!1}_getGraphicsContext(e){const i=this._contexts.get(e);if(i)return i;const r=new Map;return this._contexts.set(e,r),this.setDirty(),r}};function y9(t){const e=t.layer;return!(!(e!=null&&e.featureReduction)||e.featureReduction.type!=="selection")}function jxt(t){const e=t.graphics3DGraphics;e&&e.forEach(i=>i.setVisibilityFlag(wo.GRAPHIC,wa.DECONFLICTION,!0))}kK=u([A("esri.views.3d.layers.graphics.GraphicsDeconflictor")],kK);const Qoe="__begin__",eae="__end__",Gxt=new RegExp(Qoe,"ig"),Hxt=new RegExp(eae,"ig"),Rye=new RegExp("^"+Qoe,"i"),Pye=new RegExp(eae+"$","i"),sV='"',qxt=sV+" + ",Wxt=" + "+sV;function Zxt(t){return t.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function Yxt(t){return t.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function B6(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=Zxt(t.labelExpression),e.type="conventional"),e}function Jxt(t){const e=B6(t);switch(e.type){case"conventional":return zK(e.expression);case"arcade":return e.expression}return null}function Xxt(t){const e=B6(t);switch(e.type){case"conventional":return Qxt(e.expression);case"arcade":return tae(e.expression)}return null}function zK(t){let e;return t?(e=PD(t,i=>Qoe+'$feature["'+i+'"]'+eae),e=Rye.test(e)?e.replace(Rye,""):sV+e,e=Pye.test(e)?e.replace(Pye,""):e+sV,e=e.replaceAll(Gxt,qxt).replaceAll(Hxt,Wxt)):e='""',e}const Kxt=/^\s*\{([^}]+)\}\s*$/i;function Qxt(t){const e=t==null?void 0:t.match(Kxt);return(e==null?void 0:e[1].trim())||null}const eSt=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*$/i,tSt=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,iSt=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(.+)(\1)\s*\));?\s*$/i;function tae(t){if(!t)return null;let e=eSt.exec(t)||tSt.exec(t);return e?e[1]||e[3]:(e=iSt.exec(t),e?e[2]:null)}const v9=()=>J.getLogger("esri.layers.support.labelFormatUtils"),_9={type:"simple",evaluate:()=>null},rSt={getAttribute:(t,e)=>t.field(e)};async function sSt(t,e,i){if(!t||!t.symbol||!e)return _9;const r=t.where,s=B6(t);let n;if(s.type==="arcade"){const o=K$e(s.expression),a=e.get(o);if(a&&(cAe(a)||gG(a)||Mre(a)))n={type:"simple",evaluate(l){var h;const c="attributes"in l?(h=l.attributes)==null?void 0:h[a.name]:l.field(a.name);return c==null?"":c.toString()}};else{const l=await _Xe(s.expression,i,e);if(l==null)return _9;n={type:"arcade",evaluate(c,h){try{const d="attributes"in c?l.repurposeFeature(c):c;d.contextTimeZone=h??null;const f=l.evaluate({$view:{timeZone:h},$feature:d},l.services);if(f!=null)return f.toString()}catch(d){v9().error(new U("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:d,feature:c,expression:s}))}return null},needsHydrationToEvaluate:()=>tae(s.expression)==null}}}else n={type:"simple",evaluate:o=>s.expression.replaceAll(/{[^}]*}/g,a=>{var d;const l=a.slice(1,-1),c=e.get(l);if(!c)return a;let h=null;return h="attributes"in o?(d=o==null?void 0:o.attributes)==null?void 0:d[c.name]:o.field(c.name),h==null?"":nSt(h,c)})};if(r){let o;try{o=await Cre(r,e)}catch(l){return v9().error(new U("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:r,error:l})),_9}const a=n.evaluate;n.evaluate=(l,c)=>{const h="attributes"in l?void 0:rSt;try{if(o.testFeature(l,h))return a(l,c)}catch(d){v9().error(new U("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:r,feature:l,error:d}))}return null}}return n}function nSt(t,e){if(t==null)return"";const i=e.domain;if(i){if(i.type==="codedValue"||i.type==="coded-value"){const s=t;for(const n of i.codedValues)if(n.code===s)return n.name}else if(i.type==="range"){const{max:s,min:n}=cXe(e),o=+t;if(n!=null&&s!=null&&n<=o&&o<=s)return i.name}}let r=t;return uAe(e)?r=rG(r,P7e("short-date")):gG(e)&&(r=JD(+r)),r||""}function Vsi(t,e,i,r,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!Soe(l))continue;const{update:c,averageGeometrySampledElevation:h}=WFe(l,e,i,r,s);a+=h,c&&n.geometryVertexAttributeUpdated(l,z.POSITION)}return a/o.length}function oSt(t,e,i,r,s,n){const o=t.stageObject,a=e.centerPointInElevationSR;let l=0;o.usesVerticalDistanceToGround?(r(a,ic),$Pe(o,ic.verticalDistanceToGround),l=ic.sampledElevation):(r(a,ic),e.mode!=="absolute-height"&&(l=ic.sampledElevation));const c=_n(aSt,n??o.transformation),h=se(qFe,c[12],c[13],c[14]);xs.TESTS_DISABLE_OPTIMIZATIONS?(tc[0]=a.x,tc[1]=a.y,tc[2]=ic.z,cT(a.spatialReference,tc,c,s.spatialReference)&&(n?_n(n,c):o.transformation=c)):s.setAltitudeOfTransformation(ic.z,c);const d=iae/s.unitInMeters;return(Math.abs(c[12]-h[0])>=d||Math.abs(c[13]-h[1])>=d||Math.abs(c[14]-h[2])>=d)&&(n?_n(n,c):o.transformation=c),l}const aSt=qe();function jsi(t,e,i,r,s){const n=t.graphics3DSymbolLayer.lodRenderer;if(n==null)return 0;const o=e.centerPointInElevationSR;r(o,ic);const a=e.mode!=="absolute-height"?ic.sampledElevation:0,l=n.instanceData,c=t.instanceIndex,h=lSt;l.getGlobalTransform(c,h);const d=se(qFe,h[12],h[13],h[14]);xs.TESTS_DISABLE_OPTIMIZATIONS?(tc[0]=o.x,tc[1]=o.y,tc[2]=ic.z,cT(o.spatialReference,tc,h,s.spatialReference)&&l.setGlobalTransform(c,h)):s.setAltitudeOfTransformation(ic.z,h);const f=iae/s.unitInMeters;return(xs.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(h[12]-d[0])>=f||Math.abs(h[13]-d[1])>=f||Math.abs(h[14]-d[2])>=f)&&l.setGlobalTransform(c,h),a}function Gsi(t,e,i,r,s){const n=t.stageObject,o=n.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,h=!1;for(const d of o){if(!Soe(d))continue;const f=d.attributes.get(z.POSITION);if(f!==l){const{update:m,averageGeometrySampledElevation:g}=WFe(d,e,i,r,s);c=g,l=f,h=m}h&&n.geometryVertexAttributeUpdated(d,z.POSITION),a+=c}return a/o.length}const iae=.01,tc=$(),Ch=$(),lE=$(),lSt=qe(),qFe=$(),ic=new Qse;function WFe(t,e,i,r,s){let n=!1;const o=t.transformation,a=e.requiresSampledElevationInfo;Ch[0]=o[12],Ch[1]=o[13],Ch[2]=o[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute(z.POSITION),c=l.data,h=l.size,d=c.length/h,f=new TPe(t.mapPositions,i);let m=0,g=0;for(let v=0;v<d;v++){if(lE[0]=c[m],lE[1]=c[m+1],lE[2]=c[m+2],r(f,ic),a&&(g+=ic.sampledElevation),xs.TESTS_DISABLE_OPTIMIZATIONS)c[m]=f.array[f.offset],c[m+1]=f.array[f.offset+1],c[m+2]=ic.z,Gn(c,i,m,c,s.spatialReference,m,1),c[m]-=Ch[0],c[m+1]-=Ch[1],c[m+2]-=Ch[2],n=!0;else{tc[0]=c[m]+Ch[0],tc[1]=c[m+1]+Ch[1],tc[2]=c[m+2]+Ch[2],s.setAltitude(tc,ic.z),c[m]=tc[0]-Ch[0],c[m+1]=tc[1]-Ch[1],c[m+2]=tc[2]-Ch[2];const _=iae/s.unitInMeters;(Math.abs(lE[0]-c[m])>=_||Math.abs(lE[1]-c[m+1])>=_||Math.abs(lE[2]-c[m+2])>=_)&&(n=!0)}m+=h,f.offset+=3}return g/=d,{update:n,averageGeometrySampledElevation:g}}let cSt=class{constructor(e,i,r){this.graphic=e,this.renderingInfo=i,this.layer=r}},uSt=class{constructor(e,i=null){this.labelText=i,this.elevationOffset=e??0}};function hSt(t,e,i,r,s){if(ZFe(t,e))return null;i.localOrigin=pSt(t,e);const n=new foe({geometries:[i],castShadow:!1,layerUid:t.layer.uid,graphicUid:s,usesVerticalDistanceToGround:!0});return{object:n,sampledElevation:CPe(n,e,t.elevationProvider,t.renderCoordsHelper,r)}}function Wsi(t,e,i,r){return ZFe(e,i)?null:CPe(t,i,e.elevationProvider,e.renderCoordsHelper,r)}function ZFe(t,e){const i=t.clippingExtent;return!!i&&(gc(e,pb,t.elevationProvider.spatialReference),!LKe(i,pb))}function dSt(t,e,i){const r=t.elevationContext,s=i.spatialReference;gc(e,pb,s),r.centerPointInElevationSR=uT(pb[0],pb[1],e.hasZ?pb[2]:0,s??null)}function Zsi(t){switch(t.type){case"point":return t;case"polygon":case"extent":return QG(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const i=gEe(e,mEe(e)/2);return uT(i[0],i[1],i[2],t.spatialReference)}case"mesh":return t.extent.center}return null}function pSt(t,e){return gc(e,pb,t.renderCoordsHelper.spatialReference),t.localOriginFactory.getOrigin(pb)}const pb=$();function fSt(t){t.include(Sg),t.uniforms.add(new oo("geometryDepthTexture",e=>{var i;return(i=e.geometryDepth)==null?void 0:i.attachment})),t.code.add(E`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos);
return (elementDepth < (geometryDepth - 1.0));
}`)}function YFe(t){const e=new Vi,{vertex:i,fragment:r}=e,{terrainDepthTest:s}=t;return i.include(U6),e.include(UFe,t),e.vertex.include(aDe,t),e.attributes.add(z.UV0,"vec2"),i.uniforms.add(new Va("viewport",n=>n.camera.fullViewport),new mt("lineSize",(n,o)=>n.size>0?Math.max(1,n.size)*o.camera.pixelRatio:0),new $v("pixelToNDC",n=>di(Dye,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new mt("borderSize",(n,o)=>n.borderColor?o.camera.pixelRatio:0),new yc("screenOffset",(n,o)=>di(Dye,n.horizontalScreenOffset*o.camera.pixelRatio,0))),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),s&&e.varyings.add("depth","float"),t.occlusionTestEnabled&&e.include(VFe),t.hasScreenSizePerspective&&b6(i),i.main.add(E`
    ProjectHUDAux projectAux;
    vec4 endPoint = projectPositionHUD(projectAux);

    vec3 vpos = projectAux.posModel;
    if (rejectBySlice(vpos)) {
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    }
    ${Te(t.occlusionTestEnabled,E`if (!testHUDVisibility(endPoint)) {
             gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
             return;
           }`)}

    ${t.hasScreenSizePerspective?E`vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
               vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);`:"vec2 screenOffsetScaled = screenOffset;"}
    // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
    // correct depth value
    vec3 posView = (view * vec4(position, 1.0)).xyz;
    ${Te(s,"depth = posView.z;")}

    applyHUDViewDependentPolygonOffset(centerOffsetAndDistance.w, projectAux.absCosAngle, posView);
    vec4 startPoint = proj * vec4(posView, 1.0);

    // Apply screen offset to both start and end point
    vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
    startPoint.xy += screenOffsetNorm * startPoint.w;
    endPoint.xy += screenOffsetNorm * endPoint.w;

    // Align start and end to pixel origin
    vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
    vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${Te(t.hudDepth,t.hudDepthAlignStart?"endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);":"startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);")}
    vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);

    // The direction of the line in screen space
    vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
    vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?E`float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
               float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);`:E`float lineSizeScaled = lineSize;
               float borderSizeScaled = borderSize;`}
    float halfPixelSize = lineSizeScaled * 0.5;

    // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
    float padding = 1.0 + borderSizeScaled;
    vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

    // Offset x/y from the center of the line in screen space
    projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

    // Compute a coverage varying which we can use in the fragment shader to determine
    // how much a pixel is actually covered by the line (i.e. to anti alias the line).
    // This works by computing two coordinates that can be linearly interpolated and then
    // subtracted to find out how far away from the line edge we are.
    float edgeDirection = (uv0.x * 2.0 - 1.0);

    float halfBorderSize = 0.5 * borderSizeScaled;
    float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
    float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

    float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

    coverageSampling = vec4(
      // Edge coordinate
      outerEdgeCoverageSampler,

      // Border edge coordinate
      outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

      // Line offset
      halfPixelSize - 0.5,

      // Border offset
      halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
    );

    lineSizes = vec2(lineSizeScaled, borderSizeScaled);
    gl_Position = projectedPosition;`),r.uniforms.add(new pc("uColor",n=>n.color??an),new pc("borderColor",n=>n.borderColor??an)),s&&(r.include(fSt,t),r.uniforms.add(new $v("inverseViewport",n=>n.inverseViewport))),r.main.add(E`
    ${Te(s,"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }")}

    vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

    float borderAlpha = uColor.a * borderColor.a * coverage.y;
    float colorAlpha = uColor.a * coverage.x;

    float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);
    ${Te(!t.hudDepth,E`vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
           fragColor = vec4(finalRgb, finalAlpha);`)}`),e}const Dye=Ye(),mSt=Object.freeze(Object.defineProperty({__proto__:null,build:YFe},Symbol.toStringTag,{value:"Module"}));let gSt=class extends Hi{constructor(e,i){super(e,i,new Bi(mSt,()=>G(()=>Promise.resolve().then(()=>oHt),void 0)))}initializePipeline(e){const{hudDepth:i,terrainDepthTest:r}=e,s={func:r?Ui.ALWAYS:Ui.LESS};return wi(i?{depthTest:s,depthWrite:SL}:{blending:hw(Bt.ONE,Bt.SRC_ALPHA,Bt.ONE_MINUS_SRC_ALPHA,Bt.ONE_MINUS_SRC_ALPHA),depthTest:s,colorWrite:Di})}},o_=class extends Zm{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hudDepth=!1,this.hudDepthAlignStart=!1,this.terrainDepthTest=!1,this.draped=!1}};u([ie()],o_.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([ie()],o_.prototype,"occlusionTestEnabled",void 0),u([ie()],o_.prototype,"hasVerticalOffset",void 0),u([ie()],o_.prototype,"hasScreenSizePerspective",void 0),u([ie()],o_.prototype,"hudDepth",void 0),u([ie()],o_.prototype,"hudDepthAlignStart",void 0),u([ie()],o_.prototype,"terrainDepthTest",void 0);let b9=class extends h6{constructor(e,i){super(e,JFe),this.produces=new Map([[xe.LINE_CALLOUTS,r=>ws(r)],[xe.LINE_CALLOUTS_HUD_DEPTH,r=>ws(r)]]),this._configuration=new o_(i),this._uniqueMaterialIdentifier=UK(this.parameters)}passParameters(){return this.parameters}getConfiguration(e,i){const r=i.slot===xe.LINE_CALLOUTS_HUD_DEPTH;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hudDepth=r,this._configuration.hudDepthAlignStart=!!this.parameters.hudDepthAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.terrainDepthTest=i.terrainDepthTest,this._configuration}get visible(){var e;return this.parameters.color[3]>=Kr||(((e=this.parameters.borderColor)==null?void 0:e[3])??0)>=Kr}intersect(){}createGLMaterial(e){return new ySt(e)}createBufferWriter(){return new _St}validateParameters(e){this._uniqueMaterialIdentifier=UK(e)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}};function UK({renderOccluded:t,isDecoration:e,horizontalScreenOffset:i,color:r,size:s,occlusionTest:n,shaderPolygonOffset:o,hudDepthAlignStart:a,centerOffsetUnits:l,hasSlicePlane:c,screenSizePerspective:h,verticalOffset:d,borderColor:f}){return eje`${t}:${e}:${i}:[${r}]:${s}:${n}:${o}:${a}:${l}:${c}:${h!=null}:{${d.screenLength}:${d.minWorldLength}:${d.maxWorldLength}}:[${f}]`}let ySt=class extends Rne{beginSlot(e){return this.getTechnique(gSt,e)}},JFe=class extends Dpt{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=Yi(0,0,0,1),this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.hudDepthAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const vSt=Bd().vec3f(z.POSITION).vec3f(z.NORMAL).vec2f(z.UV0).vec4f(z.CENTEROFFSETANDDISTANCE),Lye=[sd(0,0),sd(1,0),sd(0,1),sd(1,0),sd(1,1),sd(0,1)];let _St=class{constructor(){this.vertexBufferLayout=vSt}elementCount(e){return 6*e.get(z.POSITION).indices.length}write(e,i,r,s,n,o){Bne(r.get(z.POSITION),e,n.position,o,6),Vne(r.get(z.NORMAL),i,n.normal,o,6),j3(r.get(z.CENTEROFFSETANDDISTANCE),n.centerOffsetAndDistance,o,6);for(let a=0;a<Lye.length;++a)n.uv0.setVec(o+a,Lye[a])}},XFe=class KFe extends jDe{constructor(e,i){super(e,null,i,xSt),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new b9(this._materialParameters,this._context.spherical),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}_perInstanceMaterialParameters(e){const i=this._materialParameters;return i.horizontalScreenOffset=e.horizontalScreenOffset??0,i.centerOffsetUnits=e.centerOffsetUnits||"world",i}get _materialParameters(){var o;const e=new JFe,i=this.symbol,r=i.callout;if(r.color){const a=Je.toUnitRGBA(r.color);a[3]*=this._getLayerOpacity(),e.color=a}else e.color=an;if(e.size=xS(r.size||0),i.verticalOffset){const{screenLength:a,minWorldLength:l,maxWorldLength:c}=i.verticalOffset;e.verticalOffset={screenLength:xS(a),minWorldLength:l||0,maxWorldLength:c??1/0}}e.borderColor=((o=r.border)==null?void 0:o.color)!=null?Je.toUnitRGBA(r.border.color):null;const s=i.symbolLayers.at(0).type==="object",n=i.type==="label-3d";return e.occlusionTest=!s&&!X("enable-feature:non-occluded-hud"),s&&(e.shaderPolygonOffset=0),e.hudDepthAlignStart=n,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return wSt}createGraphics3DGraphic(e){const i=e.renderingInfo,r=e.graphic,s=this.setGraphicElevationContext(r,new xB,i.elevationOffset||0),n=i.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!oQe(l)))return null;const a=QG(r.geometry);return a==null?null:this._createAs3DShape(a,s,i,r.uid)}layerOpacityChanged(){var e;(e=this._materials[0])==null||e.setParameters(this._materialParameters)}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=Tut(KFe.elevationModeChangeTypes,r,s);return n!==qm.UPDATE||e.forEach(o=>{const a=i(o);a!=null&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){var e;return(e=this._materials[0])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,i,r=0){return super.setGraphicElevationContext(e,i),i.addOffsetRenderUnits(r),i}updateGraphicElevationContext(e,i){const{elevationContext:r,metadata:s}=i;this.setGraphicElevationContext(e,r,(s==null?void 0:s.elevationOffset)??0),i.needsElevationUpdates=ife(r.mode)}computeComplexity(){return new kp({verticesPerFeature:6})}_getOrCreateMaterial(e){var s;const i=this._perInstanceMaterialParameters(e),r=UK(i);if(r===((s=this._materials[0])==null?void 0:s.uniqueMaterialIdentifier))return{material:this._materials[0],isUnique:!1};if(e.materialCollection!=null){let n=e.materialCollection.get(r);return n==null&&(n=new b9(i,this._context.spherical),e.materialCollection.add(r,n)),{material:n,isUnique:!1}}return{material:new b9(i,this._context.spherical),isUnique:!0}}_createAs3DShape(e,i,r,s){const n=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:n}),a=this._getOrCreateMaterial(r),l=new $a(a.material,bSt(r),null,zn.Point,o),c=hSt(this._context,e,l,i,s);if(c==null)return null;const h=new ene(this,c.object,[l],a.isUnique?[a.material]:null,null,oSt,i);return h.metadata=new uSt(r.elevationOffset),h.alignedSampledElevation=c.sampledElevation,h.needsElevationUpdates=ife(i.mode),dSt(h,e,this._context.elevationProvider),h}};function bSt(t){const{translation:e,centerOffset:i}=t,r=new Qt(e?[e[0],e[1],e[2]]:[0,0,0],w9,3,!0),s=new Qt(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],w9,4,!0);return[[z.POSITION,r],[z.NORMAL,new Qt([0,0,1],w9,3,!0)],[z.CENTEROFFSETANDDISTANCE,s]]}XFe.elevationModeChangeTypes={definedChanged:qm.UPDATE,staysOnTheGround:qm.UPDATE,onTheGroundChanged:qm.RECREATE};const w9=[0],wSt={mode:"relative-to-ground",offset:0},xSt={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let SSt=class extends Yse{constructor(e,i,r=$(),s=yi(),n=0,o="world",a=0,l=null){super(e,i),this.translation=r,this.centerOffset=s,this.horizontalScreenOffset=n,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}},TSt=class extends cSt{};const Nye=()=>J.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function ESt(t,e){if(!jAe(t))return Nye().error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const i=CSt[t.callout.type];return i?new i(t,e):(Nye().error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const CSt={line:XFe};function rni(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance,1,1]:[1,1,1,1],translate:t.extent!=null?[t.extent.xmin,t.extent.ymax,t.extent.zmin??0,t.extent.mmin??0]:[0,0,0,0]}:null}function $St(t){return t.originPosition==="lowerLeft"&&t.scale.length===4&&t.translate.length===4}function yT(t){if($St(t))return t;const{originPosition:e,scale:i,translate:r}=t,s=i[0]??1,n=i[1]??1;return{originPosition:"lowerLeft",scale:[s,e==="lowerLeft"?n:-n,i[2]??1,i[3]??1],translate:[r[0]??0,r[1]??0,r[2]??0,r[3]??0]}}function Dv({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function Lv({scale:t,translate:e},i){return Math.round((i-e[1])/t[1])}function rD({scale:t,translate:e},i){return Math.round(((i??0)-e[2])/t[2])}function sD({scale:t,translate:e},i){return i?Math.round((i-e[3])/t[3]):0}function QFe(t,e){return t&&e?ISt:t&&!e?MSt:!t&&e?OSt:ASt}const ASt=(t,e)=>{const i=[];if(!e.length)return null;const r=e[0];let s=Dv(t,r[0]),n=Lv(t,r[1]);i.push([s,n]);for(let o=1;o<e.length;o++){const[a,l]=e[o],c=Dv(t,a),h=Lv(t,l);c===s&&h===n||i.push([c-s,h-n]),s=c,n=h}return i},MSt=(t,e)=>{const i=[];if(!e.length)return null;const r=e[0];let s=Dv(t,r[0]),n=Lv(t,r[1]),o=rD(t,r[2]);i.push([s,n,o]);for(let a=1;a<e.length;a++){const[l,c,h]=e[a],d=Dv(t,l),f=Lv(t,c),m=rD(t,h);d===s&&f===n&&m===o||i.push([d-s,f-n,m]),s=d,n=f,o=m}return i},OSt=(t,e)=>{const i=[];if(!e.length)return null;const r=e[0];let s=Dv(t,r[0]),n=Lv(t,r[1]),o=sD(t,r[2]);i.push([s,n,o]);for(let a=1;a<e.length;a++){const[l,c,h]=e[a],d=Dv(t,l),f=Lv(t,c),m=sD(t,h);d===s&&f===n&&m===o||i.push([d-s,f-n,m]),s=d,n=f,o=m}return i},ISt=(t,e)=>{const i=[];if(!e.length)return null;const r=e[0];let s=Dv(t,r[0]),n=Lv(t,r[1]),o=rD(t,r[2]),a=sD(t,r[3]);i.push([s,n,o,a]);for(let l=1;l<e.length;l++){const[c,h,d,f]=e[l],m=Dv(t,c),g=Lv(t,h),v=rD(t,d),_=sD(t,f);m===s&&g===n&&v===o&&_===a||i.push([m-s,g-n,v,_]),s=m,n=g,o=v,a=_}return i};function RSt(t,e,i,r){const s=[],n=QFe(i,r);for(let o=0;o<e.length;o++){const a=n(t,e[o]);a&&a.length>=3&&s.push(a)}return s.length?s:null}function PSt(t,e,i,r){const s=[],n=QFe(i,r);for(let o=0;o<e.length;o++){const a=n(t,e[o]);a&&a.length>=2&&s.push(a)}return s.length?s:null}function FL({scale:t,translate:e},i){return i*t[0]+e[0]}function kL({scale:t,translate:e},i){return i*t[1]+e[1]}function nD({scale:t,translate:e},i){return(i??0)*t[2]+e[2]}function oD({scale:t,translate:e},i){return i?i*t[3]+e[3]:0}function rae(t,e){return t&&e?FSt:t&&!e?LSt:!t&&e?NSt:DSt}const DSt=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=FL(t,r[0]),n=kL(t,r[1]);i[0]=[s,n];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let h=1;h<e.length;h++){const[d,f]=e[h];s+=l*d,n+=c*f,i[h]=[s,n]}return i},LSt=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=FL(t,r[0]),n=kL(t,r[1]);i[0]=[s,n,nD(t,r[2])];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let h=1;h<e.length;h++){const[d,f,m]=e[h];s+=l*d,n+=c*f,i[h]=[s,n,nD(t,m)]}return i},NSt=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=FL(t,r[0]),n=kL(t,r[1]);i[0]=[s,n,oD(t,r[2])];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let h=1;h<e.length;h++){const[d,f,m]=e[h];s+=l*d,n+=c*f,i[h]=[s,n,oD(t,m)]}return i},FSt=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=FL(t,r[0]),n=kL(t,r[1]);i[0]=[s,n,nD(t,r[2]),oD(t,r[3])];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let h=1;h<e.length;h++){const[d,f,m,g]=e[h];s+=l*d,n+=c*f,i[h]=[s,n,nD(t,m),oD(t,g)]}return i};function eke(t,e,i){const r=new Array(i.length);for(let s=0;s<i.length;s++)r[s]=e(t,i[s]);return r}function sni(t,e,i){const r=yT(t);return e.x=Dv(r,i.x),e.y=Lv(r,i.y),i.z!=null&&(e.z=rD(r,i.z)),i.m!=null&&(e.m=sD(r,i.m)),e}function nni(t,e,i){const r=RSt(yT(t),i.rings,i.hasZ,i.hasM);return r?(e.rings=r,e.hasZ=i.hasZ??!1,e.hasM=i.hasM??!1,e):null}function oni(t,e,i){const r=PSt(yT(t),i.paths,i.hasZ,i.hasM);return r?(e.paths=r,e.hasZ=i.hasZ??!1,e.hasM=i.hasM??!1,e):null}function kSt(t,e,i,r=(i==null?void 0:i.hasZ)??!1,s=(i==null?void 0:i.hasM)??!1){if(i!=null){const n=yT(t);e.points=rae(r,s)(n,i.points),e.hasZ=r,e.hasM=s}return e}function zSt(t,e,i,r=(i==null?void 0:i.z)!=null,s=(i==null?void 0:i.m)!=null){if(i==null)return e;const n=yT(t);return e.x=FL(n,i.x),e.y=kL(n,i.y),r&&(e.z=nD(n,i.z)),s&&(e.m=oD(n,i.m)),e}function USt(t,e,i,r=(i==null?void 0:i.hasZ)??!1,s=(i==null?void 0:i.hasM)??!1){if(i!=null){const n=yT(t);e.rings=eke(n,rae(r,s),i.rings),e.hasZ=r,e.hasM=s}return e}function BSt(t,e,i,r=(i==null?void 0:i.hasZ)??!1,s=(i==null?void 0:i.hasM)??!1){if(i!=null){const n=yT(t);e.paths=eke(n,rae(r,s),i.paths),e.hasZ=r,e.hasM=s}return e}function ani(){return X("curve-densification-coarse-segments")}function VSt(){return X("curve-densification-max-segments")}function lni(){return X("curve-densification-min-segments")}function cni(){return X("curve-densification-pixels-per-segment")}let uni=class{constructor(e,i,r){this.uid=e,this.geometry=i,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}};function dni(t){return t.geometry!=null}let pni=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function mni(t,e){var h;const i=FEe.fromJSON(t.geometryType),r=Oe.fromJSON(t.spatialReference),s=t.transform,n=t.objectIdFieldName,o=e==null?void 0:e.maxStringAttributeLength,a=e==null?void 0:e.maxStringAttributeFields;let l;const c=t.features.map(d=>{const f=jSt(d,i,r,t.objectIdFieldName),m=f.geometry;if(ZSt(f.attributes,a,o,g=>{l??(l=[]);const v=WSt(f,n);v!=null&&l.push({objectId:v,attribute:g})}),m!=null&&s)switch(m.type){case"point":f.geometry=zSt(s,m,m);break;case"multipoint":f.geometry=kSt(s,m,m);break;case"polygon":f.geometry=USt(s,m,m);break;case"polyline":f.geometry=BSt(s,m,m);break;case"extent":case"mesh":f.geometry=m}return f});return{geometryType:i,features:c,spatialReference:r,fields:((h=t.fields)==null?void 0:h.map(d=>CG.fromJSON(d)))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null,missingAttributes:l}}function jSt(t,e,i,r){return{uid:Td(),objectId:r&&t.attributes?t.attributes[r]:null,attributes:t.attributes,geometry:GSt(t.geometry,e,i),visible:!0}}function GSt(t,e,i){if(t==null)return null;switch(e){case"point":{const r=t;return{x:r.x,y:r.y,z:r.z,m:r.m,hasZ:r.z!=null,hasM:r.m!=null,type:"point",spatialReference:i}}case"polyline":{const r=t;return{paths:r.paths,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polyline",spatialReference:i}}case"polygon":{const r=t;return{rings:r.rings,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const r=t;return{points:r.points,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"multipoint",spatialReference:i}}}}function HSt(t){if(t==null)return 0;switch(t.type){case"point":return By+10+8+24;case"polyline":case"polygon":{let e=0;const i=2+(t.hasZ?1:0)+(t.hasM?1:0),r=t.type==="polyline"?t.paths:t.rings,s=t.type==="polyline"?t.curvePaths:t.curveRings;if(s!=null&&s.length){const n=3*VSt()*128;e=8*n*i+128*n+32*(r.length+1)}else e=TB(r);return By+64+e+34}case"multipoint":{const e=TB(t.points);return By+e+64+34+32}case"extent":return By+10+64+34;case"mesh":{const e=t.vertexAttributes;return By+t6(e.position,e.normal,e.uv,e.tangent)}default:return By}}function gni(t){let e=32;return e+=tne(t.attributes),e+=3,e+=8+HSt(t.geometry),e}function yni(t){if(t==null)return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const i of t.paths)e+=i.length;return e}case"polygon":{let e=0;for(const i of t.rings)e+=i.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function vni(t){if(t==null)return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function _ni(t,e){switch(bf(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let i=0;i<t.paths.length;i++)f8(e,t.paths[i],!!t.hasZ);break;case"polygon":for(let i=0;i<t.rings.length;i++)f8(e,t.rings[i],!!t.hasZ);break;case"multipoint":f8(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function qSt(t,e){switch(yv(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let i=0;i<t.paths.length;i++)UH(e,t.paths[i]);break;case"polygon":for(let i=0;i<t.rings.length;i++)UH(e,t.rings[i]);break;case"multipoint":UH(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function WSt(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}function ZSt(t,e,i,r){if(e!=null&&e.size&&i!=null&&t)for(const s in t){if(!e.has(s))continue;const n=t[s];typeof n=="string"&&n.length>i&&(r(s),t[s]="")}}function sae(t,e){return t?e?4:3:e?3:2}function YSt(t,e,i,r){if(!(e!=null&&e.lengths.length))return null;t.lengths.length&&(t.lengths.length=0),t.coords.length&&(t.coords.length=0);const s=t.coords,n=[],o=i?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:a,coords:l}=e,c=sae(i,r);let h=0;for(const d of a){const f=JSt(o,l,h,d,i,r);f&&n.push(f),h+=d*c}if(n.sort((d,f)=>{let m=d[2]-f[2];return m===0&&i&&(m=d[4]-f[4]),m}),n.length){let d=6*n[0][2];s[0]=n[0][0]/d,s[1]=n[0][1]/d,i&&(d=6*n[0][4],s[2]=d!==0?n[0][3]/d:0),(s[0]<o[0]||s[0]>o[1]||s[1]<o[2]||s[1]>o[3]||i&&(s[2]<o[4]||s[2]>o[5]))&&(s.length=0)}if(!s.length){const d=e.lengths[0]?XSt(l,0,a[0],i,r):null;if(!d)return null;s[0]=d[0],s[1]=d[1],i&&d.length>2&&(s[2]=d[2])}return t}function JSt(t,e,i,r,s,n){const o=sae(s,n);let a=i,l=i+o,c=0,h=0,d=0,f=0,m=0;for(let v=0,_=r-1;v<_;v++,a+=o,l+=o){const b=e[a],w=e[a+1],x=e[a+2],S=e[l],C=e[l+1],T=e[l+2];let M=b*C-S*w;f+=M,c+=(b+S)*M,h+=(w+C)*M,s&&(M=b*T-S*x,d+=(x+T)*M,m+=M),b<t[0]&&(t[0]=b),b>t[1]&&(t[1]=b),w<t[2]&&(t[2]=w),w>t[3]&&(t[3]=w),s&&(x<t[4]&&(t[4]=x),x>t[5]&&(t[5]=x))}if(f>0&&(f*=-1),m>0&&(m*=-1),!f)return null;const g=[c,h,.5*f];return s&&(g[3]=d,g[4]=.5*m),g}function XSt(t,e,i,r,s){const n=sae(r,s);let o=e,a=e+n,l=0,c=0,h=0,d=0;for(let f=0,m=i-1;f<m;f++,o+=n,a+=n){const g=t[o],v=t[o+1],_=t[o+2],b=t[a],w=t[a+1],x=t[a+2],S=r?QSt(g,v,_,b,w,x):KSt(g,v,b,w);if(S)if(l+=S,r){const C=tTt(g,v,_,b,w,x);c+=S*C[0],h+=S*C[1],d+=S*C[2]}else{const C=eTt(g,v,b,w);c+=S*C[0],h+=S*C[1]}}return l>0?r?[c/l,h/l,d/l]:[c/l,h/l]:i>0?r?[t[e],t[e+1],t[e+2]]:[t[e],t[e+1]]:null}function KSt(t,e,i,r){const s=i-t,n=r-e;return Math.sqrt(s*s+n*n)}function QSt(t,e,i,r,s,n){const o=r-t,a=s-e,l=n-i;return Math.sqrt(o*o+a*a+l*l)}function eTt(t,e,i,r){return[t+.5*(i-t),e+.5*(r-e)]}function tTt(t,e,i,r,s,n){return[t+.5*(r-t),e+.5*(s-e),i+.5*(n-i)]}const Yw=2;let nu=class h2{constructor(e=[],i=[]){this.lengths=e??[],this.coords=i??[]}static fromJSON(e){return new h2(e.lengths,e.coords)}static fromRect(e){const[i,r,s,n]=e,o=s-i,a=n-r;return new h2([5],[i,r,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0&&this.coords.length>=2}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,i)=>e+i)}get usedMemory(){return 64+t6(this.lengths,this.coords)}area(){let e=0,i=0;if(!this.lengths.length)return 0;for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];if(s<3)continue;let n=this.coords[Yw*i],o=this.coords[Yw*i+1];for(let a=1;a<s;a+=1){const l=this.coords[Yw*(a+i)],c=this.coords[Yw*(a+i)+1];e+=-.5*(l-n)*(c+o),n=l,o=c}i+=s}return e}forEachVertex(e){let i=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];for(let n=0;n<s;n++)e(this.coords[Yw*(n+i)],this.coords[Yw*(n+i)+1]);i+=s}}deltaDecode(){const e=this.clone(),{coords:i,lengths:r}=e;let s=0;for(const n of r){for(let o=1;o<n;o++)i[2*(s+o)]+=i[2*(s+o)-2],i[2*(s+o)+1]+=i[2*(s+o)-1];s+=n}return e}clone(e){if(this.lengths.length===0)return new h2([],[this.coords[0],this.coords[1]]);const i=(this.lengths.length===0?1:this.lengths.reduce((s,n)=>s+n))*Yw,r=this.coords.slice(0,i);return e?(e.set(r),new h2(this.lengths,e)):new h2(Array.from(this.lengths),Array.from(r))}},$A=class J5{constructor(e=null,i={},r,s,n=0){this.geometry=e,this.attributes=i,this.centroid=r,this.objectId=s,this.displayId=n}static fromJSON(e){const i=e.geometry?nu.fromJSON(e.geometry):null,r=e.centroid?nu.fromJSON(e.centroid):null,s=e.objectId;return new J5(i,e.attributes,r,s)}weakClone(){const e=new J5(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e}clone(){var r,s;const e=(r=this.geometry)==null?void 0:r.clone(),i=new J5(e,{...this.attributes},(s=this.centroid)==null?void 0:s.clone(),this.objectId);return i.displayId=this.displayId,i}ensureCentroid(e){return this.centroid??(this.centroid=YSt(new nu,this.geometry,e.hasZ,e.hasM)),this.centroid}get usedMemory(){var e;return 128+tne(this.attributes)+(((e=this.geometry)==null?void 0:e.usedMemory)??0)}};function bni(t){var e,i;return!!((i=(e=t.geometry)==null?void 0:e.coords)!=null&&i.length)}let iTt=class tke{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new tke;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}};function Ca(t,e){return t?e?4:3:e?3:2}const zL=()=>J.getLogger("esri.layers.graphics.featureConversionUtils"),nae={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryMultiPatch:3,esriGeometryEnvelope:0},rTt=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n},Fye=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+2]},sTt=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+3]},nTt=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+2],t[i+3]=e[r+3]};function oae(t,e,i,r){if(t){if(i)return e&&r?nTt:Fye;if(e&&r)return sTt}else if(e&&r)return Fye;return rTt}function x9({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function S9({scale:t,translate:e},i){return Math.round((e[1]-i)/t[1])}function T9({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function E9({scale:t,translate:e},i){return Math.round((i-e[1])/t[1])}function C9({scale:t,translate:e},i,r){return i*t[r]+e[r]}function wni(t,e,i){return t?e?i?cae(t):aae(t):i?lae(t):V6(t):null}function V6(t){const e=t.coords;return{x:e[0],y:e[1]}}function ike(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function aae(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function oTt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function lae(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function aTt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function cae(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function lTt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function cTt(t,e,i,r){let s=V6;i&&r?s=cae:i?s=aae:r&&(s=lae);for(const n of e){const{geometry:o,attributes:a}=n,l=o!=null?s(o):null;t.push({attributes:a,geometry:l})}return t}function uae(t,e){return t&&e?lTt:t?oTt:e?aTt:ike}function uTt(t,e,i,r,s){const n=uae(i,r);for(const{geometry:o,attributes:a}of e){const l=o!=null?n(new nu,o):null;t.push(new $A(l,a,null,s?a[s]:void 0))}return t}function hTt(t,e,i=uae(e.z!=null,e.m!=null)){return i(t,e)}function dTt(t,e,i,r){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?rke(s,i,r):null});return t}function rke(t,e,i){if(t==null)return null;const r=Ca(e,i),s=[];for(let n=0;n<t.coords.length;n+=r){const o=[];for(let a=0;a<r;a++)o.push(t.coords[n+a]);s.push(o)}return e?i?{points:s,hasZ:e,hasM:i}:{points:s,hasZ:e}:i?{points:s,hasM:i}:{points:s}}function pTt(t,e,i,r,s){const n=Ca(i,r);for(const{geometry:o,attributes:a}of e){const l=o!=null?ske(new nu,o,n):null;t.push(new $A(l,a,null,s?a[s]:void 0))}return t}function ske(t,e,i=Ca(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const r=t.coords;let s=0;for(const n of e.points)for(let o=0;o<i;o++)r[s++]=n[o];return t}function fTt(t,e,i,r){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?nke(s,i,r):null});return t}function nke(t,e,i){if(!t)return null;const r=Ca(e,i),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const d=[];for(let f=0;f<r;f++)d.push(s[a++]);c.push(d)}o.push(c)}return e?i?{paths:o,hasZ:e,hasM:i}:{paths:o,hasZ:e}:i?{paths:o,hasM:i}:{paths:o}}function mTt(t,e,i,r,s){const n=Ca(i,r);for(const{geometry:o,attributes:a,centroid:l}of e){const c=o!=null?oke(new nu,o,n):null,h=l!=null?hTt(new nu,l):null;t.push(new $A(c,a,h,s?a[s]:void 0))}return t}function oke(t,e,i=Ca(e.hasZ,e.hasM)){const{lengths:r,coords:s}=t;let n=0;for(const o of e.paths){for(const a of o)for(let l=0;l<i;l++)s[n++]=a[l];r.push(o.length)}return t}function gTt(t,e,i,r){for(const{geometry:s,attributes:n,centroid:o}of e){const a=s!=null?ake(s,i,r):null;if(o!=null){const l=V6(o);t.push({attributes:n,centroid:l,geometry:a})}else t.push({attributes:n,geometry:a})}return t}function ake(t,e,i){if(!t)return null;const r=Ca(e,i),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const d=[];for(let f=0;f<r;f++)d.push(s[a++]);c.push(d)}o.push(c)}return e?i?{rings:o,hasZ:e,hasM:i}:{rings:o,hasZ:e}:i?{rings:o,hasM:i}:{rings:o}}function yTt(t,e,i,r,s){for(const{geometry:n,centroid:o,attributes:a}of e){const l=n!=null?lke(new nu,n,i,r):null,c=s?a[s]:void 0;o!=null?t.push(new $A(l,a,ike(new nu,o),c)):t.push(new $A(l,a,null,c))}return t}function lke(t,e,i=e.hasZ,r=e.hasM){return vTt(t,e.rings,i,r)}function vTt(t,e,i,r){const s=Ca(i,r),{lengths:n,coords:o}=t;let a=0;dv(t);for(const l of e){for(const c of l)for(let h=0;h<s;h++)o[a++]=c[h];n.push(l.length)}return t}const c$=[],CP=[];function xni(t,e,i,r,s){c$[0]=t;const[n]=cke(CP,c$,e,i,r,s);return Sf(c$),Sf(CP),n}function cke(t,e,i,r,s,n){if(Sf(t),!i){for(const o of e){const a=n?o.attributes[n]:void 0;t.push(new $A(null,o.attributes,null,a))}return t}switch(i){case"esriGeometryPoint":return uTt(t,e,r,s,n);case"esriGeometryMultipoint":return pTt(t,e,r,s,n);case"esriGeometryPolyline":return mTt(t,e,r,s,n);case"esriGeometryPolygon":case"esriGeometryMultiPatch":return yTt(t,e,r,s,n);default:zL().error("convertToFeatureSet:unknown-geometry",new U(`Unable to parse unknown geometry type '${i}'`)),Sf(t)}return t}function Sni(t,e,i,r){CP[0]=t,uke(c$,CP,e,i,r);const s=c$[0];return Sf(c$),Sf(CP),s}function _Tt(t,e,i){if(t==null)return null;const r=new nu;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&i==null&&(i=t.hasM),Bie(t)?uae(e??t.z!=null,i??t.m!=null)(r,t):wb(t)?lke(r,t,e,i):Jj(t)?oke(r,t,Ca(e,i)):Uie(t)?ske(r,t,Ca(e,i)):void zL().error("convertFromGeometry:unknown-geometry",new U(`Unable to parse unknown geometry type '${t}'`))}function bTt(t,e,i,r){const s=t&&("coords"in t?t:t.geometry);if(s==null)return null;switch(e){case"esriGeometryPoint":{let n=V6;return i&&r?n=cae:i?n=aae:r&&(n=lae),n(s)}case"esriGeometryMultipoint":return rke(s,i,r);case"esriGeometryPolyline":return nke(s,i,r);case"esriGeometryPolygon":return ake(s,i,r);default:return zL().error("convertToGeometry:unknown-geometry",new U(`Unable to parse unknown geometry type '${e}'`)),null}}function wTt(t,e){for(const i of e)t.push({attributes:i.attributes});return t}function uke(t,e,i,r,s){if(Sf(t),i==null)return wTt(t,e);switch(i){case"esriGeometryPoint":return cTt(t,e,r,s);case"esriGeometryMultipoint":return dTt(t,e,r,s);case"esriGeometryPolyline":return fTt(t,e,r,s);case"esriGeometryPolygon":return gTt(t,e,r,s);default:zL().error("convertToFeatureSet:unknown-geometry",new U(`Unable to parse unknown geometry type '${i}'`))}return t}function Tni(t){const{objectIdFieldName:e,spatialReference:i,transform:r,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:h,queryGeometry:d,queryGeometryType:f}=t,m={features:uke([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:e,spatialReference:i,uniqueIdField:h,queryGeometry:bTt(d,f,!1,!1)};return r&&(m.transform=r),c&&(m.exceededTransferLimit=c),n&&(m.hasM=n),o&&(m.hasZ=o),m}function Eni(t,e){const i=new iTt,{hasM:r,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:h,fields:d}=t;return d&&(i.fields=d),i.geometryType=l??null,i.objectIdFieldName=o??e??null,i.spatialReference=a??null,i.objectIdFieldName?(n&&cke(i.features,n,l,s,r,i.objectIdFieldName),c&&(i.exceededTransferLimit=c),r&&(i.hasM=r),s&&(i.hasZ=s),h&&(i.transform=h),i):(zL().error(new U("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function Cni(t){const{transform:e,features:i,hasM:r,hasZ:s}=t;if(!e)return t;for(const n of i)n.geometry!=null&&zye(n.geometry,n.geometry,r,s,e),n.centroid!=null&&zye(n.centroid,n.centroid,r,s,e);return t.transform=null,t}function $ni(t,e){const{geometryType:i,features:r,hasM:s,hasZ:n}=e;if(!t)return e;for(let o=0;o<r.length;o++){const a=r[o],l=a.weakClone();l.geometry=new nu,kye(l.geometry,a.geometry,s,n,i,t),a.centroid&&(l.centroid=new nu,kye(l.centroid,a.centroid,s,n,"esriGeometryPoint",t)),r[o]=l}return e.transform=t,e}function kye(t,e,i,r,s,n,o=i,a=r){if(dv(t),!(e!=null&&e.coords.length))return null;const l=nae[s],{coords:c,lengths:h}=e,d=Ca(i,r),f=Ca(i&&o,r&&a),m=oae(i,r,o,a);if(!h.length)return m(t.coords,c,0,0,x9(n,c[0]),S9(n,c[1])),dv(t,d,0),t;let g,v,_,b,w=0,x=0,S=x;for(const C of h){if(C<l)continue;let T=0;x=S,_=g=x9(n,c[w]),b=v=S9(n,c[w+1]),m(t.coords,c,x,w,_,b),T++,w+=d,x+=f;for(let M=1;M<C;M++,w+=d)_=x9(n,c[w]),b=S9(n,c[w+1]),_===g&&b===v||(m(t.coords,c,x,w,_-g,b-v),x+=f,T++,g=_,v=b);T>=l&&(t.lengths.push(T),S=x)}return Sf(t.coords,S),t.coords.length?t:null}function Ani(t,e,i,r,s,n,o=i,a=r){if(dv(t),!(e!=null&&e.coords.length))return null;const l=nae[s],{coords:c,lengths:h}=e,d=Ca(i,r),f=Ca(i&&o,r&&a),m=oae(i,r,o,a);if(!h.length)return m(t.coords,c,0,0,c[0],c[1]),dv(t,d,0),t;let g=0;const v=n*n;for(const _ of h){if(_<l){g+=_*d;continue}const b=t.coords.length/f,w=g,x=g+(_-1)*d;m(t.coords,c,t.coords.length,w,c[w],c[w+1]),BK(t.coords,c,d,v,m,w,x),m(t.coords,c,t.coords.length,x,c[x],c[x+1]);const S=t.coords.length/f-b;S>=l?t.lengths.push(S):Sf(t.coords,b*f),g+=_*d}return t.coords.length?t:null}function xTt(t,e,i,r){const s=t[e],n=t[e+1],o=t[i],a=t[i+1],l=t[r],c=t[r+1];let h=o,d=a,f=l-h,m=c-d;if(f!==0||m!==0){const g=((s-h)*f+(n-d)*m)/(f*f+m*m);g>1?(h=l,d=c):g>0&&(h+=f*g,d+=m*g)}return f=s-h,m=n-d,f*f+m*m}function BK(t,e,i,r,s,n,o){let a,l=r,c=0;for(let h=n+i;h<o;h+=i)a=xTt(e,h,n,o),a>l&&(c=h,l=a);l>r&&(c-n>i&&BK(t,e,i,r,s,n,c),s(t,e,t.length,c,e[c],e[c+1]),o-c>i&&BK(t,e,i,r,s,c,o))}function Mni(t,e,i,r){var c;if(!((c=e==null?void 0:e.coords)!=null&&c.length))return null;const s=Ca(i,r);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const h=e.coords;for(let d=0;d<h.length;d+=s){const f=h[d],m=h[d+1];n=Math.min(n,f),a=Math.max(a,f),o=Math.min(o,m),l=Math.max(l,m)}}return OY(t)?zKe(t,n,o,a,l):Nie(n,o,a,l,t),t}function zye(t,e,i,r,s){const{coords:n,lengths:o}=e,a=Ca(i,r);if(!n.length)return t!==e&&dv(t),t;Fj(s);const{originPosition:l,scale:c,translate:h}=s,d=ETt;d.originPosition=l;const f=d.scale;f[0]=c[0]??1,f[1]=-(c[1]??1),f[2]=c[2]??1,f[3]=c[3]??1;const m=d.translate;if(m[0]=h[0]??0,m[1]=h[1]??0,m[2]=h[2]??0,m[3]=h[3]??0,!o.length){for(let v=0;v<a;++v)t.coords[v]=C9(d,n[v],v);return t!==e&&dv(t,a,0),t}let g=0;for(let v=0;v<o.length;v++){const _=o[v];t.lengths[v]=_;for(let x=0;x<a;++x)t.coords[g+x]=C9(d,n[g+x],x);let b=t.coords[g],w=t.coords[g+1];g+=a;for(let x=1;x<_;x++,g+=a){b+=n[g]*f[0],w+=n[g+1]*f[1],t.coords[g]=b,t.coords[g+1]=w;for(let S=2;S<a;++S)t.coords[g+S]=C9(d,n[g+S],S)}}return t!==e&&dv(t,n.length,o.length),t}function Oni(t,e,i,r,s,n){if(dv(t),t.lengths.push(...e.lengths),i===s&&r===n)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=Ca(i,r),a=oae(i,r,s,n),l=e.coords;for(let c=0;c<l.length;c+=o)a(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function STt(t,e,i,r){let s=0,n=t[r*e],o=t[r*(e+1)];for(let a=1;a<i;a++){const l=n+t[r*(e+a)],c=o+t[r*(e+a)+1],h=(l-n)*(c+o);n=l,o=c,s+=h}return .5*s}function Ini(t,e){const{coords:i,lengths:r}=t;let s=0,n=0;for(let o=0;o<r.length;o++){const a=r[o];n+=STt(i,s,a,e),s+=a}return Math.abs(n)}function TTt(t,e,i,r){return t*r-i*e===0&&t*i+e*r>0}function Rni(t,e,i,r,s){const n=Ca(r,s);if(!t.lengths.length){if(t.coords.length<2)return null;const[d,f]=t.coords,m=T9(e,d),g=E9(e,f);return new nu([],[m,g])}const o=new nu([],[0,0]),a=nae[i],l=i==="esriGeometryPolygon"||i==="esriGeometryPolyline";let c=0,h=0;for(let d=0;d<t.lengths.length;d++){const f=t.lengths[d],m=h;let g=T9(e,t.coords[n*c]),v=E9(e,t.coords[n*c+1]);o.coords[h++]=g,o.coords[h++]=v;let _=0,b=0,w=1;for(let x=1;x<f;x++){const S=T9(e,t.coords[n*(x+c)]),C=E9(e,t.coords[n*(x+c)+1]);if(S!==g||C!==v){const T=S-g,M=C-v;l&&TTt(_,b,T,M)?(o.coords[h-2]+=T,o.coords[h-1]+=M,g+=T,v+=M):(o.coords[h++]=S,o.coords[h++]=C,g=S,v=C,_=T,b=M,w+=1)}}w<a?h=m:o.lengths.push(w),c+=f}return o.lengths.length===0?null:o}function dv(t,e=0,i=0){Sf(t.lengths,i),Sf(t.coords,e)}function Sf(t,e=0){t.length!==e&&(t.length=e)}const ETt={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},Uye=new Ol(Array,t=>bG(t,IAe),null,10,5),CTt=si();let $Tt=class{get labelLayers(){return this._labelLayers||ZVe}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e==null?void 0:e.isElevationSource)}constructor(e,i,r,s,n){this.graphic=e,this.graphics3DSymbol=i,this.layers=r,this._visibleFlags=wa.ALL_LABEL,this.deconflictionPriority=0,++i.referenced,this._featureExpressionFeature=n?hPe(n,e,s):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(i=>{i.initialize(e),i.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,i){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(i),e.setVisibility(this.isVisible(wo.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(i=>{i.type==="draped"&&(e=!0)}),e}isVisible(e=wo.GRAPHIC,i){const r=i?this._visibleFlags|i|wo.LABEL*i:this._visibleFlags;return e===wo.GRAPHIC?(r&wa.ALL_GRAPHIC)===wa.ALL_GRAPHIC:(r&wa.ALL_LABEL)===wa.ALL_LABEL}setVisibilityFlag(e,i,r){const s=this.isVisible(e);r?this._visibleFlags|=e*i:this._visibleFlags&=~(e*i);const n=this.isVisible(e);if(s===n)return!1;if(e===wo.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible(wo.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}getVisibilityFlag(e,i){return!!(this._visibleFlags&e*i)}computeExtent(e){if(!this._extent){const i=this.graphic.geometry;if(i==null)return!1;this._extent=si(),qSt(i,this._extent);const r=i.spatialReference;if(!as(r,e)&&!Ese(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,i){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,i)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,i,r){let s=e.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=Ea.fromExtent(s.type==="mesh"?s.extent:s)),_Tt(s,i,r)}get usedMemory(){let e=tne(this.graphic.attributes);return this._forEachSymbolLayerGraphic(i=>e+=i.graphics3DSymbolLayer.usedMemory),e}computeAttachmentOrigin(){const e={render:{origin:$(),num:0},draped:{origin:Ye(),num:0}};for(const i of this.layers)i!=null&&i.computeAttachmentOrigin(e);return e.render.num>1&&re(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&md(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,i,r,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?bf(n.boundingBox):n.boundingBox=bf(),n.requiresDrapedElevation=!1,await jie(this.layers,async o=>{if(o==null)return;const a=o.type==="draped"?i:e,l=Uye.acquire(),c=await o.getProjectedBoundingBox(a,r,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&CAe(n.boundingBox,l),Uye.release(l)}),PKe(n.boundingBox)||cZ(MAe(n.boundingBox,CTt))?n:null}needsElevationUpdates(){var e;for(const i of this.layers)if(i!=null&&(i.type==="object3d"||i.type==="lod-instance")&&i.needsElevationUpdates)return!0;return((e=this._labelLayers)==null?void 0:e.some(i=>(i==null?void 0:i.needsElevationUpdates)??!1))??!1}alignWithElevation(e,i,r){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(e,i,this._featureExpressionFeature,r)})}alignWithAbsoluteElevation(e,i,r){this._forEachRenderedGraphic(s=>{s.type==="object3d"&&s.alignWithAbsoluteElevation(e,i,r)})}addObjectStateSet(e){this._forEachSymbolLayerGraphic(i=>i.addObjectState(e))}removeObjectState(e){this._forEachSymbolLayerGraphic(i=>i.removeObjectState(e))}updateHighlights(e){this._forEachSymbolLayerGraphic(i=>i.updateHighlights(e))}_forEachGraphicList(e,i){e==null||e.forEach(r=>r&&i(r))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this.labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){}},Dni=class{constructor(e,i){this.scheduler=e,this.schedule=i,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}get spherical(){return this.stage.view.state.viewingMode===je.Global}get doublePrecisionRequiresObfuscation(){return this.stage.renderView.renderingContext.driverTest.doublePrecisionRequiresObfuscation.result}},ATt=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};const MTt=2216,OTt=4096;function hke(t){return MTt+OTt*t.symbolLayers.length+t.complexity.memory.resourceBytes}let ITt=class extends aoe{set symbol(e){this._symbol=e,e.symbolLayers.forEach((i,r)=>{const s=this.symbolLayers[r];s!=null&&(s.symbol=e,s.symbolLayer=i)})}get symbol(){return this._symbol}constructor(e,i,r){super(i.schedule),this._symbol=e,this._context=i,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let i=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(i=this._backgroundLayers.concat(i));const r=i.length;for(;this.symbolLayers.length<i.length;)this.symbolLayers.push(null);this.symbolLayers.length=i.length;const s=[],{make:n}=await G(async()=>{const{make:o}=await import("./Graphics3DSymbolLayerFactory-DIEgSJdn.js");return{make:o}},__vite__mapDeps([354,53,54,55,56,51,105,104,318,355,341,321,356,357,35,36,358,253,359,108,360,241,107,100,326,242]));for(let o=0;o<r;o++){const a=i.at(o);if(a.enabled===!1)continue;tk.renderPriority=1-(1+o)/r,tk.renderPriorityStep=1/r,tk.ignoreDrivers=a.ignoreDrivers;const l=n(this.symbol,a,this._context,tk),c=zD(e,()=>{this.symbolLayers[o]=null,l.destroy()});c&&s.push(c),this.symbolLayers[o]=l}if(await jie(this.symbolLayers,async(o,a)=>{if(o!=null)try{await o.load(),this._extentPadding+=Math.max(this._extentPadding,o.extentPadding)}catch{this.symbolLayers[a]=null}}),s.forEach(o=>o.remove()),gt(e),this.symbolLayers.length&&!this.symbolLayers.some(o=>!!o))throw new Error}getSymbolLayerSize(e){const i=this.symbolLayers[e];return i!=null?i.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e==null?void 0:e.queryForSnapping)}updateFocus(e,i){this.symbolLayers.forEach(r=>r==null?void 0:r.updateFocus(e,i))}createGraphics3DGraphic(e,i){var o,a;const r=e.graphic,s=this.symbolLayers.map(l=>(l==null?void 0:l.createGraphics3DGraphic(e))??null),n=this._context.arcade||((a=(o=this._context.featureExpressionInfoContext)==null?void 0:o.arcade)==null?void 0:a.modules)||null;return new $Tt(r,i||this,s,e.layer,n)}get complexity(){return ooe(this.symbolLayers.map(e=>e!=null?e.complexity:null))}globalPropertyChanged(e,i){const r=this.symbolLayers.length;for(let s=0;s<r;s++){const n=this.symbolLayers[s],o=a=>{const l=a.layers[s];return l instanceof ene?l:null};if(n!=null&&!n.globalPropertyChanged(e,i,o))return!1}return!0}applyRendererDiff(e,i){return this.loadStatus!==Kh.LOADED?lv.RecreateSymbol:this.symbolLayers.reduce((r,s)=>r!==lv.RecreateSymbol&&s!=null?Math.min(r,s.applyRendererDiff(e,i)):r,lv.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===Kh.FAILED||e.diff.type!=="partial")return;const i=e.diff.diff;if(!i.symbolLayers||i.symbolLayers.type!=="partial")return;const r=i.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(s==null)return;const o=r[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),e.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const h=l.layers[n];h!=null&&a.graphics3DGraphicPatches.forEach(d=>d(h,c))})}})}updateGeometry(e,i){return this._updateGeometryOrTransform(e,(r,s)=>r.updateGeometry(s,i))}updateTransform(e,i,r,s){return this._updateGeometryOrTransform(e,(n,o)=>n.updateTransform(o,i,r,s))}_updateGeometryOrTransform(e,i){for(let r=0;r<this.symbolLayers.length;r++){const s=this.symbolLayers[r];if(s==null)continue;const n=e.layers[r];if(!n||!i(s,n))return!1}return!0}onRemoveGraphic(e){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(r==null)continue;const s=e.layers[i];s!=null&&r.onRemoveGraphic(s)}}getFastUpdateStatus(){let e=!1,i=!1;for(const r of this.symbolLayers)if(r!=null){if(r.loadStatus===Kh.LOADING)return j_.Loading;r.isFastUpdatesEnabled()?i=!0:e=!0}return i?e?j_.Mixed:j_.Fast:e?j_.Slow:j_.Undefined}async queryForSnapping(e,i,r,s){const n=this.symbolLayers.filter(df).filter(a=>a.queryForSnapping!=null).map(a=>a.queryForSnapping(e,i,r,s)),o=await Promise.all(n);return gt(s),o.flat()}destroy(){if(!this.destroyed){super.destroy();for(const e of this.symbolLayers)e!=null&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}get cachedMemory(){return hke(this)}};const tk=new ATt,RTt=["web-gltf","web","cim"];let PTt=class extends aoe{constructor(e,i,r){super(i),this.symbol=e,this._convert=r,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const i=await this.symbol.fetchSymbol({signal:e,acceptedFormats:RTt});i.id=this.symbol.id,this.graphics3DSymbol=this._convert(i),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:BDe}globalPropertyChanged(e,i){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,i)}applyRendererDiff(e,i){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,i):lv.RecreateSymbol}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,i){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e,i)}updateTransform(e,i,r,s){var n;return((n=this.graphics3DSymbol)==null?void 0:n.updateTransform(e,i,r,s))??!1}onRemoveGraphic(){}updateFocus(e,i){}getFastUpdateStatus(){var e;return((e=this.graphics3DSymbol)==null?void 0:e.getFastUpdateStatus())??j_.Loading}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}get cachedMemory(){return hke(this)}};function VK(t){return t instanceof PTt?t.graphics3DSymbol:t instanceof ITt?t:null}const zni=1.2,Uni=an,DTt=4;let LTt=class{constructor(e,i="center",r=!1,s=Ye(),n=Yi(0,0,0,-1),o="world",a=$(),l=0){this.verticalOffset=e,this.anchor=i,this.hasLabelVerticalOffset=r,this.screenOffset=s,this.centerOffset=n,this.centerOffsetUnits=o,this.translation=a,this.elevationOffset=l}},NTt=class{constructor(e,i="center",r="center",s=null,n=Ye(),o=!0){this.placement=e,this.horizontalPlacement=i,this.verticalPlacement=r,this.text=s,this.displaySize=n,this.isFocused=o}};function jK(t,e,i){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=i,t.canvas}function FTt(t){const{size:e}=t.definition,i=t.fontString(e);let r=Bye.get(i);if(!r){const s=jK(zTt,0,0).getContext("2d");t.setFontProperties(s,e);const n=s.measureText(UTt);r=new kTt(n.actualBoundingBoxAscent,n.actualBoundingBoxDescent),Bye.set(i,r)}return r}const Bye=new Map;let kTt=class{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(e,i){this.maxAscent=e,this.maxDescent=i}};const zTt={canvas:null},UTt=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})(),hae=1;let BTt=class{constructor(e,i,r,s){this.text=e,this._alignment=i,this._parameters=r,this._maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`${e}--${this._parameters.key}-${this._alignment}`,this._lines=e.replaceAll(" ","").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let e=this._metrics.firstLineAscent;for(let i=0;i<this._lines.length-1;i++)e+=this._lineSpacing;return e+=this._metrics.lastLineDescent,Math.ceil(e+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(this._metricsCached==null){const e=jK(Vye,ik,ik).getContext("2d"),i=this._parameters.definition.pixelRatio,r=this._fontSize*i;this._parameters.setFontProperties(e,r);let s=2*this._haloSize;const n=this._parameters.definition.font;n.style!=="italic"&&n.style!=="oblique"&&n.weight!=="bold"&&n.weight!=="bolder"||(s+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let o=0,a=0,l=0,c=0,h=0;this._lines.forEach((b,w)=>{const x=e.measureText(b),S=x.width/i,C=S+s;this._textWidths.push(S),this._lineWidths.push(C),o=Math.max(o,C),c=Math.max(c,x.actualBoundingBoxAscent/i),h=Math.max(h,x.actualBoundingBoxDescent/i),w===0&&(a=x.actualBoundingBoxAscent/i),w===this._lines.length-1&&(l=x.actualBoundingBoxDescent/i)});const d=FTt(this._parameters),f=Math.max(c,d.maxAscent),m=Math.max(h,d.maxDescent),g=a,v=this._parameters.definition.font.decoration==="underline"?m:l,_=o;this._metricsCached=new jTt(g,v,f,m,_)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return this._midLineHeight*VTt}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,hae)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(this._renderPixelRatio==null){const e=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(e,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case $b.Left:return this._horizontalPadding;case $b.Center:return(this.displayWidth-this._lineWidths[e])/2;case $b.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[e]}}render(e,i,r){e.save();const s=i/=this.renderPixelRatio,n=r/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset+this._metrics.firstLineAscent;i+=o,r+=a;const l=this._haloSize>0;l&&this._renderHalo(e,s,n,o,a),this._parameters.setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const h=this._lines[c],d=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,h,i+d,r),this._renderLineDecoration(e,i+d,r,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,h,i+this._getLineXOffset(c),r),this._renderLineDecoration(e,i+d,r,this._textWidths[c]),r+=this._lineSpacing}if(xs.TEXT_SHOW_BASELINE){e.strokeStyle=jye,e.setLineDash([2,2]),e.lineWidth=1;let c=n+a;for(let h=0;h<this._lines.length;++h)this._drawLine(e,[s,c],[s+this.displayWidth,c]),c+=this._lineSpacing}if(xs.TEXT_SHOW_BORDER&&(e.strokeStyle=jye,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[s,n],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,s,n,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,i,r,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":r+=2*a;break;case"line-through":r-=.33*this._midLineAscent}const l=n?this._haloSize:0;e.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(a+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(i-l),this._toRenderUnit(r)),e.lineTo(this._toRenderUnit(i+s+l),this._toRenderUnit(r)),e.stroke()}_roundedRect(e,i,r,s){i=this._toRenderUnit(i),r=this._toRenderUnit(r);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=ue(s,0,Math.floor(o/2)),e.beginPath(),e.moveTo(i,r+s),e.arcTo(i,r,i+s,r,s),e.lineTo(i+n-s,r),e.arcTo(i+n,r,i+n,r+s,s),e.lineTo(i+n,r+o-s),e.arcTo(i+n,r+o,i+n-s,r+o,s),e.lineTo(i+s,r+o),e.arcTo(i,r+o,i,r+o-s,s),e.closePath()):e.rect(i,r,n,o)}_renderHalo(e,i,r,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=jK(Vye,Math.max(o,ik),Math.max(a,ik)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._parameters.setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const h=this._renderedHaloSize<3;c.lineJoin=h?"miter":"round",h?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let d=n;for(let f=0;f<this._lines.length;++f){const m=this._getLineXOffset(f);this._renderLineDecoration(c,s+m,d,this._textWidths[f],!0),d+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,o,a,this._toRenderUnit(i),this._toRenderUnit(r),o,a),e.globalAlpha=1}_renderHaloEmulated(e,i,r){for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of dke)this._fillText(e,n,i+o+this._haloSize*a,r+this._haloSize*l);r+=this._lineSpacing}}_renderHaloNative(e,i,r){const s=2*this._haloSize;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let h=0;h<l;h++){const d=1-(l-1)*c+h*c;e.lineWidth=this._toRenderUnit(d*s),this._strokeText(e,o,i+a,r)}r+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,i,r,s){e.fillText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_strokeText(e,i,r,s){e.strokeText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_drawLine(e,i,r){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.stroke()}_drawBox(e,i,r){const s=this._toRenderUnit(i[0]),n=this._toRenderUnit(i[1]),o=this._toRenderUnit(r[0]),a=this._toRenderUnit(r[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,h=Math.floor(n)+.5,d=Math.ceil(n+a)-.5;e.beginPath(),e.moveTo(l,h),e.lineTo(c,h),e.lineTo(c,d),e.lineTo(l,d),e.lineTo(l,h),e.stroke()}};const dke=[];for(let e=0;e<360;e+=360/16)dke.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var $b;(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})($b||($b={}));const Vye={canvas:null},VTt=.2,ik=512,jye="rgb(255, 0, 255, 0.5)";let jTt=class{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(e,i,r,s,n){this.firstLineAscent=e,this.lastLineDescent=i,this.maxLineAscent=r,this.maxLineDescent=s,this.displayWidth=n}};const TO=()=>J.getLogger("esri.views.3d.layers.graphics.labelPlacement");let Gye=class{constructor(e,i,r,s=null){this._graphic=e,this._symbol=i,this._class=r,this._disablePlacement=s}get placement(){const e=this._verticalOffsetPlacement;if(e==null)return null;const i=this._getPlacementInfo(e);if(i==null)return null;const r=i.anchor,s=!!e.hasLabelVerticalOffset,n=e.verticalOffset,o=new LTt(n,r,s);return this._calculatePlacementOffsets(o,i)}get _verticalOffsetPlacement(){const e=this._class.labelPlacement,{_symbol:i,_graphic:r}=this,s=VK(r.graphics3DSymbol),n=(s==null?void 0:s.symbol.type)==="point-3d"?s.symbol:null,o=Xp[e]||this._defaultPlacementInfo;return n!=null&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:n.verticalOffset.clone(),anchor:null,normalizedOffset:null}:!(i!=null&&i.hasVisibleVerticalOffset())||n!=null&&n.supportsCallout()&&n.verticalOffset&&!r.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:o&&GTt(o.placement)?{placement:"above-center",verticalOffset:i.verticalOffset.clone(),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(TO().errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null)}_getPlacementInfo(e){if(e.anchor)return e;const i=this._class.labelPlacement,r=Xp[i],s=r||this._defaultPlacementInfo;return i&&!r&&TO().warnOncePerTick(`the requested label placement '${i}' is currently unsupported in SceneView.`),this._validatePlacementInfo(s)}_calculatePlacementOffsets(e,i){const r=this._graphic.graphic.geometry;if(r==null)return null;switch(r.type){case"point":this._setPointSpecificPlacement(e,i);break;case"mesh":this._setMeshSpecificPlacement(e,i);break;case"polygon":this._setPolygonSpecificPlacement(e,i)}const s=DTt-hae;return e.screenOffset[0]+=s*i.normalizedOffset[0],e.screenOffset[1]+=s*i.normalizedOffset[1],e}get _defaultPlacementInfo(){const e=this._graphic.graphic.geometry;if(e==null)return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:cn,anchor:"center"};case"polygon":{const i=this._firstSymbolLayer;return(i==null?void 0:i.type)==="extrude"?Xp["above-center"]:{placement:"center-center",normalizedOffset:cn,anchor:"center"}}case"point":case"mesh":return Xp["above-center"];default:return}}_validatePlacementInfo(e){const i=this._graphic.graphic.geometry;if(i==null)return null;if(this._disablePlacement!=null)return this._class.labelPlacement?(TO().warnOncePerTick(Hye(e==null?void 0:e.placement,this._disablePlacement.logEntityDescription)),this._defaultPlacementInfo):e;const r=i.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":if(this._class.labelPlacement)return TO().warnOncePerTick(Hye(e==null?void 0:e.placement,`'${r}' geometries`)),this._defaultPlacementInfo;break;case"point":case"mesh":return e}return e}_setPointSpecificPlacement(e,i){const r=this._firstSymbolLayer;if(r==null)return;const s=this._graphic.layers[0];switch(s!=null?s.getCenterObjectSpace(e.translation):se(e.translation,0,0,0),r.type){case"icon":case"text":this._setHUDSpecificPlacement(e,i,s);break;case"object":$9(e,i,s)}}_setMeshSpecificPlacement(e,i){const r=this._firstSymbolLayer;r!=null&&r.type==="fill"&&$9(e,i,this._graphic.layers[0])}_setPolygonSpecificPlacement(e,i){const r=this._firstSymbolLayer;if(r!=null)switch(r.type){case"extrude":{const s=this._graphic.layers[0];s!=null?(s.getBoundingBoxObjectSpace($P),kre($P,e.translation),e.translation[2]=ow($P)/2):se(e.translation,0,0,0),$9(e,i,s);break}}}_setHUDSpecificPlacement(e,i,r){const{_graphic:s}=this,n=r!=null?r.getScreenSize():null;if(s.isDraped||n==null)e.hasLabelVerticalOffset||e.anchor==="center"||(Xp[this._class.labelPlacement]&&TO().warnOncePerTick(`the requested placement '${i.placement}' is currently unsupported for draped graphics`),e.anchor="center");else{const o=this._normalizedSymbolAnchorPos;e.screenOffset[0]=n[0]/2*(i.normalizedOffset[0]-o[0]);const a=n[1]/2*(i.normalizedOffset[1]-o[1]);e.hasLabelVerticalOffset?(e.centerOffset[1]=a,e.centerOffsetUnits="screen"):e.screenOffset[1]=a}}get _firstSymbolLayer(){const e=this._graphic.graphics3DSymbol,i=VK(e);return i!=null?i.symbol.symbolLayers.at(0):null}get _normalizedSymbolAnchorPos(){const e=this._graphic.layers[0],i=(e==null?void 0:e.stageObject.geometries[0].material)??null;if(i&&i instanceof Koe){const r=i.parameters.anchorPosition;EO[0]=2*(r[0]-.5),EO[1]=2*(r[1]-.5)}else EO[0]=0,EO[1]=0;return EO}};function Hye(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function $9(t,e,i){const r=i!=null?i.getBoundingBoxObjectSpace($P):$P,s=De(r[3]-r[0],r[4]-r[1],r[5]-r[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);t.centerOffset[0]=n/2*e.normalizedOffset[0];const o=t.translation[2],a=s[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=o+a;const l=Ee(s);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function GTt(t){return t==="above-center"}const Xp={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},qye={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in qye){const e=qye[t],i=Xp[t];e.forEach(r=>{Xp[r]=i})}Object.freeze&&(Object.freeze(Xp),Object.keys(Xp).forEach(t=>{var e;Object.freeze(Xp[t]),Object.freeze((e=Xp[t])==null?void 0:e.normalizedOffset)}));const EO=[0,0],$P=fh(),Wni=Object.freeze({left:0,center:.5,right:1}),Zni=Object.freeze({"bottom-left":fn(0,0),bottom:fn(.5,0),"bottom-right":fn(1,0),left:fn(0,.5),center:fn(.5,.5),right:fn(1,.5),"top-left":fn(0,1),top:fn(.5,1),"top-right":fn(1,1)});function HTt(t){switch(t){case"left":return $b.Left;case"right":return $b.Right;default:return $b.Center}}function Wye(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function qTt(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function Yni(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function Jni(t){return t==="middle"?"center":t}function Xni(t,e){switch(t){case"top":return di(e,0,hae);case"bottom":return di(e,0,-1);default:return Vn(e,TS)}}let Zye=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,i){this._materials.set(e,i),this._stage.add(i)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}};const pke="arial-unicode-ms",Yye="woff2",Jye=new Map,fke=new Set;let WTt=class{constructor(e,i){this.fontFace=e,this.promise=i}};async function ZTt(t){const e=KTt(t),i=XTt(t),r=Jye.get(e);if(r)return r.promise;const s=new FontFace(t.family,`url('${Rr.fontsUrl}/woff2/${i}.${Yye}') format('${Yye}')`,{style:t.style,weight:t.weight}),n=document.fonts;if(n.has(s)&&s.status==="loading")return s.loaded;const o=s.load().then(()=>(n.add(s),s));return Jye.set(e,new WTt(s,o)),fke.add(s),o}function YTt(t){return fke.has(t)}function JTt(t){if(!t)return pke;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function XTt(t){const e=mke(t)+gke(t);return JTt(t.family)+(e.length>0?e:"-regular")}function KTt(t){const e=mke(t)+gke(t);return(t.family||pke)+(e.length>0?e:"-regular")}function mke(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function gke(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}let QTt=class yke{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=Xye(e.color),this.haloStyle=eEt(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?Xye(e.background.color):null}fontString(e){const i=this.definition.font;return`${i.style} ${i.weight} ${e}px ${i.family}, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji`}setFontProperties(e,i){e.font=this.fontString(i),e.textAlign="left",e.textBaseline="alphabetic"}static async fromSymbol(e,i){var f,m,g,v,_;const r=(f=e==null?void 0:e.material)==null?void 0:f.color,s=Je.toUnitRGBA(r)??an,n=e.size!=null?xS(e.size):12,o=e.lineHeight,a=e.background!=null?Je.toUnitRGBA(e.background.color):an,l={family:((m=e.font)==null?void 0:m.family)??"sans-serif",decoration:((g=e.font)==null?void 0:g.decoration)??"none",weight:((v=e.font)==null?void 0:v.weight)??"normal",style:((_=e.font)==null?void 0:_.style)??"normal"},c=e.halo,h=(c==null?void 0:c.color)!=null&&c.size>0?{size:xS(c.size),color:Je.toUnitRGBA(c.color)}:{size:0,color:an},d=new yke({color:s,size:n,background:{color:a,padding:e.background!=null?[.65*n,.5*n]:[0,0],borderRadius:e.background!=null?n*(6/16):0},lineSpacingFactor:o,font:l,halo:h,pixelRatio:i});if(e.font){let b=!1;const w=d.fontString(n);try{b=(await document.fonts.load(w)).some(x=>!YTt(x))}catch{J.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${w}'. Some text symbology may be rendered using the default browser font.`)}if(!b&&!tEt.has(e.font.family))try{await ZTt(e.font)}catch{}}return d}};function eEt(t){return`rgb(${t.slice(0,3).map(e=>Math.floor(255*e)).toString()})`}function Xye(t){return`rgba(${t.slice(0,3).map(e=>Math.floor(255*e)).toString()},${t[3]})`}const tEt=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),O0=4096;let wC=class extends he{constructor(e){super(e),this.type=zn.Texture,this.id=Td(),this.events=new Ss,this._glTexture=null,this._atlas=new rEt(256,256),this._needsRepack=!1,this._canRepack=!0,this._elementsToRender=new Map,this._elements=new Map,this._uvCallbacks=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._updateCanvasElementSize(this._atlas),this._reset()}unload(){this._glTexture=Dt(this._glTexture),this._frameWorker=Ji(this._frameWorker),this.updating=!1,this.events.emit("unloaded")}get glTexture(){return this._glTexture}static get maxSize(){return AP=0,[O0-I0-AP,O0-I0-AP-Kye]}load(e){if(this._glTexture)return this._glTexture;const i=new Ar;return i.wrapMode=ar.CLAMP_TO_EDGE,i.samplingMode=gi.LINEAR_MIPMAP_LINEAR,i.hasMipmap=!0,i.preMultiplyAlpha=!0,i.maxAnisotropy=e.parameters.maxMaxAnisotropy,this._glTexture=new pi(e,i,this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(lt.TEXT_TEXTURE_ATLAS,this),this.setDirty(),this._glTexture}dispose(){this._elements.clear(),this._elementsToRender.clear(),this._frameWorker=Ji(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=Dt(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.width=e.width,this._canvas.height=e.height}_resizeAtlas(e,i){var n,o;const{width:r,height:s}=this._atlas;r===e&&s===i||(this._atlas.width=e,this._atlas.height=i,(n=this._glTexture)==null||n.resize(e,i),(o=this._glTexture)==null||o.updateData(0,0,0,r,s,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach(a=>{var l;return(l=this._uvCallbacks.get(a.textRenderer.key))==null?void 0:l.forEach(c=>c(a.uv))}),this._reset())}_reset(){this._elementsToRender.clear(),this._atlas.reset(),this._needsRepack=!0,this.setDirty()}_addAtlasElement(e,i,r,s){const n=this._atlas;if(n.width<r||n.height<s)return!1;let o=n.cursors.get(s);if(!o){if(n.height<n.nextY+s)return!1;o=[new Qye(n.nextY)],n.cursors.set(s,o),n.nextY+=s}let a=o.find(l=>n.width>=l.x+r);if(a==null){if(n.height<n.nextY+s)return!1;a=new Qye(n.nextY),n.nextY+=s,o.push(a)}return e.setNewPosition(a),this._elements.set(i,e),this._elementsToRender.set(i,e),a.x+=r,!0}_ensureCallbacks(e){const i=this._uvCallbacks.get(e);if(i)return i;const r=new Set;return this._uvCallbacks.set(e,r),r}_addCallback(e,i){this._ensureCallbacks(e).add(i)}_removeCallback(e,i){const r=this._uvCallbacks.get(e);return!(!(r!=null&&r.delete(i))||r.size!==0)&&(this._uvCallbacks.delete(e),!0)}_processAddition(e){const i=e.textRenderer.key;if(this._needsRepack)return void this._elements.set(i,e);const r=this._atlas,s=e.textRenderer.renderedWidth,n=e.textRenderer.renderedHeight,o=s+I0,a=n+I0+Kye;if(!this._addAtlasElement(e,i,o,a)){if(this._canRepack)this._reset();else if(r.width<o){const l=Math.min(cv(Math.max(o,1.5*r.width)),O0);this._resizeAtlas(l,r.height)}else{const l=r.nextY+a,c=Math.min(cv(Math.max(l,1.5*r.height)),O0);if(c>r.height)this._resizeAtlas(r.width,c);else if(r.width<O0){const h=Math.min(cv(1.5*r.width),O0);this._resizeAtlas(h,r.height)}}this._elements.set(i,e)}}_renderElement(e){var s;const i=e.commitNewPosition(),r=e.textRenderer;this._ctx.clearRect(i[0]-I0,i[1]-I0,r.renderedWidth+2*I0,r.renderedHeight+2*I0),r.render(this._ctx,i[0],i[1]),(s=this._uvCallbacks.get(r.key))==null||s.forEach(n=>n(e.uv))}get running(){return this.updating}runTask(e){if(this._glTexture==null)return ea;for(;this._needsRepack&&(this._canRepack||this._atlas.height<O0&&this._atlas.height<O0);){this._canRepack=this._needsRepack=!1;const i=this._elements;this._elements=new Map,i.forEach(r=>this._processAddition(r)),e.madeProgress()}if(this._elementsToRender.size>0){for(const[i,r]of this._elementsToRender){if(e.done)break;this._renderElement(r),this._elementsToRender.delete(i),e.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=this._elementsToRender.size>0}addText(e,i){const r=e.key;this._addCallback(r,i);let s=this._elements.get(r);return s?tS(s.uv,an)||i(s.uv):(s=new iEt(this._atlas,e),this._processAddition(s),this.setDirty()),{remove:()=>this._removeText(e,i)}}_removeText(e,i){const r=e.key;this._elements.get(r)&&this._removeCallback(r,i)&&(this._elements.delete(r),this._elementsToRender.delete(r),this._canRepack=!0)}setDirty(){this._glTexture&&(this.updating=!0)}get test(){}};u([p({constructOnly:!0})],wC.prototype,"view",void 0),u([p({type:Boolean})],wC.prototype,"updating",void 0),wC=u([A("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],wC);const I0=2,Kye=2;let iEt=class{constructor(e,i){this._atlas=e,this.textRenderer=i,this._uv=yi(),this._newPosition=[0,0]}get uv(){if(this._xOffset==null||this._yOffset==null)return an;const{renderedWidth:e,renderedHeight:i}=this.textRenderer;return ss(this._uv,this._xOffset/this._atlas.width,(this._yOffset+i)/this._atlas.height,(this._xOffset+e)/this._atlas.width,this._yOffset/this._atlas.height)}setNewPosition(e){this._newPosition[0]=e.x,this._newPosition[1]=e.y}commitNewPosition(){return this._xOffset=this._newPosition[0],this._yOffset=this._newPosition[1],this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}},rEt=class{constructor(e,i){this.width=e,this.height=i,this.cursors=new Map,this.nextY=0}reset(){this.cursors.clear(),this.nextY=AP}},Qye=class{constructor(e){this.y=e,this.x=AP}},AP=0,eve=class{constructor(e,i){this.labelingContext=e,this.graphics3DGraphic=i,this.hasGraphics3DResources=!1,this.visible=!1,this.textureAtlasHandles=[],this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},sEt=class{constructor(e,i,r,s,n){this.labelClass=e,this.graphics3DSymbol=i,this.graphics3DCalloutSymbolLayer=r,this.textRenderParameters=s,this.labelFunction=n,this.calloutSymbolLayerIndex=0}},nEt=class{constructor(e,i,r,s,n,o,a,l){this.layer=i,this.graphics3DCore=r,this.scaleVisibility=s,this.emptySymbolLabelSupported=n,this.elevationInfoOverride=o,this.disablePlacement=a,this.active=l,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new yLe(e,{pickable:!0,disableOctree:!0},i.uid)}destroy(){this.stageLayer.destroy()}},H1=class extends he{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this.addHandles([H(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),H(()=>{var e;return(e=this.view.state)==null?void 0:e.rasterPixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(lt.LABELER,this)]),this._textTextureAtlas=new wC({view:this.view}),this._hudMaterialCollection=new Zye(this.view._stage),this._calloutMaterialCollection=new Zye(this.view._stage)}dispose(){this.removeAllHandles(),this._textTextureAtlas=Dt(this._textTextureAtlas),this._hudMaterialCollection=Dt(this._hudMaterialCollection),this._calloutMaterialCollection=Dt(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear()}destroy(){this.dispose(),ip.graphic=null,ip.renderingInfo=null,ip.layer=null}_activateLabelingContext(e){e.graphics.forEach((i,r)=>{const s=new eve(e,i);this._labels.set(r,s),e.labelsToInitialize.set(r,s),i.setVisibilityFlag(wo.LABEL,wa.USER,!0)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((i,r)=>{i.setVisibilityFlag(wo.LABEL,wa.USER,!1),this.setLabelGraphicVisibility(i,!1),i.clearLabelGraphics(),this._labels.delete(r)}),e.active=!1}_addLabelTextureToAtlas(e){for(const i of e.graphics3DGraphic.labelLayers){if(!i._labelClass)continue;const r=e.textRenderers[i._labelIndex];r&&(e.textureAtlasHandles.push(this._textTextureAtlas.addText(r,s=>aEt(i.stageObject,s))),oEt(i.stageObject,r))}}_removeLabelTextureFromAtlas(e){e.textureAtlasHandles.forEach(i=>i.remove()),e.textureAtlasHandles.length=0}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),ea}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const i of this._labelingContexts)if(i.active){if(A9(i))this._dirty=!0;else if(M9(i.labelClassContexts)){if(i.labelClassContexts===null){this._deactivateLabelingContext(i);continue}this._createLabelClassContext(i),this._dirty=!0}else for(const[r,s]of i.labelsToInitialize)if(this._ensureGraphics3DResources(s)&&(this._labels.set(r,s),this.deconflictor.setDirty(),e.madeProgress()),(s.visible&&s.textInitialized||!s.visible&&s.hasGraphics3DResources)&&(i.labelsToInitialize.delete(r),e.madeProgress()),e.done){this._dirty=!0;break}}this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){var o,a,l;const i=(o=e.labelClassAbortController)==null?void 0:o.signal;e.layer.when&&await e.layer.when(),gt(i),(a=e.scaleVisibility)==null||a.updateScaleRangeActive();const r=e.graphics3DCore,s=r.layer,n=(l=s.labelingInfo)==null?void 0:l.filter(c=>!!c.symbol);!n||n.length===0||(await jie(n,async(c,h)=>{const d=c.symbol,f=VK(r.getOrCreateGraphics3DSymbol(d));if(f==null)return void J.getLogger(this).error("Failed to create Graphics3DSymbol for label");await f.load(),gt(i);let m=null;jAe(d)&&d.hasVisibleCallout()&&(m=ESt(d,r.symbolCreationContext),await m.load(),gt(i));const g=await ff(sSt(c,e.layer.fieldsIndex,this.view.spatialReference));if(gt(i),g.ok===!0){const v=await this._createTextRenderParameters(f.symbol);gt(i),e.labelClassContexts[h]=new sEt(c,f,m,v,g.value)}else J.getLogger(this).error(`Label expression failed to evaluate: ${g.error}`)}),gt(i))}async _createLabelClassContext(e){return e.labelClassPromise==null&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(i=>{if(es(i))throw i;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const i=e.symbolLayers.at(0);return(i==null?void 0:i.type)!=="text"?null:QTt.fromSymbol(i,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(e){for(const r of e.labelClassContexts)--r.graphics3DSymbol.referenced;const i=e.labelClassAbortController;e.labelClassAbortController=new AbortController,fc(i),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,i,r,s,n,o){const a=new NTt(r,Wye(r.anchor),qTt(r.anchor),e.text,fn(e.displayWidth,e.displayHeight));return ip.graphic=i,ip.layer=s,ip.renderingInfo=null,n.createLabel(ip,a,this._hudMaterialCollection,this._textTextureAtlas,()=>{var l;return((l=o.placement)==null?void 0:l.elevationOffset)??null})}_createLineCalloutGraphic(e,i,r,s,n){ip.graphic=e,ip.layer=n;const o=s.screenOffset[0];return ip.renderingInfo=new SSt(null,i,s.translation,s.centerOffset,o,s.centerOffsetUnits,s.elevationOffset,this._calloutMaterialCollection),r.createGraphics3DGraphic(ip)}_ensureGraphics3DResources(e){var c,h;if(e.hasGraphics3DResources)return!1;const i=e.graphics3DGraphic;if(i.destroyed)return!1;this._ensureTextTextureResources(e);const r=e.labelingContext,s=r.labelClassContexts;if(M9(s)||!r.emptySymbolLabelSupported&&i.layers.length===0)return!1;let n=!1;const o=i.graphic,a=r.layer,l=rk(r.layer);for(let d=0;d<s.length;d++){const f=e.textRenderers[d],m=e.textLabelPlacements[d];if(f==null||m==null)continue;const g=s[d],v=g.graphics3DSymbol,_=lEt(v),b=v.symbolLayers[0];if(!b)continue;b.setElevationInfoOverride(r.elevationInfoOverride);const w=new Gye(i,_,g.labelClass),x=this._createTextSymbolGraphic(f,o,m,a,b,w);if(x==null)return!1;x._labelClass=g.labelClass,x._labelIndex=d,i.addLabelGraphic(x,r.stageLayer),i.deconflictionPriority=((c=g.textRenderParameters)==null?void 0:c.definition.size)??0,i.setVisibilityFlag(wo.LABEL,wa.USER,l),i.setVisibilityFlag(wo.LABEL,wa.SCALE_RANGE,!0),i.setVisibilityFlag(wo.LABEL,wa.DECONFLICTION,!1),n=!0;const S=g.graphics3DCalloutSymbolLayer;if(S&&m.hasLabelVerticalOffset){S.setElevationInfoOverride(r.elevationInfoOverride);const C=this._createLineCalloutGraphic(o,_,S,m,a);C!=null&&(g.calloutSymbolLayerIndex=i.labelLayers.length,i.addLabelGraphic(C,r.stageLayer))}break}return n&&((h=r.scaleVisibility)==null||h.updateGraphicLabelScaleVisibility(i)),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const i=e.labelingContext.labelClassContexts;for(const r of e.graphics3DGraphic.labelLayers){if(r._labelClass==null)continue;const s=i[r._labelIndex].graphics3DSymbol.symbolLayers[0];s==null||s.onRemoveGraphic(r)}e.graphics3DGraphic.deconflictionPriority=0,e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){var n;if(e.textInitialized)return;const i=e.labelingContext,r=i.labelClassContexts;if(M9(r))return;const s=e.graphics3DGraphic.graphic;for(let o=0;o<r.length;o++){const a=r[o];if(e.textRenderers[o]=null,e.textLabelPlacements[o]=null,(a==null?void 0:a.textRenderParameters)==null)continue;const l=a.labelFunction;let c;if(l.type==="arcade")try{const w=l.needsHydrationToEvaluate()?Qct(s,i.layer):s;c=l.evaluate(w)}catch{c=null}else c=l.evaluate(s);if(c==null||c===""||/^\s+$/.test(c))continue;const h=a.graphics3DSymbol;if(!h.symbolLayers[0])continue;const d=e.graphics3DGraphic,f=((n=h.symbol)==null?void 0:n.type)==="label-3d"?h.symbol:null,m=a.labelClass,g=i.disablePlacement,v=new Gye(d,f,m,g).placement;if(v==null)continue;const _=Wye(v.anchor),b=HTt(_);e.textRenderers[o]=new BTt(c,b,a.textRenderParameters,wC.maxSize),e.textLabelPlacements[o]=v}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,i){const r=i.graphic.uid;if(e.graphics.set(r,i),e.active){const s=new eve(e,i);this._labels.set(r,s),e.labelsToInitialize.set(r,s)}this.setDirty(),this.deconflictor.setDirty()}_updateGraphicGeometry(e,i){const r=i.graphic.uid,s=this._labels.get(r);if(!s)return!0;for(const n of s.graphics3DGraphic.labelLayers)if(n._labelClass!=null&&!e.labelClassContexts[n._labelIndex].graphics3DSymbol.symbolLayers[0].updateGeometry(n,i.graphic.geometry))return!1;return this.setDirty(),this.deconflictor.setDirty(),!0}_removeGraphic(e,i){const r=i.graphic.uid,s=this._labels.get(r);e.graphics.delete(r),s&&(this._destroyGraphic(s,r),e.labelsToInitialize.delete(r),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,i){this._labels.delete(i),e.textureAtlasHandles.length&&this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,i){if(!i)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const r of i){const s=e.graphics.get(r);s&&(this._removeGraphic(e,s),this._addGraphic(e,s))}}_globalPropertyChanged(e,i){for(const r of i.labelClassContexts){const s=new Map;i.graphics.forEach(o=>s.set(o.graphic.uid,o));const n=o=>o.labelLayers[0];if(r.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,s,n),r.graphics3DCalloutSymbolLayer){const o=a=>a.labelLayers[r.calloutSymbolLayerIndex];r.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,s,o)}}}_visibilityInfoChange(e){const i=rk(e.layer);i&&!e.active&&this._activateLabelingContext(e),!i&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((i,r)=>{const s=this._labels.get(r);s&&(this._destroyGraphic(s,r),s.visible=!1,e.labelsToInitialize.set(r,s))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const i of this._labelingContexts)if(i.graphics3DCore===e)return i;return null}addGraphicsOwner(e,i,r){const s=(r==null?void 0:r.emptySymbolLabelSupported)||!1,n=(r==null?void 0:r.elevationInfoOverride)||null,o=(r==null?void 0:r.disablePlacement)||null;if(this._findLabelingContext(e))return;const a=e.layer,l=new nEt(this.view._stage,a,e,i,s,n,o,rk(a));return this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),updateGraphicGeometry:c=>this._updateGraphicGeometry(l,c),layerLabelsEnabled:()=>rk(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),remove:()=>this._removeGraphicsOwner(e),setDirty:()=>this.setDirty()}}_removeGraphicsOwner(e){const i=this._findLabelingContext(e);if(!i)return;const r=this._labelingContexts.indexOf(i);this._labelingContexts.splice(r,1),i.graphics.forEach(s=>this._removeGraphic(i,s)),i.destroy(),this.setDirty()}setLabelGraphicVisibility(e,i){const r=e.graphic.uid,s=this._labels.get(r);s&&s.visible!==i&&(i&&!s.textureAtlasHandles.length?(this._addLabelTextureToAtlas(s),s.textInitialized||s.labelingContext.labelsToInitialize.set(r,s)):!i&&s.textureAtlasHandles.length&&this._removeLabelTextureFromAtlas(s),s.visible=i,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(i=>A9(i))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((i,r)=>i+(A9(r)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){}};function oEt(t,e){t.geometries[0].setAttributeData(z.SIZE,[e.displayWidth,e.displayHeight]),t.geometryVertexAttributeUpdated(t.geometries[0],z.SIZE)}function aEt(t,e){t.geometries[0].setAttributeData(z.UV0,e),t.geometryVertexAttributeUpdated(t.geometries[0],z.UV0,!0)}function A9(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function M9(t){return!t||t.length===0}function lEt(t){var e;return((e=t.symbol)==null?void 0:e.type)==="label-3d"?t.symbol:null}function rk(t){var e;return t.labelsVisible===!0&&!!((e=t.labelingInfo)!=null&&e.some(i=>!!i.symbol))}u([p({constructOnly:!0})],H1.prototype,"view",void 0),u([p({constructOnly:!0})],H1.prototype,"deconflictor",void 0),u([p()],H1.prototype,"_textTextureAtlas",void 0),u([p({type:Boolean,readOnly:!0})],H1.prototype,"updating",null),H1=u([A("esri.views.3d.layers.graphics.Labeler")],H1);const ip=new TSt(null,null,null);let tve=class rR{constructor(e,i,r,s,n=X5(e,i,r)){this._tilingScheme=s,this.id=n,this.lij=[0,0,0],this.extent=si(),this.measures=new cEt,this.loadPriority=0,this.used=!1,this.lij[0]=this.measures.lodLevel=e,this.lij[1]=i,this.lij[2]=r,s.getExtent(e,i,r,this.extent)}get planetRadius(){return yr(this.spatialReference).radius}get spatialReference(){return this._tilingScheme.spatialReference}get resolution(){return this._tilingScheme.resolutionAtLevel(this.measures.lodLevel)}get level(){return this.lij[0]}get lodLevelDelta(){return this.measures.lodLevel-this.level}createChildren(){const e=this.lij[0]+1,i=2*this.lij[1],r=2*this.lij[2];return[new rR(e,i,r,this._tilingScheme),new rR(e,i+1,r,this._tilingScheme),new rR(e,i,r+1,this._tilingScheme),new rR(e,i+1,r+1,this._tilingScheme)]}},cEt=class{constructor(){this.visible=!0,this.distance=0,this.lodLevel=0,this.splitPriority=0,this.mergeable=!0}};function X5(t,e,i){return`${t}/${e}/${i}`}function uEt(t,e,i,r,s,n,o=1){const a=kb(e,s);if(a==null)return!1;if(a===ys){if(t===r&&i===n)return!0;const c=i+o;for(let h=i,d=n;h<c;++h,++d)ne(r[d],t[h]);return!0}const l=i+o;for(let c=i,h=n;c<l;++c,++h)a(t[c],0,r[h],0);return!0}let hEt=class{constructor(e,i){this._renderCoordsHelper=e,this.opaqueGround=i,this._cache=new Map,this._cameraForward=$(),this._cameraEye=$(),this._cameraFovY=55*Math.PI/180,this._frustumBoundingSphereCenter=$(),this._frustumBoundingSphereRadius=0,this._frustum=new HB(e),this._renderSR=e.spatialReference;const r=jb(this._renderSR);this._renderSREllipsoidRadius=yr(r).radius}setup(e){this._aboveGround=e.aboveGround,this._frustum.update(e),ae(this._cameraForward,e.viewForward),ne(this._cameraEye,e.eye),this._cameraFovY=e.fovY,this._updateFrustumBoundingSphere()}done(){this._cache.clear()}compute(e){if(this._cache.has(e.id))return this._cache.get(e.id);const i=this._isVisibleInFrustum(e);return this._cache.set(e.id,i),i}_isVisibleInFrustum(e){return this._renderCoordsHelper.viewingMode===je.Local?this._isTileVisibleInFrustumLocal(e):this._isTileVisibleInFrustumGlobal(e)}_updateFrustumBoundingSphere(){const e=this._frustum,i=e.origin,r=bEt;ae(r,e.direction);const s=e.points,n=wEt;Fi(n,s[4],i);const o=.5*fe(n,n)/fe(r,n),a=this._frustumBoundingSphereCenter;Qn(a,i,r,o);const l=1+o;this._frustumBoundingSphereRadius=l}_isTileVisibleInFrustumLocal(e){const i=e.spatialReference,r=e.extent,s=this._renderSR;if(xn[0]=r[0],xn[1]=r[1],xn[2]=0,xn[3]=r[2],xn[4]=r[3],xn[5]=0,!Gn(xn,i,0,xn,s,0))return!1;se(sl[0],xn[0],xn[1],0),se(sl[1],xn[3],xn[1],0),se(sl[2],xn[3],xn[4],0),se(sl[3],xn[0],xn[4],0),se(sk,.5*(xn[0]+xn[3]),.5*(xn[1]+xn[4]),.5*(xn[2]+xn[5]));const n=ave,o=.5*Ba(sl[0],sl[2]),a=this._frustum,l=this._frustumBoundingSphereRadius,c=this._frustumBoundingSphereCenter,h=SEt;Fi(h,c,sk);const d=fe(n,h),f=xEt;if(Qn(f,sk,n,d),Ba(f,c)>o+l)return!1;const m=this._cameraForward,g=fe(m,ave),v=this._cameraFovY,_=this._cameraEye;if(Math.abs(g)<Math.abs(Math.cos(.5*v))){let T=!0;const M=se(YEt,m[0],m[1],0),I=fe(_,M);for(let D=0;D<4;++D){const P=sl[D];if(fe(P,M)-I>0){T=!1;break}}if(T)return!1}{const T=sl[0],M=sl[2];if(T[0]<=_[0]&&_[0]<=M[0]&&T[1]<=_[1]&&_[1]<=M[1])return!0}const b=mEt,w=this.opaqueGround&&this._aboveGround,x=this.opaqueGround&&!this._aboveGround,S=Math.min(x?nk:1/0,d+l),C=Math.max(w?-430:-1/0,d-l);for(let T=0;T<4;++T)Qn(b[T],sl[T],n,S),Qn(b[T+4],sl[T],n,C);if(rve(a.planes,b,8))return!1;if(O9(a.planes,b,8))return!0;for(let T=0;T<4;++T){const M=b[T],I=b[T+4];if(P9(a.planes,M,I))return!0;const D=b[(T+1)%4];if(P9(a.planes,M,D))return!0;const P=b[4+(T+1)%4];if(P9(a.planes,I,P))return!0}if(zf[0][3]=+sl[0][0],zf[1][3]=-sl[2][0],zf[2][3]=+sl[0][1],zf[3][3]=-sl[2][1],zf[4][3]=+C,zf[5][3]=-S,O9(zf,a.points)||O9(zf,a.points))return!0;for(let T=0;T<4;++T){const M=_,I=a.points[T+4];if(lve(zf,M,I))return!0;const D=a.points[4+(T+1)%4];if(lve(zf,I,D))return!0}return!1}_isTileVisibleInFrustumGlobal(e){if(e.level<K5)return!0;const i=e.spatialReference,r=e.extent,s=this.opaqueGround&&this._aboveGround,n=this.opaqueGround&&!this._aboveGround,o=sl,a=.5*(r[0]+r[2]);if(se(o[0],r[0],r[1],0),se(o[1],r[2],r[1],0),se(o[2],r[2],r[3],0),se(o[3],r[0],r[3],0),se(o[4],a,r[1],0),se(o[5],a,r[3],0),!uEt(o,i,0,o,this._renderSR,0,6))return!1;const l=o[0][2]>0,c=o[3][2]<0,h=l||c,d=this._renderSREllipsoidRadius;if(h){const ut=gEt;a_(ut,ok,o[0]);const _t=yEt;if(a_(_t,ok,o[1]),l){const me=sve,ye=o[4],we=nve;a_(we,ye,ok),a_(me,we,ye);const ke=o[0];ct(ke,ut,me),CO(ke,d);const Ge=o[1];ct(Ge,_t,me),CO(Ge,d)}else if(c){const me=sve,ye=o[5],we=nve;a_(we,ye,ok),a_(me,ye,we);const ke=o[3];ct(ke,me,ut),CO(ke,d);const Ge=o[2];ct(Ge,me,_t),CO(Ge,d)}}const f=sk,m=Fi($Et,o[3],o[0]);ae(m,m);const g=oe(AEt,o[0],o[3]);re(g,g,.5);const v=-fe(g,m),_=oe(MEt,o[0],o[1]);re(_,_,.5);const b=oe(OEt,o[2],o[3]);re(b,b,.5);const w=Fi(IEt,b,_);ae(w,w);const x=-(v+fe(m,_))/fe(m,w);Qn(f,_,w,x),CO(f,d);const S=this._frustumBoundingSphereRadius,C=this._frustumBoundingSphereCenter,T=this._frustum,M=T.planes,I=vEt;ae(I,f);const D=fe(o[0],I)/ja(o[0]),P=T.origin,F=T.points;let L=!1;if(s){{L=!0;const _t=ae(ove,P);for(let me=0;me<4;++me){const ye=F[4+me],we=Fi($(),ye,P);ae(we,we);const ke=ct($(),_t,we);ae(ke,ke);const Ge=ct($(),we,ke);if(ae(Ge,Ge),fe(P,Ge)>d){L=!1;break}}}if(L&&fe(P,I)<d*D-nk)return!1;const ut=ae(ove,T.origin);if(fe(ut,I)<0)return!1;{const _t=ae(WEt,T.direction);if(fe(_t,I)>ZEt)return!1}}const N=Math.sqrt(1-D*D);if(N>.9)return!0;let R=!1;const k=fe(I,C),W=ja(C);if(W<=S&&!M.some(ut=>on(ut,I9)>0)){if(!s)return!0;R=!0}const j=k/W;if(!R&&k<=0&&-k>S)return!1;const B=S/W;if(Math.sqrt(1-j*j)*Math.sqrt(1-B*B)-B*j>N)return!1;if(!L&&(o.some(ut=>T.intersectsPoint(ut))||T.intersectsPoint(f)))return!0;const te=TEt;Fi(te,C,I9);const le=fe(te,I),de=_Et;re(de,I,le);const Ae=Ba(de,C),We=i.isWGS84,Ue=e.lij,it=We&&Ue[2]===2**Ue[0]-1,Et=We&&Ue[2]===0,Jt=Et?BEt:it?zEt:FEt,wt=Et?VEt:it?UEt:kEt;if(!R){const ut=o,_t=jEt,me=REt,ye=PEt,we=I9;for(const ke of Jt){const Ge=ut[ke];if(ive(me,ut[(ke+1)%4],Ge),ive(ye,we,Ge),a_(_t,ye,me),fEt(_t,F,1))return!1}}let vt=null;if(!s&&le<1.01*S){const ut=2.5*S;if(Ae>D*ut+S)return!1;const _t=CEt,me=ut/D;for(let ye=0;ye<4;++ye)re(_t[ye],o[ye],me/d);se(_t[4],0,0,0),vt=_t}else{const ut=(n?d+nk:le+S)/D,_t=s?d-nk:(le-S)/D,me=EEt;for(let ye=0;ye<4;++ye){const we=o[ye];re(me[ye],we,_t/d),re(me[ye+4],we,ut/d)}vt=me}if(rve(M,vt,vt.length))return!1;const Ft=T.lines,xt=DEt,zt=LEt;for(const ut of Ft){ae(zt,ut.direction);for(const _t of wt){const me=vt[_t];if(ae(xt,me),R9(zt,xt,vt,F))return!1;const ye=(_t+1)%4;if(s){const we=vt[ye];if(Fi(xt,we,me),ae(xt,xt),R9(zt,xt,vt,F))return!1}if(n){const we=vt[4+_t],ke=vt[4+ye];if(Fi(xt,ke,we),ae(xt,xt),R9(zt,xt,vt,F))return!1}}}return!0}};function a_(t,e,i){return ct(t,e,i),ae(t,t),t}function ive(t,e,i){return Fi(t,e,i),ae(t,t),t}function CO(t,e){return re(t,t,e/ja(t)),t}const vke=[bo.LEFT,bo.RIGHT,bo.BOTTOM,bo.TOP,bo.FAR];function dEt(t,e,i){for(let r=0;r<i;++r)if(on(t,e[r])<=0)return!1;return!0}function rve(t,e,i){for(const r of vke)if(dEt(t[r],e,i))return!0;return!1}function O9(t,e,i=e.length){for(let r=0;r<i;++r){const s=e[r];let n=!0;for(const o of t)if(on(o,s)>0){n=!1;break}if(n)return!0}return!1}const K5=2,pEt=4;function fEt(t,e,i){for(const r of e)if(fe(r,t)<i)return!1;return!0}const mEt=[$(),$(),$(),$(),$(),$(),$(),$()],xn=[0,0,0,0,0,0],sl=[$(),$(),$(),$(),$(),$()],sk=$(),sve=$(),gEt=$(),yEt=$(),nve=$(),vEt=$(),_Et=$(),bEt=$(),wEt=$(),xEt=$(),SEt=$(),I9=yf(0,0,0),TEt=$(),EEt=[$(),$(),$(),$(),$(),$(),$(),$()],CEt=[$(),$(),$(),$(),$()],$Et=$(),AEt=$(),MEt=$(),OEt=$(),IEt=$(),REt=$(),PEt=$(),DEt=$(),LEt=$(),NEt=$(),FEt=[0,1,2,3],kEt=[0,1,2,3],zEt=[0,1,3],UEt=[0,1,3],BEt=[1,2,3],VEt=[1,2,3],jEt=$();function GEt(t,e,i){let r=1/0,s=-1/0;for(const n of i){const o=fe(e,n);r=Math.min(r,o),s=Math.max(s,o)}t[0]=r,t[1]=s}function HEt(t,e,i,r){let s=1/0,n=-1/0;for(const o of r){const a=fe(i,o);if(s=Math.min(s,a),n=Math.max(n,a),s<=e&&n>=t)return!1}return!0}const qEt=[0,0];function R9(t,e,i,r){if(i.length===0||r.length===0)return!0;const s=NEt;a_(s,t,e);const n=r[0]<i[0],o=n?i:r,a=qEt;return GEt(a,s,n?r:i),HEt(a[0],a[1],s,o)}const nk=430,ove=$(),WEt=$(),ZEt=Math.cos(.25*Math.PI),ave=De(0,0,1),YEt=$();function P9(t,e,i){const r={t0:0,t1:1};for(const s of vke)if(!_ke(t[s],e,i,r))return!1;return r.t0<r.t1}function lve(t,e,i){const r={t0:0,t1:1};for(const s of t)if(!_ke(s,e,i,r))return!1;return r.t0<r.t1}function _ke(t,e,i,r){let{t0:s,t1:n}=r;const o=on(t,e),a=on(t,i);if(o>=0&&a>=0)return!1;if(o<0&&a>=0){const l=-o/(a-o);if(l<s)return!1;l<n&&(n=l)}else if(o>=0&&a<0){const l=o/(o-a);if(l>n)return!1;l>s&&(s=l)}return r.t0=s,r.t1=n,!0}const zf=[Uy(-1,0,0,1),Uy(1,0,0,-1),Uy(0,-1,0,1),Uy(0,1,0,-1),Uy(0,0,-1,1),Uy(0,0,1,-1)],ok=yf(0,0,1);let cve=class{constructor(e,i,r){this._renderCoordsHelper=e,this._tilingScheme=i,this._camera=new qr,this._surfaceElevation=0,this._focusOnMap=[0,0],this._visibility=new hEt(e,r)}set opaqueGround(e){this._visibility.opaqueGround=e}setup(e,i,r){this._camera.copyFrom(e),this._surfaceElevation=r,this._focusOnMap[0]=i.x,this._focusOnMap[1]=i.y,this._visibility.setup(this._camera)}done(){this._visibility.done()}update(e){const{measures:i,extent:r,level:s}=e;i.visible=this._visibility.compute(e),i.distance=I8e(r,this._focusOnMap),i.mergeable=!0,i.lodLevel=K5,i.splitPriority=Math.max(0,K5-s),i.visible&&(this._isGlobal?this._updateSplitAndLodGlobal(e):this._updateSplitAndLodLocal(e))}_updateSplitAndLodGlobal(e){const i=e.level,r=this._renderCoordsHelper,{eye:s,fov:n}=this._camera,o=r.referenceEllipsoid.radius,a=ja(s)-o;if(2*Math.atan(o/a)<n&&a>0)return void(e.measures.lodLevel=Math.max(i,K5));const l=uve,{extent:c}=e,{_surfaceElevation:h}=this;se(l[0],c[0],c[1],h),se(l[1],c[2],c[1],h),se(l[2],c[2],c[3],h),se(l[3],c[0],c[3],h);const d=se(hve,.5*(c[0]+c[2]),.5*(c[1]+c[3]),h),f=this._tilingScheme.spatialReference;for(let _=0;_<4;++_)r.toRenderCoords(l[_],f,l[_]);r.toRenderCoords(d,f,d);const m=ae(D9.direction,d),g=fe(s,m),v=re(dve,m,g);this._updateSplitAndLod(e,l,d,v)}_updateSplitAndLodLocal(e){const i=uve,{extent:r}=e,{_surfaceElevation:s}=this;se(i[0],r[0],r[1],s),se(i[1],r[2],r[1],s),se(i[2],r[2],r[3],s),se(i[3],r[0],r[3],s);const n=this._tilingScheme.spatialReference;for(let d=0;d<4;++d)this._renderCoordsHelper.toRenderCoords(i[d],n,i[d]);const o=se(hve,.5*(i[0][0]+i[2][0]),.5*(i[0][1]+i[2][1]),.25*(i[0][2]+i[1][2]+i[2][2]+i[3][2])),a=se(JEt,o[0],o[1],0),{eye:l,far:c}=this._camera,h=se(dve,a[0],a[1],l[2]);se(D9.origin,a[0],a[1],l[2]-2*c),ne(D9.direction,bke),this._updateSplitAndLod(e,i,o,h)}_updateSplitAndLod(e,i,r,s){const n=Math.max(Ba(i[0],i[2]),Ba(i[1],i[3]),Ba(i[0],r)+Ba(r,i[2]),Ba(i[1],r)+Ba(r,i[3])),{eye:o,near:a,fov:l,viewForward:c,width:h,height:d,pixelRatio:f,frustum:m}=this._camera,g=fe(o,c),v=fe(r,c)-g,_=Ba(r,o);let b=v,w=v,x=_,S=_;const C=(j,B)=>B<a?1:Math.sqrt(j*j-B*B)/B;let T=C(_,v);for(const j of i){const B=fe(j,c)-g;b=Math.min(b,B),w=Math.max(w,B);const te=Ba(j,o);S=Math.max(S,te),x=Math.min(x,te);const le=C(te,B);T=Math.min(T,le)}if(w<a)return void(e.measures.lodLevel=0);const M=Math.cos(.5*l),I=Ba(o,s);T>M&&I>KEt*n&&(w=pve*S,b=pve*x);const D=.5*Math.sqrt(h*h+d*d)/f,P=2*Math.tan(.5*l),F=j=>Math.max(a,j)*XEt/D*P,L=e.level,N=n*2**L*Math.max(1,P),R=F(b),k=Math.ceil(Math.log2(Math.max(1,N/R)));if(e.measures.lodLevel=Math.max(k,e.measures.lodLevel),e.measures.splitPriority+=e.measures.lodLevel-L,L<k){const j=+pC(m,i[0])+ +pC(m,i[1])+ +pC(m,i[2])+ +pC(m,i[3]);e.measures.splitPriority+=j}const W=F(w)/R;W>2.5&&(e.measures.splitPriority+=W)}get _isGlobal(){return this._renderCoordsHelper.viewingMode===je.Global}};const uve=[$(),$(),$(),$()],hve=$(),JEt=$(),dve=$(),bke=yf(0,0,1),D9=Fse(cn,bke),XEt=312,KEt=.5,pve=2;function hoi(t,e,i){if(t==null||i==null)return!1;let r=!0;return Rn[0]=t.xmin!=null?t.xmin:0,Rn[1]=t.ymin!=null?t.ymin:0,Rn[2]=t.zmin!=null?t.zmin:0,r=r&&Gn(Rn,t.spatialReference,0,e,i,0),Rn[0]=t.xmax!=null?t.xmax:0,Rn[1]=t.ymax!=null?t.ymax:0,Rn[2]=t.zmax!=null?t.zmax:0,r=r&&Gn(Rn,t.spatialReference,0,e,i,3),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),r}function wke(t,e,i){if(t==null||i==null)return!1;let r=!0;return Rn[0]=t.xmin!=null?t.xmin:0,Rn[1]=t.ymin!=null?t.ymin:0,Rn[2]=t.zmin!=null?t.zmin:0,r=r&&Gn(Rn,t.spatialReference,0,Rn,i,0),e[0]=Rn[0],e[1]=Rn[1],Rn[0]=t.xmax!=null?t.xmax:0,Rn[1]=t.ymax!=null?t.ymax:0,Rn[2]=t.zmax!=null?t.zmax:0,r=r&&Gn(Rn,t.spatialReference,0,Rn,i,0),e[2]=Rn[0],e[3]=Rn[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),r}const Rn=$(),QEt=60;let Bo=class extends he{constructor(e){super(e),this.tiles=new Ce,this.tileSize=512,this._idToTile=new Map,this._clients=new Set,this._dirty=Ta(!1),this._pendingTiles=Ta(null),this._newTiles=new ii,this._tests=!1,this._measurements=new cve(e.renderCoordsHelper,e.tilingSchemeOwner.tilingScheme,this._opaqueGround)}initialize(){var r;const e=()=>this._setDirty(),i=()=>this._reset();this.addHandles([H(()=>this.tileSize,i,Mt),H(()=>{var s;return(s=this.cameraOnSurface)==null?void 0:s.location},e,Mt),H(()=>{var s;return(s=this.viewState)==null?void 0:s.contentCamera},e,Mt),H(()=>{var s;return(s=this.focus)==null?void 0:s.location},e,Mt),H(()=>{var s;return((s=this.terrain)==null?void 0:s.baseOpacity)??1},e),H(()=>this.tilingScheme,s=>{this._reset(),this._measurements=new cve(this.renderCoordsHelper,s,this._opaqueGround)},Yt),H(()=>this._opaqueGround,s=>this._measurements.opaqueGround=s,Yt)]),this._frameWorker=(r=this.scheduler)==null?void 0:r.registerTask(lt.FEATURE_TILE_TREE,this)}destroy(){this._frameWorker=Ji(this._frameWorker)}get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(e!=null&&!e.spatialReference.equals(this.viewState.spatialReference))return void J.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const i=this._get("filterExtent");if(i===e||i!=null&&e&&i.equals(e))return;const r=e!=null?e.clone():null;this._set("filterExtent",r),this._setDirty()}get _filterExtentRect(){if(this.filterExtent==null)return null;const e=si();return wke(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty.value||!!this._pendingTiles.value}addClient(){const e=Td();return this._clients.add(e),this._clients.size===1&&this._setDirty(),Pi(()=>this._removeClient(e))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}get _opaqueGround(){var e;return(((e=this.terrain)==null?void 0:e.baseOpacity)??1)===1}_setDirty(){this._hasClients&&!this.suspended&&(this._frameWorker?this._dirty.value=!0:this.runTask(Kc))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty.value=!1}get running(){return this.updating}_reset(){this._newTiles.clear(),this._pendingTiles.value=null,this._setDirty()}_getRootTiles(){const e=this.tilingScheme;return this._rootTileIds.map(i=>new tve(i[0],i[1],i[2],e))}runTask(e){e=this._tests?Kc:e,this._dirty.value=!1,this._pendingTiles.value||(this._startUpdate(e),this._frameWorker!=null&&(this._frameWorker.priority=lt.FEATURE_TILE_TREE_ACTIVE)),this._splitPendingTiles(e),this._pendingTiles.value||this._frameWorker==null||(this._frameWorker.priority=lt.FEATURE_TILE_TREE)}_startUpdate(e){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();const{_measurements:i,_filterExtentRect:r,_newTiles:s}=this;i.setup(this.viewState.contentCamera,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles.value=this._getRootTiles().filter(n=>{if(i.update(n),n.measures.visible&&(!r||y3(n.extent,r))){if(n.measures.splitPriority>0)return!0;s.push(n)}return!1}).sort(fve),this._newTiles.clear(),e.madeProgress()}_splitPendingTiles(e){const i=this._pendingTiles.value;if(!i)return;const{tilingScheme:r,_filterExtentRect:s,_newTiles:n,_measurements:o}=this;for(;i.length>0&&this._tileBudgetExceeded<1;){const a=i.pop();if(e.madeProgress(),a.measures.splitPriority>0){r.ensureMaxLod(a.level+1);const l=a.createChildren();for(const c of l)o.update(c),!c.measures.visible||s&&!y3(c.extent,s)||(c.measures.splitPriority>0?i.push(c):n.push(c));i.sort(fve),this._tileBudgetExceeded>=1&&(this._mergeNewTiles(),this._tileBudgetExceeded>=1&&this._mergeNewTiles(!0))}else n.push(a);if(e.done)return}n.pushArray(i),this._pendingTiles.value=null,this._updateTiles(),n.clear(),o.done()}get _tileBudgetExceeded(){var e;return Math.max(0,(this._newTiles.length+(((e=this._pendingTiles.value)==null?void 0:e.length)??0))/QEt-1)}_mergeNewTiles(e=!1){const{_newTiles:i,_measurements:r}=this,s=new Map(i.map(o=>[o.id,o]));let n=!1;return s.forEach(o=>{const{lij:a,measures:l}=o;if(!l.mergeable||a[1]%2!=0||a[2]%2!=0||a[0]<=1||o.lodLevelDelta>=pEt)return;const c=l.lodLevel;let h=c,d=!0;const f=s.get(X5(a[0],a[1]+1,a[2]));let m=Math.abs(((f==null?void 0:f.measures.lodLevel)??0)-c),g=m===0||e&&(f==null?void 0:f.measures.mergeable)&&m<=1;if(!f||!g)return;h+=f.measures.lodLevel,d&&(d=m===0);const v=s.get(X5(a[0],a[1],a[2]+1));if(m=Math.abs(((v==null?void 0:v.measures.lodLevel)??0)-c),g=m===0||e&&(v==null?void 0:v.measures.mergeable)&&m<=1,!v||!g)return;h+=v.measures.lodLevel,d&&(d=m===0);const _=s.get(X5(a[0],a[1]+1,a[2]+1));if(m=Math.abs(((_==null?void 0:_.measures.lodLevel)??0)-c),g=m===0||e&&(_==null?void 0:_.measures.mergeable)&&m<=1,!_||!g)return;h+=_.measures.lodLevel,d&&(d=m===0),i.removeUnordered(o),i.removeUnordered(f),i.removeUnordered(v),i.removeUnordered(_);const b=new tve(a[0]-1,a[1]/2,a[2]/2,this.tilingScheme);r.update(b),b.measures.visible=!0,b.measures.lodLevel=h/4,b.measures.mergeable=d,i.push(b),n=!0}),n}_updateTiles(){for(;this._mergeNewTiles(););for(;this._tileBudgetExceeded&&this._mergeNewTiles(!0););for(const s of this.tiles.items)s.used=!1;let e=!1;const i=this._newTiles.filter(s=>{const n=this._idToTile.get(s.id);return n?(e||(e=n.measures.lodLevel!==s.measures.lodLevel),n.measures={...s.measures},n.used=!0):this._idToTile.set(s.id,s),!n}),r=this.tiles.items.filter(s=>!s.used&&(this._idToTile.delete(s.id),!0));this.tiles.removeMany(r),this.tiles.addMany(i),this._sortTiles(),!e||r.length||i.length||this.tiles.emit("change")}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,i)=>e.measures.distance-i.measures.distance),this.tiles.forEach((e,i)=>e.loadPriority=i)}};function fve(t,e){return t.lodLevelDelta-e.lodLevelDelta||t.measures.splitPriority-e.measures.splitPriority||e.measures.distance-t.measures.distance}u([p({constructOnly:!0})],Bo.prototype,"scheduler",void 0),u([p({constructOnly:!0})],Bo.prototype,"renderCoordsHelper",void 0),u([p({constructOnly:!0})],Bo.prototype,"tilingSchemeOwner",void 0),u([p({constructOnly:!0})],Bo.prototype,"cameraOnSurface",void 0),u([p({constructOnly:!0})],Bo.prototype,"focus",void 0),u([p({constructOnly:!0})],Bo.prototype,"viewState",void 0),u([p({constructOnly:!0})],Bo.prototype,"terrain",void 0),u([p()],Bo.prototype,"tiles",void 0),u([p()],Bo.prototype,"tileSize",void 0),u([p({readOnly:!0})],Bo.prototype,"tilingScheme",null),u([p()],Bo.prototype,"filterExtent",null),u([p({readOnly:!0})],Bo.prototype,"_filterExtentRect",null),u([p({readOnly:!0})],Bo.prototype,"_rootTileIds",null),u([p({value:!1})],Bo.prototype,"suspended",null),u([p({readOnly:!0})],Bo.prototype,"updating",null),Bo=u([A("esri.views.3d.layers.support.FeatureTileTree3D")],Bo);let hs=class extends he{constructor(e){super(e),this._propertiesPool=new _v({camera:qr},this),this._lastSeenCameraProjectionValues=new qr,this.mode=ui.ANIMATING,this._cssCamera=new qr,this._camera=new qr,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.constraints=new hy({state:this}),this.events=new Ss,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}reset(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new _v({camera:qr},this)}destroy(){var e;this.cameraController=null,(e=this._propertiesPool)==null||e.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===je.Global){const e=yr(this.spatialReference).radius;this.camera=new qr({eye:De(4*e,0,0),center:De(e,0,0),up:De(0,0,1)})}else this.camera=new qr({eye:De(0,0,100),center:De(0,0,0),up:De(0,1,0)})}get animation(){return this.cameraController instanceof X3&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:i,width:r,pixelRatio:s}=this.camera;return e.pixelRatio=1,e.height=Math.round(i/s),e.width=Math.round(r/s),e}get camera(){return this._camera}set camera(e){e!==$h&&$h.copyFrom(e),$h.computeUp(this.viewingMode),this.events.emit("before-camera-change",$h);const i=this._camera;if(t2t(this._lastSeenCameraProjectionValues,$h)&&(this._lastSeenCameraProjectionValues.copyFrom($h),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!i.equals($h)&&(this._camera=this._propertiesPool.get("camera").copyFrom($h),this._cameraChanged=!i.almostEquals($h),this._cameraChanged)){const r=eTe(()=>{this._cameraChanged=!1,r.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===ui.IDLE}get updating(){return this.mode!==ui.IDLE}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=e!=null?e.clone():null}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===je.Global}get isLocal(){return this.viewingMode===je.Local}get viewingMode(){return TJ(this.view.viewingMode)}get spatialReference(){return this.view.spatialReference}get highlights(){const e=this.view.highlights.items.slice(0,oet);for(let i=0;i<e.length;){const r=e[i],s=e.findIndex(n=>n.name===r.name);s>=0&&i>s?e.splice(i,1):++i}return e}get highlightOrderMap(){const e=new Map;return this.highlights.forEach((i,r)=>e.set(i.name,r)),e}get navigating(){var e;return!!((e=this.cameraController)!=null&&e.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){var i;this.stopActiveCameraController()?((i=this.cameraController)==null||i.destroy(),e&&(this.removeHandles(mve),this.addHandles(bn(()=>e.state===Hr.Finished||e.state===Hr.Stopped,()=>{this._set("cameraController",null),this.updateCamera(r=>e.onControllerEnd(r))},{sync:!0,once:!0}),mve),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=Hr.Rejected)}switchCameraController(e){this.cameraController=e}stopActiveCameraController(){return!this.cameraController||this.cameraController.stopController()}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();$h.copyFrom(this._get("camera")),e($h),this.camera=$h,this._processingUpdates=!1,this._processUpdateQueue()}};u([p({constructOnly:!0})],hs.prototype,"view",void 0),u([p()],hs.prototype,"mode",void 0),u([p({readOnly:!0,type:xv})],hs.prototype,"animation",null),u([p({type:qr})],hs.prototype,"cssCamera",null),u([p()],hs.prototype,"_cssCamera",void 0),u([p({type:qr})],hs.prototype,"camera",null),u([p()],hs.prototype,"_camera",void 0),u([p({readOnly:!0})],hs.prototype,"pixelRatio",null),u([p()],hs.prototype,"rasterPixelRatio",void 0),u([p()],hs.prototype,"contentPixelRatio",void 0),u([p({readOnly:!0})],hs.prototype,"alignPixelEnabled",null),u([p({readOnly:!0})],hs.prototype,"updating",null),u([p({})],hs.prototype,"_contentCamera",void 0),u([p({type:qr})],hs.prototype,"contentCamera",null),u([p({readOnly:!0})],hs.prototype,"fixedContentCamera",null),u([p({readOnly:!0})],hs.prototype,"events",void 0),u([p({readOnly:!0})],hs.prototype,"isGlobal",null),u([p({readOnly:!0})],hs.prototype,"isLocal",null),u([p({readOnly:!0})],hs.prototype,"viewingMode",null),u([p({readOnly:!0})],hs.prototype,"highlights",null),u([p({readOnly:!0})],hs.prototype,"highlightOrderMap",null),u([p({readOnly:!0})],hs.prototype,"navigating",null),u([p({readOnly:!0})],hs.prototype,"stationary",null),u([p()],hs.prototype,"_cameraChanged",void 0),u([p()],hs.prototype,"cameraController",null),hs=u([A("esri.views.3d.state.ViewState")],hs);const e2t=hs;function t2t(t,e){return t.fov!==e.fov||t.fullViewport[0]!==e.fullViewport[0]||t.fullViewport[1]!==e.fullViewport[1]||t.fullViewport[2]!==e.fullViewport[2]||t.fullViewport[3]!==e.fullViewport[3]||t.padding[ai.TOP]!==e.padding[ai.TOP]||t.padding[ai.RIGHT]!==e.padding[ai.RIGHT]||t.padding[ai.BOTTOM]!==e.padding[ai.BOTTOM]||t.padding[ai.LEFT]!==e.padding[ai.LEFT]}const $h=new qr,mve="ViewStateHandles";function xke(t){return t?l2t:c2t}function i2t(t,e){return e!=null&&e.mode?e.mode:xke(t).mode}function r2t(t,e){return e??xke(t)}function Ske(t,e){return i2t(t==null||(t.hasZ??!1),e)}function foi(t,e){return r2t(t==null||(t.hasZ??!1),e)}function moi(t){const e=Eke(t);return Ske(t.geometry,e)}function s2t(t){const e=Eke(t),i=Ske(t.geometry,e),r=e!=null&&i!=="on-the-ground"?$ke(e):0,s=e==null?void 0:e.featureExpressionInfo;return{mode:i,offset:r,featureExpressionInfo:s}}function goi(t){return Tke(s2t(t))}function yoi(t){return Tke(t)||n2t(t)}function n2t(t){var e;return((e=t==null?void 0:t.featureExpressionInfo)==null?void 0:e.expression)==="0"}function Tke(t){if(!t||t.mode==="on-the-ground")return!1;const e=t!=null&&t.featureExpressionInfo?t.featureExpressionInfo.expression:null;return!(!e||e==="0")}function Eke(t){return t.layer&&"elevationInfo"in t.layer?t.layer.elevationInfo:null}function dae(t,e){if(!(t!=null&&t.offset))return 0;const{offset:i,unit:r}=t;if(r==="decimal-degrees")return 0;const s=r!=="unknown"&&r?r:"meters",n=UHe(e);return n?mr(i,s,n):0}function voi(t,e,i){if(!(i!=null&&i.mode))return;const r=t.hasZ?t.z:0,s=dae(i,t.spatialReference);switch(i.mode){case"absolute-height":return r-s;case"on-the-ground":return 0;case"relative-to-ground":return r-((e.elevationProvider.getElevation(t.x,t.y,r,t.spatialReference,"ground")??0)+s);case"relative-to-scene":return r-((e.elevationProvider.getElevation(t.x,t.y,r,t.spatialReference,"scene")??0)+s)}}function _oi(t,e,i,r=null){return Cke(t,e.x,e.y,e.hasZ?e.z:0,e.spatialReference,i,r)}function boi(t,e,i,r,s=null){return Cke(t,e[0],e[1],e.length>2?e[2]:0,i,r,s)}function Cke(t,e,i,r,s,n,o=null){if(n==null)return;const a=o!=null?o.mode:"absolute-height";if(a==="on-the-ground")return 0;const{absoluteZ:l}=o2t(e,i,r,s,t,n);return a2t(l,e,i,r,s,t,o,a)}function o2t(t,e,i,r,s,n){const o=dae(n,r);switch(n.mode){case"absolute-height":return{absoluteZ:i+o,elevation:0};case"on-the-ground":{const a=s.elevationProvider.getElevation(t,e,0,r,"ground")??0;return{absoluteZ:a,elevation:a}}case"relative-to-ground":{const a=s.elevationProvider.getElevation(t,e,i,r,"ground")??0;return{absoluteZ:i+a+o,elevation:a}}case"relative-to-scene":{const a=s.elevationProvider.getElevation(t,e,i,r,"scene")??0;return{absoluteZ:i+a+o,elevation:a}}}}function a2t(t,e,i,r,s,n,o,a){const l=dae(o,s);switch(a){case"absolute-height":return t-l;case"relative-to-ground":return t-((n.elevationProvider.getElevation(e,i,r,s,"ground")??0)+l);case"relative-to-scene":return t-((n.elevationProvider.getElevation(e,i,r,s,"scene")??0)+l)}}function woi(t,e){if(e==null)return!1;const{mode:i}=e;return i!=null&&(t==="scene"&&i==="relative-to-scene"||t==="ground"&&i!=="absolute-height")}function xoi(t,e,i){return i&&i.mode!==e?`${t} only support ${e} elevation mode`:null}function Soi(t,e,i){return(i==null?void 0:i.mode)===e?`${t} do not support ${e} elevation mode`:null}function Toi(t,e){return(e==null?void 0:e.featureExpressionInfo)!=null&&e.featureExpressionInfo.expression!=="0"?`${t} do not support featureExpressionInfo`:null}function Eoi(t,e){e&&t.warn(".elevationInfo=",e)}function $ke(t){return((t==null?void 0:t.offset)??0)*oPe(t==null?void 0:t.unit)}const l2t={mode:"absolute-height",offset:0},c2t={mode:"on-the-ground",offset:null},u2t="OBJECTID";let Coi=class extends wL{constructor(e,i,r,s){super(i,r),this.point=e,this.createGraphic=s}};function Ake(t){return dh(t)&&t.intersector===Xr.PCL&&!!t.target}let Aoi=class extends HPe{constructor(e,i,r,s,n){super(e),this.layerUid=e,this.sublayerUid=i,this.nodeIndex=r,this.componentIndex=s,this.triangleNr=n}},Ooi=class extends wL{constructor(e,i,r){super(i,null),this.point=e,this.createVoxelGraphic=r}},Roi=class extends wL{constructor(e,i){super(e,null),this.createTiles3DGraphic=i}};function j6(t){return dh(t)&&t.intersector===Xr.I3S&&!!t.target}function Mke(t){return dh(t)&&t.intersector===Xr.VOXEL&&!!t.target}function h2t(t){return dh(t)&&t.intersector===Xr.TILES3D&&!!t.target}function d2t(t){return dh(t)&&t.intersector===Xr.TERRAIN&&!!t.target}let p2t=class extends wL{constructor(e,i,r){super(e,i),this.triangleNr=r}};function Oke(t){return dh(t)&&t.intersector===Xr.OVERLAY&&!!t.target}function Ike(t,e){var i,r;return i6(t)||r6(t)?aD((i=t.target)==null?void 0:i.object,e):d2t(t)?(r=e.map)==null?void 0:r.ground:Ake(t)||j6(t)||Oke(t)||Mke(t)?aD(t.target,e):null}function Loi(t,e){const i=pae(t,e);return i!=null&&i.type==="graphic"?i.graphic:null}function pae(t,e){var i;if(t==null)return null;if(i6(t)||r6(t))return gve((i=t.target)==null?void 0:i.object,e);if(Ake(t)){const r=t.target.createGraphic();return{type:"graphic",graphic:r,layer:r.layer}}if(Mke(t)){const r=t.target.createVoxelGraphic();return{type:"graphic",graphic:r,layer:r.layer}}if(h2t(t)){const r=t.target.createTiles3DGraphic();return{type:"graphic",graphic:r,layer:r.layer}}return Oke(t)||lne(t)?gve(t.target,e):j6(t)?f2t(t.target,e):null}function gve(t,e){if((t==null?void 0:t.graphicUid)==null)return null;const i=aD(t,e);if(i==null)return null;if(i===e.graphics)return e.graphicsView==null||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const r=e.allLayerViews.find(s=>s.layer===i);return!r||r.suspended||t.graphicUid==null?null:"getHit"in r?r.getHit(t.graphicUid):null}function f2t(t,e){const i=aD(t,e);if(i==null)return null;const r=e.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getGraphicFromIntersectorTarget"in r?g2t(r.getGraphicFromIntersectorTarget(t)):null}function m2t(t,e){const i=aD(t,e);if(i==null)return null;const r=e.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getAABBFromIntersectorTarget"in r?r.getAABBFromIntersectorTarget(t):null}function g2t(t){return t!=null?{type:"graphic",graphic:t,layer:t.layer}:null}function aD(t,e){return(t==null?void 0:t.layerUid)==null?null:e.graphicsView!=null&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.allLayers.find(i=>i.uid===t.layerUid)}function Noi(t,e){if(i6(t)||r6(t))return Hm(t.target.object.boundingVolumeWorldSpace.bounds);if(lne(t)){v$e(ak,t.transformation);const i=Math.max(ak[0],ak[1],ak[2]);return t.target.baseBoundingSphere.radius*i}if(j6(t)){const i=m2t(t.target,e);return i?.5*DKe(i):null}return null}function Foi(t){return!i6(t)&&!r6(t)&&(lne(t)?t.target.numLodLevels>1:!!j6(t))}const ak=$();async function y2t(t,e,i,r){const s=i?Dke(t,i):r,n=ln(e.x,e.y);s.requiresGroundFeedback=!0,s.enableDraped=!0;const o=ph(t.state.viewingMode);o.options.selectionMode=!0,o.options.store=Co.ALL,t.sceneIntersectionHelper.intersectIntersectorScreen(n,o,s);const a=_2t(t,o.results.all,s.graphics),l=o.results.ground,c=Ike(l,t),h=c!=null&&"type"in c&&w3(c.type)?c:null,d={screenPoint:e,results:a,ground:{mapPoint:xC(t,l),distance:dh(l)?l.distanceInRenderSpace:0,layer:h}};return xs.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(d.intersector=o),d}function v2t(t,e,i,r){var h,d,f,m,g;const s=i?Dke(t,i):r,n=!(!((h=s.graphics)!=null&&h.include)&&!((d=s.graphics)!=null&&d.exclude)),o=!(!((f=s.mediaElements)!=null&&f.include)&&!((m=s.mediaElements)!=null&&m.exclude)),a=Yp(e);s.enableDraped=s.include&&!s.include.has(qb)||((g=s.exclude)==null?void 0:g.has(qb));const l=t.sceneIntersectionHelper,c=ph(t.state.viewingMode);if(c.options.selectionMode=!0,c.options.store=n||o?Co.ALL:Co.MIN,c.options.excludeLabels=(i==null?void 0:i.excludeLabels)??!1,l.intersectIntersectorScreen(a,c,s),n||o){for(const v of c.results.all){const _=pae(v,t);if(_==null||n&&(_.type!=="graphic"||Rke(s.graphics,_.graphic))||o&&(_.type!=="media"||Pke(s.mediaElements,_.element)))return xC(t,v)}return null}return xC(t,c.results.min)}function _2t(t,e,i){const r=new Array;let s=null;for(let n=0;n<e.length;n++){const o=e[n],a=Ike(o,t);if(a!=null&&(a===t.map.ground||"type"in a&&w3(a.type)))break;const l=pae(o,t);if(l==null)continue;if(l.type==="graphic"){if(s==null&&n!==e.length-1&&(s=new Set),s!=null){const d=fae(l.graphic);if(s.has(d))continue;s.add(d)}if(!Rke(i,l.graphic))continue}const c=xC(t,o),h=o.distanceInRenderSpace;if(l.type==="media"){const d=l.element.toSource(c);r.push({...l,mapPoint:c,distance:h,sourcePoint:d})}else r.push({...l,mapPoint:c,distance:h})}return r}function xC(t,e,i){return e.getIntersectionPoint(SC)?(i=GK(t,SC,i),e.intersector===Xr.TERRAIN&&t.basemapTerrain&&(i.z=Pm(t.basemapTerrain,i)??0),i):null}function fae(t){var s;const e=t.sourceLayer,i=t.layer,r=e&&"objectIdField"in e?e:i&&"objectIdField"in i?i:e;if(r){const n=r.objectIdField??u2t,o=(s=t.attributes)==null?void 0:s[n];if(o)return`o-${r.id}-${o}`}return`u-${t.uid}`}function Rke(t,e){return Pke(t,fae(e))}function Pke(t,e){return t==null||(t.include==null||t.include.has(e))&&(t.exclude==null||!t.exclude.has(e))}function GK(t,e,i){let r=t.spatialReference||Oe.WGS84;return vc(e,t.renderSpatialReference,SC,r)?e=SC:(r=Oe.WGS84,vc(e,t.renderSpatialReference,SC,r)&&(e=SC)),i?(i.x=e[0],i.y=e[1],i.z=e[2],i.spatialReference=r):i=new Fe(e,r),i}function Dke(t,e){const i=HK(t,e.include,AA.INCLUDE),r=HK(t,e.exclude,AA.EXCLUDE);return{include:i.layerUids,exclude:r.layerUids,graphics:{include:i.graphicUids,exclude:r.graphicUids},mediaElements:{include:i.mediaElements,exclude:r.mediaElements}}}function HK(t,e,i,r={layerUids:void 0,graphicUids:void 0,mediaElements:void 0}){if(!e)return r;if(e instanceof Pl)b2t(r,fae(e)),i===AA.INCLUDE&&(t.graphicsView!=null&&e.layer===t?cE(r,t.graphicsView.processor.layer.id):e.layer&&cE(r,e.layer.uid));else if("layer"in e&&"element"in e)w2t(r,e.element),i===AA.INCLUDE&&cE(r,e.layer.uid);else if(o3(e))for(const s of e)s===t.graphics&&t.graphicsView!=null?cE(r,t.graphicsView.processor.layer.id):s===t.map.ground?cE(r,qb):HK(t,s,i,r);else"uid"in e&&cE(r,e.uid);return r}function cE(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function b2t(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}function w2t(t,e){t.mediaElements||(t.mediaElements=new Set),t.mediaElements.add(e)}const SC=$();var AA;(function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"})(AA||(AA={}));let x2t=class{constructor(e,i,r){this.viewingMode=e,this._forEachLayer=i,this._view=r,this._externalIntersectionHandlers=new ii,this._tolerance=yA,this._tmpRay=Nn(),this._tmpRegion=si(),this._validateHUDIntersector=ph(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,i,r){return this.intersectRay(this._getPickRay(e,this._tmpRay),yve(this.viewingMode),i,r)}intersectScreenFreePointFallback(e,i,r){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),i,r)}intersectRayFreePointFallback(e,i,r){return this.intersectRay(e,yve(this.viewingMode),i,r)||this._intersectRayFreePointLocal(e,i)}intersectRay(e,i,r,s){return i.options.selectionMode=!1,i.options.store=Co.MIN,this.computeIntersection(e,i,s),!!i.results.min&&i.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(e,i,r=.5,s=.5){return e.getRenderCenter(ck,r,s),ck[0]+=.0466,ck[1]-=.0123,Goe(e,ck,i)}intersectIntersectorScreen(e,i,r){this.computeIntersection(this._getPickRay(e,this._tmpRay),i,r)}intersectToolIntersectorScreen(e,i,r){const s=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(s,i,r)}intersectToolIntersectorRay(e,i,r){i.options.selectionMode=!0,this.computeIntersection(e,i,r);const s=i.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||dh(s)&&s.intersector!==Xr.TERRAIN||(i.options.selectionMode=!1,this.computeIntersection(e,i,r))}setTolerance(e=yA){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((i,r)=>i.type===Xr.TERRAIN?1:r.type===Xr.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((i,r)=>i.type===Xr.TERRAIN?1:r.type===Xr.TERRAIN?-1:0)}_getPickRay(e,i){const r=this._view.state.camera;return joe(r,e,i)}_intersectRayFreePointLocal(e,i){return this.viewingMode!==je.Local||e==null||oe(i,e.origin,ae(Le.get(),e.direction)),!1}intersectElevationFromScreen(e,i,r=0,s=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),i,r,s)}_intersectElevation(e,i,r=0,s=null){if(e==null)return null;const n=this._view,{renderCoordsHelper:o}=n,a=gS(n.spatialReference),l=i!=null?i.mode:"absolute-height",c=$ke(i)/a,h=(l!=="on-the-ground"?c+r:0)*a/o.unitInMeters,{camera:d}=n.state;if(l==="absolute-height"){const S=o==null?void 0:o.getAltitude(d.eye),C=fe(ae($O,e.direction),o.worldUpAtPosition(d.eye,E2t));if(S<h&&C<0||S>=h&&C>0)return null;if(o.intersectInfiniteManifold(e,h,$O)){const T=GK(n,$O);return T.z??(T.z=0),T.z-=c,T}return null}const f=Le.get();d.projectToRenderScreen(e.origin,f);const m=new vve(null,this._forEachLayer),{slicePlane:g}=n,v=g!=null?dfe(g):null,_=ph(this.viewingMode);_.options.store=Co.MIN,_.options.verticalOffset=h,_.options.normalRequired=!1;const b=e.origin,w=oe(Le.get(),b,e.direction);_.reset(b,w,d),_.point=f;const x=s?"type"in s&&s.type==="graphics"?S=>S.layerUid!==s.uid:S=>S.graphicUid!==s.uid:null;switch(l){case"relative-to-scene":{const S=C=>(!x||x(C))&&!!C.lastValidElevationBB;_.intersect(m.layers,f,this._tolerance,null,S),this._externalIntersectionHandlers.forAll(C=>{if(C.type===Xr.I3S||C.type===Xr.TERRAIN||C.type===Xr.TILES3D){const T=C.slicePlaneEnabled?v:null;C.intersect(_,T,_.rayBegin,_.rayEnd,f)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(S=>{if(S.isGround){const C=S.slicePlaneEnabled?v:null;S.intersect(_,C,_.rayBegin,_.rayEnd,f)}})}if(_.results.min.getIntersectionPoint($O)){const S=GK(n,$O);return S.z=r,S}return null}computeIntersection(e,i,r,s){var v;if(e==null)return;const n=this._view.state.camera,o=Le.get();n.projectToRenderScreen(e.origin,o);const a=new vve(r,this._forEachLayer);i.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);const l=e.origin,c=oe(Le.get(),e.origin,e.direction);i.reset(l,c,n),i.intersect(a.layers,o,this._tolerance);const h=this._view.slicePlane,d=h!=null?dfe(h):null;i.intersect(a.sliceableLayers,o,this._tolerance,d);const f=r&&(r.requiresGroundFeedback||r.enableDraped);this._externalIntersectionHandlers.forAll(_=>{const b=_.layerUid,w=Array.isArray(b),x=w?b:[b];w&&(i.options.filteredLayerUids=[]);let S=!1;for(const C of x)a.filterLayerUid(C)?S=!0:w&&i.options.filteredLayerUids.push(C);if(i.options.isFiltered=!S,_.isGround&&f||!i.options.isFiltered){const C=_.slicePlaneEnabled?d:null;_.intersect(i,C,l,c,o,s)}});const m=Le.get(),g=this._view.basemapTerrain;if(r&&r.enableDraped&&g.spatialReference!=null&&i.results.ground.getIntersectionPoint(m)){const _=g.overlayManager.renderer,b=this._view.renderCoordsHelper.spatialReference,w=Le.get();this._view.renderCoordsHelper.fromRenderCoords(m,w,g.spatialReference),w[2]=((v=this._view.elevationProvider)==null?void 0:v.getElevation(m[0],m[1],m[2],b,"ground"))??0,_.intersect(i,w,i.results.ground,x=>a.filterRenderGeometry(x))}i.sortResults(),this._processHUDResults(i)}_processHUDResults(e){const i=e.results.hud;Lb(this._tmpRegion,pZ);const r=this._view.state.camera,s=[],n=this._tmpRegion,o=b=>{const w=new T2t(b),x=w.result.target.object.geometries.every(S=>S.material instanceof Koe&&S.material.parameters.occlusionTest);s.push({item:w,occlusionTest:x}),x&&(r.projectToRenderScreen(b.target.center,w.screenPoint),w.screenPoint[0]=Math.floor(w.screenPoint[0]),w.screenPoint[1]=Math.floor(w.screenPoint[1]),M8e(n,w.screenPoint))};e.sortResults(i.all),i.min.dist!=null&&o(i.min);for(const b of i.all)i.min.target.object!==b.target.object&&i.max.target.object!==b.target.object&&o(b);if(i.max.dist!=null&&i.max.target.object!==i.min.target.object&&o(i.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=r.fullWidth,l=r.fullHeight,c=Math.max(0,n[0]-sR),h=Math.max(0,n[1]-sR),d=Math.min(Jo(n)+2*sR,a-c),f=Math.min(El(n)+2*sR,l-h),m=d>0&&f>0?new Uint8Array(d*f*4):null;m&&this._view._stage.renderer.readHUDVisibility(c,h,d,f,m);let g=!0;const v=e.results.max.dist==null;let _=0;for(const{item:b,occlusionTest:w}of s){let x=!w;if(w&&m)for(const S of S2t){const C=4*(Math.min(b.screenPoint[0]+S[0],a)-n[0]+(Math.min(b.screenPoint[1]+S[1],l)-n[1])*d);if(C>=0&&C<m.length&&m[C]){x=!0;break}}x&&(g&&(e.results.min.copy(b.result),g=!1),v&&e.results.max.copy(b.result),e.options.store===Co.ALL&&e.results.all.splice(_++,0,b.result))}}};const sR=1,S2t=(()=>{const t=[],e=sR;for(let i=-1;i<=e;i++)for(let r=-1;r<=e;r++)t.push([r+e,i+e]);return t})();let T2t=class{constructor(e){this.result=e,this.screenPoint=Qp()}},lk;function yve(t){return lk&&lk.viewingMode===t||(lk=ph(t)),lk}let vve=class{constructor(e,i){this.layers=new Array,this.sliceableLayers=new Array,this.include=e==null?void 0:e.include,this.exclude=e==null?void 0:e.exclude,i(r=>{r.pickable&&this.filterLayerUid(r.apiLayerUid)&&(r.sliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerUid(e){const{include:i,exclude:r}=this;return e==null?i==null&&r==null:(i==null||i.has(e))&&(r==null||!r.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function _ve(t){return typeof t=="object"&&"intersect"in t}const $O=$(),E2t=$(),ck=Qp();let Boi=class{constructor(e,i){this.spatialReference=e,this._view=i}getElevation(e,i,r){return this._view.elevationProvider.getElevation(e,i,0,this.spatialReference,r)}async queryElevation(e,i,r,s,n){return this._view.elevationProvider.queryElevation(e,i,0,this.spatialReference,n,r,s)}},C2t=class{constructor(e,i,r,s){this.spatialReference=i,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...s,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(lt.ELEVATION_QUERY,this)}destroy({completeTasks:e}={completeTasks:!1}){if(this._frameTask.remove(),this.running)if(e)this.runTask(Kc);else for(const i of this._queries)i.result.reject(bi())}queryElevation(e,i,r,s=0){const n=ta(),o={x:e,y:i,minDemResolution:s,result:n,signal:r};return this._queries.push(o),Qo(r,()=>{MD(this._queries,o),n.reject(bi())}),n.promise}get running(){return this._queries.length>0}runTask(e){const i=this._queries;this._queries=[];const r=this._getElevationQueryProvider();if(!r)return i.forEach(h=>h.result.reject()),void e.madeProgress();const s=i.map(h=>[h.x,h.y]),n=i.reduce((h,d)=>Math.min(h,d.minDemResolution),1/0),o=new WS({points:s,spatialReference:this.spatialReference}),a=i.length>1&&i.some(h=>!!h.signal)?new AbortController:null,l=a!=null?a.signal:i[0].signal;if(a!=null){let h=0;i.forEach(d=>Qo(d.signal,()=>{h++,d.result.reject(bi()),h===i.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:n,signal:l};r.queryElevation(o,c).then(h=>{i.forEach((d,f)=>{d.signal!=null&&d.signal.aborted?d.result.reject(bi()):d.result.resolve(h.geometry.points[f][2])})}).catch(h=>{i.forEach(d=>d.result.reject(h))}),e.madeProgress()}get test(){}},nV=class{constructor(e=1/0,i=-1/0){this.elevationRangeMin=e,this.elevationRangeMax=i}get elevationRangeValid(){return!Number.isNaN(this.elevationRangeMin)}invalidateElevationRange(){this.elevationRangeMin=NaN}expandElevationRangeValues(e,i){this.elevationRangeMin=Math.min(this.elevationRangeMin,e),this.elevationRangeMax=Math.max(this.elevationRangeMax,i)}expandElevationRange(e){this.elevationRangeMin=Math.min(this.elevationRangeMin,e.elevationRangeMin),this.elevationRangeMax=Math.max(this.elevationRangeMax,e.elevationRangeMax)}setElevationRange(e){this.elevationRangeMin=e.elevationRangeMin,this.elevationRangeMax=e.elevationRangeMax}},nR=class extends Ss.EventedMixin(he){get spatialReference(){var e,i;return(i=(e=this.view)==null?void 0:e.basemapTerrain)==null?void 0:i.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this.lastElevationQuery=null,this._cacheEnabled=!1}destroy(){this._cachedQuery=$e(this._cachedQuery)}enableCache(e){e||(this.lastElevationQuery=null),this._cacheEnabled=e}getElevation(e,i,r,s,n){if(this._cacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&i===a.y&&r===a.z&&as(s,a.spatialReference)&&n===a.queryContext)return a.result}let o=null;return o=uk(o,this._im,e,i,r,s,n),o==null&&(o=uk(o,this._ground,e,i,r,s,n)),n==="scene"&&(o=uk(o,this._scene,e,i,r,s,n)),this._cacheEnabled&&(this.lastElevationQuery={x:e,y:i,z:r,spatialReference:s,queryContext:n,result:o}),o}getSphereElevationBounds(e,i,r){const s=new nV;function n(o){for(const a of o)if(a.getSphereElevationBounds){const l=a.getSphereElevationBounds(e,i,r);l!=null&&s.expandElevationRangeValues(l.elevationRangeMin,l.elevationRangeMax)}}return n(this._ground),n(this._im),r==="scene"&&n(this._scene),s}getRootElevationBounds(){const e=new nV;for(const i of[this._im,this._ground,this._scene])i.forEach(r=>{if(r.getRootElevationBounds){const s=r.getRootElevationBounds();s!=null&&e.expandElevationRangeValues(s.elevationRangeMin,s.elevationRangeMax)}});return e}async queryElevation(e,i,r,s,n,o=null,a=0){const l=this._getElevationQuery(s);try{const c=await l.queryElevation(e,i,o,a);return n==="scene"?uk(c,this._scene,e,i,r,s,n):c}catch(c){return Wc(c),this.getElevation(e,i,r,s,n)}}register(e,i){this.addHandles(i.on("elevation-change",r=>this.emit("elevation-change",r)),i),this._providersFromContext(e).push(i)}unregister(e){this.removeHandles(e);for(const i of[this._im,this._ground,this._scene]){const r=i.indexOf(e);r>-1&&i.splice(r,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}_getElevationQuery(e=this.view.spatialReference){const i=this._cachedQuery;if(i!=null&&as(e,i.spatialReference))return i;i==null||i.destroy({completeTasks:!0});const{wkid:r,wkt:s,wkt2:n,latestWkid:o}=e,a=new C2t(this.view.resourceController.scheduler,new Oe({wkid:r,wkt:s,wkt2:n,latestWkid:o}),()=>{var l;return(l=this.view.map)==null?void 0:l.ground},{maximumAutoTileRequests:4});return this._cachedQuery=a,a}};function uk(t,e,i,r,s,n,o){for(const a of e){const l=a.getElevation(i,r,s,n,o);l!=null&&(t=t!=null?Math.max(l,t):l)}return t}u([p({constructOnly:!0})],nR.prototype,"view",void 0),u([p()],nR.prototype,"spatialReference",null),nR=u([A("esri.views.3d.support.CombinedElevationProvider")],nR);let nS=class qK{static isValidProfile(e){return e in qK.profiles}static getDefaultProfile(){return X("esri-iPhone")?"low":"medium"}static apply(e,i){const r=qK.profiles[e];i.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,i.graphics3D.maxNumberOfDrawCalls=r.graphics3D.maxNumberOfDrawCalls,i.graphics3D.maxTotalNumberOfVertices=r.graphics3D.maxTotalNumberOfVertices,i.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,i.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor,i.graphics3D.snapshotAvailable=r.graphics3D.snapshotAvailable,i.graphics3D.skipHighSymbolLods=r.graphics3D.skipHighSymbolLods,i.graphics3D.uncompressedTextureDownsamplingEnabled=r.graphics3D.uncompressedTextureDownsamplingEnabled;const s=i.sceneService.object,n=r.sceneService.object;s.lodFactor=n.lodFactor,i.sceneService.point.lodFactor=r.sceneService.point.lodFactor,i.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,i.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,i.sceneService.uncompressedTextureDownsamplingEnabled=r.sceneService.uncompressedTextureDownsamplingEnabled,i.tiledSurface.lodBias=r.tiledSurface.lodBias,i.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,i.tiledSurface.vtlContentZoom=r.tiledSurface.vtlContentZoom,i.tiledSurface.elevationLevelDelta=r.tiledSurface.elevationLevelDelta,i.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,i.heatmap.pixelRatio=r.heatmap.pixelRatio,i.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures,i.fadeDuration=r.fadeDuration,i.antialiasingEnabled=r.antialiasingEnabled,i.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,i.highQualityTransparency=r.highQualityTransparency,i.highResolutionAtmosphere=r.highResolutionAtmosphere,i.reflections=r.reflections,i.ambientOcclusion=r.ambientOcclusion,i.memoryLimit=r.memoryLimit,i.additionalCacheMemory=r.additionalCacheMemory,i.frameRate=r.frameRate,i.maximumPixelRatio=r.maximumPixelRatio}};nS.test={reset(){const t=Lke();for(const e of Object.keys(t))nS.profiles[e]=t[e]}};const AO={IPhone12Pro:120,GalaxyS20:200,FullHD:240,SurfacePro7:300,FullHDRetina:430};function Lke(){const t=!!X("esri-mobile"),e=!!X("ios"),i=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxNumberOfDrawCalls:8e3,maxTotalNumberOfVertices:255e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0,uncompressedTextureDownsamplingEnabled:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,vtlContentZoom:.75,elevationLevelDelta:3,reduceTileLevelDifferences:!0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200+AO.IPhone12Pro,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:625e4,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:t},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:13e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:3,reduceTileLevelDifferences:!X("disable-feature:reduce-map-tile-levels")},fadeDuration:i,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:t?600+AO.GalaxyS20:750+AO.FullHD,additionalCacheMemory:t?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:125e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:23e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:2,reduceTileLevelDifferences:!X("disable-feature:reduce-map-tile-levels")},fadeDuration:i,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:t?900+AO.SurfacePro7:1500+AO.FullHDRetina,additionalCacheMemory:t?-150:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}(function(t){t.profiles=Lke()})(nS);var kt;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})(kt||(kt={}));const d2=[kt.ELEVATION,kt.MAP];async function $2t(t,e){if(t.type==="2d")return t.hitTest(e);const i=await t.hitTest(e);if(i.results.length===0)return i;const r=i.results[0],s=(r.distance??0)*(1+A2t),n=i.results.findIndex(o=>(o.distance??0)>s);return n!==-1&&(i.results=i.results.slice(0,n)),r&&i.ground.distance>s&&(i.ground.mapPoint=null),i}const A2t=.05;function M2t(t){return(t==null?void 0:t.type)==="graphic"}function qoi(t){return t.find(M2t)??null}async function O2t(t,e){var f,m,g,v,_;const{results:i,ground:r}=await $2t(t,e),s=(!r.layer||!w3(r.layer.type))&&r.mapPoint,n=[],o=P2t(t),a=s?I2t(t,o):R2t;let l=0,c=0;const h=()=>{const b=a.layerViews[c];s&&b&&"fetchPopupFeaturesAtLocation"in b&&n.push({mapPoint:r.mapPoint,layerView:b}),++c};let d=null;for(;l<i.length||c<a.layerViews.length;){const b=i[l];if(b&&b.type!=="graphic")++l;else if(((f=b==null?void 0:b.layer)==null?void 0:f.type)!=="scene"||((m=b==null?void 0:b.layer)==null?void 0:m.parent)!==((g=t==null?void 0:t.map)==null?void 0:g.basemap))if(b){const w=(v=b.layer)==null?void 0:v.uid,x=a.layerUids.has(w)&&b.distance===r.distance,S=o.get((_=b.layer)==null?void 0:_.uid);if(d??(d=b.mapPoint),c<a.layerViews.length&&(x||(b.distance??0)>r.distance)&&a.layerViews[c]!==S){h();continue}n.push({graphic:b.graphic,layerView:S}),++l}else h();else++l}return d??(d=r.mapPoint),{hits:n,location:d}}function I2t(t,e){const i=new Set,r=[];for(let n=t.basemapTerrain.numLayers(kt.MAP)-1;n>=0;n--){const o=t.basemapTerrain.layerViewByIndex(n,kt.MAP);i.add(o.layer.uid),r.push(o)}const s=t.basemapTerrain.overlayManager.renderer.layers;for(const{uid:n}of s){const o=e.get(n);o&&(i.add(n),r.push(o))}return r.reverse(),{layerUids:i,layerViews:r}}const R2t={layerUids:new Set,layerViews:[]};function P2t(t){const e=new Map;for(const i of t.allLayerViews){const r=i.layer.uid;e.set(r,i)}return e}let Bu=class extends he{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxNumberOfDrawCalls=17e3,this.maxTotalNumberOfVertices=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1,this.uncompressedTextureDownsamplingEnabled=!1}};u([p()],Bu.prototype,"minTotalNumberOfFeatures",void 0),u([p()],Bu.prototype,"maxTotalNumberOfFeatures",void 0),u([p()],Bu.prototype,"maxNumberOfDrawCalls",void 0),u([p()],Bu.prototype,"maxTotalNumberOfVertices",void 0),u([p()],Bu.prototype,"snapshotAvailable",void 0),u([p()],Bu.prototype,"polygonLodFactor",void 0),u([p()],Bu.prototype,"polylineLodFactor",void 0),u([p()],Bu.prototype,"skipHighSymbolLods",void 0),u([p()],Bu.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Bu=u([A("esri.views.3d.support.QualitySettings.Graphics3DSettings")],Bu);let tf=class extends he{constructor(){super(...arguments),this.lodFactor=1}};u([p()],tf.prototype,"lodFactor",void 0),tf=u([A("esri.views.3d.support.QualitySettings.LoDFactorSettings")],tf);let Ry=class extends he{constructor(){super(...arguments),this.object=new tf,this.point=new tf,this.integratedMesh=new tf,this.pointCloud=new tf,this.uncompressedTextureDownsamplingEnabled=!1}};u([p({type:tf})],Ry.prototype,"object",void 0),u([p({type:tf})],Ry.prototype,"point",void 0),u([p({type:tf})],Ry.prototype,"integratedMesh",void 0),u([p({type:tf})],Ry.prototype,"pointCloud",void 0),u([p()],Ry.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Ry=u([A("esri.views.3d.support.QualitySettings.SceneServiceSettings")],Ry);let Py=class extends he{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.vtlContentZoom=1,this.elevationLevelDelta=3,this.reduceTileLevelDifferences=!0}};u([p()],Py.prototype,"lodBias",void 0),u([p()],Py.prototype,"angledSplitBias",void 0),u([p()],Py.prototype,"vtlContentZoom",void 0),u([p()],Py.prototype,"elevationLevelDelta",void 0),u([p()],Py.prototype,"reduceTileLevelDifferences",void 0),Py=u([A("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],Py);let TC=class extends he{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};u([p()],TC.prototype,"pixelRatio",void 0),u([p()],TC.prototype,"maxTotalNumberOfFeatures",void 0),TC=u([A("esri.views.3d.support.QualitySettings.HeatmapSettings")],TC);let oa=class extends he{constructor(){super(...arguments),this.graphics3D=new Bu,this.sceneService=new Ry,this.tiledSurface=new Py,this.heatmap=new TC,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};u([p({type:Bu})],oa.prototype,"graphics3D",void 0),u([p({type:Ry})],oa.prototype,"sceneService",void 0),u([p({type:Py})],oa.prototype,"tiledSurface",void 0),u([p({type:TC})],oa.prototype,"heatmap",void 0),u([p()],oa.prototype,"fadeDuration",void 0),u([p()],oa.prototype,"antialiasingEnabled",void 0),u([p()],oa.prototype,"physicallyBasedRenderingEnabled",void 0),u([p()],oa.prototype,"highQualityTransparency",void 0),u([p()],oa.prototype,"highResolutionAtmosphere",void 0),u([p()],oa.prototype,"reflections",void 0),u([p()],oa.prototype,"ambientOcclusion",void 0),u([p()],oa.prototype,"memoryLimit",void 0),u([p()],oa.prototype,"additionalCacheMemory",void 0),u([p()],oa.prototype,"frameRate",void 0),u([p()],oa.prototype,"maximumPixelRatio",void 0),oa=u([A("esri.views.3d.support.QualitySettings")],oa);const bve=oa;let D2t=class WK{constructor(e,i,r,s){this.viewingMode=e,this.spatialReference=i,this.unitInMeters=r,this._coordinateSystem=s,this._tmpCoordinateSystem=act(s),this.referenceEllipsoid=yr(i),this.sphericalPCPF=jb(i)}set extent(e){e&&lct(this._coordinateSystem,e,this._coordinateSystem)}get extent(){return cct(this._coordinateSystem,si())}getAltitude(e){return yct(this._coordinateSystem,e)}setAltitude(e,i,r=e){return YRe(this._coordinateSystem,r,i,e)}setAltitudeOfTransformation(e,i){vct(this._coordinateSystem,i,e,i)}worldUpAtPosition(e,i){return pct(this._coordinateSystem,e,i)}worldBasisAtPosition(e,i,r){return fct(this._coordinateSystem,e,i,r)}basisMatrixAtPosition(e,i){const r=this.worldBasisAtPosition(e,rs.X,Le.get()),s=this.worldBasisAtPosition(e,rs.Y,Le.get()),n=this.worldBasisAtPosition(e,rs.Z,Le.get());return yg(i,r[0],r[1],r[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),i}headingAtPosition(e,i){const r=this.worldUpAtPosition(e,Le.get()),s=this.worldBasisAtPosition(e,rs.Y,Le.get()),n=SRe(i,s,r);return Ao(n)}intersectManifoldClosestSilhouette(e,i,r){return J8(this._coordinateSystem,i,this._tmpCoordinateSystem),gct(this._tmpCoordinateSystem,e,r),r}intersectManifold(e,i,r){J8(this._coordinateSystem,i,this._tmpCoordinateSystem);const s=Le.get();return mct(this._tmpCoordinateSystem,e,s)?ne(r,s):null}intersectInfiniteManifold(e,i,r){if(this.viewingMode===je.Global)return this.intersectManifold(e,i,r);J8(this._coordinateSystem,i,this._tmpCoordinateSystem);const s=this._tmpCoordinateSystem.value,n=Le.get();return dM(s.plane,e,n)?ne(r,n):null}toRenderCoords(e,i,r){return SB(e)?gc(e,i,this.spatialReference):vc(e,i,r,this.spatialReference)}fromRenderCoords(e,i,r=null){return SB(i)?(r!=null&&(i.spatialReference=r),dT(e,this.spatialReference,i)?i:null):vc(e,this.spatialReference,i,r)?i:null}static create(e,i){switch(e){case je.Local:return new WK(je.Local,i,Mo(i),dct());case je.Global:return new WK(je.Global,i,1,hct(i))}}static renderUnitScaleFactor(e,i){return aue(e)/aue(i)}};var Im;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})(Im||(Im={}));const L2t=(()=>{const t=new Array;return t[Im.ELEVATION]=10,t[Im.BASEMAP]=10,t[Im.I3S_INDEX]=10,t[Im.I3S_DATA]=10,t[Im.SYMBOLOGY]=5,t})(),N2t=30,ZK=-3,Nke=ZK-1;var Up;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})(Up||(Up={}));let F2t=class{constructor(e,i,r,s=0){this.name=e,this._storage=i,this._defaultPriority=s,this.id=k2t+++":",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),r&&(this._storage.registerRemoveFunc(this.id,r),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(e){return this._storage.getSize(this,e)}resetHitRate(){this._hit=this._miss=0}put(e,i,r=this._defaultPriority){this._storage.put(this,e,i,i.cachedMemory,r)}pop(e){const i=this._storage.pop(this,e);return i===void 0?++this._miss:++this._hit,i}get(e){const i=this._storage.get(this,e);return i===void 0?++this._miss:++this._hit,i}peek(e){return this._storage.peek(this,e)}updateSize(e,i){this._storage.updateSize(this,e,i,i.cachedMemory)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}},Fke=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new ii,this._users=new ii}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear()}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,i){this._removeFuncs.push([e,i])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(i=>i[0]!==e)}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,i){const r=this._db.get(e.id+i);return(r==null?void 0:r.size)??0}put(e,i,r,s,n){i=e.id+i;const o=this._db.get(i);if(o&&(this._size-=o.size,e.size-=o.size,this._db.delete(i),o.entry!==r&&this._notifyRemove(i,o.entry,o.size,Up.ALL)),s>this._maxSize)return void this._notifyRemove(i,r,s,Up.ALL);if(r===void 0)return void console.warn("Refusing to cache undefined entry ");if(!s||s<0)return console.warn(`Refusing to cache entry with size ${s} for key ${i}`),void this._notifyRemove(i,r,0,Up.ALL);const a=1+Math.max(n,Nke)-ZK;this._db.set(i,new z2t(r,s,a)),this._size+=s,e.size+=s,this._checkSize()}updateSize(e,i,r,s){i=e.id+i;const n=this._db.get(i);if(n&&n.entry===r){for(this._size-=n.size,e.size-=n.size;s>this._maxSize;){const o=this._notifyRemove(i,r,s,Up.SOME);if(!(o!=null&&o>0))return void this._db.delete(i);s=o}n.size=s,this._size+=s,e.size+=s,this._checkSize()}}pop(e,i){i=e.id+i;const r=this._db.get(i);if(r)return this._size-=r.size,e.size-=r.size,this._db.delete(i),++this._hit,r.entry;++this._miss}get(e,i){i=e.id+i;const r=this._db.get(i);if(r!==void 0)return this._db.delete(i),r.lives=r.lifetime,this._db.set(i,r),++this._hit,r.entry;++this._miss}peek(e,i){const r=this._db.get(e.id+i);return r?++this._hit:++this._miss,r==null?void 0:r.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},r=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;r[l]=(r[l]||0)+o.size,this._users.forAll(c=>{const{id:h,name:d}=c;if(a.startsWith(h)){const f=i[d]||0;i[d]=f+o.size}})});const s={};this._users.forAll(o=>{const a=o.name;if("hitRate"in o&&typeof o.hitRate=="number"&&!isNaN(o.hitRate)&&o.hitRate>0){const l=i[a]||0;i[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(i);n.sort((o,a)=>i[a]-i[o]),n.forEach(o=>e[o]=Math.round(i[o]/2**20)+"MB / "+s[o]);for(let o=r.length-1;o>=0;--o){const a=r[o];a&&(e["Priority "+(o+ZK-1)]=Math.round(a/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){const i=e.id;this._db.forEach((r,s)=>{s.startsWith(i)&&(this._size-=r.size,this._db.delete(s),this._notifyRemove(s,r.entry,r.size,Up.ALL))}),e.size=0}clearAll(){this._db.forEach((e,i)=>this._notifyRemove(i,e.entry,e.size,Up.ALL)),this._users.forAll(e=>e.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,i,r,s){let n;return this._removeFuncs.some(o=>{if(e.startsWith(o[0])){const a=o[1](i,s,r);return typeof a=="number"&&(n=a),!0}return!1}),n}_checkSize(){this._users.forAll(e=>this._checkSizeLimits(e)),this._checkSizeLimits()}_checkSizeLimits(e){const i=e??this;if(i.maxSize<0||i.size<=i.maxSize)return;const r=e==null?void 0:e.id;let s=!0;for(;s;){s=!1;for(const[n,o]of this._db)if(o.lifetime===0&&(!r||n.startsWith(r))){if(this._purgeItem(n,o,e),i.size<=.9*i.maxSize)return;s||(s=this._db.has(n))}}for(const[n,o]of this._db)if((!r||n.startsWith(r))&&(this._purgeItem(n,o,e),i.size<=.9*i.maxSize))return}_purgeItem(e,i,r=this._users.find(s=>e.startsWith(s.id))){if(this._db.delete(e),i.lives<=1){this._size-=i.size,r&&(r.size-=i.size);const s=this._notifyRemove(e,i.entry,i.size,Up.SOME);s!=null&&s>0&&(this._size+=s,r&&(r.size+=s),i.lives=i.lifetime,i.size=s,this._db.set(e,i))}else--i.lives,this._db.set(e,i)}},k2t=0,z2t=class{constructor(e,i,r){this.entry=e,this.size=i,this.lifetime=r,this.lives=r}};function U2t(t){return"usedMemory"in t&&"unloadedMemory"in t&&"ignoresMemoryFactor"in t}function B2t(t){return new pl({view:t})}const wve=.1,hk=1,L9=1,V2t=.75,j2t=.6,xve=1.3;let pl=class extends he{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new Fke,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=750,this._additionalCacheMemory=0,this.addHandles(tg({prepare:()=>this._updateMemory()}))}destroy(){this._cacheStorage.destroy()}get maxMemory(){return this._maxMemory}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(hk),this._maxMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}set additionalCacheMemory(e){e!=null&&(this._additionalCacheMemory=e)}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}get usedCacheMemory(){return this._cacheStorage.size}newCache(e,i,r){return new F2t(e,this._cacheStorage,i,r)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();this._memoryPredicted<j2t&&this._canFastRecover?(this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(hk)):e?(this._memoryPredicted>1.1*L9||this._usedMemory>L9)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>wve&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/xve),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1)):(this._downscaleMemoryUsed=0,this._usedMemory>L9?(this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/xve),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(this._usedMemory<V2t&&this._quality<hk?(this._stableQuality=this._quality,e=this._updateQuality(this._quality+.05)):this._quality<1&&(this._canFastRecover=!0))),this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,wve),hk))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){var a,l,c,h,d;if(!this.view)return;(l=(a=this.view._stage)==null?void 0:a.renderer)==null||l.tick();const e=(h=(c=this.view._stage)==null?void 0:c.renderer)==null?void 0:h.usedMemory;let i=(((d=this.view.basemapTerrain)==null?void 0:d.usedMemory)??0)+(e?e.fbos+e.edges+e.plugins:0),r=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(f=>{if(U2t(f)){const m=f.ignoresMemoryFactor?this._quality:1;i+=f.usedMemory*m,r+=f.unloadedMemory*m}});const s=this._warnMemoryUsage==null||Math.round(10*i)!==Math.round(10*this._warnMemoryUsage),n=1048576*this.maxMemory;if(i>n&&s){this._warnMemoryUsage=i;const f=g=>(g/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",m=Math.round(100*this._quality);J.getLogger(this).warn(`Memory Limit exceeded! Limit: ${f(n)} Current: ${f(i)} Projected: ${f(i+r)} Quality: ${m}%`)}this._usedMemory=i/n,this._memoryPredicted=(i+r)/n;const o=n-i;this._cacheStorage.maxSize=Math.max(0,o+1048576*this.additionalCacheMemory)}get test(){}};u([p({constructOnly:!0})],pl.prototype,"view",void 0),u([p()],pl.prototype,"maxMemory",null),u([p()],pl.prototype,"additionalCacheMemory",null),u([p({readOnly:!0})],pl.prototype,"memoryFactor",null),u([p({readOnly:!0})],pl.prototype,"updating",null),u([p({readOnly:!0})],pl.prototype,"usedMemory",null),u([p({readOnly:!0})],pl.prototype,"usedCacheMemory",null),u([p()],pl.prototype,"_quality",void 0),u([p()],pl.prototype,"_usedMemory",void 0),u([p()],pl.prototype,"_updating",void 0),u([p()],pl.prototype,"_stableQuality",void 0),u([p()],pl.prototype,"_maxMemory",void 0),u([p()],pl.prototype,"_additionalCacheMemory",void 0),pl=u([A("esri.views.3d.support.MemoryController")],pl);let G2t=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},H2t=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new q2t}},q2t=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},W2t=class{constructor(e,i,r,s){this._workerFunc=e,this._callbackFunc=i,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=s.map(n=>new H2t(n))}destroy(){this._clients.length=0}hasQuota(e){const i=this._clients[e];return!!i&&(this._totalNumWorkers<this._maxTotalNumWorkers||i.numWorkers+i.tasks.length<i.typeWorkerQuota)}push(e){const i=this._clients[e.client];i&&(this._totalNumWorkers<this._maxTotalNumWorkers?(i.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(r,s)=>this._taskCallback(r,s))):i.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const i=this._clients[e.client];this._totalNumWorkers--,i&&(i.numWorkers--,i.statistics.requests++,i.statistics.size+=e.size||0,i.statistics.duration+=e.duration||0,i.statistics.speed=i.statistics.duration>0?i.statistics.size/i.statistics.duration:0,Zt(i.numWorkers>=0)),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(i,r)=>this._taskCallback(i,r)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,i){e._cancelled||(this._callbackFunc(e,i),this._taskFinished(e))}getStatsForType(e){const i=this._clients[e];return i?{quota:i.typeWorkerQuota,workers:i.numWorkers,queueSize:i.tasks.length,requestStats:i.statistics}:null}get test(){}},Z2t=class{constructor(e,i){this.element=e,this.type="image+type",this.isOpaque=i==="image/jpeg"}};function p2(t){return t!=null&&"type"in t&&t.type==="vector-tile"}function kke(t){return t!=null&&"type"in t&&t.type==="raster-tile"}function zke(t){return t!=null&&"type"in t&&t.type==="tile-texture"}function G6(t){return t!=null&&"type"in t&&t.type==="image+type"}let Q5=class extends he{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,i,r){this._loadQueue=new W2t((s,n)=>this._startLoading(s,n),(s,n)=>this._doneLoadingCB(s,n),e,i),r&&(this._frameTask=r.registerTask(lt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=Ji(this._frameTask),this._tasks.forEach(e=>fc(e.abortController)),this._loadQueue=$e(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,i,r,s={}){const n=ta();n.__signal=s!=null?s.signal:null;const o=this._createOrUpdateTask(e,i,r,s,n);return Qo(s,()=>this._cancelRequest(o,n)),n.promise}_createTask(e,i,r,s,n,o){const a=new X2t(e,i,r,s,n);return this._updateTask(a,o),this._tasks.set(n,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,i){var r;r3(e.resolvers,i),i.reject(bi()),e.resolvers.length===0&&(e.status===Gh.DOWNLOADING&&(e.status=Gh.CANCELLED,this._loadQueue.cancel(e),(r=e.abortController)==null||r.abort(),e.request=null,e.abortController=null),e.status=Gh.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,i){e.resolvers.push(i)}_createOrUpdateTask(e,i,r,s,n){const o=K2t((s==null?void 0:s.uid)||e,i,r),a=this._tasks.get(o);return a?(this._updateTask(a,n),a):this._createTask(e,s,i,r,o,n)}_doneLoadingCB(e,i){this._loadQueue&&(Zt(e.status===Gh.DOWNLOADING),e.status=Gh.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:i}):this._doneLoading(e,i))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const i=this._onLoadQueue.shift();gt(i.task.abortController),i.task.abortController=null,i.callback(i.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const i=this._doneQueue.shift();i.task.status!==Gh.DOWNLOADED&&(i.err=i.err||bi()),this._doneLoading(i.task,i.err),e.madeProgress()}}_doneLoading(e,i){if(i&&!es(i)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let r=G6(e.result)||e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const s of e.resolvers)if(i)es(i)?s.reject(i):s.reject(new U("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${i}`,{url:e.url,error:i}));else{--r;const n=r>0?q(e.result):e.result;s.resolve(n)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,i){if(e.status===Gh.CANCELLED)return!1;let r,s;switch(e.startTime=performance.now(),e.status=Gh.DOWNLOADING,e.docType){case"binary":s="array-buffer",r=0;break;case"image":s="image";break;case"image+type":s="array-buffer";break;default:s="json"}e.abortController=new AbortController;const n=e.abortController.signal;e.request=Ri(e.url,{...e.options,responseType:s,timeout:r,signal:n});const o=l=>{e.duration=performance.now()-e.startTime,e.size=l instanceof ArrayBuffer?l.byteLength:e.size||0,e.result=l,this._frameTask?this._onLoadQueue.push({callback:i,task:e}):(e.abortController=null,i(e))},a=l=>{e.status===Gh.DOWNLOADING&&i(e,l)};return e.docType!=="image+type"?(e.request.then(l=>o(l.data),a),!0):(e.request.then(l=>{const c=l.data,h=J2t(c);if(s="image",e.size=c.byteLength,h==="unknown")return e.request=Ri(e.url,{responseType:s,timeout:r,signal:n}),void e.request.then(m=>o(m.data),a);const d=new Blob([c],{type:h}),f=window.URL.createObjectURL(d);e.request=Ri(f,{responseType:s,timeout:r,signal:n}),e.request.then(m=>o(new Z2t(m.data,h)),a).finally(()=>window.URL.revokeObjectURL(f))},a),!0)}get test(){}};u([p({readOnly:!0})],Q5.prototype,"updating",void 0),Q5=u([A("esri.views.3d.support.StreamDataLoader")],Q5);const Y2t={numRetries:0};function J2t(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let X2t=class extends G2t{constructor(e,i,r,s,n){super(s),this.url=e,this.options=i,this.docType=r,this.key=n,this.result=null,this.status=Gh.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=Y2t.numRetries}};function K2t(t,e,i){return`${t}:${e}:${i}`}var Gh;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(Gh||(Gh={}));let ez=class extends he{constructor(){super(...arguments),this.updating=!1}};function Q2t(t){return new lm({view:t})}u([p({readOnly:!0})],ez.prototype,"updating",void 0),ez=u([A("esri.views.3d.support.ResourceController.ResourceControllerMain")],ez);let lm=class extends ez{constructor(){super(...arguments),this._immediateTask=nA,this._normalTask=nA,this._updatingObjects=Ta([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=uOe(),this._memoryController=B2t(this.view),this._streamDataLoader=new Q5,this._streamDataLoader.setup(N2t,L2t,this._scheduler),this.addHandles([H(()=>{var e;return(e=this.view.state)==null?void 0:e.mode},e=>{e!=null&&(this._scheduler.state=e)},Yt),H(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=tg({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(lt.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(lt.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=Ji(this._frameTask),this._streamDataLoader=$e(this._streamDataLoader),this._memoryController=$e(this._memoryController),this._scheduler=$e(this._scheduler),this.view=null}get updating(){var e,i,r,s;return!!((e=this._memoryController)!=null&&e.updating||(i=this._streamDataLoader)!=null&&i.updating||(r=this._immediateTask)!=null&&r.updating)||((s=this._updatingObjects)==null?void 0:s.value.some(n=>n.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const i=this._streamDataLoader;return{request:(r,s,n)=>i.request(r,s,e,n),get busy(){return!i.hasDownloadSlots(e)}}}addUpdatingObject(e){const i=this._updatingObjects;return i.value=[...i.value,e],Pi(()=>{i.value=i.value.filter(r=>r!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(HSe(e.deltaTime)),!this._scheduler)||(this._memoryController.update(),this._scheduler.frame(e))}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){}};u([p()],lm.prototype,"view",void 0),u([p()],lm.prototype,"_scheduler",void 0),u([p()],lm.prototype,"_memoryController",void 0),u([p()],lm.prototype,"_streamDataLoader",void 0),u([p()],lm.prototype,"_immediateTask",void 0),u([p()],lm.prototype,"_normalTask",void 0),u([p({readOnly:!0})],lm.prototype,"updating",null),lm=u([A("esri.views.3d.support.ResourceController")],lm);let dai=class{constructor(e,i=0,r=0,s=0,n=0,o=null){this.usedMemory=e,this.displayedFeatures=i,this.totalFeatures=r,this.maximumFeatures=s,this.nodes=n,this.core=o}};function eCt(t){return"performanceInfo"in t}let tCt=class{constructor(e){this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer;const i=e.performanceInfo;this.memory=i.usedMemory,this.displayedNumberOfFeatures=i.displayedFeatures,this.maximumNumberOfFeatures=i.maximumFeatures,this.totalNumberOfFeatures=i.totalFeatures}},iCt=class{constructor(e){var i,r,s,n;if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,this.cachedMemory=0,this.fboMemory=0,e.resourceController!=null){const o=e.resourceController.memoryController;this.totalMemory=(o.maxMemory??0)*tD.MEGABYTES,this.usedMemory=Math.round(o.usedMemory*this.totalMemory),this.quality=e.quality,this.load=e.resourceController.scheduler.load,this.cachedMemory=o.usedCacheMemory}this.terrainMemory=((i=e.basemapTerrain)==null?void 0:i.usedMemory)??0,this.edgesMemory=((r=e._stage)==null?void 0:r.renderer.usedMemory.edges)??0,this.fboMemory=((s=e._stage)==null?void 0:s.renderer.usedMemory.fbos)??0,(n=e.allLayerViews)==null||n.items.forEach(o=>{eCt(o)&&this.layerPerformanceInfos.push(new tCt(o))}),this.layerPerformanceInfos.sort((o,a)=>a.memory-o.memory)}},rCt=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,i){return this._load("json",e,i)}async loadBinary(e,i){return $f(e)?(gt(i),TTe(e)):this._load("binary",e,i)}async loadImage(e,i){return this._load("image",e,i)}async _load(e,i,r){if(this._streamDataRequester==null)return(await Ri(i,{responseType:sCt[e]})).data;const s=await ff(this._streamDataRequester.request(i,e,r));if(s.ok===!0)return s.value;throw Wc(s.error),new U("glt-loader-request-error",`Request for resource failed: ${s.error}`)}};const sCt={image:"image",binary:"array-buffer",json:"json","image+type":void 0},py=()=>J.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");let nCt=class{constructor(e,i,r){this.resource=e,this.textures=i,this.cachedMemory=r}};async function oCt(t,e){const i=await aCt(t,e),r=await hCt(i.textureDefinitions??{},e);let s=0;for(const n in r)if(r.hasOwnProperty(n)){const o=r[n];s+=o!=null&&o.image?o.image.width*o.image.height*4:0}return new nCt(i,r,s+TB(i))}async function aCt(t,e){const i=e==null?void 0:e.streamDataRequester;if(i)return lCt(t,i,e);const r=await ff(Ri(t,e));if(r.ok===!0)return r.value.data;Wc(r.error),Uke(r.error)}async function lCt(t,e,i){const r=await ff(e.request(t,"json",i));if(r.ok===!0)return r.value;Wc(r.error),Uke(r.error.details.url)}function Uke(t){throw new U("",`Request for object resource failed: ${t}`)}function cCt(t){const e=t.params,i=e.topology;let r=!0;switch(e.vertexAttributes||(py().warn("Geometry must specify vertex attributes"),r=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=e.faces;if(n){if(e.vertexAttributes)for(const o in e.vertexAttributes){const a=n[o];a!=null&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(py().warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),r=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(py().warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),r=!1)):(py().warn(`Indexed geometry does not specify face indices for '${o}' attribute`),r=!1)}}else py().warn("Indexed geometries must specify faces"),r=!1;break}default:py().warn(`Unsupported topology '${i}'`),r=!1}t.params.material||(py().warn("Geometry requires material"),r=!1);const s=t.params.vertexAttributes;for(const n in s)s[n].values||(py().warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function vai(t,e){var g,v;const i=new Array,r=new Array,s=new Array,n=new Ov,o=t.resource,a=gL.parse(o.version||"1.0","wosr");pCt.validate(a);const l=o.model.name,c=o.model.geometries,h=o.materialDefinitions??{},d=t.textures;let f=0;const m=new Map;for(let _=0;_<c.length;_++){const b=c[_];if(!cCt(b))continue;const w=dCt(b),x=b.params.vertexAttributes,S=[],C=k=>{if(b.params.topology==="PerAttributeArray")return null;const W=b.params.faces;for(const j in W)if(j===k)return W[j].values;return null},T=x[z.POSITION],M=T.values.length/T.valuesPerElement;for(const k in x){const W=x[k],j=W.values,B=C(k)??vL(M);S.push([k,new Qt(j,B,W.valuesPerElement,!0)])}const I=w.texture,D=d&&d[I];if(D&&!m.has(I)){const{image:k,parameters:W}=D,j=new voe(k,W);r.push(j),m.set(I,j)}const P=m.get(I),F=P?P.id:void 0,L=w.material;let N=n.get(L,I);if(N==null){const k=h[L.slice(L.lastIndexOf("/")+1)].params;k.transparency===1&&(k.transparency=0);const W=D&&D.alphaChannelUsage,j=k.transparency>0||W==="transparency"||W==="maskAndTransparency",B=D?Bke(D.alphaChannelUsage):void 0,te={ambient:H$(k.diffuse),diffuse:H$(k.diffuse),opacity:1-(k.transparency||0),transparent:j,textureAlphaMode:B,textureAlphaCutoff:.33,textureId:F,doubleSided:!0,cullFace:Al.None,colorMixMode:k.externalColorMixMode||"tint",textureAlphaPremultiplied:(D==null?void 0:D.parameters.preMultiplyAlpha)??!1};e!=null&&e.materialParameters&&Object.assign(te,e.materialParameters),N=new NB(te,e),n.set(L,I,N)}s.push(N);const R=new $a(N,S);f+=((v=(g=S.find(k=>k[0]===z.POSITION))==null?void 0:g[1])==null?void 0:v.indices.length)??0,i.push(R)}return{engineResources:[{name:l,stageResources:{textures:r,materials:s,geometries:i},pivotOffset:o.model.pivotOffset,numberOfVertices:f,lodThreshold:null}],referenceBoundingBox:uCt(i)}}function uCt(t){const e=bf();return t.forEach(i=>{const r=i.boundingInfo;r!=null&&(C3(e,r.bbMin),C3(e,r.bbMax))}),e}async function hCt(t,e){const i=new Array;for(const n in t){const o=t[n],a=o.images[0].data;if(!a){py().warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,h=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",d={noUnpackFlip:!0,wrap:{s:ar.REPEAT,t:ar.REPEAT},preMultiplyAlpha:Bke(h)!==Fn.Opaque},f=e!=null&&e.disableTextures?Promise.resolve(null):Iv(l,e);i.push(f.then(m=>({refId:c,image:m,parameters:d,alphaChannelUsage:h})))}const r=await Promise.all(i),s={};for(const n of r)s[n.refId]=n;return s}function Bke(t){switch(t){case"mask":return Fn.Mask;case"maskAndTransparency":return Fn.MaskBlend;case"none":return Fn.Opaque;default:return Fn.Blend}}function dCt(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const pCt=new gL(1,2,"wosr");let fCt=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,i,r){const s=r?`gltfPBR:${e}`:`gltf:${e}`,n=this._gltfMemCache.get(s);return n!=null?Promise.resolve(n):Sve(this._gltfLoading,this._gltfMemCache,s,async o=>{const{loadGLTF:a}=await G(()=>import("./loader-BRah9kOb.js"),__vite__mapDeps([361,253]));return a(new rCt(o.streamDataRequester),e,o,r)},i)}loadWOSR(e,i){const r=`wosr:${e}:${i.disableTextures}`,s=this._wosrMemCache.get(r);return s!=null?Promise.resolve(s):Sve(this._wosrLoading,this._wosrMemCache,r,n=>oCt(e,n),i)}};async function Sve(t,e,i,r,s){gt(s);const n=Qo(s,()=>mCt(t,i));let o=t.get(i);if(o)o.refCount++;else{const a=new AbortController;o={refCount:1,abortController:a,promise:r({...s,signal:a.signal})},t.set(i,o)}try{const a=await o.promise;return e.put(i,a),t.delete(i),gt(s),a}finally{Ji(n)}}function mCt(t,e){const i=t.get(e);i!=null&&--i.refCount>0||(t.delete(e),i!=null&&i.abortController.abort())}let EC=class extends he{constructor(e,i){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(i==null?void 0:i.registerTask(lt.TEXTURE_UNLOAD))??nA}normalizeCtorArgs(){return{}}destroy(){var e,i,r;super.destroy(),(e=this._frameTask)==null||e.remove(),(i=this._textureRequests)==null||i.forEach(s=>this._releaseTextureRequest(s)),(r=this._textureRequests)==null||r.clear()}get updating(){return this._frameTask.updating}fromData(e,i){const r=this.makeUid(e);let s=this._textureRequests.get(r);if(!s){const n=new jke;n.texture=i(),this._stage&&(n.texture.load(this._stage.renderView.renderingContext),this._stage.add(n.texture)),this._textureRequests.set(r,n),s=n}return s.referenceCount++,new Vke(r,s.texture,()=>this._release(r))}_release(e){const i=this._textureRequests.get(e);i?(i.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),i.referenceCount--,i.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){}_releaseNow(e){var r;if(!this._textureRequests)return;const i=this._textureRequests.get(e);!i||i.referenceCount>0||((r=i.texture)==null||r.unload(),this._releaseTextureRequest(i),this._textureRequests.delete(e))}_releaseTextureRequest(e){var i;e.texture?(i=this._stage)==null||i.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,i=null){return i!=null?`${e}.${i}px`:e}};u([p()],EC.prototype,"_frameTask",void 0),u([p()],EC.prototype,"updating",null),EC=u([A("esri.views.3d.support.TextureCollection")],EC);let Vke=class{constructor(e,i,r){this.uid=e,this.texture=i,this.release=r}},jke=class{constructor(){this.referenceCount=0}},gCt=class extends EC{constructor(e,i,r){super(i,r),this._streamDataRequester=e}async fromUrl(e,i,r){gt(r);const s=r==null?void 0:r.signal,n=this.makeUid(e,i);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:n,signal:a.signal});o=new jke,o.abortController=a;const c=o;this._textureRequests.set(n,o),o.textureAsync=l.then(async h=>{const d=this._createTexture(e,h,i);return c.texture=d,c.abortController=null,await d.load(this._stage.renderView.renderingContext),this._stage.add(d),new Vke(n,d,()=>this._release(n))},h=>{throw c.abortController=null,h})}o.referenceCount++;try{return await oie(o.textureAsync,s)}catch(a){throw this._release(n),a}}_createTexture(e,i,r){var n;const s={width:i.width,height:i.height,wrap:{s:ar.CLAMP_TO_EDGE,t:ar.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if(ATe(e)){if(r||i.width===0&&i.height===0){const o=i.width?i.height/i.width:1;r=r||64,o>1?(i.width=Math.round(r/o),i.height=r):(i.width=r,i.height=Math.round(r*o))}(n=this._stage.renderView)!=null&&n.renderingContext.driverTest.svgPremultipliesAlpha.result&&(s.preMultiplyAlpha=!1)}return new voe(i,s)}},yCt=class{constructor(e){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(Im.SYMBOLOGY),this.objectResourceCache=new fCt((r,s)=>e.resourceController.memoryController.newCache(r,s)),this.textures=new gCt(this.streamDataRequester,e.view._stage,e.resourceController.scheduler);const i=yr(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=O3e(e.viewingMode,i),this.screenSizePerspectiveSettingsLabels=Apt(e.viewingMode,i)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return Pi();this._graphicsOwners.push(e);const i=H(()=>{var r;return(r=e.layer)==null?void 0:r.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),Pi(()=>{i.remove(),r3(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(i=>{var r;return((r=i.layer)==null?void 0:r.screenSizePerspectiveEnabled)===!0});if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new fg;const i=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([H(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,i,Yt),this._viewState.events.on("camera-projection-changed",i)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=$e(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;dk.distance=e.centerOnSurfaceInfrequent.distance,dk.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(dk),this.screenSizePerspectiveSettingsLabels.update(dk),this._view._stage.renderView.requestRender()}get test(){}};const dk={distance:0,fovY:0};let vCt=class{constructor(e){this.destination=e}hide(){this.graphic!=null&&(this.destination.remove(this.graphic),this.graphic=null)}},f2=class extends vCt{constructor(e,i,r=""){super(e),this._symbol=new Rm({symbolLayers:new Ce([new sb({material:{color:i},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new tT({text:r,halo:{color:"white",size:1/.75},material:{color:i},size:12})])})}show(e,i){if(!i)return;this.hide();const r=new Fe({x:e[0],y:e[1],z:e[2],spatialReference:i});this.graphic=new Pl({geometry:r,symbol:this._symbol}),this.destination.add(this.graphic)}},H_=class extends he{constructor(e){super(e)}};u([p({constructOnly:!0})],H_.prototype,"renderCoordsHelper",void 0),u([p({constructOnly:!0})],H_.prototype,"surface",void 0),u([p({constructOnly:!0})],H_.prototype,"state",void 0),H_=u([A("esri.views.3d.support.pointsOfInterest.PointOfInterest")],H_);const _Ct=Array;let bp=class extends H_{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new _v({location:Fe,renderLocation:_Ct},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=$(),this._tmpPoint=new Fe}initialize(){if(this.scheduler&&this.addHandles(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.addHandles(so(()=>{var i,r;return(r=(i=this.map)==null?void 0:i.ground)==null?void 0:r.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=$e(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get scale(){const e=this._camera,i=Sr(e.eye,this.renderLocation),r={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return LS(r,i)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){var s;if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!((s=this.map)!=null&&s.ground))return this._updateSurfaceAltitude(0),ea;const e=this.state.spatialReference;this._tmpPoint.spatialReference=e,this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint);const i=(this._tmpPoint.z??0)>bCt&&this.renderCoordsHelper.viewingMode===je.Global&&(e.isWGS84||e.isWebMercator);let r=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:r.signal,cache:this.cache,minDemResolution:i?wCt:0}).then(n=>this._updateSurfaceAltitude(n.geometry.z??0)).catch(n=>{es(n)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===r&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),r=null}),this._pendingElevationQueryController=r,ea}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(N9,this._estimatedSurfaceAltitude,this._camera.eye),to(this._get("renderLocation"),N9)||(this._set("renderLocation",ne(this._propertiesPool.get("renderLocation"),N9)),this.notifyChange("renderLocation"))}};u([p({constructOnly:!0})],bp.prototype,"scheduler",void 0),u([p({constructOnly:!0})],bp.prototype,"cache",void 0),u([p({constructOnly:!0})],bp.prototype,"task",void 0),u([p()],bp.prototype,"location",null),u([p({constructOnly:!0})],bp.prototype,"map",void 0),u([p()],bp.prototype,"renderLocation",void 0),u([p()],bp.prototype,"scale",null),u([p()],bp.prototype,"updating",null),bp=u([A("esri.views.3d.support.pointsOfInterest.CameraOnSurface")],bp);const N9=$(),bCt=1e5,wCt=1e6,xCt=Array;let Hh=class extends H_{constructor(e){super(e),this._propertiesPool=new _v({location:Fe,renderLocation:xCt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=$(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=Ji(this._frameWorker),this._propertiesPool=$e(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,ea}_updateRenderLocation(){const e=TCt;let i=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const r=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!i&&r&&(i=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),i&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const s=ECt;i&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,s)&&(ne(e,s),this._currentSurfaceAltitude=this._latestSurfaceAltitude),i?this.distance=Sr(this._camera.eye,e):(re(e,this._camera.viewForward,this._get("distance")),oe(e,e,this._camera.eye)),to(this._get("renderLocation"),e)||this._set("renderLocation",ne(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,i){var s,n;const r=this._camera;if(!this.renderCoordsHelper.intersectInfiniteManifold(r.ray,e,i))return!1;if(this.state.isGlobal){const o=yr(this.renderCoordsHelper.spatialReference).radius,a=o+e,l=Xo(r.eye),c=l<a*a,h=Sr(r.eye,i);if(c&&h>o/4){const d=a-Math.sqrt(l);return re(i,r.viewForward,d),oe(i,i,r.eye),!0}}else{const o=(s=this.surface)!=null&&s.ready?this.surface.extent:null;o!=null&&Ese(o,(n=this.surface)==null?void 0:n.spatialReference,MO,this.renderCoordsHelper.spatialReference)&&(i[0]=ue(i[0],MO[0],MO[2]),i[1]=ue(i[1],MO[1],MO[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,i){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,i)){if(xs.TESTS_DISABLE_OPTIMIZATIONS)return!0;const r=this._camera.eye,s=Sr(r,e),n=Sr(r,i);if(Math.abs(n-s)/s>SCt)return!0}return!1}};u([p({constructOnly:!0})],Hh.prototype,"scheduler",void 0),u([p({constructOnly:!0})],Hh.prototype,"task",void 0),u([p()],Hh.prototype,"distance",void 0),u([p({constructOnly:!0})],Hh.prototype,"estimateSurfaceAltitudeAtCenter",void 0),u([p({readOnly:!0})],Hh.prototype,"location",null),u([p({readOnly:!0})],Hh.prototype,"renderLocation",void 0),u([p()],Hh.prototype,"updating",void 0),Hh=u([A("esri.views.3d.support.pointsOfInterest.CenterOnSurface")],Hh);const SCt=.05,TCt=$(),ECt=$(),MO=si();let CCt=class{constructor(e){this._handles=new fg,this.events=new Ss,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",i=>this._layerViewsChanged(i))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=$e(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(e){e.added.forEach(i=>{i.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(i.on("visible-geometry-changed",()=>this._contentChanged()),i.uid)}),e.removed.forEach(i=>this._handles.remove(i.uid))}_contentChanged(){this.events.emit("request-update",$Ct)}};const $Ct={},ACt=Array;let wp=class extends H_{constructor(e){super(e),this._propertiesPool=new _v({location:Fe,renderLocation:ACt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([H(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),H(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.addHandles(this.scheduler.registerTask(lt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=$e(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get worldUnitsPerContentPixel(){const{camera:e,contentPixelRatio:i}=this.state;return e.computeRenderPixelSizeAt(this.renderLocation)*(e.pixelRatio/i)}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),i=this.centerOnSurface.renderLocation,r=this.renderCoordsHelper,s=this.state.contentCamera;this._dirty=!1,r.worldUpAtPosition(i,Tve);const n=Math.max(0,(Math.acos(fe(Tve,s.viewForward))-.5*Math.PI)*(s.aboveGround?1:-1));if(Number.isNaN(n)){if(!e||!aA(e,i)){const c=this._propertiesPool.get("renderLocation");ne(c,i),this._set("renderLocation",c)}return ea}const o=1-ue(n/(.5*Math.PI),0,1),a=o*o*o;this._calculateScreenHorizontalEdgeOnSurface(Eve);const l=this._propertiesPool.get("renderLocation");return fr(l,i,Eve,a),e&&aA(e,l)||this._set("renderLocation",l),ea}_calculateScreenHorizontalEdgeOnSurface(e){const i=this.state.contentCamera,r=i.getRenderCenter(Qp());if(r[1]=i.aboveGround?i.padding[ai.BOTTOM]:i.fullHeight-i.padding[ai.TOP],this.estimateSurfaceIntersectionAtRenderPoint(r,e))return e;const s=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(i.unprojectFromRenderScreen(r,OO)){be(OO,OO,i.eye);const n=ae(OO,OO);if(this.renderCoordsHelper.intersectInfiniteManifold(wf(i.eye,n),s,e))return e}return this.renderCoordsHelper.setAltitude(e,s,i.eye)}updateRenderLocation(){this._dirty=!0}};u([p()],wp.prototype,"_dirty",void 0),u([p({constructOnly:!0})],wp.prototype,"scheduler",void 0),u([p({constructOnly:!0})],wp.prototype,"centerOnSurface",void 0),u([p({constructOnly:!0})],wp.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),u([p()],wp.prototype,"updating",null),u([p()],wp.prototype,"location",null),u([p()],wp.prototype,"renderLocation",void 0),u([p()],wp.prototype,"worldUnitsPerContentPixel",null),wp=u([A("esri.views.3d.support.pointsOfInterest.Focus")],wp);const Tve=$(),OO=$(),Eve=$();let fy=class extends he{get surface(){var e;return(e=this.view.map)==null?void 0:e.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=$();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null}initialize(){this.view.state.isLocal&&(this.addHandles([H(()=>{var e,i;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(i=this.surfaceView)==null?void 0:i.extent]},()=>this._update()),so(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}_update(){var r;if(this._updateController&&(this._updateController.abort(),this._updateController=null),((r=this.surfaceView)==null?void 0:r.extent)==null||this.surfaceView.spatialReference==null)return void this._set("location",null);const e=xEe(this.surfaceView.extent),i=new Fe({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(i,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(s=>{this._updateController=null,this._set("location",s.geometry)}).catch(s=>{})):this._set("location",i)}};u([p({constructOnly:!0})],fy.prototype,"view",void 0),u([p({constructOnly:!0})],fy.prototype,"cache",void 0),u([p()],fy.prototype,"surface",null),u([p()],fy.prototype,"surfaceView",null),u([p({readOnly:!0})],fy.prototype,"location",void 0),u([p({readOnly:!0})],fy.prototype,"renderLocation",null),fy=u([A("esri.views.3d.support.pointsOfInterest.StableSurfaceCenter")],fy);let my=class extends he{constructor(e){super(e),this._tileGeometryUpdateExtent=yv(),this._tileGeometryUpdateSpatialReference=null,this.events=new Ss,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(lt.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",MCt),yv(this._tileGeometryUpdateExtent),this._set("updating",!1)),ea}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,kC(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let i=1;i<this.centerOnSurfaces.length;i++){const r=this.centerOnSurfaces[i];r.distance>e.distance&&(e=r)}return e}_centerIntersectsExtent(e,i){const r=this.state.contentCamera.eye,s=OCt,n=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,Jw,i),this.renderCoordsHelper.fromRenderCoords(n.renderLocation,Xw,i),Jw[0]<Xw[0]?(s[0]=Jw[0],s[2]=Xw[0]):(s[0]=Xw[0],s[2]=Jw[0]),Jw[1]<Xw[1]?(s[1]=Jw[1],s[3]=Xw[1]):(s[1]=Xw[1],s[3]=Jw[1]),y3(s,e)}};u([p({constructOnly:!0})],my.prototype,"state",void 0),u([p({constructOnly:!0})],my.prototype,"centerOnSurfaces",void 0),u([p({constructOnly:!0})],my.prototype,"renderCoordsHelper",void 0),u([p({constructOnly:!0})],my.prototype,"scheduler",void 0),u([p({constructOnly:!0})],my.prototype,"surface",void 0),u([p({readOnly:!0})],my.prototype,"updating",void 0),my=u([A("esri.views.3d.support.pointsOfInterest.SurfaceGeometryUpdates")],my);const MCt={},Jw=$(),Xw=$(),OCt=yv();let Yl=class extends he{constructor(e){super(e),this.renderPointOfView=$(),this._pois=new Array,this._debugCenters=null,this._tmpRay=Nn(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new _v({renderPointOfView:ICt},this)}initialize(){var c;const{state:e,basemapTerrain:i,renderCoordsHelper:r,map:s}=this.view;this._surfaceIntersector=ph(e.viewingMode),this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=Co.MIN,this._contentIntersector=ph(e.viewingMode);const n=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=(c=this.view.basemapTerrain)==null?void 0:c.elevationQueryCache,l={state:e,scheduler:o,surface:i,renderCoordsHelper:r};this._set("centerOnSurfaceInfrequent",new Hh({...l,task:lt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnSurfaceFrequent",new Hh({...l,task:lt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnContent",new Hh({...l,task:lt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new bp({...l,cache:a,task:lt.POINT_OF_INTEREST_INFREQUENT,map:s})),this._set("surfaceGeometryUpdates",new my({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new CCt({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:r})),this._set("surfaceOrigin",new fy({cache:a,view:this.view})),this._set("focus",new wp({state:e,scheduler:o,surface:i,renderCoordsHelper:r,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(h,d)=>this._estimateSurfaceIntersectionAtRenderPoint(h,this.view.state.contentCamera,d)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus),this.addHandles([H(()=>e.contentCamera,h=>this._cameraChanged(h),Yt),H(()=>i.extent,()=>this._updateCenterPointsOfInterest()),H(()=>{var h,d,f;return(f=(d=(h=this.view.map)==null?void 0:h.ground)==null?void 0:d.navigationConstraint)==null?void 0:f.type},h=>{this._surfaceIntersector.options.backfacesTerrain=h==="none"},Ut),bn(()=>!i.updating,()=>this._updateCenterPointsOfInterest(),Yt),so(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),so(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),H(()=>xs.SHOW_POI,h=>this._setDebug(h),Ut)]),this._cameraChanged(this.view.state.contentCamera);for(const h of this._pois)h.runTask()}destroy(){this._setDebug(!1),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(i=>i.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,uE,PCt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(uE):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(e==null)return this._surfaceAltitudeAtCenter;const i=e.origin,r=oe(uE,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,i,r),this._surfaceIntersector.results.min.getIntersectionPoint(uE)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(uE)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,i,r){const s=Goe(i,e,RCt);if(s==null)return null;const n=s.origin,o=oe(uE,s.origin,s.direction);return this._surfaceIntersector.resetWithRay(s,i),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,n,o),this._surfaceIntersector.results.min.getIntersectionPoint(r)?r:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const i=e.eye;to(this.renderPointOfView,i)||this._set("renderPointOfView",ne(this._propertiesPool.get("renderPointOfView"),i))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){var i;if(!e)return(i=this._debugCenters)==null||i.forEach(r=>r.hide()),void this.removeHandles("debug");if(!this._debugCenters){this._debugCenters=new Map;const r=this.view.graphics;this._debugCenters.set(this.centerOnContent,new f2(r,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new f2(r,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new f2(r,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new f2(r,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new f2(r,"green","Focus"))}for(const r of this._pois)this.addHandles(H(()=>r.renderLocation,s=>{var n,o;return(o=(n=this._debugCenters)==null?void 0:n.get(r))==null?void 0:o.show(s,r.renderCoordsHelper.spatialReference)},Ut),"debug")}get test(){}};u([p()],Yl.prototype,"centerOnContent",void 0),u([p()],Yl.prototype,"centerOnSurfaceFrequent",void 0),u([p()],Yl.prototype,"centerOnSurfaceInfrequent",void 0),u([p()],Yl.prototype,"cameraOnSurface",void 0),u([p()],Yl.prototype,"focus",void 0),u([p()],Yl.prototype,"renderPointOfView",void 0),u([p()],Yl.prototype,"surfaceOrigin",void 0),u([p()],Yl.prototype,"contentGeometryUpdates",void 0),u([p()],Yl.prototype,"surfaceGeometryUpdates",void 0),u([p({constructOnly:!0})],Yl.prototype,"view",void 0),u([p()],Yl.prototype,"updating",null),Yl=u([A("esri.views.3d.support.pointsOfInterest.PointsOfInterest")],Yl);const ICt=Array,uE=$(),RCt=Nn(),PCt={exclude:new Set([qb])},DCt=()=>J.getLogger("esri/core/MemCachePool");let UL=class{constructor(e,i){this._cache=e(i,(r,s,n)=>{switch(s){case Up.ALL:return r.forEach(o=>o.dispose()),0;case Up.SOME:{const o=r.shift();return o?(n-=Math.round(o.cachedMemory),o.dispose()):n>0&&(DCt().warn("Encountered empty MemCachePool with non-zero memory."),n=0),n}}})}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}getSize(e){return this._cache.getSize(e)}pop(e){const i=this._cache.peek(e);if(!i)return;const r=i.pop();return i.length>0?r&&(i.cachedMemory=this._cache.getSize(e)-Math.round(r.cachedMemory),this._cache.updateSize(e,i)):this._cache.pop(e),r}put(e,i,r=Nke){const s=this._cache.peek(e);if(s)s.push(i),s.cachedMemory=this._cache.getSize(e)+Math.round(i.cachedMemory),this._cache.updateSize(e,s);else{const n=new LCt(i);this._cache.put(e,n,r)}}},LCt=class extends Array{constructor(e){super(),this.item=e,this.cachedMemory=e.cachedMemory,this.push(e)}},NCt=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,i){this._store.put(e,i)}},FCt=class{constructor(e="scene"){this.context=e,this.extent=yv()}};const zai={value:.5,readOnly:!0},kCt={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let CC=class{constructor(e=0,i=0){this.min=e,this.max=i,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},zCt=class{constructor(e,i){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(i[2]-i[0]),this.dy=(e.width-1)/(i[3]-i[1]),this.x0=i[0],this.y1=i[3]}},UCt=class{constructor(e,i,r){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=i,this.samplerData=new zCt(r,i)}computeMinMaxValue(e,i,r,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=e-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(i/o)===this.i&&Math.floor(r/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.data.width,h=this.samplerData.data.values,d=.5*Roe;let f=(c-1)/o,m=(r-this.j*o)*f,g=(i-this.i*o)*f;if(f<1){const v=Math.floor(m),_=Math.floor(g),b=v+_*c,w=h[b],x=h[b+1],S=h[b+c],C=h[b+c+1];if(w+x+S+C<d){const T=m-v,M=g-_,I=qN(w,x,S,C,T,M),D=qN(w,x,S,C,T+f,M),P=qN(w,x,S,C,T,M+f),F=qN(w,x,S,C,T+f,M+f);return s.min=Math.min(I,D,P,F),s.max=Math.max(I,D,P,F),s}m=v,g=_,f=1}else m=Math.floor(m),g=Math.floor(g),f=Math.ceil(f);for(let v=m;v<=m+f;v++)for(let _=g;_<=g+f;_++){const b=h[v+_*c];b<d?(a=Math.min(a,b),l=Math.max(l,b)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}};const BCt=.5*Roe;function ds(t,e,i){if(i==null)return null;for(const r of i){if(!r)continue;const s=r.safeWidth;let n=ue(r.dy*(r.y1-e),0,s),o=ue(r.dx*(t-r.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=r.data.width,h=a*c+l,d=r.data.values,f=d[h],m=d[h+1],g=h+c,v=d[g],_=d[g+1];if(f+v+m+_<BCt){n-=a,o-=l;const b=f+(m-f)*o;return b+(v+(_-v)*o-b)*n}}return null}var nt;(function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"})(nt||(nt={}));function Gke(t){return mae(t)||KA(t)||QA(t)}function mae(t){return Pb(t)||OU(t)}function VCt(t,e,i,r){if(t==null)return Ioe();const s=t.spatialReference;if(s.isGeographic&&!mae(s))return new U("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const n=oc.checkUnsupported(t);return n??(i==null?new U("tilingscheme:extent-not-exist","The layer does not provide a layer extent."):jCt(t,i)||(e==null||s.equals(e)||e.isWGS84&&s.isWebMercator?null:new U("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")))}function jCt(t,e){const i=t.lods,r=i[0].resolution*2**i[0].level,s=[r*t.size[0],r*t.size[1]],n=[t.origin.x,t.origin.y],o=wEe(e),a=si();oc.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>gC){const c=i[0].scale*2**i[0].level;let h=Math.max((o[3]-o[1])/t.size[1],(o[2]-o[0])/t.size[0])*c/r;const d=Math.floor(Math.log(h)/Math.log(10));return h=Math.ceil(h/10**d)*10**d,new U("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:h,requiredNumRootTiles:l,allowedNumRootTiles:gC})}return null}const GCt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:VCt},Symbol.toStringTag,{value:"Module"}));function HCt(t,e,i,r){if(t==null)return Ioe();const s=(t==null?void 0:t.lods.length)-1,n=t.spatialReference;if(n.isWebMercator){if(!oc.makeWebMercatorAuxiliarySphere(s).compatibleWith(t,r))return new U("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!Gke(n))return new U("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!oc.makeGCSWithTileSize(t.spatialReference,t.size[0],s).compatibleWith(t,r))return t.spatialReference.isWGS84?new U("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new U("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return e==null||t.spatialReference.equals(e)?null:new U("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const qCt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:HCt},Symbol.toStringTag,{value:"Module"})),WCt={[je.Global]:qCt,[je.Local]:GCt};function fo(t,e){t||console.warn("Terrain: "+e)}let Kn=!1,oV=!1;function ZCt(t){oV=t,Kn=Kn||t}function YCt(t){Kn=t}function Ie(t,e){var i;if(Kn&&!t){const r=(i=new Error().stack)==null?void 0:i.slice(5);throw console.warn("Terrain internal: "+(e??"")+" at "+r),new Error("Assertion failed"+(e?": "+e:""))}}function aV(t){return(t==null?void 0:t.type)==="imagery-tile"||(t==null?void 0:t.type)==="wcs"}function H6(t){return(t==null?void 0:t.type)==="imagery-tile-3d"}function Hke(t){return(t==null?void 0:t.type)==="tile-3d"}function MA(t){return(t==null?void 0:t.type)==="vector-tile-3d"}function qke(t){return(t==null?void 0:t.type)==="wmts-3d"}function YK(t){return(t==null?void 0:t.type)==="elevation-3d"}function IO(t){return(t==null?void 0:t.type)==="group"}function lD(t){return t&&(Hke(t)||qke(t)||H6(t)||MA(t))}function JK(t){return t&&(Hke(t)||H6(t)||MA(t)||qke(t))}function XK(t){return JK(t)||YK(t)}function JCt(t){var e;return kke((e=t==null?void 0:t.sourceLayerInfo)==null?void 0:e.data)}function XCt(t){return Wke(t==null?void 0:t.sourceLayerInfo)||!!(t!=null&&t.isVTLBackground)}function KCt(t){var e;return zke((e=t==null?void 0:t.sourceLayerInfo)==null?void 0:e.data)}function QCt(t){var i;const e=(i=t==null?void 0:t.sourceLayerInfo)==null?void 0:i.data;return G6(e)||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData}function Wke(t){return p2(t==null?void 0:t.data)}function u$(t){return t!=null&&"release"in t&&t.release(),null}function jai(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function cD(t,e,i,r,s){return WCt[r].checkIfTileInfoSupportedForViewSR(t,i,e,s)}function q6(t,e,i){var o;let r=null,s=null;if((t==null?void 0:t.type)==="wmts"){const a=Zke(t,e,i);r=a.tileInfo,s=a.fullExtent}else{s=aV(t)?t.getCompatibleFullExtent(e):t.fullExtent;const a=i===je.Local;aV(t)?r=t.getCompatibleTileInfo(e,s,a):(t==null?void 0:t.type)==="vector-tile"?r=a&&!e$t(e)||t$t.force512VTL?t.tileInfo:t.tileInfo.getCompatibleForVTL(256):r=t.tileInfo}const n="tilemapCache"in t?(o=t.tilemapCache)==null?void 0:o.effectiveMaxLOD:void 0;return r!=null&&s!=null&&cD(r,s,e,i,n)==null?{tileInfo:r,fullExtent:s}:null}function Zke(t,e,i){const r=bYe(t);if(r!=null){if(!Ce.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{const s=r.find(n=>cD(n.tileInfo,n.fullExtent,e,i)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function e$t(t){return t.isWGS84||t.isWebMercator||OU(t)||!Gj(t)}const t$t={force512VTL:!1};function Cve(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function jg(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function hd(t,e,i=s$t){return Math.abs(t-e)<i}function lV(t){return t===nt.NORTH_EAST?nt.SOUTH_WEST:t===nt.NORTH_WEST?nt.SOUTH_EAST:t===nt.SOUTH_WEST?nt.NORTH_EAST:nt.NORTH_WEST}function gae(t){return t===nt.NORTH?nt.SOUTH:t===nt.EAST?nt.WEST:t===nt.SOUTH?nt.NORTH:nt.EAST}function i$t(t){return t===nt.NORTH_WEST||t===nt.SOUTH_WEST}function r$t(t){return t===nt.NORTH_WEST||t===nt.NORTH_EAST}function $ve(t){return t===nt.NORTH_WEST||t===nt.WEST||t===nt.SOUTH_WEST}function Ave(t){return t===nt.NORTH_EAST||t===nt.EAST||t===nt.SOUTH_EAST}function Mve(t){return t===nt.SOUTH_EAST||t===nt.SOUTH||t===nt.SOUTH_WEST}function Ove(t){return t===nt.NORTH_EAST||t===nt.NORTH||t===nt.NORTH_WEST}const rf=[nt.NORTH,nt.EAST,nt.SOUTH,nt.WEST],cV=[nt.NORTH_EAST,nt.SOUTH_EAST,nt.SOUTH_WEST,nt.NORTH_WEST],s$t=1e-5;let Bh=class extends he{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(i=>{const r=i.layer;if("operationalLayerType"in r&&_Ye(r.operationalLayerType)&&this.viewSpatialReference!=null){const s=Yke(r.fullExtent,this.viewSpatialReference);s!=null&&e.push(wEe(s))}}),e}};function n$t(t,e){return t===je.Global?new KK(e):new QK(e)}u([p({readOnly:!0})],Bh.prototype,"layerViewsExtent",null),u([p({readOnly:!0})],Bh.prototype,"tiledLayersExtent",null),u([p({readOnly:!0})],Bh.prototype,"stencilEnabledExtents",null),u([p()],Bh.prototype,"viewSpatialReference",void 0),u([p()],Bh.prototype,"tilingScheme",void 0),u([p()],Bh.prototype,"defaultTiledLayersExtent",void 0),u([p({constructOnly:!0})],Bh.prototype,"layers",void 0),u([p({constructOnly:!0})],Bh.prototype,"layerViews",void 0),Bh=u([A("esri.views.3d.terrain.ExtentHelper")],Bh);let KK=class extends Bh{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?INe:k_t}};KK=u([A("esri.views.3d.terrain.ExtentHelper.ExtentHelperGlobal")],KK);let QK=class extends Bh{_computeLayerViewsExtent(){const e=yv(),i=this.viewSpatialReference;this.layerViews.forEach(n=>{const o=n.layer;if(n.isResolved()&&(o.type!=="graphics"||!o.internal)){const a=Yke("fullExtentInLocalViewSpatialReference"in n&&n.fullExtentInLocalViewSpatialReference||n.layer.fullExtent,i);kC(e,a,e)}});const r=cZ(e)?e:null,s=this._get("layerViewsExtent");return Hx(r,s)?s:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const i=this.viewSpatialReference,r=yv();this.layers.forEach(o=>{var a;if(o.loaded&&HC(o)){const l=q6(o,i,je.Local);if(l==null)return;const{tileInfo:c,fullExtent:h}=l,d="tilemapCache"in o?(a=o.tilemapCache)==null?void 0:a.effectiveMaxLOD:void 0;c!=null&&h!=null&&(aV(o)||e.compatibleWith(c,d)&&h.spatialReference.equals(e.spatialReference))&&kC(r,h,r)}}),kC(r,this.defaultTiledLayersExtent,r);const s=cZ(r)?r:null,n=this._get("tiledLayersExtent");return Hx(s,n)?n:s}};function Yke(t,e){return t==null||t.spatialReference.equals(e)?t:KR(t,t.spatialReference,e)}QK=u([A("esri.views.3d.terrain.ExtentHelper.ExtentHelperLocal")],QK);var gs,qo;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(gs||(gs={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(qo||(qo={}));let o$t=class{constructor(e,i){this._material=e,this._repository=i,this._map=new Map}dispose(){this._map.forEach((e,i)=>{e!=null&&this._repository.release(this._material,i)})}load(e,i,r){const s=this._material.produces.get(i);if(!(s!=null&&s(r)))return null;this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,i,r));const n=this._map.get(r);if(n!=null){if(n.ensureResources(e)===Hb.LOADED)return n;this._repository.requestRender()}return null}},Jke=class extends sDe{constructor(e=$()){super(),this.origin=e}get slicePlaneLocalOrigin(){return this.origin}},yae=class{constructor(e=0,i=0){this.from=e,this.to=i}get numElements(){return this.to-this.from}};function Ive(t){if(t.length<2)return;const e=new Map;t.forAll(r=>e.set(r.from,r));let i=!0;for(;i;){i=!1;for(let r=0;r<t.length;++r){const s=t.data[r],n=e.get(s.to);n&&(s.to=n.to,e.delete(n.from),t.removeUnordered(n),i=!0)}}}let Rve=class extends yae{constructor(e,i,r,s){super(i,r),this.geometry=e,this._highlightName=null,this.updateHighlightOptions(s)}updateHighlightOptions(e){const{geometry:i}=this;if(!i.hasHighlights)return void(this._highlightName=null);let r=-1,s=null;i.foreachHighlightOptions(n=>{const o=e.get(n)??-1;o>r&&(r=o,s=n)}),this._highlightName=s}get highlightName(){return this._highlightName}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.isVisible&&this.geometry.hasHighlights}get hasOccludees(){return this.geometry.occludees!=null}},a$t=class{constructor(){this.first=0,this.count=0}},l$t=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new ii({allocator:e=>e||new yae,deallocator:null}),this.hasHiddenInstances=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.highlightNames=new Set,this.drawCommandsDefault=pk(),this.drawCommandsHighlights=new Map,this.drawCommandsOccludees=pk(),this.drawCommandsShadowHighlightRest=pk()}get numElements(){return this._numElements}get instances(){return this._instances}get hasHighlights(){return this.highlightNames.size>0}resetInstanceSummary(){this.hasHiddenInstances=!1,this.hasOccludees=!1,this.highlightNames.clear()}updateIfDrawCommandsDirty(e,i){if(this.drawCommandsDirty){this.resetInstanceSummary();for(const r of this.instances.values())this.updateDrawState(r);this.updateDrawCommands(e,i)}}addInstance(e,i){this.deleteInstance(e),this._instances.set(e,i),this._numElements+=i.numElements}deleteInstance(e){const i=this._instances.get(e);i&&(this._numElements-=i.numElements,this._instances.delete(e))}updateInstance(e,i,r){const s=this._instances.get(e);s&&(this._numElements-=s.numElements,s.from=i,s.to=r,this._numElements+=s.numElements)}updateDrawState(e){if(e.isVisible){const{highlightName:i}=e;i&&this.highlightNames.add(i),e.hasOccludees&&(this.hasOccludees=!0)}else this.hasHiddenInstances=!0}updateDrawCommands(e,i){if(this.drawCommandsDefault.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;const{sortedInstances:r}=this;if(this._updateHighlightDrawCommands(e,r),!this.needsMultipleCommands()){const s=this.drawCommandsDefault.pushNew(),n=this.holes.front();return this.vao!=null&&this.holes.length===1&&n.to===Math.floor(this.vao.byteSize/i)?(s.first=0,void(s.count=n.from)):(s.first=1/0,s.count=0,this._instances.forEach(o=>{s.first=Math.min(s.first,o.from),s.count=Math.max(s.count,o.to)}),void(s.count-=s.first))}for(const s of r)s.isVisible&&F9(s.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,s)}get sortedInstances(){return Array.from(this._instances.values()).sort((e,i)=>e.from===i.from?e.to-i.to:e.from-i.from)}updateHighlights(e){this.highlightNames.clear();const i=this.sortedInstances;for(const r of i)r.updateHighlightOptions(e),r.isVisible&&r.highlightName&&this.highlightNames.add(r.highlightName);this._updateHighlightDrawCommands(e)}_updateHighlightDrawCommands(e,i=this.sortedInstances){const{drawCommandsHighlights:r,drawCommandsShadowHighlightRest:s}=this;r.clear(),s.clear();for(const n of i){if(n.updateHighlightOptions(e),!n.isVisible)continue;const{highlightName:o}=n;o&&(this.highlightNames.add(o),F9(tw(r,o,pk),n)),o&&o===jm||F9(s,n)}}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function c$t(t){return t.vao!=null}function pk(){return new ii({allocator:t=>t||new a$t,deallocator:t=>t})}function F9(t,e){const i=t.back();if(i==null){const r=t.pushNew();return r.first=e.from,void(r.count=e.numElements)}if(u$t(i,e)){const r=e.from-i.first+e.numElements;i.count=r}else{const r=t.pushNew();r.first=e.from,r.count=e.numElements}}function u$t(t,e){return t.first+t.count>=e.from}let h$t=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(i=>i.instances.has(e))}},Fx=class extends OL{get _hasHighlights(){return this._highlightNames.size>0}hasHighlightOptions(e){return this._highlightNames.has(e)}constructor(e){super(e),this._dataByOrigin=new Map,this._drawParameters=new Jke,this._highlightNames=new Set,this.drapedPriority=0,this._produces=new Map,this._hasOccludees=!1}destroy(){this._glMaterials=Dt(this._glMaterials),this._dataByOrigin.forEach(e=>e.dispose()),this._dataByOrigin.clear(),this._vaoCache=null}initialize(){this._updateProduces()}_updateProduces(){this.material.produces.forEach((e,i)=>{this._produces.set(i,r=>!(this._dataByOrigin.size===0||!(r!==Y.Highlight&&r!==Y.ShadowHighlight||this._hasHighlights))&&e(r))})}initializeRenderContext(e,i){this._glMaterials=new o$t(this.material,i??e.materials),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=e.renderContext.rctx.getVaoCache(this.material.vertexAttributeLocations,Jv(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get produces(){return this._produces}get hasOccludees(){return this._hasOccludees}get hasEmissions(){return this.material.hasEmissions}get isDecoration(){return this.material.parameters.isDecoration}queryRenderOccludedState(e){return this.material.queryRenderOccludedState(e)}get numGeometries(){let e=0;return this._dataByOrigin.forEach(i=>e+=i.buffers.reduce((r,s)=>r+s.instances.size,0)),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach(i=>e+=i.buffers.reduce((r,s)=>r+s.vao.cachedMemory,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(i=>i.buffers.forEach(r=>r.instances.forEach(({geometry:s})=>e(s))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}updateHighlights(e){this.highlightOrderMap=e,this._highlightNames.clear(),this._dataByOrigin.forEach(i=>{i.buffers.forEach(r=>{r.updateHighlights(e),r.highlightNames.forEach(s=>this._highlightNames.add(s))})}),this._updateProduces()}_updateGeometries(e){const i=this._bufferWriter;if(i==null)return;const r=i.vertexBufferLayout.stride/4;for(const s of e){const n=s.renderGeometry,o=this._dataByOrigin.get(n.localOrigin.id),a=o==null?void 0:o.findBuffer(n.id);if(a==null)return;const l=a.instances.get(n.id);if(s.updateType&(qo.GEOMETRY|qo.TRANSFORMATION)){const c=gk(i.elementCount(l.geometry.geometry.attributes)*r),h=i.vertexBufferLayout.createView(c.buffer);this._writeGeometry(n,h,0),a.vao.vertexBuffers.get("geometry").setSubData(c,l.from*r,0,l.numElements*r)}s.updateType&(qo.HIGHLIGHT|qo.OCCLUDEE|qo.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(e,i){const r=new Ov;for(const s of e){const n=s.localOrigin;if(n==null)continue;let o=r.get(n.id,null);o==null&&(o=new Pve(n.vec3),r.set(n.id,null,o)),o.changes.push(s)}for(const s of i){const n=s.localOrigin;if(n==null)continue;const o=this._dataByOrigin.get(n.id),a=o==null?void 0:o.findBuffer(s.id);if(a==null)continue;let l=r.get(n.id,a);l==null&&(l=new Pve(n.vec3),r.set(n.id,a,l)),l.changes.push(s)}return r}_addAndRemoveGeometries(e,i){if(this._bufferWriter==null||this._vaoCache==null)return;const{_bufferWriter:r,_dataByOrigin:s}=this,n=r.vertexBufferLayout.stride/4,o=this._computeDeltas(e,i);o.forEach((a,l)=>{const c=a.get(null),h=(c==null?void 0:c.changes)??[];o.delete(l,null);let d=s.get(l);if(a.forEach((f,m)=>{if(o.delete(l,m),m==null)return void Zt(!1,"No VAO for removed geometries");if(m.instances.size===f.changes.length)return this._vaoCache.deleteVao(m.vao),r3(d.buffers,m),void(d.buffers.length===0&&h.length===0&&s.delete(l));const g=m.numElements,v=m.vao.byteSize/4,_=h.reduce((S,C)=>S+r.elementCount(C.geometry.attributes),0),b=f.changes.reduce((S,C)=>S+r.elementCount(C.geometry.attributes),0),w=Math.min((g+_-b)*n,mk),x=w>v;w>MP&&w<v/2?(f.changes.forEach(({id:S})=>m.deleteInstance(S)),m.instances.forEach(({geometry:S})=>h.push(S)),this._vaoCache.deleteVao(m.vao),r3(d.buffers,m)):x?this._applyAndRebuild(m,h,f):this._applyRemoves(m,f)}),h.length>0)for(d==null&&(d=new h$t(c.origin),s.set(l,d)),d.buffers.forEach(f=>this._applyAdds(f,h));h.length>0;)d.buffers.push(this._applyAndRebuild(new l$t,h,null))})}_updateDrawCommands(){this._highlightNames.clear(),this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(i=>{i.updateIfDrawCommandsDirty(this.highlightOrderMap,this._bufferWriter.vertexBufferLayout.stride),i.hasHighlights&&l3(this._highlightNames,i.highlightNames),this._hasOccludees=this._hasOccludees||i.hasOccludees})})}_applyAndRebuild(e,i,r){if(r)for(const g of r.changes)e.deleteInstance(g.id);const s=this._bufferWriter,n=s.vertexBufferLayout.stride,o=n/4,a=Math.floor(mk/o);let l=e.numElements;for(;i.length>0;){const g=i.pop(),v=s.elementCount(g.geometry.attributes);if(l+v>a&&l>0){i.push(g);break}l+=v;const _=new Rve(g,0,0,this.highlightOrderMap);Zt(e.instances.get(g.id)==null),e.addInstance(g.id,_)}const c=l*o,h=gk(c),d=s.vertexBufferLayout.createView(h.buffer);let f=0;e.resetInstanceSummary(),e.instances.forEach((g,v)=>{this._writeGeometry(g.geometry,d,f);const _=f;f+=s.elementCount(g.geometry.geometry.attributes),e.updateInstance(v,_,f),e.updateDrawState(g)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(Lve(c)),e.vao.vertexBuffers.get("geometry").setSubData(h,0,0,f*o),e.holes.clear();const m=e.holes.pushNew();return m.from=f,m.to=Math.floor(e.vao.byteSize/n),e.updateDrawCommands(this.highlightOrderMap,n),e}_applyRemoves(e,i){if(i.changes.length===0||this._bufferWriter==null)return;for(const a of i.changes){const l=a.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const h=Uf.back();if(h){if(h.to===c.from){h.to=c.to;continue}if(h.from===c.to){h.from=c.from;continue}}const d=Uf.pushNew();d.from=c.from,d.to=c.to}Ive(Uf);const r=this._bufferWriter.vertexBufferLayout.stride/4,s=Uf.reduce((a,l)=>Math.max(a,l.numElements),0)*r,n=gk(s);n.fill(0,0,s);const o=e.vao.vertexBuffers.get("geometry");Uf.forAll(a=>o.setSubData(n,a.from*r,0,a.numElements*r)),e.holes.pushArray(Uf.data,Uf.length),Uf.forAll((a,l)=>Uf.data[l]=null),Uf.clear(),e.drawCommandsDirty=!0}_applyAdds(e,i){if(i.length===0||this._bufferWriter==null)return;if(!c$t(e))return void this._applyAndRebuild(e,i,null);const r=this._bufferWriter,s=r.vertexBufferLayout.stride/4,n=e.numElements,o=i.reduce((b,w)=>b+r.elementCount(w.geometry.attributes),0),a=Math.min((n+o)*s,mk),l=4*a;if(e.vao.byteSize<Lve(mk-MP)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,i,null);Ive(e.holes);const c=new Array;for(const b of i){const w=r.elementCount(b.geometry.attributes),x=d$t(e.holes,w);c.push(x)}const h=e.vao.vertexBuffers.get("geometry");let d=0,f=0,m=0;const g=gk(a),v=r.vertexBufferLayout.createView(g.buffer);i.forEach((b,w)=>{const x=c[w];if(x==null)return;if(m!==x){const T=m-f;T>0&&h.setSubData(g,f*s,0,T*s),f=x,d=0}const S=r.elementCount(b.geometry.attributes);this._writeGeometry(b,v,d),d+=S,m=x+S;const C=new Rve(b,x,x+S,this.highlightOrderMap);Zt(e.instances.get(b.id)==null),e.addInstance(b.id,C),e.drawCommandsDirty=!0});const _=m-f;_>0&&h.setSubData(g,f*s,0,_*s),WVe(i,(b,w)=>c[w]==null)}_writeGeometry(e,i,r){this._bufferWriter!=null&&(_n(hE,e.transformation),hE[12]-=e.localOrigin.vec3[0],hE[13]-=e.localOrigin.vec3[1],hE[14]-=e.localOrigin.vec3[2],$l(fk,hE),mc(fk,fk),this._bufferWriter.write(hE,fk,e.geometry.attributes,e.geometry.objectAndLayerIdColor,i,r))}updateAnimation(e){return this.material.update(e)}acquireTechniques(e){var g;if(!this.material.shouldRender(e))return null;const{output:i,bind:r}=e,s=this.material.produces.get(r.slot);if(!(s!=null&&s(i)))return null;const{highlight:n,slot:o}=r,a=i===Y.ShadowHighlight,l=i===Y.Highlight,c=l||a,h=n==null?void 0:n.name;if(c&&(this._highlightNames.size===0||l&&h&&!this._highlightNames.has(h)))return null;const d=v=>l&&!!h&&!v.has(h),f=i===Y.ShadowExcludeHighlight,m=!(c||f);for(const{buffers:v}of this._dataByOrigin.values())for(const _ of v){if(d(_.highlightNames))continue;const b=a?_.drawCommandsHighlights.get(jm):c?h?_.drawCommandsHighlights.get(h):_.drawCommandsHighlights.size>0:((g=(f&&_.needsMultipleCommands()?_.drawCommandsShadowHighlightRest:_.drawCommandsDefault)||null)==null?void 0:g.length)??!1,w=m&&_.drawCommandsOccludees||null;if(b||w!=null&&w.length){const x=this._glMaterials.load(e.rctx,o,i),S=x==null?void 0:x.beginSlot(r);if(S)return S}}return null}render(e,i){const{output:r,bind:s}=e,{slot:n,highlight:o}=s,a=r===Y.Highlight,l=(o==null?void 0:o.name)??"";if(a&&!o)return;const c=r===Y.ShadowHighlight,h=a||c,d=r===Y.ShadowExcludeHighlight,f=!(h||d),m=n===xe.OCCLUDER_MATERIAL||n===xe.TRANSPARENT_OCCLUDER_MATERIAL?n:null,{rctx:g}=e;g.runAppleAmdDriverHelper();const v=g.bindTechnique(i,s,this.material.parameters);for(const _ of this._dataByOrigin.values())for(const b of _.buffers){if(a&&(!b.hasHighlights||!b.drawCommandsHighlights.has(l))||c&&(!b.hasHighlights||!b.drawCommandsHighlights.has(jm)))continue;const w=()=>{const M=[],I=b.drawCommandsHighlights.get(jm)??new ii;return I&&M.push(I),M},x=h&&!c?b.drawCommandsHighlights.get(l)??null:null,S=c?w():h?x?[x]:p$t:d&&b.needsMultipleCommands()?[b.drawCommandsShadowHighlightRest]:[b.drawCommandsDefault],C=S.some(M=>M.length>0),T=f&&b.drawCommandsOccludees||null;if(C||T!=null&&T.length){if(this._drawParameters.origin=_.origin,v.bindDraw(s,this.material.parameters,this._drawParameters),i.ensureAttributeLocations(b.vao),g.bindVAO(b.vao),C)for(const M of S)g.setPipelineState(i.getPipeline(!1,m)),M.forAll(I=>g.drawArrays(i.primitiveType,I.first,I.count));T!=null&&T.length&&(g.setPipelineState(i.getPipeline(!0,m)),T.forAll(M=>g.drawArrays(i.primitiveType,M.first,M.count)))}}}static prune(){tz=new Float32Array(MP)}get test(){}};u([p({constructOnly:!0})],Fx.prototype,"material",void 0),u([p({})],Fx.prototype,"highlightOrderMap",void 0),Fx=u([A("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],Fx);let Pve=class{constructor(e){this.origin=e,this.changes=new Array}};function d$t(t,e){const i=t.find(s=>s.numElements>=e);if(i==null)return null;const r=i.from;return i.from+=e,i.from>=i.to&&t.removeUnordered(i),r}const hE=qe(),fk=qe(),Uf=new ii({allocator:t=>t||new yae,deallocator:null}),MP=65536,k9=4*MP,Dve=1024,Xke=16777216,mk=Xke/4;let tz=new Float32Array(MP);function gk(t){return tz.length<t&&(tz=new Float32Array(t)),tz}function Lve(t){const e=4*t;return e<=Dve?Dve:e<k9?nTe(e):Math.max(Math.min(Math.ceil(1.5*e/k9)*k9,Xke),e)}const p$t=[];let Lh=class extends he{constructor(e){super(e),this._pending=new f$t,this._changes=new tK,this._renderers=new Map,this._sortedRenderers=new ii,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._sortedRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materials(){return this.rendererContext.materials}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}hasHighlightOptions(e){return $m(this._renderers,i=>i.hasHighlightOptions(e))}get hasWater(){return this._hasWater}get rendersOccludedDraped(){for(const e of this._renderers.values())if(e.numGeometries!==0&&!e.queryRenderOccludedState(Cr.Occlude))return!0;return!1}get isEmpty(){return!this.updating&&this._renderers.size===0&&this._geometries.size===0}getMaterialRenderer(e){return this._renderers.get(e)}get sortedRenderers(){return this._sortedRenderers}commitChanges(e){if(!this.updating)return!1;this._processAddsRemoves();const i=XDe(this._changes);let r=!1;return i.forEach((s,n)=>{let o=this._renderers.get(n);!o&&s.adds.length>0&&(o=new Fx({material:n,highlightOrderMap:e}),o.initializeRenderContext(this.rendererContext.pluginContext,this._materials),this._renderers.set(n,o),r=!0),o&&(o.modify(s),o.updateHighlights(e),o.numGeometries===0&&(this._renderers.delete(n),o.destroy(),r=!0))}),this._changes.clear(),r&&this._updateSortedMaterialRenderers(),this._hasHighlights=$m(this._renderers,s=>{const n=s.produces.get(xe.DRAPED_MATERIAL);return!!n&&n(Y.Highlight)}),this._hasWater=$m(this._renderers,s=>{const n=s.produces.get(xe.DRAPED_WATER);return!!n&&n(Y.Normal)}),this.notifyChange("updating"),!0}updateHighlights(e){this._renderers.forEach(i=>i.updateHighlights(e))}addGeometries(e,i){if(e.length===0)return;const r=this._validateRenderGeometries(e);for(const n of r)this._geometries.set(n.id,n);const s=this._pending.empty;for(const n of r)this._pending.adds.add(n);s&&this.notifyChange("updating"),i===gs.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,i){const r=this._pending.empty,s=this._pending.adds;for(const n of e)s.has(n)?(this._pending.removed.add(n),s.delete(n)):this._pending.removed.has(n)||this._pending.removes.add(n),this._geometries.delete(n.id);r&&!this._pending.empty&&this.notifyChange("updating"),i===gs.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,i){const r=this._changes.updates.length===0;for(const s of e){const n=this._changes.updates.pushNew();n.renderGeometry=this._validateRenderGeometry(s),n.updateType=i}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),i){case qo.TRANSFORMATION:case qo.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case qo.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let i=!1;return this._sortedRenderers.forAll(r=>i=!!r.updateAnimation&&r.updateAnimation(e)||i),i}precompile(e){return this._sortedRenderers.reduce((i,r)=>r.precompile(e)||i,!1)}render(e){this._sortedRenderers.forAll(i=>{const r=i.acquireTechniques(e);r&&i.render(e,r)})}intersect(e,i,r,s,n){for(const o of this._geometries.values()){if(!s(o))continue;this._intersectRenderGeometry(o,r,i,0,e,n);const a=this.rendererContext.longitudeCyclical;a&&(o.boundingSphere[0]-o.boundingSphere[3]<a.min&&this._intersectRenderGeometry(o,r,i,a.range,e,n),o.boundingSphere[0]+o.boundingSphere[3]>a.max&&this._intersectRenderGeometry(o,r,i,-a.range,e,n)),n++}return n}_updateSortedMaterialRenderers(){this._sortedRenderers.clear();let e=0;for(const i of this._renderers.values())i.drapedPriority=e++,this._sortedRenderers.push(i);this._sortedRenderers.sort((i,r)=>{var s,n,o,a;return((s=r.material)==null?void 0:s.renderPriority)===((n=i.material)==null?void 0:n.renderPriority)?i.drapedPriority-r.drapedPriority:(((o=r.material)==null?void 0:o.renderPriority)||0)-(((a=i.material)==null?void 0:a.renderPriority)||0)})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes)),this._changes.updates.filterInPlace(({renderGeometry:e})=>!this._pending.has(e)),this._pending.clear()}_intersectRenderGeometry(e,i,r,s,n,o){if(!e.visible||!e.material.visible)return;let a=0;s+=e.transformation[12],a=e.transformation[13],z9[0]=r[0]-s,z9[1]=r[1]-a,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,n,z9,(l,c,h)=>{m$t(i,h,o,e.material.renderPriority,n,e.layerUid,e.graphicUid)},i)}_notifyGraphicGeometryChanged(e){if(this.drapeSource.notifyGraphicGeometryChanged==null)return;let i;for(const{graphicUid:r}of e)r!=null&&r!==i&&(this.drapeSource.notifyGraphicGeometryChanged(r),i=r)}_notifyGraphicVisibilityChanged(e){if(this.drapeSource.notifyGraphicVisibilityChanged==null)return;let i;for(const{graphicUid:r}of e)r!=null&&r!==i&&(this.drapeSource.notifyGraphicVisibilityChanged(r),i=r)}_validateRenderGeometries(e){for(const i of e)this._validateRenderGeometry(i);return e}_validateRenderGeometry(e){return e.localOrigin==null&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){}};u([p()],Lh.prototype,"drapeSource",void 0),u([p()],Lh.prototype,"updating",null),u([p()],Lh.prototype,"rctx",null),u([p({constructOnly:!0})],Lh.prototype,"rendererContext",void 0),u([p()],Lh.prototype,"_materials",null),u([p()],Lh.prototype,"_localOriginFactory",null),u([p({readOnly:!0})],Lh.prototype,"isEmpty",null),u([p()],Lh.prototype,"_renderers",void 0),u([p()],Lh.prototype,"_geometries",void 0),Lh=u([A("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Lh);let f$t=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function m$t(t,e,i,r,s,n,o){const a=new p2t(n,o,e),l=c=>{c.set(Xr.OVERLAY,a,t.dist,t.normal,t.transformation,i,r)};if((s.results.min.drapedLayerOrder==null||i>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==Co.MIN&&(s.results.max.drapedLayerOrder==null||i<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===Co.ALL){const c=ane(s.ray);l(c),s.results.all.push(c)}}const z9=Ye();function Kke(){var e;const t=(e=globalThis.require)==null?void 0:e.modules;if(t){const i=Object.keys(t);for(const r of i)r.includes(".glsl")&&delete t[r]}}let Nve=class{constructor(e,i){this.screen=e,this.olid=i}};const Qke=1.3,g$t=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let R0,Hl=class extends he{constructor(e){super(e),this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._latestOriginId=0,this._maxResolution=X("esri-mobile")?2048:4096}initialize(){const e=this.view;this.renderer=new om({parent:this}),e._stage.renderer.plugins.add(this.renderer);const i=()=>this.requestRender();this._groundIntersector=ph(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this.addHandles([H(()=>this.renderer.hasHighlights,i),this.renderer.events.on("has-water",()=>{var r;return(r=e._stage)==null?void 0:r.renderer.updateHasFlags()}),this.renderer.events.on("content-changed",i),H(()=>e.state.camera.pixelRatio,i),H(()=>e.state.alignPixelEnabled,i),this.renderer.events.on("textures-disposed",()=>this.surface.requestRender()),H(()=>{var r,s,n;return[(r=e.pointsOfInterest)==null?void 0:r.renderPointOfView,(n=(s=e.pointsOfInterest)==null?void 0:s.centerOnSurfaceFrequent)==null?void 0:n.location]},()=>this.setPlacementDirty()),H(()=>{var r,s;return[(r=e.state)==null?void 0:r.pixelRatio,(s=e.state)==null?void 0:s.contentPixelRatio]},()=>this.setPlacementDirty(),Yt),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(lt.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",r=>{this._updateOverlays(Kc,r.camera,$t.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlays($t.BACKGROUND,r)})]),e._stage.renderer.overlay=this}destroy(){var e;(e=this.view)!=null&&e._stage&&(this.view._stage.renderer.plugins.remove(this.renderer),this.view._stage.renderer.overlay=null),R0&&(R0.hide(),R0=null),this.renderer=$e(this.renderer)}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.renderer.longitudeCyclical=null;const i=this.view.renderSpatialReference;e!=null&&i!=null?(this._renderSR=i,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this.renderer.longitudeCyclical=e.isWebMercator?new Ob(-20037508342787e-6,20037508342787e-6):new Ob(-180,180))):this.renderer.disposeOverlays()}get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||xs.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?yr(this._spatialReference).metersPerDegree:1}get _overlayStretch(){return Qke/this.view.resolutionScale}get _longitudeCyclical(){return this.renderer.longitudeCyclical}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get rendersOccludedDraped(){return this.renderer.rendersOccludedDraped}render(){if(this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays)return this._precompileShaders()?this._drawOverlays($t.UPDATE):null}get hasOverlays(){return this.renderer.hasOverlays}registerDrapeSource(e,i,r){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this.renderer.createDrapeSourceRenderer(e,i,r);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),s}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,Lh)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.requestRender()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,$t.UPDATE)}_updateOverlays(e,i,r){if(!this._spatialReference)return ea;const s=this._computeOverlayResolution(i);this._computeOverlayExtents(i,s,Bf),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources,Bf.stretch);const n=this._updateOverlay(Dn.INNER,Bf.inner,s,1*Bf.pixelRatioAdjustment,Bf.mapUnitsPerPixel),o=Jo(Bf.inner)/Jo(Bf.outer),a=this._updateOverlay(Dn.OUTER,Bf.outer,s,o*Bf.pixelRatioAdjustment,Bf.mapUnitsPerPixel);n!==_m.EXTENT&&a!==_m.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.updateOverlayParameters(r)),n===_m.NONE&&a===_m.NONE||this.requestRender(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const i=this.view.state.contentPixelRatio*this.view.resolutionScale,r=e.fullWidth/e.pixelRatio*i,s=e.fullHeight/e.pixelRatio*i,n=Math.ceil(1.5*Math.max(r,s));return Math.min(cv(n),this._maxResolution)}_updateOverlay(e,i,r,s,n){if(this.renderer.overlays.length===0)return _m.NONE;const o=this.renderer.overlays[e],a=o.mapUnitsPerPixel;if(o.mapUnitsPerPixel=n,o.pixelRatio=s,y$t(i,o.extent)&&r===o.resolution)return a===n?_m.NONE:_m.RERENDER_ONLY;Lb(o.extent,i),o.resolution=r;const l=xEe(o.extent);return o.renderLocalOrigin=kB(l[0],l[1],0,"OV_"+this._latestOriginId++),_m.EXTENT}updateOverlayParameters(e){this.surface.allTiles.forAll(i=>this.updateTileOverlayParameters(i)),this.surface.requestRender(e)}updateTileOverlayParameters(e){if(!e.renderData)return;const i=e.renderData.overlay;if(this.renderer.overlays.length===0)this._clearTileOverlayData(Dn.INNER,i),this._clearTileOverlayData(Dn.OUTER,i);else{const[r,s]=this.renderer.overlays,n=e.extent;this._rectInsideRect(r.extent,n)||this._rectanglesOverlap(n,r.extent)||this._rectanglesOverlap(n,s.extent)?(this._setTileOverlayData(n,Dn.INNER,i),this._setTileOverlayData(n,Dn.OUTER,i)):(this._clearTileOverlayData(Dn.INNER,i),this._clearTileOverlayData(Dn.OUTER,i))}}overlayPixelSizeInMapUnits(e,i){if(this.renderer.overlays.length===0)return i();const r=this.renderer.overlays[Dn.INNER],s=this.renderer.overlays[Dn.OUTER],n=this._pointIsInExtent(e,r.extent)?r:s;return(n.extent[2]-n.extent[0])/n.resolution}_setTileOverlayData(e,i,r){if(this.renderer.overlays.length===0)return;const s=this.renderer.overlays[i].extent,n=Jo(s),o=El(s);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(s[0],a);const l=this._longitudeCyclical.minimalMonotonic(s[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}r.setScale(i,Jo(e)/n,El(e)/o),r.setOffset(i,(a-s[0])/n,(e[1]-s[1])/o)}_clearTileOverlayData(e,i){i.setScale(e,-1,-1),i.setOffset(e,-1,-1)}reloadShaders(){Kke(),this.requestRender(),this.runTask(Kc)}requestRender(e=$t.UPDATE){this.renderer.hasOverlays?(e===$t.UPDATE?(this._contentUpdated=!0,this._drawTexturesDirty=!0):this._drawTexturesAnimateDirty=!0,this.view._stage.renderView.requestRender(e)):this.setPlacementDirty()}_intersectGroundFromView(e,i,r,s,n){const o=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,w$t,i,r);if(o==null)return!1;const a=o.origin,l=oe(yk,o.origin,o.direction);this._groundIntersector.reset(a,l,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,a,l);const c=this._groundIntersector.results.min;return c.getIntersectionPoint(n)&&c.withinDistance(s)}_findHorizonBasedPointOfInterest(e,i){let r=.5;const s=.55,n=this.view.renderCoordsHelper.getAltitude(e.eye),o=this.view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=ue(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:n+a,e.aboveGround?n-a:1/0),c=e.aboveGround;if(this.view.viewingMode==="global"){const h=yk;fM(pM(WG,yr(this.view.spatialReference).radius+l),wf(e.eye,e.viewForward),h),be(h,h,e.eye);const d=Ib.normalize(SRe(e.viewForward,h,e.viewRight))/e.fovY+.5,f=d<=0||d>=1?.5:s;r=c?f*d:d+f*(1-d)}else{const h=.5*Math.PI-Math.acos(-e.viewForward[2]),d=Math.tan(h),f=Yi(0,d,1,0),m=eu(f,f,e.projectionMatrix)[1],g=ue(.5+.5*m,0,1);r=g===1||g===0?.5:c?g*s:1-(1-g)*s}return this._intersectGroundFromView(e,.5,r,o.distance,i)}_computeOverlayExtents(e,i,r){var D;const s=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n=$();this._findHorizonBasedPointOfInterest(e,n)||ne(n,s),xs.OVERLAY_SHOW_CENTER?(R0==null&&(R0=new f2(this.view.graphics,"red")),R0.show(n,this._renderSR)):R0!=null&&R0.hide();const o=Math.max(.1,Sr(e.eye,n)),a=Rv(this.view.renderCoordsHelper,s,e.eye);this._overlaySREqualsRenderSR||vc(n,this._renderSR,n,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&((D=this._spatialReference)==null?void 0:D.isGeographic),h=c&&this._spatialReference?1/yr(this._spatialReference).metersPerDegree:1,d=this.view.state.contentPixelRatio,f=e.perScreenPixelRatio/d*o*h;r.mapUnitsPerPixel=f/this.worldToPCSRatio,r.stretch=this._overlayStretch;let m=i*f/2*r.stretch,g=!1,v=c?90:1/0;this._isSpherical&&l&&this._spatialReference&&(this._spatialReference.isWebMercator?(m/=Math.cos(nZ(n[1])),v=l[3]):(g=!0,m/=yr(this._spatialReference).metersPerDegree,v=90),m>=v&&(m=v,n[1]=0,this._spatialReference.isWebMercator&&(n[0]=0)));let _=1;g&&(_=1/Math.max(.2,Math.cos(Math.abs(At(n[1])))),m*_>180&&(_=180/m),r.mapUnitsPerPixel*=_);const b=Math.log(2)/12;m=Math.exp(Math.round(Math.log(m)/b)*b);const w=m*_,x=32,S=.5*i/(x*w),C=.5*i/(x*m);n[0]=Math.round(n[0]*S)/S,n[1]=Math.round(n[1]*C)/C;const T=r.inner;T[0]=n[0]-w,T[1]=n[1]-m,T[2]=n[0]+w,T[3]=n[1]+m,this._isSpherical&&this._shiftExtentToFitBounds(T,1/0,v);const M=r.outer;if(6*w>Jo(l))Lb(M,l);else if(Math.PI/2-Math.abs(a-Math.PI/2)<=.25*Math.PI)M[0]=T[0]-w,M[1]=T[1]-m,M[2]=T[2]+w,M[3]=T[3]+m;else{vc(e.eye,this._renderSR,yk,this._spatialReference),fd(Kw,n,yk);let P=-Math.atan2(Kw[1],Kw[0])+.125*Math.PI;P<0&&(P+=2*Math.PI);const F=Math.floor(P/(.25*Math.PI));hA(Kw,g$t[F],2*m),Kw[0]*=_,Kw[2]*=_,Rse(M,T,Kw)}if(this._isSpherical)M[0]=this._longitudeCyclical.clamp(M[0]),M[2]=this._longitudeCyclical.clamp(M[2]),M[1]=Math.max(M[1],-v),M[3]=Math.min(M[3],v);else{const P=hZ(T,l,_$t),F=hZ(M,l,b$t);uZ(P,F)&&(M[2]=M[0],M[3]=M[1])}const I=Math.abs(T[2]-T[0])/i;r.mapUnitsPerPixel=Math.max(r.mapUnitsPerPixel,I),r.pixelRatioAdjustment=r.mapUnitsPerPixel/I}_precompileShaders(){return!!this.renderer.hasOverlays&&(this.renderer.precompileShaders(this.view.state),!0)}_drawOverlays(e,i=this.view.state){if(!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return this.renderer;const r=this._drawTexturesDirty;this._drawTexturesDirty=this._drawTexturesAnimateDirty=!1;const s=this.renderer.computeValidity();return this.renderer.releaseRenderTargets(),this.renderer.drawOverlays(i),s!==this.renderer.computeValidity()&&this.updateOverlayParameters($t.UPDATE),r?(this.surface.requestRender(e),e===$t.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender($t.BACKGROUND),this.renderer}_rectanglesOverlap(e,i){return e!=null&&(this._longitudeCyclical?(this._longitudeCyclical.contains(i[0],i[2],e[0])||this._longitudeCyclical.contains(i[0],i[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],i[0]))&&!(e[1]>i[3]||e[3]<i[1]):y3(e,i))}_rectInsideRect(e,i){return i!=null&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],i[0])&&this._longitudeCyclical.contains(e[0],e[2],i[2])&&i[1]>e[1]&&i[3]<e[3]:uZ(e,i))}_pointIsInExtent(e,i){if(this._longitudeCyclical)return this._longitudeCyclical.contains(i[0],i[2],e.x)&&e.y>=i[1]&&e.y<=i[3];const r=e.x,s=e.y;return r>i[0]&&r<i[2]&&s>i[1]&&s<i[3]}_shiftExtentToFitBounds(e,i,r){let s=0,n=0;e[0]<-i?s=e[0]+i:e[2]>i&&(s=i-e[2]),e[1]<-r?n=e[1]+r:e[3]>r&&(n=r-e[3]),DU(e,s,n)}get test(){}};function y$t(t,e){const r=xs.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r&&Math.abs(e[3]-t[3])<=r}u([p()],Hl.prototype,"_spatialReference",void 0),u([p({readOnly:!0})],Hl.prototype,"running",null),u([p()],Hl.prototype,"_placementDirty",void 0),u([p()],Hl.prototype,"_contentUpdated",void 0),u([p()],Hl.prototype,"_isSpherical",null),u([p()],Hl.prototype,"worldToPCSRatio",null),u([p()],Hl.prototype,"renderer",void 0),u([p({constructOnly:!0})],Hl.prototype,"view",void 0),u([p({constructOnly:!0})],Hl.prototype,"surface",void 0),u([p()],Hl.prototype,"suspended",null),u([p()],Hl.prototype,"updating",null),u([p({type:Boolean})],Hl.prototype,"rendersOccludedDraped",null),Hl=u([A("esri.views.3d.terrain.OverlayManager")],Hl);let v$t=class{constructor(){this.inner=si(),this.outer=si(),this.mapUnitsPerPixel=0,this.pixelRatioAdjustment=1,this.stretch=Qke}};const Kw=yi(),yk=$(),Bf=new v$t,_$t=si(),b$t=si(),w$t=Nn();var _m;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(_m||(_m={}));let x$t=class{constructor(){this.indices=null,this.indexCount=0,this.edgeIndicesStartIndex=0,this.poleIndicesStartIndex=0,this.vertexAttributes=null,this.edgeVerticesStartIndex=0,this.poleVerticesStartIndex=0,this.maxEdgeVertexCount=0,this.boundingBox=bf(),this.numVerticesPerSide=0,this.minu=0,this.minv=0,this.maxu=1,this.maxv=1,this.outerEdgesOffsetAndLength=[0,0,0,0,0,0,0,0]}release(){this.vertexAttributes=Lr(this.vertexAttributes),this.indices=null}reset(){this.indices=null,this.vertexAttributes=null,bf(this.boundingBox),this.numVerticesPerSide=0}getEdgeFirstVertexIndex(e){return this.outerEdgesOffsetAndLength[2*e]}getEdgeCount(e){return this.outerEdgesOffsetAndLength[2*e+1]}getEdgeVertexIndex(e,i){return this.getEdgeAttributeIndex(e,i)}getEdgeVertexPosition(e,i,r,s){this._getEdgeVertexRaw(this.getEdgeAttributeIndex(e,s),i),oe(i,i,r)}getEdgeNormal(e,i,r){const{typedBuffer:s,typedBufferStride:n}=this.vertexAttributes.normalCompressed;c0t(i,s,this.getEdgeAttributeIndex(e,r),n)}setEdgeNormalFromValues(e,i,r,s,n){this._setNormal(this.getEdgeAttributeIndex(e,i),r,s,n)}setEdgeVertexFromValuesRawPositionUV(e,i,r,s,n,o,a){const l=this.getEdgeAttributeIndex(e,i);this.vertexAttributes.position.setValues(l,r,s,n),this._setUV(l,o,a)}setEdgeVertexFromValuesRawPositionUVNormal(e,i,r,s,n,o,a,l,c,h){const d=this.getEdgeAttributeIndex(e,i);this.vertexAttributes.position.setValues(d,r,s,n),this._setUV(d,o,a),this._setNormal(d,l,c,h)}_getEdgeVertexRaw(e,i){this.vertexAttributes.position.getVec(e,i)}_setNormal(e,i,r,s){const{typedBuffer:n,typedBufferStride:o}=this.vertexAttributes.normalCompressed;Zb(n,e,i,r,s,o)}_setUV(e,i,r){uf(this.vertexAttributes.uv0,e,i,r)}getEdgeAttributeIndex(e,i){return Ie(0<=i&&i<this.getEdgeCount(e)),this.getEdgeFirstVertexIndex(e)+i}};const Fve=16384;function uf(t,e,i,r){t.setValues(e,i*Fve,r*Fve)}let S$t=class{constructor(){this.sinLonLUT=new Array(YI+1),this.cosLonLUT=new Array(YI+1),this.sinLatLUT=new Array(YI+1),this.cosLatLUT=new Array(YI+1)}update(e,i,r){const s=i[0],n=i[2];for(let o=0;o<=e;o++){const a=o/e,l=s*(1-a)+n*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=r(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}},T$t=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.samplerDataVersion=0,this.clippingArea=null,this.wireframe=!1,this.cornerPeerNeighbors=[null,null,null,null],this.cornerNeighborCornerTiles=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.cornerNeighborCornerTileSamplerVersions=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1]}},e4e=class iz{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=$e(this._current),this._next=$e(this._next),this._waiting=$e(this._waiting),this._delayed=$e(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){const i=this._delayed||this._waiting||this._next||this._current;i!==this._current&&(this._current=null,this.clear(),this._current=i)}let e=iz.test.fadeMoment;if(this._delayed!=null&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,Ab.Immediate),this._delayed=null)),this._next!=null){e=e||performance.now();const i=this._fadeDuration,r=this._current!=null&&this._next.texture===this._current.texture,s=this._next.type!==Rs.FADING,n=e-this._fadeStart>=i;(r||s||n)&&($e(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;const e=iz.test.fadeMoment||performance.now(),i=Math.max(0,e-this._fadeStart),r=this._fadeDuration;return i>r?0:1-i/r}get isFading(){return this._next!=null||this._delayed!=null}push(e,i=Ab.Immediate){this._delayed=$e(this._delayed),this._push(e,i)}_push(e,i){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=e);const r=iz.test.fadeMoment||performance.now();return i!==Ab.Immediate?(this._delayed=e,void(this._delayedTime=r+i)):this._next==null?(this._next=e,void(this._fadeStart=this._alignFadeStart(r))):void(e!=null&&($e(this._waiting),this._waiting=e))}get _fadeDuration(){const e=this._getFadeDuration();return this._waiting?.5*e:e}_alignFadeStart(e){const i=this._getFadeDuration();return e+i-e%i}get _isFadingEnabled(){return this._getFadeDuration()>0}};var Ab;e4e.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(Ab||(Ab={}));let uV=class{constructor(e,i,r,s,n,o){this.texture=e,this.type=i,this.offsetAndScale=r,e.retain(),this.opacities=De(s,n,o)}destroy(){this.texture.release()}},E$t=class{constructor(){this._scales=Yi(-1,-1,-1,-1),this._offsets=Yi(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,i,r){this._scales[2*e]=i,this._scales[2*e+1]=r}setOffset(e,i,r){this._offsets[2*e]=i,this._offsets[2*e+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}};var OA;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(OA||(OA={}));let t4e=class{constructor(){this._queue=new ii,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.leaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),e!=null&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){var i;const e=(i=this._last)==null?void 0:i.children;return e!=null&&e[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},C$t=class{constructor(){this._q=new ii}get done(){return this._q.length===0}reset(e){if(this._q.clear(),e!=null){this._q.pushArray(e);for(let i=0;i<this._q.length;++i){const r=this._q.data[i];r.leaf||this._q.pushArray(r.children)}}}next(){return this._q.pop()}};function oS(t,e){if(e==null)return!1;const i=$$t(e);if((i==null?void 0:i.fullExtent)==null)return!1;const r=i.fullExtent,s=t.extent;if(r.xmin>s[2]||r.ymin>s[3]||r.xmax<s[0]||r.ymax<s[1])return!1;const n=t.surface.tilingScheme.levels[t.level].scale,o=i.minScale;if(o>0&&n>1.00000001*o)return!1;const a=i.maxScale;return!(a>0&&n<.99999999*a)}function $$t(t){return H6(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale}:t.layer}function A$t(t){return!H6(t)&&t.layer&&"tilemapCache"in t.layer?t.layer.tilemapCache:null}function Fm(t,e){const i=t.lij,r=e.lij;return i[0]-r[0]||i[1]-r[1]||i[2]-r[2]}function M$t(t,e,i=null){i==null||i.length===0?t===OA.BACK_TO_FRONT?e.sort(O$t):e.sort(I$t):e.sort((r,s)=>R$t(r,s,t,i))}function O$t(t,e){const i=e.screenDepth-t.screenDepth;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function I$t(t,e){const i=t.screenDepth-e.screenDepth;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function i4e(t,e,i){const r=t.screenDepth,s=e.screenDepth;return r<s?-i:r>s?i:Fm(t,e)}function R$t(t,e,i,r){return kve(t,r)===kve(e,r)?i4e(t,e,i):t?i:-i}function kve(t,e){for(const i of e)if(t.intersectsExtent(i))return!0;return!1}function P$t(t,e){const i=t.distanceToPOI-e.distanceToPOI;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function D$t(t,e){const i=t.length;for(let r=0;r<i;++r)t.at(r).updateDistanceToPOI(e);t.sort(P$t)}function L$t(t,e,i){let r=1,s=0,n=0;for(;t!==e;)if(r*=.5,s*=.5,n*=.5,1&t.lij[2]&&(s+=.5),1&t.lij[1]||(n+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");i.init(e,s,n,r)}function N$t(t){for(let e=0;e<t.length;e++){const i=t[e],r=i.parent;if(r)for(let s=0;s<4;s++){const n=r.children[s];if(n&&n!==i)return!0}}return!1}function fli(t,e){if(!t||!e||t[0]===e[0])return!1;const i=t[0]<e[0],r=i?t:e,s=i?e:t,n=1<<s[0]-r[0];return Math.floor(s[1]/n)===r[1]&&Math.floor(s[2]/n)===r[2]}var va;(function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.InvisibleWithDraped=2]="InvisibleWithDraped",t[t.Invisible=3]="Invisible",t[t.COUNT=4]="COUNT"})(va||(va={}));function F$t(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(E`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(E`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(E`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}function k$t(t,e){e.spherical?t.vertex.code.add(E`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(E`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(E`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(E`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}function vae(t){t.code.add(E`
    float lineFactorAtPosition(float value) {
      float pos = value * ${E.float(257)};
      if(pos < 0.5 || pos > ${E.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}var km;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(km||(km={}));let z$t=class extends roe{constructor(){super(...arguments),this.overlayOpacity=1}};function U$t(t,e){const{vertex:i,fragment:r,varyings:s}=t;s.add("vtc","vec2"),i.uniforms.add(new zve("texOffsetAndScale")),r.uniforms.add(new Uve("tex")),r.uniforms.add(new U9("textureOpacities"));const n=e.textureFadingEnabled&&!e.renderOccluded;n&&(i.uniforms.add(new zve("nextTexOffsetAndScale")),s.add("nvtc","vec2"),r.uniforms.add(new Uve("texNext")),r.uniforms.add(new U9("nextTexOpacities")),r.uniforms.add(new B$t("fadeFactor")));const o=e.tileBlendInput===km.ColorComposite,a=e.tileBlendInput===km.GridComposite;a&&r.include(vae),o&&r.uniforms.add(new U9("backgroundColor")),i.code.add(E`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = texOffsetAndScale.xy + uv * texOffsetAndScale.zw;
    ${Te(n,"nvtc = nextTexOffsetAndScale.xy + uv * nextTexOffsetAndScale.zw;")}
  }`),r.code.add(E`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${Te(a||o,E`if (opacities.y <= 0.0) {
           return color * opacities.z * opacities.x;
         }
         vec4 bg = vec4(${o?E`backgroundColor`:E`gridColor(uv)`} * opacities.y, opacities.y);
         vec4 layer = color * opacities.z;
         return (bg * (1.0 - layer.a) + layer) * opacities.x;`,"return color;")}
    }`),n?r.code.add(E`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):r.code.add(E`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}let B$t=class extends lr{constructor(e){super(e,"float")}},U9=class extends lr{constructor(e){super(e,"vec3")}},zve=class extends lr{constructor(e){super(e,"vec4")}},Uve=class extends lr{constructor(e){super(e,"sampler2D")}},_ae=class extends z$t{};function r4e(t){const e=new Vi,{vertex:i,fragment:r,varyings:s}=e,{output:n,pbrMode:o,overlayMode:a,tileBorders:l,spherical:c,transparencyMode:h,screenSizePerspective:d}=t;e.include(g6),e.include(mM,t),e.include(Ky,t);const f=()=>{e.include(k$t,t),i.code.add(E`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};Qy(i,t),e.include(ub,t);const m=h===va.InvisibleWithDraped||h===va.Invisible,g=a!==Dm.Disabled,v=g&&m;switch(n){case Y.ColorEmission:case Y.Color:{e.include(U$t,t),e.include(wA,t),g&&(t.pbrMode=o===Ct.Simplified?Ct.TerrainWithWater:Ct.Water,e.include(aO,t),t.pbrMode=o);const _=a===Dm.EnabledWithWater;_&&e.include(F$t,t),s.add("vnormal","vec3"),s.add("vpos","vec3"),s.add("vup","vec3"),f(),d&&RB(i);const b=t.receiveShadows&&!t.renderOccluded;b&&e.include(v6,t),d&&(s.add("screenSizeDistanceToCamera","float"),s.add("screenSizeCosAngle","float")),i.main.add(E`
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);
          vnormal = getNormal();
          vup = getLocalUp(position, localOrigin);
          ${Te(_,E`forwardVertexTangent(vnormal);`)}

          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${Te(g,"setOverlayVTC(uv);")}
          ${Te(l,"forwardTextureCoordinates();")}
          ${Te(d,E`vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
                 screenSizeDistanceToCamera = length(viewPos);
                 vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
                 screenSizeCosAngle = abs(viewSpaceNormal.z);`)}
          ${Te(b,"forwardLinearDepth();")}`),e.fragment.include(cb,t),e.include(wA,t),e.include(T6,t),e.include(soe,t),Wb(r,t),E6(r),bA(r),r.uniforms.add(i.uniforms.get("localOrigin"),new Ka("viewDirection",({camera:x})=>ae(Bve,se(Bve,x.viewMatrix[12],x.viewMatrix[13],x.viewMatrix[14])))),_&&r.uniforms.add(new It("ovWaterTex",(x,S)=>{var C;return(C=S.overlay)==null?void 0:C.getTexture(sr.WaterNormal)}),new Wne("view",({origin:x},{camera:S})=>uh(V$t,S.viewMatrix,x)));const w=.2;r.code.add(E`float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),cg(r),Av(r),r.main.add(E`
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${b?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), readShadowMap(vpos, linearDepth))":c?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${Te(g,E`vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
                   vec4 overlayColor = overlayOpacity * overlayColorOpaque;
                   ${Te(m,`if (overlayColor.a < ${E.float(Kr)}) { discard; }`)}
                   vec4 groundColor = tileColor;
                   tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`)}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a < ${E.float(Kr)}) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= ${E.float(w)};
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${o===Ct.Simplified||o===Ct.TerrainWithWater?E`fragColor = vec4(evaluatePBRSimplifiedLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:E`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${Te(_,E`vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
                   float waterNormalLength = length(overlayWaterMask);
                   if (waterNormalLength > 0.95) {
                     mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                     vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                     vec4 viewPosition = view*vec4(vpos, 1.0);
                     vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                     vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                     float opacity = sliced ? ${E.float(w)} : 1.0;
                     // un-gamma the ground color to mix in linear space
                     fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
                   }`)}
          ${Te(d,E`float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0));
                   if (perspectiveScale <= 0.25) {
                     fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
                   } else if (perspectiveScale <= 0.5) {
                     fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
                   } else if (perspectiveScale >= 0.99) {
                     fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
                   } else {
                     fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
                   }`)}
          ${Te(t.visualizeNormals,c?E`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);`:E`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);`)}
          ${Te(l,E`vec2 dVuv = fwidth(vuv0);
                 vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
                 float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
                 fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`)}
          fragColor = applySlice(fragColor, vpos);`)}break;case Y.Depth:v&&e.include(aO,t),i.main.add(E`
        ${Te(v,"setOverlayVTC(getUV0());")}
        gl_Position = transformPosition(proj, view, position);`),r.main.add(`${Te(v,`if (getCombinedOverlayColor().a < ${E.float(Kr)}) discard;`)}`);break;case Y.Shadow:case Y.ShadowHighlight:case Y.ShadowExcludeHighlight:case Y.ViewshedShadow:e.include(Jne,t),HX(e),Hne(e),i.main.add(E`gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);`),r.main.add(E`outputDepth(linearDepth);`);break;case Y.Normal:v&&e.include(aO,t),s.add("vnormal","vec3"),RB(i),f(),i.main.add(E`
        ${Te(v,"setOverlayVTC(getUV0());")}
        gl_Position = transformPosition(proj, view, position);
        vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);`),r.main.add(E`
        ${Te(v,`if (getCombinedOverlayColor().a < ${E.float(Kr)}) discard;`)}
        vec3 normal = normalize(vnormal);
        if (gl_FrontFacing == false) {
          normal = -normal;
        }
        fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);`);break;case Y.Highlight:g&&e.include(aO,t),i.main.add(E`
        ${Te(g,"setOverlayVTC(getUV0());")}
        gl_Position = transformPosition(proj, view, position);`),e.include(EL,t),r.main.add(E`
        ${Te(g,E`
           vec2 overlayHighlightTexel = getAllOverlayHighlightValuesEncoded();
           calculateOcclusionAndOutputHighlightOverlay(overlayHighlightTexel);`,"calculateOcclusionAndOutputHighlight();")}
      `)}if(n===Y.ObjectAndLayerIdColor)if(g)t.pbrMode=Ct.Disabled,e.include(aO,t),t.pbrMode=o,i.main.add(E`gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());`),r.main.add(E`fragColor = getOverlayColorTexel();`);else{const _=h===va.Opaque;i.main.add(E`${Te(_,"gl_Position = transformPosition(proj, view, position);")}`),r.main.add(E`fragColor = vec4(0.0);`)}return e}const V$t=qe(),Bve=$(),j$t=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:_ae,build:r4e},Symbol.toStringTag,{value:"Module"}));let G$t=class extends Hi{constructor(e,i){super(e,i,new Bi(j$t,()=>G(()=>Promise.resolve().then(()=>aHt),void 0)),s4e),this.type="TerrainTechnique",this.useStencil=!1}initializePipeline(e){return this._stencilPipelineState=this._createPipeline(e,!0),this._createPipeline(e,!1)}_createPipeline(e,i){const{renderOccluded:r,output:s}=e,n=e.backfaceCullingEnabled&&!r;return wi({blending:r?gM:null,culling:n?Nne:null,depthTest:r?null:{func:Ui.LESS},depthWrite:r?null:SL,colorWrite:Di,stencilTest:i?Dft(hh.IntegratedMeshMaskExcluded):null,drawBuffers:s===Y.Depth?{buffers:[Ga.NONE]}:null})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}};const s4e=new Map([[z.POSITION,0],[z.UV0,1],[z.NORMALCOMPRESSED,2]]);let H$t=class{constructor(){this.geometry=new x$t,this.intersectionData=null,this.geometryState=null,this._vao=null,this._texture=null,this._textureOpacity=1,this._textureRef=new e4e(()=>this._tile.surface.fadeDuration),this.overlay=new E$t,this._localOrigin=null,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._modifiedFlags=0}get tile(){return this._tile}get localOrigin(){return this._localOrigin}init(e,i){this.clear(),this._tile=e,this.geometry.reset(),this.intersectionData=null,this.geometryState=new T$t,this._localOrigin=i,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this.wireframeChanged||this.clippingAreaChanged||this.samplerDataChanged||this.numVerticesPerSideChanged||this.dirtyCorners||this.dirtyEdgeResolutions||this.dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),Kn&&this.tile.intersectsClippingArea)for(let i=0;i<4;++i)Ie(this.geometry.getEdgeCount(i)===this.geometryState.edgeResolutions[i]+1)}_calculateEdgeResolution(e,i){var l;const r=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){const c=r.surface.extent;if(c!=null&&(e===0&&r.extent[3]>c[3]||e===1&&r.extent[2]>c[2]||e===2&&r.extent[1]<c[1]||e===3&&r.extent[0]<c[0]))return s}const n=r.level,o=rf[e];if(!i)return Ie(((l=r.surface)==null?void 0:l.rootTiles)==null||r.surface.updatingRootTiles||!r.shouldHaveNeighbor(o)),s;if(i.loaded){const c=i,h=c.renderData.geometryState,d=n-c.level;if(Ie(d>=0),d===0){const g=h.numVerticesPerSide-1;return Math.max(g,s)}const f=2**d,m=h.edgeResolutions[(e+2)%4]/f;return Math.max(1,m)}Ie(!i.leaf);let a=s;return i.forAllSubtreeOnSide(gae(o),c=>c===r||(c.loaded?(a=Math.max(a,2**(c.level-n)),!0):(Ie(!c.leaf),!1))),a}updateNeighborData(){var o;const e=this.tile;if(!e.intersectsClippingArea)return;const i=e.renderData.geometryState,r=a=>(a.loaded||a.level===e.level)&&(a==null?void 0:a.intersectsClippingArea),s=i.edgePeerNeighbors,n=i.edgePeerNeighborSamplerVersions;for(let a=0;a<4;++a){const l=e.findNeighborTile(rf[a],r),c=wx(e,l),h=((o=c==null?void 0:c.renderData)==null?void 0:o.geometryState.samplerDataVersion)??-1,d=s[a],f=c!==wx(e,d),m=n[a]!==h;Kn&&l&&(Ie(e.level>=l.level),Ie(e.level-l.level<=In)),s[a]=l,(f||m)&&(n[a]=h,this._markEdgeDirty(a));const g=i.edgeResolutions[a],v=this._calculateEdgeResolution(a,l);Ie(u3(v)),Ie(v>=1),i.edgeResolutions[a]=v,g!==v&&this._markEdgeResolutionDirty(a)}for(let a=0;a<4;++a){const l=e.findNeighborTile(cV[a],r);i.cornerPeerNeighbors[a]=l;const c=wx(e,s[a]),h=wx(e,s[(a+1)%4]),d=wx(e,l);rp[a]=d,rp[(a+1)%4]=h,rp[(a+2)%4]=e,rp[(a+3)%4]=c,Ie(rp.some(v=>(v==null?void 0:v.loaded)||v===e));const f=rp.reduce((v,_)=>Math.min(v,(_==null?void 0:_.level)??1/0),1/0);rp.forEach((v,_)=>{v&&(v==null?void 0:v.level)>f&&(rp[_]=null)}),Ie(rp.some(v=>(v==null?void 0:v.loaded)||v===e));const m=i.cornerNeighborCornerTiles,g=i.cornerNeighborCornerTileSamplerVersions;for(let v=0;v<4;++v){const _=rp[v],b=(_==null?void 0:_.renderData.geometryState.samplerDataVersion)??-1,w=4*a+v,x=m[w]!==_,S=!x&&g[w]!==b;(x||S)&&(m[w]=_,g[w]=b,this._markCornerDirty(a))}Kn&&Ie(bae.some(v=>{var _;return((_=m[4*a+v])==null?void 0:_.loaded)||m[4*a+v]===e}))}Kn&&Ie(this.geometryState.edgeResolutions.every(a=>a>0));for(let a=0;a<4;++a)rp[a]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;Kn&&Ie(!this.tile.intersectsClippingArea||this.geometryState.edgeResolutions.every(m=>m>0)),this.intersectionData=null;const{tile:i,_vao:r,geometry:s,geometryState:n}=this,o=!r||this.wireframeChanged||this.samplerDataChanged||this.clippingAreaChanged||this.numVerticesPerSideChanged,a=this.dirtyEdgeResolutions!==0,l=n.edgeResolutions.reduce((m,g)=>m+g+1,0),c=o||a&&l>((s==null?void 0:s.maxEdgeVertexCount)??0),h=!c&&a,d=!h&&(this.dirtyEdges!==0||a),f=!d&&this.dirtyCorners!==0;c?(this.releaseGeometry(),this._createGeometry(e)):h?i.updateEdgeElevationsAndResolutions():d||f?i.updateEdgeElevations():f?i.updateCornerElevations():console.warn("Update for no reason?"),this._modifiedFlags=0}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao=Dt(this._vao),this.geometry.release(),!0)}ensureTexture(e,i,r,s){const n=i?Tt.RGBA:Tt.RGB;return this._texture!=null&&(r===Rs.FADING&&this._tile.surface.fadeDuration>0&&this._isTextureVisible(this._texture)||this._texture.descriptor.width!==e||this._texture.descriptor.pixelFormat!==n)&&this.releaseTexture(),this._texture==null&&(this._texture=s(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture!=null&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}reuseTexture(e,i){return!(!e||!this._texture)&&(e.setTextureReference(new uV(this._texture,Rs.FADING,i,this._textureOpacity,0,1)),!0)}get numVerticesPerSideChanged(){return!!(this._modifiedFlags&W$t)}get samplerDataChanged(){return!!(this._modifiedFlags&Z$t)}get clippingAreaChanged(){return!!(this._modifiedFlags&Y$t)}get wireframeChanged(){return!!(this._modifiedFlags&J$t)}get dirtyEdges(){return this._modifiedFlags>>B9&15}get dirtyCorners(){return this._modifiedFlags>>V9&15}get dirtyEdgeResolutions(){return this._modifiedFlags>>j9&15}_markCornerDirty(e){const i=1<<e<<V9;this._modifiedFlags|=i}_markEdgeDirty(e){const i=1<<e<<B9;this._modifiedFlags|=i,this._markCornerDirty((e+0)%4),this._markCornerDirty((e+3)%4)}_markEdgeResolutionDirty(e){const i=1<<e<<j9;this._modifiedFlags|=i,this._markEdgeDirty(e)}_markAllEdgesAndCornersDirty(){this._modifiedFlags|=15<<V9|15<<B9|15<<j9}updateGeometryState(){const e=this._elevationInfo,i=this.tile,r=e.samplerData?i.getElevationVerticesPerSide(e.maxTileLevel):i.minimumVerticesPerSide,s=Math.max(r,5);let n=i.clippingArea;i.intersectsClippingArea&&!i.withinClippingArea||(n=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==s&&(this._modifiedFlags|=1,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),e.changed&&(this._modifiedFlags|=2,o.samplerData=e.samplerData,o.samplerDataVersion++,a=!0),eg(o.clippingArea,n)||(this._modifiedFlags=4,o.clippingArea=n,a=!0);const l=i.surface.wireframe;return o.wireframe!==l&&(this._modifiedFlags=8,o.wireframe=l,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const i=this.geometry.vertexAttributes,r=this.geometry.indices,s=e.gl;this._vao=new Tg(e,s4e,new Map([["geometry",Jv(i.layout)]]),new Map([["geometry",jn.createVertex(e,s.STATIC_DRAW,i.buffer)]]),jn.createIndex(e,s.STATIC_DRAW,r)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,i=Ab.Immediate){(e==null?void 0:e.texture)===this._texture?this._textureOpacity=e.opacities[0]:this.releaseTexture(),this._textureRef.push(e,i)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_isTextureVisible(e){var i,r;return((i=this._textureRef.current)==null?void 0:i.texture)===e||((r=this._textureRef.next)==null?void 0:r.texture)===e&&this._textureRef.fadeFactor<1}get _elevationInfo(){var h;const e=this.geometryState.samplerData,i=this.tile.layerInfo[kt.ELEVATION],r=i.length,s=new Array(r);let n=0,o=0,a=!1;for(let d=0;d<r;d++){const f=i[d],m=(h=f.upsampleInfo)==null?void 0:h.tile;if(m){const g=m.layerInfo[kt.ELEVATION][d].data,v=g&&g.samplerData;e&&e[n]===v||(a=!0),s[n++]=v,o=Math.max(o,m.lij[0])}else if(f.data){const g=this.tile.surface.layerViewByIndex(d,kt.ELEVATION);if(oS(this.tile,g)){const v=f.data;e&&e[n]===v.samplerData||(a=!0),s[n++]=v.samplerData,o=this.tile.level}}}e!=null&&e.length!==n&&(a=!0);const l=n>0,c=l?s:null;return l&&(s.length=n),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){var i,r,s;const e=((i=this.intersectionData)==null?void 0:i.estimatedMemoryUsage)??0;return(((r=this.geometry.indices)==null?void 0:r.byteLength)??0)+(((s=this.geometry.vertexAttributes)==null?void 0:s.byteLength)??0)+e}get texture(){return this._texture}get test(){}checkGeometryWaterproofness(){if(!Kn)return;const e=this.tile;if(!e.loaded||!e.intersectsClippingArea||e.level===0)return void Ie(e==null?void 0:e.loaded);const i=e.surface.extent;if(i!=null&&!e.intersectsExtent(i))return;const r=rf.map((a,l)=>i!=null&&(l<2?-1:1)*(e.extent[3-l]-i[3-l])<0),s=e.level;Ie(this.dirtyCorners===0),Ie(this.dirtyEdges===0),Ie(this.dirtyEdgeResolutions===0),Ie(!this.numVerticesPerSideChanged),Ie(!this.samplerDataChanged),Ie(!this.clippingAreaChanged),Ie(!this.wireframeChanged);const n=cV.map(a=>e.findNeighborCornerTileExact(a,l=>!l.intersectsClippingArea||l.loaded||l.level===e.level)??null).map(a=>a!=null&&a.intersectsClippingArea?a:null),o=this.geometryState;for(let a=0;a<4;++a){const l=o.cornerPeerNeighbors[a],c=n[a];Ie(c===l,`Tile[${e.lij}].corner[${a}] out of date: cur=[${l==null?void 0:l.lij}] exp=[${c==null?void 0:c.lij}]`)}rf.forEach((a,l)=>{if(r[l])return;const c=e.findNeighborTile(a,de=>(de.level===s||(de==null?void 0:de.loaded))&&(de==null?void 0:de.intersectsClippingArea));if(!c){const de=!e.surface.updatingRootTiles&&e.surface.rootTiles!=null&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(a);return void Ie(!de)}Ie(c.loaded||c.level===e.level),Ie(c===this.geometryState.edgePeerNeighbors[l]);const h=s-c.level;if(!c.loaded)return Ie(!c.leaf),void Ie(h===0);const d=c.renderData;Ie(e.isEdgeNeighbor(c,a)),Ie(h>=0);const f=2**h;if(h<0)return void Ie(!1);const m=e.renderData,g=m.geometry,v=m.localOrigin,_=g.getEdgeCount(l),b=g.numVerticesPerSide-1,w=d.geometry;if(!w)return void Ie(!1);const x=d.localOrigin,S=this.geometryState.edgePeerNeighbors[l];if(S!=null&&S.loaded){const de=S.renderData;Ie(m.geometryState.edgePeerNeighborSamplerVersions[l]===de.geometryState.samplerDataVersion),Ie(this.geometryState.edgePeerNeighborSamplerVersions[l]===de.geometryState.samplerDataVersion)}const C=(l+2)%4,T=w.getEdgeCount(C),M=_-1,I=T-1;Ie(M*f===I,`Tile[${e.lij}]:e${l},res=${M} edgeRes mismatch with Neighbor[${c.lij}]:e${C},res=${I} (expected:${M*f})`);const D=e.extent,P=a===nt.NORTH||a===nt.SOUTH,F=T-1,L=F>>h,N=_-1;if(L<1)return void Ie(N===1);Ie(L===N),Ie(u3(L));const R=w.numVerticesPerSide-1;Ie(h>0||L===Math.max(R,b));const k=e.getNeighborEdgeStartVertexIndex(l,c);Ie(0<=k&&k<f);const W=k*L;Ie(0<=W&&W<=F-L);let j=0,B=W;g.getEdgeVertexPosition(l,Vf,v,0),g.getEdgeVertexPosition(l,jf,v,_-1);const te=Sr(Vf,jf),le=Math.max(q$t,1e-4*te);for(let de=0;de<=L;++de){g.getEdgeVertexPosition(l,Vf,v,j),w.getEdgeVertexPosition(C,jf,x,B);const Ae=de/L,We=P?D[0]+Ae*(D[2]-D[0]):a===nt.WEST?D[0]:D[2],Ue=P?a===nt.SOUTH?D[1]:D[3]:D[1]+Ae*(D[3]-D[1]),it=e.surface.extent;if(it==null||Yj(it,We,Ue)){const Et=Ba(Vf,jf),Jt=ja(Vf)-Ci.radius,wt=ja(jf)-Ci.radius,vt=Et<le;if(!vt){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${l}[${j}/${_}] and [${c.lij}].edge${C}[${B}/${T}]`),it!=null&&console.warn("  surface extent= ",it," x,y=",We,",",Ue);const zt=$();be(zt,m.localOrigin,d.localOrigin),ja(zt)>0&&console.warn(`   localOrigins: ${m.localOrigin} vs ${d.localOrigin} d=${ja(zt)} [${zt}]`),(()=>{const me=os(Vf),ye=os(jf);e.updateEdgeElevations(),c.updateEdgeElevations(),g.getEdgeVertexPosition(l,Vf,v,j),w.getEdgeVertexPosition(C,jf,x,B);const we=$();Fi(we,Vf,me),ja(we)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${me} vs ${Vf} d=${ja(we)} [${we}]`),Fi(we,jf,ye),ja(we)>0&&console.warn(`  XXX Neighbor[${c.lij}] edge out of date: ${ye} vs ${jf} d=${ja(we)} [${we}]`)})();const ut=g.getEdgeCount(l),_t=w.getEdgeCount(T);Ie(vt,`Mismatch in tile [${e.lij}].edge[${l}][${j}/${ut}] vs neighbor [${c.lij}].edge[${C}][${B}/${_t}] ${jg(Vf)} vs ${jg(jf)}  dist=${Et} h(t|n|d)=${Jt}|${wt}|${wt-Jt}`)}g.getEdgeNormal(l,dE,j),w.getEdgeNormal(C,pE,B),ae(Vve,dE),ae(jve,pE);const Ft=fe(Vve,jve),xt=1-Ft<.01||!1||e===c;if(!xt){const zt=$();Fi(zt,dE,pE);const ut=()=>`Mismatch in tile edge normal ${Cve(e.lij)} (${j}/${_-1}) edge ${l} vs neighbor ${Cve(c.lij)}  (${B}/${T-1}) nedge ${C} :${jg(dE)} vs ${jg(pE)}  dot = ${Ft} : ${jg(zt)}`;console.warn("Mismatch in tile edge normal: ",ut());{e.updateEdgeElevations(),c.updateEdgeElevations();const _t=$(),me=$();g.getEdgeNormal(l,_t,j),w.getEdgeNormal(C,me,B),aA(dE,_t)||console.warn("Missing update in tile normal: ",jg(dE)," => ",jg(_t)),aA(pE,me)||console.warn("Missing update in neighbor normal: ",jg(pE)," => ",jg(me))}Ie(xt,ut())}}j+=1,B+=1}})}};const Vf=$(),jf=$(),dE=$(),pE=$(),Vve=$(),jve=$(),q$t=1,rp=[null,null,null,null];function wx(t,e){return e!=null&&e.loaded||e===t?e:null}const W$t=1,Z$t=2,Y$t=4,J$t=8,B9=4,V9=8,j9=12,bae=[0,1,2,3];let wae=class{get updating(){return!!this._tileRequested}init(e,i,r,s){this.tile=e,this._layerIdx=i,this._layerClass=r,this._suspended=s,this._tileLayerInfo=e.getLayerInfo(i,r),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e,i){this._setUpsampleTile(e,i),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,Rs.FADING,i):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return e!=null?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){var b;const e=this._layerIdx,i=this._layerClass,r=this.tile.surface.layerViewByIndex(e,i),{minLevel:s,maxLevel:n}=r.dataLevelRange,o=this._desiredMinLevelDelta,a=this._progressiveLevelModulo+o,l=this._scaleRangeEnabled?oS:()=>!0;let c=this.tile;const h=c.level;let d;const f=this._tileLayerInfo.upsampleInfo,m=((b=f==null?void 0:f.tile)==null?void 0:b.level)??-1,g=f!=null&&m-h>=o,v=A$t(r),_=r.type==="vector-tile-3d"?r.schemaHelper:null;for(;c&&l(c,r)&&c.level>=s;){const w=c.level,x=h-w,S=c.layerInfo[i][e];if(S.data&&x>=o){(!g||w>m)&&this._setUpsampleTile(c),S.dataInvalidated&&(d=c);break}const C=(_==null?void 0:_.getLevelRowColumn(c.lij))??c.lij;if((v==null?void 0:v.getAvailability(C[0],C[1],C[2]))!=="unavailable"&&w<=n&&!S.data&&!S.dataMissing&&((!d||c.level===s||w%ONe==0||h-d.level<o)&&(d=c),x>=a))break;c=c.parent}if(d!=null&&h-d.level<o)if(f)d=null;else{const w=this._findAncestorWithData();w!=null&&(this._setUpsampleTile(w),d=w.layerInfo[i][e].dataInvalidated?w:null)}return d}_findAncestorWithData(){const e=this.tile.elevationLevel,i=this._desiredMinLevelDelta;let r;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(e-s.level>=i)return s;r=s}return r}_setUpsampleTile(e,i){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,Rs.FADING,i)}get test(){}},X$t=class extends wae{constructor(){super(...arguments),this.type="none"}get _desiredMinLevelDelta(){throw Gve}get _progressiveLevelModulo(){throw Gve}dispose(){}};const Gve=new Error("Abstract method called on TileAgent"),Sc=new X$t;let K$t=class extends wae{constructor(){super(...arguments),this.type="elevation",this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return this.tile.elevationLevelDelta-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}};function Q$t(t){return t.type==="elevation"}let eAt=class extends wae{constructor(){super(),this.type="map",this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return ONe}};function tAt(t){return t.type==="map"}var Ha;(function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"})(Ha||(Ha={}));let rz=class{constructor(){this.waitingAgents=new ii,this.pendingUpdates=0}static acquire(e){const i=G9.acquire();return i._init(e),i}release(){this.dispose(),sz.delete(this),G9.release(this)}dispose(){this.loadingAgent=Dt(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=u$(this._data)}static prune(){G9.prune(0)}_init(e){this.waitingAgents.clear(),this._data=u$(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=fc(this.requestAbort),this.requestPromise=null}_unsetUpsampleInfo(){var e;this.upsampleInfo&&((e=this.upsampleInfo.tile)==null||e.unrefMapData(),this._pool.release(this.upsampleInfo),this.upsampleInfo=null)}setUpsampleInfo(e,i){var r;if(e!==i&&i!=null){if(this.upsampleInfo==null)this.upsampleInfo=this._pool.acquire();else{if(this.upsampleInfo.tile===i)return;(r=this.upsampleInfo.tile)==null||r.unrefMapData()}i.refMapData(),L$t(e,i,this.upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){u$(this._data),this._data=e}};const G9=new Ol(rz,null,()=>{}),sz=new Map;function iAt(){sz.size>0&&(console.log(`${sz.size} live TilePerLayerInfo allocations:`),sz.forEach(t=>console.log(t,`
`)))}var st;(function(t){t[t.NONE=0]="NONE",t[t.SPLIT=1]="SPLIT",t[t.ELEVATION=2]="ELEVATION",t[t.MERGE=4]="MERGE",t[t.GEOMETRY=8]="GEOMETRY",t[t.TEXTURE_NOFADING=16]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=32]="TEXTURE_FADING"})(st||(st={}));const rAt=.1;let xae=class{constructor(){this._lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=si(),this._elevationBoundsMin=NaN,this._elevationBoundsMax=0,this.layerInfo=[[],[]],this.extentInRadians=si(),this.centerAtSeaLevel=$(),this._center=[$(),Ls(),$()],this.up=nre(),this._withinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=0,this._rasterTileMemory=0,this._vectorTileMemory=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=$(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0}get lij(){return this._lij}get elevationLevelDelta(){return this._surface.getElevationLevelDelta(this.level)}static prune(){Sae.prune(0),Tae.prune(0),rz.prune()}get _cached(){return!this.leaf&&this._mapDataRefCount<=0}get withinClippingArea(){return this._withinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBoundsMin(){return this._elevationBoundsMin}get elevationBoundsMax(){return this._elevationBoundsMax}get level(){return this._lij[0]}get key(){return`${this._lij[0]}/${this._lij[1]}/${this._lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[nn.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const e=this.parent,i=(e==null?void 0:e.frustumVisibility)??Ha.INTERSECTS;this._frustumVisibility=i===Ha.INSIDE?Ha.INSIDE:i===Ha.OUTSIDE?Ha.OUTSIDE:this._calculateFrustumVisibility(this.surface.frustum);const r=this._frustumVisibility!==Ha.OUTSIDE&&this._intersectsClippingArea;r!==this._visible&&(this._visible=r,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get _loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}init(e,i,r,s,n){this._lij[0]=e,this._lij[1]=i,this._lij[2]=r,this.ellipsoid=yr(n.tilingScheme.spatialReference),n.tilingScheme.getExtent(e,i,r,this.extent),n.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._withinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,n.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[nn.MIDDLE][3]=0,this.elevationLevel=e,s&&!Number.isNaN(s.elevationBoundsMin)?(this._elevationBoundsMin=s.elevationBoundsMin,this._elevationBoundsMax=s.elevationBoundsMax):(this._elevationBoundsMin=0,this._elevationBoundsMax=0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=s,this.clearChildren(),this._surface=n,this.updateVisibility(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0;for(const o of d2){const a=n.numLayers(o),l=this.layerInfo[o];for(const c of l)c.release();l.length=a;for(let c=0;c<a;c++)l[c]=rz.acquire(this._surface.upsampleInfoPool),o===kt.ELEVATION&&this.findElevationBoundsForLayer(c,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(n.tilingScheme.pixelSize,YI)}dispose(){this._surface!=null&&(fo(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key),this.layerInfo.forEach(e=>{e.forEach(i=>i.release()),e.length=0}),this._surface=this._parent=null,this.clearChildren(),this.setMemoryDirty())}refMapData(){++this._mapDataRefCount,this._cached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){--this._mapDataRefCount,this._cached&&this.cachedMemory>0&&this._surface.upsampleMapCache.put(this.key,this)}setMemoryDirty(){this._usedMemory=0}get usedMemory(){return this._ensureUsedMemory()+(this._cached?0:this._mapTileMemory)}get cachedMemory(){return this._ensureUsedMemory(),this._surface==null?this.usedMemory:this._cached?this._mapTileMemory:0}get _mapTileMemory(){return this._rasterTileMemory+this._vectorTileMemory}get _cpuImageMemorySize(){const i=this._surface.tilingScheme.pixelSize;return i*i*4}_ensureUsedMemory(){var e;if(this._usedMemory>0)return this._vectorTileMemory=this.layerInfo[kt.MAP].reduce((i,{data:r})=>i+(p2(r)?r.usedMemoryPerReference:0),0),this._usedMemory;this._usedMemory=this._baseUsedMemory,this._rasterTileMemory=0,this._vectorTileMemory=0;for(const{data:i}of this.layerInfo[kt.MAP])p2(i)?this._vectorTileMemory+=i.usedMemoryPerReference:this._rasterTileMemory+=this.getTerrainDataMemory(i);for(const i of this.layerInfo[kt.ELEVATION])this._usedMemory+=i.data?this._cpuImageMemorySize:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._rasterTileMemory+=((e=this.renderData.texture)==null?void 0:e.cachedMemory)??0),this._cached&&this._surface.upsampleMapCache.updateSize(this.key,this),this._usedMemory}getUsedMemoryForLayer(e,i){const r=this.layerInfo[e][i];return r!=null&&r.data?e===kt.MAP?this._cached?0:this.getTerrainDataMemory(r.data):e===kt.ELEVATION?this._cpuImageMemorySize:0:0}getTerrainDataMemory(e){return zke(e)?e.texture.usedMemory:kke(e)?e.memoryUsage:p2(e)?e.usedMemoryPerReference:G6(e)||e instanceof HTMLImageElement?this._cpuImageMemorySize:0}updateScreenDepth(e){const i=this._center[nn.MIDDLE],r=e,s=i[0],n=i[1],o=i[2],a=r[2]*s+r[6]*n+r[10]*o+r[14];this.screenDepth=a<0?0:a/(r[3]*s+r[7]*n+r[11]*o+r[15])}shouldSplit(e,i,r){if(!this.visible||e.frustum&&(!this._intersectsClippingArea||this._calculateFrustumVisibility(e.frustum)===Ha.OUTSIDE))return st.NONE;const s=this.level;be(_k,this._center[nn.MIDDLE],i);let n=Xo(_k),o=_k,a=this._center[nn.MIDDLE];be(H9,this._center[nn.TOP],i);const l=Xo(H9);l<n&&(n=l,o=H9,a=this._center[nn.TOP]),be(q9,this._center[nn.BOTTOM],i);const c=Xo(q9);if(c<n&&(n=c,o=q9,a=this._center[nn.BOTTOM]),this._edgeLen2>n&&s<e.maxLod)return st.SPLIT;const h=Math.sqrt(n),d=e.fovX*h*2,f=this._edgeLen/d,m=()=>{if(s<e.maxLod)return this.elevationLevel=s,st.NONE;const M=s+Math.ceil(-Math.log2(e.relativeWidthLimit/f));return M!==this.elevationLevel?(this.elevationLevel=M,st.ELEVATION):st.NONE},g=r!=null?r-s:1/0;if(g<=.5)return m();const v=fe(this.up,_k),_=this._elevationBoundsMax-this._elevationBoundsMin,b=_/this.edgeLen;if(e.aboveGround&&v>0&&b<.001&&v/h-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-b>0)return st.NONE;const w=r!=null?3-Math.min(g,2):1;if(f*w<e.relativeWidthLimit||s>=e.maxLod)return m();if(s<7)return st.SPLIT;re(No,this.up,v),be(No,No,o);const x=Xo(No);if(x<=this.radius*this.radius)return st.SPLIT;re(No,No,this.radius/Math.sqrt(x)),oe(No,No,a),be(No,i,No);const S=Math.min(1,(Math.abs(fe(No,this.up))+.5*_+this._curvatureHeight)/Ee(No)),C=rAt/e.angledSplitBias,T=e.fovY*h*2;return S*(this._edgeLen/T*w)<C*e.relativeHeightLimit?st.NONE:st.SPLIT}createChildren(){const e=this._children,i=this.lij[0]+1,r=2*this.lij[1],s=2*this.lij[2];return e[0]=this.surface.createTile(i,r,s,this),e[1]=this.surface.createTile(i,r,s+1,this),e[2]=this.surface.createTile(i,r+1,s,this),e[3]=this.surface.createTile(i,r+1,s+1,this),e}clearChildren(){this._children[0]=this._children[1]=this._children[2]=this._children[3]=null}get loaded(){var e;return((e=this.renderData)==null?void 0:e.hasGeometry)??!1}load(){this.refMapData();for(const e of d2)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(){this.renderData&&this.unrefMapData(),this.surface.renderer.unloadTile(this);for(const e of d2){const i=this.layerInfo[e];for(const r of i)r.loadingAgent&&r.loadingAgent!==Sc&&(vk(r.loadingAgent),r.loadingAgent=null),r.pendingUpdates=0}this.resetPendingUpdate(st.GEOMETRY),this.resetPendingUpdate(st.TEXTURE_NOFADING),this.resetPendingUpdate(st.TEXTURE_FADING)}unloadMapData(){const e=this.layerInfo[kt.MAP];for(const i of e)i.loadingAgent&&i.loadingAgent!==Sc&&(vk(i.loadingAgent),i.loadingAgent=null),i.pendingUpdates=0,i.invalidateSourceData();this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(Hx(e,this._clippingArea))return!1;const i=this._intersectsClippingArea,r=this._withinClippingArea;e!=null?(this._intersectsClippingArea=this.intersectsExtent(e),this._withinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._withinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const s=r&&this._withinClippingArea,n=!(r||i||this._withinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(st.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,i){return this.layerInfo[i][e]}hasLayerData(e,i){const r=this.layerInfo[i][e];return!(!(r!=null&&r.data)||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of d2){const i=this.layerInfo[e];for(const r of i)if(r.loadingAgent&&r.loadingAgent!==Sc&&r.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(st.SPLIT)||e!==kt.ELEVATION&&!this._loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){const i=this._pendingUpdates;return this._pendingUpdates|=e,e===st.SPLIT||e===st.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate(),i!==this._pendingUpdates}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,i,r){const s=this.layerInfo[i][e];if(s.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),r.tile.lij.toString(),i,e),!0;if(s.waitingAgents.push(r),s.data&&!s.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),r.tile.lij.toString(),i,e);const a=p2(s.data);return r.dataArrived(this,a),!0}if(s.requestPromise)return!0;fc(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,e,i,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get leaf(){return this._children[0]==null}hasLij(e){return this._lij[0]===e[0]&&this._lij[1]===e[1]&&this._lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const i=this._children;return i[0]?i[0].findByLij(e)||i[1].findByLij(e)||i[2].findByLij(e)||i[3].findByLij(e):null}distanceToSquared(e){return Xo(be(No,this._center[nn.MIDDLE],e))}containsPoint(e){const i=this.extent;return e[0]>=i[0]&&e[1]>=i[1]&&e[0]<=i[2]&&e[1]<=i[3]}containsPointXY(e,i){const r=this.extent;return e>=r[0]&&i>=r[1]&&e<=r[2]&&i<=r[3]}unrequestLayerData(e,i,r){const s=this.layerInfo[i][e],n=s.waitingAgents,o=n.removeUnordered(r)!=null;fo(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(e,i,r){const s=p2(r),n=this.layerInfo[i][e];n.data=r,n.dataInvalidated=!1,n.waitingAgents.forAll(o=>o.dataArrived(this,s)),n.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,i){const r=this.layerInfo[i][e];r.dataMissing=!0,r.waitingAgents.forAll(s=>s.dataMissing()),r.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,i,r){switch(r&&this.forEachLoadedNeighbor(s=>s.updateRenderData(e,i)),e){case kt.MAP:return this._updateTexture(i);case kt.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===Rs.FADING?st.TEXTURE_NOFADING:st.TEXTURE_FADING),this.setPendingUpdate(e===Rs.FADING?st.TEXTURE_FADING:st.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(st.GEOMETRY);for(const e of this.layerInfo[kt.ELEVATION])e.pendingUpdates|=st.GEOMETRY}invalidateLayerData(e,i){this.layerInfo[i][e].invalidateSourceData(),this.restartAgents(i)}computeElevationBounds(){const e=this._elevationBoundsMin,i=this._elevationBoundsMax;let r=1/0,s=-1/0;const n=this.layerInfo[kt.ELEVATION];let o=!0;for(const a of n)a.elevationBounds!=null&&(r=Math.min(r,a.elevationBounds.min),s=Math.max(s,a.elevationBounds.max),a.elevationBounds.hasNoDataValues||(o=!1));o&&(r=Math.min(r,0),s=Math.max(s,0)),e===r&&i===s||(this._elevationBoundsMin=r,this._elevationBoundsMax=s,this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBoundsMin,i=this._elevationBoundsMax,r=.5*(e+i),s=this._center;re(No,this.up,r),oe(s[nn.MIDDLE],this.centerAtSeaLevel,No),re(No,this.up,e),oe(s[nn.TOP],this.centerAtSeaLevel,No),re(No,this.up,i),oe(s[nn.BOTTOM],this.centerAtSeaLevel,No)}findElevationBoundsForLayer(e,i){const r=this.layerInfo[kt.ELEVATION][e],s=this.elevationLevelDelta,n=Math.max(this.elevationLevel-s,0),o=r.elevationBounds;if(o!=null&&o.level>=i&&o.level<=n)return;const a=this._surface.layerViewByIndex(e,kt.ELEVATION);if(!oS(this,a))return;const l=nAt;let c=!1;const h=r.data;if(h&&h.level<=n){const d=r.data;l.min=d.samplerData.data.minValue,l.max=d.samplerData.data.maxValue,l.hasNoDataValues=d.samplerData.data.hasNoDataValues,l.level=this.level,c=!0}else{let d,f,m=0;for(let g=this._parent;g&&(!f||m<s)&&(m=this.elevationLevel-g.level,d=f||d,f=g.layerInfo[kt.ELEVATION][e].data,!(!f&&d&&g.level<=n));g=g.parent);f=f||d,f&&(f.computeMinMaxValue(this._lij[0],this._lij[1],this._lij[2],l),l.min!==1/0&&(l.level=f.level,c=!0))}c&&(r.elevationBounds==null&&(r.elevationBounds=new CC),r.elevationBounds.copyFrom(l))}modifyLayers(e,i,r){const s=this.layerInfo[r];for(const a of s)a.loadingAgent&&a.loadingAgent!==Sc&&(vk(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)e[a]===void 0&&s[a].release();const n=new Array(...s),o=i.length;s.length=o;for(let a=0;a<o;a++){const l=i[a];s[a]=l>-1?n[l]:rz.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,Rs.FADING))}updateAgents(e){if(this.renderData){const i=this.layerInfo[e];for(const r of i)r.loadingAgent===Sc&&(r.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of d2){const i=this._isSuspended(e);for(const r of this.layerInfo[e])r.loadingAgent&&r.loadingAgent!==Sc&&(r.loadingAgent.setSuspension(i),r.loadingAgent===Sc&&this.updateRenderData(e,Rs.FADING))}}removeLayerAgent(e,i){const r=this.layerInfo[i][e];r.loadingAgent&&r.loadingAgent!==Sc&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(e,i){const r=this.layerInfo[i][e];r.loadingAgent=Sc,r.data||r.upsampleInfo!=null||this._createOrUpdateAgents(e+1,i)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||J$(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,i,r){var s,n,o;for(let a=e;a<i;++a){const l=this._surface.layerViewByIndex(a,r);if(lD(l)&&((s=l==null?void 0:l.layer)==null?void 0:s.blendMode)!=="normal"||J$((n=l==null?void 0:l.layer)==null?void 0:n.parent)&&this._hasBlendableAncestor((o=l==null?void 0:l.layer)==null?void 0:o.parent))return!0}return!1}_createOrUpdateAgents(e,i){const r=this.layerInfo[i];if(r.length===0)return;const s=this._isSuspended(i);for(let n=e;n<r.length;++n){const o=r[n],a=this._surface.layerViewByIndex(n,i);let l=!1;if(o.loadingAgent?oS(this,a)?(o.loadingAgent!==Sc&&o.loadingAgent.setSuspension(s),o.loadingAgent!==Sc&&(l=o.loadingAgent.update())):o.dispose():oS(this,a)&&(o.loadingAgent=sAt(this,n,i,s),l=o.loadingAgent.startLoading(),l?o.loadingAgent===Sc&&this.setPendingUpdate(st.GEOMETRY):(vk(o.loadingAgent),o.loadingAgent=Sc)),o.loadingAgent===Sc&&this.updateRenderData(i,Rs.FADING),!this._hasBlendModes(e,r.length,i)&&l&&a.isOpaque)return}}_isWithinExtent(e){const i=this.extent;return i[0]>=e[0]&&e[2]>=i[2]&&i[1]>=e[1]&&e[3]>=i[3]}intersectsExtent(e){const i=this.extent;return i[2]>=e[0]&&e[2]>=i[0]&&i[3]>=e[1]&&e[3]>=i[1]}getElevationVerticesPerSide(e){const i=this.elevationLevel-this.level,r=Math.max(this.level-e,this.elevationLevelDelta-i),s=ue(1+(this._maxTesselation>>r),2,this._maxTesselation+1),n=this.minimumVerticesPerSide;return Math.max(s,n)}_findLIJ(e,i){if(!e)return null;const r=this.surface.rootTiles;if(r!=null){for(const s of r)if(oAt(s,e)){let n=s,o=e[0]-n.level-1;for(;o>=0&&!n.leaf&&!i(n);){const a=e[1]>>o&1,l=e[2]>>o&1;n=n.children[2*a+l],o--}return i(n)?n:null}}return null}findNeighborTile(e,i){const r=this._lij,s=this._getNeighborLIJ(r,e);return s?nz(r,s)?i(this)?this:null:this._findLIJ(s,i):null}findCorner(e,i){const r=e===nt.NORTH_EAST?1:e===nt.NORTH_WEST?0:e===nt.SOUTH_WEST?2:3;let s=this;for(;s.children[0]&&(!i||!i(s));)s=s.children[r];return s}findNeighborCornerTileExact(e,i){var r;return((r=this.findNeighborTile(e,s=>i(s)||s.level===this.level))==null?void 0:r.findCorner(lV(e),i))||null}forAllSubtreeOnSide(e,i){const r=e===nt.NORTH?[0,1]:e===nt.NORTH_EAST?[1]:e===nt.EAST?[1,3]:e===nt.SOUTH_EAST?[3]:e===nt.SOUTH?[2,3]:e===nt.SOUTH_WEST?[2]:e===nt.WEST?[0,2]:[0],s=n=>{const o=n.children;!i(n)&&o[0]&&r.forEach(a=>s(o[a]))};s(this)}getNeighborEdgeStartVertexIndex(e,i){if(!i)return 0;const r=this.level-i.level;if(Ie(!Kn||r>=0),r===0)return 0;const s=2**r,n=!(1&~e),o=n?0:1,a=i.lij[o+1]*s,l=this._lij[o+1],c=l-a,h=n?s-1-c:c;return Kn&&(Ie(a<=l&&l<a+s),Ie(0<=h&&h<s)),h}forEachLoadedNeighbor(e){const i=this.level,r=s=>s.level===i||s.loaded;rf.forEach(s=>{const n=this.findNeighborTile(s,r);n!=null&&n!==this&&n.forAllSubtreeOnSide(gae(s),o=>!!o.loaded&&(e(o,s),!0))}),cV.forEach(s=>{var o;const n=(o=this.findNeighborTile(s,r))==null?void 0:o.findCorner(lV(s),a=>a.loaded);Ie(!n||eQ(this,n,s)),n!=null&&n.loaded&&e(n,s)})}_getNeighborLIJ(e,i){const r=Ove(i)?-1:Mve(i)?1:0,s=$ve(i)?-1:Ave(i)?1:0,n=[e[0],e[1]+r,e[2]+s];return n[1]<0?null:this.surface.isGlobal?this._wrapLIJ(n):n[2]<0?null:n}_wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}isEdgeNeighbor(e,i){if(e==null)return!1;if(this.level===0&&e.level===0&&(this._eastEnd&&e._westEnd&&i===nt.EAST||this._westEnd&&e._eastEnd&&i===nt.WEST))return!0;const r=Math.max(1e-6*(this.extent[2]-this.extent[0]),1);switch(i){case nt.NORTH:return hd(this.extent[3],e.extent[1],r);case nt.SOUTH:return hd(this.extent[1],e.extent[3],r);case nt.EAST:return hd(this.extent[2],e.extent[0],r)||hd(this.extent[2],-e.extent[0],r);case nt.WEST:return hd(this.extent[0],e.extent[2],r)||hd(this.extent[0],-e.extent[2],r)}}get _eastEnd(){return this._lij[2]===this.surface.lijEastEnd(this.level)-1}get _westEnd(){return this._lij[2]===0}checkGeometryWaterproofness(){var e;oV&&(Ie(this.loaded),(e=this.renderData)==null||e.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const i=this.extent,r=this.surface.rootTilesExtent,s=.25*(i[2]-i[0]);if(Ove(e)&&i[3]+s>=r[3]||Mve(e)&&i[1]-s<=r[1])return!1;const n=this.surface.isGlobal;return!(!n&&$ve(e)&&i[0]-s<=r[0])&&!(!n&&Ave(e)&&i[2]+s>=r[2])}updateDistanceToPOI(e){const i=this._lastPOI;if(this.distanceToPOI>=0&&i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2])return;ne(this._lastPOI,e);const r=this._center[nn.MIDDLE],s=e[0]-r[0],n=e[1]-r[1],o=e[2]-r[2];this.distanceToPOI=s*s+n*n+o*o}};function sAt(t,e,i,r){const s=i===kt.ELEVATION?Tae.acquire():Sae.acquire();return s.init(t,e,i,r),s}function vk(t){t.dispose(),Q$t(t)?Tae.release(t):tAt(t)&&Sae.release(t)}const Sae=new Ol(eAt),Tae=new Ol(K$t),nAt=new CC;var nn;function oAt(t,e){const i=t.lij,r=e[0]-i[0];return!(r<0)&&e[1]>>r===i[1]&&e[2]>>r===i[2]}function nz(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function eQ(t,e,i){return t!=null&&e!=null&&e!==t&&(t.level>=e.level?Hve(t,e,i):Hve(e,t,lV(i)))}function Hve(t,e,i){Ie(t.level>=e.level);const r=i$t(i),s=r$t(i),n=t.extent,o=e.extent,a=[r?n[0]:n[2],s?n[3]:n[1]],l=[r?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),h=hd(a[0],l[0],c)||t.surface.isGlobal&&hd(a[0],-l[0],c),d=hd(a[1],l[1],c);if(h&&d)return!0;if(t.level===e.level||!h&&!d)return Ie(!1),!1;const f=h?qve(o[1],o[3],n[1],n[3],c):qve(o[0],o[2],n[0],n[2],c);return Ie(f),f}function qve(t,e,i,r,s){return t-s<=i&&i<=r&&r<=e+s}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(nn||(nn={}));const _k=$(),H9=$(),q9=$(),No=$(),aAt=65536;function lAt(t,e){const{tile:i,geometry:r,geometryState:s}=t,{extentInRadians:n,surface:o}=i,{isWebMercator:a,renderer:l}=o,{numVerticesPerSide:c,wireframe:h}=s,d=c-1,f=(c-2)**2,m=a&&(e===cd.HAS_SOUTH_POLE||e===cd.HAS_BOTH_POLES),g=a&&(e===cd.HAS_NORTH_POLE||e===cd.HAS_BOTH_POLES),v=((m?1:0)+(g?1:0))*oz*c,_=_4e(s),b=f+v+4*_,w=l.tileGeometryCache.acquire(b);r.numVerticesPerSide=c,r.vertexAttributes=w,r.maxEdgeVertexCount=_;const{boundingBox:x}=r;bf(x);const S=Cae(t);Vo.update(d,n,S),uAt(t),r.poleVerticesStartIndex=f;const C=cAt(t,m,g);r.edgeVerticesStartIndex=f+v,Aae(t),Eae(t),h4e(r,C,h),t.intersectionData=null}function cAt(t,e,i){const{tile:r,localOrigin:s,geometry:n}=t,{extent:o,ellipsoid:a}=r,{boundingBox:l,numVerticesPerSide:c,vertexAttributes:h,poleVerticesStartIndex:d}=n,f=c-1,m=s[0],g=s[1],v=s[2],_=a.radius,b=o[1],w=o[3],x=[];let S=d;const C=(T,M)=>{const I=M*c;$d(-m,-g,T*_-v,l),x.push(new AAt(T===1,I,T===1?0:2,S,oz));const D=a4e(T===-1?b:w,_),P=T*Math.PI/2-D,F=.99*(T===1?1:-1),L=_+0,{position:N,uv0:R}=h,{typedBuffer:k,typedBufferStride:W}=h.normalCompressed;for(let j=1;j<=oz;++j){const B=D+P*(j/oz),te=Math.cos(B),le=Math.sin(B);for(let de=0;de<=f;de++){const Ae=de/f,We=Vo.sinLonLUT[de],Ue=Vo.cosLonLUT[de]*te,it=We*te,Et=le,Jt=Ue*L-m,wt=it*L-g,vt=Et*L-v;$d(Jt,wt,vt,l),N.setValues(S,Jt,wt,vt),uf(R,S,Ae,F),Zb(k,S,Ue,it,Et,W),++S}}};return e&&C(-1,0),i&&C(1,f),x}function uAt(t){const{tile:e}=t;if(!e.intersectsClippingArea)return;const{geometry:i,geometryState:r,localOrigin:s}=t,{numVerticesPerSide:n,samplerData:o}=r,a=n-2,l=n-1,{vertexAttributes:c,boundingBox:h}=i,d=c.position,f=c.uv0,{typedBuffer:m,typedBufferStride:g}=c.normalCompressed,{extent:v}=e,_=v[0],b=v[2],w=v[1],x=v[3],S=e.ellipsoid.radius,C=s[0],T=s[1],M=s[2],I=d.typedBuffer,D=d.typedBufferStride,P=1/l;let F=0;if(1<=a){const L=P,N=w*(1-L)+x*L,R=Vo.sinLatLUT[1],k=Vo.cosLatLUT[1];for(let W=1;W<=a;W++){const j=W*P,B=_*(1-j)+b*j,te=Vo.sinLonLUT[W],le=Vo.cosLonLUT[W],de=S+ds(B,N,o),Ae=de*le*k-C,We=de*te*k-T,Ue=de*R-M;$d(Ae,We,Ue,h);const it=(W-1)*D;I[it]=Ae,I[it+1]=We,I[it+2]=Ue,uf(f,W-1,j,L)}}for(let L=1;L<=a;L++){const N=L*P,R=w*(1-N)+x*N,k=Vo.sinLatLUT[L],W=Vo.cosLatLUT[L],j=L+1,B=j*P,te=w*(1-B)+x*B,le=Vo.sinLatLUT[j],de=Vo.cosLatLUT[j],Ae=Vo.sinLonLUT[0],We=Vo.cosLonLUT[0],Ue=S+ds(_,R,o);let it=We*W*Ue-C,Et=Ae*W*Ue-T,Jt=k*Ue-M;const wt=F*D;let vt=I[wt],Ft=I[wt+1],xt=I[wt+2];for(let zt=1;zt<=a;zt++){const ut=zt*P,_t=_*(1-ut)+b*ut,me=Vo.sinLonLUT[zt],ye=Vo.cosLonLUT[zt];let we=0,ke=0,Ge=0;if(zt<a){const Si=(F+1)*D;we=I[Si],ke=I[Si+1],Ge=I[Si+2]}else{const Si=Vo.sinLonLUT[l],zr=Vo.cosLonLUT[l],Es=S+ds(b,R,o);we=zr*W*Es-C,ke=Si*W*Es-T,Ge=k*Es-M}const Ot=it,He=Et,yt=Jt;it=vt,Et=Ft,Jt=xt,vt=we,Ft=ke,xt=Ge;const Se=we-Ot,ze=ke-He,bt=Ge-yt;let qi=0,ji=0,ur=0;if(L>1){const Si=(F-a)*D;qi=I[Si],ji=I[Si+1],ur=I[Si+2]}else{const Si=Vo.sinLatLUT[0],zr=Vo.cosLatLUT[0],Es=S+ds(_t,w,o);qi=ye*zr*Es-C,ji=me*zr*Es-T,ur=Si*Es-M}const ir=S+ds(_t,te,o),Xi=ye*de*ir-C,$i=me*de*ir-T,zi=le*ir-M;if(L<a){const Si=F+a,zr=Si*D;I[zr]=Xi,I[zr+1]=$i,I[zr+2]=zi,$d(Xi,$i,zi,h),uf(f,Si,ut,B)}const Ai=qi-Xi,Ht=ji-$i,Xt=ur-zi;let xi=ye*W,Wi=me*W,Mr=k;Mr*Mr<.999&&(xi=bt*Ht-ze*Xt,Wi=Se*Xt-bt*Ai,Mr=ze*Ai-Se*Ht);const Qs=1/Math.sqrt(xi*xi+Wi*Wi+Mr*Mr);Zb(m,F,xi*Qs,Wi*Qs,Mr*Qs,g),++F}}}function hAt(t){t.tile.intersectsClippingArea&&(Eae(t),wM(t),t.intersectionData=null)}function dAt(t){t.tile.intersectsClippingArea&&(f4e(t),Eae(t),wM(t),y4e(t),t.intersectionData=null)}function pAt(t){t.tile.intersectsClippingArea&&(o4e(t),n4e(t,!0),wM(t),t.intersectionData=null)}function Eae(t){t.tile.intersectsClippingArea&&(o4e(t),n4e(t))}function n4e(t,e=!1){const{geometry:i,geometryState:r,tile:s,localOrigin:n}=t,{level:o,extent:a,extentInRadians:l,ellipsoid:c}=s,h=c.radius,d=l[0],f=l[2],m=l[1],g=l[3],{samplerData:v}=r,_=a[0],b=a[2],w=a[1],x=a[3],S=Cae(t),{boundingBox:C,vertexAttributes:T}=i,M=n[0],I=n[1],D=n[2],P=T.position,F=P.typedBuffer,L=P.typedBufferStride,N=T.uv0;for(let R=0;R<4;++R){const k=R===1||R===3,W=r.edgeResolutions[R];Ie(u3(W));const j=W+1,B=wx(s,r.edgePeerNeighbors[R]);if(v4e(s,B,R)){m4e(t,R,B);continue}const te=B!=null;Ie(!te||B.level===s.level),Ie(!te||Fm(s,B)<=0);const le=B==null?void 0:B.renderData,de=le==null?void 0:le.geometryState;if(Kn){const Se=s.surface;if(!B&&Se&&!Se.updatingRootTiles){const ze=rf[R],bt=s.findNeighborTile(ze,qi=>qi.loaded||qi.leaf||qi.level===s.level);bt?bt.intersectsClippingArea&&(Ie(!bt.loaded),Ie(!bt.leaf),Ie(bt.level===o)):Ie((Se==null?void 0:Se.rootTiles)==null||!s.shouldHaveNeighbor(ze))}}const Ae=R===1?a[2]:a[0],We=B==null?void 0:B.extent,Ue=We&&k?R===1?We[0]:We[2]:Ae,it=R===0?a[3]:a[1],Et=R===1?1:0,Jt=R===0?1:0,wt=R===1?f:d,vt=R===0?g:m,Ft=Math.sin(wt),xt=Math.cos(wt),zt=Math.sin(vt),ut=Math.cos(vt),_t=de==null?void 0:de.samplerData,me=te?(Se,ze,bt)=>.5*(ds(Se,ze,v)+ds(bt,ze,_t)):(Se,ze,bt)=>ds(Se,ze,v),ye=i.outerEdgesOffsetAndLength[2*R+0],we=e&&j>3?j-3:1,ke=v!=null&&v.some(Se=>Se!=null),Ge=_t!=null&&_t.some(Se=>Se!=null),Ot=ke||Ge,He=1/W,yt=ye;Ie(!We||hd(We[2]-We[0],a[2]-a[0])),(()=>{const Se=R===1?-1:R===3?1:0,ze=R===0?-1:R===2?1:0,bt=(a[2]-a[0])*He,qi=Se*bt,ji=ze*bt,ur=k?Se*((f-d)*He):0,ir=k?0:ze*He,Xi=Jt,$i=k?wt+ur:wt,zi=k?Math.sin($i):Ft,Ai=k?Math.cos($i):xt,Ht=k?wt-ur:wt,Xt=k?Math.sin(Ht):Ft,xi=k?Math.cos(Ht):xt,Wi=k?vt:S(Xi+ir),Mr=k?zt:Math.sin(Wi),Qs=k?ut:Math.cos(Wi),Si=k?vt:S(Xi-ir),zr=k?zt:Math.sin(Si),Es=k?ut:Math.cos(Si);let Ro=0,el=0,tl=0;{const Q=0*He,Vt=k?Ae:_*(1-Q)+b*Q,ps=k?Ue:Vt,Wr=k?w*(1-Q)+x*Q:it,fs=k?wt:d*(1-Q)+f*Q,Xe=k?Ft:Math.sin(fs),jd=k?xt:Math.cos(fs),cs=k?S(Q):vt,du=k?Math.sin(cs):zt,Gd=k?Math.cos(cs):ut,Do=h+me(Vt,Wr,ps);Ro=jd*Gd*Do,el=Xe*Gd*Do,tl=du*Do}let Po=0,un=0,Cs=0;{const Q=1*He,Vt=k?Ae:_*(1-Q)+b*Q,ps=k?Ue:Vt,Wr=k?w*(1-Q)+x*Q:it,fs=k?wt:d*(1-Q)+f*Q,Xe=k?Ft:Math.sin(fs),jd=k?xt:Math.cos(fs),cs=k?S(Q):vt,du=k?Math.sin(cs):zt,Gd=k?Math.cos(cs):ut,Do=h+me(Vt,Wr,ps);Po=jd*Gd*Do,un=Xe*Gd*Do,Cs=du*Do}for(let Q=1;Q<j-1;Q+=we){let Vt=0,ps=0,Wr=0;{const Or=(Q+1)*He,vh=k?Ae:_*(1-Or)+b*Or,Hd=k?Ue:vh,ra=k?w*(1-Or)+x*Or:it,If=k?wt:d*(1-Or)+f*Or,t0=k?Ft:Math.sin(If),xT=k?xt:Math.cos(If),_w=k?S(Or):vt,Aa=k?Math.sin(_w):zt,bw=k?Math.cos(_w):ut,i0=h+me(vh,ra,Hd);Vt=xT*bw*i0,ps=t0*bw*i0,Wr=Aa*i0}const fs=Vt,Xe=ps,jd=Wr,cs=Po,du=un,Gd=Cs;Po=fs,un=Xe,Cs=jd;{const Or=yt+Q,vh=Or*L,Hd=cs-M,ra=du-I,If=Gd-D;F[vh]=Hd,F[vh+1]=ra,F[vh+2]=If,$d(Hd,ra,If,C);const t0=Q*He;uf(N,Or,k?Et:t0,k?t0:Jt)}const Do=Ro,QL=el,eN=tl;Ro=cs,el=du,tl=Gd;const Kt=cs,vw=du,Mg=Gd,wT=1/Math.sqrt(Kt*Kt+vw*vw+Mg*Mg),tN=Mg*wT;let Mf=0,e0=0,Of=0;if(Ot&&tN*tN<.999){let Or=0,vh=0,Hd=0;{const ra=R===0?-1:1;Or=ra*(fs-Do),vh=ra*(Xe-QL),Hd=ra*(jd-eN)}{const ra=Q*He,If=k?Ae:_*(1-ra)+b*ra,t0=k?Ue:If,xT=k?w*(1-ra)+x*ra:it,_w=k?wt:d*(1-ra)+f*ra,Aa=k?Ft:Math.sin(_w),bw=k?xt:Math.cos(_w),i0=k?S(ra):vt,V=k?Math.sin(i0):zt,pe=k?Math.cos(i0):ut;let Me=Kt,jt=vw,Ur=Mg;if(te){const Zr=h+ds(t0-qi,xT-ji,_t),Ns=k?pe:Es;Me=(k?xi:bw)*Ns*Zr,jt=(k?Xt:Aa)*Ns*Zr,Ur=(k?V:zr)*Zr}{const Zr=h+ds(If+qi,xT+ji,v),Ns=k?pe:Qs,Ma=(k?Ai:bw)*Ns*Zr,Qle=(k?zi:Aa)*Ns*Zr,ece=(k?V:Mr)*Zr;te||(Me=2*Kt-Ma,jt=2*vw-Qle,Ur=2*Mg-ece);const xH=R===3?-1:1,tce=xH*(Me-Ma),ice=xH*(jt-Qle),rce=xH*(Ur-ece);Mf=Hd*ice-vh*rce,e0=Or*rce-Hd*tce,Of=vh*tce-Or*ice;const SH=1/Math.sqrt(Mf*Mf+e0*e0+Of*Of);Mf*=SH,e0*=SH,Of*=SH}}}else Mf=Kt*wT,e0=vw*wT,Of=Mg*wT;i.setEdgeNormalFromValues(R,Q,Mf,e0,Of)}})()}}function o4e(t){g4e(t)}function a4e(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function fAt(t,e,i,r){return a4e(t*(1-r)+e*r,i)}function mAt(t,e,i){return t*(1-i)+e*i}function Cae(t){const{tile:e}=t;if(e.surface.isWebMercator){const r=e.extent,s=e.ellipsoid.radius;return n=>fAt(r[1],r[3],s,n)}const i=e.extentInRadians;return r=>mAt(i[1],i[3],r)}function gAt(t,e){const{tile:i,geometryState:r,geometry:s}=t,{extent:n,surface:o}=i,{wireframe:a}=r,l=n[0],c=n[1],h=n[2]-l,d=n[3]-c,{numVerticesPerSide:f,clippingArea:m}=r,g=m!=null?Math.max(0,(m[0]-l)/h):0,v=m!=null?Math.max(0,(m[1]-c)/d):0,_=m!=null?Math.min(1,(m[2]-l)/h):1,b=m!=null?Math.min(1,(m[3]-c)/d):1,w=(f-2)**2,x=_4e(r),S=w+4*x,C=o.renderer.tileGeometryCache.acquire(S),{boundingBox:T}=s;bf(T),s.numVerticesPerSide=f,s.vertexAttributes=C,s.maxEdgeVertexCount=x,s.minu=g,s.minv=v,s.maxu=_,s.maxv=b,yAt(t),s.edgeVerticesStartIndex=w,Aae(t),$ae(t),h4e(s,[],a),t.intersectionData=null}function yAt(t){const e=t.tile;if(!e.intersectsClippingArea)return;const{geometry:i,geometryState:r,localOrigin:s}=t,{samplerData:n,clippingArea:o,numVerticesPerSide:a}=r,{surface:l,extent:c,ellipsoid:h}=e,{isWebMercatorOnPlateCarree:d}=l,f=o??Mae,m=c[0],g=c[1],v=c[2],_=c[3],b=Math.max(m,f[0]),w=Math.min(v,f[2]),x=Math.max(g,f[1]),S=Math.min(_,f[3]),C=h.radius,T=e.horizontalScale,M=a-1,I=a-2,{minu:D,minv:P,maxu:F,maxv:L,boundingBox:N,vertexAttributes:R}=i,k=R.position,W=R.uv0,{typedBuffer:j,typedBufferStride:B}=R.normalCompressed,te=s[0],le=s[1],de=s[2],Ae=k.typedBuffer,We=k.typedBufferStride;let Ue=0;const it=ue(g,x,S),Et=d?(Math.PI/2-2*Math.atan(Math.exp(-it/C)))*C:it*T,Jt=1/M,wt=ue(g*(1-Jt)+_*Jt,x,S);let vt=Et,Ft=d?(Math.PI/2-2*Math.atan(Math.exp(-wt/C)))*C:wt*T;for(let xt=1;xt<=I;xt++){const zt=xt/M,ut=ue(g*(1-zt)+_*zt,x,S),_t=ue(zt,P,L),me=Ft,ye=(xt-1)/M,we=ue(g*(1-ye)+_*ye,x,S),ke=vt,Ge=(xt+1)/M,Ot=ue(g*(1-Ge)+_*Ge,x,S),He=d?(Math.PI/2-2*Math.atan(Math.exp(-Ot/C)))*C:Ot*T,yt=ue(Ge,P,L);vt=Ft,Ft=He;const Se=ue(m,b,w);let ze=Se*T,bt=ds(Se,ut,n);const qi=1/M,ji=ue(qi,D,F),ur=ue(m*(1-ji)+v*ji,b,w);let ir=ji,Xi=ur,$i=ur*T,zi=ds(ur,ut,n);if(xt===1){const Ai=$i-te,Ht=vt-le,Xt=zi-de,xi=0*We;Ae[xi]=Ai,Ae[xi+1]=Ht,Ae[xi+2]=Xt,$d(Ai,Ht,Xt,N);const Wi=ue(qi,D,F);uf(W,Ue,Wi,_t)}for(let Ai=1;Ai<=I;Ai++){const Ht=$i,Xt=zi,xi=(Ai+1)/M,Wi=ue(xi,D,F),Mr=ue(m*(1-xi)+v*xi,b,w),Qs=Xi;Xi=Mr;{const un=Ue+1,Cs=un*We;if(xt===1||Ai===I){const Q=Mr*T,Vt=ds(Mr,ut,n);if(xt===1&&Ai<I){const ps=Q-te,Wr=me-le,fs=Vt-de;Ae[Cs]=ps,Ae[Cs+1]=Wr,Ae[Cs+2]=fs,$d(ps,Wr,fs,N),uf(W,un,Wi,_t)}$i=Q,zi=Vt}else $i=Ae[Cs]+te,zi=Ae[Cs+2]+de}const Si=$i,zr=zi,Es=ze,Ro=bt;ze=Ht,bt=Xt;const el=(Ue-I)*We,tl=xt===1?ds(Qs,we,n):Ae[el+2]+de,Po=ds(Qs,Ot,n);if(xt<I){const un=Ue+I,Cs=un*We,Q=Ht-te,Vt=He-le,ps=Po-de;Ae[Cs]=Q,Ae[Cs+1]=Vt,Ae[Cs+2]=ps,$d(Q,Vt,ps,N);const Wr=ir;ir=Wi,uf(W,un,Wr,yt)}{const un=Si-Es,Cs=ke-He,Q=Cs*(zr-Ro),Vt=un*(tl-Po),ps=-Cs*un,Wr=Q*Q+Vt*Vt+ps*ps;if(Wr===0)Zb(j,Ue,0,0,1,B);else{const fs=1/Math.sqrt(Wr);Zb(j,Ue,Q*fs,Vt*fs,ps*fs,B)}}++Ue}}}function vAt(t,e){t.tile.intersectsClippingArea&&(c4e(t),l4e(t,!0),wM(t),t.intersectionData=null)}function _At(t,e){t.tile.intersectsClippingArea&&(f4e(t),$ae(t),wM(t),y4e(t),t.intersectionData=null)}function bAt(t,e){t.tile.intersectsClippingArea&&($ae(t),wM(t),t.intersectionData=null)}function $ae(t,e){t.tile.intersectsClippingArea&&(c4e(t),l4e(t,!1))}function l4e(t,e){const{geometry:i,geometryState:r,localOrigin:s}=t,n=t.tile,{surface:o,extent:a}=n,{clippingArea:l,samplerData:c}=r,h=l??Mae,d=a[0],f=a[2],m=a[1],g=a[3],v=[g>h[3],f>h[2],m<h[1],d<h[0]],_=n.horizontalScale,b=u4e(o.isWebMercatorOnPlateCarree,n.ellipsoid.radius,_),{minu:w,minv:x,maxu:S,maxv:C,boundingBox:T}=i,M=Math.max(d,h[0]),I=Math.min(f,h[2]),D=Math.max(m,h[1]),P=Math.min(g,h[3]),F=s[0],L=s[1],N=s[2];for(let R=0;R<4;++R){const k=R===1||R===3,W=r.edgeResolutions[R];Ie(u3(W));const j=W+1,B=v[R],te=wx(n,r.edgePeerNeighbors[R]);if(!B&&v4e(n,te,R)){m4e(t,R,te);continue}const le=te!=null&&!B,de=te==null?void 0:te.renderData,Ae=de==null?void 0:de.geometryState;if(Kn&&(Ie(!le||te.level===n.level),Ie(!le||Fm(n,te)<=0),n&&!te&&!o.updatingRootTiles)){const He=rf[R],yt=n.findNeighborTile(He,Se=>Se.loaded||Se.leaf||Se.level===n.level);o.updatingRootTiles||(yt?yt.intersectsClippingArea&&(Ie(!yt.loaded),Ie(!yt.leaf),Ie(yt.level===n.level)):Ie((o==null?void 0:o.rootTiles)==null||!n.shouldHaveNeighbor(He)))}const We=ue(R===1?f:d,M,I),Ue=ue(R===0?g:m,D,P),it=Ae==null?void 0:Ae.samplerData,Et=e&&j>3?j-3:1,Jt=ue(R===1?1:0,w,S),wt=ue(R===0?1:0,x,C),vt=le?(He,yt)=>.5*(ds(He,yt,it)+ds(He,yt,c)):(He,yt)=>ds(He,yt,c),Ft=(f-d)/W,xt=k?R===1?Ft:-Ft:0,zt=k?0:R===0?Ft:-Ft,ut=-xt,_t=-zt;let me=0,ye=0,we=0;{const He=0/W,yt=k?We:ue(d*(1-He)+f*He,M,I),Se=k?ue(m*(1-He)+g*He,D,P):Ue,ze=vt(yt,Se);me=yt*_,ye=b(Se),we=ze}let ke=0,Ge=0,Ot=0;{const He=1/W,yt=k?We:ue(d*(1-He)+f*He,M,I),Se=k?ue(m*(1-He)+g*He,D,P):Ue,ze=vt(yt,Se);ke=yt*_,Ge=b(Se),Ot=ze}for(let He=1;He<j-1;He+=Et){const yt=He/W,Se=ke,ze=Ge,bt=Ot;{const Xt=k?Jt:ue(yt,w,S),xi=k?ue(yt,x,C):wt,Wi=Se-F,Mr=ze-L,Qs=bt-N;$d(Se,Mr,Qs,T),i.setEdgeVertexFromValuesRawPositionUV(R,He,Wi,Mr,Qs,Xt,xi)}{const Xt=(He+1)/W,xi=k?We:ue(d*(1-Xt)+f*Xt,M,I),Wi=k?ue(m*(1-Xt)+g*Xt,D,P):Ue,Mr=vt(xi,Wi);ke=xi*_,Ge=b(Wi),Ot=Mr}const qi=ke,ji=Ot,ur=me,ir=ye,Xi=we;me=Se,ye=ze,we=bt;let $i=0,zi=0,Ai=0;if(k){const Xt=Ge-ze,xi=ji-bt,Wi=ir-ze,Mr=Xi-bt,Qs=ue(m*(1-yt)+g*yt,D,P),Si=We+ut,zr=Si*_-Se,Es=ds(Si,Qs,c)-bt,Ro=R===3?-1:1;if($i=Ro*(-Wi+Xt)*Es,zi=Ro*zr*(-Mr+xi),Ai=-Ro*zr*(-Wi+Xt),le){const el=We+xt,tl=el*_-Se;$i=(-Wi+Xt)*(Es-(ds(el,Qs,it)-bt)),zi=(zr-tl)*(-Mr+xi),Ai=-(zr-tl)*(-Wi+Xt)}}else{const Xt=qi-Se,xi=ji-bt,Wi=ur-Se,Mr=Xi-bt,Qs=ue(d*(1-yt)+f*yt,M,I),Si=Ue+_t,zr=ds(Qs,Si,c)-bt,Es=b(Si)-ze,Ro=R===2?-1:1;if($i=Ro*Es*(-Mr+xi),zi=Ro*(-Wi+Xt)*zr,Ai=-Ro*Es*(-Wi+Xt),le){const el=Qs,tl=Ue+zt,Po=b(tl)-ze;$i=(-Es+Po)*(-Mr+xi),zi=(-Wi+Xt)*(-zr+(ds(el,tl,it)-bt)),Ai=-(-Es+Po)*(-Wi+Xt)}}const Ht=1/Math.sqrt($i*$i+zi*zi+Ai*Ai);i.setEdgeNormalFromValues(R,He,$i*Ht,zi*Ht,Ai*Ht)}}}function c4e(t,e){g4e(t)}function wAt(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function xAt(t,e){return t*e}function u4e(t,e,i){return t?r=>wAt(r,e):r=>xAt(r,i)}function h4e(t,e,i){const{numVerticesPerSide:r,vertexAttributes:s,maxEdgeVertexCount:n}=t,o=r-1,a=s.count,l=2*(r-3)*(r-3),c=4*(o+n-3),h=bae.reduce((v,_)=>v+(o+t.getEdgeCount(_)-3),0),d=e.reduce((v,_)=>v+o*(2*(_.latitudeResolution-1)+1),0),f=3*(i?2:1),m=(l+c+d)*f,g=a>=aAt?new Uint32Array(m):new Uint16Array(m);for(let v=0;v<m;++v)g[v]=0;t.indices=g,t.indexCount=(l+h+d)*f,t.poleIndicesStartIndex=l*f,t.edgeIndicesStartIndex=(l+d)*f,i?(EAt(t),CAt(t,e),p4e(t)):(SAt(t),TAt(t,e),d4e(t))}function SAt(t){const{numVerticesPerSide:e,indices:i,vertexAttributes:r}=t,{position:s}=r,{typedBuffer:n,typedBufferStride:o}=s,a=e-2,l=e-3,c=0,h=e-3;let d=0;for(let f=0;f<l;++f){const m=f*a;for(let g=c;g<h;++g){const v=m+g,_=v+1,b=_+a,w=b-1;b4e(v,_,b,w,o,n)?(i[d]=v,i[d+1]=_,i[d+2]=b,i[d+3]=b,i[d+4]=w,i[d+5]=v):(i[d]=v,i[d+1]=_,i[d+2]=w,i[d+3]=w,i[d+4]=_,i[d+5]=b),d+=6}}}function TAt(t,e){const{numVerticesPerSide:i,indices:r,poleIndicesStartIndex:s}=t,n=i-1;let o=s;for(const a of e){const l=a.isNorth?1:2,c=a.isNorth?2:1,h=a.isNorth?3:4,d=a.isNorth?4:3;let f=t.getEdgeVertexIndex(a.connectedOuterEdgeOffset,0),m=1;for(let g=0;g<a.latitudeResolution;++g){const v=g===0?a.rowOffset:f+i;for(let _=0;_<n;_++){const b=v+_;r[o]=f,r[o+l]=f+1,r[o+c]=b,g<a.latitudeResolution-1?(r[o+h]=f+1,r[o+d]=b+1,r[o+5]=b,o+=6):o+=3,f+=m}f=v,m=1}}}function d4e(t){const{indices:e,numVerticesPerSide:i,edgeIndicesStartIndex:r}=t,s=i-1,n=s-2;let o=r;for(let a=0;a<4;++a){const l=Oae[a];let c=0,h=0;const d=t.getEdgeCount(a),f=l.count;Ie(f===s-1);const m=a===1||a===2,g=m?1:2,v=m?2:1,_=t.getEdgeFirstVertexIndex(a),b=1,w=l.vertex0Index,x=l.stride;for(;c<d-1||h<f-1;){const S=w+h*x,C=_+c*b,T=c<d-1,M=h<f-1,I=T&&(!M||(T?0+s*(c+.5)/(d-1):0)<=(M?1+n*(h+.5)/(f-1):0));I?++c:++h;const D=I?C+b:S+x;e[o]=S,e[o+g]=C,e[o+v]=D,o+=3}}t.indexCount=o}function EAt(t){const{indices:e,numVerticesPerSide:i,vertexAttributes:r}=t,{position:s}=r,{typedBuffer:n,typedBufferStride:o}=s,a=i-2;let l=0;for(let c=0;c<i-3;++c){const h=c*a;for(let d=0;d<i-3;++d){const f=c*a+d,m=f+1,g=m+a,v=g-1,_=h+d,b=_+1,w=b+a;b4e(_,b,w,w-1,o,n)?($C(e,l,f,m,g),l+=6,$C(e,l,g,v,f)):($C(e,l,f,m,v),l+=6,$C(e,l,v,g,m)),l+=6}}}function CAt(t,e){const{indices:i,numVerticesPerSide:r,poleIndicesStartIndex:s}=t,n=r-1;let o=s;for(const a of e){const l=a.connectedOuterEdgeOffset;let c=t.getEdgeVertexIndex(l,0),h=1;for(let d=0;d<a.latitudeResolution;++d){const f=d===0?a.rowOffset:c+r;for(let m=0;m<n;m++)$C(i,o,c,c+1,f+m),o+=6,d<a.latitudeResolution-1&&($C(i,o,c+1,f+m+1,f+m),o+=6),c+=h;c=f,h=1}}}function p4e(t){const{indices:e,numVerticesPerSide:i,edgeIndicesStartIndex:r}=t,s=i-1,n=s-2;let o=r;for(let a=0;a<4;++a){const l=Oae[a];let c=0,h=0;const d=t.getEdgeCount(a),f=l.count;Ie(f===s-1);const m=a===1||a===2,g=m?1:3,v=m?3:1,_=t.getEdgeFirstVertexIndex(a),b=1,w=l.vertex0Index,x=l.stride;for(;c<d-1||h<f-1;){const S=w+h*x,C=_+c*b,T=c<d-1,M=h<f-1,I=T&&(!M||(T?0+s*(c+.5)/(d-1):0)<=(M?1+n*(h+.5)/(f-1):0));I?++c:++h;const D=I?C+b:S+x;e[o]=S,e[o+g]=C,e[o+g+1]=C,e[o+v]=D,e[o+v+1]=D,e[o+5]=S,o+=6}}t.indexCount=o}function Aae(t){const{geometry:e,geometryState:i}=t,{edgeResolutions:r}=i,{numVerticesPerSide:s,edgeVerticesStartIndex:n}=e,o=s-2;let a=n;for(let l=0;l<4;++l){{const c=l===0||l===2,h=(l===0?o-1:0)*o+(l===1?o-1:0),d=(c?0:1)*o+(c?1:0),f=Oae[l];f.vertex0Index=h,f.stride=d,f.count=o}{const c=r[l]+1;e.outerEdgesOffsetAndLength[2*l+0]=a,e.outerEdgesOffsetAndLength[2*l+1]=c,a+=c}}}function f4e(t){Aae(t),t.geometryState.wireframe?p4e(t.geometry):d4e(t.geometry)}function m4e(t,e,i){const{geometryState:r,geometry:s,tile:n,localOrigin:o}=t,a=e===1||e===3,l=r.edgeResolutions[e];Ie(u3(l));const c=l+1,{boundingBox:h,minu:d,minv:f,maxu:m,maxv:g,vertexAttributes:v}=s,_=ue(e===1?1:0,d,m),b=ue(e===0?1:0,f,g),w=i.renderData,x=w.geometryState,S=w.geometry,C=(e+2)%4,T=S.getEdgeCount(C),M=n.getNeighborEdgeStartVertexIndex(e,i)*l,I=l*2**(n.level-i.level);Ie(x.edgeResolutions[C]===I),Ie(T-1===I);const D=w.localOrigin[0]-o[0],P=w.localOrigin[1]-o[1],F=w.localOrigin[2]-o[2],L=s.getEdgeFirstVertexIndex(e),N=v.position,R=N.typedBuffer,k=N.typedBufferStride,W=v.normalCompressed,j=W.typedBuffer,B=W.typedBufferStride,te=v.uv0,le=S.vertexAttributes,de=S.getEdgeFirstVertexIndex(C),Ae=le.position.typedBuffer,We=le.position.typedBufferStride,Ue=le.normalCompressed.typedBuffer,it=le.normalCompressed.typedBufferStride;for(let Et=1;Et<c-1;++Et){const Jt=L+Et,wt=de+(M+Et),vt=Jt*k,Ft=wt*We,xt=Ae[Ft]+D,zt=Ae[Ft+1]+P,ut=Ae[Ft+2]+F;R[vt]=xt,R[vt+1]=zt,R[vt+2]=ut,$d(xt,zt,ut,h);const _t=Jt*B,me=wt*it;j[_t]=Ue[me],j[_t+1]=Ue[me+1];const ye=Et/l,we=a?_:ue(ye,d,m),ke=a?ue(ye,f,g):b;uf(te,Jt,we,ke)}}function g4e(t){var _t;const{geometry:e,geometryState:i,localOrigin:r}=t,{clippingArea:s,samplerData:n}=i,{minu:o,minv:a,maxu:l,maxv:c,boundingBox:h,vertexAttributes:d}=e,f=t.tile,{surface:m,ellipsoid:g,extent:v,extentInRadians:_,horizontalScale:b}=f,w=((_t=m.view)==null?void 0:_t.viewingMode)==="local",x=g.radius;let S=0,C=0,T=0;const M=(me,ye,we)=>{const ke=_[ye===0?1:3],Ge=_[me===0?0:2],Ot=Math.cos(ke),He=Math.sin(ke),yt=Math.sin(Ge),Se=Math.cos(Ge),ze=x+we;S=Se*Ot*ze,C=yt*Ot*ze,T=He*ze},I=w?(()=>{const me=s,ye=me!=null&&(v[3]>me[3]||v[2]>me[2]||v[1]<me[1]||v[0]<me[0]),we=u4e(m.isWebMercatorOnPlateCarree,x,b);return(ke,Ge,Ot)=>{const He=ke===0?v[0]:v[2],yt=Ge===0?v[1]:v[3],Se=ye?ue(He,me[0],me[2]):He,ze=ye?ue(yt,me[1],me[3]):yt,bt=Ot;S=Se*b,C=we(ze),T=bt}})():M;let D=0,P=0,F=0,L=0,N=0,R=0,k=0,W=0,j=0;const B=w&&m.isWebMercatorOnPlateCarree,te=(me,ye,we,ke,Ge)=>{let Ot=0,He=0,yt=0;if(w){const Se=ye*b,ze=B?(Math.PI/2-2*Math.atan(Math.exp(-we/x)))*x:we*b;Ot=Se-S,He=ze-C,yt=ke-T}else{const Se=Cae(me),ze=me.tile,bt=ze.extent,qi=ze.extentInRadians,ji=(ye-bt[0])/(bt[2]-bt[0]),ur=(we-bt[1])/(bt[3]-bt[1]),ir=qi[0]*(1-ji)+qi[2]*ji,Xi=Se(ur),$i=Math.cos(Xi),zi=Math.sin(Xi),Ai=Math.sin(ir),Ht=Math.cos(ir),Xt=x+ke;Ot=Ht*$i*Xt-S,He=Ai*$i*Xt-C,yt=zi*Xt-T}switch(Ge){case 0:k+=Ot,W+=He,j+=yt;break;case 1:L-=Ot,N-=He,R-=yt;break;case 2:k-=Ot,W-=He,j-=yt;break;case 3:L+=Ot,N+=He,R+=yt}},le=s??Mae,de=v[0],Ae=v[2],We=v[1],Ue=v[3],it=[Ue>le[3],Ae>le[2],We<le[1],de<le[0]],Et=Math.max(de,le[0]),Jt=Math.min(Ae,le[2]),wt=Math.max(We,le[1]),vt=Math.min(Ue,le[3]),Ft=me=>Math.max(le[0],Math.min(le[2],me)),xt=me=>Math.max(le[1],Math.min(le[3],me)),zt=me=>{const ye=i.cornerNeighborCornerTiles;D=0,P=0,F=1,L=0,N=0,R=0,k=0,W=0,j=0;let we=1/0;for(let Se=0;Se<4;++Se){const ze=ye[4*me+Se];we=Math.min(we,(ze==null?void 0:ze.level)??1/0)}for(let Se=0;Se<4;++Se){const ze=ye[4*me+Se];RO[Se]=(ze==null?void 0:ze.level)===we?ze:null}let ke=1,Ge=0;for(let Se=0;Se<4;++Se){const ze=RO[Se];ze&&(ke=Math.max(ke,ze==null?void 0:ze.renderData.geometryState.numVerticesPerSide),Ge=ze.extent[2]-ze.extent[0])}const Ot=Ge,He=ke;Ie(He>1);const yt=Ot/He;for(let Se=0;Se<4;++Se){const ze=RO[(Se+3)%4],bt=RO[Se%4];if(!ze&&!bt)continue;const qi=Se===0?1:Se===1?2:Se===2?3:0,ji=Se===0?2:Se===1?3:Se===2?0:1;if(ze&&bt){const ur=W9[Se][0]*yt,ir=W9[Se][1]*yt,Xi=ze.extent,$i=Ft(Xi[qi===0||qi===1?2:0]+ur),zi=xt(Xi[qi===0||qi===3?3:1]+ir),Ai=bt.extent,Ht=Ft(Ai[ji===0||ji===1?2:0]+ur),Xt=xt(Ai[ji===0||ji===3?3:1]+ir),xi=ze.renderData,Wi=bt.renderData,Mr=ds($i,zi,xi.geometryState.samplerData),Qs=ds(Ht,Xt,Wi.geometryState.samplerData);te(xi,$i,zi,.5*(Mr+Qs),Se)}else{const ur=ze??bt,ir=ze?qi:ji,Xi=ur.extent,$i=W9[Se],zi=Ft(Xi[ir===0||ir===1?2:0]+$i[0]*yt),Ai=xt(Xi[ir===0||ir===3?3:1]+$i[1]*yt),Ht=ur.renderData,Xt=ds(zi,Ai,Ht.geometryState.samplerData);te(Ht,zi,Ai,Xt,Se)}}if(!w){const Se=Math.sqrt(S*S+C*C+T*T);D=S/Se,P=C/Se,F=T/Se}if(w||F*F<.999){const Se=Math.sqrt(L*L+N*N+R*R);L/=Se,N/=Se,R/=Se;const ze=Math.sqrt(k*k+W*W+j*j);k/=ze,W/=ze,j/=ze,D=R*W-N*j,P=L*j-R*k,F=N*k-L*W;const bt=1/Math.sqrt(D*D+P*P+F*F);D*=bt,P*=bt,F*=bt}},ut=i.cornerNeighborCornerTiles;for(let me=0;me<4;++me){const ye=me,we=(me+1)%4,ke=me===0||me===1?1:0,Ge=me===0||me===3?1:0,Ot=ue(ke,o,l),He=ue(Ge,a,c),yt=e.getEdgeFirstVertexIndex(ye),Se=e.getEdgeCount(ye),ze=me===0||me===3?Se-1:0,bt=e.getEdgeFirstVertexIndex(we),qi=e.getEdgeCount(we),ji=me===0||me===1?qi-1:0;let ur=-1;for(let $i=0;$i<4;++$i){const zi=ut[4*me+$i],Ai=ut[4*me+ur];zi&&(ur===-1||Fm(Ai,zi)>0)&&(ur=$i)}const ir=ur,Xi=ut[4*me+ir];if(Xi!==f){const $i=f.level-Xi.level,zi=2**$i,Ai=[Xi.lij[0]+$i,Xi.lij[1]*zi,Xi.lij[2]*zi],Ht=[Ai[1]+zi===f.lij[1],me===0&&(ir===1||ir===0&&Xi!==ut[4*me+3])||me===1&&(ir===0||ir===1&&Xi!==ut[4*me+2]),Ai[1]===f.lij[1]+1,me===2&&(ir===3||ir===2&&Xi!==ut[4*me+1])||me===3&&(ir===2||ir===3&&Xi!==ut[4*me+0])],Xt=Ht.reduce((Si,zr)=>Si+(zr?1:0),0);Ie(Xt===1||Xt===2);let xi=-1,Wi=-1;const Mr=Xi.renderData;if(Xt===1){const Si=Ht.findIndex(Es=>Es);Ie(0<=Si&&Si<=3),xi=(Si+2)%4;const zr=i.edgeResolutions[Si];Wi=f.getNeighborEdgeStartVertexIndex(Si,Xi)*zr+zr*(Si===0&&me===0||Si===1&&me===0||Si===2&&me===1||Si===3&&me===3?1:0)}else{Ie(Ht[1]||Ht[3]),xi=Ht[1]?3:1;const Si=Mr.geometryState.edgeResolutions[xi];Wi=me===0||me===3?0:Si}const Qs=Mr.geometry;{const Si=yt+ze,zr=bt+ji,Es=Qs.getEdgeFirstVertexIndex(xi)+Wi,Ro=Qs.vertexAttributes,el=Mr.localOrigin;{const Po=Ro.position,un=Po.typedBuffer,Cs=Es*Po.typedBufferStride,Q=un[Cs]+el[0]-r[0],Vt=un[Cs+1]+el[1]-r[1],ps=un[Cs+2]+el[2]-r[2];$d(Q,Vt,ps,h);const Wr=d.position,fs=Wr.typedBuffer;{const Xe=Si*Wr.typedBufferStride;fs[Xe]=Q,fs[Xe+1]=Vt,fs[Xe+2]=ps}{const Xe=zr*Wr.typedBufferStride;fs[Xe]=Q,fs[Xe+1]=Vt,fs[Xe+2]=ps}}const tl=d.uv0;uf(tl,Si,Ot,He),uf(tl,zr,Ot,He);{const Po=Ro.normalCompressed.typedBuffer,un=Es*Ro.normalCompressed.typedBufferStride,Cs=d.normalCompressed,Q=Cs.typedBuffer;{const Vt=Si*Cs.typedBufferStride;Q[Vt]=Po[un],Q[Vt+1]=Po[un+1]}{const Vt=zr*Cs.typedBufferStride;Q[Vt]=Po[un],Q[Vt+1]=Po[un+1]}}}}else{const $i=it[ye],zi=it[we];let Ai;if($i||zi){const Wi=ue(de*(1-ke)+Ae*ke,Et,Jt),Mr=ue(We*(1-Ge)+Ue*Ge,wt,vt);Ai=ds(Wi,Mr,n)}else Ai=$At(ut,me);I(ke,Ge,Ai),zt(me);const Ht=S-r[0],Xt=C-r[1],xi=T-r[2];$d(Ht,Xt,xi,h),e.setEdgeVertexFromValuesRawPositionUVNormal(ye,ze,Ht,Xt,xi,Ot,He,D,P,F),e.setEdgeVertexFromValuesRawPositionUVNormal(we,ji,Ht,Xt,xi,Ot,He,D,P,F)}}for(let me=0;me<4;++me)RO[me]=null}function $At(t,e){var a,l;const i=4*e,r=bae.reduce((c,h)=>{var d;return Math.min(c,((d=t[i+h])==null?void 0:d.level)??1/0)},1/0);Kn&&(Ie(!t[i+0]||!t[i+2]||eQ(t[i+0],t[i+2],nt.SOUTH_WEST)),Ie(!t[i+1]||!t[i+3]||eQ(t[i+1],t[i+3],nt.NORTH_WEST)));let s=0,n=0;for(let c=0;c<4;++c){const h=t[i+c];if(h&&h.level===r){const d=c===0||c===1,f=c===0||c===3,m=h.extent,g=m[d?0:2],v=m[f?1:3],_=(l=(a=h.renderData)==null?void 0:a.geometryState)==null?void 0:l.samplerData;n+=ds(g,v,_),s++}}const o=s?n/s:0;return Ie(o!=null),o}function wM(t){const{vao:e,geometry:i}=t,{vertexAttributes:r,edgeVerticesStartIndex:s}=i,n=r.position.typedBuffer;e.vertexBuffers.get("geometry").setSubData(n,s,s,n.length)}function y4e(t){const{vao:e,geometry:i}=t,{indices:r,indexCount:s,edgeIndicesStartIndex:n}=i;e.indexBuffer.setSubData(r,n,n,s)}let AAt=class{constructor(e,i,r,s,n){this.isNorth=e,this.connectedRowOffset=i,this.connectedOuterEdgeOffset=r,this.rowOffset=s,this.latitudeResolution=n}};const W9=[[0,1],[1,0],[0,-1],[-1,0]],Vo=new S$t,Mae=Nie(-1/0,-1/0,1/0,1/0),RO=[null,null,null,null];function v4e(t,e,i){if(!e)return!1;const r=Fm(t,e);return r>0||r===0&&i>=2}let bk=class{constructor(){this.vertex0Index=0,this.stride=1,this.count=0}getVertexIndex(e){return Ie(0<=e&&e<this.count),this.vertex0Index+this.stride*e}};const Oae=[new bk,new bk,new bk,new bk];function $d(t,e,i,r){t<r[0]?r[0]=t:t>r[3]&&(r[3]=t),e<r[1]?r[1]=e:e>r[4]&&(r[4]=e),i<r[2]?r[2]=i:i>r[5]&&(r[5]=i)}function _4e(t){const{edgeResolutions:e,numVerticesPerSide:i}=t,r=1+Math.max(...e);return Math.max(i,r)}function b4e(t,e,i,r,s,n){const o=t*s,a=n[o],l=n[o+1],c=n[o+2],h=e*s,d=n[h],f=n[h+1],m=n[h+2],g=i*s,v=n[g],_=n[g+1],b=n[g+2],w=r*s,x=n[w],S=n[w+1],C=n[w+2];return(d-x)*(d-x)+(f-S)*(f-S)+(m-C)*(m-C)>(a-v)*(a-v)+(l-_)*(l-_)+(c-b)*(c-b)}function $C(t,e,i,r,s){t[e]=i,t[e+1]=r,t[e+2]=r,t[e+3]=s,t[e+4]=s,t[e+5]=i}const oz=6;let MAt=class extends xae{constructor(e,i,r,s,n){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=si(),this._baseUsedMemory=900,this._subtreeGeometryElevationBoundMin=0,this._subtreeGeometryElevationBoundMax=0,this.init(e,i,r,s,n)}init(e,i,r,s,n){super.init(e,i,r,s,n);const o=n.view.renderSpatialReference,a=n.spatialReference,l=o!=null&&m3(o)&&a!=null&&a.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=l;const{isWebMercatorOnPlateCarree:c}=n,h=this._extentInRenderSR,d=this.extent;if(c){const f=De(d[0],d[1],0);vc(f,Oe.WebMercator,f,Oe.PlateCarree);const m=De(d[2],d[3],0);vc(m,Oe.WebMercator,m,Oe.PlateCarree),h[0]=f[0],h[1]=f[1],h[2]=m[0],h[3]=m[1]}else for(let f=0;f<4;++f)h[f]=d[f]*l;this.centerAtSeaLevel[0]=.5*(h[0]+h[2]),this.centerAtSeaLevel[1]=.5*(h[1]+h[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(h[2]-h[0],h[3]-h[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,i=.5*(e[2]-e[0]),r=.5*(e[3]-e[1]),s=Math.sqrt(i*i+r*r),n=.5*(this.elevationBoundsMax-this.elevationBoundsMin),o=Math.max(s,n);this._center[nn.MIDDLE][3]=o}_calculateFrustumVisibility(e){const i=this._aabb(),r=i[0],s=i[1],n=i[2],o=i[3],a=i[4],l=i[5];let c=!0;for(let h=0;h<6;h++){const d=e[h],f=d[0],m=d[1],g=d[2],v=d[3];if(f*(f>0?r:o)+m*(m>0?s:a)+g*(g>0?n:l)+v>=0)return Ha.OUTSIDE;c=c&&f*(f<0?r:o)+m*(m<0?s:a)+g*(g<0?n:l)+v<=0}return c?Ha.INSIDE:Ha.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return UKe(e[0],e[1],Math.min(this.elevationBoundsMin,this._subtreeGeometryElevationBoundMin),e[2],e[3],Math.max(this.elevationBoundsMax,this._subtreeGeometryElevationBoundMax))}intersectsRay(e,i,r,s){return wk[0]=1/i[0],wk[1]=1/i[1],wk[2]=1/i[2],Une(this._aabb(),e,wk,r,s)}createGeometry(){gAt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds(),this.setMemoryDirty()}_updateSubtreeGeometryElevationsBounds(){const e=this._subtreeGeometryElevationBoundMin,i=this._subtreeGeometryElevationBoundMax,r=this.renderData;let s=e,n=i;if(r){const o=r.geometry.boundingBox;s=o[2],n=o[5]}else if(!this.leaf){s=1/0,n=-1/0;for(const o of this.children){const a=o;s=Math.min(s,a._subtreeGeometryElevationBoundMin),n=Math.max(n,a._subtreeGeometryElevationBoundMax)}}if(s!==this._subtreeGeometryElevationBoundMin||n!==this._subtreeGeometryElevationBoundMax){this._subtreeGeometryElevationBoundMin=s,this._subtreeGeometryElevationBoundMax=n;const o=this.parent;o==null||o._updateSubtreeGeometryElevationsBounds()}}get minimumVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){vAt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevations(){bAt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevationsAndResolutions(){_At(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}get horizontalScale(){return this._horizontalScaleFactor}};const wk=$();let OAt=class{constructor(){this.extent=yi(),this.minLevel=0,this.maxLevel=0,this.callback=null}},az=class extends he{constructor(){super(...arguments),this._queries=new ii({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new ii({initialSize:30}),this._queryPool=new Ol(OAt)}queryVisibleLevelRange(e,i,r,s){const n=this._queryPool.acquire();xd(n.extent,e),n.minLevel=i??-Number.MAX_VALUE,n.maxLevel=r??Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const i=this._queries.data[e];this._queryPool.release(i),i.callback(e>=this._queriesInvPtr),i.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const i=e.level;let r=0;for(;r<this._queriesInvPtr;){const s=this._queries.data[r],n=s.extent;i>=s.minLevel&&i<=s.maxLevel&&n[0]<=e.extent[2]&&n[2]>=e.extent[0]&&n[1]<=e.extent[3]&&n[3]>=e.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}};u([p()],az.prototype,"updating",null),az=u([A("esri.views.3d.terrain.ScaleRangeQueries")],az);function IAt(t,e,i,r){const s=Math.cos(i);t[0]=Math.cos(e)*s*r,t[1]=Math.sin(e)*s*r,t[2]=Math.sin(i)*r}let RAt=class extends xae{constructor(e,i,r,s,n){super(),this._convexHull=new Array(24),this._boundingSphere=Ls(),this._baseUsedMemory=1816,this.init(e,i,r,s,n)}init(e,i,r,s,n){super.init(e,i,r,s,n);const o=this.ellipsoid.radius,a=this.extentInRadians[0],l=this.extentInRadians[1],c=this.extentInRadians[2],h=this.extentInRadians[3],d=ft(l,h,.5),f=ft(a,c,.5),m=e===0?0:Math.min(Math.abs(l),Math.abs(h));this._edgeLen=(c-a)*Math.cos(m)*o,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=o-Math.sqrt(o*o-this._edgeLen2/4),IAt(this.centerAtSeaLevel,f,d,this.ellipsoid.radius),ae(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)se(e[nn.MIDDLE],0,0,0),se(e[nn.TOP],0,0,0),se(e[nn.BOTTOM],0,0,0),e[nn.MIDDLE][3]=this.ellipsoid.radius+this.elevationBoundsMax;else{this._updateCenter();const i=e[nn.MIDDLE],r=this.convexHull;let s=0;for(let n=0;n<8;++n)s=Math.max(s,PAt(i,r,3*n));e[nn.MIDDLE][3]=Math.sqrt(s)}}_calculateFrustumVisibility(e){if(!hb(e,this._boundingSphere))return Ha.OUTSIDE;if(this.lij[0]<10)return Ha.INTERSECTS;const i=this.convexHull,r=this.surface.view.state.camera.near;let s=!0;for(let n=0;n<vM;n++){const o=n===bo.NEAR,a=e[n],l=a[0],c=a[1],h=a[2],d=a[3]-(o?r:0);let f=!1;for(let m=0;m<8;++m){const g=3*m;if(l*i[g]+c*i[g+1]+h*i[g+2]+d<0){if(f=!0,!s)break}else s=!1}if(!f)return Ha.OUTSIDE}return s?Ha.INSIDE:Ha.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){lAt(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),Kn&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,i=e,r=this.elevationBoundsMin,s=this.elevationBoundsMax,n=this.ellipsoid.radius,o=s;if(this.level===0)se(i,0,0,0),e[3]=n+o;else{const a=this.extentInRadians,l=.5*(a[0]+a[2]),c=a[1],h=a[3];Qw(Yve,l,c,n),Qw(Jve,l,h,n),oe(i,Yve,Jve),re(i,i,(n+.5*(r+s))/ja(i));const d=this.convexHull;let f=0;const m=(v,_)=>{const b=v[0]-d[3*_],w=v[1]-d[3*_+1],x=v[2]-d[3*_+2];return Math.sqrt(b*b+w*w+x*x)};for(let v=0;v<8;++v){const _=m(i,v);f=Math.max(f,_)}const g=f;e[3]=g+2}}_updateConvexHull(){const e=this.extentInRadians,i=this.ellipsoid.radius;if(this.level===0)return;const r=this.elevationBoundsMin,s=this.elevationBoundsMax,n=this._getPatchType(),o=this.surface.isWebMercator,a=o&&n===cd.HAS_NORTH_POLE,l=o&&n===cd.HAS_SOUTH_POLE,c=l||a,h=Math.PI/2,d=e[0],f=e[2],m=l?-h:e[1],g=a?h:e[3],v=.5*(d+f),_=r,b=i+(c?Math.min(0,_-1):_),w=(j,B,te)=>Qw(j,B,te,b),x=$(),S=$(),C=$(),T=$();w(x,d,m),w(S,d,g),w(C,f,g),w(T,f,m);const M=(j,B)=>{for(let te=0;te<3;++te)this._convexHull[3*B+te]=j[te]};M(x,0),M(S,1),M(C,2),M(T,3);const I=s,D=i+(c?Math.max(0,I+1):I),P=$(),F=$(),L=$();Qw(F,v,g,b),Qw(L,v,m,b),oe(P,F,L),ae(P,P);const N=$(),R=$(),k=(j,B)=>{Fi(R,j,B),ae(R,R);const te=-fe(j,N)/fe(R,N);Ie(te>=0),re(R,R,te),oe(j,j,R)};if(2**this.lij[0]>2*this.lij[1]){const j=L,B=$();ct(B,Zve,j),ae(B,B),ct(N,j,B),ae(N,N),Ie(hd(fe(N,j)/ja(j),0)),k(x,S),k(T,C),M(x,0),M(T,3)}else if(2**this.lij[0]!==2*this.lij[1]){const j=F,B=$();ct(B,Zve,j),ae(B,B),ct(N,B,j),ae(N,N),k(S,x),k(C,T),M(S,1),M(C,2)}const W=(j,B)=>{const te=D/fe(B,P);for(let le=0;le<3;++le)this._convexHull[3*j+le]=B[le]*te};W(4,x),W(5,S),W(6,C),W(7,T)}_getPatchType(){const e=this.lij[1],i=e===0,r=e===(1<<this.level)-1;return i?r?cd.HAS_BOTH_POLES:cd.HAS_NORTH_POLE:r?cd.HAS_SOUTH_POLE:cd.REGULAR}intersectsRay(e,i,r,s){const n=this._boundingSphere,o=n[3]+r,a=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=n[0]-e[0],c=n[1]-e[1],h=n[2]-e[2],d=(l*i[0]+c*i[1]+h*i[2])/a,f=i[0]*d-l,m=i[1]*d-c,g=i[2]*d-h;return f*f+m*m+g*g<o*o}get minimumVerticesPerSide(){return this.level<Wve.length?Wve[this.level]+1:2}updateCornerElevations(){pAt(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){hAt(this.renderData),this._updateBoundingVolumes()}updateEdgeElevationsAndResolutions(){dAt(this.renderData),this._updateBoundingVolumes()}_checkBVs(){var me;if(!Kn||this.level<=2)return;const e=this._boundingSphere,i=e[3],r=e,s=$(),n=this.ellipsoid.radius,o=this.elevationBoundsMin,a=this.elevationBoundsMax,l=n+o,c=1,h=0,d=this._center[nn.MIDDLE][3],f=this.convexHull,m=(ye,we)=>{for(let ke=0;ke<3;++ke)ye[ke]=f[3*we+ke]};{const ye=$(),we=$(),ke=$(),Ge=$(),Ot=$(),He=(yt,Se,ze,bt)=>{m(we,yt),m(ke,Se),m(Ge,ze),Fi(we,we,ke),Fi(Ge,Ge,ke),ct(ye,we,Ge),ae(ye,ye);const qi=fe(ye,ke);m(Ot,bt);const ji=fe(ye,Ot),ur=Math.abs(ji-qi);Ie(hd(ur,0),`Non coplanar ${yt},${Se},${ze},${bt} diff = ${ur}`)};He(0,1,2,3),He(4,5,6,7),He(0,1,4,5),He(1,2,5,6),He(2,3,6,7),He(3,0,7,4)}const g=cc(24),v=(ye,we,ke)=>{const Ge=4*ye;for(let Ot=0;Ot<3;++Ot)g[Ge+Ot]=we[Ot];g[Ge+3]=ke},_=$(),b=$(),w=$(),x=$(),S=(ye,we,ke,Ge)=>{m(_,we),m(b,ke),m(w,Ge),Fi(_,_,b),ae(_,_),Fi(w,w,b),ae(w,w),ct(x,_,w),ae(x,x);const Ot=fe(x,b);v(ye,x,Ot)};S(0,0,1,2),S(1,1,0,4),S(2,1,5,2),S(3,3,2,6),S(4,4,0,3),S(5,4,6,5);const C=(ye,we,ke,Ge)=>{const Ot=4*ye;return g[Ot]*we+g[Ot+1]*ke+g[Ot+2]*Ge-g[Ot+3]},T=(ye,we,ke,Ge)=>C(ye,we,ke,Ge)>=-1,M=(ye,we)=>T(ye,we[0],we[1],we[2]),I=2**this.lij[0]>2*this.lij[1],D=(ye,we,ke)=>Math.sqrt(w4e(ye,we,ke,r[0],r[1],r[2]))<i,P=ye=>D(ye[0],ye[1],ye[2]),F=(ye,we)=>D(ye[we],ye[we+1],ye[we+2]),L=this.extentInRadians,N=.5*(L[0]+L[2]),R=L[1],k=L[3],W=$(),j=$();Qw(W,N,k,l),Qw(j,N,R,l);const B=I?"Upper":"Lower";let te=!0;for(let ye=0;ye<6;++ye){for(let we=0;we<8;++we){const ke=3*we,Ge=T(ye,f[ke],f[ke+1],f[ke+2]);te&&(te=Ge),Ie(Ge,`Tile[${this.lij}] Convex hull point ${we} outside of plane ${ye}`)}Ie(M(ye,j),`Tile[${this.lij}] (${B}) bottom mid outside of plane ${ye}`),Ie(M(ye,W),`Tile[${this.lij}] (${B}) top mid outside of plane ${ye}`)}Ie(te,"Not all convex hull points are inside  convex hull polyhedron"),Ie(P(j),`Tile[${this.lij}] (${B}) bottom mid outside of bounding sphere`),Ie(P(W),`Tile[${this.lij}] (${B}) top mid outside of bounding sphere`);for(let ye=0;ye<8;++ye){const we=F(f,3*ye);Ie(we,`Tile[${this.lij}] Convex hull point ${ye} outside of bounding sphere`)}for(let ye=0;ye<6;++ye)for(let we=0;we<8;++we){const ke=3*we;T(ye,f[ke],f[ke+1],f[ke+2])||console.error(`Tile[${this.lij}] Convex hull point ${we} outside of plane ${ye}`)}const{extentInRadians:le}=this,de=Math.max(le[2]-le[0],le[3]-le[1]),Ae=Math.round(de*n),{renderData:We}=this;if(!We)return;const{geometry:Ue,geometryState:it,localOrigin:Et}=We,Jt=(me=Ue.vertexAttributes)==null?void 0:me.position;if(!Jt)return;const wt=$(),vt=Ue.numVerticesPerSide-2,{indices:Ft,indexCount:xt,edgeVerticesStartIndex:zt,poleVerticesStartIndex:ut}=Ue;if(!Ft)return;const _t=new Set;for(let ye=0;ye<xt;++ye){const we=Ft[ye];if(_t.has(we))continue;_t.add(we);const ke=we<ut,Ge=we>=zt;let Ot=!1,He=-1;if(Ge){let Ht=zt;for(let Xt=0;Xt<4;++Xt){const xi=it.edgeResolutions[Xt];if(we===Ht||we===Ht+xi-1){Ot=!0;break}if(Ht+=xi,we<Ht){He=Xt;break}}}const yt=Ge?it.edgePeerNeighbors[He]:null,Se=Ge&&yt&&Fm(this,yt)>0;Jt.getVec(we,s),oe(wt,s,Et);const ze=ja(wt)-n;let bt=0,qi=!1;const ji=o-ze,ur=ze-a,ir=ji>c,Xi=ur>c,$i=ir||Xi,zi=()=>{const Ht=ke?"internal":Ge&&!Ot?"edge":Ot?"corner":"pole";return`Tile[${this.lij}].vertex[${we}]:${Ht}`+(ir?"(below)":Xi?"(above)":"")+(Se?"(Neighbor)":"")},Ai=Ba(wt,r);if(Ai>=i+h){const Ht=Ai-i;$i||(console.error(`${zi()} is out of the bounding sphere by ${Ht.toFixed(0)} / ${i.toFixed(0)}[tol=${h}] h=${ze.toFixed(0)} / [${o.toFixed(0)}..${a.toFixed(0)}] (${(Ht/i).toFixed(0)})`),qi=!0)}for(let Ht=0;Ht<6;++Ht)if(!T(Ht,wt[0],wt[1],wt[2])){const Xt=C(Ht,wt[0],wt[1],wt[2]),xi=we%vt,Wi=(we-xi)/vt;Ht===0&&ji||Ht===5&&ur||(console.error(`${zi()} (${xi},${Wi})|${vt}] is out of the bounding trapezoid plane ${Ht} h=${Math.round(ze)} / [${Math.round(o)}..${Math.round(a)}] dist=${Math.round(Xt)} radii = ${Math.round(i)}/${Math.round(d)}} : maxL = ${Ae}`),++bt)}if(qi||bt>0)break}}get convexHull(){return this._convexHull}};const Wve=[128,64,64,32,16,8,8,4];function PAt(t,e,i){return w4e(t[0],t[1],t[2],e[i],e[i+1],e[i+2])}function w4e(t,e,i,r,s,n){const o=r-t,a=s-e,l=n-i;return o*o+a*a+l*l}const Qw=(t,e,i,r)=>{const s=Math.cos(e),n=Math.sin(e),o=Math.cos(i),a=Math.sin(i);t[0]=r*o*s,t[1]=r*o*n,t[2]=r*a},Zve=[0,0,1],Yve=$(),Jve=$();let xp=class extends he{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};u([p()],xp.prototype,"fovX",void 0),u([p()],xp.prototype,"fovY",void 0),u([p()],xp.prototype,"relativeWidthLimit",void 0),u([p()],xp.prototype,"relativeHeightLimit",void 0),u([p()],xp.prototype,"maxLod",void 0),u([p()],xp.prototype,"angledSplitBias",void 0),u([p()],xp.prototype,"aboveGround",void 0),u([p()],xp.prototype,"frustum",void 0),xp=u([A("esri.views.3d.terrain.SplitLimits")],xp);const DAt=Bd().vec3f(z.POSITION).vec2i16(z.UV0).vec2i16(z.NORMALCOMPRESSED,{glNormalized:!0});let LAt=class{constructor(e){this._storage=new UL((i,r)=>e.newCache(i,r),"TileGeometry")}acquire(e){const r=Math.ceil(e/4)*4,s=this._storage,n=NAt(r),o=s.pop(n);if(o)return o;const a=DAt.createBuffer(r);return a.release=()=>s.put(n,a),a}clear(){this._storage.clear()}destroy(){this._storage.destroy()}};function NAt(t){return t.toString()}let x4e=class extends cr{constructor(){super(...arguments),this.scale=1,this.offset=TS}};function S4e(t){t.attributes.add(z.POSITION,"vec2"),t.attributes.add(z.UV0,"vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.uniforms.add(new mt("scale",e=>e.scale),new yc("offset",e=>e.offset)),t.vertex.main.add(E`gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;`)}var mn;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(mn||(mn={}));var Pe;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(Pe||(Pe={}));const tQ={normal:Pe.Normal,average:Pe.Average,lighten:Pe.Lighten,lighter:Pe.Lighter,screen:Pe.Screen,plus:Pe.Plus,"color-dodge":Pe.ColorDodge,darken:Pe.Darken,multiply:Pe.Multiply,"color-burn":Pe.ColorBurn,overlay:Pe.Overlay,"soft-light":Pe.SoftLight,"hard-light":Pe.HardLight,"vivid-light":Pe.VividLight,hue:Pe.Hue,saturation:Pe.Saturation,luminosity:Pe.Luminosity,color:Pe.Color,difference:Pe.Difference,exclusion:Pe.Exclusion,minus:Pe.Minus,invert:Pe.Invert,reflect:Pe.Reflect,"destination-over":Pe.DestinationOver,"destination-atop":Pe.DestinationAtop,"destination-in":Pe.DestinationIn,"destination-out":Pe.DestinationOut,"source-atop":Pe.SourceAtop,"source-in":Pe.SourceIn,"source-out":Pe.SourceOut,xor:Pe.Xor};function FAt(t){return t===Pe.DestinationOver||t===Pe.DestinationAtop||t===Pe.DestinationIn||t===Pe.DestinationOut||t===Pe.SourceAtop||t===Pe.SourceIn||t===Pe.SourceOut||t===Pe.Xor}var ka;(function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"})(ka||(ka={}));var ed;(function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"})(ed||(ed={}));function kAt(t,e){const i=e.blendMode;i!==Pe.Normal&&(i===Pe.Reflect&&t.code.add(E`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),i!==Pe.ColorDodge&&i!==Pe.VividLight||t.code.add(E`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),i!==Pe.ColorBurn&&i!==Pe.VividLight||t.code.add(E`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),i===Pe.Overlay&&t.code.add(E`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),i===Pe.HardLight&&t.code.add(E`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),i===Pe.SoftLight&&t.code.add(E`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),i===Pe.VividLight&&t.code.add(E`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),i!==Pe.Hue&&i!==Pe.Saturation&&i!==Pe.Color&&i!==Pe.Luminosity||(t.code.add(E`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),i!==Pe.Hue&&i!==Pe.Saturation||t.code.add(E`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(E`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${i===Pe.Multiply?E`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.Average?E`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.Lighten?E`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.Darken?E`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.Lighter?E`return vec4(cl * ol + cb * ob, ol + ob);`:i===Pe.Plus?E`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:i===Pe.Minus?E`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:i===Pe.Screen?E`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.Difference?E`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.Invert?E`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Pe.DestinationOver?E`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:i===Pe.DestinationAtop?E`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:i===Pe.DestinationOut?E`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:i===Pe.SourceAtop?E`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Pe.SourceOut?E`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:i===Pe.Xor?E`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:i===Pe.DestinationIn?E`return vec4(cb * ob * ol, ol * ob);`:i===Pe.SourceIn?E`return vec4(cl * ol * ob, ol * ob);`:i===Pe.Hue?E`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.Saturation?E`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.Color?E`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.Luminosity?E`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.Exclusion?E`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.Reflect?E`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.ColorDodge?E`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.ColorBurn?E`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.Overlay?E`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.SoftLight?E`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.HardLight?E`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.VividLight?E`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:E``}
    }
  `))}function T4e(t,e){const i=e.output===mn.GridComposite,r=e.output===mn.ColorComposite,s=e.output===mn.GroupBackgroundComposite,n=e.output===mn.Composite,o=e.baseOpacityMode===ka.Required,a=t.fragment;o&&a.uniforms.add(new mt("baseOpacity",d=>d.baseOpacity)),i?a.include(vae):r?a.uniforms.add(new $r("backgroundColor",d=>d.backgroundColor)):n&&a.uniforms.add(new It("fboColor",d=>d.fboTexture));const l=e.blendMode!==Pe.Normal,c=e.premultipliedSource===ed.On,h=!l&&!c&&(n&&!o||s);a.include(kAt,e),a.code.add(E`
    vec4 getBackground(vec2 uv) {
      return ${o?E`baseOpacity *`:""} ${s?E`vec4(0.0, 0.0, 0.0, 0.0)`:r?E`vec4(backgroundColor, 1.0)`:i?E`vec4(gridColor(uv), 1.0)`:E`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec2 bgUV, vec4 colorLayer, float opacity) {
      ${l?E`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec4 bgColor = getBackground(bgUV);
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:E`
          float composeAlpha = colorLayer.a * opacity;
          ${h?E`return colorLayer * opacity;`:E`
            vec4 bgColor = getBackground(bgUV);
            return bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}var Nv;function E4e(t){const e=new Vi,i=e.fragment;if(e.include(S4e),t.background===Nv.Only){const r=t.output===mn.ColorComposite;return r?i.uniforms.add(new $r("backgroundColor",s=>s.backgroundColor)):i.include(vae),i.main.add(E`fragColor = vec4(${r?E`backgroundColor`:E`gridColor(uv)`}, 1.0);`),e}return e.include(T4e,t),i.uniforms.add(new It("tex",r=>r.texture),new mt("opacity",r=>r.opacity)),i.main.add(E`fragColor = blendLayers(uv, texture(tex, uv), opacity);`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(Nv||(Nv={}));const zAt=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return Nv},build:E4e},Symbol.toStringTag,{value:"Module"}));let UAt=class extends x4e{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=cn}},Xve=class extends Hi{constructor(e,i){super(e,i,new Bi(zAt,()=>G(()=>Promise.resolve().then(()=>lHt),void 0)))}};var aS,kS;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(aS||(aS={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}(kS||(kS={}));let BAt=class{constructor(e,i){this.sourceTile=i,this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.featureIndex=0,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},VAt=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};const Vli=!0,jAt=32,jli=1.5,GAt=200;var iQ,Kve,Qve;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(iQ||(iQ={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(Kve||(Kve={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(Qve||(Qve={}));const HAt=512;var Dy,ha;(function(t){t[t.Unknown=0]="Unknown",t[t.Point=1]="Point",t[t.LineString=2]="LineString",t[t.Polygon=3]="Polygon"})(Dy||(Dy={}));let Ua=class lz{constructor(e,i){this.x=e,this.y=i}clone(){return new lz(this.x,this.y)}equals(e,i){return e===this.x&&i===this.y}isEqual(e){return e.x===this.x&&e.y===this.y}setCoords(e,i){return this.x=e,this.y=i,this}normalize(){const e=this.x,i=this.y,r=Math.sqrt(e*e+i*i);return this.x/=r,this.y/=r,this}rightPerpendicular(){const e=this.x;return this.x=this.y,this.y=-e,this}leftPerpendicular(){const e=this.x;return this.x=-this.y,this.y=e,this}move(e,i){return this.x+=e,this.y+=i,this}assign(e){return this.x=e.x,this.y=e.y,this}assignAdd(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}assignSub(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}rotate(e,i){const r=this.x,s=this.y;return this.x=r*e-s*i,this.y=r*i+s*e,this}scale(e){return this.x*=e,this.y*=e,this}length(){const e=this.x,i=this.y;return Math.sqrt(e*e+i*i)}sub(e){return this.x-=e.x,this.y-=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}static distance(e,i){const r=i.x-e.x,s=i.y-e.y;return Math.sqrt(r*r+s*s)}static add(e,i){return new lz(e.x+i.x,e.y+i.y)}static sub(e,i){return new lz(e.x-i.x,e.y-i.y)}},xk=class{constructor(e,i,r){this.ratio=e,this.x=i,this.y=r}},Hli=class{constructor(e,i,r,s=8,n=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=s,this._pixelMargin=n,this._tileSize=HAt*s,this._dz=e,this._yPos=i,this._xPos=r}setPixelMargin(e){e!==this._pixelMargin&&(this._pixelMargin=e,this.setExtent(this._extent))}setExtent(e){this._extent=e,this._finalRatio=this._tileSize/e*(1<<this._dz);let i=this._pixelRatio*this._pixelMargin;i/=this._finalRatio;const r=e>>this._dz;i>r&&(i=r),this._margin=i,this._xmin=r*this._xPos-i,this._ymin=r*this._yPos-i,this._xmax=this._xmin+r+2*i,this._ymax=this._ymin+r+2*i}reset(e){this._type=e,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(e,i){this._pushLine(),this._prevIsIn=this._isIn(e,i),this._moveTo(e,i,this._prevIsIn),this._prevPt=new Ua(e,i),this._firstPt=new Ua(e,i),this._dist=0}lineTo(e,i){const r=this._isIn(e,i),s=new Ua(e,i),n=Ua.distance(this._prevPt,s);let o,a,l,c,h,d,f,m;if(r)this._prevIsIn?this._lineTo(e,i,!0):(o=this._prevPt,a=s,l=this._intersect(a,o),this._start=this._dist+n*(1-this._r),this._lineTo(l.x,l.y,!0),this._lineTo(a.x,a.y,!0));else if(this._prevIsIn)a=this._prevPt,o=s,l=this._intersect(a,o),this._lineTo(l.x,l.y,!0),this._lineTo(o.x,o.y,!1);else{const g=this._prevPt,v=s;if(g.x<=this._xmin&&v.x<=this._xmin||g.x>=this._xmax&&v.x>=this._xmax||g.y<=this._ymin&&v.y<=this._ymin||g.y>=this._ymax&&v.y>=this._ymax)this._lineTo(v.x,v.y,!1);else{const _=[];if((g.x<this._xmin&&v.x>this._xmin||g.x>this._xmin&&v.x<this._xmin)&&(c=(this._xmin-g.x)/(v.x-g.x),m=g.y+c*(v.y-g.y),m<=this._ymin?d=!1:m>=this._ymax?d=!0:_.push(new xk(c,this._xmin,m))),(g.x<this._xmax&&v.x>this._xmax||g.x>this._xmax&&v.x<this._xmax)&&(c=(this._xmax-g.x)/(v.x-g.x),m=g.y+c*(v.y-g.y),m<=this._ymin?d=!1:m>=this._ymax?d=!0:_.push(new xk(c,this._xmax,m))),(g.y<this._ymin&&v.y>this._ymin||g.y>this._ymin&&v.y<this._ymin)&&(c=(this._ymin-g.y)/(v.y-g.y),f=g.x+c*(v.x-g.x),f<=this._xmin?h=!1:f>=this._xmax?h=!0:_.push(new xk(c,f,this._ymin))),(g.y<this._ymax&&v.y>this._ymax||g.y>this._ymax&&v.y<this._ymax)&&(c=(this._ymax-g.y)/(v.y-g.y),f=g.x+c*(v.x-g.x),f<=this._xmin?h=!1:f>=this._xmax?h=!0:_.push(new xk(c,f,this._ymax))),_.length===0)h?d?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):d?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(_.length>1&&_[0].ratio>_[1].ratio)this._start=this._dist+n*_[1].ratio,this._lineTo(_[1].x,_[1].y,!0),this._lineTo(_[0].x,_[0].y,!0);else{this._start=this._dist+n*_[0].ratio;for(let b=0;b<_.length;b++)this._lineTo(_[b].x,_[b].y,!0)}this._lineTo(v.x,v.y,!1)}}this._dist+=n,this._prevIsIn=r,this._prevPt=s}close(){if(this._line.length>2){const e=this._firstPt,i=this._prevPt;e.x===i.x&&e.y===i.y||this.lineTo(e.x,e.y);const r=this._line;let s=r.length;for(;s>=4&&(r[0].x===r[1].x&&r[0].x===r[s-2].x||r[0].y===r[1].y&&r[0].y===r[s-2].y);)r.pop(),r[0].x=r[s-2].x,r[0].y=r[s-2].y,--s}}result(e=!0){return this._pushLine(),this._lines.length===0?null:(this._type===Dy.Polygon&&e&&qAt.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(this._type!==Dy.LineString)throw new Error("Only valid for lines");this._pushLine();const e=this._lines,i=e.length;if(i===0)return null;const r=[];for(let s=0;s<i;s++)r.push({line:e[s],start:this._starts[s]||0});return r}_isIn(e,i){return e>=this._xmin&&e<=this._xmax&&i>=this._ymin&&i<=this._ymax}_intersect(e,i){let r,s,n;if(i.x>=this._xmin&&i.x<=this._xmax)s=i.y<=this._ymin?this._ymin:this._ymax,n=(s-e.y)/(i.y-e.y),r=e.x+n*(i.x-e.x);else if(i.y>=this._ymin&&i.y<=this._ymax)r=i.x<=this._xmin?this._xmin:this._xmax,n=(r-e.x)/(i.x-e.x),s=e.y+n*(i.y-e.y);else{s=i.y<=this._ymin?this._ymin:this._ymax,r=i.x<=this._xmin?this._xmin:this._xmax;const o=(r-e.x)/(i.x-e.x),a=(s-e.y)/(i.y-e.y);o<a?(n=o,s=e.y+o*(i.y-e.y)):(n=a,r=e.x+a*(i.x-e.x))}return this._r=n,new Ua(r,s)}_pushLine(){this._line&&(this._type===Dy.Point?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===Dy.LineString?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===Dy.Polygon&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(e,i,r){this._type!==Dy.Polygon?r&&(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.push(new Ua(e,i))):(r||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),i<this._ymin&&(i=this._ymin),i>this._ymax&&(i=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.push(new Ua(e,i)),this._isH=!1,this._isV=!1)}_lineTo(e,i,r){let s,n;if(this._type!==Dy.Polygon)if(r){if(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(s=this._line[this._line.length-1],s.equals(e,i)))return;this._line.push(new Ua(e,i))}else this._line&&this._line.length>0&&this._pushLine();else if(r||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),i<this._ymin&&(i=this._ymin),i>this._ymax&&(i=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){s=this._line[this._line.length-1];const o=s.x===e,a=s.y===i;if(o&&a)return;this._isH&&o||this._isV&&a?(s.x=e,s.y=i,n=this._line[this._line.length-2],n.x===e&&n.y===i?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(n=this._line[this._line.length-2],this._isH=n.x===e,this._isV=n.y===i)):(this._isH=n.x===e,this._isV=n.y===i)):(this._line.push(new Ua(e,i)),this._isH=o,this._isV=a)}else this._line.push(new Ua(e,i))}},Wli=class{setExtent(e){this._ratio=e===4096?1:4096/e}get validateTessellation(){return this._ratio<1}reset(e){this._lines=[],this._line=null}moveTo(e,i){this._line&&this._lines.push(this._line),this._line=[];const r=this._ratio;this._line.push(new Ua(e*r,i*r))}lineTo(e,i){const r=this._ratio;this._line.push(new Ua(e*r,i*r))}close(){const e=this._line;e&&!e[0].isEqual(e[e.length-1])&&e.push(e[0])}result(){return this._line&&this._lines.push(this._line),this._lines.length===0?null:this._lines}};(function(t){t[t.sideLeft=0]="sideLeft",t[t.sideRight=1]="sideRight",t[t.sideTop=2]="sideTop",t[t.sideBottom=3]="sideBottom"})(ha||(ha={}));let qAt=class l_{static simplify(e,i,r){if(!r)return;const s=-i,n=e+i,o=-i,a=e+i,l=[],c=[],h=r.length;for(let f=0;f<h;++f){const m=r[f];if(!m||m.length<2)continue;let g,v=m[0];const _=m.length;for(let b=1;b<_;++b)g=m[b],v.x===g.x&&(v.x<=s&&(v.y>g.y?(l.push(f),l.push(b),l.push(ha.sideLeft),l.push(-1)):(c.push(f),c.push(b),c.push(ha.sideLeft),c.push(-1))),v.x>=n&&(v.y<g.y?(l.push(f),l.push(b),l.push(ha.sideRight),l.push(-1)):(c.push(f),c.push(b),c.push(ha.sideRight),c.push(-1)))),v.y===g.y&&(v.y<=o&&(v.x<g.x?(l.push(f),l.push(b),l.push(ha.sideTop),l.push(-1)):(c.push(f),c.push(b),c.push(ha.sideTop),c.push(-1))),v.y>=a&&(v.x>g.x?(l.push(f),l.push(b),l.push(ha.sideBottom),l.push(-1)):(c.push(f),c.push(b),c.push(ha.sideBottom),c.push(-1)))),v=g}if(l.length===0||c.length===0)return;l_.fillParent(r,c,l),l_.fillParent(r,l,c);const d=[];l_.calcDeltas(d,c,l),l_.calcDeltas(d,l,c),l_.addDeltas(d,r)}static fillParent(e,i,r){const s=r.length,n=i.length;for(let o=0;o<n;o+=4){const a=i[o],l=i[o+1],c=i[o+2],h=e[a][l-1],d=e[a][l];let f=8092,m=-1;for(let g=0;g<s;g+=4){if(r[g+2]!==c)continue;const v=r[g],_=r[g+1],b=e[v][_-1],w=e[v][_];switch(c){case ha.sideLeft:case ha.sideRight:if(Sk(h.y,b.y,w.y)&&Sk(d.y,b.y,w.y)){const x=Math.abs(w.y-b.y);x<f&&(f=x,m=g)}break;case ha.sideTop:case ha.sideBottom:if(Sk(h.x,b.x,w.x)&&Sk(d.x,b.x,w.x)){const x=Math.abs(w.x-b.x);x<f&&(f=x,m=g)}}}i[o+3]=m}}static calcDeltas(e,i,r){const s=i.length;for(let n=0;n<s;n+=4){const o=[],a=l_.calcDelta(n,i,r,o);e.push(i[n]),e.push(i[n+1]),e.push(i[n+2]),e.push(a)}}static calcDelta(e,i,r,s){const n=i[e+3];if(n===-1)return 0;const o=s.length;return o>1&&s[o-2]===n?0:(s.push(n),l_.calcDelta(n,r,i,s)+1)}static addDeltas(e,i){const r=e.length;let s=0;for(let n=0;n<r;n+=4){const o=e[n+3];o>s&&(s=o)}for(let n=0;n<r;n+=4){const o=i[e[n]],a=e[n+1],l=s-e[n+3];switch(e[n+2]){case ha.sideLeft:o[a-1].x-=l,o[a].x-=l,a===1&&(o[o.length-1].x-=l),a===o.length-1&&(o[0].x-=l);break;case ha.sideRight:o[a-1].x+=l,o[a].x+=l,a===1&&(o[o.length-1].x+=l),a===o.length-1&&(o[0].x+=l);break;case ha.sideTop:o[a-1].y-=l,o[a].y-=l,a===1&&(o[o.length-1].y-=l),a===o.length-1&&(o[0].y-=l);break;case ha.sideBottom:o[a-1].y+=l,o[a].y+=l,a===1&&(o[o.length-1].y+=l),a===o.length-1&&(o[0].y+=l)}}}};const Sk=(t,e,i)=>t>=e&&t<=i||t>=i&&t<=e,Yli=Number.POSITIVE_INFINITY,Iae=Math.PI,Jli=2*Iae,WAt=128/Iae,ZAt=256/360,Xli=Iae/180,YAt=1/Math.LN2;function C4e(t,e){return(t%=e)>=0?t:t+e}function Kli(t){return C4e(t*WAt,256)}function Qli(t){return C4e(t*ZAt,256)}function eci(t){return Math.log(t)*YAt}function tci(t,e,i){return t*(1-i)+e*i}const JAt=8,XAt=14,KAt=16;function ici(t){return JAt+Math.max((t-XAt)*KAt,0)}function rci(t,e,i){let r,s,n,o=0;for(const a of i){r=a.length;for(let l=1;l<r;++l)s=a[l-1],n=a[l],s.y>e!=n.y>e&&((n.x-s.x)*(e-s.y)-(n.y-s.y)*(t-s.x)>0?o++:o--)}return o!==0}function sci(t,e,i,r){let s,n,o,a;const l=r*r;for(const c of i){const h=c.length;if(!(h<2)){s=c[0].x,n=c[0].y;for(let d=1;d<h;++d){if(o=c[d].x,a=c[d].y,v8e(t,e,s,n,o,a)<l)return!0;s=o,n=a}}}return!1}function QAt(t,e,i,r,s,n,o){const a=Math.max(r,Math.min(e,n))-e,l=Math.max(s,Math.min(i,o))-i;return a*a+l*l<=t*t}function nci(t,e){if(e===0||Number.isNaN(e))return t;const i=[],r=new Ua(0,0),s=new Ua(0,0),n=new Ua(0,0);for(let o=0;o<t.length;o++){const a=t[o],l=[];for(let c=0;c<a.length;c++){const h=a[c-1],d=a[c],f=a[c+1];c===0?r.setCoords(0,0):r.assignSub(d,h).normalize().rightPerpendicular(),c===a.length-1?s.setCoords(0,0):s.assignSub(f,d).normalize().rightPerpendicular(),n.assignAdd(r,s).normalize();const m=n.x*s.x+n.y*s.y;m!==0&&n.scale(1/m),l.push(Ua.add(d,n.scale(e)))}i.push(l)}return i}function oci(t,e,i,r){const s=new Ua(t[0],t[1]);if(s.scale(r),e==="viewport"){const n=-i*(Math.PI/180),o=Math.cos(n),a=Math.sin(n);s.rotate(o,a)}return s}function e0e(t,e,i,r,s,n){const o=i-s;if(o>=0)return(e>>o)+(r-(n<<o))*(t>>o);const a=-o;return e-(n-(r<<a))*(t>>a)<<a}let $4e=class{constructor(e,i,r){this._rows=Math.ceil(i/r),this._columns=Math.ceil(e/r),this._cellSize=r,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(e,i){const r=Math.min(Math.max(Math.floor(i/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][s]||null}getCellSpan(e,i,r,s){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function lci(t,e,i,r,s,n,o){const a=e[r++];for(let l=0;l<a;l++){const c=new BAt(n,o);c.xTile=e[r++],c.yTile=e[r++],c.hash=e[r++],c.priority=e[r++],c.featureIndex=e[r++];const h=e[r++];for(let m=0;m<h;m++){const g=e[r++],v=e[r++],_=e[r++],b=e[r++],w=!!e[r++],x=e[r++],S=i[r++],C=i[r++],T=e[r++],M=e[r++];c.colliders.push({xTile:g,yTile:v,dxPixels:_,dyPixels:b,hard:w,partIndex:x,width:T,height:M,minLod:S,maxLod:C})}const d=t[r++];for(let m=0;m<d;m++)c.textVertexRanges.push([t[r++],t[r++]]);const f=t[r++];for(let m=0;m<f;m++)c.iconVertexRanges.push([t[r++],t[r++]]);s.push(c)}return r}function eMt(t,e,i){for(const[r,s]of t.symbols)tMt(t,e,i,s,r)}function tMt(t,e,i,r,s){const n=t.layerData.get(s);if(n.type===iQ.SYMBOL){for(const o of r){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],h=c.startOpacity,d=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&d===0;const f=i?Math.floor(127*h)|d<<7:d?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.iconVertexRanges)for(let d=c;d<c+h;d+=4)n.iconOpacity[d/4]=l;if(o.selectedForRendering){const c=a.parts[1],h=c.startOpacity,d=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&d===0;const f=i?Math.floor(127*h)|d<<7:d?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.textVertexRanges)for(let d=c;d<c+h;d+=4)n.textOpacity[d/4]=l}n.lastOpacityUpdate=e,n.opacityChanged=!0}}function iMt(t,e,i,r){const s=t.colliders;let n,o,a,l;for(const c of s)if(t.unique.show&&t.unique.parts[c.partIndex].show&&(n=c.xScreen-r[0]+c.dxScreen,o=c.yScreen-r[1]+c.dyScreen,a=n+c.width,l=o+c.height,QAt(i,e.x,e.y,n,o,a,l)))return!0;return!1}var rQ,sQ,t0e,i0e,r0e,s0e,n0e,o0e,a0e,l0e,nQ,oQ,c0e,u0e,h0e,d0e,p0e,f0e,m0e,g0e,y0e,v0e,_0e,b0e,w0e,x0e,S0e,T0e,E0e,C0e,$0e,A0e,M0e,O0e,I0e,R0e,P0e,D0e,L0e,N0e,F0e,k0e,z0e,U0e,B0e,V0e,j0e,G0e,H0e,q0e,W0e,Z0e,Y0e,J0e,X0e,hV,K0e,Q0e,e_e,t_e,i_e,r_e,s_e;(function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE",t[t.UNKNOWN=4]="UNKNOWN"})(rQ||(rQ={})),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER",t[t.UNKNOWN=4]="UNKNOWN"}(sQ||(sQ={})),function(t){t[t.SCREEN=0]="SCREEN",t[t.MAP=1]="MAP"}(t0e||(t0e={})),function(t){t[t.Tint=0]="Tint",t[t.Ignore=1]="Ignore",t[t.Multiply=99]="Multiply"}(i0e||(i0e={})),function(t){t.Both="Both",t.JustBegin="JustBegin",t.JustEnd="JustEnd",t.None="None"}(r0e||(r0e={})),function(t){t[t.Mosaic=0]="Mosaic",t[t.Centered=1]="Centered"}(s0e||(s0e={})),function(t){t[t.Normal=0]="Normal",t[t.Superscript=1]="Superscript",t[t.Subscript=2]="Subscript"}(n0e||(n0e={})),function(t){t[t.MSSymbol=0]="MSSymbol",t[t.Unicode=1]="Unicode"}(o0e||(o0e={})),function(t){t[t.Unspecified=0]="Unspecified",t[t.TrueType=1]="TrueType",t[t.PSOpenType=2]="PSOpenType",t[t.TTOpenType=3]="TTOpenType",t[t.Type1=4]="Type1"}(a0e||(a0e={})),function(t){t[t.Display=0]="Display",t[t.Map=1]="Map"}(l0e||(l0e={})),function(t){t.None="None",t.Loop="Loop",t.Oscillate="Oscillate"}(nQ||(nQ={})),function(t){t.Linear="Linear",t.EaseIn="EaseIn",t.EaseOut="EaseOut",t.EaseInOut="EaseInOut"}(oQ||(oQ={})),function(t){t[t.Z=0]="Z",t[t.X=1]="X",t[t.Y=2]="Y"}(c0e||(c0e={})),function(t){t[t.XYZ=0]="XYZ",t[t.ZXY=1]="ZXY",t[t.YXZ=2]="YXZ"}(u0e||(u0e={})),function(t){t[t.Rectangle=0]="Rectangle",t[t.RoundedRectangle=1]="RoundedRectangle",t[t.Oval=2]="Oval"}(h0e||(h0e={})),function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.Screen=2]="Screen",t[t.Multiply=3]="Multiply",t[t.Add=4]="Add"}(d0e||(d0e={})),function(t){t[t.TTB=0]="TTB",t[t.RTL=1]="RTL",t[t.BTT=2]="BTT"}(p0e||(p0e={})),function(t){t[t.None=0]="None",t[t.SignPost=1]="SignPost",t[t.FaceNearPlane=2]="FaceNearPlane"}(f0e||(f0e={})),function(t){t[t.Float=0]="Float",t[t.String=1]="String",t[t.Boolean=2]="Boolean"}(m0e||(m0e={})),function(t){t[t.Intersect=0]="Intersect",t[t.Subtract=1]="Subtract"}(g0e||(g0e={})),function(t){t.OpenEnded="OpenEnded",t.Block="Block",t.Crossed="Crossed"}(y0e||(y0e={})),function(t){t.FullGeometry="FullGeometry",t.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",t.ReversedFirstSegment="ReversedFirstSegment",t.PerpendicularToSecondSegment="PerpendicularToSecondSegment",t.SecondSegmentWithTicks="SecondSegmentWithTicks",t.DoublePerpendicular="DoublePerpendicular",t.OppositeToFirstSegment="OppositeToFirstSegment",t.TriplePerpendicular="TriplePerpendicular",t.HalfCircleFirstSegment="HalfCircleFirstSegment",t.HalfCircleSecondSegment="HalfCircleSecondSegment",t.HalfCircleExtended="HalfCircleExtended",t.OpenCircle="OpenCircle",t.CoverageEdgesWithTicks="CoverageEdgesWithTicks",t.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",t.GapExtentMidline="GapExtentMidline",t.Chevron="Chevron",t.PerpendicularWithArc="PerpendicularWithArc",t.ClosedHalfCircle="ClosedHalfCircle",t.TripleParallelExtended="TripleParallelExtended",t.ParallelWithTicks="ParallelWithTicks",t.Parallel="Parallel",t.PerpendicularToFirstSegment="PerpendicularToFirstSegment",t.ParallelOffset="ParallelOffset",t.OffsetOpposite="OffsetOpposite",t.OffsetSame="OffsetSame",t.CircleWithArc="CircleWithArc",t.DoubleJog="DoubleJog",t.PerpendicularOffset="PerpendicularOffset",t.LineExcludingLastSegment="LineExcludingLastSegment",t.MultivertexArrow="MultivertexArrow",t.CrossedArrow="CrossedArrow",t.ChevronArrow="ChevronArrow",t.ChevronArrowOffset="ChevronArrowOffset",t.PartialFirstSegment="PartialFirstSegment",t.Arch="Arch",t.CurvedParallelTicks="CurvedParallelTicks",t.Arc90Degrees="Arc90Degrees",t.TipWithPerpendicularAndTicks="TipWithPerpendicularAndTicks",t.ConcentricCircles="ConcentricCircles",t.DoubleJogArrow="DoubleJogArrow",t.LinkedChevrons="LinkedChevrons",t.SegmentThenHalfCircle="SegmentThenHalfCircle",t.LineWithStraightTicks="LineWithStraightTicks",t.DoubleCurve="DoubleCurve",t.ParallelWithTicksByWidth="ParallelWithTicksByWidth",t.EnclosingRoundedRectangle="EnclosingRoundedRectangle"}(v0e||(v0e={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square",t.TrueBuffer="TrueBuffer"}(_0e||(_0e={})),function(t){t.ClosePath="ClosePath",t.ConvexHull="ConvexHull",t.RectangularBox="RectangularBox"}(b0e||(b0e={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(w0e||(w0e={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square"}(x0e||(x0e={})),function(t){t.Fast="Fast",t.Accurate="Accurate"}(S0e||(S0e={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(T0e||(T0e={})),function(t){t.Sinus="Sinus",t.Square="Square",t.Triangle="Triangle",t.Random="Random"}(E0e||(E0e={})),function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Force=2]="Force"}(C0e||(C0e={})),function(t){t[t.Buffered=0]="Buffered",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.AlongLine=3]="AlongLine"}($0e||($0e={})),function(t){t[t.Linear=0]="Linear",t[t.Rectangular=1]="Rectangular",t[t.Circular=2]="Circular",t[t.Buffered=3]="Buffered"}(A0e||(A0e={})),function(t){t[t.Discrete=0]="Discrete",t[t.Continuous=1]="Continuous"}(M0e||(M0e={})),function(t){t[t.AcrossLine=0]="AcrossLine",t[t.AlongLine=1]="AlongLine"}(O0e||(O0e={})),function(t){t[t.Auto=0]="Auto",t[t.Clockwise=1]="Clockwise",t[t.Counterclockwise=2]="Counterclockwise"}(I0e||(I0e={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Justify=3]="Justify"}(R0e||(R0e={})),function(t){t[t.Base=0]="Base",t[t.MidPoint=1]="MidPoint",t[t.ThreePoint=2]="ThreePoint",t[t.FourPoint=3]="FourPoint",t[t.Underline=4]="Underline",t[t.CircularCW=5]="CircularCW",t[t.CircularCCW=6]="CircularCCW"}(P0e||(P0e={})),function(t){t.Butt="Butt",t.Round="Round",t.Square="Square"}(D0e||(D0e={})),function(t){t.NoConstraint="NoConstraint",t.HalfPattern="HalfPattern",t.HalfGap="HalfGap",t.FullPattern="FullPattern",t.FullGap="FullGap",t.Custom="Custom"}(L0e||(L0e={})),function(t){t[t.None=-1]="None",t[t.Custom=0]="Custom",t[t.Circle=1]="Circle",t[t.OpenArrow=2]="OpenArrow",t[t.ClosedArrow=3]="ClosedArrow",t[t.Diamond=4]="Diamond"}(N0e||(N0e={})),function(t){t[t.ExtraLeading=0]="ExtraLeading",t[t.Multiple=1]="Multiple",t[t.Exact=2]="Exact"}(F0e||(F0e={})),function(t){t.Bevel="Bevel",t.Round="Round",t.Miter="Miter"}(k0e||(k0e={})),function(t){t[t.Default=0]="Default",t[t.String=1]="String",t[t.Numeric=2]="Numeric"}(z0e||(z0e={})),function(t){t[t.InsidePolygon=0]="InsidePolygon",t[t.PolygonCenter=1]="PolygonCenter",t[t.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(U0e||(U0e={})),function(t){t[t.Tint=0]="Tint",t[t.Replace=1]="Replace",t[t.Multiply=2]="Multiply"}(B0e||(B0e={})),function(t){t[t.ClipAtBoundary=0]="ClipAtBoundary",t[t.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",t[t.DoNotTouchBoundary=2]="DoNotTouchBoundary",t[t.DoNotClip=3]="DoNotClip"}(V0e||(V0e={})),function(t){t.NoConstraint="NoConstraint",t.WithMarkers="WithMarkers",t.WithFullGap="WithFullGap",t.WithHalfGap="WithHalfGap",t.Custom="Custom"}(j0e||(j0e={})),function(t){t.Fixed="Fixed",t.Random="Random",t.RandomFixedQuantity="RandomFixedQuantity"}(G0e||(G0e={})),function(t){t.LineMiddle="LineMiddle",t.LineBeginning="LineBeginning",t.LineEnd="LineEnd",t.SegmentMidpoint="SegmentMidpoint"}(H0e||(H0e={})),function(t){t.OnPolygon="OnPolygon",t.CenterOfMass="CenterOfMass",t.BoundingBoxCenter="BoundingBoxCenter"}(q0e||(q0e={})),function(t){t[t.Low=0]="Low",t[t.Medium=1]="Medium",t[t.High=2]="High"}(W0e||(W0e={})),function(t){t[t.MarkerCenter=0]="MarkerCenter",t[t.MarkerBounds=1]="MarkerBounds"}(Z0e||(Z0e={})),function(t){t[t.None=0]="None",t[t.PropUniform=1]="PropUniform",t[t.PropNonuniform=2]="PropNonuniform",t[t.DifUniform=3]="DifUniform",t[t.DifNonuniform=4]="DifNonuniform"}(Y0e||(Y0e={})),function(t){t.Tube="Tube",t.Strip="Strip",t.Wall="Wall"}(J0e||(J0e={})),function(t){t[t.Random=0]="Random",t[t.Increasing=1]="Increasing",t[t.Decreasing=2]="Decreasing",t[t.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(X0e||(X0e={})),function(t){t[t.Relative=0]="Relative",t[t.Absolute=1]="Absolute"}(hV||(hV={})),function(t){t[t.Normal=0]="Normal",t[t.LowerCase=1]="LowerCase",t[t.Allcaps=2]="Allcaps"}(K0e||(K0e={})),function(t){t[t.LTR=0]="LTR",t[t.RTL=1]="RTL"}(Q0e||(Q0e={})),function(t){t.Draft="Draft",t.Picture="Picture",t.Text="Text"}(e_e||(e_e={})),function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Baseline=2]="Baseline",t[t.Bottom=3]="Bottom"}(t_e||(t_e={})),function(t){t[t.Right=0]="Right",t[t.Upright=1]="Upright"}(i_e||(i_e={})),function(t){t[t.Small=0]="Small",t[t.Medium=1]="Medium",t[t.Large=2]="Large"}(r_e||(r_e={})),function(t){t[t.Calm=0]="Calm",t[t.Rippled=1]="Rippled",t[t.Slight=2]="Slight",t[t.Moderate=3]="Moderate"}(s_e||(s_e={}));var aQ,q_,dV,Wp,lQ,pV,cQ,W_,uQ;(function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(aQ||(aQ={})),function(t){t[t.VISIBLE=0]="VISIBLE",t[t.NONE=1]="NONE"}(q_||(q_={})),function(t){t[t.POINT=0]="POINT",t[t.LINE=1]="LINE",t[t.LINE_CENTER=2]="LINE_CENTER"}(dV||(dV={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT",t[t.AUTO=2]="AUTO"}(Wp||(Wp={})),function(t){t[t.AUTO=0]="AUTO",t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT"}(lQ||(lQ={})),function(t){t[t.CENTER=0]="CENTER",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.TOP_LEFT=5]="TOP_LEFT",t[t.TOP_RIGHT=6]="TOP_RIGHT",t[t.BOTTOM_LEFT=7]="BOTTOM_LEFT",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(pV||(pV={})),function(t){t[t.NONE=0]="NONE",t[t.UPPERCASE=1]="UPPERCASE",t[t.LOWERCASE=2]="LOWERCASE"}(cQ||(cQ={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT"}(W_||(W_={})),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(uQ||(uQ={}));let sp=class{};sp.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:q_.VISIBLE}},sp.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:q_.VISIBLE}},sp.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:q_.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:rQ.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:sQ.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},sp.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:q_.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:dV.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:pV.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:Wp.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:pV.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:lQ.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:Wp.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:cQ.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[uQ.HORIZONTAL]}},sp.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:q_.VISIBLE}},sp.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},sp.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:W_.MAP}},sp.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:W_.MAP},"line-width":{type:"number",minimum:0,default:1}},sp.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:W_.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:W_.MAP}},sp.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},sp.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:W_.MAP}};function rMt(t,e,i,r,s,n){const{iconRotationAlignment:o,textRotationAlignment:a,iconTranslate:l,iconTranslateAnchor:c,textTranslate:h,textTranslateAnchor:d}=r;let f=0;for(const m of t.colliders){const[g,v]=m.partIndex===0?l:h,_=m.partIndex===0?c:d,b=m.minLod<=n&&n<=m.maxLod;f+=b?0:1,m.enabled=b,m.xScreen=m.xTile*s[0]+m.yTile*s[3]+s[6],m.yScreen=m.xTile*s[1]+m.yTile*s[4]+s[7],_===W_.MAP?(m.xScreen+=i*g-e*v,m.yScreen+=e*g+i*v):(m.xScreen+=g,m.yScreen+=v),Wp.VIEWPORT===(m.partIndex===0?o:a)?(m.dxScreen=m.dxPixels,m.dyScreen=m.dyPixels):(m.dxScreen=i*(m.dxPixels+m.width/2)-e*(m.dyPixels+m.height/2)-m.width/2,m.dyScreen=e*(m.dxPixels+m.width/2)+i*(m.dyPixels+m.height/2)-m.height/2)}t.colliders.length>0&&f===t.colliders.length&&(t.unique.show=!1)}let sMt=class{constructor(e,i,r,s,n,o){this._symbols=e,this._styleRepository=s,this._zoom=n,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new $4e(i,r,jAt),this._si=Math.sin(Math.PI*o/180),this._co=Math.cos(Math.PI*o/180);for(const a of e)for(const l of a.symbols)this._allNeededMatrices.has(l.tile)||this._allNeededMatrices.set(l.tile,sOe(l.tile.transforms.tileUnitsToPixels))}work(e){const i=this._gridIndex;function r(n){const o=n.xScreen+n.dxScreen,a=n.yScreen+n.dyScreen,l=o+n.width,c=a+n.height,[h,d,f,m]=i.getCellSpan(o,a,l,c);for(let g=d;g<=m;g++)for(let v=h;v<=f;v++){const _=i.cells[g][v];for(const b of _){const w=b.xScreen+b.dxScreen,x=b.yScreen+b.dyScreen,S=w+b.width,C=x+b.height;if(!(l<w||o>S||c<x||a>C))return!0}}return!1}const s=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const n=this._symbols[this._currentLayerCursor],o=this._getProperties(n.styleLayerUID);for(;this._currentSymbolCursor<n.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-s>e)return!1;const a=n.symbols[this._currentSymbolCursor];if(!a.unique.show)continue;rMt(a,this._si,this._co,o,this._allNeededMatrices.get(a.tile),this._zoom);const l=a.unique;if(!l.show)continue;const{iconAllowOverlap:c,iconIgnorePlacement:h,textAllowOverlap:d,textIgnorePlacement:f}=o;for(const m of a.colliders){if(!m.enabled)continue;const g=l.parts[m.partIndex];g.show&&!(m.partIndex?d:c)&&r(m)&&(m.hard?l.show=!1:g.show=!1)}if(l.show)for(const m of a.colliders){if(!m.enabled||(m.partIndex?f:h)||!l.parts[m.partIndex].show)continue;const g=m.xScreen+m.dxScreen,v=m.yScreen+m.dyScreen,_=g+m.width,b=v+m.height,[w,x,S,C]=this._gridIndex.getCellSpan(g,v,_,b);for(let T=x;T<=C;T++)for(let M=w;M<=S;M++)this._gridIndex.cells[T][M].push(m)}}}return!0}_getProperties(e){const i=this._styleProps.get(e);if(i)return i;const r=this._zoom,s=this._styleRepository.getStyleLayerByUID(e),n=s.getLayoutValue("symbol-placement",r)!==dV.POINT;let o=s.getLayoutValue("icon-rotation-alignment",r);o===Wp.AUTO&&(o=n?Wp.MAP:Wp.VIEWPORT);let a=s.getLayoutValue("text-rotation-alignment",r);a===Wp.AUTO&&(a=n?Wp.MAP:Wp.VIEWPORT);const l=s.getPaintValue("icon-translate",r),c=s.getPaintValue("icon-translate-anchor",r),h=s.getPaintValue("text-translate",r),d=s.getPaintValue("text-translate-anchor",r),f={iconAllowOverlap:s.getLayoutValue("icon-allow-overlap",r),iconIgnorePlacement:s.getLayoutValue("icon-ignore-placement",r),textAllowOverlap:s.getLayoutValue("text-allow-overlap",r),textIgnorePlacement:s.getLayoutValue("text-ignore-placement",r),iconRotationAlignment:o,textRotationAlignment:a,iconTranslateAnchor:c,iconTranslate:l,textTranslateAnchor:d,textTranslate:h};return this._styleProps.set(e,f),f}};function nMt(t,e){if(t.priority-e.priority)return t.priority-e.priority;const i=t.tile.key,r=e.tile.key;return i.world-r.world?i.world-r.world:i.level-r.level?i.level-r.level:i.row-r.row?i.row-r.row:i.col-r.col?i.col-r.col:t.xTile-e.xTile?t.xTile-e.xTile:t.yTile-e.yTile}let oMt=class{get running(){return this._running}constructor(e,i,r,s,n,o){this._visibleTiles=e,this._symbolRepository=i,this._createCollisionJob=r,this._assignTileSymbolsOpacity=s,this._symbolLayerSorter=n,this._isLayerVisible=o,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}setScreenSize(e,i){this._screenWidth===e&&this._screenHeight===i||this.restart(),this._screenWidth=e,this._screenHeight=i}restart(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}continue(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){const i=performance.now();if(!this._selectionJob.work(e)||(this._selectionJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){const i=performance.now();if(!this._collisionJob.work(e)||(this._collisionJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){const i=performance.now();if(!this._opacityJob.work(e)||(this._opacityJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}return this._running=!1,!0}_createSelectionJob(){const e=this._symbolRepository.uniqueSymbols;for(let l=0;l<e.length;l++){const c=e[l];for(let h=0;h<c.uniqueSymbols.length;h++){const d=c.uniqueSymbols[h];for(const f of d.tileSymbols)f.selectedForRendering=!1}}const i=[];let r=0,s=0;const n=this._isLayerVisible;function o(l){let c;const h=performance.now();for(;s<e.length;s++,r=0){const d=e[s],f=d.styleLayerUID;if(!n(f)){i[s]||(i[s]={styleLayerUID:f,symbols:[]});continue}i[s]=i[s]||{styleLayerUID:f,symbols:[]};const m=i[s];for(;r<d.uniqueSymbols.length;r++){if(c=d.uniqueSymbols[r],r%100==99&&performance.now()-h>l)return!1;let g=null,v=!1,_=!1;for(const b of c.tileSymbols)if(!_||!v){const w=b.tile;(!g||w.isCoverage||w.neededForCoverage&&!v)&&(g=b,(w.neededForCoverage||w.isCoverage)&&(_=!0),w.isCoverage&&(v=!0))}if(g.selectedForRendering=!0,_){m.symbols.push(g),c.show=!0;for(const b of c.parts)b.show=!0}else c.show=!1}}for(const d of i)d.symbols.sort(nMt);return!0}const a=this._symbolLayerSorter;return{work:o,get sortedSymbols(){return i.sort(a)}}}_createOpacityJob(){const e=this._assignTileSymbolsOpacity,i=this._visibleTiles;let r=0;function s(n,o){for(const a of n.symbols.values())aMt(a,o);e(n,o);for(const a of n.childrenTiles)s(a,o)}return{work(n){const o=performance.now();for(;r<i.length;r++){if(performance.now()-o>n)return!1;const a=i[r];a.parentTile==null&&s(a,performance.now())}return!0}}}};function aMt(t,e){for(const i of t){const r=i.unique;for(const s of r.parts){const n=s.targetOpacity>.5?1:-1;s.startOpacity+=n*((e-s.startTime)/GAt),s.startOpacity=Math.min(Math.max(s.startOpacity,0),1),s.startTime=e,s.targetOpacity=r.show&&s.show?1:0}}}const lMt=32,cMt=8,uMt=64,hMt=20;let dMt=class{constructor(e,i,r){this.tileCoordRange=e,this._visibleTiles=i,this._createUnique=r,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}get uniqueSymbols(){return this._uniqueSymbolLayerArray==null&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}get uniqueSymbolsReferences(){return this._uniqueSymbolsReferences}add(e,i){this._uniqueSymbolLayerArray=null;let r=this._tiles.get(e.id);r||(r={symbols:new Map},this._tiles.set(e.id,r));const s=new Map;if(i)for(const a of i)r.symbols.has(a)&&(s.set(a,r.symbols.get(a)),r.symbols.delete(a));else for(const[a,l]of e.layerData)r.symbols.has(a)&&(s.set(a,r.symbols.get(a)),r.symbols.delete(a));this._removeSymbols(s);const n=e.symbols,o=new Map;for(const[a,l]of n){let c=l.length;if(c>=lMt){let h=this.tileCoordRange;do h/=2,c/=4;while(c>cMt&&h>uMt);const d=new $4e(this.tileCoordRange,this.tileCoordRange,h);o.set(a,{flat:l,index:d}),r.symbols.set(a,{flat:l,index:d});for(const f of l)d.getCell(f.xTile,f.yTile).push(f)}else o.set(a,{flat:l}),r.symbols.set(a,{flat:l})}this._addSymbols(e.key,n)}deleteStyleLayers(e){this._uniqueSymbolLayerArray=null;for(const[i,r]of this._tiles){const s=new Map;for(const n of e)r.symbols.has(n)&&(s.set(n,r.symbols.get(n)),r.symbols.delete(n));this._removeSymbols(s),r.symbols.size===0&&this._tiles.delete(i)}}removeTile(e){this._uniqueSymbolLayerArray=null;const i=this._tiles.get(e.id);if(!i)return;const r=new Map;for(const[s,n]of e.symbols)i.symbols.has(s)&&(r.set(s,i.symbols.get(s)),i.symbols.delete(s));this._removeSymbols(r),i.symbols.size===0&&this._tiles.delete(e.id)}querySymbols(e,i,r,s){const n=[],o=this.uniqueSymbols;for(const a of o){const l=a.styleLayerUID,c=a.uniqueSymbols;for(const h of c){const d=h.tileSymbols.find(f=>f.selectedForRendering);d&&iMt(d,e,i*(window.devicePixelRatio||1),r)&&n.push({vtlSymbol:d,styleLayerUID:l,tileKey:d.tile.key})}}return n}_removeSymbols(e){for(const[i,{flat:r}]of e)for(const s of r){const n=s.unique,o=n.tileSymbols,a=o.length-1;for(let l=0;l<a;l++)if(o[l]===s){o[l]=o[a];break}if(o.length=a,a===0){const l=this._uniqueSymbolsReferences.get(i);l.delete(n),l.size===0&&this._uniqueSymbolsReferences.delete(i)}s.unique=null}}_addSymbols(e,i){if(i.size===0)return;const r=this._visibleTiles;for(const s of r)s.parentTile||s.key.world!==e.world||s.key.level===e.level&&!s.key.equals(e)||this._matchSymbols(s,e,i);for(const[s,n]of i)for(const o of n)if(o.unique==null){const a=this._createUnique();o.unique=a,a.tileSymbols.push(o);let l=this._uniqueSymbolsReferences.get(s);l||(l=new Set,this._uniqueSymbolsReferences.set(s,l)),l.add(a)}}_matchSymbols(e,i,r){if(e.key.level>i.level){const n=e.key.level-i.level;if(e.key.row>>n!==i.row||e.key.col>>n!==i.col)return}if(i.level>e.key.level){const n=i.level-e.key.level;if(i.row>>n!==e.key.row||i.col>>n!==e.key.col)return}if(i.equals(e.key)){for(const n of e.childrenTiles)this._matchSymbols(n,i,r);return}const s=new Map;for(const[n,o]of r){const a=[];for(const d of o){const f=e0e(this.tileCoordRange,d.xTile,i.level,i.col,e.key.level,e.key.col),m=e0e(this.tileCoordRange,d.yTile,i.level,i.row,e.key.level,e.key.row);f>=0&&f<this.tileCoordRange&&m>=0&&m<this.tileCoordRange&&a.push({symbol:d,xTransformed:f,yTransformed:m})}const l=[],c=(e.key.level<i.level?1:1<<e.key.level-i.level)+hMt,h=this._tiles.get(e.id).symbols.get(n);if(h){const d=h.flat;for(const f of a){let m,g=!1;const v=f.xTransformed,_=f.yTransformed;m=h.index!=null?h.index.getCell(v,_):d;const b=f.symbol,w=b.hash;for(const x of m)if(w===x.hash&&Math.abs(v-x.xTile)<=c&&Math.abs(_-x.yTile)<=c){const S=x.unique;b.unique=S,S.tileSymbols.push(b),g=!0;break}g||l.push(b)}}l.length>0&&s.set(n,l)}for(const n of e.childrenTiles)this._matchSymbols(n,i,s)}_createUniqueSymbolLayerArray(){const e=this._uniqueSymbolsReferences,i=new Array(e.size);let r,s=0;for(const[n,o]of e){const a=new Array(o.size);r=0;for(const l of o)a[r++]=l;i[s]={styleLayerUID:n,uniqueSymbols:a},s++}return i}};function pMt(t,e){const i=t.transforms.tileUnitsToPixels,r=iL(e),s=Math.cos(r),n=Math.sin(r),o=Math.ceil(512*(Math.abs(n)+Math.abs(s)));RG(Gf),ES(Gf,Gf,[o/2,o/2]),PG(Gf,Gf,r),ES(Gf,Gf,[-256,-256]),DG(Gf,Gf,[1/8,1/8,1]),t.transforms.tileUnitsToPixels=Gf;const a=[],l=new dMt(4096,a,()=>new VAt),c=new oMt(a,l,(h,d,f)=>new sMt(h,d,f,t.styleRepository,t.key.level,e),(h,d)=>{eMt(h,d,!1)},()=>0,h=>{const d=t.styleRepository.getStyleLayerByUID(h).getLayoutProperty("visibility");return!d||d.getValue()!==q_.NONE});a.push(t),l.add(t),c.setScreenSize(o,o),c.continue(1/0),l.removeTile(t),t.transforms.tileUnitsToPixels=i}const Gf=Qx();let cm=class extends he{constructor(e){super(e),this.computedOpacity=1,this.computedVisible=!0,this.opacity=1,this.visible=!0,this._fadeOutResolver=null,this._fadeInResolver=null}get transitioning(){return(this._fadeOutResolver||!this.visible?0:this.opacity)!==this.computedOpacity}endTransition(){var e,i;(e=this._fadeInResolver)==null||e.call(this),(i=this._fadeOutResolver)==null||i.call(this),this._fadeInResolver=this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0}fadeIn(){var e;return this._fadeInResolver||(this.opacity=1,this.computedOpacity=0,(e=this._fadeOutResolver)==null||e.call(this),this._fadeOutResolver=null,this._fadeInResolver=ta()),this._fadeInResolver.promise}fadeOut(){var e;return this._fadeOutResolver||(this.opacity=0,(e=this._fadeInResolver)==null||e.call(this),this._fadeInResolver=null,this._fadeOutResolver=ta()),this._fadeOutResolver.promise}transitionStep(e,i){var n,o;const r=X("mapview-transitions-duration"),s=r?1/r:0;if(s===0)this.computedOpacity=this.opacity,this.computedVisible=this.visible;else{const a=this._fadeOutResolver||!this.visible?0:this.opacity,l=this.computedOpacity;if(l===a)this.computedVisible=this.visible;else{const c=e*s;this.computedOpacity=l>a?Math.max(a,l-c):Math.min(a,l+c),this.computedVisible=this.computedOpacity>0}}this.transitioning||((n=this._fadeInResolver)==null||n.call(this),(o=this._fadeOutResolver)==null||o.call(this),this._fadeOutResolver=this._fadeInResolver=null)}};u([p()],cm.prototype,"computedOpacity",void 0),u([p()],cm.prototype,"computedVisible",void 0),u([p()],cm.prototype,"opacity",void 0),u([p()],cm.prototype,"visible",void 0),u([p()],cm.prototype,"transitioning",null),u([p()],cm.prototype,"_fadeOutResolver",void 0),u([p()],cm.prototype,"_fadeInResolver",void 0),cm=u([A("esri.views.2d.engine.transitions.FadeTransition")],cm);let fMt=class extends Ss{constructor(){super(...arguments),this._transitionables=null,this._clips=null,this._fadeTransition=null,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get computedOpacity(){var e;return((e=this._fadeTransition)==null?void 0:e.computedOpacity)??this.opacity}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get fadeTransitionEnabled(){return this._fadeTransition!==null}set fadeTransitionEnabled(e){!this._fadeTransition&&e?(this._fadeTransition=new cm({opacity:this.opacity,visible:this.visible}),this.addTransitionable(this._fadeTransition)):this._fadeTransition&&!e&&(this.removeTransitionable(this._fadeTransition),this._fadeTransition=null)}get inFadeTransition(){var e;return((e=this._fadeTransition)==null?void 0:e.transitioning)??!1}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this._fadeTransition&&(this._fadeTransition.opacity=this._opacity),this.requestRender())}get stage(){return this._stage}set stage(e){var r;if(this._stage===e)return;const i=this._stage;this._stage=e,e?(r=this._stage)!=null&&r.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):i==null||i.trashDisplayObject(this)}get transforms(){return this._transforms==null&&(this._transforms=this._createTransforms()),this._transforms}get transitioning(){return this.isTransitioning()}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this._fadeTransition&&(this._fadeTransition.visible=this._visible),this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}addTransitionable(e){this._transitionables??(this._transitionables=[]),this._transitionables.push(e),this.requestRender()}removeTransitionable(e){e.endTransition(),this._transitionables&&MD(this._transitionables,e),this.requestRender()}fadeIn(){this.fadeTransitionEnabled=!0;const e=this._fadeTransition.fadeIn();return this.opacity=1,this.requestRender(),e}fadeOut(){this.fadeTransitionEnabled=!0;const e=this._fadeTransition.fadeOut();return this.opacity=0,this.requestRender(),e}endTransitions(){if(this._transitionables){for(const e of this._transitionables)e.endTransition();this.requestRender()}}beforeRender(e){this.transitionStep(e.deltaTime,e.state.scale),this.setTransform(e.state)}afterRender(e){this.transitioning&&this.requestRender()}remove(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e){}processRender(e){var i;this.stage&&(((i=this._fadeTransition)==null?void 0:i.computedVisible)??this.visible)&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this.endTransitions(),this.onDetach(),this.emit("detach")}isTransitioning(){var e;return((e=this._transitionables)==null?void 0:e.some(i=>i.transitioning))??!1}transitionStep(e,i){if(this._transitionables)for(const r of this._transitionables)r.transitionStep(e,i)}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},mMt=class extends fMt{constructor(e,i,r,s,n,o,a=n,l=o){super(),this.tileDebugInfoTexture=null,this.debugInfo={display:{length:0,minOrderedLength:0,minUnorderedLength:0,triangleCount:0},memory:{bytesUsed:0,bytesReserved:0}},this._destroyed=!1,this.key=new og(e),this.resolution=i,this.x=r,this.y=s,this.width=n,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.tileDebugInfoTexture&&(this.tileDebugInfoTexture.dispose(),this.tileDebugInfoTexture=null),this._destroyed=!0}get debugSlot(){let e=this;for(;e.parent!==this._stage;){if(!e.parent)return 0;e=e.parent}return this._stage.children.indexOf(e)}setTransform(e){const i=this.resolution/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,[s,n]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*i,a=this.height/this.rangeY*i;aL(r,o,0,0,0,a,0,s,n,1),cL(this.transforms.displayViewScreenMat3,e.displayViewMat3,r)}get destroyed(){return this._destroyed}},gMt=class extends mMt{_createTransforms(){return{displayViewScreenMat3:Qx(),tileMat3:Qx()}}},yMt=class{constructor(){this._candidateTiles=[]}schedule(e){this._candidateTiles.includes(e)||this._candidateTiles.push(e)}reshuffle(e){const i=[];for(const r of this._candidateTiles)e>0?(r.reshuffle(),e--):i.push(r);this._candidateTiles=i}};const vMt=.125;let _Mt=class{constructor(){this._renderParams={reshuffleManager:new yMt,context:null,drawPhase:1,state:new bMt,stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null,stencilSymbols:!0,is3D:!0,backgroundColor:null},this._backgroundTile=new gMt(new og(0,0,0,0),0,0,0,512,512,4096,4096),this._heading=0,this._declutteredForHeading=new WeakMap}dispose(){this._renderParams=null}renderBackground(e,i,r,s,n,o,a,l,c,h){const d=this._backgroundTile;this._updateRenderParameters(e,i,d,r,n,o,a,l,c,h),this._renderParams.stencilSymbols=!1,r.drawBackground(this._renderParams,d,s)}renderContent(e,i,r,s,n,o,a,l,c,h,d,f){this._declutter(r),s.forAll(({sourceLayerInfo:{data:v}})=>this._declutter(v));const m=s.length>0;m&&this._stencilSymbols(e,i,r,s,n,o,a,l,c,h,d,f);let g=1;r.stencilRef=m?g:0,e.setStencilFunction(Ui.EQUAL,r.stencilRef,255),this._render(e,i,r,n,o,a,l,c,h,d,f),s.forAll(({sourceLod:v,offset:_,sourceLayerInfo:{data:b}})=>{b.stencilRef=++g,this._renderSymbols(e,v,b,n,o,a,l,_,h,d,f)})}_stencilSymbols(e,i,r,s,n,o,a,l,c,h,d,f){let m=1;r.stencilRef=m,e.setDepthTestEnabled(!1),e.setDepthWriteEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(tr.KEEP,tr.KEEP,tr.REPLACE),e.setStencilWriteMask(255),e.setStencilFunction(Ui.ALWAYS,r.stencilRef,255),this._stencilTileSymbols(e,i,r,n,o,a,l,c,h,d,f),s.forAll(({sourceLod:g,offset:v,sourceLayerInfo:{data:_}})=>{_.stencilRef=++m,e.setStencilFunction(Ui.ALWAYS,_.stencilRef,255),this._stencilTileSymbols(e,g,_,n,o,a,l,v,h,d,f)}),e.setStencilWriteMask(0),e.setBlendingEnabled(!0),e.setDepthTestEnabled(!0),e.setColorMask(!0,!0,!0,!0)}_renderSymbols(e,i,r,s,n,o,a,l,c,h,d){e.setStencilFunction(Ui.EQUAL,r.stencilRef,255),this._render(e,i,r,s,n,o,a,l,c,h,d,aQ.SYMBOL)}_render(e,i,r,s,n,o,a,l,c,h,d,f){this._updateRenderParameters(e,i,r,s,o,a,l,c,h,d),this._renderParams.stencilSymbols=!1,s.drawTile(this._renderParams,r,n,f)}_stencilTileSymbols(e,i,r,s,n,o,a,l,c,h,d){this._updateRenderParameters(e,i,r,s,o,a,l,c,h,d),this._renderParams.stencilSymbols=!0,r.triangleCount=0,s.drawSymbols(this._renderParams,r,n)}_updateRenderParameters(e,i,r,s,n,o,a,l,c,h){"type"in r&&r.type==="vector-tile"&&!r.stage&&r.attachWithContext(e);const d=i[0]-n.getLevelShift(i[0]),f=this._renderParams;f.context=e,f.painter=s,f.glyphMosaic=s.glyphMosaic,f.spriteMosaic=s.spriteMosaic,f.pixelRatio=c*h,f.displayLevel=d,f.requiredLevel=d;const m=n.getScale(i[0]),[g,v]=n.getOffset(i,o*m),_=vMt*o*m/l,b=r.transforms.displayViewScreenMat3;b[0]=_,b[4]=-_,b[6]=-1-g-a[0]*o*2,b[7]=1+v+(1-a[1])*o*2-2;const w=f.state,x=l/h;w.size[0]=x,w.size[1]=x,w.pixelRatio=h,w.rotation=(360-this._heading)%360;const S=2/x;aL(w.displayViewMat3,S,0,0,0,-S,0,-1,1,1);const C=RG(w.displayMat3),T=iL(this._heading);ES(C,C,[x/2,x/2]),PG(C,C,T),ES(C,C,[-x/2,-x/2]),cL(C,w.displayViewMat3,C)}updateHeading(e){this._heading=e}_declutter(e){this._declutteredForHeading.get(e)!==this._heading&&(pMt(e,(360-this._heading)%360),this._declutteredForHeading.set(e,this._heading))}},bMt=class{constructor(){this.size=[0,0],this.pixelRatio=1,this.rotation=0,this.displayMat3=Ts(),this.displayViewMat3=Ts(),this.transform=null,this.inverseTransform=null,this.viewMat2d=null,this.viewMat3=null,this.id=0,this.extent=null,this.center=null,this.scale=1,this.resolution=0,this.worldScreenWidth=0,this.spatialReference=null,this.viewpoint=null,this.getScreenTransform=null,this.toMap=null,this.toScreen=null,this.clone=null,this.copy=null,this.toJSON=null}},A4e=class extends hu{constructor(){super(...arguments),this.blendMode=Pe.Normal}};u([ie({count:Pe.COUNT})],A4e.prototype,"blendMode",void 0);let OP=class extends A4e{constructor(){super(...arguments),this.output=mn.Composite,this.baseOpacityMode=ka.NotRequired,this.premultipliedSource=ed.Off}};u([ie({count:mn.COUNT})],OP.prototype,"output",void 0),u([ie({count:ka.COUNT})],OP.prototype,"baseOpacityMode",void 0),u([ie({count:ed.COUNT})],OP.prototype,"premultipliedSource",void 0);let M4e=class extends OP{constructor(){super(...arguments),this.background=Nv.BelowLayer}};u([ie({count:Nv.COUNT})],M4e.prototype,"background",void 0);function wMt(t){t.fragment.uniforms.add(new It("u_colormap",e=>e.u_colormap),new mt("u_colormapOffset",e=>e.colormap.u_colormapOffset),new mt("u_colormapMaxIndex",e=>e.colormap.u_colormapMaxIndex),new mt("u_opacity",e=>e.common.u_opacity)),t.fragment.code.add(E`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}function xMt(t){t.fragment.uniforms.add(new It("u_transformGrid",e=>e.u_transformGrid),new yc("u_transformSpacing",e=>e.common.u_transformSpacing),new yc("u_targetImageSize",e=>e.common.u_targetImageSize)),t.fragment.code.add(E`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}let uD=class extends lr{constructor(e,i){super(e,"bool",Lt.Pass,(r,s,n)=>r.setUniform1b(e,i(s,n)))}},SMt=class extends x4e{constructor(e,i,r){super(),this.common=e,this.u_image=i,this.u_transformGrid=r}};function TMt(t,e){t.include(xMt),t.fragment.uniforms.add(new It("u_image",r=>r.u_image),new uD("u_flipY",r=>r.common.u_flipY),new uD("u_applyTransform",r=>r.common.u_applyTransform));const{requireBilinearWithNN:i}=e;i&&t.fragment.uniforms.add(new yc("u_srcImageSize",r=>r.common.u_srcImageSize)),t.fragment.code.add(E`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),i?t.fragment.code.add(E`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):t.fragment.code.add(E`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}let W6=class extends SMt{constructor(e,i,r,s,n,o){super(e,s,n),this.colormap=i,this.symbolizer=r,this.u_colormap=o,this.backgroundColor=cn,this.fboTexture=null,this.baseOpacity=1}},O4e=class extends W6{},I4e=class extends W6{};function R4e(t){const e=new Vi;return e.include(S4e),e.include(TMt,t),e.include(wMt,t),e.include(T4e,t),e.fragment.code.add(E`vec4 applyBackgroundBlend(vec4 layerColor) {
return blendLayers(vuv, layerColor, u_opacity);
}`),t.colorizerType===aS.Stretch?CMt(e,t):t.colorizerType===aS.Lut?EMt(e):t.colorizerType===aS.Hillshade&&$Mt(e,t),e}function EMt(t){t.fragment.main.add(E`vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));`)}function CMt(t,e){t.fragment.uniforms.add(new dw("u_bandCount",r=>r.symbolizer.u_bandCount),new gd("u_minCutOff",r=>r.symbolizer.u_minCutOff,3),new gd("u_maxCutOff",r=>r.symbolizer.u_maxCutOff,3),new gd("u_factor",r=>r.symbolizer.u_factor,3),new mt("u_minOutput",r=>r.symbolizer.u_minOutput),new mt("u_maxOutput",r=>r.symbolizer.u_maxOutput),new uD("u_useGamma",r=>r.symbolizer.u_useGamma),new gd("u_gamma",r=>r.symbolizer.u_gamma,3),new gd("u_gammaCorrection",r=>r.symbolizer.u_gammaCorrection,3),new mt("u_opacity",r=>r.common.u_opacity)),t.fragment.code.add(E`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const i=e.applyColormap?E`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:E`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.main.add(E`
    vec2 pixelLocation = getPixelLocation(uv);
    if (isOutside(pixelLocation)) {
      fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
      return;
    }

    vec4 currentPixel = getPixel(pixelLocation);
    ${e.stretchType===kS.Noop?E`fragColor = applyBackgroundBlend(currentPixel);`:E`
    if (currentPixel.a == 0.0) {
      fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
      return;
    }
    if (u_bandCount == 1) {
      float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
      ${i}
    } else {
      float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
      float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
      float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
      fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
    }`}`)}function $Mt(t,e){const i=t.fragment;i.uniforms.add(new It("u_image",s=>s.u_image),new dw("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new gd("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new gd("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new gd("u_cosZs",s=>s.symbolizer.u_cosZs,6),new gd("u_weights",s=>s.symbolizer.u_weights,6),new yc("u_factor",s=>s.symbolizer.u_factor),new mt("u_minValue",s=>s.symbolizer.u_minValue),new mt("u_maxValue",s=>s.symbolizer.u_maxValue),new yc("u_srcImageSize",s=>s.common.u_srcImageSize)),i.include(yM),i.code.add(E`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),i.code.add(E`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=e.applyColormap?E`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:E`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;i.main.add(E`
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}`)}const AMt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:I4e,ColorizerStretchUniforms:O4e,ColorizerUniforms:W6,build:R4e},Symbol.toStringTag,{value:"Module"}));let n_e=class extends Hi{constructor(e,i){super(e,i,new Bi(AMt,()=>G(()=>Promise.resolve().then(()=>cHt),void 0)))}},oR=class extends OP{constructor(){super(...arguments),this.colorizerType=aS.Stretch,this.stretchType=kS.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}};u([ie({count:aS.COUNT})],oR.prototype,"colorizerType",void 0),u([ie({count:kS.COUNT})],oR.prototype,"stretchType",void 0),u([ie()],oR.prototype,"applyColormap",void 0),u([ie()],oR.prototype,"requireBilinearWithNN",void 0);let o_e=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const i=this._fbos.get(e);if(i)return i;const r=new Eg(this._rctx,new Ar(e),new DNe(ga.DEPTH24_STENCIL8,e));return this._fbos.set(e,r),r}};function mw(t,e=hg.Pos2,i=bg,r=-1,s=1){const n=e===hg.Pos2?new Float32Array([r,r,s,r,r,s,s,s]):new Float32Array([r,r,0,0,s,r,1,0,r,s,0,1,s,s,1,1]);return new Tg(t,i,new Map([["geometry",OMt.get(e)]]),new Map([["geometry",jn.createVertex(t,Js.STATIC_DRAW,n)]]))}const MMt=4;function P4e(t){const e=new Ar(MMt);return e.samplingMode=gi.NEAREST,new pi(t,e)}var hg;(function(t){t[t.Pos2=0]="Pos2",t[t.Pos2Tex=1]="Pos2Tex"})(hg||(hg={}));const OMt=new Map([[hg.Pos2,uLe],[hg.Pos2Tex,vyt]]),IMt=()=>J.getLogger("esri.views.3d.terrain");let RMt=class{constructor(e,i){this._rctx=e,this._techniques=i,this._fbos=[],this._vectorTileHelper=new _Mt,this._bindParameters=new _oe(null),this._blendLayersTechniqueConfig=new M4e,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=mw(this._rctx,hg.Pos2Tex)}dispose(){this._fbos.forEach(Dt),this._fbos=null,this._vtFBO=Dt(this._vtFBO),this._vaoQuad=Dt(this._vaoQuad),this._vectorTileHelper=Dt(this._vectorTileHelper)}updateHeading(e){var i;(i=this._vectorTileHelper)==null||i.updateHeading(e)}_acquireBlendLayersTechnique(e,i,r,s=ed.Off,n=Nv.BelowLayer){return this._blendLayersTechniqueConfig.output=i,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=r,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechniqueConfig.background=n,this._techniques.precompile(Xve,this._blendLayersTechniqueConfig),this._techniques.get(Xve,this._blendLayersTechniqueConfig)}drawBackground(e,i){const r=this._acquireBlendLayersTechnique(Pe.Normal,i?mn.ColorComposite:mn.GridComposite,ka.NotRequired,ed.Off,Nv.Only),s=this._rctx.bindTechnique(r,this._bindParameters,e);this._render(s)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Gi.TRIANGLE_STRIP,0,uA(this._vaoQuad,"geometry"))}drawGroup(e,i,r,s,n=ed.On){i===mn.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(r).colorTexture),e.texture=this.currentFBO(r).colorTexture,this.closeGroup(r);const o=e.baseOpacity<1?ka.Required:ka.NotRequired,a=this._acquireBlendLayersTechnique(s,i,o,n),l=this._rctx.bindTechnique(a,this._bindParameters,e);this._render(l)}drawImageData(e,i,r,s,n=ed.Off){if(e.texture==null)return;const o=e.baseOpacity<1?ka.Required:ka.NotRequired;e.fboTexture=i===mn.GroupBackgroundComposite||s===Pe.Normal&&o===ka.NotRequired&&n===ed.Off?null:this.switch(r).colorTexture;const a=this._acquireBlendLayersTechnique(s,i,o,n),l=this._rctx.bindTechnique(a,this._bindParameters,e);this._render(l)}drawRasterData(e,i,r,s,n){const o=n.sourceLayerInfo.data;if(!o.source||(n.tile.surface.layerViewByIndex(n.layerIndex,kt.MAP).ensureSymbolizerParameters(o),!o.bind(this._rctx)))return;const a=e.baseOpacity<1?ka.Required:ka.NotRequired;e.fboTexture=s===Pe.Normal&&a===ka.NotRequired?null:this.switch(r).colorTexture;const l=this._acquireRasterColorizerTechnique(o,i,s,a);o.opacity=e.opacity;const c=o.getUniforms();c.scale=n.scale,c.offset=n.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const h=this._rctx.bindTechnique(l,this._bindParameters,c);this._render(h)}_acquireRasterColorizerTechnique(e,i,r,s){const n=e.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return this._rasterColorizerConfig==null&&(this._rasterColorizerConfig=new oR,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=i,this._rasterColorizerConfig.blendMode=r,this._rasterColorizerConfig.baseOpacityMode=s,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.requireBilinearWithNN=e.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?kS.Noop:kS.PerBand,this._techniques.precompile(n_e,this._rasterColorizerConfig),this._techniques.get(n_e,this._rasterColorizerConfig)}drawVectorData(e,i,r,s,n,o,a,l){const c=this._rctx,h=n.sourceLayerInfo.data,d=n.tile.surface.layerViewByIndex(n.layerIndex,kt.MAP),f=e.baseOpacity<1?ka.Required:ka.NotRequired,m=f===ka.Required||e.opacity<1||s!==Pe.Normal||i!==mn.Composite,g=m?ed.On:ed.Off,v=this._acquireBlendLayersTechnique(s,i,f,g);c.setPipelineState(v.getPipeline());let _=null,b=null;m?(b=this.currentFBO(r),this._vtFBO==null&&(this._vtFBO=new o_e(this._rctx)),_=this._vtFBO.get(r),c.bindFramebuffer(_),this._clearCurrentFBO()):l&&c.clear(Mi.DEPTH);try{this._vectorTileHelper.renderBackground(c,n.sourceLod,d.painter,d.layer.styleRepository,d.schemaHelper,Math.round(1/n.scale),n.offset,a,o,d.contentZoom),h&&this._vectorTileHelper.renderContent(c,n.sourceLod,h,n.vtlNeighborInfos,d.painter,d.layer.styleRepository,d.schemaHelper,Math.round(1/n.scale),n.offset,a,o,d.contentZoom)}catch(w){IMt().warnOnce("A render call containing vector tiles did not resolve correctly.",w)}return!_||(c.bindFramebuffer(b),e.texture=_.colorTexture,e.offset=TS,e.scale=1,this.drawImageData(e,i,r,s,g),l)}copyFBOToTexture(e){const i=this._rctx,r=i.bindTexture(e.texture,pi.TEXTURE_UNIT_FOR_UPDATES),s=e.descriptor;i.gl.copyTexImage2D(ns.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),e.generateMipmap(),i.bindTexture(r,pi.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setStencilWriteMask(255),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.setClearStencil(0),this._rctx.clear(Mi.COLOR|Mi.DEPTH|Mi.STENCIL)}_initFBO(e,i,r){this._rctx.bindFramebuffer(e),r&&(this._rctx.setViewport(0,0,i,i),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,i=0,r=!0){if(this._current=i,i>=this._fbos.length)for(let s=this._fbos.length;s<=i;s++)this._fbos.push(new o_e(this._rctx));this._initFBO(this._fbos[i].get(e),e,r)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const i=this.currentFBO(e),r=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),i}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const i=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},PMt=class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.isVTLBackground=!1,this.vtlNeighborInfos=new ii({allocator:e=>e||new DMt})}},DMt=class{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}},a_e=class{constructor(e,i){this._texture=e,this._cache=i,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&(this._cache?(this._texture.isCompressing&&this._texture.abortCompression(),this._cache.put(this._generateCacheKey(),this)):this.dispose())}dispose(){this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}_generateCacheKey(){return`${this._texture.descriptor.width} ${this._texture.descriptor.pixelFormat}`+(Hst(this._texture)?"compressed":"")}get descriptor(){return this._texture.descriptor}get cachedMemory(){return this._texture.usedMemory}},LMt=class{constructor(e,i,r,s,n={}){this._mainMethod=i,this._transferLists=r,this._listeners=[],this._promise=nCe(e,{...n,schedule:s}).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,n.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>J.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${o}`))}on(e,i){const r={removed:!1,eventName:e,callback:i,threadHandle:null};return this._listeners.push(r),this._connectListener(r),Pi(()=>{r.removed=!0,MD(this._listeners,r),this._thread&&r.threadHandle!=null&&r.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,i){return this.invokeMethod(this._mainMethod,e,i)}invokeMethod(e,i,r){if(this._thread){const s=this._transferLists[e],n=s?s(i):[];return this._thread.invoke(e,i,{transferList:n,signal:r})}return this._promise?this._promise.then(()=>(gt(r),this.invokeMethod(e,i,r))):Promise.reject(null)}broadcast(e,i){return this._thread?Promise.all(this._thread.broadcast(i,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,i)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(i=>{e.removed||(e.threadHandle=i)})}};function D4e(t){return t instanceof HTMLImageElement||t instanceof HTMLCanvasElement}let NMt=class extends LMt{constructor(e){super("TextureCompressionWorker","compress",{compress:i=>[i.data]},e)}isCompressible(e){return D4e(e)}},FMt=class{constructor(e,i,r,s,n,o){this.start=e,this.end=i,this.blendMode=r,this.opacity=s,this.output=n,this.baseOpacity=o}},c_=class extends he{constructor(e){super(e),this._passParameters=new UAt,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1}initialize(){this._maxAnisotropy=this.rctx.parameters.maxMaxAnisotropy,this._compositor=new RMt(this.rctx,this.techniques),this._ensureBackgroundTexture(this.tileSize),this.texturesBeingCompressed=0}dispose(){this._compositor=Dt(this._compositor),this._backgroundTexture=Lr(this._backgroundTexture)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateHeading(e){var i;(i=this._compositor)==null||i.updateHeading(e)}updateTileTexture(e,i){if(!e.renderData)return;const r=e.surface,s=r.baseOpacity;let n=0,o=0,a=this.tileSize,l=!1,c=!1;const h=r.view.state.contentPixelRatio;let d=!1;fV.clear(),fE.length=0;const f=e.layerInfo[kt.MAP];let m=0,g=null;for(;m<f.length;m++){const b=r.layerViewByIndex(m,kt.MAP),w=b.layer,x=!oS(e,b),S=w.opacity,C=b.fullOpacity;if(c=c||N4(w),lD(b)){let I=b.layer.blendMode!=="normal";if(J$(w.parent)){const D=w.parent.uid;D!=null&&D!==""&&(I=L4e(w.parent)||I)}I&&(d=I,l=!1)}if((x||S===0)&&!d){f[m].pendingUpdates&=~(st.TEXTURE_NOFADING&st.TEXTURE_FADING);continue}++o;const T=MA(b),M=Z9(e,m,T);if(M){if(f[m].pendingUpdates&=~(st.TEXTURE_NOFADING&st.TEXTURE_FADING),J$(w.parent)){const I=w.parent.uid;I!=null&&I!==""&&N4e(w.parent,m)}T?a=Math.max(a,this.tileSize*h):s===1&&C===1&&(b.isOpaque||this._dataToTexture(M)&&M.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++n,g===null&&(g=m)}}const v=a/this.tileSize,_=this._ensureBackgroundTexture(this.tileSize);n!==0&&g!==null?n===1&&!d&&this._useLayerTexture(e,g)||this._composeLayers(e,i,m-1,c,a,v,!l||d,fV,d):zMt(e,o,_,i!==Rs.FADING)}_ensureBackgroundTexture(e){return this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(e,!1),this._backgroundDirty=!0),this._backgroundDirty&&(this._compositor.bind(e),this._passParameters.offset=TS,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor&&(this._passParameters.backgroundColor=this.backgroundColor),this._compositor.drawBackground(this._passParameters,this.backgroundColor!=null),this._compositor.copyFBOToTexture(this._backgroundTexture),this._compositor.unbind(),this._backgroundDirty=!1),this._backgroundTexture}_useLayerTexture(e,i){const r=e.surface.layerViewByIndex(i,kt.MAP),s=N4(r.layer),n=s?e.surface.baseOpacity:1,o=s?1:e.surface.baseOpacity,a=r.fullOpacity,l=Z9(e,i,!1);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new uV(l.sourceLayerInfo.data,Rs.FADING,Yi(l.offset[0],l.offset[1],l.scale,l.scale),n,o,a)),!0)}_composeLayers(e,i,r,s,n,o,a,l,c){this._compositor.ensureBuffer(n);const h=e.surface.baseOpacity;let d=!1,f=gi.LINEAR_MIPMAP_LINEAR,m=!1,g=0;for(let w=r;w>=0;w--){const x=e.surface.layerViewByIndex(w,kt.MAP),S=x.layer,C=MA(x),T=Z9(e,w,C),M=S.opacity,I=!oS(e,x);if(!T||(M===0||I)&&!c)continue;const D=!N4(S)&&!d;D&&(d=!0);let P=!1;l.forEach(R=>{R.start===w&&(R.output=s?mn.Composite:a&&D?this.backgroundIsGrid?mn.GridComposite:mn.ColorComposite:mn.Composite,R.baseOpacity=D?h:1,fE.push(R),this._compositor.openGroup(n),P=!0)});const F=g===0,L=P?mn.GroupBackgroundComposite:a&&F?this.backgroundIsGrid?mn.GridComposite:mn.ColorComposite:mn.Composite,N=tQ[lD(x)?x.layer.blendMode:"normal"];for(this._passParameters.baseOpacity=D&&!P&&h<1?h:1,this._passParameters.opacity=M,XCt(T)?m=this._compositor.drawVectorData(this._passParameters,L,n,N,T,o,this.tileSize,m):JCt(T)?(this._compositor.drawRasterData(this._passParameters,L,n,N,T),kMt(T)&&(f=gi.NEAREST)):this._dataToTexture(T)&&(this._passParameters.texture=T.sourceLayerInfo.data.texture,this._passParameters.offset=T.offset,this._passParameters.scale=T.scale,this._compositor.drawImageData(this._passParameters,L,n,N));fE.length>0&&fE[fE.length-1].end===w;){const R=fE.pop();this._passParameters.baseOpacity=R.baseOpacity,this._passParameters.opacity=R.opacity,this._passParameters.offset=TS,this._passParameters.scale=1,this._compositor.drawGroup(this._passParameters,R.output,n,tQ[R.blendMode])}g++}const v=e.renderData,_=c||d&&h<1,b=v.ensureTexture(n,_,i,()=>this._buildTexture(n,_,f));this._compositor.copyFBOToTexture(b),this._compositor.unbind(),v.setTextureReference(new uV(b,i,F4e,d?1:h,0,1))}_dataToTexture(e){if(QCt(e)){const i=e.sourceLayerInfo,r=e.scale===1;i.data=this._buildTexture(i.data,!0,r),e.tile.setMemoryDirty()}return KCt(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,i,r=gi.LINEAR_MIPMAP_LINEAR){if(e==null)return null;const s=new Ar;s.wrapMode=ar.CLAMP_TO_EDGE,s.samplingMode=typeof r=="boolean"?gi.LINEAR_MIPMAP_LINEAR:r,s.maxAnisotropy=this._maxAnisotropy,s.preMultiplyAlpha=!0,s.flipped=!0,s.hasMipmap=!0,i||(s.pixelFormat=Tt.RGB);const n=this.rctx,o=typeof r=="boolean"&&r;let a;if(typeof e=="number")s.width=s.height=e,a=this._buildTileTexture(s,e);else if(G6(e))s.isOpaque=e.isOpaque,s.isOpaque&&(s.pixelFormat=Tt.RGB),a=this._buildTileTexture(s,e.element.width,o,e.element);else try{s.width=e.width,s.height=e.height,a=this._buildTileTexture(s,e.width,o,e)}catch{a=new a_e(P4e(n)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const l=n.bindTexture(a.texture,pi.TEXTURE_UNIT_FOR_UPDATES);return a.generateMipmap(),n.bindTexture(l,pi.TEXTURE_UNIT_FOR_UPDATES),a}_buildTileTexture(e,i,r=!1,s){const n=`${i} ${e.pixelFormat}`,o=this.cache.pop(n)??this.cache.pop(n+"compressed");if(r&&(r=D4e(s)),o)return o.retain(),r&&o.texture.enableCompression(!0),o.texture.setData(s),o;e.shouldCompress=r;const a=new pi(this.rctx,e,s);return a.isCompressing&&(this.texturesBeingCompressed++,this.addHandles([H(()=>a.isCompressing,l=>{l?this.texturesBeingCompressed++:this.texturesBeingCompressed--},Yt)])),new a_e(a,this.cache)}get test(){}};function Z9(t,e,i){var o;Ra.layerIndex=e,Ra.vtlNeighborInfos.clear();const r=t.layerInfo[kt.MAP][e];if(di(Ra.offset,0,0),Ra.tile=t,Ra.scale=1,Ra.sourceLod=t.lij,Ra.sourceLayerInfo=r,Ra.isVTLBackground=i,r.data)return i&&t.forEachLoadedNeighbor((a,l)=>{if(a.level!==t.level)return;const c=a.layerInfo[kt.MAP][e];if(!Wke(c)||r.data===c.data)return;const h=Ra.vtlNeighborInfos.pushNew();h.offset=gy[l],h.sourceLod=a.lij,h.sourceLayerInfo=c}),Ra;const s=r.upsampleInfo,n=(o=s==null?void 0:s.tile)==null?void 0:o.layerInfo[kt.MAP][e];return n&&s.tile?(Ra.tile=s.tile,Vn(Ra.offset,s.offset),Ra.scale=s.scale,Ra.sourceLod=s.tile.lij,Ra.sourceLayerInfo=n,Ra):i?Ra:null}function kMt(t){const e=t.sourceLayerInfo.data;return!!e.source&&e.interpolation==="nearest"}function L4e(t){let e=t.blendMode!=="normal";return J$(t.parent)&&(e=L4e(t.parent)||e),e}function N4e(t,e){J$(t.parent)&&N4e(t.parent,e);const i=t.uid;if(i!=null&&i!==""){const r=fV.get(i);r?r.start=e:fV.set(i,new FMt(e,e,t.blendMode,t.opacity,mn.Composite,1))}}function zMt(t,e,i,r){const s=t.renderData,n=!r&&s.textureReference!=null&&(t.surface.view.layerViewManager.updating||e>0)?Ab.Delayed:Ab.Immediate;s.setTextureReference(new uV(i,Rs.FADING,F4e,t.surface.baseOpacity,0,1),n)}u([p({constructOnly:!0})],c_.prototype,"rctx",void 0),u([p({constructOnly:!0})],c_.prototype,"techniques",void 0),u([p({constructOnly:!0})],c_.prototype,"cache",void 0),u([p()],c_.prototype,"tileSize",void 0),u([p()],c_.prototype,"texturesBeingCompressed",void 0),c_=u([A("esri.views.3d.terrain.TileRenderer")],c_);const fV=new Map,fE=new Array,Ra=new PMt,F4e=Yi(0,0,1,1),gy=new Array;gy[nt.NORTH]=[0,-1],gy[nt.NORTH_EAST]=[-1,-1],gy[nt.EAST]=[-1,0],gy[nt.SOUTH_EAST]=[-1,1],gy[nt.SOUTH]=[0,1],gy[nt.SOUTH_WEST]=[1,1],gy[nt.WEST]=[1,0],gy[nt.NORTH_WEST]=[1,-1];const UMt=200,Y9=40,BMt=.8,VMt=10,hQ=1e-6;function jMt(t,e,i){const r=e,s=i;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=t[a];if(r[a]<l){if(s[a]<=hQ)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-1e-6){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=t[a+3];if(r[a]>l){if(s[a]>=-1e-6)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]>=hQ){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}let l_e=class{constructor(e,i,r,s,n){this.aabb=e,this.axis=i,this.d=r,this.midStartIndex=s,this.rightStartIndex=n}},k4e=class dQ{constructor(e,i,r,s){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=i,this.positions=s,this._rayDirection=$(),this._callback=u_e,this._intersectionOptions=c_e,this.bspNodeTree=new Array;const n=r-i,o=new(n<ZMt?Uint8Array:n<YMt?Uint16Array:Uint32Array)(n);this.triangleIndexMap=o;for(let a=0;a<n;++a)o[a]=a;{const a=WMt(e,i,r,s.data,s.stride),l=ue(Math.log2(n/Y9),2,VMt),c=(h,d,f)=>{const m=HMt(o,a,h,d),g=d-h;if(g<=Y9){const S=new l_e(m,void 0,0,h,d);return this.bspNodeTree.push(S),S}const{axis:v,midValue:_}=qMt(m),b=GMt(o,a,h,d,v,_),w=(S,C)=>{if(f>l)return;const T=C-S;return T<Y9||T>=BMt*g?void 0:c(S,C,f+1)},x=new l_e(m,v,_,b.next,b.mid);return this.bspNodeTree.push(x),x.leftNode=w(h,b.next),x.rightNode=w(b.mid,d),x};c(0,n,0)}}intersectRayTriangleRange(e,i){if(e>=i)return;const r=this.positions;J3e(this._rayFrom,this._rayDirection,e,i,this.globalTriangleVertexIndices,r.data,r.stride,this._intersectionOptions.normalRequired,this._callback,this.triangleIndexMap,this.firstTriangleIndex),dQ.numFacesTested+=i-e}intersectRay(e,i,r,s){dQ.numFacesTested=0;const n=e,o=i,a=o[0]-n[0],l=o[1]-n[1],c=o[2]-n[2];if(a*a+l*l+c*c<hQ)return;this._rayFrom=n;const h=this._rayDirection;h[0]=a,h[1]=l,h[2]=c;const d=this.triangleIndexMap.length;this._callback=s,this._intersectionOptions=r,this.intersectRayBSP(this.bspNodeTree[0],0,d),this._callback=u_e,this._intersectionOptions=c_e}intersectRayBSP(e,i,r){const s=this._rayFrom,n=this._rayDirection;if(!jMt(e.aabb,s,n))return;const o=e.axis,a=e.d;if(s[o]<a||n[o]<0){const l=i,c=e.midStartIndex;if(l<c){const h=e.leftNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),s[o]>a||n[o]>0){const l=e.rightStartIndex,c=r;if(l<c){const h=e.rightNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleIndexMap.byteLength}};k4e.numFacesTested=0;const mE=[1/0,1/0,1/0],gE=[-1/0,-1/0,-1/0];function GMt(t,e,i,r,s,n){let o=i,a=r;for(;o<a;){const c=t[o];e[6*c+s+3]<=n?++o:(--a,t[o]=t[a],t[a]=c)}let l=o;for(a=r;l<a;){const c=t[a-1];e[6*c+s]>=n?--a:(t[a-1]=t[l],t[l]=c,++l)}return{next:o,mid:l}}function HMt(t,e,i,r){if(r<=i)return rA(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*t[i];for(let n=0;n<3;++n)mE[n]=e[s+0+n],gE[n]=e[s+3+n]}for(let s=i+1;s<r;++s){const n=6*t[s];for(let o=0;o<3;++o)mE[o]=Math.min(mE[o],e[n+0+o]),gE[o]=Math.max(gE[o],e[n+3+o])}return rA(mE[0],mE[1],mE[2],gE[0],gE[1],gE[2])}function qMt(t){const e=t[3]-t[0],i=t[4]-t[1],r=t[5]-t[2],s=e>i?e>r?0:i>r?1:2:i>r?1:r>e?2:0;return{axis:s,midValue:(t[s]+t[s+3])/2}}function WMt(t,e,i,r,s){const n=i-e,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+e),c=t[l]*s,h=t[l+1]*s,d=t[l+2]*s;for(let f=0;f<3;++f){const m=r[c+f],g=r[h+f],v=r[d+f];o[6*a+f]=Math.min(m,g,v),o[6*a+3+f]=Math.max(m,g,v)}}return o}const ZMt=255,YMt=65535,c_e=new p6,u_e=()=>{};let fl=class extends Zm{constructor(e){super(),this.spherical=e,this.overlayMode=Dm.Disabled,this.tileBlendInput=km.LayerOnly,this.transparencyMode=va.Opaque,this.pbrMode=Ct.Simplified,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.screenSpaceReflections=!1,this.cloudReflections=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.normalType=kr.Compressed,this.textureCoordinateType=Ys.Compressed,this.highStepCount=!1,this.useCustomDTRExponentForWater=!1,this.useFillLights=!1,this.hasColorTexture=!0,this.canHaveOverlay=!0}};u([ie({count:Dm.COUNT})],fl.prototype,"overlayMode",void 0),u([ie({count:km.COUNT})],fl.prototype,"tileBlendInput",void 0),u([ie({count:va.COUNT})],fl.prototype,"transparencyMode",void 0),u([ie({count:Ct.COUNT})],fl.prototype,"pbrMode",void 0),u([ie()],fl.prototype,"doublePrecisionRequiresObfuscation",void 0),u([ie()],fl.prototype,"receiveShadows",void 0),u([ie()],fl.prototype,"backfaceCullingEnabled",void 0),u([ie()],fl.prototype,"textureFadingEnabled",void 0),u([ie()],fl.prototype,"renderOccluded",void 0),u([ie()],fl.prototype,"screenSpaceReflections",void 0),u([ie()],fl.prototype,"cloudReflections",void 0),u([ie()],fl.prototype,"tileBorders",void 0),u([ie()],fl.prototype,"visualizeNormals",void 0),u([ie()],fl.prototype,"screenSizePerspective",void 0),u([ie()],fl.prototype,"receiveAmbientOcclusion",void 0);const J9=7,JMt=10,X9=fh();let Ru=class extends OL{get _isGlobal(){return this._stage.viewingMode===je.Global}get _techniques(){return this._context.techniques}get _rctx(){return this._context.renderContext.rctx}constructor(e,i,r,s,n){super({}),this._overlayRenderer=e,this._stage=i,this._allTiles=r,this._ellipsoidRadius=s,this.type=Xr.TERRAIN,this.isGround=!0,this._passParameters=new _ae,this._drawParameters=new Jke,this._renderDataPool=new Ol(H$t),this._visiblePatchesByOrigin=new Map,this._allPatchesByOrigin=new Map,this._patchesByOriginDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new t4e,this._castShadows=!1,this._inViewshed=!1,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.renderOccludedFlags=Cr.Occlude,this.produces=new Map([[xe.OPAQUE_TERRAIN,()=>this._produces()&&this.transparency===va.Opaque],[xe.TRANSPARENT_TERRAIN,()=>this._produces()&&(this.transparency===va.Transparent||this.transparency===va.InvisibleWithDraped)],[xe.OCCLUDED_TERRAIN,()=>this._produces()]]),this._tileSize=256,this._configuration=new fl(i.viewingMode===je.Global),this._tileTextureCache=new UL((o,a)=>n.newCache(o,a),"TileTexture"),this.tileGeometryCache=new LAt(n)}normalizeCtorArgs(){return{}}initialize(){this._stage.addRenderPlugin(this),this.addHandles(H(()=>this._overlayRenderer.rendersOccludedDraped,e=>{this.renderOccludedFlags=e?_P:Cr.Occlude,this.setNeedsRender()},Yt))}destroy(){this._stage.removeRenderPlugin(this),this._tileTextureCache.destroy(),this.tileGeometryCache.destroy()}_produces(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}consumes(){return this._overlayRenderer.hasWater?cyt:rLe}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set visible(e){this._set("visible",!!e),this.setDirty()}updateHeading(e){var i;(i=this._tileRenderer)==null||i.updateHeading(e)}set transparency(e){this._configuration.transparencyMode!==e&&(this._configuration.transparencyMode=e,this.setNeedsRender())}get transparency(){return this._configuration.transparencyMode}get tileRenderer(){return this._tileRenderer}get texturesBeingCompressed(){var e;return this._tileRenderer?(e=this._tileRenderer)==null?void 0:e.texturesBeingCompressed:null}get renderPatchBorders(){return this._configuration.tileBorders}set renderPatchBorders(e){this._configuration.tileBorders!==e&&(this._configuration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return this._configuration.visualizeNormals}set visualizeNormals(e){this._configuration.visualizeNormals!==e&&(this._configuration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._configuration.backfaceCullingEnabled}set cullBackFaces(e){this._configuration.backfaceCullingEnabled!==e&&(this._configuration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}get layerUid(){return qb}get slicePlaneEnabled(){return this._configuration.hasSlicePlane}set slicePlaneEnabled(e){this._configuration.hasSlicePlane!==e&&(this._configuration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._configuration.textureFadingEnabled!==e&&(this._configuration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._configuration.pbrMode!==e&&(this._configuration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._configuration.screenSizePerspective!==e&&(this._configuration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}set tileSize(e){this._tileSize=e,this._tileRenderer!=null&&(this._tileRenderer.tileSize=e),this.setDirty()}get tileSize(){return this._tileSize}_ensureRenderData(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e,this._getLocalOriginOfTile(e)))}loadTile(e){this._ensureRenderData(e),this.updateTileGeometryState(e),this.reuseTextureFromParent(e)||this.updateTileTexture(e,st.TEXTURE_FADING)}reuseTextureFromParent(e){var s;const i=e.parent;if(!i)return!1;const r=Yi(1&e.lij[2]?.5:0,1&e.lij[1]?0:.5,.5,.5);return((s=i.renderData)==null?void 0:s.reuseTexture(e.renderData,r))??!1}updateTileTexture(e,i){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(e,i===st.TEXTURE_FADING?Rs.FADING:Rs.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(i))}updateTileGeometryState(e){for(const r of e.layerInfo[kt.ELEVATION])r.pendingUpdates&=~st.GEOMETRY;e.resetPendingUpdate(st.GEOMETRY);const i=e.renderData.updateGeometryState();return i&&this.setDirty(),i}updateGeometryIfNeeded(e){e.loaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const i=e.renderData;i&&(i.releaseGeometry(),this._renderDataPool.release(i),i.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const i=JMt-J9,r=Math.max(0,Math.floor((e.level-i)/J9)*J9);if(this._isGlobal&&r===0)return cn;for(;e.parent&&e.level>r;)e=e.parent;return e.centerAtSeaLevel}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=$t.UPDATE){this._patchesByOriginDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=$t.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=$t.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._tileRenderer=new c_({rctx:this._rctx,tileSize:this._tileSize,techniques:this._techniques,cache:this._tileTextureCache}),this.updateTileBackground(),this._emptyTex=P4e(this._rctx)}uninitializeRenderContext(){this._emptyTex=Dt(this._emptyTex),this._tileRenderer=Dt(this._tileRenderer)}intersect(e,i,r,s){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==va.Opaque)return;const n=XMt,o=KMt;be(n,s,r),se(o,1/n[0],1/n[1],1/n[2]);const a=e.results.min,l=e.results.max,c=e.results.ground,h=e.options.store===Co.MIN,d=!!e.results.ground.target,f=Idt(e.verticalOffset),m=e.tolerance;let g,v=h&&a.dist!=null?a.dist:1/0;const _=e.options,b=_.normalRequired||!_.backfacesTerrain,w=new p6(!1,b),x=C=>{const T=C.renderData;if(!(T!=null&&T.vao))return;const M=T.geometry;bG(X9,M.boundingBox);const I=T.localOrigin;f!=null&&(f.localOrigin=I,f.applyToAabb(X9));const D=X9;if(yE[0]=r[0]-I[0],yE[1]=r[1]-I[1],yE[2]=r[2]-I[2],!Une(D,yE,o,m,v))return;const P=(te,le,de)=>{te.set(this.type,C,le,de,eo),v=h&&a.dist!=null?a.dist:1/0},F=(te,le,de)=>{if((!b||de!=null)&&te>=0&&(_.backfacesTerrain||fe(de,n)<0)&&(_.invisibleTerrain||!_.selectionMode||i==null||i(r,s,te))){if((c.dist==null||te<c.dist)&&P(c,te,de),_.isFiltered)return;_.store===Co.ALL&&(g==null?(g=ane(e.ray),P(g,te,de),e.results.all.push(g)):te<g.dist&&P(g,te,de)),(a.dist==null||te<a.dist)&&P(a,te,de),_.store!==Co.MIN&&(l.dist==null||te>l.dist)&&P(l,te,de)}},L=QMt;be(L,s,I);const{indices:N,indexCount:R}=M,k=M.vertexAttributes,W=k.getField(z.POSITION,IS),j=new e6(W.typedBuffer,3,k.stride/4),B=R/3;if(!f&&B>UMt){const te=C.renderData;te.intersectionData==null&&(te.intersectionData=new k4e(N,0,B,j)),te.intersectionData.intersectRay(yE,L,w,F)}else uft(yE,L,0,B,N,j,f,w,F)},S=this._rootTiles;S!=null&&(()=>{const C=this._tileIterator;C.reset(S);const T=e.options.invisibleTerrain;for(let M=C.next();M;M=C.next())!(M.visible||T&&M.intersectsClippingArea)||f==null&&!M.intersectsRay(r,n,m,v)||d&&this._useStencilForTile(M)?C.skipSubtree():x(M)})()}processScaleRangeQueries(e,i){var r;if(!i.done)for(this._updatePatchGroups();e.updating&&!i.done;){e.prepare();for(const s of this._visiblePatchesByOrigin.values())for(const n of s)((r=n.renderData)==null?void 0:r.textureReference)!=null&&e.queriesForTile(n);e.process(),i.madeProgress()}}acquireTechniques(e){const i=!!X("enable-feature:terrain-shadows")&&e.bind.shadowMap.enabled;i!==this._castShadows&&(this._castShadows=i,this._patchesByOriginDirty=!0);const r=e.bind.viewshedEnabled;if(this._inViewshed!==r&&(this._inViewshed=r,this._patchesByOriginDirty=!0),e.bind.slot===xe.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&_P))return null}else{const s=this.transparency===va.Opaque?xe.OPAQUE_TERRAIN:xe.TRANSPARENT_TERRAIN;if(e.bind.slot!==s)return null}if(this.transparency===va.Invisible)return null;switch(this._configuration.screenSpaceReflections=this._configuration.cloudReflections=this._configuration.receiveShadows=this._configuration.receiveAmbientOcclusion=!1,this._configuration.overlayMode=this._overlayRenderer.mode,e.output){case Y.Color:case Y.ColorEmission:return this._configuration.screenSpaceReflections=e.bind.ssr.lastFrameColor!=null,this._configuration.cloudReflections=e.bind.clouds.data!=null,this._configuration.receiveShadows=e.bind.shadowMap.ready,this._configuration.receiveAmbientOcclusion=e.bind.ssao!=null,this._acquireTechnique(e.output,e.bind.slot===xe.OCCLUDED_TERRAIN);case Y.Shadow:case Y.ShadowExcludeHighlight:return this._castShadows?this._acquireTechnique(Y.Shadow,!1):null;case Y.ViewshedShadow:return this._inViewshed?this._acquireTechnique(Y.ViewshedShadow,!1):null;case Y.Depth:case Y.Normal:return this._acquireTechnique(e.output,!1);case Y.ObjectAndLayerIdColor:return this._acquireTechnique(Y.ObjectAndLayerIdColor,!1);case Y.Highlight:return this._overlayRenderer.hasHighlights?this._acquireTechnique(Y.Highlight,!1):null}return null}render(e,i){var r;switch(this._updatePatchGroups(),i.useStencil=!1,e.output){case Y.Color:case Y.ColorEmission:{const s=e.bind.slot===xe.OCCLUDED_TERRAIN?sr.Occluded:sr.Color;this._renderMaterialPass(e,i,s);break}case Y.Depth:case Y.Normal:this._renderAuxiliaryPass(e,i,sr.Color,this._visiblePatchesByOrigin);break;case Y.Highlight:{const s=(r=e.bind.highlight)==null?void 0:r.name;s&&this._overlayRenderer.hasHighlights&&this._overlayRenderer.renders(sr.Highlight)&&this._overlayRenderer.hasHighlightOptions(s)&&this._renderAuxiliaryPass(e,i,sr.Highlight,this._visiblePatchesByOrigin);break}case Y.Shadow:case Y.ShadowExcludeHighlight:case Y.ViewshedShadow:this._renderAuxiliaryPass(e,i,null,this._allPatchesByOrigin);break;case Y.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,i,sr.ObjectAndLayerIdColor,this._visiblePatchesByOrigin)}}updateTileBackground(e){if(this._tileRenderer==null)return;const i=this._tileRenderer;let r;if(e!=null){const s=Je.toUnitRGBA(e);r=De(s[0]||0,s[1]||0,s[2]||0)}i.setBackground(r),this._allTiles.forAll(s=>i.updateTileTexture(s,Rs.FADING)),this._configuration.tileBlendInput=i.backgroundIsGrid?km.GridComposite:i.backgroundColor!=null?km.ColorComposite:km.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchesByOriginDirty&&(this._rebuildPatchGroups(),this._patchesByOriginDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==OA.NONE){const e=Array.from(this._visiblePatchesByOrigin.values()),i=this._stencilEnabledLayerExtents;for(const r of e)M$t(this.renderOrder,r,i);e.sort((r,s)=>i4e(r[0],s[0],this.renderOrder)),this._visiblePatchesByOrigin=new Map(e.map(r=>[r[0].renderData.localOrigin,r])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){var i;const e=this._rootTiles;if(e!=null){(i=e[0])==null||i.surface.checkAllTilesWaterproofness(),this._visiblePatchesByOrigin.clear(),this._allPatchesByOrigin.clear();for(const r of e)this._rebuildPatchGroupsForRootTile(r)}}_rebuildPatchGroupsForRootTile(e){const i=this._tileIterator;for(i.resetOne(e);!i.done;){const r=i.next(),s=r.renderData;if(!s){this._numTilesCulled++;continue}const n=s.localOrigin;if(this._castShadows||this._inViewshed){let a=this._allPatchesByOrigin.get(n);a||(a=[],this._allPatchesByOrigin.set(n,a)),a.push(r)}if(!r.visible){this._numTilesCulled++,i.skipSubtree();continue}let o=this._visiblePatchesByOrigin.get(n);o||(o=[],this._visiblePatchesByOrigin.set(n,o)),o.push(r),i.skipSubtree()}}_useStencilForTile(e){for(const i of this._stencilEnabledLayerExtents)if(e.intersectsExtent(i))return!0;return!1}_renderAuxiliaryPass(e,i,r,s){const n=e.rctx;this._passParameters.overlayContent=r,n.bindTechnique(i,e.bind,this._passParameters);const o=this._stencilEnabledLayerExtents.length>0;s.forEach(a=>{this._drawParameters.origin=a[0].renderData.localOrigin,i.program.bindDraw(e.bind,this._passParameters,this._drawParameters);for(let l=0;l<a.length;l++)this._renderPatch(e,i,a[l],Gi.TRIANGLES,o,r)}),e.rctx.bindVAO(null)}_renderMaterialPass(e,i,r){var f;const{rctx:s}=e;this._passParameters.overlayContent=r,s.bindTechnique(i,e.bind,this._passParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0;const n=e.bind.camera,o=i.program;if(this._configuration.screenSizePerspective&&this.pointsOfInterest){const m=O3e(this._stage.viewingMode,this._ellipsoidRadius),g=this.pointsOfInterest.centerOnSurfaceFrequent.distance;m.update({distance:g,fovY:n.fovY})}const a=this._stencilEnabledLayerExtents.length>0,l=r===sr.Occluded;l&&(o.bindTexture("tex",this._emptyTex),o.setUniform3fv("textureOpacities",cn),o.setUniform4fv("texOffsetAndScale",an));const c=((f=this._tileRenderer)==null?void 0:f.backgroundColor)!=null?this._tileRenderer.backgroundColor:cn;this._configuration.tileBlendInput===km.ColorComposite&&o.setUniform3fv("backgroundColor",c);const h=this.wireframe?Gi.LINES:Gi.TRIANGLES;this._configuration.textureFadingEnabled&&o.bindTexture("texNext",this._emptyTex);const d=this._visiblePatchesByOrigin;for(const m of d.values()){const g=m[0].renderData.localOrigin;this._drawParameters.origin=g,i.program.bindDraw(e.bind,this._passParameters,this._drawParameters),this._numOriginsRendered++;for(const v of m){const _=v.renderData,b=_.textureReference;if(b!=null){if(!l){o.setUniform4fv("texOffsetAndScale",b.offsetAndScale),o.bindTexture("tex",b.texture.texture);const w=_.textureFadeFactor,x=w<1?_.nextTextureReference:null;this._configuration.textureFadingEnabled&&x!=null&&w<1?(o.setUniform1f("fadeFactor",w),o.setUniform4fv("nextTexOffsetAndScale",x.offsetAndScale),o.setUniform3fv("nextTexOpacities",x.opacities),o.bindTexture("texNext",x.texture.texture)):o.setUniform1f("fadeFactor",1),_.textureIsFading&&this.setNeedsRender(),o.setUniform3fv("textureOpacities",b.opacities)}this._renderPatch(e,i,v,h,a,r),v.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,i,r,s,n,o){const a=r.renderData,l=a.vao,c=l==null?void 0:l.indexBuffer;if(!l||c==null)return void(Kn&&console.error("Rendered tile with no indices: ",r.lij," : ",a));const h=i.program;o==null||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(h,a.overlay),n&&(i.useStencil=this._useStencilForTile(r),e.rctx.setPipelineState(i.getPipeline()));const d=a.geometry.indexCount;e.rctx.bindVAO(l),h.assertCompatibleVertexAttributeLocations(l),e.rctx.drawElements(s,d,c.indexType,0)}_bindOverlayPatchData(e,i){e.setUniform4fv("overlayTexOffset",i.offsets),e.setUniform4fv("overlayTexScale",i.scales)}_acquireTechnique(e,i){return this._configuration.output=e,this._configuration.renderOccluded=i,this._techniques.get(G$t,this._configuration)}get test(){}hasHighlightOptions(e){return this._overlayRenderer.hasHighlightOptions(e)}};u([p({readOnly:!0})],Ru.prototype,"_isGlobal",null),u([p()],Ru.prototype,"renderOccludedFlags",void 0),u([p({value:!1})],Ru.prototype,"renderingDisabled",null),u([p({value:!0})],Ru.prototype,"visible",null),u([p()],Ru.prototype,"texturesBeingCompressed",null),u([p()],Ru.prototype,"renderPatchBorders",null),u([p()],Ru.prototype,"visualizeNormals",null),u([p()],Ru.prototype,"cullBackFaces",null),u([p({value:OA.FRONT_TO_BACK})],Ru.prototype,"renderOrder",null),u([p()],Ru.prototype,"wireframe",null),Ru=u([A("esri.views.3d.terrain.TerrainRenderer")],Ru);const XMt=$(),KMt=$(),yE=$(),QMt=$();let eOt=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},um=class extends he{constructor(e){super(e)}initialize(){this.addHandles([this.layers.on("change",()=>this._update()),H(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())]),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(i=>!(!HC(i)||i.isRejected())&&!(i.isFulfilled()&&!tOt(i,this.viewSpatialReference,this.viewingMode))&&(e=i,!((i==null?void 0:i.type)==="vector-tile"||aV(i)))),e)if(e.isResolved()){const i=q6(e,this.viewSpatialReference,this.viewingMode);if(i!=null){const r=new oc(i.tileInfo);this._lockTilingScheme(r)}}else this._updateWhen(e)}_updateWhen(e){const i=e.when().catch(()=>{}).then(()=>{i!==this._waitTask||this.destroyed||this._update()});this._waitTask=i}_lockTilingScheme(e){if(this.viewingMode===je.Global){const i=e.levels.length-1,r=e.spatialReference;r.isWebMercator?e=oc.makeWebMercatorAuxiliarySphere(i):mae(r)&&(e=oc.makeGCSWithTileSize(e.spatialReference,e.pixelSize,i))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this.removeAllHandles(),this.addHandles(H(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===je.Global){const e=this.extentHelper.viewSpatialReference;e.isWebMercator?this.tilingScheme=oc.WebMercatorAuxiliarySphere:Gke(e)&&(this.tilingScheme=oc.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;e==null||Hx(e,this.extent)||(this.tilingScheme=oc.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){}};function tOt(t,e,i){return q6(t,e,i)!=null}u([p()],um.prototype,"tilingScheme",void 0),u([p({readOnly:!0})],um.prototype,"extent",void 0),u([p({value:!1})],um.prototype,"tilingSchemeLocked",void 0),u([p({constructOnly:!0})],um.prototype,"viewSpatialReference",void 0),u([p({constructOnly:!0})],um.prototype,"layers",void 0),u([p({constructOnly:!0})],um.prototype,"extentHelper",void 0),u([p({constructOnly:!0})],um.prototype,"viewingMode",void 0),um=u([A("esri.views.3d.terrain.TilingSchemeLogic")],um);let iOt=class{constructor(){this._offset=Ye(),this.scale=0}get offset(){return this._offset}init(e,i,r,s){this.tile=e,this._offset[0]=i,this._offset[1]=r,this.scale=s}dispose(){this.tile=null,this._offset[0]=0,this._offset[1]=0,this.scale=0}};var cz;let qt=cz=class extends Ss.EventedMixin(he){get allTiles(){return this._allTiles}constructor(t){var e,i,r;super(t),this._scaleRangeQueries=new az,this._iteratorPool=new Ol(t4e,s=>s.remove=()=>this._iteratorPool.release(s)),this._postorderIterator=new C$t,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._usedMemory=null,this._performanceInfo=new eOt,this._viewChanged=!1,this.heading=0,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=$(),this._eyePosSurfaceSR=$(),this._splitLimits=new xp,this._frustum=zB(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._watchUpdatingTracking=new rv,this._frameTask=nA,this._allTiles=new ii,this._upsampleInfoPool=new Ol(iOt),this._shouldEmitChangeEvent=!1,this._destroying=!1,this._rootTilesExtent=si(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=Oe.WebMercator,this._elevationProjectorCache=new Map,this.visibleElevationBounds=new CC(1/0,-1/0),this.rootTileElevationBounds=new CC(1/0,-1/0),this._projectorCache=new Map,this._radiusModifier=Math.cos(Math.PI/16/16),this._tilingSchemeSpatialReference=null,this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateCarree=!1,this.overlayManager=new Hl({...t,surface:this}),this._isGlobal=!((i=(e=t.view)==null?void 0:e.state)!=null&&i.isLocal),this._isGeographic=((r=this._spatialReference)==null?void 0:r.isGeographic)??!1,this._tileConstructor=this._isGlobal?RAt:MAt,this._ellipsoid=yr(t.view.spatialReference)}initialize(){const t=this.view,e=t.resourceController,i=e.memoryController;this._tileCache=new UL((l,c)=>i.newCache(l,c),"terrain-tile"),this._upsampleMapCache=i.newCache("terrain-upsample",l=>l.unloadMapData()),this._elevationQueryCache=new NCt(i.newCache("elevation-query"));const r=this.overlayManager;this._renderer=new Ru(r.renderer,t._stage,this._allTiles,this._ellipsoid.radius,i),this.addHandles([H(()=>r.renderer.isEmpty,()=>this._evaluateTransparency()),H(()=>this.renderer.visible,l=>this.suspended=!l),H(()=>this.heading,l=>{this._renderer.updateHeading(l),this._updateTileTextures(Rs.FADING)}),H(()=>{var l,c;return{heading:(l=t.camera)==null?void 0:l.heading,state:(c=t.state)==null?void 0:c.mode}},({heading:l,state:c})=>{if(l==null)return;if(this.isGlobal&&this.isGeographic||this.isWebMercatorOnPlateCarree)return void(this.heading=90*Math.round(l/90)%360);const h=Math.round(l)%360,d=Math.abs(h-this.heading);(c===ui.IDLE||Math.min(d,360-d)>=30)&&(this.heading=h)})],"overlayManager"),this.addHandles([H(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?Rs.UNFADED:Rs.IMMEDIATE)},Mt),H(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?Rs.UNFADED:Rs.IMMEDIATE),Mt),H(()=>this.backgroundColor,(l,c)=>{l!=null&&l.equals(c)||(this._handleLayerViewChanges(),this._renderer.updateTileBackground(l))},Yt),H(()=>this.snapLevel,()=>this._viewChanged=!0,Yt),H(()=>this.view.pointsOfInterest,l=>{this._renderer.pointsOfInterest=l,this._watchUpdatingTracking.removeAll(),l&&this._watchUpdatingTracking.add(()=>l.focus.renderLocation,()=>this._allTilesSorted=!1)}),H(()=>xs.TERRAIN_TILE_TREE_SHOW_TILES,l=>{l&&!this._treeDebugger?G(()=>import("./TerrainTileTree3DDebugger-BfKaBqz9.js"),__vite__mapDeps([362,363])).then(({TerrainTileTree3DDebugger:c})=>{!this._treeDebugger&&xs.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new c({view:t}))}):l||(this._treeDebugger=$e(this._treeDebugger))},Ut)]),this.addHandles([H(()=>{var l;return(l=this._renderer.tileRenderer)==null?void 0:l.texturesBeingCompressed},(l,c)=>{c&&l<c&&(this.setMemoryDirty(),this._allTiles.forAll(h=>h.setMemoryDirty()))})]),this.addHandles([H(()=>this._renderer.texturesBeingCompressed,(l,c)=>{l===0&&l!==c&&this.requestRender()})]);const{spatialReference:s}=t;this._extentHelper=n$t(this.viewingMode,{layers:t.map.allLayers,layerViews:t.allLayerViews,viewSpatialReference:s});const n=new j$({getCollections:()=>{var l,c;return(c=(l=t.defaultsFromMap)==null?void 0:l.mapCollections)==null?void 0:c.map(({layers:h})=>h)},getChildrenFunction:l=>l&&"layers"in l?l.layers:null}),o=new um({layers:n,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:s});this._set("tilingSchemeLogic",o),this._updateTilingScheme(),this._elevationDataRequester=e.createStreamDataRequester(Im.ELEVATION),this._mapDataRequester=e.createStreamDataRequester(Im.BASEMAP);const a=e.scheduler;this._frameTask=a.registerTask(lt.TERRAIN_SURFACE,this),this.addHandles([H(()=>this._extentHelper.stencilEnabledExtents,l=>this._renderer.setStencilEnabledLayerExtents(l),Ut),H(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),Yt),H(()=>this.extent,()=>this._updateRootTiles(),Ut),t.on("resize",()=>this._viewChangeUpdate()),H(()=>{const l=t.state;return[this._lodBias,this.lodSnappingEnabled,t.quality,l.camera,l.contentCamera,l.fixedContentCamera]},()=>this._viewChangeUpdate(),Mt),H(()=>{var l;return(l=t.qualitySettings)==null?void 0:l.fadeDuration},l=>this._renderer.textureFadingEnabled=l>0,Ut),H(()=>{var l;return(l=t.qualitySettings)==null?void 0:l.physicallyBasedRenderingEnabled},l=>this._renderer.pbrMode=l?Ct.Simplified:Ct.Disabled,Ut),H(()=>{var l;return(l=t.qualitySettings)==null?void 0:l.tiledSurface.elevationLevelDelta},()=>this._updateAllTileGeometries()),H(()=>this._userClippingExtent,()=>this._updateClippingExtent(),Yt)]),this.addHandles(t.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges(),this._renderer.updateTileBackground(this.backgroundColor)}destroy(){this._destroying=!0,this._frameTask.remove(),this._watchUpdatingTracking.destroy(),this._removeAllTiles(),this._set("tilingSchemeLogic",$e(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((t,e)=>this._unregisterTiledLayerView(e)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",$e(this.overlayManager)),this._tileCache=$e(this._tileCache),xae.prune(),this._treeDebugger=$e(this._treeDebugger),this._renderer=$e(this._renderer),this._iteratorPool=$e(this._iteratorPool),this._upsampleMapCache=$e(this._upsampleMapCache),this._elevationQueryCache=$e(this._elevationQueryCache),this._set("view",null),this._extentHelper=$e(this._extentHelper),this._upsampleInfoPool=$e(this._upsampleInfoPool),iAt()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){if(this.lodSnappingEnabled){const{view:t,tilingScheme:e}=this,i=t.scale;if(e&&i){const r=e.levelAtScale(i)+t.qualitySettings.tiledSurface.lodBias,s=e.getMaxLod();return r<=0?null:Math.min(r,s||1/0)}}return null}get lodSnappingEnabled(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get hasStencilEnabledExtents(){return this._extentHelper.stencilEnabledExtents.length>0}get _userClippingExtent(){const{spatialReference:t}=this,{clippingArea:e}=this.view;if(e==null||t==null)return null;const i=si(),r=wke(e,i,t)?i:null,s=this._get("extent");return Hx(r,s)?s:r}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const t=hZ(this.groundExtent,this._userClippingExtent,si()),e=this._get("extent");return Hx(t,e)?e:t}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var t;return(t=this.tilingSchemeLogic)==null?void 0:t.extent}get updating(){var t,e;return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||(t=this._watchUpdatingTracking)!=null&&t.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||(e=this.overlayManager)!=null&&e.updating||this.renderer.texturesBeingCompressed)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){var t,e,i;return((i=(e=(t=this.view)==null?void 0:t.map)==null?void 0:e.ground)==null?void 0:i.opacity)??1}set baseOpacity(t){this.view.map.ground.opacity=t}get viewingMode(){return this.view.state.viewingMode}get ready(){return this._rootTiles!=null}set renderOrder(t){this._renderer.renderOrder=t,this._set("renderOrder",t)}get rootTiles(){return this._rootTiles}get spatialReference(){var t;return((t=this.tilingScheme)==null?void 0:t.spatialReference)??null}get backgroundColor(){var t,e,i;return(i=(e=(t=this.view)==null?void 0:t.map)==null?void 0:e.ground)==null?void 0:i.surfaceColor}set backgroundColor(t){this.view.map.ground.surfaceColor=t}set slicePlaneEnabled(t){this._renderer.slicePlaneEnabled=t,this._set("slicePlaneEnabled",t),this._evaluateTransparency()}get tilingSchemeLocked(){var t;return((t=this.tilingSchemeLogic)==null?void 0:t.tilingSchemeLocked)??!1}get wireframe(){var t;return(t=this._renderer)==null?void 0:t.wireframe}set wireframe(t){t!==this._renderer.wireframe&&(this._renderer.wireframe=t,this._updateAllTileGeometries())}get opaque(){return this._renderer.transparency===va.Opaque}set suspended(t){this._set("suspended",t),this._viewChangeUpdate()}get fadeDuration(){return this.view.qualitySettings.fadeDuration??0}intersect(t,e,i,r){this._renderer.intersect(t,e,i,r)}getElevationLevelDelta(t){return t<4?3:this.view.qualitySettings.tiledSurface.elevationLevelDelta}getElevation(t,e,i,r){const s=this._rootTiles;if(!(s!=null&&s.length)||s[0].layerInfo[kt.ELEVATION].length===0)return null;let n=this._elevationProjectorCache.get(r);if(n===void 0&&(n=kb(r,this._spatialReference)??null,this._elevationProjectorCache.set(r,n)),n==null)return J.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;const o=se(PO,t,e,i);return n(o,0,o,0),h_e(s,o[0],o[1])}getElevations(t,e,i){const r=this._rootTiles,s=r?r[0].layerInfo[kt.ELEVATION].length:0;if(r!=null&&r.length&&s!==0)for(let n=0;n<e;++n){const o=3*n;i(n,h_e(r,t[o],t[o+1]))}else for(let n=0;n<e;++n)i(n,null)}getScale(t){if(!this.tilingScheme)return null;if(!gc(t,PO,this.spatialReference))return J.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const e=this._rootTiles;if(e!=null){for(const i of e)if(i!=null&&i.containsPoint(PO)){let r=i;for(;r.children[0]&&!r.rendered;){const s=r.children[0].extent;let n=0;PO[0]>s[2]&&(n+=1),PO[1]<s[1]&&(n+=2),r=r.children[n]}return this._getLodBiasCorrectedScale(r.level)}}return 1/0}_ensureProjector(t){const e=this._projectorCache.get(t);if(e)return e;const i=kb(t,this._tilingSchemeSpatialReference)??null;return this._projectorCache.set(t,i),i}getSphereElevationBounds(t,e){const i=this._ensureProjector(e);if(i==null)return J.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;AS(t,vE);const r=vE;i(r,0,r,0);const s=new nV,n=this._rootTiles;if(n!=null){const o=[];for(const l of n)o.push(l);let a=0;for(;a<o.length;){const l=o[a];if(++a,!mue(l.extent,vE))continue;const c=l.children;if(c[0]==null||l.rendered)s.expandElevationRangeValues(l.elevationBoundsMin,l.elevationBoundsMax);else for(const h of c)o.push(h)}}return s}getRootElevationBounds(){return new nV(this.rootTileElevationBounds.min,this.rootTileElevationBounds.max)}getLowerBoundRadius(){const t=(this._ellipsoid.radius+this.visibleElevationBounds.min)*this._radiusModifier;return Math.min(t,this._ellipsoid.radius)}getSphereScale(t,e){if(!this.tilingScheme)return null;if(!gc(t,vE,this.spatialReference))return J.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;vE[3]=e;let i=null;const r=n=>{if(n&&mue(n.extent,vE)){const o=n.children;if(o[0]&&!n.rendered)for(const a of o)r(a);else{const a=this._getLodBiasCorrectedScale(n.level);i=i==null?a:Math.min(i,a)}}},s=this._rootTiles;if(s!=null)for(const n of s)r(n);return i}queryVisibleScaleRange(t,e,i,r){const s=e?this.tilingScheme.levelAtScale(e):0,n=i?this.tilingScheme.levelAtScale(i):1/0,o=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(t,s+o,n+o,r)}_evaluateTransparency(){const t=this.baseOpacity,e=this.overlayManager.renderer.isEmpty,i=this._renderer.transparency,r=this._allSurfaceLayersTransparent()?e?va.Invisible:va.InvisibleWithDraped:t>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?va.Opaque:va.Transparent;return this._renderer.transparency=r,i!==r}_updateTilingScheme(){var i,r,s,n;const t=this.tilingSchemeLogic.tilingScheme;if(t===this.tilingScheme)return;fo(!!t,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((r=(i=this.view)==null?void 0:i.state)!=null&&r.isLocal),this.tilingScheme&&this._removeAllTiles();const e=(t==null?void 0:t.spatialReference)??Oe.WebMercator;this._spatialReference=e,this._isWebMercator=!!(e!=null&&e.isWebMercator),this._isWebMercatorOnPlateCarree=this._isWebMercator&&m3((s=this.view)==null?void 0:s.renderSpatialReference),this._isGeographic=(e==null?void 0:e.isGeographic)??!1,this._set("tilingScheme",t),this._tilingSchemeSpatialReference=(n=this.tilingScheme)==null?void 0:n.spatialReference,this._projectorCache.clear(),this._updateClippingExtent(),t&&(this._updateTiledLayers(),this._renderer.tileSize=t.pixelSize,this.overlayManager.spatialReference=t.spatialReference,this._updateRootTiles())}_acquireTile(t,e,i,r){const s=this._tileCache.pop(cz._tileMemcacheKey);return s?(s.init(t,e,i,r,this),s):new this._tileConstructor(t,e,i,r,this)}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:t,tilingScheme:e}=this;if(!e)return;const i=sOt;let r=e.rootTilesInExtent(t,i,5*gC);if(this._rootTiles!=null){if(r.length>gC)return void J.getLogger(this).warn(z_t);const s=this._rootTiles.map(o=>o.lij),n=vW(s,r,nz);if(this._updatingRootTiles=!0,n.removed.length>0||n.added.length>0){const o=this._rootTiles.filter(a=>!(n.removed.findIndex(l=>nz(l,a.lij))>-1)||(this._purgeTile(a),!1));n.added.forEach(a=>o.push(this._newRootTile(a))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,r.length>gC&&(J.getLogger(this).warn(U_t),r=e.rootTilesInExtent(t,i,gC)),this._setRootTiles(r.map(s=>this._newRootTile(s)));Hx(i,this._rootTilesExtent)||(this._rootTilesExtent=si(i)),this.renderer.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const t=this._allTiles.filter(e=>e.loaded&&e.intersectsClippingArea);t.sort(Fm),t.forEach(e=>this._renderer.updateTileGeometryState(e)),t.forEach(e=>e.renderData.updateNeighborData()),this._updateTilesGeometries(t),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(t){if(t.length===0)return;t.sort(Fm);const e=this.renderer;t.forEach(i=>e.updateGeometryIfNeeded(i)),t.forEach(i=>this._pendingTilesForElevationUpdateEvent.add(i))}_shouldSplit(t){return t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===st.SPLIT}_newRootTile(t){const e=this._acquireTile(0,t[1],t[2],null);return this._shouldSplit(e)&&e.setPendingUpdate(st.SPLIT),this._loadTile(e),this._markTileToUpdate(e),this._updateRootTileElevationBounds(),e}_setRootTiles(t){if(this._rootTiles=t,this._allTiles.clear(),t!=null){const e=this._iteratorPool.acquire();for(e.reset(t);!e.done;)this._allTiles.push(e.next());e.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(t)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this.renderer.visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(t){t.updateClippingStatus(this.extent)&&t.resetPendingUpdate(st.GEOMETRY)&&this._updateTileGeometryState(t)}_updateTilesVisibility(t){if(t==null)return;const e=N$t(t),i=this.visibleElevationBounds;let r=e?i.min:1/0,s=e?i.max:-1/0;const n=this.extent,o=this.view.state.contentCamera.viewProjectionMatrix;this.setTileTreeDirty();const a=this._iteratorPool.acquire();for(a.reset(t);!a.done;){const l=a.next();l.updateClippingStatus(n)&&l.resetPendingUpdate(st.GEOMETRY)&&this._updateTileGeometryState(l),l.computeVisibility(),l.updateScreenDepth(o),l.renderData&&(r=Math.min(l.elevationBoundsMin,r),s=Math.max(l.elevationBoundsMax,s))}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._updatePendingTileGeometries(),isFinite(r)&&isFinite(s)&&(i.min!==r||i.max!==s)&&(this.visibleElevationBounds=new CC(r,s))}_updateRootTileElevationBounds(){let t=1/0,e=-1/0;const i=this._rootTiles;i!=null&&i.forEach(({elevationBoundsMin:s,elevationBoundsMax:n})=>{t=Math.min(t,s),e=Math.max(e,n)});const r=this.rootTileElevationBounds;r.min===t&&r.max===e||(this.rootTileElevationBounds=new CC(t,e))}_updateViewDependentParameters(){const{camera:t,contentCamera:e}=this.view.state,i=Math.tan(.5*e.fovX),r=Math.tan(.5*e.fovY),s=this.tilingScheme.pixelSize,n=2**-this._lodBias*t.pixelRatio;this._splitLimits.aboveGround=t.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=s/t.width*this.maxTextureScale*n,this._splitLimits.relativeHeightLimit=s/t.height*this.maxTextureScale*n,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?this._splitLimits.frustum=eK(this._splitLimits.frustum??zB(),e.frustum):this._splitLimits.frustum=null,eK(this._frustum,t.frustum),ne(this._eyePosRenderSR,e.eye),vc(t.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateTileGeometryState(t){t.updateVisibility(),this._renderer.updateTileGeometryState(t)&&this._markTileToUpdate(t),this.setMemoryDirty()}_markAllTileNeighborsForUpdate(t){t.forEachLoadedNeighbor(e=>{this._layerViews[kt.MAP].some(MA)&&e.setPendingUpdate(st.TEXTURE_FADING),this._pendingTilesToUpdate.add(e)})}_updateTileTexture(t,e){const i=t.resetPendingUpdate(st.TEXTURE_FADING)?st.TEXTURE_FADING:!!t.resetPendingUpdate(st.TEXTURE_NOFADING)&&st.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(t,i),this._usedMemory=null,e.madeProgress())}_emitElevationUpdateEventForTiles(){if(!this._shouldEmitChangeEvent)return;const t=K9.extent;yv(t),this._pendingTilesForElevationUpdateEvent.forEach(e=>kC(t,e.extent,t)),this._pendingTilesForElevationUpdateEvent.clear(),K9.spatialReference=this.spatialReference,this.emit("elevation-change",K9),this._shouldEmitChangeEvent=!1}runTask(t){this._handleLayerViewChanges(t),this._frameTask.processQueue(t),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,t),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(t),this._sortTiles(t);const e=!this.view.state.fixedContentCamera;if(this._mergeAndSplit(t,e),this._updateElevation(t),this._updateTextures(t),e||this._mergeAndSplit(t,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._updatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),t.done&&t.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue"),Kn&&this._checkTileInvariant(),!t.hasProgressed)return ea}_checkTileInvariant(){const t=new Map;this._allTiles.forAll(e=>t.set(e,new Set)),this._allTiles.forAll(e=>{var i;if(fo(e.rendered===e.leaf,` rendered ${e.rendered} != ${e.leaf} leaf`),!e.leaf){const r=n=>n.unmergableChildCount===0&&n.maxLevelDeltaNeighborCount===0,s=e.children.reduce((n,o)=>n+(r(o)?0:1),0);if(fo(e.unmergableChildCount===s,` Tile[${e.lij.toString()}] unmergeable child count mismatch: actual ${e.unmergableChildCount} vs ${s}`),e.hasPendingUpdate(st.MERGE)){fo(!e.hasPendingUpdate(st.SPLIT),"Tile can be both split and merge at the same time");for(const n of e.children)fo(n.leaf||n.hasPendingUpdate(st.MERGE),"Child of tile to merge must also merge")}}for(let r=0;r<4;++r){if(e.rendered){const a=(i=e.renderData)==null?void 0:i.geometryState.edgePeerNeighbors[r];if(a!=null){{const l=e.level-a.level<=In;l||(console.log(`tile level delta [${e.lij.toString()}] vs [${a.lij.toString()}] > ${In}  (edge[${r}])`),fo(l,`tile level delta [${e.level}] vs [${a.level}] > ${In}`))}fo(e.level-a.level<=In,`Max tile lod delta exceeded: [${e.lij.toString()}] vs [${a.lij.toString()}]`)}}const s=e.level-In,n=a=>a.leaf||a.level===e.level,o=e.findNeighborTile(rf[r],n);if(o!=null){if(e.leaf&&e.level>=In){let a=o;for(;e.level-a.level<In;)a=a.parent;const l=[s,e.lij[1]>>In,e.lij[2]>>In];if(!nz(l,a.lij)){const c=t.get(a);fo(!c.has(e),"Cannot already have neighbor"),c.add(e)}}fo(o.rendered||o.level===e.level,"Non-same-level-neighbor of rendered must be rendered"),fo(e.level-o.level<=In,`Tile level delta [${e.level}] vs [${o.level}] > ${In}`)}}}),this._allTiles.forAll(e=>{const i=e.maxLevelDeltaNeighborCount,r=t.get(e);fo(i===r.size,`Tile[${e.lij.toString()}] merge-blocker mismatch: actual ${i} vs ${r.size}`)})}_updateAllTilesStatus(t){if(!this._viewChanged||!this._rootTiles||t.done)return;this._viewChanged=!1;const e=new nOt(this._allTiles.length);e.pushAll(this._rootTiles);const i=this.snapLevel,r=this._splitLimits,s=this._eyePosRenderSR;this._allTiles.forAll(o=>{o.maxLevelDeltaNeighborCount=0,o.unmergableChildCount=0});const n=this.view.state.contentCamera.viewProjectionMatrix;for(;!e.empty;){const o=e.pop(),a=o.parent,l=a!=null&&a.hasPendingUpdate(st.MERGE),c=l?st.MERGE:o.shouldSplit(r,s,i),h=c===st.SPLIT;o.leaf?Q9(o,h):e.pushAll(o.children),l?(o.resetPendingUpdate(st.SPLIT),o.leaf||o.setPendingUpdate(st.MERGE),this._updateClippingStatus(o),o.updateVisibility(),o.updateScreenDepth(n)):h?(o.resetPendingUpdate(st.MERGE),o.leaf&&o.setPendingUpdate(st.SPLIT)):(o.resetPendingUpdate(st.SPLIT)&&o.updateAgentSuspension(),c===st.ELEVATION&&o.updateAgents(kt.ELEVATION),o.leaf||(o.setPendingUpdate(st.MERGE),o.resetPendingUpdate(st.SPLIT)))}this.requestUpdate(),(this._shortBatches||!this._oneBatchPerFrameTask)&&this._updatePendingTileGeometries(),t.madeProgress()}_sortTiles(t){t.done||this._allTilesSorted||(D$t(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),t.madeProgress())}_markTileToUpdate(t){Ie(t.loaded),t.intersectsClippingArea&&(this._pendingTilesToUpdate.add(t),this._markAllTileNeighborsForUpdate(t))}_updatePendingTileGeometries(){const t=this._pendingTilesToUpdate,e=Array.from(t.keys()).filter(s=>s.loaded&&s.intersectsClippingArea);if(e.length===0)return void t.clear();const i=(s,n)=>{!(n!=null&&n.loaded)||!n.intersectsClippingArea||n.level<s.level||t.has(n)||(t.add(n),e.push(n),n.renderData.updateNeighborData())};e.sort(Fm);const r=e.length;for(let s=0;s<r;++s){const n=e[s];Ie(n.loaded),Ie(n.intersectsClippingArea);const o=n.renderData;o.updateNeighborData();const a=o.dirtyEdgeResolutions,l=o.geometryState,c=h=>{var f;const d=cV[h];i(n,(f=l.cornerPeerNeighbors[h])==null?void 0:f.findCorner(lV(d),m=>m.loaded))};for(let h=0;h<4;++h)if(a&1<<h){const d=o.geometryState.edgePeerNeighbors[h];d&&(d==null?void 0:d.level)>=n.level&&d.forAllSubtreeOnSide(gae(rf[h]),f=>!(!f.loaded||!f.intersectsClippingArea)&&(Ie(t.has(f)||Fm(n,f)<0),i(n,f),!0)),c((h+1)%4),c(h)}}t.clear(),this._updateTilesGeometries(e),this._shouldEmitChangeEvent=!0,Kn&&oV&&this.checkAllTilesWaterproofness()}_mergeAndSplit(t,e){if(this.suspended||t.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let i=!1;const r=this.view.state.fixedContentCamera;let s=!1;for(;!t.done;){s=!0;let n=!1;const o=!this._allTiles.some(a=>{if(!i&&!r&&!a.visible)return t.done;let l=a;if(a.hasPendingUpdate(st.MERGE)){if(!e||a.unmergableChildCount>0)return t.done;for(a.resetPendingUpdate(st.MERGE);l.parent!=null&&l.parent.unmergableChildCount===0&&l.parent.resetPendingUpdate(st.MERGE);)l=l.parent;this._mergeTile(l),n=!0,t.madeProgress()}else if(a.resetPendingUpdate(st.SPLIT)){let c=!0;const h=a.level;if(h>=In){const d=f=>f.leaf||h-f.level<In;for(let f=0;f<4;++f){const m=a.findNeighborTile(rf[f],d);m!=null&&h-m.level===In&&(c=!1,Kn&&(Ie(m.leaf),Ie(m.hasPendingUpdate(st.SPLIT))))}}c?(this._splitTile(a),t.madeProgress(),n=!0):a.setPendingUpdate(st.SPLIT)}return t.done});if(n&&(this._allTilesSorted=!1,this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries()),o){if(!i){i=!0;continue}if(!n)break}else this._allTilesDirty=!0}s?t.madeProgress():this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries(),this._sortTiles(t)}_updateElevation(t){t.done||(this._allTiles.some(e=>(e.resetPendingUpdate(st.GEOMETRY)&&(this._updateTileGeometryState(e),this._shortBatches&&this._updatePendingTileGeometries(),t.madeProgress()),t.done)),!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries())}_updateTextures(t){t.done||this._allTiles.some(e=>(this._updateTileTexture(e,t),t.done))}_updateClippingExtent(){var t;this.spatialReference&&((t=this.overlayManager)==null||t.updateOverlayParameters($t.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const t=this.view.quality;return this.view.qualitySettings.tiledSurface.lodBias-(1-t)*F_t}_getLodBiasCorrectedScale(t){const e=this.tilingScheme.levels,i=ue(t-this._lodBias,0,e.length-1),r=i-Math.floor(i);return e[Math.floor(i)].scale*(1-r)+e[Math.ceil(i)].scale*r}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(t=>this._purgeTile(t)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.renderer.visible=!1}_purgeSubtree(t){const e=t.children;e[0]&&(this._purgeTile(e[0]),this._purgeTile(e[1]),this._purgeTile(e[2]),this._purgeTile(e[3]),t.clearChildren())}_purgeTile(t){t.leaf?d_e(t):this._purgeSubtree(t),this._allTiles.removeUnordered(t),this._unloadTile(t),t.dispose(),this._tileCache.put(cz._tileMemcacheKey,t)}_unloadTile(t){this._pendingTilesToUpdate.delete(t),this._pendingTilesForElevationUpdateEvent.delete(t),t.unload()}_splitTile(t){fo(t.leaf,"Tile that is already split should not be split again!"),fo(t.rendered,"Tile marked to split is not rendered"),d_e(t);const e=t.createChildren();this._allTiles.pushArray(e),t.updateAgentSuspension(),fo(t.rendered,"parent should be rendered"),e.forEach(i=>this._loadTile(i)),e.forEach(i=>this._pendingTilesToUpdate.add(i)),this._unloadTile(t),this._markAllTileNeighborsForUpdate(t),this._emitTileScaleChange(t,t.level+1),this._allTilesDirty=!0,this._shortBatches&&this._updatePendingTileGeometries(),e.forEach(i=>Q9(i,i.hasPendingUpdate(st.SPLIT))),++this._performanceInfo.numSplit}_emitTileScaleChange(t,e=t.level){Tk.spatialReference=this.spatialReference,Tk.extent=t.extent,Tk.scale=this._getLodBiasCorrectedScale(e),this.emit("scale-change",Tk)}createTile(t,e,i,r){fo(!!r,"createTile sanity check");const s=this._acquireTile(t,e,i,r);return s.updateClippingStatus(this.extent),s.updateScreenDepth(this.view.state.contentCamera.viewProjectionMatrix),this._shouldSplit(s)&&s.setPendingUpdate(st.SPLIT),s}get _shortBatches(){return this.view.state.mode!==ui.IDLE}_mergeTile(t){fo(!t.hasPendingUpdate(st.SPLIT),"_mergeTile sanity check"),fo(!t.leaf,"Cannot merge a leaf"),t.leaf||(this._purgeSubtree(t),fo(!t.renderData,"Merging tile with existing render data?"),this._loadTile(t),this._markTileToUpdate(t),this._emitTileScaleChange(t),this._shortBatches&&this._updatePendingTileGeometries(),Q9(t,!1),this._allTilesDirty=!0,++this._performanceInfo.numMerged)}_loadTile(t){var e;t.load(),this.requestUpdate(),this._allTilesDirty=!0,(e=this.overlayManager)!=null&&e.hasOverlays&&this.overlayManager.updateTileOverlayParameters(t)}_handleLayerViewChanges(t=Kc){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let e=!1;const i=new Set;let r=-1;for(let s=this.view.allLayerViews.length-1;s>=0;s--){const n=this.view.allLayerViews.items[s];if(i.add(n.uid),XK(n)||IO(n))if(this._basemapLayerViewHandles.has(n.uid)&&!IO(n)){const o=this._layerClassFromLayerView(n),a=this._getLayerIdxByUID(o,n.uid);a!=null&&((a<r||r==null)&&(e=!0),r=a)}else this._registerTiledLayerView(n),n.layer.loaded&&(e=!0)}this._basemapLayerViewHandles.forEach((s,n)=>{i.has(n)||(this._unregisterTiledLayerView(n),e=!0)}),e&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),t.madeProgress()}_allSurfaceLayersTransparent(){var e,i;let t=((i=(e=this.view.map)==null?void 0:e.ground)==null?void 0:i.opacity)===0;for(const r of this.view.allLayerViews.items)if(JK(r)&&!N4(r.layer)&&r.fullOpacity!==0)return t=!1,t;return t}_hasCompositeBlendMode(){for(const t of this.view.allLayerViews.items)if((lD(t)||IO(t))&&FAt(tQ[t.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(t){return YK(t)?kt.ELEVATION:kt.MAP}_registerTiledLayerView(t){const e=[];if((lD(t)||IO(t))&&e.push(H(()=>t.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(Rs.UNFADED)})),!IO(t)){const i=this._layerClassFromLayerView(t);e.push(H(()=>t.suspended,()=>this._updateTiledLayers())),e.push(H(()=>t.fullOpacity,()=>this._updateTileTextures(Rs.UNFADED))),e.push(H(()=>"effectiveScaleRange"in t.layer?t.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),e.push(t.on("data-changed",()=>{const r=this._getLayerIdxByUID(i,t.uid);r!=null&&this._invalidateLayerData(r,i)}))}this._unregisterTiledLayerView(t.uid),this._basemapLayerViewHandles.set(t.uid,e)}_unregisterTiledLayerView(t){const e=this._basemapLayerViewHandles.get(t);if(e){for(const i of e)i.remove();this._basemapLayerViewHandles.delete(t)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const t=this.view.allLayerViews,e=[[],[]];let i=null;t.forEach(r=>{if(!r.layer||r.suspended||!XK(r)||!r.fullExtent)return;const s=this._layerClassFromLayerView(r);if(s===kt.MAP){const n=r.displayLevelRange.maxLevel;n!==1/0&&(i===null||n>i)&&(i=n)}e[s].push(r)});for(const r of d2){const s=this._layerViews[r],n=e[r];n.reverse();const o=n.length;let a=s.length!==o;const l=new Array(o),c=new Array(s.length);this._layerIndexByUid[r].clear();for(let h=0;h<o;h++){const d=n[h].uid;this._layerIndexByUid[r].set(d,h);const f=s.indexOf(n[h]);l[h]=f,h!==f&&(a=!0),f>-1&&(c[f]=h)}if(a){const h=this._postorderIterator;for(h.reset(this._rootTiles);!h.done;)h.next().modifyLayers(c,l,r);this._layerViews[r]=n,this._restartAllAgents(r),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&(this._viewChangeUpdate(),this.notifyChange("tilingScheme"))}_restartAllAgents(t){const e=this._postorderIterator;for(e.reset(this._rootTiles);!e.done;){const i=e.next();i.restartAgents(t),t===kt.ELEVATION&&i.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(t,e){return this._layerViews[e][t]}numLayers(t){return this._layerViews[t].length}_updateTileTextures(t){this._allTiles.forAll(e=>{e.updateAgents(kt.MAP),t===Rs.IMMEDIATE?this.renderer.updateTileTexture(e,st.TEXTURE_NOFADING):e.updateRenderData(kt.MAP,t)}),this._evaluateTransparency()}_invalidateLayerData(t,e){this._allTiles.forAll(i=>i.removeLayerAgent(t,e)),this._allTiles.forAll(i=>i.invalidateLayerData(t,e))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(t=$t.UPDATE){this.renderer.setNeedsRender(t)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(t,e,i,r){const s=this.layerViewByIndex(e,i),n=s.layer;return!n.tilemapCache||MA(s)?this._requestTileData(t,i,s,r):(++this._asyncWorkItems,n.tilemapCache.fetchAvailability(t.level,t.lij[1],t.lij[2],{...r,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,gt(r),es(o)||this._dataMissing(t,i,s),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(t,i,s,r),r.signal)))}_requestTileData(t,e,i,r){if(this._destroying)return Promise.resolve();const s=e===kt.ELEVATION;return r.requester??(r.requester=s?this._elevationDataRequester:this._mapDataRequester),s?YK(i)?this._requestElevationTileData(t,i,r):Promise.reject():JK(i)?this._requestMapTileData(t,i,r):Promise.reject()}_requestElevationTileData(t,e,i){++this._asyncWorkItems;const r=n=>{!Sa(i)&&n&&(this.setMemoryDirty(),this.requestUpdate(),this._elevationDataArrived(t,e,n))},s=n=>{es(n)||(J.getLogger(this).error(`Tile ${t.lij.toString()} layer ${kt.ELEVATION}/${e.uid} error ${n}`),this._dataMissing(t,kt.ELEVATION,e),this.requestUpdate())};return e.fetchTile(t.lij,i).then(n=>this._frameTask.schedule(()=>r(n)),s).finally(()=>--this._asyncWorkItems)}_elevationDataArrived(t,e,i){const r=this._layerIndexByUid[kt.ELEVATION].get(e.uid);if(r==null)return void J.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",kt.ELEVATION,t.lij.toString());const s=new UCt(t.lij,t.extent,i);t.dataArrived(r,kt.ELEVATION,s);const n=[t],o=t.level,a=this._iteratorPool.acquire();for(a.reset(n);!a.done;){const l=a.next();l.findElevationBoundsForLayer(r,o),l.computeElevationBounds()}o===0&&this._updateRootTileElevationBounds(),a.remove(),this._updateTilesVisibility(n)}_requestMapTileData(t,e,i){++this._asyncWorkItems;const r=(a,l)=>{u$(l),Sa(i)||(console.error(`Tile ${t.lij.toString()} layer ${kt.MAP}/${e.uid} error ${a}`),this._dataMissing(t,kt.MAP,e),this.requestUpdate())},s=a=>l=>r(l,a),n=a=>this._frameTask.schedule(()=>{this.requestUpdate(),Sa(i)?u$(a):this._mapTileDataArrived(t,e,a)},i.signal,s(a)).catch(s(a)),o=(a,l=null)=>this._frameTask.schedule(()=>r(a,l));return e.fetchTile(t.lij,i).then(n,o).finally(()=>--this._asyncWorkItems)}_mapTileDataArrived(t,e,i){const r=this._getLayerIdxByUID(kt.MAP,e.uid);if(r==null)return u$(i),void J.getLogger(this).warn("TerrainSurface: received data from unknown layer");t.dataArrived(r,kt.MAP,i)}_getLayerIdxByUID(t,e){return this._layerIndexByUid[t].get(e)}_dataMissing(t,e,i){const r=this._getLayerIdxByUID(e,i.uid);r!=null?t.dataMissing(r,e):J.getLogger(this).warn("TerrainSurface: received data from unknown layer")}get performanceInfo(){const t=this._performanceInfo;return t.numNodes=this._allTiles.length,t.numLeaves=t.numVisible=t.numRendered=t.numLoadedPerLevel.length=t.numRenderedPerLevel.length=0,this._allTiles.forAll(e=>{e.leaf&&t.numLeaves++;const i=e.level;e.renderData&&(t.numLoadedPerLevel[i]=(t.numLoadedPerLevel[i]||0)+1),e.visible&&(t.numVisible++,e.rendered&&(t.numRenderedPerLevel[i]=(t.numRenderedPerLevel[i]||0)+1,t.numRendered++))}),t}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory??0):0}_recalculateUsedMemory(){return this.tilingScheme?Math.round(this._allTiles.reduce((t,e)=>t+e.usedMemory,0)):null}getUsedMemoryForLayerView(t){let e=0;const i=this._layerClassFromLayerView(t),r=this._getLayerIdxByUID(i,t.uid);return r!=null&&this._allTiles.forAll(s=>e+=s.getUsedMemoryForLayer(i,r)),e}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(t){this._renderer.renderPatchBorders=t}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(t){this._renderer.visualizeNormals=t}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(t){this._renderer.renderingDisabled=t}get test(){}checkAllTilesWaterproofness(){if(!oV)return;const t=this._rootTiles;if(t==null)return;const e=n=>{var o,a,l;return((l=(a=(o=n==null?void 0:n.renderData)==null?void 0:o.geometry)==null?void 0:a.indices)==null?void 0:l.length)>0},i=(n,o)=>{e(n)&&console.error("Tile[",n.lij,"] has geometry although parent[",o.lij,"] has geom")},r=n=>{var o,a;if(n.intersectsClippingArea)if(n.renderData&&!n.renderData.geometryState&&console.error("Tile[",n.lij,"] has renderData but not geometryState"),n.renderData&&!n.renderData.geometry&&console.error("Tile[",n.lij,"] has renderData but not geometryInfo"),!((o=n.renderData)!=null&&o.geometry)||(((a=n.renderData.geometry.indices)==null?void 0:a.length)??0)>0||console.error("Tile[",n.lij,"] has renderData but no indices - geometryInfo: ",n.renderData.geometry),e(n)){n.checkGeometryWaterproofness();for(const l of n.children)i(l,n)}else if(n.leaf)console.error("Tile[",n.lij,"] has no geometry and no children, from root to leaf");else for(const l of n.children)r(l)},s=n=>{var c;const o=((c=n.parent)==null?void 0:c.visible)??!0,a=n.visible;n.computeVisibility();const l=n.visible;if(a!==l&&o&&console.error(" Tile[",n.lij,"] has out of date visibility: ",a," instead of ",l),!n.leaf)for(const h of n.children)s(h)};for(const n of t)r(n),s(n)}get isGlobal(){return this._isGlobal}get isGeographic(){return this._isGeographic}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateCarree(){return this._isWebMercatorOnPlateCarree}isEastEndWrap(t){return this._isGlobal&&t[2]===this.lijEastEnd(t[0])-1}isWestEndWrap(t){return this._isGlobal&&t[2]===0}lijEastEnd(t){return 1<<t+(this._isGeographic?1:0)}wrapEastWest(t){const e=this.lijEastEnd(t[0]),i=t[2];if(0<=i&&i<e)return t;if(!this._isGlobal)return null;const r=(i+(i<0?e:0))%e;return[t[0],t[1],r]}enableInternalChecks(t){YCt(t)}enableWaterproofnessChecks(t){ZCt(t)}};qt._tileMemcacheKey="TerrainTileMemcache",u([p()],qt.prototype,"_renderer",void 0),u([p({constructOnly:!0})],qt.prototype,"_scaleRangeQueries",void 0),u([p({constructOnly:!0})],qt.prototype,"view",void 0),u([p({constructOnly:!0})],qt.prototype,"overlayManager",void 0),u([p()],qt.prototype,"_hasPendingUpdates",void 0),u([p()],qt.prototype,"_asyncWorkItems",void 0),u([p()],qt.prototype,"_allTilesDirty",void 0),u([p()],qt.prototype,"_allTilesSorted",void 0),u([p()],qt.prototype,"_viewChanged",void 0),u([p({type:Number})],qt.prototype,"heading",void 0),u([p()],qt.prototype,"_splitLimits",void 0),u([p({readOnly:!0})],qt.prototype,"_watchUpdatingTracking",void 0),u([p()],qt.prototype,"_frameTask",void 0),u([p({readOnly:!0})],qt.prototype,"snapLevel",null),u([p({readOnly:!0})],qt.prototype,"lodSnappingEnabled",null),u([p()],qt.prototype,"_userClippingExtent",null),u([p()],qt.prototype,"_rootTilesExtent",void 0),u([p({readOnly:!0})],qt.prototype,"extent",null),u([p({readOnly:!0})],qt.prototype,"groundExtent",null),u([p({readOnly:!0})],qt.prototype,"_tilingSchemeExtent",null),u([p({readOnly:!0})],qt.prototype,"updating",null),u([p({readOnly:!0})],qt.prototype,"running",null),u([p(kCt)],qt.prototype,"updatingProgress",void 0),u([p({readOnly:!0})],qt.prototype,"updatingProgressValue",null),u([p()],qt.prototype,"_maxNumUpdating",void 0),u([p()],qt.prototype,"baseOpacity",null),u([p()],qt.prototype,"hasCompositeBlendMode",void 0),u([p({readOnly:!0})],qt.prototype,"viewingMode",null),u([p()],qt.prototype,"maxTextureScale",void 0),u([p({readOnly:!0})],qt.prototype,"ready",null),u([p({value:OA.FRONT_TO_BACK})],qt.prototype,"renderOrder",null),u([p({readOnly:!0})],qt.prototype,"rootTiles",null),u([p()],qt.prototype,"_rootTiles",void 0),u([p({readOnly:!0})],qt.prototype,"spatialReference",null),u([p({type:Je})],qt.prototype,"backgroundColor",null),u([p({value:!1})],qt.prototype,"slicePlaneEnabled",null),u([p({readOnly:!0})],qt.prototype,"tilingScheme",void 0),u([p({readOnly:!0})],qt.prototype,"tilingSchemeLocked",null),u([p({readOnly:!0})],qt.prototype,"tilingSchemeLogic",void 0),u([p()],qt.prototype,"wireframe",null),u([p({value:!1})],qt.prototype,"suspended",null),u([p()],qt.prototype,"fadeDuration",null),u([p()],qt.prototype,"visibleElevationBounds",void 0),u([p()],qt.prototype,"rootTileElevationBounds",void 0),u([p()],qt.prototype,"_layerViewsDirty",void 0),u([p()],qt.prototype,"renderPatchBorders",null),u([p()],qt.prototype,"visualizeNormals",null),u([p()],qt.prototype,"renderingDisabled",null),qt=cz=u([A("esri.views.3d.terrain.TerrainSurface")],qt);const rOt=qt,PO=$(),vE=Ls(),sOt=si();new ii;const K9=new FCt("ground"),Tk={spatialReference:null,extent:null,scale:0};function h_e(t,e,i){var r;for(const s of t){if(!s.containsPointXY(e,i))continue;let n=s;for(;n&&!n.renderData;){const a=(e>n.extentMidX?1:0)+(i<n.extentMidY?2:0);n=n.children[a]}const o=((r=n==null?void 0:n.renderData)==null?void 0:r.geometryState.samplerData)??null;return ds(e,i,o)}return null}class nOt{constructor(e){this.capacity=e,this._head=0,this._tail=0,this._data=new Array(e)}push(e){const i=this._tail;if(!(i<this.capacity))throw new Error("Queue full");this._data[i]=e,this._tail=i+1}pushAll(e){const i=e.length;if(i===0)return;const r=this._tail;if(!(r+i<=this.capacity))throw new Error("Queue full");for(let s=0;s<i;++s)this._data[r+s]=e[s];this._tail=r+i}pop(){const e=this._head;if(e<this._tail){const i=this._data[e];return this._head=e+1,i}}get empty(){return this._head>=this._tail}get full(){return this._tail>=this._data.length}}function Q9(t,e){!t.leaf||t.level<In||Rae(t,i=>{e&&z4e(i);const r=pQ(i);if(i.maxLevelDeltaNeighborCount++,r){let s=i.parent;for(;s;){const n=pQ(s);if(s.unmergableChildCount++,!n)break;s=s.parent}}})}function z4e(t){if(t.hasPendingUpdate(st.SPLIT))return;let e=t.parent;for(;e!=null&&e.resetPendingUpdate(st.MERGE);)e=e.parent;t.resetPendingUpdate(st.MERGE),t.leaf&&t.setPendingUpdate(st.SPLIT),t.level<In||Rae(t,i=>{z4e(i)})}function d_e(t){t.level<In||Rae(t,e=>{if(e.maxLevelDeltaNeighborCount--,e.maxLevelDeltaNeighborCount===0&&e.unmergableChildCount===0){let i=e.parent;for(;i&&(i.unmergableChildCount--,pQ(i));)i=i.parent}})}function pQ(t){return t.maxLevelDeltaNeighborCount===0&&t.unmergableChildCount===0}function Rae(t,e){if(t.level<In)return;const i=t.level-In,r=t.lij[1]>>In,s=t.lij[2]>>In,n=o=>o.leaf||o.level===i;for(let o=0;o<4;++o){const a=t.findNeighborTile(rf[o],n);if(!a||a.level!==i)continue;const l=a.lij;l[1]===r&&l[2]===s||e(a)}}let oOt=class{constructor(e,i,r,s){this.operation=e,this.geometry=i,this.states=r,this.sync=s}},aR=class extends he{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this._dirtyRecordCount=0}get dirty(){return this._dirtyRecordCount>0}commitLayer(e,i){const r=this._dirtyGeomRecords.get(e);if(!r)return;let s=0;r.forEach((n,o)=>{const a=this._ensureGeomRecord(e,o);s+=n.size,n.forEach(({geometry:l,operation:c,states:h},d)=>{let f=!1;if(c===gs.UPDATE){const m=a.get(d);if(m){if(h&qo.TRANSFORMATION){const g=this.model.getObject(o);this.model.updateRenderGeometryTransformation(g,l,m)&&(f=!0)}f||i.updates.push({renderGeometry:m,updateType:h})}else Zt(!1,"ModelDirtySet.commitLayer: invalid update")}if(c===gs.REMOVE||f){const m=a.get(d);m?(i.removes.push(m),a.delete(d)):c===gs.REMOVE&&Zt(!1,"ModelDirtySet.commitLayer: invalid remove")}if(c===gs.ADD||f){const m=this.model.getObject(o);if(m!=null){const g=this.model.getRenderGeometry(m,l);i.adds.push(g),a.set(d,g)}}}),a.size===0&&this._residentGeomRecords.get(e).delete(o)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this._dirtyRecordCount-=s}commitSyncUpdates(e,i){const r=this._dirtyGeomRecords.get(e);r&&r.forEach((s,n)=>{const o=this._ensureGeomRecord(e,n);s.forEach(({geometry:a,operation:l,states:c,sync:h},d)=>{let f=!1;if(l===gs.UPDATE&&h){const m=o.get(d);if(m){if(c&qo.TRANSFORMATION){const g=this.model.getObject(n);this.model.updateRenderGeometryTransformation(g,a,m)&&(f=!0)}f||i.updates.push({renderGeometry:m,updateType:c})}else Zt(!1,"ModelDirtySet.commitSyncUpdates: invalid update")}})})}getResidentRenderGeometries(e,i){const r=this._residentGeomRecords.get(e);r&&r.forEach(s=>s.forEach(n=>i.push(n)))}_objectStateChanged(e,i){for(const r of i.geometries)this._updateOrCreateDirtyRecord(i,r,null,gs.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(qo.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(qo.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(qo.OCCLUDEE,e)}attributesChanged({object:e,geometry:i,sync:r}){this._updateOrCreateDirtyRecord(e,i,null,gs.UPDATE,qo.GEOMETRY,r)}layerAdded(e){e.objects.forAll(i=>this._layerObjectAdded(e,i))}layerRemoved(e){e.objects.forAll(i=>this._layerObjectRemoved(e,i))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,i){const r=e.id;for(const s of i.geometries)this._geometryAdded(i,s,r)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const i of e.objects)this._layerObjectAdded(e.layer,i)}layerObjectsRemoved(e){for(const i of e.objects)this._layerObjectRemoved(e.layer,i)}_layerObjectRemoved(e,i){const r=e.id;for(const s of i.geometries)this._geometryRemoved(i,s,r)}transformationChanged(e){const i=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(s=>{this._updateOrCreateDirtyRecord(e,s.geometry,i,gs.UPDATE,qo.TRANSFORMATION)})}shaderTransformationChanged(e){const i=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(s=>{s.objectShaderTransformationChanged(e.shaderTransformation)})}geometryAdded(e){this._geometryAdded(e.object,e.geometry)}_geometryAdded(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,gs.ADD)}geometryRemoved(e){this._geometryRemoved(e.object,e.geometry)}_geometryRemoved(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,gs.REMOVE)}_updateOrCreateDirtyRecord(e,i,r,s,n=qo.NONE,o=!1){r=r??this._getParentLayerId(e);const a=e.id,l=i.id,c=this._ensureDirtyRecord(r,a),h=c.get(l);if(h){const d=h.operation;d===gs.REMOVE&&s===gs.ADD&&h.states!==qo.NONE?h.operation=gs.UPDATE:d===gs.REMOVE&&s===gs.ADD||d===gs.ADD&&s===gs.REMOVE?(c.delete(l),this._dirtyRecordCount--):d!==gs.UPDATE||s!==gs.REMOVE&&s!==gs.UPDATE?(Zt((d===gs.REMOVE||d===gs.ADD)&&s===gs.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),h.states|=n):(h.operation=s,h.states|=n),h.sync=h.sync||o}else c.set(l,new oOt(s,i,n,o)),this._dirtyRecordCount++}_ensureGeomRecord(e,i){let r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));let s=r.get(i);return s||(s=new Map,r.set(i,s)),s}_ensureDirtyRecord(e,i){let r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));let s=r.get(i);return s||(s=new Map,r.set(i,s)),s}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:NGe}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let i="";return this._dirtyGeomRecords.forEach((r,s)=>{r.forEach((n,o)=>{i.length>0&&(i+=`
`),i+=s+"."+o;const a=[];n.forEach(l=>{const c=l.operation;a[c]||(a[c]=[]),a[c].push(l.geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){i+=" "+e[l-1]+": ";for(let c=0;c<a[l].length;c++)i+=a[l][c]+", "}})}),i}get test(){}};u([p()],aR.prototype,"_dirtyRecordCount",void 0),u([p({constructOnly:!0})],aR.prototype,"model",void 0),aR=u([A("esri.views.3d.webgl-engine.lib.ModelDirtySet")],aR);const aOt=aR;let lOt=class{constructor(e,i={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=qe(),this._shaderTransformation=null,this._boundingSphere=null,this.id=Td(),this.layerUid=i.layerUid,this.graphicUid=i.graphicUid,this.castShadow=i.castShadow??!1,i.objectShaderTransformation&&this.objectShaderTransformationChanged(i.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){_n(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){e==null?this._shaderTransformation=null:(this._shaderTransformation??(this._shaderTransformation=qe()),Bn(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(this._boundingSphere==null&&(this._boundingSphere??(this._boundingSphere=Ls()),ot(this._boundingSphere,this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*L3(this.shaderTransformation)),this._boundingSphere):URe}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??this.transformation}get attributes(){return this.geometry.attributes}get highlight(){return this.geometry.highlights}foreachHighlightOptions(e){this.geometry.foreachHighlightOptions(e)}get hasHighlights(){return this.geometry.hasHighlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}},uz=class extends he{constructor(){super(...arguments),this.dirtySet=new aOt({model:this}),this._content=new Map,this._originFactory=new zLe(null)}getObject(e){return this._content.get(e)}add(e){const i=e.id;Zt(!this._content.has(i),"Model/Stage already contains object to be added"),this._content.set(i,e),VB(e)&&this.dirtySet.layerAdded(e)}remove(e){return!!this._content.has(e.id)&&(this._content.delete(e.id),VB(e)&&this.dirtySet.layerRemoved(e),!0)}addMany(e){for(const i of e)i&&(Zt(!this._content.has(i.id),"Model/Stage already contains object to be added"),this._content.set(i.id,i))}removeMany(e){for(const i of e)i&&(Zt(this._content.has(i.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(i.id))}has(e){return this._content.has(e.id)}forEachOfType(e,i){this._content.forEach(r=>{r.type===e&&i(r)})}getRenderGeometry(e,i){const r=new lOt(i,{castShadow:e.castShadow,objectShaderTransformation:e.shaderTransformation});r.transformation=e.getCombinedStaticTransformation(i,p_e);const{localOrigin:s}=i;return r.localOrigin=s??this._originFactory.getOrigin(r.boundingSphere),r}updateRenderGeometryTransformation(e,i,r){if(e==null)return!1;r.transformation=e.getCombinedStaticTransformation(i,p_e);const s=this._originFactory.getOrigin(r.boundingSphere);return r.localOrigin!==s}getStats(){const e={},i=Array.from(this._content.values());for(let r=0;r<zn.COUNT;++r)e[r]=i.filter(s=>s.type===r).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){}};u([p({constructOnly:!0})],uz.prototype,"dirtySet",void 0),uz=u([A("esri.views.3d.webgl-engine.parts.Model")],uz);const p_e=qe();function cOt(t){return"r"in t&&"g"in t&&"b"in t}function U4e(t){return"h"in t&&"s"in t&&"v"in t}function B4e(t){return"l"in t&&"a"in t&&"b"in t}function V4e(t){return"l"in t&&"c"in t&&"h"in t}function uOt(t){return"x"in t&&"y"in t&&"z"in t}const hOt=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],dOt=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function j4e(t,e){const i=[];let r,s;if(t[0].length!==e.length)throw new Error("dimensions do not match");const n=t.length,o=t[0].length;let a=0;for(r=0;r<n;r++){for(a=0,s=0;s<o;s++)a+=t[r][s]*e[s];i.push(a)}return i}function G4e(t){const e=[t.r/255,t.g/255,t.b/255].map(r=>r<=.04045?r/12.92:((r+.055)/1.055)**2.4),i=j4e(hOt,e);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function Pae(t){const e=j4e(dOt,[t.x/100,t.y/100,t.z/100]).map(i=>{const r=i<=.0031308?12.92*i:1.055*i**.4166666666666667-.055;return Math.min(1,Math.max(r,0))});return{r:Math.round(255*e[0]),g:Math.round(255*e[1]),b:Math.round(255*e[2])}}function H4e(t){const e=[t.x/95.047,t.y/100,t.z/108.883].map(i=>i>.008856451679035631?i**.3333333333333333:7.787037037037035*i+.13793103448275862);return{l:116*e[1]-16,a:500*(e[0]-e[1]),b:200*(e[1]-e[2])}}function q4e(t){const e=t.l,i=[(e+16)/116+t.a/500,(e+16)/116,(e+16)/116-t.b/200].map(r=>r>6/29?r**3:3*(6/29)**2*(r-4/29));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function pOt(t){const e=t.l,i=t.a,r=t.b,s=Math.sqrt(i*i+r*r);let n=Math.atan2(r,i);return n=n>0?n:n+2*Math.PI,{l:e,c:s,h:n}}function fOt(t){const e=t.l,i=t.c,r=t.h;return{l:e,a:i*Math.cos(r),b:i*Math.sin(r)}}function mOt(t){return H4e(G4e(t))}function gOt(t){return Pae(q4e(t))}function yOt(t){return pOt(H4e(G4e(t)))}function vOt(t){return Pae(q4e(fOt(t)))}function _Ot(t){const e=t.r,i=t.g,r=t.b,s=Math.max(e,i,r),n=s-Math.min(e,i,r);let o=s,a=n===0?0:s===e?(i-r)/n%6:s===i?(r-e)/n+2:(e-i)/n+4,l=n===0?0:n/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}function bOt(t){const e=(t.h+360)%360/60,i=t.s/100,r=t.v/100*255,s=r*i,n=s*(1-Math.abs(e%2-1));let o;switch(Math.floor(e)){case 0:o={r:s,g:n,b:0};break;case 1:o={r:n,g:s,b:0};break;case 2:o={r:0,g:s,b:n};break;case 3:o={r:0,g:n,b:s};break;case 4:o={r:n,g:0,b:s};break;case 5:case 6:o={r:s,g:0,b:n};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+r-s),o.g=Math.round(o.g+r-s),o.b=Math.round(o.b+r-s),o}function BL(t){return cOt(t)?t:V4e(t)?vOt(t):B4e(t)?gOt(t):uOt(t)?Pae(t):U4e(t)?bOt(t):t}function wOt(t){return U4e(t)?t:_Ot(BL(t))}function xOt(t){return B4e(t)?t:mOt(BL(t))}function Yci(t){return V4e(t)?t:yOt(BL(t))}function SOt(t){let{r:e,g:i,b:r,a:s}=t;return s<1&&(e=Math.round(s*e+255*(1-s)),i=Math.round(s*i+255*(1-s)),r=Math.round(s*r+255*(1-s))),new Je({r:e,g:i,b:r})}function TOt(t,e){const{r:i,g:r,b:s}=e!=null&&e.ignoreAlpha?t:SOt(t);return .2126*i+.7152*r+.0722*s}var fQ;function Jci(t,e=fQ.High){return TOt(t,{ignoreAlpha:!0})>e?new Je([0,0,0,t.a]):new Je([255,255,255,t.a])}function Xci(t,e){const i=xOt(t);i.l*=1-e;const r=BL(i),s=t.clone();return s.setColor(r),s.a=t.a,s}function Kci(t,e){const i=t.clone();return i.a*=e,i}function Qci(t,e){const i=wOt(t);i.s*=e;const r=BL(i),s=t.clone();return s.setColor(r),s.a=t.a,s}function Dae(t){return Je.toUnitRGBA(t)}function eui(t,e){return t===e||t!=null&&e!=null&&$S(t,e)}function tui(t){return Yi(t[0],t[1],t[2],t.length>3?t[3]:1)}function EOt(t){return t[0]??(t[0]=0),t[1]??(t[1]=0),t[2]??(t[2]=0),t}function iui(t){return t.length=4,EOt(t),t[3]??(t[3]=1),ue(t[3],0,1),t}function rui(t,e){const i=Je.toUnitRGBA(t);return i[3]*=e,i}function sui(t,e,i={}){if(t.length===0||e<=0)return[];if((t=t.map(r=>typeof r=="string"?new Je(r):r)).length===1||e===1){const r=[],s=t[0];for(let n=0;n<e;n++)r.push(s.clone());return r}if(i.shuffle&&(t=iSe(q(t),i.seed)),t.length>=e){const r=[],s=(t.length-1)/(e-1);for(let n=0;n<e;n++){const o=Math.round(n*s);r.push(t[o].clone())}return r}return COt(t,e,i)}function COt(t,e,i={}){const r=[],s=t.length-1,n=Math.ceil((e-t.length)/s);e:for(let o=0;o<s;o++){const a=t[o],l=t[o+1];for(let c=1;c<=n;c++){const h=c/(n+1);if(r.push($Ot(a,l,h,i)),r.length+t.length===e)break e}}return[...t.map(o=>o.clone()),...iSe(r,i.seed??1)]}(function(t){t[t.Low=160]="Low",t[t.High=225]="High"})(fQ||(fQ={}));const e7=(t,e)=>{const i=Math.floor(10*e())-5;return Math.min(255,Math.max(0,t+i))};function $Ot(t,e,i,r={}){const s=t.r,n=t.g,o=t.b,a=e.r,l=e.g,c=e.b,h=Math.round(s+(a-s)*i),d=Math.round(n+(l-n)*i),f=Math.round(o+(c-o)*i);if(!r.offset)return new Je([h,d,f]);const m=Zte(r.seed);return new Je([e7(h,m),e7(d,m),e7(f,m)])}let W4e=class extends cr{constructor(){super(...arguments),this.radii=Ye(),this.heightParameters=yi()}};function AOt(t){t.uniforms.add(new yc("radii",e=>e.radii),new pc("heightParameters",e=>e.heightParameters)),t.constants.add("scaleHeight","float",Ci.scaleHeight*Ci.atmosphereHeight),t.code.add(E`float chapmanApproximation(float thickness, float height, float cosZenith) {
float c = sqrt(thickness + height);
float cExpH = c * exp(-height);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (thickness + height);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(thickness - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),t.code.add(E`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),t.code.add(E`vec4 planetIntersect(vec3 cameraPos, vec3 rayDir) {
float reducedPlanetRadius = radii[0] - 20000.0;
float rayPlanetDistance = heightParameters[1] - reducedPlanetRadius * reducedPlanetRadius;
vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, rayPlanetDistance);
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, heightParameters[2]);
bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
bool insideAtmosphere = heightParameters[0] < radii[1];
if (!(hitsAtmosphere || insideAtmosphere)) {
return vec4(1.0, 0.0, 0.0, 0.0);
}
bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;
float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;
if (heightParameters[0] < reducedPlanetRadius) {
if (dot(rayDir, normalize(cameraPos)) < -0.025) {
return vec4(1.0, 0.0, 0.0, 0.0);
}
start = rayPlanetIntersect.y;
}
float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
return vec4(0.0, hitsPlanet ? 1.0 : 0.0, start, end);
}`)}function Z4e(t,e){t.include(AOt);const i=6;t.uniforms.add(new Ka("cameraPosition",r=>r.camera.eye)),t.constants.add("betaRayleigh","vec3",G5),t.constants.add("betaCombined","vec3",Hwt),t.constants.add("betaMie","float",Gwt),t.code.add(E`
    vec3 raymarchAtmosphere(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      vec4 ray = planetIntersect(cameraPos, rayDir);
      if(ray.x == 1.0) {
        return vec3(0);
      }
      ${Te(e,"if (terrainDepth != -1.0) { ray.w = terrainDepth; }")}

      vec3 samplePoint = cameraPos + rayDir * ray.w;
      float multiplier = ray.y == 1.0 ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (ray.w - ray.z) / ${E.float(i)};

      for (int i = 0; i < ${E.int(i)}; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
          ${Te(!e,"scattering *= mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0))")};
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {
          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);
          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${Te(!e,"scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);")}
        }
        lastOpticalDepth = opticalDepth;
      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;
      ${e?"return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;":E`const float g = 0.8;
             const float gg = g * g;
             float phaseMie = 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg));
             phaseMie = clamp(phaseMie, 0.0, 128.0);
             return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }`)}function Z6(t,e={needUVs:!0,needEyeDirection:!0}){t.attributes.add(z.POSITION,"vec2"),t.varyings.add("worldRay","vec3");const{needUVs:i,needEyeDirection:r}=e;i&&t.varyings.add("uv","vec2"),r&&t.varyings.add("eyeDir","vec3"),t.vertex.uniforms.add(new $o("inverseProjectionMatrix",s=>s.camera.inverseProjectionMatrix),new $o("inverseViewMatrix",s=>wre(MOt,s.camera.viewMatrix))),t.vertex.main.add(E`
    vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
    ${Te(r,"eyeDir = posViewNear;")}
    worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
    ${Te(i,"uv = position * 0.5 + vec2(0.5);")}
    gl_Position = vec4(position, 1, 1);
  `)}const MOt=qe();function Y4e(t){const e=new Vi;e.include(Z6);const{reduced:i}=t,{fragment:r}=e;return cg(r),e.include(ML),r.include(R6),r.include(A6),r.include(Z4e,!1),r.uniforms.add(new $r("backgroundColor",s=>s.backgroundColor),new mt("innerFadeDistance",s=>s.innerFadeDistance),new mt("altitudeFade",s=>s.altitudeFade),new oo("depthTexture",s=>s.mainDepth)).code.add(E`vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
float rayPlanetDistance = heightParameters[1] - radii[0] * radii[0];
vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, rayPlanetDistance);
if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
return fragColor;
}
float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
if (relDist > 1.0) {
return surfaceColor;
}
return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
}
float getGlow(float dist, float radius, float intensity) {
return pow(radius / max(dist, 1e-6), intensity);
}
vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){
float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));
vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));
float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));
return normalize(sunTransmittance) * sunDisc;
}`).main.add(E`
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${Te(!i,E`float depthSample = texture(depthTexture, uv).r;
             if (depthSample != 1.0) {
                fragColor = vec4(0);
                return;
             }`)}

      vec3 col = linearizeGamma(backgroundColor);
      col += raymarchAtmosphere(cameraPosition, rayDir, mainLightDirection, terrainDepth);
      col += getSun(cameraPosition, rayDir, mainLightDirection);
      float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);
  `),e}const OOt=Object.freeze(Object.defineProperty({__proto__:null,build:Y4e},Symbol.toStringTag,{value:"Module"}));let IOt=class extends W4e{constructor(){super(...arguments),this.innerFadeDistance=0,this.altitudeFade=0,this.backgroundColor=$()}},t7=class extends Hi{constructor(e,i){super(e,i,new Bi(OOt,()=>G(()=>Promise.resolve().then(()=>uHt),void 0)))}initializePipeline(e){return wi({blending:e.reduced?Lne:hT(Bt.SRC_ALPHA,Bt.ONE_MINUS_SRC_ALPHA),depthTest:{func:e.reduced?Ui.ALWAYS:Ui.LEQUAL},colorWrite:Di})}},J4e=class extends hu{constructor(){super(...arguments),this.reduced=!1}};u([ie()],J4e.prototype,"reduced",void 0);let zm=class extends Af{constructor(){super(...arguments),this.produces="disabled",this.consumes={required:[dt.OPAQUE_ENVIRONMENT]}}_enable(){this.produces=dt.OPAQUE_ENVIRONMENT,this.requestRender($t.UPDATE)}_disable(){this.produces="disabled",this.requestRender($t.UPDATE)}};u([p()],zm.prototype,"produces",void 0),u([p()],zm.prototype,"consumes",void 0),zm=u([A("esri.views.3d.webgl-engine.effects.OpaqueEnvironment")],zm);let Lae=class extends cr{};function X4e(){const t=new Vi;return t.include(ia),t.fragment.uniforms.add(new It("colorTexture",e=>e.color),new oo("depthTexture",e=>e.mainDepth)),t.fragment.main.add(E`float depthSample = texture(depthTexture, uv).r;
if (depthSample != 1.0 ) {
fragColor = vec4(0);
return;
}
fragColor = texture(colorTexture, uv);`),t}const ROt=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:Lae,build:X4e},Symbol.toStringTag,{value:"Module"}));let f_e=class extends Hi{constructor(e,i){super(e,i,new Bi(ROt,()=>G(()=>Promise.resolve().then(()=>hHt),void 0)))}initializePipeline(){return wi({blending:hT(Bt.SRC_ALPHA,Bt.ONE_MINUS_SRC_ALPHA),depthTest:{func:Ui.ALWAYS},colorWrite:Di})}},mQ=class extends zm{constructor(){super(...arguments),this.requireGeometryDepth=!0,this._compositingPassParameters=new Lae,this._vao=null,this._passParameters=new IOt,this._configuration=new J4e}initialize(){this.techniques.precompile(t7,this._configuration),this.techniques.precompile(f_e),this._configuration.reduced=!0,this.techniques.precompile(t7,this._configuration),this._configuration.reduced=!1,this.addHandles([H(()=>this.view.environment.background,e=>{const i=e instanceof iFe?Dae(e.color):an;se(this._passParameters.backgroundColor,i[0]*i[3],i[1]*i[3],i[2]*i[3])},Mt),H(()=>{var e,i;return(i=(e=this.view._stage)==null?void 0:e.renderer)==null?void 0:i.fullResolutionAtmosphere},e=>this._configuration.reduced=!e,Mt),H(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),Mt)])}destroy(){this._vao=Dt(this._vao)}render(e){const i=e.find(({name:v})=>v===dt.OPAQUE_ENVIRONMENT);if(!this.bindParameters.mainDepth)return i;const r=this.renderingContext;this._vao??(this._vao=mw(r,hg.Pos2Tex));const s=i.getAttachment(r.gl.DEPTH_STENCIL_ATTACHMENT);this._update();const n=this.techniques.get(t7,this._configuration);if(!n.compiled)return this.requestRender($t.UPDATE),i;if(!this._configuration.reduced)return i.detachDepth(),r.bindFramebuffer(i.fbo),r.bindTechnique(n,this.bindParameters,this._passParameters),r.bindVAO(this._vao),r.drawArrays(Gi.TRIANGLE_STRIP,0,4),i.attachDepth(s),i;const o=this.techniques.get(f_e);if(!o.compiled)return this.requestRender($t.UPDATE),i;const a=r.getViewport(),l=this.bindParameters.camera,c=Ee(l.eye)-Ci.radius;let h;const d=Ci.atmosphereHeight;if(c<d){const v=Math.min(1,Math.max(0,c/d));h=ft(.2,.3,v)}else{const v=Math.min(1,Math.max(0,(c-d)/(15*d)));h=ft(.3,.6,v)}const f=cv(Math.round(h*l.fullViewport[2])),m=cv(Math.round(h*l.fullViewport[3]));r.setViewport(0,0,f,m);const g=this.fboCache.acquire(f,m,"chapman",gr.RGBA);return r.bindFramebuffer(g.fbo),r.clearFramebuffer([0,0,0,1],!0,!0),r.bindTechnique(n,this.bindParameters,this._passParameters),r.bindVAO(this._vao),r.drawArrays(Gi.TRIANGLE_STRIP,0,4),r.setViewport(a.x,a.y,a.width,a.height),this._compositingPassParameters.color=g.getTexture(),i.detachDepth(),r.bindFramebuffer(i.fbo),r.bindTechnique(o,this.bindParameters,this._compositingPassParameters),r.screen.draw(),i.attachDepth(s),g.release(),i}_update(){var a;const e=this.bindParameters.camera,i=Xo(e.eye),r=Math.sqrt(i),s=i-this._passParameters.radii[1]**2,n=ue((r-this._passParameters.radii[0])/Ci.atmosphereHeight,0,1);ss(this._passParameters.heightParameters,r,i,s,n);const o=((a=this.view.basemapTerrain)==null?void 0:a.getLowerBoundRadius())??0;di(this._passParameters.radii,o,o+Ci.atmosphereHeight),this._passParameters.innerFadeDistance=2*Math.sqrt((2*o-oye)*oye),this._passParameters.altitudeFade=Yoe(r-o)}};mQ=u([A("esri.views.3d.environment.ChapmanAtmosphere")],mQ);function K4e(){const t=new Vi,{fragment:e}=t;return t.include(Z6,{needUVs:!1,needEyeDirection:!1}),e.include(yM),e.include(uw),t.include(IDe,{pbrMode:Ct.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(CL),t.include(ML),t.include(QDe),e.uniforms.add(new Ka("cameraPosition",i=>i.camera.eye),new Un("cloudsOpacity",i=>i.clouds.opacity)).main.add(E`vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4(cloudsOpacity * cloudsColor.rgb, cloudsColor.a);`),t}const POt=Object.freeze(Object.defineProperty({__proto__:null,build:K4e},Symbol.toStringTag,{value:"Module"}));let m_e=class extends Hi{constructor(e,i){super(e,i,new Bi(POt,()=>G(()=>Promise.resolve().then(()=>dHt),void 0)))}initializePipeline(){return wi({blending:hw(Bt.ONE,Bt.ZERO,Bt.SRC_ALPHA,Bt.ONE),depthTest:{func:Ui.LEQUAL},colorWrite:Di})}},gQ=class extends zm{constructor(e){super(e),this._planetRadius=yr(e.view.spatialReference).radius}initialize(){this.techniques.precompile(m_e),this.addHandles([H(()=>this.view.environment.weather!=null&&this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),Ut)])}destroy(){this._vao=Dt(this._vao)}render(e){const i=e.find(({name:a})=>a===dt.OPAQUE_ENVIRONMENT),r=this.bindParameters.clouds;if(!r.data)return i;const s=this.techniques.get(m_e);if(!s.compiled)return this.requestRender($t.UPDATE),i;const n=this.renderingContext;this._vao??(this._vao=mw(n));const o=n.bindTechnique(s,this.bindParameters);return n.bindVAO(this._vao),o.assertCompatibleVertexAttributeLocations(this._vao),n.drawArrays(Gi.TRIANGLE_STRIP,0,4),r.isFading&&this.requestRender($t.UPDATE),i}};gQ=u([A("esri.views.3d.environment.CloudsComposition")],gQ);let Nae=class extends cr{constructor(){super(...arguments),this.color=$(),this.strength=4e-6,this.atmosphereC=1,this.amount=0}};function Q4e(){const t=new Vi;t.include(Z6,{needUVs:!0,needEyeDirection:!0});const e=t.fragment;return e.uniforms.add(new mt("atmosphereC",i=>i.atmosphereC),new Ka("cameraPosition",i=>i.camera.eye),new oo("depthTexture",i=>i.mainDepth),new mt("fogStrength",i=>i.strength),new mt("fogAmount",i=>i.amount),new $r("fogColor",i=>i.color)),t.include(ML),e.include(R6),e.include(A6),e.include(Sg),e.code.add(E`float getFogAmount(float dist, vec3 rayDir) {
if(dist == -1.0){
dist = 0.055 * sphereIntersect(cameraPosition, rayDir, atmosphereC).y;
}
return fogAmount * (1.0 - exp(-dist * fogStrength));
}`),e.main.add(E`vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = depthFromTexture(depthTexture, uv);
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linearizeDepth(depthSample);;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
float fogAmount = getFogAmount(terrainDepth, rayDir);
vec4 fog = vec4(fogColor, 1.0) * fogAmount;
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));`),t}const DOt=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:Nae,build:Q4e},Symbol.toStringTag,{value:"Module"}));let g_e=class extends Hi{constructor(e,i){super(e,i,new Bi(DOt,()=>G(()=>Promise.resolve().then(()=>pHt),void 0)))}initializePipeline(){return wi({blending:hw(Bt.SRC_ALPHA,Bt.ZERO,Bt.ONE_MINUS_SRC_ALPHA,Bt.ONE),colorWrite:Di})}},IP=class extends zm{constructor(){super(...arguments),this.consumes={required:[dt.TRANSPARENT_ENVIRONMENT]}}_enable(){this.produces=dt.TRANSPARENT_ENVIRONMENT,this.requestRender($t.UPDATE)}};u([p()],IP.prototype,"consumes",void 0),IP=u([A("esri.views.3d.webgl-engine.effects.TransparentEnvironment")],IP);const LOt=.95,NOt=1;let yQ=class extends IP{constructor(e){super(e),this.requireGeometryDepth=!0,this._newParameters=new i7,this._oldParameters=new i7,this._fadedParameters=new i7,this._parameters=this._newParameters,this._passParameters=new Nae;const i=yr(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+i.atmosphereHeight,e.view._stage.renderView.techniques.precompile(g_e)}toogle(){this.view.environment.atmosphereEnabled&&this.view.environment.weather?this._enable():this._disable()}initialize(){this.addHandles([H(()=>this.view.environment.atmosphereEnabled,()=>this.toogle(),Mt),H(()=>this.view.environment.weather,()=>this.toogle(),Mt),H(()=>this._updateFogParameters(),()=>{},Mt)]),this.addHandles(H(()=>this._fadeFactor,e=>this._fade(e),Mt))}get _fadeFactor(){var e;return((e=this.view._stage)==null?void 0:e.renderer.renderContext.bind.clouds.fadeFactor)??1}_fade(e){const{_newParameters:i,_oldParameters:r}=this;e>=1?(this._parameters=i,this._oldParameters.copyFrom(this._newParameters)):e<=0?this._parameters=r:(this._fadedParameters.lerp(r,i,e),this._parameters=this._fadedParameters)}_updateFogParameters(){const e=this.view.environment.weather,i=e.type==="foggy"||e.type==="snowy"||e.type==="rainy";this._newParameters.strength=e.type==="foggy"?ft(3e-5,.005,e.fogStrength**3):e.type==="snowy"||e.type==="rainy"?ft(4e-6,2e-4,(e.precipitation??0)**3):0,this._newParameters.amount=i?1:0,e.type!=="foggy"&&e.type!=="snowy"||ne(this._newParameters.color,kOt),e.type==="rainy"&&ne(this._newParameters.color,FOt),this._fadeFactor>=1&&this._oldParameters.copyFrom(this._newParameters),this.requestRender($t.UPDATE)}render(e){const i=e.find(({name:o})=>o===dt.TRANSPARENT_ENVIRONMENT);if(this._parameters.amount===0||(this._update(),this._passParameters.amount<=0))return i;const r=this.techniques.get(g_e);if(!r.compiled)return this.requestRender($t.UPDATE),i;const s=this.renderingContext,n=i.getAttachment(s.gl.DEPTH_STENCIL_ATTACHMENT);return i.attachDepth(null),s.bindFramebuffer(i.fbo),s.bindTechnique(r,this.bindParameters,this._passParameters),s.screen.draw(),i.attachDepth(n),i}_update(){const e=this.bindParameters.camera;ae(y_e,e.eye);const i=Math.max(0,fe(y_e,this.bindParameters.lighting.mainLight.direction)),r=this._parameters.color;re(v_e,r,.1),fr(this._passParameters.color,v_e,r,i);const s=Ee(e.eye);this._passParameters.atmosphereC=s**2-this._atmosphereRadius**2,this._passParameters.amount=(1-h3(LOt*r$,NOt*r$,Math.abs(s-this._planetRadius)))*this._parameters.amount,this._passParameters.strength=this._parameters.strength}};yQ=u([A("esri.views.3d.environment.Fog")],yQ);let i7=class{constructor(){this.color=$(),this.strength=0,this.amount=0}copyFrom(e){this.amount=e.amount,this.strength=e.strength,ne(this.color,e.color)}lerp(e,i,r){this.amount=ft(e.amount,i.amount,r),this.strength=ft(e.strength,i.strength,r),fr(this.color,e.color,i.color,r)}};const y_e=$(),v_e=$(),FOt=De(.5,.5,.5),kOt=De(1.5,1.5,1.5);var hf;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(hf||(hf={}));let Fae=class extends Zm{constructor(){super(...arguments),this.geometry=hf.Cone}};u([ie({count:hf.COUNT})],Fae.prototype,"geometry",void 0);let Y6=class extends cr{constructor(){super(...arguments),this.texV=Ye(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new kae}},kae=class{constructor(){this.center=$(),this.v1=$(),this.v2=$()}};function e5e(t){const e=new Vi,{vertex:i,fragment:r}=e;if(cg(i),t.geometry===hf.Underground)e.attributes.add(z.POSITION,"vec2"),e.varyings.add("color","vec4"),i.uniforms.add(new Ka("cameraPosition",s=>s.camera.eye),new mt("undergroundFadeAlpha",s=>s.undergroundFadeAlpha)),i.main.add(E`float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);`),r.main.add(E`fragColor = color;`);else{e.include(ub,t),e.attributes.add(z.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const s=t.geometry===hf.Cylinder;i.uniforms.add(new $o("proj",a=>a.camera.projectionMatrix),new $o("view",a=>a.camera.viewMatrix)),s||(e.varyings.add("innerFactor","float"),i.uniforms.add(new $r("silCircleCenter",a=>a.silhouette.center)),i.uniforms.add(new $r("silCircleV1",a=>a.silhouette.v1)),i.uniforms.add(new $r("silCircleV2",a=>a.silhouette.v2)),i.uniforms.add(new yc("texV",a=>a.texV)),i.uniforms.add(new mt("innerScale",a=>a.innerScale)));const n=6.2831853,o=1/128;i.main.add(E`
      ${s?E`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:E`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${E.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${E.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
	  `),r.uniforms.add(new It("tex",a=>a.texture)),s||r.uniforms.add(new mt("altitudeFade",a=>a.altitudeFade)),r.main.add(E`
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${s?E`fragColor = atmosphereColor;`:E`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));`}`)}return e}const zOt=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:kae,SimpleAtmospherePassParameters:Y6,build:e5e},Symbol.toStringTag,{value:"Module"}));let AC=class extends Hi{constructor(e,i){super(e,i,new Bi(zOt,()=>G(()=>Promise.resolve().then(()=>fHt),void 0)))}initializePipeline(e){const i=e.geometry===hf.Cylinder;return wi({blending:Ld,culling:i?Nne:void 0,depthTest:{func:Ui.LEQUAL},colorWrite:Di})}};const UOt=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);let vQ=class extends zm{constructor(){super(...arguments),this._configuration=new Fae,this._passParameters=new Y6,this._vao=null,this._vaoCount=0}initialize(){this._configuration.geometry=hf.Cylinder,this.addHandles([H(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),Ut)])}destroy(){this._passParameters.texture=Dt(this._passParameters.texture),this._vao=Dt(this._vao)}precompile(){this.techniques.precompile(AC,this._configuration)}render(e){const i=e.find(({name:o})=>o===dt.OPAQUE_ENVIRONMENT),r=this.techniques.get(AC,this._configuration);if(!r.compiled)return this.requestRender($t.UPDATE),i;const s=this.renderingContext;if(this._vao||(this._vao=BOt(s),this._vaoCount=uA(this._vao,"geometry")),!this._passParameters.texture){const o=new Ar;o.wrapMode=ar.CLAMP_TO_EDGE,o.flipped=!0,o.width=1,o.height=512,this._passParameters.texture=new pi(s,o,UOt)}const n=s.bindTechnique(r,this.bindParameters,this._passParameters);return VOt(__e,this.bindParameters.camera.viewMatrix),n.setUniformMatrix4fv("view",__e),s.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),s.drawArrays(Gi.TRIANGLES,0,this._vaoCount),i}};function BOt(t){const e=BPe(1,2,!1),{data:i,indices:r}=e[0][1],s=b_e.createBuffer(r.length),n=s.position;for(let o=0;o<r.length;++o){const a=3*r[o%3==0?o+2:o%3==2?o-2:o];n.set(o,0,i[a]),n.set(o,1,i[a+1]),n.set(o,2,i[a+2])}return new Tg(t,bg,new Map([["geometry",Jv(b_e)]]),new Map([["geometry",jn.createVertex(t,Js.STATIC_DRAW,s.buffer)]]))}function VOt(t,e){_n(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}vQ=u([A("esri.views.3d.environment.LocalAtmosphere")],vQ);const __e=qe(),b_e=Bd().vec3f(z.POSITION),jOt=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),Ek=128,w_e=-1e4,x_e=0,r7=50,GOt=()=>1-511/512,HOt=_5([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let _Q=class extends zm{constructor(e){super(e),this._passParameters=new Y6,this._configuration=new Fae,this._vao=null,this._vaoCount=0,this._fadeVao=null,this._fadeVaoCount=0,this._texV1=1;const i=e.view,r=yr(i.spatialReference),{outerAtmosphereRimWidth:s,radius:n}=r;this._planetRadius=n,this._innerRimFactor=1+w_e/n,this._middleRimFactor=1+x_e/n,this._outerRimFactor=1+s/n,this._texV0=x_e/s,this._texVScale=this._texV1-this._texV0;const o=i._stage.renderView.techniques;o.precompile(AC,this._configuration),this._configuration.geometry=hf.Underground,o.precompile(AC,this._configuration)}initialize(){this.addHandles(H(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),Ut))}destroy(){this._passParameters.texture=Dt(this._passParameters.texture),this._fadeVao=Dt(this._fadeVao),this._vao=Dt(this._vao)}render(e){const i=e.find(({name:s})=>s===dt.OPAQUE_ENVIRONMENT);this._update();const r=this.renderingContext;if(!this._passParameters.texture){const s=new Ar;s.wrapMode=ar.CLAMP_TO_EDGE,s.flipped=!0,s.width=1,s.height=512,this._passParameters.texture=new pi(r,s,jOt)}if(this._passParameters.undergroundFadeAlpha<1){this._vao||(this._vao=this._createRibbon(r),this._vaoCount=uA(this._vao,"geometry")),this._configuration.geometry=hf.Cone;const s=this.techniques.get(AC,this._configuration);if(!s.compiled)return this.requestRender($t.UPDATE),i;r.bindTechnique(s,this.bindParameters,this._passParameters),r.bindVAO(this._vao),r.drawArrays(Gi.TRIANGLES,0,this._vaoCount)}if(this._passParameters.undergroundFadeAlpha>0){this._fadeVao||(this._fadeVao=mw(r),this._fadeVaoCount=uA(this._fadeVao,"geometry")),this._configuration.geometry=hf.Underground;const s=this.techniques.get(AC,this._configuration);if(!s.compiled)return this.requestRender($t.UPDATE),i;r.bindTechnique(s,this.bindParameters,this._passParameters),r.bindVAO(this._fadeVao),r.drawArrays(Gi.TRIANGLE_STRIP,0,this._fadeVaoCount)}return i}_update(){const e=this.bindParameters.camera,i=$(),r=this._planetRadius,s=Ee(e.eye),n=s-r;if(n<0){const m=Math.min(-n/5e3,1);this._passParameters.undergroundFadeAlpha=m}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(r7,n),a=r+w_e;this._passParameters.innerScale=qOt(r+o,r,a)-1,this._passParameters.altitudeFade=Yoe(n),re(i,e.eye,(r+r7)/s),S_e(i,e.center,e.up,r,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,i,e.up,this._passParameters.silhouette),c=GOt(),h=HOt(n);let d=this._texV0+c*this._texVScale,f=this._texV0+l*h*this._texVScale;if(n>r7){S_e(e.eye,e.center,e.up,r,this._passParameters.silhouette);const m=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),g=ue((m-1.5)/(l-1.5),0,1);d=this._texV0+g*c*this._texVScale,f=this._texV0+ft(this._texV1,l*h,g)*this._texVScale}di(this._passParameters.texV,d,f)}_createRibbon(e){const i=oh(3+3*Ek*3),r=new Uint32Array(3*Ek*5);i[0]=0,i[1]=0,i[2]=-1;for(let o=0;o<Ek;o++){const a=9*o+3;i[a]=o,i[a+1]=this._innerRimFactor,i[a+2]=-1,i[a+3]=o,i[a+4]=this._middleRimFactor,i[a+5]=0,i[a+6]=o,i[a+7]=this._outerRimFactor,i[a+8]=1;const l=3*o+1,c=o===Ek-1?1:l+3,h=15*o;r[h]=l,r[h+1]=l+1,r[h+2]=c+1,r[h+3]=c+1,r[h+4]=c,r[h+5]=l,r[h+6]=l+1,r[h+7]=l+2,r[h+8]=c+2,r[h+9]=c+2,r[h+10]=c+1,r[h+11]=l+1,r[h+12]=l,r[h+13]=c,r[h+14]=0}const s=T_e.createBuffer(r.length),n=s.position;for(let o=0;o<r.length;++o){const a=3*r[o];n.set(o,0,i[a]),n.set(o,1,i[a+1]),n.set(o,2,i[a+2])}return new Tg(e,bg,new Map([["geometry",Jv(T_e)]]),new Map([["geometry",jn.createVertex(e,Js.STATIC_DRAW,s.buffer)]]))}_computeScreenRimWidth(e,i,r,s){return oe(_E,s.center,s.v2),re(Ck,_E,this._outerRimFactor),hG(s7,i,_E,r),afe(_E,s7,e.projectionMatrix,e.viewport,_E),afe(Ck,s7,e.projectionMatrix,e.viewport,Ck),Sr(_E,Ck)/e.height}};function S_e(t,e,i,r,s){const n=Ee(t),o=r*Math.sqrt(n*n-r*r)/n,a=Math.sqrt(r*r-o*o),l=s.v1,c=s.v2;return re(s.center,t,a/n),ct(l,t,e),Xo(l)<1&&ct(l,t,i),re(l,l,o/Ee(l)),ct(c,l,t),re(c,c,o/Ee(c)),o}_Q=u([A("esri.views.3d.environment.MarsAtmosphere")],_Q);const s7=qe(),_E=$(),Ck=$();function qOt(t,e,i){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-i*i)+e*i)}const T_e=Bd().vec3f(z.POSITION),WOt=_Q;function ZOt(t,e){zae(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function zae(t,e,i=3,r=i){const s=e.length/r;let n=0,o=0;for(let a=0;a<s;++a)t[n]=e[o],t[n+1]=e[o+1],t[n+2]=e[o+2],n+=i,o+=r}function YOt(t,e,i,r,s){const n=t.typedBuffer,o=t.typedBufferStride,a=(s==null?void 0:s.count)??t.count;let l=((s==null?void 0:s.dstIndex)??0)*o;for(let c=0;c<a;++c)n[l]=e,n[l+1]=i,n[l+2]=r,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:zae,copyView:ZOt,fill:YOt},Symbol.toStringTag,{value:"Module"}));let JOt=class{constructor(e){this._totalCount=e,this._componentCountCache=-1,this._indexRanges=[0,e]}allVisible(){return this.componentCount===this._totalCount}allInvisible(){return this._indexRanges.length===0}isVisible(e){if(e<0||e>=this._totalCount)return!1;if(this.allVisible())return!0;{const i=this._indexRanges;let r=0,s=i.length/2;if(e<i[2*r]||e>i[2*s]+i[2*s+1])return!1;for(;s-r>0;){const n=Math.floor(.5*(r+s)),o=i[2*n];if(e<o){if(s-r==1)return!1;s=n;continue}if(e<o+i[2*n+1])return!0;if(s-r==1)return!1;r=n+1}return!1}}get componentCount(){if(this._componentCountCache===-1){const e=this._indexRanges;let i=0;for(let r=0;r<e.length;r+=2)i+=e[r+1];this._componentCountCache=i}return this._componentCountCache}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=XOt(e),this._componentCountCache=-1}forEachComponent(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r],n=s+i[r+1];for(let o=s;o<n;o++)if(!e(o))return!1}return!0}forEachComponentRange(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r];if(!e(s,s+i[r+1]))return!1}return!0}computeOffsetRanges(e){const i=new Array(this._indexRanges.length),r=this._indexRanges;for(let s=0;s<r.length;s+=2){const n=r[s],o=n+r[s+1],a=e[n],l=e[o];i[s]=a,i[s+1]=l-a}return i}};function XOt(t){const e=new Array;if(t.length===0)return e;let i=t[0],r=1;for(let s=1;s<t.length;s++){const n=t[s];i+r===n?r+=1:(e.push(i),e.push(r),i=n,r=1)}return e.push(i),e.push(r),e}let KOt=class{constructor(e,i){this.offsets=i,this._highlightsInOrder=[],this.pickability=null,this.componentHighlights=new Map,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRangesMap=null,this.cachedShadowmapRanges=null;const r=this.count;this.visibility=new JOt(r),this.materialDataBuffer=e.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let s=0;s<r;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return this.cachedGeometryRanges==null&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRangesMap(){return this.componentHighlights.size===0?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRangesMap)}get shadowmapRanges(){return this.componentHighlights.size===0?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedShadowmapRanges)}markHighlightsDirty(){this.cachedHighlightRangesMap=null,this.cachedShadowmapRanges=null}markVisibilityDirty(){this.cachedGeometryRanges=null,this.markHighlightsDirty()}updateHighlights(e){this._updateHighlightOrder(e)&&(this.markHighlightsDirty(),this._updateCachedHighlightRanges())}_updateHighlightOrder(e){const{_highlightsInOrder:i}=this;let r=i.length!==e.length;i.length=Math.min(e.length,8);for(let s=0;s<e.length;++s){const n=e.at(s).name;i.length<s?(r=!0,i.push(n)):i[s]!==n&&(i[s]=n,r=!0)}return r}_updateCachedHighlightRanges(){if(this.cachedHighlightRangesMap==null||this.cachedShadowmapRanges==null){const{highlightRangesMap:e,shadowmapRangesMap:i}=QOt(this.componentHighlights,this.visibility,this.offsets,this._highlightsInOrder);this.cachedHighlightRangesMap=e,this.cachedShadowmapRanges=i}}};function QOt(t,e,i,r){const s=new Map,n=[];if(t.size>0){let o=i.length;e.forEachComponent(a=>{let l=!1;for(let c=r.length-1;c>=0;--c){const h=r[c],d=t.get(h);if(((d==null?void 0:d[a])??0)>0){const f=tw(s,h,()=>[]),m=i[a],g=i[a+1];f.push(m),f.push(g-m),l||(l=h===jm);break}}return l||(o!==a-1&&(n.length>0&&n.push(i[o+1]-n[n.length-1]),n.push(i[a])),o=a),!0}),n.length>0&&n.push(i[o+1]-n[n.length-1])}return{highlightRangesMap:s,shadowmapRangesMap:n}}let eIt=class{constructor(e,i,r,s,n,o){this.transform=e,this.toMapSpace=i,this.obb=r,this.componentData=s,this.renderable=n,this.intersectionGeometry=o,this.visible=!1,this.offsetObb=null}destroy(){this.intersectionGeometry=$e(this.intersectionGeometry),this.renderable=$e(this.renderable),this.componentData=$e(this.componentData)}};function tIt(t,e,i,r,s,n,o){const a=n-o,l=e-t,c=new Float64Array(4*l);for(let h=0;h<l;++h){const d=3*(h+t),f=s*i[d+0],m=r[f+0],g=r[f+1],v=a/(r[f+2]-o),_=m*v,b=g*v,w=s*i[d+1],x=r[w+0],S=r[w+1],C=a/(r[w+2]-o),T=x*C,M=S*C,I=s*i[d+2],D=r[I+0],P=r[I+1],F=a/(r[I+2]-o),L=D*F,N=P*F,R=4*h;c[R+0]=Math.min(_,T,L),c[R+1]=Math.min(b,M,N),c[R+2]=Math.max(_,T,L),c[R+3]=Math.max(b,M,N)}return c}function iIt(t,e,i,r,s){const n=e-t,o=new Float64Array(4*n);for(let a=0;a<n;++a){const l=3*(a+t),c=s*i[l+0],h=r[c+0],d=r[c+1],f=s*i[l+1],m=r[f+0],g=r[f+1],v=s*i[l+2],_=r[v+0],b=r[v+1],w=4*a;o[w+0]=Math.min(h,m,_),o[w+1]=Math.min(d,g,b),o[w+2]=Math.max(h,m,_),o[w+3]=Math.max(d,g,b)}return o}function rIt(t,e){return new(sIt(t))(e)}function sIt(t){return t<128?Uint8Array:t<32768?Uint16Array:t<1<<31?Uint32Array:Array}let t5e=class{constructor(e,i){this.elementCount=e,this.model=i,this._elementIndexMap=null,this._bspNodes=[],this._generatedBVH=!1,this.localMode=i.localMode,this.planetCenterZ=i.planetCenterZ,this.geometryMinZ=i.geometryMinZ,this.planetCenter=De(0,0,this.planetCenterZ),this.maxBspNodeDepth=i.maxBspNodeDepth??8,this.minElementCountForBVH=i.minElementCountForBVH??15,this.minBspNodeElementCount=i.minBspNodeElementCount??5}get elementIndexMap(){return this._ensureBVH(),this._elementIndexMap}get _skipBVH(){return this.elementCount<this.minElementCountForBVH||this.geometryMinZ<.5*this.planetCenterZ}_ensureBVH(){this._generatedBVH||this._skipBVH||this._bspNodes.length===0&&this._generateBsp()}intersectRay(e,i,r){this.elementCount<1||(this._skipBVH?this._intersectRayWithoutBVH(r):this._intersectRayWithBVH(e,i,r))}_intersectRayWithoutBVH(e){this._intersectRange(0,this.elementCount)}_intersectRange(e,i){this.model.intersectRange(e,i)}_intersectRayWithBVH(e,i,r){this._ensureBVH(),r?this._intersectGeometryWithBVHVerticalRay(e):this._intersectGeometryWithBVHGeneralRay(e,i)}_intersectGeometryWithBVHVerticalRay(e){let i=e[0],r=e[1];if(!this.localMode){const{geometryMinZ:o,planetCenterZ:a}=this,l=(o-a)/(e[2]-a);i=e[0]*l,r=e[1]*l}const{_bspNodes:s}=this;let n=0;for(;n>=0;){const o=s[n],{d:a,dim:l,minIndexIndex:c,minMidIndexIndex:h,maxMidIndexIndex:d,maxIndexIndex:f,aabb2D:m}=o;if(i<m[0]||i>m[2]||r<m[1]||r>m[3])break;if(l===-1||o.child0===-1&&o.child1===-1){this._intersectRange(c,f);break}{this._intersectRange(h,d);const g=(l===0?i:r)-a;if(g<0){if(o.child0===-1){this._intersectRange(c,h);break}n=o.child0}else{if(!(g>0))break;if(o.child1===-1){this._intersectRange(d,f);break}n=o.child1}}}}_intersectGeometryWithBVHGeneralRay(e,i){let r=e[0],s=e[1],n=i[0],o=i[1];const{geometryMinZ:a}=this;if(!this.localMode){let g=0,v=1;const _=Math.min(.5*this.planetCenterZ,a),b=e[2],w=i[2];if(b<_&&w<_||(b<_&&(g=(_-b)/(w-b)),w<_&&(v=(_-b)/(w-b)),g>v))return;const x=(1-g)*e[0]+g*i[0],S=(1-g)*e[1]+g*i[1],C=(1-g)*e[2]+g*i[2],T=(1-v)*e[0]+v*i[0],M=(1-v)*e[1]+v*i[1],I=(1-v)*e[2]+v*i[2],{planetCenterZ:D}=this,P=a-D,F=P/(C-D);r=x*F,s=S*F;const L=P/(I-D);n=T*L,o=M*L}const l=n-r,c=o-s,h=this._bspNodes;let d=1;{const{aabb2D:g}=h[0],v=(w,x,S,C)=>{if(Math.abs(x)<1e-5*Math.max(C-S,1))return!1;const T=x>0,M=T?C:S,I=w+d*x;return(T?I<M:I>M)&&(d=Math.max((M-w)/x,d),!0)},_=()=>v(r,l,g[0],g[2]),b=()=>v(s,c,g[1],g[3]);Math.abs(l)>=Math.abs(c)?_()||b():b()||_()}const f=[0,0,d];let m=0;for(;m<f.length;){const g=f[m];let v=f[m+1],_=f[m+2];if(m+=3,v>_)continue;const b=h[g],{minIndexIndex:w,maxIndexIndex:x}=b,{child0:S,child1:C,minMidIndexIndex:T,maxMidIndexIndex:M,aabb2D:I,d:D,dim:P}=b;{const F=r+v*l,L=r+_*l,N=Math.min(F,L),R=Math.max(F,L),k=I[0],W=I[2];if(R<k||W<N)continue;if(N<k){const j=(k-r)/l;l>0?v=Math.max(v,j):_=Math.min(_,j)}if(W<R){const j=(W-r)/l;l>0?_=Math.min(_,j):v=Math.max(v,j)}}{const F=s+v*c,L=s+_*c,N=Math.min(F,L),R=Math.max(F,L),k=I[1],W=I[3];if(R<k||W<N)continue;if(N<k){const j=(k-s)/c;c>0?v=Math.max(v,j):_=Math.min(_,j)}if(W<R){const j=(W-s)/c;c>0?_=Math.min(_,j):v=Math.max(v,j)}}if(S===-1&&C===-1)this._intersectRange(w,x);else{const F=P===0?r:s,L=P===0?l:c,N=F+v*L,R=F+_*L,k=Math.min(N,R),W=Math.max(N,R),j=ue((D-F)/L,0,d);w<T&&k<=D&&(S!==-1?(f.push(S),f.push(L>=0?v:Math.max(v,j)),f.push(L>=0?Math.min(_,j):_)):this._intersectRange(w,T)),this._intersectRange(T,M),M<x&&D<=W&&(C!==-1?(f.push(C),f.push(L>=0?Math.max(v,j):v),f.push(L>=0?_:Math.min(_,j))):this._intersectRange(M,x))}}}_generateBsp(){const{elementCount:e}=this;if(e<1)return;const i=rIt(e,e);this._elementIndexMap=i;for(let m=0;m<e;++m)i[m]=m;const r=this.model.getAabbs2D();let s=0;const n=this._bspNodes;n.length=0;const{localMode:o}=this;let a=!1;if(!o){const{planetCenterZ:m,geometryMinZ:g}=this;a=m>=0||g<.5*m}const l=[],c=(m,g,v,_,b)=>{l.push(m),l.push(g),l.push(v),l.push(_<0?-1:(b?0:1)+2*_)},{maxBspNodeDepth:h,minBspNodeElementCount:d}=this,f=(m,g,v,_,b)=>{const w=n.length;if(w>0&&(a||v>=h||g-m<d))return;const x=[0,0,0,0];lIt(x,m,g,i,r);const{d:S,dim:C}=o?nIt(x):oIt(x),{rangeMidStart:T,rangeMidEnd:M}=aIt(m,g,C,S,i,r),I=v===h-1,D=!I&&T>=m+d,P=!I&&g>=M+d;if(D||P||w===0){const F=new cIt(m,T,M,g,C,S,x);if(D&&c(m,T,v+1,w,!0),P&&c(M,g,v+1,w,!1),n.push(F),_!==-1){const L=n[_];b?L.child0=w:L.child1=w}}};for(c(0,e,0,-1,!1);s<l.length;){const m=l[s],g=l[s+1],v=l[s+2],_=l[s+3];s+=4;const b=_>>1;f(m,g,v,b,_-(b<<1)==0)}this._generatedBVH=!0}};function nIt(t){const e=t[0],i=t[1],r=t[2],s=t[3];let n,o;return r-e>=s-i?(o=.5*(e+r),n=0):(o=.5*(i+s),n=1),{d:o,dim:n}}function oIt(t){const e=t[0],i=t[1],r=t[2],s=t[3];let n,o;return r-e>=s-i?(n=0,o=.5*(e+r)):(n=1,o=.5*(i+s)),{dim:n,d:o}}function aIt(t,e,i,r,s,n){let o=t;{let h=e;for(;o<h;){const d=s[o];E_e(d,i,r,n)<0?++o:(--h,s[o]=s[h],s[h]=d)}}const a=o;let l=o,c=e;for(;l<c;){const h=s[c-1];E_e(h,i,r,n)>0?--c:(s[c-1]=s[l],s[l]=h,++l)}return{rangeMidStart:a,rangeMidEnd:c}}function E_e(t,e,i,r){const s=4*t,n=r[s+0+e];return r[s+2+e]<i?-1:n>i?1:0}function lIt(t,e,i,r,s){let n=1/0,o=1/0,a=-1/0,l=-1/0;for(let c=e;c<i;++c){const h=4*r[c];n=Math.min(n,s[h+0]),o=Math.min(o,s[h+1]),a=Math.max(a,s[h+2]),l=Math.max(l,s[h+3])}t[0]=n,t[1]=o,t[2]=a,t[3]=l}let cIt=class{constructor(e,i,r,s,n,o,a){this.minIndexIndex=e,this.minMidIndexIndex=i,this.maxMidIndexIndex=r,this.maxIndexIndex=s,this.dim=n,this.d=o,this.aabb2D=a,this.child0=-1,this.child1=-1}},uIt=class{constructor(e,i,r,s,n,o,a,l,c){this.componentIndex=e,this.vertexData=i,this.vertexStride=r,this.indexData=s,this.startTriangleNumber=n,this.endTriangleNumber=o,this.geometryMinZ=a,this.planetCenterZ=l,this.localMode=c,this.maxBspNodeDepth=8,this.minElementCountForBVH=20,this.minBspNodeElementCount=10,this.rayDirection=$(),this.ray0=$(),this.isVerticalRay=!1,this._triangleHitCallback=C_e,this.totalElevationOffset=0,this.normalRequired=!1,this._bvh=new t5e(o-n,this)}getAabbs2D(){return this.localMode?iIt(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride):tIt(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride,this.geometryMinZ,this.planetCenterZ)}get numTriangles(){return this.endTriangleNumber-this.startTriangleNumber}intersectRay(e,i,r,s,n,o){ne(this.ray0,e),Fi(this.rayDirection,i,e),this.isVerticalRay=r,this.totalElevationOffset=s,this.normalRequired=o,this._triangleHitCallback=n,this._bvh.intersectRay(e,i,r),this._triangleHitCallback=C_e}intersectRange(e,i){const r=this._bvh.elementIndexMap;i5e(this.ray0,this.rayDirection,e,i,this.indexData,this.vertexData,this.vertexStride,this.totalElevationOffset,this.planetCenterZ,this.normalRequired,this._triangleHitCallback,r,this.startTriangleNumber)}getTriangleElevationOffset(e){return this.totalElevationOffset}};function i5e(t,e,i,r,s,n,o,a,l,c,h,d=null,f=0){a!==0?dft(t,e,i,r,s,n,o,a,l,c,h,d,f):J3e(t,e,i,r,s,n,o,c,h,d,f)}function C_e(){}function hIt(t,e,i,r){if(i>=e)return t;t==null&&(t=dIt());const s=t.isVisibleBit;let n=t.data;const o=r5e(n),a=i/o|0,l=i-o*a,c=(e-1)/o|0,h=n,d=r===s;if(!(i<h.length*o)&&d){const f=a+1,m=Math.ceil(h.length*Qxe),g=c+1;let v=Math.max(f,m);v=Math.min(v,g),n=new Uint32Array(v),n.set(h)}return a<n.length&&(n[a]=fIt(n[a],l,d)),t.data=n,t}function bQ(t,e){if(t==null)return!0;const{isVisibleBit:i,data:r}=t,s=r5e(r);return e<r.length*s?pIt(i,r,e,s):!t.isVisibleBit}function dIt(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function pIt(t,e,i,r){const s=i/r|0,n=i-s*r;return mIt(e[s],n)===t}function r5e(t){return t.BYTES_PER_ELEMENT*8}function fIt(t,e,i){return t&~(1<<e)|(i?1:0)<<e}function mIt(t,e){return!!(t&1<<e)}let gIt=class{constructor(e,i,r,s,n,o,a,l){this.vertexData=e,this.vertexStride=i,this.indexData=r,this._components=s,this._componentAabbs3D=n,this.geometryMinZ=o,this.planetCenterZ=a,this.localMode=l,this.maxBspNodeDepth=6,this.minElementCountForBVH=10,this.minBspNodeElementCount=3,this._ray0=bIt,this._ray1=wIt,this._invDir=$(),this._componentVerticalOffsets=null,this._verticalOffset=null,this._tolerance=0,this._intersectionOptions=xIt,this._callback=$_e,this.rayDirectionC=$(),this._componentIndexMap=null,this._bvh=new t5e(s.count,this),this.componentIntersectionData=new Array(s.count)}get numComponents(){return this._components.count}get minZGlobal(){return this.geometryMinZ-this.planetCenterZ}getAabbs2D(){return this.localMode?this.getAabbs2DLocal():this.getAabbs2DGlobal()}getAabbs2DGlobal(){const{numComponents:e,planetCenterZ:i,minZGlobal:r}=this,s=new Float64Array(4*e),n=this._componentAabbs3D;for(let o=0;o<e;++o){const a=6*o,l=n[a+0],c=n[a+1],h=n[a+2],d=n[a+3],f=n[a+4],m=r/(h-i),g=r/(n[a+5]-i),v=Math.min(l*m,l*g),_=Math.min(c*m,c*g),b=Math.max(d*m,d*g),w=Math.max(f*m,f*g),x=4*o;s[x+0]=v,s[x+1]=_,s[x+2]=b,s[x+3]=w}return s}getAabbs2DLocal(){const{numComponents:e}=this,i=new Float64Array(4*e),r=this._componentAabbs3D;for(let s=0;s<e;++s){const n=6*s,o=r[n+0],a=r[n+1],l=r[n+3],c=r[n+4],h=4*s;i[h+0]=o,i[h+1]=a,i[h+2]=l,i[h+3]=c}return i}intersectRay(e,i,r,s,n,o,a){const{isVerticalRay:l}=a;this._ray0=e,this._ray1=i,this._componentVerticalOffsets=r,this._verticalOffset=s,this._tolerance=o,this._intersectionOptions=a,this._componentIndexMap=this._bvh.elementIndexMap,vft(e,i,this._invDir),this._callback=n,this._bvh.intersectRay(e,i,l),this._callback=$_e}intersectRange(e,i){const r=this._componentIndexMap,s=this._components,n=s.pickability,o=s.visibility;for(let a=e;a<i;++a){const l=r?r[a]:a;bQ(n,l)&&o.isVisible(l)&&this._intersectComponent(l)}}getComponentTriangleCount(e){const i=this._components.offsets,r=i[e]/3;return i[e+1]/3-r}getComponentAabb3D(e,i){const r=this._componentAabbs3D,s=6*e;return i[0]=r[s],i[1]=r[s+1],i[2]=r[s+2],i[3]=r[s+3],i[4]=r[s+4],i[5]=r[s+5],i}_intersectComponent(e){if(!bQ(this._components.pickability,e))return;const i=this.getComponentAabb3D(e,yIt);let r=!1;const{localMode:s,_componentVerticalOffsets:n,_verticalOffset:o,_ray0:a,_ray1:l,_invDir:c,planetCenterZ:h,_tolerance:d,rayDirectionC:f,componentIntersectionData:m}=this,{isVerticalRay:g}=this._intersectionOptions,v=this._components.offsets,_=ne(vIt,a),b=ne(_It,l),w=(n==null?void 0:n[e])??0,x=w+((o==null?void 0:o.offset)??0);if(x!==0&&(s?(_[2]=a[2]-x,b[2]=l[2]-x,r=!0):o!=null&&(o.componentOffset=w)),o==null||r||x===0||o.applyToAabb(i),!K3e(i,_,c,d))return;Fi(f,b,_);const S=v[e]/3,C=v[e+1]/3,T=C-S,M=(N,R,k)=>{this._callback(N,R,e,k)},{vertexData:I,vertexStride:D,indexData:P,_intersectionOptions:F}=this,{normalRequired:L}=F;if(T>SIt){let N=m[e];N==null&&(N=new uIt(e,I,D,P,S,C,this.geometryMinZ,h,s),m[e]=N),N.intersectRay(_,b,g,r?0:x,M,L)}else i5e(_,f,S,C,P,I,D,r?0:x,h,L,M)}};const yIt=fh(),vIt=$(),_It=$(),bIt=$(),wIt=$(),$_e=()=>{},xIt=new p6,SIt=40;let TIt=class{constructor(e,i,r){this.viewingMode=e,this.positionData=i,this._components=r,this.verticalOffset=null,this.componentVerticalOffsets=null,this._planetCenter=$(),this._componentBvh=null,this._aabb=[0,0,0,0,0,0],this._indices=i.indices?MS(i.indices):vL(i.positions.length/3),this._positions=i.positions}destroy(){this._positions=null,this._indices=null,this._perComponentAabbs=null,this._componentBvh=null}getComponentAabb(e,i){const r=this._ensureComponentAabbs(),s=6*e;return i[0]=r[s],i[1]=r[s+1],i[2]=r[s+2],i[3]=r[s+3],i[4]=r[s+4],i[5]=r[s+5],i}getComponentAabbs(){return this._ensureComponentAabbs()}_ensureComponentAabbs(){return this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs()),this._perComponentAabbs}getComponentPositions(e,i){i.indices=this._indices,i.data=this._positions,i.stride=3,i.startIndex=this._components.offsets[e],i.endIndex=this._components.offsets[e+1]}intersect(e,i,r,s,n,o,a,l){this.verticalOffset=s,this.componentVerticalOffsets=n;const{position:c}=o,h=Fi(EIt,e,c),d=Fi(CIt,i,c),f=lL($It,o.rotationScale);uc(h,h,f),uc(d,d,f);const m=uM(MIt,f);if(this.viewingMode===je.Global){const v=this._planetCenter;Cd(v,c),uc(v,v,f)}const g=(v,_,b,w)=>{l(b,v,w?uc(AIt,w,m):null,_)};this._intersectComponents(h,d,n,s,g,r,a)}_computePerComponentAabbs(){const e=this._aabb,i=.5*(e[0]+e[3]),r=.5*(e[1]+e[4]),s=.5*(e[2]+e[5]),n=this._components.count,o=oh(6*n),a=this._indices,l=this._positions,c=this._components.offsets;let h=0,d=1/0,f=1/0,m=1/0,g=-1/0,v=-1/0,_=-1/0;for(let b=0;b<n;b++){const w=c[b],x=c[b+1];let S=1/0,C=1/0,T=1/0,M=-1/0,I=-1/0,D=-1/0;if(w<x)for(let P=w;P<x;P++){const F=3*a[P],L=l[F],N=l[F+1],R=l[F+2];S=Math.min(S,L),C=Math.min(C,N),T=Math.min(T,R),M=Math.max(M,L),I=Math.max(I,N),D=Math.max(D,R)}else S=i,C=r,T=s,M=i,I=r,D=s;o[h++]=S,o[h++]=C,o[h++]=T,o[h++]=M,o[h++]=I,o[h++]=D,d=Math.min(d,S),f=Math.min(f,C),m=Math.min(m,T),g=Math.max(g,M),v=Math.max(v,I),_=Math.max(_,D)}return this._aabb[0]=d,this._aabb[1]=f,this._aabb[2]=m,this._aabb[3]=g,this._aabb[4]=v,this._aabb[5]=_,o}_intersectComponents(e,i,r,s,n,o,a){let l=this._componentBvh;l==null&&(l=new gIt(this._positions,3,this._indices,this._components,this._ensureComponentAabbs(),this.geometryMinZ,this.planetCenterZ,this.localMode),this._componentBvh=l),l.intersectRay(e,i,r,s,n,o,a)}get geometryMinZ(){return this._aabb[2]}get planetCenterZ(){return this._planetCenter[2]}get numTriangles(){return this._indices.length/3}get localMode(){return this.viewingMode===je.Local}get positions(){return this._positions}get indices(){return this._indices}get aabb(){return this._ensureComponentAabbs(),this._aabb}};const EIt=$(),CIt=$(),$It=Ts(),AIt=$(),MIt=Ts();let OIt=class{constructor(e,i,r){this.material=e,this.geometry=i,this.meta=r}destroy(){this.material.dispose(),this.geometry.dispose()}},IIt=class{constructor(e,i,r,s){this.vao=e,this.primitiveType=i,this.parameters=r,this.indexed=s}dispose(){this.vao.dispose()}},cu=class{constructor(e=1/0,i=-1/0){this.near=e,this.far=i}set(e,i){this.near=e,this.far=i}union(e){e!=null&&(this.near=Math.min(this.near,e.near),this.far=Math.max(this.far,e.far))}within(e){return this.near<=e&&e<=this.far}};cu.zero=new cu(0,0);function RIt(t,e){const i=new cu,{eye:r,frustum:s,viewForward:n}=t;e.forAll(o=>{const a=o.offsetObb!=null?o.offsetObb:o.obb,l=fe(Fi(Pu,a.center,r),n),c=a.projectedRadius(n);if(i.within(l-c)&&i.within(l+c))return;const h=FIt(a,s);if(h===-1)return;if(h===0)return Gg.far=l+c,Gg.near=l-c,void i.union(Gg);const d=$k.pushNew();d.near=l-c,d.far=l+c,d.mask=h,d.object=o});for(let o=0;o<$k.length;o++){const a=$k.data[o];if(i.within(a.near)&&i.within(a.far))continue;Gg.far=a.far,Gg.near=1/0,NIt(a.object.offsetObb!=null?a.object.offsetObb:a.object.obb,r,PIt,c=>{let h=DIt;for(let d=0;d<s5e&&c.length>0;d++){if(!(a.mask&1<<d))continue;LIt(s[d],c,h);const f=c;c=h,h=f}for(let d=0;d<c.length;d+=3){se(Jl,c.data[d],c.data[d+1],c.data[d+2]);const f=fe(Fi(Jl,Jl,r),n);Gg.near=Math.min(Gg.near,f)}})===0&&(Gg.near=0),i.union(Gg)}return $k.length=0,i}const $k=new ii({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=null,t)}),Gg=new cu,Jl=$(),e1=$(),PIt=new ii({deallocator:null}),DIt=new ii({deallocator:null});function LIt(t,e,i){i.length=0;const r=e.length-3;n7(Jl,e,r);const s=on(t,Jl);s<=0&&(i.push(Jl[0]),i.push(Jl[1]),i.push(Jl[2]));let n=0,o=s;for(;n<r;n+=3){n7(e1,e,n);const a=on(t,e1);o*a<0&&(fr(Jl,e1,Jl,a/(a-o)),Xl(i,Jl)),a<=0&&Xl(i,e1),o=a,ne(Jl,e1)}o*s<0&&(n7(e1,e,r),fr(Jl,e1,Jl,s/(s-o)),Xl(i,Jl))}function n7(t,e,i){return se(t,e.data[i],e.data[i+1],e.data[i+2])}function Xl(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function NIt(t,e,i,r){Tb(M_e,t.quaternion),Fi(Pu,e,t.center),Hc(Pu,Pu,M_e);const s=t.halfSize,n=8*((Pu[0]<-s[0]?-1:Pu[0]>s[0]?1:0)+3*(Pu[1]<-s[1]?-1:Pu[1]>s[1]?1:0)+9*(Pu[2]<-s[2]?-1:Pu[2]>s[2]?1:0)+13),o=A_e[n];if(o===0)return o;O3(Ak,t.quaternion),DG(Ak,Ak,t.halfSize);const a=(l,c)=>{const h=A_e[n+c+1];return se(l,((1&h)<<1)-1,(2&h)-1,((4&h)>>1)-1),uc(l,l,Ak),oe(l,t.center,l)};return i.length=0,Xl(i,a(o7,0)),Xl(i,a(O_e,1)),Xl(i,a(Pu,2)),Xl(i,a(I_e,3)),r(i),o===1||(i.length=0,Xl(i,o7),Xl(i,I_e),Xl(i,a(Pu,4)),Xl(i,a(R_e,5)),r(i),o===2||(i.length=0,Xl(i,o7),Xl(i,R_e),Xl(i,a(Pu,6)),Xl(i,O_e),r(i))),o}const A_e=(()=>{const t=new Array(216);let e=0;const i=r=>{for(let s=0;s<r.length;s++)t[e+s]=r[s];e+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),t})(),s5e=4;function FIt(t,e){let i=0;for(let r=0;r<s5e;r++){const s=t.intersectPlane(e[r]);if(s>0)return-1;s===0&&(i|=1<<r)}return i}const Ak=Ts(),M_e=zd(),Pu=$(),o7=$(),O_e=$(),I_e=$(),R_e=$();let kIt=class{constructor(e){this._objects=e}submit(e,i){this._objects.preSubmit(i),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(e,i,r))}queryDepthRange(e){return this._objects.visibleObjects.length?RIt(e,this._objects.visibleObjects):null}get hasEmissions(){return this._objects.visibleObjects.some(e=>e.renderable.material.hasEmissions)}hasHighlightOptions(e){return this._objects.hasHighlightOptions(e)}},kui=class extends cr{constructor(e,i,r,s,n){super(),this.colors=e,this.textureCoordinates=i,this.hasNormals=r,this.shadeNormals=s,this.applySSAO=n}};function zIt({hasNormals:t,textureCoordinates:e,colors:i}){const r=Bd().vec3f(z.POSITION);return t&&r.vec2i16(z.NORMALCOMPRESSED,{glNormalized:!0}),e===Ys.Default?r.vec2f(z.UV0):e===Ys.Atlas&&(r.vec2f(z.UV0),r.vec4u16(z.UVREGION,{glNormalized:!0})),i&&r.vec4u8(z.COLOR,{glNormalized:!0}),r}let UIt=class{constructor(){this.externalColor=yi(),this.externalColorMixMode=kn.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}};var dd;(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(dd||(dd={}));var Jm;function Bui(t){return t&&KA(t)?Jm.Mars:t&&QA(t)?Jm.Moon:Jm.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(Jm||(Jm={}));var yd;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(yd||(yd={}));let Tr=class extends hu{constructor(e,i){super(),this.spherical=e,this.doublePrecisionRequiresObfuscation=i,this.output=Y.Color,this.textureCoordinateType=Ys.None,this.componentData=Wm.Uniform,this.cullFace=Al.Back,this.vertexDiscardMode=dd.None,this.doubleSidedMode=io.WindingOrder,this.alphaDiscardMode=Fn.Opaque,this.integratedMeshMode=yd.None,this.oitPass=Ti.NONE,this.ellipsoidMode=Jm.Earth,this.pbrMode=Ct.Disabled,this.normalType=kr.Attribute,this.emissionSource=Ko.None,this.hasVertexColors=!1,this.hasNormals=!1,this.shadeNormals=!0,this.hasSlicePlane=!1,this.hasColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.screenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.hasNormalTextureTransform=!1,this.cloudReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1,this.discardInvisibleFragments=!1,this.occlusionPass=!1,this.bindType=Lt.Draw,this.useCustomDTRExponentForWater=!1,this.hasVertexTangents=!1,this.highStepCount=!1,this.instancedDoublePrecision=!1,this.hasModelTransformation=!1,this.useFillLights=!0,this.objectAndLayerIdColorInstanced=!1,this.canHaveOverlay=!0}};u([ie({count:Y.COUNT})],Tr.prototype,"output",void 0),u([ie({count:Ys.COUNT})],Tr.prototype,"textureCoordinateType",void 0),u([ie({count:Wm.COUNT})],Tr.prototype,"componentData",void 0),u([ie({count:Al.COUNT})],Tr.prototype,"cullFace",void 0),u([ie({count:dd.COUNT})],Tr.prototype,"vertexDiscardMode",void 0),u([ie({count:io.COUNT})],Tr.prototype,"doubleSidedMode",void 0),u([ie({count:Fn.COUNT})],Tr.prototype,"alphaDiscardMode",void 0),u([ie({count:yd.COUNT})],Tr.prototype,"integratedMeshMode",void 0),u([ie({count:Ti.COUNT})],Tr.prototype,"oitPass",void 0),u([ie({count:Jm.COUNT})],Tr.prototype,"ellipsoidMode",void 0),u([ie({count:Ct.COUNT})],Tr.prototype,"pbrMode",void 0),u([ie({count:kr.COUNT})],Tr.prototype,"normalType",void 0),u([ie({count:Ko.COUNT})],Tr.prototype,"emissionSource",void 0),u([ie()],Tr.prototype,"hasVertexColors",void 0),u([ie()],Tr.prototype,"hasNormals",void 0),u([ie()],Tr.prototype,"shadeNormals",void 0),u([ie()],Tr.prototype,"hasSlicePlane",void 0),u([ie()],Tr.prototype,"hasColorTexture",void 0),u([ie()],Tr.prototype,"receiveAmbientOcclusion",void 0),u([ie()],Tr.prototype,"receiveShadows",void 0),u([ie()],Tr.prototype,"blendingEnabled",void 0),u([ie()],Tr.prototype,"screenSpaceReflections",void 0),u([ie()],Tr.prototype,"hasPolygonOffset",void 0),u([ie()],Tr.prototype,"hasMetallicRoughnessTexture",void 0),u([ie()],Tr.prototype,"hasOcclusionTexture",void 0),u([ie()],Tr.prototype,"hasNormalTexture",void 0),u([ie()],Tr.prototype,"hasOccludees",void 0),u([ie()],Tr.prototype,"terrainDepthTest",void 0),u([ie()],Tr.prototype,"cullAboveTerrain",void 0),u([ie()],Tr.prototype,"hasNormalTextureTransform",void 0),u([ie()],Tr.prototype,"cloudReflections",void 0),u([ie()],Tr.prototype,"snowCover",void 0),u([ie()],Tr.prototype,"objectAndLayerIdColor",void 0);function P_e(t,e){const i=t.fragment;switch(e.doubleSidedMode){case io.None:i.code.add(E`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case io.View:t.include(fP,e),i.code.add(E`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case io.WindingOrder:i.code.add(E`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case io.COUNT:}switch(e.normalType){case kr.Attribute:case kr.Compressed:t.include(y6,e),i.main.add(E`vec3 fragmentFaceNormal = _adjustDoublesided(normalize(vNormalWorld));
vec3 fragmentFaceNormalView = gl_FrontFacing ? normalize(vNormalView) : -normalize(vNormalView);`);break;case kr.ScreenDerivative:t.include(fP,e),i.main.add(E`vec3 fragmentFaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
vec3 fragmentFaceNormalView = normalize(cross(dFdx(vPosition_view), dFdy(vPosition_view)));`);default:case kr.COUNT:}e.shadeNormals?i.main.add(E`vec3 fragmentShadingNormal = fragmentFaceNormal;`):e.spherical?(t.include(fP,e),i.main.add(E`vec3 fragmentShadingNormal = normalize(positionWorld());`)):i.main.add(E`vec3 fragmentShadingNormal = vec3(0.0, 0.0, 1.0);`)}function BIt(t,e){t.include(_6,e),t.fragment.include(noe);const i=t.fragment;i.uniforms.add(new B3("baseColor",r=>r.baseColor)),i.uniforms.add(new SDe("objectOpacity",r=>r.objectOpacity)),e.hasVertexColors?i.code.add(E`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):i.code.add(E`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),i.code.add(E`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function VIt(t,e){const i=e.hasColorTexture&&(ws(e.output)||e.alphaDiscardMode!==Fn.Opaque);i&&(t.include(u6,e),t.fragment.uniforms.add(new ag("baseColorTexture",r=>r.texture))),t.fragment.code.add(E`
    vec4 readBaseColorTexture() {
      return ${i?"textureLookup(baseColorTexture, vuv0)":"vec4(1.0)"};
    }
  `)}function n5e(t){const e=new Vi,{vertex:i,fragment:r}=e;e.include(fP,t),e.include(y6,t),e.include(_6,t),e.include(Ky,t),e.include(v6,t),e.include(lpt,t),e.include(lmt,t),r.include(kft,t),e.include(VIt,t),e.include(AL,t);const{output:s,pbrMode:n,hasNormalTexture:o,snowCover:a,receiveShadows:l,spherical:c,ellipsoidMode:h}=t,d=n===Ct.Normal||n===Ct.Schematic;d&&(e.include(Pne,t),o&&e.include(CDe,t));const f=s===Y.Shadow||s===Y.ShadowHighlight||s===Y.ShadowExcludeHighlight,m=f&&t.componentData===Wm.Varying,g=t.integratedMeshMode===yd.ColorOverlay||t.integratedMeshMode===yd.ColorOverlayWithWater;if(g){e.include(wA,t),e.include(nyt,t);const M=h===Jm.Earth,I=h===Jm.Earth,D=M?Ci.radius:I?nf.radius:gv.radius;i.code.add(`
      ${Te(c,`const float invRadius = ${E.float(1/D)};`)}
      vec2 projectOverlay(vec3 pos) { return pos.xy ${Te(c,"/ (1.0 + invRadius * pos.z);")}; }`)}const v=g&&ws(s)&&n===Ct.WaterOnIntegratedMesh;v&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3"));const _=t.vertexDiscardMode===dd.None,b=t.vertexDiscardMode===dd.Opaque,w=1-1/255;if(i.main.add(E`
    bool castShadows;
    vec4 externalColor = forwardExternalColor(castShadows);
    ${Te(m,"if(!castShadows) { gl_Position = vec4(vec3(1e38), 1.0); return; }")}

    ${Te(!_,`{ if (externalColor.a ${b?">":"<="} ${E.float(w)}) { gl_Position = vec4(vec3(1e38), 1.0); return; } }`)}

    ${Te(s===Y.ObjectAndLayerIdColor,"externalColor.a = 1.0;")}

    forwardPosition(readElevationOffset());
    forwardViewPosDepth(vPosition_view);
    forwardNormal();
    forwardTextureCoordinates();
    forwardVertexColor();
    forwardLinearDepth();
    forwardObjectAndLayerIdColor();
    ${Te(v,c?E`
              groundNormal = normalize(positionWorld());
              tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
              tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:E`
              groundNormal = vec3(0.0, 0.0, 1.0);
              tbnTangent = vec3(1.0, 0.0, 0.0);
              tbnBiTangent = vec3(0.0, 1.0, 0.0);`)}
    ${Te(g,"setOverlayVTC(projectOverlay(position));")}

    if (externalColor.a < ${E.float(Kr)}) {
      // Discard this vertex
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    }
  `),ws(s))return e.include(BIt,t),e.include(P_e,t),e.include(wA,t),e.include(C6,t),l&&e.include($L,t),r.code.add(E`
      float evaluateShadow() {
        return ${l?"readShadowMap(vPositionWorldCameraRelative, linearDepth)":"0.0"};
      }`),g&&r.uniforms.add(new It("ovColorTex",(M,I)=>tLe(M,I))),r.main.add(E`
      discardBySlice(vPositionWorldCameraRelative);
      discardByTerrainDepth();

      vec4 textureColor = readBaseColorTexture();
      discardOrAdjustAlpha(textureColor);

      vec4 externalColor;
      int externalColorMixMode;
      readExternalColor(externalColor, externalColorMixMode);

      vec4 materialColor = computeMaterialColor(textureColor, externalColor, externalColorMixMode);
      ${Te(g,E`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`)}
    `),d?(Av(r),c&&bA(r),r.main.add(E`
        applyPBRFactors();
        ${Te(n===Ct.Normal,E`if (externalColorMixMode == 3) {
              mrr = vec3(0.0, 0.6, 0.2);
            }`)}
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
        ${Te(o,"mat3 tangentSpace = computeTangentSpace(fragmentShadingNormal, vPositionWorldCameraRelative, vuv0);")}
        vec3 shadingNormal = ${o?"computeTextureNormal(tangentSpace, vuv0)":"fragmentShadingNormal"};
        vec3 normalGround = ${c?E`normalize(positionWorld())`:E`vec3(0.0, 0.0, 1.0)`};

        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * evaluateAmbientOcclusionInverse();
        ${Te(a,E`float snow = smoothstep(0.5, 0.55, dot(fragmentFaceNormal, normalize(positionWorld())));
                 materialColor.rgb = mix(materialColor.rgb, vec3(1.1), snow);
                 ssao = mix(ssao, 0.5 * ssao, snow);
                 shadingNormal = mix(shadingNormal, fragmentFaceNormal, snow);`)}
        ${Te(g,"materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;")}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 emission = getEmissions();
        ${Te(c,"float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());")}
        ${c?E`float shadow = max(lightingGlobalFactor * (1.0 - additionalAmbientScale), evaluateShadow());`:"float shadow = evaluateShadow();"}
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, shadow, ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(c&&bA(r),v&&r.uniforms.add(new oo("ovNormalTex",M=>{var I;return(I=M.overlay)==null?void 0:I.getTexture(sr.WaterNormal)})),r.main.add(E`
        ${Te(c,"float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());")}
        float shadow = ${l?c?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), evaluateShadow())":"evaluateShadow()":c?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        ${Te(a,E`float snow = smoothstep(0.5, 0.55, dot(fragmentFaceNormal, normalize(positionWorld())));
               materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)}

        // At global scale we create some additional ambient light based on the main light to simulate global illumination
        float ssao = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());

        ${Te(g,"materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;")}

        vec4 shadedColor = vec4(evaluateSceneLighting(fragmentShadingNormal, materialColor.rgb, shadow, ssao, additionalLight), materialColor.a);
        ${Te(v,E`vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
                 float waterNormalLength = length(overlayWaterMask);
                 if (waterNormalLength > 0.95) {
                   mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                   vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                   vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                   // un-gamma the ground color to mix in linear space
                   shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
                 }`)}
      `)),r.main.add("outputColorHighlightOID(shadedColor, vPositionWorldCameraRelative);"),e;const x=s===Y.Normal,S=s===Y.ObjectAndLayerIdColor,C=s===Y.Highlight,T=f||s===Y.ViewshedShadow;return T&&e.include(Jne,t),x&&e.include(P_e,t),e.include(EL,t),r.main.add(E`
    discardBySlice(vPositionWorldCameraRelative);

    vec4 textureColor = readBaseColorTexture();
    discardOrAdjustAlpha(textureColor);

    ${Te(T,"outputDepth(linearDepth);")}
    ${Te(x,E`fragColor = vec4(vec3(0.5) + 0.5 * fragmentFaceNormalView, 1.0);`)}
    ${Te(S,g?"fragColor = getOverlayColorTexel();":"outputObjectAndLayerIdColor();")}
    ${Te(C,E`${Te(g,E`
           vec2 overlayHighlightTexel = getAllOverlayHighlightValuesEncoded();
           calculateOcclusionAndOutputHighlightOverlay(overlayHighlightTexel);`,E`calculateOcclusionAndOutputHighlight();`)}`)}`),e}const jIt=Object.freeze(Object.defineProperty({__proto__:null,build:n5e},Symbol.toStringTag,{value:"Module"}));let GIt=class extends Hi{constructor(e,i){super(e,i,new Bi(jIt,()=>G(()=>Promise.resolve().then(()=>mHt),void 0)),o5e)}initializePipeline(e){const{integratedMeshMode:i,output:r,blendingEnabled:s,cullFace:n,hasOccludees:o,hasPolygonOffset:a,oitPass:l}=e,c=i!==yd.None,h=l===Ti.NONE,d=l===Ti.FrontFace;return wi({blending:ws(r)&&s?Fne(l):null,culling:F3e(n),depthTest:{func:zne(l)},depthWrite:h||d?SL:null,drawBuffers:r===Y.Depth?{buffers:[Ga.NONE]}:d6(l,r),colorWrite:Di,stencilWrite:c||o?OB:null,stencilTest:c?Lft(hh.IntegratedMeshMaskExcluded):o?Gne:null,polygonOffset:h||d?a?{factor:2,units:2}:null:kne})}};const o5e=new Map([[z.POSITION,0],[z.NORMAL,1],[z.NORMALCOMPRESSED,1],[z.COLOR,2],[z.UV0,3],[z.UVREGION,4],[z.COMPONENTINDEX,5]]);let HIt=class extends cr{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},Uae=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function _s(t={}){return(e,i)=>{const r=e._parameterCount??0;if(e._parameterCount=r+1,t.vectorOps){const s=t.vectorOps;Object.defineProperty(e,i,{get(){return this[r]},set(n){const o=this[r];if(o==null)this[r]=[...n];else{if(s.equals(o,n))return;s.copy(o,n)}this._setDirty()}})}else Object.defineProperty(e,i,{get(){return this[r]},set(s){this[r]!==s&&(t.dispose&&this[r]&&this[r].dispose(),this[r]=s,this._setDirty())}})}}function D_e(){return(t,e)=>{const i=t._parameterCount??0;t._parameterCount=i+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(i),Object.defineProperty(t,e,{get(){return this[i]},set(r){this[i]!==r&&(this[i]=r,this._setDirty())}})}}let a5e=class{constructor(e){this._low=$(),this._high=$(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){ne(this._low,ne(L_e,e));const i=Fi(L_e,e,this._low);ne(this._high,i)}get(e){return oe(e,this._low,this._high)}getLowScaled(e){return re(e,this._low,1)}};const L_e=Zc();let uo=class extends HIt{constructor(e,i){super(),this.toMapSpace=i,this.baseColor=D3(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=M3e,this.emissiveFactor=yf(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.commonMaterialParameters=new hz,this.componentParameters=new RP,this.objectOpacity=1,this.textureAlphaCutoff=Kr,this.alphaDiscardMode=Fn.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=Jm.Earth,this.hasOccludees=!1;const r=new a5e(e.position),s=nRe(e.rotationScale);lL(s,s),uM(s,s),this.transformNormalGlobalFromModel=s,this.transformWorldFromModelTL=r.low,this.transformWorldFromModelTH=r.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){var e;return(e=this.baseColorTexture)==null?void 0:e.glTexture}get textureMetallicRoughness(){var e;return(e=this.metallicRoughnessTexture)==null?void 0:e.glTexture}get textureEmissive(){var e;return(e=this.emissionTexture)==null?void 0:e.glTexture}get hasEmissions(){return this.emissionTexture!=null||!to(this.emissiveFactor,cn)}get textureOcclusion(){var e;return(e=this.occlusionTexture)==null?void 0:e.glTexture}get textureNormal(){var e;return(e=this.normalTexture)==null?void 0:e.glTexture}acquireTechnique(e,i,r,s){const n=new Tr(e.context.spherical,e.context.doublePrecisionRequiresObfuscation);n.hasVertexColors=s.colors,n.hasNormals=s.hasNormals,n.textureCoordinateType=s.textureCoordinates,n.hasMetallicRoughnessTexture=this.metallicRoughnessTexture!=null,n.hasOcclusionTexture=this.occlusionTexture!=null,n.hasNormalTexture=this.normalTexture!=null,n.oitPass=i.identifier===Wa.Material&&r.oitPass!=null?r.oitPass:Ti.NONE,n.terrainDepthTest=i.identifier===Wa.Material&&r.terrainDepthTest,n.cullAboveTerrain=i.identifier===Wa.Material&&r.cullAboveTerrain,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?io.View:io.None,n.hasColorTexture=this.baseColorTexture!=null;const o=this._computeWhichMaterialPass();if(n.blendingEnabled=o===yl.Transparent||o===yl.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?ZIt(r)?WIt(r)?yd.ColorOverlayWithWater:yd.ColorOverlay:yd.NoOverlay:yd.None,n.hasPolygonOffset=this.polygonOffsetEnabled,n.pbrMode=n.integratedMeshMode===yd.ColorOverlayWithWater?Ct.WaterOnIntegratedMesh:this.usePBR?this.hasParametersFromSource?s.shadeNormals&&this.isIntegratedMesh?Ct.Disabled:Ct.Schematic:Ct.Normal:Ct.Disabled,n.emissionSource=this.emissionTexture!=null?Ko.Texture:n.pbrMode===Ct.Normal?Ko.Value:Ko.None,n.shadeNormals=s.shadeNormals,n.normalType=n.hasNormals?kr.Compressed:kr.ScreenDerivative,n.hasSlicePlane=r.slicePlane!=null&&this.commonMaterialParameters.hasSlicePlane,i.identifier===Wa.ShadowMap)n.output=Y.Shadow,n.vertexDiscardMode=dd.None;else if(i.identifier===Wa.ViewshedShadowMap)n.output=Y.ViewshedShadow,n.vertexDiscardMode=dd.None;else if(i.identifier===Wa.Highlight)n.output=Y.Highlight,n.vertexDiscardMode=dd.None;else{switch(o===yl.OpaqueAndTransparent?n.vertexDiscardMode=i.transparent?dd.Opaque:dd.Transparent:n.vertexDiscardMode=dd.None,n.output=i.output,n.receiveAmbientOcclusion=n.receiveShadows=!1,i.output){case Y.Color:case Y.ColorEmission:n.receiveAmbientOcclusion=s.applySSAO&&r.ssao!=null,n.hasOccludees=r.hasOccludees,n.receiveShadows=r.shadowMap.ready,n.screenSpaceReflections=r.ssr.lastFrameColor!=null,n.cloudReflections=r.clouds.data!=null;break;case Y.ObjectAndLayerIdColor:n.objectAndLayerIdColor=!0}n.snowCover=this.hasSnowCover(r)}const a=e.get(GIt,n);return this._setClean(),a}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,i,r){if(this.objectOpacity<=0)return;const{componentData:s,renderable:n}=r,{geometry:o}=n,a=n.meta.cameraDepthSquared;s.updateHighlights(i.highlights);const{geometryRanges:l,highlightRangesMap:c,shadowmapRanges:h}=s;switch(this._computeWhichMaterialPass()){case yl.Opaque:e.opaque.submitDraw(this,o,l,a);break;case yl.Transparent:e.transparent.submitDraw(this,o,l,a);break;case yl.OpaqueAndTransparent:e.opaque.submitDraw(this,o,l,a),e.transparent.submitDraw(this,o,l,a);break;case yl.IntegratedMesh:e.integratedMesh.submitDraw(this,o,l,a),qIt(i)&&e.highlightIntegratedMesh.submitDraw(this,o,l,a)}if(this.componentParameters.castShadows!==Ln.None){if(c!=null)for(const d of c)d[0]===jm&&e.highlightShadowMap.submitDraw(this,o,d[1],a,d[0]);h!=null&&e.nonHighlightShadowMap.submitDraw(this,o,h,a),e.shadowMap.submitDraw(this,o,l,a)}if(c!=null)for(const d of c)e.highlight.submitDraw(this,o,d[1],a,d[0]);i.viewshedEnabled&&e.viewshedShadowMap.submitDraw(this,o,l,a)}_computeWhichMaterialPass(){if(this.isIntegratedMesh)return yl.IntegratedMesh;if(this.objectOpacity<1)return yl.Transparent;if(this.componentParameters.opaqueOverride===Ln.All)return yl.Opaque;if(this.baseColor[3]<1||this.alphaDiscardMode===Fn.Blend||this.alphaDiscardMode===Fn.MaskBlend)return yl.Transparent;switch(this.componentParameters.transparent){case Ln.None:return yl.Opaque;case Ln.All:return yl.Transparent;case Ln.Some:return yl.OpaqueAndTransparent}}};var yl,Ln;u([_s({vectorOps:xRe})],uo.prototype,"baseColor",void 0),u([_s()],uo.prototype,"usePBR",void 0),u([_s()],uo.prototype,"hasParametersFromSource",void 0),u([_s({vectorOps:kde})],uo.prototype,"mrrFactors",void 0),u([_s({vectorOps:kde})],uo.prototype,"emissiveFactor",void 0),u([_s({dispose:!0})],uo.prototype,"baseColorTexture",void 0),u([_s({dispose:!0})],uo.prototype,"metallicRoughnessTexture",void 0),u([_s({dispose:!0})],uo.prototype,"emissionTexture",void 0),u([_s({dispose:!0})],uo.prototype,"occlusionTexture",void 0),u([_s({dispose:!0})],uo.prototype,"normalTexture",void 0),u([D_e()],uo.prototype,"commonMaterialParameters",void 0),u([D_e()],uo.prototype,"componentParameters",void 0),u([_s()],uo.prototype,"objectOpacity",void 0),u([_s()],uo.prototype,"textureAlphaCutoff",void 0),u([_s()],uo.prototype,"alphaDiscardMode",void 0),u([_s()],uo.prototype,"isIntegratedMesh",void 0),u([_s()],uo.prototype,"polygonOffsetEnabled",void 0),u([_s()],uo.prototype,"ellipsoidMode",void 0),u([_s()],uo.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(yl||(yl={}));let hz=class extends Uae{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=Al.Back,this.hasSlicePlane=!0}};u([_s()],hz.prototype,"doubleSided",void 0),u([_s()],hz.prototype,"cullFace",void 0),u([_s()],hz.prototype,"hasSlicePlane",void 0);let RP=class extends Uae{constructor(){super(...arguments),this.externalColor=Yi(1,1,1,1),this.externalColorMixMode=kn.Multiply,this.castShadows=Ln.All}get transparent(){return this.externalColor[3]<1?Ln.All:Ln.None}get opaqueOverride(){return this.externalColorMixMode===kn.Replace&&this.externalColor[3]===1?Ln.All:Ln.None}get visible(){return this.externalColor[3]>0?Ln.All:Ln.None}get type(){return Wm.Uniform}};u([_s({vectorOps:xRe})],RP.prototype,"externalColor",void 0),u([_s()],RP.prototype,"externalColorMixMode",void 0),u([_s()],RP.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(Ln||(Ln={}));let lR=class extends Uae{constructor(){super(...arguments),this.texture=null,this.transparent=Ln.None,this.opaqueOverride=Ln.None,this.castShadows=Ln.None}get type(){return Wm.Varying}};function qIt(t){var e;return((e=t.overlay)==null?void 0:e.getTexture(sr.Highlight))!=null}function WIt(t){var e;return((e=t.overlay)==null?void 0:e.getTexture(sr.WaterNormal))!=null}function ZIt(t){var e;return((e=t.overlay)==null?void 0:e.getTexture(sr.ColorNoRasterImage))!=null}u([_s()],lR.prototype,"texture",void 0),u([_s()],lR.prototype,"transparent",void 0),u([_s()],lR.prototype,"opaqueOverride",void 0),u([_s()],lR.prototype,"castShadows",void 0);let YIt=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},JIt=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this.textureWidth=4096,this._dirty=!0;const r=new Ar(this.textureWidth,1);r.samplingMode=gi.NEAREST,r.wrapMode=ar.CLAMP_TO_EDGE,this._texture=new pi(this._rctx,r),this._data=new lg(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,i,r,s,n,o){const a=e*this._fieldCount+i;this._dirty=!0,this._data.set(a,0,r),this._data.set(a,1,s),this._data.set(a,2,n),this._data.set(a,3,o)}setDataElement(e,i,r,s){const n=e*this._fieldCount+i;this._dirty=!0,this._data.set(n,r,s)}getDataElement(e,i,r){const s=e*this._fieldCount+i;return this._dirty=!0,this._data.get(s,r)}resizeToFit(e){const i=(e+1)*this._fieldCount;if(i>this._data.count){const r=Math.ceil(i/this.textureWidth)*this.textureWidth,s=new lg(new ArrayBuffer(4*r));s.typedBuffer.set(this._data.typedBuffer),this._data=s}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,i=this._texture.descriptor.height;this._data.count>e*i&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const l5e=65536;let XIt=class{constructor(e,i=1){this.textureBuffer=new JIt(e,i),this._indexManager=new YIt(l5e)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},KIt=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const r of this._buffers)if(r.availableCount>=e)return r;if(e>l5e)return null;const i=new XIt(this._rctx,this._fieldCount);return this._buffers.push(i),i}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const Mk=()=>J.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");let QIt=class{constructor(e,i){this._renderManager=e,this._viewingMode=i,this._elevationRangeCacheVerticalOffset=NaN,this._elevationRangeCacheMin=NaN,this._elevationRangeCacheMax=NaN,this._activeHighlightOptions=new Map,this._visible=new ii,this._hidden=new ii,this._renderSubmit=new kIt(this),this._renderManager.register(this._renderSubmit),this._componentBufferManager=new KIt(e.rctx,2+(Dd()?1:0))}destroy(){Zt(this._hidden.length===0&&this._visible.length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy(),this._visible.forAll(e=>e.destroy()),this._hidden.forAll(e=>e.destroy()),this._visible.clear(),this._hidden.clear()}createObject(e){const i=e.geometry,r=new KOt(this._componentBufferManager,MS(i.componentOffsets)),s=this._createRenderable(e,r),n=new TIt(this._viewingMode,i.positionData,r),o=new eIt(e.transform,e.toMapSpace,e.obb.clone(),r,s,n);return(o.visible?this._visible:this._hidden).push(o),o}destroyObject(e){const i=e;(i.visible?this._visible:this._hidden).removeUnordered(i),i.destroy(),this._notifyDirty()}setObjectVisibility(e,i){const r=e;i!==r.visible&&(i?(this._hidden.removeUnordered(r),this._visible.push(r)):(this._visible.removeUnordered(r),this._hidden.push(r)),r.visible=i,this._notifyDirty())}preSubmit(e){const i=e.camera.eye;this.visibleObjects.forAll(r=>r.renderable.meta.cameraDepthSquared=no(i,r.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,i){const r=e.renderable.material;i(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,i){const r=e;r.componentData.visibility.reset(i),r.componentData.markVisibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,i){return e.componentData.visibility.forEachComponent(i)}getComponentCount(e){const i=e,r=i.componentData.visibility.componentCount;return{visible:r,invisible:i.componentData.count-r}}setComponentData(e,i){const r=e,{renderable:s,componentData:n}=r,o=s.material,a=n.materialDataBuffer,l=n.materialDataIndices,c=new UIt,h=a.textureBuffer,d=new Uint8Array(4),f=new Uint32Array(d.buffer);let m=0,g=0,v=0,_=n.verticalOffsets,b=1/0,w=-1/0,x=!1,S=!1,C=0;for(let T=0;T<n.count;T++){i(T,c),m+=+(c.externalColor[3]<1),g+=+(c.externalColorMixMode===kn.Replace&&c.externalColor[3]===1),v+=+c.castShadows,Kdt(c.externalColor,c.externalColorMixMode,d),d[2]=254&d[2]|+c.castShadows,h.setData(l[T],0,d[0],d[1],d[2],d[3]),x||(x=T>0&&C!==f[0]),C=f[0],S||(S=c.elevationOffset!==0),S&&_==null&&(_=new Array(T).fill(0)),_!=null&&(_[T]=c.elevationOffset),b=Math.min(b,c.elevationOffset),w=Math.max(w,c.elevationOffset),apt(c.elevationOffset,d),h.setData(l[T],1,d[0],d[1],d[2],d[3]);const M=c.objectAndLayerIdColor;M!=null&&h.setData(l[T],2,M[0],M[1],M[2],M[3]),c.pickable!==bQ(n.pickability,T)&&(n.pickability=hIt(n.pickability,n.count,T,c.pickable))}n.verticalOffsets=S?_:null,r.offsetObb=S?t3e(r.obb,b,w,this._viewingMode,r.offsetObb??r.obb.clone()):null,x||S||Dd()?(o.componentParameters=new lR,o.componentParameters.castShadows=a7(v,n.count),o.componentParameters.transparent=a7(m,n.count),o.componentParameters.opaqueOverride=a7(g,n.count),o.componentParameters.texture=h,h.updateTexture()):(o.componentParameters=new RP,o.componentParameters.castShadows=c.castShadows?Ln.All:Ln.None,o.componentParameters.externalColor=c.externalColor,o.componentParameters.externalColorMixMode=c.externalColorMixMode),this._elevationRangeCacheVerticalOffset=NaN,this._notifyDirty()}getComponentAabb(e,i,r,s=!1){e.intersectionGeometry.getComponentAabb(i,r);const n=e,o=n.componentData.verticalOffsets;if(s||o==null)return r;const a=o[i];if(this._viewingMode===je.Local||a===0)return r[2]+=a,r[5]+=a,r;const l=Tfe(a);return l.localOrigin=n.transform.position,l.applyToAabb(r)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,i,r){return e.intersectionGeometry.getComponentPositions(i,r)}expandRangeWithComponentObjectElevationRange(e,i,r,s){Number.isNaN(this._elevationRangeCacheVerticalOffset)||this._elevationRangeCacheVerticalOffset!==i||s.expandElevationRangeValues(this._elevationRangeCacheMin,this._elevationRangeCacheMax);const n=e,o=n.componentData,a=o.count,l=o.verticalOffsets,c=n.intersectionGeometry,h=this._viewingMode===je.Local,d=c.getComponentAabbs(),f=tRt;let m=1/0,g=-1/0;for(let v=0;v<a;v++){const _=6*v,b=(l==null?void 0:l[v])??0;let w=1/0,x=-1/0;if(h)w=d[_+2]+b+i,x=d[_+5]+b+i;else{if(f[0]=d[_],f[1]=d[_+1],f[2]=d[_+2],f[3]=d[_+3],f[4]=d[_+4],f[5]=d[_+5],b!==0){const M=Tfe(b);M.localOrigin=n.transform.position,M.applyToAabb(f)}const S=Math.max(Math.abs(f[3]),Math.abs(f[0])),C=Math.max(Math.abs(f[4]),Math.abs(f[1])),T=i+f[5]+r;s.expandElevationRangeValues(i+f[2],Math.sqrt(S*S+C*C+T*T)-r)}s.expandElevationRangeValues(w,x),m=Math.min(m,w),g=Math.max(g,x)}this._elevationRangeCacheVerticalOffset=i,this._elevationRangeCacheMin=m,this._elevationRangeCacheMax=g}intersect(e,i,r,s,n,o,a){const l=e,{transform:c}=l,{position:h}=c;return n!=null&&(n.localOrigin=h),l.intersectionGeometry.intersect(i,r,s,n,l.componentData.verticalOffsets,c,o,a)}addEdges(e,i,r,s,n){const o=e,{indices:a,positions:l}=o.intersectionGeometry,c=o.componentData.offsets;return i.addComponentObject(o,l,a,c,r,s,n)}async extractEdgeInformation(e,i,r){const s=e,n=s.componentData.visibility;if(n.allInvisible()){const{extractComponentsEdgeLocationsLayout:m}=await G(()=>import("./edgeProcessing-CNLZuFc6.js").then(g=>g.e),__vite__mapDeps([33,32]));return{buffer:m.createBuffer(0),origin:[0,0,0]}}const{indices:o,positions:a}=s.intersectionGeometry,l=s.componentData.offsets,{EdgeInputBufferLayout:c}=await G(async()=>{const{EdgeInputBufferLayout:m}=await import("./bufferLayouts-BSMug04M.js");return{EdgeInputBufferLayout:m}},[]),h=c.createBuffer(a.length/3);zae(h.position.typedBuffer,a,h.position.typedBufferStride,3),tPe(h.position,h.position,s.transform.rotationScale),this._setComponentIndices(h.componentIndex,o,l);const d=h.count,f=this._computeVisibilityIndices(o,n,l,d);return{origin:os(s.transform.position),buffer:await i.extractComponentsEdgeLocations({indices:f,indicesLength:f.length,skipDeduplicate:!0,data:h,writerSettings:{reducedPrecision:!1,variants:0}},r)}}_setComponentIndices(e,i,r){let s=0;for(let n=0;n<r.length-1;n++){const o=r[n],a=r[n+1];for(let l=o;l<a;l++){const c=i?i[l]:l;e.set(c,s)}s++}}_computeVisibilityIndices(e,i,r,s){if(e&&i.allVisible())return e;let n=0;i.forEachComponentRange((l,c)=>(n+=r[c]-r[l],!0));const o=RD(e)?(e==null?void 0:e.BYTES_PER_ELEMENT)===2||s<=65536?new Uint16Array(n):new Uint32Array(n):new Array(n);let a=0;return i.forEachComponentRange((l,c)=>{const h=r[l],d=r[c];for(let f=h;f<d;f++)o[a++]=e?e[f]:f;return!0}),o}addComponentHighlight(e,i,r){const s=e.componentData,n=tw(s.componentHighlights,r,()=>new Uint32Array(s.count+1));{const o=this._activeHighlightOptions.get(r)??0;this._activeHighlightOptions.set(r,o+1)}n[i]++===0&&(s.markHighlightsDirty(),this._notifyDirty()),n[s.count]++}removeComponentHighlight(e,i,r){const{componentData:s}=e,n=s.componentHighlights.get(r);if(n===void 0)return void Mk().warn("Removing non-existing highlight.");const o=n[i];if(o===0)return void Mk().warn("Removing non-existing highlight.");this._removeActiveHighlight(r);const a=n[s.count];if(o>1)return n[i]=o-1,void(n[s.count]=a-1);n[i]=0,a===1?s.componentHighlights.delete(r):n[s.count]=a-1,s.markHighlightsDirty(),this._notifyDirty()}_removeActiveHighlight(e,i=1){const r=this._activeHighlightOptions.get(e);if(r===void 0)Mk().warn("Removing non-existing highlight.");else{const s=r-i;s<0&&Mk().warn("Removing non-existing highlight."),s<=0?this._activeHighlightOptions.delete(e):this._activeHighlightOptions.set(e,s)}}clearHighlights(e){const{componentData:i}=e,{componentHighlights:r}=i;if(r.size>0){for(const s of r)this._removeActiveHighlight(s[0],s[1][i.count]);r.clear(),i.markHighlightsDirty(),this._notifyDirty()}}hasHighlightOptions(e){return this._activeHighlightOptions.has(e)}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._visible}_createRenderable(e,i){const r=this._renderManager.rctx,s=e.geometry,n=s.vertices.layoutParameters,o=jn.createVertex(r,Js.STATIC_DRAW,s.vertices.data),a=s.indices?jn.createIndex(r,Js.STATIC_DRAW,s.indices):null,l=Jv(zIt(n)),c=new Uint16Array(s.vertices.count);for(let v=0;v<i.count;v++){const _=i.offsets[v],b=i.offsets[v+1],w=i.materialDataIndices[v];if(s.indices!=null)for(let x=_;x<b;x++)c[s.indices[x]]=w;else for(let x=_;x<b;x++)c[x]=w}const h=jn.createVertex(r,Js.STATIC_DRAW,c.buffer),d=new uo(e.transform,e.toMapSpace),f=new IL(r,o5e,new Map([["data",l],["componentIndices",eRt]]),new Map([["data",o],["componentIndices",h]]),a),m=new IIt(f,Gi.TRIANGLES,n,a!=null),g={cameraDepthSquared:.5,gpuMemoryEstimate:o.usedMemory+h.usedMemory+(a!=null?a.usedMemory:0)};return new OIt(d,m,g)}_notifyDirty(){this._renderManager.notifyDirty()}};const eRt=Jv(Bd().u16(z.COMPONENTINDEX));function a7(t,e){return t===e?Ln.All:t===0?Ln.None:Ln.Some}const tRt=fh();let iRt=class{constructor(e,i,r,s,n){this.rctx=e,this.viewingMode=i,this.stippleTextures=r,this.waterTextures=s,this.markerTextures=n}get spherical(){return this.viewingMode===je.Global}get doublePrecisionRequiresObfuscation(){return this.rctx.driverTest.doublePrecisionRequiresObfuscation.result}},rRt=class{constructor(e){this.context=e,this._debug=!1,this._precompiling=this._debug?0:1,this._cache=new Ov}get precompiling(){return this._precompiling}set precompiling(e){this._precompiling=e,e===0&&this.context.rctx.gl.flush()}get viewingMode(){return this.context.viewingMode}destroy(){this._cache.forAll(e=>e.destroy()),this._cache.clear()}precompile(e,i=N_e){++this.precompiling,this.get(e,i),--this.precompiling}get(e,i=N_e){const r=i.key.code;let s=this._cache.get(e,r);if(s==null){if(this._precompiling===0){let n=`Uncached shader compile in ${new Error().stack}
  for configuration
${i.decode()}`;const o=this._cache.getInner(e);throw o!=null&&o.size&&(n+=`

  cached configurations:
`,n+=Array.from(o.values()).map(a=>i.decode(a.key)).sort().join(`

`)),console.log(n),new U(n)}s=new e(this.context,i),this._cache.set(e,r,s)}return s}async reloadAll(){const e=new Array;this._cache.forEach(i=>e.push(sRt(i))),await Promise.all(e)}};async function sRt(t){let e=!0;t.forEach(async i=>{await i.reload(e),e=!1})}const N_e=new hu;let cR=class extends Af{constructor(e){super(e),this.consumes={required:["olid"]},this.produces="olid"}destroy(){}render(e){const i=e.find(({name:s})=>s==="olid"),r=this.renderingContext;return r.bindFramebuffer(i.fbo),r.clearFramebuffer(an,!0,!0),this.view._stage.renderer.renderAllGeometry(Y.ObjectAndLayerIdColor),r.clear(Mi.DEPTH|Mi.STENCIL),this.view._stage.renderer.renderHUD(fa.NotOccluded),i}};u([p()],cR.prototype,"consumes",void 0),u([p()],cR.prototype,"produces",void 0),cR=u([A("esri.views.3d.webgl-engine.effects.geometry.ObjectAndLayerIDRenderNode")],cR);var _a;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.Depth=3]="Depth",t[t.COUNT=4]="COUNT"})(_a||(_a={}));let mV=class extends hu{constructor(){super(...arguments),this.blitMode=_a.None,this.hasOpacityFactor=!1}};u([ie({count:_a.COUNT})],mV.prototype,"blitMode",void 0),u([ie()],mV.prototype,"hasOpacityFactor",void 0);let J6=class extends cr{constructor(){super(...arguments),this.opacity=1}};function c5e(t){const e=new Vi;e.include(ia),e.fragment.uniforms.add(new It("tex",r=>r.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new mt("opacity",r=>r.opacity));const i=t.blitMode===_a.Depth;return i&&(e.fragment.uniforms.add(new $v("nearFar",r=>r.camera.nearFar)),e.fragment.include(Sg),e.fragment.include(uw)),e.fragment.main.add(E`
    ${i?E`
          float normalizedLinearDepth = (-linearDepthFromTexture(tex, uv) - nearFar[0]) / (nearFar[1] - nearFar[0]);
          fragColor = float2rgba(normalizedLinearDepth);`:E`
          fragColor = texture(tex, uv) ${t.hasOpacityFactor?"* opacity":""};`}`),e}const nRt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:J6,build:c5e},Symbol.toStringTag,{value:"Module"}));let Z_=class extends Hi{constructor(e,i){super(e,i,new Bi(nRt,()=>G(()=>Promise.resolve().then(()=>gHt),void 0)))}initializePipeline(e){switch(e.blitMode){case _a.None:case _a.Depth:return wi({colorWrite:Di});case _a.Alpha:return wi({blending:Ld,colorWrite:Di});default:e.blitMode;case _a.PremultipliedAlpha:case _a.COUNT:return wi({blending:gM,colorWrite:Di})}}},u5e=class{constructor(e,i=_a.None){this._techniques=e,this._parameters=new J6,this._configuration=new mV,this._configuration.blitMode=i,e.precompile(Z_,this._configuration)}blit(e,i,r,s){e.bindFramebuffer(r.fbo),e.setClearColor(0,0,0,1),e.clear(Mi.COLOR),this._parameters.texture=i.getTexture();const n=this._techniques.get(Z_,this._configuration);e.bindTechnique(n,s,this._parameters),e.screen.draw()}blend(e,i,r,s,n=1){this._configuration.hasOpacityFactor=n<1;const o=this._techniques.get(Z_,this._configuration);return!!o.compiled&&(e.bindFramebuffer(r.fbo),this._parameters.texture=i.getTexture(),this._parameters.opacity=n,e.bindTechnique(o,s,this._parameters),e.screen.draw(),!0)}},uR=class extends Af{constructor(e){super(e),this.consumes={required:[dt.OCCLUDED]},this.produces=dt.OCCLUDED,this._blit=new u5e(e.view._stage.renderView.techniques,_a.PremultipliedAlpha)}precompile(){const e=this.view._stage.renderer;e.plugins.plugins.forAll(i=>{e.precompileSlots(i,xe.OCCLUDED_TERRAIN,xe.TRANSPARENT_OCCLUDER_MATERIAL),i.material&&e.precompileOccludedSlots(i,F_e)})}render(e){const i=e.find(({name:n})=>n===this.produces),r=this.view._stage.renderer;let s=0;if(Hg.clear(),r.plugins.plugins.forAll(n=>{n.material&&n.queryRenderOccludedState(Cr.OccludeAndTransparentStencil)&&(s|=Cr.OccludeAndTransparentStencil,Hg.push(n))}),Hg.length>0&&(r.renderSlots(Hg,xe.OCCLUDER_MATERIAL),s&Cr.OccludeAndTransparentStencil&&this._renderAndComposite(i,.5,()=>r.renderSlots(Hg,xe.TRANSPARENT_OCCLUDER_MATERIAL),!1,!1)),Hg.clear(),r.plugins.plugins.forAll(n=>{if(!n.material)return;const o=n.queryRenderOccludedState(Cr.OccludeAndTransparent),a=n.queryRenderOccludedState(Cr.Transparent),l=n.queryRenderOccludedState(Cr.Opaque);(o||a||l)&&(s|=o?Cr.OccludeAndTransparent:a?Cr.Transparent:Cr.Opaque,Hg.push(n))}),s|=r.plugins.renderOccludedFlags,!s)return i;for(const n of F_e)s&n&&this._renderAndComposite(i,n===Cr.Opaque?1:.5,()=>r.renderOccludedSlots(Hg,n),!0,hh.OutlineVisualElementMask);return Hg.clear(),i}_renderAndComposite(e,i,r,s,n){const o=this.renderingContext,{width:a,height:l}=e.fbo,c=this.fboCache.acquire(a,l,"tmp color"),h=s?this.fboCache.acquireDepth(Ho.DEPTH_STENCIL_TEXTURE,a,l,"tmp depth"):e.getAttachment(CS);c.attachDepth(h),o.bindFramebuffer(c.fbo),o.clearFramebuffer(an,s,n),r(),c.detachDepth(),this._blit.blend(o,c,e,this.bindParameters,i),s&&h.release(),c.release()}};u([p()],uR.prototype,"consumes",void 0),u([p()],uR.prototype,"produces",void 0),uR=u([A("esri.views.3d.webgl-engine.effects.geometry.RenderOccludedRenderNode")],uR);const Hg=new ii,F_e=[Cr.OccludeAndTransparent,Cr.Transparent,Cr.Opaque];let Bae=class extends cr{};function h5e(){const t=new Vi;return t.include(ia),t.fragment.uniforms.add(new It("colorTexture",e=>e.color),new oo("depthTexture",e=>e.mainDepth)),t.fragment.main.add(E`float depthSample = texture(depthTexture, uv).r;
if (depthSample == 1.0 ) {
fragColor = vec4(0);
return;
}
fragColor = texture(colorTexture, uv);`),t}const oRt=Object.freeze(Object.defineProperty({__proto__:null,HazeCompositingPassParameters:Bae,build:h5e},Symbol.toStringTag,{value:"Module"}));let k_e=class extends Hi{constructor(e,i){super(e,i,new Bi(oRt,()=>G(()=>Promise.resolve().then(()=>yHt),void 0)))}initializePipeline(){return wi({blending:hw(Bt.ONE,Bt.ZERO,Bt.ONE_MINUS_SRC_COLOR,Bt.ONE),depthTest:{func:Ui.ALWAYS},colorWrite:Di})}};function d5e(t){const e=new Vi,{fragment:i}=e;e.include(Z6),cg(i),e.include(ML),i.include(Sg),i.include(R6),i.include(A6),i.include(Z4e,!0),i.uniforms.add(new oo("depthTexture",s=>s.mainDepth),new mt("hazeStrength",s=>s.hazeStrength));const{reduced:r}=t;return r&&i.code.add(E`float getDepth(vec2 uv){
return linearDepthFromTexture(depthTexture, uv);
}
float textureBilinear(vec2 uv) {
vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
vec2 texelSize = 1.0 / depthTextureSize;
vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);
vec2 f = fract(depthUV);
vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;
float d0 = getDepth(snapUV);
float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
float d3 = getDepth(snapUV + texelSize);
return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
}`),i.main.add(E`
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture(depthTexture, uv).r;
      if (depthSample != 1.0) {
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;

        cameraSpaceRay *= ${Te(r,"-textureBilinear(uv)","-linearDepthFromTexture(depthTexture, uv)")};
        terrainDepth = max(0.0, length(cameraSpaceRay));
      } else {
        discard;
      }

      // Alpha is ignored for haze blending
      vec3 col = vec3(0);
      float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
      if(depthSample != 1.0){
        col = (1.0 - fadeOut) * hazeStrength * raymarchAtmosphere(cameraPosition, rayDir, mainLightDirection, terrainDepth);
      }
      float alpha = 1.0;

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
  `),e}const aRt=Object.freeze(Object.defineProperty({__proto__:null,build:d5e},Symbol.toStringTag,{value:"Module"}));let lRt=class extends W4e{constructor(){super(...arguments),this.hazeStrength=1}},l7=class extends Hi{constructor(e,i){super(e,i,new Bi(aRt,()=>G(()=>Promise.resolve().then(()=>vHt),void 0)))}initializePipeline(e){return e.reduced?wi({blending:Lne,depthTest:{func:Ui.ALWAYS},colorWrite:Di}):wi({blending:hw(Bt.ONE,Bt.ZERO,Bt.ONE_MINUS_SRC_COLOR,Bt.ONE),colorWrite:Di})}},dz=class extends hu{constructor(){super(...arguments),this.reduced=!1}};u([ie()],dz.prototype,"reduced",void 0);let wQ=class extends IP{constructor(e){super(e),this._compositingPassParameters=new Bae,this._passParameters=new lRt,this._hazeConfiguration=new dz,this._vao=null,this.requireGeometryDepth=!0,this._oldAmount=1,this._newAmount=1,this._amount=this._newAmount;const i=e.view._stage.renderView.techniques;i.precompile(l7,new dz);const r=new dz;r.reduced=!0,i.precompile(l7,r),i.precompile(k_e)}initialize(){this.addHandles([H(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),Mt),H(()=>{var e;return((e=this.view._stage)==null?void 0:e.renderer.renderContext.bind.clouds.fadeFactor)??1},e=>this._fade(e),Mt),H(()=>this.view.environment.weather.type,e=>this._newAmount=e==="rainy"?0:1,Mt),H(()=>{var e;return(e=this.view._stage.renderer)==null?void 0:e.fullResolutionAtmosphere},e=>this._hazeConfiguration.reduced=!e,Mt)])}_fade(e){e>=1?(this._amount=this._newAmount,this._oldAmount=this._newAmount):this._amount=e<=0?this._oldAmount:ft(this._oldAmount,this._newAmount,e)}destroy(){this._vao=Dt(this._vao)}render(e){const i=e.find(({name:v})=>v===dt.TRANSPARENT_ENVIRONMENT);if(!this.bindParameters.mainDepth)return i;const r=this.renderingContext;this._vao??(this._vao=mw(r,hg.Pos2Tex));const s=this.techniques.get(l7,this._hazeConfiguration);if(!s.compiled)return i;const n=i.getAttachment(r.gl.DEPTH_STENCIL_ATTACHMENT);if(this._update(),!this._hazeConfiguration.reduced)return i.detachDepth(),r.bindFramebuffer(i.fbo),r.bindTechnique(s,this.bindParameters,this._passParameters),this._renderCommon(r),i.attachDepth(n),i;const o=this.techniques.get(k_e);if(!o.compiled)return i;const a=r.getViewport(),l=this.camera,c=Ee(l.eye)-Ci.radius;let h;const d=Ci.atmosphereHeight;if(c<d){const v=Math.min(1,Math.max(0,c/d));h=ft(.4,.5,v)}else{const v=Math.min(1,Math.max(0,(c-d)/(15*d)));h=ft(.5,1,v)}const f=cv(Math.round(h*l.fullViewport[2])),m=cv(Math.round(h*l.fullViewport[3]));r.setViewport(0,0,f,m);const g=this.fboCache.acquire(f,m,"haze",gr.RGBA);return r.bindFramebuffer(g.fbo),r.clearFramebuffer([0,0,0,1],!0,!0),r.bindTechnique(s,this.bindParameters,this._passParameters),this._renderCommon(r),r.setViewport(a.x,a.y,a.width,a.height),this._compositingPassParameters.color=g.getTexture(),i.detachDepth(),r.bindFramebuffer(i.fbo),r.bindTechnique(o,this.bindParameters,this._compositingPassParameters),r.screen.draw(),i.attachDepth(n),g.release(),i}_renderCommon(e){this._vao!=null&&(e.bindVAO(this._vao),e.drawArrays(Gi.TRIANGLE_STRIP,0,4))}_update(){var a;const e=this.bindParameters.camera,i=Xo(e.eye),r=Math.sqrt(i),s=i-this._passParameters.radii[1]*this._passParameters.radii[1],n=ue((r-this._passParameters.radii[0])/Ci.atmosphereHeight,0,1);ss(this._passParameters.heightParameters,r,i,s,n);const o=((a=this.view.basemapTerrain)==null?void 0:a.getLowerBoundRadius())??0;di(this._passParameters.radii,o,o+Ci.atmosphereHeight),this._passParameters.hazeStrength=ft(ft(.6,1,h3(9500,10500,r-Ci.radius)),1,this._amount)}};wQ=u([A("esri.views.3d.webgl-engine.effects.haze.Haze")],wQ);function cRt(t){const e=t.fragment;t.include(x6),e.include(Sg),e.code.add(E`vec3 normalFromDepth(sampler2D depthMap, vec3 pixelPos, vec2 fragCoord, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthMap, 0)));
float leftPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(-1, 0), 0).r);
float rightPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(1, 0), 0).r);
float bottomPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(0, -1), 0).r);
float topPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(0, 1), 0).r);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`)}let Vae=class extends hu{constructor(){super(...arguments),this.receiveShadows=!0}};u([ie()],Vae.prototype,"receiveShadows",void 0);const uRt=.025;function p5e(){const t=new Vi;t.include($L,hRt),t.include(ia),t.include(cRt);const e=t.fragment;return e.include(uw),e.uniforms.add(new oo("defaultDepthTex",i=>i.shadowMap.getSnapshot(DS.ExcludeHighlight)),new oo("highlightDepthTex",i=>i.shadowMap.getSnapshot(DS.Highlight)),new oo("depthMap",i=>{var r;return(r=i.depth)==null?void 0:r.attachment}),new It("highlightTexture",i=>i.highlight),new pc("uColor",i=>i.shadowColor),new mt("opacity",i=>i.shadowOpacity),new mt("occludedOpacity",i=>i.occludedShadowOpacity),new mt("terminationFactor",i=>i.opacityElevation*i.dayNightTerminator),new Ka("lightingMainDirectionView",({lighting:i,camera:r})=>ae(U_e,ot(U_e,i.mainLight.direction,r.viewInverseTransposeMatrix))),new $o("inverseViewMatrix",({camera:i})=>$l(z_e,uh(z_e,i.viewMatrix,i.center)))).main.add(E`
    ivec2 highlightTextureSize = textureSize(highlightTexture, 0);
    ivec2 highlightIUV = ivec2(uv * vec2(highlightTextureSize));
    vec4 highlightInfo = texelFetch(highlightTexture, highlightIUV, 0);

    fragColor = vec4(0.0);

    // Calculate bit mask to check if pixel is highlit unoccluded at any level
    int ored =
         (int(highlightInfo.r*255.0) << 0)
       | (int(highlightInfo.g*255.0) << 8);
    bool visiblyHighlighted = ((ored & ~(ored >> 1)) & (1+4+16+64)) != 0;
    if (visiblyHighlighted) {
      return;
    }

    // 1.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
    float depth = depthFromTexture(depthMap, uv);
    if (depth >= 1.0 || depth <= 0.0) {
      return;
    }

    float currentPixelDepth = linearizeDepth(depth);
    vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
    vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;

    mat4 shadowMatrix;
    float linearDepth = -currentPixelDepth;
    int i = chooseCascade(linearDepth, shadowMatrix);
    if (i >= numCascades) {
      return;
    }

    // vertex completely outside? -> no shadow
    vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
    if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
      return;
    }

    ivec2 texSize = textureSize(highlightDepthTex, 0);
    ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));

    float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
    bool shadowHighlight = depthHighlight < lvpos.z;
    if (!shadowHighlight) {
      return;
    }

    float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
    bool shadowDefault = depthDefault < lvpos.z;

    vec3 normal = normalFromDepth(depthMap, currentPixelPos.xyz, gl_FragCoord.xy, uv);
    bool shaded = dot(normal, lightingMainDirectionView) < ${E.float(uRt)};

    float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
    fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
  `),t}const z_e=qe(),U_e=$(),hRt=new Vae,dRt=Object.freeze(Object.defineProperty({__proto__:null,build:p5e},Symbol.toStringTag,{value:"Module"}));let pRt=class extends roe{constructor(){super(...arguments),this.shadowColor=Yi(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},B_e=class extends Hi{constructor(e,i){super(e,i,new Bi(dRt,()=>G(()=>Promise.resolve().then(()=>_Ht),void 0))),this.primitiveType=Gi.TRIANGLE_STRIP}initializePipeline(){return wi({blending:Ld,colorWrite:Di,depthTest:null,depthWrite:null})}};const fRt=1/512,mRt=4e4,gRt=5e4;let m2=class extends Af{constructor(e){super(e),this.produces=rr.COMPOSITE,this.consumes={required:[rr.COMPOSITE,"highlights"]},this._passParameters=new pRt,this._maxOpacity=1,this._shadowDifference=.2}initialize(){this.addHandles([H(()=>this.view.highlightOptions.shadowOpacity,e=>{this._passParameters.shadowOpacity=e??mMe,this._updateOccludedShadowOpacity(),this._ensureMaxOpacity()},Mt),H(()=>this.view.highlightOptions.shadowDifference,e=>{this._shadowDifference=e??gMe,this._updateOccludedShadowOpacity(),this._ensureMaxOpacity()},Mt),H(()=>this.view.highlightOptions.shadowColor,e=>{this._passParameters.shadowColor=Dae(e??fMe),this._ensureMaxOpacity()},Mt)])}_updateOccludedShadowOpacity(){this._passParameters.occludedShadowOpacity=this._passParameters.shadowOpacity*(1-this._shadowDifference)}_ensureMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3],this.requestRender($t.UPDATE)}precompile(){this.techniques.precompile(B_e)}render(e){var n;const i=e.find(({name:o})=>o===rr.COMPOSITE),r=this.bindParameters;if(!r.shadowHighlightsVisible||!r.depth||!this._ensureIfVisible(r.camera,r.lighting.mainLight.direction))return i;const s=this.techniques.get(B_e);if(s.compiled){this._passParameters.highlight=(n=e.find(({name:a})=>a==="highlights"))==null?void 0:n.getTexture(),this._passParameters.origin=r.camera.center;const o=this.renderingContext;o.bindFramebuffer(i.fbo),o.bindTechnique(s,r,this._passParameters),o.screen.draw()}else this.requestRender($t.UPDATE);return i}_ensureIfVisible(e,i){this._passParameters.opacityElevation=1-h3(mRt,gRt,e.relativeElevation);const r=this.viewingMode===je.Global?ae(V_e,e.center):se(V_e,0,0,1),s=fe(r,i);return this._passParameters.dayNightTerminator=h3(0,1,ue(30*s,0,1)),this._maxOpacity*this._passParameters.opacityElevation*this._passParameters.dayNightTerminator>=fRt}};u([p()],m2.prototype,"produces",void 0),u([p()],m2.prototype,"consumes",void 0),u([p({constructOnly:!0})],m2.prototype,"viewingMode",void 0),m2=u([A("esri.views.3d.webgl-engine.effects.highlight.ShadowHighlight")],m2);const V_e=$();let jae=class extends cr{constructor(){super(...arguments),this.mask=null,this.overlay=null,this.input=null,this.size=0}};function f5e(){const t=new Vi;return t.attributes.add(z.POSITION,"vec2"),t.vertex.uniforms.add(new pc("drawPosition",(e,i)=>yRt(e,i))),t.varyings.add("vUV","vec2"),t.vertex.main.add(E`vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);`),t.fragment.uniforms.add(new It("textureInput",e=>e.input)),t.fragment.uniforms.add(new It("textureMask",e=>e.mask)),t.fragment.uniforms.add(new It("textureOverlay",e=>e.overlay)),t.fragment.uniforms.add(new uD("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new uD("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(E`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}`),t.fragment.main.add(E`float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;`),t}function yRt(t,e){const i=e.camera.pixelRatio,r=t.magnifier.offset.x*i,s=t.magnifier.offset.y*i;Yp(t.magnifier.position,j_e);const n=e.camera.screenToRender(j_e,vRt),o=Math.ceil(i*t.magnifier.size),{fullWidth:a,fullHeight:l}=e.camera;return ss(_Rt,(n[0]+r)/a*2-1,(n[1]-s)/l*2-1,o/a*2,o/l*2)}const j_e=ln(),vRt=f$e(),_Rt=yi(),bRt=Object.freeze(Object.defineProperty({__proto__:null,MagnifierPassParameters:jae,build:f5e},Symbol.toStringTag,{value:"Module"}));let G_e=class extends Hi{constructor(e,i){super(e,i,new Bi(bRt,()=>G(()=>Promise.resolve().then(()=>bHt),void 0)))}initializePipeline(){return wi({blending:gM,depthTest:null,depthWrite:null,colorWrite:Di})}};async function wRt(t){const e=G(()=>import("./mask-svg-cNit2NTT.js"),[]),i=G(()=>import("./overlay-svg-DioSRl-7.js"),[]),r=Iv((await e).default,{signal:t}),s=Iv((await i).default,{signal:t}),n={mask:await r,overlay:await s};return gt(t),n}let q1=class extends Af{constructor(){super(...arguments),this.produces=dt.MAGNIFIER,this.consumes={required:[dt.MAGNIFIER]},this._imageSources=null,this._imageLoadTask=null,this._passParameters=new jae,this._vao=null,this._magnifier=null,this._tmpScreenPoint=ln(),this._tmpRenderPoint=f$e()}initialize(){this.addHandles([H(()=>this.view.magnifier,e=>this._update(e),Mt)])}_update(e){if(e===this._magnifier)return;this.removeAllHandles(),this._magnifier=e;const i=()=>{const r=this._validMagnifier;r?(this._loadResources(r),this.produces=dt.MAGNIFIER):this.produces="disabled",this.requestRender()};this._magnifier&&this.addHandles(H(()=>{var r;return(r=this._magnifier)==null?void 0:r.version},i)),i()}get _validMagnifier(){var e,i,r;return(e=this._magnifier)!=null&&e.visible&&((i=this._magnifier)!=null&&i.position)&&((r=this._magnifier)==null?void 0:r.size)>0?this._magnifier:null}get _factor(){var e;return((e=this._magnifier)==null?void 0:e.factor)||1}destroy(){this._magnifier=null,this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeTextures(),this._vao=Dt(this._vao)}_disposeTextures(){this._passParameters.mask=Dt(this._passParameters.mask),this._passParameters.overlay=Dt(this._passParameters.overlay),this._passParameters.input=Dt(this._passParameters.input)}precompile(){this._imageSources&&this.techniques.precompile(G_e)}render(e){const i=this._validMagnifier,r=e.find(({name:b})=>b===dt.MAGNIFIER);if(i==null)return r;if(this._imageSources==null)return this.requestRender($t.UPDATE),r;const s=this.renderingContext,n=this.camera.pixelRatio,o=Math.ceil(n*i.size);this._vao??(this._vao=mw(s,hg.Pos2,bg,0,1));const a=this.techniques.get(G_e);if(this._ensureTextureResources(s,o),!a.compiled||!this._passParameters.input)return this.requestRender($t.UPDATE),r;const l=Math.ceil(1/this._factor*o),c=this._passParameters.input;c.resize(l,l),Yp(i.position,this._tmpScreenPoint);const h=this.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),d=this.camera.fullWidth,f=this.camera.fullHeight,m=.5*l,g=.5*l;h[0]=ue(h[0],m,d-m-1),h[1]=ue(h[1],g,f-g-1);const v=Math.floor(h[0]-m),_=Math.floor(h[1]-g);return s.bindFramebuffer(r.fbo),a.program.bindTexture("textureInput",c),s.gl.copyTexImage2D(c.descriptor.target,0,c.descriptor.pixelFormat,v,_,l,l,0),this._passParameters.magnifier=i,s.bindTechnique(a,this.bindParameters,this._passParameters),s.bindVAO(this._vao),s.drawArrays(Gi.TRIANGLE_STRIP,0,4),r}_loadResources(e){var s,n,o;const{maskUrl:i,overlayUrl:r}=e;((s=this._imageLoadTask)==null?void 0:s.maskUrl)===i&&((n=this._imageLoadTask)==null?void 0:n.overlayUrl)===r||((o=this._imageLoadTask)==null||o.task.abort(),this._imageLoadTask=this._imageSources=null),this._imageSources||this._imageLoadTask||(this._imageLoadTask={maskUrl:i,overlayUrl:r,task:gg(async a=>{const l=i==null||r==null?wRt(a):null,c=i!=null?Iv(i,{signal:a}):l.then(d=>d.mask),h=r!=null?Iv(r,{signal:a}):l.then(d=>d.overlay);this._imageSources={mask:await c,overlay:await h}})})}_ensureTextureResources(e,i){if(this._imageSources==null||this._passParameters.size===i&&this._passParameters.input&&this._passParameters.mask&&this._passParameters.overlay)return;this._disposeTextures(),this._imageSources.overlay.width=this._imageSources.mask.width=i,this._imageSources.overlay.height=this._imageSources.mask.height=i;const r=new Ar;r.internalFormat=Tt.RGBA,r.wrapMode=ar.CLAMP_TO_EDGE,r.flipped=!0,r.preMultiplyAlpha=!ATe(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result,this._passParameters.overlay=new pi(e,r,this._imageSources.overlay),r.pixelFormat=r.internalFormat=Tt.ALPHA,r.preMultiplyAlpha=!1,this._passParameters.mask=new pi(e,r,this._imageSources.mask),r.pixelFormat=r.internalFormat=Tt.RGBA,r.flipped=!1,this._passParameters.input=new pi(e,r)}};u([p()],q1.prototype,"produces",void 0),u([p()],q1.prototype,"consumes",void 0),u([p()],q1.prototype,"_imageSources",void 0),u([p()],q1.prototype,"_imageLoadTask",void 0),q1=u([A("esri.views.3d.webgl-engine.effects.magnifier.Magnifier")],q1);const DO=8,xRt=16;function m5e(){const t=new Vi;t.include(ia),t.fragment.uniforms.add(new It("edgesTexture",i=>i.inputTexture),new It("areaTexture",i=>i.areaTexture),new It("searchTexture",i=>i.searchTexture)),t.fragment.constants.add("smaaAreaTexPixelSize","vec2",[1/160,1/560]);const e=1/7;return t.fragment.code.add(E`
    vec4 sampleLevelZeroOffset(vec2 coord, vec2 offset, vec2 resolution) {
      return texture(edgesTexture, coord + offset.x * resolution);
    }

    float searchLength(vec2 e, float bias, float scale) {
      e.r = bias + e.r * scale;
      return 255.0 * texture(searchTexture, e).r;
    }

    float searchLeft(vec2 texcoord, float end, vec2 resolution) {
      vec2 e = vec2(0.0, 1.0);
      for (int i = 0; i < ${E.int(DO)}; ++i) {
        e = texture(edgesTexture, texcoord).rg;
        texcoord -= vec2(2.0, 0.0) * resolution;
        if (! (texcoord.x > end && e.g > 0.8281 && e.r == 0.0)) break;
      }
      texcoord.x += 0.25 * resolution.x;
      texcoord.x += resolution.x;
      texcoord.x += 2.0 * resolution.x;
      texcoord.x -= resolution.x * searchLength(e, 0.0, 0.5);
      return texcoord.x;
    }

    float searchRight(vec2 texcoord, float end, vec2 resolution) {
      vec2 e = vec2(0.0, 1.0);
      for (int i = 0; i < ${E.int(DO)}; ++i) {
        e = texture(edgesTexture, texcoord).rg;
        texcoord += vec2(2.0, 0.0) * resolution;
        if (! (texcoord.x < end && e.g > 0.8281 && e.r == 0.0)) break;
      }
      texcoord.x -= 0.25 * resolution.x;
      texcoord.x -= resolution.x;
      texcoord.x -= 2.0 * resolution.x;
      texcoord.x += resolution.x * searchLength(e, 0.5, 0.5);
      return texcoord.x;
    }

    float searchUp(vec2 texcoord, float end, vec2 resolution) {
      vec2 e = vec2(1.0, 0.0);
      for (int i = 0; i < ${E.int(DO)}; ++i) {
        e = texture(edgesTexture, texcoord).rg;
        texcoord += vec2(0.0, 2.0) * resolution;
        if (! (texcoord.y > end && e.r > 0.8281 && e.g == 0.0)) break;
      }
      texcoord.y -= 0.25 * resolution.y;
      texcoord.y -= resolution.y;
      texcoord.y -= 2.0 * resolution.y;
      texcoord.y += resolution.y * searchLength(e.gr, 0.0, 0.5);
      return texcoord.y;
    }

    float searchDown(vec2 texcoord, float end, vec2 resolution) {
      vec2 e = vec2(1.0, 0.0);
      for (int i = 0; i < ${E.int(DO)}; ++i) {
        e = texture(edgesTexture, texcoord).rg;
        texcoord -= vec2(0.0, 2.0) * resolution;
        if (! (texcoord.y < end && e.r > 0.8281 && e.g == 0.0)) break;
      }
      texcoord.y += 0.25 * resolution.y;
      texcoord.y += resolution.y;
      texcoord.y += 2.0 * resolution.y;
      texcoord.y -= resolution.y * searchLength(e.gr, 0.5, 0.5);
      return texcoord.y;
    }

    vec2 getArea(sampler2D areaTex, vec2 dist, float e1, float e2, float offset) {
      vec2 texcoord = float(${E.int(xRt)}) * round(4.0 * vec2(e1, e2)) + dist;
      texcoord = smaaAreaTexPixelSize * texcoord + (0.5 * smaaAreaTexPixelSize);
      texcoord.y += ${E.float(e)} * offset;
      return texture(areaTex, texcoord).rg;
    }`),t.fragment.main.add(E`
    vec2 size = vec2(textureSize(edgesTexture, 0));
    vec2 resolution = 1.0 / size;
    vec2 pixelCoord = uv * size;
    vec4 offsets[2];
    offsets[0] = uv.xyxy + resolution.xyxy * vec4(-0.25, 0.125, 1.25, 0.125);
    offsets[1] = uv.xyxy + resolution.xyxy * vec4(-0.125, 0.25, -0.125, -1.25);
    vec4 maxOffset = vec4(offsets[0].xz, offsets[1].yw) + vec4(-2.0, 2.0, -2.0, 2.0) * resolution.xxyy * float(${E.int(DO)});
    ivec4 subsampleIndices = ivec4(0.0);
    vec4 weights = vec4(0.0);
    vec2 e = texture(edgesTexture, uv).rg;
    if (e.r > 0.0) {
      vec2 d;
      vec2 coords;
      coords.y = searchUp(offsets[1].xy, maxOffset.z, resolution);
      coords.x = offsets[0].x;
      d.x = coords.y;
      float e1 = texture(edgesTexture, coords).g;
      coords.y = searchDown(offsets[1].zw, maxOffset.w, resolution);
      d.y = coords.y;
      d = d * size.y - pixelCoord.y;
      vec2 sqrt_d = sqrt(abs(d));
      coords.y -= 1.0 * resolution.y;
      float e2 = sampleLevelZeroOffset(coords, vec2(0.0, 1.0), resolution).g;
      weights.ba = getArea(areaTexture, sqrt_d, e1, e2, float(subsampleIndices.x));
      // for some reason the following lines are necessary to prevent
      // texture lookup precision issues on some Intel integrated graphics chips
      vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
      weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
    }
    if (e.g > 0.0) {
      vec2 d;
      vec2 coords;
      coords.x = searchLeft(offsets[0].xy, maxOffset.x, resolution);
      coords.y = offsets[1].y;
      d.x = coords.x;
      float e1 = texture(edgesTexture, coords).r;
      coords.x = searchRight(offsets[0].zw, maxOffset.y, resolution);
      d.y = coords.x;
      d = d * size.x - pixelCoord.x;
      vec2 sqrt_d = sqrt(abs(d));
      coords.y -= 1.0 * resolution.y;
      float e2 = sampleLevelZeroOffset(coords, vec2(1.0, 0.0), resolution).r;
      weights.rg = getArea(areaTexture, sqrt_d, e1, e2, float(subsampleIndices.y));
    }
    fragColor = weights;
  `),t}const SRt=Object.freeze(Object.defineProperty({__proto__:null,build:m5e},Symbol.toStringTag,{value:"Module"}));let H_e=class extends Hi{constructor(e,i){super(e,i,new Bi(SRt,()=>G(()=>Promise.resolve().then(()=>wHt),void 0)))}initializePipeline(){return wi({colorWrite:Di})}};function g5e(){const t=new Vi;return t.include(ia),t.fragment.uniforms.add(new It("blendWeightsTexture",e=>e.inputTexture),new It("colorTexture",e=>e.color)),t.fragment.main.add(E`vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
vec4 offsets = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets.zw).g;
a.a = texture(blendWeightsTexture, offsets.xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}`),t}const TRt=Object.freeze(Object.defineProperty({__proto__:null,build:g5e},Symbol.toStringTag,{value:"Module"}));let q_e=class extends Hi{constructor(e,i){super(e,i,new Bi(TRt,()=>G(()=>Promise.resolve().then(()=>xHt),void 0)))}initializePipeline(){return wi({colorWrite:Di})}};const ERt=.05,CRt=2;function y5e(){const t=new Vi;return t.include(ia),t.outputs.add("fragEdges","vec2"),t.fragment.code.add(E`float absMax3(vec3 v) {
vec3 t = abs(v);
return max(max(t.r, t.g), t.b);
}`),t.fragment.uniforms.add(new It("colorTexture",e=>e.color)).main.add(E`
    vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
    vec4 offsets[3];
    offsets[0] = vec4(uv.x - resolution.x, uv.y, uv.x, uv.y + resolution.y);
    offsets[1] = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
    offsets[2] = vec4(uv.x - 2.0 * resolution.x, uv.y, uv.x, uv.y + 2.0 * resolution.y);

    // Calculate color deltas:
    vec3 C = texture(colorTexture, uv).rgb;
    vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
    vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
    vec2 delta = vec2(absMax3(C - Cleft), absMax3(C - Ctop));
    vec2 edges = step(vec2(${E.float(ERt)}), delta);

    // discard if there is no edge:
    if (dot(edges, vec2(1.0)) == 0.0) {
      fragEdges = vec2(0.0);
    }
    else {
      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      float horizontal = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      float vertical = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), horizontal), vertical);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      horizontal = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      vertical = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, horizontal), vertical);

      // Local contrast adaptation in action:
      fragEdges = edges * step(maxDelta, float(${E.float(CRt)}) * delta);
    }
  `),t}const $Rt=Object.freeze(Object.defineProperty({__proto__:null,build:y5e},Symbol.toStringTag,{value:"Module"}));let W_e=class extends Hi{constructor(e,i){super(e,i,new Bi($Rt,()=>G(()=>Promise.resolve().then(()=>SHt),void 0)))}initializePipeline(){return wi({colorWrite:Di})}},ARt=class extends cr{},W1=class extends Af{constructor(e){super(e),this.produces="disabled",this.consumes={required:[dt.ANTIALIASING],optional:[rr.COMPOSITE]},this._areaTexture=null,this._searchTexture=null,this._smaaParameters=new ARt}initialize(){this.addHandles([H(()=>this.isEnabled(),e=>e?this.enable():this.disable(),Mt)])}async enable(){if(this.produces=dt.ANTIALIASING,this._abortController||this._areaTexture&&this._searchTexture)return;this._abortController=new AbortController;const e=this._abortController.signal;try{const i=await G(()=>import("./SMAAData-DCEZ61Cs.js"),[]);await this._loadTextures(i,e),this.requestRender($t.UPDATE)}catch{}this._abortController=null}async _loadTextures(e,i){gt(i);const[r,s]=await Promise.allSettled([Iv(e.areaTexture,{signal:i}),Iv(e.searchTexure,{signal:i})]);if(gt(i),r.status!=="fulfilled"||s.status!=="fulfilled")return;const n=this.renderingContext;this._areaTexture=Z_e(n,gi.LINEAR,Tt.RGB,r.value),this._searchTexture=Z_e(n,gi.NEAREST,Tt.LUMINANCE,s.value)}disable(){this.produces="disabled"}destroy(){this._searchTexture=Dt(this._searchTexture),this._areaTexture=Dt(this._areaTexture)}precompile(){this.techniques.precompile(W_e),this.techniques.precompile(H_e),this.techniques.precompile(q_e)}render(e){const i=e.find(({name:m})=>m===dt.ANTIALIASING);if(!this._areaTexture||!this._searchTexture)return this.requestRender($t.UPDATE),i;const r=this.techniques.get(W_e),s=this.techniques.get(H_e),n=this.techniques.get(q_e);if(!r.compiled||!s.compiled||!n.compiled)return this.requestRender($t.UPDATE),i;const o=e.find(({name:m})=>m===rr.COMPOSITE);if(!o)return i;const a=o.fbo.width,l=o.fbo.height,c=this.renderingContext;c.setViewport(0,0,a,l);const h=this.fboCache.acquire(a,l,"smaa edges",gr.RG);c.bindFramebuffer(h.fbo),c.setClearColor(0,0,0,1),c.clear(Mi.COLOR),this._smaaParameters.color=o.getTexture();const d=this.bindParameters;c.bindTechnique(r,d,this._smaaParameters),c.screen.draw();const f=this.fboCache.acquire(a,l,"smaa blend");return c.bindFramebuffer(f.fbo),c.setClearColor(0,0,1,1),c.clear(Mi.COLOR),this._smaaParameters.inputTexture=h.getTexture(),this._smaaParameters.areaTexture=this._areaTexture,this._smaaParameters.searchTexture=this._searchTexture,c.bindTechnique(s,d,this._smaaParameters),c.screen.draw(),h.release(),c.bindFramebuffer(i.fbo),c.setClearColor(0,1,0,1),c.clear(Mi.COLOR),this._smaaParameters.inputTexture=f.getTexture(),c.bindTechnique(n,d,this._smaaParameters),c.screen.draw(),f.release(),i}};function Z_e(t,e,i,r){const s=new Ar;return s.pixelFormat=i,s.wrapMode=ar.CLAMP_TO_EDGE,s.width=r.width,s.height=r.height,s.samplingMode=e,new pi(t,s,r)}u([p()],W1.prototype,"produces",void 0),u([p()],W1.prototype,"consumes",void 0),u([p({constructOnly:!0})],W1.prototype,"isEnabled",void 0),u([p()],W1.prototype,"_abortController",void 0),W1=u([A("esri.views.3d.webgl-engine.effects.smaa.SMAA")],W1);function v5e(){const t=new Vi;return t.attributes.add(z.POSITION,"vec3"),t.attributes.add(z.COLOR,"vec4"),t.attributes.add(z.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add(new jne("transform",(e,i)=>MRt(e,i)),new Va("viewport",e=>e.camera.fullViewport),new Un("pixelRatio",e=>e.camera.pixelRatio)),t.vertex.main.add(E`gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;`),t.fragment.main.add(E`float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);`),t}function MRt(t,e){return _n(P0,e.camera.projectionMatrix),P0[10]=24e-8-1,P0[11]=-1,P0[14]=(24e-8-2)*e.camera.near,Bn(P0,P0,e.camera.viewMatrix),Bn(P0,P0,t.modelMatrix)}const P0=qe(),ORt=Object.freeze(Object.defineProperty({__proto__:null,build:v5e},Symbol.toStringTag,{value:"Module"}));let IRt=class extends cr{constructor(){super(...arguments),this.modelMatrix=qe()}},Y_e=class extends Hi{constructor(e,i){super(e,i,new Bi(ORt,()=>G(()=>Promise.resolve().then(()=>THt),void 0)))}initializePipeline(){return wi({blending:Ld,depthTest:{func:Ui.LEQUAL},colorWrite:Di})}},xQ=class extends zm{constructor(){super(...arguments),this._starData=null,this._loadDataTask=null,this._numPoints=0,this._passParameters=new IRt}initialize(){this.addHandles([H(()=>this.view.environment.starsEnabled,e=>e?this._enable():this._disable(),Ut),H(()=>this.view.environment.lighting.type==="virtual"?null:this.view.environment.lighting.date,e=>this._update(e),Mt)])}_enable(){super._enable(),this._loadDataTask=this._createLoadDataTask()}get loading(){return!!this._loadDataTask&&!this._loadDataTask.finished}destroy(){this._loadDataTask=fc(this._loadDataTask),this._numPoints=0,this._vao=Dt(this._vao),this._starData=null}precompile(){this.techniques.precompile(Y_e)}render(e){const i=e.find(({name:n})=>n===dt.OPAQUE_ENVIRONMENT),r=this.renderingContext;if(this.loading)return this.requestRender($t.UPDATE),i;if(!this._starData)return i;this._vao??(this._vao=this._ensureResources(this._starData,r));const s=this.techniques.get(Y_e);return s.compiled?(r.bindTechnique(s,this.bindParameters,this._passParameters),r.bindVAO(this._vao),r.drawArrays(Gi.POINTS,0,this._numPoints),i):(this.requestRender($t.UPDATE),i)}_ensureResources(e,i){return this._numPoints=e.byteLength/_5e,RRt(i,new Float32Array(e,0,2*this._numPoints),new Uint8Array(e,2*this._numPoints*4,this._numPoints),this._numPoints)}_update(e){if(!e)return;const i=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,r=2*PRt(e),s=_n(this._passParameters.modelMatrix,zRt);Q$(s,s,-r*Math.PI),Bn(s,kRt,s),Q$(s,s,-i*Math.PI),this.requestRender($t.UPDATE)}_createLoadDataTask(){if(this._starData)return null;const e=gg(async i=>{const{data:r}=await wHe("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:i});DRt(r),this._starData=r});return e.promise.catch(i=>{es(i)||J.getLogger(this).error(i)}).then(()=>{this.destroyed||this.requestRender($t.UPDATE)}),e}};function RRt(t,e,i,r){const s=J_e.createBuffer(r),n=s.position,o=s.color,a=s.size;for(let l=0;l<r;l++){const c=e[2*l],h=e[2*l+1];n.set(l,0,-Math.cos(c)*Math.sin(h)),n.set(l,1,-Math.sin(c)*Math.sin(h)),n.set(l,2,-Math.cos(h));const d=NRt(i[l]),f=LRt(FRt[d[1]]);o.set(l,0,255*f[0]),o.set(l,1,255*f[1]),o.set(l,2,255*f[2]),o.set(l,3,255),a.set(l,d[0])}return new Tg(t,bg,new Map([["geometry",Jv(J_e)]]),new Map([["geometry",jn.createVertex(t,Js.STATIC_DRAW,s.buffer)]]))}function PRt(t){const e=t,i=new Date(t.getFullYear(),0,1,11,58,56);return(+e-+i)/(+new Date(t.getFullYear()+1,0,1,11,58,55)-+i)}function DRt(t){if(!t)throw new U("stars:no-data-received","Failed to create stars because star catalogue is missing");const e=t.byteLength/_5e;if(e%1!=0||e>5e4||e<5e3)throw new U("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}function LRt(t){return[parseInt(t.slice(0,2),16),parseInt(t.slice(2,4),16),parseInt(t.slice(4,6),16)]}function NRt(t){return t>=192?[2.9,t-192]:t>=160?[2.5,t-160]:t>=128?[2,t-128]:t>=96?[1.5,t-96]:t>=64?[1,t-64]:t>=32?[.7,t-32]:[.4,t]}xQ=u([A("esri.views.3d.webgl-engine.effects.stars.Stars")],xQ);const FRt=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],kRt=Cse(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),zRt=Cse(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),_5e=9,J_e=Bd().vec3f(z.POSITION).vec4u8(z.COLOR).f32(z.SIZE);let Gae=class extends cr{};function b5e(){const t=new Vi;return t.include(ia),t.fragment.uniforms.add(new It("tex",e=>e.texture)),t.fragment.main.add(E`fragColor = vec4(1.0 - texture(tex, uv).a);`),t}const URt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:Gae,build:b5e},Symbol.toStringTag,{value:"Module"}));let X_e=class extends Hi{constructor(e,i){super(e,i,new Bi(URt,()=>G(()=>Promise.resolve().then(()=>EHt),void 0)))}initializePipeline(){return wi({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}},BRt=class{constructor(e,i){this._rctx=e,this._techniques=i,this._configuration=new mV,this._passParameters=new J6,this._hudParameters=new Gae,this._configuration.blitMode=_a.PremultipliedAlpha,this._techniques.precompile(Z_,this._configuration),this._configuration.hasOpacityFactor=!0,this._techniques.precompile(Z_,this._configuration),this._configuration.hasOpacityFactor=!1,this._configuration.blitMode=_a.Alpha,this._techniques.precompile(Z_,this._configuration),this._configuration.blitMode=_a.Depth,this._techniques.precompile(Z_,this._configuration),this._techniques.precompile(X_e)}compositeHUD(e,i){this._hudParameters.texture=i;const r=this._techniques.get(X_e);this._rctx.bindTechnique(r,e,this._hudParameters),this._rctx.screen.draw()}compositePreMultipliedAlpha(e,i,r=1){this._composite(e,i,_a.PremultipliedAlpha,r)}composite(e,i){this._composite(e,i,_a.Alpha,1)}blitDepthToLinearDepth(e,i){this._composite(e,i,_a.Depth,1)}_composite(e,i,r,s){this._configuration.blitMode=r,this._configuration.hasOpacityFactor=s!==1,this._passParameters.texture=i,this._passParameters.opacity=s;const n=this._techniques.get(Z_,this._configuration);this._rctx.bindTechnique(n,e,this._passParameters),this._rctx.screen.draw()}},VRt=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new lg(new ArrayBuffer(4)),this._layerToOidToColor=new Ov,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Ov,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,i,r,s,n,o=null,a=null,l=null){e&&i&&r&&s&&(this._layerUidToId.set(s,r),this._layerUidToPopupEnabled.set(s,n),n&&this._layerUidToGraphicsUidToObjectId.set(s,i,{objectId:e,attributeNodeId:o,attributeIndex:a,subLayerId:l}))}getObjectAndLayerIdColor(e){const i=this.getObjectAndLayerIdColorArray(e);return Yi(i.get(0,1),i.get(0,2),i.get(0,3),255)}getObjectAndLayerIdColorArray(e){var o;if(!e.layerUid||!e.graphicUid)return this.colorZero;const i=this._layerUidToPopupEnabled.get(e.layerUid);if(i===void 0)return this.colorZero;if(i===!1)return this.colorZero;const r=(o=this._layerUidToGraphicsUidToObjectId.get(e.layerUid,e.graphicUid))==null?void 0:o.objectId;if(!r)return this.colorZero;let s=this._layerToOidToColor.get(e.layerUid,r);if(!s){if(X("enable-feature:objectAndLayerId-screenshot-testing"))s=r;else for(;!s;){const a=Math.floor(16777214*Math.random())+1;this._colorToUID.has(a)||(s=a)}if(s>16777215)throw new Error("Object ID Overflow");this._layerToOidToColor.set(e.layerUid,r,s),this._colorToUID.set(s,e)}const n=new ArrayBuffer(4);return new DataView(n).setUint32(0,s,!1),new lg(n)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[i,r]of this._colorToUID.entries()){const s=this._layerUidToGraphicsUidToObjectId.get(r.layerUid,r.graphicUid),n=this._layerUidToId.get(r.layerUid);s&&n&&e.set(i,s.attributeNodeId?{type:"object-and-layer-and-i3s-id",olid:s.objectId,lid:n,attrId:s.attributeNodeId,attrIdx:s.attributeIndex,subLayerId:s.subLayerId}:{type:"object-and-layer-id",olid:s.objectId,lid:n})}return e}};function w5e(){return new Float32Array(4)}function jRt(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function xM(t,e,i,r){const s=new Float32Array(4);return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function GRt(t,e){return new Float32Array(t,e,4)}function x5e(){return w5e()}function S5e(){return xM(1,1,1,1)}function T5e(){return xM(1,0,0,0)}function E5e(){return xM(0,1,0,0)}function C5e(){return xM(0,0,1,0)}function $5e(){return xM(0,0,0,1)}const Hae=x5e(),HRt=S5e(),qRt=T5e(),WRt=E5e(),ZRt=C5e(),YRt=$5e();Object.freeze(Object.defineProperty({__proto__:null,ONES:HRt,UNIT_W:YRt,UNIT_X:qRt,UNIT_Y:WRt,UNIT_Z:ZRt,ZEROS:Hae,clone:jRt,create:w5e,createView:GRt,fromValues:xM,ones:S5e,unitW:$5e,unitX:T5e,unitY:E5e,unitZ:C5e,zeros:x5e},Symbol.toStringTag,{value:"Module"}));let A5e=class{constructor(e,i){this.key=e,this.free=i,this.incarnation=0,this._refCount=1}retain(e=1){this._refCount+=e}release(){return this._refCount===0?(console.log(`Releasing already released FBO attachment "${this.name}" in ${new Error().stack}`),!0):(--this._refCount,this._refCount===0&&(this.free(),!0))}};var IA;(function(t){t[t.FBO=0]="FBO",t[t.DEPTH=1]="DEPTH",t[t.COLOR=2]="COLOR"})(IA||(IA={}));let M5e=class extends A5e{constructor(e,i,r){super(e,r),this.attachment=i,this.name=""}dispose(){this.attachment.dispose()}get cachedMemory(){return this.attachment.usedMemory}},JRt=class extends M5e{constructor(e,i,r){super(e,i,r),this.attachment=i,this.type=IA.COLOR}},K_e=class extends M5e{constructor(){super(...arguments),this.type=IA.DEPTH}};function XRt(t){return(t==null?void 0:t.attachment.type)===Tv.Texture}let O5e=class extends A5e{constructor(e,i,r,s,n,o){super(e,o),this.type=IA.FBO,this._colors=new Map,this._name=rr.COMPOSITE,this.acquireDepth=null,this.acquireColor=null,this._name=i,this.fbo=r,this.acquireDepth=s,this.acquireColor=n}dispose(){var e;(e=this.fbo)==null||e.dispose()}get cachedMemory(){var e;return((e=this.fbo)==null?void 0:e.usedMemory)||0}get numberOfColorAttachments(){return this._colors.size}get name(){return this._name}setName(e){this._name=e}getTexture(e=nr.COLOR_ATTACHMENT0){var i,r;return e===CS?(i=this.fbo)==null?void 0:i.depthStencilTexture:(r=this.fbo)==null?void 0:r.getColorTexture(e)}getAttachment(e=nr.COLOR_ATTACHMENT0){return e===CS?this._depth:this._colors.get(e)}hasAttachment(e){return $m(this._colors,i=>i.name===e)}attachDepth(e){var i;return e==null||e.retain(),this.detachDepth(),e&&((i=this.fbo)==null||i.attachDepthStencil(e.attachment)),this._depth=e,this}detachDepth(){var e,i;(e=this.fbo)==null||e.detachDepthStencilTexture(),(i=this.fbo)==null||i.detachDepthStencilBuffer(),this._depth=Lr(this._depth)}obtainDepthTexture(){var i;const e=this._depth;return XRt(e)?((i=this.fbo)==null||i.detachDepthStencilTexture(),this._depth=null,e):null}attachColor(e,i){var r;return e.retain(),this.detachColor(i),(r=this.fbo)==null||r.attachColorTexture(e.attachment,i),this._colors.set(i,e),this}detachColor(e){var r;(r=this.fbo)==null||r.detachColorTexture(e);const i=this._colors.get(e);this._colors.delete(e),i==null||i.release()}detachAll(){this._colors.forEach((e,i)=>this.detachColor(i)),this.detachDepth()}},c7=class{constructor(e,i){this._last=new ii,this._incarnation=0,this._cache=new UL(e,i)}destroy(){var e;(e=this._last)==null||e.forAll(i=>i.dispose()),this._last=null,this._cache.destroy()}set interactive(e){var i;e&&!this._last?this._last=new ii:e||((i=this._last)==null||i.forAll(r=>r.dispose()),this._last=null)}clean(){var e;(e=this._last)==null||e.filterInPlace(i=>!(i.incarnation<this._incarnation)||(this._cache.put(i.key,i),!1))}frame(){++this._incarnation}pop(e){if(this._last){const i=this._last.find(r=>r.key===e);if(i)return this._last.removeUnordered(i),i}return this._cache.pop(e)}put(e){e.incarnation=this._incarnation,this._last?this._last.push(e):this._cache.put(e.key,e)}get usedMemory(){var e;return((e=this._last)==null?void 0:e.reduce((i,r)=>i+r.cachedMemory,0))??0}},KRt=class{constructor(e){this.rctx=e,this._acquired=new Set,this._cache=new c7(e.newCache,"FBOCache"),this._depthCache=new c7(e.newCache,"DepthAttachmentCache"),this._colorCache=new c7(e.newCache,"ColorAttachmentCache")}destroy(){this._cache.destroy(),this._depthCache.destroy(),this._colorCache.destroy()}clean(){this._cache.clean(),this._colorCache.clean(),this._depthCache.clean()}frameStart(){var e;this._cache.frame(),this._colorCache.frame(),this._depthCache.frame(),(e=this.debugCallback)==null||e.call(this)}frameEnd(){const e=this.debugCallback;e&&this._acquired.forEach(i=>i.type===IA.FBO&&e(i.name,i.fbo,i.numberOfColorAttachments))}get usedMemory(){return Array.from(this._acquired.values()).reduce((e,i)=>{var r;return e+("getTexture"in i?((r=i.getTexture())==null?void 0:r.usedMemory)??0:i.cachedMemory)},this._cache.usedMemory+this._colorCache.usedMemory+this._depthCache.usedMemory)}set interactive(e){this._cache.interactive=this._colorCache.interactive=this._depthCache.interactive=e}acquire(e,i,r,s=gr.RGBA){const n=u7(s,e,i);let o=this._cache.pop(n);if(o){o.retain(),o.setName(r);const a=this.rctx.getBoundFramebufferObject();if(this.rctx.bindFramebuffer(o.fbo),this.rctx.setDrawBuffers([nr.COLOR_ATTACHMENT0]),!o.fbo)throw new U("attempt to use a not existing framebuffer");this.rctx.unbindTexture(o.fbo.colorTexture),this.rctx.bindFramebuffer(a)}else o=new O5e(n,r,new Eg(this.rctx,{...Q_e[s],width:e,height:i}),a=>{a??(a=Ho.DEPTH_STENCIL_TEXTURE);const l=this._acquireDepth(a,o.fbo.width,o.fbo.height,`${o.name} depth`);return o.attachDepth(l),l.release(),o},(a,l,c)=>{l??(l=gr.RGBA);const h=this._acquireColor(l,e,i,c??`${o.name} color ${a}`);return this.rctx.unbindTexture(h.attachment),o.attachColor(h,a),h.release(),o},()=>{var a;(a=this.debugCallback)==null||a.call(this,o.name,o.fbo,o.numberOfColorAttachments),this._acquired.delete(o),o.detachAll(),this._cache.put(o)});return this._trackHandle(o)}acquireDepth(e,i,r,s){return this._acquireDepth(e,i,r,s)}_acquireDepth(e,i,r,s){const n=u7(e,i,r),o=this._depthCache.pop(n);if(o)return o.retain(),o.name=s,this._trackHandle(o);const a=e===Ho.DEPTH_STENCIL_TEXTURE?new K_e(n,new pi(this.rctx,{...ebe[e],width:i,height:r}),()=>{this._acquired.delete(a),this._depthCache.put(a)}):new K_e(n,new LNe(this.rctx,{...ebe[e],width:i,height:r}),()=>{this._acquired.delete(a),this._depthCache.put(a)});return a.name=s,this._trackHandle(a)}_acquireColor(e,i,r,s){const n=u7(e,i,r),o=this._colorCache.pop(n);if(o)return o.retain(),o.name=s,this._trackHandle(o);const a=new JRt(n,new pi(this.rctx,{...Q_e[e],width:i,height:r}),()=>{this._acquired.delete(a),this._colorCache.put(a)});return a.name=s,this._trackHandle(a)}_trackHandle(e){return this._acquired.add(e),e}};const fb=new O5e("default","default",null,()=>fb,()=>fb,()=>{});function u7(t,e,i){return`${t}x${e}x${i}`}fb.release=()=>!1;const pz=new Ar;pz.pixelFormat=Tt.RED,pz.internalFormat=rt.R8,pz.wrapMode=ar.CLAMP_TO_EDGE;const fz=new Ar;fz.pixelFormat=Tt.RG,fz.internalFormat=rt.RG8,fz.wrapMode=ar.CLAMP_TO_EDGE;const mz=new Ar;mz.internalFormat=rt.RGBA4,mz.dataType=Xa.UNSIGNED_SHORT_4_4_4_4,mz.wrapMode=ar.CLAMP_TO_EDGE;const I5e=new Ar;I5e.wrapMode=ar.CLAMP_TO_EDGE;const hR=new Ar;hR.wrapMode=ar.CLAMP_TO_EDGE,hR.samplingMode=gi.LINEAR_MIPMAP_LINEAR,hR.hasMipmap=!0,hR.maxAnisotropy=8;const dR=new Ar;dR.pixelFormat=Tt.RED,dR.dataType=Xa.HALF_FLOAT,dR.internalFormat=rt.R16F,dR.samplingMode=gi.NEAREST;const gz=new Ar;gz.dataType=Xa.HALF_FLOAT,gz.internalFormat=rt.RGBA16F,gz.samplingMode=gi.NEAREST;const Q_e={[gr.RED]:pz,[gr.RG]:fz,[gr.RGBA4]:mz,[gr.RGBA]:I5e,[gr.RGBA_MIPMAP]:hR,[gr.R16F]:dR,[gr.RGBA16F]:gz},g2=new Ar;g2.pixelFormat=Tt.DEPTH_STENCIL,g2.dataType=Xa.UNSIGNED_INT_24_8,g2.samplingMode=gi.NEAREST,g2.wrapMode=ar.CLAMP_TO_EDGE,g2.internalFormat=Tt.DEPTH24_STENCIL8;const ebe={[Ho.DEPTH_STENCIL_TEXTURE]:g2,[Ho.DEPTH16_BUFFER]:new DNe(ga.DEPTH_COMPONENT16,4)};var hD;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(hD||(hD={}));let qg=class{constructor(e,i,r=hD.FrontToBack){this._rctx=e,this._techniques=i,this._sorting=r,this._draws=new ii({allocator:s=>s??{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,i,r,s,n){const o=this._draws.pushNew();o.geometry=i,o.geometryRanges=r,o.material=e,o.depthSquaredHint=s,o.indexType=(i.indexed?i.vao.indexBuffer.indexType:null)??0,o.highlightName=n}acquire(e,i){return this._draws.map(r=>r.material.acquireTechnique(this._techniques,e,i,r.geometry.parameters))}dispatch(e,i,r){var l,c;const s=this._rctx;this._previouslyBoundDraw.clear();let n=null;const o=this._draws.length,a=(l=i.highlight)==null?void 0:l.name;for(let h=0;h<o;h++){const d=this._draws.data[h];if(e.identifier===Wa.Highlight){const x=d.highlightName;if(x){if(x!==a)continue}else if(!a||!((c=i.overlay)!=null&&c.hasHighlightOptions(a)))continue}const f=r[h];f===n&&i.oitPass===Ti.NONE||(s.bindTechnique(f,i,e),n=f);const{geometryRanges:m,indexType:g,geometry:v,material:_}=d;s.bindVAO(v.vao),this._previouslyBoundDraw.get(f)!==_&&(f.program.bindDraw(i,e,_),this._previouslyBoundDraw.set(f,_));const b=m.length,{primitiveType:w}=v;for(let x=0;x<b;x+=2){const S=m[x],C=m[x+1];if(g!==0){const T=yz.get(g);s.drawElements(w,C,g,S*T)}else s.drawArrays(w,S,C)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===hD.FrontToBack?1:-1;this._draws.sort((i,r)=>{const s=e*(i.depthSquaredHint-r.depthSquaredHint);return s!==0?s:i.geometry.vao.byteSize-r.geometry.vao.byteSize})}get count(){return this._draws.length}};const yz=new Map;yz.set(ki.UNSIGNED_BYTE,1),yz.set(ki.UNSIGNED_SHORT,2),yz.set(ki.UNSIGNED_INT,4);let QRt=class{constructor(e){const i=e.renderContext.rctx,r=e.techniques;this.opaque=new qg(i,r),this.transparent=new qg(i,r,hD.BackToFront),this.integratedMesh=new qg(i,r),this.shadowMap=new qg(i,r),this.highlight=new qg(i,r),this.highlightIntegratedMesh=new qg(i,r),this.highlightShadowMap=new qg(i,r),this.viewshedShadowMap=new qg(i,r),this.nonHighlightShadowMap=new qg(i,r)}},X6=class extends rDe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=$(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}},ePt=class extends X6{constructor(){super(...arguments),this.identifier=Wa.Material,this.output=Y.Color,this.transparent=!1}},tPt=class extends X6{constructor(){super(...arguments),this.identifier=Wa.ShadowMap}},iPt=class extends X6{constructor(){super(...arguments),this.identifier=Wa.Highlight}},rPt=class extends X6{constructor(){super(...arguments),this.identifier=Wa.ViewshedShadowMap}},SQ=class extends OL{constructor(){super({}),this.produces=new Map([[xe.OPAQUE_MATERIAL,e=>this._produces(e,xe.OPAQUE_MATERIAL)],[xe.TRANSPARENT_MATERIAL,e=>this._produces(e,xe.TRANSPARENT_MATERIAL)],[xe.INTEGRATED_MESH,e=>this._produces(e,xe.INTEGRATED_MESH)]]),this._materialPassParameters=new ePt,this._shadowPassParameters=new tPt,this._highlightPassParameters=new iPt,this._viewshedPassParameters=new rPt,this._systems=new Set}initializeRenderContext(e){this._context=e,this._passes=new QRt(e)}get rctx(){return this._context.renderContext.rctx}uninitializeRenderContext(){}dispose(){this._context=null,this._systems.clear()}register(e){this._systems.add(e)}_produces(e,i){return!!this._invoke(e,i,r=>r.count>0)}prepareRender(e){if(this._systems.size!==0&&this._passes!=null){for(const i of Object.values(this._passes))i.prepareSubmit();this._systems.forEach(i=>i.submit(this._passes,e.bind));for(const i of Object.values(this._passes))i.finishSubmit()}}acquireTechniques(e){if(this._systems.size===0)return null;const i=e.output===Y.Shadow||e.output===Y.ShadowHighlight||e.output===Y.ShadowExcludeHighlight?this._shadowPassParameters:e.output===Y.ViewshedShadow?this._viewshedPassParameters:e.output===Y.Highlight?this._highlightPassParameters:this._materialPassParameters,r=e.bind;return this._updateParameters(r.camera,i,r.slot===xe.TRANSPARENT_MATERIAL),this._materialPassParameters.output=e.output,this._invoke(e.output,e.bind.slot,(s,n)=>s.acquire(n,e.bind))}render(e,i){this._invoke(e.output,e.bind.slot,(r,s)=>r.dispatch(s,e.bind,i))}_invoke(e,i,r){if(this._passes==null)return null;switch(i){case xe.OPAQUE_MATERIAL:switch(e){case Y.Color:case Y.ColorEmission:case Y.Depth:case Y.Normal:case Y.ObjectAndLayerIdColor:return r(this._passes.opaque,this._materialPassParameters);case Y.Highlight:return r(this._passes.highlight,this._highlightPassParameters);case Y.Shadow:return r(this._passes.shadowMap,this._shadowPassParameters);case Y.ShadowHighlight:return r(this._passes.highlightShadowMap,this._shadowPassParameters);case Y.ShadowExcludeHighlight:return r(this._passes.nonHighlightShadowMap,this._shadowPassParameters);case Y.ViewshedShadow:return r(this._passes.viewshedShadowMap,this._viewshedPassParameters)}break;case xe.TRANSPARENT_MATERIAL:switch(e){case Y.Color:case Y.ColorEmission:case Y.Depth:case Y.Normal:case Y.ObjectAndLayerIdColor:return r(this._passes.transparent,this._materialPassParameters)}break;case xe.INTEGRATED_MESH:switch(e){case Y.Color:case Y.ColorEmission:case Y.Depth:case Y.Normal:case Y.ObjectAndLayerIdColor:return r(this._passes.integratedMesh,this._materialPassParameters);case Y.Highlight:return r(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}queryDepthRange(e){const i=new cu;return this._systems.forEach(r=>i.union(r.queryDepthRange(e))),i}get hasEmissions(){let e=!1;return this._systems.forEach(i=>e=i.hasEmissions||e),e}_updateParameters(e,i,r){const s=e.viewInverseTransposeMatrix;se(h7,s[3],s[7],s[11]),d7.set(h7),ne(i.transformWorldFromViewTH,d7.high),ne(i.transformWorldFromViewTL,d7.low),ne(i.slicePlaneLocalOrigin,h7),sT(i.transformViewFromCameraRelativeRS,e.viewMatrix),_n(i.transformProjFromView,e.projectionMatrix),i.identifier===Wa.Material&&(this._materialPassParameters.transparent=r,uM(tbe,i.transformViewFromCameraRelativeRS),lL(i.transformNormalViewFromGlobal,tbe))}hasHighlightOptions(e){for(const i of this._systems)if(i.hasHighlightOptions(e))return!0;return!1}};SQ=u([A("esri.views.3d.webgl-engine.core.renderPasses.RenderPassManager")],SQ);const h7=$(),tbe=Ts(),d7=new a5e;function sPt(t){return t.name}let nPt=class{constructor(e){this._context=e,this._nodes=new ii}destroy(){this._nodes.forEach(e=>e.destroy()),this._nodes.clear()}add(e){this._nodes.push(e),lB&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:i})=>i).join(", ")}`)}remove(e){this._nodes.remove(e),lB&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:i})=>i).join(", ")}`)}produces(e){return this._nodes.some(({produces:i})=>i===e)}require(e,...i){const r=this._nodes,s=n=>r.reduce((o,{consumes:a,produces:l})=>o+(!a.required.includes(e)||n!=null&&l!==n?0:1),0);return i.length===0?s():i.reduce((n,o)=>n+s(o),0)}optional(e,...i){const r=this._nodes,s=n=>r.reduce((o,{consumes:a,produces:l})=>{var c;return o+(!((c=a.optional)!=null&&c.includes(e))||n!=null&&l!==n?0:1)},0);return i.length===0?s():i.reduce((n,o)=>n+s(o),0)}updateAnimation(e){return this._nodes.reduce((i,r)=>r.updateAnimation(e)||i,!1)}precompile(...e){++this._context.techniques.precompiling;for(const i of e)this._nodes.forEach(r=>{r.produces===i&&r.precompile()});--this._context.techniques.precompiling}render(e,i,r=()=>{}){const s=e.name,n=this._nodes.filter(({produces:o})=>o===s);return n.length===0?sPt(e)?e:fb:(n.forEach(o=>{var l;const a=[e];for(const c of o.consumes.required){if(c===s)continue;const h=i.get(c);if(h)a.push(h);else if(c!=="emissive"||!((l=i.get(s))!=null&&l.hasAttachment(c)))return void(r&&r(a))}if(o.consumes.optional)for(const c of o.consumes.optional){if(c===s)continue;const h=i.get(c);h&&a.push(h)}try{const c=o.doRender(a);c&&c!==e&&(s!==c.name&&(J.getLogger(o).errorOnce(`RenderNode produced ${c.name}, expected ${s}`),c.setName(s)),e.release(),e=c,i.set(s,e))}catch(c){J.getLogger(o).errorOnce(c)}r&&r(a)}),this._context.rctx.enforceState(),e)}requireGeometryDepth(){return this._nodes.some(e=>e.produces!=="disabled"&&e.requireGeometryDepth)}get test(){return{nodes:this._nodes}}},oPt=class{constructor(e){this.context=e,this._renderPlugins=new ii,this._slots=new Array,this._version=Ta(0);for(let i=0;i<xe.MAX_SLOTS;++i)this._slots[i]=[]}destroy(){this._renderPlugins.forEach(e=>e.destroy()),this._renderPlugins.clear()}get plugins(){return this._renderPlugins}add(e,i){const r=()=>{if(i!=null&&i.aborted)throw e.uninitializeRenderContext(),bi();this._renderPlugins.push(e),e.produces.forEach((n,o)=>this._slots[o].push(e)),this.context.requestRender(),this._version.value++},s=e.initializeRenderContext(this.context,i);if(uu(s))return s.then(r);r()}remove(e){this._renderPlugins.removeUnordered(e),e.uninitializeRenderContext();for(let i=0;i<this._slots.length;++i)this._slots[i]=this._slots[i].filter(r=>r!==e);this.context.requestRender(),this._version.value++}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this.context.renderContext)})}updateAnimation(e){let i=!1;return this._renderPlugins.forAll(r=>{var s;return i=((s=r.updateAnimation)==null?void 0:s.call(r,e))||i}),i}precompile(...e){++this.context.techniques.precompiling;const i=this.context.renderContext.bind.slot;for(const r of e)this.context.renderContext.bind.slot=r,this._forEachRender(()=>{});this.context.renderContext.bind.slot=i,--this.context.techniques.precompiling}render(e,...i){for(const r of i)this.context.renderContext.bind.slot=r,this._forEachRender((s,n)=>s.render(this.context.renderContext,n,e))}_forEachRender(e){const i=this.context.renderContext.bind.slot,r=this.context.renderContext.output;this._slots[i].forEach(s=>{const n=s.produces.get(i);if(!(n!=null&&n(r))||s.isDecoration&&!this.context.renderContext.bind.decorations)return;const o=s.acquireTechniques(this.context.renderContext);o&&e(s,o)})}queryDepthRange(e){const i=new cu;return this._renderPlugins.forAll(r=>{var n;const s=(n=r.queryDepthRange)==null?void 0:n.call(r,e);i.union(s)}),i}get updating(){return this._version.value>=0&&this._renderPlugins.some(e=>e.running)}produces(e,...i){return i.some(r=>this._slots[r].some(s=>{const n=s.produces.get(r);return!!n&&n(e)}))}consumes(e){return this._renderPlugins.some(i=>i.consumes().required.includes(e))}hasHighlightOptions(e){return aPt.some(i=>this._slots[i].some(r=>r.hasHighlightOptions(e)))}get hasDecorations(){return this._renderPlugins.some(e=>e.isDecoration)}get hasOccludees(){return this._renderPlugins.some(e=>e.hasOccludees)}get hasEmissions(){return this._renderPlugins.some(e=>e.hasEmissions)}get renderOccludedFlags(){return this._renderPlugins.reduce((e,i)=>e|i.renderOccludedFlags,Cr.None)}get usedMemory(){return this._renderPlugins.reduce((e,i)=>i.material?e:e+(i.usedMemory??0),0)}get test(){}};const aPt=[xe.OPAQUE_MATERIAL,xe.TRANSPARENT_MATERIAL,xe.DRAPED_MATERIAL,xe.HUD_MATERIAL,xe.LABEL_MATERIAL];let qae=class extends cr{};function R5e(t){const e=new Vi;e.include(ia);const i=t.hasEmission,r=e.fragment;return r.uniforms.add(new It("colorTexture",s=>s.colorTexture),new It("alphaTexture",s=>s.alphaTexture),new It("frontFaceTexture",s=>s.frontFaceTexture)),e.outputs.add("fragColor","vec4",0),i&&(e.outputs.add("fragEmission","vec4",1),r.uniforms.add(new It("emissionTexture",s=>s.emissionTexture)),r.uniforms.add(new It("emissionFrontFaceTexture",s=>s.emissionFrontFaceTexture))),r.main.add(E`
      float srcAlpha = texture(alphaTexture, uv).r;
      if(srcAlpha == 0.0){
        fragColor = vec4(0.0);
        return;
      }

      vec4 srcColor = texture(colorTexture, uv);
      vec4 frontFace = texture(frontFaceTexture, uv);

      vec4 transparentColor = vec4(mix(srcColor.rgb / srcAlpha, frontFace.rgb, frontFace.a), 1.0 - srcColor.a);
      fragColor = transparentColor;

      ${Te(i,`vec4 emission = texture(emissionTexture, uv);
         vec4 emissionFrontFace = texture(emissionFrontFaceTexture, uv);
        fragEmission = vec4(mix(emission.rgb / srcAlpha, emissionFrontFace.rgb, emissionFrontFace.a), emissionFrontFace.a);`)}
    `),e}const lPt=Object.freeze(Object.defineProperty({__proto__:null,OITBlendPassParameters:qae,build:R5e},Symbol.toStringTag,{value:"Module"}));let p7=class extends Hi{constructor(e,i){super(e,i,new Bi(lPt,()=>G(()=>Promise.resolve().then(()=>CHt),void 0)))}initializePipeline(e){return wi({blending:Ld,colorWrite:Di,drawBuffers:e.hasEmission?{buffers:[nr.COLOR_ATTACHMENT0,nr.COLOR_ATTACHMENT1]}:{buffers:[nr.COLOR_ATTACHMENT0]}})}},P5e=class extends hu{constructor(){super(...arguments),this.hasEmission=!1}};u([ie()],P5e.prototype,"hasEmission",void 0);let cPt=class{constructor(e){this._techniques=e,this._parameters=new qae,this._configuration=new P5e,e.precompile(p7,this._configuration),this._configuration.hasEmission=!0,e.precompile(p7,this._configuration)}blend(e,i,r,s,n){this._parameters.colorTexture=i.getTexture(),n&&(this._parameters.emissionTexture=i.getTexture(nr.COLOR_ATTACHMENT1),this._parameters.emissionFrontFaceTexture=r.getTexture(nr.COLOR_ATTACHMENT1)),this._parameters.alphaTexture=i.getTexture(n?nr.COLOR_ATTACHMENT2:nr.COLOR_ATTACHMENT1),this._parameters.frontFaceTexture=r.getTexture(),this._configuration.hasEmission=n;const o=this._techniques.get(p7,this._configuration);e.bindTechnique(o,s,this._parameters),e.screen.draw()}},uPt=class{constructor(e,i){this._camera=e,this._dt=0,this._time=0,this._lastUpdate=0,this._lastUpdate=i,this._time=i}advance(e,i,r){const s=i-this._lastUpdate;this._dt=s/r,this._time=this._time+s,this._lastUpdate=i,this._camera=e}forceTime(e){this._lastUpdate=this._time=e,this._dt=0}get camera(){return this._camera}get dt(){return this._dt}get time(){return this._time}},hPt=class{constructor(){this._step=sbe,this._dilation=1,this._firstIdleTime=0}frame(e,i){if(i?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,X("disable-feature:high-quality-idle"))this._dilation=1;else{const s=i?performance.now()-this._firstIdleTime:0;if(s>=ibe+pPt)return this._step=1/0,void(this._dilation=1);this._dilation=s>=ibe?fPt:1}const r=ue(e/dPt,sbe,gPt);this._step===1/0?this._step=r:this._step=this._step*rbe+r*(1-rbe)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const dPt=.5,ibe=12e4,pPt=1e4,fPt=10,rbe=.9,mPt=30,sbe=1e3/1,gPt=1e3/mPt;var gV;(function(t){t[t.SHADOW_CASTERS=0]="SHADOW_CASTERS",t[t.FULL_SCENE=1]="FULL_SCENE"})(gV||(gV={}));const yPt=1e4,TQ=100,vPt=500,_Pt=500,bPt=.1;function wPt(t,e,i,r=gV.SHADOW_CASTERS){let s=0;if(!e.some(o=>!!o.material&&(s+=o.numGeometries,s>=yPt)))return OPt.compute(t,e,r);const n=new cu;return i.forAll(o=>n.union(xPt(t,o))),n}function xPt(t,e){if(!e.visible)return;const i=new cu,r=e.getSpatialQueryAccelerator();return r?SPt(i,t,r):TPt(i,t,e.objects),i}function SPt(t,e,i){const{eye:r,viewForward:s,frustum:n}=e,o=l=>l.visible,a=i.objectCount;if(a<vPt)Jh.set(e.near,Math.min(t.near,e.far)),i.forEachInDepthRange(r,s,Lm.DepthOrder.FRONT_TO_BACK,Jh,(l,c)=>{EQ(t,e,l),Jh.far=t.near,c.setRange(Jh)},n,o),Jh.set(Math.max(t.far,e.near),e.far),i.forEachInDepthRange(r,s,Lm.DepthOrder.BACK_TO_FRONT,Jh,(l,c)=>{EQ(t,e,l),Jh.near=t.far,c.setRange(Jh)},n,o);else{const l=Math.max(Math.min(a,_Pt),Math.ceil(a*bPt)),c=i.findClosest(s,Lm.DepthOrder.FRONT_TO_BACK,n,o,l),h=i.findClosest(s,Lm.DepthOrder.BACK_TO_FRONT,n,o,l);c&&h&&(nbe(t,e,c.boundingVolumeWorldSpace.bounds),nbe(t,e,h.boundingVolumeWorldSpace.bounds))}}function TPt(t,e,i){bE.clear(),i.forAll(r=>{r.visible&&r.geometries.length!==0&&bE.add(r)}),bE.empty||(bE.sort(e),Jh.set(e.near,Math.min(t.near,e.far)),bE.forEachInDepthRange(Jh,Lm.DepthOrder.FRONT_TO_BACK,(r,s)=>{s<t.near&&EQ(t,e,r)}),Jh.set(Math.max(t.far,e.near),e.far),bE.forEachInDepthRange(Jh,Lm.DepthOrder.BACK_TO_FRONT,(r,s,n)=>{t.far=Math.max(t.far,n)}))}function EQ(t,e,i){if(!i.visible||!hb(e.frustum,i.boundingVolumeWorldSpace.bounds))return;const r=i.transformation,s=MPt;i.geometries.forEach(n=>{Bn(s,r,n.transformation);const o=L3(s);D5e(t,e,n.boundingInfo,s,o)})}function D5e(t,e,i,r,s){if(i==null)return;ot(Go,i.center,r);const{eye:n,viewForward:o}=e,a=o[0]*(Go[0]-n[0])+o[1]*(Go[1]-n[1])+o[2]*(Go[2]-n[2]);if(Go[3]=i.radius*s,!(a-Go[3]>t.near&&a+Go[3]<t.far)&&hb(e.frustum,Go))if(i.radius>TQ&&i.getChildren())for(const l of i.getChildren())D5e(t,e,l,r,s);else CQ.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function nbe(t,e,i){const r=e.eye,s=e.viewForward,n=(i[0]-r[0])*s[0]+(i[1]-r[1])*s[1]+(i[2]-r[2])*s[2];t.near=Math.min(t.near,n-i[3]),t.far=Math.max(t.far,n+i[3])}let EPt=class{constructor(){this._items=new ii({allocator:e=>e||{object:null,distance:0,near:0,far:0},deallocator:e=>(e.object=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().object=e}sort(e){const i=e.eye,r=e.viewForward;this._items.forAll(s=>{const n=s.object.boundingVolumeWorldSpace.bounds,o=(n[0]-i[0])*r[0]+(n[1]-i[1])*r[1]+(n[2]-i[2])*r[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(e,i,r){if(i===Lm.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<e.near||n.near>e.far||r(n.object,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<e.near||n.near>e.far||r(n.object,n.near,n.far)}}},CPt=class{constructor(){this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange=new cu(0,0)}compute(e,i,r){this._reset();const{viewMatrix:s}=e;i.forAll(c=>{c.forEachGeometry(h=>{if(!h.visible||r===gV.SHADOW_CASTERS&&!h.castShadow)return;const d=h.boundingSphere,f=s[2]*d[0]+s[6]*d[1]+s[10]*d[2]+s[14],m=f-d[3],g=f+d[3];this._geometries.push(h),this._near.push(-g),this._far.push(-m)})});const n=new cu;if(this._geometries.length===0)return n;for(let c=0;c<this._geometries.length;++c)this._near[c]>n.far&&(n.far=this._near[c]),this._near[c]>2&&this._far[c]<n.near&&(n.near=this._far[c]);const o=this._looseRange;o.near=Math.max(.5*n.near,2),o.far=2*n.far;let a=0,l=0;for(let c=0;c<this._geometries.length;++c)this._near[c]<n.near&&(this._near[c]>=o.near?n.near=this._near[c]:this._nearCandidates[a++]=c),this._far[c]>n.far&&(this._far[c]<=o.far?n.far=this._far[c]:this._farCandidates[l++]=c);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return n;this._nearCandidates.sort((c,h)=>this._near[c]<this._near[h]?-1:this._near[c]>this._near[h]?1:0),this._farCandidates.sort((c,h)=>this._far[c]<this._far[h]?1:this._far[c]>this._far[h]?-1:0);for(let c=0;c<this._nearCandidates.length;++c){const h=this._nearCandidates[c];if(this._near[h]<n.near){const d=this._geometries[h],{boundingInfo:f,shaderTransformation:m}=d;this._includeNearBoundingInfoRec(e,f,m,n)}}for(let c=0;c<this._farCandidates.length;++c){const h=this._farCandidates[c];if(this._far[h]>n.far){const d=this._geometries[h],{boundingInfo:f,shaderTransformation:m}=d;this._includeFarBoundingInfoRec(e,f,m,n)}}return this._reset(),n}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_isOutsideSidePlanes(e,i){const r=e,s=Hm(e);return i[0][0]*r[0]+i[0][1]*r[1]+i[0][2]*r[2]+i[0][3]>s||i[1][0]*r[0]+i[1][1]*r[1]+i[1][2]*r[2]+i[1][3]>s||i[2][0]*r[0]+i[2][1]*r[1]+i[2][2]*r[2]+i[2][3]>s||i[3][0]*r[0]+i[3][1]*r[1]+i[3][2]*r[2]+i[3][3]>s}_includeNearBoundingInfoRec(e,i,r,s){if(i==null)return;const n=i.center;ot(Go,n,r),Go[3]=i.radius*L3(r);const{frustum:o}=e;if(this._isOutsideSidePlanes(Go,o))return;const a=Go[0],l=Go[1],c=Go[2],h=Go[3],{viewMatrix:d}=e,f=d[2]*a+d[6]*l+d[10]*c+d[14],m=f+h;if(!(-(f-h)<2||-m>=s.near))if(-m>this._looseRange.near)s.near=-m;else{if(h>TQ){const g=i.getChildren();if(g!==void 0){for(const v of g)this._includeNearBoundingInfoRec(e,v,r,s);return}}CQ.unionDepthRangeWithAABB(s,e.viewProjectionMatrix,r,i.bbMin,i.bbMax)}}_includeFarBoundingInfoRec(e,i,r,s){if(i==null)return;const n=i.center;ot(Go,n,r),Go[3]=i.radius*L3(r);const{frustum:o}=e;if(this._isOutsideSidePlanes(Go,o))return;const[a,l,c,h]=Go,{viewMatrix:d}=e,f=d[2]*a+d[6]*l+d[10]*c+d[14]-h;if(!(-f<=s.far))if(-f<this._looseRange.far)s.far=-f;else{if(h>TQ){const m=i.getChildren();if(m!==void 0){for(const g of m)this._includeFarBoundingInfoRec(e,g,r,s);return}}CQ.unionDepthRangeWithAABB(s,e.viewProjectionMatrix,r,i.bbMin,i.bbMax)}}},$Pt=class{constructor(){this._modelViewProj=qe(),this._clipPosition=[yi(),yi(),yi(),yi(),yi(),yi(),yi(),yi()]}unionDepthRangeWithAABB(e,i,r,s,n){const o=this._modelViewProj;Bn(o,i,r);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],h=l===0||l===3||l===4||l===7?s[0]:n[0],d=l===0||l===1||l===4||l===5?s[1]:n[1],f=l<4?s[2]:n[2];c[0]=o[0]*h+o[4]*d+o[8]*f+o[12],c[1]=o[1]*h+o[5]*d+o[9]*f+o[13],c[2]=o[2]*h+o[6]*d+o[10]*f+o[14],c[3]=o[3]*h+o[7]*d+o[11]*f+o[15]}for(let l=0;l<12;++l){const c=APt(this._clipPosition[m7[l][0]],this._clipPosition[m7[l][1]],this._clipPosition[m7[l][2]]);let h=!0;for(let d=0;d<c.length;++d)if(c[d][3]>=2){h=!1;break}if(!h){a=!0;for(let d=0;d<c.length;++d){const f=c[d][3];Number.isFinite(f)&&(e.near=Math.min(f,e.near),e.far=Math.max(f,e.far))}}}return a}};function APt(t,e,i){let r=[t,e,i];for(let s=0;s<4;++s){const n=r;r=[];for(let o=0;o<n.length;++o){const a=n[o],l=n[(o+1)%n.length];f7(l,s)?(f7(a,s)||r.push(obe(a,l,s)),r.push(l)):f7(a,s)&&r.push(obe(a,l,s))}}return r}function f7(t,e){return e===0?t[0]>=-t[3]:e===1?t[1]>=-t[3]:e===2?t[0]<=t[3]:e===3?t[1]<=t[3]:void Zt(!1)}function obe(t,e,i){let r=0;return i===0?r=(-t[3]-t[0])/(e[0]-t[0]+e[3]-t[3]):i===1?r=(-t[3]-t[1])/(e[1]-t[1]+e[3]-t[3]):i===2?r=(t[3]-t[0])/(e[0]-t[0]-e[3]+t[3]):i===3&&(r=(t[3]-t[1])/(e[1]-t[1]-e[3]+t[3])),VG(yi(),t,e,r)}const m7=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],Go=Ls(),MPt=qe(),Jh=new cu,bE=new EPt,OPt=new CPt,CQ=new $Pt,IPt={idleOpacity:.8,navigatingOpacity:.4,maxDelta:.1,tiltFadeStart:20,tiltFadeEnd:30,altitudeStart:1e4,altitudeEnd:2e4};let RPt=class{constructor(e){this._fbos=e,this._requiresEmission=!1,this._size=new Hvt(0,0),this._clearColor=yi()}dispose(){this._color=Lr(this._color),this.releaseDepth()}initialize(e,i,r,s){this._size.width=e,this._size.height=i,Px(this._size,this._fbos.rctx.parameters.maxTextureSize);const n=this._color;return this._color=null,this.releaseDepth(),this._requiresEmission=s,xd(this._clearColor,r),n}releaseDepth(){var e;(e=this._color)==null||e.detachDepth(),this._depth=Lr(this._depth)}update(e){const i=this._ensureColor();i.attachDepth(this.depth),this._color=e(i)}bind(){const e=this._color==null;if(this.color.attachDepth(this.depth),this._fbos.rctx.bindFramebuffer(this.color.fbo),e){const i=this._fbos.rctx;i.setClearStencil(0),i.setClearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3]),i.clear(Mi.COLOR|Mi.DEPTH|Mi.STENCIL),this._requiresEmission&&i.gl.clearBufferfv(i.gl.COLOR,1,Hae)}}_acquireColor(){return this._requiresEmission?this._fbos.acquire(this._size.width,this._size.height,"acquired-color").acquireColor(nr.COLOR_ATTACHMENT1,gr.RGBA,"emissive"):this._fbos.acquire(this._size.width,this._size.height,"acquired-color")}_acquireDepth(){return this._fbos.acquireDepth(Ho.DEPTH_STENCIL_TEXTURE,this._size.width,this._size.height,"depth")}get size(){return this._size}get color(){return this._ensureColor()}get depth(){return this._depth??(this._depth=this._acquireDepth()),this._depth}_ensureColor(){return this._color??(this._color=this._acquireColor()),this._color}},PPt=class{constructor(){this._inputs=new Map}set(e,i){this._inputs.set(e,i)}get(e){return this._inputs.get(e)}has(e){return this._inputs.has(e)}release(e){var i;(i=this._inputs.get(e))!=null&&i.release()&&this._inputs.delete(e)}};const VL=255,DPt=1/VL;function L5e(){const t=new Vi,e=t.fragment;return e.include(uw),e.include(Sg),t.include(x6),t.include(ia),t.include($L,LPt),e.uniforms.add(new oo("shadowMap",i=>i.shadowMap.depthTexture),new oo("depthMap",i=>{var r;return(r=i.depth)==null?void 0:r.attachment}),new $o("inverseViewMatrix",i=>$l(abe,uh(abe,i.camera.viewMatrix,i.camera.center)))),e.constants.add("sampleValue","float",DPt),t.outputs.add("sampleCount","float"),e.main.add(E`sampleCount = 0.0;
float depth = depthFromTexture(depthMap, uv);
if (depth >= 1.0 || depth <= 0.0) {
return;
}
float currentPixelDepth = linearizeDepth(depth);
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
return;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
return;
}
ivec2 texSize = textureSize(shadowMap, 0);
ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));
float depthShadow = readShadowMapDepth(uvShadow, shadowMap);
bool shadow = depthShadow < lvpos.z;
if (shadow) {
sampleCount = sampleValue;
}`),t}const abe=qe(),LPt=new Vae,NPt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:VL,build:L5e},Symbol.toStringTag,{value:"Module"}));var RA;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(RA||(RA={}));let $Q=class extends hu{constructor(){super(...arguments),this.visualization=RA.Gradient,this.bandsEnabled=!1}};u([ie({count:RA.COUNT})],$Q.prototype,"visualization",void 0),u([ie()],$Q.prototype,"bandsEnabled",void 0);let Wae=class extends cr{constructor(e){super(),this._data=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=UG(FPt),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}};const FPt=Yi(.01,0,.25,1);function N5e(t){const e=new Vi,i=e.fragment;e.include(x6),e.include(ia);const{visualization:r,bandsEnabled:s}=t;i.constants.add("inverseSampleValue","float",VL),i.uniforms.add(new It("shadowCastMap",a=>a.shadowCastMap),new mt("sampleScale",a=>a.sampleScale),new mt("opacityFromElevation",a=>a.opacityFromElevation),new pc("uColor",a=>a.color));const n=r===RA.Gradient,o=r===RA.Threshold;return n&&s?i.uniforms.add(new mt("bandSize",a=>a.bandSize)):o&&i.uniforms.add(new mt("threshold",a=>a.threshold)),i.main.add(E`
    float record = texture(shadowCastMap, uv).r;
    float pixelSamples = record * inverseSampleValue;

    fragColor = vec4(0.0);
    if (pixelSamples < 1.0) {
      return;
    }

    float strength = pixelSamples * sampleScale;
    ${o?E`if (strength <= threshold) return;`:""}
    ${n&&s?E`strength = ceil(strength / bandSize) * bandSize;`:""}
    fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?"* strength":""});
  `),e}const kPt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:Wae,build:N5e},Symbol.toStringTag,{value:"Module"}));let lbe=class extends Hi{constructor(e,i){super(e,i,new Bi(kPt,()=>G(()=>Promise.resolve().then(()=>$Ht),void 0))),this.primitiveType=Gi.TRIANGLE_STRIP}initializePipeline(){return wi({blending:Ld,colorWrite:Di,depthTest:null,depthWrite:null})}};const zPt=4e4,UPt=5e4,F5e=1/512;let vz=class extends he{constructor(e,i,r,s){super({}),this._techniques=e,this._rctx=i,this._data=r,this._requestRender=s,this._passParameters=new Wae(this._data),this._configuration=new $Q,this._enabled=!1,this._vao=mw(i)}dispose(){this._stop(),this._vao=Dt(this._vao)}precompile(){this._showVisualization&&this._techniques.precompile(lbe,this._configuration)}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const i=this._techniques.get(lbe,this._configuration);this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(i,e,this._passParameters),this._rctx.drawArrays(i.primitiveType,0,uA(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>F5e}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfEnabled())}get _visualization(){return this._configuration.visualization}set _visualization(e){e!==this._visualization&&(this._configuration.visualization=e,this._requestRenderIfEnabled())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfEnabled())}get _bandsEnabled(){return this._configuration.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._configuration.bandsEnabled=e,this._requestRenderIfEnabled())}_setColor(e){const i=this._passParameters.color;tS(e,i)||(xd(this._passParameters.color,e),this._requestRenderIfEnabled())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};u([p()],vz.prototype,"opacityFromElevation",null),vz=u([A("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],vz);let cbe=class extends Hi{constructor(e,i){super(e,i,new Bi(NPt,()=>G(()=>Promise.resolve().then(()=>AHt),void 0))),this.primitiveType=Gi.TRIANGLE_STRIP}initializePipeline(){return wi({blending:Npt,colorWrite:Di,depthTest:null,depthWrite:null})}},ql=class extends he{constructor(e,i,r,s,n,o){super({}),this.fbos=e,this._techniques=i,this._stage=r,this._prepareForShadowMapPass=s,this._renderToShadowMap=n,this._requestRender=o,this._progress=0,this._sampleCount=0,this._passParameters=new roe,this._cachedLightDirections=[],this._depthRange=cu.zero,this._previewing=!1,this._cameraForcedForScreenshot=!1,this._shadowAccumulatorKey="shadowAccumulator",this._rctx=e.rctx,this._bindParameters=new _oe(new boe(e,r.viewingMode)),this._bindParameters.shadowMap.enabled=!0,this._vao=mw(this._rctx),this._accumulationRenderer=new vz(i,this._rctx,this,o);const a=this._stage.view.resourceController.scheduler;this.addHandles([a.registerTask(lt.SHADOW_ACCUMULATOR,this),H(()=>r.renderView,l=>{this.removeHandles(ube),l!=null&&this.addHandles(l.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),ube)},Mt),H(()=>this._previewing,()=>this._requestRenderIfEnabled(),Yt)],this._shadowAccumulatorKey),i.precompile(cbe)}normalizeCtorArgs(){return{}}dispose(){this._disable(),this.removeHandles(this._shadowAccumulatorKey),this._accumulationRenderer=Dt(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=Dt(this._fbo),this._vao=Dt(this._vao),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){var e;return(e=this._fbo)==null?void 0:e.colorTexture}get accumulating(){return this._active&&this._previewing||this._refining}get _refining(){return this._active&&!this._doneAccumulating&&!this._previewing}get _active(){return this._fbo!=null&&this._sampleCount>0}get canAccumulate(){return this._bindParameters.depth!=null&&this._depthRange!==cu.zero&&this._opacityFromElevation>F5e}get _doneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const i=this._cachedLightDirections;if(eg(i,e,aA))return;const r=Math.min(VL,e.length);i.length=r,this._sampleCount=r;for(let s=0;s<r;++s)i[s]=ne(i[s]??$(),e[s]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._refining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._doneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,i,r,s){if(this._depthRange=i,this._updateCamera(r),this._bindParameters.contentCamera=s,this._bindParameters.depth=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.accumulating||!this.canAccumulate)return!1;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();let n=this._cameraForcedForScreenshot?this._sampleCount:Math.min(BPt,this._sampleCount);n-=this._progress;for(let o=0;o<n;++o)this._accumulateShadow(),this._requestRender();return this._cameraForcedForScreenshot=!1,n>0}precompile(){this._accumulationRenderer.precompile()}render(e){this._accumulationRenderer.render(e)}setOptions(e){if(e.enabled!==void 0){const i=this._fbo!=null;e.enabled!==i&&(e.enabled?this._enable():this._disable())}e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,i){return!this._active||!this._fbo||this._progress<1||e<0||e>=this._fbo.width||i<0||i>=this._fbo.height?0:(this._fbo.readPixels(e,i,1,1,Tt.RGBA,Xa.UNSIGNED_BYTE,hbe),hbe[0]/this._progress)}_enable(){this._progress=0;const e=new Ar;e.pixelFormat=Tt.RED,e.internalFormat=rt.R8,e.wrapMode=ar.CLAMP_TO_EDGE,this._fbo=new Eg(this._rctx,e),this._requestRender()}_disable(){this._fbo=Dt(this._fbo),this._requestRender()}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clear(Mi.COLOR),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._lightDirections[this._progress++],this._depthRange);const e=this._techniques.get(cbe);this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._bindParameters,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,uA(this._vao,"geometry"))}_updateCamera(e){const i=this._fbo;if(i==null)return;const r=this._bindParameters.camera;e.equals(r)||r.copyFrom(e),i.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-h3(zPt,UPt,e.relativeElevation)}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){}};u([p()],ql.prototype,"_progress",void 0),u([p()],ql.prototype,"_sampleCount",void 0),u([p()],ql.prototype,"_fbo",void 0),u([p()],ql.prototype,"_depthRange",void 0),u([p()],ql.prototype,"_previewing",void 0),u([p()],ql.prototype,"_accumulationRenderer",void 0),u([p()],ql.prototype,"_refining",null),u([p()],ql.prototype,"_active",null),u([p()],ql.prototype,"canAccumulate",null),u([p()],ql.prototype,"_doneAccumulating",null),u([p()],ql.prototype,"_opacityFromElevation",null),u([p()],ql.prototype,"running",null),ql=u([A("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],ql);const BPt=6,ube="renderView",hbe=new Uint8Array(4),VPt=lw();let jPt=class{constructor(){this._plane=lw()}get plane(){return this._plane}set plane(e){lT(e||VPt,this._plane)}},dbe=class{constructor(e,i,r,s,n,o,a,l,c){this.createQuery=e,this.deleteQuery=i,this.resultAvailable=r,this.getResult=s,this.disjoint=n,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}},yy=!1;function GPt(t,e){if(e.disjointTimerQuery)return null;let i=t.getExtension("EXT_disjoint_timer_query_webgl2");return i?new dbe(()=>t.createQuery(),r=>{t.deleteQuery(r),yy=!1},r=>t.getQueryParameter(r,t.QUERY_RESULT_AVAILABLE),r=>t.getQueryParameter(r,t.QUERY_RESULT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{yy||(yy=!0,t.beginQuery(i.TIME_ELAPSED_EXT,r))},()=>{t.endQuery(i.TIME_ELAPSED_EXT),yy=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>t.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):(i=t.getExtension("EXT_disjoint_timer_query"),i?new dbe(()=>i.createQueryEXT(),r=>{i.deleteQueryEXT(r),yy=!1},r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_AVAILABLE_EXT),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_EXT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{yy||(yy=!0,i.beginQueryEXT(i.TIME_ELAPSED_EXT,r))},()=>{i.endQueryEXT(i.TIME_ELAPSED_EXT),yy=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):null)}function HPt(t,e){const i=t.capabilities.disjointTimerQuery;return i==null?null:new qPt(i,e)}let qPt=class{constructor(e,i){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,i.forEach(r=>{const s=this._timer.createQuery(),n=this._timer.createQuery();this._queryPool.push(s,n),this._queryResults.set(r,null)})}start(){yy||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const i=this._queryResults.get(e);if(i==null)return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(i))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const r=this._timer.getResult(i)/1e6;return this._queryPool.unshift(i),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,r}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{e!=null&&this._timer.deleteQuery(e)})}};var Ms;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.DEPTH="depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.APPLY_ACCUMULATED_SHADOWS="apply accumulated shadows",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.NORMALS="normals",t.SSAO="SSAO",t.HIGHLIGHTS="highlights",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.TRANSPARENT_MATERIAL_WITHOUT_DEPTH="transparent material without depth",t.OPAQUE_ENVIRONMENT="opaque environment",t.TRANSPARENT_ENVIRONMENT="transparent environment",t.OCCLUDED="occluded",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish",t.FOCUS_AREA_MASK="focus area mask"})(Ms||(Ms={}));const g7=Object.values(rr).concat(Object.values(dt)).concat(Object.values(Ms)),pbe="Total";let WPt=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new Xy(pbe),this._cpuTimeSamplers=new Map(g7.map(i=>[i,new Xy(i)])),this._enableGPUTimer=0,this._totalGPUTime=new Xy("GPU"),this._gpuTimeSamplers=new Map(g7.map(i=>[i,new Xy(i)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){const i=[...g7,pbe];this._gpuTimerPool=HPt(this._rctx,i)}if(this._gpuTimerPool==null)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;let e=!1;return{hasGPUTimerSupport:!0,remove:()=>{e||(e=!0,--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=Dt(this._gpuTimerPool)))}}}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool&&(this._gpuTimeSamplers.forEach(e=>e.push(0)),this._gpuTimerPool.start())}advance(e){const i=performance.now();if(this._cpuTimeSamplers.get(e).push(i-this._lastTimeStampCPU),this._lastTimeStampCPU=i,this._gpuTimerPool){const r=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).set(r),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool){const i=this._gpuTimerPool.stop(Ms.FINISH);this._gpuTimeSamplers.get(Ms.FINISH).set(i),this._rctx.gl.flush()}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.push(e),this._gpuTimerPool&&this._totalGPUTime.push(this.gpuTimeSamplers.reduce((i,r)=>i+(r.last||0),0)),++this._totalFrameCount}};class _z{constructor(e,i,r,s,n,o){this._stage=e,this._techniques=r,this._rctx=s,this._compositingHelper=n,this._requestRender=o,this._pluginsHas={hudElements:!1,water:!1},this._renderers=new Map,this.renderPassManager=new SQ,this._isRendering=!1,this._inGlobeView=!1,this._backgroundColor=Yi(0,0,0,1),this._sliceHelper=new jPt,this._blit=null,this._oitblend=null,this._state=Ta(ui.IDLE),this._highQualityTransparencyEnabled=!0,this._ssrEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new hPt,this._loadEdgeViewTask=null,this._edgeViewCallbacks=[],this._reprojectionMatrixVersion=Ta(0),this._lastFrameTime=0,this._renderHiddenTransparentEdges=()=>{},this._pluginInput=new PPt,this._releaseNormals=a=>{a.some(({name:l})=>l==="normals")&&this._pluginInput.release("normals")},this._debugNeedsDepth=!1,this.fboCache=new KRt(s),this._renderStateFeatures=Ta(hye(!X("disable-feature:high-quality-idle"),e.view.qualityProfile)),this._framebuffer=new RPt(this.fboCache),this.performanceInfo=new WPt(this._rctx),this._shadowMap=new boe(this.fboCache,e.viewingMode),this._shadowAccumulator=new ql(this.fboCache,r,e,a=>{const l=this.shadowsEnabled;this._shadowMap.enabled=!0,this._ensureBindParametersCamera(a.camera,a.contentCamera),this._plugins.prepareRender(),this._shadowMap.enabled=l},(a,l,c)=>{const h=this._stage.view.qualitySettings.maximumPixelRatio;a.shadowMap.start(a.camera,l,c,!0,h),this._renderShadowCascades(Y.Shadow,a.shadowMap),a.shadowMap.finish(),a.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(a.camera,a.contentCamera)},o),this._renderContext=new Wvt(this._rctx,this._shadowMap,r),this._nodes=new nPt(this._renderContext),this._plugins=new oPt({renderContext:this._renderContext,techniques:r,materials:i,requestRender:o,controller:e,fbos:this.fboCache,isFeatureEnabled:a=>this.isFeatureEnabled(a)}),this._plugins.add(this.renderPassManager),this._handles=[H(()=>this._stage.view.state.camera,()=>o(),Mt),H(()=>xs.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,a=>{this._renderHiddenTransparentEdges=a?()=>this._renderEdges(od.TRANSPARENT):()=>{},o()},Ut),H(()=>{var a;return(a=this._stage.view.environment.background)==null?void 0:a.color},a=>{const l=a?Dae(a):an;ss(this._backgroundColor,l[0]*l[3],l[1]*l[3],l[2]*l[3],l[3]),o()},Mt),H(()=>this._stage.view.state.camera.relativeElevation,a=>this._inGlobeView=(a??1/0)>=PB,Mt),H(()=>this._bindParameters.clouds.fadeFactor,()=>this._bindParameters.fadeLighting(),Yt),H(()=>{var a;return(a=this._bindParameters.clouds.data)==null?void 0:a.state},()=>o(),Yt),H(()=>this._stage.view.state.highlights,a=>{this._bindParameters.highlights=a,this._updateHighlights(),o()},Ut)]}destroy(){this._handles.forEach(e=>e.remove()),this._gpuTimerHandle=Ji(this._gpuTimerHandle),this._nodes.destroy(),this._framebuffer.dispose(),this._shadowMap.dispose(),this._shadowAccumulator.dispose(),this._loadEdgeViewTask=fc(this._loadEdgeViewTask),this._edgeView=$e(this._edgeView),this.renderPassManager.dispose(),this._releaseFBOs(),this._disposeOffscreenBuffers(),this.fboCache.destroy(),this._plugins.destroy(),this._renderers.clear(),this._blit=null,this._oitblend=null,LPe.prune(),Fx.prune(),Vct()}get renderContext(){return this._renderContext}get _bindParameters(){return this._renderContext.bind}get _framebufferSize(){return this._framebuffer.size}updateRenderFeatures(e=null,i=!X("disable-feature:high-quality-idle")){this._renderStateFeatures.value=hye(i,e),this._requestRender()}isFeatureEnabled(e,i=this._state.value){return this._renderStateFeatures.value.get(i,e)??!1}setFeatureEnabled(e,i,r){this._renderStateFeatures.mutate(s=>s.set(i,e,r)),this._requestRender()}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(Hs.HighQualityTransparency)}get hasReflections(){return this._pluginsHas.water&&(this._ssrEnabled||this.isFeatureEnabled(Hs.WaterReflection))}get _hasHighlights(){return this._plugins.produces(Y.Highlight,xe.OPAQUE_MATERIAL,xe.TRANSPARENT_MATERIAL,xe.DRAPED_MATERIAL,xe.HUD_MATERIAL,xe.LABEL_MATERIAL)}hasHighlightOptions(e){return this._plugins.hasHighlightOptions(e)}get _hasHUDHighlights(){return this._plugins.produces(Y.Highlight,xe.HUD_MATERIAL,xe.LABEL_MATERIAL)}get hasSSAO(){return(this._stage.view.qualitySettings.ambientOcclusion||this.isFeatureEnabled(Hs.SSAO))&&!this._inGlobeView}get hasSMAA(){return this._stage.view.qualitySettings.antialiasingEnabled||this.isFeatureEnabled(Hs.Antialiasing)}get fullResolutionAtmosphere(){return this._stage.view.qualitySettings.highResolutionAtmosphere||this.isFeatureEnabled(Hs.HighResolutionAtmosphere)}_releaseFBOs(){this._bindParameters.ssr.lastFrameColor=Lr(this._bindParameters.ssr.lastFrameColor),this._bindParameters.terrainDepth=Lr(this._bindParameters.terrainDepth),this._bindParameters.geometryDepth=Lr(this._bindParameters.geometryDepth)}_disposeOffscreenBuffers(){this._framebuffer.dispose(),this._disposeBindBuffers()}_disposeBindBuffers(){this._shadowMap.disposeOffscreenBuffers(),this._bindParameters.depth=Lr(this._bindParameters.depth),this._bindParameters.hudVisibility=Lr(this._bindParameters.hudVisibility)}get updating(){return this._edgeView!=null&&this._edgeView.updating||this._shadowAccumulator.running||this._plugins.updating||!this.isCameraFinal}loadEdgeView(){return this._loadEdgeViewTask||(this._loadEdgeViewTask=gg(async e=>{const{EdgeView:i}=await G(()=>import("./EdgeView-Cgvof-Dj.js"),__vite__mapDeps([364,32,33,365,31]));gt(e);const r=this._edgeView=new i({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniques:this._techniques,setNeedsRender:()=>this._requestRender(),schedule:XPt(this._stage.view.resourceController)});return this._handles.push(H(()=>r.updating,()=>this._requestRender(),Yt)),this._requestRender(),this._edgeViewCallbacks.forEach(s=>s(r)),this._edgeViewCallbacks.length=0,r})),this._loadEdgeViewTask.promise}withEdgeView(e){this.loadEdgeView(),this._edgeView==null?this._edgeViewCallbacks.push(e):e(this._edgeView)}get edgeView(){return this._edgeView}get isCameraFinal(){return this._reprojectionMatrixVersion.value>=0&&Sre(this._bindParameters.ssr.reprojectionMatrix,eo)}set _reprojectionMatrix(e){GVe(this._bindParameters.ssr.reprojectionMatrix,e)&&this._reprojectionMatrixVersion.value++}get shadowsEnabled(){var e;return!!((e=this._shadowMap)!=null&&e.enabled)}setParameters(e){var s;const{_shadowMap:i,_bindParameters:r}=this;if(((s=e.qualitySettings)==null?void 0:s.reflections)!==void 0&&this._ssrEnabled!==e.qualitySettings.reflections&&(this._ssrEnabled=e.qualitySettings.reflections,this._requestRender()),e.shadowMap!==void 0&&this._shadowMap.enabled!==e.shadowMap&&(this._shadowMap.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&i.maxCascades!==e.shadowMapMaxCascades&&(i.maxCascades=e.shadowMapMaxCascades,this._requestRender()),e.environment!=null){e.environment.weather!=null&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=!!e.weatherVisible);const n=e.environment.lighting.type!=="virtual";r.enableFillLights!==n&&(r.enableFillLights=n,this._requestRender())}e.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==e.highQualityTransparency&&(this._highQualityTransparencyEnabled=e.highQualityTransparency,this._requestRender()),e.shadowCast!==void 0&&this._shadowAccumulator.setOptions(e.shadowCast)}set slicePlane(e){this._sliceHelper.plane!==e&&(this._sliceHelper.plane=e,this._requestRender())}get plugins(){return this._plugins}getMaterialRenderer(e){return this._renderers.get(e)}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(e,i){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:r,removes:s,updates:n}=e;r.length===0&&s.length===0&&n.length===0||(XDe(e).forEach((o,a)=>{if(i.done)return;let l=this._renderers.get(a);l==null&&o.adds.length>0&&(l=new Fx({material:a,highlightOrderMap:this._stage.view.state.highlightOrderMap}),l.initializeRenderContext(this._plugins.context),this._plugins.add(l),this._renderers.set(a,l)),l&&(l.modify(o),l.updateHighlights(this._stage.view.state.highlightOrderMap),l.numGeometries===0&&(this._renderers.delete(l.material),this._plugins.remove(l),l.destroy())),o.removes.forEach(c=>e.removes.removeUnordered(c)),o.adds.forEach(c=>e.adds.removeUnordered(c)),o.updates.forEach(c=>e.updates.removeUnordered(c)),i.madeProgress()}),this.updateHasFlags())}updateHasFlags(){const e=this._pluginsHas;e.hudElements=this._plugins.produces(Y.Color,...NO),e.water=this._plugins.produces(Y.Normal,xe.DRAPED_WATER),this._bindParameters.hasOccludees=this._plugins.hasOccludees,this._requestRender()}updateAnimation(e,i){this._animationTimer??(this._animationTimer=new uPt(e.camera,i)),this._animationTimer.advance(e.camera,i,this._animationTimeDilation),e.forcedAnimationTime!=null&&this._animationTimer.forceTime(e.forcedAnimationTime);const r=this._hasAnimations;return this._hasAnimations=this._plugins.updateAnimation(this._animationTimer),this._hasAnimations=this._nodes.updateAnimation(this._animationTimer)||this._hasAnimations,this._hasAnimations!==r&&(this._gpuTimerHandle=r?Ji(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get _animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}tick(){this.fboCache.clean()}render(e,i,r=zp.Default,s=!1){try{return this._isRendering=!0,this._render(e,i,r,s)}catch(n){console.error(`Exception during rendering: ${n}`)}finally{this._isRendering=!1}return new Nve(this._pluginInput.get(rr.FINAL),null)}_updateHUDOccludedFragmentOpacity(e,i){const{idleOpacity:r,navigatingOpacity:s,maxDelta:n,tiltFadeStart:o,tiltFadeEnd:a,altitudeStart:l,altitudeEnd:c}=IPt,h=this._stage.view,d=h.stateManager.camera,f=h.qualitySettings.fadeDuration,m=e===ui.IDLE?r:s,g=ue((d.tilt-o)/(a-o),0,1),v=ue((d.position.z??0-l)/(c-l),0,1),_=ft(ft(1,m,g),1,v),b=this._bindParameters.hudOccludedFragmentOpacity;if(f<=0||b===_||this._lastFrameTime===0||this._lastFrameTime>i)return this._bindParameters.hudOccludedFragmentOpacity=_,void(this._lastFrameTime=i);const w=i-this._lastFrameTime;this._lastFrameTime=i;const x=Math.min(Math.abs(r-s)*w/f,n);x>=Math.abs(_-b)?this._bindParameters.hudOccludedFragmentOpacity=_:(this._bindParameters.hudOccludedFragmentOpacity=b+Math.sign(_-b)*x,this._requestRender())}_render(e,i,r=zp.Default,s){var F,L,N,R,k,W,j;this.performanceInfo.startFrame(),this.fboCache.frameStart(),this.fboCache.interactive=r===zp.Default,this._disposeBindBuffers();const{camera:n,contentCamera:o,mode:a,alignPixelEnabled:l}=e;this._state.value=a;const c=this._nodes.produces("magnifier-color"),h=this._nodes.produces(rr.FINAL),d=this._nodes.require("emissive",rr.FINAL,rr.COMPOSITE)>0&&this._plugins.hasEmissions,f=d?Y.ColorEmission:Y.Color;this._renderContext.time=i,this._renderContext.output=f,this._bindParameters.oitPass=Ti.NONE,this._bindParameters.alignPixelEnabled=l,this._bindParameters.decorations=!s,this._bindParameters.mainDepth=null,this._bindParameters.slicePlane=this._sliceHelper.plane,this._bindParameters.viewshedEnabled=this._nodes.produces(dt.VIEWSHED),this._renderOverlay(i),n.setGLViewport(this._rctx);const m=this._framebuffer,g=m.initialize(n.fullWidth,n.fullHeight,this._backgroundColor,d);this.hasReflections?(g==null||g.setName("last frame color"),this._bindParameters.ssr.lastFrameColor=g):g==null||g.release(),this._ensureBindParametersCamera(n,o),this._updateHUDOccludedFragmentOpacity(a,i),this._plugins.prepareRender(),this._bindParameters.shadowHighlightsVisible=this._needsShadowHighlight&&!s;const v=this._highQualityTransparency&&this._hasTransparentTerrain,_=this._plugins.produces(Y.Color,...LO);this._precompilePrepasses(),this.performanceInfo.advance(Ms.PREPARE);const b=this._computeDepthRange(n);this._renderShadowMap(n,this._bindParameters.lighting.mainLight.direction,b),this._ensureBindParametersCamera(n,o),this._pluginInput.set("normals",this._renderNormals()),this._renderRemainingGeometryDepth(),this._renderShadowAccumulation(b,n,o),this._ensureBindParametersSSR(i),this._precompileShaders(v,_,f),this._renderContext.output=f,m.bind(),this._bindParameters.mainDepth=m.depth.attachment;const w=this.plugins.produces(Y.Color,...y7);w&&this._renderOpaqueGeometry(),m.update(B=>this._renderNodes(rr.OPAQUE,B,w)),(L=(F=this.fboCache).debugCallback)==null||L.call(F,rr.OPAQUE,m.color.fbo),m.update(B=>this._renderNodes(dt.OPAQUE_ENVIRONMENT,B)),(R=(N=this.fboCache).debugCallback)==null||R.call(N,dt.OPAQUE_ENVIRONMENT,m.color.fbo),this._renderTerrainDepth(v),this._renderEdges(od.OPAQUE),m.bind(),this._renderPlugins(xe.VOXEL,Ms.VOXEL),this._renderHiddenTransparentEdges(),_&&(this._oitEnabled?this._renderOIT(MC.Geometry,f):this._renderTransparentGeometry()),m.update(B=>this._renderNodes(rr.TRANSPARENT,B,_)),(W=(k=this.fboCache).debugCallback)==null||W.call(k,rr.TRANSPARENT,m.color.fbo),this._renderGeometryDepth(v),this._renderHUDVisibility(),v||this._plugins.render(this._pluginInput,xe.LINE_CALLOUTS),this._renderEdges(od.TRANSPARENT);const x=this._hasTransparentTerrain?this._renderTransparentTerrain():null;x&&(this.performanceInfo.advance(Ms.TRANSPARENT_TERRAIN),this._bindParameters.hudVisibility&&(v?this._renderLineCallouts(fa.Occluded):(this._rctx.bindFramebuffer((j=this._bindParameters.hudVisibility)==null?void 0:j.fbo),this._compositingHelper.compositeHUD(this._bindParameters,x.getTexture())),this._renderHUD(fa.Occluded,m.color,f))),this._bindParameters.cullAboveTerrain=!1,x&&(m.bind(),this._compositingHelper.compositePreMultipliedAlpha(this._bindParameters,x.getTexture()),x.release(),v&&(this._renderEdges(od.OPAQUE),_&&(this._oitEnabled?this._renderOIT(MC.Geometry,f):this._renderTransparentGeometry(),this.performanceInfo.advance(Ms.TRANSPARENT)),this._renderEdges(od.TRANSPARENT))),this._bindParameters.ssao=Lr(this._bindParameters.ssao),v&&this._renderLineCallouts(fa.NotOccluded),this._bindParameters.terrainDepthTest=!1,this._renderTransparentEnvironment(),this._pluginInput.set(dt.FOCUSAREA,this._renderFocusAreaGeometry()),m.update(B=>this._renderNodes(dt.TRANSPARENT_ENVIRONMENT,B)),m.update(B=>this._renderNodes(dt.VIEWSHED,B)),m.update(B=>this._renderNodes(dt.LASERLINES,B)),m.update(B=>this._renderNodes(dt.OCCLUDED,B)),this._pluginInput.set("highlights",this._renderHighlightPrepass());const S=r===zp.ObjectAndLayerID?this._renderObjectAndLayerIdColor():null;m.update(B=>this._renderNodes(rr.COMPOSITE,B)),this._pluginInput.release(dt.FOCUSAREA);const C=!(r!==zp.Default||h||c&&!s),T=this._pluginInput.get(rr.COMPOSITE),M=C?fb:this.fboCache.acquire(T.fbo.width,T.fbo.height,dt.ANTIALIASING),I=this._nodes.produces(dt.ANTIALIASING)?this._renderNodes(dt.ANTIALIASING,M):this._blitFBO(T,M,!1);let D;this._pluginInput.set(dt.ANTIALIASING,I),this._hasHUDHighlights?(this._renderHUD(fa.NotOccluded,I,f),D=this._renderNodes(dt.HIGHLIGHTS,I)):(D=this._renderNodes(dt.HIGHLIGHTS,I),this._renderHUD(fa.NotOccluded,D,f));const P=this._renderNodes(dt.MAGNIFIER,D);return c&&!s&&r===zp.Default&&!h&&this._blitFBO(P),h?(P.attachDepth(m.depth),this._blitFBO(this._renderNodes(rr.FINAL,P)),P.detachDepth()):this._pluginInput.set(rr.FINAL,P),this._pluginInput.release("highlights"),this.onPostRender&&this.onPostRender(),this._releaseFBOs(),m.releaseDepth(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this.fboCache.frameEnd(),this.performanceInfo.finishFrame(),r!==zp.Default&&(this._releaseFBOs(),this._disposeOffscreenBuffers()),new Nve(this._pluginInput.get(rr.FINAL),S)}_precompileShaders(e,i,r){if(++this._plugins.context.techniques.precompiling,this._renderContext.output=r,this._precompileOpaqueGeometry(),this._nodes.precompile(dt.OPAQUE_ENVIRONMENT),this._bindParameters.terrainDepthTest=e,this._bindParameters.cullAboveTerrain=e,this._renderContext.output=Y.Depth,this._plugins.precompile(xe.TRANSPARENT_TERRAIN),e&&(this._precompileOpaqueGeometry(),this._precompileTransparentGeometry()),this._renderContext.output=r,this._plugins.precompile(xe.TRANSPARENT_TERRAIN),i&&(this._precompileTransparentGeometry(),this._hasTransparentTerrain&&(this._bindParameters.cullAboveTerrain=!1,this._precompileTransparentGeometry(),this._bindParameters.cullAboveTerrain=e)),this._nodes.precompile(dt.FOCUSAREA),this._needsHUDVisibility&&this._plugins.precompile(xe.OCCLUSION_PIXELS),this._plugins.precompile(xe.LINE_CALLOUTS),this._precompileHUD(fa.Occluded),this._bindParameters.terrainDepthTest=!1,this._bindParameters.cullAboveTerrain=!1,this._nodes.precompile(dt.VIEWSHED,dt.LASERLINES,dt.OCCLUDED,dt.ANTIALIASING,dt.HIGHLIGHTS),this._precompileHUD(fa.NotOccluded),this._hasHighlights){const s=this._bindParameters;s.highlights.forEach((n,o)=>{s.highlightLevel=o,this._precompileAllGeometry(Y.Highlight)}),s.highlightLevel=null}this._nodes.precompile(rr.COMPOSITE,dt.MAGNIFIER),this._shadowAccumulator.precompile(),this._plugins.precompile(xe.TRANSPARENT_MATERIAL_WITHOUT_DEPTH),--this._plugins.context.techniques.precompiling}_updateHighlights(){const e=this._stage.view.state;this._renderers.forEach(i=>i.updateHighlights(e.highlightOrderMap))}_renderFocusAreaGeometry(){if(!this._nodes.produces(dt.FOCUSAREA))return null;const{width:e,height:i}=this._framebufferSize;let r=this.fboCache.acquire(e,i,dt.FOCUSAREA);return r=this._nodes.render(r,this._pluginInput),this.performanceInfo.advance(Ms.FOCUS_AREA_MASK),r}_renderObjectAndLayerIdColor(){if(!this._nodes.produces("olid"))return null;const e=this._renderContext.output;++this._techniques.precompiling;const i=this._framebufferSize;let r=this.fboCache.acquire(i.width,i.height,"olid");return r.acquireDepth(Ho.DEPTH_STENCIL_TEXTURE),r=this._nodes.render(r,this._pluginInput),--this._techniques.precompiling,this.performanceInfo.advance(Ms.OBJECT_AND_LAYER_ID_COLOR),this._renderContext.output=e,r}finish(e){this._hasAnimations||this._animationTimestep.clear();const i=this.performanceInfo.gpuSamplingEnabled,r=e===$t.BACKGROUND;if(r||i){const s=r?this.performanceInfo.elapsedTime:0;let n=0;i?n=this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.finish();const o=Math.max(s,n);this._animationTimestep.frame(o,r)}}readMainDepth(e,i){var o;const{mainDepth:r,camera:s}=this._bindParameters;if(!r)return;const n=this.fboCache.acquire(this._framebufferSize.width,this._framebufferSize.height,"linear-depth");this._rctx.bindFramebuffer(n.fbo),s.setGLViewport(this._rctx),this._rctx.setScissorRect(e[0],e[1],e[2],e[3]),this._rctx.setScissorTestEnabled(!0),this._rctx.clearFramebuffer(an),this._compositingHelper.blitDepthToLinearDepth(this._bindParameters,r),this._rctx.setScissorTestEnabled(!1),this._rctx.setScissorRect(0,0,this._rctx.gl.canvas.width,this._rctx.gl.canvas.width),(o=n.fbo)==null||o.readPixels(e[0],e[1],e[2],e[3],Tt.RGBA,Xa.UNSIGNED_BYTE,i),n.release()}readHUDVisibility(e,i,r,s,n){var o,a;(a=(o=this._bindParameters.hudVisibility)==null?void 0:o.fbo)==null||a.readPixels(e,i,r,s,Tt.RGBA,Xa.UNSIGNED_BYTE,n)}readAccumulatedShadow(e){return this._shadowAccumulator.readAccumulatedShadow(e[0],e[1])}_renderEdges(e){const i=this._edgeView;if(!(i!=null&&i.shouldRender()))return;const r=this._framebufferSize,s=this.fboCache.acquire(r.width,r.height,"edges"),n=()=>i.render(this._bindParameters,e),o=this._bindParameters.geometryDepth;this.renderToTargets(n,s,o??this._framebuffer.depth,an),this._framebuffer.bind(),this._compositingHelper.composite(this._bindParameters,s.getTexture()),s.release(),this.performanceInfo.advance(e===od.OPAQUE?Ms.OPAQUE_EDGES:Ms.TRANSPARENT_EDGES)}_renderOverlay(e){var i;this._bindParameters.overlay=(i=this.overlay)==null?void 0:i.render(e),this._bindParameters.overlay&&this.performanceInfo.advance(Ms.OVERLAY)}_renderShadowMap(e,i,r){if(!this.shadowsEnabled)return;const s=this._shadowMap;s.start(e,i,r,this.isFeatureEnabled(Hs.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._needsShadowHighlight?(this._renderShadowCascades(Y.ShadowHighlight,this._shadowMap),s.moveSnapshot(DS.Highlight),this._renderShadowCascades(Y.ShadowExcludeHighlight,this._shadowMap),s.copySnapshot(DS.ExcludeHighlight),this._renderShadowCascades(Y.ShadowHighlight,this._shadowMap)):this._renderShadowCascades(Y.Shadow),s.finish(),e.setGLViewport(this._rctx),this.performanceInfo.advance(Ms.SHADOW_MAP)}_precompileShadowCascades(e){for(const i of this._shadowMap.cascades)i.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(i.camera,i.camera),this._precompileAllGeometry(e)}_renderShadowCascades(e,i=this._shadowMap){for(const r of i.cascades)r.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(r.camera,r.camera),this.renderAllGeometry(e)}get _needsDepth(){return this._plugins.consumes(Y.Depth)||this._nodes.requireGeometryDepth()||this.hasReflections||this._needsShadowHighlight||this._needsShadowAccumulation||this._debugNeedsDepth}_renderRemainingGeometryDepth(){const e=this._pluginInput.get("normals");if(e){const i=this._needsDepth?e.getAttachment(CS):null;i==null||i.retain(),this._pluginInput.set(dt.SSAO,this._renderSSAO()),this._renderGeometryWithoutNormalsDepth(i)}else this._renderAllGeometryDepth()}_renderGeometryWithoutNormalsDepth(e){if(!this._needsDepth||!e)return void(this._bindParameters.depth=Lr(this._bindParameters.depth));const i=this._framebufferSize,r=this.fboCache.acquire(i.width,i.height,"depth");r.attachDepth(e),e.release(),this._rctx.bindFramebuffer(r.fbo),this._rctx.clear(Mi.STENCIL),this._renderGeometryWithoutNormals(Y.Depth),Lr(this._bindParameters.depth),this._bindParameters.depth=r.obtainDepthTexture(),r.release(),this.performanceInfo.advance(Ms.DEPTH)}_renderAllGeometryDepth(){if(!this._needsDepth)return void(this._bindParameters.depth=Lr(this._bindParameters.depth));const e=this._framebufferSize,i=this.fboCache.acquire(e.width,e.height,"depth").acquireDepth(Ho.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(i.fbo),this._rctx.clear(Mi.DEPTH|Mi.STENCIL),this.renderAllGeometry(Y.Depth),Lr(this._bindParameters.depth),this._bindParameters.depth=i.obtainDepthTexture(),i.release(),this.performanceInfo.advance(Ms.DEPTH)}_renderTerrainDepth(e){if(this._bindParameters.terrainDepthTest=e,this._bindParameters.cullAboveTerrain=e,!e)return void(this._bindParameters.terrainDepth=Lr(this._bindParameters.terrainDepth));const i=this._renderContext.output;this._renderContext.output=Y.Depth;const r=this._framebufferSize,s=this.fboCache.acquire(r.width,r.height,"terrain depth").acquireDepth(Ho.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(s.fbo),this._rctx.clear(Mi.DEPTH|Mi.STENCIL),this._renderTransparentTerrain(),Lr(this._bindParameters.terrainDepth),this._bindParameters.terrainDepth=s.obtainDepthTexture(),this._renderContext.output=i,s.release()}_renderGeometryDepth(e){if(!e)return void(this._bindParameters.geometryDepth=Lr(this._bindParameters.geometryDepth));const i=this._renderContext.output,{width:r,height:s}=this._framebufferSize,n=this.fboCache.acquire(r,s,"geometry depth").acquireDepth(Ho.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(n.fbo),this._rctx.clear(Mi.DEPTH|Mi.STENCIL),this._renderOpaqueAndTransparentGeometry(Y.Depth),this._renderContext.output=i,Lr(this._bindParameters.geometryDepth),this._bindParameters.geometryDepth=n.obtainDepthTexture(),n.release()}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowAccumulation}_computeDepthRange(e){if(!this._needsDepthRange)return cu.zero;const i=wPt(e,this._plugins.plugins,this._stage.layers);return i.union(this._plugins.queryDepthRange(e)),i.near=Math.max(e.near,i.near),i.far=Math.min(e.far,i.far),i}get _normalsRequired(){const e=this._nodes.require("normals",rr.FINAL,rr.COMPOSITE,rr.OPAQUE,rr.TRANSPARENT,dt.VIEWSHED,dt.LASERLINES);return(this.hasSSAO?1:0)+e}_precompilePrepasses(){this._normalsRequired&&this._precompileAllGeometry(Y.Normal),this._needsDepth&&this._precompileAllGeometry(Y.Depth),this.shadowsEnabled&&(this._needsShadowHighlight?(this._precompileShadowCascades(Y.ShadowHighlight),this._precompileShadowCascades(Y.ShadowExcludeHighlight),this._precompileShadowCascades(Y.ShadowHighlight)):this._precompileShadowCascades(Y.Shadow)),this._needsShadowAccumulation&&this._precompileAllGeometry(Y.Shadow)}_renderNormals(){const e=this._normalsRequired;if(e===0)return;const i=this._framebufferSize,r=this.fboCache.acquire(i.width,i.height,"normals",gr.RGBA);r.acquireDepth(Ho.DEPTH_STENCIL_TEXTURE),this._rctx.bindFramebuffer(r.fbo),this._rctx.clearFramebuffer(an,!0,!0),this._renderGeometryWithNormals(Y.Normal);const s=this._nodes.optional("normals",rr.FINAL,rr.COMPOSITE,rr.OPAQUE,rr.TRANSPARENT,dt.VIEWSHED);return r.retain(e+s-1),this.performanceInfo.advance(Ms.NORMALS),r}_renderSSAO(){const e=this._pluginInput.get("normals");if(!this.hasSSAO||!e)return void(e==null?void 0:e.detachDepth());fb.setName(dt.SSAO);const i=this._nodes.render(fb,this._pluginInput);return this._bindParameters.ssao=i,e.detachDepth(),this._pluginInput.release("normals"),this.performanceInfo.advance(Ms.SSAO),i}_precompileAllGeometry(e){const i=this._renderContext.output;this._renderContext.output=e,this._precompileOpaqueGeometry(),this._precompileTransparentGeometry(),this._plugins.precompile(xe.TRANSPARENT_TERRAIN),this._renderContext.output=i}renderAllGeometry(e){this._renderContext.output=e,this._renderOpaqueAndTransparentGeometry(e),this._renderTransparentTerrain()}precompileSlots(e,...i){for(const r of i)this._bindParameters.slot=r,e.precompile(this._renderContext)}precompileOccludedSlots(e,i){for(const r of i)this._renderContext.renderOccludedMask=r,this.precompileSlots(e,...fbe);this._renderContext.renderOccludedMask=s$}renderSlots(e,...i){for(const r of i)this._bindParameters.slot=r,e.forAll(s=>{const n=s.acquireTechniques(this._renderContext);n&&s.render(this._renderContext,n,this._pluginInput)})}renderOccludedSlots(e,i){this._renderContext.renderOccludedMask=i,this.plugins.renderOccludedFlags>Cr.Occlude&&this._plugins.render(this._pluginInput,xe.OCCLUDED_TERRAIN),this.renderSlots(e,...fbe),this._renderContext.renderOccludedMask=s$}renderHUD(e){this._bindParameters.hudRenderStyle=e,this._plugins.render(this._pluginInput,xe.HUD_MATERIAL)}precompileViewshedShadowMap(){this._precompileAllGeometry(Y.ViewshedShadow)}renderViewshedShadowMap(e){const{camera:i,contentCamera:r}=this._bindParameters,s=this._renderContext.output;e.setGLViewport(this._rctx),this._ensureBindParametersCamera(e,e),this.renderAllGeometry(Y.ViewshedShadow),this._ensureBindParametersCamera(i,r),this._bindParameters.camera.setGLViewport(this._rctx),this._renderContext.output=s}_renderOpaqueAndTransparentGeometry(e){this._renderContext.output=e,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderGeometryWithNormals(e){this._renderContext.output=e,this._plugins.render(this._pluginInput,...ZPt),this._renderTransparentTerrain()}_renderGeometryWithoutNormals(e){this._renderContext.output=e,this._plugins.render(this._pluginInput,...YPt)}_precompileOpaqueGeometry(){this._plugins.precompile(...y7)}_renderOpaqueGeometry(){this._plugins.render(this._pluginInput,...y7)}_renderTransparentGeometry(){this._plugins.render(this._pluginInput,...LO)}get _hasTransparentTerrain(){return this._plugins.produces(Y.Color,xe.TRANSPARENT_TERRAIN)}_renderTransparentTerrain(){const e=()=>this._plugins.render(this._pluginInput,xe.TRANSPARENT_TERRAIN);if(!ws(this._renderContext.output))return void e();const i=this._framebufferSize,r=this.fboCache.acquire(i.width,i.height,"transparent terrain");return this.renderToTargets(e,r,this._framebuffer.depth,an),r}get _needsHUDVisibility(){return this._plugins.produces(this._renderContext.output,xe.OCCLUSION_PIXELS)}_renderHUDVisibility(){var n,o;if(!this._needsHUDVisibility)return void(this._bindParameters.hudVisibility=Lr(this._bindParameters.hudVisibility));const{width:e,height:i}=this._framebufferSize;let r=this._bindParameters.hudVisibility;((n=r==null?void 0:r.fbo)==null?void 0:n.width)===e&&((o=r==null?void 0:r.fbo)==null?void 0:o.height)===i||(r==null||r.release(),r=this.fboCache.acquire(e,i,"hud visibility",gr.RGBA4),this._bindParameters.hudVisibility=r);const s=this._bindParameters.geometryDepth;r.attachDepth(s||this._framebuffer.depth),this._rctx.bindFramebuffer(r.fbo),this._rctx.clearFramebuffer([0,1,0,1]),this._plugins.render(this._pluginInput,xe.OCCLUSION_PIXELS),r.detachDepth(),this._framebuffer.bind(),this.performanceInfo.advance(Ms.HUD_VISIBILITY)}_renderLineCallouts(e){if(this._bindParameters.hudRenderStyle=e,e===fa.Occluded){const i=()=>this._plugins.render(this._pluginInput,xe.LINE_CALLOUTS),r=this._framebufferSize,s=this.fboCache.acquireDepth(Ho.DEPTH16_BUFFER,r.width,r.height,"line callouts");this.renderToTargets(i,this._framebuffer.color,s,void 0,!0,!0),s.release()}else this._plugins.render(this._pluginInput,xe.LINE_CALLOUTS)}_precompileHUD(e){if(this._precompileHUDOutput(e),this._hasHighlights){const i=this._renderContext.output;this._renderContext.output=Y.Highlight,this._precompileHUDOutput(e),this._renderContext.output=i}}_precompileHUDOutput(e){const i=this._bindParameters.hudRenderStyle;this._bindParameters.hudRenderStyle=e,this._oitEnabled&&ws(this._renderContext.output)?(this._bindParameters.oitPass=Ti.ColorAlpha,this._plugins.precompile(...NO),this._bindParameters.oitPass=Ti.FrontFace,this._plugins.precompile(...NO),this._bindParameters.oitPass=Ti.NONE):this._plugins.precompile(...NO),this._bindParameters.hudRenderStyle=i}_renderHUD(e,i,r){if(this._pluginsHas.hudElements){if(this._oitEnabled){const s=this._renderOIT(MC.HUD,r,e);this._rctx.bindFramebuffer(i.fbo),this._compositingHelper.compositePreMultipliedAlpha(this._bindParameters,s.getTexture()),s.release()}else if(this._renderContext.output=r,e===fa.Occluded){const s=()=>this._renderHUDElements(e),n=this._framebufferSize,o=this.fboCache.acquireDepth(Ho.DEPTH16_BUFFER,n.width,n.height,"hud");this.renderToTargets(s,this._framebuffer.color,o,void 0,!0,!0),o.release()}else i.acquireDepth(Ho.DEPTH16_BUFFER),this._rctx.bindFramebuffer(i.fbo),this._renderHUDElements(e),i.detachDepth();this.performanceInfo.advance(e===fa.Occluded?Ms.HUD_OCCLUDED:Ms.HUD)}}_renderHUDElements(e){this._bindParameters.hudRenderStyle=e,this._plugins.render(this._pluginInput,...NO)}get _needsShadowHighlight(){return this.shadowsEnabled&&this._plugins.produces(Y.ShadowHighlight,xe.OPAQUE_MATERIAL)}_renderHighlightPrepass(){if(!this._hasHighlights)return;const{fboCache:e,_rctx:i,_bindParameters:r}=this,s=this._framebufferSize,n=e.acquire(s.width,s.height,"highlights",gr.RG);return n.acquireDepth(Ho.DEPTH_STENCIL_TEXTURE),i.bindFramebuffer(n.fbo),i.clearFramebuffer(an,!0),this._renderContext.output=Y.Highlight,i.bindFramebuffer(n.fbo),hLe(i,e,s,r,()=>this._renderHighlightGeometries()),this.performanceInfo.advance(Ms.HIGHLIGHTS),n}_renderHighlightGeometries(){this._plugins.render(this._pluginInput,...JPt),this._rctx.clear(Mi.DEPTH),this._renderHUDElements(fa.Both)}get _needsShadowAccumulation(){return this._shadowAccumulator.accumulating}_renderShadowAccumulation(e,i,r){this._needsShadowAccumulation&&this._bindParameters.depth&&this._shadowAccumulator.renderAccumulation(this._bindParameters.depth,e,i,r)&&this.performanceInfo.advance(Ms.ACCUMULATED_SHADOWS)}_precompileTransparentGeometry(){this._oitEnabled&&ws(this._renderContext.output)?(this._bindParameters.oitPass=Ti.ColorAlpha,this._plugins.precompile(...LO),this._bindParameters.oitPass=Ti.FrontFace,this._plugins.precompile(...LO),this._bindParameters.oitPass=Ti.NONE):this._plugins.precompile(...LO)}_renderOIT(e,i,r=fa.Both){const s=e===MC.HUD,n=this._framebufferSize,o=s?this.fboCache.acquire(n.width,n.height,"oit hud composite"):null,a=s?()=>this._renderHUDElements(r):()=>this._renderTransparentGeometry(),l=this._bindParameters,c=this._renderContext.output;this._renderContext.output=i,l.oitPass=Ti.ColorAlpha;const h=o?"oit hud color+alpha":"oit color+alpha",d=this.fboCache.acquire(n.width,n.height,h,gr.RGBA16F),f=i===Y.ColorEmission;f&&d.acquireColor(nr.COLOR_ATTACHMENT1,gr.RGBA16F,"emissive"),d.acquireColor(f?nr.COLOR_ATTACHMENT2:nr.COLOR_ATTACHMENT1,gr.R16F),o||d.attachDepth(this._framebuffer.depth),this._rctx.bindFramebuffer(d.fbo),this._rctx.clearFramebuffer([0,0,0,1]),f&&this._rctx.gl.clearBufferfv(this._rctx.gl.COLOR,1,Hae),a(),d.detachDepth(),l.oitPass=Ti.FrontFace;const m=this.fboCache.acquire(n.width,n.height,o?"oit hud front":"oit front");return f&&m.acquireColor(nr.COLOR_ATTACHMENT1,gr.RGBA,"emissive"),o?m.acquireDepth(Ho.DEPTH16_BUFFER):m.attachDepth(this._framebuffer.depth),this._rctx.bindFramebuffer(m.fbo),this._rctx.clearFramebuffer(an,!!o),a(),m.detachDepth(),l.oitPass=Ti.NONE,o?(this._rctx.bindFramebuffer(o.fbo),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clear(Mi.COLOR)):this._framebuffer.bind(),this._oitblend??(this._oitblend=new cPt(this._techniques)),this._oitblend.blend(this._rctx,d,m,l,f),o==null||o.detachDepth(),m.release(),d.release(),this._renderContext.output=c,o}_renderTransparentEnvironment(){this._shadowAccumulator.render(this._bindParameters),this.performanceInfo.advance(Ms.APPLY_ACCUMULATED_SHADOWS),this._framebuffer.bind(),this._plugins.render(this._pluginInput,xe.TRANSPARENT_MATERIAL_WITHOUT_DEPTH),this.performanceInfo.advance(Ms.TRANSPARENT_MATERIAL_WITHOUT_DEPTH)}_renderPlugins(e,i){this._plugins.produces(this._renderContext.output,e)&&(this._plugins.render(this._pluginInput,e),this.performanceInfo.advance(i))}_renderNodes(e,i,r=!1){if(i.setName(e),this._pluginInput.set(e,i),!this._nodes.produces(e))return r&&this.performanceInfo.advance(e),i;const s=this._nodes.render(i,this._pluginInput,this._releaseNormals);return this.performanceInfo.advance(e),s}_blitFBO(e,i=fb,r=!0){return this._blit??(this._blit=new u5e(this._techniques)),this._blit.blit(this._rctx,e,i,this._bindParameters),this._pluginInput.set(e.name,i),r&&e.release(),i}_ensureBindParametersCamera(e,i){this._bindParameters.camera=e,this._bindParameters.contentCamera=i}_ensureBindParametersSSR(e){if(this._bindParameters.ssr.lastFrameColor){this._ssrEnableTime==null&&(this._ssrEnableTime=e),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=eo:($l(gbe,this._bindParameters.camera.viewMatrix),$l(mbe,this._bindParameters.camera.projectionMatrix),Bn(wE,gbe,mbe),Bn(wE,this._renderContext.lastFrameCamera.viewMatrix,wE),Bn(wE,this._renderContext.lastFrameCamera.projectionMatrix,wE),this._reprojectionMatrix=wE);const i=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=i>0?Math.min(i,e-this._ssrEnableTime)/i:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=eo,this._ssrEnableTime=null}addRenderNode(e){this._nodes.add(e),this._requestRender()}removeRenderNode(e){this._nodes.remove(e),this._requestRender()}updateLighting(e,i,r,s){this._bindParameters.updateLighting(e,i,r,s),this._requestRender($t.UPDATE)}get usedMemory(){var e;return{fbos:this.fboCache.usedMemory,plugins:this._plugins.usedMemory,edges:((e=this.edgeView)==null?void 0:e.usedMemory)??0}}renderToTargets(e,i,r,s,n=!1,o=!1){i.attachDepth(r),this._rctx.bindFramebuffer(i.fbo),this._rctx.clearFramebuffer(s,n,o),e(),i.detachDepth()}get test(){}}var MC;u([p({readOnly:!0})],_z.prototype,"fullResolutionAtmosphere",null),u([p()],_z.prototype,"_edgeView",void 0),u([p()],_z.prototype,"updating",null),function(t){t[t.Geometry=0]="Geometry",t[t.HUD=1]="HUD"}(MC||(MC={}));const ZPt=[xe.INTEGRATED_MESH,xe.OPAQUE_TERRAIN,xe.OPAQUE_MATERIAL,xe.TRANSPARENT_MATERIAL],YPt=[xe.OPAQUE_MATERIAL_WITHOUT_NORMALS,xe.TRANSPARENT_MATERIAL_WITHOUT_NORMALS],y7=[xe.INTEGRATED_MESH,xe.OPAQUE_TERRAIN,xe.OPAQUE_MATERIAL,xe.OPAQUE_MATERIAL_WITHOUT_NORMALS],LO=[xe.TRANSPARENT_MATERIAL,xe.TRANSPARENT_MATERIAL_WITHOUT_NORMALS],fbe=[xe.OPAQUE_MATERIAL,xe.TRANSPARENT_MATERIAL,xe.TRANSPARENT_MATERIAL_WITHOUT_DEPTH],NO=[xe.LINE_CALLOUTS_HUD_DEPTH,xe.HUD_MATERIAL,xe.LABEL_MATERIAL],JPt=[xe.TRANSPARENT_MATERIAL,xe.TRANSPARENT_MATERIAL_WITHOUT_NORMALS,xe.OPAQUE_MATERIAL,xe.OPAQUE_MATERIAL_WITHOUT_NORMALS,xe.TRANSPARENT_TERRAIN,xe.INTEGRATED_MESH,xe.OPAQUE_TERRAIN],mbe=qe(),gbe=qe(),wE=qe();function XPt(t){return e=>t.immediate.schedule(e)}let KPt=class{constructor(e){this._rctx=e,this._vao=QPt(e)}destroy(){this._vao=Dt(this._vao)}draw(){this._vao!=null&&(this._rctx.bindVAO(this._vao),this._rctx.drawArrays(Gi.TRIANGLES,0,3))}get test(){}};function QPt(t,e=uLe,i=bg){const r=new Float32Array([-1,-1,3,-1,-1,3]);return new Tg(t,i,new Map([["geometry",e]]),new Map([["geometry",jn.createVertex(t,Js.STATIC_DRAW,r)]]))}let e3t=class{constructor(e,i,r){this._rctx=e,this._locations=i,this._layout=r,this._cache=new UL(e.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(e){var s;const i=e.toString();let r=this._cache.pop(i);return r||(r=new Tg(this._rctx,this._locations,new Map([["geometry",this._layout]]),new Map([["geometry",jn.createVertex(this._rctx,Js.STATIC_DRAW)]])),(s=r.vertexBuffers.get("geometry"))==null||s.setSize(e),r)}deleteVao(e){if(e==null)return;const i=e.byteSize.toString();this._cache.put(i,e)}},k5e=class z5e{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:`#version 300 es
    precision highp float;

    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,fragment:`#version 300 es
    precision highp float;

    out vec4 fragColor;

    void main(void) {
      fragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`}}_createHelperProgram(){const e=z5e.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}_createIndexbuffer(){return jn.createIndex(this._rctx,Js.STATIC_DRAW,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,ht.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(Gi.POINTS,1,ki.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}get test(){}},ybe=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Bt.ONE,dstRGB:Bt.ZERO,srcAlpha:Bt.ONE,dstAlpha:Bt.ZERO},this.blendEquation={mode:Sv.ADD,modeAlpha:Sv.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=eh.BACK,this.frontFace=cA.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=Ui.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:eh.FRONT_AND_BACK,func:Ui.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:eh.FRONT_AND_BACK,fail:tr.KEEP,zFail:tr.KEEP,zPass:tr.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.transformFeedbackBuffer=null,this.uniformBufferBindingPoints=new Array,this.transformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.drawBuffers={defaultFramebuffer:[Ga.BACK],fbos:new WeakMap},this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},t3t=class{constructor(){for(this._current=new Array,this._allocations=null;this._current.length<Ws.COUNT;)this._current.push(0)}increment(e,i,r=1){var s;this._current[e]+=r,(s=this._allocations)==null||s.add(i)}decrement(e,i,r=1){var s;this._current[e]-=r,(s=this._allocations)==null||s.remove(i)}get current(){return this._current}get total(){return this.current.reduce((e,i,r)=>e+(r<Ws.UNCOUNTED?i:0),0)}get resourceInformation(){var i;let e="";if(this.total>0){e+=`Live objects:
`;for(let r=0;r<Ws.COUNT;++r){const s=this._current[r];s>0&&(e+=`${Ws[r]}: ${s}
`)}}return e+=(i=this._allocations)==null?void 0:i.resetLog(),e}},i3t=class{constructor(e,i,r){const s=i.textureFilterAnisotropic,n=r.maxAnisotropy??1/0;this.versionString=e.getParameter(e.VERSION),this.maxVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=s?Math.min(e.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY),n):1,this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=e.getParameter(e.MAX_VIEWPORT_DIMS),this.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=e.getParameter(e.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=e.getParameter(e.MAX_SAMPLES),this.maxDrawBuffers=e.getParameter(e.MAX_DRAW_BUFFERS)}};const r3t=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"],s3t=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"],vbe=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"],n3t=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"];var np=999,_be=9999,v7=0,_7=1,bbe=2,wbe=3,xbe=4,Ok=5,o3t=6,a3t=7,l3t=8,Sbe=9,c3t=10,Tbe=11,u3t=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function h3t(){var t,e,i,r=0,s=0,n=np,o=[],a=[],l=1,c=0,h=0,d=!1,f=!1,m="";return function(L){return a=[],L!==null?v(L.replace?L.replace(/\r\n/g,`
`):L):_()};function g(L){L.length&&a.push({type:u3t[n],data:L,position:h,line:l,column:c})}function v(L){var N;for(r=0,i=(m+=L).length;t=m[r],r<i;){switch(N=r,n){case v7:r=C();break;case _7:r=S();break;case bbe:r=x();break;case wbe:r=T();break;case xbe:r=D();break;case Tbe:r=I();break;case Ok:r=P();break;case _be:r=F();break;case Sbe:r=w();break;case np:r=b()}N!==r&&(m[N]===`
`?(c=0,++l):++c)}return s+=r,m=m.slice(r),a}function _(L){return o.length&&g(o.join("")),n=c3t,g("(eof)"),a}function b(){return o=o.length?[]:o,e==="/"&&t==="*"?(h=s+r-1,n=v7,e=t,r+1):e==="/"&&t==="/"?(h=s+r-1,n=_7,e=t,r+1):t==="#"?(n=bbe,h=s+r,r):/\s/.test(t)?(n=Sbe,h=s+r,r):(d=/\d/.test(t),f=/[^\w_]/.test(t),h=s+r,n=d?xbe:f?wbe:_be,r)}function w(){return/[^\s]/g.test(t)?(g(o.join("")),n=np,r):(o.push(t),e=t,r+1)}function x(){return t!=="\r"&&t!==`
`||e==="\\"?(o.push(t),e=t,r+1):(g(o.join("")),n=np,r)}function S(){return x()}function C(){return t==="/"&&e==="*"?(o.push(t),g(o.join("")),n=np,r+1):(o.push(t),e=t,r+1)}function T(){if(e==="."&&/\d/.test(t))return n=Ok,r;if(e==="/"&&t==="*")return n=v7,r;if(e==="/"&&t==="/")return n=_7,r;if(t==="."&&o.length){for(;M(o););return n=Ok,r}if(t===";"||t===")"||t==="("){if(o.length)for(;M(o););return g(t),n=np,r+1}var L=o.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||L){for(;M(o););return n=np,r}return o.push(t),e=t,r+1}function M(L){for(var N,R,k=0;;){if(N=vbe.indexOf(L.slice(0,L.length+k).join("")),R=vbe[N],N===-1){if(k--+L.length>0)continue;R=L.slice(0,1).join("")}return g(R),h+=R.length,(o=o.slice(R.length)).length}}function I(){return/[^a-fA-F0-9]/.test(t)?(g(o.join("")),n=np,r):(o.push(t),e=t,r+1)}function D(){return t==="."||/[eE]/.test(t)?(o.push(t),n=Ok,e=t,r+1):t==="x"&&o.length===1&&o[0]==="0"?(n=Tbe,o.push(t),e=t,r+1):/[^\d]/.test(t)?(g(o.join("")),n=np,r):(o.push(t),e=t,r+1)}function P(){return t==="f"&&(o.push(t),e=t,r+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(o.push(t),e=t,r+1):/[^\d]/.test(t)?(g(o.join("")),n=np,r):(o.push(t),e=t,r+1)}function F(){if(/[^\d\w_]/.test(t)){var L=o.join("");return n=s3t.indexOf(L)>-1?l3t:n3t.indexOf(L)>-1?a3t:o3t,g(o.join("")),n=np,r}return o.push(t),e=t,r+1}}function d3t(t){var e=h3t(),i=[];return i=(i=i.concat(e(t))).concat(e(null))}function p3t(t){return d3t(t)}function f3t(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const b7=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]);function m3t(t,e="100",i="300 es"){const r=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of t)if(s.type==="preprocessor"){const n=r.exec(s.data);if(n){const o=n[1].replaceAll(/\s{2,}/g," ");if(o===i)return o;if(o===e)return s.data="#version "+i,e;throw new Error("unknown glsl version: "+o)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:`
`}),null}function g3t(t,e){for(let i=e-1;i>=0;i--){const r=t[i];if(r.type!=="whitespace"&&r.type!=="block-comment"){if(r.type!=="keyword")break;if(r.data==="attribute"||r.data==="in")return!0}}return!1}function pR(t,e,i,r){r=r||i;for(const s of t)if(s.type==="ident"&&s.data===i)return r in e?e[r]++:e[r]=0,pR(t,e,r+"_"+e[r],r);return i}function U5e(t,e,i="afterVersion"){function r(l,c){for(let h=c;h<l.length;h++){const d=l[h];if(d.type==="operator"&&d.data===";")return h}return null}function s(l){let c=-1,h=0,d=-1;for(let f=0;f<l.length;f++){const m=l[f];if(m.type==="preprocessor"&&(/#(if|ifdef|ifndef)\s+.+/.test(m.data)?++h:/#endif\s*.*/.test(m.data)&&--h),i!=="afterVersion"&&i!=="afterPrecision"||m.type==="preprocessor"&&m.data.startsWith("#version")&&(d=Math.max(d,f)),i==="afterPrecision"&&m.type==="keyword"&&m.data==="precision"){const g=r(l,f);if(g===null)throw new Error("precision statement not followed by any semicolons!");d=Math.max(d,g)}c<d&&h===0&&(c=f)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let a=s(t);o(a-1)&&t.splice(a++,0,n);for(const l of e)t.splice(a++,0,l);o(a-1)&&o(a)&&t.splice(a,0,n)}function y3t(t,e,i,r="lowp"){U5e(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function v3t(t,e,i,r,s="lowp"){U5e(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function _3t(t,e){let i,r,s=-1;for(let n=e;n<t.length;n++){const o=t[n];if(o.type==="operator"&&(o.data==="["&&(i=n),o.data==="]")){r=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return i&&r&&t.splice(i,r-i+1),s}function Ebe(t,e){if(t.startsWith("#version 300"))return t;const i=p3t(t);if(m3t(i,"100","300 es")==="300 es")return t;let r=null,s=null;const n={},o={};for(let a=0;a<i.length;++a){const l=i[a];switch(l.type){case"keyword":e===Zu.VERTEX_SHADER&&l.data==="attribute"?l.data="in":l.data==="varying"&&(l.data=e===Zu.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===Zu.FRAGMENT_SHADER&&l.data==="gl_FragColor"&&(r||(r=pR(i,n,"fragColor"),y3t(i,r,"vec4")),l.data=r),e===Zu.FRAGMENT_SHADER&&l.data==="gl_FragData"){const c=_3t(i,a+1),h=pR(i,n,"fragData");v3t(i,h,"vec4",c,"mediump"),l.data=h}else e===Zu.FRAGMENT_SHADER&&l.data==="gl_FragDepthEXT"&&(s||(s=pR(i,n,"gl_FragDepth")),l.data=s);break;case"ident":if(r3t.includes(l.data)){if(e===Zu.VERTEX_SHADER&&g3t(i,a))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in o||(o[l.data]=pR(i,n,l.data)),l.data=o[l.data]}}}for(let a=i.length-1;a>=0;--a){const l=i[a];if(l.type==="preprocessor"){const c=l.data.match(/#extension\s+(.*):/);if(c!=null&&c[1]&&b7.has(c[1].trim())){const f=i[a+1];i.splice(a,f&&f.type==="whitespace"?2:1)}const h=l.data.match(/#ifdef\s+(.*)/);h!=null&&h[1]&&b7.has(h[1].trim())&&(l.data="#if 1");const d=l.data.match(/#ifndef\s+(.*)/);d!=null&&d[1]&&b7.has(d[1].trim())&&(l.data="#if 0")}}return b3t(t,f3t(i))}function b3t(t,e){return e}const w3t=4294967295;let x3t=class{constructor(e,i,r,s,n=new Map,o=[]){var c;this._context=e,this._locations=s,this._uniformBlockBindings=n,this._transformFeedbackVaryings=o,this._refCount=1,this._compiled=!1,this._linesOfCode=0,this._nameToUniformLocation=new Map,this._nameToUniform1=new Map,this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),i.length===0&&console.error("Shaders source should not be empty!"),i=Ebe(i,Zu.VERTEX_SHADER),r=Ebe(r,Zu.FRAGMENT_SHADER),this._vShader=Cbe(this._context,Zu.VERTEX_SHADER,i),this._fShader=Cbe(this._context,Zu.FRAGMENT_SHADER,r),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(Ws.Shader,this),FJ()&&(this.vertexShader=i,this.fragmentShader=r),this.usedMemory=i.length+r.length;const a=this._context.gl,l=a.createProgram();a.attachShader(l,this._vShader),a.attachShader(l,this._fShader),this._locations.forEach((h,d)=>a.bindAttribLocation(l,h,d)),(c=this._transformFeedbackVaryings)!=null&&c.length&&a.transformFeedbackVaryings(l,this._transformFeedbackVaryings,a.SEPARATE_ATTRIBS),a.linkProgram(l),FJ()&&!a.getProgramParameter(l,a.LINK_STATUS)&&console.error(`Could not link shader
validated: ${a.getProgramParameter(l,a.VALIDATE_STATUS)}, gl error ${a.getError()}, vertex: ${a.getShaderParameter(this._vShader,a.COMPILE_STATUS)}, fragment: ${a.getShaderParameter(this._fShader,a.COMPILE_STATUS)}, info log: ${a.getProgramInfoLog(l)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`);for(const[h,d]of this._uniformBlockBindings){const f=a.getUniformBlockIndex(l,h);f<w3t&&a.uniformBlockBinding(l,f,d)}this._glName=l,this._context.instanceCounter.increment(Ws.Program,this)}get glName(){return this._glName}get hasGLName(){return this._glName!=null}get hasTransformFeedbackVaryings(){var e;return!!((e=this._transformFeedbackVaryings)!=null&&e.length)}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||this.glName==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl,i=this._context.instanceCounter;this._nameToUniformLocation.forEach(r=>r&&i.decrement(Ws.Uniform,r)),this._nameToUniformLocation.clear(),this._vShader&&(this._linesOfCode>0&&(i.decrement(Ws.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),e.deleteShader(this._vShader),this._vShader=null,i.decrement(Ws.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,i.decrement(Ws.Program,this))}ref(){++this._refCount}_getUniformLocation(e){const i=this._nameToUniformLocation.get(e);if(i!==void 0)return i;if(this.glName){const r=this._context.gl.getUniformLocation(this.glName,e);return this._nameToUniformLocation.set(e,r),r&&this._context.instanceCounter.increment(Ws.Uniform,r),r}return null}hasUniform(e){return this._getUniformLocation(e)!=null}setUniform1i(e,i){const r=this._nameToUniform1.get(e);r!==void 0&&i===r||(this._context.gl.uniform1i(this._getUniformLocation(e),i),this._nameToUniform1.set(e,i))}setUniform1iv(e,i){Hf(this._nameToUniform1v,e,i)&&this._context.gl.uniform1iv(this._getUniformLocation(e),i)}setUniform2iv(e,i){Hf(this._nameToUniform2,e,i)&&this._context.gl.uniform2iv(this._getUniformLocation(e),i)}setUniform3iv(e,i){Hf(this._nameToUniform3,e,i)&&this._context.gl.uniform3iv(this._getUniformLocation(e),i)}setUniform4iv(e,i){Hf(this._nameToUniform4,e,i)&&this._context.gl.uniform4iv(this._getUniformLocation(e),i)}setUniform1f(e,i){const r=this._nameToUniform1.get(e);r!==void 0&&i===r||(this._context.gl.uniform1f(this._getUniformLocation(e),i),this._nameToUniform1.set(e,i))}setUniform1fv(e,i){Hf(this._nameToUniform1v,e,i)&&this._context.gl.uniform1fv(this._getUniformLocation(e),i)}setUniform2f(e,i,r){const s=this._nameToUniform2.get(e);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),this._nameToUniform2.set(e,[i,r])):i===s[0]&&r===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),s[0]=i,s[1]=r)}setUniform2fv(e,i){Hf(this._nameToUniform2,e,i)&&this._context.gl.uniform2fv(this._getUniformLocation(e),i)}setUniform3f(e,i,r,s){const n=this._nameToUniform3.get(e);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,s),this._nameToUniform3.set(e,[i,r,s])):i===n[0]&&r===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,s),n[0]=i,n[1]=r,n[2]=s)}setUniform3fv(e,i){const r=this._getUniformLocation(e);r!=null&&Hf(this._nameToUniform3,e,i)&&this._context.gl.uniform3fv(r,i)}setUniform4f(e,i,r,s,n){const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,s,n),this._nameToUniform4.set(e,[i,r,s,n])):o!==void 0&&i===o[0]&&r===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,s,n),o[0]=i,o[1]=r,o[2]=s,o[3]=n)}setUniform4fv(e,i){const r=this._getUniformLocation(e);r!=null&&Hf(this._nameToUniform4,e,i)&&this._context.gl.uniform4fv(r,i)}setUniformMatrix3fv(e,i,r=!1){const s=this._getUniformLocation(e);s!=null&&Hf(this._nameToUniformMatrix3,e,i)&&this._context.gl.uniformMatrix3fv(s,r,i)}setUniformMatrix4fv(e,i,r=!1){const s=this._getUniformLocation(e);s!=null&&Hf(this._nameToUniformMatrix4,e,i)&&this._context.gl.uniformMatrix4fv(s,r,i)}stop(){}};function Cbe(t,e,i){const r=t.gl,s=r.createShader(e);return r.shaderSource(s,i),r.compileShader(s),FJ()&&!r.getShaderParameter(s,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===Zu.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(s)),console.error(S3t(i))),s}function S3t(t){let e=2;return t.replaceAll(`
`,()=>`
`+T3t(e++)+":")}function T3t(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function Hf(t,e,i){const r=t.get(e);if(!r)return t.set(e,Array.from(i)),!0;const s=i.length;if(r.length!==s)return t.set(e,Array.from(i)),!0;for(let n=0;n<s;++n){const o=i[n];if(r[n]!==o){for(r[n]=o;n<s;++n)r[n]=i[n];return!0}}return!1}let E3t=class{constructor(e){this._rctx=e,this._store=new Ov}dispose(){this._store.forAll(e=>e.dispose()),this._store.clear()}acquire(e,i,r,s){const n=this._store.get(e,i);if(n!=null)return n.ref(),n;const o=new x3t(this._rctx,e,i,r,s);return o.ref(),this._store.set(e,i,o),o}get test(){}},K6=class{constructor(){this._result=!1}dispose(){this._program=Dt(this._program)}get result(){return this._program!=null&&(this._result=this._test(this._program),this.dispose()),this._result}},C3t=class extends K6{constructor(e){super(),this._rctx=e,this._helperProgram=null,X("mac")&&X("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){var e;super.dispose(),(e=this._helperProgram)==null||e.dispose(),this._helperProgram=null}_test(e){const i=this._rctx,r=i.getBoundFramebufferObject(),{x:s,y:n,width:o,height:a}=i.getViewport();i.resetState();const l=new Ar(1);l.wrapMode=ar.CLAMP_TO_EDGE,l.samplingMode=gi.NEAREST;const c=new Eg(i,l),h=jn.createIndex(this._rctx,Js.STATIC_DRAW,new Uint8Array([0]));i.bindFramebuffer(c),i.setViewport(0,0,1,1),i.useProgram(this._helperProgram),i.bindBuffer(h,ht.ELEMENT_ARRAY_BUFFER),i.drawElements(Gi.POINTS,1,ki.UNSIGNED_BYTE,0),i.useProgram(e),i.bindVAO(null),i.drawArrays(Gi.TRIANGLES,0,258);const d=new Uint8Array(4);return c.readPixels(0,0,1,1,Tt.RGBA,Xa.UNSIGNED_BYTE,d),i.setViewport(s,n,o,a),i.bindFramebuffer(r),c.dispose(),h.dispose(),d[0]===255}_prepareProgram(){const i=`#version 300 es
    precision highp float;

    out float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${E.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,r=`#version 300 es
    precision highp float;

    in float triangleId;

    out vec4 fragColor;

    void main(void) {
      fragColor = triangleId == ${E.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(i,r,new Map([]))}_prepareHelperProgram(){const e=k5e.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}},$3t=class extends K6{constructor(e){super(),this._rctx=e,this._program=$be(this._rctx,!1),this._obfuscated=$be(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=Dt(this._obfuscated)}_test(e){if(X("force-double-precision-obfuscation"))return!0;if(this._obfuscated==null)return!1;const i=this._rctx,r=i.getBoundFramebufferObject(),{x:s,y:n,width:o,height:a}=i.getViewport(),l=this._runProgram(e),c=this._runProgram(this._obfuscated);return i.setViewport(s,n,o,a),i.bindFramebuffer(r),l!==0&&(c===0||l/c>5)}_runProgram(e){const i=this._rctx;i.resetState();const r=new Ar(1);r.wrapMode=ar.CLAMP_TO_EDGE,r.samplingMode=gi.NEAREST;const s=new Eg(i,r),n=jn.createVertex(i,Js.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new IL(i,new Map([["position",0]]),new Map([["geometry",[new xf("position",2,ki.UNSIGNED_SHORT,0,4)]]]),new Map([["geometry",n]])),a=De(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),l=De(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),c=new Float32Array(6);qX(a,c,3);const h=new Float32Array(6);qX(l,h,3),i.useProgram(e),e.setUniform3f("u_highA",c[0],c[2],c[4]),e.setUniform3f("u_lowA",c[1],c[3],c[5]),e.setUniform3f("u_highB",h[0],h[2],h[4]),e.setUniform3f("u_lowB",h[1],h[3],h[5]),i.bindFramebuffer(s),i.setViewport(0,0,1,1),i.bindVAO(o),i.drawArrays(Gi.TRIANGLE_STRIP,0,4);const d=new Uint8Array(4);s.readPixels(0,0,1,1,Tt.RGBA,Xa.UNSIGNED_BYTE,d),o.dispose(),s.dispose();const f=(a[2]-l[2])/25,m=hne(d);return Math.abs(f-m)}};function $be(t,e){const i=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `;return t.programCache.acquire(i,`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `,new Map([["position",0]]))}let A3t=class extends K6{constructor(e){var s,n;if(super(),this._rctx=e,!e.gl||!((s=e.capabilities.colorBufferFloat)!=null&&s.textureFloat&&((n=e.capabilities.colorBufferFloat)!=null&&n.floatBlend)))return;const i=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}_test(e){const i=this._rctx,r=new Ar(1);r.wrapMode=ar.CLAMP_TO_EDGE,r.dataType=Xa.FLOAT,r.internalFormat=rt.RGBA32F,r.samplingMode=gi.NEAREST;const s=new Eg(i,r),n=jn.createVertex(i,Js.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new IL(i,new Map([["a_pos",0]]),new Map([["geometry",[new xf("a_pos",2,ki.UNSIGNED_SHORT,0,4)]]]),new Map([["geometry",n]]));i.gl.getError(),i.useProgram(e);const a=i.getBoundFramebufferObject(),{x:l,y:c,width:h,height:d}=i.getViewport();i.bindFramebuffer(s),i.setViewport(0,0,1,1),i.bindVAO(o),i.drawArrays(Gi.TRIANGLE_STRIP,0,4);const f=wi({blending:Lpt});i.setPipelineState(f),i.drawArrays(Gi.TRIANGLE_STRIP,0,4);const m=i.gl.getError();return i.setViewport(l,c,h,d),i.bindFramebuffer(a),o.dispose(),s.dispose(),m!==i.gl.INVALID_OPERATION||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}};const Odi=new Map([["geometry",[new xf("a_pos",2,ki.BYTE,0,2)]]]),Idi=new Map([["geometry",[new xf("a_pos",2,ki.BYTE,0,4),new xf("a_tex",2,ki.BYTE,2,4)]]]),M3t=new Map([["geometry",[new xf("a_pos",2,ki.UNSIGNED_SHORT,0,4)]]]);let O3t=class extends K6{constructor(e){super(),this._rctx=e;const i=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
    precision highp float;

    varying vec2 v_uv;

    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(e){const i=this._rctx;if(!i.gl)return e.dispose(),!0;const r=new Ar(1);r.wrapMode=ar.CLAMP_TO_EDGE,r.samplingMode=gi.NEAREST;const s=new Eg(i,r),n=jn.createVertex(i,Js.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new IL(i,new Map([["a_pos",0]]),M3t,new Map([["geometry",n]])),a=new Ar;a.samplingMode=gi.LINEAR,a.wrapMode=ar.CLAMP_TO_EDGE;const l=new pi(i,a,fR);i.useProgram(e),i.bindTexture(l,0),e.setUniform1i("u_texture",0);const c=i.getBoundFramebufferObject(),{x:h,y:d,width:f,height:m}=i.getViewport();i.bindFramebuffer(s),i.setViewport(0,0,1,1),i.setClearColor(0,0,0,0),i.setBlendingEnabled(!1),i.clear(Mi.COLOR),i.bindVAO(o),i.drawArrays(Gi.TRIANGLE_STRIP,0,4);const g=new Uint8Array(4);return s.readPixels(0,0,1,1,Tt.RGBA,Xa.UNSIGNED_BYTE,g),o.dispose(),s.dispose(),l.dispose(),i.setViewport(h,d,f,m),i.bindFramebuffer(c),g[0]!==255}};const fR=new Image;fR.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",fR.width=5,fR.height=5,fR.decode();let I3t=class{constructor(e){this.rctx=e,this.floatBufferBlend=new A3t(e),this.svgPremultipliesAlpha=new O3t(e),this.doublePrecisionRequiresObfuscation=new $3t(e),this.drawArraysRequiresIndicesTypeReset=new C3t(e)}dispose(){this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function R3t(t,e){if(e.compressedTextureETC)return null;const i=t.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function P3t(t,e){if(e.compressedTextureS3TC)return null;const i=t.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function D3t(t,e){if(e.textureFilterAnisotropic)return null;const i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}function L3t(t,e){const i=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),r=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}function N3t(t,e,i,r,s){if(e[i])return!1;for(const n of s)if(t.getExtension(n))return!0;return!1}function F3t(t,e){if(e.textureNorm16)return null;const i=t.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}function k3t(t,e){const i=e.loseContext&&t.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}let z3t=class{constructor(e,i){this._gl=e,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._colorBufferFloat=null,this._loseContext=null,this._textureNorm16=null,this._textureFloatLinear=null,this._debugRendererInfo=null,this._disabledExtensions=i.disabledExtensions||{},this._debugWebGLExtensions=i.debugWebGLExtensions||{}}get compressedTextureETC(){return this._compressedTextureETC??(this._compressedTextureETC=R3t(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC??(this._compressedTextureS3TC=P3t(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic??(this._textureFilterAnisotropic=D3t(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery??(this._disjointTimerQuery=GPt(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get colorBufferFloat(){return this._colorBufferFloat??(this._colorBufferFloat=L3t(this._gl,this._disabledExtensions)),this._colorBufferFloat}get textureNorm16(){return this._textureNorm16??(this._textureNorm16=F3t(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear??(this._textureFloatLinear=N3t(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}get loseContext(){return this._loseContext??(this._loseContext=k3t(this._gl,this._debugWebGLExtensions)),this._loseContext}get debugRendererInfo(){return this._debugRendererInfo??(this._debugRendererInfo=dIe(this._gl,this._debugWebGLExtensions)),this._debugRendererInfo}enable(e){return this[e]}},U3t=class{constructor(e,i){this.gl=e,this.instanceCounter=new t3t,this.programCache=new E3t(this),this._transformFeedbackRequestInfo=null,this._state=new ybe,this._numOfDrawCalls=0,this._numOfTriangles=0,this._loadExtensions(),this.configure(i)}configure(e){this._capabilities=new z3t(this.gl,e),this._parameters=new i3t(this.gl,this._capabilities,e),pi.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const i=this.gl.getParameter(this.gl.VIEWPORT);this._state=new ybe,this._state.viewport={x:i[0],y:i[1],width:i[2],height:i[3]},this._stateTracker=new sft({setBlending:r=>{if(r){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(r.opRgb,r.opAlpha),this.setBlendFunctionSeparate(r.srcRgb,r.dstRgb,r.srcAlpha,r.dstAlpha);const s=r.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:r=>{r?(this.setFaceCullingEnabled(!0),this.setCullFace(r.face),this.setFrontFace(r.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:r=>{r?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(r.factor,r.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:r=>{r?(this.setDepthTestEnabled(!0),this.setDepthFunction(r.func)):this.setDepthTestEnabled(!1)},setStencilTest:r=>{if(r){this.setStencilTestEnabled(!0);const s=r.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=r.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:r=>{r?(this.setDepthWriteEnabled(!0),this.setDepthRange(r.zNear,r.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:r=>{r?this.setColorMask(r.r,r.g,r.b,r.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:r=>{r?this.setStencilWriteMask(r.mask):this.setStencilWriteMask(0)},setDrawBuffers:r=>{if(r)this.setDrawBuffers(r.buffers);else{const{drawFramebuffer:s}=this._state;s===null?this.setDrawBuffers([Ga.BACK]):s.colorAttachments.length===0?this.setDrawBuffers([Ga.NONE]):this.setDrawBuffers([nr.COLOR_ATTACHMENT0])}}}),this.enforceState(),Dt(this._driverTest),this._driverTest=new I3t(this)}dispose(){Dt(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(ht.ARRAY_BUFFER),this.unbindBuffer(ht.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(ht.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(ht.PIXEL_PACK_BUFFER),this.unbindBuffer(ht.PIXEL_UNPACK_BUFFER),this.unbindBuffer(ht.COPY_READ_BUFFER),this.unbindBuffer(ht.COPY_WRITE_BUFFER),this._state.textureUnitMap.length=0,Np()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var e;(e=this._state.program)==null||e.stop(),this._state.program=null}externalTextureUnitUpdate(e,i){for(let r=0;r<e.length;++r)this._state.textureUnitMap[e[r]]=null;i>=0&&(this._state.activeTexture=i)}externalVertexArrayObjectUpdate(){this.gl.bindVertexArray(null),this._state.vertexArrayObject=null,this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,i,r,s){e===this._state.blendColor.r&&i===this._state.blendColor.g&&r===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(e,i,r,s),this._state.blendColor.r=e,this._state.blendColor.g=i,this._state.blendColor.b=r,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(e,i){e===this._state.blendFunction.srcRGB&&i===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,i),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,i,r,s){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===r&&this._state.blendFunction.dstRGB===i&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(e,i,r,s),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,i){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===i||(this.gl.blendEquationSeparate(e,i),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=i,this._stateTracker.invalidateBlending())}setColorMask(e,i,r,s){this._state.colorMask.r===e&&this._state.colorMask.g===i&&this._state.colorMask.b===r&&this._state.colorMask.a===s||(this.gl.colorMask(e,i,r,s),this._state.colorMask.r=e,this._state.colorMask.g=i,this._state.colorMask.b=r,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(e,i,r,s){this._state.clearColor.r===e&&this._state.clearColor.g===i&&this._state.clearColor.b===r&&this._state.clearColor.a===s||(this.gl.clearColor(e,i,r,s),this._state.clearColor.r=e,this._state.clearColor.g=i,this._state.clearColor.b=r,this._state.clearColor.a=s)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,i){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===i||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=i,this.gl.polygonOffset(e,i),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,i,r,s){this._state.scissorRect.x===e&&this._state.scissorRect.y===i&&this._state.scissorRect.width===r&&this._state.scissorRect.height===s||(this.gl.scissor(e,i,r,s),this._state.scissorRect.x=e,this._state.scissorRect.y=i,this._state.scissorRect.width=r,this._state.scissorRect.height=s)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,i){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===i||(this.gl.depthRange(e,i),this._state.depthRange.zNear=e,this._state.depthRange.zFar=i,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,i,r){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===r||(this.gl.stencilFunc(e,i,r),this._state.stencilFunction.face=eh.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,i,r,s){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===i&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(e,i,r,s),this._state.stencilFunction.face=e,this._state.stencilFunction.func=i,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,i,r){this._state.stencilOperation.face===eh.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===r||(this.gl.stencilOp(e,i,r),this._state.stencilOperation.face=eh.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,i,r,s){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===i&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(e,i,r,s),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=i,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,i=!1){const r=this._state.activeTexture;return e>=0&&(i||e!==this._state.activeTexture)&&(this.gl.activeTexture(D8+e),this._state.activeTexture=e),r}setDrawBuffers(e){const{drawFramebuffer:i}=this._state,r=i===null,s=r?this._state.drawBuffers.defaultFramebuffer:this._state.drawBuffers.fbos.get(i);if((s==null?void 0:s.length)!==e.length||!s.every((n,o)=>n===e[o]))if(e.length>this.parameters.maxDrawBuffers)console.error("Setting more active draw buffers than GL.MAX_DRAW_BUFFERS allows.");else{if(r){if(e.length>1)return void console.error("The default framebuffer can only have one active draw buffer.");if(e[0]!==Ga.BACK&&e[0]!==Ga.NONE)return void console.error("The default framebuffer can only use the constants GL.BACK or GL.NONE as draw buffers.")}r||!e.includes(Ga.BACK)?(this.gl.drawBuffers(e),r?this._state.drawBuffers.defaultFramebuffer=e:this._state.drawBuffers.fbos.set(i,e),this._stateTracker.invalidateDrawBuffers()):console.error("A framebuffer object can only use the constants GL.COLOR_ATTACHMENTi or GL.NONE as draw buffers.")}}clear(e,i=255){var r;if(e){if(e&Mi.COLOR){const s=(r=this._state.drawFramebuffer)==null?void 0:r.colorAttachments;s&&this.setDrawBuffers(s),this.setColorMask(!0,!0,!0,!0)}e&Mi.DEPTH&&this.setDepthWriteEnabled(!0),e&Mi.STENCIL&&this.setStencilWriteMask(i),this.gl.clear(e)}}clearFramebuffer(e,i=!1,r=!1){let s=0;if(e){const o=Math.max(1e-13,e[3]);this.setClearColor(e[0],e[1],e[2],o),s|=Mi.COLOR}i&&(s|=Mi.DEPTH),r===!1?r=0:(r===!0&&(r=255),s|=Mi.STENCIL),s&&this.clear(s,r)}drawArrays(e,i,r){var s,n;if(this._transformFeedbackRequestInfo){if(e!==this._transformFeedbackRequestInfo.primitiveType)throw new Error("DrawArrays called during transform feedback, but primitiveType does not match that of the current transform feedback request");if(((s=this._state.program)==null?void 0:s.hasTransformFeedbackVaryings)==null)throw new Error("DrawArrays called during transform feedback, but the shader program was not linked with a transform feedback varying")}if(Np()){this._numOfDrawCalls++,this._numOfTriangles+=Abe(e,r);const o=this._state.textureUnitMap;for(let a=0;a<o.length;a++){const l=o[a];if(l!=null&&l===((n=this._state.drawFramebuffer)==null?void 0:n.colorTexture))throw new Error(`Detected readWrite. Texture already bound at index ${a}`)}}this.gl.drawArrays(e,i,r),nd(this.gl)}drawArraysInstanced(e,i,r,s){this.gl.drawArraysInstanced(e,i,r,s),nd(this.gl)}drawElements(e,i,r,s){if(this._transformFeedbackRequestInfo)throw new Error("Cannot called drawElements during a transform feedback request");if(Np()&&(this._numOfDrawCalls++,this._numOfTriangles+=Abe(e,i)),this.gl.drawElements(e,i,r,s),Np()){const n=VOe(this);if(n){const o=this.getBoundVAO(),a=o==null?void 0:o.indexBuffer,l=o==null?void 0:o.vertexBuffers,c={indexBuffer:a,vertexBuffers:l},h={mode:e,count:i,type:r,offset:s},d=(a==null?void 0:a.size)??0,f=s+i,m=d<f?`. Buffer is too small. Attempted to draw index ${f} of ${d}`:"";console.error(`drawElements: ${n}${m}`,{args:h,vao:c})}}}drawElementsInstanced(e,i,r,s,n){this.gl.drawElementsInstanced(e,i,r,s,n),nd(this.gl)}logInfo(){Np()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){Np()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,i,r,s){r=Math.max(Math.round(r),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===e&&n.y===i&&n.width===r&&n.height===s||(n.x=e,n.y=i,n.width=r,n.height=s,this.gl.viewport(e,i,r,s))}setViewport4fv(e){this.setViewport(e[0],e[1],e[2],e[3])}restoreViewport({x:e,y:i,width:r,height:s}){this.setViewport(e,i,r,s)}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){var i;this._state.program!==e&&((i=this._state.program)==null||i.stop(),this._state.program=e,this.gl.useProgram((e==null?void 0:e.glName)??null))}bindTexture(e,i,r=!1){(i>=this.parameters.maxTextureImageUnits||i<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[i];return(e==null?void 0:e.glName)==null?(s!=null&&(this.setActiveTexture(i,r),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[i]=null,s):r||s!==e?(this.setActiveTexture(i,r),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[i]=e,s):(e.isDirty&&(this.setActiveTexture(i,r),e.applyChanges()),s)}unbindTexture(e){if(e!=null)for(let i=0;i<this.parameters.maxTextureImageUnits;i++)this._state.textureUnitMap[i]===e&&(this.bindTexture(null,i),this._state.textureUnitMap[i]=null)}bindFramebuffer(e,i=!1){if(i||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(this._stateTracker.invalidateDrawBuffers(),e==null)return this.gl.bindFramebuffer(za.FRAMEBUFFER,null),void(this._state.readFramebuffer=this._state.drawFramebuffer=null);e.initializeAndBind(za.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,i,r=!1){const s=i===za.READ_FRAMEBUFFER,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(r||n!==e)&&(e==null?this.gl.bindFramebuffer(i,null):e.initializeAndBind(i),s?this._state.readFramebuffer=e??null:(this._stateTracker.invalidateDrawBuffers(),this._state.drawFramebuffer=e??null))}blitFramebuffer(e,i,r=0,s=0,n=e.width,o=e.height,a=0,l=0,c=i.width,h=i.height,d=Mi.COLOR,f=gi.NEAREST){this.bindFramebufferSeparate(e,za.READ_FRAMEBUFFER),this.bindFramebufferSeparate(i,za.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(r,s,n,o,a,l,c,h,d,f)}bindBuffer(e,i){if(e)switch(i??(i=e.bufferType),i){case ht.ARRAY_BUFFER:this._state.vertexBuffer=zl(this.gl,e,i,this._state.vertexBuffer);break;case ht.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=zl(this.gl,e,i,this._state.indexBuffer);break;case ht.UNIFORM_BUFFER:this._state.uniformBuffer=zl(this.gl,e,i,this._state.uniformBuffer);break;case ht.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=zl(this.gl,e,i,this._state.pixelPackBuffer);break;case ht.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=zl(this.gl,e,i,this._state.pixelUnpackBuffer);break;case ht.COPY_READ_BUFFER:this._state.copyReadBuffer=zl(this.gl,e,i,this._state.copyReadBuffer);break;case ht.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=zl(this.gl,e,i,this._state.copyWriteBuffer);break;case ht.TRANSFORM_FEEDBACK_BUFFER:this._state.transformFeedbackBuffer=zl(this.gl,e,i,this._state.transformFeedbackBuffer)}}bindRenderbuffer(e){const i=this.gl;e||(i.bindRenderbuffer(i.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(i.bindRenderbuffer(i.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,i){if(i>=this.parameters.maxUniformBufferBindings||i<0)return console.error("Uniform buffer binding point is out of range!"),null;const r=e===ht.UNIFORM_BUFFER?this._state.uniformBufferBindingPoints:this._state.transformBufferBindingPoints;let s=r[i];return s==null&&(s={buffer:null,offset:0,size:0},r[i]=s),s}bindBufferBase(e,i,r){const s=this._getBufferBinding(e,i);s!=null&&(s.buffer===r&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(e,i,r?r.glName:null),s.buffer=r,s.offset=0,s.size=0))}bindBufferRange(e,i,r,s,n){const o=this._getBufferBinding(e,i);o!=null&&(o.buffer===r&&o.offset===s&&o.size===n||(s%this._parameters.uniformBufferOffsetAlignment==0?(this.gl.bindBufferRange(e,i,r.glName,s,n),o.buffer=r,o.offset=s,o.size=n):console.error("Uniform buffer binding offset is not a multiple of the context offset alignment")))}bindUBO(e,i,r,s){i!=null?(Np()&&(s??i.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),i.initialize(),r!==void 0&&s!==void 0?this.bindBufferRange(ht.UNIFORM_BUFFER,e,i.buffer,r,s):this.bindBufferBase(ht.UNIFORM_BUFFER,e,i.buffer)):this.bindBufferBase(ht.UNIFORM_BUFFER,e,null)}unbindUBO(e){for(let i=0,r=this._state.uniformBufferBindingPoints.length;i<r;i++){const s=this._state.uniformBufferBindingPoints[i];s!=null&&s.buffer===e.buffer&&this.bindBufferBase(ht.UNIFORM_BUFFER,i,null)}}unbindBuffer(e){switch(e){case ht.ARRAY_BUFFER:this._state.vertexBuffer=zl(this.gl,null,e,this._state.vertexBuffer);break;case ht.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=zl(this.gl,null,e,this._state.indexBuffer);break;case ht.UNIFORM_BUFFER:this._state.uniformBuffer=zl(this.gl,null,e,this._state.uniformBuffer);break;case ht.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=zl(this.gl,null,e,this._state.pixelPackBuffer);break;case ht.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=zl(this.gl,null,e,this._state.pixelUnpackBuffer);break;case ht.COPY_READ_BUFFER:this._state.copyReadBuffer=zl(this.gl,null,e,this._state.copyReadBuffer);break;case ht.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=zl(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){e!=null?this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}bindTransformFeedback(e){const{gl:i}=this;i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,e.glName)}beginTransformFeedback(e,i){if(this._transformFeedbackRequestInfo)throw new Error("Already in a transform feedback request");const{gl:r}=this;r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,e.glName),r.beginTransformFeedback(i),this._transformFeedbackRequestInfo={primitiveType:i}}endTransformFeedback(){if(!this._transformFeedbackRequestInfo)throw new Error("Not in a transform feedback request");const{gl:e}=this;e.endTransformFeedback(),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),this._transformFeedbackRequestInfo=null}async clientWaitAsync(e=10){const{gl:i}=this,r=i.fenceSync(NJ.SYNC_GPU_COMMANDS_COMPLETE,0);if(!r)throw new Error("Client wait failed, could not create sync object");let s;this.instanceCounter.increment(Ws.Sync,r),i.flush();do await aie(e),s=i.clientWaitSync(r,0,0);while(s===aB.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(Ws.Sync,r),i.deleteSync(r),s===aB.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=za.FRAMEBUFFER){return e===za.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(ht.ARRAY_BUFFER),this.unbindBuffer(ht.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(ht.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(ht.PIXEL_PACK_BUFFER),this.unbindBuffer(ht.PIXEL_UNPACK_BUFFER),this.unbindBuffer(ht.COPY_READ_BUFFER),this.unbindBuffer(ht.COPY_WRITE_BUFFER);for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(Bt.ONE,Bt.ZERO),this.setBlendEquation(Sv.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(eh.BACK),this.setFrontFace(cA.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(Ui.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(Ui.ALWAYS,0,0),this.setStencilOp(tr.KEEP,tr.KEEP,tr.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setDrawBuffers([Ga.BACK]),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var r,s,n;const{gl:e}=this;e.bindVertexArray(null);for(let o=0;o<this.parameters.maxVertexAttributes;o++)e.disableVertexAttribArray(o);this._state.vertexBuffer?e.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):e.bindBuffer(ht.ARRAY_BUFFER,null),this._state.indexBuffer?e.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):e.bindBuffer(ht.ELEMENT_ARRAY_BUFFER,null),this._state.uniformBuffer?e.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):e.bindBuffer(ht.UNIFORM_BUFFER,null);for(let o=0;o<this._parameters.maxUniformBufferBindings;o++){const a=this._state.uniformBufferBindingPoints[o];if(a!=null){const{buffer:l,offset:c,size:h}=a;l!==null?c===0&&h===0?e.bindBufferBase(ht.UNIFORM_BUFFER,o,l.glName):e.bindBufferRange(ht.UNIFORM_BUFFER,o,l.glName,c,h):e.bindBufferBase(ht.UNIFORM_BUFFER,o,null)}}if(this._state.pixelPackBuffer?e.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):e.bindBuffer(ht.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?e.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):e.bindBuffer(ht.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?e.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):e.bindBuffer(ht.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?e.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):e.bindBuffer(ht.COPY_WRITE_BUFFER,null),e.bindFramebuffer(za.READ_FRAMEBUFFER,null),e.readBuffer(e.BACK),this._state.readFramebuffer&&(e.bindFramebuffer(za.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),e.readBuffer(nr.COLOR_ATTACHMENT0)),e.bindFramebuffer(za.DRAW_FRAMEBUFFER,((r=this._state.drawFramebuffer)==null?void 0:r.glName)??null),this._state.drawFramebuffer===null){const o=this._state.drawBuffers.defaultFramebuffer;e.drawBuffers(o??[Ga.BACK])}else{const o=this._state.drawBuffers.fbos.get(this._state.drawFramebuffer);e.drawBuffers(o??[nr.COLOR_ATTACHMENT0])}if(this._state.vertexArrayObject){const o=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(o)}e.useProgram(((s=this._state.program)==null?void 0:s.glName)??null),e.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),e.bindRenderbuffer(e.RENDERBUFFER,((n=this._state.renderbuffer)==null?void 0:n.glName)??null),this._state.blend===!0?e.enable(this.gl.BLEND):e.disable(this.gl.BLEND),e.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),e.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),e.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),e.clearDepth(this._state.clearDepth),e.clearStencil(this._state.clearStencil),e.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),e.cullFace(this._state.cullFace),e.depthFunc(this._state.depthFunction),e.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(this._state.depthWrite),e.frontFace(this._state.frontFace),e.lineWidth(1),this._state.faceCulling===!0?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),e.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._state.stencilWriteMask);for(let o=0;o<this.parameters.maxTextureImageUnits;o++){e.activeTexture(D8+o),e.bindTexture(ns.TEXTURE_2D,null),e.bindTexture(ns.TEXTURE_CUBE_MAP,null),e.bindTexture(ns.TEXTURE_3D,null),e.bindTexture(ns.TEXTURE_2D_ARRAY,null);const a=this._state.textureUnitMap[o];a!=null&&e.bindTexture(a.descriptor.target,a.glName)}e.activeTexture(D8+this._state.activeTexture);const i=this._state.viewport;e.viewport(i.x,i.y,i.width,i.height),this.resetInfo()}_loadExtensions(){this.gl.getExtension("KHR_parallel_shader_compile")}};function zl(t,e,i,r){return e?r!==e&&t.bindBuffer(i,e.glName):t.bindBuffer(i,null),e}function Abe(t,e){switch(t){case Gi.POINTS:return 2*e;case Gi.TRIANGLES:return e/3;case Gi.TRIANGLE_STRIP:case Gi.TRIANGLE_FAN:return e-2;default:return 0}}let B3t=class extends U3t{constructor(e,i){super(e,i),this._vaoCaches=new Ov,this._appleAmdDriverHelper=null,this._refCount=1,this._newCache=i.newCache,this.screen=new KPt(this)}configure(e){super.configure(e),this._newCache=e.newCache}destroy(){var e,i;(e=this._vaoCaches)==null||e.forAll(r=>r.dispose()),(i=this._vaoCaches)==null||i.clear(),--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){var e;super.dispose(),(e=this._appleAmdDriverHelper)==null||e.dispose(),this.screen.destroy(),this._vaoCaches.forAll(i=>i.dispose()),this._vaoCaches.clear()}get newCache(){return this._newCache}getVaoCache(e,i){const r=Array.from(e).join("."),s=JSON.stringify(i),n=this._vaoCaches.get(r,s);if(n)return n;const o=new e3t(this,e,i);return this._vaoCaches.set(r,s,o),o}bindTechnique(e,i,r,s){return this.useProgram(e.program),this.setPipelineState(e.getPipeline()),e.program.bind(i),r&&(e.program.bindPass(r,i),s&&e.program.bindDraw(i,r,s)),e.program}runAppleAmdDriverHelper(){this.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper??(this._appleAmdDriverHelper=new k5e(this)),this._appleAmdDriverHelper.run())}get test(){}};function Mbe(t){return!!t.frameUpdate}let y2=class extends he{constructor(e){super({}),this._stage=e,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new Ss,this._frameTask=e.view.resourceController.scheduler.registerTask(lt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(zn.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}acquire(e){const i=this._textures.get(e);return i?(i.ref(),i.loadingPromise??i):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(i=>{const r=i.texture.frameUpdate(i.previousToken);r>=0&&r!==i.previousToken&&(i.previousToken=r,e=!0)}),e&&this.events.emit("changed",$t.BACKGROUND)}_createNewRef(e){const i=this._stage.getObject(e);if(i==null)return null;const r=i.events.on("unloaded",()=>{r.remove(),this._onTextureUnloaded(e)}),s=new V3t(e,()=>{this._frameTask.schedule(()=>{s.isUnreferenced&&i.unload()})});return this._textures.set(e,s),s.ref(),i.glTexture?(this._updateGLTexture(s,i.glTexture),Mbe(i)&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),s):(this._loadingCount++,s.loadingPromise=this._stage.schedule(()=>{const n=i.load(this._stage.renderView.renderingContext),o=l=>(this._loadingCount--,s.loadingPromise=null,this._updateGLTexture(s,l),Mbe(i)&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),s),a=l=>(this._loadingCount--,s.loadingPromise=null,es(l)||J.getLogger(this).error(l),null);return uu(n)?n.then(o,a):o(n)}),s.loadingPromise)}_updateGLTexture(e,i){e.glTexture=i,this.events.emit("changed",$t.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};u([p()],y2.prototype,"_loadingCount",void 0),u([p()],y2.prototype,"_frameTask",void 0),u([p()],y2.prototype,"updating",null),y2=u([A("esri.views.3d.webgl-engine.lib.TextureRepository")],y2);let V3t=class{constructor(e,i){this.id=e,this._release=i,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(J.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}};function j3t(t,e){return new vLe(i=>Ivt(i,t),i=>i,e)}let mR=class extends he{constructor(){super(...arguments),this._passParameters=new G3t,this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=fc(this._resourcesTask),this._passParameters.waveNormal=Dt(this._passParameters.waveNormal),this._passParameters.wavePerturbation=Dt(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&!this._resourcesTask.finished}ensureResources(e){return this._resourcesTask||(this._resourcesTask=gg(async i=>{await Promise.allSettled([this._loadImageResource(e,vs("esri/images/materials/water/normals.jpg"),r=>this._passParameters.waveNormal=r,i),this._loadImageResource(e,vs("esri/images/materials/water/perturbation.jpg"),r=>this._passParameters.wavePerturbation=r,i)])})),this._resourcesTask.finished?Hb.LOADED:Hb.LOADING}async _loadImageResource(e,i,r,s){try{const n=await Iv(i,{signal:s});gt(s);const o=new Ar(n.width,n.height);o.pixelFormat=Tt.RGB,o.samplingMode=gi.LINEAR_MIPMAP_LINEAR,o.hasMipmap=!0,o.maxAnisotropy=8,r(new pi(e,o,n))}catch(n){J.getLogger(this).error("Failed to load water material normal texture.",n)}}};u([p()],mR.prototype,"_resourcesTask",void 0),u([p({type:Boolean,readOnly:!0})],mR.prototype,"updating",null),mR=u([A("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],mR);let G3t=class extends cr{},H3t=class{constructor(e,i){this.parameters=e,this.fbos=i}},q3t=class{constructor(e,i,r){this._rctx=e,this._renderFunctions=i,this._forceCameraHook=r,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene($t.BACKGROUND);const i=ta();return this._screenshotQueue.push({settings:e,resolver:i}),i.promise}update(e,i){for(const r of this._screenshotQueue){if(this._rctx==null){r.resolver.reject();continue}const s={...r.settings,pixelRatio:r.settings.pixelRatio*e.parameters.camera.pixelRatio},n=this._renderScreenshot(e,s,i);r.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,i,r){e.width=i.width,e.height=i.height;const s=e.getContext("2d"),n=r.pixelRatio;return s.save(),s.translate(0,i.height),s.scale(1,-1),r.region&&s.translate(-r.region.x,-r.region.y),s.scale(n,n),i=this._renderFunctions.renderOverlay(e,r.disableDecorations,i),s.restore(),i}_readbackScreenshot(e,i){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},i):this._readbackScreenshotImmediate(e,i)}_readbackScreenshotResampled(e,i){const{framebufferWidth:r,framebufferHeight:s,region:n,resample:o}=e,a=this._ensureScreenshotEncodeCanvas();let l=c5(r,s,a);this._rctx.gl.readPixels(0,0,r,s,Tt.RGBA,ki.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),i(),l=this._renderScreenshotOverlay(a,l,{...e,region:void 0});const c=c5(n.width,n.height,a);return oIe(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,i){const{framebufferHeight:r,region:s}=e,n=this._ensureScreenshotEncodeCanvas(),o=c5(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,r-(s.y+s.height),s.width,s.height,Tt.RGBA,ki.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),i(),this._renderScreenshotOverlay(n,o,e)}_renderScreenshot(e,i,r){const s=e.parameters.camera,n={width:i.framebufferWidth,height:i.framebufferHeight};Px(n,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let o=!1;const a=n.width!==s.fullWidth||n.height!==s.fullHeight,l=i.ignorePadding&&s.pixelRatio!==i.pixelRatio,c=a||i.disableDecorations||l||i.objectAndLayerIdColor;let h=null,d=null;if(c){const v=s.clone();if(i.ignorePadding){const S=UG(v.padding);for(let C=0;C<4;C++)S[C]=Math.round(S[C]/v.pixelRatio*i.pixelRatio);v.padding=S}v.fullWidth=n.width,v.fullHeight=n.height,v.pixelRatio=i.pixelRatio;const _=s.fovX-v.fovX,b=s.fovY-v.fovY;_<0&&_<b?v.fovX=s.fovX:b<0&&b<_&&(v.fovY=s.fovY);const w={camera:v,contentCamera:v,mode:ui.IDLE,alignPixelEnabled:!0,contentPixelRatio:v.pixelRatio,forcedAnimationTime:e.parameters.forcedAnimationTime};this._forceCameraHook(w),o=!0;const x=this._renderFunctions.renderScene(w,r,i.objectAndLayerIdColor?zp.ObjectAndLayerID:zp.Screenshot,i.disableDecorations);d=x.screen,h=x.olid}const f=()=>{this._rctx.bindFramebuffer(null),d==null||d.release()};this._rctx.bindFramebuffer(d==null?void 0:d.fbo);const m=this._readbackScreenshot(i,f);let g=null;if(i.objectAndLayerIdColor){const v=()=>{this._rctx.bindFramebuffer(null),h==null||h.release()};this._rctx.bindFramebuffer(h==null?void 0:h.fbo),g=this._readbackScreenshot(i,v),this._rctx.bindFramebuffer(null)}if(c&&!this._rctx.contextAttributes.alpha)for(let v=3;v<m.data.length;v+=4)m.data[v]=255;if(g&&!this._rctx.contextAttributes.alpha)for(let v=3;v<g.data.length;v+=4)g.data[v]=255;return o&&this._forceCameraHook(e.parameters),[m,g]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas??(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}},aa=class extends he{constructor(e){super(e),this.events=new Ss,this.waterTextures=new mR,this.olidRenderHelper=Dd()?new VRt:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._savedFadeDuration=0;const i=e.stage;try{this._initializeContext(i)}catch(n){return void console.error("Failed to initialize context",n)}const{memoryController:r}=i.view.resourceController;this.stippleTextures=Vyt(this._rctx,r),this.markerTextures=j3t(this._rctx,r),this._techniques=new rRt(new iRt(this._rctx,i.viewingMode,this.stippleTextures,this.waterTextures,this.markerTextures)),this._textures=new y2(i),this.addHandles(this._textures.events.on("changed",n=>this.requestRender(n))),this._materials=new dLe(this._textures,this._techniques,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new BRt(this._rctx,this._techniques),this.renderer=new _z(i,this._materials,this._techniques,this._rctx,this._compositingHelper,n=>this.requestRender(n)),this.addHandles([H(()=>i.view.ready,n=>{n&&this._createRenderNodes()},Ut),H(()=>{var n;return(n=this.waterTextures)==null?void 0:n.updating},()=>this.requestRender(),Ut),H(()=>i.view.qualityProfile,n=>{var o;return(o=this.renderer)==null?void 0:o.updateRenderFeatures(n)},Mt)]);const s={renderScene:(n,o,a,l)=>this.renderer.render(n,o,a,l),requestRenderScene:n=>this.requestRender(n),prepareOverlay:()=>i.options.screenshot.prepareOverlay(),renderOverlay:(n,o,a)=>i.options.screenshot.renderOverlay(n,o,a)};this._screenshotManager=new q3t(this._rctx,s,n=>this.events.emit("force-camera-for-screenshot",n)),this._registerFrameTask(i)}destroy(){var i;const e=(i=this.stage)==null?void 0:i.container;e!=null&&e.contains(this._canvas)&&e.removeChild(this._canvas),this._frameTask=Ji(this._frameTask),this._techniques=$e(this._techniques),this._componentObjects=$e(this._componentObjects),this._screenshotManager=$e(this._screenshotManager),$e(this.renderer),this._textures=$e(this._textures),$e(this.waterTextures),$e(this.markerTextures),$e(this.stippleTextures),this._canvas=null,this._rctx=$e(this._rctx)}_createRenderNodes(){const{view:e,viewingMode:i}=this.stage;new xQ({view:e}),QA(e.spatialReference)||(i===je.Local?new vQ({view:e}):KA(e.spatialReference)?new WOt({view:e}):(new mQ({view:e}),new gQ({view:e}),new wQ({view:e}),new yQ({view:e}))),new r2({view:e,isEnabled:()=>this.renderer.hasSSAO}),new W1({view:e,isEnabled:()=>this.renderer.hasSMAA}),new q1({view:e}),new qI({view:e}),new m2({view:e,viewingMode:i}),new uR({view:e}),Dd()&&new cR({view:e})}requestRender(e=$t.UPDATE){this._needsRender=!0,e===$t.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textures.updating||this.waterTextures.updating}get textures(){return this._textures}get techniques(){return this._techniques}get compositingHelper(){return this._compositingHelper}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(i=>i[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,i,r,s,n,o=n){const a=s.constrainWindowSize(i,r,n*s.pixelRatio,o*s.pixelRatio),l=this._ensureLinearDepthArrayBuffer(a);this.renderer.readMainDepth(a,l);const c=(d,f,m)=>hne(f,d)*(m[1]-m[0])+m[0];let h=Number.MAX_VALUE;for(let d=0;d<a[2]*a[3];d++){const f=c(4*d,l,s.nearFar);h>f&&f!==s.nearFar[0]&&f!==s.nearFar[1]&&(h=f)}if(e){const d=e.pickDepth(i*s.pixelRatio,r*s.pixelRatio,s);d!=null&&h>d&&d!==s.nearFar[0]&&d!==s.nearFar[1]&&(h=d)}return h===Number.MAX_VALUE?void 0:h}_ensureLinearDepthArrayBuffer(e){const i=4*e[2]*e[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<i)&&(this._tmpDepthBuffer=new Uint8Array(i)),this._tmpDepthBuffer}async reloadShaders(){var e;Kke(),await this._techniques.reloadAll(),(e=this.renderer.overlay)==null||e.reloadShaders(),this.requestRender()}_registerFrameTask(e){const i=e.view.state;let r=!1,s=$t.BACKGROUND,n=!1;const o={preRender:({time:a})=>{r=this.updating,s=this._needsUpdate?$t.UPDATE:$t.BACKGROUND,e.commitSyncLayers(),a=this._testTime??a,(a-this._lastAnimationUpdate>this.renderer.animationTimestep||i.forcedAnimationTime!=null||r||this._needsRender)&&(this.renderer.updateAnimation(i,a)&&this.requestRender($t.BACKGROUND),this._lastAnimationUpdate=a)},render:({time:a})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&i.camera.fullWidth>0&&i.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,a=this._testTime??a,this.renderer.render(i,a),n=!0,l&&this.renderer.hasReflections&&(this.requestRender($t.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:a})=>{this._textures.update();const l=new H3t(i,this.renderer.fboCache);a=this._testTime??a,this._screenshotManager.update(l,a)},finish:()=>{n&&(this.renderer.finish(i.mode===ui.IDLE?s:$t.UPDATE),n=!1)}};this._frameTask=tg(o)}_initializeContext(e){const{options:i}=e,r=i.canvas??document.createElement("canvas");r.setAttribute("style","width: 100%; height:100%; display:block;"),this._canvas=r;const s={alpha:i.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:i.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:i.preserveDrawingBuffer??!1},n=r.getContext("webgl2",s);if(n==null)return void J.getLogger(this).error("A WebGL2 context could not be created.");this._rctx=W3t(n,e),this._loadShaderOnlyExtensions(),!i.alpha&&this._rctx.contextAttributes.alpha&&J.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested");const{container:o}=e;!this._rctx.contextAttributes.alpha&&X("safari")>=11&&(o.style.backgroundColor="black"),o.contains(r)||o.appendChild(r)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloatLinear")}get _viewingMode(){return this.stage.viewingMode}getObjectAndLayerIdColor(e){var i;return(i=this.olidRenderHelper)==null?void 0:i.getObjectAndLayerIdColor(e)}get componentObjectCollection(){return this._componentObjects==null&&(this._componentObjects=new QIt(this.renderer.renderPassManager,this._viewingMode)),this._componentObjects}set componentObjectCollection(e){this._componentObjects=e}updateQualitySettings(e){this._testTime!=null&&(this._savedFadeDuration=e.fadeDuration,e.fadeDuration=0)}set testTime(e){this._testTime=e,e==null?this.stage.view.qualitySettings.fadeDuration=this._savedFadeDuration:this.updateQualitySettings(this.stage.view.qualitySettings)}get testTime(){return this._testTime}};function W3t(t,e){const i=(s,n)=>e.view.resourceController.memoryController.newCache(s,n),r={disabledExtensions:e.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:e.options.debugWebGLExtensions||{},maxAnisotropy:8,newCache:i};return new B3t(t,r)}u([p({type:Boolean,readOnly:!0})],aa.prototype,"updating",null),u([p({constructOnly:!0})],aa.prototype,"stage",void 0),u([p()],aa.prototype,"_rctx",void 0),u([p()],aa.prototype,"_canvas",void 0),u([p()],aa.prototype,"stippleTextures",void 0),u([p()],aa.prototype,"markerTextures",void 0),u([p()],aa.prototype,"waterTextures",void 0),u([p({readOnly:!0})],aa.prototype,"olidRenderHelper",void 0),u([p()],aa.prototype,"_textures",void 0),u([p({readOnly:!0})],aa.prototype,"renderer",void 0),u([p()],aa.prototype,"_screenshotManager",void 0),u([p()],aa.prototype,"componentObjectCollection",null),u([p()],aa.prototype,"_componentObjects",void 0),u([p()],aa.prototype,"_needsUpdate",void 0),u([p()],aa.prototype,"_needsWaterReflectionUpdate",void 0),aa=u([A("esri.views.3d.webgl-engine.parts.RenderView")],aa);let Nh=class extends he{constructor(e){super(e),this._model=new uz,this._layers=new ii,this._asyncChangeSet=new tK,this._syncChangeSet=new tK,this._layerSyncSet=new Set}initialize(){this._set("renderView",new aa({stage:this})),this._frameTask=this.view.resourceController.scheduler.registerTask(lt.STAGE,this),this.addHandles(this._frameTask)}destroy(){this.renderView.destroy()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){var e;return(e=this.renderView)==null?void 0:e.renderer}add(e){this._model.add(e),VB(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){e!=null&&!this.destroyed&&this._model.remove(e)&&(VB(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){e!=null&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){var i,r;e!=null&&((i=this._model)==null||i.removeMany(e),(r=this.renderView)==null||r.requestRender())}forEachOfType(e,i){this._model.forEachOfType(e,i)}handleEvent(e,i){this.destroyed||(this._model.dirtySet[e](i),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){if(this._frameTask.processQueue(e),this._commit(e),!e.hasProgressed)return ea}_commit(e){const i=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{if(e.done)return;const s=this._layerSyncSet.has(r.id)||r.updatePolicy===Eb.SYNC,n=s?this._syncChangeSet:this._asyncChangeSet;i.commitLayer(r.id,n),this._layerSyncSet.delete(r.id),n.empty||(this.renderer.modify(n,s?Kc:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Kc),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{e.done||this._layerSyncSet.has(r.id)||r.updatePolicy!==Eb.ASYNC||(i.commitLayer(r.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(i=>{this._layerSyncSet.has(i.id)||i.updatePolicy===Eb.SYNC?(e.commitLayer(i.id,this._syncChangeSet),this._layerSyncSet.delete(i.id)):e.commitSyncUpdates(i.id,this._syncChangeSet)});for(const i of this._layerSyncSet)e.commitLayer(i,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Kc),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Kc),this.renderView.requestRender())}schedule(e,i){return this._frameTask.schedule(e,i)}reschedule(e,i){return this._frameTask.reschedule(e,i)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,Kc))}addRenderPlugin(e,i){const r=this.renderer.plugins.add(e,i),s=()=>{_ve(e)&&this.view.sceneIntersectionHelper.addIntersectionHandler(e)};if(uu(r))return r.then(s);s()}removeRenderPlugin(e){this.destroyed||(_ve(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.plugins.remove(e))}get performanceInfo(){return this._model.getStats()}get test(){}};u([p({constructOnly:!0})],Nh.prototype,"view",void 0),u([p({constructOnly:!0})],Nh.prototype,"options",void 0),u([p({readOnly:!0})],Nh.prototype,"viewingMode",null),u([p({constructOnly:!0})],Nh.prototype,"container",void 0),u([p({readOnly:!0})],Nh.prototype,"updating",null),u([p({constructOnly:!0})],Nh.prototype,"_model",void 0),u([p()],Nh.prototype,"renderView",void 0),u([p({readOnly:!0})],Nh.prototype,"renderer",null),u([p({readOnly:!0})],Nh.prototype,"running",null),Nh=u([A("esri.views.3d.webgl-engine.Stage")],Nh);function Hdi(t){return t&&typeof t.highlight=="function"}function Z3t(t){return t&&typeof t.maskOccludee=="function"}function Y3t(t,e,i){return t==null||t>=i&&(e===0||t<=e)}function qdi(t,e){if(e&&t){const{minScale:i,maxScale:r}=t;if(J3t(i,r))return Y3t(e,i,r)}return!0}function J3t(t,e){return t!=null&&t>0||e!=null&&e>0}function Wdi(t){return!(t!=null&&t.minScale)||!t.maxScale||t.minScale>=t.maxScale}function Zdi(t){return t!=null&&typeof t=="object"&&"createQuery"in t&&"queryFeatures"in t&&"layer"in t&&"view"in t}function Ydi(t,e,i){return new U("layerview:spatial-reference-incompatible",`The spatial reference of this ${t}${e?`(wkid:${e})`:""} is incompatible with the spatial reference of the view${i?`(wkid:${i})`:""}.`,{})}function X3t(t){return e=>{if(t.immediate)return t.immediate.schedule(e);const i="No immediate scheduler";throw console.error(i),new Error(i)}}const yV=new Set,B5e=()=>J.getLogger("esri/views/support/TextureCompressionHelper");function K3t(t,e){return pi.compressionWorkerHandle??(pi.compressionWorkerHandle=new NMt(X3t(e))),yV.has(t)?B5e().warn("Repeated texture compression worker initialization by the same view."):yV.add(t),pi.compressionWorkerHandle}function Q3t(t){pi.compressionWorkerHandle&&(yV.delete(t)||B5e().warn("Unknown view attempted to destroy the texture compression worker."),yV.size||($e(pi.compressionWorkerHandle),pi.compressionWorkerHandle=null))}let bz=class extends kG{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};u([p()],bz.prototype,"components",void 0),bz=u([A("esri.views.ui.3d.DefaultUI3D")],bz);const V5e=bz;let Ze=class extends OCe(t$e(e$e(EMe))){constructor(t){super(t),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._overrideDefaultEnvironmentOnly=!0,this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new _v({slicePlane:ARe},this),this._resourceController=Q2t(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new kK({view:this}),this.labeler=new H1({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new eA,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new vx,this.environment=new u2,this.environmentManager=new Ph,this.floors=new Ce,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new G_t({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new e2t({view:this}),this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new V5e,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.focusAreas=new i_({view:this}),sCe();const e=(i=null)=>{i!=null&&i.type===Er.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async r=>{try{await r.when()}catch{}this._updatingChanged()}))};this.addHandles([so(()=>{var i;return(i=this.map)==null?void 0:i.allLayers},"after-changes",i=>e(i),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",i=>this._updateUpdatingMonitors(i)),H(()=>this.map,i=>{i&&"load"in i&&i.load&&i.load().catch(()=>{})})]),this.inputManager=new rxt({view:this}),this.stateManager=new Us({view:this})}initialize(){if(X("enable-feature:esri-compress-textures")){const e=K3t(this,this.resourceController);this.addResolvingPromise(e.promise)}this.groundView=new V_t({view:this}),this._updateUpdatingMonitors();const t=()=>this._updateDefaultToMapOptions();this.addHandles(so(()=>{var e;return(e=this.map)==null?void 0:e.allLayers},"after-changes",t,{onListenerAdd:t,onListenerRemove:t})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},Ut),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},Ut),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>EGe(e>0?1e3/Math.ceil(e):0),Ut),this.updatingHandles.add(()=>{var e;return(e=this.map)==null?void 0:e.ground},t,Mt),this.updatingHandles.add(()=>{var e,i;return(i=(e=this.map)==null?void 0:e.ground)==null?void 0:i.opacity},()=>this._updateDefaultHitTestOptions(),Mt),this.addHandles(H(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),Yt))}destroy(){var t;this.destroyed||(Q3t(this),this.updatingHandles.removeAll(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._set("analysisViewManager",$e(this.analysisViewManager)),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=$e(this.sharedSymbolResources),this._set("labeler",$e(this.labeler)),this._set("deconflictor",$e(this.deconflictor)),this._resourceController=$e(this._resourceController),this._set("stateManager",$e(this.stateManager)),this._set("inputManager",$e(this.inputManager)),this.state.destroy(),this.highlights.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",$e(this.environmentManager)),this._set("environment",$e(this.environment)),this.groundView=$e(this.groundView),this._exitBasemapTerrain(),(t=this._stage)==null||t.destroy())}get renderSpatialReference(){var t;return(t=this.renderCoordsHelper)==null?void 0:t.spatialReference}get basemapSpatialReference(){var t;return(t=this.basemapTerrain)==null?void 0:t.spatialReference}get animation(){var t;return(t=this.state)==null?void 0:t.animation}get camera(){var t;return(t=this.stateManager)==null?void 0:t.camera}set camera(t){this.stateManager&&(this.stateManager.camera=t)}get contentCamera(){var t;return(t=this.stateManager)==null?void 0:t.contentCamera}set contentCamera(t){this.stateManager&&(this.stateManager.contentCamera=t)}installContentCameraReset(t={sticky:!1}){return this.stateManager.installContentCameraReset(t)}get center(){var t;return(t=this.stateManager)==null?void 0:t.center}set center(t){this.stateManager&&(this.stateManager.center=t)}get clippingArea(){if(this.viewingMode==="global")return null;const t=this.map;let e=this._userClippingArea||kce(t,"clippingArea");return!this._userClippingArea&&!kce(t,"clippingEnabled")||e==null?(this._clippingArea=null,null):e instanceof _i?this.spatialReference&&(e=Ik(e,this.spatialReference),e==null)?(J.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),e.intersection(this._groundAndLayersExtent)==null&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(J.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(t){this.ready&&this.viewingMode==="global"&&t!=null?J.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=t}get renderDataExtent(){if(this.state.viewingMode===je.Global)return null;const t=this.renderSpatialReference,e=this.dataExtent;return e==null||t==null||e.spatialReference.equals(t)?e:Ik(e,t)}get tileInfo(){var t,e;return(e=(t=this.basemapTerrain)==null?void 0:t.tilingScheme)==null?void 0:e.toTileInfo()}get dataExtent(){let t=this._groundAndLayersExtent;const e=this.spatialReference||Oe.WGS84,i=Ik(this.clippingArea,e);i!=null&&(t=t!=null?t.intersection(i):i);const r=this._get("dataExtent");return t!=null&&t.equals(r)?r:t}get _groundAndLayersExtent(){const t=this.spatialReference||Oe.WGS84;let e;const i=n=>{const o=Ik(n,t);o!=null&&(e!=null?e.union(o):e=o.clone())},r=this.basemapTerrain;if(r!=null&&r.spatialReference){const n=r.groundExtent;i(new _i({xmin:n[0],ymin:n[1],zmin:0,xmax:n[2],ymax:n[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){const n=o=>{o.fullExtent==null||o.type==="graphics"&&o.internal||i(o.fullExtent)};this.map.allLayers.forEach(o=>n(o))}if(e==null)return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const s=this._get("_groundAndLayersExtent");return e.equals(s)?s:e}castEnvironment(t){var e;return t?t instanceof u2?t:t instanceof EA?((e=this.environment)==null?void 0:e.cloneWithWebsceneEnvironment(t))??u2.fromWebsceneEnvironment(t):Ds(u2,t):new u2}get extent(){var t;return(t=this.stateManager)==null?void 0:t.extent}set extent(t){this.stateManager&&(this.stateManager.extent=t)}get screenCenter(){var t;return(t=this.stateManager)==null?void 0:t.screenCenter}get frustum(){var t;return(t=this.stateManager)==null?void 0:t.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){var t;return this.navigating||(((t=this.toolViewManager)==null?void 0:t.interacting)??!1)}get stationary(){var t;return!this.animation&&!this.resizing&&(((t=this.state)==null?void 0:t.stationary)??!0)}get navigating(){var t;return((t=this.state)==null?void 0:t.navigating)??!1}get padding(){var t;return(t=this.stateManager)==null?void 0:t.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}set qualityProfile(t){var e;nS.isValidProfile(t)&&(nS.apply(t,this.qualitySettings),(e=this._stage)==null||e.renderView.updateQualitySettings(this.qualitySettings),this._set("qualityProfile",t))}get qualityProfile(){return this._get("qualityProfile")||nS.getDefaultProfile()}set slicePlane(t){if(this._stage!=null&&(this._stage.renderer.slicePlane=t),t==null)return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");lT(t,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){var t;return!!this.viewingMode&&!!((t=this.stateManager)!=null&&t.preinit(this.spatialReference))}get resolution(){return this.spatialReference!=null?bct(this.scale,this.spatialReference):0}get scale(){var t;return(t=this.stateManager)==null?void 0:t.scale}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get heightModelInfo(){const t=this.getDefaultHeightModelInfo();return t!=null?rw.deriveUnitFromSR(t,this.spatialReference):null}get updating(){var s,n,o,a;if(this.destroyed)return!1;let t=0,e=this.layerViewManager.updating,i=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(l=>{if(l.isFulfilled()){if(l.updating){if(e=!0,l.suspended||XK(l))return;++i,t+=l.updatingProgress}}else++i});for(const l of this._updatingObjects)l!=null&&l.updating&&(i+=.1,t+=.5*.1);for(const l of this._updatingObjectsWithProgress)l!=null&&l.updating&&(++i,t+=l.updatingProgress);const r=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(e=!!(e||i>0||this.updatingHandles.updating||!this.ready||!this.stationary||r||this._createGraphicsViewController||(s=this.inputManager)!=null&&s.updating||(o=(n=this.map)==null?void 0:n.allLayers)!=null&&o.some(l=>!l.isFulfilled())||(a=this.textures)!=null&&a.updating),e?(this._numUpdating=Math.max(i,this._numUpdating),t+=this._numUpdating-i):this._numUpdating=0,this._numUpdating>0?t/=this._numUpdating:t=e?0:1,this._get("updatingProgress")!==t){const l=performance.now();if(t<1){const c=Math.min((l-this._lastUpdateTime)/2e3,1);t=this.updatingProgress*(1-c)+t*c}this._set("updatingProgress",t),this._lastUpdateTime=e&&t<1?l:0}return e}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){var i;const t=this._predeterminedViewingMode;if(t!=null)return cP(t);const e=this.spatialReference;return e?((i=this.defaultsFromMap)==null?void 0:i.viewingMode)!=null&&e.equals(this.defaultsFromMap.spatialReference)?cP(this.defaultsFromMap.viewingMode):SA(e,je.Global)?"global":"local":"global"}set viewingMode(t){this.ready?J.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",t)}get viewpoint(){var t;return(t=this.stateManager)==null?void 0:t.viewpoint}set viewpoint(t){this.stateManager&&(this.stateManager.viewpoint=t)}get visibleArea(){var t;return(t=this.stateManager)==null?void 0:t.visibleArea}get zoom(){return this.stateManager.zoom}set zoom(t){this.stateManager&&(this.stateManager.zoom=t)}get highlightOptions(){return this.highlights.find(({name:t})=>t===jm)??new Gm}set highlightOptions(t){for(let e=0;e<this.highlights.length;++e)if(this.highlights.at(e).name===jm)return void this.highlights.items[e].assignFrom(t)}get resourceController(){return this._resourceController}get quality(){var t,e;return((e=(t=this._resourceController)==null?void 0:t.memoryController)==null?void 0:e.memoryFactor)??1}get resolutionScale(){return Math.sqrt(Math.min(1,this.quality/.75))}get performanceInfo(){return new iCt(this)}on(t,e,i,r){return this.viewEvents.on(t,e,i,r)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}toMap(t,e){if(!this.ready)return J.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;const i=QU(t)?KU(this,t):t;return v2t(this,i,e,this._defaultToMapOptions)}toScreen(t){if(!this.ready)return J.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=(t.z==null?Pm(this.elevationProvider,t):null)??0;return gc(t,Rk,this.renderSpatialReference,e),this.state.camera.projectToScreen(Rk,w7),xo(w7[0],w7[1])}pixelSizeAt(t,e){if(!this.ready)return J.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if(!t)return 0;const i=this.renderSpatialReference;gc(t,Rk,i);const r=this.state.camera.computeScreenPixelSizeAt(Rk);return e&&i!==e?r*Mo(i)/Mo(e):r}overlayPixelSizeInMapUnits(t){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(t,()=>this.pixelSizeAt(t)):1}hitTest(t,e){if(!this.ready)return J.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;const i=QU(t)?KU(this,t):t;return y2t(this,i,e,this._defaultHitTestOptions)}async popupHitTest(t){return O2t(this,t)}goTo(t,e){return this.updatingHandles.addPromise(this.stateManager.goTo(t,e))}async whenAnalysisView(t){if(t.parent==null)throw new U("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});switch(t.parent.type){case"line-of-sight":case"dimension":case"viewshed":return(await this.whenLayerView(t.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(t)}}whenLayerView(t){return super.whenLayerView(t)}async takeScreenshot(t){const e=await this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(e);return(await G(async()=>{const{encode:r}=await Promise.resolve().then(()=>JM);return{encode:r}},void 0)).encode(i,e,this._pixelFormat())}async _takeScreenshot(t){const e=await this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(e);return(await G(async()=>{const{encodeData:r}=await Promise.resolve().then(()=>JM);return{encodeData:r}},void 0)).encodeData(i,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(t){const e=await this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(e),{encodeData:r}=await G(async()=>{const{encodeData:s}=await Promise.resolve().then(()=>JM);return{encodeData:s}},void 0);return[r(i[0],this._pixelFormat()),r(i[1],this._pixelFormat())]}async _completeSettings(t){const{toRenderSettings:e,screenshotSuperSampleSettings:i}=await G(()=>Promise.resolve().then(()=>JM),void 0),r=e(t,this);return r.pixelRatio/=this.state.pixelRatio,i(r,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){}async takeScreenshotWithObjectAndLayerId(t){if(!Dd())throw new U("360vr:objectAndLayerId-rendering-disabled","has enable-feature:objectAndLayerId-rendering must be true");const{encode:e}=await G(()=>Promise.resolve().then(()=>JM),void 0),i=await this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(i),s=e(r[0],i,this._pixelFormat()),n=await this._completeSettings(t);return n.format="png",[s,e(r[1],n,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){const t=this._stage.renderView.olidRenderHelper;if(t)return t.getColorToObjectAndLayerIdMapping();throw new U("360vr:objectAndLayerId-rendering-disabled","has enable-feature:objectAndLayerId-rendering must be true")}addUpdatingPromise(t){return this.updatingHandles.addPromise(t)}importLayerView(t){return mge.importLayerView(t)}hasLayerViewModule(t){return mge.hasLayerViewModule(t)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var t,e,i;return this.map&&"initialViewProperties"in this.map&&((t=this.map.initialViewProperties)==null?void 0:t.spatialReference)||((e=this.defaultsFromMap)==null?void 0:e.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.ready)&&this._initialDefaultSpatialReference||null}async validate(){let t=pIe(this.type);const e=X("safari");if(e&&e<9&&(t=new U("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),t!=null)throw J.getLogger(this).warn("#validate()",t.message),t}get _predeterminedViewingMode(){var e;const t=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?(e=this.map.initialViewProperties)==null?void 0:e.viewingMode:null)??null;return t!=null?TJ(t):null}getSpatialReferenceSupport(t,e){const i=this._predeterminedViewingMode;if(i!=null)return this._validateSpatialReferenceForViewingMode(t,e,i)?{constraints:this._makeSpatialReferenceConstraints(t,e,i)}:null;const r=this._validateSpatialReferenceForViewingMode(t,e,je.Local),s=this._validateSpatialReferenceForViewingMode(t,e,je.Global);return r||s?r&&s?{constraints:this._makeSpatialReferenceConstraints(t,e,null)}:r?{constraints:this._makeSpatialReferenceConstraints(t,e,je.Local)}:{constraints:this._makeSpatialReferenceConstraints(t,e,je.Global)}:null}_validateSpatialReferenceForViewingMode(t,e,i){return!!SA(t,i)&&(e==null||!!Nhe(e)||(!HC(e)||q6(e,t,i)!=null)&&(!Lhe(e)||i!==je.Global))}_makeSpatialReferenceConstraints(t,e,i){if(e==null)return[{spatialReference:t,viewingMode:i}];const{isWebMercator:r,isWGS84:s}=t;return Nhe(e)&&(r||s)?!s||i===je.Local||cD(e.tileInfo,e.fullExtent,t,je.Global)===null?[{spatialReference:t,viewingMode:i},{spatialReference:Oe.WebMercator,viewingMode:i}]:[{spatialReference:r?Oe.WGS84:Oe.WebMercator,viewingMode:i}]:HC(e)||Lhe(e)||!r&&!s?HC(e)&&r&&i!==je.Global?[{spatialReference:t,viewingMode:i},{spatialReference:Oe.WGS84,viewingMode:je.Local}]:[{spatialReference:t,viewingMode:i}]:[{spatialReference:t,viewingMode:i},{spatialReference:r?Oe.WGS84:Oe.WebMercator,viewingMode:i}]}_validateSpatialReference(t){const e=this.getSpatialReferenceSupport(t)!=null,i=this._predeterminedViewingMode;return e||(i!=null?J.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${cP(i)} viewing mode.`):t.isGeographic&&J.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}trackGraphicState(t){if(!t.graphic)return J.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(t.graphic);let i=null,r=!1;const s=n=>{var o;!r&&n!=null&&"processor"in n&&((o=n.processor)==null?void 0:o.type)==="graphics-3d"&&n.processor.graphicsCore&&(i=n.processor.graphicsCore.trackGraphicState(t))};return e!=null?s(e):this.whenViewForGraphic(t.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),Pi(()=>{r=!0,i!=null&&(i.remove(),i=null)})}maskOccludee(t){if(!t)return J.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(t);let i=null,r=!1;const s=n=>{!r&&n!=null&&Z3t(n)&&(i=n.maskOccludee(t))};return e!=null?s(e):this.whenViewForGraphic(t,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),Pi(()=>{r=!0,i!=null&&(i.remove(),i=null)})}getViewForGraphic(t){return t.layer===this.graphics?this.graphicsView:t.layer?this.allLayerViews.filter(e=>e.type!=="media-3d").find(e=>e.layer===t.layer):null}graphicChanged(t){this.graphicsView!=null&&this.graphicsView.graphicChanged(t)}async whenViewForGraphic(t,e){if(t.layer===this)return await Id(()=>this.graphicsView),this.graphicsView;if(!t.layer||!this.map)throw new U("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(t.layer)?new Promise((i,r)=>{const s=this.map.allLayers.on("change",n=>{n.added.includes(t.layer)&&(s.remove(),this.whenLayerView(t.layer).then(i,r))})}):this.whenLayerView(t.layer)}_initBasemapTerrain(){this._set("basemapTerrain",new rOt({view:this})),this._set("elevationProvider",new nR({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new Yl({view:this})),this._set("featureTiles",new Bo({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const t=()=>{var i;const e=(i=this.basemapTerrain)==null?void 0:i.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const r=this.basemapTerrain.extent!=null&&this.basemapTerrain.spatialReference!=null?Nd(GD(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.clippingArea?this.featureTiles.filterExtent=this.clippingArea.intersection(r):this.featureTiles.filterExtent=r}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>xs.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(G(()=>import("./FeatureTileTree3DDebugger-CqkcqBjq.js"),__vite__mapDeps([366,363]))).then(({FeatureTileTree3DDebugger:i})=>{!this._featureTreeDebugger&&xs.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new i({view:this}))}):e||!this._featureTreeDebugger||xs.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},Mt),this.updatingHandles.add(()=>this.clippingArea,t,Mt),this.updatingHandles.add(()=>this.basemapTerrain.extent,t,Mt)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.featureTiles&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this._set("featureTiles",$e(this.featureTiles)),this._set("pointsOfInterest",$e(this.pointsOfInterest)),this._exitBasemapTerrain(),this.state.reset(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const t=this.spatialReference,e=this.state.isGlobal,i=_ct(e,t);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",D2t.create(this.state.viewingMode,i)),e||this.addHandles(H(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.extent},r=>{const s=this.renderCoordsHelper.spatialReference;r==null||r[0]===0&&r[1]===0&&r[2]===0&&r[3]===0||!Ese(r,this.basemapTerrain.spatialReference,Obe,s)||(this.renderCoordsHelper.extent=Obe)},Yt),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(yA/this.renderCoordsHelper.unitInMeters))}else this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null)}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(t=null){t!=null&&t.type===Er.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.addHandles(H(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),Yt),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(t,e,i){if(!this.overlay||!this.overlay.hasVisibleItems)return i;const r=t.getContext("2d");return r.putImageData(i,0,0),this.overlay.renderCanvas(t,{disableDecorations:e}),r.getImageData(0,0,i.width,i.height)}_initStage(){const t={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(r,s,n)=>this._renderScreenshotOverlay(r,s,n)}},e=new x2t(this.state.viewingMode,r=>this._stage.layers.forAll(r),this);this._set("sceneIntersectionHelper",e);const i=nG(this.surface);this._stage=new Nh({view:this,options:t,container:i}),this._stage.renderer.slicePlane=this.slicePlane,this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,r=>this._stage.renderer.setParameters({highQualityTransparency:r}),Ut),this.on("pointer-move",()=>{var r;return(r=this._stage)==null?void 0:r.renderer.resetAnimation()}),ZA(this._stage.renderView.canvas,"webglcontextlost",r=>{this.fatalError=new U("webgl-context-lost",r.statusMessage)})],"stage"),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(yA/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=$e(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(t){this._exitSurface(),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new yCt({view:this,viewingMode:t,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;const t=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(t,t),this._updatingChanged()}async _createGraphicsViewAsync(t){const e=(await G(async()=>{const{default:i}=await import("./GraphicsView3D-D3uzlhQc.js");return{default:i}},__vite__mapDeps([367,278,257,258,27,26,170,271,260]))).default;gt(t),await Id(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.ready},t),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),this.graphicsView!=null&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const t=TJ(this.viewingMode);t===je.Global&&(this._clippingArea=null),this._initSurface(t),this._set("ready",!0),this.addHandles(so(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded();const e=this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties:null,i=e==null?void 0:e.environment;i&&(this._overrideDefaultEnvironmentOnly?rRe(this.environment,i):this.environment=this.environment.cloneWithWebsceneEnvironment(i)),this.timeExtent=e==null?void 0:e.timeExtent,this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect(),this._set("textures",new EC(this._stage,this.resourceController.scheduler));const r=this._resolveWhenReady;this._resolveWhenReady=[],r.forEach(s=>s(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this._overrideDefaultEnvironmentOnly=!1,this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._set("textures",$e(this.textures)),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(qb);for(const t of this.map.allLayers.items)w3(t.type)&&this._defaultToMapOptions.include.add(t.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(qb);for(const t of this.map.allLayers.items)w3(t.type)&&t.opacity<1&&this._defaultHitTestOptions.exclude.add(t.uid)}}};function Ik(t,e){return t!=null&&lu(t.spatialReference,e)?Nd(t,e):null}Ze.type="3d",u([p()],Ze.prototype,"_userClippingArea",void 0),u([p()],Ze.prototype,"_resourceController",void 0),u([p()],Ze.prototype,"_stage",void 0),u([p({readOnly:!0})],Ze.prototype,"deconflictor",void 0),u([p({readOnly:!0})],Ze.prototype,"labeler",void 0),u([p(KZ(eA,"analyses"))],Ze.prototype,"analyses",void 0),u([p({type:xv,readOnly:!0})],Ze.prototype,"animation",null),u([p({readOnly:!0})],Ze.prototype,"basemapTerrain",void 0),u([p({readOnly:!0})],Ze.prototype,"elevationProvider",void 0),u([p()],Ze.prototype,"camera",null),u([p({type:ou})],Ze.prototype,"contentCamera",null),u([p({readOnly:!0})],Ze.prototype,"canvas",void 0),u([p({type:Fe})],Ze.prototype,"center",null),u([p({type:_i})],Ze.prototype,"clippingArea",null),u([p({type:vx})],Ze.prototype,"constraints",void 0),u([p({type:_i,readOnly:!0})],Ze.prototype,"renderDataExtent",null),u([p({readOnly:!0})],Ze.prototype,"tileInfo",null),u([p({type:_i,readOnly:!0})],Ze.prototype,"dataExtent",null),u([p({type:_i,readOnly:!0})],Ze.prototype,"_groundAndLayersExtent",null),u([p({type:u2})],Ze.prototype,"environment",void 0),u([ti("environment")],Ze.prototype,"castEnvironment",null),u([p({readOnly:!0})],Ze.prototype,"environmentManager",void 0),u([p({type:_i})],Ze.prototype,"extent",null),u([p({type:Ce})],Ze.prototype,"floors",void 0),u([p()],Ze.prototype,"screenCenter",null),u([p()],Ze.prototype,"frustum",null),u([p({type:Number,readOnly:!0})],Ze.prototype,"fullOpacity",void 0),u([p({readOnly:!0})],Ze.prototype,"graphicsView",void 0),u([p({readOnly:!0})],Ze.prototype,"analysisViewManager",void 0),u([p()],Ze.prototype,"groundView",void 0),u([p({type:Boolean})],Ze.prototype,"initialExtentRequired",null),u([p()],Ze.prototype,"defaultsFromMapSettings",null),u([p()],Ze.prototype,"interacting",null),u([p()],Ze.prototype,"stationary",null),u([p()],Ze.prototype,"navigating",null),u([p()],Ze.prototype,"map",void 0),u([p()],Ze.prototype,"padding",null),u([p({type:Yl,readOnly:!0})],Ze.prototype,"pointsOfInterest",void 0),u([p({type:Bo,readOnly:!0})],Ze.prototype,"featureTiles",void 0),u([p()],Ze.prototype,"_featureTreeDebugger",void 0),u([p({type:Boolean})],Ze.prototype,"screenSizePerspectiveEnabled",void 0),u([p({constructOnly:!0})],Ze.prototype,"deactivatedWebGLExtensions",void 0),u([p({constructOnly:!0})],Ze.prototype,"debugWebGLExtensions",void 0),u([p({constructOnly:!0})],Ze.prototype,"renderCanvas",void 0),u([p({constructOnly:!0})],Ze.prototype,"state",void 0),u([p({readOnly:!0})],Ze.prototype,"inputManager",void 0),u([p({readOnly:!0})],Ze.prototype,"stateManager",void 0),u([p({type:["low","medium","high"]})],Ze.prototype,"qualityProfile",null),u([p({type:bve,get(){let t=this._get("qualitySettings");return t||(t=new bve,nS.apply(this.qualityProfile,t)),t}})],Ze.prototype,"qualitySettings",void 0),u([p()],Ze.prototype,"slicePlane",null),u([p({readOnly:!0})],Ze.prototype,"typeSpecificPreconditionsReady",null),u([p({readOnly:!0})],Ze.prototype,"renderCoordsHelper",void 0),u([p({readOnly:!0})],Ze.prototype,"sceneIntersectionHelper",void 0),u([p({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],Ze.prototype,"resolution",null),u([p({type:Number})],Ze.prototype,"scale",null),u([p()],Ze.prototype,"heightModelInfo",null),u([p()],Ze.prototype,"spatialReference",void 0),u([p({type:Boolean,constructOnly:!0})],Ze.prototype,"alphaCompositingEnabled",void 0),u([p({constructOnly:!0})],Ze.prototype,"preserveDrawingBufferEnabled",void 0),u([p({type:Boolean})],Ze.prototype,"supersampleScreenshotsEnabled",void 0),u([p({readOnly:!0})],Ze.prototype,"type",void 0),u([p(),ti(t=>t instanceof kG?t:GA(V5e,t))],Ze.prototype,"ui",void 0),u([p({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating","textures.updating"]})],Ze.prototype,"updating",null),u([p()],Ze.prototype,"_updatingObjects",null),u([p()],Ze.prototype,"_updatingObjectsWithProgress",null),u([p({type:Number,readOnly:!0,dependsOn:["updating"]})],Ze.prototype,"updatingProgress",void 0),u([p({type:["global","local"]})],Ze.prototype,"viewingMode",null),u([p({type:Qr})],Ze.prototype,"viewpoint",null),u([p({readOnly:!0})],Ze.prototype,"visibleArea",null),u([p({type:Number})],Ze.prototype,"zoom",null),u([p({type:Gm})],Ze.prototype,"highlightOptions",null),u([p({readOnly:!0})],Ze.prototype,"quality",null),u([p({readOnly:!0})],Ze.prototype,"resolutionScale",null),u([p()],Ze.prototype,"textures",void 0),Ze=u([A("esri.views.SceneView")],Ze);const Rk=$(),w7=ln(),Obe=si(),eDt=Ze;let tDt=class j5e{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(MW),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const i=new j5e,r=this._originStores[Oi.DEFAULTS];r&&r.forEach((s,n)=>{i.set(n,q(s),Oi.DEFAULTS)});for(let s=Oi.SERVICE;s<MW;s++){const n=this._originStores[s];n&&n.forEach((o,a)=>{e&&e.has(a)||i.set(a,q(o),s)})}return i}get(e,i){const r=i===void 0?this._values:this._originStores[i];return r?r.get(e):void 0}keys(e){const i=e==null?this._values:this._originStores[e];return i?[...i.keys()]:[]}set(e,i,r=Oi.USER){let s=this._originStores[r];if(s||(s=new Map,this._originStores[r]=s),s.set(e,i),!this._values.has(e)||this._propertyOriginMap.get(e)<=r){const n=this._values.get(e);return this._values.set(e,i),this._propertyOriginMap.set(e,r),n!==i}return!1}delete(e,i=Oi.USER){const r=this._originStores[i];if(!r)return;const s=r.get(e);if(r.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===i){this._values.delete(e);for(let n=i-1;n>=0;n--){const o=this._originStores[n];if(o&&o.has(e)){this._values.set(e,o.get(e)),this._propertyOriginMap.set(e,n);break}}}return s}has(e,i){const r=i===void 0?this._values:this._originStores[i];return!!r&&r.has(e)}revert(e,i){for(;i>0&&!this.has(e,i);)--i;const r=this._originStores[i],s=r==null?void 0:r.get(e),n=this._values.get(e);return this._values.set(e,s),this._propertyOriginMap.set(e,i),n!==s}originOf(e){return this._propertyOriginMap.get(e)||Oi.DEFAULTS}forEach(e){this._values.forEach(e)}};const G5e=t=>{let e=class extends t{constructor(...i){super(...i);const r=Ml(this),s=r.store,n=new tDt;r.store=n,uTe(r,s,n)}read(i,r){dTe(this,i,r)}getAtOrigin(i,r){const s=x7(this),n=Q_(r);if(typeof i=="string")return s.get(i,n);const o={};return i.forEach(a=>{o[a]=s.get(a,n)}),o}originOf(i){return fU(this.originIdOf(i))}originIdOf(i){return x7(this).originOf(i)}revert(i,r){const s=x7(this),n=Q_(r),o=Ml(this);let a;a=typeof i=="string"?i==="*"?s.keys(n):[i]:i,a.forEach(l=>{o.invalidate(l),s.revert(l,n),o.commit(l)})}};return e=u([A("esri.core.ReadOnlyMultiOriginJSONSupport")],e),e};function x7(t){return Ml(t).store}let Ibe=class extends G5e(he){};Ibe=u([A("esri.core.ReadOnlyMultiOriginJSONSupport")],Ibe);const iDt=t=>{let e=class extends t{constructor(...i){super(...i)}clear(i,r="user"){return S7(this).delete(i,Q_(r))}write(i,r){return fTe(this,i=i||{},r),i}setAtOrigin(i,r,s){Ml(this).setAtOrigin(i,r,Q_(s))}removeOrigin(i){const r=S7(this),s=Q_(i),n=r.keys(s);for(const o of n)r.originOf(o)===s&&r.set(o,r.get(o,s),Oi.USER)}updateOrigin(i,r){const s=S7(this),n=Q_(r),o=Bm(this,i);for(let a=n+1;a<MW;++a)s.delete(i,a);s.set(i,o,n)}toJSON(i){return this.write({},i)}};return e=u([A("esri.core.MultiOriginJSONSupport.WriteableMultiOriginJSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function S7(t){return Ml(t).store}const jL=t=>{let e=class extends iDt(G5e(t)){constructor(...i){super(...i)}};return e=u([A("esri.core.MultiOriginJSONSupport")],e),e};let dD=class extends jL(he){};dD=u([A("esri.core.MultiOriginJSONSupport")],dD);async function rDt(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return Cx(t);const i=Oe.WGS84;return await XD(e,i),Nd(t,i)}function gw(t,e){if(!kx(t,e)){const i=t.typeKeywords;i?i.push(e):t.typeKeywords=[e]}}function kx(t,e){var i;return!!((i=t.typeKeywords)!=null&&i.includes(e))}function Qdi(t){return kx(t,zS.HOSTED_SERVICE)}function Kl(t,e){const i=t.typeKeywords;if(i){const r=i.indexOf(e);r>-1&&i.splice(r,1)}}function Rbe(t,e,i){i?gw(t,e):Kl(t,e)}async function epi(t){const e=t.clone().normalize();let i;if(e.length>1)for(const r of e)i?r.width>i.width&&(i=r):i=r;else i=e[0];return rDt(i)}const zS={DEVELOPER_BASEMAP:"DeveloperBasemap",GROUP_LAYER_MAP:"Map",HOSTED_SERVICE:"Hosted Service",JSAPI:"ArcGIS API for JavaScript",LOCAL_SCENE:"ViewingMode-Local",METADATA:"Metadata",MULTI_LAYER:"Multilayer",ORIENTED_IMAGERY_LAYER:"OrientedImageryLayer",SINGLE_LAYER:"Singlelayer",SUBTYPE_GROUP_LAYER:"SubtypeGroupLayer",SUBTYPE_GROUP_TABLE:"SubtypeGroupTable",TABLE:"Table",TILED_IMAGERY:"Tiled Imagery"};function sDt(t){var l;const{portal:e,isOrgItem:i,itemControl:r}=t,s=(l=e.user)==null?void 0:l.privileges;let n=!s||s.includes("features:user:edit"),o=!!i&&!!(s!=null&&s.includes("features:user:fullEdit"));const a=r==="update"||r==="admin";return a?o=n=!0:o&&(n=!0),{features:{edit:n,fullEdit:o},content:{updateItem:a}}}let u_=class extends ee{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};u([p({type:String,json:{write:{isRequired:!0}}})],u_.prototype,"facilityIdField",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],u_.prototype,"layerId",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],u_.prototype,"nameField",void 0),u([p({type:String,json:{write:!0}})],u_.prototype,"siteIdField",void 0),u([p({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],u_.prototype,"sublayerId",void 0),u_=u([A("esri.layers.support.FacilityLayerInfo")],u_);const nDt=u_;let Sp=class extends ee{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.levelIdField=null,this.levelNumberField=null,this.longNameField=null,this.shortNameField=null,this.sublayerId=null,this.verticalOrderField=null}};u([p({type:String,json:{write:{isRequired:!0}}})],Sp.prototype,"facilityIdField",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],Sp.prototype,"layerId",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],Sp.prototype,"levelIdField",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],Sp.prototype,"levelNumberField",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],Sp.prototype,"longNameField",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],Sp.prototype,"shortNameField",void 0),u([p({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],Sp.prototype,"sublayerId",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],Sp.prototype,"verticalOrderField",void 0),Sp=u([A("esri.layers.support.LevelLayerInfo")],Sp);const oDt=Sp;let Z1=class extends ee{constructor(e){super(e),this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};u([p({type:String,json:{write:{isRequired:!0}}})],Z1.prototype,"layerId",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],Z1.prototype,"nameField",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],Z1.prototype,"siteIdField",void 0),u([p({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],Z1.prototype,"sublayerId",void 0),Z1=u([A("esri.layers.support.SiteLayerInfo")],Z1);const aDt=Z1;let v2=class extends ee{constructor(e){super(e),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null}};u([p({type:oDt,json:{write:{isRequired:!0}}})],v2.prototype,"levelLayer",void 0),u([p({type:nDt,json:{write:{isRequired:!0}}})],v2.prototype,"facilityLayer",void 0),u([p({type:aDt,json:{write:!0}})],v2.prototype,"siteLayer",void 0),v2=u([A("esri.support.MapFloorInfo")],v2);const H5e=v2;var xl;(function(t){t[t.SAVE=0]="SAVE",t[t.SAVE_AS=1]="SAVE_AS"})(xl||(xl={}));var AQ;let _2=AQ=class extends ee{constructor(t){super(t),this.activeRange=null,this.currentRangeExtent=null,this.fullRangeExtent=null}clone(){return new AQ(q({activeRange:this.activeRange,currentRangeExtent:this.currentRangeExtent,fullRangeExtent:this.fullRangeExtent}))}};u([p({type:String,nonNullable:!0,json:{read:{source:"activeRangeName"},write:{target:"activeRangeName",isRequired:!0}}})],_2.prototype,"activeRange",void 0),u([p({type:[Number],json:{write:!0}})],_2.prototype,"currentRangeExtent",void 0),u([p({type:[Number],json:{write:!0}})],_2.prototype,"fullRangeExtent",void 0),_2=AQ=u([A("esri.webdoc.RangeInfo")],_2);const Zae=_2;var MQ;let hm=MQ=class extends ee{constructor(t){super(t),this.enabled=!1,this.longNames=!1,this.minimized=!1,this.pinnedLevels=!1,this.site=null,this.facility=null,this.level=null}clone(){return new MQ(q({enabled:this.enabled,longNames:this.longNames,minimized:this.minimized,pinnedLevels:this.pinnedLevels,site:this.site,facility:this.facility,level:this.level}))}};u([p({type:Boolean,json:{read:{source:"enabled"},write:{target:"enabled"}}})],hm.prototype,"enabled",void 0),u([p({type:Boolean,json:{read:{source:"longNames"},write:{target:"longNames"}}})],hm.prototype,"longNames",void 0),u([p({type:Boolean,json:{read:{source:"minimized"},write:{target:"minimized"}}})],hm.prototype,"minimized",void 0),u([p({type:Boolean,json:{read:{source:"pinnedLevels"},write:{target:"pinnedLevels"}}})],hm.prototype,"pinnedLevels",void 0),u([p({type:String,json:{read:{source:"site"},write:{target:"site"}}})],hm.prototype,"site",void 0),u([p({type:String,json:{read:{source:"facility"},write:{target:"facility"}}})],hm.prototype,"facility",void 0),u([p({type:String,json:{read:{source:"level"},write:{target:"level"}}})],hm.prototype,"level",void 0),hm=MQ=u([A("esri.webdoc.widgets.FloorFilter")],hm);const lDt=hm;var OQ;const Pk=new ni({slider:"slider",picker:"picker"});let b2=OQ=class extends ee{constructor(t){super(t),this.interactionMode=null,this.numStops=null,this.stopInterval=null}clone(){return new OQ({interactionMode:this.interactionMode,numStops:this.numStops,stopInterval:this.stopInterval})}};u([p({type:Pk.apiValues,nonNullable:!0,json:{type:Pk.jsonValues,default:null,read:{reader:Pk.read},write:{isRequired:!0,writer:Pk.write}}})],b2.prototype,"interactionMode",void 0),u([p({type:Ii,json:{read:{source:"numberOfStops"},write:{target:"numberOfStops",overridePolicy(){const t=this.stopInterval!=null;return{enabled:!t,isRequired:!t}}}}})],b2.prototype,"numStops",void 0),u([p({type:Number,json:{write:{overridePolicy(){return{isRequired:this.numStops==null}}}}})],b2.prototype,"stopInterval",void 0),b2=OQ=u([A("esri.webdoc.widgets.Range")],b2);const cDt=b2,Yae=Oo()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});let gR=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return G$e(this.value,this.unit,"milliseconds")}};u([Ve(Yae,{nonNullable:!0})],gR.prototype,"unit",void 0),u([p({type:Number,json:{write:!0},nonNullable:!0})],gR.prototype,"value",void 0),gR=u([A("esri.time.TimeInterval")],gR);const US=gR;var IQ;let zo=IQ=class extends ee{constructor(t){super(t),this.currentTimeExtent=null,this.fullTimeExtent=null,this.loop=!1,this.numStops=null,this.numThumbs=null,this.stopDelay=null,this.stopInterval=null,this.stops=null}readCurrentTimeExtent(t){return t?Eo.fromArray(t):void 0}writeCurrentTimeExtent(t,e,i){t&&ro(i,t.toArray(),e)}readFullTimeExtent(t,e){const i=e.properties;if(!i)return;const r=i.endTime!=null?new Date(i.endTime):null,s=i.startTime!=null?new Date(i.startTime):null;return new Eo({start:s,end:r})}writeFullTimeExtent(t,e){if(!t)return;const i=e.properties=e.properties||{},r=t.end,s=t.start;r&&(i.endTime=r!=null?r.getTime():null),s&&(i.startTime=s!=null?s.getTime():null)}readStopInterval(t,e,i){return t?US.fromJSON({value:t.interval,unit:t.units},i):null}writeStopInterval(t,e,i,r){if(!t)return;const s=t.toJSON(r);ro("properties.timeStopInterval",{interval:s.value,units:s.unit},e)}readStops(t){return t!=null&&t.length?t.map(e=>new Date(e)):null}writeStops(t,e,i){t!=null&&t.length&&ro(i,t.map(r=>r.getTime()),e)}clone(){return new IQ(q({currentTimeExtent:this.currentTimeExtent,fullTimeExtent:this.fullTimeExtent,loop:this.loop,numStops:this.numStops,numThumbs:this.numThumbs,stopDelay:this.stopDelay,stopInterval:this.stopInterval,stops:this.stops}))}};u([p({type:Eo,json:{type:[[Ii,HA]],read:{source:"properties.currentTimeExtent"},write:{target:"properties.currentTimeExtent"}}})],zo.prototype,"currentTimeExtent",void 0),u([ve("currentTimeExtent")],zo.prototype,"readCurrentTimeExtent",null),u([_e("currentTimeExtent")],zo.prototype,"writeCurrentTimeExtent",null),u([p({type:Eo,json:{read:{source:["properties.endTime","properties.startTime"]},write:{target:{"properties.endTime":{type:Number},"properties.startTime":{type:Number}}}}})],zo.prototype,"fullTimeExtent",void 0),u([ve("fullTimeExtent")],zo.prototype,"readFullTimeExtent",null),u([_e("fullTimeExtent")],zo.prototype,"writeFullTimeExtent",null),u([p({type:Boolean,nonNullable:!0,json:{default:!1,read:{source:"properties.loop"},write:{target:"properties.loop"}}})],zo.prototype,"loop",void 0),u([p({type:Ii,json:{read:{source:"properties.numberOfStops"},write:{target:"properties.numberOfStops",overridePolicy(){var r;const t=!!this.stopInterval,e=!!((r=this.stops)!=null&&r.length),i=!(t||e);return{enabled:i,isRequired:i}}}}})],zo.prototype,"numStops",void 0),u([p({type:[1,2],nonNullable:!0,json:{type:Ii,read:{source:"properties.thumbCount"},write:{target:"properties.thumbCount",isRequired:!0}}})],zo.prototype,"numThumbs",void 0),u([p({type:Number,nonNullable:!0,json:{read:{source:"properties.thumbMovingRate"},write:{target:"properties.thumbMovingRate",isRequired:!0}}})],zo.prototype,"stopDelay",void 0),u([p({type:US,json:{read:{source:"properties.timeStopInterval"},write:{target:{"properties.timeStopInterval.interval":{type:Number},"properties.timeStopInterval.units":{type:Yae.jsonValues.filter(t=>t!=="esriTimeUnitsUnknown")}},overridePolicy(){var i;const t=this.numStops!=null,e=!!((i=this.stops)!=null&&i.length);return{enabled:!e,isRequired:!(t||e)}}}}})],zo.prototype,"stopInterval",void 0),u([ve("stopInterval")],zo.prototype,"readStopInterval",null),u([_e("stopInterval")],zo.prototype,"writeStopInterval",null),u([p({type:[Date],json:{type:[Ii],read:{source:"properties.stops"},write:{target:"properties.stops",overridePolicy(){return{isRequired:this.numStops==null&&!this.stopInterval}}}}})],zo.prototype,"stops",void 0),u([ve("stops")],zo.prototype,"readStops",null),u([_e("stops")],zo.prototype,"writeStops",null),zo=IQ=u([A("esri.webdoc.widgets.TimeSlider")],zo);const uDt=zo;var RQ;let w2=RQ=class extends ee{constructor(t){super(t),this.range=null,this.timeSlider=null,this.floorFilter=null}clone(){return new RQ(q({range:this.range,timeSlider:this.timeSlider,floorFilter:this.floorFilter}))}};u([p({type:cDt,json:{write:!0}})],w2.prototype,"range",void 0),u([p({type:uDt,json:{write:!0}})],w2.prototype,"timeSlider",void 0),u([p({type:lDt,json:{write:!0}})],w2.prototype,"floorFilter",void 0),w2=RQ=u([A("esri.webdoc.Widgets")],w2);const q5e=w2,hDt={width:600,height:400},Dk=1.5;function W5e(t,e){e=e||hDt;let{width:i,height:r}=e;const s=i/r;return s<Dk?r=i/Dk:s>Dk&&(i=r*Dk),i>t.width&&(r*=t.width/i,i=t.width),r>t.height&&(i*=t.height/r,r=t.height),{width:Math.round(i),height:Math.round(r)}}function dDt(t,e){return{...Z5e(t,e),readResourcePaths:[]}}function PQ(t,e,i){const r=yn(t.itemUrl);return{...Z5e(t,e),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:r?{rootPath:r.path,writtenUrls:[]}:null,resources:i?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function Z5e(t,e){return{origin:e,url:yn(t.itemUrl),portal:t.portal||vn.getDefault(),portalItem:t}}let Y1=class extends ee{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(s=>s.toJSON()),i=this.geometries[0],r={};return r.outSR=MU(this.outSpatialReference),r.inSR=MU(i.spatialReference),r.geometries=JSON.stringify({geometryType:HD(i),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(r.transformForward=this.transformForward),r}};u([p()],Y1.prototype,"geometries",void 0),u([p({type:Oe,json:{read:{source:"outSR"}}})],Y1.prototype,"outSpatialReference",void 0),u([p()],Y1.prototype,"transformation",void 0),u([p()],Y1.prototype,"transformForward",void 0),Y1=u([A("esri.rest.support.ProjectParameters")],Y1);const Jae=Y1,pDt=Ds(Jae);async function Y5e(t,e,i){e=pDt(e);const r=BMe(t),s={...r.query,f:"json",...e.toJSON()},n=e.outSpatialReference,o=HD(e.geometries[0]),a=dtt(s,i);return Ri(r.path+"/project",a).then(({data:{geometries:l}})=>VMe(l,o,n))}function fDt(t,e){var i;return e.resourceInfo?J5e(e,e.resourceInfo,{origin:t.origin}):(i=e.portalItem)!=null&&i.id?mDt(t,e,e.portalItem):Promise.resolve()}function J5e(t,e,i){const r={context:{...i,layerContainerType:"operational-layers"}};return t.portalItem&&(r.context.portal=t.portalItem.portal||vn.getDefault()),G(()=>import("./layersCreator-B9RBAQ3N.js"),__vite__mapDeps([118,119,120,121,122,123])).then(({populateOperationalLayers:s})=>{const n=[],o=e.operationalLayers;o!=null&&o.length&&n.push(s(t.layers,o,r));const a={...r,context:{...r.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"},l=e.tables;return l!=null&&l.length&&n.push(s(t.tables,l,a)),Promise.allSettled(n).then(()=>{})})}async function mDt(t,e,i){var o;if(await i.load().catch(a=>{throw new U(`${t.name}:load-portal-item`,"Failed to load portal item",{error:a})}),i.type!==t.itemType)throw new U(`${t.name}:invalid-portal-item`,`Invalid portal item type '${i.type}', expected '${t.itemType}'`,{type:i.type});const r=await i.fetchData();e.resourceInfo=r;const s=dDt(i,t.origin);await gDt(t,e,r,s),e.resourceReferences={portalItem:i,paths:s.readResourcePaths};const n=await vDt(e.initialViewProperties,i,J.getLogger(e));if(n){const a=((o=e.initialViewProperties)==null?void 0:o.clone())??t.createInitialViewProperties();a.viewpoint=n,e.initialViewProperties=a}}function gDt(t,e,i,r){const s=yDt(t,i);return e.read(s,r),J5e(e,s,r)}function yDt(t,e){const i=t.parseVersion(e.version||"",t.name);return t.currentVersion.validate(i),e.version=`${i.major}.${i.minor}`,e}async function vDt(t,e,i){var n;if((n=t==null?void 0:t.viewpoint)==null?void 0:n.targetGeometry)return null;const s=await _Dt(t,e,i);return s?new Qr({targetGeometry:s}):null}async function _Dt(t,e,i){const r=t==null?void 0:t.spatialReference,s=e==null?void 0:e.extent;if(!r||!s)return null;if(r.isWGS84)return s.clone();if(r.isWebMercator)return iv(s);const{getGeometryServiceURL:n}=await G(()=>import("./geometryServiceUtils-D_K144mp.js"),[]);try{const o=await n(e),a=new Jae({geometries:[s],outSpatialReference:r});return(await Y5e(o,a))[0]}catch(o){i.error("Error projecting item's extent:",o)}return null}function Pbe(t){return{enabled:!!(t!=null&&t.length)}}var DQ;let x2=DQ=class extends ee{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new DQ({exactMatch:this.exactMatch,type:this.type,name:this.name})}};u([p({type:Boolean,json:{write:!0}})],x2.prototype,"exactMatch",void 0),u([p({type:String,json:{write:!0}})],x2.prototype,"name",void 0),u([Ve(Hre)],x2.prototype,"type",void 0),x2=DQ=u([A("esri.webdoc.applicationProperties.SearchLayerField")],x2);const bDt=x2;var LQ;let S2=LQ=class extends ee{constructor(t){super(t),this.field=null,this.id=null,this.subLayer=null}clone(){return new LQ(q({field:this.field,id:this.id,subLayer:this.subLayer}))}};u([p({type:bDt,json:{write:{isRequired:!0}}})],S2.prototype,"field",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],S2.prototype,"id",void 0),u([p({type:Ii,json:{write:!0}})],S2.prototype,"subLayer",void 0),S2=LQ=u([A("esri.webdoc.applicationProperties.SearchLayer")],S2);const wDt=S2;var NQ;let T2=NQ=class extends ee{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new NQ({exactMatch:this.exactMatch,type:this.type,name:this.name})}};u([p({type:Boolean,json:{write:!0}})],T2.prototype,"exactMatch",void 0),u([p({type:String,json:{write:!0}})],T2.prototype,"name",void 0),u([Ve(Hre)],T2.prototype,"type",void 0),T2=NQ=u([A("esri.webdoc.applicationProperties.SearchTableField")],T2);const xDt=T2;var FQ;let yR=FQ=class extends ee{constructor(t){super(t),this.field=null,this.id=null}clone(){return new FQ(q({field:this.field,id:this.id}))}};u([p({type:xDt,json:{write:{isRequired:!0}}})],yR.prototype,"field",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],yR.prototype,"id",void 0),yR=FQ=u([A("esri.webdoc.applicationProperties.SearchTable")],yR);const SDt=yR;var kQ;const X5e=Ce.ofType(wDt),K5e=Ce.ofType(SDt);let dm=kQ=class extends ee{constructor(t){super(t),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new X5e,this.tables=new K5e}readAddressSearchEnabled(t){return!t}writeAddressSearchEnabled(t,e,i){e[i]=!t}clone(){return new kQ(q({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};u([p({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],dm.prototype,"addressSearchEnabled",void 0),u([ve("addressSearchEnabled")],dm.prototype,"readAddressSearchEnabled",null),u([_e("addressSearchEnabled")],dm.prototype,"writeAddressSearchEnabled",null),u([p({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],dm.prototype,"enabled",void 0),u([p({type:String,json:{write:!0}})],dm.prototype,"hintText",void 0),u([p({type:X5e,json:{write:{overridePolicy:Pbe},origins:{"web-scene":{write:{isRequired:!0}}}}})],dm.prototype,"layers",void 0),u([p({type:K5e,json:{read:!0,write:{overridePolicy:Pbe}}})],dm.prototype,"tables",void 0),dm=kQ=u([A("esri.webdoc.applicationProperties.Search")],dm);const TDt=dm;var zQ;let wz=zQ=class extends ee{constructor(t){super(t),this.search=null}clone(){return new zQ(q({search:this.search}))}};u([p({type:TDt,json:{write:!0}})],wz.prototype,"search",void 0),wz=zQ=u([A("esri.webdoc.applicationProperties.Viewing")],wz);const Q5e=wz;var UQ;let E2=UQ=class extends ee{constructor(t){super(t),this.editing=null,this.offline=null,this.viewing=null}clone(){return new UQ(q({editing:this.editing,offline:this.offline,viewing:this.viewing}))}};u([p({json:{write:!0}})],E2.prototype,"editing",void 0),u([p({json:{write:!0}})],E2.prototype,"offline",void 0),u([p({type:Q5e,json:{write:!0}})],E2.prototype,"viewing",void 0),E2=UQ=u([A("esri.webmap.ApplicationProperties")],E2);const EDt=E2;var BQ;let lc=BQ=class extends ee{constructor(){super(...arguments),this.url=""}destroy(){this.url=""}get isSecureUrl(){return CTe(this.url)}get isDataURI(){return $f(this.url)}clone(){return new BQ({url:this.url})}};u([p({type:String,json:{write:{isRequired:!0}}})],lc.prototype,"url",void 0),u([p()],lc.prototype,"isSecureUrl",null),u([p()],lc.prototype,"isDataURI",null),lc=BQ=u([A("esri.webdoc.support.SlideThumbnail")],lc);const Xae={type:Eo,json:{read:{source:"timeExtent",reader:t=>t?Array.isArray(t)?Eo.fromArray(t):Eo.fromJSON(t):null},write:{writer:(t,e,i,r)=>{t&&(t.isEmpty?r!=null&&r.messages&&r.messages.push(new U("invalid-timeExtent","TimeExtent cannot be empty")):e[i]=t.toArray())},target:{timeExtent:{type:[[Ii,HA]]}}}}};var VQ;let pm=VQ=class extends XS.IdentifiableMixin(ee){constructor(t){super(t),this.name=null,this.thumbnail=new lc,this.timeExtent=null}castThumbnail(t){return typeof t=="string"?new lc({url:t}):Ds(lc,t)}set viewpoint(t){const{targetGeometry:e,scale:i}=t;e!=null&&e.type==="point"&&i==null&&J.getLogger(this).warn("Bookmark.viewpoint should include 'scale' when its targetGeometry is a point.",t),this._set("viewpoint",t)}readViewpoint(t,e){const{extent:i,viewpoint:r}=e;return Qr.fromJSON(r||{targetGeometry:i})}writeViewpoint(t,e,i,r){if(!t)return;const{targetGeometry:s}=t;if(s==null||s.type==="extent")s!=null&&(e.extent=s.toJSON()),e[i]=t.toJSON();else{const n="Bookmark.viewpoint cannot be written to JSON when the viewpoint's targetGeometry is not an extent.";r!=null&&r.messages?r.messages.push(new U("property:unsupported",n)):J.getLogger(this).error(n)}}clone(){return new VQ(q({name:this.name,thumbnail:this.thumbnail,timeExtent:this.timeExtent,viewpoint:this.viewpoint}))}};u([p({type:String,nonNullable:!0,json:{write:{isRequired:!0}}})],pm.prototype,"name",void 0),u([p({type:lc,json:{write:{overridePolicy:t=>({enabled:!(!t||!t.url)})}}})],pm.prototype,"thumbnail",void 0),u([ti("thumbnail")],pm.prototype,"castThumbnail",null),u([p(Xae)],pm.prototype,"timeExtent",void 0),u([p({type:Qr,nonNullable:!0,json:{write:!0}})],pm.prototype,"viewpoint",null),u([ve("viewpoint",["extent","viewpoint"])],pm.prototype,"readViewpoint",null),u([_e("viewpoint")],pm.prototype,"writeViewpoint",null),pm=VQ=u([A("esri.webmap.Bookmark")],pm);const CDt=pm;let vy=class extends Nt.ClonableMixin(he){constructor(e){super(e),this.background=null,this.rangeInfo=null,this.spatialReference=null,this.timeExtent=null,this.timeZone=mf,this.viewpoint=null}};u([p({type:zG})],vy.prototype,"background",void 0),u([p({type:Zae})],vy.prototype,"rangeInfo",void 0),u([p({type:Oe})],vy.prototype,"spatialReference",void 0),u([p({type:Eo})],vy.prototype,"timeExtent",void 0),u([p({nonNullable:!0})],vy.prototype,"timeZone",void 0),u([p({type:Qr})],vy.prototype,"viewpoint",void 0),vy=u([A("esri.webmap.InitialViewProperties")],vy);const vV=vy,eze=Ce.ofType(CDt),$Dt=new Map([["image/jpeg","jpeg"],["image/jpg","jpg"],["image/png","png"],["image/gif","gif"]]),ADt="ArcGIS Pro",MDt=zS.JSAPI;let $s=class extends jL(Il.LoadableMixin(iw.EsriPromiseMixin(Ere))){constructor(e){super(e),this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1,this._thumbnailFilename=null,this._updateFromPromise=null,this.resourceReferences={portalItem:null,paths:[]},this.applicationProperties=null,this.bookmarks=new eze,this.floorInfo=null,this.initialViewProperties=new vV,this.portalItem=null,this.sourceVersion=null,this.widgets=null,this._debouncedSaveOperations=UD(async(i,r,s)=>{const{save:n,saveAs:o}=await G(()=>Promise.resolve().then(()=>X5t),void 0);switch(i){case xl.SAVE:return n(this.context,this,r);case xl.SAVE_AS:return o(this.context,this,s,r)}}),this.authoringApp=this.authoringAppVersion=null,this._isAuthoringAppSetByUser=this._isAuthoringAppVersionSetByUser=!1}destroy(){this.portalItem=$e(this.portalItem)}initialize(){if(this.when().catch(e=>{J.getLogger(this).error("#load()","Failed to load web map",e)}),this.resourceInfo){let e;try{e=this._validateJSON(this.resourceInfo)}catch(i){return void this.addResolvingPromise(Promise.reject(i))}this.read(e)}}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,i){e&&this._isAuthoringAppSetByUser?i.authoringApp=e:i.authoringApp=MDt}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,i){e&&this._isAuthoringAppVersionSetByUser?i.authoringAppVersion=e:i.authoringAppVersion=wie}readInitialViewProperties(e,i){var o,a;const r=new vV;i.background&&(r.background=zG.fromJSON(i.background));const s=(o=i.initialState)==null?void 0:o.timeExtent;s&&(r.timeExtent=Eo.fromArray(s));const n=(a=i.initialState)==null?void 0:a.viewpoint;return n&&(n.rotation&&WC.parse(i.version||"","webmap").lessThan(2,20)&&i.authoringApp===ADt&&(n.rotation*=-1),r.viewpoint=Qr.fromJSON(n)),i.mapRangeInfo&&(r.rangeInfo=Zae.fromJSON(i.mapRangeInfo)),i.spatialReference&&(r.spatialReference=Oe.fromJSON(i.spatialReference)),i.timeZone&&(r.timeZone=i.timeZone),r}writeInitialViewProperties(e,i,r,s){var a;if(!e)return;(a=e.background)!=null&&a.color&&(i.background=e.background.write({},s));const{timeExtent:n,viewpoint:o}=e;if(o||n){const l={};o&&(l.viewpoint=o.write({},s)),n&&(l.timeExtent=n.toArray()),i.initialState=l}e.rangeInfo&&(i.mapRangeInfo=e.rangeInfo.toJSON(s)),e.spatialReference&&(i.spatialReference=e.spatialReference.write({},s)),i.timeZone=e.timeZone}writeLayers(e,i,r,s){i[r]=this._writeLayers(e,s,"operational-layers")}readSourceVersion(e,i){const[r,s]=i.version.split(".");return new WC(parseInt(r,10),parseInt(s,10))}writeSourceVersion(e,i,r){i[r]=`${this.context.currentVersion.major}.${this.context.currentVersion.minor}`}writeTables(e,i,r,s){const n=this._writeLayers(e,s,"tables");n.length&&(i[r]=n)}get thumbnailUrl(){var e;return((e=this.portalItem)==null?void 0:e.thumbnailUrl)||null}set thumbnailUrl(e){e?(this._override("thumbnailUrl",e),this._thumbnailFilename=this._generateCustomThumbnailFilename(e)):this._clearThumbnailOverride()}get updatingFromView(){return!!this._updateFromPromise}load(e){return this.addResolvingPromise(fDt(this.context,this)),Promise.resolve(this)}loadAll(){return KD(this,e=>{e(this.ground,this.basemap,this.layers,this.tables)})}read(e,i){i={...i,origin:this.context.origin};const r=this._getAuthoringPropsState();uie(this,e,s=>super.read(e,s),i),this._restoreAuthoringPropsFromState(r)}write(e,i){if(this.loadStatus!=="loaded"){const r=new U("webmap:not-loaded","Web map must be loaded before it can be serialized");throw J.getLogger(this).error("#toJSON()","Web map must be loaded before it can be serialized",this.loadError||this.loadStatus),r}return this._removeDanglingLayerRefs(),i={...i,origin:this.context.origin,restrictedWebMapWriting:!0,webmap:this},super.write(e,i)}async save(e){return this._debouncedSaveOperations(xl.SAVE,e)}async saveAs(e,i){return this._debouncedSaveOperations(xl.SAVE_AS,i,e)}async updateFrom(e,i){const r=this._updateFromInternal(e,i);this._updateFromPromise=r,await r,r===this._updateFromPromise&&(this._updateFromPromise=null)}getLayerJSONFromResourceInfo(e){var r,s,n,o;const i=this.resourceInfo;return this._collectAllLayersJSON([...((r=i==null?void 0:i.baseMap)==null?void 0:r.baseMapLayers)||[],...(i==null?void 0:i.operationalLayers)||[],...((o=(n=(s=this.basemap)==null?void 0:s.resourceInfo)==null?void 0:n.data)==null?void 0:o.baseMapLayers)||[]]).find(a=>a.id===e.id)}async updateItemThumbnail(){var e;this.thumbnailUrl&&this._isOverridden("thumbnailUrl")&&(await((e=this.portalItem)==null?void 0:e.updateThumbnail({thumbnail:this.thumbnailUrl,filename:this._thumbnailFilename})),this._clearThumbnailOverride())}getThumbnailState(){let e=this.thumbnailUrl;return e&&(e=this._isOverridden("thumbnailUrl")?e:bie(e,"w","8192")),{thumbnailUrl:e,filename:this._thumbnailFilename}}restoreThumbnailFromState(e){this.thumbnailUrl=e.thumbnailUrl,this._thumbnailFilename=e.filename}_collectAllLayersJSON(e){return e.reduce((i,r)=>(i.push(r),r.layerType==="GroupLayer"&&(i=i.concat(this._collectAllLayersJSON(r.layers||[]))),i),[])}_writeLayers(e,i,r){return i={...i,layerContainerType:r},e.map(s=>jZ(s,r==="tables"?null:this.getLayerJSONFromResourceInfo(s),i)).filter(df).toArray()}_validateJSON(e){const i=WC.parse(e.version||"","webmap");return this.context.currentVersion.validate(i),e.version=`${i.major}.${i.minor}`,e}_removeDanglingLayerRefs(){var o,a;const e=this.applicationProperties,i=(o=e==null?void 0:e.viewing)==null?void 0:o.search,r=l=>this.allLayers.some(c=>c.id===l);if(i!=null&&i.layers&&(i.layers=i.layers.filter(l=>r(l.id))),i!=null&&i.tables&&(i.tables=i.tables.filter(l=>this.tables.some(c=>c.id===l.id))),e){const l=(a=e.editing)==null?void 0:a.locationTracking;l!=null&&l.info&&!r(l.info.layerId)&&(e.editing=null)}const s="presentation"in this?this.presentation:null,n=s==null?void 0:s.slides;n&&n.forEach(l=>{l.visibleLayers&&(l.visibleLayers=l.visibleLayers.filter(c=>r(c.id)))})}async _updateFromInternal(e,i){if(i??(i={}),await Id(()=>e.ready),this._updateInitialViewProperties(e,i),e.map===this)for(const r of e.allLayerViews)"visible"in r&&"visible"in r.layer&&r._isOverridden("visible")&&(r.layer.visible=r.visible),"featureEffect"in r&&"featureEffect"in r.layer&&r._isOverridden("featureEffect")&&(r.layer.featureEffect=r.featureEffect);await this._updateThumbnailUrl(e,i)}_updateInitialViewProperties(e,i){var r,s;if(i.backgroundExcluded||(this.initialViewProperties.background=(r=e.background)==null?void 0:r.clone()),this.initialViewProperties.spatialReference=(s=e.spatialReference)==null?void 0:s.clone(),this.initialViewProperties.timeZone=e.timeZone,i.viewpointExcluded||(this.initialViewProperties.viewpoint=new Qr({rotation:e.rotation,scale:i.scalePreserved?e.scale:null,targetGeometry:this._getViewExtent(e)})),!i.widgetsExcluded)for(const n of e.persistableViewModels)n.updateWebDocument(this)}_getViewExtent(e){const i=e.center.clone().normalize(),r=e.extent.clone(),s=r.width/2;return r.xmin=i.x-s,r.xmax=i.x+s,r}async _updateThumbnailUrl(e,i){if(i.thumbnailExcluded)return;const r=W5e(e,i.thumbnailSize),s=await e.takeScreenshot({format:"png",width:r.width,height:r.height});this._setAutoGeneratedThumbnail(s.dataUrl)}_setAutoGeneratedThumbnail(e){this.thumbnailUrl=e,this._thumbnailFilename=null}_clearThumbnailOverride(){this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"),this._thumbnailFilename=null}_generateCustomThumbnailFilename(e){if($f(e)){const i=pS(e),r=i==null?void 0:i.mediaType,s=r&&$Dt.get(r.toLowerCase())||null,n=`thumbnail${Date.now()}`;return s?`${n}.${s}`:n}return null}_getAuthoringPropsState(){return{authoringApp:this.authoringApp,authoringAppVersion:this.authoringAppVersion,isAuthoringAppSetByUser:this._isAuthoringAppSetByUser,isAuthoringAppVersionSetByUser:this._isAuthoringAppVersionSetByUser}}_restoreAuthoringPropsFromState(e){e.isAuthoringAppSetByUser?this.authoringApp=e.authoringApp:this._isAuthoringAppSetByUser=!1,e.isAuthoringAppVersionSetByUser?this.authoringAppVersion=e.authoringAppVersion:this._isAuthoringAppVersionSetByUser=!1}};u([p()],$s.prototype,"_updateFromPromise",void 0),u([p({type:EDt,json:{write:!0}})],$s.prototype,"applicationProperties",void 0),u([p({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],$s.prototype,"authoringApp",null),u([_e("authoringApp")],$s.prototype,"writeAuthoringApp",null),u([p({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],$s.prototype,"authoringAppVersion",null),u([_e("authoringAppVersion")],$s.prototype,"writeAuthoringAppVersion",null),u([p({type:eze,json:{write:{overridePolicy:t=>({enabled:!!(t&&t.length>0),ignoreOrigin:!0})}}})],$s.prototype,"bookmarks",void 0),u([p({type:H5e,json:{name:"mapFloorInfo",write:!0}})],$s.prototype,"floorInfo",void 0),u([p({type:vV,nonNullable:!0,json:{read:{source:["background","initialState.timeExtent","initialState.viewpoint","mapRangeInfo","spatialReference","timeZone"]},write:{ignoreOrigin:!0,target:{background:{type:zG},"initialState.timeExtent":{type:Eo},"initialState.viewpoint":{type:Qr},mapRangeInfo:{type:Zae},spatialReference:{type:Oe},"timeZone:":{type:String}}}}})],$s.prototype,"initialViewProperties",void 0),u([ve("initialViewProperties")],$s.prototype,"readInitialViewProperties",null),u([_e("initialViewProperties")],$s.prototype,"writeInitialViewProperties",null),u([p({json:{read:!1,write:{target:"operationalLayers",ignoreOrigin:!0}}})],$s.prototype,"layers",void 0),u([_e("layers")],$s.prototype,"writeLayers",null),u([p({type:nh})],$s.prototype,"portalItem",void 0),u([p()],$s.prototype,"resourceInfo",void 0),u([p({readOnly:!0,type:WC,json:{read:{source:"version"},write:{allowNull:!0,ignoreOrigin:!0,target:"version",isRequired:!0}}})],$s.prototype,"sourceVersion",void 0),u([ve("sourceVersion")],$s.prototype,"readSourceVersion",null),u([_e("sourceVersion")],$s.prototype,"writeSourceVersion",null),u([p({json:{read:!1,write:{ignoreOrigin:!0}}})],$s.prototype,"tables",void 0),u([_e("tables")],$s.prototype,"writeTables",null),u([p()],$s.prototype,"thumbnailUrl",null),u([p()],$s.prototype,"updatingFromView",null),u([p({type:q5e,json:{write:!0}})],$s.prototype,"widgets",void 0),$s=u([A("esri.WebDocument2D")],$s);const ODt=$s,Xs=(t=>t)(["operational-layers","basemap","ground"]);var jQ;let J1=jQ=class extends ee{constructor(t){super(t),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new jQ({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([p({type:String,json:{write:!0}})],J1.prototype,"expression",void 0),u([p({type:String,json:{write:!0}})],J1.prototype,"name",void 0),u([p({type:["boolean","date","number","string"],json:{write:!0}})],J1.prototype,"returnType",void 0),u([p({type:String,json:{write:!0}})],J1.prototype,"title",void 0),J1=jQ=u([A("esri.form.ExpressionInfo")],J1);const IDt=J1;let X1=class extends ee{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};u([p({type:String,json:{write:!0}})],X1.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],X1.prototype,"label",void 0),u([p()],X1.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],X1.prototype,"visibilityExpression",void 0),X1=u([A("esri.form.elements.Element")],X1);const Jb=X1;let xz=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.type=null}};u([p()],xz.prototype,"type",void 0),xz=u([A("esri.form.elements.inputs.attachments.Input")],xz);const Xb=xz,Q6=["any","capture","upload"];let C2=class extends Xb{constructor(e){super(e),this.type="audio",this.inputMethod="any",this.maxDuration=null}};u([p({type:["audio"],readOnly:!0,json:{write:!0}})],C2.prototype,"type",void 0),u([p({type:Q6,json:{write:!0}})],C2.prototype,"inputMethod",void 0),u([p({type:Number,json:{write:!0}})],C2.prototype,"maxDuration",void 0),C2=u([A("esri.form.elements.inputs.attachments.AudioInput")],C2);const Dbe=C2;let vR=class extends Xb{constructor(e){super(e),this.type="document",this.maxFileSize=null}};u([p({type:["document"],readOnly:!0,json:{write:!0}})],vR.prototype,"type",void 0),u([p({type:Number,json:{write:!0}})],vR.prototype,"maxFileSize",void 0),vR=u([A("esri.form.elements.inputs.attachments.DocumentInput")],vR);const Lbe=vR;let $2=class extends Xb{constructor(e){super(e),this.type="image",this.inputMethod="any",this.maxImageSize=null}};u([p({type:["image"],readOnly:!0,json:{write:!0}})],$2.prototype,"type",void 0),u([p({type:Q6,json:{write:!0}})],$2.prototype,"inputMethod",void 0),u([p({type:Number,json:{write:!0}})],$2.prototype,"maxImageSize",void 0),$2=u([A("esri.form.elements.inputs.attachments.ImageInput")],$2);const Nbe=$2;let _R=class extends Xb{constructor(e){super(e),this.type="signature",this.inputMethod="any"}};u([p({type:["signature"],readOnly:!0,json:{write:!0}})],_R.prototype,"type",void 0),u([p({type:Q6,json:{write:!0}})],_R.prototype,"inputMethod",void 0),_R=u([A("esri.form.elements.inputs.attachments.SignatureInput")],_R);const Fbe=_R;let A2=class extends Xb{constructor(e){super(e),this.type="video",this.inputMethod="any",this.maxDuration=null}};u([p({type:["video"],readOnly:!0,json:{write:!0}})],A2.prototype,"type",void 0),u([p({type:Q6,json:{write:!0}})],A2.prototype,"inputMethod",void 0),u([p({type:Number,json:{write:!0}})],A2.prototype,"maxDuration",void 0),A2=u([A("esri.form.elements.inputs.attachments.VideoInput")],A2);const kbe=A2;function tze(t){return{nestableTypes:{base:Xb,key:"type",typeMap:{audio:Dbe,document:Lbe,image:Nbe,signature:Fbe,video:kbe}},allTypes:{base:Xb,key:"type",typeMap:{attachment:t,audio:Dbe,document:Lbe,image:Nbe,signature:Fbe,video:kbe}}}}function RDt(t,e,i){return t?t.map(r=>Ad(e.nestableTypes,r)):null}function PDt(t,e,i){if(!t)return null;const r=e.nestableTypes.typeMap;return t.filter(s=>r[s.type]).map(s=>r[s.type].fromJSON(s))}function DDt(t,e,i){if(!t)return null;const r=e.nestableTypes.typeMap;return t.filter(s=>r[s.type]).map(s=>s.toJSON())}let bm=class extends Xb{constructor(e){super(e),this.type="attachment",this.attachmentAssociationType="exact",this.inputTypes=null}castInputs(e){return RDt(e,T7)}readInputs(e,i){return PDt(i.inputTypes,T7)}writeInputs(e,i){i.inputTypes=DDt(e,T7)}};u([p({type:["attachment"],readOnly:!0,json:{write:!0}})],bm.prototype,"type",void 0),u([p({type:["any","exact","exactOrNone"],json:{write:!0}})],bm.prototype,"attachmentAssociationType",void 0),u([p({json:{write:{isRequired:!0}}})],bm.prototype,"inputTypes",void 0),u([ti("inputTypes")],bm.prototype,"castInputs",null),u([ve("inputTypes")],bm.prototype,"readInputs",null),u([_e("inputTypes")],bm.prototype,"writeInputs",null),bm=u([A("esri.form.elements.inputs.attachments.AttachmentInput")],bm);const T7=tze(bm),LDt=bm;var GQ;const NDt=tze(LDt);let Du=GQ=class extends Jb{constructor(t){super(t),this.allowUserRename=!0,this.attachmentKeyword=null,this.displayFilename=!1,this.editableExpression=null,this.filenameExpression="{attachmentKeyword}_{now}",this.input=null,this.maxAttachmentCount=null,this.minAttachmentCount=null,this.type="attachment",this.useOriginalFilename=!0}clone(){var t;return new GQ({allowUserRename:this.allowUserRename,attachmentKeyword:this.attachmentKeyword,description:this.description,displayFilename:this.displayFilename,editableExpression:this.editableExpression,filenameExpression:this.filenameExpression,input:(t=this.input)==null?void 0:t.clone(),label:this.label,maxAttachmentCount:this.maxAttachmentCount,minAttachmentCount:this.minAttachmentCount,useOriginalFilename:this.useOriginalFilename,visibilityExpression:this.visibilityExpression})}};u([p({type:Boolean,json:{write:!0}})],Du.prototype,"allowUserRename",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],Du.prototype,"attachmentKeyword",void 0),u([p({type:Boolean,json:{write:!0}})],Du.prototype,"displayFilename",void 0),u([p({type:String,json:{write:!0}})],Du.prototype,"editableExpression",void 0),u([p({type:String,json:{write:!0}})],Du.prototype,"filenameExpression",void 0),u([p({types:NDt.allTypes,json:{read:{source:"inputType"},write:{target:"inputType",isRequired:!0}}})],Du.prototype,"input",void 0),u([p({type:Number,json:{write:!0}})],Du.prototype,"maxAttachmentCount",void 0),u([p({type:Number,json:{write:!0}})],Du.prototype,"minAttachmentCount",void 0),u([p({type:["attachment"],readOnly:!0,json:{read:!1,write:!0}})],Du.prototype,"type",void 0),u([p({type:Boolean,json:{write:!0}})],Du.prototype,"useOriginalFilename",void 0),Du=GQ=u([A("esri.form.elements.AttachmentElement")],Du);const zbe=Du;let Sz=class extends ee{constructor(e){super(e),this.type=null}};u([p()],Sz.prototype,"type",void 0),Sz=u([A("esri.form.elements.inputs.Input")],Sz);const Xv=Sz;let bR=class extends Xv{constructor(e){super(e),this.maxLength=null,this.minLength=0}};u([p({type:Number,json:{write:!0}})],bR.prototype,"maxLength",void 0),u([p({type:Number,json:{write:!0}})],bR.prototype,"minLength",void 0),bR=u([A("esri.form.elements.inputs.TextInput")],bR);const Kae=bR;var HQ;let Tz=HQ=class extends Kae{constructor(t){super(t),this.type="barcode-scanner"}clone(){return new HQ({maxLength:this.maxLength,minLength:this.minLength})}};u([p({type:["barcode-scanner"],json:{read:!1,write:!0}})],Tz.prototype,"type",void 0),Tz=HQ=u([A("esri.form.elements.inputs.BarcodeScannerInput")],Tz);const FDt=Tz;var qQ;let M2=qQ=class extends Xv{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="combo-box"}clone(){return new qQ({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};u([p({type:String,json:{write:!0}})],M2.prototype,"noValueOptionLabel",void 0),u([p({type:Boolean,json:{write:!0}})],M2.prototype,"showNoValueOption",void 0),u([p({type:["combo-box"],json:{read:!1,write:!0}})],M2.prototype,"type",void 0),M2=qQ=u([A("esri.form.elements.inputs.ComboBoxInput")],M2);const kDt=M2;var WQ;function Ube(t){return t??null}function Bbe(t){return t??null}let fm=WQ=class extends Xv{constructor(t){super(t),this.max=null,this.min=null,this.type="date-picker"}readMax(t,e){return Ube(e.max)}writeMax(t,e){e.max=Bbe(t)}readMin(t,e){return Ube(e.min)}writeMin(t,e){e.min=Bbe(t)}clone(){return new WQ({max:this.max,min:this.min})}};u([p({type:String,json:{type:String,write:!0}})],fm.prototype,"max",void 0),u([ve("max")],fm.prototype,"readMax",null),u([_e("max")],fm.prototype,"writeMax",null),u([p({type:String,json:{type:String,write:!0}})],fm.prototype,"min",void 0),u([ve("min")],fm.prototype,"readMin",null),u([_e("min")],fm.prototype,"writeMin",null),u([p({type:["date-picker"],json:{read:!1,write:!0}})],fm.prototype,"type",void 0),fm=WQ=u([A("esri.form.elements.inputs.DatePickerInput")],fm);const zDt=fm;var ZQ;function E7(t){return t??null}function C7(t){return t??null}let Mc=ZQ=class extends Xv{constructor(t){super(t),this.includeTimeOffset=!0,this.max=null,this.min=null,this.timeResolution="minutes",this.type="datetimeoffset-picker"}readMax(t,e){return E7(e.max)}writeMax(t,e){e.max=C7(t)}readMin(t,e){return E7(e.min)}writeMin(t,e){e.min=C7(t)}readTimeResolution(t,e){return E7(e.timeResolution)}writeTimeResolution(t,e){e.timeResolution=C7(t)}clone(){return new ZQ({includeTimeOffset:this.includeTimeOffset,max:this.max,min:this.min,timeResolution:this.timeResolution})}};u([p({type:Boolean,json:{write:!0}})],Mc.prototype,"includeTimeOffset",void 0),u([p({type:String,json:{type:String,write:!0}})],Mc.prototype,"max",void 0),u([ve("max")],Mc.prototype,"readMax",null),u([_e("max")],Mc.prototype,"writeMax",null),u([p({type:String,json:{type:String,write:!0}})],Mc.prototype,"min",void 0),u([ve("min")],Mc.prototype,"readMin",null),u([_e("min")],Mc.prototype,"writeMin",null),u([p({type:String,json:{type:String,write:!0}})],Mc.prototype,"timeResolution",void 0),u([ve("timeResolution")],Mc.prototype,"readTimeResolution",null),u([_e("timeResolution")],Mc.prototype,"writeTimeResolution",null),u([p({type:["datetimeoffset-picker"],json:{read:!1,write:!0}})],Mc.prototype,"type",void 0),Mc=ZQ=u([A("esri.form.elements.inputs.DateTimeOffsetPickerInput")],Mc);const UDt=Mc;var YQ;function Vbe(t){return t!=null?new Date(t):null}function jbe(t){return t?t.getTime():null}let Tp=YQ=class extends Xv{constructor(t){super(t),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(t,e){return Vbe(e.max)}writeMax(t,e){e.max=jbe(t)}readMin(t,e){return Vbe(e.min)}writeMin(t,e){e.min=jbe(t)}clone(){return new YQ({includeTime:this.includeTime,max:this.max,min:this.min})}};u([p({type:Boolean,json:{write:!0}})],Tp.prototype,"includeTime",void 0),u([p({type:Date,json:{type:Number,write:!0}})],Tp.prototype,"max",void 0),u([ve("max")],Tp.prototype,"readMax",null),u([_e("max")],Tp.prototype,"writeMax",null),u([p({type:Date,json:{type:Number,write:!0}})],Tp.prototype,"min",void 0),u([ve("min")],Tp.prototype,"readMin",null),u([_e("min")],Tp.prototype,"writeMin",null),u([p({type:["datetime-picker"],json:{read:!1,write:!0}})],Tp.prototype,"type",void 0),Tp=YQ=u([A("esri.form.elements.inputs.DateTimePickerInput")],Tp);const BDt=Tp;var JQ;let O2=JQ=class extends Xv{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="radio-buttons"}clone(){return new JQ({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};u([p({type:String,json:{write:!0}})],O2.prototype,"noValueOptionLabel",void 0),u([p({type:Boolean,json:{write:!0}})],O2.prototype,"showNoValueOption",void 0),u([p({type:["radio-buttons"],json:{read:!1,write:!0}})],O2.prototype,"type",void 0),O2=JQ=u([A("esri.form.elements.inputs.RadioButtonsInput")],O2);const VDt=O2;var XQ;let I2=XQ=class extends Xv{constructor(t){super(t),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new XQ({offValue:this.offValue,onValue:this.onValue})}};u([p({type:[String,Number],json:{write:!0}})],I2.prototype,"offValue",void 0),u([p({type:[String,Number],json:{write:!0}})],I2.prototype,"onValue",void 0),u([p({type:["switch"],json:{read:!1,write:!0}})],I2.prototype,"type",void 0),I2=XQ=u([A("esri.form.elements.inputs.SwitchInput")],I2);const jDt=I2;var KQ;let Ez=KQ=class extends Kae{constructor(t){super(t),this.type="text-area"}clone(){return new KQ({maxLength:this.maxLength,minLength:this.minLength})}};u([p({type:["text-area"],json:{read:!1,write:!0}})],Ez.prototype,"type",void 0),Ez=KQ=u([A("esri.form.elements.inputs.TextAreaInput")],Ez);const GDt=Ez;var QQ;let Cz=QQ=class extends Kae{constructor(t){super(t),this.type="text-box"}clone(){return new QQ({maxLength:this.maxLength,minLength:this.minLength})}};u([p({type:["text-box"],json:{read:!1,write:!0}})],Cz.prototype,"type",void 0),Cz=QQ=u([A("esri.form.elements.inputs.TextBoxInput")],Cz);const HDt=Cz;var eee;function $7(t){return t??null}function A7(t){return t??null}let Lu=eee=class extends Xv{constructor(t){super(t),this.max=null,this.min=null,this.timeResolution="minutes",this.type="time-picker"}readMax(t,e){return $7(e.max)}writeMax(t,e){e.max=A7(t)}readMin(t,e){return $7(e.min)}writeMin(t,e){e.min=A7(t)}readTimeResolution(t,e){return $7(e.timeResolution)}writeTimeResolution(t,e){e.timeResolution=A7(t)}clone(){return new eee({max:this.max,min:this.min,timeResolution:this.timeResolution})}};u([p({type:String,json:{type:String,write:!0}})],Lu.prototype,"max",void 0),u([ve("max")],Lu.prototype,"readMax",null),u([_e("max")],Lu.prototype,"writeMax",null),u([p({type:String,json:{type:String,write:!0}})],Lu.prototype,"min",void 0),u([ve("min")],Lu.prototype,"readMin",null),u([_e("min")],Lu.prototype,"writeMin",null),u([p({type:String,json:{type:String,write:!0}})],Lu.prototype,"timeResolution",void 0),u([ve("timeResolution")],Lu.prototype,"readTimeResolution",null),u([_e("timeResolution")],Lu.prototype,"writeTimeResolution",null),u([p({type:["time-picker"],json:{read:!1,write:!0}})],Lu.prototype,"type",void 0),Lu=eee=u([A("esri.form.elements.inputs.TimePickerInput")],Lu);const qDt=Lu,WDt={base:Xv,key:"type",typeMap:{"barcode-scanner":FDt,"combo-box":kDt,"date-picker":zDt,"datetime-picker":BDt,"datetimeoffset-picker":UDt,"radio-buttons":VDt,switch:jDt,"text-area":GDt,"text-box":HDt,"time-picker":qDt}};var tee;let Fh=tee=class extends Jb{constructor(t){super(t),this.domain=null,this.editable=null,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}clone(){return new tee({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};u([p({types:aMe,json:{read:{reader:EG},write:!0}})],Fh.prototype,"domain",void 0),u([p({type:Boolean,json:{write:!0}})],Fh.prototype,"editable",void 0),u([p({type:String,json:{write:!0}})],Fh.prototype,"editableExpression",void 0),u([p({type:String,json:{write:!0}})],Fh.prototype,"fieldName",void 0),u([p({type:String,json:{write:!0}})],Fh.prototype,"hint",void 0),u([p({types:WDt,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Fh.prototype,"input",void 0),u([p({type:String,json:{write:!0}})],Fh.prototype,"requiredExpression",void 0),u([p({type:String,json:{read:!1,write:!0}})],Fh.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],Fh.prototype,"valueExpression",void 0),Fh=tee=u([A("esri.form.elements.FieldElement")],Fh);const Gbe=Fh;var iee;let _y=iee=class extends Jb{constructor(t){super(t),this.displayCount=null,this.displayType="list",this.editableExpression=null,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new iee({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editableExpression:this.editableExpression,label:this.label,orderByFields:q(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};u([p({type:Number,json:{write:!0}})],_y.prototype,"displayCount",void 0),u([p({type:["list"],json:{write:!0}})],_y.prototype,"displayType",void 0),u([p({type:String,json:{write:!0}})],_y.prototype,"editableExpression",void 0),u([p({type:[Pre],json:{write:!0}})],_y.prototype,"orderByFields",void 0),u([p({type:Number,json:{write:!0}})],_y.prototype,"relationshipId",void 0),u([p({type:["relationship"],json:{read:!1,write:!0}})],_y.prototype,"type",void 0),_y=iee=u([A("esri.form.elements.RelationshipElement")],_y);const Hbe=_y;var ree;let R2=ree=class extends Jb{constructor(t){super(t),this.text=null,this.textFormat="plain-text",this.type="text"}clone(){return new ree({text:this.text,textFormat:this.textFormat,visibilityExpression:this.visibilityExpression})}};u([p({type:String,json:{write:!0}})],R2.prototype,"text",void 0),u([p({type:String,json:{write:!0}})],R2.prototype,"textFormat",void 0),u([p({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],R2.prototype,"type",void 0),R2=ree=u([A("esri.form.elements.TextElement")],R2);const qbe=R2;let P2=class extends Nt.ClonableMixin(Jb){constructor(e){super(e),this.associationTypes=null,this.editableExpression=null,this.type="utilityNetworkAssociations"}};u([p({type:[yAe],json:{write:{isRequired:!0}}})],P2.prototype,"associationTypes",void 0),u([p({type:String,json:{write:!0}})],P2.prototype,"editableExpression",void 0),u([p({type:["utilityNetworkAssociations"],json:{read:!1,write:!0}})],P2.prototype,"type",void 0),P2=u([A("esri.form.elements.UtilityNetworkAssociationsElement")],P2);const Wbe=P2,ZDt=t=>t.type==="field",YDt=t=>t.type==="group",JDt=t=>t.type==="text";function ize(t){return{typesWithGroup:{base:Jb,key:"type",typeMap:{attachment:zbe,field:Gbe,group:t,relationship:Hbe,text:qbe,utilityNetworkAssociations:Wbe}},typesWithoutGroup:{base:Jb,key:"type",typeMap:{attachment:zbe,field:Gbe,relationship:Hbe,text:qbe,utilityNetworkAssociations:Wbe}}}}function rze(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>r[s.type]).map(s=>r[s.type].fromJSON(s))}function sze(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>r[s.type]).map(s=>s.toJSON())}function nze(t,e,i=!0){return t?t.map(r=>Ad(i?e.typesWithGroup:e.typesWithoutGroup,r)):null}var see;let wm=see=class extends Jb{constructor(t){super(t),this.elements=null,this.initialState="expanded",this.type="group"}castElements(t){return nze(t,M7,!1)}readElements(t,e){return rze(e.formElements,M7,!1)}writeElements(t,e){e.formElements=sze(t,M7,!1)}clone(){return new see({description:this.description,elements:q(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};u([p({json:{write:!0}})],wm.prototype,"elements",void 0),u([ti("elements")],wm.prototype,"castElements",null),u([ve("elements",["formElements"])],wm.prototype,"readElements",null),u([_e("elements")],wm.prototype,"writeElements",null),u([p({type:["collapsed","expanded"],json:{write:!0}})],wm.prototype,"initialState",void 0),u([p({type:String,json:{read:!1,write:!0}})],wm.prototype,"type",void 0),wm=see=u([A("esri.form.elements.GroupElement")],wm);const M7=ize(wm),XDt=wm;var nee;const O7=ize(XDt);let Ep=nee=class extends ee{constructor(t){super(t),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(t){return nze(t,O7)}readElements(t,e){return rze(e.formElements,O7)}writeElements(t,e){e.formElements=sze(t,O7)}clone(){return new nee({description:this.description,expressionInfos:q(this.expressionInfos),elements:q(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}async getFieldsUsed(t,e){const i=new Set,{description:r,elements:s,expressionInfos:n,title:o}=this;if(PP(i,t,r),PP(i,t,o),!s)return[];const a=KDt(s,n).map(l=>Rl(i,t,l));await Promise.all(a);for(const l of s)oze(i,{fieldsIndex:t,relationships:e},l);return Array.from(i).sort()}};function oze(t,e,i){var s;const{fieldsIndex:r}=e;if(!r||r.fields.length!==t.size)switch(PP(t,r,i.label),PP(t,r,i.description),i.type){case"field":dc(t,r,i.fieldName);break;case"group":i.elements.forEach(n=>oze(t,e,n));break;case"relationship":if(e.relationships){const n=e.relationships.find(o=>o.id===i.relationshipId);n&&dc(t,r,n.keyField)}SS(t,r,(s=i.orderByFields)==null?void 0:s.map(n=>n.field));break;case"text":PP(t,r,i.text)}}function KDt(t,e){if(!e||e.length===0)return[];const i=aze(t),r=[];for(const s of e)i.has(s.name)&&r.push(s.expression);return r}function aze(t){const e=new Set;for(const i of t)if(qce(e,i.visibilityExpression),!JDt(i)){if(YDt(i))l3(e,aze(i.elements));else if(qce(e,i.editableExpression),ZDt(i)){const{requiredExpression:r,valueExpression:s}=i;l3(e,[r,s])}}return e}function PP(t,e,i){SS(t,e,Ore(i))}u([p({type:String,json:{write:!0}})],Ep.prototype,"description",void 0),u([p({json:{write:!0}})],Ep.prototype,"elements",void 0),u([ti("elements")],Ep.prototype,"castElements",null),u([ve("elements",["formElements"])],Ep.prototype,"readElements",null),u([_e("elements")],Ep.prototype,"writeElements",null),u([p({type:[IDt],json:{write:!0}})],Ep.prototype,"expressionInfos",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],Ep.prototype,"preserveFieldValuesWhenHidden",void 0),u([p({type:String,json:{write:!0}})],Ep.prototype,"title",void 0),Ep=nee=u([A("esri.form.FormTemplate")],Ep);const QDt=Ep;function Zbe(t,e,i){if(t.hasM==null||t.hasZ)for(const r of e)for(const s of r)s.length>2&&(s[2]*=i)}function eLt(t,e,i){if(!t&&!e||!i)return;const r=gS(i);Ybe(t,i,r),Ybe(e,i,r)}function Ybe(t,e,i){if(t)for(const r of t)tLt(r.geometry,e,i)}function tLt(t,e,i){if(!(t!=null&&t.spatialReference)||as(t.spatialReference,e))return;const r=gS(t.spatialReference)/i;if(r!==1){if("x"in t)t.z!=null&&(t.z*=r);else if("rings"in t)Zbe(t,t.rings,r);else if("paths"in t)Zbe(t,t.paths,r);else if("points"in t&&(t.hasM==null||t.hasZ))for(const s of t.points)s.length>2&&(s[2]*=r)}}function Jbe(t,e,i){if(!(i!=null&&i.features)||!i.hasZ)return;const r=vCe(i.geometryType,e,t.outSpatialReference);if(r!=null)for(const s of i.features)r(s.geometry)}var oee;const aee=new ni({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let la=oee=class extends ee{constructor(t){super(t),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(t,e){return this.readFeaturesWithClass(t,e,Pl)}writeGeometryType(t,e,i,r){if(t)return void aee.write(t,e,i,r);const{features:s}=this;if(s){for(const n of s)if((n==null?void 0:n.geometry)!=null)return void aee.write(n.geometry.type,e,i,r)}}readQueryGeometry(t,e){if(!t)return null;const i=!!t.spatialReference,r=pf(t);return r&&!i&&e.spatialReference&&(r.spatialReference=Oe.fromJSON(e.spatialReference)),r}writeSpatialReference(t,e){if(t)return void(e.spatialReference=t.toJSON());const{features:i}=this;if(i){for(const r of i)if(r&&r.geometry!=null&&r.geometry.spatialReference)return void(e.spatialReference=r.geometry.spatialReference.toJSON())}}clone(){return new oee(this.cloneProperties())}cloneProperties(){return q({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(t){const e=this.write();if(e.features&&Array.isArray(t)&&t.length>0)for(let i=0;i<e.features.length;i++){const r=e.features[i];if(r.geometry){const s=t==null?void 0:t[i];r.geometry=(s==null?void 0:s.toJSON())||r.geometry}}return e}quantize(t){const{scale:[e,i],translate:[r,s]}=t,n=c=>Math.round((c-r)/e),o=c=>Math.round((s-c)/i),a=this.features,l=this._getQuantizationFunction(this.geometryType,n,o);for(let c=0,h=a.length;c<h;c++)l!=null&&l(a[c].geometry)||(a.splice(c,1),c--,h--);return this.transform=t,this}unquantize(){var f,m;const{geometryType:t,features:e,transform:i}=this;if(!i)return this;const{translate:[r,s],scale:[n,o]}=i,a=g=>g*n+r,l=g=>s-g*o;let c=null,h=null;if(this.hasZ&&((f=i==null?void 0:i.scale)==null?void 0:f[2])!=null){const{translate:[,,g],scale:[,,v]}=i;c=_=>_*v+g}if(this.hasM&&((m=i==null?void 0:i.scale)==null?void 0:m[3])!=null){const{translate:[,,,g],scale:[,,,v]}=i;h=_=>_==null?_:_*v+g}const d=this._getHydrationFunction(t,a,l,c,h);for(const{geometry:g}of e)g!=null&&d&&d(g);return this.transform=null,this}readFeaturesWithClass(t,e,i){var n;const r=Oe.fromJSON(e.spatialReference),s=[];for(let o=0;o<t.length;o++){const a=t[o],l=i.fromJSON(a),c=(n=a.geometry)==null?void 0:n.spatialReference;l.geometry==null||c||(l.geometry.spatialReference=r);const h=a.aggregateGeometries,d=l.aggregateGeometries;if(h&&d!=null)for(const f in d){const m=d[f],g=h[f],v=g==null?void 0:g.spatialReference;m==null||v||(m.spatialReference=r)}s.push(l)}return s}_quantizePoints(t,e,i){let r,s;const n=[];for(let o=0,a=t.length;o<a;o++){const l=t[o];if(o>0){const c=e(l[0]),h=i(l[1]);c===r&&h===s||(n.push([c-r,h-s]),r=c,s=h)}else r=e(l[0]),s=i(l[1]),n.push([r,s])}return n.length>0?n:null}_getQuantizationFunction(t,e,i){return t==="point"?r=>(r.x=e(r.x),r.y=i(r.y),r):t==="polyline"||t==="polygon"?r=>{const s=wb(r)?r.rings:r.paths,n=[];for(let o=0,a=s.length;o<a;o++){const l=s[o],c=this._quantizePoints(l,e,i);c&&n.push(c)}return n.length>0?(wb(r)?r.rings=n:r.paths=n,r):null}:t==="multipoint"?r=>{const s=this._quantizePoints(r.points,e,i);return s&&s.length>0?(r.points=s,r):null}:t==="extent"?r=>r:null}_getHydrationFunction(t,e,i,r,s){return t==="point"?n=>{n.x=e(n.x),n.y=i(n.y),r&&(n.z=r(n.z))}:t==="polyline"||t==="polygon"?n=>{const o=wb(n)?n.rings:n.paths;let a,l;for(let c=0,h=o.length;c<h;c++){const d=o[c];for(let f=0,m=d.length;f<m;f++){const g=d[f];f>0?(a+=g[0],l+=g[1]):(a=g[0],l=g[1]),g[0]=e(a),g[1]=i(l)}}if(r&&s)for(let c=0,h=o.length;c<h;c++){const d=o[c];for(let f=0,m=d.length;f<m;f++){const g=d[f];g[2]=r(g[2]),g[3]=s(g[3])}}else if(r)for(let c=0,h=o.length;c<h;c++){const d=o[c];for(let f=0,m=d.length;f<m;f++){const g=d[f];g[2]=r(g[2])}}else if(s)for(let c=0,h=o.length;c<h;c++){const d=o[c];for(let f=0,m=d.length;f<m;f++){const g=d[f];g[2]=s(g[2])}}}:t==="extent"?n=>{n.xmin=e(n.xmin),n.ymin=i(n.ymin),n.xmax=e(n.xmax),n.ymax=i(n.ymax),r&&n.zmax!=null&&n.zmin!=null&&(n.zmax=r(n.zmax),n.zmin=r(n.zmin)),s&&n.mmax!=null&&n.mmin!=null&&(n.mmax=s(n.mmax),n.mmin=s(n.mmin))}:t==="multipoint"?n=>{const o=n.points;let a,l;for(let c=0,h=o.length;c<h;c++){const d=o[c];c>0?(a+=d[0],l+=d[1]):(a=d[0],l=d[1]),d[0]=e(a),d[1]=i(l)}if(r&&s)for(let c=0,h=o.length;c<h;c++){const d=o[c];d[2]=r(d[2]),d[3]=s(d[3])}else if(r)for(let c=0,h=o.length;c<h;c++){const d=o[c];d[2]=r(d[2])}else if(s)for(let c=0,h=o.length;c<h;c++){const d=o[c];d[2]=s(d[2])}}:null}};u([p({type:String,json:{write:!0}})],la.prototype,"displayFieldName",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],la.prototype,"exceededTransferLimit",void 0),u([p({type:[Pl],json:{write:!0}})],la.prototype,"features",void 0),u([ve("features")],la.prototype,"readFeatures",null),u([p({type:[CG],json:{write:!0}})],la.prototype,"fields",void 0),u([p({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:aee.read}}})],la.prototype,"geometryType",void 0),u([_e("geometryType")],la.prototype,"writeGeometryType",null),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],la.prototype,"hasM",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],la.prototype,"hasZ",void 0),u([p({types:eM,json:{write:!0}})],la.prototype,"queryGeometry",void 0),u([ve("queryGeometry")],la.prototype,"readQueryGeometry",null),u([p({type:Oe,json:{write:!0}})],la.prototype,"spatialReference",void 0),u([_e("spatialReference")],la.prototype,"writeSpatialReference",null),u([p({json:{write:!0}})],la.prototype,"transform",void 0),la=oee=u([A("esri.rest.support.FeatureSet")],la),la.prototype.toJSON.isDefaultToJSON=!0;const lze=la;let iLt=0,Ly=class extends Il.LoadableMixin(iw.EsriPromiseMixin(Ce)){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const i=e!=null?e.signal:null;return this.addResolvingPromise(this._startWorker(i)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}get _workerGeometryType(){var i;const e=(i=this.layer)==null?void 0:i.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,i={}){await this.load(i);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,i);Jbe(e,this.layer.spatialReference,r);const s=lze.fromJSON(r);if(!this._requiresClientGraphicMapping())return s;const n=this.layer.objectIdField;for(const o of s.features){const a=o.attributes[n],l=this._idToClientGraphic.get(a);l&&(o.geometry=l.geometry)}return s.geometryType=this.layer.geometryType,s}async queryFeaturesJSON(e,i={}){if(this._requiresClientGraphicMapping())throw new U("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(i);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,i);return Jbe(e,this.layer.spatialReference,r),r}queryFeatureCount(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,i))}queryObjectIds(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,i))}queryExtent(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,i)).then(r=>({count:r.count,extent:_i.fromJSON(r.extent)}))}querySnapping(e,i={}){return this.load(i).then(()=>this._connection.invoke("querySnapping",e,i))}async queryAttributeBins(e,i={}){return await this.load(),this._connection.invoke("queryAttributeBins",e==null?void 0:e.toJSON(),i)}async _applyEdits(e){if(!this._connection)throw new U("feature-layer-source:edit-failure","Memory source not loaded");const i=this.layer.objectIdField;let r=null;const s=[],n=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const o=h=>"objectId"in h&&h.objectId!=null?h.objectId:"attributes"in h&&h.attributes[i]!=null?h.attributes[i]:null;if(e.addFeatures&&(r=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const h of e.deleteFeatures){const d=o(h);d!=null&&s.push(d)}const a=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const h of e.updateFeatures)if(n.push(this._serializeFeature(h)),a){const d=o(h);d!=null&&a.set(d,h)}}eLt(r?r.features:null,n,this.layer.spatialReference);const{fullExtent:l,featureEditResults:c}=await this._connection.invoke("applyEdits",{adds:r?r.features:[],updates:n,deletes:s});return this.fullExtent=l,r&&r.finish(c.uidToObjectId),this._updateClientGraphicIds(a,c),this._createEditsResult(c)}async _prepareClientMapping(e,i){if(this._layerOrSourceGeometryType!=="mesh"||e==null)return;const r=[];for(const{geometry:s}of e)s==null||s.type!=="mesh"||s.hasExtent||s.loaded||r.push(s.load({signal:i}));r.length&&await Promise.all(r)}_updateClientGraphicIds(e,i){if(this._idToClientGraphic){if(e)for(const r of i.updateResults){if(!r.success)continue;const s=e.get(r.objectId);s!=null&&this._addIdToClientGraphic(s)}for(const r of i.deleteResults)r.success&&this._idToClientGraphic.delete(r.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const i=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:i?new U("feature-layer-source:edit-failure",i.description,{code:i.code}):null}}_prepareAddFeatures(e){const i=new Map,r=new Array(e.length);let s=null;for(let o=0;o<e.length;o++){const a=e[o],l=this._serializeFeature(a);s||a.geometry==null||(s=a.geometry.type),r[o]=l,i.set(`${l.uid}`,a)}const n=this;return{features:r,inferredGeometryType:s,finish(o){const a=n.sourceJSON.objectIdField;for(const l in o){const c=o[l],h=i.get(l);h&&(h.attributes||(h.attributes={}),c===-1?delete h.attributes[a]:h.attributes[a]=c,n._addIdToClientGraphic(h))}}}}_addIdToClientGraphic(e){var s;if(!this._idToClientGraphic)return;const i=this.sourceJSON.objectIdField,r=(s=e.attributes)==null?void 0:s[i];r!=null&&this._idToClientGraphic.set(r,e)}get _layerOrSourceGeometryType(){var e,i;return((e=this.layer)==null?void 0:e.geometryType)??((i=this.sourceJSON)==null?void 0:i.geometryType)}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this._layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:i}=e,r=this._geometryForSerialization(e),s=(iLt++).toString();return r?{uid:s,geometry:r.toJSON(),attributes:i}:{uid:s,attributes:i}}_geometryForSerialization(e){const{geometry:i}=e;return i==null?null:this._geometryRequiresClientGraphicMapping(i)?i.extent?Ea.fromExtent(i.extent):null:i}async _startWorker(e){this._connection=await nCe("MemorySourceWorker",{strategy:X("feature-layers-workers")?"dedicated":"local",signal:e,registryTarget:this});const{fields:i,spatialReference:r,objectIdField:s,hasM:n,hasZ:o,timeInfo:a,dateFieldsTimeZone:l}=this.layer,c=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const h=this._prepareAddFeatures(this.items);this.addHandles(this.on("before-changes",g=>{J.getLogger(this).error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),g.preventDefault()}));const d={features:h.features,fields:i==null?void 0:i.map(g=>g.toJSON()),geometryType:yue.toJSON(this._workerGeometryType),hasM:this._layerOrSourceGeometryType!=="mesh"&&n,hasZ:this._layerOrSourceGeometryType==="mesh"||o,objectIdField:s,spatialReference:c?null:r&&r.toJSON(),timeInfo:(a==null?void 0:a.toJSON())??null,dateFieldsTimeZone:l},f=await this._connection.invoke("load",d,{signal:e});for(const g of f.warnings)J.getLogger(this.layer).warn("#load()",`${g.message} (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{warning:g});f.featureErrors.length&&J.getLogger(this.layer).warn("#load()",`Encountered ${f.featureErrors.length} validation errors while loading features. (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{errors:f.featureErrors});const m=f.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(h.inferredGeometryType)&&(m.geometryType=yue.toJSON(h.inferredGeometryType)),this.sourceJSON=m,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),h.finish(f.assignedObjectIds)}};u([Vie({Type:Pl,ensureType:Ds(Pl)})],Ly.prototype,"itemType",void 0),u([p()],Ly.prototype,"type",void 0),u([p({constructOnly:!0})],Ly.prototype,"layer",void 0),u([p({readOnly:!0})],Ly.prototype,"_workerGeometryType",null),u([p()],Ly.prototype,"sourceJSON",void 0),Ly=u([A("esri.layers.graphics.sources.MemorySource")],Ly);function rLt(t){return"portalItem"in t}const sLt=t=>{let e=class extends t{get apiKey(){var i;return this._isOverridden("apiKey")?this._get("apiKey"):rLt(this)?(i=this.portalItem)==null?void 0:i.apiKey:null}set apiKey(i){i!=null?this._override("apiKey",i):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return u([p({type:String})],e.prototype,"apiKey",null),e=u([A("esri.layers.mixins.APIKeyMixin")],e),e},nLt=t=>{let e=class extends t{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const i=Rb(this.url);if(i!=null&&i.title)return i.title}return this._get("title")||""}set title(i){this._set("title",i)}set url(i){this._set("url",Q6e(i,J.getLogger(this)))}};return u([p()],e.prototype,"title",null),u([p({type:String})],e.prototype,"url",null),e=u([A("esri.layers.mixins.ArcGISService")],e),e};function oLt(t,e){function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i}function h$(t,e,i,r){var s=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(s,h$.prototype),s.expected=e,s.found=i,s.location=r,s.name="SyntaxError",s}function I7(t,e,i){return i=i||" ",t.length>e?t:(e-=t.length,t+(i+=i.repeat(e)).slice(0,e))}function aLt(t,e){var i,r={},s=(e=e!==void 0?e:{}).grammarSource,n={start:Mg},o=Mg,a="none",l=")",c=",",h="(",d="%",f="px",m="cm",g="mm",v="in",_="pt",b="pc",w="deg",x="rad",S="grad",C="turn",T="#",M=".",I="e",D=/^[ \t\n\r]/,P=/^[a-z\-]/,F=/^[0-9a-fA-F]/,L=/^[+\-]/,N=/^[0-9]/,R=Do("none"),k=cs("none",!1),W=cs(")",!1),j=cs(",",!1),B=Do("whitespace"),te=du([" ","	",`
`,"\r"],!1,!1),le=Do("function"),de=cs("(",!1),Ae=Do("identifier"),We=du([["a","z"],"-"],!1,!1),Ue=Do("percentage"),it=cs("%",!1),Et=Do("length"),Jt=cs("px",!1),wt=cs("cm",!1),vt=cs("mm",!1),Ft=cs("in",!1),xt=cs("pt",!1),zt=cs("pc",!1),ut=Do("angle"),_t=cs("deg",!1),me=cs("rad",!1),ye=cs("grad",!1),we=cs("turn",!1),ke=Do("number"),Ge=Do("color"),Ot=cs("#",!1),He=du([["0","9"],["a","f"],["A","F"]],!1,!1),yt=du(["+","-"],!1,!1),Se=du([["0","9"]],!1,!1),ze=cs(".",!1),bt=cs("e",!1),qi=function(){return[]},ji=function(V,pe){return{type:"function",name:V,parameters:pe||[]}},ur=function(V,pe){return pe.length>0?i0(V,pe,3):[V]},ir=function(V){return{type:"quantity",value:V.value,unit:V.unit}},Xi=function(V){return{type:"color",colorType:V.type,value:V.value}},$i=function(V){return V},zi=function(){return jd()},Ai=function(V){return{value:V,unit:"%"}},Ht=function(V){return{value:V,unit:"px"}},Xt=function(V){return{value:V,unit:"cm"}},xi=function(V){return{value:V,unit:"mm"}},Wi=function(V){return{value:V,unit:"in"}},Mr=function(V){return{value:V,unit:"pt"}},Qs=function(V){return{value:V,unit:"pc"}},Si=function(V){return{value:V,unit:"deg"}},zr=function(V){return{value:V,unit:"rad"}},Es=function(V){return{value:V,unit:"grad"}},Ro=function(V){return{value:V,unit:"turn"}},el=function(V){return{value:V,unit:null}},tl=function(){return{type:"hex",value:jd()}},Po=function(V){return{type:"function",value:V}},un=function(){return{type:"named",value:jd()}},Cs=function(){return parseFloat(jd())},Q=0|e.peg$currPos,Vt=Q,ps=[{line:1,column:1}],Wr=Q,fs=e.peg$maxFailExpected||[],Xe=0|e.peg$silentFails;if(e.startRule){if(!(e.startRule in n))throw new Error(`Can't start parsing from rule "`+e.startRule+'".');o=n[e.startRule]}function jd(){return t.substring(Vt,Q)}function cs(V,pe){return{type:"literal",text:V,ignoreCase:pe}}function du(V,pe,Me){return{type:"class",parts:V,inverted:pe,ignoreCase:Me}}function Gd(){return{type:"end"}}function Do(V){return{type:"other",description:V}}function QL(V){var pe,Me=ps[V];if(Me)return Me;if(V>=ps.length)pe=ps.length-1;else for(pe=V;!ps[--pe];);for(Me={line:(Me=ps[pe]).line,column:Me.column};pe<V;)t.charCodeAt(pe)===10?(Me.line++,Me.column=1):Me.column++,pe++;return ps[V]=Me,Me}function eN(V,pe,Me){var jt=QL(V),Ur=QL(pe);return{source:s,start:{offset:V,line:jt.line,column:jt.column},end:{offset:pe,line:Ur.line,column:Ur.column}}}function Kt(V){Q<Wr||(Q>Wr&&(Wr=Q,fs=[]),fs.push(V))}function vw(V,pe,Me){return new h$(h$.buildMessage(V,pe),V,pe,Me)}function Mg(){var V;return(V=wT())===r&&(V=tN()),V}function wT(){var V,pe;return Xe++,V=Q,Or(),t.substr(Q,4)===a?(pe=a,Q+=4):(pe=r,Xe===0&&Kt(k)),pe!==r?(Or(),Vt=V,V=qi()):(Q=V,V=r),Xe--,V===r&&Xe===0&&Kt(R),V}function tN(){var V,pe;if(V=[],(pe=Mf())!==r)for(;pe!==r;)V.push(pe),pe=Mf();else V=r;return V}function Mf(){var V,pe,Me,jt;return V=Q,Or(),(pe=vh())!==r?(Or(),(Me=e0())===r&&(Me=null),Or(),t.charCodeAt(Q)===41?(jt=l,Q++):(jt=r,Xe===0&&Kt(W)),jt!==r?(Or(),Vt=V,V=ji(pe,Me)):(Q=V,V=r)):(Q=V,V=r),V}function e0(){var V,pe,Me,jt,Ur,Zr,Ns,Ma;if(V=Q,(pe=Of())!==r){for(Me=[],jt=Q,Ur=Or(),t.charCodeAt(Q)===44?(Zr=c,Q++):(Zr=r,Xe===0&&Kt(j)),Zr===r&&(Zr=null),Ns=Or(),(Ma=Of())!==r?jt=Ur=[Ur,Zr,Ns,Ma]:(Q=jt,jt=r);jt!==r;)Me.push(jt),jt=Q,Ur=Or(),t.charCodeAt(Q)===44?(Zr=c,Q++):(Zr=r,Xe===0&&Kt(j)),Zr===r&&(Zr=null),Ns=Or(),(Ma=Of())!==r?jt=Ur=[Ur,Zr,Ns,Ma]:(Q=jt,jt=r);Vt=V,V=ur(pe,Me)}else Q=V,V=r;return V}function Of(){var V,pe;return V=Q,(pe=ra())===r&&(pe=If())===r&&(pe=t0())===r&&(pe=xT()),pe!==r&&(Vt=V,pe=ir(pe)),(V=pe)===r&&(V=Q,(pe=_w())!==r&&(Vt=V,pe=Xi(pe)),V=pe),V}function Or(){var V,pe;for(Xe++,V=[],pe=t.charAt(Q),D.test(pe)?Q++:(pe=r,Xe===0&&Kt(te));pe!==r;)V.push(pe),pe=t.charAt(Q),D.test(pe)?Q++:(pe=r,Xe===0&&Kt(te));return Xe--,pe=r,Xe===0&&Kt(B),V}function vh(){var V,pe,Me;return Xe++,V=Q,(pe=Hd())!==r?(t.charCodeAt(Q)===40?(Me=h,Q++):(Me=r,Xe===0&&Kt(de)),Me!==r?(Vt=V,V=$i(pe)):(Q=V,V=r)):(Q=V,V=r),Xe--,V===r&&(pe=r,Xe===0&&Kt(le)),V}function Hd(){var V,pe,Me;if(Xe++,V=Q,pe=[],Me=t.charAt(Q),P.test(Me)?Q++:(Me=r,Xe===0&&Kt(We)),Me!==r)for(;Me!==r;)pe.push(Me),Me=t.charAt(Q),P.test(Me)?Q++:(Me=r,Xe===0&&Kt(We));else pe=r;return pe!==r&&(Vt=V,pe=zi()),Xe--,(V=pe)===r&&(pe=r,Xe===0&&Kt(Ae)),V}function ra(){var V,pe,Me;return Xe++,V=Q,Or(),(pe=Aa())!==r?(t.charCodeAt(Q)===37?(Me=d,Q++):(Me=r,Xe===0&&Kt(it)),Me!==r?(Vt=V,V=Ai(pe)):(Q=V,V=r)):(Q=V,V=r),Xe--,V===r&&Xe===0&&Kt(Ue),V}function If(){var V,pe,Me;return Xe++,V=Q,Or(),(pe=Aa())!==r?(t.substr(Q,2)===f?(Me=f,Q+=2):(Me=r,Xe===0&&Kt(Jt)),Me!==r?(Vt=V,V=Ht(pe)):(Q=V,V=r)):(Q=V,V=r),V===r&&(V=Q,Or(),(pe=Aa())!==r?(t.substr(Q,2)===m?(Me=m,Q+=2):(Me=r,Xe===0&&Kt(wt)),Me!==r?(Vt=V,V=Xt(pe)):(Q=V,V=r)):(Q=V,V=r),V===r&&(V=Q,Or(),(pe=Aa())!==r?(t.substr(Q,2)===g?(Me=g,Q+=2):(Me=r,Xe===0&&Kt(vt)),Me!==r?(Vt=V,V=xi(pe)):(Q=V,V=r)):(Q=V,V=r),V===r&&(V=Q,Or(),(pe=Aa())!==r?(t.substr(Q,2)===v?(Me=v,Q+=2):(Me=r,Xe===0&&Kt(Ft)),Me!==r?(Vt=V,V=Wi(pe)):(Q=V,V=r)):(Q=V,V=r),V===r&&(V=Q,Or(),(pe=Aa())!==r?(t.substr(Q,2)===_?(Me=_,Q+=2):(Me=r,Xe===0&&Kt(xt)),Me!==r?(Vt=V,V=Mr(pe)):(Q=V,V=r)):(Q=V,V=r),V===r&&(V=Q,Or(),(pe=Aa())!==r?(t.substr(Q,2)===b?(Me=b,Q+=2):(Me=r,Xe===0&&Kt(zt)),Me!==r?(Vt=V,V=Qs(pe)):(Q=V,V=r)):(Q=V,V=r)))))),Xe--,V===r&&Xe===0&&Kt(Et),V}function t0(){var V,pe,Me;return Xe++,V=Q,(pe=Aa())!==r?(t.substr(Q,3)===w?(Me=w,Q+=3):(Me=r,Xe===0&&Kt(_t)),Me!==r?(Vt=V,V=Si(pe)):(Q=V,V=r)):(Q=V,V=r),V===r&&(V=Q,(pe=Aa())!==r?(t.substr(Q,3)===x?(Me=x,Q+=3):(Me=r,Xe===0&&Kt(me)),Me!==r?(Vt=V,V=zr(pe)):(Q=V,V=r)):(Q=V,V=r),V===r&&(V=Q,(pe=Aa())!==r?(t.substr(Q,4)===S?(Me=S,Q+=4):(Me=r,Xe===0&&Kt(ye)),Me!==r?(Vt=V,V=Es(pe)):(Q=V,V=r)):(Q=V,V=r),V===r&&(V=Q,(pe=Aa())!==r?(t.substr(Q,4)===C?(Me=C,Q+=4):(Me=r,Xe===0&&Kt(we)),Me!==r?(Vt=V,V=Ro(pe)):(Q=V,V=r)):(Q=V,V=r)))),Xe--,V===r&&(pe=r,Xe===0&&Kt(ut)),V}function xT(){var V,pe;return Xe++,V=Q,Or(),(pe=Aa())!==r?(Vt=V,V=el(pe)):(Q=V,V=r),Xe--,V===r&&Xe===0&&Kt(ke),V}function _w(){var V,pe,Me,jt;if(Xe++,V=Q,t.charCodeAt(Q)===35?(pe=T,Q++):(pe=r,Xe===0&&Kt(Ot)),pe!==r){if(Me=[],jt=t.charAt(Q),F.test(jt)?Q++:(jt=r,Xe===0&&Kt(He)),jt!==r)for(;jt!==r;)Me.push(jt),jt=t.charAt(Q),F.test(jt)?Q++:(jt=r,Xe===0&&Kt(He));else Me=r;Me!==r?(Vt=V,V=tl()):(Q=V,V=r)}else Q=V,V=r;return V===r&&(V=Q,(pe=Mf())!==r&&(Vt=V,pe=Po(pe)),(V=pe)===r&&(V=Q,(pe=Hd())!==r&&(Vt=V,pe=un()),V=pe)),Xe--,V===r&&(pe=r,Xe===0&&Kt(Ge)),V}function Aa(){var V,pe,Me,jt,Ur,Zr,Ns,Ma;for(V=Q,pe=t.charAt(Q),L.test(pe)?Q++:(pe=r,Xe===0&&Kt(yt)),pe===r&&(pe=null),Me=Q,jt=[],Ur=t.charAt(Q),N.test(Ur)?Q++:(Ur=r,Xe===0&&Kt(Se));Ur!==r;)jt.push(Ur),Ur=t.charAt(Q),N.test(Ur)?Q++:(Ur=r,Xe===0&&Kt(Se));if(t.charCodeAt(Q)===46?(Ur=M,Q++):(Ur=r,Xe===0&&Kt(ze)),Ur!==r){if(Zr=[],Ns=t.charAt(Q),N.test(Ns)?Q++:(Ns=r,Xe===0&&Kt(Se)),Ns!==r)for(;Ns!==r;)Zr.push(Ns),Ns=t.charAt(Q),N.test(Ns)?Q++:(Ns=r,Xe===0&&Kt(Se));else Zr=r;Zr!==r?Me=jt=[jt,Ur,Zr]:(Q=Me,Me=r)}else Q=Me,Me=r;if(Me===r)if(Me=[],jt=t.charAt(Q),N.test(jt)?Q++:(jt=r,Xe===0&&Kt(Se)),jt!==r)for(;jt!==r;)Me.push(jt),jt=t.charAt(Q),N.test(jt)?Q++:(jt=r,Xe===0&&Kt(Se));else Me=r;if(Me!==r){if(jt=Q,t.charCodeAt(Q)===101?(Ur=I,Q++):(Ur=r,Xe===0&&Kt(bt)),Ur!==r){if(Zr=t.charAt(Q),L.test(Zr)?Q++:(Zr=r,Xe===0&&Kt(yt)),Zr===r&&(Zr=null),Ns=[],Ma=t.charAt(Q),N.test(Ma)?Q++:(Ma=r,Xe===0&&Kt(Se)),Ma!==r)for(;Ma!==r;)Ns.push(Ma),Ma=t.charAt(Q),N.test(Ma)?Q++:(Ma=r,Xe===0&&Kt(Se));else Ns=r;Ns!==r?jt=Ur=[Ur,Zr,Ns]:(Q=jt,jt=r)}else Q=jt,jt=r;jt===r&&(jt=null),Vt=V,V=Cs()}else Q=V,V=r;return V}function bw(V,pe){return V.map(function(Me){return Me[pe]})}function i0(V,pe,Me){return[V].concat(bw(pe,Me))}if(i=o(),e.peg$library)return{peg$result:i,peg$currPos:Q,peg$FAILED:r,peg$maxFailExpected:fs,peg$maxFailPos:Wr};if(i!==r&&Q===t.length)return i;throw i!==r&&Q<t.length&&Kt(Gd()),vw(fs,Wr<t.length?t.charAt(Wr):null,Wr<t.length?eN(Wr,Wr+1):eN(Wr,Wr))}function cze(t){if(!t||t.length===0)return null;if(typeof t=="string"){const i=Xbe(t);return i&&i.length!==0?i:null}const e=t.map(i=>{if(!Number.isFinite(i.scale)||i.scale<=0)throw new U("effect:invalid-scale","scale must be finite and greater than 0",{stop:i});return{scale:i.scale,effects:Xbe(i.value)}});e.sort((i,r)=>r.effects.length-i.effects.length);for(let i=0;i<e.length-1;i++){if(!EJe(e[i].effects,e[i+1].effects))throw new U("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[i].effects,b:e[i+1].effects});CJe(e[i].effects,e[i+1].effects)}return e.sort((i,r)=>r.scale-i.scale),e}function Xbe(t){let e;if(!t)return[];try{e=aLt(t)}catch(i){throw new U("effect:invalid-syntax","Invalid effect syntax",{value:t,error:i})}return e.map(i=>lLt(i))}function lLt(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return cLt(t);case"opacity":return uLt(t);case"hue-rotate":return hLt(t);case"blur":return dLt(t);case"drop-shadow":return pLt(t);case"bloom":return fLt(t)}}catch(e){throw e.details.filter=t,e}throw new U("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function cLt(t){let e=1;return SM(t.parameters,1),t.parameters.length===1&&(e=Bp(t.parameters[0])),new qZ(t.name,e)}function uLt(t){let e=1;return SM(t.parameters,1),t.parameters.length===1&&(e=Bp(t.parameters[0])),new D$e(e)}function hLt(t){let e=0;return SM(t.parameters,1),t.parameters.length===1&&(e=bLt(t.parameters[0])),new R$e(e)}function dLt(t){let e=0;return SM(t.parameters,1),t.parameters.length===1&&(e=tle(t.parameters[0]),GL(e,t.parameters[0])),new $$e(e)}function pLt(t){const e=[];let i=null;for(const r of t.parameters)if(r.type==="color"){if(e.length&&Object.freeze(e),i)throw new U("effect:type-error","Accepts only one color",{});i=wLt(r)}else{const s=tle(r);if(Object.isFrozen(e))throw new U("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(s),e.length===3&&GL(s,r)}if(e.length<2||e.length>3)throw new U("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new O$e(e[0],e[1],e[2]||0,i||uze("black"))}function fLt(t){let e=1,i=0,r=0;return SM(t.parameters,3),t.parameters[0]&&(e=Bp(t.parameters[0])),t.parameters[1]&&(i=tle(t.parameters[1]),GL(i,t.parameters[1])),t.parameters[2]&&(r=Bp(t.parameters[2])),new E$e(e,i,r)}function SM(t,e){if(t.length>e)throw new U("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function eH(t){if(t.type==="color")return"<color>";if(t.unit){if(t.unit in ele)return"<length>";if(t.unit in Qae)return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function GL(t,e){if(t<0)throw new U("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function mLt(t){if(t.type!=="quantity"||t.unit!==null)throw new U("effect:type-error",`Expected <double>, Actual: ${eH(t)}`,{term:t})}function gLt(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new U("effect:type-error",`Expected <double> or <percentage>, Actual: ${eH(t)}`,{term:t})}oLt(h$,Error),h$.prototype.format=function(t){var e="Error: "+this.message;if(this.location){var i,r=null;for(i=0;i<t.length;i++)if(t[i].source===this.location.source){r=t[i].text.split(/\r\n|\n|\r/g);break}var s=this.location.start,n=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(s):s,o=this.location.source+":"+n.line+":"+n.column;if(r){var a=this.location.end,l=I7("",n.line.toString().length," "),c=r[s.line-1],h=(s.line===a.line?a.column:c.length+1)-s.column||1;e+=`
 --> `+o+`
`+l+` |
`+n.line+" | "+c+`
`+l+" | "+I7("",s.column-1," ")+I7("",h,"^")}else e+=`
 at `+o}return e},h$.buildMessage=function(t,e){var i={literal:function(c){return'"'+s(c.text)+'"'},class:function(c){var h=c.parts.map(function(d){return Array.isArray(d)?n(d[0])+"-"+n(d[1]):n(d)});return"["+(c.inverted?"^":"")+h.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(c){return c.description}};function r(c){return c.charCodeAt(0).toString(16).toUpperCase()}function s(c){return c.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(h){return"\\x0"+r(h)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(h){return"\\x"+r(h)})}function n(c){return c.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(h){return"\\x0"+r(h)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(h){return"\\x"+r(h)})}function o(c){return i[c.type](c)}function a(c){var h,d,f=c.map(o);if(f.sort(),f.length>0){for(h=1,d=1;h<f.length;h++)f[h-1]!==f[h]&&(f[d]=f[h],d++);f.length=d}switch(f.length){case 1:return f[0];case 2:return f[0]+" or "+f[1];default:return f.slice(0,-1).join(", ")+", or "+f[f.length-1]}}function l(c){return c?'"'+s(c)+'"':"end of input"}return"Expected "+a(t)+" but "+l(e)+" found."};const Qae={deg:1,grad:.9,rad:180/Math.PI,turn:360};function yLt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&Qae[t.unit]!=null))throw new U("effect:type-error",`Expected <angle>, Actual: ${eH(t)}`,{term:t})}const ele={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function vLt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&ele[t.unit]!=null))throw new U("effect:type-error",`Expected <length>, Actual: ${eH(t)}`,{term:t})}function Bp(t){gLt(t);const e=t.value;return GL(e,t),t.unit==="%"?.01*e:e}function _Lt(t){return mLt(t),GL(t.value,t),t.value}function bLt(t){return yLt(t),t.value*Qae[t.unit]||0}function tle(t){return vLt(t),t.value*ele[t.unit]||0}function wLt(t){switch(t.colorType){case"hex":return LYe(t.value);case"named":return uze(t.value);case"function":return TLt(t.value)}}function uze(t){if(!c$e(t))throw new U("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return DYe(t)}const xLt=/^rgba?/i,SLt=/^hsla?/i;function TLt(t){if(SM(t.parameters,4),xLt.test(t.name))return[Bp(t.parameters[0]),Bp(t.parameters[1]),Bp(t.parameters[2]),t.parameters[3]?Bp(t.parameters[3]):1];if(SLt.test(t.name))return u$e(_Lt(t.parameters[0]),Bp(t.parameters[1]),Bp(t.parameters[2]),t.parameters[3]?Bp(t.parameters[3]):1);throw new U("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function pD(t,e,i){var r;try{return CLt(t)}catch(s){(r=i==null?void 0:i.messages)==null||r.push(s)}return null}function fD(t,e,i,r){try{const s=ELt(t);ro(i,s,e)}catch(s){r.messages&&r.messages.push(s)}}function ELt(t){const e=cze(t);return e?$Je(e)?e.map(i=>i.toJSON()):e.map(({scale:i,effects:r})=>({scale:i,value:r.map(s=>s.toJSON())})):null}function CLt(t){if(!t||t.length===0)return null;if($Lt(t)){const e=[];for(const i of t)e.push({scale:i.scale,value:Kbe(i.value)});return e}return Kbe(t)}function $Lt(t){const e=t[0];return!!e&&"scale"in e}function Kbe(t){if(!(t!=null&&t.length))return"";const e=[];for(const i of t){let r=[];switch(i.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":r=[Wg(i,"amount")];break;case"blur":r=[Wg(i,"radius","pt")];break;case"hue-rotate":r=[Wg(i,"angle","deg")];break;case"drop-shadow":r=[Wg(i,"xoffset","pt"),Wg(i,"yoffset","pt"),Wg(i,"blurRadius","pt"),ALt(i,"color")];break;case"bloom":r=[Wg(i,"strength"),Wg(i,"radius","pt"),Wg(i,"threshold")]}const s=`${i.type}(${r.filter(Boolean).join(" ")})`;cze(s),e.push(s)}return e.join(" ")}function Wg(t,e,i){if(t[e]==null)throw new U("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});return i?t[e]+i:""+t[e]}function ALt(t,e){if(t[e]==null)throw new U("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});const i=t[e];return`rgba(${i[0]||0}, ${i[1]||0}, ${i[2]||0}, ${i[3]/255||0})`}const MLt={type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:{layerContainerTypes:Xs}},"portal-item":{read:!0,write:{layerContainerTypes:Xs}}}}},Qbe={read:{reader:pD},write:{allowNull:!0,writer:fD,layerContainerTypes:Xs}},OLt={json:{read:!1,write:!1,origins:{"web-map":Qbe,"portal-item":Qbe}}},ILt=t=>{let e=class extends t{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return u([p(MLt)],e.prototype,"blendMode",void 0),u([p(OLt)],e.prototype,"effect",void 0),e=u([A("esri.layers.mixins.BlendLayer")],e),e},RLt=t=>{let e=class extends t{constructor(){super(...arguments),this.customParameters=null}};return u([p({type:Object,json:{write:{overridePolicy:i=>({enabled:!!(i&&Object.keys(i).length>0)})}}})],e.prototype,"customParameters",void 0),e=u([A("esri.layers.mixins.CustomParametersMixin")],e),e},ewe={write:{overridePolicy:(t,e,i)=>({enabled:!i||i.filterMode==="scale"})}};let h_=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.id=dL(),this.maxScale=0,this.minScale=0,this.title="",this.where=null}};u([p({type:String,json:{write:!0}})],h_.prototype,"id",void 0),u([p({type:Number,json:ewe})],h_.prototype,"maxScale",void 0),u([p({type:Number,json:ewe})],h_.prototype,"minScale",void 0),u([p({type:String,json:{write:!0}})],h_.prototype,"title",void 0),u([p({type:String,json:{write:!0}})],h_.prototype,"where",void 0),h_=u([A("esri.layers.support.DisplayFilter")],h_);const hze=h_;function PLt(t,e){return{...e,filterMode:t.mode}}function xpi(t,e){return dze(t,e).next().value??null}function Spi(t,e,i){const r=DLt(t);if(r&&(oTe(e,r[0])||kW(i,r[1])))return"";const s=Array.from(dze(t,e,i)),n=LLt(s,e,i)?"1=1":s.map(o=>o.where||"1=1").reduce((o,a)=>KJe(o,a),"");return n&&n!=="1=1"?n:""}function DLt(t){if(pze(t)==="manual")return null;const e=[Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY];for(const{minScale:i,maxScale:r}of t.filters)e[0]=Math.max(e[0],mD(i)),e[1]=Math.min(e[1],_V(r));return e}function*dze(t,e,i){if(pze(t)==="manual"){const r=t.filters.find(s=>s.id===t.activeFilterId);r&&(yield r)}else{typeof e=="object"&&(e=e.scale);for(const r of t.filters)NLt(r.minScale,r.maxScale,e,i)&&(yield r)}}function LLt(t,e,i){var n,o;if(t.length===0)return!0;const r=mD((n=t.at(0))==null?void 0:n.minScale),s=_V((o=t.at(-1))==null?void 0:o.maxScale);if(kW(r,e)||oTe(s,i))return!0;for(let a=0;a<t.length-1;a++){const l=t[a],c=t[a+1];if(kW(mD(c.minScale),_V(l.maxScale)))return!0}return!1}function NLt(t,e,i,r){return t=mD(t),i=mD(i),e=_V(e),!(!tu(i,t)&&(r??i)>t)&&!JGe(e,i)&&(r===void 0||!tu(r,t))}function pze(t){return"mode"in t?t.mode:t.filterMode}function mD(t){return t||Number.POSITIVE_INFINITY}function _V(t){return t||0}let K1=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.activeFilterId=null,this.filters=new(Ce.ofType(hze)),this.mode="manual"}writeFilters(e,i,r,s){const n=e.toArray();this.mode==="scale"&&n.sort((o,a)=>{const l=Tct(a.minScale,o.minScale),c=o.maxScale-a.maxScale;return l===0?c:l}),i[r]=n.map(o=>o.toJSON(s))}write(e,i){return super.write(e,PLt(this,i))}};u([p({type:String,json:{write:{overridePolicy:(t,e,i)=>({enabled:i.filterMode==="manual",isRequired:!0})}}})],K1.prototype,"activeFilterId",void 0),u([p({type:Ce.ofType(hze),nonNullable:!0,json:{write:!0}})],K1.prototype,"filters",void 0),u([_e("filters")],K1.prototype,"writeFilters",null),u([p({type:["manual","scale"],nonNullable:!0,json:{name:"filterMode",write:!0}})],K1.prototype,"mode",void 0),K1=u([A("esri.layers.support.DisplayFilterInfo")],K1);const FLt=K1,kLt=t=>{let e=class extends t{constructor(){super(...arguments),this.displayFilterEnabled=!0,this.displayFilterInfo=null}};return u([p(zLt)],e.prototype,"displayFilterEnabled",void 0),u([p(ULt)],e.prototype,"displayFilterInfo",void 0),e=u([A("esri.layers.mixins.DisplayFilteredLayer")],e),e},zLt={type:Boolean,json:{name:"layerDefinition.disableDisplayFilter",read:{reader:t=>!t},write:{layerContainerTypes:Xs,writer(t,e,i){ro(i,!t,e)}},origins:{"web-scene":{write:!1,read:!1}}}},ULt={type:FLt,json:{name:"layerDefinition.displayFilterInfo",write:{enabled:!0,allowNull:!0,layerContainerTypes:Xs},origins:{"web-scene":{write:!1,read:!1}}}},lee=Ynt(),fze=new Map,mze=new Map;async function Epi(t,e,i){if(!t||!i)return!1;if(!e)return!0;const r=new URL(t).host;let s=fze.get(r);if(!s){const n=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");s=(await Ri(n,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return s===e}async function twe(t,e,i=!1){var n,o,a;if(!t||!e)return!0;const r=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),s=(n=mze.get(r))==null?void 0:n.entries();if(s){for(const[l,c]of s)if(c.name===e){const h=!((o=c.stack)!=null&&o.hasForwardEdits());if(!h&&i){const[{deleteForwardEdits:d},{default:f}]=await Promise.all([G(()=>import("./deleteForwardEdits-BPifJt3m.js"),[]),G(()=>import("./DeleteForwardEditsParameters-ckzj_3oU.js"),[])]),m=await d(r,l,new f({sessionId:lee,moment:c.moment}));return m.success&&((a=c.stack)==null||a.clearForwardEdits()),m.success}return h}}return!0}function $z(t,e){var s;if(!t)return!1;const i=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),r=(s=mze.get(i))==null?void 0:s.entries();if(r){for(const[n,o]of r)if(o.name===e)return o.lockType==="edit"}return!1}const ile=new Ss.EventEmitter;function gze(t){return ile.on("apply-edits",new WeakRef(t))}function yze(t){return ile.on("update-moment",new WeakRef(t))}function iwe(t,e,i=null,r=!1){const s=ta();return r=e==null||r,ile.emit("apply-edits",{serviceUrl:t,layerId:e,gdbVersion:i,mayReceiveServiceEdits:r,result:s.promise}),s}const vze=Symbol();function Cpi(t){return t!=null&&typeof t=="object"&&vze in t}function FO(t){return t!=null&&typeof t=="object"&&"gdbVersion"in t}function DP(t,e,i){const r=new URL(t).host,s=fze.get(r),n=o=>!o||o===s;return n(e)&&n(i)||e===i}const BLt=t=>{var e;let i=class extends t{constructor(...r){super(...r),this[e]=!0,this._applyEditsHandler=s=>{const{serviceUrl:n,layerId:o,gdbVersion:a,mayReceiveServiceEdits:l,result:c}=s,h=n===this.url,d=o!=null&&this.layerId!=null&&o===this.layerId,f=FO(this),m=FO(this)&&DP(n,a,this.gdbVersion);if(!h||f&&!m||!d&&!l)return;const g=c.then(v=>{var w;if(this.lastEditsEventDate=new Date,d&&(v.addedFeatures.length||v.updatedFeatures.length||v.deletedFeatures.length||v.addedAttachments.length||v.updatedAttachments.length||v.deletedAttachments.length))return this.emit("edits",q(v)),v;const _=(w=v.editedFeatures)==null?void 0:w.find(({layerId:x})=>x===this.layerId);if(_){const{adds:x,updates:S,deletes:C}=_.editedFeatures,T={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:x?x.map(({attributes:M})=>({objectId:this.objectIdField&&M[this.objectIdField],globalId:this.globalIdField&&M[this.globalIdField]})):[],deletedFeatures:C?C.map(({attributes:M})=>({objectId:this.objectIdField&&M[this.objectIdField],globalId:this.globalIdField&&M[this.globalIdField]})):[],updatedFeatures:S?S.map(({current:{attributes:M}})=>({objectId:this.objectIdField&&M[this.objectIdField],globalId:this.globalIdField&&M[this.globalIdField]})):[],editedFeatures:q(v.editedFeatures),exceededTransferLimit:!1,historicMoment:q(v.historicMoment)};return this.emit("edits",T),T}const b={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:q(v.editedFeatures),exceededTransferLimit:!1,historicMoment:q(v.historicMoment)};return"historicMoment"in this&&this._shouldUpdateHistoricMoment(n,a,b.historicMoment)&&this.emit("edits",b),b}).then(v=>("historicMoment"in this&&this._shouldUpdateHistoricMoment(n,a,v.historicMoment)&&(this.historicMoment=v.historicMoment),v));this.emit("apply-edits",{result:g})},this._updateMomentHandler=s=>{const{serviceUrl:n,gdbVersion:o,moment:a}=s,l=n===this.url,c=FO(this),h=FO(this)&&DP(n,o,this.gdbVersion),d=FO(this)&&!DP(n,this.gdbVersion,null);l&&c&&h&&d&&"historicMoment"in this&&this.historicMoment!==a&&(this.historicMoment=a)},this.when().then(()=>{this.addHandles(gze(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(yze(this._updateMomentHandler))},()=>{})}_shouldUpdateHistoricMoment(r,s,n){return"historicMoment"in this&&this.historicMoment!==n&&$z(r,s)}};return e=vze,u([p()],i.prototype,"lastEditsEventDate",void 0),i=u([A("esri.layers.mixins.EditBusLayer")],i),i};var cee;const R7=new ni({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),P7=new ni({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let mm=cee=class extends ee{constructor(t){super(t),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(t={}){const{where:e,geometry:i,spatialRelationship:r,timeExtent:s,objectIds:n,units:o,distance:a}=this;return new ng({geometry:q(i),objectIds:q(n),spatialRelationship:r,timeExtent:q(s),where:e,units:o,distance:a,...t})}clone(){const{where:t,geometry:e,spatialRelationship:i,timeExtent:r,objectIds:s,units:n,distance:o}=this;return new cee({geometry:q(e),objectIds:q(s),spatialRelationship:i,timeExtent:q(r),where:t,units:n,distance:o})}};u([p({type:String,json:{write:!0}})],mm.prototype,"where",void 0),u([p({types:eM,json:{write:!0}})],mm.prototype,"geometry",void 0),u([p({type:R7.apiValues,json:{name:"spatialRel",read:{reader:R7.read},write:{allowNull:!1,writer:R7.write,overridePolicy(){return{enabled:this.geometry!=null}}}}})],mm.prototype,"spatialRelationship",void 0),u([p({type:Number,json:{write:{overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],mm.prototype,"distance",void 0),u([p({type:[Number],json:{write:!0}})],mm.prototype,"objectIds",void 0),u([p({type:P7.apiValues,json:{read:P7.read,write:{writer:P7.write,overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],mm.prototype,"units",void 0),u([p({type:Eo,json:{write:!0}})],mm.prototype,"timeExtent",void 0),mm=cee=u([A("esri.layers.support.FeatureFilter")],mm);const VLt=mm;var uee;const rwe={read:{reader:pD},write:{writer:fD,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},swe={read:{reader:pD},write:{writer:fD,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},nwe={name:"showExcludedLabels",default:!0};let Q1=uee=class extends ee{constructor(t){super(t),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(t,e){var r,s;const i=super.write(t,e);if(e!=null&&e.origin){if(i.filter){const n=Object.keys(i.filter);if(n.length>1||n[0]!=="where")return(r=e.messages)==null||r.push(new U("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:e.layer,effect:this})),null}if("showExcludedLabels"in i)return(s=e.messages)==null||s.push(new U("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:e.layer,effect:this})),null}return i}clone(){return new uee({filter:this.filter!=null?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};u([p({type:VLt,json:{write:{allowNull:!0,writer(t,e,i,r){const s=t==null?void 0:t.write({},r);s&&Object.keys(s).length!==0?ro(i,s,e):ro(i,null,e)}}}})],Q1.prototype,"filter",void 0),u([p({json:{read:pD,write:{writer:fD,allowNull:!0},origins:{"web-map":rwe,"portal-item":rwe}}})],Q1.prototype,"includedEffect",void 0),u([p({json:{read:pD,write:{writer:fD,allowNull:!0},origins:{"web-map":swe,"portal-item":swe}}})],Q1.prototype,"excludedEffect",void 0),u([p({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":nwe,"portal-item":nwe}}})],Q1.prototype,"excludedLabelsVisible",void 0),Q1=uee=u([A("esri.layers.support.FeatureEffect")],Q1);const jLt=Q1,owe={write:{allowNull:!0}},GLt={type:jLt,json:{origins:{"web-map":owe,"portal-item":owe}}},HLt=t=>{let e=class extends t{constructor(){super(...arguments),this.featureEffect=null}};return u([p(GLt)],e.prototype,"featureEffect",void 0),e=u([A("esri.layers.mixins.FeatureEffectLayer")],e),e};var hee;let wR=hee=class extends ee{constructor(t){super(t)}async collectRequiredFields(t,e){return Rl(t,e,this.expression)}clone(){return new hee({expression:this.expression,title:this.title})}equals(t){return this.expression===t.expression&&this.title===t.title}};u([p({type:String,json:{write:{isRequired:!0}}})],wR.prototype,"expression",void 0),u([p({type:String,json:{write:!0}})],wR.prototype,"title",void 0),wR=hee=u([A("esri.symbols.support.FeatureExpressionInfo")],wR);const awe=wR;var dee;const Lk=Oo()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),lwe=new ni({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let by=dee=class extends ee{constructor(t){super(t),this.featureExpressionInfo=void 0,this.offset=null}readFeatureExpressionInfo(t,e){return t??(e.featureExpression&&e.featureExpression.value===0?{expression:"0"}:void 0)}writeFeatureExpressionInfo(t,e,i,r){e[i]=t.write({},r),t.expression==="0"&&(e.featureExpression={value:0})}get mode(){const{offset:t,featureExpressionInfo:e}=this;return this._isOverridden("mode")?this._get("mode"):t!=null||e?"relative-to-ground":"on-the-ground"}set mode(t){this._override("mode",t)}set unit(t){this._set("unit",t)}write(t,e){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(t,e):null}clone(){return new dee({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(t){return this.mode===t.mode&&this.offset===t.offset&&this.unit===t.unit&&eGe(this.featureExpressionInfo,t.featureExpressionInfo)}};u([p({type:awe,json:{write:!0}})],by.prototype,"featureExpressionInfo",void 0),u([ve("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],by.prototype,"readFeatureExpressionInfo",null),u([_e("featureExpressionInfo",{featureExpressionInfo:{type:awe},"featureExpression.value":{type:[0]}})],by.prototype,"writeFeatureExpressionInfo",null),u([p({type:Lk.apiValues,nonNullable:!0,json:{type:Lk.jsonValues,read:Lk.read,write:{writer:Lk.write,isRequired:!0}}})],by.prototype,"mode",null),u([p({type:Number,json:{write:!0}})],by.prototype,"offset",void 0),u([p({type:Xct,json:{type:String,read:lwe.read,write:lwe.write}})],by.prototype,"unit",null),by=dee=u([A("esri.symbols.support.ElevationInfo")],by);const qLt=by;let D2=class extends ee{constructor(e){super(e),this.description=null,this.label=null,this.type=null}};u([p({type:String,json:{write:!0}})],D2.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],D2.prototype,"label",void 0),u([p()],D2.prototype,"type",void 0),D2=u([A("esri.tables.elements.AttributeTableElement")],D2);const PA=D2;var pee;let xR=pee=class extends PA{constructor(t){super(t),this.displayType="auto",this.type="attachment"}clone(){return new pee({description:this.description,displayType:this.displayType,label:this.label})}};u([p({type:["auto"],json:{write:!0}})],xR.prototype,"displayType",void 0),u([p({type:["attachment"],readOnly:!0,json:{read:!1,write:!0}})],xR.prototype,"type",void 0),xR=pee=u([A("esri.tables.elements.AttributeTableAttachmentElement")],xR);const cwe=xR;var fee;let SR=fee=class extends PA{constructor(t){super(t),this.fieldName=null,this.type="field"}clone(){return new fee({description:this.description,fieldName:this.fieldName,label:this.label})}};u([p({type:String,json:{write:!0}})],SR.prototype,"fieldName",void 0),u([p({type:String,json:{read:!1,write:!0}})],SR.prototype,"type",void 0),SR=fee=u([A("esri.tables.elements.AttributeTableFieldElement")],SR);const uwe=SR;var mee;let TR=mee=class extends PA{constructor(t){super(t),this.relationshipId=null,this.type="relationship"}clone(){return new mee({description:this.description,label:this.label,relationshipId:this.relationshipId})}};u([p({type:Number,json:{write:!0}})],TR.prototype,"relationshipId",void 0),u([p({type:["relationship"],json:{read:!1,write:!0}})],TR.prototype,"type",void 0),TR=mee=u([A("esri.tables.elements.AttributeTableRelationshipElement")],TR);const hwe=TR;function _ze(t){return{typesWithGroup:{base:PA,key:"type",typeMap:{attachment:cwe,field:uwe,group:t,relationship:hwe}},typesWithoutGroup:{base:PA,key:"type",typeMap:{attachment:cwe,field:uwe,relationship:hwe}}}}function bze(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>r[s.type]).map(s=>r[s.type].fromJSON(s))}function wze(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>r[s.type]).map(s=>s.toJSON())}function xze(t,e,i=!0){return t?t.map(r=>Ad(i?e.typesWithGroup:e.typesWithoutGroup,r)):null}var gee;let Ny=gee=class extends PA{constructor(t){super(t),this.elements=null,this.type="group"}castElements(t){return xze(t,D7,!1)}readElements(t,e){return bze(e.attributeTableElements,D7,!1)}writeElements(t,e){e.attributeTableElements=wze(t,D7,!1)}clone(){return new gee({description:this.description,elements:q(this.elements),label:this.label})}};u([p({json:{write:!0}})],Ny.prototype,"elements",void 0),u([ti("elements")],Ny.prototype,"castElements",null),u([ve("elements",["attributeTableElements"])],Ny.prototype,"readElements",null),u([_e("elements")],Ny.prototype,"writeElements",null),u([p({type:String,json:{read:!1,write:!0}})],Ny.prototype,"type",void 0),Ny=gee=u([A("esri.tables.elements.AttributeTableGroupElement")],Ny);const D7=_ze(Ny),WLt=Ny;var yee;const L7=_ze(WLt);let d_=yee=class extends ee{constructor(t){super(t),this.elements=null,this.orderByFields=null}castElements(t){return xze(t,L7)}readElements(t,e){return bze(e.attributeTableElements,L7)}writeElements(t,e){e.attributeTableElements=wze(t,L7)}clone(){return new yee({elements:q(this.elements),orderByFields:this.orderByFields})}};u([p({json:{write:!0}})],d_.prototype,"elements",void 0),u([ti("elements")],d_.prototype,"castElements",null),u([ve("elements",["attributeTableElements"])],d_.prototype,"readElements",null),u([_e("elements")],d_.prototype,"writeElements",null),u([p({type:[Object],json:{write:!0}})],d_.prototype,"orderByFields",void 0),d_=yee=u([A("esri.tables.AttributeTableTemplate")],d_);const ZLt=d_,YLt={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:{enabled:!0,layerContainerTypes:Xs}}},tH={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(t,e)=>!e.disablePopup},write:{enabled:!0,writer(t,e,i){e[i]=!t}}}},iH={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:{enabled:!0,layerContainerTypes:Xs}}},JLt={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:fS}}},XLt={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:{enabled:!0,layerContainerTypes:Xs}}},KLt={value:null,type:qLt,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:{enabled:!0,layerContainerTypes:Xs}}};function Api(t){return{type:t,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const Sze={write:{enabled:!0,layerContainerTypes:Xs},read:!0},vee={type:Number,json:{origins:{"web-document":Sze,"portal-item":{write:{layerContainerTypes:Xs}}}}},QLt={...vee,json:{...vee.json,origins:{"web-document":{...Sze,write:{enabled:!0,layerContainerTypes:Xs,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(t,e,i)=>{var r;return i&&i.origin!=="service"||!e.drawingInfo||e.drawingInfo.transparency===void 0?(r=e.layerDefinition)!=null&&r.drawingInfo&&e.layerDefinition.drawingInfo.transparency!==void 0?X$(e.layerDefinition.drawingInfo.transparency):void 0:X$(e.drawingInfo.transparency)}}}},Mpi={type:_i,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(t,e)=>{const i=_i.fromJSON(t);return e.spatialReference!=null&&typeof e.spatialReference=="object"&&(i.spatialReference=Oe.fromJSON(e.spatialReference)),i}}}},read:!1}},eNt={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},tNt={type:Number,json:{origins:{service:{write:{enabled:!1}}},name:"layerDefinition.minScale",write:{layerContainerTypes:Xs}}},iNt={type:Number,json:{origins:{service:{write:{enabled:!1}}},name:"layerDefinition.maxScale",write:{layerContainerTypes:Xs}}},Tze={json:{write:{ignoreOrigin:!0,layerContainerTypes:Xs},origins:{"web-map":{read:!1,write:!1}}}},rNt={type:ZLt,json:{name:"attributeTableInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}};let wy=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.timeZone=null}};u([p()],wy.prototype,"creatorField",void 0),u([p()],wy.prototype,"creationDateField",void 0),u([p()],wy.prototype,"editorField",void 0),u([p()],wy.prototype,"editDateField",void 0),u([p()],wy.prototype,"realm",void 0),u([p(UU("dateFieldsTimeReference",!0))],wy.prototype,"timeZone",void 0),wy=u([A("esri.layers.support.EditFieldsInfo")],wy);const sNt=wy;let xm=class extends Nt.ClonableMixin(ee){constructor(e){super(e)}};u([p({constructOnly:!0,json:{write:!0}})],xm.prototype,"name",void 0),u([p({constructOnly:!0,json:{write:!0}})],xm.prototype,"fields",void 0),u([p({constructOnly:!0,json:{write:!0}})],xm.prototype,"isAscending",void 0),u([p({constructOnly:!0,json:{write:!0}})],xm.prototype,"indexType",void 0),u([p({constructOnly:!0,json:{write:!0}})],xm.prototype,"isUnique",void 0),u([p({constructOnly:!0,json:{write:!0}})],xm.prototype,"description",void 0),xm=u([A("esri.layers.support.FeatureIndex")],xm);async function Eze(t,e,i){e=e.clone(),t.capabilities.query.supportsMaxRecordCountFactor&&(e.maxRecordCountFactor=Cze(t));const r=nNt(t),s=t.capabilities.query.supportsPagination;e.start=0,e.num=r;let n=null;for(;;){const o=await t.source.queryFeaturesJSON(e,i);if(n==null?n=o:n.features=n.features.concat(o.features),n.exceededTransferLimit=o.exceededTransferLimit,!s||!o.exceededTransferLimit)break;e.start+=r}return n}function nNt(t){return Cze(t)*oNt(t)}function oNt(t){return t.capabilities.query.maxRecordCount||2e3}function Cze(t){return t.capabilities.query.supportsMaxRecordCountFactor?ng.MAX_MAX_RECORD_COUNT_FACTOR:1}var _ee;let ER=_ee=class extends ee{constructor(t){super(t),this.minValue=0,this.maxValue=0}clone(){return new _ee({minValue:this.minValue,maxValue:this.maxValue})}};u([p({type:Number,json:{write:!0}})],ER.prototype,"minValue",void 0),u([p({type:Number,json:{write:!0}})],ER.prototype,"maxValue",void 0),ER=_ee=u([A("esri.renderers.support.AuthoringInfoClassBreakInfo")],ER);var bee;let D_=bee=class extends ee{constructor(t){super(t),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=new Array}clone(){return new bee({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:q(this.classBreakInfos)})}};u([p({type:String,json:{write:!0}})],D_.prototype,"field",void 0),u([p({type:String,json:{write:!0}})],D_.prototype,"normalizationField",void 0),u([p({type:String,json:{write:!0}})],D_.prototype,"label",void 0),u([p({type:[ER],json:{write:!0}})],D_.prototype,"classBreakInfos",void 0),D_=bee=u([A("esri.renderers.support.AuthoringInfoFieldInfo")],D_);var wee;let L2=wee=class extends ee{constructor(t){super(t),this.label=null,this.size=null,this.value=null}clone(){return new wee({label:this.label,value:this.value,size:this.size})}};u([p({type:String,json:{write:!0}})],L2.prototype,"label",void 0),u([p({type:Number,json:{write:!0}})],L2.prototype,"size",void 0),u([p({type:Number,json:{write:!0}})],L2.prototype,"value",void 0),L2=wee=u([A("esri.renderers.support.AuthoringInfoSizeStop")],L2);const aNt=L2;var xee;const Nk=new ni({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),Fk=new ni({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),dwe={key:t=>typeof t=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},pwe=["high-to-low","above-and-below","centered-on","extremes"],fwe=[...new Set(["high-to-low","above-and-below","centered-on","extremes","above","below","high-to-low","above-and-below","above","below","reference-size"])],mwe=["seconds","minutes","hours","days","months","years"],lNt=["circle","diamond","hexagon-flat","hexagon-pointy","square"];let ca=xee=class extends ee{constructor(t){super(t),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(t){return typeof t=="string"||typeof t=="number"?t:null}get normalizationField(){return this.theme==="reference-size"?this._get("normalizationField"):null}set normalizationField(t){this._set("normalizationField",t)}get referenceSizeScale(){return this.theme==="reference-size"?this._get("referenceSizeScale"):null}set referenceSizeScale(t){this._set("referenceSizeScale",t)}get referenceSizeSymbolStyle(){return this.theme==="reference-size"?this._get("referenceSizeSymbolStyle"):null}set referenceSizeSymbolStyle(t){this._set("referenceSizeSymbolStyle",t)}castStartTime(t){return typeof t=="string"||typeof t=="number"?t:null}get sizeStops(){return this.theme==="reference-size"?this._get("sizeStops"):null}set sizeStops(t){this._set("sizeStops",t)}get style(){return this.type==="color"?this._get("style"):null}set style(t){this._set("style",t)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(t){this._set("theme",t)}clone(){return new xee({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,normalizationField:this.normalizationField,referenceSizeScale:this.referenceSizeScale,referenceSizeSymbolStyle:this.referenceSizeSymbolStyle,sizeStops:q(this.sizeStops),startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};u([p({types:dwe,json:{write:!0}})],ca.prototype,"endTime",void 0),u([ti("endTime")],ca.prototype,"castEndTime",null),u([p({type:String,json:{write:!0}})],ca.prototype,"field",void 0),u([p({type:Number,json:{write:!0}})],ca.prototype,"maxSliderValue",void 0),u([p({type:Number,json:{write:!0}})],ca.prototype,"minSliderValue",void 0),u([p({type:String,json:{origins:{"web-scene":{write:!1}},write:!0}})],ca.prototype,"normalizationField",null),u([p({type:Number,value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],ca.prototype,"referenceSizeScale",null),u([p({type:lNt,value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],ca.prototype,"referenceSizeSymbolStyle",null),u([p({types:dwe,json:{write:!0}})],ca.prototype,"startTime",void 0),u([ti("startTime")],ca.prototype,"castStartTime",null),u([p({type:[aNt],json:{origins:{"web-scene":{write:!1}},write:!0}})],ca.prototype,"sizeStops",null),u([p({type:Nk.apiValues,value:null,json:{type:Nk.jsonValues,read:Nk.read,write:Nk.write}})],ca.prototype,"style",null),u([p({type:fwe,value:null,json:{type:fwe,origins:{"web-scene":{type:pwe,write:{writer:(t,e)=>{pwe.includes(t)&&(e.theme=t)}}}},write:!0}})],ca.prototype,"theme",null),u([p({type:Fk.apiValues,json:{type:Fk.jsonValues,read:Fk.read,write:Fk.write}})],ca.prototype,"type",void 0),u([p({type:mwe,json:{type:mwe,write:!0}})],ca.prototype,"units",void 0),ca=xee=u([A("esri.renderers.support.AuthoringInfoVisualVariable")],ca);const cNt=ca;let Az=class extends ee{constructor(e){super(e),this.type=null}};u([p({readOnly:!0,json:{read:!1,write:!0}})],Az.prototype,"type",void 0),Az=u([A("esri.rest.support.ColorRamp")],Az);const rle=Az;var See;let ex=See=class extends rle{constructor(t){super(t),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new See({fromColor:q(this.fromColor),toColor:q(this.toColor),algorithm:this.algorithm})}};u([Ve({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],ex.prototype,"algorithm",void 0),u([p({type:Je,json:{type:[Ii],write:!0}})],ex.prototype,"fromColor",void 0),u([p({type:Je,json:{type:[Ii],write:!0}})],ex.prototype,"toColor",void 0),u([p({type:["algorithmic"]})],ex.prototype,"type",void 0),ex=See=u([A("esri.rest.support.AlgorithmicColorRamp")],ex);const sle=ex;var Tee;let CR=Tee=class extends rle{constructor(t){super(t),this.colorRamps=null,this.type="multipart"}clone(){return new Tee({colorRamps:q(this.colorRamps)})}};u([p({type:[sle],json:{write:!0}})],CR.prototype,"colorRamps",void 0),u([p({type:["multipart"]})],CR.prototype,"type",void 0),CR=Tee=u([A("esri.rest.support.MultipartColorRamp")],CR);const $ze=CR,uNt={key:"type",base:rle,typeMap:{algorithmic:sle,multipart:$ze}};function hNt(t){return t!=null&&t.type?t.type==="algorithmic"?sle.fromJSON(t):t.type==="multipart"?$ze.fromJSON(t):null:null}var Eee;const t1=new ni({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),kk=new ni({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),gwe=new ni({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),ywe=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers"],dNt=["high-to-low","above-and-below","above","below"],pNt=["flow-line","wave-front"],fNt=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let hn=Eee=class extends ee{constructor(t){super(t),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const t=this._get("classificationMethod"),e=this.type;return e&&e!=="relationship"?e==="class-breaks-size"||e==="class-breaks-color"?t||"manual":null:t}set classificationMethod(t){this._set("classificationMethod",t)}readColorRamp(t){return t?hNt(t):void 0}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(t){this._set("fields",t)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(t){this._set("field1",t)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(t){this._set("field2",t)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(t){this._set("flowTheme",t)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(t){this._set("focus",t)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(t){this._set("numClasses",t)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(t){this._set("statistics",t)}get standardDeviationInterval(){const t=this.type;return t&&t!=="relationship"&&t!=="class-breaks-size"&&t!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(t){this._set("standardDeviationInterval",t)}get type(){return this._get("type")}set type(t){let e=t;t==="classed-size"?e="class-breaks-size":t==="classed-color"&&(e="class-breaks-color"),this._set("type",e)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(t){this._set("univariateSymbolStyle",t)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(t){this._set("univariateTheme",t)}clone(){var t;return new Eee({classificationMethod:this.classificationMethod,colorRamp:q(this.colorRamp),fadeRatio:q(this.fadeRatio),fields:(t=this.fields)==null?void 0:t.slice(),field1:q(this.field1),field2:q(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(e=>e.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};u([p({type:t1.apiValues,value:null,json:{type:t1.jsonValues,read:t1.read,write:t1.write,origins:{"web-document":{default:"manual",type:t1.jsonValues,read:t1.read,write:t1.write}}}})],hn.prototype,"classificationMethod",null),u([p({types:uNt,json:{write:!0}})],hn.prototype,"colorRamp",void 0),u([ve("colorRamp")],hn.prototype,"readColorRamp",null),u([p({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],hn.prototype,"fadeRatio",void 0),u([p({type:[String],value:null,json:{write:!0}})],hn.prototype,"fields",null),u([p({type:D_,value:null,json:{write:!0}})],hn.prototype,"field1",null),u([p({type:D_,value:null,json:{write:!0}})],hn.prototype,"field2",null),u([p({type:pNt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],hn.prototype,"flowTheme",null),u([p({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],hn.prototype,"focus",null),u([p({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],hn.prototype,"isAutoGenerated",void 0),u([p({type:Number,value:null,json:{type:Ii,write:!0}})],hn.prototype,"numClasses",null),u([p({type:ywe,json:{type:ywe,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],hn.prototype,"lengthUnit",void 0),u([p({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],hn.prototype,"maxSliderValue",void 0),u([p({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],hn.prototype,"minSliderValue",void 0),u([p({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],hn.prototype,"statistics",null),u([p({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],hn.prototype,"standardDeviationInterval",null),u([p({type:kk.apiValues,value:null,json:{type:kk.jsonValues,read:kk.read,write:kk.write,origins:{"web-scene":{type:gwe.jsonValues,write:{writer:gwe.write,overridePolicy:t=>({enabled:t!=="flow"})}}}}})],hn.prototype,"type",null),u([p({type:[cNt],json:{write:!0}})],hn.prototype,"visualVariables",void 0),u([p({type:fNt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],hn.prototype,"univariateSymbolStyle",null),u([p({type:dNt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],hn.prototype,"univariateTheme",null),hn=Eee=u([A("esri.renderers.support.AuthoringInfo")],hn);const nle=hn,N7=new ni({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let $R=class extends ee{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const i=new Set;return await this.collectRequiredFields(i,e),Array.from(i).sort()}getSymbol(e,i){}async getSymbolAsync(e,i){}get symbols(){return[]}get arcadeRequired(){return!1}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};u([p({type:nle,json:{write:!0}})],$R.prototype,"authoringInfo",void 0),u([p({type:N7.apiValues,readOnly:!0,json:{type:N7.jsonValues,read:!1,write:{writer:N7.write,ignoreOrigin:!0,isRequired:!0}}})],$R.prototype,"type",void 0),$R=u([A("esri.renderers.Renderer")],$R);const Kv=$R;let AR=class extends Nt.ClonableMixin(ee){constructor(){super(...arguments),this.showLegend=null,this.title=null}};u([p({type:Boolean,json:{write:!0}})],AR.prototype,"showLegend",void 0),u([p({type:String,json:{write:!0}})],AR.prototype,"title",void 0),AR=u([A("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],AR);const Aze=AR,F7=new ni({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let Cp=class extends ee{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(J.getLogger(this).error(".field: field must be a string value"),null):DD(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};u([p()],Cp.prototype,"index",void 0),u([p({type:F7.apiValues,readOnly:!0,json:{read:F7.read,write:{writer:F7.write,isRequired:!0}}})],Cp.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],Cp.prototype,"field",void 0),u([ti("field")],Cp.prototype,"castField",null),u([p({type:String,json:{write:!0}})],Cp.prototype,"valueExpression",void 0),u([p({type:String,json:{write:!0}})],Cp.prototype,"valueExpressionTitle",void 0),u([p({readOnly:!0})],Cp.prototype,"arcadeRequired",null),u([p({type:Aze,json:{write:!0}})],Cp.prototype,"legendOptions",void 0),Cp=u([A("esri.renderers.visualVariables.VisualVariable")],Cp);const TM=Cp;var Cee;let tx=Cee=class extends ee{constructor(t){super(t),this.color=null,this.label=null,this.value=null}writeValue(t,e,i){e[i]=t??0}clone(){return new Cee({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};u([p({type:Je,json:{type:[Ii],write:{isRequired:!0}}})],tx.prototype,"color",void 0),u([p({type:String,json:{write:!0}})],tx.prototype,"label",void 0),u([p({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],tx.prototype,"value",void 0),u([_e("value")],tx.prototype,"writeValue",null),tx=Cee=u([A("esri.renderers.visualVariables.support.ColorStop")],tx);const mNt=tx;var $ee;let ix=$ee=class extends TM{constructor(t){super(t),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value),this._set("stops",t)}clone(){var t;return new $ee({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:(t=this.legendOptions)==null?void 0:t.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([p({readOnly:!0})],ix.prototype,"cache",null),u([p({type:["color"],json:{type:["colorInfo"]}})],ix.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],ix.prototype,"normalizationField",void 0),u([p({type:[mNt],json:{write:!0}})],ix.prototype,"stops",null),ix=$ee=u([A("esri.renderers.visualVariables.ColorVariable")],ix);const Mze=ix;var Aee;let p_=Aee=class extends ee{constructor(t){super(t),this.label=null,this.opacity=null,this.value=null}readOpacity(t,e){return X$(e.transparency)}writeOpacity(t,e,i){e[i]=eL(t)}clone(){return new Aee({label:this.label,opacity:this.opacity,value:this.value})}};u([p({type:String,json:{write:!0}})],p_.prototype,"label",void 0),u([p({type:Number,json:{type:Ii,write:{target:"transparency",isRequired:!0}}})],p_.prototype,"opacity",void 0),u([ve("opacity",["transparency"])],p_.prototype,"readOpacity",null),u([_e("opacity")],p_.prototype,"writeOpacity",null),u([p({type:Number,json:{write:{isRequired:!0}}})],p_.prototype,"value",void 0),p_=Aee=u([A("esri.renderers.visualVariables.support.OpacityStop")],p_);const gNt=p_;var Mee;let rx=Mee=class extends TM{constructor(t){super(t),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value),this._set("stops",t)}clone(){var t;return new Mee({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:(t=this.legendOptions)==null?void 0:t.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([p({readOnly:!0})],rx.prototype,"cache",null),u([p({type:["opacity"],json:{type:["transparencyInfo"]}})],rx.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],rx.prototype,"normalizationField",void 0),u([p({type:[gNt],json:{write:!0}})],rx.prototype,"stops",null),rx=Mee=u([A("esri.renderers.visualVariables.OpacityVariable")],rx);const ole=rx;var Oee;let sx=Oee=class extends TM{constructor(t){super(t),this.axis=null,this.type="rotation",this.rotationType="geographic"}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}clone(){var t;return new Oee({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:(t=this.legendOptions)==null?void 0:t.clone()})}};u([p({readOnly:!0})],sx.prototype,"cache",null),u([p({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],sx.prototype,"axis",void 0),u([p({type:["rotation"],json:{type:["rotationInfo"]}})],sx.prototype,"type",void 0),u([p({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],sx.prototype,"rotationType",void 0),sx=Oee=u([A("esri.renderers.visualVariables.RotationVariable")],sx);const Oze=sx;function yNt(t){return or(t)}var Iee;let f_=Iee=class extends ee{constructor(t){super(t),this.label=null,this.size=null,this.value=null,this.useMinValue=null,this.useMaxValue=null}clone(){return new Iee({label:this.label,size:this.size,value:this.value,useMaxValue:this.useMaxValue,useMinValue:this.useMinValue})}};u([p({type:String,json:{write:!0}})],f_.prototype,"label",void 0),u([p({type:Number,cast:or,json:{write:{isRequired:!0}}})],f_.prototype,"size",void 0),u([p({type:Number,json:{write:{isRequired:!0}}})],f_.prototype,"value",void 0),u([p({type:Boolean,json:{write:!1}})],f_.prototype,"useMinValue",void 0),u([p({type:Boolean,json:{write:!1}})],f_.prototype,"useMaxValue",void 0),f_=Iee=u([A("esri.renderers.visualVariables.support.SizeStop")],f_);const Mz=f_;let Oz=class extends Aze{constructor(){super(...arguments),this.customValues=null}};u([p({type:[Number],json:{write:!0}})],Oz.prototype,"customValues",void 0),Oz=u([A("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],Oz);const vNt=Oz;var Ree;const zk=new ni({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),Pee=new ni({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers"});function vwe(t){if(t!=null)return typeof t=="string"||typeof t=="number"?yNt(t):t.type==="size"?lC(t)?t:(delete(t={...t}).type,new Dr(t)):void 0}function _we(t,e,i){if(typeof t!="object")return t;const r=new Dr;return r.read(t,i),r}let Dr=Ree=class extends TM{constructor(t){super(t),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:this.valueExpression!=null&&vPe.test(this.valueExpression)}}set index(t){lC(this.maxSize)&&(this.maxSize.index=`visualVariables[${t}].maxSize`),lC(this.minSize)&&(this.minSize.index=`visualVariables[${t}].minSize`),this._set("index",t)}get inputValueType(){return gPe(this)}set maxDataValue(t){t&&this.stops&&(J.getLogger(this).warn("cannot set maxDataValue when stops is not null."),t=null),this._set("maxDataValue",t)}set maxSize(t){t&&this.stops&&(J.getLogger(this).warn("cannot set maxSize when stops is not null."),t=null),this._set("maxSize",t)}castMaxSize(t){return vwe(t)}readMaxSize(t,e,i){return _we(t,e,i)}set minDataValue(t){t&&this.stops&&(J.getLogger(this).warn("cannot set minDataValue when stops is not null."),t=null),this._set("minDataValue",t)}set minSize(t){t&&this.stops&&(J.getLogger(this).warn("cannot set minSize when stops is not null."),t=null),this._set("minSize",t)}castMinSize(t){return vwe(t)}readMinSize(t,e,i){return _we(t,e,i)}get arcadeRequired(){return!!this.valueExpression||this.minSize!=null&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize!=null&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(t){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value):t&&(J.getLogger(this).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),t=null),this._set("stops",t)}get transformationType(){return lut(this,this.inputValueType)}readValueExpression(t,e){return t||e.expression&&"$view.scale"}writeValueExpressionWebScene(t,e,i,r){if(t==="$view.scale"){if(r!=null&&r.messages){const s=this.index,n=typeof s=="string"?s:`visualVariables[${s}]`;r.messages.push(new U("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpression",context:r}))}}else e[i]=t}readValueUnit(t){return t?Pee.read(t):null}clone(){var t,e;return new Ree({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:lC(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:lC(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:(t=this.stops)==null?void 0:t.map(i=>i.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:(e=this.legendOptions)==null?void 0:e.clone()})}flipSizes(){if(this.transformationType===Wo.ClampedLinear){const{minSize:t,maxSize:e}=this;return this.minSize=e,this.maxSize=t,this}if(this.transformationType===Wo.Stops){const t=this.stops;if(!t)return this;const e=t.map(r=>r.size).reverse(),i=t.length;for(let r=0;r<i;r++)t[r].size=e[r];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){var t;return(t=this.stops)==null?void 0:t.map(e=>e.value||0)}};u([p({readOnly:!0})],Dr.prototype,"cache",null),u([p({type:zk.apiValues,json:{type:zk.jsonValues,origins:{"web-map":{read:!1}},read:zk.read,write:zk.write}})],Dr.prototype,"axis",void 0),u([p()],Dr.prototype,"index",null),u([p({type:String,readOnly:!0})],Dr.prototype,"inputValueType",null),u([p({type:vNt,json:{write:!0}})],Dr.prototype,"legendOptions",void 0),u([p({type:Number,value:null,json:{write:!0}})],Dr.prototype,"maxDataValue",null),u([p({type:Number,value:null,json:{write:!0}})],Dr.prototype,"maxSize",null),u([ti("maxSize")],Dr.prototype,"castMaxSize",null),u([ve("maxSize")],Dr.prototype,"readMaxSize",null),u([p({type:Number,value:null,json:{write:!0}})],Dr.prototype,"minDataValue",null),u([p({type:Number,value:null,json:{write:!0}})],Dr.prototype,"minSize",null),u([ti("minSize")],Dr.prototype,"castMinSize",null),u([ve("minSize")],Dr.prototype,"readMinSize",null),u([p({type:String,json:{write:!0}})],Dr.prototype,"normalizationField",void 0),u([p({readOnly:!0})],Dr.prototype,"arcadeRequired",null),u([p({type:String})],Dr.prototype,"scaleBy",void 0),u([p({type:[Mz],value:null,json:{write:!0}})],Dr.prototype,"stops",null),u([p({type:["outline"],json:{write:!0}})],Dr.prototype,"target",void 0),u([p({type:String,readOnly:!0})],Dr.prototype,"transformationType",null),u([p({type:["size"],json:{type:["sizeInfo"]}})],Dr.prototype,"type",void 0),u([p({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],Dr.prototype,"useSymbolValue",void 0),u([p({type:String,json:{write:!0}})],Dr.prototype,"valueExpression",void 0),u([ve("valueExpression",["valueExpression","expression"])],Dr.prototype,"readValueExpression",null),u([_e("web-scene","valueExpression")],Dr.prototype,"writeValueExpressionWebScene",null),u([p({type:["radius","diameter","area","width","distance"],json:{write:!0}})],Dr.prototype,"valueRepresentation",void 0),u([p({type:Pee.apiValues,json:{write:Pee.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],Dr.prototype,"valueUnit",void 0),u([ve("valueUnit")],Dr.prototype,"readValueUnit",null),Dr=Ree=u([A("esri.renderers.visualVariables.SizeVariable")],Dr);const rH=Dr,_Nt={color:Mze,size:rH,opacity:ole,rotation:Oze},bNt=new ni({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),wNt=/^\[([^\]]+)\]$/i;let Iz=class extends he{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),e=e==null?void 0:e.filter(i=>!!i),e==null?void 0:e.length){for(const i of e)switch(i.type){case"color":this.colorVariables.push(i);break;case"opacity":this.opacityVariables.push(i);break;case"rotation":this.rotationVariables.push(i);break;case"size":this.sizeVariables.push(i)}this.sizeVariables.length&&this.sizeVariables.some(i=>!!i.target)&&e.sort((i,r)=>{let s=null;return s=i.target===r.target?0:i.target?1:-1,s});for(let i=0;i<e.length;i++)e[i].index=i;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,i,r){const{rotationExpression:s,rotationType:n}=i,o=s==null?void 0:s.match(wNt),a=o==null?void 0:o[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:n,field:a})),e)return e.map(l=>{const c=bNt.read(l.type),h=_Nt[c];h||(J.getLogger(this).warn(`Unknown variable type: ${c}`),r!=null&&r.messages&&r.messages.push(new ch("visual-variable:unsupported",`visualVariable of type '${c}' is not supported`,{definition:l,context:r})));const d=new h;return d.read(l,r),d})}writeVariables(e,i){const r=[];for(const s of e){const n=s.toJSON(i);n&&r.push(n)}return r}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};u([p()],Iz.prototype,"visualVariables",null),Iz=u([A("esri.renderers.visualVariables.VisualVariableFactory")],Iz);const xNt=Iz,SNt={base:TM,key:"type",typeMap:{opacity:ole,color:Mze,rotation:Oze,size:rH}},EM=t=>{let e=class extends t{constructor(){super(...arguments),this._vvFactory=new xNt}set visualVariables(i){this._vvFactory.visualVariables=i,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(i,r,s){return this._vvFactory.readVariables(i,r,s)}writeVisualVariables(i,r,s,n){r[s]=this._vvFactory.writeVariables(i,n)}get arcadeRequiredForVisualVariables(){var i;return((i=this.visualVariables)==null?void 0:i.some(({arcadeRequired:r})=>r))??!1}hasVisualVariables(i,r){return i?this.getVisualVariablesForType(i,r).length>0:this.getVisualVariablesForType("size",r).length>0||this.getVisualVariablesForType("color",r).length>0||this.getVisualVariablesForType("opacity",r).length>0||this.getVisualVariablesForType("rotation",r).length>0}getVisualVariablesForType(i,r){var s;return((s=this.visualVariables)==null?void 0:s.filter(n=>n.type===i&&(typeof r=="string"?n.target===r:r!==!1||!n.target)))??[]}async collectVVRequiredFields(i,r){let s=[];this.visualVariables&&(s=s.concat(this.visualVariables));for(const n of s)n&&(n.field&&dc(i,r,n.field),n.normalizationField&&dc(i,r,n.normalizationField),n.valueExpression&&(TNt(n.valueExpression,i,r)||await Rl(i,r,n.valueExpression)))}};return u([p({types:[SNt],value:null,json:{write:!0}})],e.prototype,"visualVariables",null),u([ve("visualVariables",["visualVariables","rotationType","rotationExpression"])],e.prototype,"readVisualVariables",null),u([_e("visualVariables")],e.prototype,"writeVisualVariables",null),e=u([A("esri.renderers.mixins.VisualVariablesMixin")],e),e};function TNt(t,e,i){const r=dXe(t);return r!=null&&(dc(e,i,r),!0)}const ale=[252,146,31,255],ENt=[153,153,153,255],CNt={type:"esriSMS",style:"esriSMSCircle",size:6,color:ale,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},$Nt={type:"esriSLS",style:"esriSLSSolid",width:.75,color:ale},ANt={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},MNt={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},ONt={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},INt={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},RNt={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},bV=_g.fromJSON(CNt),lle=mh.fromJSON($Nt),Ize=rT.fromJSON(ANt),PNt=lM.fromJSON(MNt);function kpi(t){if(t==null)return null;switch(t.type){case"mesh":return null;case"point":case"multipoint":return bV;case"polyline":return lle;case"polygon":case"extent":return Ize}return null}const zpi=_g.fromJSON(ONt),Upi=mh.fromJSON(INt),Bpi=rT.fromJSON(RNt),DNt=Rm.fromSimpleMarkerSymbol(bV),LNt=iT.fromSimpleLineSymbol(lle),NNt=aw.fromSimpleFillSymbol(Ize),FNt=new sL({symbolLayers:new Ce([new eT({material:{color:ale},edges:new _Ae({size:Rd(1),color:new Je(ENt)})})])}),kNt=new iT({symbolLayers:new Ce([new aM({material:{color:new Je([0,0,0])},size:Rd(1)})])}),zNt=new aw({symbolLayers:new Ce([new eT({outline:{color:new Je([0,0,0]),size:Rd(1)}})])});function Vpi(t){if(t==null)return null;switch(t.type){case"mesh":return FNt;case"point":case"multipoint":return DNt;case"polyline":return LNt;case"polygon":case"extent":return NNt}return null}const bwe="#useCIMFallbackSymbology()",xE={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function UNt(t,e=xE){var l,c,h,d;if(!t)return{symbol:null};const{retainId:i=xE.retainId,ignoreDrivers:r=xE.ignoreDrivers,hasLabelingContext:s=xE.hasLabelingContext,retainCIM:n=xE.retainCIM,cimFallbackEnabled:o=xE.cimFallbackEnabled}=e;let a=null;if(tMe(t)||t instanceof Vb)a=t.clone();else if(t.type==="cim"){const f=(c=(l=t.data)==null?void 0:l.symbol)==null?void 0:c.type;switch(f){case"CIMPointSymbol":a=n?t.clone():Rm.fromCIMSymbol(t);break;case"CIMLineSymbol":o&&(a=kNt.clone(),(h=e==null?void 0:e.logWarning)==null||h.call(e,bwe,"Unsupported CIM line symbology converted to fallback 3D line symbology"));break;case"CIMPolygonSymbol":o&&(a=zNt.clone(),(d=e==null?void 0:e.logWarning)==null||d.call(e,bwe,"Unsupported CIM polygon symbology converted to fallback 3D polygon symbology"))}if(!a)return{error:new U("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${f||"unknown"}' is unsupported in 3D`,{symbol:t})}}else if(t instanceof mh)a=iT.fromSimpleLineSymbol(t);else if(t instanceof _g)a=Rm.fromSimpleMarkerSymbol(t);else if(t instanceof nL)a=Rm.fromPictureMarkerSymbol(t);else if(t instanceof rT)a=e.geometryType&&e.geometryType==="mesh"?sL.fromSimpleFillSymbol(t):aw.fromSimpleFillSymbol(t);else{if(!(t instanceof lM))return{error:new U("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};a=s?xG.fromTextSymbol(t):Rm.fromTextSymbol(t)}return i&&a&&a.type!=="cim"&&(a.id=t.id),!r||a.type==="cim"||a instanceof Vb||a.symbolLayers.forEach(f=>f.ignoreDrivers=!0),{symbol:a}}function wV(t,e,i,r){const s=Rze(t,{},{context:r,isLabelSymbol:!1});s!=null&&(e[i]=s)}function wwe(t,e,i,r){const s=Rze(t,{},{context:r,isLabelSymbol:!0});s!=null&&(e[i]=s)}function xwe(t){return tMe(t)||t instanceof Vb}function BNt(t){return(t==null?void 0:t.type)==="polygon-3d"||(t==null?void 0:t.type)==="line-3d"}function Rze(t,e,i){var a;if(t==null)return null;const{context:r,isLabelSymbol:s}=i,n=r==null?void 0:r.origin,o=r==null?void 0:r.messages;if(n==="web-scene"&&!xwe(t)){const l=UNt(t,{retainCIM:!0,hasLabelingContext:s});return l.symbol!=null?l.symbol.write(e,r):(o==null||o.push(new U("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:r,error:l.error})),null)}return VZ(r==null?void 0:r.layer)&&BNt(t)?(o==null||o.push(new U("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported on layers of type '${(a=r==null?void 0:r.layer)==null?void 0:a.declaredClass}'.`,{symbol:t,context:r})),null):(n==="web-map"||n==="portal-item"&&!VZ(r==null?void 0:r.layer))&&xwe(t)?(o==null||o.push(new U("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:r})),null):t.write(e,r)}function jpi(t,e){return fQe(t,null,e)}const sH={types:iMe,json:{write:{writer:wV},origins:{"web-scene":{types:lde,write:{writer:wV},read:{reader:qA({types:lde})}}}}},cle=eie({json:{origins:{"web-scene":{write:{isRequired:!0}}}}},sH),ule={types:{base:Qa,key:"type",typeMap:{"simple-fill":nb.typeMap["simple-fill"],"picture-fill":nb.typeMap["picture-fill"],"polygon-3d":nb.typeMap["polygon-3d"],cim:nb.typeMap.cim}},json:{write:{writer:wV},origins:{"web-scene":{type:aw,write:{writer:wV}}}}},Rz={cast:t=>t==null||typeof t=="string"||typeof t=="number"?t:`${t}`,json:{type:String,write:{writer:(t,e)=>{e.value=t==null?void 0:t.toString()}}}};var Dee;let nx=Dee=class extends EM(Kv){constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(t,e){await Promise.all([this.collectSymbolFields(t,e),this.collectVVRequiredFields(t,e)])}async collectSymbolFields(t,e){await Promise.all(this.symbols.map(i=>i.collectRequiredFields(t,e)))}getSymbol(t,e){return this.symbol}async getSymbolAsync(t,e){return this.symbol}get symbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){var t;return((t=this.visualVariables)==null?void 0:t.reduce((e,i)=>e+i.getAttributeHash(),""))??""}getMeshHash(){return this.symbols.reduce((t,e)=>t+JSON.stringify(e),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new Dee({description:this.description,label:this.label,symbol:q(this.symbol),visualVariables:q(this.visualVariables),authoringInfo:q(this.authoringInfo)})}};u([p({type:String,json:{write:!0}})],nx.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],nx.prototype,"label",void 0),u([p(cle)],nx.prototype,"symbol",void 0),u([Ve({simple:"simple"})],nx.prototype,"type",void 0),nx=Dee=u([A("esri.renderers.SimpleRenderer")],nx);const pv=nx,VNt=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function Lee(t){return t instanceof he}function Swe(t){return t instanceof Ce?Object.keys(t.items):Lee(t)?Ml(t).keys():t?Object.keys(t):[]}function Uk(t,e){return t instanceof Ce?t.items[e]:t[e]}function jNt(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.length!==e.length}function LP(t){return t?t.declaredClass:null}function Pze(t,e){var d;const i=t.diff;if(i&&typeof i=="function")return i(t,e);const r=Swe(t),s=Swe(e);if(r.length===0&&s.length===0)return;if(!r.length||!s.length||jNt(t,e))return{type:"complete",oldValue:t,newValue:e};const n=s.filter(f=>!r.includes(f)),o=r.filter(f=>!s.includes(f)),a=r.filter(f=>s.includes(f)&&Uk(t,f)!==Uk(e,f)).concat(n,o).sort(),l=LP(t);if(l&&VNt.has(l)&&a.length)return{type:"complete",oldValue:t,newValue:e};let c;const h=Lee(t)&&Lee(e);for(const f of a){const m=Uk(t,f),g=Uk(e,f);let v;if((h||typeof m!="function"&&typeof g!="function")&&m!==g&&(m!=null||g!=null)){if(i&&i[f]&&typeof i[f]=="function")v=(d=i[f])==null?void 0:d.call(i,m,g);else if(m instanceof Date&&g instanceof Date){if(m.getTime()===g.getTime())continue;v={type:"complete",oldValue:m,newValue:g}}else v=typeof m=="object"&&typeof g=="object"&&LP(m)===LP(g)?Pze(m,g):{type:"complete",oldValue:m,newValue:g};v!=null&&(c!=null?c.diff[f]=v:c={type:"partial",diff:{[f]:v}})}}return c}function Gpi(t,e){return GNt(t,e)}function GNt(t,e){if(t==null)return!1;const i=e.split(".");let r=t;for(const s of i){if(r.type==="complete")return!0;if(r.type!=="partial")return!1;{const n=r.diff[s];if(!n)return!1;r=n}}return!0}function Hpi(t,e){if(!t)return!1;if(t.type==="partial"){const i=Object.keys(t.diff);return i.length===1&&i[0]===e}return!1}function HNt(t,e){if(typeof t!="function"&&typeof e!="function"&&(t!=null||e!=null))return t==null||e==null||typeof t=="object"&&typeof e=="object"&&LP(t)!==LP(e)?{type:"complete",oldValue:t,newValue:e}:Pze(t,e)}function Bk(t){if(t==null)return!0;switch(t.type){case"complete":return!1;case"collection":{const e=t;for(const i of e.added)if(!Bk(i))return!1;for(const i of e.removed)if(!Bk(i))return!1;for(const i of e.changed)if(!Bk(i))return!1;return!0}case"partial":for(const e in t.diff)if(!Bk(t.diff[e]))return!1;return!0}}var Nee;const qNt=Oo()({ascendingValues:"ascending-values",descendingValues:"descending-values"});let MR=Nee=class extends Nt.ClonableMixin(ee){static from(t){return GA(Nee,t)}constructor(t){super(t),this.title=null,this.order=null}};u([p({type:String,json:{write:!0}})],MR.prototype,"title",void 0),u([Ve(qNt)],MR.prototype,"order",void 0),MR=Nee=u([A("esri.renderers.support.RendererLegendOptions")],MR);const hle=MR;let N2=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};u([p(Rz)],N2.prototype,"value",void 0),u([p(Rz)],N2.prototype,"value2",void 0),u([p(Rz)],N2.prototype,"value3",void 0),N2=u([A("esri.renderers.support.UniqueValue")],N2);const d$=N2;let m_=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(e==null)return null;const i=typeof(e=Array.isArray(e)?e:[e])[0];return i==="string"||i==="number"?e.map(r=>new d$({value:r})):i==="object"?e[0]instanceof d$?e:e.map(r=>new d$(r)):null}};u([p({type:String,json:{write:!0}})],m_.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],m_.prototype,"label",void 0),u([p(sH)],m_.prototype,"symbol",void 0),u([p({type:[d$],json:{type:[[String]],read:{reader:t=>t?t.map(e=>new d$({value:e[0],value2:e[1],value3:e[2]})):null},write:{writer:(t,e)=>{const i=[];for(const r of t){const s=[r.value,r.value2,r.value3].filter(df).map(n=>n.toString());i.push(s)}e.values=i}}}})],m_.prototype,"values",void 0),u([ti("values")],m_.prototype,"castValues",null),m_=u([A("esri.renderers.support.UniqueValueClass")],m_);const Dze=m_;let OR=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.heading=null,this.classes=null}};u([p({type:String,json:{write:!0}})],OR.prototype,"heading",void 0),u([p({type:[Dze],json:{write:{isRequired:!0}}})],OR.prototype,"classes",void 0),OR=u([A("esri.renderers.support.UniqueValueGroup")],OR);const Fee=OR;var kee;let ox=kee=class extends ee{constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new kee({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){var e;const t=JSON.stringify((e=this.symbol)==null?void 0:e.toJSON());return`${this.value}.${t}`}};u([p({type:String,json:{write:!0}})],ox.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],ox.prototype,"label",void 0),u([p(cle)],ox.prototype,"symbol",void 0),u([p(Rz)],ox.prototype,"value",void 0),ox=kee=u([A("esri.renderers.support.UniqueValueInfo")],ox);const NP=ox,Twe=new Map;async function WNt(t,e){try{return{data:(await XNt(t,e)).data,baseUrl:z6e(t),styleUrl:t}}catch(i){return Wc(i),null}}function ZNt(t,e,i){var l;const r=e.portal!=null?e.portal:vn.getDefault();let s;const n=`${r.url} - ${(l=r.user)==null?void 0:l.username} - ${t}`,o=Twe.get(n);if(o)return o;const a=YNt(t,r,i).then(c=>(s=c,c.fetchData())).then(c=>({data:c,baseUrl:s.itemUrl??"",styleName:t}));return Twe.set(n,a),a}function YNt(t,e,i){return e.load(i).then(()=>{const r=new Zp({disableExtraQuery:!0,query:`owner:${Ewe} AND type:${Cwe} AND typekeywords:"${t}"`});return e.queryItems(r,i)}).then(({results:r})=>{var o;let s=null;const n=t.toLowerCase();if(r&&Array.isArray(r)){for(const a of r)if(((o=a.typeKeywords)==null?void 0:o.some(c=>c.toLowerCase()===n))&&a.type===Cwe&&a.owner===Ewe){s=a;break}}if(!s)throw new U("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return s.load(i)})}function JNt(t,e,i){return(t==null?void 0:t.styleUrl)!=null?WNt(t.styleUrl,i):(t==null?void 0:t.styleName)!=null?ZNt(t.styleName,e,i):Promise.reject(new U("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function Ypi(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function Jpi(t,e){for(const i of e)switch(i){case"cim":if(t.cimRef)return{format:i,url:encodeURI(t.cimRef)};break;case"web-gltf-basisu":{const r=k7(t,"gltf_basisu");if(r)return{format:i,url:r};break}case"web-gltf":{const r=k7(t,"gltf");if(r)return{format:i,url:r};break}case"web":{const r=k7(t,"gltf");if(r)return{format:"web-gltf",url:r};if(t.webRef)return{format:i,url:encodeURI(t.webRef)};break}}}function k7(t,e){var i,r;if(!X("enable-feature:force-wosr"))return(r=(i=t.formatInfos)==null?void 0:i.find(s=>s.type===e))==null?void 0:r.href}function XNt(t,e){const i={responseType:"json",query:{f:"json"},...e};return Ri(Ed(t),i)}const Ewe="esri_en",Cwe="Style",Xpi="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";var IR;const Lze="esri.renderers.UniqueValueRenderer",D0=()=>J.getLogger(Lze),$we="uvInfos-watcher",Awe="uvGroups-watcher",KNt=",",QNt=Ds(NP);function eFt(t){const{field1:e,field2:i,field3:r,fieldDelimiter:s,uniqueValueInfos:n,valueExpression:o}=t,a=!(!e||!i);return[{classes:(n??[]).map(l=>{var b;const{symbol:c,label:h,value:d,description:f}=l,[m,g,v]=a?((b=d==null?void 0:d.toString())==null?void 0:b.split(s||""))||[]:[d],_=[];return(e||o)&&_.push(m),i&&_.push(g),r&&_.push(v),{symbol:c,label:h,values:[_],description:f}})}]}function SE(t){return t!=null&&t!==""&&(typeof t!="string"||t.trim()!==""&&t.toLowerCase()!=="<null>")||(t=null),t+""}let Bs=IR=class extends EM(Kv){constructor(t){super(t),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,i){if(!e&&!i)return;if(!e||!i)return{type:"complete",oldValue:e,newValue:i};let r=!1;const s={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<i.length;n++){const o=e.find(a=>a.value===i[n].value);o?HNt(o,i[n])?(s.changed.push({type:"complete",oldValue:o,newValue:i[n]}),r=!0):s.unchanged.push({oldValue:o,newValue:i[n]}):(s.added.push(i[n]),r=!0)}for(let n=0;n<e.length;n++)i.find(o=>o.value===e[n].value)||(s.removed.push(e[n]),r=!0);return r?s:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(t){this._set("field",t),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(t){return t==null||typeof t=="function"?t:DD(t)}writeField(t,e,i,r){typeof t=="string"?e[i]=t:r!=null&&r.messages?r.messages.push(new U("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):D0().error(".field: cannot write field to JSON since it's not a string value")}set field2(t){this._set("field2",t),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(t){this._set("field3",t),this._updateUniqueValues()}set valueExpression(t){this._set("valueExpression",t),this._updateUniqueValues()}set defaultSymbol(t){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",t)}set fieldDelimiter(t){this._set("fieldDelimiter",t),this._updateUniqueValues()}readPortal(t,e,i){return i.portal||vn.getDefault()}readStyleOrigin(t,e,i){if(e.styleName)return Object.freeze({styleName:e.styleName});if(e.styleUrl){const r=XA(e.styleUrl,i);return Object.freeze({styleUrl:r})}}writeStyleOrigin(t,e,i,r){t.styleName?e.styleName=t.styleName:t.styleUrl&&(e.styleUrl=BD(t.styleUrl,r))}set uniqueValueGroups(t){this.styleOrigin?D0().error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",t),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(t){this.styleOrigin?D0().error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(t,e){var r;if(this.styleOrigin)return void D0().error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let i;i=typeof t=="object"?QNt(t):new NP({value:t,symbol:rMe(e)}),(r=this.uniqueValueInfos)==null||r.push(i),this._valueInfoMap[SE(i.value)]=i,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(t){if(this.styleOrigin)return void D0().error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const e=this.uniqueValueInfos;if(e)for(let i=0;i<e.length;i++){const r=e[i];if(String(r.value)===String(t)){delete this._valueInfoMap[SE(t)],e.splice(i,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(t,e){let i=e;return this.valueExpression&&(e==null?void 0:e.arcade)==null&&(i={...i,arcade:await bv()}),this._getUniqueValueInfo(t,i)}getSymbol(t,e){if(this.valueExpression&&(e==null?void 0:e.arcade)==null)return void D0().error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this._getUniqueValueInfo(t,e);return(i==null?void 0:i.symbol)||this.defaultSymbol}async getSymbolAsync(t,e){let i=e;if(this.valueExpression&&(i==null?void 0:i.arcade)==null){const s=await bv(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i={...i,arcade:s}}const r=this._getUniqueValueInfo(t,i);return(r==null?void 0:r.symbol)||this.defaultSymbol}get symbols(){const t=[];for(const e of this.uniqueValueInfos??[])e.symbol&&t.push(e.symbol);return this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){var t;return((t=this.visualVariables)==null?void 0:t.reduce((e,i)=>e+i.getAttributeHash(),""))??""}getMeshHash(){var r;const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),i=(r=this.uniqueValueInfos)==null?void 0:r.reduce((s,n)=>s+n.getMeshHash(),"");return`${t}.${e}.${i}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const t=new IR({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:q(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:q(this.visualVariables),legendOptions:q(this.legendOptions),authoringInfo:q(this.authoringInfo),backgroundFillSymbol:q(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(t._isDefaultSymbolDerived=!0),t._set("portal",this.portal);const e=q(this.uniqueValueInfos),i=q(this.uniqueValueGroups);return this.styleOrigin&&(t._set("styleOrigin",Object.freeze(q(this.styleOrigin))),Object.freeze(e),Object.freeze(i)),t._set("uniqueValueInfos",e),t._updateValueInfoMap(),t._set("uniqueValueGroups",i),t._isInfosSource=this._isInfosSource,t._watchUniqueValueInfosAndGroups(),t}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(t,e){const i=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(i)}async collectSymbolFields(t,e){const i=[...this.symbols.map(r=>r.collectRequiredFields(t,e)),Rl(t,e,this.valueExpression)];dc(t,e,this.field),dc(t,e,this.field2),dc(t,e,this.field3),await Promise.all(i)}populateFromStyle(){return JNt(this.styleOrigin,{portal:this.portal}).then(t=>{var i;const e=[];return this._valueInfoMap={},t!=null&&t.data&&Array.isArray(t.data.items)&&t.data.items.forEach(r=>{const s=new Vb({styleUrl:t.styleUrl,styleName:t.styleName,portal:this.portal,name:r.name});this.defaultSymbol||r.name!==t.data.defaultItem||(this.defaultSymbol=s,this._isDefaultSymbolDerived=!0);const n=new NP({value:r.name,symbol:s});e.push(n),this._valueInfoMap[SE(r.name)]=n}),this._set("uniqueValueInfos",Object.freeze(e)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&((i=this.uniqueValueInfos)!=null&&i.length)&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",KNt)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:t}=this;if(t)for(const e of t)this._valueInfoMap[SE(e.value)]=e}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles($we);const{uniqueValueInfos:t}=this;if(t){const e=[];for(const i of t)e.push(H(()=>({symbol:i.symbol,value:i.value,label:i.label,description:i.description}),(r,s)=>{r!==s&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(e,$we)}}_watchUniqueValueGroups(){this.removeHandles(Awe);const{uniqueValueGroups:t}=this;if(t){const e=[];for(const i of t){e.push(H(()=>({classes:i.classes}),(r,s)=>{r!==s&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const r of i.classes??[])e.push(H(()=>({symbol:r.symbol,values:r.values,label:r.label,description:r.description}),(s,n)=>{s!==n&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(e,Awe)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const t=[],{field:e,field2:i,field3:r,fieldDelimiter:s,uniqueValueGroups:n,valueExpression:o}=this;if(!e&&!o)return this._set("uniqueValueInfos",t),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!e||!i);for(const l of n)for(const c of l.classes??[]){const{symbol:h,label:d,values:f,description:m}=c;for(const g of f??[]){const{value:v,value2:_,value3:b}=g,w=[v];i&&w.push(_),r&&w.push(b);const x=a?w.join(s||""):w[0]??void 0;t.push(new NP({symbol:h,label:d,value:x,description:m}))}}this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(t=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:e,field2:i,valueExpression:r,fieldDelimiter:s,uniqueValueInfos:n}=this;if(!e&&!r||!n.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!e||!i),a=n.map(c=>{var b;const{symbol:h,label:d,value:f,description:m}=c,[g,v,_]=o?((b=f==null?void 0:f.toString())==null?void 0:b.split(s||""))||[]:[f];return new Dze({symbol:h,label:d,description:m,values:[new d$({value:g,value2:v,value3:_})]})}),l=[new Fee({classes:a})];t&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(t,e){return this.valueExpression?this._getUnqiueValueInfoForExpression(t,e):this._getUnqiueValueInfoForFields(t)}_getUnqiueValueInfoForExpression(t,e){const{viewingMode:i,scale:r,spatialReference:s,arcade:n,timeZone:o}=e??{};let a=this._cache.compiledFunc;const l=n.arcadeUtils;if(!a){const h=l.createSyntaxTree(this.valueExpression);a=l.createFunction(h),this._cache.compiledFunc=a}const c=l.executeFunction(a,l.createExecContext(t,l.getViewInfo({viewingMode:i,scale:r,spatialReference:s}),o));return this._valueInfoMap[SE(c)]}_getUnqiueValueInfoForFields(t){const e=this.field,i=t.attributes;let r;if(this.field2){const s=this.field2,n=this.field3,o=[];e&&o.push(i[e]),s&&o.push(i[s]),n&&o.push(i[n]),r=o.join(this.fieldDelimiter||"")}else e&&(r=i[e]);return this._valueInfoMap[SE(r)]}static fromPortalStyle(t,e){const i=new IR(e==null?void 0:e.properties);i._set("styleOrigin",Object.freeze({styleName:t})),i._set("portal",(e==null?void 0:e.portal)||vn.getDefault());const r=i.populateFromStyle();return r.catch(s=>{D0().error(`#fromPortalStyle('${t}'[, ...])`,"Failed to create unique value renderer from style name",s)}),r}static fromStyleUrl(t,e){const i=new IR(e==null?void 0:e.properties);i._set("styleOrigin",Object.freeze({styleUrl:t}));const r=i.populateFromStyle();return r.catch(s=>{D0().error(`#fromStyleUrl('${t}'[, ...])`,"Failed to create unique value renderer from style URL",s)}),r}};u([p({readOnly:!0})],Bs.prototype,"_cache",null),u([Ve({uniqueValue:"unique-value"})],Bs.prototype,"type",void 0),u([p(ule)],Bs.prototype,"backgroundFillSymbol",void 0),u([p({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],Bs.prototype,"field",null),u([ti("field")],Bs.prototype,"castField",null),u([_e("field")],Bs.prototype,"writeField",null),u([p({type:String,value:null,json:{write:!0}})],Bs.prototype,"field2",null),u([p({type:String,value:null,json:{write:!0}})],Bs.prototype,"field3",null),u([p({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],Bs.prototype,"orderByClassesEnabled",void 0),u([p({type:String,value:null,json:{write:!0}})],Bs.prototype,"valueExpression",null),u([p({type:String,json:{write:!0}})],Bs.prototype,"valueExpressionTitle",void 0),u([p({type:hle,json:{write:!0}})],Bs.prototype,"legendOptions",void 0),u([p({type:String,json:{write:!0}})],Bs.prototype,"defaultLabel",void 0),u([p(eie({...sH},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],Bs.prototype,"defaultSymbol",null),u([p({type:String,value:null,json:{write:!0}})],Bs.prototype,"fieldDelimiter",null),u([p({type:vn,readOnly:!0})],Bs.prototype,"portal",void 0),u([ve("portal",["styleName"])],Bs.prototype,"readPortal",null),u([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],Bs.prototype,"styleOrigin",void 0),u([ve("styleOrigin",["styleName","styleUrl"])],Bs.prototype,"readStyleOrigin",null),u([_e("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],Bs.prototype,"writeStyleOrigin",null),u([p({type:[Fee],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(t,e,i)=>(e.uniqueValueGroups||eFt(e)).map(r=>Fee.fromJSON(r,i))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],Bs.prototype,"uniqueValueGroups",null),u([p({type:[NP],json:{read:!1,write:{isRequired:!0,overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0,isRequired:!0}}}}})],Bs.prototype,"uniqueValueInfos",null),Bs=IR=u([A(Lze)],Bs);const dle=Bs;var zee;let Uo=zee=class extends ee{constructor(t){super(t),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.orderByFields=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new zee(q({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};u([p({type:[String],json:{write:!0}})],Uo.prototype,"attachmentTypes",void 0),u([p({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],Uo.prototype,"attachmentsWhere",void 0),u([p({type:Boolean,json:{write:!0}})],Uo.prototype,"cacheHint",void 0),u([p({type:[String],json:{write:!0}})],Uo.prototype,"keywords",void 0),u([p({type:[String],json:{write:!0}})],Uo.prototype,"globalIds",void 0),u([p({json:{write:!0}})],Uo.prototype,"name",void 0),u([p({type:Number,json:{read:{source:"resultRecordCount"}}})],Uo.prototype,"num",void 0),u([p({type:[Number],json:{write:!0}})],Uo.prototype,"objectIds",void 0),u([p({type:[String],json:{write:!0}})],Uo.prototype,"orderByFields",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],Uo.prototype,"returnMetadata",void 0),u([p({type:[Number],json:{write:!0}})],Uo.prototype,"size",void 0),u([p({type:Number,json:{read:{source:"resultOffset"}}})],Uo.prototype,"start",void 0),u([_e("start"),_e("num")],Uo.prototype,"writeStart",null),u([p({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Uo.prototype,"where",void 0),Uo=zee=u([A("esri.rest.support.AttachmentQuery")],Uo),Uo.from=Ds(Uo);const tFt=Uo,Nze=Oo()({naturalLog:"natural-log",squareRoot:"square-root",percentOfTotal:"percent-of-total",log:"log",field:"field"}),Mwe="percent-of-total",Owe="field",Kpi=t=>{let e=class extends t{constructor(){super(...arguments),this.normalizationField=null,this.normalizationMaxValue=null,this.normalizationMinValue=null,this.normalizationTotal=null}get normalizationType(){let i=this._get("normalizationType");const r=!!this.normalizationField,s=this.normalizationTotal!=null;return r||s?(i=r&&Owe||s&&Mwe||null,r&&s&&J.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):i!==Owe&&i!==Mwe||(i=null),i}set normalizationType(i){this._set("normalizationType",i)}};return u([p({type:String,json:{name:"parameters.normalizationField",write:!0}})],e.prototype,"normalizationField",void 0),u([p({type:Number,json:{name:"parameters.normalizationMaxValue",write:!0}})],e.prototype,"normalizationMaxValue",void 0),u([p({type:Number,json:{name:"parameters.normalizationMinValue",write:!0}})],e.prototype,"normalizationMinValue",void 0),u([p({type:Number,json:{name:"parameters.normalizationTotal",write:!0}})],e.prototype,"normalizationTotal",void 0),u([Ve(Nze,{name:"parameters.normalizationType"})],e.prototype,"normalizationType",null),e=u([A("esri.rest.support.NormalizationBinParametersMixin")],e),e};var Uee;let tn=Uee=class extends ee{constructor(t){super(t),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(e.definitionExpression="1=1")}clone(){return new Uee(q({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};u([p({type:Boolean,json:{write:!0}})],tn.prototype,"cacheHint",void 0),u([p({type:Lp,json:{write:!0}})],tn.prototype,"dynamicDataSource",void 0),u([p({type:String,json:{write:!0}})],tn.prototype,"gdbVersion",void 0),u([p({type:Number,json:{write:!0}})],tn.prototype,"geometryPrecision",void 0),u([p({type:Date})],tn.prototype,"historicMoment",void 0),u([_e("historicMoment")],tn.prototype,"_writeHistoricMoment",null),u([p({type:Number,json:{write:!0}})],tn.prototype,"maxAllowableOffset",void 0),u([p({json:{write:!0}})],tn.prototype,"objectIds",void 0),u([p({type:[String],json:{write:!0}})],tn.prototype,"orderByFields",void 0),u([p({type:[String],json:{write:!0}})],tn.prototype,"outFields",void 0),u([p({type:Oe,json:{read:{source:"outSR"},write:{target:"outSR"}}})],tn.prototype,"outSpatialReference",void 0),u([p({json:{write:!0}})],tn.prototype,"relationshipId",void 0),u([p({type:Number,json:{read:{source:"resultOffset"}}})],tn.prototype,"start",void 0),u([_e("start"),_e("num")],tn.prototype,"writeStart",null),u([p({type:Number,json:{read:{source:"resultRecordCount"}}})],tn.prototype,"num",void 0),u([p({json:{write:!0}})],tn.prototype,"returnGeometry",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],tn.prototype,"returnM",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],tn.prototype,"returnZ",void 0),u([p({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],tn.prototype,"where",void 0),tn=Uee=u([A("esri.rest.support.RelationshipQuery")],tn),tn.from=Ds(tn);const ple=tn,Qpi=Object.freeze(Object.defineProperty({__proto__:null,default:ple},Symbol.toStringTag,{value:"Module"})),Bee=new ni({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function iFt(t,e,i,r){const s=await yw(t);if(await fle(t,e,r),!s.addAttachment)throw new U(r,"Layer source does not support addAttachment capability");return s.addAttachment(e,i)}function fle(t,e,i){var n,o;const{attributes:r}=e,{objectIdField:s}=t;return(o=(n=t.capabilities)==null?void 0:n.data)!=null&&o.supportsAttachment?e?r?s&&r[s]?Promise.resolve():Promise.reject(new U(i,`feature is missing the identifying attribute ${s}`)):Promise.reject(new U(i,"'attributes' are required on a feature to query attachments")):Promise.reject(new U(i,"A feature is required to add/delete/update attachments")):Promise.reject(new U(i,"this layer doesn't support attachments"))}async function rFt(t,e,i,r,s){const n=await yw(t);if(await fle(t,e,s),!n.updateAttachment)throw new U(s,"Layer source does not support updateAttachment capability");return n.updateAttachment(e,i,r)}async function sFt(t,e,i){const{applyEdits:r}=await G(()=>import("./editingSupport-BaZ1VgkJ.js"),[]),s=await t.load();let n=i;return s.type==="feature"&&s.infoFor3D&&e.deleteFeatures!=null&&s.globalIdField!=null&&(n={...n,globalIdToObjectId:await CFt(s,e.deleteFeatures,s.globalIdField)}),r(s,s.source,e,i)}async function nFt(t,e,i){const{uploadAssets:r}=await G(()=>import("./editingSupport-BaZ1VgkJ.js"),[]),s=await t.load();return r(s,s.source,e,i)}async function oFt(t,e,i,r){const s=await yw(t);if(await fle(t,e,r),!s.deleteAttachments)throw new U(r,"Layer source does not support deleteAttachments capability");return s.deleteAttachments(e,i)}async function aFt(t,e,i){const r=(await t.load({signal:e==null?void 0:e.signal})).source;if(!r.fetchRecomputedExtents)throw new U(i,"Layer source does not support fetchUpdates capability");return r.fetchRecomputedExtents(e)}async function lFt(t,e,i,r){var m,g,v,_;e=tFt.from(e),await t.load();const s=t.source,n=t.capabilities;if(!((m=n==null?void 0:n.data)!=null&&m.supportsAttachment))throw new U(r,"this layer doesn't support attachments");const{attachmentTypes:o,objectIds:a,globalIds:l,num:c,size:h,start:d,where:f}=e;if(!((g=n==null?void 0:n.operations)!=null&&g.supportsQueryAttachments)&&((o==null?void 0:o.length)>0||(l==null?void 0:l.length)>0||(h==null?void 0:h.length)>0||c||d||f))throw new U(r,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(a!=null&&a.length||l!=null&&l.length||f))throw new U(r,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!s.queryAttachments)throw new U(r,"Layer source does not support queryAttachments capability",e);return!((v=n==null?void 0:n.attachment)!=null&&v.supportsOrderByFields)&&((_=e.orderByFields)!=null&&_.length)&&((e=e.clone()).orderByFields=null),s.queryAttachments(e)}async function cFt(t,e,i,r){const s=await yw(t);if(!s.queryObjectIds)throw new U(r,"Layer source does not support queryObjectIds capability");return s.queryObjectIds(ng.from(e)??t.createQuery(),i)}async function uFt(t,e,i,r){const s=await yw(t);if(!s.queryFeatureCount)throw new U(r,"Layer source does not support queryFeatureCount capability");return s.queryFeatureCount(ng.from(e)??t.createQuery(),i)}async function hFt(t,e,i,r){const s=await yw(t);if(!s.queryExtent)throw new U(r,"Layer source does not support queryExtent capability");return s.queryExtent(ng.from(e)??t.createQuery(),i)}async function dFt(t,e,i,r){const s=await yw(t);if(!s.queryRelatedFeatures)throw new U(r,"Layer source does not support queryRelatedFeatures capability");return s.queryRelatedFeatures(ple.from(e),i)}async function pFt(t,e,i,r){const s=await yw(t);if(!s.queryRelatedFeaturesCount)throw new U(r,"Layer source does not support queryRelatedFeaturesCount capability");return s.queryRelatedFeaturesCount(ple.from(e),i)}async function fFt(t){const e=t.source;if(e!=null&&e.refresh)try{const{dataChanged:i,updates:r}=await e.refresh();if(r!=null&&(t.sourceJSON={...t.sourceJSON,...r},t.read(r,{origin:"service",url:t.parsedUrl})),i)return!0}catch{}if(t.definitionExpression)try{return(await Cre(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function mFt(t){var o,a;const e=new ng,i=(o=t.capabilities)==null?void 0:o.data,r=(a=t.capabilities)==null?void 0:a.query;e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,r&&(e.compactGeometryEnabled=r.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),i&&(i.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),i.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];const{timeOffset:s,timeExtent:n}=t;return e.timeExtent=s!=null&&n!=null?n.offset(-s.value,s.unit):n||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function Fze(t){const{globalIdField:e,fields:i}=t;if(e)return e;if(i){for(const r of i)if(r.type==="esriFieldTypeGlobalID")return r.name}}function kze(t){const{objectIdField:e,fields:i}=t;if(e)return e;if(i){for(const r of i)if(r.type==="esriFieldTypeOID")return r.name}}function gFt(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}function yFt(t,e,i,r){var l,c;const s=i==null?void 0:i.feature,n=!!((l=t.subtypes)!=null&&l.length);if(n&&!(i!=null&&i.excludeImpliedDomains)){const h=_Ft(t,e);if(h)return h}const o=n&&vFt(t,s);if(o){const h=(c=o==null?void 0:o.domains)==null?void 0:c[e];return(h==null?void 0:h.type)==="inherited"?r:h}const a=Bze(t.types,t.typeIdField,s);if(a){const h=a.domains&&a.domains[e];if(h&&(h==null?void 0:h.type)!=="inherited")return h}if(r)return r;if(!(i!=null&&i.excludeImpliedDomains)){const h=bFt(t,e);if(h)return h}return null}function vFt(t,e){const{subtypes:i,subtypeField:r}=t;if(!(e!=null&&e.attributes)||!(i!=null&&i.length)||!r)return null;const s=e.attributes[r];return s==null?null:i.find(n=>n.code===s)}function _Ft(t,e){var o,a;const{fieldsIndex:i,subtypeField:r}=t,{name:s,type:n}=i.get(e)??{};if(!s)return null;if((r&&((o=i.get(r))==null?void 0:o.name))===s&&((a=t.subtypes)!=null&&a.length)){const l=t.subtypes.map(c=>new Mx({code:zze(c.code,n),name:c.name}));if(l!=null&&l.length)return new TG({codedValues:l})}return null}function bFt(t,e){var n,o;const{fieldsIndex:i}=t,{name:r,type:s}=i.get(e)??{};if(!r)return null;if(("typeIdField"in t?(n=i.get(t.typeIdField))==null?void 0:n.name:null)===r&&"types"in t&&((o=t.types)!=null&&o.length)){const a=t.types.map(l=>new Mx({code:zze(l.id,s),name:l.name}));return new TG({codedValues:a})}return null}function zze(t,e){return e?Mre({type:e})&&typeof t=="number"?`${t}`:cAe({type:e})&&typeof t=="string"?Number.parseInt(t,10):t:t}async function yw(t){return(await t.load()).source}async function efi(t,e){if(!hi)return;const i=hi.findCredential(t);if(i)return i.userId;let r;try{const s=await vre(t,e);s&&(r=await hi.checkSignInStatus(`${s}/sharing`))}catch{}return r?r.userId:null}async function Uze(t,e){if(!hi||hi.findCredential(t))return;let i;try{const r=await vre(t,e);r&&(i=await hi.checkSignInStatus(`${r}/sharing`))}catch{}if(i)try{const r=e!=null?e.signal:null;await hi.getCredential(t,{signal:r})}catch{}}async function wFt(t,e,i){var s;const r=(s=t.parsedUrl)==null?void 0:s.path;r&&t.authenticationTriggerEvent===e&&await Uze(r,i)}async function tfi(t){var i;const e=(i=t.parsedUrl)==null?void 0:i.path;e&&xFt(t)&&await Uze(e)}function xFt(t){return SFt(t)&&("serviceDefinitionExpression"in t&&xV(t.serviceDefinitionExpression)||"definitionExpression"in t&&xV(t.definitionExpression))}function SFt(t){var e;return!(!a$e(t)||!((e=t.capabilities)!=null&&e.query.supportsCurrentUser))}function xV(t){return!!(t!=null&&t.toLowerCase().includes("current_user"))}function TFt(t){return!Pz(t)&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}const z7=qA({types:iMe});function mle(t,e){var i;if(t.defaultSymbol)return(i=t.types)!=null&&i.length?new dle({defaultSymbol:z7(t.defaultSymbol,t,e),field:t.typeIdField,uniqueValueInfos:t.types.map(r=>({id:r.id,symbol:z7(r.symbol,r,e)}))}):new pv({symbol:z7(t.defaultSymbol,t,e)})}function EFt(t){var r,s,n;let e=(r=t.sourceJSON)==null?void 0:r.cacheMaxAge;if(!e)return!1;const i=(n=(s=t.editingInfo)==null?void 0:s.lastEditDate)==null?void 0:n.getTime();return i==null||(e*=1e3,Date.now()-i<e)}async function CFt(t,e,i){if(e==null)return null;const r=[],{objectIdField:s}=t;if(e.forEach(c=>{let h=null;if("attributes"in c){const{attributes:d}=c;h={globalId:d[i],objectId:d[s]!=null&&d[s]!==-1?d[s]:null}}else h={globalId:c.globalId,objectId:c.objectId!=null&&c.objectId!==-1?c.objectId:null};h.globalId!=null&&(h.objectId!=null&&h.objectId!==-1||r.push(h.globalId))}),r.length===0)return null;const n=t.createQuery();n.where=r.map(c=>`${i}='${c}'`).join(" OR "),n.returnGeometry=!1,n.outFields=[s,i],n.cacheHint=!1;const o=await iqe(Eze(t,n));if(!o.ok)return null;const a=new Map,l=o.value.features;for(const c of l){const h=c.attributes[i],d=c.attributes[s];h!=null&&d!=null&&d!==-1&&a.set(Jnt(h),d)}return a}function Bze(t,e,i){if(!e||!i||!t)return null;const r=i.getAttribute(e);return r==null?null:t.find(s=>{const{id:n}=s;return n!=null&&n.toString()===r.toString()})??null}function Pz(t){var e;return((e=t.sourceJSON)==null?void 0:e.isMultiServicesView)||$Ft(t)}function $Ft(t){var e,i;return!!((i=(e=t.sourceJSON)==null?void 0:e.capabilities)!=null&&i.toLowerCase().split(",").map(r=>r.trim()).includes("map"))}function AFt(t,e,i){const r=e==null?void 0:e.queryAttributeBins;if(!r)throw new U(i,"Layer source does not support binning");switch(t.binParameters.type){case"auto-interval":if(!r.supportsAutoInterval)throw new U(i,"Layer source does not support auto-interval binning");if(t.binParameters.normalizationType&&(!r.supportsNormalization||!Iwe(t.binParameters.normalizationType,r.supportedNormalizationTypes)))throw new U(i,"Layer source does not support normalization binning");break;case"date":if(!r.supportsDate)throw new U(i,"Layer source does not support date binning");if(t.binParameters.snapToData&&!r.supportsSnapToData)throw new U(i,"Layer source does not support snapToData binning");if(t.binParameters.returnFullIntervalBin&&!r.supportsReturnFullIntervalBin)throw new U(i,"Layer source does not support returnFullIntervalBin binning");break;case"fixed-boundaries":if(!r.supportsFixedBoundaries)throw new U(i,"Layer source does not support fixed-boundaries binning");break;case"fixed-interval":if(!r.supportsFixedInterval)throw new U(i,"Layer source does not support fixed-interval binning");if(t.binParameters.normalizationType&&(!r.supportsNormalization||!Iwe(t.binParameters.normalizationType,r.supportedNormalizationTypes)))throw new U(i,"Layer source does not support normalization binning")}if(t.binParameters.stackBy&&!r.supportsStackBy)throw new U(i,"Layer source does not support stackBy binning");if(t.binParameters.splitBy&&!r.supportsSplitBy)throw new U(i,"Layer source does not support splitBy binning");if(t.binParameters.firstDayOfWeek&&!r.supportsFirstDayOfWeek)throw new U(i,"Layer source does not support firstDayOfWeek binning");const s=r==null?void 0:r.supportedStatistics;if(t.outStatistics&&s){const n=new Map([["count","count"],["sum","sum"],["min","min"],["max","max"],["avg","avg"],["stddev","stddev"],["var","var"],["percentile-continuous","percentileContinuous"],["percentile-discrete","percentileDiscrete"],["centroid-aggregate","centroid"],["convex-hull-aggregate","convexHull"],["envelope-aggregate","envelope"]]);for(const{statisticType:o}of t.outStatistics){const a=n.get(o);if(a&&!s[a])throw new U(i,`Layer source does not support ${o} statistic type`)}}}function Iwe(t,e){return t!=null&&!!(e!=null&&e[Nze.toJSON(t)])}let F2=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};u([p({type:String,json:{read:{source:"shapeAreaFieldName"}}})],F2.prototype,"shapeAreaField",void 0),u([p({type:String,json:{read:{source:"shapeLengthFieldName"}}})],F2.prototype,"shapeLengthField",void 0),u([p({type:String,json:{read:t=>qHe.read(t)||WHe.read(t)}})],F2.prototype,"units",void 0),F2=u([A("esri.layers.support.GeometryFieldsInfo")],F2);const MFt=F2;var Vee;let k2=Vee=class extends ee{constructor(t){super(t),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new Ce}clone(){return new Vee({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};u([p({type:String,json:{write:{isRequired:!0}}})],k2.prototype,"floorField",void 0),u([p({json:{read:!1,write:!1}})],k2.prototype,"viewAllMode",void 0),u([p({json:{read:!1,write:!1}})],k2.prototype,"viewAllLevelIds",void 0),k2=Vee=u([A("esri.layers.support.LayerFloorInfo")],k2);const OFt=k2,Rwe=new ni({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),Pwe=new ni({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let Nu=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.cardinality=null,this.catalogId=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};u([p({json:{read:Rwe.read,write:Rwe.write}})],Nu.prototype,"cardinality",void 0),u([p({json:{name:"catalogID"}})],Nu.prototype,"catalogId",void 0),u([p({json:{read:!0,write:!0}})],Nu.prototype,"composite",void 0),u([p({json:{read:!0,write:!0}})],Nu.prototype,"id",void 0),u([p({json:{read:!0,write:!0}})],Nu.prototype,"keyField",void 0),u([p({json:{read:!0,write:!0}})],Nu.prototype,"keyFieldInRelationshipTable",void 0),u([p({json:{read:!0,write:!0}})],Nu.prototype,"name",void 0),u([p({json:{read:!0,write:!0}})],Nu.prototype,"relatedTableId",void 0),u([p({json:{read:!0,write:!0}})],Nu.prototype,"relationshipTableId",void 0),u([p({json:{read:Pwe.read,write:Pwe.write}})],Nu.prototype,"role",void 0),Nu=u([A("esri.layers.support.Relationship")],Nu);const IFt=Nu,RFt=[["binary","application/octet-stream","bin",""]];function sfi(t,e){return Hze(e.name,(t==null?void 0:t.supportedFormats)??[])!=null}function nfi(t,e){if(!t)return!1;const i=PFt(e,t.supportedFormats??[]);return i!=null&&t.editFormats.includes(i)}function Vze(t,e){return yle(FFt(t,e))}function jze(t,e){return yle(Hze(t,e))}function ofi(t,e){return qze(NFt(t,e))}function PFt(t,e){return jze(t.name,e)??Vze(t.type,e)}function nH(t,e,i){return Vze(t,i)??jze(e,i)}function Gze({supportedFormats:t}){return nH("model/gltf-binary","glb",t)}function afi(t){const e=Gze(t);return e!=null&&t.editFormats.includes(e)}function DFt({supportedFormats:t}){return nH("model/gltf+json","gltf",t)}function LFt(t){if(!t)return null;const e=Gze(t),i=DFt(t);let r=null;for(const s of t.queryFormats){if(s===e)return s;s===i&&(r=s)}return r}function lfi({supportedFormats:t}){return nH("application/esri3do-SR_world","wld",t)}function cfi({supportedFormats:t}){return nH("application/esri3do-SR_prj","prj",t)}function gle(t){return[...RFt,...t]}function NFt(t,e){return gle(e).find(i=>yle(i)===t)}function FFt(t,e){const i=t.toLowerCase();return gle(e).find(r=>qze(r)===i)}function Hze(t,e){const i=t.toLowerCase();return gle(e).find(r=>kFt(r).some(s=>i.endsWith(s)))}function yle(t){return t==null?void 0:t[0]}function qze(t){return t==null?void 0:t[1].toLowerCase()}function kFt(t){return(t==null?void 0:t[2].split(",").map(e=>e.toLowerCase()))??[]}function ufi(t){var e;return(e=t.tables)==null?void 0:e.find(i=>i.role==="assetMaps")}function tt(t,e,i){return!!Wze(t,e,i)}function RR(t,e,i){return Wze(t,e,i)}function Wze(t,e,i){return t&&t.hasOwnProperty(e)?t[e]:i}const zFt={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function UFt(t){var i;const e=(i=t==null?void 0:t.supportedSpatialAggregationStatistics)==null?void 0:i.map(r=>r.toLowerCase());return{envelope:!!(e!=null&&e.includes("envelopeaggregate")),centroid:!!(e!=null&&e.includes("centroidaggregate")),convexHull:!!(e!=null&&e.includes("convexhullaggregate"))}}function HL(t,e){var r;const i=(r=t==null?void 0:t.supportedOperationsWithCacheHint)==null?void 0:r.map(s=>s.toLowerCase());return!!(i!=null&&i.includes(e.toLowerCase()))}function BFt(t){var i;const e=(i=t==null?void 0:t.supportedStatisticTypes)==null?void 0:i.map(r=>r.toLowerCase());return{count:!!(e!=null&&e.includes("count")),sum:!!(e!=null&&e.includes("sum")),min:!!(e!=null&&e.includes("min")),max:!!(e!=null&&e.includes("max")),avg:!!(e!=null&&e.includes("avg")),var:!!(e!=null&&e.includes("var")),stddev:!!(e!=null&&e.includes("stddev")),percentileContinuous:!!(e!=null&&e.includes("percentile_continuous")),percentileDiscrete:!!(e!=null&&e.includes("percentile_discrete")),envelope:!!(e!=null&&e.includes("envelopeaggregate")),centroid:!!(e!=null&&e.includes("centroidaggregate")),convexHull:!!(e!=null&&e.includes("convexhullaggregate"))}}function VFt(t){var i;const e=(i=t==null?void 0:t.supportedNormalizationTypes)==null?void 0:i.map(r=>r.toLowerCase());return{field:!!(e!=null&&e.includes("field")),log:!!(e!=null&&e.includes("log")),naturalLog:!!(e!=null&&e.includes("naturallog")),percentOfTotal:!!(e!=null&&e.includes("percentoftotal")),squareRoot:!!(e!=null&&e.includes("squareroot"))}}function Zze(t,e){return{analytics:jFt(t),attachment:GFt(t),data:HFt(t),metadata:qFt(t),operations:WFt(t.capabilities,t,e),query:ZFt(t,e),queryAttributeBins:XFt(t),queryRelated:YFt(t),queryTopFeatures:JFt(t),editing:KFt(t)}}function jFt(t){return{supportsCacheHint:HL(t.advancedQueryCapabilities,"queryAnalytics")}}function GFt(t){const e=t.attachmentProperties,i={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:HL(t.advancedQueryCapabilities,"queryAttachments"),supportsOrderByFields:tt(t.advancedQueryCapabilities,"supportsQueryAttachmentOrderByFields",!1),supportsResize:tt(t,"supportsAttachmentsResizing",!1)};return e&&Array.isArray(e)&&e.forEach(r=>{const s=zFt[r.name];s&&(i[s]=!!r.isEnabled)}),i}function HFt(t){return{isVersioned:tt(t,"isDataVersioned",!1),isBranchVersioned:tt(t,"isDataBranchVersioned",!1),supportsAttachment:tt(t,"hasAttachments",!1),supportsM:tt(t,"hasM",!1),supportsZ:tt(t,"hasZ",!1)}}function qFt(t){return{supportsAdvancedFieldProperties:tt(t,"supportsFieldDescriptionProperty",!1)}}function WFt(t,e,i){const r=t?t.toLowerCase().split(",").map(f=>f.trim()):[],s=i?Rb(i):null,n=r.includes(s!=null&&s.serverType==="MapServer"?"data":"query"),o=r.includes("editing")&&!e.datesInUnknownTimezone;let a=o&&r.includes("create"),l=o&&r.includes("delete"),c=o&&r.includes("update");const h=r.includes("changetracking"),d=e.advancedQueryCapabilities;return o&&!(a||l||c)&&(a=l=c=!0),{supportsCalculate:tt(e,"supportsCalculate",!1),supportsTruncate:tt(e,"supportsTruncate",!1),supportsValidateSql:tt(e,"supportsValidateSql",!1),supportsAdd:a,supportsDelete:l,supportsEditing:o,supportsChangeTracking:h,supportsQuery:n,supportsQueryAnalytics:tt(d,"supportsQueryAnalytic",!1),supportsQueryAttachments:tt(d,"supportsQueryAttachments",!1),supportsQueryBins:tt(d,"supportsQueryBins",!1),supportsQueryTopFeatures:tt(d,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:tt(e,"supportsAttachmentsResizing",!1),supportsSync:r.includes("sync"),supportsUpdate:c,supportsExceedsLimitStatistics:tt(e,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:tt(e,"supportsAsyncConvert3D",!1)}}function ZFt(t,e){const i=t.advancedQueryCapabilities,r=t.ownershipBasedAccessControlForFeatures,s=t.archivingInfo,n=t.currentVersion,o=e==null?void 0:e.includes("MapServer"),a=!o||n>=X("mapserver-pbf-version-support"),l=xU(e),c=new Set((t.supportedQueryFormats??"").split(",").map(h=>h.toLowerCase().trim()));return{maxRecordCount:RR(t,"maxRecordCount",void 0),maxRecordCountFactor:RR(t,"maxRecordCountFactor",void 0),standardMaxRecordCount:RR(t,"standardMaxRecordCount",void 0),supportedSpatialAggregationStatistics:UFt(i),supportsCacheHint:tt(i,"supportsQueryWithCacheHint",!1)||HL(i,"query"),supportsCentroid:tt(i,"supportsReturningGeometryCentroid",!1),supportsCompactGeometry:l,supportsCurrentUser:tt(i,"supportsCurrentUserQueries",!1),supportsDefaultSpatialReference:tt(i,"supportsDefaultSR",!1),supportsDisjointSpatialRelationship:tt(i,"supportsDisjointSpatialRel",!1),supportsDistance:tt(i,"supportsQueryWithDistance",!1),supportsDistinct:tt(i,"supportsDistinct",t.supportsAdvancedQueries),supportsExtent:tt(i,"supportsReturningQueryExtent",!1),supportsFormatPBF:a&&c.has("pbf"),supportsFullTextSearch:tt(i,"supportsFullTextSearch",!1),supportsGeometryProperties:tt(i,"supportsReturningGeometryProperties",!1),supportsHavingClause:tt(i,"supportsHavingClause",!1),supportsHistoricMoment:tt(s,"supportsQueryWithHistoricMoment",!1),supportsMaxRecordCountFactor:tt(i,"supportsMaxRecordCountFactor",!1),supportsOrderBy:tt(i,"supportsOrderBy",t.supportsAdvancedQueries),supportsPagination:tt(i,"supportsPagination",!1),supportsPercentileStatistics:tt(i,"supportsPercentileStatistics",!1),supportsQuantization:tt(t,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:tt(t,"supportsQuantizationEditMode",!1),supportsQueryByAnonymous:tt(r,"allowAnonymousToQuery",!0),supportsQueryByOthers:tt(r,"allowOthersToQuery",!0),supportsQueryGeometry:tt(t,"supportsReturningQueryGeometry",!1),supportsResultType:tt(i,"supportsQueryWithResultType",!1),supportsReturnMesh:!!LFt(t.infoFor3D),supportsSpatialAggregationStatistics:tt(i,"supportsSpatialAggregationStatistics",!1),supportsSqlExpression:tt(i,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:tt(t,"useStandardizedQueries",!1),supportsStatistics:tt(i,"supportsStatistics",t.supportsStatistics),supportsTopFeaturesQuery:tt(i,"supportsTopFeaturesQuery",!1),supportsTrueCurve:tt(i,"supportsTrueCurve",!1),tileMaxRecordCount:RR(t,"tileMaxRecordCount",void 0)}}function YFt(t){const e=t.advancedQueryCapabilities,i=tt(e,"supportsAdvancedQueryRelated",!1);return{supportsPagination:tt(e,"supportsQueryRelatedPagination",!1),supportsCount:i,supportsOrderBy:i,supportsCacheHint:HL(e,"queryRelated")}}function JFt(t){return{supportsCacheHint:HL(t.advancedQueryCapabilities,"queryTopFilter")}}function XFt(t){const e=t?t.queryBinsCapabilities:void 0;return{supportsDate:tt(e,"supportsDateBin",!1),supportsFixedInterval:tt(e,"supportsFixedIntervalBin",!1),supportsAutoInterval:tt(e,"supportsAutoIntervalBin",!1),supportsFixedBoundaries:tt(e,"supportsFixedBoundariesBin",!1),supportsStackBy:tt(e,"supportsStackBy",!1),supportsSplitBy:tt(e,"supportsSplitBy",!1),supportsSnapToData:tt(e,"supportsSnapToData",!1),supportsReturnFullIntervalBin:tt(e,"supportsReturnFullIntervalBin",!1),supportsFirstDayOfWeek:tt(e,"supportsFirstDayOfWeek",!1),supportsNormalization:tt(e,"supportsNormalization",!1),supportedStatistics:BFt(e),supportedNormalizationTypes:VFt(e)}}function KFt(t){const e=t.ownershipBasedAccessControlForFeatures,i=t?t.advancedEditingCapabilities:void 0;return{supportsGeometryUpdate:tt(t,"allowGeometryUpdates",!0),supportsGlobalId:tt(t,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:tt(t,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:tt(t,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:tt(t,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:tt(t,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:tt(e,"allowAnonymousToDelete",!0),supportsDeleteByOthers:tt(e,"allowOthersToDelete",!0),supportsUpdateByAnonymous:tt(e,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:tt(e,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:tt(i,"supportsAsyncApplyEdits",!1),zDefault:RR(t,"zDefault",void 0)}}function hfi(t){var e;return{operations:{supportsAppend:tt(t,"supportsAppend",!1),supportsCoverageQuery:((e=t==null?void 0:t.playbackInfo)==null?void 0:e.klv["0601"])??!1,supportsExportClip:tt(t,"supportsExportClip",!1),supportsExportFrameset:tt(t,"supportsExportFrameset",!1),supportsMensuration:tt(t,"supportsMensuration",!1),supportsUpdate:tt(t,"supportsUpdate",!1)}}}let xy=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.code=null,this.defaultValues={},this.domains=null,this.name=null}readDomains(e){if(!e)return null;const i={};for(const r of Object.keys(e))i[r]=EG(e[r]);return i}writeDomains(e,i){var s;if(!e)return;const r={};for(const n of Object.keys(e))e[n]&&(r[n]=(s=e[n])==null?void 0:s.toJSON());i.domains=r}};u([p({type:Number,json:{write:!0}})],xy.prototype,"code",void 0),u([p({type:Object,json:{write:!0}})],xy.prototype,"defaultValues",void 0),u([p({json:{write:!0}})],xy.prototype,"domains",void 0),u([ve("domains")],xy.prototype,"readDomains",null),u([_e("domains")],xy.prototype,"writeDomains",null),u([p({type:String,json:{write:!0}})],xy.prototype,"name",void 0),xy=u([A("esri.layers.support.Subtype")],xy);const QFt=xy,ekt=t=>{let e=class extends t{constructor(){super(...arguments),this.copyright=null,this.capabilities=null,this.dateFieldsTimeZone=null,this.datesInUnknownTimezone=!1,this.definitionExpression=null,this.displayField=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.fieldsIndex=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.globalIdField=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.indexes=new(Ce.ofType(xm)),this.isTable=!1,this.layerId=void 0,this.maxScale=0,this.minScale=0,this.objectIdField=null,this.preferredTimeZone=null,this.relationships=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.sourceJSON=null,this.spatialReference=Oe.WGS84,this.subtypeField=null,this.subtypes=null,this.trackIdField=null,this.version=void 0}getFieldDomain(){throw new Error("Not implemented")}getField(i){return this.fieldsIndex.get(i)}get authenticationTriggerEvent(){if(!this.url)return null;const{capabilities:i}=this;if(i){const{query:s,operations:n,editing:o}=i;if(!s.supportsQueryByOthers||!s.supportsQueryByAnonymous||n.supportsEditing&&!(o.supportsUpdateByOthers&&o.supportsUpdateByAnonymous&&o.supportsDeleteByOthers&&o.supportsDeleteByAnonymous))return"load"}if(xV(this.serviceDefinitionExpression)||xV(this.definitionExpression))return"load";if(this.userHasUpdateItemPrivileges){if(EFt(this))return"load";if(this.hasUpdateItemRestrictions)return i.operations.supportsQuery?"editing":"load"}if(this.userHasFullEditingPrivileges&&this.hasFullEditingRestrictions)return"editing";const r=this.editFieldsInfo;return(r!=null&&r.creatorField||r!=null&&r.editorField)&&(i!=null&&i.operations.supportsEditing)?"editing":null}readCapabilitiesFromService(i,r){return Zze(r,this.url)}readEditingInfo(i,r){const{editingInfo:s}=r;return s?{lastEditDate:s.lastEditDate!=null?new Date(s.lastEditDate):null}:null}get effectiveCapabilities(){const i=this.capabilities;if(!i)return null;const r=q(i),{operations:s,editing:n}=r;return Pz(this)?(this.userHasUpdateItemPrivileges&&(s.supportsQuery=!0),r):this.userHasUpdateItemPrivileges?(s.supportsAdd=s.supportsDelete=s.supportsEditing=s.supportsQuery=s.supportsUpdate=n.supportsDeleteByOthers=n.supportsGeometryUpdate=n.supportsUpdateByOthers=!0,r):(this.userHasFullEditingPrivileges&&s.supportsEditing&&(s.supportsAdd=s.supportsDelete=s.supportsUpdate=n.supportsGeometryUpdate=!0),r)}get effectiveEditingEnabled(){return!1}readGlobalIdFieldFromService(i,r){return Fze(r)}get hasFullEditingRestrictions(){const i=this.capabilities;if(!i||Pz(this))return!1;const{operations:r,editing:s}=i;return r.supportsEditing&&!(r.supportsAdd&&r.supportsDelete&&r.supportsUpdate&&s.supportsGeometryUpdate)}get hasUpdateItemRestrictions(){const i=this.capabilities;if(!i)return!1;const{operations:r,editing:s}=i;return Pz(this)?!r.supportsQuery:!(r.supportsAdd&&r.supportsDelete&&r.supportsEditing&&r.supportsQuery&&r.supportsUpdate&&s.supportsDeleteByOthers&&s.supportsGeometryUpdate&&s.supportsUpdateByOthers)}readIsTableFromService(i,r){return r.type==="Table"}readMaxScale(i,r){return r.effectiveMaxScale||i||0}readMinScale(i,r){return r.effectiveMinScale||i||0}readObjectIdFieldFromService(i,r){return kze(r)}readServiceDefinitionExpression(i,r){return r.definitionQuery||r.definitionExpression}set url(i){if(i==null)return void this._set("url",i);const r=eHe({layer:this,url:i,nonStandardUrlAllowed:!0,logger:J.getLogger(this)});this._set("url",r.url),r.layerId!=null&&this._set("layerId",r.layerId)}writeUrl(i,r,s,n){tHe(this,i,null,r,n)}readVersion(i,r){return gFt(r)}};return u([p({readOnly:!0})],e.prototype,"authenticationTriggerEvent",null),u([p({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],e.prototype,"copyright",void 0),u([p({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","isDataBranchVersioned","isDataVersioned","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],e.prototype,"capabilities",void 0),u([ve("service","capabilities")],e.prototype,"readCapabilitiesFromService",null),u([p(UU("dateFieldsTimeReference"))],e.prototype,"dateFieldsTimeZone",void 0),u([p({type:Boolean})],e.prototype,"datesInUnknownTimezone",void 0),u([p({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],e.prototype,"definitionExpression",void 0),u([p({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],e.prototype,"displayField",void 0),u([p({readOnly:!0,type:sNt})],e.prototype,"editFieldsInfo",void 0),u([p({readOnly:!0})],e.prototype,"editingInfo",void 0),u([ve("editingInfo")],e.prototype,"readEditingInfo",null),u([p({readOnly:!0})],e.prototype,"effectiveCapabilities",null),u([p()],e.prototype,"effectiveEditingEnabled",null),u([p((()=>{const i=q(KLt),r=i.json.origins;return r["web-map"]={read:!1,write:!1},r["portal-item"]={read:!1,write:!1},i})())],e.prototype,"elevationInfo",void 0),u([p()],e.prototype,"fieldsIndex",void 0),u([p({type:OFt,json:{name:"layerDefinition.floorInfo",write:{layerContainerTypes:Xs}}})],e.prototype,"floorInfo",void 0),u([p({type:_i,json:{origins:{service:{read:{source:"extent"}}}}})],e.prototype,"fullExtent",void 0),u([p()],e.prototype,"gdbVersion",void 0),u([p({readOnly:!0,type:MFt,json:{read:{source:"geometryProperties"}}})],e.prototype,"geometryFieldsInfo",void 0),u([p({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:Bee.read}}}})],e.prototype,"geometryType",void 0),u([p({type:String})],e.prototype,"globalIdField",void 0),u([ve("service","globalIdField",["globalIdField","fields"])],e.prototype,"readGlobalIdFieldFromService",null),u([p({readOnly:!0})],e.prototype,"hasFullEditingRestrictions",null),u([p({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasM",void 0),u([p({readOnly:!0})],e.prototype,"hasUpdateItemRestrictions",null),u([p({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasZ",void 0),u([p({readOnly:!0,type:rw})],e.prototype,"heightModelInfo",void 0),u([p({type:Date})],e.prototype,"historicMoment",void 0),u([p({type:Ce.ofType(xm),readOnly:!0})],e.prototype,"indexes",void 0),u([p({readOnly:!0})],e.prototype,"isTable",void 0),u([ve("service","isTable",["type"])],e.prototype,"readIsTableFromService",null),u([p({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],e.prototype,"layerId",void 0),u([p(iNt)],e.prototype,"maxScale",void 0),u([ve("service","maxScale",["maxScale","effectiveMaxScale"])],e.prototype,"readMaxScale",null),u([p(tNt)],e.prototype,"minScale",void 0),u([ve("service","minScale",["minScale","effectiveMinScale"])],e.prototype,"readMinScale",null),u([p({type:String})],e.prototype,"objectIdField",void 0),u([ve("service","objectIdField",["objectIdField","fields"])],e.prototype,"readObjectIdFieldFromService",null),u([p(UU("preferredTimeReference"))],e.prototype,"preferredTimeZone",void 0),u([p({type:[IFt],readOnly:!0})],e.prototype,"relationships",void 0),u([p({type:Boolean})],e.prototype,"returnM",void 0),u([p({type:Boolean})],e.prototype,"returnZ",void 0),u([p({readOnly:!0,json:{write:!1}})],e.prototype,"serverGens",void 0),u([p({readOnly:!0})],e.prototype,"serviceDefinitionExpression",void 0),u([ve("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],e.prototype,"readServiceDefinitionExpression",null),u([p({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],e.prototype,"serviceItemId",void 0),u([p()],e.prototype,"sourceJSON",void 0),u([p({type:Oe,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],e.prototype,"spatialReference",void 0),u([p({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],e.prototype,"subtypeField",void 0),u([p({type:[QFt],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],e.prototype,"subtypes",void 0),u([p({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],e.prototype,"trackIdField",void 0),u([p(JLt)],e.prototype,"url",null),u([_e("url")],e.prototype,"writeUrl",null),u([p({json:{origins:{service:{read:!0}},read:!1}})],e.prototype,"version",void 0),u([ve("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],e.prototype,"readVersion",null),e=u([A("esri.layers.mixins.FeatureLayerBase")],e),e};let z2=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.expression=null,this.title=null,this.returnType=null}};u([p({type:String,json:{write:!0}})],z2.prototype,"expression",void 0),u([p({type:String,json:{write:!0}})],z2.prototype,"title",void 0),u([p({type:String,json:{write:!0}})],z2.prototype,"returnType",void 0),z2=u([A("esri.layers.support.ExpressionInfo")],z2);const vle=z2;var jee;let Sy=jee=class extends ee{constructor(t){super(t),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new jee({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:q(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};u([p({type:Boolean,json:{write:!0}})],Sy.prototype,"isAutoGenerated",void 0),u([p({type:String,json:{write:!0}})],Sy.prototype,"name",void 0),u([p({type:String,json:{write:!0}})],Sy.prototype,"alias",void 0),u([p({type:String,json:{write:!0}})],Sy.prototype,"onStatisticField",void 0),u([p({type:vle,json:{write:!0}})],Sy.prototype,"onStatisticExpression",void 0),u([p({type:String,json:{write:!0}})],Sy.prototype,"statisticType",void 0),Sy=jee=u([A("esri.layers.support.AggregateField")],Sy);const Kb=Sy;let Mb=class extends ee{constructor(){super(...arguments),this.type=null}};u([p({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],Mb.prototype,"type",void 0),Mb=u([A("esri.layers.support.FeatureReduction")],Mb);var Gee;let g_=Gee=class extends ee{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(t,e){return e.value?zK(e.value):t}writeExpression(t,e,i){this.value!=null&&(t=zK(this.value)),t!=null&&(e[i]=t)}clone(){return new Gee({expression:this.expression,title:this.title,value:this.value})}};u([p({type:String,json:{write:{writerEnsuresNonNull:!0}}})],g_.prototype,"expression",void 0),u([ve("expression",["expression","value"])],g_.prototype,"readExpression",null),u([_e("expression")],g_.prototype,"writeExpression",null),u([p({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],g_.prototype,"title",void 0),u([p({json:{read:!1,write:!1}})],g_.prototype,"value",void 0),g_=Gee=u([A("esri.layers.support.LabelExpressionInfo")],g_);const Yze=g_;var Hee;const Vk=new ni({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function jk(t,e,i){return{enabled:!VZ(i==null?void 0:i.layer)}}function Jze(t){var e;return!t||t.origin!=="service"&&((e=t.layer)==null?void 0:e.type)!=="map-image"}function tkt(t){return(t==null?void 0:t.type)==="map-image"}function Xze(t){var e,i;return!!tkt(t)&&!!((i=(e=t.capabilities)==null?void 0:e.exportMap)!=null&&i.supportsArcadeExpressionForLabeling)}function ikt(t){return Jze(t)||Xze(t==null?void 0:t.layer)}let An=Hee=class extends ee{static evaluateWhere(t,e){const i=(r,s,n)=>{switch(s){case"=":return r==n;case"<>":return r!=n;case">":return r>n;case">=":return r>=n;case"<":return r<n;case"<=":return r<=n}return!1};try{if(t==null)return!0;const r=t.split(" ");if(r.length===3)return i(e[r[0]],r[1],r[2]);if(r.length===7){const s=i(e[r[0]],r[1],r[2]),n=r[3],o=i(e[r[4]],r[5],r[6]);switch(n){case"AND":return s&&o;case"OR":return s||o}}return!1}catch{}}constructor(t){super(t),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=PNt,this.useCodedValues=void 0,this.where=null}readLabelExpression(t,e){const i=e.labelExpressionInfo;if(!i||!i.value&&!i.expression)return t}writeLabelExpression(t,e,i){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)t=Yxt(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const r=tae(this.labelExpressionInfo.expression);r&&(t="["+r+"]")}}t!=null&&(e[i]=t)}writeLabelExpressionInfo(t,e,i,r){if(t==null&&this.labelExpression!=null&&Jze(r))t=new Yze({expression:this.getLabelExpressionArcade()});else if(!t)return;const s=t.toJSON(r);s.expression&&(e[i]=s)}writeMaxScale(t,e){(t||this.minScale)&&(e.maxScale=t)}writeMinScale(t,e){(t||this.maxScale)&&(e.minScale=t)}getLabelExpression(){return B6(this)}getLabelExpressionArcade(){return Jxt(this)}getLabelExpressionSingleField(){return Xxt(this)}hash(){return JSON.stringify(this)}clone(){return new Hee({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:q(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:q(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};u([p({type:String,json:{write:!0}})],An.prototype,"name",void 0),u([p({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:jk}}}}})],An.prototype,"allowOverrun",void 0),u([p({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:jk}}}}})],An.prototype,"deconflictionStrategy",void 0),u([p({type:String,json:{write:{overridePolicy(t,e,i){return this.labelExpressionInfo&&(i==null?void 0:i.origin)==="service"&&Xze(i.layer)?{enabled:!1}:{allowNull:!0}}}}})],An.prototype,"labelExpression",void 0),u([ve("labelExpression")],An.prototype,"readLabelExpression",null),u([_e("labelExpression")],An.prototype,"writeLabelExpression",null),u([p({type:Yze,json:{write:{overridePolicy:(t,e,i)=>ikt(i)?{allowNull:!0}:{enabled:!1}}}})],An.prototype,"labelExpressionInfo",void 0),u([_e("labelExpressionInfo")],An.prototype,"writeLabelExpressionInfo",null),u([p({type:Vk.apiValues,json:{type:Vk.jsonValues,read:Vk.read,write:Vk.write}})],An.prototype,"labelPlacement",void 0),u([p({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],An.prototype,"labelPosition",void 0),u([p({type:Number})],An.prototype,"maxScale",void 0),u([_e("maxScale")],An.prototype,"writeMaxScale",null),u([p({type:Number})],An.prototype,"minScale",void 0),u([_e("minScale")],An.prototype,"writeMinScale",null),u([p({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:jk}}}}})],An.prototype,"repeatLabel",void 0),u([p({type:Number,cast:or,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:jk}}}}})],An.prototype,"repeatLabelDistance",void 0),u([p({types:mQe,json:{origins:{"web-scene":{types:gQe,write:wwe,default:null}},write:wwe,default:null}})],An.prototype,"symbol",void 0),u([p({type:Boolean,json:{write:!0}})],An.prototype,"useCodedValues",void 0),u([p({type:String,json:{write:!0}})],An.prototype,"where",void 0),An=Hee=u([A("esri.layers.support.LabelClass")],An);const qL=An;var qee;let y_=qee=class extends ee{constructor(t){super(t),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){var t;return new qee({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:((t=this.symbol)==null?void 0:t.clone())??null})}getMeshHash(){const t=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${t}`}};u([p({type:String,json:{write:!0}})],y_.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],y_.prototype,"label",void 0),u([p({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],y_.prototype,"minValue",void 0),u([p({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],y_.prototype,"maxValue",void 0),u([p(cle)],y_.prototype,"symbol",void 0),y_=qee=u([A("esri.renderers.support.ClassBreakInfo")],y_);const SV=y_;var Wee;const Kze="log",Dz="percent-of-total",Lz="field",Gk=new ni({esriNormalizeByLog:Kze,esriNormalizeByPercentOfTotal:Dz,esriNormalizeByField:Lz}),rkt=Ds(SV);let ho=Wee=class extends EM(Kv){constructor(t){super(t),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(t,e,i){if(!Array.isArray(t))return;let r=e.minValue;return t.map(s=>{const n=new SV;return n.read(s,i),n.minValue==null&&(n.minValue=r),n.maxValue==null&&(n.maxValue=n.minValue),r=n.maxValue,n})}writeClassBreakInfos(t,e,i,r){const s=t.map(n=>n.write({},r));this._areClassBreaksConsecutive()&&s.forEach(n=>delete n.classMinValue),e[i]=s}castField(t){return t==null?t:typeof t=="function"?(J.getLogger(this).error(".field: field must be a string value"),null):DD(t)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let t=this._get("normalizationType");const e=!!this.normalizationField,i=this.normalizationTotal!=null;return e||i?(t=e&&Lz||i&&Dz||null,e&&i&&J.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):t!==Lz&&t!==Dz||(t=null),t}set normalizationType(t){this._set("normalizationType",t)}addClassBreakInfo(t,e,i){let r=null;r=typeof t=="number"?new SV({minValue:t,maxValue:e,symbol:rMe(i)}):rkt(q(t)),this.classBreakInfos.push(r),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(t,e){const i=this.classBreakInfos.length;for(let r=0;r<i;r++){const s=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(s[0]===t&&s[1]===e){this.classBreakInfos.splice(r,1);break}}}getBreakIndex(t,e){return this.valueExpression&&(e==null?void 0:e.arcade)==null&&J.getLogger(this).warn(""),this.valueExpression?this._getBreakIndexForExpression(t,e):this._getBreakIndexForField(t)}async getClassBreakInfo(t,e){let i=e;this.valueExpression&&(e==null?void 0:e.arcade)==null&&(i={...i,arcade:await bv()});const r=this.getBreakIndex(t,i);return r!==-1?this.classBreakInfos[r]:null}getSymbol(t,e){if(this.valueExpression&&(e==null?void 0:e.arcade)==null)return void J.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this.getBreakIndex(t,e);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}async getSymbolAsync(t,e){let i=e;if(this.valueExpression&&(e==null?void 0:e.arcade)==null){const s=await bv(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i={...i,arcade:s}}const r=this.getBreakIndex(t,i);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}get symbols(){const t=[];return this.classBreakInfos.forEach(e=>{e.symbol&&t.push(e.symbol)}),this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){var t;return((t=this.visualVariables)==null?void 0:t.reduce((e,i)=>e+i.getAttributeHash(),""))??""}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),i=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${t}.${e}.${this.classBreakInfos.reduce((r,s)=>r+s.getMeshHash(),"")}.${i}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){var t,e;return new Wee({field:this.field,backgroundFillSymbol:(t=this.backgroundFillSymbol)==null?void 0:t.clone(),defaultLabel:this.defaultLabel,defaultSymbol:(e=this.defaultSymbol)==null?void 0:e.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:q(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:q(this.visualVariables),legendOptions:q(this.legendOptions),authoringInfo:q(this.authoringInfo)})}async collectRequiredFields(t,e){const i=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(i)}async collectSymbolFields(t,e){const i=[...this.symbols.map(r=>r.collectRequiredFields(t,e)),Rl(t,e,this.valueExpression)];dc(t,e,this.field),dc(t,e,this.normalizationField),await Promise.all(i)}_getBreakIndexForExpression(t,e){const{viewingMode:i,scale:r,spatialReference:s,arcade:n,timeZone:o}=e??{},{valueExpression:a}=this;let l=this._compiledValueExpression.valueExpression===a?this._compiledValueExpression.compiledFunction:null;const c=n.arcadeUtils;if(!l){const d=c.createSyntaxTree(a);l=c.createFunction(d),this._compiledValueExpression.compiledFunction=l}this._compiledValueExpression.valueExpression=a;const h=c.executeFunction(l,c.createExecContext(t,c.getViewInfo({viewingMode:i,scale:r,spatialReference:s}),o));return this._getBreakIndexfromInfos(h)}_getBreakIndexForField(t){const e=this.field,i=t.attributes,r=this.normalizationType;let s=parseFloat(i[e]);if(r){const n=this.normalizationTotal,o=parseFloat(this.normalizationField?i[this.normalizationField]:void 0);if(r===Kze)s=Math.log(s)*Math.LOG10E;else if(r!==Dz||n==null||isNaN(n)){if(r===Lz&&!isNaN(o)){if(isNaN(s)||isNaN(o))return-1;s/=o}}else s=s/n*100}return this._getBreakIndexfromInfos(s)}_getBreakIndexfromInfos(t){const e=this.isMaxInclusive;if(t!=null&&typeof t=="number"&&!isNaN(t))for(let i=0;i<this.classBreakInfos.length;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]<=t&&(e?t<=r[1]:t<r[1]))return i}return-1}_areClassBreaksConsecutive(){const t=this.classBreakInfos,e=t.length;for(let i=1;i<e;i++)if(t[i-1].maxValue!==t[i].minValue)return!1;return!0}};u([p(ule)],ho.prototype,"backgroundFillSymbol",void 0),u([p({type:[SV],json:{write:{isRequired:!0}}})],ho.prototype,"classBreakInfos",void 0),u([ve("classBreakInfos")],ho.prototype,"readClassBreakInfos",null),u([_e("classBreakInfos")],ho.prototype,"writeClassBreakInfos",null),u([p({type:String,json:{write:!0}})],ho.prototype,"defaultLabel",void 0),u([p(sH)],ho.prototype,"defaultSymbol",void 0),u([p({type:String,json:{write:!0}})],ho.prototype,"field",void 0),u([ti("field")],ho.prototype,"castField",null),u([p({type:Boolean})],ho.prototype,"isMaxInclusive",void 0),u([p({type:hle,json:{write:!0}})],ho.prototype,"legendOptions",void 0),u([p({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],ho.prototype,"minValue",null),u([p({type:String,json:{write:!0}})],ho.prototype,"normalizationField",void 0),u([p({type:Number,json:{write:!0}})],ho.prototype,"normalizationTotal",void 0),u([p({type:Gk.apiValues,value:null,json:{type:Gk.jsonValues,read:Gk.read,write:Gk.write}})],ho.prototype,"normalizationType",null),u([Ve({classBreaks:"class-breaks"})],ho.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],ho.prototype,"valueExpression",void 0),u([p({type:String,json:{write:!0}})],ho.prototype,"valueExpressionTitle",void 0),ho=Wee=u([A("esri.renderers.ClassBreaksRenderer")],ho);const Qze=ho;let skt=class{constructor(e,i){this._storage=new Fke,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),i&&this._storage.registerRemoveFunc("",i)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,i,r=1){this._storage.put(this,e,i,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}};function nkt(t){return"timeZone"in t}function okt(t){return"timeZone"in t}function akt(t){return"dateFieldsTimeZone"in t}const lkt=new Map;let eUe=class Nz{static fromJSON(e){return new Nz(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new Nz(e.fields??[],Lwe(e))}static fromLayerJSON(e){return new Nz(e.fields??[],Lwe(e))}constructor(e=[],i){var s;this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=i?new Map(i):null;const r=[];for(const n of this.fields){const o=n==null?void 0:n.name,a=Dwe(o);if(o&&a){const l=xx(o);this._fieldsMap.set(o,n),this._fieldsMap.set(l,n),this._normalizedFieldsMap.set(a,n),r.push(`${l}:${n.type}:${(s=this._timeZoneByFieldName)==null?void 0:s.get(o)}`),uAe(n)?(this.dateFields.push(n),this._dateFieldsSet.add(n)):gG(n)&&(this._numericFieldsSet.add(n),this.numericFields.push(n)),tde(n)||ide(n)||(n.editable=n.editable==null||!!n.editable,n.nullable=n.nullable==null||!!n.nullable)}}r.sort(),this.uid=r.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)tde(e)||ide(e)||e.nullable||FXe(e)!==void 0||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===(e==null?void 0:e.uid)}has(e){return this.get(e)!=null}get(e){if(!e)return;let i=this._fieldsMap.get(e);return i||(i=this._fieldsMap.get(xx(e))??this._normalizedFieldsMap.get(Dwe(e)),i&&this._fieldsMap.set(e,i),i)}getTimeZone(e){const i=this.get(e&&typeof e!="string"?e.name:e);return i?this._timeZoneByFieldName?this._timeZoneByFieldName.get(i.name):i.type==="date"||i.type==="esriFieldTypeDate"?(J.getLogger("esri.layers.support.FieldsIndex").errorOnce(new U("getTimeZone:no-timezone-information",`no time zone information for field '${i.name}'`)),Fb):tUe.has(i.type)?wS:null:null}getLuxonTimeZone(e){const i=this.getTimeZone(e);return i?i===wS?jp.instance:i===Fb?xa.utcInstance:tw(lkt,i,()=>au.create(i)):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return WXe(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){var i;return((i=this.get(e))==null?void 0:i.name)??void 0}toJSON(){return{fields:this.fields.map(e=>ee.isSerializable(e)?e.toJSON():e),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}};function xx(t){return t.trim().toLowerCase()}function Dwe(t){var e;return((e=SXe(t))==null?void 0:e.toLowerCase())??""}const tUe=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function Lwe(t){const e=new Map;if(!t.fields)return e;const i=t.datesInUnknownTimezone===!0,{timeInfo:r,editFieldsInfo:s}=t,n=(r?"startField"in r?r.startField:r.startTimeField:"")??"",o=(r?"endField"in r?r.endField:r.endTimeField:"")??"",a=akt(t)?t.dateFieldsTimeZone??null:t.dateFieldsTimeReference?M4(t.dateFieldsTimeReference):null,l=s?nkt(s)?s.timeZone??a:s.dateFieldsTimeReference?M4(s.dateFieldsTimeReference):a??Fb:null,c=r?okt(r)?r.timeZone??a:r.timeReference?M4(r.timeReference):a:null,h=new Map([[xx((s==null?void 0:s.creationDateField)??""),l],[xx((s==null?void 0:s.editDateField)??""),l],[xx(n),c],[xx(o),c]]);for(const{name:d,type:f}of t.fields)if(tUe.has(f))e.set(d,wS);else if(f!=="date"&&f!=="esriFieldTypeDate")e.set(d,null);else if(i)e.set(d,wS);else{const m=h.get(xx(d??""))??a;e.set(d,m)}return e}const ckt={color:[128,128,128,1],outlinecolor:[0,0,0,1],backgroundcolor:[128,128,128,1],borderlinecolor:[0,0,0,1],tintcolor:[255,255,255,1]},Zee={CIMVectorMarker:{scalesymbolsproportionally:!1,respectframe:!0,anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMPictureMarker:{scalex:1,texturefilter:"Draft",anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMTextSymbol:{angle:0,anglex:0,angley:0,halosize:1,height:10,horizontalalignment:"Left",kerning:!0,letterspacing:0,letterwidth:100,ligatures:!0,linegap:0,offsetx:0,offsety:0,strikethrough:!1,textcase:"Normal",textstring:"",underline:!1,verticalalignment:"Bottom",enable:!0,colorlocked:!1},CIMSolidStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMPictureStroke:{texturefilter:"Draft",capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMGradientStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1,gradientMethod:"AcrossLine",gradientSize:75,gradientSizeUnits:hV.Relative,gradientType:"Discrete",interval:5},CIMSolidFill:{enable:!0,colorlocked:!1},CIMPictureFill:{offsetx:0,offsety:0,rotation:0,scalex:1,height:10,texturefilter:"Draft",enable:!0,colorlocked:!1},CIMHatchFill:{offsetx:0,offsety:0,rotation:0,separation:4,enable:!0,colorlocked:!1},CIMGradientFill:{enable:!0,angle:90,gradientMethod:"Linear",gradientSize:75,gradientSizeUnits:hV.Relative,gradientType:"Discrete",interval:5},CIMGeometricEffectAddControlPoints:{angletolerance:120},CIMGeometricEffectArrow:{arrowtype:"OpenEnded",width:5},CIMGeometricEffectBuffer:{size:1},CIMGeometricEffectCut:{begincut:1,endcut:1,middlecut:0,invert:!1},CIMGeometricEffectDashes:{customendingoffset:0,linedashending:"NoConstraint",offsetalongline:0},CIMGeometricEffectDonut:{method:"Mitered",option:"Accurate",width:2},CIMGeometricEffectJog:{angle:225,length:20,position:50},CIMGeometricEffectControlMeasureLine:{rule:"FullGeometry"},CIMGeometricEffectMove:{offsetx:1,offsety:-1},CIMGeometricEffectOffset:{method:"Square",offset:1,option:"Fast"},CIMGeometricEffectRotate:{angle:15},CIMGeometricEffectScale:{xscalefactor:1.15,yscalefactor:1.15},CIMGeometricEffectWave:{amplitude:2,period:3,seed:1,waveform:"Sinus"},CIMMarkerPlacementAlongLine:{customendingoffset:0,endings:"WithHalfGap",offsetalongline:0,placeperpart:!0,angletoline:!0,offset:0},CIMMarkerPlacementAtExtremities:{extremityplacement:"Both",offsetalongline:0,angletoline:!0,offset:0},CIMMarkerPlacementAtRatioPositions:{beginposition:0,endposition:0,flipfirst:!0,angletoline:!0,offset:0},CIMMarkerPlacementInsidePolygon:{gridangle:0,gridtype:"Fixed",offsetx:0,offsety:0,randomness:100,seed:0,shiftoddrows:!1,stepx:16,stepy:16,clipping:"ClipAtBoundary"},CIMMarkerPlacementOnLine:{relativeto:"LineMiddle",startpointoffset:0,angletoline:!0,offset:0},CIMMarkerPlacementOnVertices:{placeperpart:!0,placeoncontrolpoints:!0,placeonendpoints:!0,placeonregularvertices:!0,angletoline:!0,offset:0},CIMMarkerPlacementPolygonCenter:{method:"OnPolygon",offsetx:0,offsety:0,clipatboundary:!1},CIMAnimatedSymbolProperties:{playanimation:!1,reverseanimation:!1,randomizestarttime:!1,randomizestartseed:0,starttimeoffset:0,duration:3,endingduration:3,useendingduration:!1,repeattype:nQ.Loop,repeatdelay:0,easing:oQ.Linear},CIMSymbolAnimationSize:{tosize:10},CIMSymbolAnimationScale:{scalefactor:1},CIMSymbolAnimationColor:{tocolor:[255,255,255,1]},CIMSymbolAnimationTransparency:{totransparency:0},CIMSymbolAnimationRotation:{torotation:0,rotateclockwise:!1},CIMSymbolAnimationOffset:{offsetx:0,offsety:0}};function ukt(t){return typeof t=="function"}function gfi(t,e,i,r){return ukt(t)?t(e,i,r):t}function yfi(t){return[t.r,t.g,t.b,t.a]}const hkt=` /-,
`;function Nwe(t){let e=t.length;for(;e--;)if(!hkt.includes(t.charAt(e)))return!1;return!0}function vfi(t,e){const i=[];let r=0,s=-1;do if(s=t.indexOf("[",r),s>=r){if(s>r){const n=t.slice(r,s);i.push([n,null,Nwe(n)])}if(r=s+1,s=t.indexOf("]",r),s>=r){if(s>r){const n=e[t.slice(r,s)];n&&i.push([null,n,!1])}r=s+1}}while(s!==-1);if(r<t.length){const n=t.slice(r);i.push([n,null,Nwe(n)])}return i}function _fi(t,e,i,r){let s="",n=null;for(const o of e){const[a,l,c]=o;if(a)c?n=a:(n&&(s+=n,n=null),s+=a);else{let h=l;i!=null&&(h=iUe(l,i));const d=t.attributes[h];d&&(n&&(s+=n,n=null),s+=d)}}return dkt(s,r)}function dkt(t,e){switch(typeof t!="string"&&(t=String(t)),e){case"LowerCase":return t.toLowerCase();case"Allcaps":return t.toUpperCase();default:return t}}function bfi(t,e,i,r,s,n,o=!0){const a=e/s,l=i/n,c=Math.ceil(a/2),h=Math.ceil(l/2);for(let d=0;d<n;d++)for(let f=0;f<s;f++){const m=4*(f+(o?n-d-1:d)*s);let g=0,v=0,_=0,b=0,w=0,x=0,S=0;const C=(d+.5)*l;for(let T=Math.floor(d*l);T<(d+1)*l;T++){const M=Math.abs(C-(T+.5))/h,I=(f+.5)*a,D=M*M;for(let P=Math.floor(f*a);P<(f+1)*a;P++){let F=Math.abs(I-(P+.5))/c;const L=Math.sqrt(D+F*F);L>=-1&&L<=1&&(g=2*L*L*L-3*L*L+1,g>0&&(F=4*(P+T*e),S+=g*t[F+3],_+=g,t[F+3]<255&&(g=g*t[F+3]/250),b+=g*t[F],w+=g*t[F+1],x+=g*t[F+2],v+=g))}}r[m]=b/v,r[m+1]=w/v,r[m+2]=x/v,r[m+3]=S/_}}function pkt(t){return t?[t[0],t[1],t[2],t[3]/255]:[0,0,0,0]}function wfi(t){var e;return((e=t.data)==null?void 0:e.symbol)??null}function xfi(t){return t.type==="CIMVectorMarker"||t.type==="CIMPictureMarker"||t.type==="CIMBarChartMarker"||t.type==="CIMCharacterMarker"||t.type==="CIMPieChartMarker"||t.type==="CIMStackedBarChartMarker"}function Sfi(t){return t.type==="CIMGradientStroke"||t.type==="CIMPictureStroke"||t.type==="CIMSolidStroke"}function Tfi(t){return t!=null&&(t.type==="CIMGradientFill"||t.type==="CIMHatchFill"||t.type==="CIMPictureFill"||t.type==="CIMSolidFill"||t.type==="CIMWaterFill")}function fkt(t){return t!=null&&(t.type==="CIMMarkerPlacementAlongLineRandomSize"||t.type==="CIMMarkerPlacementAlongLineSameSize"||t.type==="CIMMarkerPlacementAlongLineVariableSize"||t.type==="CIMMarkerPlacementAtExtremities"||t.type==="CIMMarkerPlacementAtMeasuredUnits"||t.type==="CIMMarkerPlacementAtRatioPositions"||t.type==="CIMMarkerPlacementOnLine"||t.type==="CIMMarkerPlacementOnVertices")}const Efi=(t,e=0)=>t==null||isNaN(t)?e:t,Cfi=(t,e)=>t??e,$fi=(t,e)=>t??e,Afi=t=>t.tintColor?pkt(t.tintColor):[255,255,255,1],Mfi=t=>{if(!t)return!1;for(const e of t)switch(e.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function Ofi(){return G(()=>import("./geometryEngineJSON-Bvf5zUh7.js").then(t=>t.g),__vite__mapDeps([10,11,3,12]))}function Ifi(t){if(!t)return"normal";switch(t.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function Rfi(t){if(!t)return"normal";switch(t.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function Pfi(t){let e="normal",i="normal";if(t){const r=t.toLowerCase();r.includes("italic")?e="italic":r.includes("oblique")&&(e="oblique"),r.includes("bold")?i="bold":r.includes("light")&&(i="lighter")}return{style:e,weight:i}}function Dfi(t){return t.underline?"underline":t.strikethrough?"line-through":"none"}function Fwe(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const i=Fwe(e);if(i!=null)return i}break;case"CIMTextSymbol":return Fwe(t.symbol);case"CIMSolidFill":return t.color}return null}function kwe(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const e=t.symbolLayers;if(e)for(const i of e){const r=kwe(i);if(r!=null)return r}break}case"CIMTextSymbol":return kwe(t.symbol);case"CIMSolidStroke":return t.color}}function zwe(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const i=zwe(e);if(i!==void 0)return i}break;case"CIMTextSymbol":return zwe(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}}function Lfi(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function Nfi(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function Ffi(t){return(t?Object.keys(t):[]).map(e=>({name:e,alias:e,type:typeof t[e]=="string"?"esriFieldTypeString":"esriFieldTypeDouble"}))}const kfi=t=>t.includes("data:image/svg+xml");function zfi(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function _le(t){return t&&t.charAt(0).toLowerCase()+t.slice(1)}function Ufi(t,e,i,r,s,n,o=!0){const{infos:a}=n;let l=1,c=0,h=0,d=0,f=1;for(const{absoluteAnchorPoint:v,offsetX:_,offsetY:b,rotation:w,size:x,frameHeight:S,rotateClockWise:C,scaleSymbolsProportionally:T}of a)f=v?1:l,h=Bwe(_,b,c,f,h),d=Uwe(_,b,c,f,d),S&&(T||o)&&(l*=x/S),c=Vwe(w,C,c);const m=Bwe(r,s,c,f,h),g=Uwe(r,s,c,f,d);return{size:t*l,rotation:Vwe(e,i,c),offsetX:m,offsetY:g}}function mkt(t){if(t==null)return!1;if(Array.isArray(t))return t.every(e=>mkt(e));switch(typeof t){case"string":return!!t;case"number":return!isNaN(t)}}function gkt(t,e){if(e==="color"||e==="outlinecolor"||e==="backgroundcolor"||e==="borderlinecolor"||e==="tintcolor")return[...ckt[e]];const i=Zee[t];if(!i)throw new Error(`InternalError: default value for type ${t}.`);return i[e]}function ykt(t){return t.split(" ").map(e=>Number(e))}function vkt(t){return typeof t=="string"?ykt(t):t}function Bfi(t){return t!=null&&t.dashTemplate&&(t.dashTemplate=vkt(t.dashTemplate)),t}function Yee(t){if(t==null)return"Normal";switch(t.type){case"CIMTextSymbol":return t.textCase??"Normal";case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const e=t.symbolLayers;if(!e)return"Normal";for(const i of e)if(i.type==="CIMVectorMarker")return Yee(i)}break;case"CIMVectorMarker":{const e=t.markerGraphics;if(!e)return"Normal";for(const i of e)if(i.symbol)return Yee(i.symbol)}}return"Normal"}function Vfi(t){if(t)switch(t.type){case"CIMTextSymbol":return t.height;case"CIMPointSymbol":{let e=0;if(t.symbolLayers){for(const i of t.symbolLayers)if(i)switch(i.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const r=i.size??Zee.CIMVectorMarker.size;r>e&&(e=r);break}}}return e}case"CIMLineSymbol":case"CIMPolygonSymbol":{let e=0;if(t.symbolLayers){for(const i of t.symbolLayers)if(i)switch(i.type){case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const r=i.width;r!=null&&r>e&&(e=r);break}case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":if(i.markerPlacement&&fkt(i.markerPlacement)){const r=i.size??Zee.CIMVectorMarker.size;r>e&&(e=r)}break;case"CIMPictureFill":{const r=i.height;r!=null&&r>e&&(e=r)}}}return e}}}function iUe(t,e){if(e!==null){const i=e.get(t);return i?i.name:t}return t}function jfi(t){return t.map(e=>({...e,propertyName:_le(e.propertyName)}))}function Gfi(t){const e={};for(const i in t){const r=t[i];e[_le(i)]=r}return e}function Uwe(t,e,i,r,s){const n=i*Math.PI/180;if(n){const o=Math.cos(n);return(Math.sin(n)*t+o*e)*r+s}return e*r+s}function Bwe(t,e,i,r,s){const n=i*Math.PI/180;return n?(Math.cos(n)*t-Math.sin(n)*e)*r+s:t*r+s}function Vwe(t,e,i){return e?i-t:i+t}function Hfi(t,e,i){const r=i==="Color"||i==="TintColor"||i==="ToColor",s=i==="Rotation"||i==="Angle"||i==="ToRotation";let n=e[_le(i)];if(n!=null&&(r?n=[n[0]/255,n[1]/255,n[2]/255,n[3]/255]:s&&(n*=Math.PI/180)),n==null&&(n=gkt(e.type,i.toLowerCase()),n!=null&&(r?n=[n[0]/255,n[1]/255,n[2]/255,n[3]]:s&&(n*=Math.PI/180))),e.primitiveName!=null){const o=t[e.primitiveName];if(o!=null){const a=o[i];a==null||(typeof a=="string"||typeof a=="number"||Array.isArray(a)?(n=a,n!=null&&(r?n=[n[0]/255,n[1]/255,n[2]/255,n[3]/255]:s&&(n*=Math.PI/180))):(n={valueExpressionInfo:a,defaultValue:n},n!=null&&(r?n={type:"Process",op:"ArcadeColor",value:n}:s&&(n={type:"Process",op:"Divide",left:n,right:180/Math.PI}))))}}if(n==null)throw new Error(`Failed to derive a value or an expression for "${i}".`);return n}function qfi(t,e){return Math.max(Math.min((t??e)/100,1),0)}const jwe="esri.renderers.support.DictionaryLoader",_kt={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let rUe=class{constructor(e,i,r){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new skt(100),this._dictionaryVersion=null,this._fieldIndex=null,this._dictionaryPromise=null,this.url=e,this.config=i,this.fieldMap=r}getSymbolFields(){return this._symbolFields}async getSymbolAsync(e,i){var d;let r;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(i));try{r=await this._dictionaryPromise}catch(f){if(es(f))return this._dictionaryPromise=null,null}const s=(d=this._dictionaryVersion)==null?void 0:d.greaterEqual(4,0),n={};if(this.fieldMap)for(const f of this._symbolFields){const m=iUe(this.fieldMap[f],this._fieldIndex);if(m){const g=e.attributes[m];n[f]=s?g:g!=null?""+e.attributes[m]:""}else n[f]=""}let o=null;try{o=r==null?void 0:r(n,i)}catch{return null}if(!o||typeof o!="string"||o==="invalid")return null;const a=o.split(";"),l=[],c=[];for(let f=0;f<a.length;f++){const m=a[f];if(m){if(m.includes("po:")){const g=m.slice(3).split("|");if(g.length===3){const v=g[0],_=g[1];let b=g[2];const w="countrylabel";if(v===w&&_==="TextString"){if(this.fieldMap!=null){let x=this.fieldMap[w];x==null&&(x=w,this.fieldMap[x]=x),e.attributes[x]=b}continue}if(_==="DashTemplate")b=b.split(" ").map(x=>Number(x));else if(_==="Color"){const x=new Je(b).toRgba();b=[x[0],x[1],x[2],255*x[3]]}else b=Number(b);c.push({primitiveName:v,propertyName:_,value:b,defaultValue:null})}}else if(m.includes("|")){for(const g of m.split("|"))if(this._itemNames.has(g)){l.push(g);break}}else if(this._itemNames.has(m))l.push(m);else if(f===0){l.length=0;let g="Invalid_P";e.geometry!=null&&(wb(e.geometry)?g="Invalid_A":Jj(e.geometry)&&(g="Invalid_L")),l.push(g);break}}}const h=e.geometry==null||!e.geometry.hasZ&&e.geometry.type==="point";return this._cimPartsToCIMSymbol(e,l,c,h,i)}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void J.getLogger(jwe).error("no valid URL!");const i=Ri(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:e!=null?e.signal:null}),[{data:r}]=await Promise.all([i,bv()]);if(!r)throw this._dictionaryPromise=null,new U("esri.renderers.DictionaryRenderer","Bad dictionary data!");const{authoringInfo:s,dictionary_version:n,expression:o,itemsNames:a}=r,l=o;let c=!1;n&&(this._dictionaryVersion=gL.parse(n),c=this._dictionaryVersion.greaterEqual(4,0)),this._refSymbolUrlTemplate=this.url+"/"+r.cimRefTemplateUrl,this._itemNames=new Set(a),this._symbolFields=s.symbol;const h={};if(this.config){const m=this.config;for(const g in m)h[g]=m[g]}if(s.configuration)for(const m of s.configuration)h.hasOwnProperty(m.name)||(h[m.name]=m.value);const d=[];if(e!=null&&e.fields&&this.fieldMap)for(const m in this.fieldMap){const g=this.fieldMap[m],v=e.fields.filter(_=>_.name.toLowerCase()===(g==null?void 0:g.toLowerCase()));v.length>0&&d.push({...v[0],type:c?v[0].type:"esriFieldTypeString"})}d.length>0&&(this._fieldIndex=new eUe(d));const f=bXe(l,e!=null?e.spatialReference:null,d,h).then(m=>{const g={scale:0};return(v,_)=>{if(m==null)return null;const b=m.repurposeFeature({geometry:null,attributes:v});return g.scale=_!=null?_.scale??void 0:void 0,m.evaluate({$feature:b,$view:g},m.services)}}).catch(m=>(J.getLogger(jwe).error("Creating dictionary expression failed:",m),null));return this._dictionaryPromise=f,f}async _cimPartsToCIMSymbol(e,i,r,s,n){const o=new Array(i.length);for(let c=0;c<i.length;c++)o[c]=this._getSymbolPart(i[c],n);let a=await Promise.all(o);const l=this.fieldMap;if(l&&a.length>0){const{OverrideHelper:c}=await G(()=>import("./OverrideHelper-2qszNNyl.js"),__vite__mapDeps([143,144]));a=q(a);for(const h of a)c.applyDictionaryTextOverrides(h,e,l,this._fieldIndex,Yee(h))}return new nw({data:bkt(a,r,s)})}async _getSymbolPart(e,i){const r=this._symbolCache.get(e);if(r)return r;if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then(o=>o.data);const s=this._refSymbolUrlTemplate.replaceAll(/\{itemName\}/gi,e),n=Ri(s,{responseType:"json",query:{f:"json"},...i});this._ongoingRequests.set(e,n),n.finally(()=>this._ongoingRequests.delete(e));try{const o=await n;return this._symbolCache.put(e,o.data),o.data}catch(o){throw o}}};function bkt(t,e,i){if(!t||t.length===0)return null;const r={...t[0]};if(t.length>1){r.effects=null,r.symbolLayers=[];for(const s of t){const n=s;if(n.effects!=null)for(const o of n.symbolLayers)o.effects==null?o.effects=n.effects:o.effects.unshift(...n.effects);r.symbolLayers.unshift(...n.symbolLayers)}}return i&&(r.callout=_kt),{type:"CIMSymbolReference",symbol:r,primitiveOverrides:e}}var Jee;let $p=Jee=class extends EM(Kv){constructor(t){super(t),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new rUe(this.url,this.config,this.fieldMap)}writeData(t,e){t&&(e.scalingExpressionInfo={expression:t,returnType:"number"})}writeVisualVariables(t,e,i,r){r!=null&&r.origin||super.writeVisualVariables(t,e,i,r)}clone(){return new Jee({config:q(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:q(this.fieldMap),url:q(this.url),visualVariables:q(this.visualVariables)})}async getSymbolAsync(t,e){return this._loader.getSymbolAsync(t,e)}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e),this.scaleExpression&&await Rl(t,e,this.scaleExpression);for(const i in this.fieldMap){const r=this.fieldMap[i];e.has(r)&&t.add(r)}}get arcadeRequired(){return!0}getSymbol(){return null}get symbols(){return[]}getAttributeHash(){var t;return((t=this.visualVariables)==null?void 0:t.reduce((e,i)=>e+i.getAttributeHash(),""))??""}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};u([p({type:rUe})],$p.prototype,"_loader",null),u([p({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],$p.prototype,"config",void 0),u([p({type:Object,json:{write:!0}})],$p.prototype,"fieldMap",void 0),u([p({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],$p.prototype,"scaleExpression",void 0),u([_e("scaleExpression")],$p.prototype,"writeData",null),u([p({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(t){return{enabled:!!t&&!!this.scaleExpression}}}}})],$p.prototype,"scaleExpressionTitle",void 0),u([p({type:String,json:{write:!0}})],$p.prototype,"url",void 0),u([_e("visualVariables")],$p.prototype,"writeVisualVariables",null),$p=Jee=u([A("esri.renderers.DictionaryRenderer")],$p);const wkt=$p;var Xee;let Ty=Xee=class extends ee{constructor(t){super(t),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(t){return t==null?t:typeof t=="function"?(J.getLogger(this).error(".field: field must be a string value"),null):DD(t)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){var t;return new Xee({color:(t=this.color)==null?void 0:t.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([p({type:Je,json:{type:[Number],write:!0}})],Ty.prototype,"color",void 0),u([p({type:String,json:{write:!0}})],Ty.prototype,"field",void 0),u([ti("field")],Ty.prototype,"castField",null),u([p({type:String,json:{write:!0}})],Ty.prototype,"label",void 0),u([p({type:String,json:{write:!0}})],Ty.prototype,"valueExpression",void 0),u([p({type:String,json:{write:!0}})],Ty.prototype,"valueExpressionTitle",void 0),Ty=Xee=u([A("esri.renderers.support.AttributeColorInfo")],Ty);const sUe=Ty;var Kee;let Fz=Kee=class extends ee{constructor(){super(...arguments),this.unit=null}clone(){return new Kee({unit:this.unit})}};u([p({type:String,json:{write:!0}})],Fz.prototype,"unit",void 0),Fz=Kee=u([A("esri.renderers.support.DotDensityLegendOptions")],Fz);const xkt=Fz;var Qee;let Oc=Qee=class extends EM(Kv){constructor(t){super(t),this.attributes=null,this.backgroundColor=new Je([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new mh,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(t){if(this.referenceScale==null)return this.dotValue;const e=t/this.referenceScale*this.dotValue;return e<1?1:e}getSymbol(){return new rT({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol()]}getAttributeHash(){var t;return((t=this.attributes)==null?void 0:t.reduce((e,i)=>e+i.getAttributeHash(),""))??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new Qee({attributes:q(this.attributes),backgroundColor:q(this.backgroundColor),dotBlendingEnabled:q(this.dotBlendingEnabled),dotShape:q(this.dotShape),dotSize:q(this.dotSize),dotValue:q(this.dotValue),legendOptions:q(this.legendOptions),outline:q(this.outline),referenceScale:q(this.referenceScale),seed:q(this.seed),visualVariables:q(this.visualVariables),authoringInfo:q(this.authoringInfo)})}getControllerHash(){var e;return`${(e=this.attributes)==null?void 0:e.map(i=>i.field||i.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e);for(const i of this.attributes??[])i.valueExpression&&await Rl(t,e,i.valueExpression),i.field&&t.add(i.field)}};u([p({type:[sUe],json:{write:!0}})],Oc.prototype,"attributes",void 0),u([p({type:Je,json:{write:!0}})],Oc.prototype,"backgroundColor",void 0),u([p({type:Boolean,json:{write:!0}})],Oc.prototype,"dotBlendingEnabled",void 0),u([p({type:String,json:{write:!1}})],Oc.prototype,"dotShape",void 0),u([p({type:Number,json:{write:!0}})],Oc.prototype,"dotSize",void 0),u([p({type:xkt,json:{write:!0}})],Oc.prototype,"legendOptions",void 0),u([p({type:mh,json:{default:null,write:!0}})],Oc.prototype,"outline",void 0),u([p({type:Number,json:{write:!0}})],Oc.prototype,"dotValue",void 0),u([p({type:Number,json:{write:!0}})],Oc.prototype,"referenceScale",void 0),u([p({type:Number,json:{write:!0}})],Oc.prototype,"seed",void 0),u([Ve({dotDensity:"dot-density"})],Oc.prototype,"type",void 0),Oc=Qee=u([A("esri.renderers.DotDensityRenderer")],Oc);const Skt=Oc;var ete;let PR=ete=class extends ee{constructor(t){super(t),this.color=null,this.ratio=null}clone(){return new ete({color:this.color&&this.color.clone(),ratio:this.ratio})}};u([p({type:Je,json:{type:[Ii],default:null,write:{isRequired:!0}}})],PR.prototype,"color",void 0),u([p({type:Number,json:{write:{isRequired:!0}}})],PR.prototype,"ratio",void 0),PR=ete=u([A("esri.renderers.support.HeatmapColorStop")],PR);const kz=PR;let U2=class extends Nt.ClonableMixin(ee){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};u([p({type:String,json:{write:!0}})],U2.prototype,"minLabel",void 0),u([p({type:String,json:{write:!0}})],U2.prototype,"maxLabel",void 0),u([p({type:String,json:{write:!0}})],U2.prototype,"title",void 0),U2=u([A("esri.renderers.support.HeatmapLegendOptions")],U2);const ble=2.4;function Tkt(t){return Rd(t*ble)}function Ekt(t){return xS(t)/ble}function Ckt(t,e,i,r){let{color:s,ratio:n}=e,{color:o,ratio:a}=i;a===n&&(a===1?n-=1e-6:a+=1e-6);const l=ue((r-n)/(a-n),0,1);VG(t,s.toArray(),o.toArray(),l)}function Yfi(t){const i=new Uint8ClampedArray(2048);if(t=t.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),t.length<1)return i;let r=t[0],s=t[0],n=1;const o=yi();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>s.ratio&&n<t.length;)r=s,s=t[n++];Ckt(o,r,s,l),i.set(o,4*a)}return i}function Jfi(t,e,i){const r=Math.sqrt(t**2+e**2)/i;return r>1?0:3/(Math.PI*i**2)*(1-r**2)**2}function Xfi(t){return typeof t=="function"?t:t?e=>+e[t]:()=>1}var tte;function Gwe(t){if(t!=null){const{maxDensity:e,minDensity:i,radius:r}=t;if(e!=null||i!=null||r!=null){const{blurRadius:s,maxPixelIntensity:n,minPixelIntensity:o,...a}=t;return a}}return t}let ua=tte=class extends Kv{constructor(t){super(t),this.authoringInfo=null,this.colorStops=[new kz({ratio:0,color:new Je("rgba(255, 140, 0, 0)")}),new kz({ratio:.75,color:new Je("rgba(255, 140, 0, 1)")}),new kz({ratio:.9,color:new Je("rgba(255, 0,   0, 1)")})],this.field=null,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null}normalizeCtorArgs(t){return Gwe(t)}get blurRadius(){return Ekt(this.radius)}set blurRadius(t){const e=this.maxPixelIntensity,i=this.minPixelIntensity;this._set("radius",Tkt(t)),this._set("maxDensity",e*this._pixelIntensityToDensity),this._set("minDensity",i*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(t){this._set("maxDensity",t*this._pixelIntensityToDensity)}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(t){this._set("minDensity",t*this._pixelIntensityToDensity)}get _pixelIntensityToDensity(){return 24/(ble**2*this.blurRadius**4)}read(t,e){t=Gwe(t),super.read(t,e)}getSymbol(){return new _g}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol()]}async collectRequiredFields(t,e){const i=this.field,r=this.valueExpression;i&&typeof i=="string"&&dc(t,e,i),r&&typeof r=="string"&&await Rl(t,e,r)}getAttributeHash(){return""}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new tte({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:q(this.colorStops),field:this.field,legendOptions:q(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([p({type:nle,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],ua.prototype,"authoringInfo",void 0),u([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],ua.prototype,"blurRadius",null),u([p({type:[kz],json:{write:{isRequired:!0}}})],ua.prototype,"colorStops",void 0),u([p({type:String,json:{write:!0}})],ua.prototype,"field",void 0),u([p({type:U2,json:{write:!0}})],ua.prototype,"legendOptions",void 0),u([p({type:Number,json:{write:!0}})],ua.prototype,"maxDensity",void 0),u([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],ua.prototype,"maxPixelIntensity",null),u([p({type:Number,json:{write:!0}})],ua.prototype,"minDensity",void 0),u([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],ua.prototype,"minPixelIntensity",null),u([p({type:Number,cast:or,json:{write:!0}})],ua.prototype,"radius",void 0),u([p({type:Number,range:{min:0},json:{default:0,write:!0}})],ua.prototype,"referenceScale",void 0),u([Ve({heatmap:"heatmap"})],ua.prototype,"type",void 0),u([p({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],ua.prototype,"valueExpression",void 0),u([p({type:String})],ua.prototype,"valueExpressionTitle",void 0),u([p({readOnly:!0})],ua.prototype,"_pixelIntensityToDensity",null),ua=tte=u([A("esri.renderers.HeatmapRenderer")],ua);const nUe=ua;let Sx=class extends Nt.ClonableMixin(ee){constructor(){super(...arguments),this.color=new Je([0,0,0,0]),this.label=null,this.threshold=0}};u([p({type:Je,json:{write:!0}})],Sx.prototype,"color",void 0),u([p({type:String,json:{write:!0}})],Sx.prototype,"label",void 0),u([p({type:Number,range:{min:0,max:1},json:{write:!0}})],Sx.prototype,"threshold",void 0),Sx=u([A("esri.renderers.support.OthersCategory")],Sx);const $kt={base:TM,key:"type",typeMap:{size:rH,opacity:ole}};let Ic=class extends EM(Nt.ClonableMixin(Kv)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new Je([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new Sx,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart",this.visualVariables=null}getSymbol(){var e;return new _g({size:this.size?this.size/2+(((e=this.outline)==null?void 0:e.width)||0):0})}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(df)}getAttributeHash(){var e;return((e=this.visualVariables)==null?void 0:e.reduce((i,r)=>i+r.getAttributeHash(),""))??""}getMeshHash(){return this.symbols.reduce((e,i)=>e+JSON.stringify(i),"")}async collectRequiredFields(e,i){await this.collectVVRequiredFields(e,i);for(const r of this.attributes)r.valueExpression&&await Rl(e,i,r.valueExpression),r.field&&e.add(r.field)}};u([p({type:[sUe],json:{write:!0}})],Ic.prototype,"attributes",void 0),u([p(ule)],Ic.prototype,"backgroundFillSymbol",void 0),u([p({type:Je,json:{write:!0}})],Ic.prototype,"defaultColor",void 0),u([p({type:String,json:{write:!0}})],Ic.prototype,"defaultLabel",void 0),u([p({type:Number,range:{min:0,max:1},json:{write:!0}})],Ic.prototype,"holePercentage",void 0),u([p({type:Sx,json:{write:!0}})],Ic.prototype,"othersCategory",void 0),u([p({type:hle,json:{write:!0}})],Ic.prototype,"legendOptions",void 0),u([p({type:mh,json:{default:null,write:!0}})],Ic.prototype,"outline",void 0),u([p({type:Number,cast:or,json:{write:!0}})],Ic.prototype,"size",void 0),u([Ve({pieChart:"pie-chart"})],Ic.prototype,"type",void 0),u([p({types:[$kt]})],Ic.prototype,"visualVariables",void 0),Ic=u([A("esri.renderers.PieChartRenderer")],Ic);const Akt=Ic,WL={key:"type",base:Kv,typeMap:{heatmap:nUe,simple:pv,"unique-value":dle,"class-breaks":Qze,"dot-density":Skt,dictionary:wkt,"pie-chart":Akt},errorContext:"renderer"},Mkt={key:"type",base:Kv,typeMap:{simple:pv,"unique-value":dle,"class-breaks":Qze,heatmap:nUe},errorContext:"renderer",validate:Okt};function Okt(t){switch(t.type){case"simple":return Ikt(t);case"unique-value":return Rkt(t);case"class-breaks":return Pkt(t);case"heatmap":return t}}function Ikt(t){if(t.symbol)return t;J.getLogger("esri.renderers.support.types").error("Removed invalid 'simple' renderer without a symbol from web scene.")}function Rkt(t){const e=t.uniqueValueInfos,i=e==null?void 0:e.filter(({symbol:r,label:s},n)=>(r||J.getLogger("esri.renderers.support.types").error(`Removed invalid unique value info ([${n}] ${s}) without a symbol from web scene.`),!!r));return(i==null?void 0:i.length)!==(e==null?void 0:e.length)&&(t.uniqueValueInfos=i),t}function Pkt(t){const e=t.classBreakInfos,i=e==null?void 0:e.filter(({symbol:r,label:s},n)=>(r||J.getLogger("esri.renderers.support.types").error(`Removed invalid class break info ([${n}] ${s}) without a symbol from web scene.`),!!r));return(i==null?void 0:i.length)!==(e==null?void 0:e.length)&&(t.classBreakInfos=i),t}function emi(t,e){return gD(t,null,e)}const Dkt=qA({types:WL});function gD(t,e,i){return t?t&&(t.styleName||t.styleUrl)&&t.type!=="uniqueValue"?(i!=null&&i.messages&&i.messages.push(new ch("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+t.type+"'",{definition:t,context:i})),null):Dkt(t,e,i):null}var ite;let ml=ite=class extends Mb{constructor(t){super(t),this.type="binning",this.binType="geohash",this.fixedBinLevel=null,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.size=or("12px"),this.fields=[],this.renderer=null}writeFields(t,e,i){const r=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());ro(i,r,e)}readRenderer(t,e,i){var s;const r=(s=e.drawingInfo)==null?void 0:s.renderer;return r?gD(r,e,i)??void 0:mle(e,i)}clone(){return new ite({fields:q(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:q(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:q(this.popupTemplate),renderer:q(this.renderer),binType:q(this.binType),size:this.size})}};u([Ve({binning:"binning"})],ml.prototype,"type",void 0),u([Ve({geohash:"geohash",square:"square"}),p({type:["geohash","square"]})],ml.prototype,"binType",void 0),u([p({type:Number,json:{write:!0}})],ml.prototype,"fixedBinLevel",void 0),u([p({type:[qL],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],ml.prototype,"labelingInfo",void 0),u([p(iH)],ml.prototype,"labelsVisible",void 0),u([p({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],ml.prototype,"maxScale",void 0),u([p(tH)],ml.prototype,"popupEnabled",void 0),u([p({type:oM,json:{name:"popupInfo",write:!0}})],ml.prototype,"popupTemplate",void 0),u([p({cast:t=>t==="auto"?t:rc(or(t))})],ml.prototype,"size",void 0),u([p({type:[Kb],json:{write:!0}})],ml.prototype,"fields",void 0),u([_e("fields")],ml.prototype,"writeFields",null),u([p({types:WL,json:{write:{target:"drawingInfo.renderer"}}})],ml.prototype,"renderer",void 0),u([ve("renderer",["drawingInfo.renderer"])],ml.prototype,"readRenderer",null),ml=ite=u([A("esri.layers.support.FeatureReductionBinning")],ml);const oUe=ml;var rte;function Hwe(t){var e;return t.type==="simple"&&!((e=t.visualVariables)!=null&&e.length)}let po=rte=class extends ee{constructor(t){super(t),this.type="cluster",this.clusterRadius=or("80px"),this.clusterMinSize=or("12px"),this.clusterMaxSize=or("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=[]}readRenderer(t,e,i){var s,n;const r=(s=e.drawingInfo)==null?void 0:s.renderer;return(n=r==null?void 0:r.authoringInfo)!=null&&n.isAutoGenerated?null:r?Hwe(r)?null:gD(r,e,i)??void 0:mle(e,i)}readSymbol(t,e,i){var s,n;const r=(s=e.drawingInfo)==null?void 0:s.renderer;if((n=r==null?void 0:r.authoringInfo)!=null&&n.isAutoGenerated)return null;if(r&&Hwe(r)){const o=gD(r,e,i);return o==null?void 0:o.symbol}return null}writeSymbol(t,e,i,r){var n,o;const s=(o=(n=this.renderer)==null?void 0:n.authoringInfo)==null?void 0:o.isAutoGenerated;if(!this.renderer||s){const a=new pv({symbol:t});e.drawingInfo={renderer:a.write({},r)}}}writeFields(t,e,i){const r=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());ro(i,r,e)}readFields(t,e,i){return t.filter(r=>!r.isAutoGenerated).map(r=>Kb.fromJSON(r))}clone(){return new rte({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:q(this.labelingInfo),labelsVisible:this.labelsVisible,fields:q(this.fields),maxScale:this.maxScale,renderer:q(this.renderer),symbol:q(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:q(this.popupTemplate)})}};u([p({type:["cluster"],readOnly:!0,json:{write:!0}})],po.prototype,"type",void 0),u([p({cast:t=>t==="auto"?t:rc(or(t)),json:{write:!0}})],po.prototype,"clusterRadius",void 0),u([p({type:Number,cast:or,json:{write:!0}})],po.prototype,"clusterMinSize",void 0),u([p({type:Number,cast:or,json:{write:!0}})],po.prototype,"clusterMaxSize",void 0),u([p({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],po.prototype,"maxScale",void 0),u([p(tH)],po.prototype,"popupEnabled",void 0),u([p({type:oM,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],po.prototype,"popupTemplate",void 0),u([p({types:WL,json:{write:{target:"drawingInfo.renderer"}}})],po.prototype,"renderer",void 0),u([ve("renderer",["drawingInfo.renderer"])],po.prototype,"readRenderer",null),u([p({types:pQe})],po.prototype,"symbol",void 0),u([ve("symbol",["drawingInfo.renderer"])],po.prototype,"readSymbol",null),u([_e("symbol")],po.prototype,"writeSymbol",null),u([p({type:[qL],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],po.prototype,"labelingInfo",void 0),u([p(iH)],po.prototype,"labelsVisible",void 0),u([p({type:[Kb],json:{write:!0}})],po.prototype,"fields",void 0),u([_e("fields")],po.prototype,"writeFields",null),u([ve("fields")],po.prototype,"readFields",null),po=rte=u([A("esri.layers.support.FeatureReductionCluster")],po);const aUe=po;var ste;let zz=ste=class extends Mb{constructor(t){super(t),this.type="selection"}clone(){return new ste}};u([p({type:["selection"]})],zz.prototype,"type",void 0),zz=ste=u([A("esri.layers.support.FeatureReductionSelection")],zz);const qwe=zz,Wwe={key:"type",base:Mb,typeMap:{cluster:aUe,binning:oUe}},Lkt={types:{key:"type",base:Mb,typeMap:{selection:qwe,cluster:aUe,binning:oUe}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:Wwe},"portal-item":{types:Wwe},"web-scene":{types:{key:"type",base:Mb,typeMap:{selection:qwe}},name:"layerDefinition.featureReduction",write:{layerContainerTypes:Xs}}}}},TE={Base64:0,Hex:1,String:2,Raw:3},p$=8,lUe=(1<<p$)-1;function mb(t,e){const i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function Nkt(t){const e=[];for(let i=0,r=t.length*p$;i<r;i+=p$)e[i>>5]|=(t.charCodeAt(i/p$)&lUe)<<i%32;return e}function Fkt(t){const e=[];for(let i=0,r=32*t.length;i<r;i+=p$)e.push(String.fromCharCode(t[i>>5]>>>i%32&lUe));return e.join("")}function kkt(t){const e="0123456789abcdef",i=[];for(let r=0,s=4*t.length;r<s;r++)i.push(e.charAt(t[r>>2]>>r%4*8+4&15)+e.charAt(t[r>>2]>>r%4*8&15));return i.join("")}function zkt(t){const e="=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=[];for(let s=0,n=4*t.length;s<n;s+=3){const o=(t[s>>2]>>s%4*8&255)<<16|(t[s+1>>2]>>(s+1)%4*8&255)<<8|t[s+2>>2]>>(s+2)%4*8&255;for(let a=0;a<4;a++)8*s+6*a>32*t.length?r.push(e):r.push(i.charAt(o>>6*(3-a)&63))}return r.join("")}function Ukt(t,e){return t<<e|t>>>32-e}function oH(t,e,i,r,s,n){return mb(Ukt(mb(mb(e,t),mb(r,n)),s),i)}function nl(t,e,i,r,s,n,o){return oH(e&i|~e&r,t,e,s,n,o)}function ol(t,e,i,r,s,n,o){return oH(e&r|i&~r,t,e,s,n,o)}function al(t,e,i,r,s,n,o){return oH(e^i^r,t,e,s,n,o)}function ll(t,e,i,r,s,n,o){return oH(i^(e|~r),t,e,s,n,o)}function Bkt(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;let i=1732584193,r=-271733879,s=-1732584194,n=271733878;for(let o=0;o<t.length;o+=16){const a=i,l=r,c=s,h=n;i=nl(i,r,s,n,t[o],7,-680876936),n=nl(n,i,r,s,t[o+1],12,-389564586),s=nl(s,n,i,r,t[o+2],17,606105819),r=nl(r,s,n,i,t[o+3],22,-1044525330),i=nl(i,r,s,n,t[o+4],7,-176418897),n=nl(n,i,r,s,t[o+5],12,1200080426),s=nl(s,n,i,r,t[o+6],17,-1473231341),r=nl(r,s,n,i,t[o+7],22,-45705983),i=nl(i,r,s,n,t[o+8],7,1770035416),n=nl(n,i,r,s,t[o+9],12,-1958414417),s=nl(s,n,i,r,t[o+10],17,-42063),r=nl(r,s,n,i,t[o+11],22,-1990404162),i=nl(i,r,s,n,t[o+12],7,1804603682),n=nl(n,i,r,s,t[o+13],12,-40341101),s=nl(s,n,i,r,t[o+14],17,-1502002290),r=nl(r,s,n,i,t[o+15],22,1236535329),i=ol(i,r,s,n,t[o+1],5,-165796510),n=ol(n,i,r,s,t[o+6],9,-1069501632),s=ol(s,n,i,r,t[o+11],14,643717713),r=ol(r,s,n,i,t[o],20,-373897302),i=ol(i,r,s,n,t[o+5],5,-701558691),n=ol(n,i,r,s,t[o+10],9,38016083),s=ol(s,n,i,r,t[o+15],14,-660478335),r=ol(r,s,n,i,t[o+4],20,-405537848),i=ol(i,r,s,n,t[o+9],5,568446438),n=ol(n,i,r,s,t[o+14],9,-1019803690),s=ol(s,n,i,r,t[o+3],14,-187363961),r=ol(r,s,n,i,t[o+8],20,1163531501),i=ol(i,r,s,n,t[o+13],5,-1444681467),n=ol(n,i,r,s,t[o+2],9,-51403784),s=ol(s,n,i,r,t[o+7],14,1735328473),r=ol(r,s,n,i,t[o+12],20,-1926607734),i=al(i,r,s,n,t[o+5],4,-378558),n=al(n,i,r,s,t[o+8],11,-2022574463),s=al(s,n,i,r,t[o+11],16,1839030562),r=al(r,s,n,i,t[o+14],23,-35309556),i=al(i,r,s,n,t[o+1],4,-1530992060),n=al(n,i,r,s,t[o+4],11,1272893353),s=al(s,n,i,r,t[o+7],16,-155497632),r=al(r,s,n,i,t[o+10],23,-1094730640),i=al(i,r,s,n,t[o+13],4,681279174),n=al(n,i,r,s,t[o],11,-358537222),s=al(s,n,i,r,t[o+3],16,-722521979),r=al(r,s,n,i,t[o+6],23,76029189),i=al(i,r,s,n,t[o+9],4,-640364487),n=al(n,i,r,s,t[o+12],11,-421815835),s=al(s,n,i,r,t[o+15],16,530742520),r=al(r,s,n,i,t[o+2],23,-995338651),i=ll(i,r,s,n,t[o],6,-198630844),n=ll(n,i,r,s,t[o+7],10,1126891415),s=ll(s,n,i,r,t[o+14],15,-1416354905),r=ll(r,s,n,i,t[o+5],21,-57434055),i=ll(i,r,s,n,t[o+12],6,1700485571),n=ll(n,i,r,s,t[o+3],10,-1894986606),s=ll(s,n,i,r,t[o+10],15,-1051523),r=ll(r,s,n,i,t[o+1],21,-2054922799),i=ll(i,r,s,n,t[o+8],6,1873313359),n=ll(n,i,r,s,t[o+15],10,-30611744),s=ll(s,n,i,r,t[o+6],15,-1560198380),r=ll(r,s,n,i,t[o+13],21,1309151649),i=ll(i,r,s,n,t[o+4],6,-145523070),n=ll(n,i,r,s,t[o+11],10,-1120210379),s=ll(s,n,i,r,t[o+2],15,718787259),r=ll(r,s,n,i,t[o+9],21,-343485551),i=mb(i,a),r=mb(r,l),s=mb(s,c),n=mb(n,h)}return[i,r,s,n]}function cUe(t,e=TE.Hex){const i=e||TE.Base64,r=Bkt(Nkt(t),t.length*p$);switch(i){case TE.Raw:return r;case TE.Hex:return kkt(r);case TE.String:return Fkt(r);case TE.Base64:return zkt(r)}}const Vkt=()=>J.getLogger("esri.views.2d.layers.support.clusterUtils");X.add("esri-cluster-arcade-enabled",!0);const jkt=X("esri-cluster-arcade-enabled"),Gkt=new Set(["simple-line","simple-fill","picture-fill"]);function Zwe(t,e){let i=e.clone();if(!Hkt(i))return i;if(e.symbols.some(r=>Gkt.has(r.type))&&(i=new pv({symbol:new _g})),i.authoringInfo||(i.authoringInfo=new nle),i.authoringInfo.isAutoGenerated=!0,"visualVariables"in i){const r=(i.visualVariables||[]).filter(s=>s.valueExpression!=="$view.scale");r.forEach(s=>{s.type==="rotation"?s.field?s.field=i1(t,s.field,"avg_angle","number"):s.valueExpression&&(s.field=kO(t,s.valueExpression,"avg_angle","number"),s.valueExpression=null):s.normalizationField?(s.field=i1(t,s.field,"avg_norm","number",s.normalizationField),s.normalizationField=null):s.field?s.field=i1(t,s.field,"avg","number"):s.valueExpression&&(s.field=kO(t,s.valueExpression,"avg","number"),s.valueExpression=null)}),i.visualVariables=r}switch(i.type){case"simple":break;case"pie-chart":for(const r of i.attributes)r.field?r.field=i1(t,r.field,"sum","number"):r.valueExpression&&(r.field=kO(t,r.valueExpression,"sum","number"),r.valueExpression=null);break;case"unique-value":i.field?i.field=i1(t,i.field,"mode","string"):i.valueExpression&&(i.field=kO(t,i.valueExpression,"mode","string"),i.valueExpression=null);break;case"class-breaks":i.normalizationField?(i.field=i1(t,i.field,"avg_norm","number",i.normalizationField),i.normalizationField=null):i.field?i.field=i1(t,i.field,"avg","number"):i.valueExpression&&(i.field=kO(t,i.valueExpression,"avg","number"),i.valueExpression=null)}return i}const Hkt=t=>{const e=i=>Vkt().error(new U("Unsupported-renderer",i,{renderer:t}));if(!t)return!1;switch(t.type){case"unique-value":if(t.field2||t.field3)return e("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(t.normalizationField){const i=t.normalizationType;if(i!=="field")return e(`FeatureReductionCluster does not support a normalizationType of ${i}`),!1}break;case"simple":case"pie-chart":break;default:return e(`FeatureReductionCluster does not support renderers of type ${t.type}`),!1}if(!jkt){if("valueExpression"in t&&t.valueExpression)return e("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in t&&t.visualVariables||[]).some(i=>!(!("valueExpression"in i)||!i.valueExpression)))return e("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function qkt(t,e,i){switch(t){case"sum":return`cluster_sum_${e}`;case"avg":case"avg_angle":return`cluster_avg_${e}`;case"mode":return`cluster_type_${e}`;case"avg_norm":{const r=i,s="field",n=e.toLowerCase()+",norm:"+s+","+r.toLowerCase();return"cluster_avg_"+cUe(n)}}}function kO(t,e,i,r){const s=cUe(e),n=i==="mode"?`cluster_type_${s}`:i==="sum"?`cluster_sum_${s}`:`cluster_avg_${s}`;return t.some(o=>o.name===n)||t.push(new Kb({name:n,isAutoGenerated:!0,onStatisticExpression:new vle({expression:e,returnType:r}),statisticType:i})),n}function i1(t,e,i,r,s){if(e==="cluster_count"||t.some(o=>o.name===e))return e;const n=qkt(i,e,s);return t.some(o=>o.name===n)||(i==="avg_norm"?t.push(new Kb({name:n,isAutoGenerated:!0,onStatisticExpression:new vle({expression:`$feature.${e} / $feature.${s}`,returnType:r}),statisticType:"avg"})):t.push(new Kb({name:n,isAutoGenerated:!0,onStatisticField:e,statisticType:i}))),n}const Wkt=t=>{let e=class extends t{constructor(...i){super(...i),this.addHandles(H(()=>this.renderer,()=>{if(this.featureReduction){const r=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",r)}},Yt))}set featureReduction(i){const r=this._normalizeFeatureReduction(i);this._set("featureReduction",r)}set renderer(i){}_withClusterVariable(i,r,s){const n=i.clone();return"visualVariables"in n&&(n.visualVariables||(n.visualVariables=[]),n.visualVariables.some(o=>o.type==="size")||n.visualVariables.push(new rH({field:"cluster_count",stops:[new Mz({value:1}),new Mz({useMinValue:!0,size:r}),new Mz({useMaxValue:!0,size:s})]}))),n}_normalizeFeatureReduction(i){var d;if((i==null?void 0:i.type)!=="cluster")return i;const r=i.clone(),s=[new Kb({name:"cluster_count",alias:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],n=(r.fields??[]).filter(f=>!f.isAutoGenerated),o=i.renderer&&!((d=i.renderer.authoringInfo)!=null&&d.isAutoGenerated),{clusterMinSize:a,clusterMaxSize:l}=r;if(o){r.fields=[...s,...n];const f=this._withClusterVariable(r.renderer,a,l);return r.effectiveFeatureRenderer=f,r.effectiveClusterRenderer=f,r}if(i.symbol){if(r.fields=[...s,...n],r.renderer=null,!this.renderer)return r.effectiveFeatureRenderer=null,r.effectiveClusterRenderer=null,r;const f=Zwe(s,this.renderer),m=this._withClusterVariable(f,a,l),g="visualVariables"in m&&m.visualVariables?m.visualVariables:[],v=new pv({symbol:i.symbol,visualVariables:g});return r.fields=[...s,...n],r.effectiveFeatureRenderer=m,r.effectiveClusterRenderer=v,r}if(!this.renderer)return i;const c=Zwe(s,this.renderer);r.fields=[...s,...n],r.renderer=c;const h=this._withClusterVariable(c,a,l);return r.effectiveFeatureRenderer=h,r.effectiveClusterRenderer=h,r}};return u([p(Lkt)],e.prototype,"featureReduction",null),e=u([A("esri.layers.mixins.FeatureReductionLayer")],e),e},Ywe={ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GeoRSS:!0,GroupLayer:!0,KML:!0,KnowledgeGraphLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WCS:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},Jwe={ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,OpenStreetMap:!0,VectorTileLayer:!0,WCS:!0,WMS:!0,WebTiledLayer:!0},Xwe={ArcGISFeatureLayer:!0,SubtypeGroupTable:!0},Zkt={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GroupLayer:!0,IntegratedMesh3DTilesLayer:!0,Object3DTilesLayer:!0,IntegratedMeshLayer:!0,KML:!0,LineOfSightLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,PointCloudLayer:!0,RasterDataLayer:!0,VectorTileLayer:!0,ViewshedLayer:!0,Voxel:!0,WCS:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-scene/basemap":{ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WCS:!0,WMS:!0,WebTiledLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-scene/tables":{ArcGISFeatureLayer:!0},"web-map/operational-layers":Ywe,"web-map/basemap":Jwe,"web-map/tables":Xwe,"link-chart/operational-layers":{...Ywe,LinkChartLayer:!0},"link-chart/basemap":Jwe,"link-chart/tables":Xwe,"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,BuildingSceneLayer:!0,IntegratedMesh3DTilesLayer:!0,IntegratedMeshLayer:!0,MediaLayer:!0,OrientedImageryLayer:!0,PointCloudLayer:!0,SubtypeGroupLayer:!0,WCS:!0},"portal-item/tables":{ArcGISFeatureLayer:!0,SubtypeGroupTable:!0}},Ykt=t=>{let e=class extends t{constructor(){super(...arguments),this.persistenceEnabled=!0,this.title=null}readId(i,r,s){var n;return((n=s==null?void 0:s.portalItem)==null?void 0:n.type)==="Group Layer"?void 0:i}writeListMode(i,r,s,n){(n&&n.layerContainerType==="ground"||i&&h6e(this,s,{},n))&&(r[s]=i)}writeOperationalLayerType(i,r,s){i&&(r[s]=i)}writeTitle(i,r){r.title=i??"Layer"}readVisibilityTimeExtent(i){return i?Eo.fromArray(i):null}writeVisibilityTimeExtent(i,r,s,n){i&&n.layerContainerType!=="tables"&&(i.isEmpty?n!=null&&n.messages&&n.messages.push(new U("layer:invalid-visibilityTimeExtent","visibilityTimeExtent cannot be empty")):r[s]=i.toArray())}read(i,r){r&&(r.layer=this),uie(this,i,s=>super.read(i,s),r)}write(i,r){var o,a;if(!this.persistenceEnabled&&!(r!=null&&r.ignorePersistenceEnabled))return null;if(r!=null&&r.origin){const l=`${r.origin}/${r.layerContainerType||"operational-layers"}`,c=Zkt[l];let h=!!(c!=null&&c[this.operationalLayerType]);if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&l==="web-scene/operational-layers"&&(h=!1),this.operationalLayerType==="ArcGISDimensionLayer"&&l==="web-map/operational-layers"&&(h=!1),!h)return(o=r.messages)==null||o.push(new U("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${l}'`,{layer:this})),null}const s=super.write(i,{...r,layer:this}),n=!!r&&!!r.messages&&!!r.messages.filter(l=>l instanceof U&&l.name==="web-document-write:property-required").length;return D$(s==null?void 0:s.url)?((a=r==null?void 0:r.messages)==null||a.push(new U("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&n?null:s}beforeSave(){}};return u([p({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],e.prototype,"id",void 0),u([ve("id",["id"])],e.prototype,"readId",null),u([p(Tze)],e.prototype,"listMode",void 0),u([_e("listMode")],e.prototype,"writeListMode",null),u([p({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1},"web-scene":{name:"layerType",read:!1,write:{enabled:!0,ignoreOrigin:!0,layerContainerTypes:Xs,isRequired:!0}}}}})],e.prototype,"operationalLayerType",void 0),u([_e("operationalLayerType")],e.prototype,"writeOperationalLayerType",null),u([p(vee)],e.prototype,"opacity",void 0),u([p({type:Boolean,readOnly:!1})],e.prototype,"persistenceEnabled",void 0),u([p({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],e.prototype,"title",void 0),u([_e("title"),_e(["web-scene"],"title")],e.prototype,"writeTitle",null),u([p({type:Eo,json:{origins:{"web-scene":{write:{layerContainerTypes:Xs}}}}})],e.prototype,"visibilityTimeExtent",void 0),u([ve("visibilityTimeExtent")],e.prototype,"readVisibilityTimeExtent",null),u([_e(["portal-item","web-map","web-scene"],"visibilityTimeExtent",{visibilityTimeExtent:{type:[[Ii,HA]]}})],e.prototype,"writeVisibilityTimeExtent",null),u([p({type:Boolean,json:{name:"visibility",write:{layerContainerTypes:Xs}}})],e.prototype,"visible",void 0),e=u([A("esri.layers.mixins.OperationalLayer")],e),e};var nte;const Hk=new ni({asc:"ascending",desc:"descending"});let B2=nte=class extends ee{constructor(t){super(t),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new nte({field:this.field,valueExpression:this.valueExpression,order:this.order})}};u([p({type:String,json:{write:!0}})],B2.prototype,"field",void 0),u([p({type:String,json:{write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],B2.prototype,"valueExpression",void 0),u([p({type:Hk.apiValues,json:{type:Hk.jsonValues,read:Hk.read,write:Hk.write}})],B2.prototype,"order",void 0),B2=nte=u([A("esri.layers.support.OrderByInfo")],B2);const uUe=B2;function Jkt(t,e,i){if(!t)return null;const r=t.find(n=>!!n.field);if(!r)return null;const s=new uUe;return s.read(r,i),[s]}function Xkt(t,e,i,r){const s=t.find(n=>!!n.field);s&&ro(i,[s.toJSON()],e)}const Kkt={type:[uUe],json:{origins:{"web-scene":{write:!1,read:!1}},name:"layerDefinition.orderBy",read:{reader:Jkt},write:{writer:Xkt}}},Qkt=t=>{let e=class extends t{constructor(){super(...arguments),this.orderBy=null}};return u([p(Kkt)],e.prototype,"orderBy",void 0),e=u([A("esri.layers.mixins.OrderedLayer")],e),e},e4t=t=>{let e=class extends t{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=$e(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(i){i!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",i))}readPortalItem(i,r,s){if(r.itemId)return new nh({id:r.itemId,portal:s==null?void 0:s.portal})}writePortalItem(i,r){i!=null&&i.id&&(r.itemId=i.id)}async loadFromPortal(i,r){var s;if((s=this.portalItem)!=null&&s.id)try{const{load:n}=await G(()=>import("./layersLoader-yEVkGalG.js"),__vite__mapDeps([368,120,119,121]));return gt(r),await n({instance:this,supportedTypes:i.supportedTypes,validateItem:i.validateItem,supportsData:i.supportsData,layerModuleTypeMap:i.layerModuleTypeMap,populateGroupLayer:i.populateGroupLayer},r)}catch(n){throw es(n)||J.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${n}`),n}}async finishLoadEditablePortalLayer(i){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(i).catch(r=>(Wc(r),!0)))}async setUserPrivileges(i,r){if(!Rr.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(r);if(this.url)try{const{features:{edit:s,fullEdit:n},content:{updateItem:o}}=await this._fetchUserPrivileges(i,r);this._set("userHasEditingPrivileges",s),this._set("userHasFullEditingPrivileges",n),this._set("userHasUpdateItemPrivileges",o)}catch(s){Wc(s)}}async _fetchUserPrivileges(i,r){let s=this.portalItem;if(!i||!s||!s.loaded||s.sourceUrl)return this._fetchFallbackUserPrivileges(r);const n=!(hi!=null&&hi.findCredential(this.url)),o=i===s.id;if(o&&s.portal.user)return this._getUserPrivileges(s,n);let a,l;if(o)a=s.portal.url;else try{a=await vre(this.url,r)}catch(f){Wc(f)}if(!a||!xTe(a,s.portal.url))return this._fetchFallbackUserPrivileges(r);try{const f=r!=null?r.signal:null;l=await(hi==null?void 0:hi.getCredential(`${a}/sharing`,{prompt:!1,signal:f}))}catch(f){Wc(f)}const c=!0,h=!1,d=!1;if(!l)return{features:{edit:c,fullEdit:h},content:{updateItem:d}};try{if(o?await s.reload():(s=new nh({id:i,portal:{url:a}}),await s.load(r)),s.portal.user)return this._getUserPrivileges(s,n)}catch(f){Wc(f)}return{features:{edit:c,fullEdit:h},content:{updateItem:d}}}_getUserPrivileges(i,r){const s=sDt(i);return r&&(s.features.edit=!0),s}async _fetchFallbackUserPrivileges(i){let r=!0;try{r=await this._fetchUserHasEditingPrivileges(i)}catch(s){Wc(s)}return{features:{edit:r,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(i){const r=this.url?hi==null?void 0:hi.findCredential(this.url):null;if(!r)return!0;const s=qk.credential===r?qk.user:await this._fetchEditingUser(i);return qk.credential=r,qk.user=s,(s==null?void 0:s.privileges)==null||s.privileges.includes("features:user:edit")}async _fetchEditingUser(i){var h,d;const r=(d=(h=this.portalItem)==null?void 0:h.portal)==null?void 0:d.user;if(r)return r;const s=hi==null?void 0:hi.findServerInfo(this.url??"");if(!(s!=null&&s.owningSystemUrl))return null;const n=`${s.owningSystemUrl}/sharing/rest`,o=vn.getDefault();if(o&&o.loaded&&Ed(o.restUrl)===Ed(n))return o.user;const a=`${n}/community/self`,l=i!=null?i.signal:null,c=await ff(Ri(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?yre.fromJSON(c.value.data):null}read(i,r){r&&(r.layer=this),super.read(i,r)}write(i,r){var o;const s=r==null?void 0:r.portal,n=((o=this.portalItem)==null?void 0:o.id)&&(this.portalItem.portal||vn.getDefault());return s&&n&&!STe(n.restUrl,s.restUrl)?(r.messages&&r.messages.push(new U("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(i,{...r,layer:this})}};return u([p({type:nh})],e.prototype,"portalItem",null),u([ve("web-document","portalItem",["itemId"])],e.prototype,"readPortalItem",null),u([_e("web-document","portalItem",{itemId:{type:String}})],e.prototype,"writePortalItem",null),u([p({clonable:!1})],e.prototype,"resourceReferences",void 0),u([p({type:Boolean,readOnly:!0})],e.prototype,"userHasEditingPrivileges",void 0),u([p({type:Boolean,readOnly:!0})],e.prototype,"userHasFullEditingPrivileges",void 0),u([p({type:Boolean,readOnly:!0})],e.prototype,"userHasUpdateItemPrivileges",void 0),e=u([A("esri.layers.mixins.PortalLayer")],e),e},qk={credential:null,user:null};let DR=class extends he{constructor(){super(...arguments),this.updating=!1,this.status="unknown"}};u([p()],DR.prototype,"updating",void 0),u([p()],DR.prototype,"status",void 0),DR=u([A("esri.layers.support.PublishingInfo")],DR);const t4t=DR,i4t=Symbol(),r4t=t=>{var e;let i=class extends t{constructor(){super(...arguments),this[e]=!0}get publishingInfo(){if(this.destroyed)return null;const r=this._get("publishingInfo");if(r)return r;const s=new t4t;return this._checkPublishingStatus(s),s}_checkPublishingStatus(r){let o=0;const a=async c=>{let h;r.updating=!0;try{h=await this.fetchPublishingStatus()}catch{h="unavailable"}h!=="published"&&h!=="unavailable"||(r.status==="publishing"&&this.refresh(),l.remove()),r.status=h,r.updating=!1,l.removed||(o=setTimeout(a,c,c+125))},l={removed:!1,remove(){this.removed=!0,clearTimeout(o)}};this.when().catch(()=>l.remove()),a(250),this.addHandles(l)}};return e=i4t,u([p({readOnly:!0,clonable:!1})],i.prototype,"publishingInfo",null),i=u([A("esri.layers.mixins.PublishableLayer")],i),i},gb=new Ce,FP=new WeakMap;function s4t(t){o4t(t)&&gb.push(new WeakRef(t))}function n4t(t){const e=gb.find(i=>i.deref()===t);e&&gb.remove(e)}function o4t(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function hUe(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:hUe(e,t%e):0}let U7=0,Wk=0;function a4t(){const t=Date.now();let e=!1;for(const i of gb){const r=i.deref();r?r.refreshInterval&&t-(FP.get(r)??0)+5>=6e4*r.refreshInterval&&(FP.set(r,t),r.refresh(t)):e=!0}if(e)for(let i=gb.length-1;i>=0;i--)gb.at(i).deref()||gb.removeAt(i)}XSe(()=>{const t=Date.now();let e=0;for(const i of gb){const r=i.deref();r&&(e=hUe(Math.round(6e4*r.refreshInterval),e),r.refreshInterval?FP.get(r)||FP.set(r,t):FP.delete(r))}if(e!==Wk){if(Wk=e,clearInterval(U7),Wk===0)return void(U7=0);U7=setInterval(a4t,Wk)}},Yt);function imi(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const Kwe=.1,l4t=t=>{let e=class extends t{constructor(...i){super(...i),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=UD(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||s4t(this)},()=>{})}destroy(){n4t(this)}castRefreshInterval(i){return i>=Kwe?i:i<=0?0:Kwe}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(i=Date.now()){a3(this._debounceHasDataChanged()).then(r=>{r&&this._set("refreshTimestamp",i),this.emit("refresh",{dataChanged:r})},r=>{J.getLogger(this).error(r),this.emit("refresh",{dataChanged:!1,error:r})})}async hasDataChanged(){return!0}get test(){}};return u([p({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:Xs}}}}})],e.prototype,"refreshInterval",void 0),u([ti("refreshInterval")],e.prototype,"castRefreshInterval",null),u([p({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),u([p({readOnly:!0})],e.prototype,"refreshParameters",null),e=u([A("esri.layers.mixins.RefreshableLayer")],e),e},c4t=t=>{let e=class extends t{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const i={minScale:this.minScale,maxScale:this.maxScale},r=this.parent;r&&"effectiveScaleRange"in r&&u4t(i,r.effectiveScaleRange);const s=this._get("effectiveScaleRange");return s&&s.minScale===i.minScale&&s.maxScale===i.maxScale?s:i}};return u([p({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minScale",void 0),u([p({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"maxScale",void 0),u([p({readOnly:!0})],e.prototype,"effectiveScaleRange",null),e=u([A("esri.layers.mixins.ScaleRangeLayer")],e),e};function u4t(t,e){return t.minScale=t.minScale>0?e.minScale>0?Math.min(t.minScale,e.minScale):t.minScale:e.minScale,t.maxScale=t.maxScale>0?e.maxScale>0?Math.max(t.maxScale,e.maxScale):t.maxScale:e.maxScale,t}function Qwe(t,e){return US.fromJSON({value:t,unit:e})}let Na=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeZone=null,this.trackIdField=null,this.useTime=!0,this.stops=null}readFullTimeExtent(e,i){return i.timeExtent&&Array.isArray(i.timeExtent)&&i.timeExtent.length===2?Eo.fromArray(i.timeExtent):null}writeFullTimeExtent(e,i){(e==null?void 0:e.start)!=null&&e.end!=null?i.timeExtent=e.toArray():i.timeExtent=null}readInterval(e,i){return i.timeInterval&&i.timeIntervalUnits?Qwe(i.timeInterval,i.timeIntervalUnits):i.defaultTimeInterval&&i.defaultTimeIntervalUnits?Qwe(i.defaultTimeInterval,i.defaultTimeIntervalUnits):null}writeInterval(e,i){i.timeInterval=(e==null?void 0:e.toJSON().value)??null,i.timeIntervalUnits=(e==null?void 0:e.toJSON().unit)??null}};u([p({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],Na.prototype,"cumulative",void 0),u([p({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],Na.prototype,"endField",void 0),u([p({type:Eo,json:{write:{enabled:!0,allowNull:!0}}})],Na.prototype,"fullTimeExtent",void 0),u([ve("fullTimeExtent",["timeExtent"])],Na.prototype,"readFullTimeExtent",null),u([_e("fullTimeExtent")],Na.prototype,"writeFullTimeExtent",null),u([p({type:Boolean,json:{write:!0}})],Na.prototype,"hasLiveData",void 0),u([p({type:US,json:{write:{enabled:!0,allowNull:!0}}})],Na.prototype,"interval",void 0),u([ve("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],Na.prototype,"readInterval",null),u([_e("interval")],Na.prototype,"writeInterval",null),u([p({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],Na.prototype,"startField",void 0),u([p(UU("timeReference",!0))],Na.prototype,"timeZone",void 0),u([p({type:String,json:{write:{enabled:!0,allowNull:!0}}})],Na.prototype,"trackIdField",void 0),u([p({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],Na.prototype,"useTime",void 0),u([p({type:[Date],json:{read:!1}})],Na.prototype,"stops",void 0),Na=u([A("esri.layers.support.TimeInfo")],Na);const dUe=Na,h4t={type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation",layerContainerTypes:Xs}}},d4t=t=>{let e=class extends t{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(i,r){const s=r.timeInfo.exportOptions;if(!s)return null;const n=s.timeOffset,o=Yae.fromJSON(s.timeOffsetUnits);return n&&o?new US({value:n,unit:o}):null}set timeInfo(i){tAe(i,this.fieldsIndex),this._set("timeInfo",i)}};return u([p({type:Eo,json:{write:!1}})],e.prototype,"timeExtent",void 0),u([p({type:US})],e.prototype,"timeOffset",void 0),u([ve("service","timeOffset",["timeInfo.exportOptions"])],e.prototype,"readOffset",null),u([p({value:null,type:dUe,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.prototype,"timeInfo",null),u([p(h4t)],e.prototype,"useViewTime",void 0),e=u([A("esri.layers.mixins.TemporalLayer")],e),e};let ax=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.labelingInfo=null,this.labelsVisible=!0,this.renderer=null,this.visible=!0}};u([p({type:[qL],json:{write:!0}})],ax.prototype,"labelingInfo",void 0),u([p(iH)],ax.prototype,"labelsVisible",void 0),u([p({types:WL,json:{write:!0}})],ax.prototype,"renderer",void 0),u([p({type:Boolean,json:{write:!0}})],ax.prototype,"visible",void 0),ax=u([A("esri.layers.support.TrackPartInfo")],ax);const f$=ax;let Rc=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.enabled=!0,this.fields=[],this.latestObservations=new f$({renderer:new pv({symbol:bV.clone()})}),this.maxDisplayDuration=null,this.maxDisplayObservationsPerTrack=0,this.popupEnabled=!0,this.popupTemplate=null,this.previousObservations=new f$({renderer:new pv({symbol:bV.clone()})}),this.trackLines=new f$({renderer:new pv({symbol:lle.clone()})}),this.timeField="startTimeField"}writeFields(e,i,r){const s=e.filter(n=>n.statisticType!=="avg_angle").map(n=>n.toJSON());ro(r,s,i)}};u([p({type:Boolean,json:{write:!0}})],Rc.prototype,"enabled",void 0),u([p({type:[Kb],json:{write:!0}})],Rc.prototype,"fields",void 0),u([_e("fields")],Rc.prototype,"writeFields",null),u([p({type:f$,json:{write:!0}})],Rc.prototype,"latestObservations",void 0),u([p({type:US,json:{write:!0}})],Rc.prototype,"maxDisplayDuration",void 0),u([p({type:Number,json:{write:!0}})],Rc.prototype,"maxDisplayObservationsPerTrack",void 0),u([p(tH)],Rc.prototype,"popupEnabled",void 0),u([p({type:oM,json:{name:"popupInfo",write:!0}})],Rc.prototype,"popupTemplate",void 0),u([p({type:f$,json:{write:!0}})],Rc.prototype,"previousObservations",void 0),u([p({type:f$,json:{write:!0}})],Rc.prototype,"trackLines",void 0),u([p({type:["timeReceived","startTimeField","endTimeField"],json:{read:!0,write:!0}})],Rc.prototype,"timeField",void 0),Rc=u([A("esri.layers.support.TrackInfo")],Rc);const p4t=Rc,f4t=t=>{let e=class extends t{constructor(){super(...arguments),this.trackInfo=null}};return u([p({type:p4t})],e.prototype,"trackInfo",void 0),e=u([A("esri.layers.mixins.TrackableLayer")],e),e},e1e=new ni({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let v_=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};u([p({json:{write:!0}})],v_.prototype,"name",void 0),u([p({json:{write:!0}})],v_.prototype,"description",void 0),u([p({json:{read:e1e.read,write:e1e.write}})],v_.prototype,"drawingTool",void 0),u([p({json:{write:!0}})],v_.prototype,"prototype",void 0),u([p({json:{write:!0}})],v_.prototype,"thumbnail",void 0),v_=u([A("esri.layers.support.FeatureTemplate")],v_);const wle=v_;let Ey=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const i={};for(const r of Object.keys(e))i[r]=EG(e[r]);return i}writeDomains(e,i){var s;const r={};for(const n of Object.keys(e))e[n]&&(r[n]=(s=e[n])==null?void 0:s.toJSON());i.domains=r}};u([p({json:{write:!0}})],Ey.prototype,"id",void 0),u([p({json:{write:!0}})],Ey.prototype,"name",void 0),u([p({json:{write:!0}})],Ey.prototype,"domains",void 0),u([ve("domains")],Ey.prototype,"readDomains",null),u([_e("domains")],Ey.prototype,"writeDomains",null),u([p({type:[wle],json:{write:!0}})],Ey.prototype,"templates",void 0),Ey=u([A("esri.layers.support.FeatureType")],Ey);const pUe=Ey;function m4t(){return{fields:{type:[CG],value:null,set:function(t){if(t&&X("big-integer-warning-enabled")){const e=t.filter(i=>i.type==="big-integer"||i.type==="oid"&&(i.length||0)>=8);if(e.length){const i=e.map(r=>`'${r.name}'`).join(", ");J.getLogger(this).warn("#fields",`Layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}') references big-integer field(s): ${i}, support for which is experimental. Only integers less than ${Number.MAX_SAFE_INTEGER} (Number.MAX_SAFE_INTEGER) are supported.`)}}this._set("fields",t)}},fieldsIndex:{readOnly:!0,get(){return eUe.fromLayer(this)}},outFields:{type:[String],json:{read:!1},set:function(t){this._userOutFields=t,this.notifyChange("outFields")},get:function(){var e;const t=this._userOutFields;if(!(t!=null&&t.length))return null;if(t.includes("*"))return["*"];if(!this.fields)return t;for(const i of t)((e=this.fieldsIndex)==null?void 0:e.has(i))||J.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${i} found in outFields`,{layer:this,outFields:t});return mG(this.fieldsIndex,t)}}}}const B7=()=>J.getLogger("esri.layers.support.labelingInfo"),g4t=/\[([^[\]]+)\]/gi;function V7(t,e,i){return t?t.map(r=>{var n;const s=new qL;if(s.read(r,i),s.labelExpression){const o=e.fields||((n=e.layerDefinition)==null?void 0:n.fields)||this.fields;s.labelExpression=s.labelExpression.replaceAll(g4t,(a,l)=>`[${y4t(l,o)}]`)}return s}):null}function y4t(t,e){if(!e)return t;const i=t.toLowerCase();for(let r=0;r<e.length;r++){const s=e[r].name;if(s.toLowerCase()===i)return s}return t}const v4t={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryMultiPatch:["always-horizontal"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along","above-along","below-along"],esriGeometryMultipoint:null,esriGeometryEnvelope:null};function lmi(t,e){const i=[];for(const r of t){const s=r.labelPlacement,n=v4t[e];if(!r.symbol)return B7().warn("No ILabelClass symbol specified."),[];if(!n)return B7().error(new U("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${e}' is not supported`)),[];if(n.includes(s))i.push(r);else{const o=n[0];s&&B7().warn(`Found invalid label placement type ${s} for ${e}. Defaulting to ${o}`);const a=r.clone();a.labelPlacement=o,i.push(a)}}return i}const _4t="relationships/",b4t="expression/";let Wl=class extends he{constructor(e){super(e),this._featureUtils=null,this.effectivePopupTemplate=null}get _arcadeTask(){return this.expressionsUsedInTitle.length>0?this._get("_arcadeTask")||gg(()=>bv()):null}get featureUtilsPromise(){return this._get("featureUtilsPromise")??G(()=>import("./featureUtils-BoL5pG_W.js"),__vite__mapDeps([103,6])).then(e=>this._featureUtils=e)}get calculatedExpressions(){var i;const e=new Ce;if(!this.expressionsUsedInTitle.length)return e;if(!((i=this._arcadeTask)!=null&&i.value)){for(const r of this.expressionsUsedInTitle??[])e.push({name:r.name,invalid:!0});return e}for(const r of this.expressionsUsedInTitle)try{const s=this._arcadeTask.value.arcade.parseScript(r.expression,["$layer","$map","$datastore"]);if(s.isAsync){e.push({name:r.name,invalid:!0});break}e.push({name:r.name,syntax:s,invalid:!1,func:this._arcadeTask.value.arcade.compileScript(s,{vars:{$feature:"any"}})})}catch{e.push({name:r.name,invalid:!0});break}return e}get expressionsUsedInTitle(){var i,r,s;let e=((i=this.effectivePopupTemplate)==null?void 0:i.title)??"";return typeof e!="string"?[]:(e=e.toLowerCase(),((s=(r=this.effectivePopupTemplate)==null?void 0:r.expressionInfos)==null?void 0:s.filter(n=>e.includes(`{expression/${n.name.toLowerCase()}}`)))??[])}get fieldInfoMap(){return this._featureUtils?this._createFieldInfoMap(this._featureUtils.getAllFieldInfos(this.effectivePopupTemplate)):null}get hasBadExpressions(){return this.calculatedExpressions.some(e=>e.invalid===!0)}get requiredFields(){var r,s;const e=new Set;if((r=this._arcadeTask)!=null&&r.value&&!this.hasBadExpressions)for(const n of((s=this.calculatedExpressions)==null?void 0:s.toArray())??[])try{const o=this._arcadeTask.value.arcade.extractFieldLiterals(n.syntax);for(const a of o){const l=a.split("."),c=this.fieldsIndex.get(l.at(-1)??"");c&&e.add(c.name)}}catch{}const i=this._extractFieldNames(this.workingTitle);for(const n of i){const o=this.fieldsIndex.get(n);o&&e.add(o.name)}return e}get titleFromDisplayField(){var i,r;let e="";return this.displayField&&(e=((i=this.fieldsIndex.get(this.displayField))==null?void 0:i.name)??""),e||(e=((r=this.fieldsIndex.get(this.objectIdField))==null?void 0:r.name)??""),e?`{${e}}`:""}get workingTitle(){const e=this.effectivePopupTemplate?this.effectivePopupTemplate.title:"";return e===""||e==null||this.hasBadExpressions||typeof e!="string"?this.titleFromDisplayField:e}async getTitle(e,i,r){var s;try{const{attributes:n}=i,o=(r==null?void 0:r.timeZone)??"system",[{substituteFieldsInLinksAndAttributes:a}]=await Promise.all([this.featureUtilsPromise,(s=this._arcadeTask)==null?void 0:s.promise]);if(r.fetchMissingFields&&(i=await this._checkAndReQueryGraphic(e,i)),this.workingTitle&&this.fieldInfoMap){const l=this._createFormattedAttributes(e,i,o).global;return a({attributes:n,expressionAttributes:null,fieldInfoMap:this.fieldInfoMap,globalAttributes:l,layer:e,text:this.workingTitle})}return""}catch{}return""}async _checkAndReQueryGraphic(e,i){const r=i.getObjectId();if(r==null)return i;if(!tKe(this.requiredFields,i)){const s=e.createQuery();s.where="1=1",s.outFields=[...this.requiredFields],s.objectIds=[r];const n=await e.queryFeatures(s);if((n==null?void 0:n.features.length)===1)return n.features[0]}return i}_createFieldInfoMap(e){const i=new Map;if(!e)return i;for(const r of e){if(!r.fieldName)continue;const s=this.fieldsIndex.get(r.fieldName),n=(s==null?void 0:s.name)??r.fieldName;r.fieldName=n,i.set(n.toLowerCase(),r)}return i}_createFormattedAttributes(e,i,r="system"){var a,l;const s=((a=this.effectivePopupTemplate)==null?void 0:a.fieldInfos)??[],n={};if(!this._featureUtils)return{};if(!this.hasBadExpressions&&this.calculatedExpressions.length>0&&((l=this._arcadeTask)!=null&&l.value)){const c=this._arcadeTask.value.Feature.createFromGraphicLikeObject(i.geometry,i.attributes,e,null);for(const h of this.calculatedExpressions)try{n[`expression/${h.name}`]=h.func({vars:{$feature:c}})}catch{}}const o={...i.attributes,...n};return{global:this._featureUtils.formatAttributes({fieldInfos:s,attributes:o,graphic:i,timeZone:r,layer:e,fieldInfoMap:this.fieldInfoMap}),content:[]}}_extractFieldNames(e){return Ore(e).filter(i=>!(i.indexOf(_4t)===0||i.indexOf(b4t)===0))}};u([p({readOnly:!0})],Wl.prototype,"_arcadeTask",null),u([p()],Wl.prototype,"_featureUtils",void 0),u([p({readOnly:!0})],Wl.prototype,"featureUtilsPromise",null),u([p({readOnly:!0})],Wl.prototype,"calculatedExpressions",null),u([p()],Wl.prototype,"displayField",void 0),u([p()],Wl.prototype,"effectivePopupTemplate",void 0),u([p()],Wl.prototype,"expressionsUsedInTitle",null),u([p()],Wl.prototype,"fieldsIndex",void 0),u([p()],Wl.prototype,"fieldInfoMap",null),u([p()],Wl.prototype,"fields",void 0),u([p()],Wl.prototype,"objectIdField",void 0),u([p()],Wl.prototype,"requiredFields",null),Wl=u([A("esri.layers.support.TitleCreator")],Wl);const w4t=Wl,V2=[];function x4t(t,e){if(xU(t.url??""))return!0;const{wkid:i}=e;for(const r of V2){if((t.version??0)>=r[0])return!0;if(typeof r[1]=="function"&&(r[1]=r[1]()),r[1].has(i))return!1}return!0}V2.push([10.91,()=>{const t=new Set([9709,9716,9741,9761,9766]);for(let e=9712;e<=9713;e++)t.add(e);for(let e=9748;e<=9749;e++)t.add(e);for(let e=20904;e<=20932;e++)t.add(e);for(let e=21004;e<=21032;e++)t.add(e);for(let e=21207;e<=21264;e++)t.add(e);for(let e=21307;e<=21364;e++)t.add(e);for(let e=23301;e<=23333;e++)t.add(e);for(let e=102759;e<=102760;e++)t.add(e);for(let e=102934;e<=102955;e++)t.add(e);return t}]),V2.push([10.9,()=>{const t=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let e=9356;e<=9360;e++)t.add(e);for(let e=9404;e<=9407;e++)t.add(e);for(let e=9476;e<=9482;e++)t.add(e);for(let e=9487;e<=9494;e++)t.add(e);for(let e=9697;e<=9699;e++)t.add(e);return t}]),V2.push([10.81,()=>{const t=new Set([9265,9333,103598,103699]);for(let e=9248;e<=9254;e++)t.add(e);for(let e=9271;e<=9273;e++)t.add(e);for(let e=9284;e<=9285;e++)t.add(e);for(let e=21453;e<=21463;e++)t.add(e);return t}]),V2.push([10.8,()=>{const t=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let e=8035;e<=8036;e++)t.add(e);for(let e=8455;e<=8456;e++)t.add(e);for(let e=8518;e<=8529;e++)t.add(e);for(let e=8533;e<=8536;e++)t.add(e);for(let e=8538;e<=8540;e++)t.add(e);for(let e=8677;e<=8679;e++)t.add(e);for(let e=8902;e<=8903;e++)t.add(e);for(let e=8907;e<=8910;e++)t.add(e);for(let e=8949;e<=8951;e++)t.add(e);for(let e=8972;e<=8987;e++)t.add(e);for(let e=9039;e<=9040;e++)t.add(e);for(let e=9068;e<=9069;e++)t.add(e);for(let e=9140;e<=9141;e++)t.add(e);for(let e=9148;e<=9150;e++)t.add(e);for(let e=9153;e<=9159;e++)t.add(e);for(let e=9205;e<=9218;e++)t.add(e);for(let e=9221;e<=9222;e++)t.add(e);for(let e=54098;e<=54101;e++)t.add(e);return t}]),V2.push([10.71,()=>{const t=new Set([6316]);for(let e=8351;e<=8353;e++)t.add(e);for(let e=9294;e<=9297;e++)t.add(e);for(let e=22619;e<=22621;e++)t.add(e);for(let e=103586;e<=103594;e++)t.add(e);return t}]);async function S4t(t,e,i){const r=t&&t.getAtOrigin&&t.getAtOrigin("renderer",e.origin);if(r&&r.type==="unique-value"&&r.styleOrigin){const s=await ff(r.populateFromStyle());if(gt(i),s.ok===!1){const n=s.error;e!=null&&e.messages&&e.messages.push(new ch("renderer:style-reference",`Failed to create unique value renderer from style reference: ${n.message}`,{error:n,context:e})),t.clear("renderer",e==null?void 0:e.origin)}}}function T4t({displayField:t,editFieldsInfo:e,fields:i,objectIdField:r,title:s},n){if(!i)return null;const o=A4t({editFieldsInfo:e,fields:i,objectIdField:r},n);if(!o.length)return null;const a=I4t({titleBase:s,fields:i,displayField:t}),l=O4t();return new oM({title:a,content:l,fieldInfos:o})}function umi(t){var c;const{title:e,graphic:i}=t??{},{attributes:r,sourceLayer:s}=i??{},n=s&&"displayField"in s?s.displayField:null,o=n?r==null?void 0:r[n]:null,a=o!=null?JSON.stringify(o):null,l=(c=i==null?void 0:i.getObjectId())==null?void 0:c.toString();return e||a||l||""}const E4t=(t,e)=>e.visibleFieldNames?e.visibleFieldNames.has(t.name):NXe(t,e);function C4t({fields:t,ignoreFieldTypes:e,sortDisabled:i}){const r=t;return e&&(t=t.filter(s=>!e.includes(s.type))),t===r&&(t=t.slice()),i!==!0&&t.sort($4t),t}function $4t(t,e){return t.type==="oid"?-1:e.type==="oid"?1:t1e(t)?-1:t1e(e)?1:(t.alias||t.name).toLocaleLowerCase().localeCompare((e.alias||e.name).toLocaleLowerCase())}function A4t(t,e){const i=e==null?void 0:e.visibleFieldNames;return C4t({fields:t.fields??[],ignoreFieldTypes:(e==null?void 0:e.ignoreFieldTypes)||R4t,sortDisabled:e==null?void 0:e.sortDisabled}).map(r=>new Ire({fieldName:r.name,isEditable:LXe(r,t),label:r.alias,format:M4t(r),visible:E4t(r,{...t,visibleFieldNames:i})}))}function M4t(t){switch(t.type){case"small-integer":case"integer":case"single":return new z4({digitSeparator:!0,places:0});case"double":return new z4({digitSeparator:!0,places:2});case"string":return rKe(t.name)?new z4({digitSeparator:!0,places:0}):void 0;default:return}}function O4t(){return[new iA,new tA]}function I4t(t){const e=CXe(t),{titleBase:i}=t;return e?`${i}: {${e.trim()}}`:i??""}function t1e(t){var i;return(t.name&&t.name.toLowerCase())==="name"?!0:((i=t.alias)==null?void 0:i.toLowerCase())==="name"}const R4t=["geometry","blob","raster","guid","xml"],Pa="FeatureLayer";function Zk(t,e){return new U("layer:unsupported",`Layer (${t.title}, ${t.id}) of type '${t.declaredClass}' ${e}`,{layer:t})}function i1e(t){return t&&t instanceof Ce}const j7=m4t();function G7(t,e,i){const r=!!(i!=null&&i.writeLayerSchema);return{enabled:r,ignoreOrigin:r}}let at=class extends ekt(Wkt(HLt(r4t(BLt(kLt(ILt(Qkt(d4t(f4t(c4t(l4t(nLt(Ykt(e4t(jL(RLt(sLt(Nt.ClonableMixin(fG))))))))))))))))))){constructor(...t){super(...t),this.attributeTableTemplate=null,this.charts=null,this.copyright=null,this.displayField=null,this.dynamicDataSource=null,this.fields=null,this.fieldsIndex=null,this.formTemplate=null,this.fullExtent=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.operationalLayerType="ArcGISFeatureLayer",this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.resourceInfo=null,this.screenSizePerspectiveEnabled=!0,this.spatialReference=Oe.WGS84,this.subtypeCode=null,this.supportedSourceTypes=new Set(["Feature Layer","Oriented Imagery Layer","Table","Catalog Layer"]),this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.type="feature",this.typeIdField=null,this.types=null,this.visible=!0,this._debouncedSaveOperations=UD(async(e,i,r)=>{const{save:s,saveAs:n}=await G(()=>import("./featureLayerUtils-BxGe0ukP.js"),__vite__mapDeps([369,370,120]));switch(e){case xl.SAVE:return s(this,i);case xl.SAVE_AS:return n(this,r,i)}})}destroy(){var t;(t=this.source)==null||t.destroy()}normalizeCtorArgs(t,e){return typeof t=="string"?{url:t,...e}:t}load(t){var r;const e=t!=null?t.signal:null;if((r=this.portalItem)!=null&&r.loaded&&this.source)return this.addResolvingPromise(this.createGraphicsSource(e).then(s=>this.initLayerProperties(s))),Promise.resolve(this);const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Scene Service"]},t).catch(Wc).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const s=await this._fetchFirstValidLayerId(e);s!=null&&(this.layerId=s)}if(!this.url&&!this._hasMemorySource())throw new U("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this.initLayerProperties(await this.createGraphicsSource(e))}).then(()=>wFt(this,"load",t));return this.addResolvingPromise(i),Promise.resolve(this)}get _titleCreator(){const t=this._get("_titleCreator");return $e(t),new w4t({fieldsIndex:this.fieldsIndex,objectIdField:this.objectIdField,fields:this.fields,displayField:this.displayField,effectivePopupTemplate:this.popupTemplate??this.defaultPopupTemplate})}readCapabilities(t,e){return e=e.layerDefinition||e,Zze(e,this.url)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")??0)+1}get editingEnabled(){var t;return!(this.loaded&&!((t=this.capabilities)!=null&&t.operations.supportsEditing))&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(t){this._overrideIfSome("editingEnabled",t)}readEditingEnabled(t,e){return this._readEditingEnabled(e,!1)}readEditingEnabledFromWebMap(t,e,i){return this._readEditingEnabled(e,!0,i)}writeEditingEnabled(t,e){this._writeEditingEnabled(t,e,!1)}writeEditingEnabledToWebMap(t,e,i,r){this._writeEditingEnabled(t,e,!0,r)}get effectiveEditingEnabled(){return TFt(this)}get featureTitleFields(){return[...this._titleCreator.requiredFields]}readIsTable(t,e){return(e=(e==null?void 0:e.layerDefinition)??e).type==="Table"||!e.geometryType}writeIsTable(t,e,i,r){r!=null&&r.writeLayerSchema&&ro(i,t?"Table":"Feature Layer",e)}readGlobalIdField(t,e){return Fze(e.layerDefinition||e)}readObjectIdField(t,e){return kze(e.layerDefinition||e)}get parsedUrl(){const t=yn(this.url);return t!=null&&(this.dynamicDataSource!=null?t.path=Od(t.path,"dynamicLayer"):this.layerId!=null&&(t.path=Od(t.path,this.layerId.toString()))),t}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(t){Qhe(t,this.fieldsIndex),this._set("renderer",t)}readRenderer(t,e,i){var s;e=e.layerDefinition||e;const r=(s=e.drawingInfo)==null?void 0:s.renderer;if(r){const n=gD(r,e,i)??void 0;return n||J.getLogger(this).error("Failed to create renderer",{rendererDefinition:e.drawingInfo.renderer,layer:this,context:i}),n}return mle(e,i)}set source(t){const e=this._get("source");e!==t&&(i1e(e)&&this._resetMemorySource(e),i1e(t)&&this._initMemorySource(t),this._set("source",t))}castSource(t){return t?Array.isArray(t)||t instanceof Ce?new Ly({layer:this,items:t}):t:null}readSource(t,e){const i=lze.fromJSON(e.featureSet);return new Ly({layer:this,items:(i==null?void 0:i.features)??[]})}readTemplates(t,e){const i=e.editFieldsInfo,r=i==null?void 0:i.creatorField,s=i==null?void 0:i.editorField;return t=t==null?void 0:t.map(n=>wle.fromJSON(n)),this._fixTemplates(t,r),this._fixTemplates(t,s),t}readTitle(t,e){var s,n,o;const i=((s=e.layerDefinition)==null?void 0:s.name)??e.name,r=e.title||((n=e.layerDefinition)==null?void 0:n.title);if(i){const a=(o=this.portalItem)==null?void 0:o.title;if(this.sublayerTitleMode==="item-title")return this.url?K6e(this.url,i):i;let l=i;if(!l&&this.url){const c=Rb(this.url);c!=null&&(l=c.title)}return l?(this.sublayerTitleMode==="item-title-and-service-name"&&a&&a!==l&&(l=a+" - "+l),Eie(l)):void 0}if(this.sublayerTitleMode==="item-title"&&r)return r}readTitleFromWebMap(t,e){var i;return e.title||((i=e.layerDefinition)==null?void 0:i.name)}readTypeIdField(t,e){let i=(e=e.layerDefinition||e).typeIdField;if(i&&e.fields){i=i.toLowerCase();const r=e.fields.find(s=>s.name.toLowerCase()===i);r&&(i=r.name)}return i}readTypes(t,e){t=(e=e.layerDefinition||e).types;const i=e.editFieldsInfo,r=i==null?void 0:i.creatorField,s=i==null?void 0:i.editorField;return t==null?void 0:t.map(n=>(n=pUe.fromJSON(n),this._fixTemplates(n.templates,r),this._fixTemplates(n.templates,s),n))}readVisible(t,e){var i;return((i=e.layerDefinition)==null?void 0:i.defaultVisibility)!=null?!!e.layerDefinition.defaultVisibility:e.visibility!=null?!!e.visibility:void 0}async addAttachment(t,e){const i=await iFt(this,t,e,Pa);return this.lastEditsEventDate=new Date,i}async updateAttachment(t,e,i){const r=await rFt(this,t,e,i,Pa);return this.lastEditsEventDate=new Date,r}async applyEdits(t,e){return sFt(this,t,e)}async uploadAssets(t,e){return nFt(this,t,e)}on(t,e){return super.on(t,e)}createPopupTemplate(t){return T4t(this,t)}async createGraphicsSource(t){if(this._hasMemorySource()&&this.source)return this.source.load({signal:t});const{default:e}=await oie(G(()=>import("./FeatureLayerSource-C46JMZMA.js"),__vite__mapDeps([371,372,373,374,29,22,375,376,41,39,40,109])),t);return new e({layer:this,supportedSourceTypes:this.supportedSourceTypes}).load({signal:t})}createQuery(){const t=mFt(this);t.dynamicDataSource=this.dynamicDataSource;const e=this.subtypeCode!=null?`${this.subtypeField} = ${this.subtypeCode}`:null,i=XJe(this.definitionExpression,e);return t.where=i||"1=1",t}async deleteAttachments(t,e){const i=await oFt(this,t,e,Pa);return this.lastEditsEventDate=new Date,i}async fetchRecomputedExtents(t){return aFt(this,t,Pa)}getFeatureTitle(t,e={timeZone:"system",fetchMissingFields:!1}){return this._titleCreator.getTitle(this,t,e)}getFeatureType(t){return Bze(this.types,this.typeIdField,t)}getFieldDomain(t,e){var i;return yFt(this,t,e,((i=this.getField(t))==null?void 0:i.domain)??null)}async queryAttachments(t,e){return lFt(this,t,e,Pa)}async queryFeatures(t,e){const i=await this.load(),r=await i.source.queryFeatures(ng.from(t)??i.createQuery(),e);if(r!=null&&r.features)for(const s of r.features)s.layer=s.sourceLayer=i;return r}async queryObjectIds(t,e){return(await cFt(this,t,e,Pa)).filter(I_)}async queryFeatureCount(t,e){return uFt(this,t,e,Pa)}async queryExtent(t,e){return hFt(this,t,e,Pa)}async queryRelatedFeatures(t,e){return dFt(this,t,e,Pa)}async queryRelatedFeaturesCount(t,e){return pFt(this,t,e,Pa)}async queryTopFeatures(t,e){var o;const{source:i,capabilities:r}=await this.load();if(!i.queryTopFeatures||!((o=r==null?void 0:r.query)!=null&&o.supportsTopFeaturesQuery))throw new U(Pa,"Layer source does not support queryTopFeatures capability");const s=await G(()=>import("./TopFeaturesQuery-DbfPzVlu.js"),[]),n=await i.queryTopFeatures(s.default.from(t),e);if(n!=null&&n.features)for(const a of n.features)a.layer=a.sourceLayer=this;return n}async queryAttributeBins(t,e){var o;const{source:i,capabilities:r}=await this.load();if(!i.queryAttributeBins||!((o=r==null?void 0:r.operations)!=null&&o.supportsQueryBins))throw new U(Pa,"Layer source does not support queryAttributeBins capability");AFt(t,r,Pa);const s=await G(()=>import("./AttributeBinsQuery-ROoo0rpH.js"),__vite__mapDeps([174,16,12,23])),n=await i.queryAttributeBins(s.default.from(t),e);if(n.features)for(const a of n.features)a.layer=a.sourceLayer=this;return n}async queryTopObjectIds(t,e){const{source:i,capabilities:r}=await this.load();if(!i.queryTopObjectIds||!(r!=null&&r.query.supportsTopFeaturesQuery))throw new U(Pa,"Layer source does not support queryTopObjectIds capability");const s=await G(()=>import("./TopFeaturesQuery-DbfPzVlu.js"),[]);return(await i.queryTopObjectIds(s.default.from(t),e)).filter(I_)}async queryTopFeaturesExtent(t,e){var n;const{source:i,capabilities:r}=await this.load();if(!i.queryTopExtents||!((n=r==null?void 0:r.query)!=null&&n.supportsTopFeaturesQuery))throw new U(Pa,"Layer source does not support queryTopExtents capability");const s=await G(()=>import("./TopFeaturesQuery-DbfPzVlu.js"),[]);return i.queryTopExtents(s.default.from(t),e)}async queryTopFeatureCount(t,e){var n;const{source:i,capabilities:r}=await this.load();if(!i.queryTopCount||!((n=r==null?void 0:r.query)!=null&&n.supportsTopFeaturesQuery))throw new U(Pa,"Layer source does not support queryFeatureCount capability");const s=await G(()=>import("./TopFeaturesQuery-DbfPzVlu.js"),[]);return i.queryTopCount(s.default.from(t),e)}read(t,e){const i=t.featureCollection;if((i||t.type==="Feature Collection")&&(this.resourceInfo=t),i){const r=i.layers;r&&r.length===1&&(super.read(r[0],e),i.showLegend!=null&&super.read({showLegend:i.showLegend},e))}super.read(t,e),e&&e.origin==="service"&&(this.revert(["objectIdField","fields","timeInfo","dateFieldsTimeZone"],"service"),this.spatialReference||this.revert(["spatialReference"],"service"))}write(t,e){e={...e,origin:(e==null?void 0:e.origin)??void 0,writeLayerSchema:(e==null?void 0:e.writeLayerSchema)??this._hasMemorySource()};const{origin:i,layerContainerType:r,messages:s}=e;if(this.dynamicDataSource)return s==null||s.push(Zk(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if((i==="web-map"||i==="web-scene")&&r!=="tables")return s==null||s.push(Zk(this,`a table source can only be written to tables, not ${r}`)),null;if(this._hasMemorySource())return s==null||s.push(Zk(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&(i==="web-map"||i==="web-scene")&&r==="tables")return s==null||s.push(Zk(this,"using a non-table source cannot be written to tables in web maps or web scenes")),null;return super.write(t,e)}clone(){if(this._hasMemorySource())throw new U(Pa,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(t){var e;return!!this.loaded&&(((e=this.source)==null?void 0:e.type)==="memory"||x4t(this,t))}async save(t){return this._debouncedSaveOperations(xl.SAVE,t)}async saveAs(t,e){return this._debouncedSaveOperations(xl.SAVE_AS,e,t)}_readEditingEnabled(t,e,i){var s;let r=(s=t.layerDefinition)==null?void 0:s.capabilities;return r?this._hasEditingCapability(r):(r=t.capabilities,e&&(i==null?void 0:i.origin)==="web-map"&&!this._hasMemorySource()&&r?this._hasEditingCapability(r):void 0)}_hasEditingCapability(t){return t.toLowerCase().split(",").map(e=>e.trim()).includes("editing")}_writeEditingEnabled(t,e,i,r){var s,n;if(!t){const o=(n=(s=this.capabilities)==null?void 0:s.operations)!=null&&n.supportsSync?"Query,Sync":"Query";ro("layerDefinition.capabilities",o,e),i&&!(r!=null&&r.writeLayerSchema)&&(e.capabilities=o)}}_fetchFirstValidLayerId(t){return Ri(this.url??"",{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:t}).then(e=>{const i=e.data;if(i)return this.findFirstValidLayerId(i)})}async initLayerProperties(t){var e;return this._set("source",t),t.sourceJSON&&(this.sourceJSON=t.sourceJSON,this.read(t.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:(e=this.portalItem)==null?void 0:e.portal,url:this.parsedUrl})),this._verifySource(),this._verifyFields(),Qhe(this.renderer,this.fieldsIndex),tAe(this.timeInfo,this.fieldsIndex),this._hasMemorySource()&&this.geometryType==="mesh"&&(this.capabilities.query.supportsReturnMesh=!0),S4t(this,{origin:"service"})}async hasDataChanged(){return fFt(this)}async fetchPublishingStatus(){const t=this.source;return t!=null&&t.fetchPublishingStatus?t.fetchPublishingStatus():"unavailable"}_verifyFields(){var e,i;const t=((e=this.parsedUrl)==null?void 0:e.path)??"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+t+")"),this.isTable||this._hasMemorySource()||t.search(/\/FeatureServer\//i)!==-1||(i=this.fields)!=null&&i.some(r=>r.type==="geometry")||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+t+")")}_fixTemplates(t,e){t&&t.forEach(i=>{var s;const r=(s=i.prototype)==null?void 0:s.attributes;r&&e&&delete r[e]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new U("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new U("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(t){t.forEach(e=>{e.layer=this,e.sourceLayer=this}),this.addHandles([t.on("after-add",e=>{e.item.layer=this,e.item.sourceLayer=this}),t.on("after-remove",e=>{e.item.layer=null,e.item.sourceLayer=null})],"fl-source")}_resetMemorySource(t){t.forEach(e=>{e.layer=null,e.sourceLayer=null}),this.removeHandles("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}findFirstValidLayerId(t){return Array.isArray(t.layers)&&t.layers.length>0?t.layers[0].id:Array.isArray(t.tables)&&t.tables.length>0?t.tables[0].id:void 0}};u([p({clonable:!1,readOnly:!0})],at.prototype,"_titleCreator",null),u([p(rNt)],at.prototype,"attributeTableTemplate",void 0),u([ve("service","capabilities")],at.prototype,"readCapabilities",null),u([p({json:{origins:{"web-scene":{write:!1}},write:!0}})],at.prototype,"charts",void 0),u([p({readOnly:!0})],at.prototype,"createQueryVersion",null),u([p({json:{read:{source:"layerDefinition.copyrightText"}}})],at.prototype,"copyright",void 0),u([p({json:{read:{source:"layerDefinition.displayField"}}})],at.prototype,"displayField",void 0),u([p({types:nb,readOnly:!0})],at.prototype,"defaultSymbol",void 0),u([p({type:Lp})],at.prototype,"dynamicDataSource",void 0),u([p({type:Boolean})],at.prototype,"editingEnabled",null),u([ve(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],at.prototype,"readEditingEnabled",null),u([ve("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],at.prototype,"readEditingEnabledFromWebMap",null),u([_e(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],at.prototype,"writeEditingEnabled",null),u([_e("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],at.prototype,"writeEditingEnabledToWebMap",null),u([p({readOnly:!0})],at.prototype,"effectiveEditingEnabled",null),u([p({clonable:!1,readOnly:!0})],at.prototype,"featureTitleFields",null),u([p({...j7.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:G7}}}}})],at.prototype,"fields",void 0),u([p(j7.fieldsIndex)],at.prototype,"fieldsIndex",void 0),u([p({type:QDt,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],at.prototype,"formTemplate",void 0),u([p({json:{read:{source:"layerDefinition.extent"}}})],at.prototype,"fullExtent",void 0),u([p({json:{origins:{"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:G7,writer(t,e,i){const r=t?Bee.toJSON(t):null;r&&ro(i,r,e)}}}},read:{source:"layerDefinition.geometryType",reader:Bee.read}}})],at.prototype,"geometryType",void 0),u([p({json:{read:{source:"layerDefinition.hasM"}}})],at.prototype,"hasM",void 0),u([p({json:{read:{source:"layerDefinition.hasZ"}}})],at.prototype,"hasZ",void 0),u([p(eNt)],at.prototype,"id",void 0),u([p({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],at.prototype,"infoFor3D",void 0),u([p({json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],at.prototype,"isTable",void 0),u([ve("service","isTable",["type","geometryType"]),ve("isTable",["layerDefinition.type","layerDefinition.geometryType"])],at.prototype,"readIsTable",null),u([_e("web-map","isTable")],at.prototype,"writeIsTable",null),u([p(iH)],at.prototype,"labelsVisible",void 0),u([p({type:[qL],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:V7,write:!1},"web-scene":{name:"layerDefinition.drawingInfo.labelingInfo",read:V7,write:{enabled:!0,layerContainerTypes:Xs}}},name:"layerDefinition.drawingInfo.labelingInfo",read:V7,write:!0}})],at.prototype,"labelingInfo",void 0),u([p((()=>{const t=q(QLt);return t.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(e,i,r){ro(r,eL(e),i)}}},t})())],at.prototype,"opacity",void 0),u([p(XLt)],at.prototype,"legendEnabled",void 0),u([p({type:["show","hide"],json:(()=>{const t=q(Tze.json);return t.origins["portal-item"]={read:!1,write:!1},t})()})],at.prototype,"listMode",void 0),u([ve("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],at.prototype,"readGlobalIdField",null),u([p({json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:G7}}}}})],at.prototype,"objectIdField",void 0),u([ve("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],at.prototype,"readObjectIdField",null),u([p({type:["ArcGISFeatureLayer"],json:{write:{target:"layerType",ignoreOrigin:!0,layerContainerTypes:Xs}}})],at.prototype,"operationalLayerType",void 0),u([p(j7.outFields)],at.prototype,"outFields",void 0),u([p({readOnly:!0})],at.prototype,"parsedUrl",null),u([p({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],at.prototype,"path",void 0),u([p(tH)],at.prototype,"popupEnabled",void 0),u([p({type:oM,json:{name:"popupInfo",write:!0}})],at.prototype,"popupTemplate",void 0),u([p({readOnly:!0})],at.prototype,"defaultPopupTemplate",null),u([p({types:WL,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:Mkt,name:"layerDefinition.drawingInfo.renderer",write:{layerContainerTypes:Xs,overridePolicy:(t,e,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(t,e,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}})],at.prototype,"renderer",null),u([ve("service","renderer",["drawingInfo.renderer","defaultSymbol"]),ve("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],at.prototype,"readRenderer",null),u([p()],at.prototype,"resourceInfo",void 0),u([p((()=>{const t=q(YLt);return t.json.origins["portal-item"]={read:!1,write:!1},t})())],at.prototype,"screenSizePerspectiveEnabled",void 0),u([p({clonable:!1})],at.prototype,"source",null),u([ti("source")],at.prototype,"castSource",null),u([ve("portal-item","source",["featureSet"]),ve("web-map","source",["featureSet"])],at.prototype,"readSource",null),u([p({json:{read:{source:"layerDefinition.extent.spatialReference"}}})],at.prototype,"spatialReference",void 0),u([p({type:Number})],at.prototype,"subtypeCode",void 0),u([p({type:[wle]})],at.prototype,"templates",void 0),u([ve("templates",["editFieldsInfo","creatorField","editorField","templates"])],at.prototype,"readTemplates",null),u([p({type:dUe})],at.prototype,"timeInfo",void 0),u([p()],at.prototype,"title",void 0),u([ve("service","title",["name"]),ve("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],at.prototype,"readTitle",null),u([ve("web-map","title",["layerDefinition.name","title"])],at.prototype,"readTitleFromWebMap",null),u([p({type:String})],at.prototype,"sublayerTitleMode",void 0),u([p({json:{read:!1}})],at.prototype,"type",void 0),u([p({type:String})],at.prototype,"typeIdField",void 0),u([ve("service","typeIdField"),ve("typeIdField",["layerDefinition.typeIdField"])],at.prototype,"readTypeIdField",null),u([p({type:[pUe]})],at.prototype,"types",void 0),u([ve("service","types",["types"]),ve("types",["layerDefinition.types"])],at.prototype,"readTypes",null),u([p({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],at.prototype,"visible",void 0),u([ve("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],at.prototype,"readVisible",null),at=u([A("esri.layers.FeatureLayer")],at);const xle=at,Yk=Object.freeze(Object.defineProperty({__proto__:null,default:xle},Symbol.toStringTag,{value:"Module"}));let Cy=class extends ee{constructor(e){super(e),this.moment=null,this.fullUpdate=!1,this.validateErrorsCreated=!1,this.exceededTransferLimit=null,this.serviceEdits=null,this.discoveredSubnetworks=null}};u([p({type:Date,json:{type:Number,write:{writer:(t,e)=>{e.moment=t?t.getTime():null}}}})],Cy.prototype,"moment",void 0),u([p({type:Boolean,json:{write:!0}})],Cy.prototype,"fullUpdate",void 0),u([p({type:Boolean,json:{write:!0}})],Cy.prototype,"validateErrorsCreated",void 0),u([p({type:Boolean,json:{write:!0}})],Cy.prototype,"exceededTransferLimit",void 0),u([p({type:[Object],json:{write:!0}})],Cy.prototype,"serviceEdits",void 0),u([p({type:[Object],json:{write:!0}})],Cy.prototype,"discoveredSubnetworks",void 0),Cy=u([A("esri.rest.networks.support.ValidateNetworkTopologyResult")],Cy);const P4t=Cy,D4t=Oo()({Pending:"job-waiting",InProgress:"job-executing",Completed:"job-succeeded"});let __=class extends P4t{constructor(e){super(e),this.statusUrl=null,this.status=null,this.submissionTime=null,this.lastUpdatedTime=null,this._timer=void 0}destroy(){clearInterval(this._timer)}async checkJobStatus(e){const i={...e,query:{f:"json"}},{data:r}=await Ri(this.statusUrl,i);return this.read(r),this.editsResolver&&this.editsResolver.resolve({edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],exceededTransferLimit:!0,historicMoment:null}),this}async waitForJobCompletion(e={}){const{interval:i=1e3,statusCallback:r}=e;return new Promise((s,n)=>{this._clearTimer();const o=setInterval(()=>{this._timer||n(bi()),this.checkJobStatus().then(a=>{const{status:l}=a;switch(this.status=l,l){case"job-succeeded":this._clearTimer(),s(this);break;case"job-waiting":case"job-executing":r&&r(this)}},a=>{this._clearTimer(),n(a)})},i);this._timer=o})}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};u([p()],__.prototype,"editsResolver",void 0),u([p({type:String,json:{write:!0}})],__.prototype,"statusUrl",void 0),u([Ve(D4t)],__.prototype,"status",void 0),u([p({type:Date,json:{type:Number,write:{writer:(t,e)=>{e.submissionTime=t?t.getTime():null}}}})],__.prototype,"submissionTime",void 0),u([p({type:Date,json:{type:Number,write:{writer:(t,e)=>{e.lastUpdatedTime=t?t.getTime():null}}}})],__.prototype,"lastUpdatedTime",void 0),__=u([A("esri.networks.support.TopologyValidationJobInfo")],__);const L4t=__;async function r1e(t,e){if(t==="Utility Network Layer"){const{default:i}=await G(()=>Promise.resolve().then(()=>K4t),void 0);return new i({layerUrl:e})}return null}async function N4t(t){var o;let e="portalItem"in t?t:{portalItem:t};!e.portalItem||e.portalItem instanceof nh||(e={...e,portalItem:new nh(e.portalItem)});const i=e.portalItem;if(await i.load(),i.type!=="Feature Service")throw new U("portal:unknown-item-type","Unknown item type '${type}'",{type:i.type});const r=i.url,s=await Ri(r,{responseType:"json",query:{f:"json"}}),n="Network Layer";if((o=s.data.type)!=null&&o.includes(n))return r1e(s.data.type,r);if(s.data.layers){const a=s.data.layers.find(l=>l.type.includes(n));if(a){const l=`${r}/${a.id}`;return r1e(a.type,l)}}return null}let Zn=class extends jL(Il){static fromPortalItem(e){return N4t(e)}constructor(e){super(e),this.id=null,this.title=null,this.layerUrl=null,this.dataElement=null,this.fullExtent=null,this.spatialReference=null,this.type=null,this.sourceJSON=null,this.gdbVersion=null,this.historicMoment=null,this._sourceIdByLayerId=new Map,this._layerIdBySourceId=new Map,this._applyEditsHandler=i=>{const{serviceUrl:r,gdbVersion:s,result:n}=i,o=r===this.featureServiceUrl,a=DP(r,s,this.gdbVersion);o&&a&&n.then(l=>{$z(r,s)&&(this.historicMoment=l.historicMoment)})},this._updateMomentHandler=i=>{const{serviceUrl:r,gdbVersion:s,moment:n}=i,o=r===this.featureServiceUrl,a=DP(r,s,this.gdbVersion);o&&a&&(this.historicMoment=n)},this.when().then(()=>{this.addHandles([gze(this._applyEditsHandler),yze(this._updateMomentHandler)])},()=>{})}initialize(){this.when().catch(e=>{es(e)||J.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}get datasetName(){var e;return((e=this.dataElement)==null?void 0:e.name)??null}get owner(){var e;return((e=this.dataElement)==null?void 0:e.userIdentity)??null}get schemaGeneration(){var e;return((e=this.dataElement)==null?void 0:e.schemaGeneration)??null}get parsedUrl(){return yn(this.layerUrl)}get featureServiceUrl(){return Rb(this.parsedUrl.path).url.path}get networkServiceUrl(){return this.featureServiceUrl.replace(/\/FeatureServer/i,"/UtilityNetworkServer")}get layerId(){return Rb(this.parsedUrl.path).sublayer}get networkSystemLayers(){return null}async load(e){return this.addResolvingPromise(this._fetchDataElement(this.featureServiceUrl,this.layerId.toString(),e)),this.addResolvingPromise(this._fetchLayerMetaData(this.layerUrl,e)),this}getLayerIdBySourceId(e){if(!this.dataElement)return null;const i=this._layerIdBySourceId.get(e);if(i!=null)return i;const r=this.dataElement.domainNetworks,s=this._traverseNetworkSources(r,this._layerIdBySourceId,"sourceId","layerId",e);return s>=0?s:null}getSourceIdByLayerId(e){if(!this.dataElement)return null;const i=this._sourceIdByLayerId.get(e);if(i!=null)return i;const r=this.dataElement.domainNetworks,s=this._traverseNetworkSources(r,this._sourceIdByLayerId,"layerId","sourceId",e);return s>=0?s:null}getObjectIdsFromElements(e){const i=[],r=new Map;for(const n of e){const o=this.getLayerIdBySourceId(n.networkSourceId);if(o==null)continue;let a=r.get(o);a===void 0&&(a=[]),a.push(n.objectId),r.set(o,a)}const s=this.featureServiceUrl;return r.forEach((n,o)=>i.push({layerUrl:`${s}/${o}`,objectIds:n})),i}async queryNamedTraceConfigurations(e,i){var a;const[{queryNamedTraceConfigurations:r},{default:s}]=await Promise.all([G(()=>import("./queryNamedTraceConfigurations-Cn7zYXuv.js"),[]),G(()=>import("./QueryNamedTraceConfigurationsParameters-BiiljaFH.js"),[])]),n=this.networkServiceUrl,o=s.from(e);return(a=await r(n,o,{...i}))==null?void 0:a.namedTraceConfigurations}async validateTopology(e,i){var h,d,f;if(!e.validateArea)throw new U("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");const[{validateNetworkTopology:r},{default:s}]=await Promise.all([G(()=>import("./validateNetworkTopology-_w9Mcqgp.js"),[]),G(()=>import("./ValidateNetworkTopologyParameters-Bj1r1kxt.js"),[])]),n=s.from(e);$z(this.featureServiceUrl,this.gdbVersion||null)?(n.sessionID=lee,await twe(this.featureServiceUrl,this.gdbVersion,!0)):n.sessionID=null,n.gdbVersion=this.gdbVersion;const o=this.networkServiceUrl,a=this.featureServiceUrl,l=iwe(a,null,this.gdbVersion,!0),c=await r(o,n,{...i});if(c!=null&&c.serviceEdits){const m=[];for(const g of c.serviceEdits){const{editedFeatures:v}=g,_=v!=null&&v.spatialReference?new Oe(v.spatialReference):null;m.push({layerId:g.layerId,editedFeatures:{adds:((h=v==null?void 0:v.adds)==null?void 0:h.map(b=>Jk(b,_)))||[],updates:((d=v==null?void 0:v.updates)==null?void 0:d.map(b=>({original:Jk(b[0],_),current:Jk(b[1],_)})))||[],deletes:((f=v==null?void 0:v.deletes)==null?void 0:f.map(b=>Jk(b,_)))||[],spatialReference:_}})}l.resolve({edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],editedFeatures:m,exceededTransferLimit:!1,historicMoment:c.moment})}return c}async submitTopologyValidationJob(e,i){let r=null;if(!e.validateArea)throw new U("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");if(!this.gdbVersion){const h=this.layerUrl.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");r=(await Ri(h,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}const[{submitValidateNetworkTopologyJob:s},{default:n}]=await Promise.all([G(()=>import("./validateNetworkTopology-_w9Mcqgp.js"),[]),G(()=>import("./ValidateNetworkTopologyParameters-Bj1r1kxt.js"),[])]),o=n.from(e);$z(this.featureServiceUrl,this.gdbVersion||null)?(o.sessionID=lee,await twe(this.featureServiceUrl,this.gdbVersion,!0)):o.sessionID=null,o.gdbVersion=this.gdbVersion||r;const a=this.networkServiceUrl,l=this.featureServiceUrl?iwe(this.featureServiceUrl,null,this.gdbVersion,!0):void 0,c=await s(a,o,{...i});return new L4t({statusUrl:c,editsResolver:l})}getSourceTypeById(e){if(!this.dataElement)return null;for(const i of this.dataElement.domainNetworks)for(const r of[i.edgeSources??[],i.junctionSources??[]])for(const s of r)if(s.sourceId===e)return r===i.edgeSources?"edge":"junction";return null}_traverseNetworkSources(e,i,r,s,n){for(const o of e)for(const a of[o.edgeSources??[],o.junctionSources??[]])for(const l of a)if(l[r]===n)return i.set(n,l[s]),l[s];return-1}async _fetchLayerMetaData(e,i){const r=await Ri(e,{responseType:"json",query:{f:"json"},...i});this.sourceJSON=r.data,this.read(r.data,{origin:"service"})}async _fetchDataElement(e,i,r){if(this.dataElement)return;const s=await Ri(`${e}/queryDataElements`,{responseType:"json",query:{layers:JSON.stringify([i]),f:"json"},...r}).then(n=>{var o;return(o=n.data.layerDataElements)==null?void 0:o[0]});s&&this.read(s,{origin:"service"})}};function Jk(t,e){return new Pl({attributes:t.attributes,geometry:pf({...t.geometry,spatialReference:e})})}u([p({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:!0}},read:!1}})],Zn.prototype,"id",void 0),u([p({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:{source:"name"}}},read:!1}})],Zn.prototype,"title",void 0),u([p({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"url"},write:{target:"url",isRequired:!0}}},read:!1}})],Zn.prototype,"layerUrl",void 0),u([p({type:Object,json:{origins:{service:{read:!0}},read:!1}})],Zn.prototype,"dataElement",void 0),u([p({type:_i,json:{origins:{service:{read:{source:"extent"}}},read:!1}})],Zn.prototype,"fullExtent",void 0),u([p({type:Oe,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:!1}})],Zn.prototype,"spatialReference",void 0),u([p({type:["utility","trace"],readOnly:!0,json:{read:!1,write:!1}})],Zn.prototype,"type",void 0),u([p({readOnly:!0})],Zn.prototype,"datasetName",null),u([p({readOnly:!0})],Zn.prototype,"owner",null),u([p({readOnly:!0})],Zn.prototype,"schemaGeneration",null),u([p({readOnly:!0})],Zn.prototype,"parsedUrl",null),u([p({readOnly:!0})],Zn.prototype,"featureServiceUrl",null),u([p({readOnly:!0})],Zn.prototype,"networkServiceUrl",null),u([p({readOnly:!0})],Zn.prototype,"layerId",null),u([p()],Zn.prototype,"sourceJSON",void 0),u([p({readOnly:!0})],Zn.prototype,"networkSystemLayers",null),u([p()],Zn.prototype,"gdbVersion",void 0),u([p({type:Date})],Zn.prototype,"historicMoment",void 0),Zn=u([A("esri.networks.Network")],Zn);const F4t=Zn;var Bc;(function(t){t[t.RTJunctionJunctionConnectivity=1]="RTJunctionJunctionConnectivity",t[t.RTContainment=2]="RTContainment",t[t.RTAttachment=3]="RTAttachment",t[t.RTJunctionEdgeConnectivity=4]="RTJunctionEdgeConnectivity",t[t.RTEdgeJunctionEdgeConnectivity=5]="RTEdgeJunctionEdgeConnectivity"})(Bc||(Bc={}));const Xk=new ni({connected:"connected",upstream:"upstream",downstream:"downstream",shortestPath:"shortest-path",subnetwork:"subnetwork",subnetworkController:"subnetwork-controller",loops:"loops",isolation:"isolation"}),fmi=new ni({junctionJunctionConnectivity:"junction-junction-connectivity",connectivity:"connectivity",attachment:"attachment",containment:"containment",junctionEdgeFromConnectivity:"junction-edge-from-connectivity",junctionEdgeMidspanConnectivity:"junction-edge-midspan-connectivity",junctionEdgeToConnectivity:"junction-edge-to-connectivity"}),k4t={connectivity:1,"junction-junction-connectivity":1,containment:2,attachment:3,"junction-edge-from-connectivity":4,"junction-edge-midspan-connectivity":5,"junction-edge-to-connectivity":6},mmi=new ni({normal:"normal",rebuild:"rebuild",forceRebuild:"force-rebuild"});let b_=class extends ee.JSONSupportMixin(Il){constructor(e){super(e),this.rulesCategorized={attachment:[],containment:[],connectivity:[]},this.request=Ri}initialize(){}async load(e){const i=this.rulesLayer.load(e).then(()=>this._initializeRulesTable());return this.addResolvingPromise(i),this}getFeaturesCanAssociateWithClause(e,i,r){return this._getWhereClauseForCompatibleFeatures(e,i,r)}getFeaturesCanAssociateWith(e,i,r){return this._getFeatureSourceLayerId(e)==null?[]:i.filter(s=>this.canAssociateFeatures(e,s,r))}canAssociateFeatures(e,i,r){const[s,n]=this._getFeatureAssetCodes(e),o=this._getFeatureSourceLayerId(e),[a,l]=this._getFeatureAssetCodes(i),c=this._getFeatureSourceLayerId(i);return o!=null&&c!=null&&r.some(h=>{const{type:d,direction:f}=h;return this._getRulesForAssociationType(d).some(m=>{const g=this._getRuleFieldValuesForAssociation(m,d,f);return g==null?void 0:g.some(v=>o===(v==null?void 0:v.ruleLayerIdForSource)&&s===(v==null?void 0:v.ruleAssetGroupCodeForSource)&&n===(v==null?void 0:v.ruleAssetTypeCodeForSource)&&c===(v==null?void 0:v.ruleLayerIdForTarget)&&a===(v==null?void 0:v.ruleAssetGroupCodeForTarget)&&l===(v==null?void 0:v.ruleAssetTypeCodeForTarget))})})}getLayersCanAssociateWith(e,i,r){return this._getFeatureSourceLayerId(e)==null?[]:i.filter(s=>this.canAssociateFeatureToLayer(e,s,r))}canAssociateFeatureToLayer(e,i,r){const s=id(i)?i.parent:i;if(!s)return!1;const n=s.layerId,o=id(i)?i.subtypeCode:null,[a,l]=this._getFeatureAssetCodes(e),c=this._getFeatureSourceLayerId(e);return c!=null&&r.some(h=>{const{type:d,direction:f}=h;return this._getRulesForAssociationType(d).some(m=>{const g=this._getRuleFieldValuesForAssociation(m,d,f);return g==null?void 0:g.some(v=>c===(v==null?void 0:v.ruleLayerIdForSource)&&a===(v==null?void 0:v.ruleAssetGroupCodeForSource)&&l===(v==null?void 0:v.ruleAssetTypeCodeForSource)&&n===(v==null?void 0:v.ruleLayerIdForTarget)&&(o==null||o===(v==null?void 0:v.ruleAssetGroupCodeForTarget)))})})}getFeatureSQL(e,i){var c,h;const r=e.layerId.toString(),s=(c=e.fieldsIndex)==null?void 0:c.normalizeFieldName("assetGroup"),n=(h=e.fieldsIndex)==null?void 0:h.normalizeFieldName("assetType"),o=s?i.attributes[s]:null,a=n?i.attributes[n]:null,l=this.rulesHash[r];if(l){const d=l.assetGroupHash[o];if(d)return d.assetTypeHash[a]||null}return null}async _initializeRulesTable(){var s,n,o,a,l,c,h,d,f,m,g;const e={};let i;(function(v){v[v.from=0]="from",v[v.to=1]="to",v[v.via=2]="via"})(i||(i={}));const r=[{networkSourceId:"fromNetworkSource",assetGroupId:"fromAssetGroup",assetTypeId:"fromAssetType"},{networkSourceId:"toNetworkSource",assetGroupId:"toAssetGroup",assetTypeId:"toAssetType"},{networkSourceId:"viaNetworkSource",assetGroupId:"viaAssetGroup",assetTypeId:"viaAssetType"}];this.rulesCategorized={attachment:[],containment:[],connectivity:[]};for(const v of this.rules){if(v.ruleType===Bc.RTAttachment){this.rulesCategorized.attachment.push(v);continue}if(v.ruleType===Bc.RTContainment){this.rulesCategorized.containment.push(v);continue}if(v.ruleType===Bc.RTJunctionJunctionConnectivity){this.rulesCategorized.connectivity.push(v);continue}this.rulesCategorized.connectivity.push(v);let _=[[i.from,i.to],[i.to,i.from]];v.ruleType===Bc.RTEdgeJunctionEdgeConnectivity&&(_=[[i.from,i.via],[i.via,i.from],[i.to,i.via],[i.via,i.to]]);for(const b of _){const w=b.shift(),x=b.shift();let S=!1;switch(v.ruleType){case Bc.RTEdgeJunctionEdgeConnectivity:S=w===i.from||w===i.to;break;case Bc.RTJunctionEdgeConnectivity:S=w===i.to}const C=r[w],T=((s=v[C.networkSourceId])==null?void 0:s.layerId.toString())??"",M=(o=(n=v[C.assetGroupId])==null?void 0:n.assetGroupCode)==null?void 0:o.toString(),I=v[C.assetTypeId],D=(a=I==null?void 0:I.assetTypeCode)==null?void 0:a.toString(),P=r[x],F=((l=v[P.networkSourceId])==null?void 0:l.layerId.toString())??"",L=(h=(c=v[P.assetGroupId])==null?void 0:c.assetGroupCode)==null?void 0:h.toString(),N=v[P.assetTypeId],R=(d=N==null?void 0:N.assetTypeCode)==null?void 0:d.toString(),k=e[T]??{assetGroupHash:{}};if(!(M&&D&&L&&R))continue;const W=k.assetGroupHash[M]??{assetTypeHash:{}},j=W.assetTypeHash[D]??{};if(j[F]=j[F]??{},S){j[T]=j[T]??{};const te=`(assetgroup = ${M} AND assettype = ${D})`;(N==null?void 0:N.connectivityPolicy)==="esriNECPEndVertex"?j[T].endVertex=(f=j[T])!=null&&f.endVertex?`${j[T].endVertex}`:`${te}`:j[T].anyVertex=j[T].anyVertex?`${j[T].anyVertex}`:`${te}`}const B=`(assetgroup = ${L} AND assettype = ${R})`;(N==null?void 0:N.connectivityPolicy)==="esriNECPEndVertex"?j[F].endVertex=(m=j[F])!=null&&m.endVertex?`${j[F].endVertex} OR ${B}`:`${B}`:j[F].anyVertex=(g=j[F])!=null&&g.anyVertex?`${j[F].anyVertex} OR ${B}`:`${B}`,W.assetTypeHash[D]=j,k.assetGroupHash[M]=W,e[T]=k}}this._set("rulesHash",e)}_getRuleFieldValuesForAssociation(e,i,r="from"){var s,n,o,a,l,c,h,d,f,m,g,v,_,b,w,x,S,C,T,M,I,D,P,F,L,N,R,k,W,j,B,te,le,de,Ae,We,Ue,it,Et,Jt,wt,vt,Ft,xt,zt,ut,_t,me,ye,we,ke,Ge,Ot,He,yt,Se,ze,bt,qi,ji;switch(i){case"attachment":case"containment":return r==="from"?[{ruleLayerIdForSource:(s=e.fromNetworkSource)==null?void 0:s.layerId,ruleAssetGroupCodeForSource:(n=e.fromAssetGroup)==null?void 0:n.assetGroupCode,ruleAssetTypeCodeForSource:(o=e.fromAssetType)==null?void 0:o.assetTypeCode,ruleLayerIdForTarget:(a=e.toNetworkSource)==null?void 0:a.layerId,ruleAssetGroupCodeForTarget:(l=e.toAssetGroup)==null?void 0:l.assetGroupCode,ruleAssetTypeCodeForTarget:(c=e.toAssetType)==null?void 0:c.assetTypeCode}]:[{ruleLayerIdForSource:(h=e.toNetworkSource)==null?void 0:h.layerId,ruleAssetGroupCodeForSource:(d=e.toAssetGroup)==null?void 0:d.assetGroupCode,ruleAssetTypeCodeForSource:(f=e.toAssetType)==null?void 0:f.assetTypeCode,ruleLayerIdForTarget:(m=e.fromNetworkSource)==null?void 0:m.layerId,ruleAssetGroupCodeForTarget:(g=e.fromAssetGroup)==null?void 0:g.assetGroupCode,ruleAssetTypeCodeForTarget:(v=e.fromAssetType)==null?void 0:v.assetTypeCode}];case"connectivity":case"junction-junction-connectivity":return[{ruleLayerIdForSource:(_=e.fromNetworkSource)==null?void 0:_.layerId,ruleAssetGroupCodeForSource:(b=e.fromAssetGroup)==null?void 0:b.assetGroupCode,ruleAssetTypeCodeForSource:(w=e.fromAssetType)==null?void 0:w.assetTypeCode,ruleLayerIdForTarget:(x=e.toNetworkSource)==null?void 0:x.layerId,ruleAssetGroupCodeForTarget:(S=e.toAssetGroup)==null?void 0:S.assetGroupCode,ruleAssetTypeCodeForTarget:(C=e.toAssetType)==null?void 0:C.assetTypeCode},{ruleLayerIdForSource:(T=e.toNetworkSource)==null?void 0:T.layerId,ruleAssetGroupCodeForSource:(M=e.toAssetGroup)==null?void 0:M.assetGroupCode,ruleAssetTypeCodeForSource:(I=e.toAssetType)==null?void 0:I.assetTypeCode,ruleLayerIdForTarget:(D=e.fromNetworkSource)==null?void 0:D.layerId,ruleAssetGroupCodeForTarget:(P=e.fromAssetGroup)==null?void 0:P.assetGroupCode,ruleAssetTypeCodeForTarget:(F=e.fromAssetType)==null?void 0:F.assetTypeCode}];case"junction-edge-from-connectivity":case"junction-edge-midspan-connectivity":case"junction-edge-to-connectivity":return e.ruleType===Bc.RTEdgeJunctionEdgeConnectivity?[{ruleLayerIdForSource:(L=e.fromNetworkSource)==null?void 0:L.layerId,ruleAssetGroupCodeForSource:(N=e.fromAssetGroup)==null?void 0:N.assetGroupCode,ruleAssetTypeCodeForSource:(R=e.fromAssetType)==null?void 0:R.assetTypeCode,ruleLayerIdForTarget:(k=e.viaNetworkSource)==null?void 0:k.layerId,ruleAssetGroupCodeForTarget:(W=e.viaAssetGroup)==null?void 0:W.assetGroupCode,ruleAssetTypeCodeForTarget:(j=e.viaAssetType)==null?void 0:j.assetTypeCode},{ruleLayerIdForSource:(B=e.viaNetworkSource)==null?void 0:B.layerId,ruleAssetGroupCodeForSource:(te=e.viaAssetGroup)==null?void 0:te.assetGroupCode,ruleAssetTypeCodeForSource:(le=e.viaAssetType)==null?void 0:le.assetTypeCode,ruleLayerIdForTarget:(de=e.fromNetworkSource)==null?void 0:de.layerId,ruleAssetGroupCodeForTarget:(Ae=e.fromAssetGroup)==null?void 0:Ae.assetGroupCode,ruleAssetTypeCodeForTarget:(We=e.fromAssetType)==null?void 0:We.assetTypeCode},{ruleLayerIdForSource:(Ue=e.toNetworkSource)==null?void 0:Ue.layerId,ruleAssetGroupCodeForSource:(it=e.toAssetGroup)==null?void 0:it.assetGroupCode,ruleAssetTypeCodeForSource:(Et=e.toAssetType)==null?void 0:Et.assetTypeCode,ruleLayerIdForTarget:(Jt=e.viaNetworkSource)==null?void 0:Jt.layerId,ruleAssetGroupCodeForTarget:(wt=e.viaAssetGroup)==null?void 0:wt.assetGroupCode,ruleAssetTypeCodeForTarget:(vt=e.viaAssetType)==null?void 0:vt.assetTypeCode},{ruleLayerIdForSource:(Ft=e.viaNetworkSource)==null?void 0:Ft.layerId,ruleAssetGroupCodeForSource:(xt=e.viaAssetGroup)==null?void 0:xt.assetGroupCode,ruleAssetTypeCodeForSource:(zt=e.viaAssetType)==null?void 0:zt.assetTypeCode,ruleLayerIdForTarget:(ut=e.toNetworkSource)==null?void 0:ut.layerId,ruleAssetGroupCodeForTarget:(_t=e.toAssetGroup)==null?void 0:_t.assetGroupCode,ruleAssetTypeCodeForTarget:(me=e.toAssetType)==null?void 0:me.assetTypeCode}]:[{ruleLayerIdForSource:(ye=e.fromNetworkSource)==null?void 0:ye.layerId,ruleAssetGroupCodeForSource:(we=e.fromAssetGroup)==null?void 0:we.assetGroupCode,ruleAssetTypeCodeForSource:(ke=e.fromAssetType)==null?void 0:ke.assetTypeCode,ruleLayerIdForTarget:(Ge=e.toNetworkSource)==null?void 0:Ge.layerId,ruleAssetGroupCodeForTarget:(Ot=e.toAssetGroup)==null?void 0:Ot.assetGroupCode,ruleAssetTypeCodeForTarget:(He=e.toAssetType)==null?void 0:He.assetTypeCode},{ruleLayerIdForSource:(yt=e.toNetworkSource)==null?void 0:yt.layerId,ruleAssetGroupCodeForSource:(Se=e.toAssetGroup)==null?void 0:Se.assetGroupCode,ruleAssetTypeCodeForSource:(ze=e.toAssetType)==null?void 0:ze.assetTypeCode,ruleLayerIdForTarget:(bt=e.fromNetworkSource)==null?void 0:bt.layerId,ruleAssetGroupCodeForTarget:(qi=e.fromAssetGroup)==null?void 0:qi.assetGroupCode,ruleAssetTypeCodeForTarget:(ji=e.fromAssetType)==null?void 0:ji.assetTypeCode}];default:return[]}}_getWhereClauseForCompatibleFeatures(e,i,r){const s=new Map,[n,o]=this._getAssetFieldNames(e.sourceLayer),[a,l]=this._getFeatureAssetCodes(e),c=this._getFeatureSourceLayerId(e),h=id(i)?i.parent:i,d=id(i)?i.subtypeCode:null;r.forEach(m=>{const{type:g,direction:v}=m;this._getRulesForAssociationType(g).forEach(_=>{this._getRuleFieldValuesForAssociation(_,g,v).forEach(b=>{if(b.ruleAssetGroupCodeForTarget!=null&&b.ruleAssetTypeCodeForTarget!=null&&c===(b==null?void 0:b.ruleLayerIdForSource)&&a===(b==null?void 0:b.ruleAssetGroupCodeForSource)&&l===(b==null?void 0:b.ruleAssetTypeCodeForSource)&&h.layerId===(b==null?void 0:b.ruleLayerIdForTarget)&&(d==null||d===(b==null?void 0:b.ruleAssetGroupCodeForTarget))){const w=s.get(b.ruleAssetGroupCodeForTarget)??new Set;w.add(b.ruleAssetTypeCodeForTarget),s.set(b.ruleAssetGroupCodeForTarget,w)}})})});let f=[];return this._mergeAssetCodes(s).forEach((m,g)=>f.push(`${n} IN (${g}) AND ${o} IN (${Array.from(m).sort().join(", ")})`)),f.length>1&&(f=f.map(m=>`(${m})`)),f.join(" OR ")}_getRulesForAssociationType(e){const{rulesCategorized:i}=this;switch(e){case"attachment":return i.attachment;case"containment":return i.containment;case"connectivity":case"junction-junction-connectivity":return i.connectivity.filter(r=>r.ruleType===Bc.RTJunctionJunctionConnectivity);case"junction-edge-from-connectivity":case"junction-edge-midspan-connectivity":case"junction-edge-to-connectivity":return i.connectivity.filter(r=>r.ruleType===Bc.RTJunctionEdgeConnectivity||r.ruleType===Bc.RTEdgeJunctionEdgeConnectivity);default:return[]}}_getFeatureSourceLayerId(e){var s;const{sourceLayer:i}=e;let r;return gYe(i)?r=i.layerId:id(i)&&(r=(s=i.parent)==null?void 0:s.layerId),r??null}_getAssetFieldNames(e){return!e||!("fieldsIndex"in e)?[null,null]:[e.fieldsIndex.normalizeFieldName("assetGroup")??null,e.fieldsIndex.normalizeFieldName("assetType")??null]}_getFeatureAssetCodes(e){const[i,r]=this._getAssetFieldNames(e.sourceLayer);return[i?e.attributes[i]:null,r?e.attributes[r]:null]}_areSetsEqual(e,i){if(e.size!==i.size)return!1;for(const r of e)if(!i.has(r))return!1;return!0}_mergeAssetCodes(e){const i=new Map,r=new Set;for(const[s,n]of e){const o=new Set([s]);for(const[l,c]of e)s!==l&&!r.has(l)&&this._areSetsEqual(n,c)&&(o.add(l),r.add(l));const a=Array.from(o).sort().join(", ");i.set(a,n)}return i}};u([p({constructOnly:!0})],b_.prototype,"rulesLayer",void 0),u([p({constructOnly:!0})],b_.prototype,"rules",void 0),u([p({readOnly:!0})],b_.prototype,"rulesHash",void 0),u([p()],b_.prototype,"rulesCategorized",void 0),u([p({constructOnly:!0})],b_.prototype,"request",void 0),b_=u([A("esri.networks.RulesTable")],b_);const z4t=b_;let kh=class extends ee{constructor(e){super(e),this.conditionBarriers=[],this.outputConditions=[],this.functions=[],this.functionBarriers=[],this.traversabilityScope=null,this.shortestPathNetworkAttributeName=null,this.includeBarriers=null,this.validateConsistency=null,this.ignoreBarriersAtStartingPoints=null}};u([p({type:[Object],json:{write:!0}})],kh.prototype,"conditionBarriers",void 0),u([p({type:[Object],json:{write:!0}})],kh.prototype,"outputConditions",void 0),u([p({type:[Object],json:{write:!0}})],kh.prototype,"functions",void 0),u([p({type:[Object],json:{write:!0}})],kh.prototype,"functionBarriers",void 0),u([p({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],kh.prototype,"traversabilityScope",void 0),u([p({type:String,json:{write:!0}})],kh.prototype,"shortestPathNetworkAttributeName",void 0),u([p({type:Boolean,json:{write:!0}})],kh.prototype,"includeBarriers",void 0),u([p({type:Boolean,json:{write:!0}})],kh.prototype,"validateConsistency",void 0),u([p({type:Boolean,json:{write:!0}})],kh.prototype,"ignoreBarriersAtStartingPoints",void 0),kh=u([A("esri.networks.support.TraceConfiguration")],kh);const Sle=kh;let rn=class extends Sle{constructor(e){super(e),this.filterBarriers=[],this.arcadeExpressionBarrier=null,this.domainNetworkName=null,this.filterBitsetNetworkAttributeName=null,this.filterFunctionBarriers=[],this.filterScope=null,this.includeContainers=null,this.includeContent=null,this.includeIsolated=null,this.includeStructures=null,this.allowIndeterminateFlow=null,this.includeUpToFirstSpatialContainer=null,this.nearestNeighbor=null,this.outputFilterCategories=[],this.outputFilters=[],this.propagators=[],this.subnetworkName=null,this.targetTierName=null,this.diagramTemplateName=null,this.tierName=null,this.validateLocatability=null}};u([p({type:[Object],json:{write:!0}})],rn.prototype,"filterBarriers",void 0),u([p({type:String,json:{write:!0}})],rn.prototype,"arcadeExpressionBarrier",void 0),u([p({type:String,json:{write:!0}})],rn.prototype,"domainNetworkName",void 0),u([p({type:String,json:{write:!0}})],rn.prototype,"filterBitsetNetworkAttributeName",void 0),u([p({type:[Object],json:{write:!0}})],rn.prototype,"filterFunctionBarriers",void 0),u([p({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],rn.prototype,"filterScope",void 0),u([p({type:Boolean,json:{write:!0}})],rn.prototype,"includeContainers",void 0),u([p({type:Boolean,json:{write:!0}})],rn.prototype,"includeContent",void 0),u([p({type:Boolean,json:{write:!0}})],rn.prototype,"includeIsolated",void 0),u([p({type:Boolean,json:{write:!0}})],rn.prototype,"includeStructures",void 0),u([p({type:Boolean,json:{write:!0}})],rn.prototype,"allowIndeterminateFlow",void 0),u([p({type:Boolean,json:{write:!0}})],rn.prototype,"includeUpToFirstSpatialContainer",void 0),u([p({type:Object,json:{write:!0}})],rn.prototype,"nearestNeighbor",void 0),u([p({type:[Object],json:{write:!0}})],rn.prototype,"outputFilterCategories",void 0),u([p({type:[Object],json:{write:!0}})],rn.prototype,"outputFilters",void 0),u([p({type:[Object],json:{write:!0}})],rn.prototype,"propagators",void 0),u([p({type:String,json:{write:!0}})],rn.prototype,"subnetworkName",void 0),u([p({type:String,json:{write:!0}})],rn.prototype,"targetTierName",void 0),u([p({type:String,json:{write:!0}})],rn.prototype,"diagramTemplateName",void 0),u([p({type:String,json:{write:!0}})],rn.prototype,"tierName",void 0),u([p({type:Boolean,json:{write:!0}})],rn.prototype,"validateLocatability",void 0),rn=u([A("esri.networks.support.UNTraceConfiguration")],rn);const U4t=rn;let Pc=class extends dD{constructor(e){super(e),this.globalId=null,this.title=null,this.traceConfiguration=null,this.creationDate=null,this.creator=null,this.description=null,this.minStartingPoints=null,this.resultTypes=[],this.tags=[],this.traceType=null}readTraceConfiguration(e,i){return e.tierName!==void 0?U4t.fromJSON(e):Sle.fromJSON(e)}};u([p({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"id"},write:{target:"id",isRequired:!0}},service:{read:{source:"globalId"},write:{target:"globalId",isRequired:!0}}},read:!1}})],Pc.prototype,"globalId",void 0),u([p({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"title"},write:{target:"title",isRequired:!0}},service:{read:{source:"name"},write:{target:"name",isRequired:!0}}},read:!1}})],Pc.prototype,"title",void 0),u([p({type:Sle,json:{origins:{service:{read:!0,write:!0}},read:!1}})],Pc.prototype,"traceConfiguration",void 0),u([ve("service","traceConfiguration")],Pc.prototype,"readTraceConfiguration",null),u([p({type:Date,json:{origins:{service:{read:!0,write:!0}},read:!1}})],Pc.prototype,"creationDate",void 0),u([p({type:String,json:{origins:{service:{read:!0,write:!0}},read:!1}})],Pc.prototype,"creator",void 0),u([p({type:String,json:{origins:{service:{read:!0,write:!0}},read:!1}})],Pc.prototype,"description",void 0),u([p({type:["none","one","many"],json:{origins:{service:{read:{source:"minNumStartingPoints"},write:{target:"minNumStartingPoints"}}},read:!1}})],Pc.prototype,"minStartingPoints",void 0),u([p({json:{origins:{service:{read:!0,write:!0}},read:!1}})],Pc.prototype,"resultTypes",void 0),u([p({type:[String],json:{origins:{service:{read:!0,write:!0}},read:!1}})],Pc.prototype,"tags",void 0),u([p({type:Xk.apiValues,json:{type:Xk.jsonValues,origins:{service:{read:Xk.read,write:Xk.write}},read:!1}})],Pc.prototype,"traceType",void 0),Pc=u([A("esri.networks.support.NamedTraceConfiguration")],Pc);const B4t=Pc;function V4t(t){var m,g,v,_,b,w,x,S,C,T,M;const e=t==null?void 0:t.fieldsIndex,i="fromnetworksourceid",r="fromglobalid",s="fromterminalid",n="tonetworksourceid",o="toglobalid",a="toterminalid",l="status",c="associationtype",h="iscontentvisible",d="percentalong",f="globalid";return{fromNetworkSourceId:((m=e==null?void 0:e.get(i))==null?void 0:m.name)??i,fromGlobalId:((g=e==null?void 0:e.get(r))==null?void 0:g.name)??r,fromTerminalId:((v=e==null?void 0:e.get(s))==null?void 0:v.name)??s,toNetworkSourceId:((_=e==null?void 0:e.get(n))==null?void 0:_.name)??n,toGlobalId:((b=e==null?void 0:e.get(o))==null?void 0:b.name)??o,toTerminalId:((w=e==null?void 0:e.get(a))==null?void 0:w.name)??a,status:((x=e==null?void 0:e.get(l))==null?void 0:x.name)??l,associationType:((S=e==null?void 0:e.get(c))==null?void 0:S.name)??c,isContentVisible:((C=e==null?void 0:e.get(h))==null?void 0:C.name)??h,percentAlong:((T=e==null?void 0:e.get(d))==null?void 0:T.name)??d,globalId:((M=e==null?void 0:e.get((t==null?void 0:t.globalIdField)??f))==null?void 0:M.name)??f}}function bmi(t,e){if(e.type!=="feature"&&e.type!=="subtype-group")return[];if(!e.url)return[];const i="utilityNetworks"in t.map?t.map.utilityNetworks??[]:[];for(const r of i)if(r.isUtilityLayer(e)){const s=e.fieldsIndex.get("assetgroup"),n=e.fieldsIndex.get("assettype");return[s==null?void 0:s.name,n==null?void 0:n.name].filter(o=>o!=null)}return[]}let zh=class extends he{constructor(e){super(e),this.rulesTableId=null,this.rulesTableUrl=null,this.subnetworksTableId=null,this.subnetworksTableUrl=null,this.dirtyAreasLayerId=null,this.dirtyAreasLayerUrl=null,this.associationsTable=null,this.associationsTableId=null,this.associationsTableUrl=null}destroy(){var e;(e=this.associationsTable)==null||e.destroy()}async loadAssociationsTable(){if(!this.associationsTable){const{associationsTableUrl:e}=this;if(!e)throw new U("utility-network-system-layers:missing-associations-table-url","Unable to load the associations table, as the `associationsTableUrl` is not set.");this.associationsTable=new xle({url:e})}return await this.associationsTable.load(),this.associationsTable}};u([p({constructOnly:!0})],zh.prototype,"rulesTableId",void 0),u([p({constructOnly:!0})],zh.prototype,"rulesTableUrl",void 0),u([p({constructOnly:!0})],zh.prototype,"subnetworksTableId",void 0),u([p({constructOnly:!0})],zh.prototype,"subnetworksTableUrl",void 0),u([p({constructOnly:!0})],zh.prototype,"dirtyAreasLayerId",void 0),u([p({constructOnly:!0})],zh.prototype,"dirtyAreasLayerUrl",void 0),u([p()],zh.prototype,"associationsTable",void 0),u([p({constructOnly:!0})],zh.prototype,"associationsTableId",void 0),u([p({constructOnly:!0})],zh.prototype,"associationsTableUrl",void 0),zh=u([A("esri.networks.support.NetworkSystemLayers")],zh);const j4t=zh;let j2=class extends ee{constructor(e){super(e),this.id=null,this.name=null}};u([p({type:Number,json:{read:{source:"terminalId"},write:{target:"terminalId"}}})],j2.prototype,"id",void 0),u([p({type:String,json:{read:{source:"terminalName"},write:{target:"terminalName"}}})],j2.prototype,"name",void 0),u([p({type:Boolean,json:{write:!0}})],j2.prototype,"isUpstreamTerminal",void 0),j2=u([A("esri.networks.support.Terminal")],j2);const G4t=j2,Kk=new ni({esriUNTMBidirectional:"bidirectional",esriUNTMDirectional:"directional"});let w_=class extends ee{constructor(e){super(e),this.defaultConfiguration=null,this.id=null,this.name=null,this.terminals=[],this.traversabilityModel=null}};u([p({type:String,json:{write:!0}})],w_.prototype,"defaultConfiguration",void 0),u([p({type:Number,json:{read:{source:"terminalConfigurationId"},write:{target:"terminalConfigurationId"}}})],w_.prototype,"id",void 0),u([p({type:String,json:{read:{source:"terminalConfigurationName"},write:{target:"terminalConfigurationName"}}})],w_.prototype,"name",void 0),u([p({type:[G4t],json:{write:!0}})],w_.prototype,"terminals",void 0),u([p({type:Kk.apiValues,json:{type:Kk.jsonValues,read:Kk.read,write:Kk.write}})],w_.prototype,"traversabilityModel",void 0),w_=u([A("esri.networks.support.TerminalConfiguration")],w_);const s1e=w_;let G2=class extends ee{constructor(e){super(e),this.line=null,this.multipoint=null,this.polygon=null}};u([p({type:_d,json:{write:!0},readOnly:!0})],G2.prototype,"line",void 0),u([p({type:WS,json:{read:{source:"point"},write:{target:"point"}},readOnly:!0})],G2.prototype,"multipoint",void 0),u([p({type:Ea,json:{write:!0},readOnly:!0})],G2.prototype,"polygon",void 0),G2=u([A("esri.rest.networks.support.AggregatedGeometry")],G2);const H4t=G2;let H2=class extends ee{constructor(e){super(e),this.functionType=null,this.networkAttributeName=null,this.result=null}};u([p({type:["add","subtract","average","count","min","max"],json:{write:!0},readOnly:!0})],H2.prototype,"functionType",void 0),u([p({type:String,json:{write:!0},readOnly:!0})],H2.prototype,"networkAttributeName",void 0),u([p({type:Number,json:{write:!0},readOnly:!0})],H2.prototype,"result",void 0),H2=u([A("esri.rest.networks.support.FunctionResult")],H2);const q4t=H2;let Ap=class extends ee{constructor(e){super(e),this.assetGroupCode=null,this.assetTypeCode=null,this.globalId=null,this.networkSourceId=null,this.objectId=null,this.positionFrom=null,this.positionTo=null,this.terminalId=null}};u([p({type:Number,json:{write:!0}})],Ap.prototype,"assetGroupCode",void 0),u([p({type:Number,json:{write:!0}})],Ap.prototype,"assetTypeCode",void 0),u([p({type:String,json:{write:!0}})],Ap.prototype,"globalId",void 0),u([p({type:Number,json:{write:!0}})],Ap.prototype,"networkSourceId",void 0),u([p({type:Number,json:{write:!0}})],Ap.prototype,"objectId",void 0),u([p({type:Number,json:{write:!0}})],Ap.prototype,"positionFrom",void 0),u([p({type:Number,json:{write:!0}})],Ap.prototype,"positionTo",void 0),u([p({type:Number,json:{write:!0}})],Ap.prototype,"terminalId",void 0),Ap=u([A("esri.rest.networks.support.NetworkElement")],Ap);const W4t=Ap;let $y=class extends ee{constructor(e){super(e),this.aggregatedGeometry=null,this.elements=null,this.globalFunctionResults=null,this.kFeaturesForKNNFound=!1,this.startingPointsIgnored=!1,this.warnings=null}};u([p({type:H4t,json:{write:!0},readOnly:!0})],$y.prototype,"aggregatedGeometry",void 0),u([p({type:[W4t],json:{write:!0},readOnly:!0})],$y.prototype,"elements",void 0),u([p({type:[q4t],json:{write:!0},readOnly:!0})],$y.prototype,"globalFunctionResults",void 0),u([p({type:Boolean,json:{write:!0},readOnly:!0})],$y.prototype,"kFeaturesForKNNFound",void 0),u([p({type:Boolean,json:{write:!0},readOnly:!0})],$y.prototype,"startingPointsIgnored",void 0),u([p({type:[String],json:{write:!0},readOnly:!0})],$y.prototype,"warnings",void 0),$y=u([A("esri.rest.networks.support.TraceResult")],$y);const Z4t=$y,Y4t=Oo()({Pending:"job-waiting",InProgress:"job-executing",Completed:"job-succeeded"});let lx=class extends Z4t{constructor(e){super(e),this.statusUrl=null,this.status=null,this.submissionTime=null,this.lastUpdatedTime=null,this._timer=void 0}destroy(){clearInterval(this._timer)}async checkJobStatus(e){const i={...e,query:{f:"json"}},{data:r}=await Ri(this.statusUrl,i),s=r.traceResults?{...r.traceResults,...r}:r;return this.read(s),this}async waitForJobCompletion(e={}){const{interval:i=1e3,statusCallback:r}=e;return new Promise((s,n)=>{this._clearTimer();const o=setInterval(()=>{this._timer||n(bi()),this.checkJobStatus().then(a=>{const{status:l}=a;switch(this.status=l,l){case"job-succeeded":this._clearTimer(),s(this);break;case"job-waiting":case"job-executing":r&&r(this)}},a=>{this._clearTimer(),n(a)})},i);this._timer=o})}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};u([p({type:String,json:{write:!0}})],lx.prototype,"statusUrl",void 0),u([Ve(Y4t)],lx.prototype,"status",void 0),u([p({type:Date,json:{type:Number,write:{writer:(t,e)=>{e.submissionTime=t?t.getTime():null}}}})],lx.prototype,"submissionTime",void 0),u([p({type:Date,json:{type:Number,write:{writer:(t,e)=>{e.lastUpdatedTime=t?t.getTime():null}}}})],lx.prototype,"lastUpdatedTime",void 0),lx=u([A("esri.networks.support.TraceJobInfo")],lx);const J4t=lx;let Ay=class extends F4t{constructor(e){super(e),this.sharedNamedTraceConfigurations=[],this.type="utility",this._terminalById=new Map}get serviceTerritoryFeatureLayerId(){var e;return((e=this.dataElement)==null?void 0:e.serviceTerritoryFeatureLayerId)??null}get networkSystemLayers(){var e,i,r,s,n,o,a,l;return new j4t({rulesTableId:(e=this.sourceJSON)==null?void 0:e.systemLayers.rulesTableId,rulesTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${(i=this.sourceJSON)==null?void 0:i.systemLayers.rulesTableId}`:null,subnetworksTableId:(r=this.sourceJSON)==null?void 0:r.systemLayers.subnetworksTableId,subnetworksTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${(s=this.sourceJSON)==null?void 0:s.systemLayers.subnetworksTableId}`:null,dirtyAreasLayerId:(n=this.sourceJSON)==null?void 0:n.systemLayers.dirtyAreasLayerId,dirtyAreasLayerUrl:this.sourceJSON?`${this.featureServiceUrl}/${(o=this.sourceJSON)==null?void 0:o.systemLayers.dirtyAreasLayerId}`:null,associationsTableId:(a=this.sourceJSON)==null?void 0:a.systemLayers.associationsTableId,associationsTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${(l=this.sourceJSON)==null?void 0:l.systemLayers.associationsTableId}`:null})}get terminalConfigurations(){var e;return((e=this.dataElement)==null?void 0:e.terminalConfigurations.map(i=>s1e.fromJSON(i)))||[]}get domainNetworkNames(){var e;return((e=this.dataElement)==null?void 0:e.domainNetworks.map(i=>i.domainNetworkName))||[]}get _utilityLayerList(){var i,r;const e=new Set;return(r=(i=this.dataElement)==null?void 0:i.domainNetworks)==null||r.map(s=>{var n,o;(n=s==null?void 0:s.edgeSources)==null||n.map(({layerId:a,sourceId:l})=>{this._layerIdBySourceId.set(l,a),this._sourceIdByLayerId.set(a,l),e.add(a)}),(o=s==null?void 0:s.junctionSources)==null||o.map(({layerId:a,sourceId:l})=>{this._layerIdBySourceId.set(l,a),this._sourceIdByLayerId.set(a,l),e.add(a)})}),e}async load(e){return this.addResolvingPromise(super.load(e)),this.addResolvingPromise(this._loadNamedTraceConfigurationsFromNetwork(e)),this}getTerminalConfiguration(e){var c,h,d,f;let i=null,r=null;const s=e.layer;let n=null;if((s==null?void 0:s.type)==="feature"){if(n=s.layerId,n===null)return null}else if((s==null?void 0:s.type)!=="subtype-sublayer"||(n=((c=s==null?void 0:s.parent)==null?void 0:c.layerId)??null,n===null))return null;const o=e.attributes;if(o==null)return null;for(const m of Object.keys(o))m.toUpperCase()==="ASSETGROUP"&&(i=e.getAttribute(m)),m.toUpperCase()==="ASSETTYPE"&&(r=e.getAttribute(m));if(!this.dataElement)return null;let a=null;const l=this.dataElement.domainNetworks;for(const m of l){const g=(h=m.junctionSources)==null?void 0:h.find(v=>v.layerId===n);if(g){const v=(d=g.assetGroups)==null?void 0:d.find(_=>_.assetGroupCode===i);if(v){const _=(f=v.assetTypes)==null?void 0:f.find(b=>b.assetTypeCode===r);if(_!=null&&_.isTerminalConfigurationSupported){a=_.terminalConfigurationId;break}}}}if(a!=null){const m=this.dataElement.terminalConfigurations,g=m==null?void 0:m.find(v=>v.terminalConfigurationId===a);return g?s1e.fromJSON(g):null}return null}getTierNames(e){var r;const i=(r=this.dataElement)==null?void 0:r.domainNetworks.find(s=>s.domainNetworkName===e);return(i==null?void 0:i.tiers.map(s=>s.name))||[]}async getRulesTable(){return this._sharedRulesTable||(this._sharedRulesTable=this._createRulesTable()),await this._sharedRulesTable}getTerminalById(e){if(!this.dataElement||e==null)return null;const i=this._terminalById.get(e);return i??(this.terminalConfigurations.forEach(r=>{r.terminals.forEach(s=>{this._terminalById.set(s.id,s)})}),this._terminalById.get(e))}isUtilityLayer(e){var i,r;return"layerId"in e?this._utilityLayerList.has(e==null?void 0:e.layerId)&&(((i=e.url)==null?void 0:i.startsWith(this.featureServiceUrl))??!1):!(e.type!=="subtype-sublayer"||!e.parent)&&this._utilityLayerList.has(e.parent.layerId)&&(((r=e.parent.url)==null?void 0:r.startsWith(this.featureServiceUrl))??!1)}async queryAssociations(e,i){const[{queryAssociations:r},{default:s}]=await Promise.all([G(()=>import("./queryAssociations-ItqmlWn8.js"),__vite__mapDeps([377,378])),G(()=>import("./QueryAssociationsParameters-C_p6QGKN.js"),[])]),n=s.from(e);return n.gdbVersion=this.gdbVersion,n.moment=this.historicMoment,(await r(this.networkServiceUrl,n,i)).associations}async synthesizeAssociationGeometries(e){const[{synthesizeAssociationGeometries:i},{default:r}]=await Promise.all([G(()=>import("./synthesizeAssociationGeometries-B7StnAHS.js"),__vite__mapDeps([379,378])),G(()=>import("./SynthesizeAssociationGeometriesParameters-D_DaWc3L.js"),[])]),s=r.from(e);return s.gdbVersion=this.gdbVersion,s.moment=this.historicMoment,i(this.networkServiceUrl,s)}async trace(e){const[{trace:i},{default:r}]=await Promise.all([G(()=>import("./trace-Bc9kBDSw.js"),[]),G(()=>import("./TraceParameters-CUeWIlcC.js"),[])]),s=r.from(e);return s.gdbVersion=this.gdbVersion,s.moment=this.historicMoment,i(this.networkServiceUrl,s)}async submitTraceJob(e){const[{submitTraceJob:i},{default:r}]=await Promise.all([G(()=>import("./trace-Bc9kBDSw.js"),[]),G(()=>import("./TraceParameters-CUeWIlcC.js"),[])]),s=r.from(e);s.gdbVersion=this.gdbVersion,s.moment=this.historicMoment;const n=await i(this.networkServiceUrl,s);return new J4t({statusUrl:n})}async canAddAssociation(e){const i=await this.getRulesTable();if(!i)return!1;await i.load();const r=(c,h)=>c?c.terminalId===1?!(h!=null&&h.terminalId)||(h==null?void 0:h.terminalId)===c.terminalId:c.terminalId===(h==null?void 0:h.terminalId):!(h!=null&&h.terminalId),s=c=>({fromRuleElement:{networkSource:c.fromNetworkSource,assetGroup:c.fromAssetGroup,assetType:c.fromAssetType,terminal:c.fromTerminal},viaRuleElement:c.viaNetworkSource?{networkSource:c.viaNetworkSource,assetGroup:c.viaAssetGroup,assetType:c.viaAssetType,terminal:c.viaTerminal}:void 0,toRuleElement:{networkSource:c.toNetworkSource,assetGroup:c.toAssetGroup,assetType:c.toAssetType,terminal:c.toTerminal}}),n=(c,h,d=!0)=>{var f,m,g;return((f=c.networkSource)==null?void 0:f.sourceId)===h.networkSourceId&&((m=c.assetGroup)==null?void 0:m.assetGroupCode)===h.assetGroupCode&&((g=c.assetType)==null?void 0:g.assetTypeCode)===h.assetTypeCode&&(!d||r(c.terminal,h))},o=(c,h)=>{const{fromRuleElement:d,toRuleElement:f}=s(c);return n(d,h.fromNetworkElement,!1)&&n(f,h.toNetworkElement,!1)},a=(c,h)=>{const{fromRuleElement:d,toRuleElement:f}=s(c);return n(d,h.fromNetworkElement)&&n(f,h.toNetworkElement)||n(d,h.toNetworkElement)&&n(f,h.fromNetworkElement)},l=(c,h)=>{const{fromRuleElement:d,toRuleElement:f,viaRuleElement:m}=s(c);return n(d,h.fromNetworkElement)&&n(m,h.toNetworkElement)||n(d,h.toNetworkElement)&&n(m,h.fromNetworkElement)||n(m,h.fromNetworkElement)&&n(f,h.toNetworkElement)||n(m,h.toNetworkElement)&&n(f,h.fromNetworkElement)};return e.associationType==="containment"?i.rulesCategorized.containment.some(c=>o(c,e)):e.associationType==="attachment"?i.rulesCategorized.attachment.some(c=>o(c,e)):i.rulesCategorized.connectivity.some(c=>c.ruleType===Bc.RTEdgeJunctionEdgeConnectivity?l(c,e):a(c,e))}generateAddAssociations(e){const{associationsTable:i}=this.networkSystemLayers,{fromNetworkSourceId:r,fromGlobalId:s,fromTerminalId:n,toNetworkSourceId:o,toGlobalId:a,toTerminalId:l,associationType:c,isContentVisible:h,percentAlong:d,globalId:f}=V4t(i);return{addFeatures:e.map(m=>{var g,v,_,b,w,x;return new Pl({attributes:{[r]:(g=m.fromNetworkElement)==null?void 0:g.networkSourceId,[s]:(v=m.fromNetworkElement)==null?void 0:v.globalId,[n]:(_=m.fromNetworkElement)==null?void 0:_.terminalId,[o]:(b=m.toNetworkElement)==null?void 0:b.networkSourceId,[a]:(w=m.toNetworkElement)==null?void 0:w.globalId,[l]:(x=m.toNetworkElement)==null?void 0:x.terminalId,[c]:k4t[m.associationType],[h]:m.isContentVisible==null?void 0:m.isContentVisible?1:0,[d]:m.percentAlong,[f]:m.globalId}})}),id:this.networkSystemLayers.associationsTableId,identifierFields:{globalIdField:(i==null?void 0:i.globalIdField)??"globalid",objectIdField:(i==null?void 0:i.objectIdField)??"objectid"}}}generateDeleteAssociations(e){const{associationsTable:i,associationsTableId:r}=this.networkSystemLayers;return{deleteFeatures:e.map(s=>({globalId:s.globalId})),id:r,identifierFields:{globalIdField:(i==null?void 0:i.globalIdField)??"globalid",objectIdField:(i==null?void 0:i.objectIdField)??"objectid"}}}async loadAssociationsTable(){return this.networkSystemLayers.loadAssociationsTable()}async _loadNamedTraceConfigurationsFromNetwork(e){var s;if(((s=this.sharedNamedTraceConfigurations)==null?void 0:s.length)===0)return;const i=this.sharedNamedTraceConfigurations.map(n=>n.globalId),r=await this.queryNamedTraceConfigurations({globalIds:i},e);for(const n of this.sharedNamedTraceConfigurations){const o=r==null?void 0:r.find(a=>a.globalId===n.globalId);if(o){const a=o.write({},{origin:"service"});n.read(a,{origin:"service"})}}}async _createRulesTable(){var o;const e=this.networkSystemLayers.rulesTableUrl,i=new xle({url:e});await i.load();const r=(o=this.dataElement)==null?void 0:o.domainNetworks;if(!r)return null;const s=r.flatMap(a=>[...a.edgeSources||[],...a.junctionSources||[]]),n=(await X4t(i)).map(a=>this._hydrateRuleInfo(i,s,a));return new z4t({rulesLayer:i,rules:n})}_hydrateRuleInfo(e,i,r){const s=e.fieldsIndex,n=s.get("RULETYPE"),o=s.get("CREATIONDATE"),a=s.get("FROMNETWORKSOURCEID"),l=s.get("FROMASSETGROUP"),c=s.get("FROMASSETTYPE"),h=s.get("FROMTERMINALID"),d=s.get("TONETWORKSOURCEID"),f=s.get("TOASSETGROUP"),m=s.get("TOASSETTYPE"),g=s.get("TOTERMINALID"),v=s.get("VIANETWORKSOURCEID"),_=s.get("VIAASSETGROUP"),b=s.get("VIAASSETTYPE"),w=s.get("VIATERMINALID"),x=r.attributes[n.name],S=new Date(r.attributes[o.name]),C=[{networkSourceId:r.attributes[a.name],assetGroupId:r.attributes[l.name],assetTypeId:r.attributes[c.name],terminalId:r.attributes[h.name]},{networkSourceId:r.attributes[d.name],assetGroupId:r.attributes[f.name],assetTypeId:r.attributes[m.name],terminalId:r.attributes[g.name]},{networkSourceId:r.attributes[v.name],assetGroupId:r.attributes[_.name],assetTypeId:r.attributes[b.name],terminalId:r.attributes[w.name]}];let T;(function(I){I[I.from=0]="from",I[I.to=1]="to",I[I.via=2]="via"})(T||(T={}));const M={ruleType:x,creationDate:S};for(const I of[T.from,T.to,T.via]){if(x!==Bc.RTEdgeJunctionEdgeConnectivity&&I===T.via)continue;const D=C[I],P=i.find(k=>k.sourceId===D.networkSourceId),F=P==null?void 0:P.assetGroups.find(k=>k.assetGroupCode===D.assetGroupId),L=F==null?void 0:F.assetTypes.find(k=>k.assetTypeCode===D.assetTypeId),N=this._getTerminal(L,D);let R="";switch(I){case T.from:R="from";break;case T.to:R="to";break;case T.via:R="via"}M[`${R}NetworkSource`]=P,M[`${R}AssetGroup`]=F,M[`${R}AssetType`]=L,M[`${R}Terminal`]=N==null?void 0:N.toJSON()}return M}_getTerminal(e,i){var n,o;const r=e==null?void 0:e.terminalConfigurationId,s=(n=this.terminalConfigurations)==null?void 0:n.find(a=>a.id===r);return((o=s==null?void 0:s.terminals)==null?void 0:o.find(a=>a.id===i.terminalId))??null}};async function X4t(t){const e=new ng({where:"1=1",outFields:["*"]});return(await Eze(t,e)).features}u([p({type:[B4t],json:{origins:{"web-map":{read:{source:"traceConfigurations"},write:{target:"traceConfigurations"}},service:{read:{source:"traceConfigurations"}}},read:!1}})],Ay.prototype,"sharedNamedTraceConfigurations",void 0),u([p({type:["utility"],readOnly:!0,json:{read:!1,write:!1}})],Ay.prototype,"type",void 0),u([p({readOnly:!0})],Ay.prototype,"serviceTerritoryFeatureLayerId",null),u([p({readOnly:!0})],Ay.prototype,"networkSystemLayers",null),u([p({readOnly:!0})],Ay.prototype,"terminalConfigurations",null),u([p({readOnly:!0})],Ay.prototype,"domainNetworkNames",null),Ay=u([A("esri.networks.UtilityNetwork")],Ay);const fUe=Ay,K4t=Object.freeze(Object.defineProperty({__proto__:null,default:fUe},Symbol.toStringTag,{value:"Module"}));let q2=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.expression=null,this.returnType="string",this.title=null}};u([p({type:String,json:{write:{isRequired:!0}}})],q2.prototype,"expression",void 0),u([p({type:["number","string"],json:{write:!0}})],q2.prototype,"returnType",void 0),u([p({type:String,json:{write:!0}})],q2.prototype,"title",void 0),q2=u([A("esri.webdoc.geotriggersInfo.ExpressionInfo")],q2);const mUe=q2,Qk=new ni({deviceLocation:"device-location"});let LR=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.filterExpression=null,this.type="device-location"}};u([p({type:mUe,json:{write:!0}})],LR.prototype,"filterExpression",void 0),u([p({type:Qk.apiValues,readOnly:!0,json:{type:Qk.jsonValues,read:Qk.read,write:Qk.write}})],LR.prototype,"type",void 0),LR=u([A("esri.webdoc.geotriggersInfo.DeviceLocationFeed")],LR);const Q4t=LR;let NR=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.geometry=null,this.where=null}};u([p({types:eM,json:{read:pf,write:!0}})],NR.prototype,"geometry",void 0),u([p({type:String,json:{write:!0}})],NR.prototype,"where",void 0),NR=u([A("esri.webdoc.geotriggersInfo.FeatureFilter")],NR);const e5t=NR;let W2=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.layerId=null,this.layerUrl=null,this.type="feature-layer"}};u([p({type:String,json:{write:{overridePolicy(){return{isRequired:this.layerUrl===null}}}}})],W2.prototype,"layerId",void 0),u([p({type:String,json:{write:{overridePolicy(){return{isRequired:this.layerId===null}}}}})],W2.prototype,"layerUrl",void 0),u([Ve({featureLayer:"feature-layer"},{readOnly:!0})],W2.prototype,"type",void 0),W2=u([A("esri.webdoc.geotriggersInfo.FeatureLayerSource")],W2);const t5t=W2;let cx=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.fenceSource=null,this.filter=null,this.bufferDistance=null,this.type="features"}};u([p({type:t5t,json:{write:{isRequired:!0}}})],cx.prototype,"fenceSource",void 0),u([p({type:e5t,json:{write:!0}})],cx.prototype,"filter",void 0),u([p({type:Number,json:{write:!0}})],cx.prototype,"bufferDistance",void 0),u([Ve({features:"features"},{readOnly:!0})],cx.prototype,"type",void 0),cx=u([A("esri.webdoc.geotriggersInfo.FeatureFenceParameters")],cx);const i5t=cx;let Uz=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.type="fence"}};u([Ve({fence:"fence"},{readOnly:!0})],Uz.prototype,"type",void 0),Uz=u([A("esri.webdoc.geotriggersInfo.Geotrigger")],Uz);const gUe=Uz;let FR=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.expressionInfo=null,this.requestedActions=null}};u([p({type:mUe,json:{write:!0}})],FR.prototype,"expressionInfo",void 0),u([p({type:[String],json:{write:!0}})],FR.prototype,"requestedActions",void 0),FR=u([A("esri.webdoc.geotriggersInfo.GeotriggerNotificationOptions")],FR);const r5t=FR,s5t=new ni({enterContainsAndExitDoesNotContain:"enter-contains-and-exit-does-not-contain",enterContainsAndExitDoesNotIntersect:"enter-contains-and-exit-does-not-intersect",enterIntersectsAndExitDoesNotIntersect:"enter-intersects-and-exit-does-not-intersect"}),n5t=new ni({useGeometry:"use-geometry",useGeometryWithAccuracy:"use-geometry-with-accuracy"}),e4=new ni({enter:"enter",enterOrExit:"enter-or-exit",exit:"exit"});let Mp=class extends gUe{constructor(e){super(e),this.enterExitRule="enter-contains-and-exit-does-not-intersect",this.feed=null,this.feedAccuracyMode="use-geometry",this.fenceNotificationRule=null,this.fenceParameters=null,this.name=null,this.notificationOptions=null,this.type="fence"}};u([Ve(s5t)],Mp.prototype,"enterExitRule",void 0),u([p({type:Q4t,json:{write:{isRequired:!0}}})],Mp.prototype,"feed",void 0),u([Ve(n5t)],Mp.prototype,"feedAccuracyMode",void 0),u([p({type:e4.apiValues,json:{type:e4.jsonValues,read:e4.read,write:{writer:e4.write,isRequired:!0}}})],Mp.prototype,"fenceNotificationRule",void 0),u([p({type:i5t,json:{write:{isRequired:!0}}})],Mp.prototype,"fenceParameters",void 0),u([p({type:String,json:{write:!0}})],Mp.prototype,"name",void 0),u([p({type:r5t,json:{write:!0}})],Mp.prototype,"notificationOptions",void 0),u([Ve({fence:"fence"},{readOnly:!0})],Mp.prototype,"type",void 0),Mp=u([A("esri.webdoc.geotriggersInfo.FenceGeotrigger")],Mp);const o5t=Mp,a5t={base:gUe,key:"type",typeMap:{fence:o5t}};let Bz=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.geotriggers=null}};u([p({types:[a5t],json:{write:{isRequired:!0}}})],Bz.prototype,"geotriggers",void 0),Bz=u([A("esri.webdoc.GeotriggersInfo")],Bz);const l5t=Bz;let Z2=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.portalItem=null}readPortalItem(e,i,r){const{itemId:s}=i;if(s)return new nh({id:s,portal:r==null?void 0:r.portal})}writePortalItem(e,i){e!=null&&e.id&&(i.itemId=e.id)}};u([p({type:nh,json:{write:{isRequired:!0}}})],Z2.prototype,"portalItem",void 0),u([ve("portalItem",["itemId"])],Z2.prototype,"readPortalItem",null),u([_e("portalItem",{itemId:{type:String}})],Z2.prototype,"writePortalItem",null),Z2=u([A("esri.webdoc.ips.PositioningService")],Z2);const c5t=Z2;let Vz=class extends Nt.ClonableMixin(ee){constructor(e){super(e),this.positioningService=null}};u([p({type:c5t,json:{write:{isRequired:!0}}})],Vz.prototype,"positioningService",void 0),Vz=u([A("esri.webdoc.IPSInfo")],Vz);const u5t=Vz,h5t={currentVersion:YIe,createInitialViewProperties:()=>new vV,parseVersion:WC.parse,itemType:"Web Map",name:"webmap",origin:"web-map"},d5t=Ce.ofType(fUe);let x_=class extends ODt{constructor(e){super(e),this.geotriggersInfo=null,this.ipsInfo=null,this.presentation=null,this.utilityNetworks=null}destroy(){if(this.utilityNetworks){const e=this.utilityNetworks.removeAll();for(const i of e)i.destroy();this.utilityNetworks.destroy()}}get context(){return h5t}loadAll(){return KD(this,e=>{var i,r;e(this.ground,this.basemap,this.layers,this.tables,(r=(i=this.ipsInfo)==null?void 0:i.positioningService)==null?void 0:r.portalItem)})}static fromJSON(e){if(e)return new this({resourceInfo:e});throw new U("webmap:empty-resource","Expected a JSON resource but got nothing")}};x_.VERSION=YIe,u([p({type:l5t,json:{write:!0}})],x_.prototype,"geotriggersInfo",void 0),u([p({type:u5t,json:{write:!0,name:"mapIPSInfo"}})],x_.prototype,"ipsInfo",void 0),u([p({json:{write:!0}})],x_.prototype,"presentation",void 0),u([p({type:d5t,json:{read:!0,write:!0}})],x_.prototype,"utilityNetworks",void 0),x_=u([A("esri.WebMap")],x_);const p5t=x_;function f5t(t){return t&&"getAtOrigin"in t&&"originOf"in t}function ote(t){t!=null&&t.writtenProperties&&t.writtenProperties.forEach(({target:e,propName:i,newOrigin:r})=>{f5t(e)&&r&&e.originOf(i)!==r&&e.updateOrigin(i,r)})}const m5t=Symbol("WebScene");async function g5t(t,e={},i){await t.load(i);const r=Od(t.itemUrl,"resources"),{start:s=1,num:n=10,sortOrder:o="asc",sortField:a="resource"}=e,l={query:{start:s,num:n,sortOrder:o,sortField:a,token:t.apiKey},signal:i==null?void 0:i.signal},c=await t.portal.request(r,l);return{total:c.total,nextStart:c.nextStart,resources:c.resources.map(({created:h,size:d,resource:f})=>({created:new Date(h),size:d,resource:t.resourceFromPath(f)}))}}async function y5t(t,e,i,r){const s=new Map;for(const{resource:o,content:a,compress:l,access:c}of e){if(!o.hasPath())throw new U(`portal-item-resource-${i}:invalid-path`,"Resource does not have a valid path");const[h,d]=yUe(o.path),f=`${h}/${l??""}/${c??""}`;s.has(f)||s.set(f,{prefix:h,compress:l,access:c,files:[]}),s.get(f).files.push({fileName:d,content:a})}await t.load(r);const n=Od(t.userItemUrl,i==="add"?"addResources":"updateResources");for(const{prefix:o,compress:a,access:l,files:c}of s.values())for(let d=0;d<c.length;d+=25){const f=c.slice(d,d+25),m=new FormData;o&&o!=="."&&m.append("resourcesPrefix",o),a&&m.append("compress","true"),l&&m.append("access",l);let g=0;for(const{fileName:v,content:_}of f)m.append("file"+ ++g,_,v);m.append("f","json"),await t.portal.request(n,{method:"post",body:m,signal:r==null?void 0:r.signal})}}async function v5t(t,e,i){if(!e.hasPath())throw new U("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await t.load(i);const r=Od(t.userItemUrl,"removeResources");await t.portal.request(r,{method:"post",query:{resource:e.path},signal:i==null?void 0:i.signal}),e.portalItem=null}async function _5t(t,e){await t.load(e);const i=Od(t.userItemUrl,"removeResources");return t.portal.request(i,{method:"post",query:{deleteAll:!0},signal:e==null?void 0:e.signal})}function yUe(t){const e=t.lastIndexOf("/");return e===-1?[".",t]:[t.slice(0,e),t.slice(e+1)]}function Tle(t){const[e,i]=b5t(t),[r,s]=yUe(e);return[r,s,i]}function b5t(t){const e=G6e(t);return e==null?[t,""]:[t.slice(0,t.length-e.length-1),`.${e}`]}async function jz(t){return t.type==="blob"?t.blob:t.type==="json"?new Blob([t.jsonString],{type:"application/json"}):(await Ri(t.url,{responseType:"blob"})).data}function w5t(t,e){if(!t.hasPath())return null;const[i,,r]=Tle(t.path);return t.portalItem.resourceFromPath(Od(i,e+r))}function vUe(t,e){if(!t.hasPath())return null;const[i,,r]=Tle(t.path);return t.portalItem.resourceFromPath(Od(i,e+r))}const OC=Object.freeze(Object.defineProperty({__proto__:null,addOrUpdateResources:y5t,contentToBlob:jz,fetchResources:g5t,getSiblingOfSameType:w5t,getSiblingOfSameTypeI:vUe,removeAllResources:_5t,removeResource:v5t,splitPrefixFileNameAndExtension:Tle},Symbol.toStringTag,{value:"Module"}));async function Ele(t,e,i){const r=await _Ue(t,e,i);await bUe(r,e,i)}async function x5t(t,e,i,r,s){const n=await _Ue(i,r,s);await t.update({data:e}),await bUe(n,r,s)}async function _Ue(t,e,i){if(!(e!=null&&e.resources))return;const r=e.portalItem===t.portalItem?new Set(t.paths):new Set;t.paths.length=0,t.portalItem=e.portalItem;const s=new Set(e.resources.toKeep.map(d=>d.resource.path)),n=new Set,o=[];s.forEach(d=>{r.delete(d),t.paths.push(d)});const a=[],l=[],c=[];for(const d of e.resources.toUpdate)if(r.delete(d.resource.path),s.has(d.resource.path)||n.has(d.resource.path)){const{resource:f,content:m,finish:g}=d,v=vUe(f,dL());t.paths.push(v.path),a.push({resource:v,content:await jz(m),compress:d.compress}),g&&c.push(()=>g(v))}else{t.paths.push(d.resource.path),l.push({resource:d.resource,content:await jz(d.content),compress:d.compress});const f=d.finish;f&&c.push(()=>f(d.resource)),n.add(d.resource.path)}for(const d of e.resources.toAdd)if(t.paths.push(d.resource.path),r.has(d.resource.path))r.delete(d.resource.path);else{a.push({resource:d.resource,content:await jz(d.content),compress:d.compress});const f=d.finish;f&&c.push(()=>f(d.resource))}if(a.length||l.length){const{addOrUpdateResources:d}=await G(()=>Promise.resolve().then(()=>OC),void 0);await d(e.portalItem,a,"add",i),await d(e.portalItem,l,"update",i)}if(c.forEach(d=>d()),o.length===0)return r;const h=await vGe(o);if(gt(i),h.length>0)throw new U("save:resources","Failed to save one or more resources",{errors:h});return r}async function bUe(t,e,i){if(!t||!e.portalItem)return;const r=[];for(const s of t){const n=e.portalItem.resourceFromPath(s);r.push(n.portalItem.removeResource(n,i))}await zj(r)}async function wUe(t){const e=[];for(const i of t.allLayers)if("beforeSave"in i&&typeof i.beforeSave=="function"){const r=i.beforeSave();r&&e.push(r)}await Promise.allSettled(e)}const S5t=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);function Cle(t,e,i){let r=(t.messages??[]).filter(({type:s})=>s==="error").map(({name:s,message:n,details:o})=>new U(s,n,o));if(t.blockedRelativeUrls&&(r=r.concat(t.blockedRelativeUrls.map(s=>new U("url:unsupported",`Relative url '${s}' is not supported`)))),i){const{ignoreUnsupported:s,supplementalUnsupportedErrors:n=[],requiredPropertyChecksDisabled:o}=i;s&&(r=r.filter(({name:a})=>!(S5t.has(a)||n.includes(a)))),o&&(r=r.filter(a=>a.name!=="web-document-write:property-required"))}if(r.length>0)throw new U(e.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:r})}const T5t=["NatGeo_World_Map","Ocean_Basemap","USA_Topo_Maps","World_Imagery","World_Street_Map","World_Terrain_Base","World_Topo_Map","World_Hillshade","Canvas/World_Light_Gray_Base","Canvas/World_Light_Gray_Reference","Canvas/World_Dark_Gray_Base","Canvas/World_Dark_Gray_Reference","Ocean/World_Ocean_Base","Ocean/World_Ocean_Reference","Reference/World_Boundaries_and_Places","Reference/World_Reference_Overlay","Reference/World_Transportation"].map(t=>t.toLowerCase());async function E5t(t,e,i){i??(i={}),$5t(t,e),await Id(()=>!e.updatingFromView),await e.load(),await TUe(e),await wUe(e),await SUe(t,e);const r=e.portalItem,{json:s,jsonContext:n}=await $le(e,r,t.origin);return Cle(n,{errorName:`${t.name}:save`},i),await EUe(e,r),await Y5t(t,e,r,s,n),await Promise.all([e.updateItemThumbnail(),Ele(e.resourceReferences,n)]),r}async function $le(t,e,i){const r=PQ(e,i,!0),s=t.write({},r);return await Promise.all(r.resources.pendingOperations),{json:s,jsonContext:r}}async function C5t(t,e,i,r){r??(r={});const s=A5t(t,i);await Id(()=>!e.updatingFromView),await e.load(),await TUe(e),await wUe(e),await SUe(t,e);const{json:n,jsonContext:o}=await $le(e,s,t.origin);Cle(o,{errorName:`${t.name}:save`},r),await R5t(e,s);const a=e.getThumbnailState();return await J5t(t,e,s,n,o,r)&&(e.resourceReferences.portalItem=s),e.restoreThumbnailFromState(a),await Promise.all([e.updateItemThumbnail(),Ele(e.resourceReferences,o)]),s}function $5t(t,e){if(!e.portalItem)throw new U(`${t.name}:portal-item-not-set`,"Portal item to save to has not been set on the WebMap");xUe(t,e.portalItem)}function xUe(t,e){if(e.type!==t.itemType)throw new U(`${t.name}:portal-item-wrong-type`,`Portal item needs to have type "${t.itemType}"`)}async function SUe(t,e){var r;if(t.name==="linkchart")return;if(!((r=e.basemap)!=null&&r.baseLayers.length))throw new U(`${t.name}:save`,"Map does not have a valid basemap with a base layer.");let i=null;if(await Id(()=>{const s=F$e(e.initialViewProperties,e.basemap);return i=s.spatialReference,!s.updating}),!as(i,e.initialViewProperties.spatialReference))throw new U(`${t.name}:save`,"The spatial reference of the basemap is not compatible with the one from the map.",{expected:e.initialViewProperties.spatialReference,actual:i})}function A5t(t,e){let i=nh.from(e);return i.id&&(i=i.clone(),i.id=null),i.type||(i.type=t.itemType),i.portal||(i.portal=vn.getDefault()),xUe(t,i),i}function TUe(t){const e=[];return t.basemap&&e.push(t.basemap.load()),t.ground&&e.push(t.ground.load()),Promise.allSettled(e).then(()=>{})}async function EUe(t,e){e.extent=await V5t(t.portalItem,t.initialViewProperties.viewpoint.targetGeometry),await P5t(t,e)}const M5t=zS.JSAPI,CUe="CollectorDisabled",n1e="Collector",o1e="Data Editing",$Ue="OfflineDisabled",a1e="Offline",AUe="Workforce Project",MUe="Workforce Worker",OUe="Workforce Dispatcher",O5t="Offline Map Areas",I5t="FieldMapsDisabled",l1e=zS.DEVELOPER_BASEMAP,c1e="UtilityNetwork",u1e="IPS";async function R5t(t,e){Kl(e,CUe),Kl(e,I5t),Kl(e,zS.METADATA),Kl(e,$Ue),Kl(e,O5t),Kl(e,OUe),Kl(e,AUe),Kl(e,MUe),await EUe(t,e)}async function P5t(t,e){gw(e,M5t),await D5t(t),N5t(t,e),F5t(t,e),k5t(t,e),z5t(t,e),U5t(t,e),B5t(t,e),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((i,r,s)=>s.indexOf(i)===r))}function D5t(t){const e=Ale(t).map(i=>i.load()).toArray();return Promise.allSettled(e).then(()=>{})}function Ale(t){return t.allLayers.concat(t.allTables)}function IUe(t){return Ale(t).some(e=>e.loaded&&o$e(e)&&e.capabilities.operations.supportsEditing&&e.editingEnabled&&(e.type!=="subtype-group"||e.sublayers.some(i=>i.editingEnabled)))}function L5t(t){return Ale(t).filter(e=>e.type!=="group").every(e=>e.loaded&&H5t(t,e))}function N5t(t,e){kx(e,CUe)||kx(e,AUe)||kx(e,MUe)||kx(e,OUe)||!IUe(t)?Kl(e,n1e):gw(e,n1e)}function F5t(t,e){IUe(t)?gw(e,o1e):Kl(e,o1e)}function k5t(t,e){!kx(e,$Ue)&&L5t(t)?gw(e,a1e):Kl(e,a1e)}function z5t(t,e){WZ(t.basemap)?gw(e,l1e):Kl(e,l1e)}function U5t(t,e){var i;(i=t.utilityNetworks)!=null&&i.length?gw(e,c1e):Kl(e,c1e)}function B5t(t,e){t.ipsInfo?gw(e,u1e):Kl(e,u1e)}async function V5t(t,e){const i=e.clone().normalize();let r;if(i.length>1)for(const s of i)r?s.width>r.width&&(r=s):r=s;else r=i[0];return j5t(t,r)}async function j5t(t,e){const i=e.spatialReference;if(i.isWGS84)return e.clone();if(i.isWebMercator)return Cx(e);const{getGeometryServiceURL:r}=await G(()=>import("./geometryServiceUtils-D_K144mp.js"),[]),s=await r(t),n=new Jae({geometries:[e],outSpatialReference:Oe.WGS84});return(await Y5e(s,n))[0]}function G5t(t){return QD(t)||t.type==="map-notes"||t.type==="route"}function H5t(t,e){return o$e(e)&&e.capabilities.operations.supportsSync||G5t(e)&&!e.portalItem||q5t(e)&&!W5t(e)&&e.spatialReference.equals(t.initialViewProperties.spatialReference)}function q5t(t){return(t.type==="tile"||t.type==="vector-tile")&&(t.capabilities.operations.supportsExportTiles||Z5t(t)||N$e(t))}function W5t(t){return t.type==="vector-tile"&&Object.keys(t.sourceNameToSource).length>1}function Z5t(t){return t.type==="tile"&&iHe(t.url)&&T5t.some(e=>{var i;return(i=t.url)==null?void 0:i.toLowerCase().includes("/"+e+"/")})}async function Y5t(t,e,i,r,s){await i.update({data:r}),RUe(t,e,i,r,s)}async function J5t(t,e,i,r,s,n){const o=e.portalItem,a={item:o,authenticated:!(!(o!=null&&o.id)||!o.portal.user)},l=i.portal;await l.signIn();const{copyAllowed:c,itemReloaded:h}=await Mle(a,l);if(a.authenticated||(a.authenticated=h),!c)throw new U(`${t.name}:save-as-copy-not-allowed`,"Owner of this map does not allow others to save a copy");const d=await Ole(i,a,r,n);return e.portalItem=i,RUe(t,e,i,r,s),d}async function Mle(t,e){var s;const{item:i,authenticated:r}=t;return i!=null&&i.id&&((s=i.typeKeywords)!=null&&s.includes("useOnly"))?i.portal.portalHostname!==e.portalHostname?{copyAllowed:!1,itemReloaded:!1}:(r||await i.reload(),{copyAllowed:i.itemControl==="admin"||i.itemControl==="update",itemReloaded:!0}):{copyAllowed:!0,itemReloaded:!1}}async function Ole(t,e,i,r){const s=t.portal,{item:n}=e,{folder:o,copyAllResources:a}=r;let l=!1;if(a&&(n!=null&&n.id)&&xTe(n.portal.url,s.url)&&parseInt(n.portal.currentVersion,10)>=2023){const{total:c}=await n.fetchResources();l=!!c}if(l){const c=await n.copy({copyResources:"all",folder:o});t.id=c.id,t.portal=c.portal;const h=t.toJSON();await t.load(),t.read(h),await t.update({data:i})}else await s.user.addItem({item:t,folder:o,data:i});return l}function RUe(t,e,i,r,s){dD.prototype.read.call(e,{version:r.version,authoringApp:r.authoringApp,authoringAppVersion:r.authoringAppVersion},{origin:t.origin,ignoreDefaults:!0,url:i.itemUrl?yn(i.itemUrl):void 0}),ote(s),e.resourceInfo=r}const X5t=Object.freeze(Object.defineProperty({__proto__:null,createJSON:$le,initializeNewItem:Ole,isCopyAllowed:Mle,save:E5t,saveAs:C5t},Symbol.toStringTag,{value:"Module"}));var ate;let Gz=ate=class extends ee{constructor(t){super(t),this.viewing=null}clone(){var t;return new ate({viewing:((t=this.viewing)==null?void 0:t.clone())??null})}};u([p({type:Q5e,json:{write:!0}})],Gz.prototype,"viewing",void 0),Gz=ate=u([A("esri.webscene.ApplicationProperties")],Gz);const K5t=Gz;var lte;let S_=lte=class extends ee{constructor(t){super(t),this.environment=new EA,this.spatialReference=null,this.viewpoint=null,this.timeExtent=null}set viewingMode(t){this._set("viewingMode",t)}clone(){var t,e,i;return new lte({environment:this.environment.clone(),spatialReference:((t=this.spatialReference)==null?void 0:t.clone())??null,viewingMode:this.viewingMode,viewpoint:((e=this.viewpoint)==null?void 0:e.clone())??null,timeExtent:((i=this.timeExtent)==null?void 0:i.clone())??null})}};u([p({type:EA,json:{write:{isRequired:!0}}})],S_.prototype,"environment",void 0),u([p({type:Oe})],S_.prototype,"spatialReference",void 0),u([p({type:["local","global"]})],S_.prototype,"viewingMode",null),u([p({type:Qr,json:{write:{isRequired:!0}}})],S_.prototype,"viewpoint",void 0),u([p(Xae)],S_.prototype,"timeExtent",void 0),S_=lte=u([A("esri.webscene.InitialViewProperties")],S_);const TV=S_;var cte;let Hz=cte=class extends ee{constructor(){super(...arguments),this.text=""}clone(){return new cte({text:this.text})}};u([p({type:String,json:{write:{isRequired:!0}}})],Hz.prototype,"text",void 0),Hz=cte=u([A("esri.webscene.support.Description")],Hz);const qz=Hz;var ute;let Wz=ute=class extends ee{constructor(t){super(t),this.visible=!1}clone(){return new ute({visible:this.visible})}cloneConstructProperties(){return{visible:this.visible}}};u([p({type:Boolean,json:{default:!1,write:!0}})],Wz.prototype,"visible",void 0),Wz=ute=u([A("esri.webscene.SlideLegendInfo")],Wz);const Q5t=Wz;var hte;let Zz=hte=class extends ee{constructor(){super(...arguments),this.legendInfo=null}clone(){return new hte({legendInfo:q(this.legendInfo)})}};u([p({type:Q5t,json:{write:!0}})],Zz.prototype,"legendInfo",void 0),Zz=hte=u([A("esri.webscene.support.SlideElements")],Zz);const ezt=Zz;var dte;let IC=dte=class extends ee{constructor(){super(...arguments),this.lighting=new NS,this.weather=new UB}clone(){return new dte({lighting:q(this.lighting),weather:q(this.weather)})}};u([p({types:eFe,json:{write:!0}})],IC.prototype,"lighting",void 0),u([p({types:coe,json:{write:!0}})],IC.prototype,"weather",void 0),IC=dte=u([A("esri.webscene.Environment")],IC);var Yz;let Jz=Yz=class extends ee{constructor(){super(...arguments),this.opacity=null}clone(){return new Yz({opacity:this.opacity})}cloneAndApplyTo(t){return this.opacity==null||((t=(t==null?void 0:t.clone())??new x3).opacity=this.opacity),t}static fromGround(t){return new Yz({opacity:t.opacity})}};u([p({type:Number,json:{type:Ii,read:{reader:X$,source:"transparency"},write:{writer:(t,e)=>{e.transparency=eL(t)},target:"transparency"}}})],Jz.prototype,"opacity",void 0),Jz=Yz=u([A("esri.webscene.support.SlideGround")],Jz);const PUe=Jz;var pte;let RC=pte=class extends ee{constructor(t){super(t),this.id="",this.sublayerIds=null}clone(){return new pte({id:this.id,sublayerIds:q(this.sublayerIds)})}};u([p({type:String,json:{write:!0}})],RC.prototype,"id",void 0),u([p({type:[Ii],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],RC.prototype,"sublayerIds",void 0),RC=pte=u([A("esri.webscene.support.SlideVisibleLayer")],RC);var fte;let Xz=fte=class extends ee{constructor(){super(...arguments),this.text=""}clone(){return new fte({text:this.text})}};u([p({type:String,json:{write:{isRequired:!0}}})],Xz.prototype,"text",void 0),Xz=fte=u([A("esri.webscene.support.Title")],Xz);const kP=Xz;let tzt=0;const mte=Ce.ofType(RC),izt=["caption","cover","none"];let Yn=class extends Nt.ClonableMixin(ee){constructor(t){super(t),this.id=Date.now().toString(16)+"-slide-"+tzt++,this.title=new kP,this.description=new qz,this.hidden=!1,this.thumbnail=new lc,this.viewpoint=null,this.basemap=null,this.ground=null,this.layout="caption",this.environment=new IC,this.timeExtent=null,this.elements=null,this.visibleLayers=new mte}destroy(){this.visibleLayers.removeAll(),this.basemap=null,this.thumbnail=$e(this.thumbnail),this.description=null,this.title=null,this.thumbnail=null,this.elements=null}castTitle(t){return typeof t=="string"?new kP({text:t}):Ds(kP,t)}castDescription(t){return typeof t=="string"?new qz({text:t}):Ds(qz,t)}castThumbnail(t){return typeof t=="string"?new lc({url:t}):Ds(lc,t)}castBasemap(t){return pG(t)}set visibleLayers(t){this._set("visibleLayers",vf(t,this._get("visibleLayers"),mte))}castVisibleLayers(t){return t&&typeof t.map=="function"?t.map(e=>{if(typeof e=="string")return{id:e};if(e instanceof fG){const i=h1e(e);return{id:e.id,sublayerIds:i}}return e.id?{id:e.id,sublayerIds:"sublayerIds"in e?e.sublayerIds:void 0}:(J.getLogger(this).warn('Invalid visible layer, expected { id }, Layer or "id"'),e)}):null}async _updateVisibleLayersFrom(t){const e=[];await Promise.allSettled(this._getLayers(t.map).map(i=>t.whenLayerView(i).then(r=>{if(r.visible){const s=h1e(i);e.push(new RC({id:r.layer.id,sublayerIds:s}))}})).toArray()),this.visibleLayers.removeAll(),this.visibleLayers.addMany(e)}updateFrom(t,e){const i={format:"png",quality:80,width:120,height:75,disableDecorations:!0,...e==null?void 0:e.screenshot};return t.when(()=>{var r,s;return this.viewpoint=t.viewpoint.clone(),this.environment.lighting=t.environment.lighting.type==="virtual"?DL.prototype.clone.apply(t.environment.lighting):NS.prototype.clone.apply(t.environment.lighting),this.environment.weather=t.environment.weather.clone(),this.basemap=((r=t.map.basemap)==null?void 0:r.clone())||null,this.ground=t.map.ground?PUe.fromGround(t.map.ground):null,this.timeExtent=((s=t.timeExtent)==null?void 0:s.clone())??null,this._updateVisibleLayersFrom(t)}).then(()=>t.takeScreenshot(i)).then(r=>(this.thumbnail=new lc({url:r.dataUrl}),this))}async applyTo(t,e){this._applyToController!=null&&this._applyToController.abort();let i=new AbortController;this._applyToController=i;const r=zD(e,()=>i==null?void 0:i.abort()),s=()=>{this._applyToController===i&&(this._applyToController=null),i=null,r==null||r.remove()};try{await Id(()=>t.ready,i.signal)}catch(h){throw s(),h}if(i.signal.aborted)throw s(),bi();const n=t.resourceController.scheduler.registerTask(lt.SLIDE);let o=!1;const a={animate:!0,...e,signal:this._applyToController.signal},l=async()=>{await Promise.all([n.schedule(async()=>o=await this._setViewpointOfInterest(t,a)),n.schedule(()=>this._applyBasemap(t,a),a.signal),n.schedule(()=>this._loadLayersWithSublayerVisibility(t))]),await Promise.all([n.schedule(()=>this._applyLayerVisibility(t),a.signal),n.schedule(()=>this._applyGround(t),a.signal),n.schedule(()=>this._applyViewpoint(t,a),a.signal),n.schedule(()=>{var h;return t.timeExtent=((h=this.timeExtent)==null?void 0:h.clone())??null},a.signal),n.schedule(()=>t.environment.weather=this.environment.weather.clone())])},c=await ff(t.addUpdatingPromise(l()));if(o&&(t.contentCamera=null),n.remove(),s(),c.ok===!1)throw c.error;return this}async _applyBasemap(t,e){if(this.basemap){try{await this.basemap.load(e)}catch(i){if(es(i))throw i}t.map.basemap=zJe(this.basemap,t.map.basemap)}}_applyGround(t){this.ground&&(t.map.ground=this.ground.cloneAndApplyTo(t.map.ground))}_getLayers(t){const e=new Ce;return this._collectLayers(t,e),this._collectLayers(t.ground,e),e}_collectLayers(t,e){t.layers.forEach(i=>{i.persistenceEnabled&&(e.add(i),"layers"in i&&this._collectLayers(i,e))})}async _loadLayersWithSublayerVisibility(t){this.visibleLayers&&await Promise.allSettled(this._getLayers(t.map).items.map(e=>{var r;return((r=this.visibleLayers.find(s=>s.id===e.id))==null?void 0:r.sublayerIds)?e.load():null}))}_applyLayerVisibility(t){this.visibleLayers&&this._getLayers(t.map).forEach(e=>{const i=this.visibleLayers.find(n=>n.id===e.id);e.visible=i!=null;const r=i==null?void 0:i.sublayerIds,s=DUe(e);r&&s&&s.forEach(n=>n.visible=r.includes(n.id))})}async _setViewpointOfInterest(t,e){if(t.state.fixedContentCamera||!this.viewpoint||e!=null&&e.ignoreViewpoint||!(e!=null&&e.useDestinationCamera))return!1;const{toCameraAsync:i}=await G(()=>Promise.resolve().then(()=>v1t),void 0),r=await i(t,this.viewpoint);return t.contentCamera=r,r!=null}async _applyViewpoint(t,e){if(this._applyCachedCameraTrackingEnabled(t),this.viewpoint&&!e.ignoreViewpoint){const i=this.environment.lighting;if(e.animate&&i.type==="sun"&&i.date)return this._animateToLighting(t,e);e.animate&&(t.environment.applyLighting(i.clone()),await t.goTo(this.viewpoint,e)),t.viewpoint=this.viewpoint}t.environment.applyLighting(this.environment.lighting.clone())}async _animateToLighting(t,e){let i=null;return t.environment.lighting.type!=="virtual"&&this.environment.lighting.type!=="virtual"&&(t.viewingMode==="global"&&(i=this._animateLightingWithCamera(t,t.environment.lighting,this.environment.lighting)),t.environment.cachedCameraTrackingEnabled=t.environment.lighting.cameraTrackingEnabled,t.environment.lighting.cameraTrackingEnabled=!1),t.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled,this.environment.lighting.type==="virtual"||t.environment.lighting.type==="virtual"?(t.environment.applyLighting(this.environment.lighting.clone()),t.environment.lighting.type!=="virtual"&&(t.environment.cachedCameraTrackingEnabled=t.environment.lighting.cameraTrackingEnabled,t.environment.lighting.cameraTrackingEnabled=!1)):this.environment.lighting.displayUTCOffset!=null&&(t.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset),t.goTo(this.viewpoint,e).then(()=>{this._applyCachedCameraTrackingEnabled(t),t.environment.applyLighting(this.environment.lighting.clone())}).catch(r=>{throw t.animation==null&&this._applyCachedCameraTrackingEnabled(t),r}).finally(()=>{Ji(i)})}_applyCachedCameraTrackingEnabled(t){t.environment.cachedCameraTrackingEnabled!=null&&(t.environment.lighting.cameraTrackingEnabled=t.environment.cachedCameraTrackingEnabled,t.environment.cachedCameraTrackingEnabled=null)}_getTime(t){return[t.getTime(),3600*t.getUTCHours()+60*t.getUTCMinutes()+t.getUTCSeconds()]}_setTime(t,e,i){return t.setTime(e),t.setUTCHours(i/3600),t.setUTCMinutes(i%3600/60),t.setUTCSeconds(i%3600%60),t}_animateLightingWithCamera(t,e,i){const r=new Date(e.date.toString()),[s,n]=this._getTime(r),[o,a]=this._getTime(i.date),l=nzt(n,a),c=t.renderCoordsHelper,h=$();c.toRenderCoords(t.camera.position,h);const d=$(),f=$();this.viewpoint.camera!=null&&c.toRenderCoords(this.viewpoint.camera.position,d);const m=new Date;return bn(()=>t.camera,g=>{c.toRenderCoords(g.position,f);const v=no(h,f),_=no(d,f);let b=0;v+_!==0&&(b=v/(v+_));const w=s+(o-s)*b,x=ozt(n,l*b);e.date=this._setTime(m,w,x)})}static createFrom(t,e){return new this().updateFrom(t,e)}};u([p({type:String,json:{write:{isRequired:!0}}})],Yn.prototype,"id",void 0),u([p({type:kP,json:{default:()=>new kP({text:""}),write:{isRequired:!0}}})],Yn.prototype,"title",void 0),u([ti("title")],Yn.prototype,"castTitle",null),u([p({type:qz,json:{write:{overridePolicy:t=>({enabled:!(!t||!t.text)})}}})],Yn.prototype,"description",void 0),u([ti("description")],Yn.prototype,"castDescription",null),u([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!1}})],Yn.prototype,"hidden",void 0),u([p({type:lc,json:{default:()=>new lc({url:""}),write:{isRequired:!0}}})],Yn.prototype,"thumbnail",void 0),u([ti("thumbnail")],Yn.prototype,"castThumbnail",null),u([p({type:Qr,nonNullable:!0,json:{write:{isRequired:!0}}})],Yn.prototype,"viewpoint",void 0),u([p({type:sv,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],Yn.prototype,"basemap",void 0),u([ti("basemap")],Yn.prototype,"castBasemap",null),u([p({type:PUe,json:{write:!0}})],Yn.prototype,"ground",void 0),u([p({type:izt,json:{write:!0,default:"caption"},nonNullable:!0})],Yn.prototype,"layout",void 0),u([p({type:mte,json:{write:{isRequired:!0}}})],Yn.prototype,"visibleLayers",null),u([ti("visibleLayers")],Yn.prototype,"castVisibleLayers",null),u([p({type:IC,json:{write:!0}})],Yn.prototype,"environment",void 0),u([p(Xae)],Yn.prototype,"timeExtent",void 0),u([p({type:ezt,json:{write:!0}})],Yn.prototype,"elements",void 0),Yn=u([A("esri.webscene.Slide")],Yn);const rzt=Yn;function DUe(t){if(t.type==="building-scene"||t.type==="map-image")return t.allSublayers.toArray()}function h1e(t){const e=DUe(t);if(e)return e.filter(i=>i.visible).map(i=>i.id)}const gte=86400,szt=43200;function nzt(t,e){let i=e-t;return i>szt&&(i-=gte),i<-43200&&(i+=gte),i}function ozt(t,e){return t6e(t+e,gte)}const yte=Ce.ofType(rzt);let Kz=class extends ee{constructor(e){super(e),this.slides=new yte}destroy(){this.slides.forEach(e=>e.destroy()),this.slides.removeAll()}set slides(e){e&&(e=e.filter(i=>!!i.viewpoint)),this._set("slides",vf(e,this._get("slides"),yte))}clone(){return new this.constructor({slides:this.slides.clone()})}};u([p({type:yte,nonNullable:!0,json:{write:!0}}),ti(gre)],Kz.prototype,"slides",null),Kz=u([A("esri.webscene.Presentation")],Kz);const LUe=Kz;var vte;let Y2=vte=class extends ee{constructor(t){super(t)}clone(){return new vte({name:this.name,path:this.path,title:this.title})}};u([p({type:String,json:{write:{isRequired:!0}}})],Y2.prototype,"name",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],Y2.prototype,"path",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],Y2.prototype,"title",void 0),Y2=vte=u([A("esri.webscene.TransportationNetwork")],Y2);const azt=Y2;let EV=class extends gL{constructor(e,i){super(e,i,"webscene")}get supportsGround(){return this.greaterEqual(1,8)}get supportsVisibleElevationLayersInSlides(){return this.lessThan(1,8)}};var NUe;const lS=new EV(1,36),lzt=()=>{const e=[],i=lS.major;for(let r=8;r<=lS.minor;r++)e.push(`${i}.${r}`);return e},H7="Web Scene";let _r=class extends Il.LoadableMixin(iw.EsriPromiseMixin(jL(Ere))){constructor(t){super(t),this[NUe]=!0,this._layersIdGCTimeoutId=void 0,this._updateFromPromise=null,this.applicationProperties=null,this.clippingArea=null,this.clippingEnabled=!1,this.floorInfo=null,this.heightModelInfo=void 0,this.sourceVersion=null,this.transportationNetworks=null,this.presentation=new LUe,this.initialViewProperties=new TV,this.portalItem=null,this.resourceInfo=null,this.widgets=null,this._debouncedSaveOperations=UD(async(e,i,r)=>{switch(e){case xl.SAVE:return this._saveImpl(i);case xl.SAVE_AS:return this._saveAsImpl(r,i)}}),this._resourceReferences={portalItem:null,paths:[]},this.authoringApp=null,this.authoringAppVersion=null,this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1}initialize(){if(this.when().catch(t=>{J.getLogger(this).error("#load()","Failed to load web scene",t)}),this.resourceInfo){let t;try{t=this._validateJSON(this.resourceInfo)}catch(e){return void this.addResolvingPromise(Promise.reject(e))}this.read(t),this.addResolvingPromise(this._validateSpatialReference()),this.addResolvingPromise(this._validateHeightModelInfo())}this.addHandles(so(()=>this.allLayers,"change",()=>this._scheduleLayersIdGC()))}destroy(){this._unscheduleLayersIdGC(),this.presentation&&this.presentation.destroy(),this.portalItem=$e(this.portalItem)}writeClippingArea(t,e){e.clippingArea||(e.clippingArea={}),e.clippingArea.geometry=t.toJSON()}readClippingEnabled(t,e){return!!e.clippingArea&&!!e.clippingArea.clip}writeClippingEnabled(t,e){this.clippingArea&&(e.clippingArea||(e.clippingArea={}),e.clippingArea.clip=t)}writeLayers(t,e,i,r){e[i]=this._layersToJSON(t,"operational-layers",r)}readSourceVersion(t,e){const[i,r]=e.version.split(".");return new EV(parseInt(i,10),parseInt(r,10))}writeSourceVersion(t,e,i){e[i]=`${lS.major}.${lS.minor}`}writeTables(t,e,i,r){const s=this._layersToJSON(t,"tables",r);s.length&&(e[i]=s)}get thumbnailUrl(){var t;return((t=this.portalItem)==null?void 0:t.thumbnailUrl)??null}set thumbnailUrl(t){t?this._override("thumbnailUrl",t):(this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}set authoringApp(t){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",t)}writeAuthoringApp(t,e){t&&this._isAuthoringAppSetByUser?e.authoringApp=t:e.authoringApp="ArcGIS API for JavaScript"}set authoringAppVersion(t){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",t)}writeAuthoringAppVersion(t,e){t&&this._isAuthoringAppVersionSetByUser?e.authoringAppVersion=t:e.authoringAppVersion=wie}writeGround(t,e,i,r){e[i]=t?t.write({},r):{transparency:0,layers:[]}}readInitialViewProperties(t,e){var s,n,o;const i={};(s=e.initialState)!=null&&s.environment&&(i.environment=EA.fromJSON(e.initialState.environment)),i.spatialReference=e.spatialReference?Oe.fromJSON(e.spatialReference):Oe.WebMercator,i.viewingMode=e.viewingMode??"global",(n=e.initialState)!=null&&n.viewpoint&&(i.viewpoint=Qr.fromJSON(e.initialState.viewpoint));const r=(o=e.initialState)==null?void 0:o.timeExtent;return r!=null&&(i.timeExtent=Eo.fromArray(r)),new TV(i)}get spatialReference(){var t;return((t=this.initialViewProperties)==null?void 0:t.spatialReference)??Oe.WebMercator}get viewingMode(){var t;return((t=this.initialViewProperties)==null?void 0:t.viewingMode)??"global"}load(t){const e=this.ground;return this.addResolvingPromise(this._loadFromSource().then(()=>{e&&e!==this.ground&&e.destroy(),this._validateFeatureLayerSymbolVisibility()})),Promise.resolve(this)}loadAll(){return KD(this,t=>{const e=this.presentation&&this.presentation.slides;t(this.ground,this.basemap,this.layers,e&&e.map(i=>i.basemap),this.tables)})}read(t,e){var s;e={...e,origin:"web-scene"};const i=this._isAuthoringAppVersionSetByUser,r=this._isAuthoringAppSetByUser;if(uie(this,t,n=>super.read(t,n),e),r||(this._isAuthoringAppSetByUser=!1),i||(this._isAuthoringAppVersionSetByUser=!1),t.baseMap&&Array.isArray(t.baseMap.elevationLayers)&&((s=this.sourceVersion)==null?void 0:s.supportsVisibleElevationLayersInSlides)){const n=t.baseMap.elevationLayers.map(c=>({id:c.id})),o=this.presentation.slides,a=(c,h)=>c.visibleLayers.some(d=>d.id===h),l=n.filter(c=>!o.some(h=>a(h,c.id)));o.forEach(c=>{c.visibleLayers.addMany(l)})}}_writeBasemapElevationLayers(t){var i;const e=(i=t.ground)==null?void 0:i.layers;!t.baseMap&&(e!=null&&e.length)&&(t.baseMap={title:"Basemap",baseMapLayers:[]}),t.baseMap&&(t.baseMap.elevationLayers=q(e))}_layersToJSON(t,e,i){const r={...i,layerContainerType:e};return t.map(s=>this._verifyWritableLayer(s,i)?s.write({},r):null).filter(s=>!!s).toArray()}_verifyWritableLayer(t,e){return!!t.persistenceEnabled&&("write"in t||(e!=null&&e.messages&&e.messages.push(new U("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted in web scenes`,{layer:t})),!1))}write(t,e){var s;if(this.loadStatus!=="loaded"){const n=new U("webscene:not-loaded","Web scene must be loaded before it can be serialized");throw J.getLogger(this).error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus),n}this._runLayersIdGC();const i=!(e!=null&&e.messages);e={messages:[],...e,origin:"web-scene"};const r=super.write(t,e);if(i){const n=((s=e.messages)==null?void 0:s.filter(o=>o.name==="web-document-write:property-required"))??[];if(n.length){const o=new U("web-document:property-required","One or more properties that are required in the webscene JSON are missing, see details for the specific errors",{errors:n});throw J.getLogger(this).error("#toJSON()","One or more properties that are required in the webscene JSON are missing",n),o}}return this._writeBasemapElevationLayers(r),r}async save(t){return this._debouncedSaveOperations(xl.SAVE,t)}async _saveImpl(t){var s;if(!this.portalItem)throw new U("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene");if(((s=this.portalItem)==null?void 0:s.type)!==H7)throw new U("webscene:portal-item-wrong-type",`Portal item needs to have type "${H7}"`);const e=this._updateFromPromise;await this._ensureLoadBeforeSave();const i=this._enableVerifyItemRelativeUrls(PQ(this.portalItem,"web-scene",!0)),r=this.write({},i);return await Promise.all(i.resources.pendingOperations),await this._verifySave(r,i,xl.SAVE,t),this._updateTypeKeywords(this.portalItem),await x5t(this.portalItem,r,this._resourceReferences,i),ote(i),e&&await e,await this._saveThumbnail(),this.portalItem}async saveAs(t,e){return this._debouncedSaveOperations(xl.SAVE_AS,e,t)}async _saveAsImpl(t,e){let i=nh.from(t);if(!i)throw new U("webscene:portal-item-required","saveAs requires a portal item to save to");i.id&&(i=i.clone(),i.id=null);const r=i.portal||vn.getDefault();await this._ensureLoadBeforeSave(),i.type=H7,i.portal=r;const s=this._enableVerifyItemRelativeUrls(PQ(i,"web-scene",!0)),n=this.write({},s);await Promise.all(s.resources.pendingOperations),await this._verifySaveAs(n,s,e);const o=this.thumbnailUrl,a=!this._isOverridden("thumbnailUrl");this._updateTypeKeywords(i),await r.signIn();const l=this.portalItem,c={item:l,authenticated:!(!(l!=null&&l.id)||!l.portal.user)},{copyAllowed:h,itemReloaded:d}=await Mle(c,r);if(c.authenticated||(c.authenticated=d),!h)throw new U(`${s.name}:save-as-copy-not-allowed`,"Owner of this map does not allow others to save a copy");const f={...e,copyAllResources:!0};return await Ole(i,c,n,f)&&(this._resourceReferences.portalItem=i),await Ele(this._resourceReferences,s),this.portalItem=i,dD.prototype.read.call(this,{version:n.version,authoringApp:n.authoringApp,authoringAppVersion:n.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:i.itemUrl?yn(i.itemUrl):void 0}),ote(s),o&&(this.thumbnailUrl=a?bie(o,"w","8192"):o),s.portalItem=i,await this._saveThumbnail(),i}async _saveThumbnail(){var t;this._isOverridden("thumbnailUrl")&&(await((t=this.portalItem)==null?void 0:t.updateThumbnail({thumbnail:this.thumbnailUrl})),this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}async _verifySave(t,e,i,r){if(!Gj(this.spatialReference))throw new U("webscene:unsupported-spatial-reference","Webscenes using spatial reference systems from Mars or Moon can not be saved currently.");const{ignoreUnsupported:s,requiredPropertyChecksDisabled:n,strictSchemaValidationEnabled:o}=r||{};Cle(e,{errorName:"webscene:save"},{ignoreUnsupported:s,supplementalUnsupportedErrors:["scenemodification:unsupported"],requiredPropertyChecksDisabled:n})}_verifySaveAs(t,e,i){return this._verifySave(t,e,xl.SAVE_AS,i)}verifySaveAs(t){const e=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),i=this.write({},e);return this._verifySaveAs(i,e,t)}canNotSaveAs(){return!1}async updateFrom(t,e={}){const i=this._updateFrom(t,e);this._updateFromPromise=i,await i,this._updateFromPromise===i&&(this._updateFromPromise=null)}async _updateFrom(t,e={}){var i;if(await t.whenReady(),!e.environmentExcluded&&t.environment&&(this.initialViewProperties.environment=EA.prototype.clone.apply(t.environment)),!e.viewpointExcluded&&t.viewpoint&&(this.initialViewProperties.viewpoint=t.viewpoint.clone()),this.initialViewProperties.spatialReference=t.spatialReference.clone(),this.initialViewProperties.viewingMode=t.viewingMode,this.initialViewProperties.timeExtent=((i=t.timeExtent)==null?void 0:i.clone())??null,t.clippingArea!=null?t.clippingArea!==this.clippingArea&&(this.clippingArea=t.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,t.heightModelInfo&&(this.heightModelInfo=t.heightModelInfo.clone()),t.map===this)for(const r of t.allLayerViews){const s="visible";s in r&&s in r.layer&&r._isOverridden(s)&&(r.layer[s]=r[s])}if(!e.widgetsExcluded)for(const r of t.persistableViewModels)r.updateWebDocument(this);(e.thumbnailExcluded===!1||e.thumbnailExcluded==null&&!e.viewpointExcluded)&&await this._updateFromThumbnail(t,e.thumbnailSize??void 0)}async _updateFromThumbnail(t,e){const i=W5e(t,e),r=await t.takeScreenshot({format:"jpg",width:i.width,height:i.height,disableDecorations:!0});this.thumbnailUrl=r.dataUrl}_loadFromSource(){var t;return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):(t=this.portalItem)!=null&&t.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()}_readAndLoadFromJSON(t,e){const i=this._validateJSON(t);return this.read(i,e),this._loadFromJSON(i,e)}_extractOperationalLayers(t){var s;const e=[];if(!((s=this.sourceVersion)!=null&&s.supportsGround)&&t.baseMap&&Array.isArray(t.baseMap.elevationLayers))for(const n of t.baseMap.elevationLayers)e.push(n);const i=[],r=n=>{var o;return n.layers&&(n.layers=n.layers.filter(r)),n.layerType!=="ArcGISTiledElevationServiceLayer"||((o=this.sourceVersion)!=null&&o.supportsGround||i.push(n),!1)};return{operationalLayers:t.operationalLayers?t.operationalLayers.filter(r):[],operationalElevationLayers:i,basemapElevationLayers:e}}async _loadFromJSON(t,e){var c;const i=new Ce;await this._validateSpatialReference(),await this._validateHeightModelInfo();const{populateOperationalLayers:r}=await G(()=>import("./layersCreator-B9RBAQ3N.js"),__vite__mapDeps([118,119,120,121,122,123])),{operationalLayers:s,operationalElevationLayers:n,basemapElevationLayers:o}=this._extractOperationalLayers(t),a=[],l={context:{...e,layerContainerType:"operational-layers"}};if(this.portalItem&&(l.context.portal=this.portalItem.portal||vn.getDefault()),o.length>0){const h={...l,context:{...l.context,layerContainerType:"ground"}};h.defaultLayerType="ArcGISTiledElevationServiceLayer",a.push(r(this.ground.layers,o,h))}if(n.length>0){const h={...l,context:{...l.context,layerContainerType:"ground"}};h.defaultLayerType="ArcGISTiledElevationServiceLayer",a.push(r(i,n,h))}s&&s.length>0&&a.push(r(this.layers,s,l)),(c=t.tables)!=null&&c.length&&a.push(r(this.tables,t.tables,{...l,context:{...l.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"})),await Promise.allSettled(a),await this._loadObjectsWithLayers(),this.ground.layers.addMany(i.filter(h=>h.type==="base-elevation"||h.type==="elevation"))}async _ensureLoadBeforeSave(){await this.load(),await this._loadObjectsWithLayers();const t=[],e=[...this.allLayers.items];for(const{basemap:i}of this.presentation.slides.items)i&&(e.push(...i.baseLayers.items),e.push(...i.referenceLayers.items));for(const i of e)if("beforeSave"in i&&typeof i.beforeSave=="function"){const r=i.beforeSave();r&&t.push(r)}await Promise.allSettled(t)}async _loadObjectsWithLayers(){const t=[];this.ground&&t.push(this.ground.load()),this.basemap&&t.push(this.basemap.load()),this.presentation.slides.forEach(e=>{e.basemap&&t.push(e.basemap.load())}),await Promise.allSettled(t)}async _loadFromItem(t){if(await t.load().catch(r=>{throw new U("webscene:load-portal-item","Failed to load portal item",{error:r})}),t.type!=="Web Scene")throw new U("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:t.type});const e=await t.fetchData();this.resourceInfo=e;const i={origin:"web-scene",url:yn(t.itemUrl),portal:t.portal||vn.getDefault(),portalItem:t,readResourcePaths:[]};await this._readAndLoadFromJSON(e,i),this._resourceReferences={portalItem:t,paths:i.readResourcePaths??[]}}_validateSpatialReference(){const t=this.initialViewProperties,e=this._sceneSpatialReference;let i;if(t.viewingMode!=="local"){if(!SA(e,je.Global))return Promise.reject(new U("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:e,viewingMode:t.viewingMode}));i=a=>!a||lu(a,e)}else{if(!SA(e,je.Local))return Promise.reject(new U("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:e,viewingMode:t.viewingMode}));i=a=>!a||a.equals(e)}const r=a=>{var l,c;return((l=a==null?void 0:a.camera)==null?void 0:l.position.spatialReference)??((c=a==null?void 0:a.targetGeometry)==null?void 0:c.spatialReference)},s=t.viewpoint,n=r(s);if(n&&!i(n))return Promise.reject(new U("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:n,sceneSpatialReference:e,viewingMode:t.viewingMode}));const o=this.presentation.slides.find(a=>!i(r(a.viewpoint)));if(o){const a=r(o.viewpoint);return Promise.reject(new U("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:a,sceneSpatialReference:e,viewingMode:t.viewingMode}))}return Promise.resolve()}_validateHeightModelInfo(){const t=this._sceneSpatialReference,e=pet(this.heightModelInfo,t);return e?Promise.reject(e):Promise.resolve()}_validateFeatureLayerSymbolVisibility(){var t;(t=this.sourceVersion)!=null&&t.greaterEqual(1,35)||this.layers.forEach(e=>{e.type==="feature"&&e.addHandles(H(()=>e.loaded,()=>{var i,r,s;((i=e.elevationInfo)==null?void 0:i.mode)==="on-the-ground"&&((r=e.renderer)==null?void 0:r.type)==="simple"&&((s=e.renderer.symbol)==null?void 0:s.type)==="polygon-3d"&&e.renderer.symbol.symbolLayers.some(n=>n.type==="fill"&&n.material!=null&&(!n.material.color||n.material.color.a*e.opacity<Kr)&&(e.loadWarnings.push(new ch("feature-layer:invisible-draped-symbols","FeatureLayer has fully transparent symbols which will no longer render or highlight",{layer:e})),!0))},{once:!0,sync:!0}))})}_validateJSON(t){const e=EV.parse(t.version||"","webscene");return lS.validate(e),t.version=`${e.major}.${e.minor}`,e.major===1&&e.minor<=2&&(t.spatialReference=Oe.WebMercator.toJSON()),t}_updateTypeKeywords(t){Rbe(t,zS.LOCAL_SCENE,this.initialViewProperties.viewingMode==="local"),Rbe(t,zS.DEVELOPER_BASEMAP,WZ(this.basemap)||this.presentation.slides.some(({basemap:e})=>!!e&&WZ(e))),t.typeKeywords&&(t.typeKeywords=t.typeKeywords.filter((e,i,r)=>r.indexOf(e)===i))}get _sceneSpatialReference(){return this.initialViewProperties.spatialReference||Oe.WebMercator}get _verifyItemRelativeRootPath(){var t;return(t=this.portalItem)!=null&&t.itemUrl?yn(this.portalItem.itemUrl).path:null}_enableVerifyItemRelativeUrls(t){const e=this._verifyItemRelativeRootPath;return e&&(t.verifyItemRelativeUrls={rootPath:e,writtenUrls:[]}),t}_unscheduleLayersIdGC(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)}_scheduleLayersIdGC(){this._unscheduleLayersIdGC(),this._layersIdGCTimeoutId=setTimeout(()=>{this._layersIdGCTimeoutId=0,this._runLayersIdGC()},3e3)}_runLayersIdGC(){var r,s;this._unscheduleLayersIdGC();const t=(s=(r=this.applicationProperties)==null?void 0:r.viewing)==null?void 0:s.search,e=n=>this.allLayers.some(o=>o.id===n&&o.persistenceEnabled);t!=null&&t.layers&&(t.layers=t.layers.filter(n=>e(n.id)));const i=this.presentation&&this.presentation.slides;i&&i.forEach(n=>{n.visibleLayers&&(n.visibleLayers=n.visibleLayers.filter(o=>e(o.id)))})}static fromJSON(t){if(!t)throw new U("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:t})}};NUe=m5t,_r.version=`${lS.major}.${lS.minor}`,u([p({type:K5t,json:{write:!0}})],_r.prototype,"applicationProperties",void 0),u([p({type:_i,json:{read:{source:"clippingArea.geometry",reader:pf},write:{target:"clippingArea.geometry"}}})],_r.prototype,"clippingArea",void 0),u([_e("clippingArea")],_r.prototype,"writeClippingArea",null),u([p({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],_r.prototype,"clippingEnabled",void 0),u([ve("clippingEnabled",["clippingArea"])],_r.prototype,"readClippingEnabled",null),u([_e("clippingEnabled")],_r.prototype,"writeClippingEnabled",null),u([p({type:H5e,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],_r.prototype,"floorInfo",void 0),u([p({type:rw,json:{write:!0}})],_r.prototype,"heightModelInfo",void 0),u([p({json:{write:{target:"operationalLayers",ignoreOrigin:!0}}})],_r.prototype,"layers",void 0),u([_e("layers")],_r.prototype,"writeLayers",null),u([p({readOnly:!0,type:EV,json:{type:lzt(),write:{ignoreOrigin:!0,target:"version",isRequired:!0,overridePolicy:()=>({enabled:!0,allowNull:!0,ignoreOrigin:!0})}}})],_r.prototype,"sourceVersion",void 0),u([ve("sourceVersion",["version"])],_r.prototype,"readSourceVersion",null),u([_e("sourceVersion")],_r.prototype,"writeSourceVersion",null),u([p({json:{read:!1,write:{enabled:!0,ignoreOrigin:!0}}})],_r.prototype,"tables",void 0),u([_e("tables")],_r.prototype,"writeTables",null),u([p()],_r.prototype,"thumbnailUrl",null),u([p({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],_r.prototype,"authoringApp",null),u([_e("authoringApp")],_r.prototype,"writeAuthoringApp",null),u([p({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],_r.prototype,"authoringAppVersion",null),u([_e("authoringAppVersion")],_r.prototype,"writeAuthoringAppVersion",null),u([p({json:{write:{isRequired:!0,allowNull:!0,ignoreOrigin:!0,enabled:!0}}})],_r.prototype,"ground",void 0),u([_e("ground")],_r.prototype,"writeGround",null),u([p({type:Ce.ofType(azt),json:{write:!0}})],_r.prototype,"transportationNetworks",void 0),u([p({type:LUe,nonNullable:!0,json:{write:{ignoreOrigin:!0,writer:(t,e,i,r)=>{if(t.slides&&t.slides.length>0){const s={...r,isPresentation:!0};e.presentation=t.write({},s)}}}}})],_r.prototype,"presentation",void 0),u([p({type:TV,nonNullable:!0,json:{write:{target:"initialState",isRequired:!0,ignoreOrigin:!0},default:()=>new TV({viewingMode:"global",spatialReference:Oe.WebMercator})}})],_r.prototype,"initialViewProperties",void 0),u([ve("initialViewProperties",["initialState.timeExtent","initialState.environment","initialState.viewpoint","spatialReference","viewingMode"])],_r.prototype,"readInitialViewProperties",null),u([p({type:Oe,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],_r.prototype,"spatialReference",null),u([p({type:["local","global"],json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],_r.prototype,"viewingMode",null),u([p({type:nh})],_r.prototype,"portalItem",void 0),u([p()],_r.prototype,"resourceInfo",void 0),u([p({type:q5e,json:{write:!0}})],_r.prototype,"widgets",void 0),_r=u([A("esri.WebScene")],_r);const czt=_r;function uzt(t){return t!=null&&typeof t=="object"&&t.type==="2d"&&t.view2dType==="linkchart"}async function hzt(t,e={}){const{basemap:i,view:r}=t;await i.load(e),pzt(i),await mzt(i,r,e),gt(e)}async function dzt(t,e={}){var a,l;const{basemap:i,view:r}=t;gt(e);const s=(a=i.baseLayers.find(c=>c.type==="unknown"))==null?void 0:a.loadError;if(s!=null)throw s;if(!r||"spatialReferenceLocked"in r&&!r.spatialReferenceLocked||(await i.load(e),gt(e),i.baseLayers.length===0))return;const n=i.baseLayers.at(0);if(!HC(n))return;if(i.spatialReference){if(r.spatialReference.equals(i.spatialReference))return;d1e()}await n.load(e),gt(e);const o=(("supportedSpatialReferences"in n?n.supportedSpatialReferences:null)||["tileInfo"in n?(l=n.tileInfo)==null?void 0:l.spatialReference:null]).filter(df);o.length!==0&&o.every(c=>!r.spatialReference.equals(c))&&d1e()}function d1e(){throw new U("basemap-compatibility:incompatible-spatial-reference","Basemap spatial reference is not compatible with the view")}function pzt(t){if(t.baseLayers.length===0&&t.referenceLayers.length===0)return;const e=t.baseLayers.concat(t.referenceLayers).toArray().filter(i=>!mYe(i)).map(i=>fzt(i));if(e.length)throw e[0]}function fzt(t){return new U("basemap-compatibility:unsupported-basemap-layer-type","Unsupported basemap layer type ${operationalLayerType}",{layer:t,operationalLayerType:t.operationalLayerType||"unknown"})}async function mzt(t,e,i){if(t.baseLayers.length===0)return;const r=t.baseLayers.at(0);if(n$e(r)){try{await r.load(i)}catch(s){const n="basemap-compatibility:unknown-error",o="Unknown basemap compatibility error",{name:a=n,message:l=o,details:c}=s;throw new U(a,l,c)}gzt(r,e)}}function gzt(t,e){var a;const i=e.state.viewingMode;if(!i)return;let r,s;if((t==null?void 0:t.type)==="wmts"){const l=Zke(t,e.spatialReference,i);if(l.tileInfo==null)throw new U("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view");r=l.tileInfo,s=l.fullExtent}else r=t.tileInfo,s=t.fullExtent;if(r==null)return;if(!SA(r.spatialReference,i))throw new U(`basemapgalleryitem:spatial-reference-unsupported-${cP(i)}`,`Basemap spatial reference is unsupported in ${cP(i)} mode`);const n=(t==null?void 0:t.type)==="vector-tile"?r.getCompatibleForVTL(256):null;if(i===je.Global){let l=cD(r,s,null,i);if(l&&(t==null?void 0:t.type)==="vector-tile"&&s!=null&&n&&!cD(n,s,null,i)&&(l=null),l){const c=r.spatialReference.isWebMercator?"web-mercator":"wgs84";throw new U(`basemapgalleryitem:tiling-scheme-unsupported-${c}-global`,"Basemap tiling scheme is unsupported in global mode",{error:l})}}else if(oc.checkUnsupported(r))throw new U("basemapgalleryitem:tiling-scheme-unsupported-local","Basemap tiling scheme is unsupported in local mode");const o=(a=e.basemapTerrain)==null?void 0:a.tilingScheme;if(o&&!o.compatibleWith(r)&&((t==null?void 0:t.type)!=="vector-tile"||!n||!o.compatibleWith(n)))throw new U("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view")}let gm=class extends XS.IdentifiableMixin(he){constructor(e){super(e),this.compatibilityFunction=null,this.error=null,this.state="loading",this.view=null}initialize(){const e=()=>this.refresh();this.addHandles([H(()=>{var i;return(i=this.basemap)==null?void 0:i.loadStatus},e),H(()=>this.compatibilityFunction,e),H(()=>{var i;return this.view&&"basemapTerrain"in this.view&&((i=this.view.basemapTerrain)==null?void 0:i.tilingScheme)},e),H(()=>{var i;return(i=this.view)==null?void 0:i.ready},e),H(()=>{var i;return(i=this.view)==null?void 0:i.spatialReference},e)]),this.refresh()}destroy(){this._cancelRefresh(),this.basemap=null,this.compatibilityFunction=null,this.view=null}get _spatialReferenceTask(){return F$e(this.view,this.basemap)}set basemap(e){e&&e.load().catch(()=>{}),this._set("basemap",e)}get spatialReference(){return this._spatialReferenceTask.spatialReference}refresh(){var s;this._cancelRefresh(),this._set("state","loading");const e=(s=this.basemap)==null?void 0:s.loadStatus;if(e!=="loaded"&&e!=="failed")return;if(!this.compatibilityFunction)return void(e==="loaded"?(this._set("state","ready"),this._set("error",null)):(this._set("state","error"),this._set("error",this.basemap.loadError)));const i=new AbortController,{signal:r}=i;this.compatibilityFunction(this,{signal:r}).then(()=>Id(()=>!this._spatialReferenceTask.updating,r)).then(()=>{this._set("state","ready"),this._set("error",null)}).catch(n=>{es(n)||(this._set("state","error"),this._set("error",n))}),this._refreshController=i}_cancelRefresh(){this._refreshController&&(this._refreshController.abort(),this._refreshController=null)}};u([p({readOnly:!0})],gm.prototype,"_spatialReferenceTask",null),u([p()],gm.prototype,"basemap",null),u([p()],gm.prototype,"compatibilityFunction",void 0),u([p({readOnly:!0})],gm.prototype,"error",void 0),u([p({readOnly:!0})],gm.prototype,"spatialReference",null),u([p({readOnly:!0})],gm.prototype,"state",void 0),u([p()],gm.prototype,"view",void 0),gm=u([A("esri.widgets.BasemapGallery.support.BasemapGalleryItem")],gm);const FUe=gm,kUe=Ce.ofType(sv);let kR=class extends he{constructor(e){super(e),this.basemaps=new kUe}destroy(){this.basemaps.forEach(e=>e.destroy())}get state(){return"ready"}refresh(){}};u([p({type:kUe})],kR.prototype,"basemaps",void 0),u([p({readOnly:!0})],kR.prototype,"state",null),kR=u([A("esri.widgets.BasemapGallery.support.LocalBasemapsSource")],kR);const zUe=kR,UUe=Ce.ofType(sv);let ym=class extends Il.LoadableMixin(iw.EsriPromiseMixin(zUe)){constructor(t){super(t),this._lastPortalBasemapFetchController=null,this.basemaps=new UUe,this.filterFunction=null,this.portal=vn.getDefault(),this.query=null,this.updateBasemapsCallback=null,this.viewType=null}initialize(){this.addHandles(H(()=>{var t,e,i;return[this.filterFunction,this.loadStatus,(t=this.portal)==null?void 0:t.basemapGalleryGroupQuery,(e=this.portal)==null?void 0:e.basemapGalleryGroupQuery3D,(i=this.portal)==null?void 0:i.user,this.query,this.updateBasemapsCallback]},()=>this.refresh(),Ut))}destroy(){this.filterFunction=null,this.portal=null,this.basemaps.forEach(t=>t.destroy())}get state(){return this.loadStatus==="not-loaded"?"not-loaded":this.loadStatus==="loading"||this._lastPortalBasemapFetchController?"loading":"ready"}load(t){return this.addResolvingPromise(this.portal.load(t)),Promise.resolve(this)}async refresh(){if(this.loadStatus!=="loaded")return;this._lastPortalBasemapFetchController&&(this._lastPortalBasemapFetchController.abort(),this._lastPortalBasemapFetchController=null);const t=this.portal,e=new AbortController;this._lastPortalBasemapFetchController=e,this.notifyChange("state");try{const i=await t.fetchBasemaps(this._toQueryString(this.query),{signal:e.signal,include3d:this.viewType==="3d"||void 0});await this._updateBasemaps(i)}catch(i){if(es(i))throw i;J.getLogger(this).warn(new U("basemap-source:fetch-basemaps-error","Could not fetch basemaps from portal.",{error:i})),await this._updateBasemaps()}this._lastPortalBasemapFetchController=null,this.notifyChange("state")}_toQueryString(t){return t&&typeof t!="string"?Object.keys(t).map(e=>`${e}:${t[e]}`).join(" AND "):t}async _updateBasemaps(t=[]){let e=await this._filterBasemaps(t);e=this.updateBasemapsCallback?await this.updateBasemapsCallback(e):e,this.basemaps.removeAll(),this.basemaps.addMany(e)}async _filterBasemaps(t){if(!this.filterFunction)return t;const e=t.map(this.filterFunction),i=await Promise.all(e);return t.filter((r,s)=>i[s])}};u([p({readOnly:!0,type:UUe})],ym.prototype,"basemaps",void 0),u([p()],ym.prototype,"filterFunction",void 0),u([p({type:vn})],ym.prototype,"portal",void 0),u([p()],ym.prototype,"query",void 0),u([p({readOnly:!0})],ym.prototype,"state",null),u([p()],ym.prototype,"updateBasemapsCallback",void 0),u([p()],ym.prototype,"viewType",void 0),ym=u([A("esri.widgets.BasemapGallery.support.PortalBasemapsSource")],ym);const PC=ym,BUe=Ce.ofType(FUe);function yzt(t){return t&&t.declaredClass==="esri.portal.Portal"}function vzt(t){return t&&!(t instanceof PC)&&(!!t.portal||!!t.query)}function _zt(t){return t&&"basemaps"in t&&"state"in t&&"refresh"in t}let Fu=class extends Il{constructor(t){super(t),this._loadingProjectionEngine=!1,this.items=new BUe,this.source=new PC,this.view=null}initialize(){const t=()=>this._recreateItems();this.addHandles([H(()=>this.state==="ready"?this.compatibilityFunction:null,()=>this._updateItems()),so(()=>{var e;return(e=this.source)==null?void 0:e.basemaps},"change",t,{onListenerAdd:t}),bn(()=>this.view,()=>{var e;this.source instanceof PC&&(this.source.viewType=(e=this.view)==null?void 0:e.type)},{once:!0})])}destroy(){var e;const t=this.source.basemaps.find(i=>i===this.activeBasemap);t&&this.source.basemaps.remove(t),(e=this.source)==null||e.destroy()}get activeBasemap(){var t,e;return((e=(t=this.view)==null?void 0:t.map)==null?void 0:e.basemap)??null}set activeBasemap(t){var r,s;const e=this.view;if(!(e!=null&&e.map))return;if(!t||!e.ready)return e.map.basemap=t,void this._clearOverride("activeBasemap");const i=t.spatialReference||((s=(r=this.items)==null?void 0:r.find(n=>this.basemapEquals(t,n.basemap)))==null?void 0:s.spatialReference);if(i&&"spatialReferenceLocked"in e&&!e.spatialReferenceLocked){const n=e.spatialReference;if(i!=null&&!as(n,i)&&!lu(e.spatialReference,i)&&!Uv())return this._override("activeBasemap",t),this._loadingProjectionEngine=!0,void vv().then(()=>{this._get("activeBasemap")===t&&(e.map.basemap=t,e.spatialReference=i,this._clearOverride("activeBasemap"))},()=>{}).then(()=>{this._loadingProjectionEngine=!1});e.map.basemap=t,this._clearOverride("activeBasemap"),i==null||as(e.spatialReference,i)||(e.spatialReference=i)}else e.map.basemap=t,this._clearOverride("activeBasemap")}castActiveBasemap(t){return pG(t)}get activeBasemapIndex(){const{state:t,activeBasemap:e}=this;return t!=="ready"?-1:this._findBasemapIndex(e)}get compatibilityFunction(){var t;return((t=this.view)==null?void 0:t.type)==="3d"?hzt:dzt}set compatibilityFunction(t){this._overrideIfSome("compatibilityFunction",t)}castSource(t){return Array.isArray(t)||Ce.isCollection(t)?new zUe({basemaps:Array.isArray(t)?new Ce(t):t}):yzt(t)?new PC({portal:t}):vzt(t)?new PC(t):_zt(t)?t:null}get state(){var t;return(t=this.view)!=null&&t.ready&&this.source?uzt(this.view)&&!this.view.inGeographicLayout?"unsupported":this._loadingProjectionEngine?"loading":"ready":"disabled"}basemapEquals(t,e){return RJe(t,e)}refresh(){this._recreateItems()}load(){return this.loadSource()}loadSource(t){return this.addResolvingPromise(Il.isLoadable(this.source)?this.source.load(t):null),Promise.resolve(this)}_findBasemapIndex(t){const{items:e}=this,i=e.findIndex(r=>r.basemap===t);return i===-1?e.findIndex(r=>this.basemapEquals(r.basemap,t)):i}_recreateItems(){var n;const t=((n=this.source)==null?void 0:n.basemaps)??[],{view:e,compatibilityFunction:i}=this,r=new Map(this.items.map(o=>[o.basemap,o])),s=t.map(o=>{const a=r.get(o);return a?(r.delete(o),a):new FUe({basemap:o,compatibilityFunction:i,view:e})});this.items.removeAll(),this.items.addMany(s),r.forEach(o=>o.destroy())}_updateItems(){for(const t of this.items)t.compatibilityFunction=this.compatibilityFunction,t.view=this.view}};u([p()],Fu.prototype,"_loadingProjectionEngine",void 0),u([p({type:sv})],Fu.prototype,"activeBasemap",null),u([ti("activeBasemap")],Fu.prototype,"castActiveBasemap",null),u([p({readOnly:!0})],Fu.prototype,"activeBasemapIndex",null),u([p()],Fu.prototype,"compatibilityFunction",null),u([p({readOnly:!0,type:BUe})],Fu.prototype,"items",void 0),u([p()],Fu.prototype,"source",void 0),u([ti("source")],Fu.prototype,"castSource",null),u([p({readOnly:!0})],Fu.prototype,"state",null),u([p()],Fu.prototype,"view",void 0),Fu=u([A("esri.widgets.BasemapGallery.BasemapGalleryViewModel")],Fu);const bzt=Fu,op="esri-basemap-gallery",ap={base:op,sourceLoading:`${op}--source-loading`,loader:`${op}__loader`,item:`${op}__item`,itemContainer:`${op}__item-container`,itemContent:`${op}__item-content`,itemTitle:`${op}__item-title`,itemTagsContainer:`${op}__item-tags-container`,itemThumbnail:`${op}__item-thumbnail`,selectedItem:`${op}__item--selected`,itemError:`${op}__item--error`};function p1e({level:t,class:e,...i},r){const s=VUe(t);return ei(`h${s}`,{...i,"aria-level":String(s),class:qCe(Yo.heading,e),role:"heading"},r)}function VUe(t){return ue(Math.ceil(t),1,6)}function qmi(t,e=1){return VUe(t+e)}let Dc=class extends oT{constructor(e,i){super(e,i),this.disabled=!1,this.headingLevel=2,this.messages=null,this.viewModel=new bzt,this._focusBasemapItemEnabled=!1,Yje(J.getLogger(this),"Basemap Gallery","arcgis-basemap-gallery",{version:"4.32"})}initialize(){this.addHandles(bn(()=>this.source,()=>this.viewModel.loadSource(),{sync:!0,initial:!0}))}loadDependencies(){return mL({scrim:()=>G(()=>Promise.resolve().then(()=>MBt),void 0),chip:()=>G(()=>import("./index-ayw0OgPX.js"),[])})}get activeBasemap(){return this.viewModel.activeBasemap}set activeBasemap(e){this.viewModel.activeBasemap=e}get icon(){return"basemap"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get source(){return this.viewModel.source}set source(e){this.viewModel.source=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e=this.source.state==="loading",i=this.disabled||this.viewModel.state==="disabled",r={[ap.sourceLoading]:e,[Yo.disabled]:i};return ei("div",{class:this.classes(ap.base,Yo.widget,Yo.panel,r),key:"container"},this._getContext())}_getContext(){if(this.viewModel.state==="unsupported")return ei("div",{class:Yo.empty,key:"empty-message"},ei(p1e,{level:this.headingLevel},this.messages.unsupported));if(this.source.state==="loading")return ei("div",{class:ap.loader,key:"loader"});const e=this.viewModel.items;return e.length>0?ei("ul",{"aria-disabled":this.disabled,"aria-label":this.label,bind:this,class:ap.itemContainer,key:"item-container",onkeydown:this._handleKeyDown,role:"radiogroup"},e.map((i,r)=>this._renderBasemapGalleryItem(i,r)).toArray()):ei("div",{class:Yo.empty,key:"empty-message"},ei(p1e,{level:this.headingLevel},this.messages.noBasemaps))}_getRoundRobinIndex(e,i){return(e+i)%i}_handleKeyDown(e){const{key:i}=e;if(!["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(i))return;e.preventDefault();const{items:r,activeBasemapIndex:s}=this.viewModel,n=i==="ArrowUp"||i==="ArrowLeft"?this._getRoundRobinIndex(Math.max(s-1,-1),r.length):this._getRoundRobinIndex(s+1,r.length),o=r.at(n);(o==null?void 0:o.state)==="ready"&&(this.viewModel.activeBasemap=o.basemap),this._focusBasemapItemEnabled=!0}_focusBasemapItem(e){this._focusBasemapItemEnabled&&e.tabIndex===0&&(e.focus(),this._focusBasemapItemEnabled=!1)}_handleClick(e){const i=e.currentTarget["data-item"];i.state==="ready"&&(this.viewModel.activeBasemap=i.basemap)}_renderBasemapGalleryItem(e,i){var v,_;const r=LJe(e.basemap)||vs("esri/themes/base/images/basemap-toggle-64.svg"),s=e.basemap.title,n=(v=e.basemap.portalItem)==null?void 0:v.snippet,o=((_=e.error)==null?void 0:_.message)||n||s,{viewModel:{state:a,activeBasemapIndex:l}}=this,c=this.disabled||a==="disabled",h=l===i,d=h||l===-1&&i===0?0:-1,f=a==="loading",m={[ap.selectedItem]:h,[ap.itemError]:e.state==="error"},g=`basemapgallery-item-${e.uid}`;return ei("li",{afterUpdate:this._focusBasemapItem,"aria-checked":h.toString(),"aria-disabled":c.toString(),"aria-labelledby":g,bind:this,class:this.classes(ap.item,m),"data-item":e,key:e.uid,onclick:this._handleClick,onkeydown:this._handleClick,role:"radio",tabIndex:d,title:o},ei("img",{alt:"",class:ap.itemThumbnail,src:r}),ei("div",{class:ap.itemContent,key:"content"},ei("div",{class:ap.itemTitle,key:"title"},ei("span",{id:g},s)),MJe(e.basemap)?this._renderTags(e.basemap):null),e.state==="loading"||h&&f?ei("calcite-scrim",null,ei("span",{"aria-hidden":"true",class:Yo.loaderAnimation,key:"loader",role:"presentation"})):null)}_renderTags(e){return ei("div",{class:ap.itemTagsContainer,key:"tag"},this._render3DTag(),OJe(e)?this._renderBetaTag():null)}_render3DTag(){const{messages:e}=this;return ei("calcite-chip",{key:"tag-3d",label:e.tag3D,scale:"s"},this.messages.tag3D)}_renderBetaTag(){const{messages:e}=this;return ei("calcite-chip",{appearance:"outline-fill",key:"tag-beta",label:e.tagBeta,scale:"s"},this.messages.tagBeta)}};u([p()],Dc.prototype,"activeBasemap",null),u([p()],Dc.prototype,"disabled",void 0),u([p()],Dc.prototype,"headingLevel",void 0),u([p()],Dc.prototype,"icon",null),u([p()],Dc.prototype,"label",null),u([p(),Ev("esri/widgets/BasemapGallery/t9n/BasemapGallery")],Dc.prototype,"messages",void 0),u([p()],Dc.prototype,"source",null),u([p()],Dc.prototype,"view",null),u([p()],Dc.prototype,"viewModel",void 0),u([p()],Dc.prototype,"_focusBasemapItemEnabled",void 0),u([jIe()],Dc.prototype,"_handleClick",null),Dc=u([A("esri.widgets.BasemapGallery")],Dc);const wzt=Dc;let T_=class extends he{constructor(t){super(t),this._viewpointHandle=null,this.group=null}initialize(){this.addHandles(so(()=>{var t;return(t=this.view)==null?void 0:t.ui},"expand",t=>{const{target:e}=t;e&&e!==this&&e.expanded&&e.group&&e.group===this.group&&this._collapse()}))}destroy(){this._viewpointHandle=null,this.view=null}set autoCollapse(t){this._set("autoCollapse",t),this._watchViewpoint()}set expanded(t){var r;const e=!!t;this._set("expanded",e);const i=(r=this.view)==null?void 0:r.ui;i&&i.emit("expand",{target:this}),this._viewpointHandleChange(e)}get state(){var t;return(t=this.view)!=null&&t.ready?"ready":"disabled"}set view(t){this._get("view")!==t&&(this._set("view",t),t&&bn(()=>t.ready,()=>{this.view===t&&this._watchViewpoint()},{once:!0,initial:!0}))}_viewpointHandleChange(t){this._viewpointHandle&&(t?bn(()=>{var e;return(e=this.view)==null?void 0:e.stationary},()=>{var e;return(e=this._viewpointHandle)==null?void 0:e.resume()},{once:!0,initial:!0}):this._viewpointHandle.pause())}_watchViewpoint(){const t="viewpoint";this.removeHandles(t),this._viewpointHandle=null;const{autoCollapse:e,view:i}=this;if(!i||!e)return;const r=sqe(()=>i.type==="3d"?i.camera:i.viewpoint,()=>this._collapse());this.addHandles(r,t),this._viewpointHandle=r}_collapse(){this.expanded=!1}};u([p({value:!1})],T_.prototype,"autoCollapse",null),u([p({value:!1})],T_.prototype,"expanded",null),u([p()],T_.prototype,"group",void 0),u([p({readOnly:!0})],T_.prototype,"state",null),u([p({value:null})],T_.prototype,"view",null),T_=u([A("esri.widgets.Expand.ExpandViewModel")],T_);const jUe=T_;function q7(t){return t&&typeof t.render=="function"}function xzt(t){return t&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}const L0="esri-expand",xu={base:L0,toggle:`${L0}__toggle`,popoverContent:`${L0}__popover-content`,panel:`${L0}__panel`,panelContent:`${L0}__panel-content`,sheet:`${L0}__sheet`,contentContainer:`${L0}__content-container`,icon:"esri-collapse__icon",iconFlip:"esri-collapse__icon-flip",iconNumber:`${L0}__icon-number`},f1e="chevrons-left",m1e="chevrons-right";let Vs=class extends oT{constructor(t,e){super(t,e),this.closeOnEsc=!0,this.collapseTooltip="",this.content="",this.expandTooltip="",this.focusTrapDisabled=!1,this.iconNumber=0,this.messages=null,this.messagesCommon=null,this.mode="auto",this.placement=null,this.viewModel=new jUe,this.toggle=()=>{this.viewModel.expanded=!this.viewModel.expanded},this._handlePopoverClose=i=>{i.target===this._popoverEl&&(this.viewModel.expanded=i.currentTarget.open)},this._handleSheetClose=i=>{this.viewModel.expanded=i.currentTarget.open},this._handlePanelClose=i=>{this.viewModel.expanded=!i.currentTarget.closed},this._handleKeyDown=i=>{this.viewModel.expanded&&i.key==="Escape"&&!this._willCloseOnEsc(i)&&i.preventDefault()},this._storeToggleActionEl=i=>{this._toggleActionEl=i},this._storePopoverEl=i=>{this._popoverEl=i}}initialize(){this.addHandles(H(()=>{var t,e;return(e=(t=this.viewModel)==null?void 0:t.view)==null?void 0:e.size},()=>{var t;return(t=this._popoverEl)==null?void 0:t.reposition()},Ut))}loadDependencies(){return mL({action:()=>G(()=>Promise.resolve().then(()=>BGt),void 0),icon:()=>G(()=>Promise.resolve().then(()=>oBe),void 0),panel:()=>G(()=>Promise.resolve().then(()=>z6t),void 0),popover:()=>G(()=>Promise.resolve().then(()=>P6t),void 0),sheet:()=>G(()=>import("./index-ChDV4aA9.js"),__vite__mapDeps([380,381,382]))})}get expandTitle(){const{expanded:t,messagesCommon:e,collapseTooltip:i,expandTooltip:r}=this;return(t?i||(e==null?void 0:e.collapse):r||(e==null?void 0:e.expand))??""}get _displaySheet(){var t;switch(this.mode){case"drawer":return!0;case"auto":return((t=this.viewModel.view)==null?void 0:t.widthBreakpoint)==="xsmall";default:return!1}}get autoCollapse(){return this.viewModel.autoCollapse}set autoCollapse(t){this.viewModel.autoCollapse=t}get collapseIcon(){return m1e}set collapseIcon(t){this._overrideIfSome("collapseIcon",t)}get expanded(){return this.viewModel.expanded}set expanded(t){this.viewModel.expanded=t}get expandIcon(){return q7(this.content)?this.content.icon:f1e}set expandIcon(t){this._overrideIfSome("expandIcon",t)}get group(){return this.viewModel.group}set group(t){this.viewModel.group=t}get icon(){return null}get label(){var t;return(q7(this.content)?this.content.label:null)??((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}expand(){this.viewModel.expanded=!0}collapse(){this.viewModel.expanded=!1}render(){const{_displaySheet:t,_toggleActionEl:e,viewModel:{expanded:i},label:r,placement:s}=this;return ei("div",{class:this.classes(xu.base,Yo.widget)},this._renderToggle(),t?ei("calcite-sheet",{class:xu.sheet,heightScale:"l",label:r,onkeydown:this._handleKeyDown,open:i,position:"block-end",onCalciteSheetClose:this._handleSheetClose},ei("calcite-panel",{class:xu.panel,closable:!0,closed:!i,heading:r,onkeydown:this._handleKeyDown,onCalcitePanelClose:this._handlePanelClose},ei("div",{class:xu.panelContent},this._renderContent()))):e?ei("calcite-popover",{afterCreate:this._storePopoverEl,afterUpdate:this._storePopoverEl,focusTrapDisabled:this.focusTrapDisabled,label:r,onkeydown:this._handleKeyDown,open:i,overlayPositioning:"fixed",placement:s??this._getPlacement(),referenceElement:e,onCalcitePopoverClose:this._handlePopoverClose},ei("div",{class:xu.popoverContent},this._renderContent())):null)}_getPlacement(){const{container:t,view:e}=this,i=t&&e?e.ui.getPosition(t):null;if(!i||i==="manual")return"auto";const[r,s]=i.split("-");return`${s==="right"?"left":"right"}-${r==="bottom"?"end":"start"}`}_willCloseOnEsc(t){const{closeOnEsc:e}=this;return typeof e=="function"?e(t):e}_renderBadgeNumber(){const{expanded:t,iconNumber:e}=this;return e&&!t?ei("span",{class:xu.iconNumber,key:"expand__icon-number"},e):null}_renderToggleButton(){const{expanded:t,expandTitle:e,expandIcon:i,collapseIcon:r}=this,s=t?r:i,n=s===f1e||s===m1e;return ei("calcite-action",{afterCreate:this._storeToggleActionEl,afterUpdate:this._storeToggleActionEl,class:Yo.widgetButton,onclick:this.toggle,scale:"s",text:e,title:e},s?ei("calcite-icon",{class:this.classes(xu.icon,n&&xu.iconFlip),icon:s,scale:"s"}):null)}_renderToggle(){return ei("div",{class:xu.toggle},this._renderToggleButton(),this._renderBadgeNumber())}_renderContent(){const{content:t}=this;return typeof t=="string"?ei("div",{class:xu.contentContainer,innerHTML:t,key:"content__string"}):q7(t)?ei("div",{class:xu.contentContainer,key:"content__widget"},t.render()):t instanceof HTMLElement?ei("div",{afterCreate:this._attachToNode,bind:t,class:xu.contentContainer,key:"content__html-element"}):xzt(t)?ei("div",{afterCreate:this._attachToNode,bind:t.domNode,class:xu.contentContainer,key:"content__node"}):null}_attachToNode(t){const e=this;t.appendChild(e)}};u([p({readOnly:!0})],Vs.prototype,"expandTitle",null),u([p()],Vs.prototype,"_toggleActionEl",void 0),u([p()],Vs.prototype,"_displaySheet",null),u([p()],Vs.prototype,"autoCollapse",null),u([p()],Vs.prototype,"closeOnEsc",void 0),u([p()],Vs.prototype,"collapseIcon",null),u([p()],Vs.prototype,"collapseTooltip",void 0),u([p()],Vs.prototype,"content",void 0),u([p()],Vs.prototype,"expanded",null),u([p()],Vs.prototype,"expandIcon",null),u([p()],Vs.prototype,"expandTooltip",void 0),u([p()],Vs.prototype,"focusTrapDisabled",void 0),u([p()],Vs.prototype,"group",null),u([p()],Vs.prototype,"icon",null),u([p()],Vs.prototype,"iconNumber",void 0),u([p()],Vs.prototype,"label",null),u([p(),Ev("esri/widgets/Expand/t9n/Expand")],Vs.prototype,"messages",void 0),u([p(),Ev("esri/t9n/common")],Vs.prototype,"messagesCommon",void 0),u([p()],Vs.prototype,"mode",void 0),u([p()],Vs.prototype,"placement",void 0),u([p()],Vs.prototype,"view",null),u([p({type:jUe})],Vs.prototype,"viewModel",void 0),Vs=u([A("esri.widgets.Expand")],Vs);const Szt=Vs;var Tzt=Object.defineProperty,Ezt=Object.getOwnPropertyDescriptor,aH=(t,e,i,r)=>{for(var s=r>1?void 0:r?Ezt(e,i):e,n=t.length-1,o;n>=0;n--)(o=t[n])&&(s=(r?o(e,i,s):o(s))||s);return r&&s&&Tzt(e,i,s),s};let DA=class extends sf{constructor(){super(...arguments),this.view=null,this.extentJson="",this.scale=null,this.extentHandle=null,this.scaleHandle=null}connectedCallback(){super.connectedCallback(),this.setupWatchers()}disconnectedCallback(){super.disconnectedCallback(),this.cleanupWatchers()}updated(t){t.has("view")&&(this.cleanupWatchers(),this.setupWatchers(),this.updateExtentAndScale())}setupWatchers(){this.view&&(this.extentHandle=H(()=>this.view.extent,()=>this.updateExtentAndScale()),this.scaleHandle=H(()=>this.view.scale,()=>this.updateExtentAndScale()),this.updateExtentAndScale())}cleanupWatchers(){var t,e,i,r;(e=(t=this.extentHandle)==null?void 0:t.remove)==null||e.call(t),(r=(i=this.scaleHandle)==null?void 0:i.remove)==null||r.call(i),this.extentHandle=null,this.scaleHandle=null}updateExtentAndScale(){if(!this.view)return;const t=this.view.extent;if(t){const{xmin:e,ymin:i,xmax:r,ymax:s,spatialReference:n}=t;this.extentJson=JSON.stringify({xmin:e,ymin:i,xmax:r,ymax:s,spatialReference:n},null,2)}this.scale=this.view.scale??null}async copyExtent(){try{await navigator.clipboard.writeText(this.extentJson)}catch{const t=document.createElement("textarea");t.value=this.extentJson,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}}render(){return ce`
      <span class="extent-label">Current Extent</span>
      <div class="extent-json">${this.extentJson}</div>
      <button @click=${this.copyExtent}>Copy as JSON</button>
      <div class="scale">Scale: <b>${this.scale?Math.round(this.scale):"N/A"}</b></div>
    `}};DA.styles=Ks`
    :host {
      position: absolute;
      bottom: 20px;
      right: 20px;
      z-index: 30;
      background: white;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 12px 16px;
      font-size: 13px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      min-width: 260px;
      max-width: 350px;
      user-select: text;
    }
    .extent-label {
      font-weight: bold;
      margin-bottom: 4px;
      display: block;
    }
    .extent-json {
      font-family: monospace;
      font-size: 12px;
      background: #f7f7f7;
      padding: 4px 6px;
      border-radius: 4px;
      margin-bottom: 6px;
      word-break: break-all;
      white-space: pre-wrap;
    }
    button {
      font-size: 12px;
      padding: 3px 10px;
      border-radius: 4px;
      border: 1px solid #aaa;
      background: #f3f3f3;
      cursor: pointer;
      margin-top: 4px;
    }
    .scale {
      margin-top: 6px;
      color: #555;
    }
  `;aH([jA({attribute:!1})],DA.prototype,"view",2);aH([zv()],DA.prototype,"extentJson",2);aH([zv()],DA.prototype,"scale",2);DA=aH([Ij("view-extent")],DA);var Czt=Object.defineProperty,$zt=Object.getOwnPropertyDescriptor,ZL=(t,e,i,r)=>{for(var s=r>1?void 0:r?$zt(e,i):e,n=t.length-1,o;n>=0;n--)(o=t[n])&&(s=(r?o(e,i,s):o(s))||s);return r&&s&&Czt(e,i,s),s};let BS=class extends sf{constructor(){super(...arguments),this.view=null,this.inputJson="",this.error="",this.drawing=!1,this.graphic=null,this.sketch=null,this.graphicsLayer=null}async firstUpdated(){if(!this.view)return;const[t,e]=await Promise.all([G(()=>import("./GraphicsLayer-C8-bjLvb.js"),[]),G(()=>import("./Sketch-D77YaHSD.js").then(i=>i.S),__vite__mapDeps([383,384,385,158,386,223,288,290,287,291,387,329,111,268,286,328,338,314,11,3,315,168,112,1]))]);this.graphicsLayer=new t.default,this.view.map.add(this.graphicsLayer),this.sketch=new e.default({view:this.view,layer:this.graphicsLayer,creationMode:"single",availableCreateTools:["rectangle"],visibleElements:{createTools:{point:!1,polyline:!1,polygon:!1,circle:!1}}}),this.sketch.on("create",async i=>{if(i.state==="complete"&&this.graphic===null){if(this.clearGraphics(),this.sketch&&this.sketch.layer&&i.graphic&&this.sketch.layer.graphics.includes(i.graphic)&&this.sketch.layer.remove(i.graphic),this.sketch.visible=!1,this.graphicsLayer&&i.graphic&&i.graphic.geometry){const[r]=await Promise.all([G(()=>Promise.resolve().then(()=>cde),void 0)]),s=new r.default({geometry:i.graphic.geometry.clone(),symbol:i.graphic.symbol,popupTemplate:{title:"Drawn Extent",content:`<pre>${JSON.stringify(i.graphic.geometry.toJSON(),null,2)}</pre>`}});this.graphicsLayer.add(s),this.graphic=s}if(this.graphic&&this.graphic.geometry&&this.view)if(this.view.type==="3d"&&this.graphic.geometry.extent){const r=this.graphic.geometry.extent;await this.view.goTo({target:r,tilt:0,heading:0})}else await this.view.goTo(this.graphic.geometry);this.dispatchExtent(),this.drawing=!1,this.view&&this.view.popup&&typeof this.view.popup.open=="function"&&this.graphic&&this.view.popup.open({features:[this.graphic],location:this.graphic.geometry})}}),this.sketch.visible=!1,this.view.ui.add(this.sketch,"top-right")}updated(t){t.has("view")&&this.view&&(this.clearGraphics(),this.graphicsLayer&&this.view.map.add(this.graphicsLayer),this.sketch&&(this.sketch.view=this.view,this.view.ui.add(this.sketch,"top-right")),this.view.ui.find(e=>e===this)||this.view.ui.add(this,"bottom-left"))}connectedCallback(){super.connectedCallback(),this.view&&this.view.ui&&!this.view.ui.find(t=>t===this)&&this.view.ui.add(this,"bottom-left")}clearGraphics(){this.graphicsLayer&&this.graphicsLayer.removeAll(),this.graphic=null}async handleDraw(){this.error="",this.drawing=!0,this.sketch&&(this.sketch.visible=!0,this.sketch.create("rectangle"))}handleInput(t){this.inputJson=t.target.value}async handlePasteExtent(){this.error="",this.clearGraphics();let t;try{if(t=JSON.parse(this.inputJson),typeof t.xmin!="number"||typeof t.ymin!="number"||typeof t.xmax!="number"||typeof t.ymax!="number"||!t.spatialReference)throw new Error("Invalid extent JSON")}catch{this.error="Invalid extent JSON";return}const[e,i]=await Promise.all([G(()=>Promise.resolve().then(()=>cde),void 0),G(()=>Promise.resolve().then(()=>p8e),void 0)]);let r=t.spatialReference;typeof r=="number"&&(r={wkid:r});const s=new i.default({xmin:t.xmin,ymin:t.ymin,xmax:t.xmax,ymax:t.ymax,spatialReference:r});this.graphic=new e.default({geometry:s,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[0,0,0,1],width:2}},popupTemplate:{title:"Extent from JSON",content:`<pre>${JSON.stringify(s.toJSON(),null,2)}</pre>`}}),this.graphicsLayer.add(this.graphic),this.view&&(await this.view.goTo(s),this.view.popup&&this.view.popup.open({features:[this.graphic],location:s})),this.dispatchExtent()}dispatchExtent(){this.graphic&&this.dispatchEvent(new CustomEvent("extent-drawn",{detail:{extent:this.graphic.geometry.toJSON()},bubbles:!0,composed:!0}))}render(){return ce`
      <span class="section-label">Draw or Paste Extent</span>
      <textarea
        placeholder="Paste extent JSON here"
        .value=${this.inputJson}
        @input=${this.handleInput}
      ></textarea>
      <div>
        <button @click=${this.handlePasteExtent}>Draw from JSON</button>
        <button @click=${this.handleDraw} ?disabled=${this.drawing}>Draw on Map</button>
        <button @click=${this.clearGraphics.bind(this)}>Clear</button>
      </div>
      ${this.error?ce`<div class="error">${this.error}</div>`:""}
    `}};BS.styles=Ks`
    :host {
      display: block;
      background: white;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 12px 16px;
      font-size: 13px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      min-width: 260px;
      max-width: 350px;
      user-select: text;
    }
    textarea {
      width: 100%;
      min-height: 60px;
      font-family: monospace;
      font-size: 12px;
      margin-bottom: 6px;
      border-radius: 4px;
      border: 1px solid #aaa;
      padding: 4px;
      resize: vertical;
    }
    button {
      font-size: 12px;
      padding: 3px 10px;
      border-radius: 4px;
      border: 1px solid #aaa;
      background: #f3f3f3;
      cursor: pointer;
      margin-right: 6px;
      margin-bottom: 6px;
    }
    .error {
      color: #b00;
      font-size: 12px;
      margin-bottom: 6px;
    }
    .section-label {
      font-weight: bold;
      margin-bottom: 4px;
      display: block;
    }
  `;ZL([jA({attribute:!1})],BS.prototype,"view",2);ZL([zv()],BS.prototype,"inputJson",2);ZL([zv()],BS.prototype,"error",2);ZL([zv()],BS.prototype,"drawing",2);BS=ZL([Ij("draw-extent")],BS);/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */function Azt(t){return t.map(e=>{let i="";for(let r=0;r<e;r++)i+=((1+Math.random())*65536|0).toString(16).substring(1);return i}).join("-")}const vT=()=>Azt([2,1,1,1,3]),Mzt=t=>(...e)=>{const i=bIe(),r=new t(...e),s=r.exports;_Ie(i.at(-1));const n=r.component.manager;n.W(r,s),r.watchExports(n.W.bind(n,r)),bot(r);const o=[r.component,...i].reverse();return wIe(o,a=>a===void 0?void 0:Ozt(r,a,s),s)},Ozt=(t,{host:e,key:i,isReactive:r},s)=>{var d;const n=e,o=n[i]!==t.exports,a=n[i]!==s,l=s!==t.exports;if(o&&!a&&l&&(n[i]=t.exports),e===t.component){if(r){const f=t.component.manager;a&&f.W(t,n[i]),t.onUpdate(m=>{if(m.has(i)){const g=n[i];g!==t.exports&&f.W(t,g)}})}t.O=r?void 0:i}const h=(d=t.component.constructor.elementProperties.get(i))==null?void 0:d.readOnly;t.watchExports(()=>{n[i]!==t.exports&&(h?Tot(()=>{n[i]=t.exports}):n[i]=t.exports)})},Izt=t=>GUe(void 0,t),Rzt=t=>e=>GUe(e,t);class Pzt extends Tse{constructor(e,i){super(e);const r=this.exports;try{rC(this.component);const s=i(this.component,this),n=this.exports!==r;if(_ot(s)){n||this.setProvisionalExports(s);const o=s.then(a=>{this.exports=a,super.catchUpLifecycle()}).catch(a=>{this.P.reject(a),console.error(a)});this.onLoad(async()=>await o)}else(!n||s!==void 0)&&(this.exports=s),queueMicrotask(()=>super.catchUpLifecycle())}catch(s){this.P.reject(s),console.error(s)}}catchUpLifecycle(){}}const GUe=Mzt(Pzt),HUe=(t,e)=>new Dzt(t,e);var A$,M$,AD;class Dzt extends Tse{constructor(i,r){super();Br(this,A$);Br(this,M$);Br(this,AD);vr(this,M$,i),vr(this,AD,r),vr(this,A$,new MutationObserver(s=>{s.forEach(n=>{i.includes(n.attributeName)&&r.call(this.component,this.component.el.getAttribute(n.attributeName),n.oldValue,n.attributeName)})}))}hostConnected(){Ne(this,M$).forEach(i=>{this.component.el.hasAttribute(i)&&Ne(this,AD).call(this.component,null,this.component.el.getAttribute(i),i)}),Ne(this,A$).observe(this.component.el,{attributes:!0,attributeOldValue:!0,attributeFilter:Ne(this,M$)})}hostDisconnected(){Ne(this,A$).disconnect()}}A$=new WeakMap,M$=new WeakMap,AD=new WeakMap;const Lzt=t=>(e={})=>Izt((i,r)=>{const s=yIe(i.el),n={_lang:s.lang,_t9nLocale:s.t9nLocale,_loading:!0},o=i;r.onLifecycle(()=>dot(i.el,()=>t("./assets"),({t9nLocale:l,t9nStrings:c,lang:h})=>{const d={...c,_lang:h,_t9nLocale:l,_loading:!1};r.exports=d;const f=c.componentLabel;typeof f=="string"&&"label"in i&&i.label==null&&(i.label??(i.label=f)),a(o.messageOverrides)},e.name));const a=l=>{const c=r.exports,h=c._original??c,d=qUe(h,l);l&&(d._original=h),r.exports=d};return"messageOverrides"in o&&r.onUpdate(l=>{l.has("messageOverrides")&&a(o.messageOverrides)}),e.blocking?(r.setProvisionalExports(n,!1),r.ready):n}),qUe=(t,e)=>{if(!e)return t;const i={...t};return Object.entries(e).forEach(([r,s])=>{typeof s=="object"?i[r]=qUe(t[r],s):i[r]=s??t[r]}),i};/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const Vd=Lzt(PIe);/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const EE={percentage:"percentage",progressRing:"ring--progress",ring:"ring",rings:"rings",text:"text",trackRing:"ring--track"},Nzt=Ks`:host{position:relative;margin-inline:auto;display:flex;align-items:center;justify-content:center;opacity:1;flex-direction:column;min-block-size:var(--calcite-loader-size);font-size:var(--calcite-loader-font-size);stroke-width:var(--calcite-internal-stroke-width);fill:none;transform:scale(1);padding-block:var(--calcite-loader-spacing, 4rem)}:host([scale=s]){--calcite-internal-stroke-width: 3;--calcite-internal-text-offset: var(--calcite-spacing-xxs);--calcite-internal-loader-font-size: var(--calcite-font-size--3);--calcite-internal-loader-size: 2rem;--calcite-internal-loader-size-inline: .75rem;--calcite-internal-loader-value-line-height: .625rem}:host([scale=m]){--calcite-internal-stroke-width: 6;--calcite-internal-text-offset: var(--calcite-spacing-sm);--calcite-internal-loader-font-size: var(--calcite-font-size-0);--calcite-internal-loader-size: 4rem;--calcite-internal-loader-size-inline: 1rem;--calcite-internal-loader-value-line-height: 1.375rem}:host([scale=l]){--calcite-internal-stroke-width: 8;--calcite-internal-text-offset: var(--calcite-spacing-md);--calcite-internal-loader-font-size: var(--calcite-font-size-2);--calcite-internal-loader-size: 6rem;--calcite-internal-loader-size-inline: 1.5rem;--calcite-internal-loader-value-line-height: 1.71875rem}.text{display:block;text-align:center;font-size:var(--calcite-font-size--2);line-height:1rem;margin-block-start:var(--calcite-loader-text-spacing, var(--calcite-internal-text-offset));font-weight:var(--calcite-loader-text-weight, var(--calcite-font-weight-normal));color:var(--calcite-loader-text-color, var(--calcite-color-text-1))}.percentage{display:block;text-align:center;font-size:var(--calcite-loader-font-size);inline-size:var(--calcite-loader-size, var(--calcite-internal-loader-size));line-height:var(--calcite-internal-loader-value-line-height);align-self:center;color:var(--calcite-loader-text-color, var(--calcite-color-text-1))}.rings{position:relative;display:flex;overflow:visible;opacity:1;inline-size:var(--calcite-loader-size, var(--calcite-internal-loader-size));block-size:var(--calcite-loader-size, var(--calcite-internal-loader-size))}.ring{position:absolute;inset-block-start:0px;transform-origin:center;overflow:visible;inset-inline-start:0;inline-size:var(--calcite-loader-size, var(--calcite-internal-loader-size));block-size:var(--calcite-loader-size, var(--calcite-internal-loader-size))}.ring--track{stroke:var(--calcite-loader-track-color, var(--calcite-color-transparent-press))}.ring--progress{stroke:var(--calcite-loader-progress-color, var(--calcite-color-brand));transform:rotate(-90deg);transition:all var(--calcite-internal-animation-timing-fast) linear}:host([type=indeterminate]) .ring--progress{animation:loader-clockwise calc(var(--calcite-internal-animation-timing-slow) / var(--calcite-internal-duration-factor) * 2 / var(--calcite-internal-duration-factor)) linear infinite}:host([inline]){--calcite-internal-stroke-width: 2;position:relative;margin:0;stroke:currentColor;stroke-width:2;padding-block:0px;block-size:var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline)));min-block-size:var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline)));inline-size:var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline)));vertical-align:calc(var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline))) * -1 * .2)}:host([inline]) .rings{inset-block-start:0px;margin:0;inset-inline-start:0;inline-size:var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline)));block-size:var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline)))}:host([inline]) .ring{inline-size:var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline)));block-size:var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline)))}:host([inline]) .ring--progress{stroke:var(--calcite-loader-progress-color-inline, currentColor)}:host([complete]){opacity:0;transform:scale(.75);transform-origin:center;transition:opacity var(--calcite-internal-animation-timing-medium) linear 1s,transform var(--calcite-internal-animation-timing-medium) linear 1s}:host([complete]) .rings{opacity:0;transform:scale(.75);transform-origin:center;transition:opacity calc(.18s * var(--calcite-internal-duration-factor)) linear .8s,transform calc(.18s * var(--calcite-internal-duration-factor)) linear .8s}:host([complete]) .percentage{color:var(--calcite-color-brand);transform:scale(1.05);transform-origin:center;transition:color var(--calcite-internal-animation-timing-medium) linear,transform var(--calcite-internal-animation-timing-medium) linear}@keyframes loader-clockwise{0%{transform:rotate(0)}to{transform:rotate(360deg)}}:host([hidden]){display:none}[hidden]{display:none}`,hj=class hj extends Hn{constructor(){super(...arguments),this.messages=Vd({name:null}),this.complete=!1,this.inline=!1,this.scale="m",this.text="",this.type="indeterminate",this.value=0}connectedCallback(){super.connectedCallback(),this.updateFormatter()}load(){requestAnimationFrame(()=>this.valueChangeHandler())}willUpdate(e){e.has("value")&&(this.hasUpdated||this.value!==0)&&this.valueChangeHandler(),(e.has("type")&&(this.hasUpdated||this.type!=="indeterminate")||e.has("messages"))&&this.updateFormatter()}valueChangeHandler(){this.complete=this.type.startsWith("determinate")&&this.value===100}formatValue(){return this.type!=="determinate-value"?`${this.value}`:this.formatter.format(this.value/100)}getSize(e){return{s:32,m:64,l:96}[e]}getInlineSize(e){return{s:12,m:16,l:24}[e]}updateFormatter(){var e;this.type!=="determinate-value"||((e=this.formatter)==null?void 0:e.resolvedOptions().locale)===this.messages._lang||(this.formatter=new Intl.NumberFormat(this.messages._lang,{style:"percent"}))}render(){const{el:e,inline:i,label:r,text:s,type:n,value:o}=this,a=e.id||vT(),l=n!=="indeterminate",c=Math.floor(o);return this.el.ariaLabel=r,this.el.ariaValueMax=l?"100":void 0,this.el.ariaValueMin=l?"0":void 0,this.el.ariaValueNow=l?c.toString():void 0,FG(this.el,"id",a),this.el.role="progressbar",ce`<div class=${ge(EE.rings)}>${this.renderRing("track")}${this.renderRing("progress")}${!i&&l&&ce`<div class=${ge(EE.percentage)}>${this.formatValue()}</div>`||""}</div>${!i&&s&&ce`<div class=${ge(EE.text)}>${s}</div>`||""}`}renderRing(e){const{inline:i,scale:r,value:s}=this,n=i?this.getInlineSize(r):this.getSize(r),a=n*.45;let l;if(e==="progress"){const c=2*a*Math.PI,h=(this.type.startsWith("determinate")?s:24)/100*c,d=c-h;l={"stroke-dasharray":`${h} ${d}`}}return ce`<svg aria-hidden=true class=${ge({[EE.ring]:!0,[EE.trackRing]:e==="track",[EE.progressRing]:e==="progress"})} style=${OIe(l)} viewBox=${`0 0 ${n} ${n}`}>${t3`<circle cx=${n/2} cy=${n/2} r=${a??Ke} />`}</svg>`}};hj.properties={complete:[7,{},{reflect:!0,type:Boolean}],inline:[7,{},{reflect:!0,type:Boolean}],label:1,scale:[3,{},{reflect:!0}],text:1,type:[3,{},{reflect:!0}],value:[9,{},{type:Number}]},hj.styles=Nzt;let CV=hj;Io("calcite-loader",CV);const Zmi=Object.freeze(Object.defineProperty({__proto__:null,Loader:CV},Symbol.toStringTag,{value:"Module"}));/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 *//*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var Fzt=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],_te=Fzt.join(","),WUe=typeof Element>"u",yD=WUe?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,$V=!WUe&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t==null?void 0:t.ownerDocument},AV=function t(e,i){var r;i===void 0&&(i=!0);var s=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"inert"),n=s===""||s==="true",o=n||i&&e&&t(e.parentNode);return o},kzt=function(e){var i,r=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"contenteditable");return r===""||r==="true"},zzt=function(e,i,r){if(AV(e))return[];var s=Array.prototype.slice.apply(e.querySelectorAll(_te));return i&&yD.call(e,_te)&&s.unshift(e),s=s.filter(r),s},Uzt=function t(e,i,r){for(var s=[],n=Array.from(e);n.length;){var o=n.shift();if(!AV(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=t(l,!0,r);r.flatten?s.push.apply(s,c):s.push({scopeParent:o,candidates:c})}else{var h=yD.call(o,_te);h&&r.filter(o)&&(i||!e.includes(o))&&s.push(o);var d=o.shadowRoot||typeof r.getShadowRoot=="function"&&r.getShadowRoot(o),f=!AV(d,!1)&&(!r.shadowRootFilter||r.shadowRootFilter(o));if(d&&f){var m=t(d===!0?o.children:d.children,!0,r);r.flatten?s.push.apply(s,m):s.push({scopeParent:o,candidates:m})}else n.unshift.apply(n,o.children)}}return s},ZUe=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},YUe=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||kzt(e))&&!ZUe(e)?0:e.tabIndex},Bzt=function(e,i){var r=YUe(e);return r<0&&i&&!ZUe(e)?0:r},Vzt=function(e,i){return e.tabIndex===i.tabIndex?e.documentOrder-i.documentOrder:e.tabIndex-i.tabIndex},JUe=function(e){return e.tagName==="INPUT"},jzt=function(e){return JUe(e)&&e.type==="hidden"},Gzt=function(e){var i=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(r){return r.tagName==="SUMMARY"});return i},Hzt=function(e,i){for(var r=0;r<e.length;r++)if(e[r].checked&&e[r].form===i)return e[r]},qzt=function(e){if(!e.name)return!0;var i=e.form||$V(e),r=function(a){return i.querySelectorAll('input[type="radio"][name="'+a+'"]')},s;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")s=r(window.CSS.escape(e.name));else try{s=r(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var n=Hzt(s,e.form);return!n||n===e},Wzt=function(e){return JUe(e)&&e.type==="radio"},Zzt=function(e){return Wzt(e)&&!qzt(e)},Yzt=function(e){var i,r=e&&$V(e),s=(i=r)===null||i===void 0?void 0:i.host,n=!1;if(r&&r!==e){var o,a,l;for(n=!!((o=s)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(s)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!n&&s;){var c,h,d;r=$V(s),s=(c=r)===null||c===void 0?void 0:c.host,n=!!((h=s)!==null&&h!==void 0&&(d=h.ownerDocument)!==null&&d!==void 0&&d.contains(s))}}return n},g1e=function(e){var i=e.getBoundingClientRect(),r=i.width,s=i.height;return r===0&&s===0},Jzt=function(e,i){var r=i.displayCheck,s=i.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var n=yD.call(e,"details>summary:first-of-type"),o=n?e.parentElement:e;if(yD.call(o,"details:not([open]) *"))return!0;if(!r||r==="full"||r==="legacy-full"){if(typeof s=="function"){for(var a=e;e;){var l=e.parentElement,c=$V(e);if(l&&!l.shadowRoot&&s(l)===!0)return g1e(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=a}if(Yzt(e))return!e.getClientRects().length;if(r!=="legacy-full")return!0}else if(r==="non-zero-area")return g1e(e);return!1},Xzt=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var i=e.parentElement;i;){if(i.tagName==="FIELDSET"&&i.disabled){for(var r=0;r<i.children.length;r++){var s=i.children.item(r);if(s.tagName==="LEGEND")return yD.call(i,"fieldset[disabled] *")?!0:!s.contains(e)}return!0}i=i.parentElement}return!1},Kzt=function(e,i){return!(i.disabled||AV(i)||jzt(i)||Jzt(i,e)||Gzt(i)||Xzt(i))},y1e=function(e,i){return!(Zzt(i)||YUe(i)<0||!Kzt(e,i))},Qzt=function(e){var i=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(i)||i>=0)},eUt=function t(e){var i=[],r=[];return e.forEach(function(s,n){var o=!!s.scopeParent,a=o?s.scopeParent:s,l=Bzt(a,o),c=o?t(s.candidates):a;l===0?o?i.push.apply(i,c):i.push(a):r.push({documentOrder:n,tabIndex:l,item:s,isScope:o,content:c})}),r.sort(Vzt).reduce(function(s,n){return n.isScope?s.push.apply(s,n.content):s.push(n.content),s},[]).concat(i)},tUt=function(e,i){i=i||{};var r;return i.getShadowRoot?r=Uzt([e],i.includeContainer,{filter:y1e.bind(null,i),flatten:!1,getShadowRoot:i.getShadowRoot,shadowRootFilter:Qzt}):r=zzt(e,i.includeContainer,y1e.bind(null,i)),eUt(r)};const XUe={getShadowRoot:!0};function Ymi(t){return t?t.id=t.id||`${t.tagName.toLowerCase()}-${vT()}`:""}function Jmi(t){return Array.isArray(t)?t:Array.from(t)}function Xmi(t){const e=_T(t,`.${pP.darkMode}, .${pP.lightMode}, .${pP.autoMode}`);return e!=null&&e.classList.contains("calcite-mode-dark")||e!=null&&e.classList.contains("calcite-mode-auto")&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function YL(t){const e="dir",i=`[${e}]`,r=_T(t,i);return r?r.getAttribute(e):"ltr"}function lH(t){return t.getRootNode()}function Kmi(t){const e=lH(t);return"host"in e?e:null}function KUe(t){return t.host||null}function cH(t,{selector:e,id:i}){if(!t)return null;t.assignedSlot&&(t=t.assignedSlot);const r=lH(t);return(i?"getElementById"in r?r.getElementById(i):null:e?r.querySelector(e):null)||cH(KUe(r),{selector:e,id:i})}function _T(t,e){return t?t.closest(e)||_T(KUe(lH(t)),e):null}function iUt(t){return typeof(t==null?void 0:t.setFocus)=="function"}async function vD(t){if(t)return iUt(t)?t.setFocus():t.focus()}function QUe(t){if(t)return tUt(t,XUe)[0]??t}function uH(t){var e;(e=QUe(t))==null||e.focus()}function Qmi(t,e){return Array.from(t.children).filter(i=>i.matches(e))}function rUt(t,e){return t.filter(i=>i.matches(e))}function LA(t,e,i){if(typeof e=="string"&&e!=="")return e;if(e===""||e===!0)return t[i]}function hH(t){return(!!t).toString()}function sUt(t){return Os(t)||aUt(t)}function nUt(t){return lUt(t).filter(e=>e.nodeType===Node.TEXT_NODE).map(e=>e.textContent).join("").trim()}function oUt(t){var e;for(const i of t.childNodes)if(i.nodeType===Node.TEXT_NODE&&((e=i.textContent)==null?void 0:e.trim())!==""||i.nodeType===Node.ELEMENT_NODE)return!0;return!1}function aUt(t){return!!nUt(t)}function lUt(t){return t.currentTarget.assignedNodes({flatten:!0})}function Os(t){return!!bte(t).length}function bte(t,e){return cUt(t.target,e)}function cUt(t,e){const i=t.assignedElements({flatten:!0});return e?rUt(i,e):i}function uUt(t){return!!(t.isPrimary&&t.button===0)}function hUt(t){return t.detail===0}const t4=(t,e,i,r=!0)=>{const s=t.indexOf(e),n=s===0,o=s===t.length-1;r&&(i=i==="previous"&&n?"last":i==="next"&&o?"first":i);let a;return i==="previous"?a=t[s-1]||t[r?t.length-1:s]:i==="next"?a=t[s+1]||t[r?0:s]:i==="last"?a=t[t.length-1]:a=t[0],vD(a),a};function dUt(t,e){if(t.parentNode!==e.parentNode)return!1;const i=Array.from(t.parentNode.children);return i.indexOf(t)<i.indexOf(e)}async function egi(t,e,i,r){return eBe(t,e,"animation",i,r)}async function pUt(t,e,i,r){return eBe(t,e,"transition",i,r)}async function fUt(t,e){await wte(),t==null||t(),await wte(),e==null||e()}function v1e(t,e,i){const r=e==="transition"?"transitionProperty":"animationName";return t.getAnimations().find(s=>s[r]===i)}async function eBe(t,e,i,r,s){let n=v1e(t,i,e);if(n||(await wte(),n=v1e(t,i,e)),!n)return fUt(r,s);r==null||r();try{await n.finished}catch{}finally{s==null||s()}}function wte(){return new Promise(t=>requestAnimationFrame(()=>t()))}function tgi(t){switch(!0){case t.endsWith("px"):return parseFloat(t);case t.endsWith("vw"):return window.innerWidth/100*parseFloat(t);case t.endsWith("vh"):return window.innerHeight/100*parseFloat(t);default:return 0}}/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */function Tf(t,e,i){const r=mUt(t);return new r(e,i)}function mUt(t){class e extends window.MutationObserver{constructor(r){super(r),this.observedEntry=[],this.callback=r}observe(r,s){return this.observedEntry.push({target:r,options:s}),super.observe(r,s)}unobserve(r){const s=this.observedEntry.filter(n=>n.target!==r);this.observedEntry=[],this.callback(super.takeRecords(),this),this.disconnect(),s.forEach(n=>this.observe(n.target,n.options))}}return function(){return t==="intersection"?window.IntersectionObserver:t==="mutation"?e:window.ResizeObserver}()}/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const _1e=new Set,b1e={trace:0,debug:1,info:2,warn:4,error:8,off:10};function gUt(t){return b1e[t]>=b1e[Yot]}function J2(t,...e){if(!gUt(t))return;console[t].call(this,"%ccalcite","background: #007AC2; color: #fff; border-radius: 4px; padding: 2px 4px;",...e)}let W7;const tBe={debug:t=>J2("debug",t),info:t=>J2("info",t),warn:t=>J2("warn",t),error:t=>J2("error",t),trace:t=>J2("trace",t),deprecated:yUt};function yUt(t,{component:e,name:i,suggested:r,removalVersion:s}){const n=`${t}:${t==="component"?"":e}${i}`;if(_1e.has(n))return;_1e.add(n);const o=Array.isArray(r);o&&!W7&&(W7=new Intl.ListFormat("en",{style:"long",type:"disjunction"}));const a=`[${i}] ${t} is deprecated and will be removed in ${s==="future"?"a future version":`v${s}`}.${r?` Use ${o?W7.format(r.map(l=>`"${l}"`)):`"${r}"`} instead.`:""}`;J2("warn",a)}/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const vUt={flipRtl:"flip-rtl"},iBe={},Z7={},rBe={s:16,m:24,l:32};function sBe({icon:t,scale:e}){const i=rBe[e],r=wUt(t),s=r.charAt(r.length-1)==="F";return`${s?r.substring(0,r.length-1):r}${i}${s?"F":""}`}async function _Ut(t){const e=sBe(t),i=nBe(e);if(i)return i;Z7[e]||(Z7[e]=fetch(PIe(`./assets/icon/${e}.json`)).then(s=>s.json()).catch(()=>(tBe.error(`${t.icon} (${t.scale}) icon failed to load`),"")));const r=await Z7[e];return iBe[e]=r,r}function bUt(t){return nBe(sBe(t))}function nBe(t){return iBe[t]}function wUt(t){const e=!isNaN(Number(t.charAt(0))),i=t.split("-");if(i.length>0){const s=/[a-z]/i;t=i.map((n,o)=>n.replace(s,function(l,c){return o===0&&c===0?l:l.toUpperCase()})).join("")}return e?`i${t}`:t}const xUt=Ks`:host{display:inline-flex;color:var(--calcite-icon-color, var(--calcite-ui-icon-color, currentColor))}:host([scale=s]){inline-size:16px;block-size:16px;min-inline-size:16px;min-block-size:16px}:host([scale=m]){inline-size:24px;block-size:24px;min-inline-size:24px;min-block-size:24px}:host([scale=l]){inline-size:32px;block-size:32px;min-inline-size:32px;min-block-size:32px}.flip-rtl{transform:scaleX(-1)}.svg{display:block}:host([hidden]){display:none}[hidden]{display:none}`,dj=class dj extends Hn{constructor(){super(...arguments),this.visible=!1,this.flipRtl=!1,this.icon=null,this.preload=!1,this.scale="m"}connectedCallback(){if(super.connectedCallback(),this.preload){this.visible=!0,this.loadIconPathData();return}this.visible||this.waitUntilVisible(()=>{this.visible=!0,this.loadIconPathData()})}willUpdate(e){(e.has("icon")&&(this.hasUpdated||this.icon!==null)||e.has("scale")&&(this.hasUpdated||this.scale!=="m"))&&this.loadIconPathData()}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this.intersectionObserver)==null||e.disconnect(),this.intersectionObserver=null}async loadIconPathData(){const{icon:e,scale:i,visible:r}=this;if(!e||!r)return;const s={icon:e,scale:i},n=bUt(s)||await _Ut(s);e===this.icon&&(this.pathData=n)}waitUntilVisible(e){if(this.intersectionObserver=Tf("intersection",i=>{i.forEach(r=>{r.isIntersecting&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null,e())})},{rootMargin:"50px"}),!this.intersectionObserver){e();return}this.intersectionObserver.observe(this.el)}render(){const{el:e,flipRtl:i,pathData:r,scale:s,textLabel:n}=this,o=YL(e),a=rBe[s],l=!!n,c=[].concat(r||"");return this.el.ariaHidden=hH(!l),this.el.ariaLabel=l?n:null,this.el.role=l?"img":null,ce`<svg aria-hidden=true class=${ge({[vUt.flipRtl]:o==="rtl"&&i,svg:!0})} fill=currentColor height=100% viewBox=${`0 0 ${a} ${a}`} width=100% xmlns=http://www.w3.org/2000/svg>${c.map(h=>typeof h=="string"?t3`<path d=${h??Ke} />`:t3`<path d=${h.d??Ke} opacity=${("opacity"in h?h.opacity:1)??Ke} />`)}</svg>`}};dj.properties={pathData:[16,{},{state:!0}],visible:[16,{},{state:!0}],flipRtl:[7,{},{reflect:!0,type:Boolean}],icon:[3,{},{reflect:!0}],preload:[7,{},{reflect:!0,type:Boolean}],scale:[3,{},{reflect:!0}],textLabel:1},dj.styles=xUt;let MV=dj;Io("calcite-icon",MV);const oBe=Object.freeze(Object.defineProperty({__proto__:null,Icon:MV},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const zP=(t,e)=>{var r;const i=t._$AN;if(i===void 0)return!1;for(const s of i)(r=s._$AO)==null||r.call(s,e,!1),zP(s,e);return!0},OV=t=>{let e,i;do{if((e=t._$AM)===void 0)break;i=e._$AN,i.delete(t),t=e}while((i==null?void 0:i.size)===0)},aBe=t=>{for(let e;e=t._$AM;t=e){let i=e._$AN;if(i===void 0)e._$AN=i=new Set;else if(i.has(t))break;i.add(t),EUt(e)}};function SUt(t){this._$AN!==void 0?(OV(this),this._$AM=t,aBe(this)):this._$AM=t}function TUt(t,e=!1,i=0){const r=this._$AH,s=this._$AN;if(s!==void 0&&s.size!==0)if(e)if(Array.isArray(r))for(let n=i;n<r.length;n++)zP(r[n],!1),OV(r[n]);else r!=null&&(zP(r,!1),OV(r));else zP(this,t)}const EUt=t=>{t.type==zy.CHILD&&(t._$AP??(t._$AP=TUt),t._$AQ??(t._$AQ=SUt))};class CUt extends fL{constructor(){super(...arguments),this._$AN=void 0}_$AT(e,i,r){super._$AT(e,i,r),aBe(this),this.isConnected=e._$AU}_$AO(e,i=!0){var r,s;e!==this.isConnected&&(this.isConnected=e,e?(r=this.reconnected)==null||r.call(this):(s=this.disconnected)==null||s.call(this)),i&&(zP(this,e),OV(this))}setValue(e){if(CIe(this._$Ct))this._$Ct._$AI(e,this);else{const i=[...this._$Ct._$AH];i[this._$Ci]=e,this._$Ct._$AI(i,this,0)}}disconnected(){}reconnected(){}}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Yc=()=>new $Ut;class $Ut{}const Y7=new WeakMap,xr=pL(class extends CUt{render(t){return Ke}update(t,[e]){var r;const i=e!==this.G;return i&&this.G!==void 0&&this.rt(void 0),(i||this.lt!==this.ct)&&(this.G=e,this.ht=(r=t.options)==null?void 0:r.host,this.rt(this.ct=t.element)),Ke}rt(t){if(this.isConnected||(t=void 0),typeof this.G=="function"){const e=this.ht??globalThis;let i=Y7.get(e);i===void 0&&(i=new WeakMap,Y7.set(e,i)),i.get(this.G)!==void 0&&this.G.call(this.ht,void 0),i.set(this.G,t),t!==void 0&&this.G.call(this.ht,t)}else this.G.value=t}get lt(){var t,e;return typeof this.G=="function"?(t=Y7.get(this.ht??globalThis))==null?void 0:t.get(this.G):(e=this.G)==null?void 0:e.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}});/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ile=Symbol.for(""),AUt=t=>{if((t==null?void 0:t.r)===Ile)return t==null?void 0:t._$litStatic$},MUt=t=>({_$litStatic$:t,r:Ile}),_D=(t,...e)=>({_$litStatic$:e.reduce((i,r,s)=>i+(n=>{if(n._$litStatic$!==void 0)return n._$litStatic$;throw Error(`Value passed to 'literal' function must be a 'literal' result: ${n}. Use 'unsafeStatic' to pass non-literal values, but
            take care to ensure page security.`)})(r)+t[s+1],t[0]),r:Ile}),w1e=new Map,OUt=t=>(e,...i)=>{const r=i.length;let s,n;const o=[],a=[];let l,c=0,h=!1;for(;c<r;){for(l=e[c];c<r&&(n=i[c],(s=AUt(n))!==void 0);)l+=s+e[++c],h=!0;c!==r&&a.push(n),o.push(l),c++}if(c===r&&o.push(e[r]),h){const d=o.join("$$lit$$");(e=w1e.get(d))===void 0&&(o.raw=o,w1e.set(d,e=o)),i=a}return t(e,...i)},Rle=OUt(ce);/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const IUt=["calcite-input","calcite-input-number","calcite-input-text","calcite-text-area"];function RUt(t){return`${t.split("-").map((r,s)=>s===0?r:`${r[0].toUpperCase()}${r.slice(1)}`).join("")}${IUt.includes(t)?"Input":"Change"}`}const xte="hidden-form-input";function Ple(t){return"checked"in t}const Ste=new WeakMap,Dle=new WeakSet;function PUt(t,e){if(_T(e.parentElement,"[form]"))return!0;const r="calciteInternalFormComponentRegister";let s=!1;return t.addEventListener(r,n=>{s=n.composedPath().some(o=>Dle.has(o)),n.stopPropagation()},{once:!0}),e.dispatchEvent(new CustomEvent(r,{bubbles:!0,composed:!0})),s}function DUt(t,{status:e,message:i,icon:r}){"status"in t&&(t.status=e),"validationIcon"in t&&typeof t.validationIcon!="string"&&(t.validationIcon=r),"validationMessage"in t&&!t.validationMessage&&(t.validationMessage=i)}function lBe(t){return t.nodeName==="CALCITE-RADIO-BUTTON"?_T(t,"calcite-radio-button-group"):t}const LUt=new CustomEvent("calciteInvalid",{bubbles:!0,composed:!0});function x1e(t){var a;const e=t==null?void 0:t.target,i=e==null?void 0:e.validationMessage,r=lBe(e==null?void 0:e.parentElement);if(!r)return;const s=(a=r==null?void 0:r.nodeName)==null?void 0:a.toLowerCase(),n=s==null?void 0:s.split("-");if(n.length<2||n[0]!=="calcite")return;t==null||t.preventDefault(),"validity"in r&&(r.validity=e==null?void 0:e.validity),r.dispatchEvent(LUt),DUt(r,{message:i,icon:!0,status:"invalid"});const o=RUt(s);r.addEventListener(o,()=>{"status"in r&&(r.status="idle"),"validationIcon"in r&&(r.validationIcon===""||r.validationIcon===!0)&&(r.validationIcon=!1),"validationMessage"in r&&r.validationMessage===i&&(r.validationMessage=""),"validity"in r&&(r.validity=e==null?void 0:e.validity)},{once:!0})}function cBe(t){const{formEl:e}=t;return e?(e.addEventListener("invalid",x1e,!0),e.requestSubmit(),e.removeEventListener("invalid",x1e,!0),requestAnimationFrame(()=>{const i=e.querySelectorAll("[status=invalid]");for(const r of i)if(r!=null&&r.validationMessage){r==null||r.setFocus();break}}),!0):!1}function NUt(t){var e;(e=t.formEl)==null||e.reset()}function FUt(t){const{el:e,value:i}=t,r=uBe(t);if(!r||PUt(r,e))return;t.formEl=r,t.defaultValue=i,Ple(t)&&(t.defaultChecked=t.checked);const s=kUt.bind(t);r.addEventListener("reset",s),Ste.set(t.el,s),Dle.add(e)}function uBe(t){const{el:e,form:i}=t;return i?cH(e,{id:i}):_T(e,"form")}function kUt(){var t;if("status"in this&&(this.status="idle"),"validationIcon"in this&&(this.validationIcon=!1),"validationMessage"in this&&(this.validationMessage=""),Ple(this)){this.checked=this.defaultChecked;return}this.value=this.defaultValue,(t=this.onFormReset)==null||t.call(this)}function zUt(t){const{el:e,formEl:i}=t;if(!i)return;const r=Ste.get(e);i.removeEventListener("reset",r),Ste.delete(e),t.formEl=null,Dle.delete(e)}const Tte="calciteInternalHiddenInputInput",hBe=t=>{t.target.dispatchEvent(new CustomEvent(Tte,{bubbles:!0}))},S1e=t=>t.removeEventListener("input",hBe);function UUt(t){const{el:e,formEl:i,name:r,value:s}=t,{ownerDocument:n}=e,o=e.querySelectorAll(`input[slot="${xte}"]`);if(!i||!r){o.forEach(d=>{S1e(d),d.remove()});return}const a=Array.isArray(s)?s:[s],l=[],c=new Set;o.forEach(d=>{const f=a.find(m=>m==d.value);f!=null?(c.add(f),T1e(t,d,f)):l.push(d)});let h;a.forEach(d=>{if(c.has(d))return;let f=l.pop();f||(f=n.createElement("input"),f.ariaHidden="true",f.slot=xte),h||(h=n.createDocumentFragment()),h.append(f),f.addEventListener("input",hBe),T1e(t,f,d)}),h&&e.append(h),l.forEach(d=>{S1e(d),d.remove()})}function T1e(t,e,i){var c;const{defaultValue:r,disabled:s,form:n,name:o,required:a}=t;e.defaultValue=r,e.disabled=s,e.name=o,e.required=a,e.tabIndex=-1,n?e.setAttribute("form",n):e.removeAttribute("form"),Ple(t)?(e.checked=t.checked,e.defaultChecked=t.defaultChecked,e.value=t.checked?i||"on":""):e.value=i||"",(c=t.syncHiddenFormInput)==null||c.call(t,e);const l=lBe(t.el);if(l&&"validity"in l)for(const h in{...e==null?void 0:e.validity})l.validity[h]=e.validity[h]}const BUt=({component:t})=>(UUt(t),ce`<slot name=${xte}></slot>`);/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */function VUt(){const{disabled:t}=this;t||HTMLElement.prototype.click.call(this)}function dBe(t){t.target.disabled&&t.preventDefault()}const pBe=["mousedown","mouseup","click"];function fBe(t){t.target.disabled&&(t.stopImmediatePropagation(),t.preventDefault())}const IV={capture:!0};function Cg(t){if(t.disabled){t.el.setAttribute("aria-disabled","true"),t.el.contains(document.activeElement)&&document.activeElement.blur(),jUt(t);return}HUt(t),t.el.removeAttribute("aria-disabled")}function jUt(t){t.el.click=VUt,GUt(t.el)}function GUt(t){t.addEventListener("pointerdown",dBe,IV),pBe.forEach(e=>t.addEventListener(e,fBe,IV))}function HUt(t){delete t.el.click,qUt(t.el)}function qUt(t){t.removeEventListener("pointerdown",dBe,IV),pBe.forEach(e=>t.removeEventListener(e,fBe,IV))}const WUt={container:"interaction-container"},$g=({children:t,disabled:e})=>ce`<div class=${ge(WUt.container)} .inert=${e}>${t}</div>`;/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const mBe="calciteInternalLabelClick",Lle="calciteInternalLabelConnected",Ete="calciteInternalLabelDisconnected",E1e="calcite-label",NA=new WeakMap,UP=new WeakMap,bD=new WeakMap,RV=new WeakMap,cS=new Set,ZUt=t=>{const{id:e}=t,i=e&&cH(t,{selector:`${E1e}[for="${e}"]`});if(i)return i;const r=_T(t,E1e);return!r||YUt(r,t)?null:r};function YUt(t,e){let i;const r="custom-element-ancestor-check",s=o=>{o.stopImmediatePropagation();const a=o.composedPath();i=a.slice(a.indexOf(e),a.indexOf(t))};return t.addEventListener(r,s,{once:!0}),e.dispatchEvent(new CustomEvent(r,{composed:!0,bubbles:!0})),t.removeEventListener(r,s),i.filter(o=>o!==e&&o!==t).filter(o=>{var a;return(a=o.tagName)==null?void 0:a.includes("-")}).length>0}function dH(t){if(!t)return;const e=ZUt(t.el);if(UP.has(e)&&e===t.labelEl||!e&&cS.has(t))return;const i=XUt.bind(t);if(e){t.labelEl=e;const r=NA.get(e)||[];r.push(t),NA.set(e,r.sort(yBe)),UP.has(t.labelEl)||(UP.set(t.labelEl,C1e),t.labelEl.addEventListener(mBe,C1e)),cS.delete(t),document.removeEventListener(Lle,bD.get(t)),RV.set(t,i),document.addEventListener(Ete,i)}else cS.has(t)||(i(),document.removeEventListener(Ete,RV.get(t)))}function gBe(t){if(!t||(cS.delete(t),document.removeEventListener(Lle,bD.get(t)),document.removeEventListener(Ete,RV.get(t)),bD.delete(t),RV.delete(t),!t.labelEl))return;const e=NA.get(t.labelEl);e.length===1&&(t.labelEl.removeEventListener(mBe,UP.get(t.labelEl)),UP.delete(t.labelEl)),NA.set(t.labelEl,e.filter(i=>i!==t).sort(yBe)),t.labelEl=null}function yBe(t,e){return dUt(t.el,e.el)?-1:1}function Cte(t){var e,i;return t.label||((i=(e=t.labelEl)==null?void 0:e.textContent)==null?void 0:i.trim())||""}function C1e(t){const e=t.detail.sourceEvent.target,i=NA.get(this),r=i.find(o=>o.el===e);if(i.includes(r))return;const n=i[0];n.disabled||n.onLabelClick(t)}function JUt(){cS.has(this)&&dH(this)}function XUt(){cS.add(this);const t=bD.get(this)||JUt.bind(this);bD.set(this,t),document.addEventListener(Lle,t)}async function igi(t){var r;if(await t.componentOnReady(),NA.has(t))return;const i=(r=t.ownerDocument)==null?void 0:r.getElementById(t.for);i&&requestAnimationFrame(()=>{for(const s of cS)if(s.el===i){dH(s);break}})}/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */function Ya(t){return t==="l"?"m":"s"}async function yh(t){await t.componentOnReady(),await t.updateComplete}/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const Su={buttonLoader:"calcite-button--loader",content:"content",contentSlotted:"content--slotted",icon:"icon",iconStart:"icon--start",iconEnd:"icon--end",loadingIn:"loading-in",loadingOut:"loading-out",iconStartEmpty:"icon-start-empty",iconEndEmpty:"icon-end-empty",buttonPadding:"button-padding",buttonPaddingShrunk:"button-padding--shrunk"},KUt=Ks`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:inline-block;inline-size:auto;vertical-align:middle;border-radius:var(--calcite-button-corner-radius, var(--calcite-internal-button-corner-radius, 0))}:host a,:host button{--calcite-internal-button-content-margin: .5rem;--calcite-internal-button-padding-x: 7px;--calcite-internal-button-padding-y: 3px;position:relative;box-sizing:border-box;display:flex;block-size:100%;inline-size:100%;cursor:pointer;-webkit-user-select:none;user-select:none;appearance:none;align-items:center;justify-content:center;border-style:none;text-align:center;font-family:inherit;font-weight:var(--calcite-font-weight-normal);text-decoration-line:none;outline-color:transparent;background-color:var(--calcite-button-background-color, var(--calcite-internal-button-background-color, var(--calcite-color-transparent)));border-block-start-color:var(--calcite-button-border-color, var(--calcite-internal-button-border-block-start-color, var(--calcite-internal-button-border-color, var(--calcite-color-transparent))));border-block-end-color:var(--calcite-button-border-color, var(--calcite-internal-button-border-block-end-color, var(--calcite-internal-button-border-color, var(--calcite-color-transparent))));border-inline-start-color:var(--calcite-button-border-color, var(--calcite-internal-button-border-inline-start-color, var(--calcite-internal-button-border-color, var(--calcite-color-transparent))));border-inline-end-color:var(--calcite-button-border-color, var(--calcite-internal-button-border-inline-end-color, var(--calcite-internal-button-border-color, var(--calcite-color-transparent))));border-style:solid;border-width:var(--calcite-border-width-sm);box-shadow:inset 0 0 0 0 var(--calcite-button-shadow-color, var(--calcite-internal-button-shadow-color, var(--calcite-color-transparent)));border-radius:var(--calcite-button-corner-radius, var(--calcite-internal-button-corner-radius, 0));color:var(--calcite-button-text-color, var(--calcite-internal-button-text-color, currentColor));padding-block:var(--calcite-internal-button-padding-y);padding-inline:var(--calcite-internal-button-padding-x);transition:color var(--calcite-animation-timing) ease-in-out,background-color var(--calcite-animation-timing) ease-in-out,box-shadow var(--calcite-animation-timing) ease-in-out,outline-color var(--calcite-internal-animation-timing-fast) ease-in-out}:host a:hover,:host button:hover{text-decoration-line:none}:host a:focus,:host button:focus{outline:2px solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline-offset:calc(2px*(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}:host a span,:host button span{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}:host a calcite-loader,:host button calcite-loader{color:var(--calcite-button-loader-color, var(--calcite-internal-button-loader-color, var(--calcite-button-text-color, var(--calcite-internal-button-text-color))))}:host([round]){--calcite-internal-button-corner-radius: 50px}.content{margin-inline:var(--calcite-internal-button-content-margin)}.icon-start-empty .content{margin-inline-start:unset}.icon-end-empty .content{margin-inline-end:unset}:host([scale=m]) button,:host([scale=m]) a{--calcite-internal-button-content-margin: .75rem}:host([scale=l]) button,:host([scale=l]) a{--calcite-internal-button-content-margin: 1rem}:host([width=auto]){inline-size:auto}:host([width=half]){inline-size:50%}:host([width=full]){inline-size:100%}:host([alignment=center]:not([width=auto])) a,:host([alignment=center]:not([width=auto])) button{justify-content:center}:host([alignment=start]:not([width=auto])) a,:host([alignment=start]:not([width=auto])) button{justify-content:flex-start}:host([alignment=end]:not([width=auto])) a,:host([alignment=end]:not([width=auto])) button{justify-content:flex-end}:host([alignment*=space-between]:not([width=auto])) a,:host([alignment*=space-between]:not([width=auto])) button{justify-content:space-between}:host([alignment=icon-start-space-between]:not([width=auto])) .icon--start{margin-inline-end:auto}:host([alignment=icon-start-space-between]:not([width=auto])) a,:host([alignment=icon-start-space-between]:not([width=auto])) button{text-align:unset}:host([alignment=icon-end-space-between]:not([width=auto])) .icon--end{margin-inline-start:auto}:host([alignment=icon-end-space-between]:not([width=auto])) a,:host([alignment=icon-end-space-between]:not([width=auto])) button{text-align:unset}:host([alignment=center]) a:not(.content--slotted) .icon--start+.icon--end,:host([alignment=center]) button:not(.content--slotted) .icon--start+.icon--end{margin-inline-start:var(--calcite-internal-button-content-margin)}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}@keyframes loader-in{0%{inline-size:0;opacity:0;transform:scale(.5)}to{inline-size:1em;opacity:1;transform:scale(1)}}@keyframes loader-out{0%{inline-size:1em;opacity:1;transform:scale(1)}to{inline-size:0;opacity:0;transform:scale(.5)}}.calcite-button--loader{display:flex}.calcite-button--loader calcite-loader{margin:0}:host([loading]) button.content--slotted .calcite-button--loader calcite-loader,:host([loading]) a.content--slotted .calcite-button--loader calcite-loader{margin-inline-end:var(--calcite-internal-button-content-margin)}:host([loading]) button:not(.content--slotted) .icon--start,:host([loading]) button:not(.content--slotted) .icon--end,:host([loading]) a:not(.content--slotted) .icon--start,:host([loading]) a:not(.content--slotted) .icon--end{display:none}:host([appearance]) button,:host([appearance]) a{--calcite-internal-button-border-color: var(--calcite-color-transparent);border-style:solid;border-width:var(--calcite-button-border-size, 1px)}:host([kind=brand]) button,:host([kind=brand]) a{--calcite-internal-button-text-color: var(--calcite-color-text-inverse);--calcite-internal-button-background-color: var(--calcite-color-brand);--calcite-internal-button-loader-color: var(--calcite-color-text-inverse)}:host([kind=brand]) button:hover,:host([kind=brand]) a:hover{--calcite-internal-button-background-color: var(--calcite-color-brand-hover)}:host([kind=brand]) button:active,:host([kind=brand]) a:active{--calcite-internal-button-background-color: var(--calcite-color-brand-press)}:host([kind=danger]) button,:host([kind=danger]) a{--calcite-internal-button-text-color: var(--calcite-color-text-inverse);--calcite-internal-button-background-color: var(--calcite-color-status-danger);--calcite-internal-button-loader-color: var(--calcite-color-text-inverse)}:host([kind=danger]) button:hover,:host([kind=danger]) a:hover{--calcite-internal-button-background-color: var(--calcite-color-status-danger-hover)}:host([kind=danger]) button:active,:host([kind=danger]) a:active{--calcite-internal-button-background-color: var(--calcite-color-status-danger-press)}:host([kind=neutral]) button,:host([kind=neutral]) a{--calcite-internal-button-text-color: var(--calcite-color-text-1);--calcite-internal-button-background-color: var(--calcite-color-foreground-3);--calcite-internal-button-loader-color: var(--calcite-color-text-1)}:host([kind=neutral]) button:hover,:host([kind=neutral]) a:hover{--calcite-internal-button-background-color: var(--calcite-color-foreground-2)}:host([kind=neutral]) button:active,:host([kind=neutral]) a:active{--calcite-internal-button-background-color: var(--calcite-color-foreground-1)}:host([kind=inverse]) button,:host([kind=inverse]) a{--calcite-internal-button-text-color: var(--calcite-color-text-inverse);--calcite-internal-button-background-color: var(--calcite-color-inverse);--calcite-internal-button-loader-color: var(--calcite-color-text-inverse)}:host([kind=inverse]) button:hover,:host([kind=inverse]) a:hover{--calcite-internal-button-background-color: var(--calcite-color-inverse-hover)}:host([kind=inverse]) button:active,:host([kind=inverse]) a:active{--calcite-internal-button-background-color: var(--calcite-color-inverse-press)}:host([appearance=outline-fill]) button,:host([appearance=outline-fill]) a{--calcite-internal-button-background-color: var(--calcite-color-foreground-1);border-style:solid;border-width:var(--calcite-button-border-size, 1px)}:host([appearance=outline-fill]) button:hover,:host([appearance=outline-fill]) a:hover{--calcite-internal-button-background-color: var(--calcite-color-foreground-2)}:host([appearance=outline-fill]) button:active,:host([appearance=outline-fill]) a:active{--calcite-internal-button-background-color: var(--calcite-color-foreground-3)}:host([appearance=outline-fill][kind=brand]) button,:host([appearance=outline-fill][kind=brand]) a{--calcite-internal-button-border-color: var(--calcite-color-brand);--calcite-internal-button-text-color: var(--calcite-color-brand);--calcite-internal-button-loader-color: var(--calcite-color-brand)}:host([appearance=outline-fill][kind=brand]) button:hover,:host([appearance=outline-fill][kind=brand]) a:hover{--calcite-internal-button-border-color: var(--calcite-color-brand-hover);--calcite-internal-button-text-color: var(--calcite-color-brand-hover);--calcite-internal-button-shadow-color: var(--calcite-color-brand-hover)}:host([appearance=outline-fill][kind=brand]) button:focus,:host([appearance=outline-fill][kind=brand]) a:focus{--calcite-internal-button-border-color: var(--calcite-color-brand);--calcite-internal-button-text-color: var(--calcite-color-brand);--calcite-internal-button-shadow-color: var(--calcite-color-brand)}:host([appearance=outline-fill][kind=brand]) button:active,:host([appearance=outline-fill][kind=brand]) a:active{--calcite-internal-button-border-color: var(--calcite-color-brand-press);--calcite-internal-button-text-color: var(--calcite-color-brand-press);--calcite-internal-button-shadow-color: var(--calcite-color-brand-press)}:host([appearance=outline-fill][kind=brand]) button calcite-loader,:host([appearance=outline-fill][kind=brand]) a calcite-loader{--calcite-internal-button-loader-color: var(--calcite-color-brand)}:host([appearance=outline-fill][kind=danger]) button,:host([appearance=outline-fill][kind=danger]) a{--calcite-internal-button-border-color: var(--calcite-color-status-danger);--calcite-internal-button-text-color: var(--calcite-color-status-danger);--calcite-internal-button-loader-color: var(--calcite-color-status-danger)}:host([appearance=outline-fill][kind=danger]) button:hover,:host([appearance=outline-fill][kind=danger]) a:hover{--calcite-internal-button-border-color: var(--calcite-color-status-danger-hover);--calcite-internal-button-text-color: var(--calcite-color-status-danger-hover);--calcite-internal-button-shadow-color: var(--calcite-color-status-danger-hover)}:host([appearance=outline-fill][kind=danger]) button:focus,:host([appearance=outline-fill][kind=danger]) a:focus{--calcite-internal-button-border-color: var(--calcite-color-status-danger);--calcite-internal-button-text-color: var(--calcite-color-status-danger);--calcite-internal-button-shadow-color: var(--calcite-color-status-danger)}:host([appearance=outline-fill][kind=danger]) button:active,:host([appearance=outline-fill][kind=danger]) a:active{--calcite-internal-button-border-color: var(--calcite-color-status-danger-press);--calcite-internal-button-text-color: var(--calcite-color-status-danger-press);--calcite-internal-button-shadow-color: var(--calcite-color-status-danger-press)}:host([appearance=outline-fill][kind=danger]) button calcite-loader,:host([appearance=outline-fill][kind=danger]) a calcite-loader{--calcite-internal-button-loader-color: var(--calcite-color-status-danger)}:host([appearance=outline-fill][kind=neutral]) button,:host([appearance=outline-fill][kind=neutral]) a{--calcite-internal-button-border-color: var(--calcite-color-border-1);--calcite-internal-button-text-color: var(--calcite-color-text-1);--calcite-internal-button-loader-color: var(--calcite-color-text-1)}:host([appearance=outline-fill][kind=neutral]) button:hover,:host([appearance=outline-fill][kind=neutral]) a:hover{--calcite-internal-button-shadow-color: var(--calcite-color-foreground-3);--calcite-internal-button-border-color: var(--calcite-color-border-input)}:host([appearance=outline-fill][kind=neutral]) button:focus,:host([appearance=outline-fill][kind=neutral]) a:focus{--calcite-internal-button-shadow-color: var(--calcite-color-foreground-3)}:host([appearance=outline-fill][kind=neutral]) button:active,:host([appearance=outline-fill][kind=neutral]) a:active{--calcite-internal-button-shadow-color: var(--calcite-color-foreground-3);--calcite-internal-button-border-color: var(--calcite-color-text-3)}:host([appearance=solid][kind=neutral]) button:hover,:host([appearance=solid][kind=neutral]) a:hover{--calcite-internal-button-background-color: var(--calcite-color-border-3)}:host([appearance=solid][kind=neutral]) button:active,:host([appearance=solid][kind=neutral]) a:active{--calcite-internal-button-background-color: var(--calcite-color-border-2)}:host([appearance=outline-fill][kind=inverse]) button,:host([appearance=outline-fill][kind=inverse]) a{--calcite-internal-button-text-color: var(--calcite-color-text-1);--calcite-internal-button-border-color: var(--calcite-color-inverse);--calcite-internal-button-loader-color: var(--calcite-color-text-1)}:host([appearance=outline-fill][kind=inverse]) button:hover,:host([appearance=outline-fill][kind=inverse]) a:hover{--calcite-internal-button-border-color: var(--calcite-color-inverse-hover);--calcite-internal-button-shadow-color: var(--calcite-color-inverse-hover)}:host([appearance=outline-fill][kind=inverse]) button:focus,:host([appearance=outline-fill][kind=inverse]) a:focus{--calcite-internal-button-border-color: var(--calcite-color-inverse);--calcite-internal-button-shadow-color: var(--calcite-color-inverse)}:host([appearance=outline-fill][kind=inverse]) button:active,:host([appearance=outline-fill][kind=inverse]) a:active{--calcite-internal-button-border-color: var(--calcite-color-inverse-press);--calcite-internal-button-shadow-color: var(--calcite-color-inverse-press)}:host([appearance=outline]) button,:host([appearance=outline]) a{--calcite-internal-button-background-color: var(--calcite-color-transparent);border-style:solid;border-width:var(--calcite-button-border-size, 1px)}:host([appearance=outline]) button:hover,:host([appearance=outline]) a:hover{--calcite-internal-button-background-color: var(--calcite-color-transparent-hover)}:host([appearance=outline]) button:active,:host([appearance=outline]) a:active{--calcite-internal-button-background-color: var(--calcite-color-transparent-press)}:host([appearance=outline][kind=brand]) button,:host([appearance=outline][kind=brand]) a{--calcite-internal-button-border-color: var(--calcite-color-brand);--calcite-internal-button-text-color: var(--calcite-color-brand);--calcite-internal-button-loader-color: var(--calcite-color-brand)}:host([appearance=outline][kind=brand]) button:hover,:host([appearance=outline][kind=brand]) a:hover{--calcite-internal-button-border-color: var(--calcite-color-brand-hover);--calcite-internal-button-text-color: var(--calcite-color-brand-hover);--calcite-internal-button-shadow-color: var(--calcite-color-brand-hover)}:host([appearance=outline][kind=brand]) button:focus,:host([appearance=outline][kind=brand]) a:focus{--calcite-internal-button-border-color: var(--calcite-color-brand);--calcite-internal-button-text-color: var(--calcite-color-brand);--calcite-internal-button-shadow-color: var(--calcite-color-brand)}:host([appearance=outline][kind=brand]) button:active,:host([appearance=outline][kind=brand]) a:active{--calcite-internal-button-border-color: var(--calcite-color-brand-press);--calcite-internal-button-text-color: var(--calcite-color-brand-press);--calcite-internal-button-shadow-color: var(--calcite-color-brand-press)}:host([appearance=outline][kind=brand]) button calcite-loader,:host([appearance=outline][kind=brand]) a calcite-loader{--calcite-internal-button-loader-color: var(--calcite-color-brand)}:host([appearance=outline][kind=danger]) button,:host([appearance=outline][kind=danger]) a{--calcite-internal-button-border-color: var(--calcite-color-status-danger);--calcite-internal-button-text-color: var(--calcite-color-status-danger);--calcite-internal-button-loader-color: var(--calcite-color-status-danger)}:host([appearance=outline][kind=danger]) button:hover,:host([appearance=outline][kind=danger]) a:hover{--calcite-internal-button-border-color: var(--calcite-color-status-danger-hover);--calcite-internal-button-text-color: var(--calcite-color-status-danger-hover);--calcite-internal-button-shadow-color: var(--calcite-color-status-danger-hover)}:host([appearance=outline][kind=danger]) button:focus,:host([appearance=outline][kind=danger]) a:focus{--calcite-internal-button-border-color: var(--calcite-color-status-danger);--calcite-internal-button-text-color: var(--calcite-color-status-danger);--calcite-internal-button-shadow-color: var(--calcite-color-status-danger)}:host([appearance=outline][kind=danger]) button:active,:host([appearance=outline][kind=danger]) a:active{--calcite-internal-button-border-color: var(--calcite-color-status-danger-press);--calcite-internal-button-text-color: var(--calcite-color-status-danger-press);--calcite-internal-button-shadow-color: var(--calcite-color-status-danger-press)}:host([appearance=outline][kind=danger]) button calcite-loader,:host([appearance=outline][kind=danger]) a calcite-loader{--calcite-internal-button-loader-color: var(--calcite-color-status-danger)}:host([appearance=outline][kind=neutral]) button,:host([appearance=outline][kind=neutral]) a{--calcite-internal-button-text-color: var(--calcite-color-text-1);--calcite-internal-button-border-color: var(--calcite-color-border-1);--calcite-internal-button-loader-color: var(--calcite-color-text-1)}:host([appearance=outline][kind=neutral]) button:hover,:host([appearance=outline][kind=neutral]) a:hover{--calcite-internal-button-shadow-color: var(--calcite-color-foreground-3);--calcite-internal-button-border-color: var(--calcite-color-border-input)}:host([appearance=outline][kind=neutral]) button:focus,:host([appearance=outline][kind=neutral]) a:focus{--calcite-internal-button-shadow-color: var(--calcite-color-foreground-3)}:host([appearance=outline][kind=neutral]) button:active,:host([appearance=outline][kind=neutral]) a:active{--calcite-internal-button-shadow-color: var(--calcite-color-foreground-3);--calcite-internal-button-border-color: var(--calcite-color-text-3)}:host([appearance=outline][kind=inverse]) button,:host([appearance=outline][kind=inverse]) a{--calcite-internal-button-text-color: var(--calcite-color-text-1);--calcite-internal-button-border-color: var(--calcite-color-inverse);--calcite-internal-button-loader-color: var(--calcite-color-text-1)}:host([appearance=outline][kind=inverse]) button:hover,:host([appearance=outline][kind=inverse]) a:hover{--calcite-internal-button-border-color: var(--calcite-color-inverse-hover);--calcite-internal-button-shadow-color: var(--calcite-color-inverse-hover)}:host([appearance=outline][kind=inverse]) button:focus,:host([appearance=outline][kind=inverse]) a:focus{--calcite-internal-button-border-color: var(--calcite-color-inverse);--calcite-internal-button-shadow-color: var(--calcite-color-inverse)}:host([appearance=outline][kind=inverse]) button:active,:host([appearance=outline][kind=inverse]) a:active{--calcite-internal-button-border-color: var(--calcite-color-inverse-press);--calcite-internal-button-shadow-color: var(--calcite-color-inverse-press)}:host([appearance=outline-fill][split-child=primary]) button,:host([appearance=outline][split-child=primary]) button,:host([appearance=outline-fill][split-child=primary]) a,:host([appearance=outline][split-child=primary]) a{border-inline-end-width:0;border-inline-start-width:1px}:host([appearance=outline-fill][split-child=secondary]) button,:host([appearance=outline][split-child=secondary]) button,:host([appearance=outline-fill][split-child=secondary]) a,:host([appearance=outline][split-child=secondary]) a{border-inline-start-width:0;border-inline-end-width:1px}:host([appearance=transparent]) button,:host([appearance=transparent]) a{--calcite-internal-button-background-color: var(--calcite-color-transparent)}:host([appearance=transparent]) button:hover,:host([appearance=transparent]) button:focus,:host([appearance=transparent]) a:hover,:host([appearance=transparent]) a:focus{--calcite-internal-button-background-color: var(--calcite-color-transparent-hover)}:host([appearance=transparent]) button:active,:host([appearance=transparent]) a:active{--calcite-internal-button-background-color: var(--calcite-color-transparent-press)}:host([appearance=transparent]:not(.enable-editing-button)) button,:host([appearance=transparent]:not(.enable-editing-button)) a{background-color:var(--calcite-color-transparent)}:host([appearance=transparent]:not(.enable-editing-button)) button:hover,:host([appearance=transparent]:not(.enable-editing-button)) a:hover{background-color:var(--calcite-color-transparent-hover)}:host([appearance=transparent]:not(.enable-editing-button)) button:active,:host([appearance=transparent]:not(.enable-editing-button)) a:active{background-color:var(--calcite-color-transparent-press)}:host([appearance=transparent][kind=brand]) button,:host([appearance=transparent][kind=brand]) a{--calcite-internal-button-text-color: var(--calcite-color-brand);--calcite-internal-button-loader-color: var(--calcite-color-brand)}:host([appearance=transparent][kind=brand]) button:hover,:host([appearance=transparent][kind=brand]) a:hover{--calcite-internal-button-text-color: var(--calcite-color-brand-hover)}:host([appearance=transparent][kind=brand]) button:focus,:host([appearance=transparent][kind=brand]) a:focus{--calcite-internal-button-text-color: var(--calcite-color-brand)}:host([appearance=transparent][kind=brand]) button:active,:host([appearance=transparent][kind=brand]) a:active{--calcite-internal-button-text-color: var(--calcite-color-brand-press)}:host([appearance=transparent][kind=brand]) button calcite-loader,:host([appearance=transparent][kind=brand]) a calcite-loader{--calcite-internal-button-loader-color: var(--calcite-color-brand)}:host([appearance=transparent][kind=danger]) button,:host([appearance=transparent][kind=danger]) a{--calcite-internal-button-text-color: var(--calcite-color-status-danger);--calcite-internal-button-loader-color: var(--calcite-color-status-danger)}:host([appearance=transparent][kind=danger]) button:hover,:host([appearance=transparent][kind=danger]) a:hover{--calcite-internal-button-text-color: var(--calcite-color-status-danger-hover)}:host([appearance=transparent][kind=danger]) button:focus,:host([appearance=transparent][kind=danger]) a:focus{--calcite-internal-button-text-color: var(--calcite-color-status-danger)}:host([appearance=transparent][kind=danger]) button:active,:host([appearance=transparent][kind=danger]) a:active{--calcite-internal-button-text-color: var(--calcite-color-status-danger-press)}:host([appearance=transparent][kind=danger]) button calcite-loader,:host([appearance=transparent][kind=danger]) a calcite-loader{--calcite-internal-button-loader-color: var(--calcite-color-status-danger)}:host([appearance=transparent][kind=neutral]:not(.cancel-editing-button)) button,:host([appearance=transparent][kind=neutral]:not(.cancel-editing-button)) a,:host([appearance=transparent][kind=neutral]:not(.cancel-editing-button)) calcite-loader{--calcite-internal-button-text-color: var(--calcite-color-text-1)}:host([appearance=transparent][kind=neutral].cancel-editing-button) button{--calcite-internal-button-text-color: var(--calcite-color-text-3)}:host([appearance=transparent][kind=neutral].cancel-editing-button) button:hover{--calcite-internal-button-text-color: var(--calcite-color-text-1);--calcite-internal-button-padding-y: 0}:host(.confirm-changes-button) button:focus,:host(.cancel-editing-button) button:focus,:host(.enable-editing-button) button:focus{outline-offset:-2px}:host([appearance=transparent][kind=inverse]) button:hover,:host([appearance=transparent][kind=inverse]) a:hover{background-color:var(--calcite-color-transparent-inverse-hover)}:host([appearance=transparent][kind=inverse]) button:active,:host([appearance=transparent][kind=inverse]) a:active{background-color:var(--calcite-color-transparent-inverse-press)}:host([appearance=transparent][kind=inverse]) button calcite-loader,:host([appearance=transparent][kind=inverse]) a calcite-loader{--calcite-internal-button-text-color: var(--calcite-color-text-inverse)}:host([scale=s]) button.content--slotted,:host([scale=s]) a.content--slotted{font-size:var(--calcite-font-size--2);line-height:1rem}:host([scale=s][appearance=transparent]) button.content--slotted,:host([scale=s][appearance=transparent]) a.content--slotted{--calcite-internal-button-padding-x: .5rem}:host([scale=s]) button,:host([scale=s]) a{--calcite-internal-button-padding-y: 3px}:host([scale=m]) button.content--slotted,:host([scale=m]) a.content--slotted{--calcite-internal-button-padding-x: 11px;font-size:var(--calcite-font-size--1);line-height:1rem}:host([scale=m]) button,:host([scale=m]) a{--calcite-internal-button-padding-y: 7px}:host([scale=m][appearance=transparent]) button.content--slotted,:host([scale=m][appearance=transparent]) a.content--slotted{--calcite-internal-button-padding-x: .75rem}:host([scale=l]) button.content--slotted,:host([scale=l]) a.content--slotted{--calcite-internal-button-padding-x: 15px;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=l]) .button-padding{--calcite-internal-button-padding-x: 1rem;--calcite-internal-button-padding-y: 11px}:host([scale=l]) .button-padding--shrunk{--calcite-internal-button-padding-y: 9px}:host([scale=s]) button:not(.content--slotted),:host([scale=s]) a:not(.content--slotted){--calcite-internal-button-padding-x: .125rem;--calcite-internal-button-padding-y: 3px;inline-size:1.5rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-block-size:1.5rem}:host([scale=m]) button:not(.content--slotted),:host([scale=m]) a:not(.content--slotted){--calcite-internal-button-padding-x: .125rem;--calcite-internal-button-padding-y: 7px;inline-size:2rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-block-size:2rem}:host([scale=l]) button:not(.content--slotted),:host([scale=l]) a:not(.content--slotted){--calcite-internal-button-padding-x: .125rem;--calcite-internal-button-padding-y: 9px;inline-size:2.75rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-block-size:2.75rem}:host(:is([scale=s],[scale=m],[scale=l])[width=full]) a:not(.content--slotted),:host(:is([scale=s],[scale=m],[scale=l])[width=full]) button:not(.content--slotted){inline-size:var(--calcite-container-size-content-fluid)}:host([scale=l][appearance=transparent]) button:not(.content--slotted),:host([scale=l][appearance=transparent]) a:not(.content--slotted){--calcite-internal-button-padding-y: .625rem}:host([scale=s][icon-start][icon-end]) button:not(.content--slotted),:host([scale=s][icon-start][icon-end]) a:not(.content--slotted){--calcite-internal-button-padding-x: 23px;block-size:1.5rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=s][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=s][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-internal-button-padding-x: 1.5rem}:host([scale=m][icon-start][icon-end]) button:not(.content--slotted),:host([scale=m][icon-start][icon-end]) a:not(.content--slotted){--calcite-internal-button-padding-x: 2rem;block-size:2rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=m][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=m][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-internal-button-padding-x: 33px}:host([scale=l][icon-start][icon-end]) button:not(.content--slotted),:host([scale=l][icon-start][icon-end]) a:not(.content--slotted){--calcite-internal-button-padding-x: 43px;block-size:2.75rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=l][icon-start][icon-end]) button:not(.content--slotted) .icon--start+.icon--end,:host([scale=l][icon-start][icon-end]) a:not(.content--slotted) .icon--start+.icon--end{margin-inline-start:1rem}:host([scale=l][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=l][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-internal-button-padding-x: 2.75rem}:host([hidden]){display:none}[hidden]{display:none}`,pj=class pj extends Hn{constructor(){super(...arguments),this.attributeWatch=HUe(["aria-expanded"],this.handleGlobalAttributesChanged),this.contentEl=Yc(),this.mutationObserver=Tf("mutation",()=>this.updateHasContent()),this.resizeObserver=Tf("resize",()=>this.setTooltipText()),this.messages=Vd(),this.hasContent=!1,this.alignment="center",this.appearance="solid",this.disabled=!1,this.download=!1,this.kind="brand",this.loading=!1,this.round=!1,this.scale="m",this.splitChild=!1,this.type="button",this.width="auto"}async setFocus(){var e;await yh(this),(e=this.childEl)==null||e.focus()}connectedCallback(){super.connectedCallback(),this.setupTextContentObserver(),dH(this),this.formEl=uBe(this)}async load(){this.updateHasContent()}updated(){Cg(this)}loaded(){this.setTooltipText()}disconnectedCallback(){var e,i;super.disconnectedCallback(),(e=this.mutationObserver)==null||e.disconnect(),gBe(this),(i=this.resizeObserver)==null||i.disconnect(),this.formEl=null}handleGlobalAttributesChanged(){this.requestUpdate()}updateHasContent(){this.hasContent=oUt(this.el)}setupTextContentObserver(){var e;(e=this.mutationObserver)==null||e.observe(this.el,{childList:!0,subtree:!0})}onLabelClick(){this.handleClick(),this.setFocus()}handleClick(){const{type:e}=this;this.href||(e==="submit"?cBe(this):e==="reset"&&NUt(this))}setTooltipText(){const{contentEl:{value:e}}=this;e&&(this.tooltipText=e.offsetWidth<e.scrollWidth&&this.el.innerText||null)}setChildEl(e){var i;this.childEl=e,e&&((i=this.resizeObserver)==null||i.observe(e))}render(){const e=this.href?"a":"button",i=this.href?_D`a`:_D`button`,r=this.loading?ce`<div class=${ge(Su.buttonLoader)}><calcite-loader class=${ge(this.loading?Su.loadingIn:Su.loadingOut)} inline .label=${this.messages.loading} .scale=${this.scale==="l"?"m":"s"}></calcite-loader></div>`:null,s=!this.iconStart&&!this.iconEnd,n=ce`<calcite-icon class=${ge({[Su.icon]:!0,[Su.iconStart]:!0})} .flipRtl=${this.iconFlipRtl==="start"||this.iconFlipRtl==="both"} .icon=${this.iconStart} .scale=${Ya(this.scale)}></calcite-icon>`,o=ce`<calcite-icon class=${ge({[Su.icon]:!0,[Su.iconEnd]:!0})} .flipRtl=${this.iconFlipRtl==="end"||this.iconFlipRtl==="both"} .icon=${this.iconEnd} .scale=${Ya(this.scale)}></calcite-icon>`,a=ce`<span class=${ge(Su.content)} ${xr(this.contentEl)}><slot></slot></span>`;return $g({disabled:this.disabled,children:Rle`<${i} .ariaBusy=${this.loading} .ariaExpanded=${this.el.ariaExpanded?this.el.ariaExpanded:null} .ariaLabel=${this.loading?this.messages.loading:Cte(this)} aria-live=polite class=${ge({[Su.buttonPadding]:s,[Su.buttonPaddingShrunk]:!s,[Su.contentSlotted]:this.hasContent,[Su.iconStartEmpty]:!this.iconStart,[Su.iconEndEmpty]:!this.iconEnd})} .disabled=${e==="button"?this.disabled:null} download=${(e==="a"?this.download===!0||this.download===""?"":this.download||null:null)??Ke} href=${(e==="a"&&this.href)??Ke} name=${(e==="button"&&this.name)??Ke} @click=${this.handleClick} rel=${(e==="a"&&this.rel)??Ke} tabindex=${(this.disabled?-1:null)??Ke} target=${(e==="a"&&this.target)??Ke} title=${this.tooltipText??Ke} type=${(e==="button"?this.type:null)??Ke} ${xr(this.setChildEl)}>${r}${this.iconStart?n:null}${this.hasContent?a:null}${this.iconEnd?o:null}</${i}>`})}};pj.properties={hasContent:[16,{},{state:!0}],tooltipText:[16,{},{state:!0}],alignment:[3,{},{reflect:!0}],appearance:[3,{},{reflect:!0}],disabled:[7,{},{reflect:!0,type:Boolean}],download:[3,{converter:P3},{reflect:!0}],form:[3,{},{reflect:!0}],href:[3,{},{reflect:!0}],iconEnd:[3,{},{reflect:!0}],iconFlipRtl:[3,{},{reflect:!0}],iconStart:[3,{},{reflect:!0}],kind:[3,{},{reflect:!0}],label:1,loading:[7,{},{reflect:!0,type:Boolean}],messageOverrides:[0,{},{attribute:!1}],name:[3,{},{reflect:!0}],rel:[3,{},{reflect:!0}],round:[7,{},{reflect:!0,type:Boolean}],scale:[3,{},{reflect:!0}],splitChild:[3,{},{reflect:!0}],target:[3,{},{reflect:!0}],type:[3,{},{reflect:!0}],width:[3,{},{reflect:!0}]},pj.styles=KUt;let PV=pj;Io("calcite-button",PV);const Nle=Object.freeze(Object.defineProperty({__proto__:null,Button:PV},Symbol.toStringTag,{value:"Module"}));/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const $1e={valid:"check-circle",invalid:"exclamation-mark-triangle",idle:"information"},QUt=Ks`:host{box-sizing:border-box;display:flex;block-size:auto;inline-size:100%;align-items:center;font-weight:var(--calcite-font-weight-medium);color:var(--calcite-color-text-1);opacity:1;transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out;margin-block-start:var(--calcite-input-message-spacing, var(--calcite-input-message-spacing-value, var(--calcite-spacing-xxs)))}.calcite-input-message-icon{pointer-events:none;display:inline-flex;flex-shrink:0;transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out;margin-inline-end:var(--calcite-spacing-sm)}:host([status=invalid]) .calcite-input-message-icon{color:var(--calcite-input-message-icon-color, var(--calcite-icon-color, var(--calcite-color-status-danger)))}:host([status=warning]) .calcite-input-message-icon{color:var(--calcite-input-message-icon-color, var(--calcite-icon-color, var(--calcite-color-status-warning)))}:host([status=valid]) .calcite-input-message-icon{color:var(--calcite-input-message-icon-color, var(--calcite-icon-color, var(--calcite-color-status-success)))}:host([status=idle]) .calcite-input-message-icon{color:var(--calcite-input-message-icon-color, var(--calcite-icon-color, var(--calcite-color-brand)))}:host([scale=s]){font-size:var(--calcite-font-size--3);line-height:.75rem}:host([scale=m]){font-size:var(--calcite-font-size--2);line-height:1rem}:host([scale=l]){font-size:var(--calcite-font-size--1);line-height:1rem}:host([hidden]){display:none}[hidden]{display:none}`,fj=class fj extends Hn{constructor(){super(...arguments),this.iconFlipRtl=!1,this.scale="m",this.status="idle"}connectedCallback(){super.connectedCallback(),this.requestedIcon=LA($1e,this.icon,this.status)}willUpdate(e){(e.has("status")&&(this.hasUpdated||this.status!=="idle")||e.has("icon"))&&(this.requestedIcon=LA($1e,this.icon,this.status))}render(){const e=this.el.hidden;return FG(this.el,"calcite-hydrated-hidden",e),ce`${this.renderIcon(this.requestedIcon)}<slot></slot>`}renderIcon(e){if(e)return ce`<calcite-icon class="calcite-input-message-icon" .flipRtl=${this.iconFlipRtl} .icon=${e} scale=s></calcite-icon>`}};fj.properties={icon:[3,{converter:P3},{reflect:!0}],iconFlipRtl:[7,{},{reflect:!0,type:Boolean}],scale:[3,{},{reflect:!0}],status:[3,{},{reflect:!0}]},fj.styles=QUt;let DV=fj;Io("calcite-input-message",DV);const rgi=Object.freeze(Object.defineProperty({__proto__:null,InputMessage:DV},Symbol.toStringTag,{value:"Module"}));/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const eBt=Ks`:host{position:relative;display:block;inline-size:100%}.track,.bar{position:absolute;inset-block-start:0px;block-size:2px}.track{z-index:var(--calcite-z-index);inline-size:100%;overflow:hidden;background-color:var(--calcite-progress-background-color, var(--calcite-color-border-3))}.bar{z-index:var(--calcite-z-index);background-color:var(--calcite-progress-fill-color, var(--calcite-color-brand))}@media (forced-colors: active){.track{background-color:highlightText}.bar{background-color:linkText}}.indeterminate{inline-size:20%;animation:looping-progress-bar-ani calc(var(--calcite-internal-animation-timing-medium) / var(--calcite-internal-duration-factor) * 11 / var(--calcite-internal-duration-factor)) linear infinite}.indeterminate.calcite--rtl{animation-name:looping-progress-bar-ani-rtl}.reversed{animation-direction:reverse}.text{padding-inline:0px;padding-block:1rem 0px;text-align:center;font-size:var(--calcite-font-size--2);line-height:1rem;font-weight:var(--calcite-font-weight-medium);color:var(--calcite-progress-text-color, var(--calcite-color-text-2))}@keyframes looping-progress-bar-ani{0%{transform:translate3d(-100%,0,0)}50%{inline-size:40%}to{transform:translate3d(600%,0,0)}}@keyframes looping-progress-bar-ani-rtl{0%{transform:translate3d(100%,0,0)}50%{inline-size:40%}to{transform:translate3d(-600%,0,0)}}:host([hidden]){display:none}[hidden]{display:none}`,mj=class mj extends Hn{constructor(){super(...arguments),this.reversed=!1,this.type="determinate",this.value=0}render(){const e=this.type==="determinate",i=e?{width:`${this.value}%`}:{},r=YL(this.el);return ce`<div .ariaLabel=${this.label||this.text} .ariaValueMax=${e?"100":void 0} .ariaValueMin=${e?"0":void 0} .ariaValueNow=${e?this.value:void 0} role=progressbar><div class="track"><div class=${ge({bar:!0,indeterminate:this.type==="indeterminate",[pP.rtl]:r==="rtl",reversed:this.reversed})} style=${OIe(i)}></div></div>${this.text?ce`<div class="text">${this.text}</div>`:null}</div>`}};mj.properties={label:1,reversed:[7,{},{reflect:!0,type:Boolean}],text:1,type:[3,{},{reflect:!0}],value:[9,{},{type:Number}]},mj.styles=eBt;let $te=mj;Io("calcite-progress",$te);/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const er=pL(class extends fL{constructor(){super(...arguments),this.key=Ke}render(t,e){return this.key=t,e}update(t,[e,i]){return e!==this.key&&($Ie(t),this.key=e),i}});/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */function Fle(t){return t==="Enter"||t===" "}const pH=["0","1","2","3","4","5","6","7","8","9"];/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const tBt=new RegExp("\\.(0+)?$"),iBt=new RegExp("0+$"),ts=class ts{constructor(e){if(e instanceof ts)return e;const[i,r]=hBt(e).split(".").concat("");this.value=BigInt(i+r.padEnd(ts.DECIMALS,"0").slice(0,ts.DECIMALS))+BigInt(ts.ROUNDED&&r[ts.DECIMALS]>="5"),this.isNegative=e.charAt(0)==="-"}getIntegersAndDecimals(){const e=this.value.toString().replace("-","").padStart(ts.DECIMALS+1,"0"),i=e.slice(0,-ts.DECIMALS),r=e.slice(-ts.DECIMALS).replace(iBt,"");return{integers:i,decimals:r}}toString(){const{integers:e,decimals:i}=this.getIntegersAndDecimals();return`${this.isNegative?"-":""}${e}${i.length?"."+i:""}`}formatToParts(e){const{integers:i,decimals:r}=this.getIntegersAndDecimals(),s=e.numberFormatter.formatToParts(BigInt(i));return this.isNegative&&s.unshift({type:"minusSign",value:e.minusSign}),r.length&&(s.push({type:"decimal",value:e.decimal}),r.split("").forEach(n=>s.push({type:"fraction",value:n}))),s}format(e){const{integers:i,decimals:r}=this.getIntegersAndDecimals(),s=`${this.isNegative?e.minusSign:""}${e.numberFormatter.format(BigInt(i))}`,n=r.length?`${e.decimal}${r.split("").map(o=>e.numberFormatter.format(Number(o))).join("")}`:"";return`${s}${n}`}add(e){return ts.fromBigInt(this.value+new ts(e).value)}subtract(e){return ts.fromBigInt(this.value-new ts(e).value)}multiply(e){return ts._divRound(this.value*new ts(e).value,ts.SHIFT)}divide(e){return ts._divRound(this.value*ts.SHIFT,new ts(e).value)}};ts.DECIMALS=100,ts.ROUNDED=!0,ts.SHIFT=BigInt("1"+"0".repeat(ts.DECIMALS)),ts._divRound=(e,i)=>ts.fromBigInt(e/i+(ts.ROUNDED?e*BigInt(2)/i%BigInt(2):BigInt(0))),ts.fromBigInt=e=>Object.assign(Object.create(ts.prototype),{value:e,isNegative:e<BigInt(0)});let FA=ts;function Gy(t){return!(!t||isNaN(Number(t)))}function rBt(t){return!t||!dBt(t)?"":LV(t,e=>{let i=!1;const r=e.split("").filter((s,n)=>s.match(/\./g)&&!i?(i=!0,!0):s.match(/-/g)&&n===0?!0:pH.includes(s)).join("");return Gy(r)?new FA(r).toString():""})}const vBe=/^([-0])0+(?=\d)/,sBt=/(?!^\.)\.$/,nBt=/(?!^-)-/g,oBt=/^-\b0\b\.?0*$/,aBt=/0*$/,lBt=new Set(["e","E","-",",",".",...pH]),cBt=t=>{const e=Array.from(t).filter(i=>lBt.has(i)).join("");return LV(e,i=>{const r=i.replace(nBt,"").replace(sBt,"").replace(vBe,"$1");return Gy(r)?oBt.test(r)?r:uBt(r):i})};function uBt(t){const e=t.split(".")[1],i=new FA(t).toString(),[r,s]=i.split(".");return e&&s!==e?`${r}.${e}`:i}function LV(t,e){if(!t)return t;const i=t.toLowerCase().indexOf("e")+1;return i?t.replace(/[eE]*$/g,"").substring(0,i).concat(t.slice(i).replace(/[eE]/g,"")).split(/[eE]/).map((r,s)=>e(s===1?r.replace(/\./g,""):r)).join("e").replace(/^e/,"1e"):e(t)}function hBt(t){const e=t.split(/[eE]/);if(e.length===1)return t;const i=+t;if(Number.isSafeInteger(i))return`${i}`;const r=t.charAt(0)==="-",s=+e[1],n=e[0].split("."),o=(r?n[0].substring(1):n[0])||"",a=n[1]||"",l=(d,f)=>{const m=Math.abs(f)-d.length,g=m>0?`${"0".repeat(m)}${d}`:d;return`${g.slice(0,f)}.${g.slice(f)}`},c=(d,f)=>{const m=f>d.length?`${d}${"0".repeat(f-d.length)}`:d;return`${m.slice(0,f)}.${m.slice(f)}`},h=s>0?`${o}${c(a,s)}`:`${l(o,s)}${a}`;return`${r?"-":""}${h.charAt(0)==="."?"0":""}${h.replace(tBt,"").replace(vBe,"")}`}function dBt(t){return pH.some(e=>t.includes(e))}function pBt(t,e,i){const r=e.split(".")[1];if(r){const s=r.match(aBt)[0];if(s&&i.delocalize(t).length!==e.length&&r.indexOf("e")===-1){const n=i.decimal;return t=t.includes(n)?t:`${t}${n}`,t.padEnd(t.length+s.length,i.localize("0"))}}return t}const NV="en",fBt=["ar","bg","bs","ca","cs","da","de","de-AT","de-CH","el",NV,"en-AU","en-CA","en-GB","es","es-MX","et","fi","fr","fr-CH","he","hi","hr","hu","id","it","it-CH","ja","ko","lt","lv","mk","no","nl","pl","pt","pt-PT","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-CN","zh-HK","zh-TW"];new Map(Object.entries({bg:{am:"..",pm:".."},bs:{am:"prijepodne",pm:"popodne"},ca:{am:"a.m.",pm:"p.m."},cs:{am:"dop.",pm:"odp."},es:{am:"a.m.",pm:"p.m."},"es-mx":{am:"a.m.",pm:"p.m."},"es-MX":{am:"a.m.",pm:"p.m."},fi:{am:"ap.",pm:"ip."},he:{am:"",pm:""},hu:{am:"de. ",pm:"du."},lt:{am:"priepiet",pm:"popiet"},lv:{am:"priekpusdien",pm:"pcpusdien"},mk:{am:".",pm:"."},no:{am:"a.m.",pm:"p.m."},nl:{am:"a.m.",pm:"p.m."},"pt-pt":{am:"da manh",pm:"da tarde"},"pt-PT":{am:"da manh",pm:"da tarde"},ro:{am:"a.m.",pm:"p.m."},sl:{am:"dop.",pm:"pop."},sv:{am:"fm",pm:"em"},th:{am:"",pm:""},tr:{am:"",pm:"S"},uk:{am:"",pm:""},vi:{am:"SA",pm:"CH"}}));const mBt=["arab","arabext","latn"],J7=[...fBt],_Be=t=>mBt.includes(t),X7=new Intl.NumberFormat().resolvedOptions().numberingSystem,bBe=X7==="arab"||!_Be(X7)?"latn":X7,gBt=t=>_Be(t)?t:bBe;function yBt(t){return t?J7.includes(t)?t:(t=t.toLowerCase(),t.includes("-")&&(t=t.replace(/(\w+)-(\w+)/,(e,i,r)=>`${i}-${r.toUpperCase()}`),J7.includes(t)||(t=t.split("-")[0])),t==="nb"||t==="nn"?"no":t==="zh"?"zh-CN":J7.includes(t)?t:(console.warn(`Translations for the "${t}" locale are not available and will fall back to the default, English (en).`),NV)):NV}class vBt{constructor(){this.delocalize=e=>this._numberFormatOptions?LV(e,i=>i.replace(new RegExp(`[${this._minusSign}]`,"g"),"-").replace(new RegExp(`[${this._group}]`,"g"),"").replace(new RegExp(`[${this._decimal}]`,"g"),".").replace(new RegExp(`[${this._digits.join("")}]`,"g"),this._getDigitIndex)):e,this.localize=e=>this._numberFormatOptions?LV(e,i=>Gy(i.trim())?new FA(i.trim()).format(this).replace(new RegExp(`[${this._actualGroup}]`,"g"),this._group):i):e}get group(){return this._group}get decimal(){return this._decimal}get minusSign(){return this._minusSign}get digits(){return this._digits}get numberFormatter(){return this._numberFormatter}get numberFormatOptions(){return this._numberFormatOptions}set numberFormatOptions(e){if(e.locale=yBt(e==null?void 0:e.locale),e.numberingSystem=gBt(e==null?void 0:e.numberingSystem),!this._numberFormatOptions&&e.locale===NV&&e.numberingSystem===bBe&&Object.keys(e).length===2||JSON.stringify(this._numberFormatOptions)===JSON.stringify(e))return;this._numberFormatOptions=e,this._numberFormatter=new Intl.NumberFormat(this._numberFormatOptions.locale,this._numberFormatOptions),this._digits=[...new Intl.NumberFormat(this._numberFormatOptions.locale,{useGrouping:!1,numberingSystem:this._numberFormatOptions.numberingSystem}).format(9876543210)].reverse();const i=new Map(this._digits.map((s,n)=>[s,n])),r=new Intl.NumberFormat(this._numberFormatOptions.locale,{numberingSystem:this._numberFormatOptions.numberingSystem}).formatToParts(-123456789e-1);this._actualGroup=r.find(s=>s.type==="group").value,this._group=this._actualGroup.trim().length===0||this._actualGroup==" "?"":this._actualGroup,this._decimal=e.locale==="bs"||e.locale==="mk"?",":r.find(s=>s.type==="decimal").value,this._minusSign=r.find(s=>s.type==="minusSign").value,this._getDigitIndex=s=>i.get(s)}}const Vh=new vBt;/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const _Bt={validationContainer:"validation-container"},bBt=()=>{},wBt=({scale:t,status:e,id:i,icon:r,message:s,ref:n})=>ce`<div class=${ge(_Bt.validationContainer)} ${xr(n||bBt)}><calcite-input-message aria-live=polite .icon=${r} id=${i??Ke} .scale=${t} .status=${e}>${s}</calcite-input-message></div>`;/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const xBt=["date","datetime-local","month","number","range","time","week"],SBt=["email","password","search","tel","text","url"],TBt=["email","password","search","tel","text","textarea","url"];function CE(t,e,i,r){const s=i.toLowerCase(),n=t[i];r&&n!=null?e.setAttribute(s,`${n}`):e.removeAttribute(s)}function EBt(t,e,i){i.type=t==="textarea"?"text":t;const r=xBt.includes(t),s=e;CE(s,i,"min",r),CE(s,i,"max",r),CE(s,i,"step",r);const n=TBt.includes(t),o=e;CE(o,i,"minLength",n),CE(o,i,"maxLength",n);const a=SBt.includes(t);CE(o,i,"pattern",a)}/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const Da={loader:"loader",clearButton:"clear-button",editingEnabled:"editing-enabled",inlineChild:"inline-child",inputIcon:"icon",prefix:"prefix",suffix:"suffix",numberButtonWrapper:"number-button-wrapper",buttonItemHorizontal:"number-button-item--horizontal",wrapper:"element-wrapper",inputWrapper:"wrapper",actionWrapper:"action-wrapper",numberButtonItem:"number-button-item",hasSuffix:"has-suffix",hasPrefix:"has-prefix"},K7={validationMessage:"inputValidationMessage"},A1e={tel:"phone",password:"lock",email:"email-address",date:"calendar",time:"clock",search:"search"},CBt={action:"action"},$Bt=Ks`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:block}:host([scale=s]) input,:host([scale=s]) .prefix,:host([scale=s]) .suffix{block-size:1.5rem;padding-inline:.5rem;font-size:var(--calcite-font-size--2);line-height:1rem}:host([scale=s]) input[type=file],:host([scale=s]) textarea{min-block-size:1.5rem}:host([scale=s]) .number-button-wrapper,:host([scale=s]) .action-wrapper calcite-button,:host([scale=s]) .action-wrapper calcite-button button{block-size:1.5rem}:host([scale=s]) .clear-button{min-block-size:1.5rem;min-inline-size:1.5rem}:host([scale=s]) textarea{block-size:auto;padding-block:.25rem;padding-inline:.5rem;font-size:var(--calcite-font-size--2);line-height:1rem}:host([scale=m]) input,:host([scale=m]) .prefix,:host([scale=m]) .suffix{block-size:2rem;padding-inline:.75rem;font-size:var(--calcite-font-size--1);line-height:1rem}:host([scale=m]) textarea,:host([scale=m]) input[type=file]{min-block-size:2rem}:host([scale=m]) .number-button-wrapper,:host([scale=m]) .action-wrapper calcite-button,:host([scale=m]) .action-wrapper calcite-button button{block-size:2rem}:host([scale=m]) .clear-button{min-block-size:2rem;min-inline-size:2rem}:host([scale=m]) textarea{block-size:auto;padding-block:.5rem;padding-inline:.75rem;font-size:var(--calcite-font-size--1);line-height:1rem}:host([scale=l]) input,:host([scale=l]) .prefix,:host([scale=l]) .suffix{block-size:2.75rem;padding-inline:1rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=l]) textarea,:host([scale=l]) input[type=file]{min-block-size:2.75rem}:host([scale=l]) .number-button-wrapper,:host([scale=l]) .action-wrapper calcite-button,:host([scale=l]) .action-wrapper calcite-button button{block-size:2.75rem}:host([scale=l]) .clear-button{min-block-size:2.75rem;min-inline-size:2.75rem}:host([scale=l]) textarea{block-size:auto;padding-block:.75rem;padding-inline:1rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([disabled]) textarea{resize:none}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}textarea,input{position:relative;margin:0;box-sizing:border-box;display:flex;max-block-size:100%;inline-size:100%;max-inline-size:100%;flex:1 1 0%;text-overflow:ellipsis;border-width:1px;border-style:solid;font-family:inherit;font-weight:var(--calcite-font-weight-normal);border-color:var(--calcite-input-border-color, var(--calcite-color-border-input));background-color:var(--calcite-input-background-color, var(--calcite-color-foreground-1));color:var(--calcite-input-text-color, var(--calcite-color-text-1));transition:var(--calcite-animation-timing),block-size 0,outline-offset 0s;-webkit-appearance:none}textarea:placeholder-shown,input:placeholder-shown{text-overflow:ellipsis}textarea{border-radius:var(--calcite-input-corner-radius, var(--calcite-corner-radius-sharp))}input{border-start-start-radius:var(--calcite-input-corner-radius, var(--calcite-corner-radius-sharp));border-start-end-radius:var(--calcite-input-corner-radius, var(--calcite-corner-radius-sharp));border-end-start-radius:var(--calcite-input-corner-radius, var(--calcite-corner-radius-sharp));border-end-end-radius:var(--calcite-input-corner-radius, var(--calcite-corner-radius-sharp))}.has-prefix input{border-start-start-radius:0;border-end-start-radius:0}.has-suffix input,.element-wrapper:has(.clear-button) input,:host([number-button-type=vertical][type=number]) input,:host([number-button-type=horizontal]) .has-suffix .suffix,:host([number-button-type=vertical][type=number]) .has-suffix .suffix,:host([number-button-type=vertical][type=number]) .clear-button,:host([number-button-type=horizontal][type=number]) .clear-button{border-start-end-radius:0;border-end-end-radius:0}:host([number-button-type=horizontal]) input{border-start-start-radius:0;border-start-end-radius:0;border-end-start-radius:0;border-end-end-radius:0}.has-prefix .prefix:first-child,:host([number-button-type=horizontal]) .number-button-item[data-adjustment=down]{border-start-start-radius:var(--calcite-input-corner-radius, var(--calcite-corner-radius-sharp));border-end-start-radius:var(--calcite-input-corner-radius, var(--calcite-corner-radius-sharp))}.has-suffix .suffix,:host([number-button-type=vertical][type=number][read-only]) .has-suffix .suffix,:host([clearable]) .clear-button,:host([number-button-type=horizontal]) .number-button-item[data-adjustment=up]{border-end-end-radius:var(--calcite-input-corner-radius, var(--calcite-corner-radius-sharp));border-start-end-radius:var(--calcite-input-corner-radius, var(--calcite-corner-radius-sharp))}:host([clearable]) .has-suffix .clear-button{border-end-end-radius:0;border-start-end-radius:0}:host([number-button-type=vertical]) .number-button-item[data-adjustment=down]{border-block-start-width:0px;border-end-end-radius:var(--calcite-input-corner-radius, var(--calcite-corner-radius-sharp))}:host([number-button-type=vertical]) .number-button-item[data-adjustment=up]{border-start-end-radius:var(--calcite-input-corner-radius, var(--calcite-corner-radius-sharp))}input[type=search]::-webkit-search-decoration{-webkit-appearance:none}input:focus,textarea:focus{border-color:var(--calcite-color-brand);color:var(--calcite-input-text-color, var(--calcite-color-text-1))}input[readonly],textarea[readonly]{font-weight:var(--calcite-font-weight-medium);background-color:var(--calcite-input-background-color, var(--calcite-color-background))}input[readonly]:focus,textarea[readonly]:focus{color:var(--calcite-input-text-color, var(--calcite-color-text-1))}textarea,input{outline-color:transparent}textarea:focus,input:focus{outline:2px solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline-offset:calc(-2px*(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}:host([status=invalid]) input,:host([status=invalid]) textarea{border-color:var(--calcite-color-status-danger)}:host([status=invalid]) input:focus,:host([status=invalid]) textarea:focus{outline:2px solid var(--calcite-color-status-danger);outline-offset:calc(-2px*(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}:host([scale=s]) .icon{inset-inline-start:.5rem}:host([scale=m]) .icon{inset-inline-start:.75rem}:host([scale=l]) .icon{inset-inline-start:1rem}:host([icon][scale=s]) input{padding-inline-start:2rem}:host([icon][scale=m]) input{padding-inline-start:2.5rem}:host([icon][scale=l]) input{padding-inline-start:3.5rem}.element-wrapper{position:relative;order:3;display:inline-flex;flex:1 1 0%;align-items:center}.icon{pointer-events:none;position:absolute;display:block;transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out;color:var(--calcite-input-icon-color, var(--calcite-color-text-3));z-index:var(--calcite-z-index)}input[type=text]::-ms-clear,input[type=text]::-ms-reveal{display:none;block-size:0px;inline-size:0px}input[type=search]::-webkit-search-decoration,input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-results-button,input[type=search]::-webkit-search-results-decoration,input[type=date]::-webkit-clear-button,input[type=time]::-webkit-clear-button{display:none}.clear-button{pointer-events:initial;order:4;margin:0;box-sizing:border-box;display:flex;min-block-size:100%;cursor:pointer;align-items:center;justify-content:center;align-self:stretch;border-width:1px;border-style:solid;outline-color:transparent;transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out;border-color:var(--calcite-input-border-color, var(--calcite-color-border-input));background-color:var(--calcite-input-actions-background-color, var(--calcite-color-foreground-1));border-inline-start-width:0px}.clear-button calcite-icon{transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out;color:var(--calcite-input-actions-icon-color, var(--calcite-color-text-3))}.clear-button:hover{background-color:var(--calcite-input-actions-background-color-hover, var(--calcite-color-foreground-2))}.clear-button:hover calcite-icon{color:var(--calcite-input-actions-icon-color-hover, var(--calcite-color-text-1))}.clear-button:active{background-color:var(--calcite-input-actions-background-color-press, var(--calcite-color-foreground-3))}.clear-button:active calcite-icon{color:var(--calcite-input-actions-icon-color-press, var(--calcite-color-text-1))}.clear-button:focus{outline:2px solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline-offset:calc(-2px*(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}.clear-button:disabled{opacity:var(--calcite-opacity-disabled)}.loader{inset-block-start:1px;inset-inline:1px;pointer-events:none;position:absolute;display:block;--calcite-progress-background-color: var(--calcite-input-loading-background-color);--calcite-progress-fill-color: var(--calcite-input-loading-fill-color)}.action-wrapper{order:7;display:flex}.prefix,.suffix{box-sizing:border-box;display:flex;block-size:auto;min-block-size:100%;-webkit-user-select:none;user-select:none;align-content:center;align-items:center;overflow-wrap:break-word;border-width:1px;border-style:solid;font-weight:var(--calcite-font-weight-medium);line-height:1;border-color:var(--calcite-input-border-color, var(--calcite-color-border-input))}.prefix{order:2;border-inline-end-width:0px;inline-size:var(--calcite-input-prefix-size, auto);background-color:var(--calcite-input-prefix-background-color, var(--calcite-color-background));color:var(--calcite-input-prefix-text-color, var(--calcite-color-text-2))}.suffix{order:5;border-inline-start-width:0px;inline-size:var(--calcite-input-suffix-size, auto);background-color:var(--calcite-input-suffix-background-color, var(--calcite-color-background));color:var(--calcite-input-suffix-text-color, var(--calcite-color-text-2))}:host([alignment=start]) textarea,:host([alignment=start]) input{text-align:start}:host([alignment=end]) textarea,:host([alignment=end]) input{text-align:end}input[type=number]{-moz-appearance:textfield}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{-webkit-appearance:none;-moz-appearance:textfield;margin:0}.number-button-wrapper{pointer-events:none;order:6;box-sizing:border-box;display:flex;flex-direction:column;transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out}:host([number-button-type=vertical]) .wrapper{flex-direction:row;display:flex}:host([number-button-type=vertical]) input,:host([number-button-type=vertical]) textarea{order:2}:host([number-button-type=horizontal]) .calcite--rtl .number-button-item[data-adjustment=down] calcite-icon{transform:rotate(-90deg)}:host([number-button-type=horizontal]) .calcite--rtl .number-button-item[data-adjustment=up] calcite-icon{transform:rotate(-90deg)}.number-button-item.number-button-item--horizontal{border-color:var(--calcite-input-border-color, var(--calcite-color-border-input));order:1;max-block-size:100%;min-block-size:100%;align-self:stretch;border-width:1px;border-style:solid}.number-button-item.number-button-item--horizontal[data-adjustment=down] calcite-icon,.number-button-item.number-button-item--horizontal[data-adjustment=up] calcite-icon{transform:rotate(90deg)}.number-button-item.number-button-item--horizontal[data-adjustment=down]{border-inline-end-width:0px}.number-button-item.number-button-item--horizontal[data-adjustment=up]{border-inline-start-width:0px;order:5}.number-button-item{max-block-size:50%;min-block-size:50%;pointer-events:initial;margin:0;box-sizing:border-box;display:flex;cursor:pointer;align-items:center;align-self:center;border-width:1px;border-style:solid;background-color:var(--calcite-color-foreground-1);padding-block:0px;padding-inline:.5rem;transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out;border-color:var(--calcite-input-border-color, var(--calcite-color-border-input));background-color:var(--calcite-input-actions-background-color, var(--calcite-color-foreground-1));border-inline-start-width:0px}.number-button-item calcite-icon{pointer-events:none;transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out;color:var(--calcite-input-actions-icon-color, var(--calcite-color-text-3))}.number-button-item:hover{background-color:var(--calcite-input-actions-background-color-hover, var(--calcite-color-foreground-2))}.number-button-item:hover calcite-icon{color:var(--calcite-input-actions-icon-color-hover, var(--calcite-color-text-1))}.number-button-item:active{background-color:var(--calcite-input-actions-background-color-press, var(--calcite-color-foreground-3))}.number-button-item:active calcite-icon{color:var(--calcite-input-actions-icon-color-press, var(--calcite-color-text-1))}.number-button-item:disabled{pointer-events:none}.wrapper{position:relative;display:flex;flex-direction:row;align-items:center;border-radius:var(--calcite-input-corner-radius, var(--calcite-corner-radius-sharp));box-shadow:var(--calcite-input-shadow, var(--calcite-shadow-none))}input[type=date]::-webkit-input-placeholder{visibility:hidden!important}:host([type=color]) input{padding:.25rem}:host([type=file]) input{cursor:pointer;border-width:1px;border-style:dashed;background-color:var(--calcite-color-foreground-1);text-align:center;border-color:var(--calcite-input-border-color, var(--calcite-color-border-input));block-size:initial}:host([type=file][scale=s]) input{padding-block:1px;padding-inline:.5rem}:host([type=file][scale=m]) input{padding-block:.25rem;padding-inline:.75rem}:host([type=file][scale=l]) input{padding-block:.5rem;padding-inline:1rem}:host(.no-bottom-border) input{border-block-end-width:0px}:host(.border-top-color-one) input{border-block-start-color:var(--calcite-color-border-1)}input.inline-child{background-color:transparent;transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out}input.inline-child .editing-enabled{background-color:inherit}input.inline-child:not(.editing-enabled){display:flex;cursor:pointer;text-overflow:ellipsis;border-color:transparent;padding-inline-start:0}.validation-container{display:flex;flex-direction:column;align-items:flex-start;align-self:stretch}:host([scale=m]) .validation-container,:host([scale=l]) .validation-container{padding-block-start:.5rem}:host([scale=s]) .validation-container{padding-block-start:.25rem}::slotted(input[slot=hidden-form-input]){margin:0!important;opacity:0!important;outline:none!important;padding:0!important;position:absolute!important;inset:0!important;transform:none!important;-webkit-appearance:none!important;z-index:-1!important}:host([hidden]){display:none}[hidden]{display:none}::placeholder{font-weight:var(--calcite-font-weight-normal);color:var(--calcite-input-placeholder-text-color, var(--calcite-color-text-3))}`,gj=class gj extends Hn{constructor(){super(),this.actionWrapperEl=Yc(),this.attributeWatch=HUe(["autofocus","enterkeyhint","inputmode","spellcheck"],this.handleGlobalAttributesChanged),this.childElType="input",this.inputWrapperEl=Yc(),this.onHiddenFormInputInput=e=>{e.target.name===this.name&&this.setValue({value:e.target.value,origin:"direct"}),this.setFocus(),e.stopPropagation()},this.previousValueOrigin="initial",this.userChangedValue=!1,this._value="",this.messages=Vd(),this.slottedActionElDisabledInternally=!1,this.alignment="start",this.clearable=!1,this.disabled=!1,this.editingEnabled=!1,this.groupSeparator=!1,this.iconFlipRtl=!1,this.loading=!1,this.localeFormat=!1,this.multiple=!1,this.numberButtonType="vertical",this.readOnly=!1,this.required=!1,this.scale="m",this.status="idle",this.type="text",this.validity={valid:!1,badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1},this.calciteInputChange=Gt({cancelable:!1}),this.calciteInputInput=Gt(),this.calciteInternalInputBlur=Gt({cancelable:!1}),this.calciteInternalInputFocus=Gt({cancelable:!1}),this.listen("click",this.clickHandler),this.listen("keydown",this.keyDownHandler)}get value(){return this._value}set value(e){const i=this._value;e!==i&&(this._value=e,this.valueWatcher(e,i),e&&this._value===""&&this.setValue({origin:"reset",value:i}))}async selectText(){var e,i;this.type==="number"?(e=this.childNumberEl)==null||e.select():(i=this.childEl)==null||i.select()}async setFocus(){await yh(this),uH(this.type==="number"?this.childNumberEl:this.childEl)}connectedCallback(){super.connectedCallback(),this.inlineEditableEl=this.el.closest("calcite-inline-editable"),this.inlineEditableEl&&(this.editingEnabled=this.inlineEditableEl.editingEnabled||!1),dH(this),FUt(this),this.el.addEventListener(Tte,this.onHiddenFormInputInput)}async load(){var e,i;this.childElType=this.type==="textarea"?"textarea":"input",this.maxString=(e=this.max)==null?void 0:e.toString(),this.minString=(i=this.min)==null?void 0:i.toString(),this.requestedIcon=LA(A1e,this.icon,this.type),this.setPreviousEmittedValue(this.value),this.setPreviousValue(this.value),this.type==="number"&&(this.value==="Infinity"||this.value==="-Infinity"?(this.displayedValue=this.value,this.previousEmittedValue=this.value):(this.warnAboutInvalidNumberValue(this.value),this.setValue({origin:"connected",value:Gy(this.value)?this.value:""})))}willUpdate(e){var i,r;e.has("max")&&(this.maxString=((i=this.max)==null?void 0:i.toString())||null),e.has("min")&&(this.minString=((r=this.min)==null?void 0:r.toString())||null),(e.has("icon")||e.has("type")&&(this.hasUpdated||this.type!=="text"))&&(this.requestedIcon=LA(A1e,this.icon,this.type))}updated(){Cg(this)}disconnectedCallback(){super.disconnectedCallback(),gBe(this),zUt(this),this.el.removeEventListener(Tte,this.onHiddenFormInputInput)}get isClearable(){var e;return!this.isTextarea&&(this.clearable||this.type==="search")&&((e=this.value)==null?void 0:e.length)>0}get isTextarea(){return this.childElType==="textarea"}handleGlobalAttributesChanged(){this.requestUpdate()}valueWatcher(e,i){if(!this.userChangedValue){if(this.type==="number"&&(e==="Infinity"||e==="-Infinity")){this.displayedValue=e,this.previousEmittedValue=e;return}this.setValue({origin:"direct",previousValue:i,value:e==null||e==""?"":this.type==="number"?Gy(e)?e:this.previousValue||"":e}),this.warnAboutInvalidNumberValue(e)}this.userChangedValue=!1}keyDownHandler(e){this.readOnly||this.disabled||e.defaultPrevented||(this.isClearable&&e.key==="Escape"&&(this.clearInputValue(e),e.preventDefault()),e.key==="Enter"&&cBe(this)&&e.preventDefault())}onLabelClick(){this.setFocus()}incrementOrDecrementNumberValue(e,i,r,s){const{value:n}=this;if(n==="Infinity"||n==="-Infinity")return;const o=e==="up"?1:-1,a=this.step==="any"?1:Math.abs(this.step||1),c=new FA(n!==""?n:"0").add(`${a*o}`),h=()=>typeof r=="number"&&!isNaN(r)&&c.subtract(`${r}`).isNegative,d=()=>typeof i=="number"&&!isNaN(i)&&!c.subtract(`${i}`).isNegative,f=h()?`${r}`:d()?`${i}`:c.toString();this.setValue({committing:!0,nativeEvent:s,origin:"user",value:f})}clearInputValue(e){this.setValue({committing:!0,nativeEvent:e,origin:"user",value:""})}emitChangeIfUserModified(){this.previousValueOrigin==="user"&&this.value!==this.previousEmittedValue&&(this.calciteInputChange.emit(),this.setPreviousEmittedValue(this.value))}inputBlurHandler(){window.clearInterval(this.nudgeNumberValueIntervalId),this.calciteInternalInputBlur.emit(),this.emitChangeIfUserModified()}clickHandler(e){if(this.disabled)return;const i=e.composedPath();!i.includes(this.inputWrapperEl.value)||i.includes(this.actionWrapperEl.value)||this.setFocus()}inputFocusHandler(){this.calciteInternalInputFocus.emit()}inputInputHandler(e){this.disabled||this.readOnly||(this.type==="file"&&(this.files=this.childEl.files),this.setValue({nativeEvent:e,origin:"user",value:e.target.value}))}inputKeyDownHandler(e){this.disabled||this.readOnly||e.key==="Enter"&&this.emitChangeIfUserModified()}inputNumberInputHandler(e){if(this.disabled||this.readOnly||this.value==="Infinity"||this.value==="-Infinity")return;const i=e.target.value;Vh.numberFormatOptions={locale:this.messages._lang,numberingSystem:this.numberingSystem,useGrouping:this.groupSeparator};const r=Vh.delocalize(i);e.inputType==="insertFromPaste"?(Gy(r)||e.preventDefault(),this.setValue({nativeEvent:e,origin:"user",value:rBt(r)}),this.childNumberEl.value=this.displayedValue):this.setValue({nativeEvent:e,origin:"user",value:r})}inputNumberKeyDownHandler(e){if(this.type!=="number"||this.disabled||this.readOnly)return;if(this.value==="Infinity"||this.value==="-Infinity"){e.preventDefault(),(e.key==="Backspace"||e.key==="Delete")&&this.clearInputValue(e);return}if(e.key==="ArrowUp"){e.preventDefault(),this.nudgeNumberValue("up",e);return}if(e.key==="ArrowDown"){this.nudgeNumberValue("down",e);return}const i=[...pH,"ArrowLeft","ArrowRight","Backspace","Delete","Enter","Escape","Tab"];if(e.altKey||e.ctrlKey||e.metaKey)return;const r=e.shiftKey&&e.key==="Tab";if(i.includes(e.key)||r){e.key==="Enter"&&this.emitChangeIfUserModified();return}Vh.numberFormatOptions={locale:this.messages._lang,numberingSystem:this.numberingSystem,useGrouping:this.groupSeparator},!(e.key===Vh.decimal&&(!this.value&&!this.childNumberEl.value||this.value&&this.childNumberEl.value.indexOf(Vh.decimal)===-1))&&(/[eE]/.test(e.key)&&(!this.value&&!this.childNumberEl.value||this.value&&!/[eE]/.test(this.childNumberEl.value))||e.key==="-"&&(!this.value&&!this.childNumberEl.value||this.value&&this.childNumberEl.value.split("-").length<=2)||e.preventDefault())}nudgeNumberValue(e,i){if(i instanceof KeyboardEvent&&i.repeat||this.type!=="number")return;const r=this.maxString?parseFloat(this.maxString):null,s=this.minString?parseFloat(this.minString):null,n=150;this.incrementOrDecrementNumberValue(e,r,s,i),this.nudgeNumberValueIntervalId&&window.clearInterval(this.nudgeNumberValueIntervalId);let o=!0;this.nudgeNumberValueIntervalId=window.setInterval(()=>{if(o){o=!1;return}this.incrementOrDecrementNumberValue(e,r,s,i)},n)}numberButtonPointerUpAndOutHandler(){window.clearInterval(this.nudgeNumberValueIntervalId)}numberButtonPointerDownHandler(e){if(!uUt(e))return;e.preventDefault();const i=e.target.dataset.adjustment;this.disabled||this.nudgeNumberValue(i,e)}syncHiddenFormInput(e){EBt(this.type,this,e)}setChildElRef(e){this.childEl=e}setChildNumberElRef(e){this.childNumberEl=e}setInputValue(e){this.type==="number"&&this.childNumberEl?this.childNumberEl.value=e:this.childEl&&(this.childEl.value=e)}setPreviousEmittedValue(e){this.previousEmittedValue=this.normalizeValue(e)}normalizeValue(e){return this.type==="number"?Gy(e)?e:"":e}setPreviousValue(e){this.previousValue=this.normalizeValue(e)}setValue({committing:e=!1,nativeEvent:i,origin:r,previousValue:s,value:n}){var o,a;if(this.setPreviousValue(s??this.value),this.previousValueOrigin=r,this.type==="number"){Vh.numberFormatOptions={locale:this.messages._lang,numberingSystem:this.numberingSystem,useGrouping:this.groupSeparator,signDisplay:"never"};const l=((o=this.previousValue)==null?void 0:o.length)>n.length||((a=this.value)==null?void 0:a.length)>n.length,c=n.charAt(n.length-1)===".",h=c&&l?n:cBt(n),d=n&&!h?Gy(this.previousValue)?this.previousValue:"":h;let f=Vh.localize(d);r!=="connected"&&!c&&(f=pBt(f,d,Vh)),this.displayedValue=c&&l?`${f}${Vh.decimal}`:f,this.userChangedValue=r==="user"&&this.value!==d,this.value=["-","."].includes(d)?"":d}else this.userChangedValue=r==="user"&&this.value!==n,this.value=n;r==="direct"&&(this.setInputValue(n),this.previousEmittedValue=n),i&&(this.calciteInputInput.emit().defaultPrevented?(this.value=this.previousValue,this.displayedValue=this.type==="number"?Vh.localize(this.previousValue):this.previousValue):e&&this.emitChangeIfUserModified())}inputKeyUpHandler(){window.clearInterval(this.nudgeNumberValueIntervalId)}warnAboutInvalidNumberValue(e){this.type==="number"&&e&&!Gy(e)&&console.warn(`The specified value "${e}" cannot be parsed, or is out of range.`)}render(){const e=YL(this.el),i=ce`<div class=${ge(Da.loader)}><calcite-progress .label=${this.messages.loading} type=indeterminate></calcite-progress></div>`,r=ce`<button .ariaLabel=${this.messages.clear} class=${ge(Da.clearButton)} .disabled=${this.disabled||this.readOnly} @click=${this.clearInputValue} tabindex=-1 type=button><calcite-icon icon=x .scale=${Ya(this.scale)}></calcite-icon></button>`,s=ce`<calcite-icon class=${ge(Da.inputIcon)} .flipRtl=${this.iconFlipRtl} .icon=${this.requestedIcon} .scale=${Ya(this.scale)}></calcite-icon>`,n=this.numberButtonType==="horizontal",o=ce`<button aria-hidden=true class=${ge({[Da.numberButtonItem]:!0,[Da.buttonItemHorizontal]:n})} data-adjustment=up .disabled=${this.disabled||this.readOnly} @pointerdown=${this.numberButtonPointerDownHandler} @pointerout=${this.numberButtonPointerUpAndOutHandler} @pointerup=${this.numberButtonPointerUpAndOutHandler} tabindex=-1 type=button><calcite-icon icon=chevron-up .scale=${Ya(this.scale)}></calcite-icon></button>`,a=ce`<button aria-hidden=true class=${ge({[Da.numberButtonItem]:!0,[Da.buttonItemHorizontal]:n})} data-adjustment=down .disabled=${this.disabled||this.readOnly} @pointerdown=${this.numberButtonPointerDownHandler} @pointerout=${this.numberButtonPointerUpAndOutHandler} @pointerup=${this.numberButtonPointerUpAndOutHandler} tabindex=-1 type=button><calcite-icon icon=chevron-down .scale=${Ya(this.scale)}></calcite-icon></button>`,l=ce`<div class=${ge(Da.numberButtonWrapper)}>${o}${a}</div>`,c=ce`<div class=${ge(Da.prefix)}>${this.prefixText}</div>`,h=ce`<div class=${ge(Da.suffix)}>${this.suffixText}</div>`,d=this.el.autofocus,f=this.el.enterKeyHint,m=this.el.inputMode,g=this.type==="number"?er("localized-input",ce`<input accept=${this.accept??Ke} aria-errormessage=${K7.validationMessage} .ariaInvalid=${this.status==="invalid"} .ariaLabel=${Cte(this)} autocomplete=${this.autocomplete??Ke} .autofocus=${d} value=${this.defaultValue??Ke} .disabled=${this.disabled?!0:null} enterkeyhint=${f??Ke} inputmode=${m??Ke} maxlength=${this.maxLength??Ke} minlength=${this.minLength??Ke} .multiple=${this.multiple} name=${Ke} @blur=${this.inputBlurHandler} @focus=${this.inputFocusHandler} @input=${this.inputNumberInputHandler} @keydown=${this.inputNumberKeyDownHandler} @keyup=${this.inputKeyUpHandler} pattern=${this.pattern??Ke} placeholder=${(this.placeholder||"")??Ke} .readOnly=${this.readOnly} type=text .value=${Ope(this.displayedValue??"")} ${xr(this.setChildNumberElRef)}>`):null,v=this.childElType==="input"?_D`input`:_D`textarea`,_=this.type!=="number"?Rle`<${v} accept=${this.accept??Ke} aria-errormessage=${K7.validationMessage} .ariaInvalid=${this.status==="invalid"} .ariaLabel=${Cte(this)} autocomplete=${this.autocomplete??Ke} .autofocus=${d} class=${ge({[Da.editingEnabled]:this.editingEnabled,[Da.inlineChild]:!!this.inlineEditableEl})} .defaultValue=${this.defaultValue??""} .disabled=${this.disabled?!0:null} enterkeyhint=${f??Ke} inputmode=${m??Ke} max=${this.maxString??Ke} maxlength=${this.maxLength??Ke} min=${this.minString??Ke} minlength=${this.minLength??Ke} .multiple=${this.multiple} name=${this.name??Ke} @blur=${this.inputBlurHandler} @focus=${this.inputFocusHandler} @input=${this.inputInputHandler} @keydown=${this.inputKeyDownHandler} @keyup=${this.inputKeyUpHandler} pattern=${this.pattern??Ke} placeholder=${(this.placeholder||"")??Ke} .readOnly=${this.readOnly} .required=${this.required?!0:null} spellcheck=${this.el.spellcheck??Ke} step=${this.step??Ke} tabindex=${(this.disabled||this.inlineEditableEl&&!this.editingEnabled?-1:null)??Ke} type=${this.type??Ke} .value=${Ope(this.value??"")} ${xr(this.setChildElRef)}></${v}>`:null;return $g({disabled:this.disabled,children:ce`<div class=${ge({[Da.inputWrapper]:!0,[pP.rtl]:e==="rtl",[Da.hasSuffix]:this.suffixText,[Da.hasPrefix]:this.prefixText})} ${xr(this.inputWrapperEl)}>${this.type==="number"&&this.numberButtonType==="horizontal"&&!this.readOnly?a:null}${this.prefixText?c:null}<div class=${ge(Da.wrapper)}>${g}${_}${this.isClearable?r:null}${this.requestedIcon?s:null}${this.loading?i:null}</div><div class=${ge(Da.actionWrapper)} ${xr(this.actionWrapperEl)}><slot name=${CBt.action}></slot></div>${this.type==="number"&&this.numberButtonType==="vertical"&&!this.readOnly?l:null}${this.suffixText?h:null}${this.type==="number"&&this.numberButtonType==="horizontal"&&!this.readOnly?o:null}${BUt({component:this})}</div>${this.validationMessage&&this.status==="invalid"?wBt({icon:this.validationIcon,id:K7.validationMessage,message:this.validationMessage,scale:this.scale,status:this.status}):null}`})}};gj.properties={displayedValue:[16,{},{state:!0}],slottedActionElDisabledInternally:[16,{},{state:!0}],accept:1,alignment:[3,{},{reflect:!0}],autocomplete:[0,{},{attribute:!1}],clearable:[7,{},{reflect:!0,type:Boolean}],disabled:[7,{},{reflect:!0,type:Boolean}],editingEnabled:[7,{},{reflect:!0,type:Boolean}],files:[0,{},{attribute:!1}],form:[3,{},{reflect:!0}],groupSeparator:[7,{},{reflect:!0,type:Boolean}],icon:[3,{converter:P3},{reflect:!0}],iconFlipRtl:[7,{},{reflect:!0,type:Boolean}],label:1,loading:[7,{},{reflect:!0,type:Boolean}],localeFormat:[5,{},{type:Boolean}],max:[11,{},{reflect:!0,type:Number}],maxLength:[11,{},{reflect:!0,type:Number}],messageOverrides:[0,{},{attribute:!1}],min:[11,{},{reflect:!0,type:Number}],minLength:[11,{},{reflect:!0,type:Number}],multiple:[5,{},{type:Boolean}],name:[3,{},{reflect:!0}],numberButtonType:[3,{},{reflect:!0}],numberingSystem:[3,{},{reflect:!0}],pattern:1,placeholder:1,prefixText:1,readOnly:[7,{},{reflect:!0,type:Boolean}],required:[7,{},{reflect:!0,type:Boolean}],scale:[3,{},{reflect:!0}],status:[3,{},{reflect:!0}],step:[3,{},{reflect:!0}],suffixText:1,type:[3,{},{reflect:!0}],validationIcon:[3,{converter:P3},{reflect:!0}],validationMessage:1,validity:[0,{},{attribute:!1}],value:1},gj.styles=$Bt;let FV=gj;Io("calcite-input",FV);const sgi=Object.freeze(Object.defineProperty({__proto__:null,Input:FV},Symbol.toStringTag,{value:"Module"}));/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const M1e={scrim:"scrim",content:"content"},O1e={s:72,l:480},ABt=Ks`:host{position:absolute;inset:0;z-index:var(--calcite-z-index-overlay);display:flex;block-size:100%;inline-size:100%;flex-direction:column;align-items:stretch}@keyframes calcite-scrim-fade-in{0%{--tw-bg-opacity: 0 }to{--tw-text-opacity: 1 }}.scrim{position:absolute;inset:0;display:flex;flex-direction:column;align-content:center;align-items:center;justify-content:center;overflow:hidden;animation:calcite-scrim-fade-in var(--calcite-internal-animation-timing-medium) ease-in-out;background-color:var(--calcite-scrim-background, var(--calcite-color-transparent-scrim))}.content{padding:1rem}:host([hidden]){display:none}[hidden]{display:none}`,yj=class yj extends Hn{constructor(){super(...arguments),this.resizeObserver=Tf("resize",()=>this.handleResize()),this.messages=Vd(),this.hasContent=!1,this.loading=!1}connectedCallback(){var e;super.connectedCallback(),(e=this.resizeObserver)==null||e.observe(this.el)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this.resizeObserver)==null||e.disconnect()}handleDefaultSlotChange(e){this.hasContent=sUt(e)}storeLoaderEl(e){this.loaderEl=e,this.handleResize()}getScale(e){return e<O1e.s?"s":e>=O1e.l?"l":"m"}handleResize(){const{loaderEl:e,el:i}=this;e&&(this.loaderScale=this.getScale(Math.min(i.clientHeight,i.clientWidth)??0))}render(){const{hasContent:e,loading:i,messages:r}=this;return ce`<div class=${ge(M1e.scrim)}>${i?ce`<calcite-loader .label=${r.loading} .scale=${this.loaderScale} ${xr(this.storeLoaderEl)}></calcite-loader>`:null}<div class=${ge(M1e.content)} .hidden=${!e}><slot @slotchange=${this.handleDefaultSlotChange}></slot></div></div>`}};yj.properties={hasContent:[16,{},{state:!0}],loaderScale:[16,{},{state:!0}],loading:[7,{},{reflect:!0,type:Boolean}],messageOverrides:[0,{},{attribute:!1}]},yj.styles=ABt;let kV=yj;Io("calcite-scrim",kV);const MBt=Object.freeze(Object.defineProperty({__proto__:null,Scrim:kV},Symbol.toStringTag,{value:"Module"}));/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const $E={container:"container",actionsStart:"actions-start",contentStart:"content-start",content:"content",contentEnd:"content-end",actionsEnd:"actions-end"},DC={actionsStart:"actions-start",contentStart:"content-start",contentEnd:"content-end",actionsEnd:"actions-end"};/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const OBt=Ks`:host([disabled]) .content{cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) .content *,:host([disabled]) .content ::slotted(*){pointer-events:none}:host{display:flex;flex:1 1 0%;flex-direction:column}.container{display:flex;flex:1 1 auto;align-items:stretch;font-weight:var(--calcite-font-weight-normal);color:var(--calcite-color-text-2)}.content{display:flex;flex:1 1 auto;flex-direction:column;justify-content:center;font-size:var(--calcite-font-size--2);line-height:1.375;padding-inline:var(--calcite-stack-padding-inline, .75rem);padding-block:var(--calcite-stack-padding-block, .5rem)}.content-start{justify-content:flex-start}.content-end{justify-content:flex-end}.content-start,.content-end{flex:0 1 auto}.content-start ::slotted(calcite-icon),.content-end ::slotted(calcite-icon){margin-inline:.75rem;align-self:center}.actions-start,.actions-end,.content-start,.content-end{display:flex;align-items:center}.actions-start ::slotted(calcite-action),.actions-start ::slotted(calcite-action-menu),.actions-start ::slotted(calcite-handle),.actions-start ::slotted(calcite-dropdown),.actions-end ::slotted(calcite-action),.actions-end ::slotted(calcite-action-menu),.actions-end ::slotted(calcite-handle),.actions-end ::slotted(calcite-dropdown){align-self:stretch;color:inherit}:host([hidden]){display:none}[hidden]{display:none}`,vj=class vj extends Hn{constructor(){super(...arguments),this.hasActionsEnd=!1,this.hasActionsStart=!1,this.hasContentEnd=!1,this.hasContentStart=!1,this.disabled=!1}handleActionsStartSlotChange(e){this.hasActionsStart=Os(e)}handleActionsEndSlotChange(e){this.hasActionsEnd=Os(e)}handleContentStartSlotChange(e){this.hasContentStart=Os(e)}handleContentEndSlotChange(e){this.hasContentEnd=Os(e)}renderActionsStart(){const{hasActionsStart:e}=this;return er("actions-start-container",ce`<div class=${ge($E.actionsStart)} .hidden=${!e}><slot name=${DC.actionsStart} @slotchange=${this.handleActionsStartSlotChange}></slot></div>`)}renderActionsEnd(){const{hasActionsEnd:e}=this;return er("actions-end-container",ce`<div class=${ge($E.actionsEnd)} .hidden=${!e}><slot name=${DC.actionsEnd} @slotchange=${this.handleActionsEndSlotChange}></slot></div>`)}renderContentStart(){const{hasContentStart:e}=this;return ce`<div class=${ge($E.contentStart)} .hidden=${!e}><slot name=${DC.contentStart} @slotchange=${this.handleContentStartSlotChange}></slot></div>`}renderDefaultContent(){return ce`<div class=${ge($E.content)}><slot></slot></div>`}renderContentEnd(){const{hasContentEnd:e}=this;return ce`<div class=${ge($E.contentEnd)} .hidden=${!e}><slot name=${DC.contentEnd} @slotchange=${this.handleContentEndSlotChange}></slot></div>`}render(){return ce`<div class=${ge($E.container)}>${this.renderActionsStart()}${this.renderContentStart()}${this.renderDefaultContent()}${this.renderContentEnd()}${this.renderActionsEnd()}</div>`}};vj.properties={hasActionsEnd:[16,{},{state:!0}],hasActionsStart:[16,{},{state:!0}],hasContentEnd:[16,{},{state:!0}],hasContentStart:[16,{},{state:!0}],disabled:[7,{},{reflect:!0,type:Boolean}]},vj.styles=OBt;let Ate=vj;Io("calcite-stack",Ate);var wBe=typeof global=="object"&&global&&global.Object===Object&&global,IBt=typeof self=="object"&&self&&self.Object===Object&&self,kle=wBe||IBt||Function("return this")(),kA=kle.Symbol,xBe=Object.prototype,RBt=xBe.hasOwnProperty,PBt=xBe.toString,zO=kA?kA.toStringTag:void 0;function DBt(t){var e=RBt.call(t,zO),i=t[zO];try{t[zO]=void 0;var r=!0}catch{}var s=PBt.call(t);return r&&(e?t[zO]=i:delete t[zO]),s}var LBt=Object.prototype,NBt=LBt.toString;function FBt(t){return NBt.call(t)}var kBt="[object Null]",zBt="[object Undefined]",I1e=kA?kA.toStringTag:void 0;function fH(t){return t==null?t===void 0?zBt:kBt:I1e&&I1e in Object(t)?DBt(t):FBt(t)}function mH(t){return t!=null&&typeof t=="object"}var UBt="[object Symbol]";function SBe(t){return typeof t=="symbol"||mH(t)&&fH(t)==UBt}function BBt(t,e){for(var i=-1,r=t==null?0:t.length,s=Array(r);++i<r;)s[i]=e(t[i],i,t);return s}var TBe=Array.isArray,R1e=kA?kA.prototype:void 0,P1e=R1e?R1e.toString:void 0;function EBe(t){if(typeof t=="string")return t;if(TBe(t))return BBt(t,EBe)+"";if(SBe(t))return P1e?P1e.call(t):"";var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}var VBt=/\s/;function jBt(t){for(var e=t.length;e--&&VBt.test(t.charAt(e)););return e}var GBt=/^\s+/;function HBt(t){return t&&t.slice(0,jBt(t)+1).replace(GBt,"")}function wD(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var D1e=NaN,qBt=/^[-+]0x[0-9a-f]+$/i,WBt=/^0b[01]+$/i,ZBt=/^0o[0-7]+$/i,YBt=parseInt;function L1e(t){if(typeof t=="number")return t;if(SBe(t))return D1e;if(wD(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=wD(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=HBt(t);var i=WBt.test(t);return i||ZBt.test(t)?YBt(t.slice(2),i?2:8):qBt.test(t)?D1e:+t}function JBt(t){return t}var XBt="[object AsyncFunction]",KBt="[object Function]",QBt="[object GeneratorFunction]",eVt="[object Proxy]";function tVt(t){if(!wD(t))return!1;var e=fH(t);return e==KBt||e==QBt||e==XBt||e==eVt}var iVt=9007199254740991,rVt=/^(?:0|[1-9]\d*)$/;function sVt(t,e){var i=typeof t;return e=e??iVt,!!e&&(i=="number"||i!="symbol"&&rVt.test(t))&&t>-1&&t%1==0&&t<e}var nVt=9007199254740991;function CBe(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=nVt}function oVt(t){return t!=null&&CBe(t.length)&&!tVt(t)}var aVt=Object.prototype;function lVt(t){var e=t&&t.constructor,i=typeof e=="function"&&e.prototype||aVt;return t===i}function cVt(t,e){for(var i=-1,r=Array(t);++i<t;)r[i]=e(i);return r}var uVt="[object Arguments]";function N1e(t){return mH(t)&&fH(t)==uVt}var $Be=Object.prototype,hVt=$Be.hasOwnProperty,dVt=$Be.propertyIsEnumerable,pVt=N1e(function(){return arguments}())?N1e:function(t){return mH(t)&&hVt.call(t,"callee")&&!dVt.call(t,"callee")};function fVt(){return!1}var ABe=typeof exports=="object"&&exports&&!exports.nodeType&&exports,F1e=ABe&&typeof module=="object"&&module&&!module.nodeType&&module,mVt=F1e&&F1e.exports===ABe,k1e=mVt?kle.Buffer:void 0,gVt=k1e?k1e.isBuffer:void 0,yVt=gVt||fVt,vVt="[object Arguments]",_Vt="[object Array]",bVt="[object Boolean]",wVt="[object Date]",xVt="[object Error]",SVt="[object Function]",TVt="[object Map]",EVt="[object Number]",CVt="[object Object]",$Vt="[object RegExp]",AVt="[object Set]",MVt="[object String]",OVt="[object WeakMap]",IVt="[object ArrayBuffer]",RVt="[object DataView]",PVt="[object Float32Array]",DVt="[object Float64Array]",LVt="[object Int8Array]",NVt="[object Int16Array]",FVt="[object Int32Array]",kVt="[object Uint8Array]",zVt="[object Uint8ClampedArray]",UVt="[object Uint16Array]",BVt="[object Uint32Array]",Gs={};Gs[PVt]=Gs[DVt]=Gs[LVt]=Gs[NVt]=Gs[FVt]=Gs[kVt]=Gs[zVt]=Gs[UVt]=Gs[BVt]=!0;Gs[vVt]=Gs[_Vt]=Gs[IVt]=Gs[bVt]=Gs[RVt]=Gs[wVt]=Gs[xVt]=Gs[SVt]=Gs[TVt]=Gs[EVt]=Gs[CVt]=Gs[$Vt]=Gs[AVt]=Gs[MVt]=Gs[OVt]=!1;function VVt(t){return mH(t)&&CBe(t.length)&&!!Gs[fH(t)]}function jVt(t){return function(e){return t(e)}}var MBe=typeof exports=="object"&&exports&&!exports.nodeType&&exports,BP=MBe&&typeof module=="object"&&module&&!module.nodeType&&module,GVt=BP&&BP.exports===MBe,Q7=GVt&&wBe.process,z1e=function(){try{var t=BP&&BP.require&&BP.require("util").types;return t||Q7&&Q7.binding&&Q7.binding("util")}catch{}}(),U1e=z1e&&z1e.isTypedArray,HVt=U1e?jVt(U1e):VVt;function qVt(t,e){var i=TBe(t),r=!i&&pVt(t),s=!i&&!r&&yVt(t),n=!i&&!r&&!s&&HVt(t),o=i||r||s||n,a=o?cVt(t.length,String):[],l=a.length;for(var c in t)o&&(c=="length"||s&&(c=="offset"||c=="parent")||n&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||sVt(c,l))||a.push(c);return a}function WVt(t){var e=[];if(t!=null)for(var i in Object(t))e.push(i);return e}var ZVt=Object.prototype,YVt=ZVt.hasOwnProperty;function JVt(t){if(!wD(t))return WVt(t);var e=lVt(t),i=[];for(var r in t)r=="constructor"&&(e||!YVt.call(t,r))||i.push(r);return i}function XVt(t){return oVt(t)?qVt(t):JVt(t)}function KVt(t){return t==null?"":EBe(t)}function QVt(t){return function(e,i,r){for(var s=-1,n=Object(e),o=r(e),a=o.length;a--;){var l=o[++s];if(i(n[l],l,n)===!1)break}return e}}var ejt=QVt(),eW=function(){return kle.Date.now()},tjt="Expected a function",ijt=Math.max,rjt=Math.min;function zle(t,e,i){var r,s,n,o,a,l,c=0,h=!1,d=!1,f=!0;if(typeof t!="function")throw new TypeError(tjt);e=L1e(e)||0,wD(i)&&(h=!!i.leading,d="maxWait"in i,n=d?ijt(L1e(i.maxWait)||0,e):n,f="trailing"in i?!!i.trailing:f);function m(T){var M=r,I=s;return r=s=void 0,c=T,o=t.apply(I,M),o}function g(T){return c=T,a=setTimeout(b,e),h?m(T):o}function v(T){var M=T-l,I=T-c,D=e-M;return d?rjt(D,n-I):D}function _(T){var M=T-l,I=T-c;return l===void 0||M>=e||M<0||d&&I>=n}function b(){var T=eW();if(_(T))return w(T);a=setTimeout(b,v(T))}function w(T){return a=void 0,f&&r?m(T):(r=s=void 0,o)}function x(){a!==void 0&&clearTimeout(a),c=0,r=l=s=a=void 0}function S(){return a===void 0?o:w(eW())}function C(){var T=eW(),M=_(T);if(r=arguments,s=this,l=T,M){if(a===void 0)return g(l);if(d)return clearTimeout(a),a=setTimeout(b,e),m(l)}return a===void 0&&(a=setTimeout(b,e)),o}return C.cancel=x,C.flush=S,C}function sjt(t){return typeof t=="function"?t:JBt}var OBe=/[\\^$.*+?()[\]{}|]/g,njt=RegExp(OBe.source);function ojt(t){return t=KVt(t),t&&njt.test(t)?t.replace(OBe,"\\$&"):t}function ajt(t,e){return t==null?t:ejt(t,sjt(e),XVt)}/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const tW=(t,e,i)=>{const r=ojt(e),s=new RegExp(r,"i");t.length===0&&console.warn(`No data was passed to the filter function.
    The data argument should be an array of objects`);const n=(o,a,l)=>{if(o!=null&&o.constant||o!=null&&o.filterDisabled)return!0;let c=!1;return ajt(o,(h,d)=>{typeof h=="function"||h==null||l&&!l.includes(d)||(Array.isArray(h)||typeof h=="object"&&h!==null?n(h,a)&&(c=!0):a.test(h)&&(c=!0))}),c};return t.filter(o=>n(o,s,i))};/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const ljt={container:"container"},cjt={search:"search"},ujt=Ks`:host{box-sizing:border-box;background-color:var(--calcite-color-foreground-1);color:var(--calcite-color-text-2);font-size:var(--calcite-font-size--1)}:host *{box-sizing:border-box}:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:flex;inline-size:100%}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}.container{display:flex;inline-size:100%}:host([scale=s]) .container{padding:var(--calcite-filter-content-space, var(--calcite-spacing-sm))}:host([scale=m]) .container{padding:var(--calcite-filter-content-space, var(--calcite-spacing-md))}:host([scale=l]) .container{padding:var(--calcite-filter-content-space, var(--calcite-spacing-lg))}label{position:relative;margin-block:0px;display:flex;inline-size:100%;align-items:center;overflow:hidden}calcite-input{inline-size:100%;--calcite-input-background-color: var(--calcite-filter-input-background-color);--calcite-input-border-color: var(--calcite-filter-input-border-color);--calcite-input-corner-radius: var(--calcite-filter-input-corner-radius);--calcite-input-shadow: var(--calcite-filter-input-shadow);--calcite-input-icon-color: var(--calcite-filter-input-icon-color);--calcite-input-text-color: var(--calcite-filter-input-text-color);--calcite-input-placeholder-text-color: var(--calcite-filter-input-placeholder-text-color);--calcite-input-actions-background-color: var(--calcite-filter-input-actions-background-color);--calcite-input-actions-background-color-hover: var(--calcite-filter-input-actions-background-color-hover);--calcite-input-actions-background-color-press: var(--calcite-filter-input-actions-background-color-press);--calcite-input-actions-icon-color: var(--calcite-filter-input-actions-icon-color);--calcite-input-actions-icon-color-hover: var(--calcite-filter-input-actions-icon-color-hover);--calcite-input-actions-icon-color-press: var(--calcite-filter-input-actions-icon-color-press)}:host([hidden]){display:none}[hidden]{display:none}`,JP=class JP extends Hn{constructor(){super(...arguments),this.filterDebounced=zle((e,i=!1,r)=>this.updateFiltered(tW(this.items??[],e,this.filterProps),i,r),dB.filter),this.textInput=Yc(),this._value="",this.messages=Vd(),this.disabled=!1,this.filteredItems=[],this.items=[],this.scale="m",this.calciteFilterChange=Gt({cancelable:!1})}get value(){return this._value}set value(e){const i=this._value;e!==i&&(this._value=e,this.valueHandler(e))}async filter(e=this.value){return new Promise(i=>{this.value=e,this.updateFiltered(tW(this.items??[],e,this.filterProps),!1,i)})}async setFocus(){var e;return await yh(this),(e=this.textInput.value)==null?void 0:e.setFocus()}async load(){this.updateFiltered(tW(this.items??[],this.value,this.filterProps))}willUpdate(e){var i;(e.has("items")&&(this.hasUpdated||((i=this.items)==null?void 0:i.length)>0)||e.has("filterProps"))&&this.filterDebounced(this.value)}updated(){Cg(this)}disconnectedCallback(){super.disconnectedCallback(),this.filterDebounced.cancel()}valueHandler(e){this.filterDebounced(e)}inputHandler(e){const i=e.target;this.value=i.value,this.filterDebounced(i.value,!0)}keyDownHandler(e){e.defaultPrevented||(e.key==="Escape"&&(this.clear(),e.preventDefault()),e.key==="Enter"&&e.preventDefault())}clear(){this.value="",this.filterDebounced("",!0),this.setFocus()}updateFiltered(e,i=!1,r){this.filteredItems=e,i&&this.calciteFilterChange.emit(),r==null||r()}render(){const{disabled:e,scale:i}=this;return $g({disabled:e,children:ce`<div class=${ge(ljt.container)}><label><calcite-input clearable .disabled=${e} .icon=${cjt.search} .label=${this.label??this.messages.label} .messageOverrides=${{clear:this.messages.clear}} @keydown=${this.keyDownHandler} @calciteInputInput=${this.inputHandler} .placeholder=${this.placeholder} .scale=${i} type=text .value=${this.value} ${xr(this.textInput)}></calcite-input></label></div>`})}};JP.properties={disabled:[7,{},{reflect:!0,type:Boolean}],filterProps:[0,{},{attribute:!1}],filteredItems:[0,{},{attribute:!1}],items:[0,{},{attribute:!1}],label:1,messageOverrides:[0,{},{attribute:!1}],placeholder:1,scale:[3,{},{reflect:!0}],value:1},JP.shadowRootOptions={mode:"open",delegatesFocus:!0},JP.styles=ujt;let Mte=JP;Io("calcite-filter",Mte);/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const VP="calcite-list",zV="calcite-list-item-group",ev="calcite-list-item";function IBe(t){var i;const e=(i=t.parentElement)==null?void 0:i.closest(ev);e&&(e.open=!0,IBe(e))}function hjt(t){const e=t.assignedElements({flatten:!0}),i=e.filter(n=>n==null?void 0:n.matches(zV)).map(n=>Array.from(n.querySelectorAll(ev))).flat(),r=e.filter(n=>n==null?void 0:n.matches(ev));return{lists:e.filter(n=>n==null?void 0:n.matches(VP)),items:i.concat(r)}}function djt(t){const e=t.assignedElements({flatten:!0}).filter(r=>r.matches(ev)),i=e.filter(r=>!r.filterHidden);e.forEach(r=>{const s=i.indexOf(r);r.setPosition=s===-1?void 0:s+1,r.setSize=s===-1?void 0:i.length})}function pjt(t,e=!1){const i=e?"ancestor::calcite-list-item | ancestor::calcite-list-item-group":"ancestor::calcite-list-item";return document.evaluate(i,t,null,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null).snapshotLength}function B1e(t){return t.tagName==="CALCITE-LIST-ITEM"}/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function V1e(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),i.push.apply(i,r)}return i}function dg(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?V1e(Object(i),!0).forEach(function(r){fjt(t,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):V1e(Object(i)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))})}return t}function Qz(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Qz=function(e){return typeof e}:Qz=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qz(t)}function fjt(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Fv(){return Fv=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},Fv.apply(this,arguments)}function mjt(t,e){if(t==null)return{};var i={},r=Object.keys(t),s,n;for(n=0;n<r.length;n++)s=r[n],!(e.indexOf(s)>=0)&&(i[s]=t[s]);return i}function gjt(t,e){if(t==null)return{};var i=mjt(t,e),r,s;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);for(s=0;s<n.length;s++)r=n[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}var yjt="1.15.6";function fv(t){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(t)}var Qv=fv(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),JL=fv(/Edge/i),j1e=fv(/firefox/i),jP=fv(/safari/i)&&!fv(/chrome/i)&&!fv(/android/i),Ule=fv(/iP(ad|od|hone)/i),RBe=fv(/chrome/i)&&fv(/android/i),PBe={capture:!1,passive:!1};function br(t,e,i){t.addEventListener(e,i,!Qv&&PBe)}function dr(t,e,i){t.removeEventListener(e,i,!Qv&&PBe)}function UV(t,e){if(e){if(e[0]===">"&&(e=e.substring(1)),t)try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch{return!1}return!1}}function DBe(t){return t.host&&t!==document&&t.host.nodeType?t.host:t.parentNode}function Vp(t,e,i,r){if(t){i=i||document;do{if(e!=null&&(e[0]===">"?t.parentNode===i&&UV(t,e):UV(t,e))||r&&t===i)return t;if(t===i)break}while(t=DBe(t))}return null}var G1e=/\s+/g;function ku(t,e,i){if(t&&e)if(t.classList)t.classList[i?"add":"remove"](e);else{var r=(" "+t.className+" ").replace(G1e," ").replace(" "+e+" "," ");t.className=(r+(i?" "+e:"")).replace(G1e," ")}}function li(t,e,i){var r=t&&t.style;if(r){if(i===void 0)return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(i=t.currentStyle),e===void 0?i:i[e];!(e in r)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),r[e]=i+(typeof i=="string"?"":"px")}}function m$(t,e){var i="";if(typeof t=="string")i=t;else do{var r=li(t,"transform");r&&r!=="none"&&(i=r+" "+i)}while(!e&&(t=t.parentNode));var s=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return s&&new s(i)}function LBe(t,e,i){if(t){var r=t.getElementsByTagName(e),s=0,n=r.length;if(i)for(;s<n;s++)i(r[s],s);return r}return[]}function Xm(){var t=document.scrollingElement;return t||document.documentElement}function _o(t,e,i,r,s){if(!(!t.getBoundingClientRect&&t!==window)){var n,o,a,l,c,h,d;if(t!==window&&t.parentNode&&t!==Xm()?(n=t.getBoundingClientRect(),o=n.top,a=n.left,l=n.bottom,c=n.right,h=n.height,d=n.width):(o=0,a=0,l=window.innerHeight,c=window.innerWidth,h=window.innerHeight,d=window.innerWidth),(e||i)&&t!==window&&(s=s||t.parentNode,!Qv))do if(s&&s.getBoundingClientRect&&(li(s,"transform")!=="none"||i&&li(s,"position")!=="static")){var f=s.getBoundingClientRect();o-=f.top+parseInt(li(s,"border-top-width")),a-=f.left+parseInt(li(s,"border-left-width")),l=o+n.height,c=a+n.width;break}while(s=s.parentNode);if(r&&t!==window){var m=m$(s||t),g=m&&m.a,v=m&&m.d;m&&(o/=v,a/=g,d/=g,h/=v,l=o+h,c=a+d)}return{top:o,left:a,bottom:l,right:c,width:d,height:h}}}function H1e(t,e,i){for(var r=yb(t,!0),s=_o(t)[e];r;){var n=_o(r)[i],o=void 0;if(o=s>=n,!o)return r;if(r===Xm())break;r=yb(r,!1)}return!1}function zA(t,e,i,r){for(var s=0,n=0,o=t.children;n<o.length;){if(o[n].style.display!=="none"&&o[n]!==ci.ghost&&(r||o[n]!==ci.dragged)&&Vp(o[n],i.draggable,t,!1)){if(s===e)return o[n];s++}n++}return null}function Ble(t,e){for(var i=t.lastElementChild;i&&(i===ci.ghost||li(i,"display")==="none"||e&&!UV(i,e));)i=i.previousElementSibling;return i||null}function qh(t,e){var i=0;if(!t||!t.parentNode)return-1;for(;t=t.previousElementSibling;)t.nodeName.toUpperCase()!=="TEMPLATE"&&t!==ci.clone&&(!e||UV(t,e))&&i++;return i}function q1e(t){var e=0,i=0,r=Xm();if(t)do{var s=m$(t),n=s.a,o=s.d;e+=t.scrollLeft*n,i+=t.scrollTop*o}while(t!==r&&(t=t.parentNode));return[e,i]}function vjt(t,e){for(var i in t)if(t.hasOwnProperty(i)){for(var r in e)if(e.hasOwnProperty(r)&&e[r]===t[i][r])return Number(i)}return-1}function yb(t,e){if(!t||!t.getBoundingClientRect)return Xm();var i=t,r=!1;do if(i.clientWidth<i.scrollWidth||i.clientHeight<i.scrollHeight){var s=li(i);if(i.clientWidth<i.scrollWidth&&(s.overflowX=="auto"||s.overflowX=="scroll")||i.clientHeight<i.scrollHeight&&(s.overflowY=="auto"||s.overflowY=="scroll")){if(!i.getBoundingClientRect||i===document.body)return Xm();if(r||e)return i;r=!0}}while(i=i.parentNode);return Xm()}function _jt(t,e){if(t&&e)for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}function iW(t,e){return Math.round(t.top)===Math.round(e.top)&&Math.round(t.left)===Math.round(e.left)&&Math.round(t.height)===Math.round(e.height)&&Math.round(t.width)===Math.round(e.width)}var GP;function NBe(t,e){return function(){if(!GP){var i=arguments,r=this;i.length===1?t.call(r,i[0]):t.apply(r,i),GP=setTimeout(function(){GP=void 0},e)}}}function bjt(){clearTimeout(GP),GP=void 0}function FBe(t,e,i){t.scrollLeft+=e,t.scrollTop+=i}function kBe(t){var e=window.Polymer,i=window.jQuery||window.Zepto;return e&&e.dom?e.dom(t).cloneNode(!0):i?i(t).clone(!0)[0]:t.cloneNode(!0)}function zBe(t,e,i){var r={};return Array.from(t.children).forEach(function(s){var n,o,a,l;if(!(!Vp(s,e.draggable,t,!1)||s.animated||s===i)){var c=_o(s);r.left=Math.min((n=r.left)!==null&&n!==void 0?n:1/0,c.left),r.top=Math.min((o=r.top)!==null&&o!==void 0?o:1/0,c.top),r.right=Math.max((a=r.right)!==null&&a!==void 0?a:-1/0,c.right),r.bottom=Math.max((l=r.bottom)!==null&&l!==void 0?l:-1/0,c.bottom)}}),r.width=r.right-r.left,r.height=r.bottom-r.top,r.x=r.left,r.y=r.top,r}var Qc="Sortable"+new Date().getTime();function wjt(){var t=[],e;return{captureAnimationState:function(){if(t=[],!!this.options.animation){var r=[].slice.call(this.el.children);r.forEach(function(s){if(!(li(s,"display")==="none"||s===ci.ghost)){t.push({target:s,rect:_o(s)});var n=dg({},t[t.length-1].rect);if(s.thisAnimationDuration){var o=m$(s,!0);o&&(n.top-=o.f,n.left-=o.e)}s.fromRect=n}})}},addAnimationState:function(r){t.push(r)},removeAnimationState:function(r){t.splice(vjt(t,{target:r}),1)},animateAll:function(r){var s=this;if(!this.options.animation){clearTimeout(e),typeof r=="function"&&r();return}var n=!1,o=0;t.forEach(function(a){var l=0,c=a.target,h=c.fromRect,d=_o(c),f=c.prevFromRect,m=c.prevToRect,g=a.rect,v=m$(c,!0);v&&(d.top-=v.f,d.left-=v.e),c.toRect=d,c.thisAnimationDuration&&iW(f,d)&&!iW(h,d)&&(g.top-d.top)/(g.left-d.left)===(h.top-d.top)/(h.left-d.left)&&(l=Sjt(g,f,m,s.options)),iW(d,h)||(c.prevFromRect=h,c.prevToRect=d,l||(l=s.options.animation),s.animate(c,g,d,l)),l&&(n=!0,o=Math.max(o,l),clearTimeout(c.animationResetTimer),c.animationResetTimer=setTimeout(function(){c.animationTime=0,c.prevFromRect=null,c.fromRect=null,c.prevToRect=null,c.thisAnimationDuration=null},l),c.thisAnimationDuration=l)}),clearTimeout(e),n?e=setTimeout(function(){typeof r=="function"&&r()},o):typeof r=="function"&&r(),t=[]},animate:function(r,s,n,o){if(o){li(r,"transition",""),li(r,"transform","");var a=m$(this.el),l=a&&a.a,c=a&&a.d,h=(s.left-n.left)/(l||1),d=(s.top-n.top)/(c||1);r.animatingX=!!h,r.animatingY=!!d,li(r,"transform","translate3d("+h+"px,"+d+"px,0)"),this.forRepaintDummy=xjt(r),li(r,"transition","transform "+o+"ms"+(this.options.easing?" "+this.options.easing:"")),li(r,"transform","translate3d(0,0,0)"),typeof r.animated=="number"&&clearTimeout(r.animated),r.animated=setTimeout(function(){li(r,"transition",""),li(r,"transform",""),r.animated=!1,r.animatingX=!1,r.animatingY=!1},o)}}}}function xjt(t){return t.offsetWidth}function Sjt(t,e,i,r){return Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))/Math.sqrt(Math.pow(e.top-i.top,2)+Math.pow(e.left-i.left,2))*r.animation}var AE=[],rW={initializeByDefault:!0},XL={mount:function(e){for(var i in rW)rW.hasOwnProperty(i)&&!(i in e)&&(e[i]=rW[i]);AE.forEach(function(r){if(r.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),AE.push(e)},pluginEvent:function(e,i,r){var s=this;this.eventCanceled=!1,r.cancel=function(){s.eventCanceled=!0};var n=e+"Global";AE.forEach(function(o){i[o.pluginName]&&(i[o.pluginName][n]&&i[o.pluginName][n](dg({sortable:i},r)),i.options[o.pluginName]&&i[o.pluginName][e]&&i[o.pluginName][e](dg({sortable:i},r)))})},initializePlugins:function(e,i,r,s){AE.forEach(function(a){var l=a.pluginName;if(!(!e.options[l]&&!a.initializeByDefault)){var c=new a(e,i,e.options);c.sortable=e,c.options=e.options,e[l]=c,Fv(r,c.defaults)}});for(var n in e.options)if(e.options.hasOwnProperty(n)){var o=this.modifyOption(e,n,e.options[n]);typeof o<"u"&&(e.options[n]=o)}},getEventProperties:function(e,i){var r={};return AE.forEach(function(s){typeof s.eventProperties=="function"&&Fv(r,s.eventProperties.call(i[s.pluginName],e))}),r},modifyOption:function(e,i,r){var s;return AE.forEach(function(n){e[n.pluginName]&&n.optionListeners&&typeof n.optionListeners[i]=="function"&&(s=n.optionListeners[i].call(e[n.pluginName],r))}),s}};function Tjt(t){var e=t.sortable,i=t.rootEl,r=t.name,s=t.targetEl,n=t.cloneEl,o=t.toEl,a=t.fromEl,l=t.oldIndex,c=t.newIndex,h=t.oldDraggableIndex,d=t.newDraggableIndex,f=t.originalEvent,m=t.putSortable,g=t.extraEventProperties;if(e=e||i&&i[Qc],!!e){var v,_=e.options,b="on"+r.charAt(0).toUpperCase()+r.substr(1);window.CustomEvent&&!Qv&&!JL?v=new CustomEvent(r,{bubbles:!0,cancelable:!0}):(v=document.createEvent("Event"),v.initEvent(r,!0,!0)),v.to=o||i,v.from=a||i,v.item=s||i,v.clone=n,v.oldIndex=l,v.newIndex=c,v.oldDraggableIndex=h,v.newDraggableIndex=d,v.originalEvent=f,v.pullMode=m?m.lastPutMode:void 0;var w=dg(dg({},g),XL.getEventProperties(r,e));for(var x in w)v[x]=w[x];i&&i.dispatchEvent(v),_[b]&&_[b].call(e,v)}}var Ejt=["evt"],Tc=function(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=r.evt,n=gjt(r,Ejt);XL.pluginEvent.bind(ci)(e,i,dg({dragEl:Be,parentEl:Mn,ghostEl:Ei,rootEl:sn,nextEl:ux,lastDownEl:eU,cloneEl:dn,cloneHidden:Y_,dragStarted:zR,putSortable:Fa,activeSortable:ci.active,originalEvent:s,oldIndex:LC,oldDraggableIndex:HP,newIndex:Vu,newDraggableIndex:L_,hideGhostForTarget:jBe,unhideGhostForTarget:GBe,cloneNowHidden:function(){Y_=!0},cloneNowShown:function(){Y_=!1},dispatchSortableEvent:function(a){Zl({sortable:i,name:a,originalEvent:s})}},n))};function Zl(t){Tjt(dg({putSortable:Fa,cloneEl:dn,targetEl:Be,rootEl:sn,oldIndex:LC,oldDraggableIndex:HP,newIndex:Vu,newDraggableIndex:L_},t))}var Be,Mn,Ei,sn,ux,eU,dn,Y_,LC,Vu,HP,L_,i4,Fa,X2=!1,BV=!1,VV=[],r1,lp,sW,nW,W1e,Z1e,zR,ME,qP,WP=!1,r4=!1,tU,cl,oW=[],Ote=!1,jV=[],gH=typeof document<"u",s4=Ule,Y1e=JL||Qv?"cssFloat":"float",Cjt=gH&&!RBe&&!Ule&&"draggable"in document.createElement("div"),UBe=function(){if(gH){if(Qv)return!1;var t=document.createElement("x");return t.style.cssText="pointer-events:auto",t.style.pointerEvents==="auto"}}(),BBe=function(e,i){var r=li(e),s=parseInt(r.width)-parseInt(r.paddingLeft)-parseInt(r.paddingRight)-parseInt(r.borderLeftWidth)-parseInt(r.borderRightWidth),n=zA(e,0,i),o=zA(e,1,i),a=n&&li(n),l=o&&li(o),c=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+_o(n).width,h=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+_o(o).width;if(r.display==="flex")return r.flexDirection==="column"||r.flexDirection==="column-reverse"?"vertical":"horizontal";if(r.display==="grid")return r.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(n&&a.float&&a.float!=="none"){var d=a.float==="left"?"left":"right";return o&&(l.clear==="both"||l.clear===d)?"vertical":"horizontal"}return n&&(a.display==="block"||a.display==="flex"||a.display==="table"||a.display==="grid"||c>=s&&r[Y1e]==="none"||o&&r[Y1e]==="none"&&c+h>s)?"vertical":"horizontal"},$jt=function(e,i,r){var s=r?e.left:e.top,n=r?e.right:e.bottom,o=r?e.width:e.height,a=r?i.left:i.top,l=r?i.right:i.bottom,c=r?i.width:i.height;return s===a||n===l||s+o/2===a+c/2},Ajt=function(e,i){var r;return VV.some(function(s){var n=s[Qc].options.emptyInsertThreshold;if(!(!n||Ble(s))){var o=_o(s),a=e>=o.left-n&&e<=o.right+n,l=i>=o.top-n&&i<=o.bottom+n;if(a&&l)return r=s}}),r},VBe=function(e){function i(n,o){return function(a,l,c,h){var d=a.options.group.name&&l.options.group.name&&a.options.group.name===l.options.group.name;if(n==null&&(o||d))return!0;if(n==null||n===!1)return!1;if(o&&n==="clone")return n;if(typeof n=="function")return i(n(a,l,c,h),o)(a,l,c,h);var f=(o?a:l).options.group.name;return n===!0||typeof n=="string"&&n===f||n.join&&n.indexOf(f)>-1}}var r={},s=e.group;(!s||Qz(s)!="object")&&(s={name:s}),r.name=s.name,r.checkPull=i(s.pull,!0),r.checkPut=i(s.put),r.revertClone=s.revertClone,e.group=r},jBe=function(){!UBe&&Ei&&li(Ei,"display","none")},GBe=function(){!UBe&&Ei&&li(Ei,"display","")};gH&&!RBe&&document.addEventListener("click",function(t){if(BV)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),BV=!1,!1},!0);var s1=function(e){if(Be){e=e.touches?e.touches[0]:e;var i=Ajt(e.clientX,e.clientY);if(i){var r={};for(var s in e)e.hasOwnProperty(s)&&(r[s]=e[s]);r.target=r.rootEl=i,r.preventDefault=void 0,r.stopPropagation=void 0,i[Qc]._onDragOver(r)}}},Mjt=function(e){Be&&Be.parentNode[Qc]._isOutsideThisEl(e.target)};function ci(t,e){if(!(t&&t.nodeType&&t.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.el=t,this.options=e=Fv({},e),t[Qc]=this;var i={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(t.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return BBe(t,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(o,a){o.setData("Text",a.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:ci.supportPointer!==!1&&"PointerEvent"in window&&(!jP||Ule),emptyInsertThreshold:5};XL.initializePlugins(this,t,i);for(var r in i)!(r in e)&&(e[r]=i[r]);VBe(e);for(var s in this)s.charAt(0)==="_"&&typeof this[s]=="function"&&(this[s]=this[s].bind(this));this.nativeDraggable=e.forceFallback?!1:Cjt,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?br(t,"pointerdown",this._onTapStart):(br(t,"mousedown",this._onTapStart),br(t,"touchstart",this._onTapStart)),this.nativeDraggable&&(br(t,"dragover",this),br(t,"dragenter",this)),VV.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),Fv(this,wjt())}ci.prototype={constructor:ci,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(ME=null)},_getDirection:function(e,i){return typeof this.options.direction=="function"?this.options.direction.call(this,e,i,Be):this.options.direction},_onTapStart:function(e){if(e.cancelable){var i=this,r=this.el,s=this.options,n=s.preventOnFilter,o=e.type,a=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,l=(a||e).target,c=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||l,h=s.filter;if(Fjt(r),!Be&&!(/mousedown|pointerdown/.test(o)&&e.button!==0||s.disabled)&&!c.isContentEditable&&!(!this.nativeDraggable&&jP&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=Vp(l,s.draggable,r,!1),!(l&&l.animated)&&eU!==l)){if(LC=qh(l),HP=qh(l,s.draggable),typeof h=="function"){if(h.call(this,e,l,this)){Zl({sortable:i,rootEl:c,name:"filter",targetEl:l,toEl:r,fromEl:r}),Tc("filter",i,{evt:e}),n&&e.preventDefault();return}}else if(h&&(h=h.split(",").some(function(d){if(d=Vp(c,d.trim(),r,!1),d)return Zl({sortable:i,rootEl:d,name:"filter",targetEl:l,fromEl:r,toEl:r}),Tc("filter",i,{evt:e}),!0}),h)){n&&e.preventDefault();return}s.handle&&!Vp(c,s.handle,r,!1)||this._prepareDragStart(e,a,l)}}},_prepareDragStart:function(e,i,r){var s=this,n=s.el,o=s.options,a=n.ownerDocument,l;if(r&&!Be&&r.parentNode===n){var c=_o(r);if(sn=n,Be=r,Mn=Be.parentNode,ux=Be.nextSibling,eU=r,i4=o.group,ci.dragged=Be,r1={target:Be,clientX:(i||e).clientX,clientY:(i||e).clientY},W1e=r1.clientX-c.left,Z1e=r1.clientY-c.top,this._lastX=(i||e).clientX,this._lastY=(i||e).clientY,Be.style["will-change"]="all",l=function(){if(Tc("delayEnded",s,{evt:e}),ci.eventCanceled){s._onDrop();return}s._disableDelayedDragEvents(),!j1e&&s.nativeDraggable&&(Be.draggable=!0),s._triggerDragStart(e,i),Zl({sortable:s,name:"choose",originalEvent:e}),ku(Be,o.chosenClass,!0)},o.ignore.split(",").forEach(function(h){LBe(Be,h.trim(),aW)}),br(a,"dragover",s1),br(a,"mousemove",s1),br(a,"touchmove",s1),o.supportPointer?(br(a,"pointerup",s._onDrop),!this.nativeDraggable&&br(a,"pointercancel",s._onDrop)):(br(a,"mouseup",s._onDrop),br(a,"touchend",s._onDrop),br(a,"touchcancel",s._onDrop)),j1e&&this.nativeDraggable&&(this.options.touchStartThreshold=4,Be.draggable=!0),Tc("delayStart",this,{evt:e}),o.delay&&(!o.delayOnTouchOnly||i)&&(!this.nativeDraggable||!(JL||Qv))){if(ci.eventCanceled){this._onDrop();return}o.supportPointer?(br(a,"pointerup",s._disableDelayedDrag),br(a,"pointercancel",s._disableDelayedDrag)):(br(a,"mouseup",s._disableDelayedDrag),br(a,"touchend",s._disableDelayedDrag),br(a,"touchcancel",s._disableDelayedDrag)),br(a,"mousemove",s._delayedDragTouchMoveHandler),br(a,"touchmove",s._delayedDragTouchMoveHandler),o.supportPointer&&br(a,"pointermove",s._delayedDragTouchMoveHandler),s._dragStartTimer=setTimeout(l,o.delay)}else l()}},_delayedDragTouchMoveHandler:function(e){var i=e.touches?e.touches[0]:e;Math.max(Math.abs(i.clientX-this._lastX),Math.abs(i.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){Be&&aW(Be),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;dr(e,"mouseup",this._disableDelayedDrag),dr(e,"touchend",this._disableDelayedDrag),dr(e,"touchcancel",this._disableDelayedDrag),dr(e,"pointerup",this._disableDelayedDrag),dr(e,"pointercancel",this._disableDelayedDrag),dr(e,"mousemove",this._delayedDragTouchMoveHandler),dr(e,"touchmove",this._delayedDragTouchMoveHandler),dr(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,i){i=i||e.pointerType=="touch"&&e,!this.nativeDraggable||i?this.options.supportPointer?br(document,"pointermove",this._onTouchMove):i?br(document,"touchmove",this._onTouchMove):br(document,"mousemove",this._onTouchMove):(br(Be,"dragend",this),br(sn,"dragstart",this._onDragStart));try{document.selection?iU(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,i){if(X2=!1,sn&&Be){Tc("dragStarted",this,{evt:i}),this.nativeDraggable&&br(document,"dragover",Mjt);var r=this.options;!e&&ku(Be,r.dragClass,!1),ku(Be,r.ghostClass,!0),ci.active=this,e&&this._appendGhost(),Zl({sortable:this,name:"start",originalEvent:i})}else this._nulling()},_emulateDragOver:function(){if(lp){this._lastX=lp.clientX,this._lastY=lp.clientY,jBe();for(var e=document.elementFromPoint(lp.clientX,lp.clientY),i=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(lp.clientX,lp.clientY),e!==i);)i=e;if(Be.parentNode[Qc]._isOutsideThisEl(e),i)do{if(i[Qc]){var r=void 0;if(r=i[Qc]._onDragOver({clientX:lp.clientX,clientY:lp.clientY,target:e,rootEl:i}),r&&!this.options.dragoverBubble)break}e=i}while(i=DBe(i));GBe()}},_onTouchMove:function(e){if(r1){var i=this.options,r=i.fallbackTolerance,s=i.fallbackOffset,n=e.touches?e.touches[0]:e,o=Ei&&m$(Ei,!0),a=Ei&&o&&o.a,l=Ei&&o&&o.d,c=s4&&cl&&q1e(cl),h=(n.clientX-r1.clientX+s.x)/(a||1)+(c?c[0]-oW[0]:0)/(a||1),d=(n.clientY-r1.clientY+s.y)/(l||1)+(c?c[1]-oW[1]:0)/(l||1);if(!ci.active&&!X2){if(r&&Math.max(Math.abs(n.clientX-this._lastX),Math.abs(n.clientY-this._lastY))<r)return;this._onDragStart(e,!0)}if(Ei){o?(o.e+=h-(sW||0),o.f+=d-(nW||0)):o={a:1,b:0,c:0,d:1,e:h,f:d};var f="matrix(".concat(o.a,",").concat(o.b,",").concat(o.c,",").concat(o.d,",").concat(o.e,",").concat(o.f,")");li(Ei,"webkitTransform",f),li(Ei,"mozTransform",f),li(Ei,"msTransform",f),li(Ei,"transform",f),sW=h,nW=d,lp=n}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!Ei){var e=this.options.fallbackOnBody?document.body:sn,i=_o(Be,!0,s4,!0,e),r=this.options;if(s4){for(cl=e;li(cl,"position")==="static"&&li(cl,"transform")==="none"&&cl!==document;)cl=cl.parentNode;cl!==document.body&&cl!==document.documentElement?(cl===document&&(cl=Xm()),i.top+=cl.scrollTop,i.left+=cl.scrollLeft):cl=Xm(),oW=q1e(cl)}Ei=Be.cloneNode(!0),ku(Ei,r.ghostClass,!1),ku(Ei,r.fallbackClass,!0),ku(Ei,r.dragClass,!0),li(Ei,"transition",""),li(Ei,"transform",""),li(Ei,"box-sizing","border-box"),li(Ei,"margin",0),li(Ei,"top",i.top),li(Ei,"left",i.left),li(Ei,"width",i.width),li(Ei,"height",i.height),li(Ei,"opacity","0.8"),li(Ei,"position",s4?"absolute":"fixed"),li(Ei,"zIndex","100000"),li(Ei,"pointerEvents","none"),ci.ghost=Ei,e.appendChild(Ei),li(Ei,"transform-origin",W1e/parseInt(Ei.style.width)*100+"% "+Z1e/parseInt(Ei.style.height)*100+"%")}},_onDragStart:function(e,i){var r=this,s=e.dataTransfer,n=r.options;if(Tc("dragStart",this,{evt:e}),ci.eventCanceled){this._onDrop();return}Tc("setupClone",this),ci.eventCanceled||(dn=kBe(Be),dn.removeAttribute("id"),dn.draggable=!1,dn.style["will-change"]="",this._hideClone(),ku(dn,this.options.chosenClass,!1),ci.clone=dn),r.cloneId=iU(function(){Tc("clone",r),!ci.eventCanceled&&(r.options.removeCloneOnHide||sn.insertBefore(dn,Be),r._hideClone(),Zl({sortable:r,name:"clone"}))}),!i&&ku(Be,n.dragClass,!0),i?(BV=!0,r._loopId=setInterval(r._emulateDragOver,50)):(dr(document,"mouseup",r._onDrop),dr(document,"touchend",r._onDrop),dr(document,"touchcancel",r._onDrop),s&&(s.effectAllowed="move",n.setData&&n.setData.call(r,s,Be)),br(document,"drop",r),li(Be,"transform","translateZ(0)")),X2=!0,r._dragStartId=iU(r._dragStarted.bind(r,i,e)),br(document,"selectstart",r),zR=!0,window.getSelection().removeAllRanges(),jP&&li(document.body,"user-select","none")},_onDragOver:function(e){var i=this.el,r=e.target,s,n,o,a=this.options,l=a.group,c=ci.active,h=i4===l,d=a.sort,f=Fa||c,m,g=this,v=!1;if(Ote)return;function _(B,te){Tc(B,g,dg({evt:e,isOwner:h,axis:m?"vertical":"horizontal",revert:o,dragRect:s,targetRect:n,canSort:d,fromSortable:f,target:r,completed:w,onMove:function(de,Ae){return n4(sn,i,Be,s,de,_o(de),e,Ae)},changed:x},te))}function b(){_("dragOverAnimationCapture"),g.captureAnimationState(),g!==f&&f.captureAnimationState()}function w(B){return _("dragOverCompleted",{insertion:B}),B&&(h?c._hideClone():c._showClone(g),g!==f&&(ku(Be,Fa?Fa.options.ghostClass:c.options.ghostClass,!1),ku(Be,a.ghostClass,!0)),Fa!==g&&g!==ci.active?Fa=g:g===ci.active&&Fa&&(Fa=null),f===g&&(g._ignoreWhileAnimating=r),g.animateAll(function(){_("dragOverAnimationComplete"),g._ignoreWhileAnimating=null}),g!==f&&(f.animateAll(),f._ignoreWhileAnimating=null)),(r===Be&&!Be.animated||r===i&&!r.animated)&&(ME=null),!a.dragoverBubble&&!e.rootEl&&r!==document&&(Be.parentNode[Qc]._isOutsideThisEl(e.target),!B&&s1(e)),!a.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),v=!0}function x(){Vu=qh(Be),L_=qh(Be,a.draggable),Zl({sortable:g,name:"change",toEl:i,newIndex:Vu,newDraggableIndex:L_,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),r=Vp(r,a.draggable,i,!0),_("dragOver"),ci.eventCanceled)return v;if(Be.contains(e.target)||r.animated&&r.animatingX&&r.animatingY||g._ignoreWhileAnimating===r)return w(!1);if(BV=!1,c&&!a.disabled&&(h?d||(o=Mn!==sn):Fa===this||(this.lastPutMode=i4.checkPull(this,c,Be,e))&&l.checkPut(this,c,Be,e))){if(m=this._getDirection(e,r)==="vertical",s=_o(Be),_("dragOverValid"),ci.eventCanceled)return v;if(o)return Mn=sn,b(),this._hideClone(),_("revert"),ci.eventCanceled||(ux?sn.insertBefore(Be,ux):sn.appendChild(Be)),w(!0);var S=Ble(i,a.draggable);if(!S||Pjt(e,m,this)&&!S.animated){if(S===Be)return w(!1);if(S&&i===e.target&&(r=S),r&&(n=_o(r)),n4(sn,i,Be,s,r,n,e,!!r)!==!1)return b(),S&&S.nextSibling?i.insertBefore(Be,S.nextSibling):i.appendChild(Be),Mn=i,x(),w(!0)}else if(S&&Rjt(e,m,this)){var C=zA(i,0,a,!0);if(C===Be)return w(!1);if(r=C,n=_o(r),n4(sn,i,Be,s,r,n,e,!1)!==!1)return b(),i.insertBefore(Be,C),Mn=i,x(),w(!0)}else if(r.parentNode===i){n=_o(r);var T=0,M,I=Be.parentNode!==i,D=!$jt(Be.animated&&Be.toRect||s,r.animated&&r.toRect||n,m),P=m?"top":"left",F=H1e(r,"top","top")||H1e(Be,"top","top"),L=F?F.scrollTop:void 0;ME!==r&&(M=n[P],WP=!1,r4=!D&&a.invertSwap||I),T=Djt(e,r,n,m,D?1:a.swapThreshold,a.invertedSwapThreshold==null?a.swapThreshold:a.invertedSwapThreshold,r4,ME===r);var N;if(T!==0){var R=qh(Be);do R-=T,N=Mn.children[R];while(N&&(li(N,"display")==="none"||N===Ei))}if(T===0||N===r)return w(!1);ME=r,qP=T;var k=r.nextElementSibling,W=!1;W=T===1;var j=n4(sn,i,Be,s,r,n,e,W);if(j!==!1)return(j===1||j===-1)&&(W=j===1),Ote=!0,setTimeout(Ijt,30),b(),W&&!k?i.appendChild(Be):r.parentNode.insertBefore(Be,W?k:r),F&&FBe(F,0,L-F.scrollTop),Mn=Be.parentNode,M!==void 0&&!r4&&(tU=Math.abs(M-_o(r)[P])),x(),w(!0)}if(i.contains(Be))return w(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){dr(document,"mousemove",this._onTouchMove),dr(document,"touchmove",this._onTouchMove),dr(document,"pointermove",this._onTouchMove),dr(document,"dragover",s1),dr(document,"mousemove",s1),dr(document,"touchmove",s1)},_offUpEvents:function(){var e=this.el.ownerDocument;dr(e,"mouseup",this._onDrop),dr(e,"touchend",this._onDrop),dr(e,"pointerup",this._onDrop),dr(e,"pointercancel",this._onDrop),dr(e,"touchcancel",this._onDrop),dr(document,"selectstart",this)},_onDrop:function(e){var i=this.el,r=this.options;if(Vu=qh(Be),L_=qh(Be,r.draggable),Tc("drop",this,{evt:e}),Mn=Be&&Be.parentNode,Vu=qh(Be),L_=qh(Be,r.draggable),ci.eventCanceled){this._nulling();return}X2=!1,r4=!1,WP=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Ite(this.cloneId),Ite(this._dragStartId),this.nativeDraggable&&(dr(document,"drop",this),dr(i,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),jP&&li(document.body,"user-select",""),li(Be,"transform",""),e&&(zR&&(e.cancelable&&e.preventDefault(),!r.dropBubble&&e.stopPropagation()),Ei&&Ei.parentNode&&Ei.parentNode.removeChild(Ei),(sn===Mn||Fa&&Fa.lastPutMode!=="clone")&&dn&&dn.parentNode&&dn.parentNode.removeChild(dn),Be&&(this.nativeDraggable&&dr(Be,"dragend",this),aW(Be),Be.style["will-change"]="",zR&&!X2&&ku(Be,Fa?Fa.options.ghostClass:this.options.ghostClass,!1),ku(Be,this.options.chosenClass,!1),Zl({sortable:this,name:"unchoose",toEl:Mn,newIndex:null,newDraggableIndex:null,originalEvent:e}),sn!==Mn?(Vu>=0&&(Zl({rootEl:Mn,name:"add",toEl:Mn,fromEl:sn,originalEvent:e}),Zl({sortable:this,name:"remove",toEl:Mn,originalEvent:e}),Zl({rootEl:Mn,name:"sort",toEl:Mn,fromEl:sn,originalEvent:e}),Zl({sortable:this,name:"sort",toEl:Mn,originalEvent:e})),Fa&&Fa.save()):Vu!==LC&&Vu>=0&&(Zl({sortable:this,name:"update",toEl:Mn,originalEvent:e}),Zl({sortable:this,name:"sort",toEl:Mn,originalEvent:e})),ci.active&&((Vu==null||Vu===-1)&&(Vu=LC,L_=HP),Zl({sortable:this,name:"end",toEl:Mn,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){Tc("nulling",this),sn=Be=Mn=Ei=ux=dn=eU=Y_=r1=lp=zR=Vu=L_=LC=HP=ME=qP=Fa=i4=ci.dragged=ci.ghost=ci.clone=ci.active=null,jV.forEach(function(e){e.checked=!0}),jV.length=sW=nW=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":Be&&(this._onDragOver(e),Ojt(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],i,r=this.el.children,s=0,n=r.length,o=this.options;s<n;s++)i=r[s],Vp(i,o.draggable,this.el,!1)&&e.push(i.getAttribute(o.dataIdAttr)||Njt(i));return e},sort:function(e,i){var r={},s=this.el;this.toArray().forEach(function(n,o){var a=s.children[o];Vp(a,this.options.draggable,s,!1)&&(r[n]=a)},this),i&&this.captureAnimationState(),e.forEach(function(n){r[n]&&(s.removeChild(r[n]),s.appendChild(r[n]))}),i&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,i){return Vp(e,i||this.options.draggable,this.el,!1)},option:function(e,i){var r=this.options;if(i===void 0)return r[e];var s=XL.modifyOption(this,e,i);typeof s<"u"?r[e]=s:r[e]=i,e==="group"&&VBe(r)},destroy:function(){Tc("destroy",this);var e=this.el;e[Qc]=null,dr(e,"mousedown",this._onTapStart),dr(e,"touchstart",this._onTapStart),dr(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(dr(e,"dragover",this),dr(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(i){i.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),VV.splice(VV.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!Y_){if(Tc("hideClone",this),ci.eventCanceled)return;li(dn,"display","none"),this.options.removeCloneOnHide&&dn.parentNode&&dn.parentNode.removeChild(dn),Y_=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(Y_){if(Tc("showClone",this),ci.eventCanceled)return;Be.parentNode==sn&&!this.options.group.revertClone?sn.insertBefore(dn,Be):ux?sn.insertBefore(dn,ux):sn.appendChild(dn),this.options.group.revertClone&&this.animate(Be,dn),li(dn,"display",""),Y_=!1}}};function Ojt(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move"),t.cancelable&&t.preventDefault()}function n4(t,e,i,r,s,n,o,a){var l,c=t[Qc],h=c.options.onMove,d;return window.CustomEvent&&!Qv&&!JL?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=e,l.from=t,l.dragged=i,l.draggedRect=r,l.related=s||e,l.relatedRect=n||_o(e),l.willInsertAfter=a,l.originalEvent=o,t.dispatchEvent(l),h&&(d=h.call(c,l,o)),d}function aW(t){t.draggable=!1}function Ijt(){Ote=!1}function Rjt(t,e,i){var r=_o(zA(i.el,0,i.options,!0)),s=zBe(i.el,i.options,Ei),n=10;return e?t.clientX<s.left-n||t.clientY<r.top&&t.clientX<r.right:t.clientY<s.top-n||t.clientY<r.bottom&&t.clientX<r.left}function Pjt(t,e,i){var r=_o(Ble(i.el,i.options.draggable)),s=zBe(i.el,i.options,Ei),n=10;return e?t.clientX>s.right+n||t.clientY>r.bottom&&t.clientX>r.left:t.clientY>s.bottom+n||t.clientX>r.right&&t.clientY>r.top}function Djt(t,e,i,r,s,n,o,a){var l=r?t.clientY:t.clientX,c=r?i.height:i.width,h=r?i.top:i.left,d=r?i.bottom:i.right,f=!1;if(!o){if(a&&tU<c*s){if(!WP&&(qP===1?l>h+c*n/2:l<d-c*n/2)&&(WP=!0),WP)f=!0;else if(qP===1?l<h+tU:l>d-tU)return-qP}else if(l>h+c*(1-s)/2&&l<d-c*(1-s)/2)return Ljt(e)}return f=f||o,f&&(l<h+c*n/2||l>d-c*n/2)?l>h+c/2?1:-1:0}function Ljt(t){return qh(Be)<qh(t)?1:-1}function Njt(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,i=e.length,r=0;i--;)r+=e.charCodeAt(i);return r.toString(36)}function Fjt(t){jV.length=0;for(var e=t.getElementsByTagName("input"),i=e.length;i--;){var r=e[i];r.checked&&jV.push(r)}}function iU(t){return setTimeout(t,0)}function Ite(t){return clearTimeout(t)}gH&&br(document,"touchmove",function(t){(ci.active||X2)&&t.cancelable&&t.preventDefault()});ci.utils={on:br,off:dr,css:li,find:LBe,is:function(e,i){return!!Vp(e,i,e,!1)},extend:_jt,throttle:NBe,closest:Vp,toggleClass:ku,clone:kBe,index:qh,nextTick:iU,cancelNextTick:Ite,detectDirection:BBe,getChild:zA,expando:Qc};ci.get=function(t){return t[Qc]};ci.mount=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];e[0].constructor===Array&&(e=e[0]),e.forEach(function(r){if(!r.prototype||!r.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(r));r.utils&&(ci.utils=dg(dg({},ci.utils),r.utils)),XL.mount(r)})};ci.create=function(t,e){return new ci(t,e)};ci.version=yjt;var mo=[],UR,Rte,Pte=!1,lW,cW,GV,BR;function kjt(){function t(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return t.prototype={dragStarted:function(i){var r=i.originalEvent;this.sortable.nativeDraggable?br(document,"dragover",this._handleAutoScroll):this.options.supportPointer?br(document,"pointermove",this._handleFallbackAutoScroll):r.touches?br(document,"touchmove",this._handleFallbackAutoScroll):br(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(i){var r=i.originalEvent;!this.options.dragOverBubble&&!r.rootEl&&this._handleAutoScroll(r)},drop:function(){this.sortable.nativeDraggable?dr(document,"dragover",this._handleAutoScroll):(dr(document,"pointermove",this._handleFallbackAutoScroll),dr(document,"touchmove",this._handleFallbackAutoScroll),dr(document,"mousemove",this._handleFallbackAutoScroll)),J1e(),rU(),bjt()},nulling:function(){GV=Rte=UR=Pte=BR=lW=cW=null,mo.length=0},_handleFallbackAutoScroll:function(i){this._handleAutoScroll(i,!0)},_handleAutoScroll:function(i,r){var s=this,n=(i.touches?i.touches[0]:i).clientX,o=(i.touches?i.touches[0]:i).clientY,a=document.elementFromPoint(n,o);if(GV=i,r||this.options.forceAutoScrollFallback||JL||Qv||jP){uW(i,this.options,a,r);var l=yb(a,!0);Pte&&(!BR||n!==lW||o!==cW)&&(BR&&J1e(),BR=setInterval(function(){var c=yb(document.elementFromPoint(n,o),!0);c!==l&&(l=c,rU()),uW(i,s.options,c,r)},10),lW=n,cW=o)}else{if(!this.options.bubbleScroll||yb(a,!0)===Xm()){rU();return}uW(i,this.options,yb(a,!1),!1)}}},Fv(t,{pluginName:"scroll",initializeByDefault:!0})}function rU(){mo.forEach(function(t){clearInterval(t.pid)}),mo=[]}function J1e(){clearInterval(BR)}var uW=NBe(function(t,e,i,r){if(e.scroll){var s=(t.touches?t.touches[0]:t).clientX,n=(t.touches?t.touches[0]:t).clientY,o=e.scrollSensitivity,a=e.scrollSpeed,l=Xm(),c=!1,h;Rte!==i&&(Rte=i,rU(),UR=e.scroll,h=e.scrollFn,UR===!0&&(UR=yb(i,!0)));var d=0,f=UR;do{var m=f,g=_o(m),v=g.top,_=g.bottom,b=g.left,w=g.right,x=g.width,S=g.height,C=void 0,T=void 0,M=m.scrollWidth,I=m.scrollHeight,D=li(m),P=m.scrollLeft,F=m.scrollTop;m===l?(C=x<M&&(D.overflowX==="auto"||D.overflowX==="scroll"||D.overflowX==="visible"),T=S<I&&(D.overflowY==="auto"||D.overflowY==="scroll"||D.overflowY==="visible")):(C=x<M&&(D.overflowX==="auto"||D.overflowX==="scroll"),T=S<I&&(D.overflowY==="auto"||D.overflowY==="scroll"));var L=C&&(Math.abs(w-s)<=o&&P+x<M)-(Math.abs(b-s)<=o&&!!P),N=T&&(Math.abs(_-n)<=o&&F+S<I)-(Math.abs(v-n)<=o&&!!F);if(!mo[d])for(var R=0;R<=d;R++)mo[R]||(mo[R]={});(mo[d].vx!=L||mo[d].vy!=N||mo[d].el!==m)&&(mo[d].el=m,mo[d].vx=L,mo[d].vy=N,clearInterval(mo[d].pid),(L!=0||N!=0)&&(c=!0,mo[d].pid=setInterval((function(){r&&this.layer===0&&ci.active._onTouchMove(GV);var k=mo[this.layer].vy?mo[this.layer].vy*a:0,W=mo[this.layer].vx?mo[this.layer].vx*a:0;typeof h=="function"&&h.call(ci.dragged.parentNode[Qc],W,k,t,GV,mo[this.layer].el)!=="continue"||FBe(mo[this.layer].el,W,k)}).bind({layer:d}),24))),d++}while(e.bubbleScroll&&f!==l&&(f=yb(f,!1)));Pte=c}},30),HBe=function(e){var i=e.originalEvent,r=e.putSortable,s=e.dragEl,n=e.activeSortable,o=e.dispatchSortableEvent,a=e.hideGhostForTarget,l=e.unhideGhostForTarget;if(i){var c=r||n;a();var h=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:i,d=document.elementFromPoint(h.clientX,h.clientY);l(),c&&!c.el.contains(d)&&(o("spill"),this.onSpill({dragEl:s,putSortable:r}))}};function Vle(){}Vle.prototype={startIndex:null,dragStart:function(e){var i=e.oldDraggableIndex;this.startIndex=i},onSpill:function(e){var i=e.dragEl,r=e.putSortable;this.sortable.captureAnimationState(),r&&r.captureAnimationState();var s=zA(this.sortable.el,this.startIndex,this.options);s?this.sortable.el.insertBefore(i,s):this.sortable.el.appendChild(i),this.sortable.animateAll(),r&&r.animateAll()},drop:HBe};Fv(Vle,{pluginName:"revertOnSpill"});function jle(){}jle.prototype={onSpill:function(e){var i=e.dragEl,r=e.putSortable,s=r||this.sortable;s.captureAnimationState(),i.parentNode&&i.parentNode.removeChild(i),s.animateAll()},drop:HBe};Fv(jle,{pluginName:"removeOnSpill"});ci.mount(new kjt);ci.mount(jle,Vle);/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const yH=new Set,zjt={ghostClass:"calcite-sortable--ghost",chosenClass:"calcite-sortable--chosen",dragClass:"calcite-sortable--drag",fallbackClass:"calcite-sortable--fallback"};function Ujt(t){if(WBe(t))return;qBe(t),yH.add(t);const e="id",{group:i,handleSelector:r,dragSelector:s}=t;t.sortable=ci.create(t.el,{dataIdAttr:e,...zjt,...!!s&&{draggable:s},...!!i&&{group:{name:i,...!!t.canPull&&{pull:(n,o,a,{newDraggableIndex:l,oldDraggableIndex:c})=>t.canPull({toEl:n.el,fromEl:o.el,dragEl:a,newIndex:l,oldIndex:c})},...!!t.canPut&&{put:(n,o,a,{newDraggableIndex:l,oldDraggableIndex:c})=>t.canPut({toEl:n.el,fromEl:o.el,dragEl:a,newIndex:l,oldIndex:c})}}},onMove:({from:n,dragged:o,to:a,related:l})=>{t.onDragMove&&t.onDragMove({fromEl:n,dragEl:o,toEl:a,relatedEl:l})},handle:r,filter:`${r}[disabled]`,onStart:({from:n,item:o,to:a,newDraggableIndex:l,oldDraggableIndex:c})=>{Dte.active=!0,Bjt(),t.onDragStart({fromEl:n,dragEl:o,toEl:a,newIndex:l,oldIndex:c})},onEnd:({from:n,item:o,to:a,newDraggableIndex:l,oldDraggableIndex:c})=>{Dte.active=!1,Vjt(),t.onDragEnd({fromEl:n,dragEl:o,toEl:a,newIndex:l,oldIndex:c})},onSort:({from:n,item:o,to:a,newDraggableIndex:l,oldDraggableIndex:c})=>{t.onDragSort({fromEl:n,dragEl:o,toEl:a,newIndex:l,oldIndex:c})}})}function qBe(t){var e;WBe(t)||(yH.delete(t),(e=t.sortable)==null||e.destroy(),t.sortable=null)}const Dte={active:!1};function WBe(t){return t.dragEnabled&&Dte.active}function Bjt(){Array.from(yH).forEach(t=>t.onGlobalDragStart())}function Vjt(){Array.from(yH).forEach(t=>t.onGlobalDragEnd())}/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const N0={container:"container",table:"table",scrim:"scrim",stack:"stack",tableContainer:"table-container",sticky:"sticky-pos",assistiveText:"assistive-text"},hW={filterNoResults:"filter-no-results",filterActionsStart:"filter-actions-start",filterActionsEnd:"filter-actions-end"},jjt=Ks`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:block}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}.container{position:relative;background-color:var(--calcite-list-background-color, var(--calcite-color-foreground-1))}.table-container{box-sizing:border-box;display:flex;inline-size:100%;flex-direction:column;background-color:transparent}.table-container *{box-sizing:border-box}.table{inline-size:100%}.stack{--calcite-stack-padding-inline: 0;--calcite-stack-padding-block: 0}.sticky-pos{position:sticky;inset-block-start:0px;z-index:var(--calcite-z-index-sticky);background-color:var(--calcite-list-background-color, var(--calcite-color-foreground-1))}.assistive-text{position:absolute;inline-size:1px;block-size:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}:host([hidden]){display:none}[hidden]{display:none}`,Gjt=`${zV}, ${ev}`,_j=class _j extends Hn{constructor(){super(),this.dragSelector=ev,this.focusableItems=[],this.handleSelector="calcite-sort-handle",this.listItems=[],this.listItemGroups=[],this.mutationObserver=Tf("mutation",()=>{this.willPerformFilter=!0,this.updateListItems()}),this.updateListItems=zle(()=>{this.updateGroupItems();const{selectionAppearance:e,selectionMode:i,interactionMode:r,dragEnabled:s,el:n,filterEl:o,moveToItems:a,displayMode:l,scale:c}=this,h=Array.from(this.el.querySelectorAll(ev));if(h.forEach(d=>{d.scale=c,d.selectionAppearance=e,d.selectionMode=i,d.interactionMode=r,d.closest(VP)===n&&(d.moveToItems=a.filter(f=>f.element!==n&&!d.contains(f.element)),d.dragHandle=s,d.displayMode=l)}),this.parentListEl){this.setUpSorting();return}this.listItems=h,this.filterEnabled&&this.willPerformFilter&&(this.willPerformFilter=!1,this.dataForFilter=this.getItemData(),o&&(o.items=this.dataForFilter,this.filterAndUpdateData())),this.visibleItems=this.listItems.filter(d=>!d.closed&&!d.hidden),this.updateFilteredItems(),this.borderItems(),this.focusableItems=this.filteredItems.filter(d=>!d.disabled),this.setActiveListItem(),this.updateSelectedItems(),this.setUpSorting()},dB.nextTick),this.visibleItems=[],this.willFilterEmit=!1,this.willPerformFilter=!1,this.messages=Vd({blocking:!0}),this.dataForFilter=[],this.hasFilterActionsEnd=!1,this.hasFilterActionsStart=!1,this.hasFilterNoResults=!1,this.moveToItems=[],this.disabled=!1,this.dragEnabled=!1,this.filterEnabled=!1,this.filteredData=[],this.filteredItems=[],this.interactionMode="interactive",this.loading=!1,this.displayMode="flat",this.scale="m",this.selectedItems=[],this.selectionAppearance="icon",this.selectionMode="none",this.calciteInternalListDefaultSlotChange=Gt({cancelable:!1}),this.calciteListChange=Gt({cancelable:!1}),this.calciteListDragEnd=Gt({cancelable:!1}),this.calciteListDragStart=Gt({cancelable:!1}),this.calciteListFilter=Gt({cancelable:!1}),this.calciteListMoveHalt=Gt({cancelable:!1}),this.calciteListOrderChange=Gt({cancelable:!1}),this.listen("calciteInternalListItemToggle",this.handleCalciteListItemToggle),this.listen("calciteInternalFocusPreviousItem",this.handleCalciteInternalFocusPreviousItem),this.listen("calciteInternalListItemActive",this.handleCalciteInternalListItemActive),this.listen("calciteListItemSelect",this.handleCalciteListItemSelect),this.listen("calciteInternalAssistiveTextChange",this.handleCalciteInternalAssistiveTextChange),this.listen("calciteSortHandleReorder",this.handleSortReorder),this.listen("calciteSortHandleMove",this.handleSortMove),this.listen("calciteInternalListItemSelect",this.handleCalciteInternalListItemSelect),this.listen("calciteInternalListItemSelectMultiple",this.handleCalciteInternalListItemSelectMultiple),this.listen("calciteInternalListItemChange",this.handleCalciteInternalListItemChange),this.listen("calciteInternalListItemGroupDefaultSlotChange",this.handleCalciteInternalListItemGroupDefaultSlotChange)}get hasActiveFilter(){return this.filterEnabled&&this.filterText&&this.filteredItems.length!==this.visibleItems.length}get showNoResultsContainer(){return this.filterEnabled&&this.filterText&&this.hasFilterNoResults&&this.visibleItems.length&&!this.filteredItems.length}putFailed(e){this.calciteListMoveHalt.emit(e)}async setFocus(){var e,i;return await yh(this),this.filterEnabled?(e=this.filterEl)==null?void 0:e.setFocus():(i=this.focusableItems.find(r=>r.active))==null?void 0:i.setFocus()}connectedCallback(){super.connectedCallback(),this.connectObserver(),this.willPerformFilter=!0,this.updateListItems(),this.setUpSorting(),this.setParentList(),this.setListItemGroups()}async load(){this.handleInteractionModeWarning()}willUpdate(e){(e.has("filterText")||e.has("filterProps")||e.has("filterPredicate"))&&this.performFilter(),(e.has("filterEnabled")&&(this.hasUpdated||this.filterEnabled!==!1)||e.has("group")||e.has("dragEnabled")&&(this.hasUpdated||this.dragEnabled!==!1)||e.has("selectionMode")&&(this.hasUpdated||this.selectionMode!=="none")||e.has("selectionAppearance")&&(this.hasUpdated||this.selectionAppearance!=="icon")||e.has("displayMode")&&this.hasUpdated||e.has("scale")&&this.hasUpdated||e.has("filterPredicate")&&this.hasUpdated)&&this.handleListItemChange()}updated(){Cg(this)}disconnectedCallback(){super.disconnectedCallback(),this.disconnectObserver(),qBe(this)}handleListItemChange(){this.willPerformFilter=!0,this.updateListItems()}handleCalciteListItemToggle(e){this.parentListEl||(e.stopPropagation(),this.borderItems())}handleCalciteInternalFocusPreviousItem(e){if(this.parentListEl)return;e.stopPropagation();const{focusableItems:i}=this,s=i.findIndex(n=>n.active)-1;i[s]&&this.focusRow(i[s])}handleCalciteInternalListItemActive(e){if(this.parentListEl)return;e.stopPropagation();const i=e.target,{listItems:r}=this;r.forEach(s=>{s.active=s===i})}handleCalciteListItemSelect(){this.parentListEl||this.updateSelectedItems(!0)}handleCalciteInternalAssistiveTextChange(e){this.assistiveText=e.detail.message,e.stopPropagation()}handleSortReorder(e){this.parentListEl||e.defaultPrevented||(e.preventDefault(),this.handleReorder(e))}handleSortMove(e){this.parentListEl||e.defaultPrevented||(e.preventDefault(),this.handleMove(e))}handleCalciteInternalListItemSelect(e){if(this.parentListEl)return;e.stopPropagation();const i=e.target,{listItems:r,selectionMode:s}=this;i.selected&&(s==="single"||s==="single-persist")&&r.forEach(n=>n.selected=n===i),this.updateSelectedItems()}handleCalciteInternalListItemSelectMultiple(e){if(this.parentListEl)return;e.stopPropagation();const{target:i,detail:r}=e,{focusableItems:s,lastSelectedInfo:n}=this,o=i;if(r.selectMultiple&&n){const a=s.indexOf(o),l=s.indexOf(n.selectedItem),c=Math.min(l,a),h=Math.max(l,a);s.slice(c,h+1).forEach(d=>d.selected=n.selected)}else this.lastSelectedInfo={selectedItem:o,selected:o.selected}}handleCalciteInternalListItemChange(e){this.parentListEl||(e.stopPropagation(),this.updateListItems())}handleCalciteInternalListItemGroupDefaultSlotChange(e){e.stopPropagation()}connectObserver(){var e;(e=this.mutationObserver)==null||e.observe(this.el,{childList:!0,subtree:!0})}disconnectObserver(){var e;(e=this.mutationObserver)==null||e.disconnect()}setUpSorting(){const{dragEnabled:e,defaultSlotEl:i}=this;e&&(i&&djt(i),Ujt(this))}onGlobalDragStart(){this.disconnectObserver()}onGlobalDragEnd(){this.connectObserver()}onDragEnd(e){this.calciteListDragEnd.emit(e)}onDragStart(e){e.dragEl.sortHandleOpen=!1,this.calciteListDragStart.emit(e)}onDragSort(e){this.setParentList(),this.updateListItems(),this.calciteListOrderChange.emit(e)}setParentList(){var e;this.parentListEl=(e=this.el.parentElement)==null?void 0:e.closest(VP)}handleDefaultSlotChange(){this.parentListEl&&this.calciteInternalListDefaultSlotChange.emit()}setListItemGroups(){this.listItemGroups=Array.from(this.el.querySelectorAll(zV))}handleFilterActionsStartSlotChange(e){this.hasFilterActionsStart=Os(e)}handleFilterActionsEndSlotChange(e){this.hasFilterActionsEnd=Os(e)}handleFilterNoResultsSlotChange(e){this.hasFilterNoResults=Os(e)}setActiveListItem(){const{focusableItems:e}=this;e.some(i=>i.active)||e[0]&&(e[0].active=!0)}async updateSelectedItems(e=!1){await this.updateComplete,this.selectedItems=this.visibleItems.filter(i=>i.selected),e&&this.calciteListChange.emit()}filterElements({el:e,filteredItems:i,visibleParents:r}){const s=!r.has(e)&&!i.includes(e);e.filterHidden=s;const n=e.parentElement.closest(Gjt);n&&(s||r.add(n),this.filterElements({el:n,filteredItems:i,visibleParents:r}))}allParentListItemsExpanded(e){var r;const i=(r=e.parentElement)==null?void 0:r.closest(ev);if(i){if(!i.expanded)return!1}else return!0;return this.allParentListItemsExpanded(i)}borderItems(){const e=this.visibleItems.filter(i=>!i.filterHidden&&this.allParentListItemsExpanded(i));e.forEach(i=>i.bordered=i!==e[e.length-1])}updateFilteredItems(){const{visibleItems:e,filteredData:i,filterText:r,filterPredicate:s}=this,n=e==null?void 0:e.filter(l=>e.every(c=>c===l||!l.contains(c))),o=s?e.filter(s):r?i.map(l=>l.el):e||[],a=new WeakSet;n.forEach(l=>this.filterElements({el:l,filteredItems:o,visibleParents:a})),this.filteredItems=o,this.willFilterEmit&&(this.willFilterEmit=!1,this.calciteListFilter.emit())}updateFilteredData(){const{filterEl:e}=this;e&&(e.filteredItems&&(this.filteredData=e.filteredItems),this.updateListItems())}async filterAndUpdateData(){var e;await((e=this.filterEl)==null?void 0:e.filter(this.filterText)),this.updateFilteredData()}get effectiveFilterProps(){return this.filterProps?this.filterProps.filter(e=>e!=="el"):["description","label","metadata","heading"]}performFilter(){const{filterEl:e,filterText:i,effectiveFilterProps:r}=this;e&&(e.value=i,e.filterProps=r,this.filterAndUpdateData())}setDefaultSlotEl(e){this.defaultSlotEl=e}setFilterEl(e){this.filterEl=e,this.performFilter()}handleFilterChange(e){e.stopPropagation();const{value:i}=e.currentTarget;this.filterText=i,this.willFilterEmit=!0,this.updateFilteredData()}getItemData(){return this.listItems.map(e=>({label:e.label,description:e.description,metadata:e.metadata,heading:this.getGroupHeading(e),el:e}))}getGroupHeading(e){return this.listItemGroups.filter(r=>r.contains(e)).map(r=>r.heading)}updateGroupItems(){const{el:e,group:i,scale:r}=this,s=lH(e),n=i?Array.from(s.querySelectorAll(`${VP}[group="${i}"]`)).filter(a=>!a.disabled&&a.dragEnabled):[];this.moveToItems=n.map(a=>({element:a,label:a.label??a.id,id:vT()})),Array.from(this.el.querySelectorAll(zV)).forEach(a=>{a.scale=r})}focusRow(e){const{focusableItems:i}=this;e&&(i.forEach(r=>r.active=r===e),e.setFocus())}isNavigable(e){var r;const i=(r=e.parentElement)==null?void 0:r.closest(ev);return i?i.expanded&&this.isNavigable(i):!0}handleListKeydown(e){var n;if(e.defaultPrevented||this.parentListEl)return;const{key:i}=e,r=this.focusableItems.filter(o=>this.isNavigable(o)),s=r.findIndex(o=>o.active);if(i==="ArrowDown"){e.preventDefault();const o=e.target===this.filterEl?0:s+1;r[o]&&this.focusRow(r[o])}else if(i==="ArrowUp"){if(e.preventDefault(),s===0&&this.filterEnabled){(n=this.filterEl)==null||n.setFocus();return}const o=s-1;r[o]&&this.focusRow(r[o])}else if(i==="Home"){e.preventDefault();const o=r[0];o&&this.focusRow(o)}else if(i==="End"){e.preventDefault();const o=r[r.length-1];o&&this.focusRow(o)}}handleInteractionModeWarning(){this.interactionMode==="static"&&this.selectionMode!=="none"&&this.selectionAppearance==="border"&&console.warn('selection-appearance="border" requires interaction-mode="interactive"')}handleMove(e){var c,h;const{moveTo:i}=e.detail,r=e.target,s=r==null?void 0:r.parentElement,n=i.element,a=Array.from(s.children).filter(B1e).indexOf(r),l=0;if(s){if(((c=s.canPull)==null?void 0:c.call(s,{toEl:n,fromEl:s,dragEl:r,newIndex:l,oldIndex:a}))===!1){this.calciteListMoveHalt.emit({toEl:n,fromEl:s,dragEl:r,oldIndex:a,newIndex:l});return}if(((h=n.canPut)==null?void 0:h.call(n,{toEl:n,fromEl:s,dragEl:r,newIndex:l,oldIndex:a}))===!1){n.putFailed({toEl:n,fromEl:s,dragEl:r,oldIndex:a,newIndex:l});return}r.sortHandleOpen=!1,this.disconnectObserver(),n.prepend(r),IBe(r),this.updateListItems(),this.connectObserver(),this.calciteListOrderChange.emit({dragEl:r,fromEl:s,toEl:n,newIndex:l,oldIndex:a})}}handleReorder(e){const{reorder:i}=e.detail,r=e.target,s=r==null?void 0:r.parentElement;if(!s)return;r.sortHandleOpen=!1;const n=Array.from(s.children).filter(B1e),o=n.length-1,a=n.indexOf(r);let l=a;switch(i){case"top":l=0;break;case"bottom":l=o;break;case"up":l=a===0?0:a-1;break;case"down":l=a===o?o:a+1;break}this.disconnectObserver();const c=i==="up"||i==="top"?n[l]:n[l].nextSibling;s.insertBefore(r,c),this.updateListItems(),this.connectObserver(),this.calciteListOrderChange.emit({dragEl:r,fromEl:s,toEl:s,newIndex:l,oldIndex:a})}render(){const{loading:e,label:i,disabled:r,dataForFilter:s,filterEnabled:n,filterPlaceholder:o,filterText:a,filterLabel:l,hasFilterActionsStart:c,hasFilterActionsEnd:h,effectiveFilterProps:d}=this;return $g({disabled:this.disabled,children:ce`<div class=${ge(N0.container)}>${this.dragEnabled?ce`<span aria-live=assertive class=${ge(N0.assistiveText)}>${this.assistiveText}</span>`:null}${this.renderItemAriaLive()}${e?ce`<calcite-scrim class=${ge(N0.scrim)} .loading=${e}></calcite-scrim>`:null}<div .ariaBusy=${e} .ariaLabel=${i||""} class=${ge(N0.table)} @keydown=${this.handleListKeydown} role=treegrid>${n||c||h?ce`<div class=${ge(N0.sticky)} role=rowgroup><div role=row><div role=columnheader><calcite-stack class=${ge(N0.stack)}><slot name=${hW.filterActionsStart} @slotchange=${this.handleFilterActionsStartSlotChange} slot=${DC.actionsStart}></slot><calcite-filter .ariaLabel=${o} .disabled=${r} .filterProps=${d} .items=${s} .label=${l} @calciteFilterChange=${this.handleFilterChange} .placeholder=${o} .scale=${this.scale} .value=${a} ${xr(this.setFilterEl)}></calcite-filter><slot name=${hW.filterActionsEnd} @slotchange=${this.handleFilterActionsEndSlotChange} slot=${DC.actionsEnd}></slot></calcite-stack></div></div></div>`:null}<div class=${ge(N0.tableContainer)} role=rowgroup><slot @slotchange=${this.handleDefaultSlotChange} ${xr(this.setDefaultSlotEl)}></slot></div></div><div aria-live=polite data-test-id=no-results-container .hidden=${!this.showNoResultsContainer}><slot name=${hW.filterNoResults} @slotchange=${this.handleFilterNoResultsSlotChange}></slot></div></div>`})}renderItemAriaLive(){const{messages:e,filteredItems:i,parentListEl:r,messages:{_lang:s},numberingSystem:n}=this;return Vh.numberFormatOptions={locale:s,numberingSystem:n},r?null:ce`<div aria-live=polite class=${ge(N0.assistiveText)}>${this.hasActiveFilter?er("aria-filter-enabled",ce`<div>${e.filterEnabled}</div>`):null}${er("aria-item-count",ce`<div>${e.total.replace("{count}",Vh.localize(i.length.toString()))}</div>`)}${i.length?er("aria-item-list",ce`<ol>${i.map(o=>ce`<li>${o.label}</li>`)}</ol>`):null}</div>`}};_j.properties={assistiveText:[16,{},{state:!0}],dataForFilter:[16,{},{state:!0}],hasFilterActionsEnd:[16,{},{state:!0}],hasFilterActionsStart:[16,{},{state:!0}],hasFilterNoResults:[16,{},{state:!0}],moveToItems:[16,{},{state:!0}],hasActiveFilter:[16,{},{state:!0}],showNoResultsContainer:[16,{},{state:!0}],canPull:[0,{},{attribute:!1}],canPut:[0,{},{attribute:!1}],disabled:[7,{},{reflect:!0,type:Boolean}],dragEnabled:[7,{},{reflect:!0,type:Boolean}],filterEnabled:[7,{},{reflect:!0,type:Boolean}],filterPredicate:[0,{},{attribute:!1}],filterLabel:[3,{},{reflect:!0}],filterPlaceholder:[3,{},{reflect:!0}],filterProps:[0,{},{attribute:!1}],filterText:[3,{},{reflect:!0}],filteredData:[0,{},{attribute:!1}],filteredItems:[0,{},{attribute:!1}],group:[3,{},{reflect:!0}],interactionMode:[3,{},{reflect:!0}],label:1,loading:[7,{},{reflect:!0,type:Boolean}],messageOverrides:[0,{},{attribute:!1}],displayMode:[3,{},{reflect:!0}],numberingSystem:1,scale:[3,{},{reflect:!0}],selectedItems:[0,{},{attribute:!1}],selectionAppearance:[3,{},{reflect:!0}],selectionMode:[3,{},{reflect:!0}]},_j.styles=jjt;let HV=_j;Io("calcite-list",HV);const ngi=Object.freeze(Object.defineProperty({__proto__:null,List:HV},Symbol.toStringTag,{value:"Module"})),ZBe=["top","right","bottom","left"],X1e=["start","end"],K1e=ZBe.reduce((t,e)=>t.concat(e,e+"-"+X1e[0],e+"-"+X1e[1]),[]),UA=Math.min,uS=Math.max,qV=Math.round,o4=Math.floor,Km=t=>({x:t,y:t}),Hjt={left:"right",right:"left",bottom:"top",top:"bottom"},qjt={start:"end",end:"start"};function Lte(t,e,i){return uS(t,UA(e,i))}function bT(t,e){return typeof t=="function"?t(e):t}function kv(t){return t.split("-")[0]}function Qm(t){return t.split("-")[1]}function YBe(t){return t==="x"?"y":"x"}function Gle(t){return t==="y"?"height":"width"}function vb(t){return["top","bottom"].includes(kv(t))?"y":"x"}function Hle(t){return YBe(vb(t))}function JBe(t,e,i){i===void 0&&(i=!1);const r=Qm(t),s=Hle(t),n=Gle(s);let o=s==="x"?r===(i?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[n]>e.floating[n]&&(o=ZV(o)),[o,ZV(o)]}function Wjt(t){const e=ZV(t);return[WV(t),e,WV(e)]}function WV(t){return t.replace(/start|end/g,e=>qjt[e])}function Zjt(t,e,i){const r=["left","right"],s=["right","left"],n=["top","bottom"],o=["bottom","top"];switch(t){case"top":case"bottom":return i?e?s:r:e?r:s;case"left":case"right":return e?n:o;default:return[]}}function Yjt(t,e,i,r){const s=Qm(t);let n=Zjt(kv(t),i==="start",r);return s&&(n=n.map(o=>o+"-"+s),e&&(n=n.concat(n.map(WV)))),n}function ZV(t){return t.replace(/left|right|bottom|top/g,e=>Hjt[e])}function Jjt(t){return{top:0,right:0,bottom:0,left:0,...t}}function XBe(t){return typeof t!="number"?Jjt(t):{top:t,right:t,bottom:t,left:t}}function YV(t){const{x:e,y:i,width:r,height:s}=t;return{width:r,height:s,top:i,left:e,right:e+r,bottom:i+s,x:e,y:i}}function Q1e(t,e,i){let{reference:r,floating:s}=t;const n=vb(e),o=Hle(e),a=Gle(o),l=kv(e),c=n==="y",h=r.x+r.width/2-s.width/2,d=r.y+r.height/2-s.height/2,f=r[a]/2-s[a]/2;let m;switch(l){case"top":m={x:h,y:r.y-s.height};break;case"bottom":m={x:h,y:r.y+r.height};break;case"right":m={x:r.x+r.width,y:d};break;case"left":m={x:r.x-s.width,y:d};break;default:m={x:r.x,y:r.y}}switch(Qm(e)){case"start":m[o]-=f*(i&&c?-1:1);break;case"end":m[o]+=f*(i&&c?-1:1);break}return m}const Xjt=async(t,e,i)=>{const{placement:r="bottom",strategy:s="absolute",middleware:n=[],platform:o}=i,a=n.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(e));let c=await o.getElementRects({reference:t,floating:e,strategy:s}),{x:h,y:d}=Q1e(c,r,l),f=r,m={},g=0;for(let v=0;v<a.length;v++){const{name:_,fn:b}=a[v],{x:w,y:x,data:S,reset:C}=await b({x:h,y:d,initialPlacement:r,placement:f,strategy:s,middlewareData:m,rects:c,platform:o,elements:{reference:t,floating:e}});h=w??h,d=x??d,m={...m,[_]:{...m[_],...S}},C&&g<=50&&(g++,typeof C=="object"&&(C.placement&&(f=C.placement),C.rects&&(c=C.rects===!0?await o.getElementRects({reference:t,floating:e,strategy:s}):C.rects),{x:h,y:d}=Q1e(c,f,l)),v=-1)}return{x:h,y:d,placement:f,strategy:s,middlewareData:m}};async function xD(t,e){var i;e===void 0&&(e={});const{x:r,y:s,platform:n,rects:o,elements:a,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:h="viewport",elementContext:d="floating",altBoundary:f=!1,padding:m=0}=bT(e,t),g=XBe(m),_=a[f?d==="floating"?"reference":"floating":d],b=YV(await n.getClippingRect({element:(i=await(n.isElement==null?void 0:n.isElement(_)))==null||i?_:_.contextElement||await(n.getDocumentElement==null?void 0:n.getDocumentElement(a.floating)),boundary:c,rootBoundary:h,strategy:l})),w=d==="floating"?{x:r,y:s,width:o.floating.width,height:o.floating.height}:o.reference,x=await(n.getOffsetParent==null?void 0:n.getOffsetParent(a.floating)),S=await(n.isElement==null?void 0:n.isElement(x))?await(n.getScale==null?void 0:n.getScale(x))||{x:1,y:1}:{x:1,y:1},C=YV(n.convertOffsetParentRelativeRectToViewportRelativeRect?await n.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:w,offsetParent:x,strategy:l}):w);return{top:(b.top-C.top+g.top)/S.y,bottom:(C.bottom-b.bottom+g.bottom)/S.y,left:(b.left-C.left+g.left)/S.x,right:(C.right-b.right+g.right)/S.x}}const Kjt=t=>({name:"arrow",options:t,async fn(e){const{x:i,y:r,placement:s,rects:n,platform:o,elements:a,middlewareData:l}=e,{element:c,padding:h=0}=bT(t,e)||{};if(c==null)return{};const d=XBe(h),f={x:i,y:r},m=Hle(s),g=Gle(m),v=await o.getDimensions(c),_=m==="y",b=_?"top":"left",w=_?"bottom":"right",x=_?"clientHeight":"clientWidth",S=n.reference[g]+n.reference[m]-f[m]-n.floating[g],C=f[m]-n.reference[m],T=await(o.getOffsetParent==null?void 0:o.getOffsetParent(c));let M=T?T[x]:0;(!M||!await(o.isElement==null?void 0:o.isElement(T)))&&(M=a.floating[x]||n.floating[g]);const I=S/2-C/2,D=M/2-v[g]/2-1,P=UA(d[b],D),F=UA(d[w],D),L=P,N=M-v[g]-F,R=M/2-v[g]/2+I,k=Lte(L,R,N),W=!l.arrow&&Qm(s)!=null&&R!==k&&n.reference[g]/2-(R<L?P:F)-v[g]/2<0,j=W?R<L?R-L:R-N:0;return{[m]:f[m]+j,data:{[m]:k,centerOffset:R-k-j,...W&&{alignmentOffset:j}},reset:W}}});function Qjt(t,e,i){return(t?[...i.filter(s=>Qm(s)===t),...i.filter(s=>Qm(s)!==t)]:i.filter(s=>kv(s)===s)).filter(s=>t?Qm(s)===t||(e?WV(s)!==s:!1):!0)}const eGt=function(t){return t===void 0&&(t={}),{name:"autoPlacement",options:t,async fn(e){var i,r,s;const{rects:n,middlewareData:o,placement:a,platform:l,elements:c}=e,{crossAxis:h=!1,alignment:d,allowedPlacements:f=K1e,autoAlignment:m=!0,...g}=bT(t,e),v=d!==void 0||f===K1e?Qjt(d||null,m,f):f,_=await xD(e,g),b=((i=o.autoPlacement)==null?void 0:i.index)||0,w=v[b];if(w==null)return{};const x=JBe(w,n,await(l.isRTL==null?void 0:l.isRTL(c.floating)));if(a!==w)return{reset:{placement:v[0]}};const S=[_[kv(w)],_[x[0]],_[x[1]]],C=[...((r=o.autoPlacement)==null?void 0:r.overflows)||[],{placement:w,overflows:S}],T=v[b+1];if(T)return{data:{index:b+1,overflows:C},reset:{placement:T}};const M=C.map(P=>{const F=Qm(P.placement);return[P.placement,F&&h?P.overflows.slice(0,2).reduce((L,N)=>L+N,0):P.overflows[0],P.overflows]}).sort((P,F)=>P[1]-F[1]),D=((s=M.filter(P=>P[2].slice(0,Qm(P[0])?2:3).every(F=>F<=0))[0])==null?void 0:s[0])||M[0][0];return D!==a?{data:{index:b+1,overflows:C},reset:{placement:D}}:{}}}},tGt=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var i,r;const{placement:s,middlewareData:n,rects:o,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:h=!0,crossAxis:d=!0,fallbackPlacements:f,fallbackStrategy:m="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:v=!0,..._}=bT(t,e);if((i=n.arrow)!=null&&i.alignmentOffset)return{};const b=kv(s),w=vb(a),x=kv(a)===a,S=await(l.isRTL==null?void 0:l.isRTL(c.floating)),C=f||(x||!v?[ZV(a)]:Wjt(a)),T=g!=="none";!f&&T&&C.push(...Yjt(a,v,g,S));const M=[a,...C],I=await xD(e,_),D=[];let P=((r=n.flip)==null?void 0:r.overflows)||[];if(h&&D.push(I[b]),d){const R=JBe(s,o,S);D.push(I[R[0]],I[R[1]])}if(P=[...P,{placement:s,overflows:D}],!D.every(R=>R<=0)){var F,L;const R=(((F=n.flip)==null?void 0:F.index)||0)+1,k=M[R];if(k&&(!(d==="alignment"?w!==vb(k):!1)||P.every(B=>B.overflows[0]>0&&vb(B.placement)===w)))return{data:{index:R,overflows:P},reset:{placement:k}};let W=(L=P.filter(j=>j.overflows[0]<=0).sort((j,B)=>j.overflows[1]-B.overflows[1])[0])==null?void 0:L.placement;if(!W)switch(m){case"bestFit":{var N;const j=(N=P.filter(B=>{if(T){const te=vb(B.placement);return te===w||te==="y"}return!0}).map(B=>[B.placement,B.overflows.filter(te=>te>0).reduce((te,le)=>te+le,0)]).sort((B,te)=>B[1]-te[1])[0])==null?void 0:N[0];j&&(W=j);break}case"initialPlacement":W=a;break}if(s!==W)return{reset:{placement:W}}}return{}}}};function exe(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function txe(t){return ZBe.some(e=>t[e]>=0)}const iGt=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:i}=e,{strategy:r="referenceHidden",...s}=bT(t,e);switch(r){case"referenceHidden":{const n=await xD(e,{...s,elementContext:"reference"}),o=exe(n,i.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:txe(o)}}}case"escaped":{const n=await xD(e,{...s,altBoundary:!0}),o=exe(n,i.floating);return{data:{escapedOffsets:o,escaped:txe(o)}}}default:return{}}}}};async function rGt(t,e){const{placement:i,platform:r,elements:s}=t,n=await(r.isRTL==null?void 0:r.isRTL(s.floating)),o=kv(i),a=Qm(i),l=vb(i)==="y",c=["left","top"].includes(o)?-1:1,h=n&&l?-1:1,d=bT(e,t);let{mainAxis:f,crossAxis:m,alignmentAxis:g}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof g=="number"&&(m=a==="end"?g*-1:g),l?{x:m*h,y:f*c}:{x:f*c,y:m*h}}const sGt=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var i,r;const{x:s,y:n,placement:o,middlewareData:a}=e,l=await rGt(e,t);return o===((i=a.offset)==null?void 0:i.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:s+l.x,y:n+l.y,data:{...l,placement:o}}}}},nGt=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:i,y:r,placement:s}=e,{mainAxis:n=!0,crossAxis:o=!1,limiter:a={fn:_=>{let{x:b,y:w}=_;return{x:b,y:w}}},...l}=bT(t,e),c={x:i,y:r},h=await xD(e,l),d=vb(kv(s)),f=YBe(d);let m=c[f],g=c[d];if(n){const _=f==="y"?"top":"left",b=f==="y"?"bottom":"right",w=m+h[_],x=m-h[b];m=Lte(w,m,x)}if(o){const _=d==="y"?"top":"left",b=d==="y"?"bottom":"right",w=g+h[_],x=g-h[b];g=Lte(w,g,x)}const v=a.fn({...e,[f]:m,[d]:g});return{...v,data:{x:v.x-i,y:v.y-r,enabled:{[f]:n,[d]:o}}}}}};function vH(){return typeof window<"u"}function CM(t){return KBe(t)?(t.nodeName||"").toLowerCase():"#document"}function ah(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function Ag(t){var e;return(e=(KBe(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function KBe(t){return vH()?t instanceof Node||t instanceof ah(t).Node:!1}function Ef(t){return vH()?t instanceof Element||t instanceof ah(t).Element:!1}function pg(t){return vH()?t instanceof HTMLElement||t instanceof ah(t).HTMLElement:!1}function ixe(t){return!vH()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof ah(t).ShadowRoot}function KL(t){const{overflow:e,overflowX:i,overflowY:r,display:s}=Cf(t);return/auto|scroll|overlay|hidden|clip/.test(e+r+i)&&!["inline","contents"].includes(s)}function oGt(t){return["table","td","th"].includes(CM(t))}function _H(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function bH(t){const e=qle(),i=Ef(t)?Cf(t):t;return["transform","translate","scale","rotate","perspective"].some(r=>i[r]?i[r]!=="none":!1)||(i.containerType?i.containerType!=="normal":!1)||!e&&(i.backdropFilter?i.backdropFilter!=="none":!1)||!e&&(i.filter?i.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(r=>(i.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(i.contain||"").includes(r))}function aGt(t){let e=Qb(t);for(;pg(e)&&!BA(e);){if(bH(e))return e;if(_H(e))return null;e=Qb(e)}return null}function qle(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function BA(t){return["html","body","#document"].includes(CM(t))}function Cf(t){return ah(t).getComputedStyle(t)}function wH(t){return Ef(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Qb(t){if(CM(t)==="html")return t;const e=t.assignedSlot||t.parentNode||ixe(t)&&t.host||Ag(t);return ixe(e)?e.host:e}function QBe(t){const e=Qb(t);return BA(e)?t.ownerDocument?t.ownerDocument.body:t.body:pg(e)&&KL(e)?e:QBe(e)}function SD(t,e,i){var r;e===void 0&&(e=[]),i===void 0&&(i=!0);const s=QBe(t),n=s===((r=t.ownerDocument)==null?void 0:r.body),o=ah(s);if(n){const a=Nte(o);return e.concat(o,o.visualViewport||[],KL(s)?s:[],a&&i?SD(a):[])}return e.concat(s,SD(s,[],i))}function Nte(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function eVe(t){const e=Cf(t);let i=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const s=pg(t),n=s?t.offsetWidth:i,o=s?t.offsetHeight:r,a=qV(i)!==n||qV(r)!==o;return a&&(i=n,r=o),{width:i,height:r,$:a}}function Wle(t){return Ef(t)?t:t.contextElement}function g$(t){const e=Wle(t);if(!pg(e))return Km(1);const i=e.getBoundingClientRect(),{width:r,height:s,$:n}=eVe(e);let o=(n?qV(i.width):i.width)/r,a=(n?qV(i.height):i.height)/s;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const lGt=Km(0);function tVe(t){const e=ah(t);return!qle()||!e.visualViewport?lGt:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function cGt(t,e,i){return e===void 0&&(e=!1),!i||e&&i!==ah(t)?!1:e}function VS(t,e,i,r){e===void 0&&(e=!1),i===void 0&&(i=!1);const s=t.getBoundingClientRect(),n=Wle(t);let o=Km(1);e&&(r?Ef(r)&&(o=g$(r)):o=g$(t));const a=cGt(n,i,r)?tVe(n):Km(0);let l=(s.left+a.x)/o.x,c=(s.top+a.y)/o.y,h=s.width/o.x,d=s.height/o.y;if(n){const f=ah(n),m=r&&Ef(r)?ah(r):r;let g=f,v=Nte(g);for(;v&&r&&m!==g;){const _=g$(v),b=v.getBoundingClientRect(),w=Cf(v),x=b.left+(v.clientLeft+parseFloat(w.paddingLeft))*_.x,S=b.top+(v.clientTop+parseFloat(w.paddingTop))*_.y;l*=_.x,c*=_.y,h*=_.x,d*=_.y,l+=x,c+=S,g=ah(v),v=Nte(g)}}return YV({width:h,height:d,x:l,y:c})}function Zle(t,e){const i=wH(t).scrollLeft;return e?e.left+i:VS(Ag(t)).left+i}function iVe(t,e,i){i===void 0&&(i=!1);const r=t.getBoundingClientRect(),s=r.left+e.scrollLeft-(i?0:Zle(t,r)),n=r.top+e.scrollTop;return{x:s,y:n}}function uGt(t){let{elements:e,rect:i,offsetParent:r,strategy:s}=t;const n=s==="fixed",o=Ag(r),a=e?_H(e.floating):!1;if(r===o||a&&n)return i;let l={scrollLeft:0,scrollTop:0},c=Km(1);const h=Km(0),d=pg(r);if((d||!d&&!n)&&((CM(r)!=="body"||KL(o))&&(l=wH(r)),pg(r))){const m=VS(r);c=g$(r),h.x=m.x+r.clientLeft,h.y=m.y+r.clientTop}const f=o&&!d&&!n?iVe(o,l,!0):Km(0);return{width:i.width*c.x,height:i.height*c.y,x:i.x*c.x-l.scrollLeft*c.x+h.x+f.x,y:i.y*c.y-l.scrollTop*c.y+h.y+f.y}}function hGt(t){return Array.from(t.getClientRects())}function dGt(t){const e=Ag(t),i=wH(t),r=t.ownerDocument.body,s=uS(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),n=uS(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let o=-i.scrollLeft+Zle(t);const a=-i.scrollTop;return Cf(r).direction==="rtl"&&(o+=uS(e.clientWidth,r.clientWidth)-s),{width:s,height:n,x:o,y:a}}function pGt(t,e){const i=ah(t),r=Ag(t),s=i.visualViewport;let n=r.clientWidth,o=r.clientHeight,a=0,l=0;if(s){n=s.width,o=s.height;const c=qle();(!c||c&&e==="fixed")&&(a=s.offsetLeft,l=s.offsetTop)}return{width:n,height:o,x:a,y:l}}function fGt(t,e){const i=VS(t,!0,e==="fixed"),r=i.top+t.clientTop,s=i.left+t.clientLeft,n=pg(t)?g$(t):Km(1),o=t.clientWidth*n.x,a=t.clientHeight*n.y,l=s*n.x,c=r*n.y;return{width:o,height:a,x:l,y:c}}function rxe(t,e,i){let r;if(e==="viewport")r=pGt(t,i);else if(e==="document")r=dGt(Ag(t));else if(Ef(e))r=fGt(e,i);else{const s=tVe(t);r={x:e.x-s.x,y:e.y-s.y,width:e.width,height:e.height}}return YV(r)}function rVe(t,e){const i=Qb(t);return i===e||!Ef(i)||BA(i)?!1:Cf(i).position==="fixed"||rVe(i,e)}function mGt(t,e){const i=e.get(t);if(i)return i;let r=SD(t,[],!1).filter(a=>Ef(a)&&CM(a)!=="body"),s=null;const n=Cf(t).position==="fixed";let o=n?Qb(t):t;for(;Ef(o)&&!BA(o);){const a=Cf(o),l=bH(o);!l&&a.position==="fixed"&&(s=null),(n?!l&&!s:!l&&a.position==="static"&&!!s&&["absolute","fixed"].includes(s.position)||KL(o)&&!l&&rVe(t,o))?r=r.filter(h=>h!==o):s=a,o=Qb(o)}return e.set(t,r),r}function gGt(t){let{element:e,boundary:i,rootBoundary:r,strategy:s}=t;const o=[...i==="clippingAncestors"?_H(e)?[]:mGt(e,this._c):[].concat(i),r],a=o[0],l=o.reduce((c,h)=>{const d=rxe(e,h,s);return c.top=uS(d.top,c.top),c.right=UA(d.right,c.right),c.bottom=UA(d.bottom,c.bottom),c.left=uS(d.left,c.left),c},rxe(e,a,s));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function yGt(t){const{width:e,height:i}=eVe(t);return{width:e,height:i}}function vGt(t,e,i){const r=pg(e),s=Ag(e),n=i==="fixed",o=VS(t,!0,n,e);let a={scrollLeft:0,scrollTop:0};const l=Km(0);function c(){l.x=Zle(s)}if(r||!r&&!n)if((CM(e)!=="body"||KL(s))&&(a=wH(e)),r){const m=VS(e,!0,n,e);l.x=m.x+e.clientLeft,l.y=m.y+e.clientTop}else s&&c();n&&!r&&s&&c();const h=s&&!r&&!n?iVe(s,a):Km(0),d=o.left+a.scrollLeft-l.x-h.x,f=o.top+a.scrollTop-l.y-h.y;return{x:d,y:f,width:o.width,height:o.height}}function dW(t){return Cf(t).position==="static"}function sxe(t,e){if(!pg(t)||Cf(t).position==="fixed")return null;if(e)return e(t);let i=t.offsetParent;return Ag(t)===i&&(i=i.ownerDocument.body),i}function sVe(t,e){const i=ah(t);if(_H(t))return i;if(!pg(t)){let s=Qb(t);for(;s&&!BA(s);){if(Ef(s)&&!dW(s))return s;s=Qb(s)}return i}let r=sxe(t,e);for(;r&&oGt(r)&&dW(r);)r=sxe(r,e);return r&&BA(r)&&dW(r)&&!bH(r)?i:r||aGt(t)||i}const _Gt=async function(t){const e=this.getOffsetParent||sVe,i=this.getDimensions,r=await i(t.floating);return{reference:vGt(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function bGt(t){return Cf(t).direction==="rtl"}const Fte={convertOffsetParentRelativeRectToViewportRelativeRect:uGt,getDocumentElement:Ag,getClippingRect:gGt,getOffsetParent:sVe,getElementRects:_Gt,getClientRects:hGt,getDimensions:yGt,getScale:g$,isElement:Ef,isRTL:bGt};function nVe(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function wGt(t,e){let i=null,r;const s=Ag(t);function n(){var a;clearTimeout(r),(a=i)==null||a.disconnect(),i=null}function o(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),n();const c=t.getBoundingClientRect(),{left:h,top:d,width:f,height:m}=c;if(a||e(),!f||!m)return;const g=o4(d),v=o4(s.clientWidth-(h+f)),_=o4(s.clientHeight-(d+m)),b=o4(h),x={rootMargin:-g+"px "+-v+"px "+-_+"px "+-b+"px",threshold:uS(0,UA(1,l))||1};let S=!0;function C(T){const M=T[0].intersectionRatio;if(M!==l){if(!S)return o();M?o(!1,M):r=setTimeout(()=>{o(!1,1e-7)},1e3)}M===1&&!nVe(c,t.getBoundingClientRect())&&o(),S=!1}try{i=new IntersectionObserver(C,{...x,root:s.ownerDocument})}catch{i=new IntersectionObserver(C,x)}i.observe(t)}return o(!0),n}function xGt(t,e,i,r){r===void 0&&(r={});const{ancestorScroll:s=!0,ancestorResize:n=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,c=Wle(t),h=s||n?[...c?SD(c):[],...SD(e)]:[];h.forEach(b=>{s&&b.addEventListener("scroll",i,{passive:!0}),n&&b.addEventListener("resize",i)});const d=c&&a?wGt(c,i):null;let f=-1,m=null;o&&(m=new ResizeObserver(b=>{let[w]=b;w&&w.target===c&&m&&(m.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var x;(x=m)==null||x.observe(e)})),i()}),c&&!l&&m.observe(c),m.observe(e));let g,v=l?VS(t):null;l&&_();function _(){const b=VS(t);v&&!nVe(v,b)&&i(),v=b,g=requestAnimationFrame(_)}return i(),()=>{var b;h.forEach(w=>{s&&w.removeEventListener("scroll",i),n&&w.removeEventListener("resize",i)}),d==null||d(),(b=m)==null||b.disconnect(),m=null,l&&cancelAnimationFrame(g)}}const SGt=sGt,TGt=eGt,EGt=nGt,nxe=tGt,CGt=iGt,$Gt=Kjt,AGt=(t,e,i)=>{const r=new Map,s={platform:Fte,...i},n={...s.platform,_c:r};return Xjt(t,e,{...s,platform:n})};function MGt(t){return OGt(t)}function pW(t){return t.assignedSlot?t.assignedSlot:t.parentNode instanceof ShadowRoot?t.parentNode.host:t.parentNode}function OGt(t){for(let e=t;e;e=pW(e))if(e instanceof Element&&getComputedStyle(e).display==="none")return null;for(let e=pW(t);e;e=pW(e)){if(!(e instanceof Element))continue;const i=getComputedStyle(e);if(i.display!=="contents"&&(i.position!=="static"||bH(i)||e.tagName==="BODY"))return e}return null}/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */(function(){{const e=Fte.getOffsetParent;Fte.getOffsetParent=i=>e(i,MGt)}})();function oxe(t){const e=window.devicePixelRatio||1;return Math.round(t*e)/e}const oVe=async(t,{referenceEl:e,floatingEl:i,overlayPositioning:r="absolute",placement:s,flipDisabled:n,flipPlacements:o,offsetDistance:a,offsetSkidding:l,arrowEl:c,type:h})=>{var S;if(!e||!i)return;const d=YL(i)==="rtl",{x:f,y:m,placement:g,strategy:v,middlewareData:_}=await AGt(e,i,{strategy:r,placement:s==="auto"||s==="auto-start"||s==="auto-end"?void 0:lxe(s,d),middleware:PGt({placement:s,flipDisabled:n,flipPlacements:o==null?void 0:o.map(C=>lxe(C,d)),offsetDistance:a,offsetSkidding:l,arrowEl:c,type:h})});if(c&&_.arrow){const{x:C,y:T}=_.arrow,M=g.split("-")[0],I=C!=null?"left":"top",D=LGt[M],P={left:"",top:"",bottom:"",right:""};"floatingLayout"in t&&(t.floatingLayout=M==="left"||M==="right"?"horizontal":"vertical"),Object.assign(c.style,{...P,[I]:`${I=="left"?C:T}px`,[M]:"100%",transform:D})}const w=((S=_.hide)==null?void 0:S.referenceHidden)?"hidden":null,x=w?"none":null;i.setAttribute(IGt,g),Object.assign(i.style,{pointerEvents:x,position:v,transform:`translate(${oxe(f)}px,${oxe(m)}px)`,visibility:w})},IGt="data-placement",axe=["top","bottom","right","left","top-start","top-end","bottom-start","bottom-end","right-start","right-end","left-start","left-end","leading","trailing","leading-start","leading-end","trailing-start","trailing-end"],kte="bottom-start",RGt="bottom-end",JV={animation:"calcite-floating-ui-anim",animationActive:"calcite-floating-ui-anim--active"};function PGt({placement:t,flipDisabled:e,flipPlacements:i,offsetDistance:r,offsetSkidding:s,arrowEl:n,type:o}){const a=[EGt(),CGt()];return o==="menu"&&a.push(nxe({fallbackPlacements:i||["top-start","top","top-end","bottom-start","bottom","bottom-end"]})),a.push(SGt({mainAxis:typeof r=="number"?r:0,crossAxis:typeof s=="number"?s:0})),t==="auto"||t==="auto-start"||t==="auto-end"?a.push(TGt({alignment:t==="auto-start"?"start":t==="auto-end"?"end":null})):e||a.push(nxe(i?{fallbackPlacements:i}:{})),n&&a.push($Gt({element:n})),a}function aVe(t,e){const i=t.filter(r=>axe.includes(r));return i.length!==t.length&&console.warn(`${e.tagName}: Invalid value found in: flipPlacements. Try any of these: ${axe.map(r=>`"${r}"`).join(", ").trim()}`,{el:e}),i}function lxe(t,e=!1){const i=["left","right"];return e&&i.reverse(),t.replace(/leading/gi,i[0]).replace(/trailing/gi,i[1])}async function lVe(t,e,i=!1){if(!t.open||!e.floatingEl||!e.referenceEl)return;if(Object.assign(e.floatingEl.style,{display:"block",position:e.overlayPositioning??"absolute"}),!TD.get(t))return cVe(t);await(i?DGt(t):oVe)(t,e)}function DGt(t){let e=XV.get(t);return e||(e=zle(oVe,dB.reposition,{leading:!0,maxWait:dB.reposition}),XV.set(t,e),e)}const LGt={top:"",left:"rotate(-90deg)",bottom:"rotate(180deg)",right:"rotate(90deg)"},TD=new WeakMap,XV=new WeakMap;async function cVe(t){const{referenceEl:e,floatingEl:i}=t;if(!i.isConnected)return;const r=xGt;TD.set(t,{state:"pending"});let s;const n=r(e,i,()=>{const o=t.reposition();s||(s=o)});return TD.set(t,{state:"active",cleanUp:n}),s}function Yle(t){const{floatingEl:e}=t;e&&Object.assign(e.style,{display:"",pointerEvents:"",position:"",transform:"",visibility:""})}async function VR(t){const{floatingEl:e,referenceEl:i}=t;if(Yle(t),!(!e||!i)&&(Jle(t),!!t.open))return cVe(t)}function Jle(t){var i;const e=TD.get(t);(e==null?void 0:e.state)==="active"&&e.cleanUp(),TD.delete(t),(i=XV.get(t))==null||i.cancel(),XV.delete(t)}const cxe=4,uxe=Math.ceil(Math.hypot(cxe,cxe));/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */function hxe(t){return t[t.openProp||"open"]}function Xle(t){requestAnimationFrame(()=>{t.transitionEl&&pUt(t.transitionEl,t.transitionProp,()=>{hxe(t)?t.onBeforeOpen():t.onBeforeClose()},()=>{hxe(t)?t.onOpen():t.onClose()})})}/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */function NGt(t,e,i){return e?`${t}-${e}`:i?`${t}-${i}`:`${t}-m`}/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const FGt={dropdownTrigger:"trigger"},dxe={content:"calcite-dropdown-content",wrapper:"calcite-dropdown-wrapper"},kGt=Ks`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:inline-block}.calcite-dropdown-wrapper{--calcite-floating-ui-z-index: var(--calcite-z-index-dropdown);inline-size:max-content;display:none;max-inline-size:100vw;max-block-size:100vh;inset-block-start:0;left:0;z-index:var(--calcite-floating-ui-z-index)}.calcite-dropdown-wrapper .calcite-floating-ui-anim{position:relative;transition:var(--calcite-floating-ui-transition);transition-property:inset,left,opacity;opacity:0;box-shadow:0 0 16px #00000029;z-index:var(--calcite-z-index);border-radius:.25rem}.calcite-dropdown-wrapper[data-placement^=bottom] .calcite-floating-ui-anim{inset-block-start:-5px}.calcite-dropdown-wrapper[data-placement^=top] .calcite-floating-ui-anim{inset-block-start:5px}.calcite-dropdown-wrapper[data-placement^=left] .calcite-floating-ui-anim{left:5px}.calcite-dropdown-wrapper[data-placement^=right] .calcite-floating-ui-anim{left:-5px}.calcite-dropdown-wrapper[data-placement] .calcite-floating-ui-anim--active{opacity:1;inset-block-start:0;left:0}.calcite-dropdown-content{max-height:45vh;width:auto;overflow-y:auto;overflow-x:hidden;inline-size:var(--calcite-dropdown-width, var(--calcite-internal-dropdown-width));background-color:var(--calcite-dropdown-background-color, var(--calcite-color-foreground-1))}.calcite-trigger-container{position:relative;display:flex;height:100%;flex:1 1 auto;word-wrap:break-word;word-break:break-word}.width-s{--calcite-internal-dropdown-width: 12rem}.width-m{--calcite-internal-dropdown-width: 14rem}.width-l{--calcite-internal-dropdown-width: 16rem}@media (forced-colors: active){:host([open]) .calcite-dropdown-wrapper{border:var(--calcite-border-width-sm) solid canvasText}}:host([hidden]){display:none}[hidden]{display:none}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}`,XP=class XP extends Hn{constructor(){super(),this.focusLastDropdownItem=!1,this.groups=[],this.guid=`calcite-dropdown-${vT()}`,this.items=[],this.mutationObserver=Tf("mutation",()=>this.updateItems()),this.transitionProp="opacity",this.resizeObserver=Tf("resize",e=>this.resizeObserverCallback(e)),this.closeOnSelectDisabled=!1,this.disabled=!1,this.maxItems=0,this.offsetDistance=0,this.offsetSkidding=0,this.open=!1,this.overlayPositioning="absolute",this.placement=kte,this.scale="m",this.selectedItems=[],this.type="click",this.calciteDropdownBeforeClose=Gt({cancelable:!1}),this.calciteDropdownBeforeOpen=Gt({cancelable:!1}),this.calciteDropdownClose=Gt({cancelable:!1}),this.calciteDropdownOpen=Gt({cancelable:!1}),this.calciteDropdownSelect=Gt({cancelable:!1}),this.listenOn(window,"click",this.closeCalciteDropdownOnClick),this.listen("calciteInternalDropdownCloseRequest",this.closeCalciteDropdownOnEvent),this.listenOn(window,"calciteDropdownOpen",this.closeCalciteDropdownOnOpenEvent),this.listen("pointerenter",this.pointerEnterHandler),this.listen("pointerleave",this.pointerLeaveHandler),this.listen("calciteInternalDropdownItemKeyEvent",this.calciteInternalDropdownItemKeyEvent),this.listen("calciteInternalDropdownItemSelect",this.handleItemSelect)}async reposition(e=!1){const{filteredFlipPlacements:i,floatingEl:r,offsetDistance:s,offsetSkidding:n,overlayPositioning:o,placement:a,referenceEl:l}=this;return lVe(this,{floatingEl:r,referenceEl:l,offsetDistance:s,offsetSkidding:n,overlayPositioning:o,placement:a,flipPlacements:i,type:"menu"},e)}async setFocus(){await yh(this),uH(this.referenceEl)}connectedCallback(){var e;super.connectedCallback(),(e=this.mutationObserver)==null||e.observe(this.el,{childList:!0,subtree:!0}),this.setFilteredPlacements(),this.updateItems(),VR(this)}willUpdate(e){e.has("open")&&(this.hasUpdated||this.open!==!1)&&this.openHandler(),e.has("disabled")&&(this.hasUpdated||this.disabled!==!1)&&this.handleDisabledChange(this.disabled),e.has("flipPlacements")&&this.flipPlacementsHandler(),e.has("maxItems")&&this.hasUpdated&&this.setMaxScrollerHeight(),this.hasUpdated&&(e.has("offsetDistance")&&this.offsetDistance!==0||e.has("offsetSkidding")&&this.offsetSkidding!==0||e.has("overlayPositioning")&&this.overlayPositioning!=="absolute"||e.has("placement")&&this.placement!==kte)&&this.reposition(!0),e.has("scale")&&(this.hasUpdated||this.scale!=="m")&&this.handlePropsChange()}updated(){Cg(this)}loaded(){this.updateSelectedItems(),VR(this)}disconnectedCallback(){var e,i;super.disconnectedCallback(),(e=this.mutationObserver)==null||e.disconnect(),(i=this.resizeObserver)==null||i.disconnect(),Jle(this)}openHandler(){Xle(this),!this.disabled&&this.reposition(!0)}handleDisabledChange(e){e||(this.open=!1)}flipPlacementsHandler(){this.setFilteredPlacements(),this.reposition(!0)}handlePropsChange(){this.updateItems(),this.updateGroupProps()}closeCalciteDropdownOnClick(e){this.disabled||!this.open||e.composedPath().includes(this.el)||this.closeCalciteDropdown(!1)}closeCalciteDropdownOnEvent(e){this.closeCalciteDropdown(),e.stopPropagation()}closeCalciteDropdownOnOpenEvent(e){e.composedPath().includes(this.el)||(this.open=!1)}pointerEnterHandler(){this.disabled||this.type!=="hover"||this.toggleDropdown()}pointerLeaveHandler(){this.disabled||this.type!=="hover"||this.closeCalciteDropdown()}getTraversableItems(){return this.items.filter(e=>!e.disabled&&!e.hidden)}calciteInternalDropdownItemKeyEvent(e){const{keyboardEvent:i}=e.detail,r=i.target,s=this.getTraversableItems();switch(i.key){case"Tab":this.open=!1,this.updateTabIndexOfItems(r);break;case"ArrowDown":t4(s,r,"next");break;case"ArrowUp":t4(s,r,"previous");break;case"Home":t4(s,r,"first");break;case"End":t4(s,r,"last");break}e.stopPropagation()}handleItemSelect(e){this.updateSelectedItems(),e.stopPropagation(),this.calciteDropdownSelect.emit(),(!this.closeOnSelectDisabled||e.detail.requestedDropdownGroup.selectionMode==="none")&&this.closeCalciteDropdown(),e.stopPropagation()}setFilteredPlacements(){const{el:e,flipPlacements:i}=this;this.filteredFlipPlacements=i?aVe(i,e):null}updateTriggers(e){this.triggers=e.target.assignedElements({flatten:!0}),this.reposition(!0)}updateItems(){this.items=this.groups.map(e=>Array.from(e==null?void 0:e.querySelectorAll("calcite-dropdown-item"))).reduce((e,i)=>[...e,...i],[]),this.updateSelectedItems(),this.reposition(!0),this.items.forEach(e=>e.scale=this.scale)}updateGroups(e){const i=e.target.assignedElements({flatten:!0}).filter(r=>r==null?void 0:r.matches("calcite-dropdown-group"));this.groups=i,this.updateItems(),this.updateGroupProps()}updateGroupProps(){this.groups.forEach((e,i)=>{e.scale=this.scale,e.position=i})}resizeObserverCallback(e){e.forEach(i=>{const{target:r}=i;this.hasUpdated&&(r===this.referenceEl?this.setDropdownWidth():r===this.scrollerEl&&this.setMaxScrollerHeight())})}setDropdownWidth(){const{referenceEl:e,scrollerEl:i}=this,r=e==null?void 0:e.clientWidth;i.style.minWidth=`${r}px`}setMaxScrollerHeight(){const e=this.getMaxScrollerHeight();this.scrollerEl.style.maxBlockSize=e>0?`${e}px`:"",this.reposition(!0)}setScrollerAndTransitionEl(e){var i;e&&((i=this.resizeObserver)==null||i.observe(e),this.scrollerEl=e,this.transitionEl=e)}onBeforeOpen(){this.calciteDropdownBeforeOpen.emit()}async onOpen(){this.focusOnFirstActiveOrDefaultItem(),this.calciteDropdownOpen.emit()}onBeforeClose(){this.calciteDropdownBeforeClose.emit()}onClose(){this.calciteDropdownClose.emit(),Yle(this)}setReferenceEl(e){var i;this.referenceEl=e,VR(this),e&&((i=this.resizeObserver)==null||i.observe(e))}setFloatingEl(e){this.floatingEl=e,VR(this)}keyDownHandler(e){if(!e.composedPath().includes(this.referenceEl))return;const{defaultPrevented:i,key:r}=e;if(!i){if(r==="Escape"){this.closeCalciteDropdown(),e.preventDefault();return}if(this.open&&e.shiftKey&&r==="Tab"){this.closeCalciteDropdown(),e.preventDefault();return}Fle(r)?(this.toggleDropdown(),e.preventDefault()):(r==="ArrowDown"||r==="ArrowUp")&&(e.preventDefault(),this.focusLastDropdownItem=r==="ArrowUp",this.open=!0)}}updateSelectedItems(){this.selectedItems=this.items.filter(e=>e.selected)}getMaxScrollerHeight(){const{maxItems:e,items:i}=this;return i.length>=e&&e>0?this.getYDistance(this.scrollerEl,i[e-1]):0}getYDistance(e,i){const r=e.getBoundingClientRect();return i.getBoundingClientRect().bottom-r.top}closeCalciteDropdown(e=!0){this.open=!1,e&&vD(this.triggers[0])}focusOnFirstActiveOrDefaultItem(){const i=this.getTraversableItems().find(r=>r.selected)||(this.focusLastDropdownItem?this.items[this.items.length-1]:this.items[0]);this.focusLastDropdownItem=!1,i&&vD(i)}toggleDropdown(){this.open=!this.open}updateTabIndexOfItems(e){this.items.forEach(i=>{i.tabIndex=e!==i?-1:0})}render(){const{open:e,guid:i}=this;return $g({disabled:this.disabled,children:ce`<div class="calcite-trigger-container" .id=${`${i}-menubutton`} @click=${this.toggleDropdown} @keydown=${this.keyDownHandler} ${xr(this.setReferenceEl)}><slot aria-controls=${`${i}-menu`} .ariaExpanded=${e} aria-haspopup=menu name=${FGt.dropdownTrigger} @slotchange=${this.updateTriggers}></slot></div><div .ariaHidden=${!e} class=${ge({[dxe.wrapper]:!0,[NGt("width",this.width,this.widthScale)]:!!(this.width||this.widthScale)})} ${xr(this.setFloatingEl)}><div aria-labelledby=${`${i}-menubutton`} class=${ge({[dxe.content]:!0,[JV.animation]:!0,[JV.animationActive]:e})} .id=${`${i}-menu`} role=menu ${xr(this.setScrollerAndTransitionEl)}><slot @slotchange=${this.updateGroups}></slot></div></div>`})}};XP.properties={closeOnSelectDisabled:[7,{},{reflect:!0,type:Boolean}],disabled:[7,{},{reflect:!0,type:Boolean}],flipPlacements:[0,{},{attribute:!1}],maxItems:[11,{},{reflect:!0,type:Number}],offsetDistance:[11,{},{type:Number,reflect:!0}],offsetSkidding:[11,{},{reflect:!0,type:Number}],open:[7,{},{reflect:!0,type:Boolean}],overlayPositioning:[3,{},{reflect:!0}],placement:[3,{},{reflect:!0}],scale:[3,{},{reflect:!0}],selectedItems:[0,{},{attribute:!1}],type:[3,{},{reflect:!0}],widthScale:[3,{},{reflect:!0}],width:[3,{},{reflect:!0}]},XP.shadowRootOptions={mode:"open",delegatesFocus:!0},XP.styles=kGt;let KV=XP;Io("calcite-dropdown",KV);const ogi=Object.freeze(Object.defineProperty({__proto__:null,Dropdown:KV},Symbol.toStringTag,{value:"Module"}));/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const cp={button:"button",buttonTextVisible:"button--text-visible",buttonCompact:"button--compact",indicatorText:"indicator-text",iconContainer:"icon-container",slotContainer:"slot-container",slotContainerHidden:"slot-container--hidden",textContainer:"text-container",textContainerVisible:"text-container--visible",indicatorWithIcon:"indicator-with-icon",indicatorWithoutIcon:"indicator-without-icon"},zGt={tooltip:"tooltip"},UGt=Ks`:host{box-sizing:border-box;background-color:var(--calcite-color-foreground-1);color:var(--calcite-color-text-2);font-size:var(--calcite-font-size--1)}:host *{box-sizing:border-box}:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:flex;cursor:pointer;background-color:transparent;--calcite-internal-action-text-color: var(--calcite-color-text-3);border-radius:var(--calcite-action-corner-radius, var(--calcite-action-corner-radius-start-start, var(--calcite-corner-radius)) var(--calcite-action-corner-radius-start-end, var(--calcite-corner-radius)) var(--calcite-action-corner-radius-end-end, var(--calcite-corner-radius)) var(--calcite-action-corner-radius-end-start, var(--calcite-corner-radius)))}.interaction-container{border-radius:inherit}:host([drag-handle]){cursor:move;--calcite-internal-action-text-color: var(--calcite-color-border-input);--calcite-internal-action-padding-inline: var(--calcite-spacing-xxs)}.button{border-radius:inherit;position:relative;margin:0;display:flex;inline-size:auto;align-items:center;justify-content:flex-start;border-style:none;font-family:var(--calcite-font-family);font-size:var(--calcite-font-size--2);line-height:1rem;font-weight:var(--calcite-font-weight-medium);outline-color:transparent;background-color:var(--calcite-action-background-color, var(--calcite-color-foreground-1));color:var(--calcite-action-text-color, var(--calcite-internal-action-text-color));text-align:unset;flex:1 0 auto;cursor:inherit}.button:hover{background-color:var(--calcite-action-background-color-hover, var(--calcite-color-foreground-2));color:var(--calcite-action-text-color-press, var(--calcite-action-text-color-pressed, var(--calcite-color-text-1)))}.button:focus{outline:2px solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline-offset:calc(-2px*(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}.button:active{background-color:var(--calcite-action-background-color-press, var(--calcite-action-background-color-pressed, var(--calcite-color-foreground-3)))}.icon-container{pointer-events:none;margin:0;display:flex;align-items:center;justify-content:center;min-inline-size:1rem;min-block-size:1.5rem}.text-container{margin:0;inline-size:0px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;line-height:1.5rem;opacity:0;transition-property:opacity;transition-duration:.15s;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-property:margin;transition-property:inline-size}.text-container--visible{inline-size:auto;flex:1 1 auto;opacity:1}:host([active]) .button,:host([active]) .button:hover,:host([active]) .button:focus{color:var(--calcite-action-text-color-press, var(--calcite-action-text-color-pressed, var(--calcite-color-text-1)));background-color:var(--calcite-action-background-color-press, var(--calcite-action-background-color-pressed, var(--calcite-color-foreground-3)))}:host([active]) .button:active{background-color:var(--calcite-action-background-color, var(--calcite-color-foreground-1))}:host([loading]) .button:hover,:host([loading]) .button:focus{background-color:var(--calcite-action-background-color, var(--calcite-color-foreground-1))}:host([loading]) .text-container{opacity:var(--calcite-opacity-disabled)}:host([loading]) calcite-loader[inline]{margin-inline-end:0px}:host([appearance=transparent]):host([active]) .button{background-color:var(--calcite-color-transparent-press)}:host([appearance=transparent]) .button{background-color:transparent;transition-property:box-shadow;transition-duration:.15s;transition-timing-function:cubic-bezier(.4,0,.2,1)}:host([appearance=transparent]) .button:hover{background-color:var(--calcite-color-transparent-hover)}:host([appearance=transparent]) .button:active{background-color:var(--calcite-color-transparent-press)}:host([data-active]) .button{outline:2px solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline-offset:calc(-2px*(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}:host([scale=s]) .button{font-size:var(--calcite-font-size--2);line-height:1rem;font-weight:var(--calcite-font-weight-normal);padding-inline:var(--calcite-internal-action-padding-inline, .5rem);padding-block:var(--calcite-internal-action-padding-block, var(--calcite-spacing-xxs))}:host([scale=s]) .button--text-visible .icon-container{margin-inline-end:.5rem}:host([scale=m]) .button{font-size:var(--calcite-font-size--1);line-height:1rem;font-weight:var(--calcite-font-weight-normal);padding-inline:var(--calcite-internal-action-padding-inline, 1rem);padding-block:var(--calcite-internal-action-padding-block, var(--calcite-spacing-md))}:host([scale=m]) .button--text-visible .icon-container{margin-inline-end:.75rem}:host([scale=l]) .button{font-size:var(--calcite-font-size-0);line-height:1.25rem;font-weight:var(--calcite-font-weight-normal);padding-inline:var(--calcite-internal-action-padding-inline, 1.25rem);padding-block:var(--calcite-internal-action-padding-block, var(--calcite-spacing-xl))}:host([scale=l]) .button--text-visible .icon-container{margin-inline-end:1rem}:host([alignment=center]) .button{justify-content:center}:host([alignment=end]) .button{justify-content:flex-end}:host([alignment=center]) .button .text-container--visible,:host([alignment=end]) .button .text-container--visible{flex:0 1 auto}:host([scale=s][compact]) .button,:host([scale=m][compact]) .button,:host([scale=l][compact]) .button{padding-inline:0px}.slot-container{display:flex}.slot-container--hidden{display:none}.button--text-visible{inline-size:100%}.indicator-with-icon{position:relative}.indicator-with-icon:after{content:"";position:absolute;block-size:.5rem;inline-size:.5rem;border-radius:9999px;inset-block-end:-.275rem;inset-inline-end:-.275rem;background-color:var(--calcite-action-indicator-color, var(--calcite-color-brand))}.indicator-without-icon{margin-inline:.25rem;inline-size:1rem;position:relative}.indicator-without-icon:after{content:"";position:absolute;block-size:.5rem;inline-size:.5rem;border-radius:9999px;inset-block-end:-.275rem;inset-inline-end:-.275rem;background-color:var(--calcite-action-indicator-color, var(--calcite-color-brand))}.indicator-text{position:absolute;inline-size:1px;block-size:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}:host([hidden]){display:none}[hidden]{display:none}:host([disabled]) .button,:host([disabled]) .button:hover,:host([disabled]) .button:focus{cursor:default;opacity:var(--calcite-opacity-disabled);background-color:var(--calcite-action-background-color, var(--calcite-action-background-color, var(--calcite-color-foreground-1)))}:host([disabled]):host([active]) .button,:host([disabled]):host([active]) .button:hover,:host([disabled]):host([active]) .button:focus{opacity:var(--calcite-opacity-disabled);background-color:var(--calcite-action-background-color-press, var(--calcite-action-background-color-press, var(--calcite-action-background-color-pressed, var(--calcite-color-foreground-3))))}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}`,bj=class bj extends Hn{constructor(){super(...arguments),this.guid=`calcite-action-${vT()}`,this.buttonEl=Yc(),this.buttonId=`${this.guid}-button`,this.indicatorId=`${this.guid}-indicator`,this.mutationObserver=Tf("mutation",()=>this.requestUpdate()),this.messages=Vd({blocking:!0}),this.active=!1,this.appearance="solid",this.compact=!1,this.disabled=!1,this.dragHandle=!1,this.iconFlipRtl=!1,this.indicator=!1,this.loading=!1,this.scale="m",this.textEnabled=!1}async setFocus(){var e;await yh(this),(e=this.buttonEl.value)==null||e.focus()}connectedCallback(){var e;super.connectedCallback(),(e=this.mutationObserver)==null||e.observe(this.el,{childList:!0,subtree:!0})}updated(){Cg(this)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this.mutationObserver)==null||e.disconnect()}handleTooltipSlotChange(e){const r=e.target.assignedElements({flatten:!0}).filter(s=>s==null?void 0:s.matches("calcite-tooltip"))[0];r&&(r.referenceElement=this.buttonEl.value)}renderTextContainer(){const{text:e,textEnabled:i}=this,r={[cp.textContainer]:!0,[cp.textContainerVisible]:i};return e?er("text-container",ce`<div class=${ge(r)}>${e}</div>`):null}renderIndicatorText(){const{indicator:e,messages:i,indicatorId:r,buttonId:s}=this;return ce`<div aria-labelledby=${s??Pp} aria-live=polite class=${ge(cp.indicatorText)} id=${r??Pp} role=region>${e?i.indicator:null}</div>`}renderIconContainer(){var m;const{loading:e,icon:i,scale:r,el:s,iconFlipRtl:n,indicator:o}=this,a=r==="l"?"l":"m",l=e?ce`<calcite-loader inline .label=${this.messages.loading} .scale=${a}></calcite-loader>`:null,c=i?ce`<calcite-icon class=${ge({[cp.indicatorWithIcon]:o})} .flipRtl=${n} .icon=${i} .scale=${Ya(this.scale)}></calcite-icon>`:null,h=l||c,d=h||((m=s.children)==null?void 0:m.length),f=ce`<div class=${ge({[cp.slotContainer]:!0,[cp.slotContainerHidden]:e})}><slot></slot></div>`;return d?er("icon-container",ce`<div aria-hidden=true class=${ge(cp.iconContainer)}>${h}${f}</div>`):null}renderButton(){const{active:e,compact:i,disabled:r,icon:s,loading:n,textEnabled:o,label:a,text:l,indicator:c,indicatorId:h,buttonId:d,messages:f}=this,m=a||l||"",g=c?f.indicatorLabel.replace("{label}",m):m,v={[cp.button]:!0,[cp.buttonTextVisible]:o,[cp.buttonCompact]:i},_=ce`${this.renderIconContainer()}${this.renderTextContainer()}${!s&&c&&er("indicator-no-icon",ce`<div class=${ge(cp.indicatorWithoutIcon)}></div>`)||""}`;return this.dragHandle?ce`<span aria-controls=${(c?h:null)??Pp} .ariaBusy=${n} .ariaDisabled=${this.disabled?this.disabled:null} .ariaLabel=${g} .ariaPressed=${e} class=${ge(v)} id=${d??Pp} role=button tabindex=${(this.disabled?null:0)??Pp} ${xr(this.buttonEl)}>${_}</span>`:ce`<button aria-controls=${(c?h:null)??Pp} .ariaBusy=${n} .ariaLabel=${g} .ariaPressed=${e} class=${ge(v)} .disabled=${r} id=${d??Pp} tabindex=${(r?null:0)??Pp} ${xr(this.buttonEl)}>${_}</button>`}render(){return $g({disabled:this.disabled,children:ce`${this.renderButton()}<slot name=${zGt.tooltip} @slotchange=${this.handleTooltipSlotChange}></slot>${this.renderIndicatorText()}`})}};bj.properties={active:[7,{},{reflect:!0,type:Boolean}],alignment:[3,{},{reflect:!0}],appearance:[3,{},{reflect:!0}],compact:[7,{},{reflect:!0,type:Boolean}],disabled:[7,{},{reflect:!0,type:Boolean}],dragHandle:[7,{},{reflect:!0,type:Boolean}],icon:[3,{},{reflect:!0}],iconFlipRtl:[7,{},{reflect:!0,type:Boolean}],indicator:[7,{},{reflect:!0,type:Boolean}],label:1,loading:[7,{},{reflect:!0,type:Boolean}],messageOverrides:[0,{},{attribute:!1}],scale:[3,{},{reflect:!0}],text:1,textEnabled:[7,{},{reflect:!0,type:Boolean}]},bj.styles=UGt;let QV=bj;Io("calcite-action",QV);const BGt=Object.freeze(Object.defineProperty({__proto__:null,Action:QV},Symbol.toStringTag,{value:"Module"}));/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const E_={container:"container",containerNone:"container--none-selection",icon:"dropdown-item-icon",iconEnd:"dropdown-item-icon--end",iconStart:"dropdown-item-icon--start",itemContent:"dropdown-item-content",link:"dropdown-link"};/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const VGt=Ks`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{position:relative;display:flex;flex-grow:1;align-items:center;outline-color:transparent}.container{position:relative;display:flex;flex-grow:1;cursor:pointer;align-items:center;text-decoration-line:none;color:var(--calcite-dropdown-item-text-color, var(--calcite-color-text-3));text-align:start;outline-color:transparent}.container a{outline:none;position:relative;display:flex;flex-grow:1;cursor:pointer;align-items:center;text-decoration-line:none;color:var(--calcite-dropdown-item-text-color, var(--calcite-color-text-3))}.dropdown-item-content{flex:1 1 auto;padding-block:.125rem}.dropdown-item-icon{position:relative;opacity:0;transition-duration:.15s;transition-timing-function:cubic-bezier(.4,0,.2,1);transform:scale(.9)}:host([scale=s]) .container{padding-block:.25rem;padding-inline:.5rem;font-size:var(--calcite-font-size--2);line-height:1rem}:host([scale=s]) .dropdown-item-icon,:host([scale=s]) .dropdown-item-icon--start{padding-inline-end:var(--calcite-spacing-sm)}:host([scale=s]) .dropdown-item-icon--end{padding-inline-start:var(--calcite-spacing-sm)}:host([scale=m]) .container{padding-block:.5rem;padding-inline:.75rem;font-size:var(--calcite-font-size--1);line-height:1rem}:host([scale=m]) .dropdown-item-icon,:host([scale=m]) .dropdown-item-icon--start{padding-inline-end:var(--calcite-spacing-md)}:host([scale=m]) .dropdown-item-icon--end{padding-inline-start:var(--calcite-spacing-md)}:host([scale=l]) .container{padding-block:.625rem;padding-inline:1rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=l]) .dropdown-item-icon,:host([scale=l]) .dropdown-item-icon--start{padding-inline-end:var(--calcite-spacing-lg)}:host([scale=l]) .dropdown-item-icon--end{padding-inline-start:var(--calcite-spacing-lg)}:host(:focus) .container{text-decoration-line:none;outline:2px solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline-offset:calc(-2px*(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}:host(:hover:not([disabled])) .container{background-color:var(--calcite-dropdown-item-background-color-hover, var(--calcite-color-foreground-2))}:host(:active:not([disabled])) .container{background-color:var(--calcite-dropdown-item-background-color-press, var(--calcite-color-foreground-3))}:host(:hover:not([disabled])) .container,:host(:active:not([disabled])) .container{text-decoration-line:none;color:var(--calcite-dropdown-item-text-color-press, var(--calcite-color-text-1))}:host(:hover:not([disabled])) .dropdown-link,:host(:active:not([disabled])) .dropdown-link{color:var(--calcite-dropdown-item-text-color-press, var(--calcite-color-text-1))}:host([selected]) .container:not(.container--none-selection),:host([selected]) .dropdown-link{font-weight:var(--calcite-font-weight-medium);color:var(--calcite-dropdown-item-text-color-press, var(--calcite-color-text-1))}:host([selected]) .container:not(.container--none-selection) calcite-icon,:host([selected]) .dropdown-link calcite-icon{color:var(--calcite-dropdown-item-icon-color-press, var(--calcite-color-brand))}:host(:hover:not([disabled])) .dropdown-item-icon{color:var(--calcite-dropdown-item-icon-color-hover)}:host([selected]) .dropdown-item-icon{opacity:1}:host([hidden]){display:none}[hidden]{display:none}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}`,wj=class wj extends Hn{constructor(){super(),this.childLink=Yc(),this.disabled=!1,this.scale="m",this.selected=!1,this.selectionMode="single",this.calciteDropdownItemSelect=Gt({cancelable:!1}),this.calciteInternalDropdownCloseRequest=Gt({cancelable:!1}),this.calciteInternalDropdownItemKeyEvent=Gt({cancelable:!1}),this.calciteInternalDropdownItemSelect=Gt({cancelable:!1}),this.listen("click",this.onClick),this.listen("keydown",this.keyDownHandler),this.listenOn(document.body,"calciteInternalDropdownItemChange",this.updateActiveItemOnChange)}async setFocus(){var e;await yh(this),(e=this.el)==null||e.focus()}connectedCallback(){super.connectedCallback(),this.initialize()}load(){this.initialize()}updated(){Cg(this)}onClick(){this.emitRequestedItem()}keyDownHandler(e){switch(e.key){case" ":case"Enter":this.emitRequestedItem(),this.href&&this.childLink.value.click(),e.preventDefault();break;case"Escape":this.calciteInternalDropdownCloseRequest.emit(),e.preventDefault();break;case"Tab":this.calciteInternalDropdownItemKeyEvent.emit({keyboardEvent:e});break;case"ArrowUp":case"ArrowDown":case"Home":case"End":e.preventDefault(),this.calciteInternalDropdownItemKeyEvent.emit({keyboardEvent:e});break}}updateActiveItemOnChange(e){e.composedPath().includes(this.parentDropdownGroupEl)&&(this.requestedDropdownGroup=e.detail.requestedDropdownGroup,this.requestedDropdownItem=e.detail.requestedDropdownItem,this.determineActiveItem()),e.stopPropagation()}initialize(){this.parentDropdownGroupEl=this.el.closest("calcite-dropdown-group"),this.selectionMode==="none"&&(this.selected=!1)}determineActiveItem(){switch(this.selectionMode){case"multiple":this.el===this.requestedDropdownItem&&(this.selected=!this.selected);break;case"single":this.el===this.requestedDropdownItem?this.selected=!0:this.requestedDropdownGroup===this.parentDropdownGroupEl&&(this.selected=!1);break;case"none":this.selected=!1;break}}emitRequestedItem(){this.calciteDropdownItemSelect.emit(),this.calciteInternalDropdownItemSelect.emit({requestedDropdownItem:this.el,requestedDropdownGroup:this.parentDropdownGroupEl})}render(){const{href:e,selectionMode:i,label:r,iconFlipRtl:s}=this,n=ce`<calcite-icon class=${ge(E_.iconStart)} .flipRtl=${s==="start"||s==="both"} .icon=${this.iconStart} .scale=${Ya(this.scale)}></calcite-icon>`,o=ce`<span class=${ge(E_.itemContent)}><slot></slot></span>`,a=ce`<calcite-icon class=${ge(E_.iconEnd)} .flipRtl=${s==="end"||s==="both"} .icon=${this.iconEnd} .scale=${Ya(this.scale)}></calcite-icon>`,l=this.iconStart&&this.iconEnd?[n,o,a]:this.iconStart?[n,o]:this.iconEnd?[o,a]:o,c=e?ce`<a .ariaLabel=${r} class=${ge(E_.link)} href=${e??Pp} rel=${this.rel??Pp} tabindex=-1 target=${this.target??Pp} ${xr(this.childLink)}>${l}</a>`:l,h=e?null:i==="single"?"menuitemradio":i==="multiple"?"menuitemcheckbox":"menuitem",d=i!=="none"?hH(this.selected):null,{disabled:f}=this;return this.el.ariaChecked=d,this.el.ariaLabel=e?"":r,this.el.role=h,FG(this.el,"tabIndex",f?-1:0),$g({disabled:f,children:ce`<div class=${ge({[E_.container]:!0,[E_.containerNone]:i==="none"})}>${i!=="none"?ce`<calcite-icon class=${ge(E_.icon)} .icon=${i==="multiple"?"check":"bullet-point"} .scale=${Ya(this.scale)}></calcite-icon>`:null}${c}</div>`})}};wj.properties={disabled:[7,{},{reflect:!0,type:Boolean}],href:[3,{},{reflect:!0}],iconEnd:[3,{},{reflect:!0}],iconFlipRtl:[3,{},{reflect:!0}],iconStart:[3,{},{reflect:!0}],label:1,rel:[3,{},{reflect:!0}],scale:[3,{},{reflect:!0}],selected:[7,{},{reflect:!0,type:Boolean}],selectionMode:1,target:[3,{},{reflect:!0}]},wj.styles=VGt;let ej=wj;Io("calcite-dropdown-item",ej);const agi=Object.freeze(Object.defineProperty({__proto__:null,DropdownItem:ej},Symbol.toStringTag,{value:"Module"}));/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const pxe={title:"dropdown-title",separator:"dropdown-separator"},jGt=Ks`:host{display:block}.container{text-align:start}.dropdown-title{margin-block-end:-1px;display:block;cursor:default;overflow-wrap:break-word;border-width:0px;border-block-end-width:1px;border-style:solid;font-weight:var(--calcite-font-weight-bold);border-color:var(--calcite-dropdown-group-border-color, var(--calcite-color-border-3));color:var(--calcite-dropdown-group-title-text-color, var(--calcite-color-text-2))}.dropdown-separator{display:block;block-size:1px;background-color:var(--calcite-dropdown-group-border-color, var(--calcite-color-border-3))}:host([scale=s]){font-size:var(--calcite-font-size--2);line-height:1rem}:host([scale=s]) .dropdown-title{padding:.5rem}:host([scale=m]){font-size:var(--calcite-font-size--1);line-height:1rem}:host([scale=m]) .dropdown-title{padding:.75rem}:host([scale=l]){font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=l]) .dropdown-title{padding:1rem}:host([hidden]){display:none}[hidden]{display:none}`,KP=class KP extends Hn{constructor(){super(),this.mutationObserver=Tf("mutation",()=>this.updateItems()),this.position=-1,this.scale="m",this.selectionMode="single",this.calciteInternalDropdownItemChange=Gt({cancelable:!1}),this.listen("calciteInternalDropdownItemSelect",this.updateActiveItemOnChange)}connectedCallback(){var e;super.connectedCallback(),this.updateItems(),(e=this.mutationObserver)==null||e.observe(this.el,{childList:!0})}willUpdate(e){e.has("selectionMode")&&(this.hasUpdated||this.selectionMode!=="single")&&this.updateItems()}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this.mutationObserver)==null||e.disconnect()}updateActiveItemOnChange(e){this.requestedDropdownGroup=e.detail.requestedDropdownGroup,this.requestedDropdownItem=e.detail.requestedDropdownItem,this.calciteInternalDropdownItemChange.emit({requestedDropdownGroup:this.requestedDropdownGroup,requestedDropdownItem:this.requestedDropdownItem})}updateItems(){Array.from(this.el.querySelectorAll("calcite-dropdown-item")).forEach(e=>e.selectionMode=this.selectionMode)}render(){const e=this.groupTitle?ce`<span aria-hidden=true class=${ge(pxe.title)}>${this.groupTitle}</span>`:null,i=this.position>0?ce`<div class=${ge(pxe.separator)} role=separator></div>`:null;return this.el.ariaLabel=this.groupTitle,this.el.role="group",ce`<div class=${ge({[E_.container]:!0})}>${i}${e}<slot></slot></div>`}};KP.properties={groupTitle:[3,{},{reflect:!0}],position:[9,{},{type:Number}],scale:[3,{},{reflect:!0}],selectionMode:[3,{},{reflect:!0}]},KP.shadowRootOptions={mode:"open",delegatesFocus:!0},KP.styles=jGt;let tj=KP;Io("calcite-dropdown-group",tj);const lgi=Object.freeze(Object.defineProperty({__proto__:null,DropdownGroup:tj},Symbol.toStringTag,{value:"Module"}));/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const fxe={handle:"handle",dropdown:"dropdown"},mxe={drag:"drag",blank:"blank"},fW={label:"{label}",position:"{position}",total:"{total}"},gxe=["top","up","down","bottom"],GGt=Ks`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:flex}.dropdown{block-size:100%}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}:host([hidden]){display:none}[hidden]{display:none}`,xj=class xj extends Hn{constructor(){super(...arguments),this.disabled=!1,this.messages=Vd({blocking:!0}),this.moveToItems=[],this.open=!1,this.overlayPositioning="absolute",this.placement=kte,this.scale="m",this.calciteSortHandleBeforeClose=Gt({cancelable:!1}),this.calciteSortHandleBeforeOpen=Gt({cancelable:!1}),this.calciteSortHandleClose=Gt({cancelable:!1}),this.calciteSortHandleMove=Gt({cancelable:!0}),this.calciteSortHandleOpen=Gt({cancelable:!1}),this.calciteSortHandleReorder=Gt({cancelable:!0})}get hasSetInfo(){return typeof this.setPosition=="number"&&typeof this.setSize=="number"}get isSetDisabled(){const{setPosition:e,setSize:i,moveToItems:r}=this;return this.hasSetInfo?e<1||i<1||i<2&&r.length<1:!1}async setFocus(){var e;await yh(this),(e=this.dropdownEl)==null||e.setFocus()}willUpdate(e){e.has("open")&&(this.hasUpdated||this.open!==!1)&&this.openHandler()}updated(){Cg(this)}openHandler(){if(this.disabled){this.open=!1;return}this.dropdownEl&&(this.dropdownEl.open=this.open)}setDropdownEl(e){e&&(this.dropdownEl=e,this.openHandler())}getLabel(){const{label:e,messages:i,setPosition:r,setSize:s}=this;if(!this.hasSetInfo)return e??"";let n=e?i.repositionLabel.replace(fW.label,e):i.reposition;return n=n.replace(fW.position,r?r.toString():""),n.replace(fW.total,s?s.toString():"")}handleBeforeOpen(e){e.stopPropagation(),this.calciteSortHandleBeforeOpen.emit()}handleOpen(e){e.stopPropagation(),this.calciteSortHandleOpen.emit(),this.open=!0}handleBeforeClose(e){e.stopPropagation(),this.calciteSortHandleBeforeClose.emit()}handleClose(e){e.stopPropagation(),this.calciteSortHandleClose.emit(),this.open=!1}handleReorder(e){this.calciteSortHandleReorder.emit({reorder:e.target.dataset.value})}handleMoveTo(e){const i=e.target.dataset.id,r=this.moveToItems.find(s=>s.id===i);this.calciteSortHandleMove.emit({moveTo:r})}render(){const{disabled:e,flipPlacements:i,open:r,overlayPositioning:s,placement:n,scale:o,widthScale:a}=this,l=this.getLabel(),c=e||this.isSetDisabled;return $g({disabled:e,children:ce`<calcite-dropdown class=${ge(fxe.dropdown)} .disabled=${c} .flipPlacements=${i} @calciteDropdownBeforeClose=${this.handleBeforeClose} @calciteDropdownBeforeOpen=${this.handleBeforeOpen} @calciteDropdownClose=${this.handleClose} @calciteDropdownOpen=${this.handleOpen} .overlayPositioning=${s} .placement=${n} .scale=${o} .widthScale=${a} ${xr(this.setDropdownEl)}><calcite-action .active=${r} appearance=transparent class=${ge(fxe.handle)} .dragHandle=${!0} .icon=${e?mxe.blank:mxe.drag} .label=${l} .scale=${o} slot=trigger .text=${l} title=${l??Ke}></calcite-action>${this.renderGroup()}${this.renderMoveToGroup()}</calcite-dropdown>`})}renderMoveToItem(e){return er(e.id,ce`<calcite-dropdown-item data-id=${e.id??Ke} .label=${e.label} @calciteDropdownItemSelect=${this.handleMoveTo}>${e.label}</calcite-dropdown-item>`)}renderGroup(){return this.hasSetInfo?er("reorder",ce`<calcite-dropdown-group .groupTitle=${this.messages.reorder} .scale=${this.scale} selection-mode=none>${this.renderTop()}${this.renderUp()}${this.renderDown()}${this.renderBottom()}</calcite-dropdown-group>`):null}renderMoveToGroup(){const{messages:e,moveToItems:i,scale:r}=this;return i.length?er("move-to-items",ce`<calcite-dropdown-group .groupTitle=${e.moveTo} .scale=${r} selection-mode=none>${i.map(s=>this.renderMoveToItem(s))}</calcite-dropdown-group>`):null}renderDropdownItem(e,i){return er(gxe[e],ce`<calcite-dropdown-item data-value=${gxe[e]??Ke} .label=${i} @calciteDropdownItemSelect=${this.handleReorder}>${i}</calcite-dropdown-item>`)}renderTop(){const{setPosition:e}=this;return e!==1&&e!==2?this.renderDropdownItem(0,this.messages.moveToTop):null}renderUp(){return this.setPosition!==1?this.renderDropdownItem(1,this.messages.moveUp):null}renderDown(){return this.setPosition!==this.setSize?this.renderDropdownItem(2,this.messages.moveDown):null}renderBottom(){const{setPosition:e,setSize:i}=this;return e!==i&&e!==i-1?this.renderDropdownItem(3,this.messages.moveToBottom):null}};xj.properties={hasSetInfo:[16,{},{state:!0}],isSetDisabled:[16,{},{state:!0}],disabled:[7,{},{reflect:!0,type:Boolean}],flipPlacements:[0,{},{attribute:!1}],label:1,messageOverrides:[0,{},{attribute:!1}],messages:[0,{},{attribute:!1}],moveToItems:[0,{},{attribute:!1}],open:[7,{},{reflect:!0,type:Boolean}],overlayPositioning:[3,{},{reflect:!0}],placement:[3,{},{reflect:!0}],scale:[3,{},{reflect:!0}],setPosition:[9,{},{type:Number}],setSize:[9,{},{type:Number}],widthScale:[3,{},{reflect:!0}]},xj.styles=GGt;let zte=xj;Io("calcite-sort-handle",zte);/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const HGt=Ks`:host(.calcite-sortable--ghost){position:relative;overflow:hidden}:host(.calcite-sortable--ghost):before{content:"";position:absolute;inset-block:0px;inset-inline-start:0px;inset-inline-end:0px;z-index:var(--calcite-z-index);box-sizing:border-box;border-width:1px;border-style:dashed;border-color:var(--calcite-color-brand);background-color:var(--calcite-color-foreground-2)}:host(.calcite-sortable--drag){--tw-shadow: 0 6px 20px -4px rgba(0, 0, 0, .1), 0 4px 12px -2px rgba(0, 0, 0, .08);--tw-shadow-colored: 0 6px 20px -4px var(--tw-shadow-color), 0 4px 12px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}`;/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const hr={actionsEnd:"actions-end",actionsStart:"actions-start",description:"description",close:"close",container:"container",containerHover:"container--hover",containerBorder:"container--border",containerBorderSelected:"container--border-selected",containerBorderUnselected:"container--border-unselected",content:"content",contentBottom:"content-bottom",contentContainer:"content-container",contentContainerHasCenterContent:"content-container--has-center-content",contentContainerSelectable:"content-container--selectable",contentContainerUnavailable:"content-container--unavailable",contentContainerWrapper:"content-container-wrapper",contentContainerWrapperBordered:"content-container-wrapper--bordered",contentEnd:"content-end",contentStart:"content-start",customContent:"custom-content",expandedContainer:"expanded-container",dragContainer:"drag-container",gridCell:"grid-cell",icon:"icon",nestedContainer:"nested-container",nestedContainerExpanded:"nested-container--expanded",label:"label",row:"row",selectionContainer:"selection-container",selectionContainerSingle:"selection-container--single",wrapper:"wrapper",wrapperBordered:"wrapper--bordered"},OE={actionsStart:"actions-start",contentStart:"content-start",content:"content",contentBottom:"content-bottom",contentEnd:"content-end",actionsEnd:"actions-end"},cgi=0,Zg={selectedMultiple:"check-square-f",selectedSingle:"circle-inset-large",unselectedMultiple:"square",unselectedSingle:"circle",collapsedLTR:"chevron-right",collapsedRTL:"chevron-left",open:"chevron-down",blank:"blank",close:"x"},yxe="data-test-active";/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const qGt=Ks`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:flex;flex-direction:column}:host([filter-hidden]),:host([closed]){display:none}.wrapper--bordered{border-block-end:1px solid var(--calcite-list-border-color, var(--calcite-color-border-3))}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}.container{box-sizing:border-box;display:flex;flex:1 1 0%;overflow:hidden;background-color:var(--calcite-list-background-color, var(--calcite-color-foreground-1))}.container *{box-sizing:border-box}.container--hover:hover{cursor:pointer;background-color:var(--calcite-list-background-color-hover, var(--calcite-color-foreground-2))}.container:active{background-color:var(--calcite-list-background-color-press, var(--calcite-color-foreground-3))}.container--border{position:relative}.container--border:before{position:absolute;inline-size:var(--calcite-border-width-lg);inset-block:0;inset-inline-start:0;background-color:transparent;content:""}.container--border-selected:before{background-color:var(--calcite-list-selection-border-color, var(--calcite-color-brand))}.container--border-selected:focus{box-shadow:inset var(--calcite-border-width-lg) 0 0 0 var(--calcite-list-selection-border-color, var(--calcite-color-brand))}.nested-container{display:none;flex-direction:column;border-width:0px;border-style:solid;border-color:1px solid var(--calcite-list-border-color, var(--calcite-color-border-3));margin-inline-start:var(--calcite-list-spacing-indent, 1.5rem)}.nested-container--expanded{display:flex}.selection-container{display:flex;padding-block:0px;color:var(--calcite-list-icon-color, var(--calcite-color-border-input))}:host(:not([disabled]):not([selected])) .container:hover .selection-container--single{color:var(--calcite-list-icon-color, var(--calcite-color-border-input))}:host([selected]:hover) .selection-container,:host([selected]:hover) .selection-container--single,:host([selected]) .selection-container{color:var(--calcite-list-icon-color, var(--calcite-color-brand))}.content-container-wrapper{display:flex;flex:1 1 auto}.content-container-wrapper--bordered{border-block-end:1px solid var(--calcite-list-border-color, var(--calcite-color-border-3))}.content-container{display:flex;flex:1 1 auto;-webkit-user-select:none;user-select:none;align-items:stretch;font-weight:var(--calcite-font-weight-normal);color:var(--calcite-list-content-text-color, var(--calcite-color-text-2))}.content-container--unavailable{opacity:var(--calcite-opacity-disabled)}.row,.grid-cell{outline-color:transparent}.row{position:relative}.row:focus,.grid-cell:focus{outline:2px solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline-offset:calc(-2px*(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}.content,.custom-content{display:flex;flex:1 1 auto;flex-direction:column;justify-content:center;line-height:var(--calcite-font-line-height-relative-snug)}.label{color:var(--calcite-list-label-text-color, var(--calcite-color-text-1))}.description{color:var(--calcite-list-description-text-color, var(--calcite-color-text-3))}.icon{align-self:center;color:var(--calcite-list-icon-color, var(--calcite-color-text-3))}.icon:hover,.icon:active{color:var(--calcite-color-text-1)}:host([display-mode=flat][drag-handle]:is([selection-mode=none],[selection-appearance=border])) .drag-container{padding-inline-end:var(--calcite-spacing-xxs)}:host([scale=s]) .actions-start{padding-inline-end:var(--calcite-spacing-sm)}:host([scale=s]) .content-container{gap:var(--calcite-spacing-sm);min-block-size:32px;padding-block:var(--calcite-spacing-xxs);padding-inline-end:var(--calcite-spacing-sm)}:host([scale=s]) .content,:host([scale=s]) .custom-content,:host([scale=s]) .label{font-size:var(--calcite-font-size--2)}:host([scale=s]) .description{font-size:var(--calcite-font-size--3)}:host([scale=s][display-mode=flat]:not([drag-handle])) .container{padding-inline-start:var(--calcite-spacing-sm)}:host([scale=s][display-mode=flat]:not([drag-handle])) .selection-container{padding-inline-end:var(--calcite-spacing-sm)}:host([scale=s][display-mode=flat][drag-handle]) .selection-container{padding-inline:var(--calcite-spacing-xxs) var(--calcite-spacing-sm)}:host([scale=s][display-mode=nested]) .selection-container{padding-inline-end:var(--calcite-spacing-xxs)}:host([scale=s][display-mode=nested][selection-appearance=icon]:not([selection-mode=none]):not([drag-handle])) .container{padding-inline-start:var(--calcite-spacing-sm)}:host([scale=s][display-mode=nested][selection-appearance=icon]:not([selection-mode=none]):not([drag-handle])) .selection-container{padding-inline-end:var(--calcite-spacing-xxs)}:host([scale=s][display-mode=nested][drag-handle]) .selection-container{padding-inline:var(--calcite-spacing-xxs)}:host([scale=m]) .actions-start{padding-inline-end:var(--calcite-spacing-sm)}:host([scale=m]) .content-container{gap:var(--calcite-spacing-sm);min-block-size:40px;padding-block:var(--calcite-spacing-sm);padding-inline-end:var(--calcite-spacing-md)}:host([scale=m]) .content,:host([scale=m]) .custom-content{font-size:var(--calcite-font-size--2)}:host([scale=m]) .label{font-size:var(--calcite-font-size--1)}:host([scale=m]) .description{font-size:var(--calcite-font-size--2)}:host([scale=m][display-mode=flat]) .container{padding-inline-start:var(--calcite-spacing-md)}:host([scale=m][display-mode=flat]) .selection-container{padding-inline-end:var(--calcite-spacing-sm)}:host([scale=m][display-mode=flat][drag-handle]) .container{padding-inline-start:0}:host([scale=m][display-mode=flat][drag-handle]) .selection-container{padding-inline:var(--calcite-spacing-xxs) var(--calcite-spacing-sm)}:host([scale=m][display-mode=nested]) .container{padding-inline-start:var(--calcite-spacing-xxs)}:host([scale=m][display-mode=nested]) .selection-container{padding-inline-end:var(--calcite-spacing-xxs)}:host([scale=m][display-mode=nested][selection-appearance=icon]:not([selection-mode=none]):not([drag-handle])) .container{padding-inline-start:var(--calcite-spacing-md)}:host([scale=m][display-mode=nested][drag-handle]) .container{padding-inline-start:0}:host([scale=m][display-mode=nested][drag-handle]) .selection-container{padding-inline:var(--calcite-spacing-xxs)}:host([scale=l]) .actions-start{padding-inline-end:var(--calcite-spacing-md)}:host([scale=l]) .content-container{gap:var(--calcite-spacing-md);min-block-size:56px;padding-block:.625rem;padding-inline-end:var(--calcite-spacing-lg)}:host([scale=l]) .content,:host([scale=l]) .custom-content,:host([scale=l]) .label{font-size:var(--calcite-font-size-0)}:host([scale=l]) .description{font-size:var(--calcite-font-size--1)}:host([scale=l]) .nested-container{margin-inline-start:1.75rem}:host([scale=l][display-mode=flat]) .container{padding-inline-start:var(--calcite-spacing-lg)}:host([scale=l][display-mode=flat]) .selection-container{padding-inline-end:var(--calcite-spacing-md)}:host([scale=l][display-mode=flat][drag-handle]) .container{padding-inline-start:0}:host([scale=l][display-mode=flat][drag-handle]) .selection-container{padding-inline-end:var(--calcite-spacing-md)}:host([scale=l][display-mode=nested]) .container{padding-inline-start:var(--calcite-spacing-xxs)}:host([scale=l][display-mode=nested][drag-handle]) .container{padding-inline-start:0}:host([scale=l][display-mode=nested][selection-appearance=icon]:not([selection-mode=none]):not([drag-handle])) .container{padding-inline-start:var(--calcite-spacing-lg)}.label,.description,.content-bottom{font-family:var(--calcite-font-family);font-weight:var(--calcite-font-weight-normal);word-wrap:break-word;word-break:break-word}:host([selected]) .label{font-weight:var(--calcite-font-weight-medium)}:host([selected]) .icon{color:var(--calcite-list-icon-color, var(--calcite-color-text-1))}:host([selected]) .description{color:var(--calcite-list-description-text-color, var(--calcite-color-text-2))}.content-start{justify-content:flex-start}.content-end{justify-content:flex-end}.content-start,.content-end{flex:1 1 auto}.content-start ::slotted(calcite-icon),.content-end ::slotted(calcite-icon){align-self:center}.content-bottom{display:flex;flex-direction:column}.content-container--has-center-content .content-start,.content-container--has-center-content .content-end{flex:0 1 auto}.expanded-container{color:var(--calcite-list-icon-color, var(--calcite-color-text-3));padding-inline:var(--calcite-spacing-xxs)}:host(:not([disabled])) .expanded-container:hover{color:var(--calcite-list-icon-color, var(--calcite-color-text-1))}.actions-start,.actions-end,.content-start,.content-end,.selection-container,.drag-container,.expanded-container{display:flex;align-items:center}.actions-start calcite-action,.actions-start calcite-sort-handle,.actions-end calcite-action,.actions-end calcite-sort-handle,.content-start calcite-action,.content-start calcite-sort-handle,.content-end calcite-action,.content-end calcite-sort-handle,.selection-container calcite-action,.selection-container calcite-sort-handle,.drag-container calcite-action,.drag-container calcite-sort-handle,.expanded-container calcite-action,.expanded-container calcite-sort-handle{align-self:stretch}.drag-container,.selection-container,.expanded-container{padding-block-end:var(--calcite-spacing-px)}.expanded-container,.selection-container{cursor:pointer}.actions-start,.actions-end{position:relative;padding:0}.actions-start ::slotted(calcite-action),.actions-start ::slotted(calcite-action-menu),.actions-start ::slotted(calcite-sort-handle),.actions-start ::slotted(calcite-dropdown),.actions-end ::slotted(calcite-action),.actions-end ::slotted(calcite-action-menu),.actions-end ::slotted(calcite-sort-handle),.actions-end ::slotted(calcite-dropdown){align-self:stretch;color:inherit}.row:focus .actions-start,.row:focus .actions-end{inset-block:.125rem}.row:focus .actions-start .close,.row:focus .actions-start ::slotted(calcite-action),.row:focus .actions-start ::slotted(calcite-action-menu),.row:focus .actions-start ::slotted(calcite-sort-handle),.row:focus .actions-start ::slotted(calcite-dropdown),.row:focus .actions-end .close,.row:focus .actions-end ::slotted(calcite-action),.row:focus .actions-end ::slotted(calcite-action-menu),.row:focus .actions-end ::slotted(calcite-sort-handle),.row:focus .actions-end ::slotted(calcite-dropdown){block-size:calc(100% - .25rem)}.row:focus:after,.row:focus:before{position:absolute;content:"";inline-size:.125rem;z-index:var(--calcite-z-index-header);background-color:var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));inset-block:0}.row:focus:before{inset-inline-start:0}.row:focus:after{inset-inline-end:0}.container--border:focus:before{display:none}::slotted(calcite-list:empty){border-block-start-width:0px}:host([hidden]){display:none}[hidden]{display:none}`,mW=new Map,Sj=class Sj extends Hn{constructor(){super(),this.actionsEndEl=Yc(),this.actionsStartEl=Yc(),this.containerEl=Yc(),this.contentEl=Yc(),this.defaultSlotEl=Yc(),this.handleGridEl=Yc(),this.messages=Vd(),this.hasActionsEnd=!1,this.hasActionsStart=!1,this.hasContentBottom=!1,this.hasContentEnd=!1,this.hasContentStart=!1,this.hasCustomContent=!1,this.level=null,this.expandable=!1,this.active=!1,this.bordered=!1,this.closable=!1,this.closed=!1,this.disabled=!1,this.dragDisabled=!1,this.dragHandle=!1,this.expanded=!1,this.filterHidden=!1,this.interactionMode=null,this.displayMode="flat",this.moveToItems=[],this.scale="m",this.selected=!1,this.selectionAppearance=null,this.selectionMode=null,this.sortHandleOpen=!1,this.unavailable=!1,this.calciteInternalFocusPreviousItem=Gt({cancelable:!1}),this.calciteInternalListItemActive=Gt({cancelable:!1}),this.calciteInternalListItemChange=Gt({cancelable:!1}),this.calciteInternalListItemSelect=Gt({cancelable:!1}),this.calciteInternalListItemSelectMultiple=Gt({cancelable:!1}),this.calciteInternalListItemToggle=Gt({cancelable:!1}),this.calciteListItemClose=Gt({cancelable:!1}),this.calciteListItemSelect=Gt({cancelable:!1}),this.calciteListItemSortHandleBeforeClose=Gt({cancelable:!1}),this.calciteListItemSortHandleBeforeOpen=Gt({cancelable:!1}),this.calciteListItemSortHandleClose=Gt({cancelable:!1}),this.calciteListItemSortHandleOpen=Gt({cancelable:!1}),this.calciteListItemToggle=Gt({cancelable:!1}),this.listen("calciteInternalListItemGroupDefaultSlotChange",this.handleCalciteInternalListDefaultSlotChanges),this.listen("calciteInternalListDefaultSlotChange",this.handleCalciteInternalListDefaultSlotChanges)}get open(){return this.expanded}set open(e){tBe.deprecated("property",{name:"open",removalVersion:4,suggested:"expanded"}),this.expanded=e}async setFocus(){await yh(this);const{containerEl:{value:e},parentListEl:i}=this,r=mW.get(i);if(typeof r=="number"){const s=this.getGridCells();s[r]?this.focusCell(s[r]):e==null||e.focus();return}e==null||e.focus()}connectedCallback(){super.connectedCallback();const{el:e}=this;this.parentListEl=e.closest(VP),this.level=pjt(e)+1,this.setSelectionDefaults()}willUpdate(e){e.has("active")&&(this.hasUpdated||this.active!==!1)&&this.activeHandler(this.active),e.has("closed")&&(this.hasUpdated||this.closed!==!1)&&this.handleClosedChange(),e.has("disabled")&&(this.hasUpdated||this.disabled!==!1)&&this.handleDisabledChange(),e.has("expanded")&&(this.hasUpdated||this.expanded!==!1)&&this.handleExpandedChange(),e.has("selected")&&(this.hasUpdated||this.selected!==!1)&&this.handleSelectedChange(),e.has("sortHandleOpen")&&(this.hasUpdated||this.sortHandleOpen!==!1)&&this.sortHandleOpenHandler(),e.has("displayMode")&&this.hasUpdated&&this.handleExpandableChange(this.defaultSlotEl.value)}updated(){Cg(this)}activeHandler(e){e||this.focusCell(null,!1)}handleClosedChange(){this.emitCalciteInternalListItemChange()}handleDisabledChange(){this.emitCalciteInternalListItemChange()}handleExpandedChange(){this.emitCalciteInternalListItemToggle()}handleSelectedChange(){this.calciteInternalListItemSelect.emit()}sortHandleOpenHandler(){this.sortHandleEl&&(this.sortHandleEl.open=this.sortHandleOpen)}handleCalciteInternalListDefaultSlotChanges(e){e.stopPropagation(),this.handleExpandableChange(this.defaultSlotEl.value)}setSortHandleEl(e){this.sortHandleEl=e,this.sortHandleOpenHandler()}handleSortHandleBeforeOpen(e){e.stopPropagation(),this.calciteListItemSortHandleBeforeOpen.emit()}handleSortHandleBeforeClose(e){e.stopPropagation(),this.calciteListItemSortHandleBeforeClose.emit()}handleSortHandleClose(e){e.stopPropagation(),this.sortHandleOpen=!1,this.calciteListItemSortHandleClose.emit()}handleSortHandleOpen(e){e.stopPropagation(),this.sortHandleOpen=!0,this.calciteListItemSortHandleOpen.emit()}emitInternalListItemActive(){this.calciteInternalListItemActive.emit()}emitCalciteInternalListItemToggle(){this.calciteInternalListItemToggle.emit()}emitCalciteInternalListItemChange(){this.calciteInternalListItemChange.emit()}handleCloseClick(){this.closed=!0,this.calciteListItemClose.emit()}handleContentSlotChange(e){this.hasCustomContent=Os(e)}handleActionsStartSlotChange(e){this.hasActionsStart=Os(e)}handleActionsEndSlotChange(e){this.hasActionsEnd=Os(e)}handleContentStartSlotChange(e){this.hasContentStart=Os(e)}handleContentEndSlotChange(e){this.hasContentEnd=Os(e)}handleContentBottomSlotChange(e){this.hasContentBottom=Os(e)}setSelectionDefaults(){const{parentListEl:e,selectionMode:i,selectionAppearance:r}=this;e&&(i||(this.selectionMode=e.selectionMode),r||(this.selectionAppearance=e.selectionAppearance))}handleExpandableChange(e){if(!e)return;const i=hjt(e);i.lists.forEach(r=>{r.displayMode=this.displayMode}),this.expandable=this.displayMode==="nested"&&(i.lists.length>0||i.items.length>0)}handleDefaultSlotChange(e){this.handleExpandableChange(e.target)}handleToggleClick(){this.toggle()}toggle(e=!this.expanded){this.expanded=e,this.calciteListItemToggle.emit()}handleItemClick(e){e.defaultPrevented||this.toggleSelected(e.shiftKey)}async toggleSelected(e){const{selectionMode:i,selected:r}=this;this.disabled||(i==="multiple"||i==="single"?this.selected=!r:i==="single-persist"&&(this.selected=!0),this.calciteInternalListItemSelectMultiple.emit({selectMultiple:e&&i==="multiple"}),await this.updateComplete,this.calciteListItemSelect.emit())}getGridCells(){return[this.handleGridEl.value,this.actionsStartEl.value,this.contentEl.value,this.actionsEndEl.value].filter(e=>e&&!e.hidden)}handleItemKeyDown(e){if(e.defaultPrevented)return;const{key:i}=e,r=e.composedPath(),{containerEl:{value:s},actionsStartEl:{value:n},actionsEndEl:{value:o},expanded:a,expandable:l}=this,c=this.getGridCells(),h=c.findIndex(d=>r.includes(d));if(i==="Enter"&&!r.includes(n)&&!r.includes(o))e.preventDefault(),this.toggleSelected(e.shiftKey);else if(i==="ArrowRight"){e.preventDefault();const d=h+1;h===-1?!a&&l?(this.toggle(!0),this.focusCell(null)):c[0]&&this.focusCell(c[0]):c[h]&&c[d]&&this.focusCell(c[d])}else if(i==="ArrowLeft"){e.preventDefault();const d=h-1;h===-1?(this.focusCell(null),a&&l?this.toggle(!1):this.calciteInternalFocusPreviousItem.emit()):h===0?(this.focusCell(null),s.focus()):c[h]&&c[d]&&this.focusCell(c[d])}}focusCellNull(){this.focusCell(null)}setFocusCell(e,i,r){const{parentListEl:s}=this;r&&mW.set(s,null);const n=this.getGridCells();n.forEach(o=>{o.removeAttribute("tabindex"),o.removeAttribute(yxe)}),e&&(e===i?e.tabIndex=0:e.removeAttribute("tabindex"),e.setAttribute(yxe,""),r&&mW.set(s,n.indexOf(e)))}focusCell(e,i=!0){const r=QUe(e);this.setFocusCell(e,r,i),r==null||r.focus()}renderSelected(){const{selected:e,selectionMode:i,selectionAppearance:r}=this;return i==="none"||r==="border"?null:er("selection-container",ce`<div class=${ge({[hr.selectionContainer]:!0,[hr.selectionContainerSingle]:i==="single"||i==="single-persist"})} @click=${this.handleItemClick}><calcite-icon .icon=${e?i==="multiple"?Zg.selectedMultiple:Zg.selectedSingle:i==="multiple"?Zg.unselectedMultiple:Zg.unselectedSingle} .scale=${Ya(this.scale)}></calcite-icon></div>`)}renderDragHandle(){const{label:e,dragHandle:i,dragDisabled:r,setPosition:s,setSize:n,moveToItems:o}=this;return i?er("drag-handle-container",ce`<div .ariaLabel=${e} class=${ge({[hr.dragContainer]:!0,[hr.gridCell]:!0})} role=gridcell ${xr(this.handleGridEl)}><calcite-sort-handle .disabled=${r} .label=${e} .moveToItems=${o} @calciteSortHandleBeforeClose=${this.handleSortHandleBeforeClose} @calciteSortHandleBeforeOpen=${this.handleSortHandleBeforeOpen} @calciteSortHandleClose=${this.handleSortHandleClose} @calciteSortHandleOpen=${this.handleSortHandleOpen} overlay-positioning=fixed .scale=${this.scale} .setPosition=${s} .setSize=${n} ${xr(this.setSortHandleEl)}></calcite-sort-handle></div>`):null}renderExpanded(){const{el:e,expanded:i,expandable:r,messages:s,displayMode:n,scale:o}=this;if(n!=="nested")return null;const a=YL(e),l=r?i?Zg.open:a==="rtl"?Zg.collapsedRTL:Zg.collapsedLTR:Zg.blank,c=Ya(o),h=r?i?s.collapse:s.expand:void 0,d=r?this.handleToggleClick:void 0;return er("expanded-container",ce`<div class=${ge(hr.expandedContainer)} @click=${d} title=${h??Ke}>${er(l,ce`<calcite-icon .icon=${l} .scale=${c}></calcite-icon>`)}</div>`)}renderActionsStart(){const{label:e,hasActionsStart:i}=this;return er("actions-start-container",ce`<div .ariaLabel=${e} class=${ge({[hr.actionsStart]:!0,[hr.gridCell]:!0})} .hidden=${!i} role=gridcell ${xr(this.actionsStartEl)}><slot name=${OE.actionsStart} @slotchange=${this.handleActionsStartSlotChange}></slot></div>`)}renderActionsEnd(){const{label:e,hasActionsEnd:i,closable:r,messages:s}=this;return er("actions-end-container",ce`<div .ariaLabel=${e} class=${ge({[hr.actionsEnd]:!0,[hr.gridCell]:!0})} .hidden=${!(i||r)} role=gridcell ${xr(this.actionsEndEl)}><slot name=${OE.actionsEnd} @slotchange=${this.handleActionsEndSlotChange}></slot>${r?er("close-action",ce`<calcite-action appearance=transparent class=${ge(hr.close)} .icon=${Zg.close} .label=${s.close} @click=${this.handleCloseClick} .scale=${this.scale} .text=${s.close}></calcite-action>`):null}</div>`)}renderContentStart(){const{hasContentStart:e}=this;return ce`<div class=${ge(hr.contentStart)} .hidden=${!e}><slot name=${OE.contentStart} @slotchange=${this.handleContentStartSlotChange}></slot></div>`}renderCustomContent(){const{hasCustomContent:e}=this;return ce`<div class=${ge(hr.customContent)} .hidden=${!e}><slot name=${OE.content} @slotchange=${this.handleContentSlotChange}></slot></div>`}renderIconStart(){const{iconStart:e,iconFlipRtl:i,scale:r}=this;return e?er("icon-start",ce`<calcite-icon class=${ge(hr.icon)} .flipRtl=${i==="both"||i==="start"} .icon=${e} .scale=${Ya(r)}></calcite-icon>`):null}renderIconEnd(){const{iconEnd:e,iconFlipRtl:i,scale:r}=this;return e?er("icon-end",ce`<calcite-icon class=${ge(hr.icon)} .flipRtl=${i==="both"||i==="end"} .icon=${e} .scale=${Ya(r)}></calcite-icon>`):null}renderContentEnd(){const{hasContentEnd:e}=this;return ce`<div class=${ge(hr.contentEnd)} .hidden=${!e}><slot name=${OE.contentEnd} @slotchange=${this.handleContentEndSlotChange}></slot></div>`}renderContentBottom(){const{hasContentBottom:e}=this;return ce`<div class=${ge(hr.contentBottom)} .hidden=${!e}><slot name=${OE.contentBottom} @slotchange=${this.handleContentBottomSlotChange}></slot></div>`}renderDefaultContainer(){return ce`<div class=${ge({[hr.nestedContainer]:!0,[hr.nestedContainerExpanded]:this.expandable&&this.expanded})}><slot @slotchange=${this.handleDefaultSlotChange} ${xr(this.defaultSlotEl)}></slot></div>`}renderContentProperties(){const{label:e,description:i,hasCustomContent:r}=this;return!r&&(e||i)?er("content",ce`<div class=${ge(hr.content)}>${e?er("label",ce`<div class=${ge(hr.label)}>${e}</div>`):null}${i?er("description",ce`<div class=${ge(hr.description)}>${i}</div>`):null}</div>`):null}renderContentContainer(){const{description:e,label:i,selectionMode:r,hasCustomContent:s,unavailable:n}=this,o=s||!!i||!!e,a=[this.renderContentStart(),this.renderCustomContent(),this.renderIconStart(),this.renderContentProperties(),this.renderIconEnd(),this.renderContentEnd()];return er("content-container",ce`<div .ariaLabel=${i} class=${ge({[hr.gridCell]:!0,[hr.contentContainer]:!0,[hr.contentContainerUnavailable]:n,[hr.contentContainerSelectable]:r!=="none",[hr.contentContainerHasCenterContent]:o})} @click=${this.handleItemClick} role=gridcell ${xr(this.contentEl)}>${a}</div>`)}render(){const{expandable:e,expanded:i,level:r,active:s,label:n,selected:o,selectionAppearance:a,selectionMode:l,interactionMode:c,closed:h,filterHidden:d,bordered:f,disabled:m,hasContentBottom:g}=this,v=f&&g,_=f&&!g,b=l!=="none"&&a==="border",w=b&&o,x=b&&!o,S=c==="interactive"||c==="static"&&l!=="none"&&a==="border";return $g({disabled:m,children:ce`<div class=${ge({[hr.wrapper]:!0,[hr.wrapperBordered]:v})}><div .ariaExpanded=${e?i:null} .ariaLabel=${n} .ariaLevel=${r} .ariaSelected=${o} class=${ge({[hr.row]:!0,[hr.container]:!0,[hr.containerHover]:S,[hr.containerBorder]:b,[hr.containerBorderSelected]:w,[hr.containerBorderUnselected]:x})} .hidden=${h||d} @focus=${this.focusCellNull} @focusin=${this.emitInternalListItemActive} @keydown=${this.handleItemKeyDown} role=row .tabIndex=${s?0:-1} ${xr(this.containerEl)}>${this.renderDragHandle()}${this.renderSelected()}${this.renderExpanded()}<div class=${ge({[hr.contentContainerWrapper]:!0,[hr.contentContainerWrapperBordered]:_})}>${this.renderActionsStart()}${this.renderContentContainer()}${this.renderActionsEnd()}</div></div>${this.renderContentBottom()}</div>${this.renderDefaultContainer()}`})}};Sj.properties={hasActionsEnd:[16,{},{state:!0}],hasActionsStart:[16,{},{state:!0}],hasContentBottom:[16,{},{state:!0}],hasContentEnd:[16,{},{state:!0}],hasContentStart:[16,{},{state:!0}],hasCustomContent:[16,{},{state:!0}],level:[16,{},{state:!0}],expandable:[16,{},{state:!0}],parentListEl:[16,{},{state:!0}],active:[5,{},{type:Boolean}],bordered:[5,{},{type:Boolean}],closable:[7,{},{reflect:!0,type:Boolean}],closed:[7,{},{reflect:!0,type:Boolean}],description:1,disabled:[7,{},{reflect:!0,type:Boolean}],dragDisabled:[7,{},{reflect:!0,type:Boolean}],dragHandle:[7,{},{reflect:!0,type:Boolean}],expanded:[7,{},{reflect:!0,type:Boolean}],filterHidden:[7,{},{reflect:!0,type:Boolean}],interactionMode:1,label:1,messageOverrides:[0,{},{attribute:!1}],metadata:[0,{},{attribute:!1}],displayMode:[3,{},{reflect:!0}],moveToItems:[0,{},{attribute:!1}],open:[7,{},{reflect:!0,type:Boolean}],scale:[3,{},{reflect:!0}],selected:[7,{},{reflect:!0,type:Boolean}],selectionAppearance:[3,{},{reflect:!0}],selectionMode:[3,{},{reflect:!0}],setPosition:[9,{},{type:Number}],setSize:[9,{},{type:Number}],sortHandleOpen:[7,{},{reflect:!0,type:Boolean}],unavailable:[7,{},{reflect:!0,type:Boolean}],value:1,iconStart:[3,{},{reflect:!0}],iconEnd:[3,{},{reflect:!0}],iconFlipRtl:[3,{},{reflect:!0}]},Sj.styles=[qGt,HGt];let ij=Sj;Io("calcite-list-item",ij);const ugi=Object.freeze(Object.defineProperty({__proto__:null,ListItem:ij},Symbol.toStringTag,{value:"Module"}));/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const vxe={brand:"lightbulb",danger:"exclamationMarkTriangle",info:"information",success:"checkCircle",warning:"exclamationMarkTriangle"};/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const a4={title:"title",message:"message",link:"link",actionsEnd:"actions-end"},UO={actionsEnd:"actions-end",close:"notice-close",container:"container",content:"notice-content",icon:"notice-icon"},WGt=Ks`:host([scale=s]){--calcite-notice-spacing-token-small: .5rem;--calcite-notice-spacing-token-large: .75rem}:host([scale=s]) .container slot[name=title]::slotted(*),:host([scale=s]) .container *::slotted([slot=title]){margin-block:.125rem;font-size:var(--calcite-font-size--1);line-height:1.375}:host([scale=s]) .container slot[name=message]::slotted(*),:host([scale=s]) .container *::slotted([slot=message]){margin-block:.125rem;font-size:var(--calcite-font-size--2);line-height:1.375}:host([scale=s]) ::slotted(calcite-link){margin-block:.125rem;font-size:var(--calcite-font-size--2);line-height:1.375}:host([scale=s]) .notice-close{padding:.5rem}:host([scale=m]){--calcite-notice-spacing-token-small: .75rem;--calcite-notice-spacing-token-large: 1rem}:host([scale=m]) .container slot[name=title]::slotted(*),:host([scale=m]) .container *::slotted([slot=title]){margin-block:.125rem;font-size:var(--calcite-font-size-0);line-height:1.375}:host([scale=m]) .container slot[name=message]::slotted(*),:host([scale=m]) .container *::slotted([slot=message]){margin-block:.125rem;font-size:var(--calcite-font-size--1);line-height:1.375}:host([scale=m]) ::slotted(calcite-link){margin-block:.125rem;font-size:var(--calcite-font-size--1);line-height:1.375}:host([scale=l]){--calcite-notice-spacing-token-small: 1rem;--calcite-notice-spacing-token-large: 1.25rem}:host([scale=l]) .container slot[name=title]::slotted(*),:host([scale=l]) .container *::slotted([slot=title]){margin-block:.125rem;font-size:var(--calcite-font-size-1);line-height:1.375}:host([scale=l]) .container slot[name=message]::slotted(*),:host([scale=l]) .container *::slotted([slot=message]){margin-block:.125rem;font-size:var(--calcite-font-size-0);line-height:1.375}:host([scale=l]) ::slotted(calcite-link){margin-block:.125rem;font-size:var(--calcite-font-size-0);line-height:1.375}:host([width=auto]){--calcite-notice-width: auto}:host([width=half]){--calcite-notice-width: 50%}:host([width=full]){--calcite-notice-width: 100%}:host{margin-inline:auto;display:none;max-inline-size:100%;align-items:center;inline-size:var(--calcite-notice-width)}.container{pointer-events:none;margin-block:0px;box-sizing:border-box;display:flex;inline-size:100%;opacity:0;overflow:hidden;max-block-size:0;transition-property:opacity,max-block-size;transition-duration:var(--calcite-animation-timing);text-align:start;border-inline-start:var(--calcite-border-width-md) solid;box-shadow:0 0 0 0 transparent;background-color:var(--calcite-notice-background-color, var(--calcite-color-foreground-1))}.notice-close{outline-color:transparent}.notice-close:focus{outline:2px solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline-offset:calc(-2px*(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}:host{display:flex}:host([open]) .container{pointer-events:auto;max-block-size:100%;align-items:center;opacity:1;--tw-shadow: 0 4px 8px -1px rgba(0, 0, 0, .08), 0 2px 4px -1px rgba(0, 0, 0, .04);--tw-shadow-colored: 0 4px 8px -1px var(--tw-shadow-color), 0 2px 4px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow);overflow:visible}.container slot[name=title]::slotted(*),.container *::slotted([slot=title]){margin:0;font-weight:var(--calcite-font-weight-medium);color:var(--calcite-notice-title-text-color, var(--calcite-color-text-1))}.container slot[name=message]::slotted(*),.container *::slotted([slot=message]){margin:0;display:inline;font-weight:var(--calcite-font-weight-normal);margin-inline-end:var(--calcite-notice-spacing-token-small);color:var(--calcite-notice-content-text-color, var(--calcite-color-text-2))}.notice-content{box-sizing:border-box;transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out;padding-inline:var(--calcite-notice-spacing-token-large);flex:0 0 auto;display:flex;min-inline-size:0px;flex-direction:column;overflow-wrap:break-word;flex:1 1 0;padding-block:var(--calcite-notice-spacing-token-small);padding-inline:0 var(--calcite-notice-spacing-token-small)}.notice-content:first-of-type:not(:only-child){padding-inline-start:var(--calcite-notice-spacing-token-large)}.notice-content:only-of-type{padding-block:var(--calcite-notice-spacing-token-small);padding-inline:var(--calcite-notice-spacing-token-large)}.notice-icon{display:flex;align-items:center;box-sizing:border-box;transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out;padding-block:var(--calcite-notice-spacing-token-small);padding-inline:var(--calcite-notice-spacing-token-large);flex:0 0 auto}.notice-close{display:flex;cursor:pointer;align-items:center;align-self:stretch;border-style:none;background-color:transparent;outline:2px solid transparent;outline-offset:2px;box-sizing:border-box;transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out;padding-block:var(--calcite-notice-spacing-token-small);padding-inline:var(--calcite-notice-spacing-token-large);flex:0 0 auto;-webkit-appearance:none;color:var(--calcite-notice-close-icon-color, var(--calcite-color-text-3))}.notice-close:hover,.notice-close:focus{background-color:var(--calcite-notice-close-background-color-focus, var(--calcite-color-foreground-2));color:var(--calcite-notice-close-icon-color-hover, var(--calcite-color-text-1))}.notice-close:active{background-color:var(--calcite-notice-close-background-color-press, var(--calcite-color-foreground-3))}.actions-end{display:flex;align-self:stretch}:host([kind=brand]) .container{border-color:var(--calcite-color-brand)}:host([kind=brand]) .container .notice-icon{color:var(--calcite-color-brand)}:host([kind=info]) .container{border-color:var(--calcite-color-status-info)}:host([kind=info]) .container .notice-icon{color:var(--calcite-color-status-info)}:host([kind=danger]) .container{border-color:var(--calcite-color-status-danger)}:host([kind=danger]) .container .notice-icon{color:var(--calcite-color-status-danger)}:host([kind=success]) .container{border-color:var(--calcite-color-status-success)}:host([kind=success]) .container .notice-icon{color:var(--calcite-color-status-success)}:host([kind=warning]) .container{border-color:var(--calcite-color-status-warning)}:host([kind=warning]) .container .notice-icon{color:var(--calcite-color-status-warning)}:host([hidden]){display:none}[hidden]{display:none}`,Tj=class Tj extends Hn{constructor(){super(...arguments),this.closeButton=Yc(),this.transitionProp="opacity",this.messages=Vd(),this.hasActionEnd=!1,this.closable=!1,this.iconFlipRtl=!1,this.kind="brand",this.open=!1,this.scale="m",this.width="auto",this.calciteNoticeBeforeClose=Gt({cancelable:!1}),this.calciteNoticeBeforeOpen=Gt({cancelable:!1}),this.calciteNoticeClose=Gt({cancelable:!1}),this.calciteNoticeOpen=Gt({cancelable:!1})}async setFocus(){await yh(this);const e=this.el.querySelector("calcite-link");if(!(!this.closeButton.value&&!e)){if(e)return e.setFocus();this.closeButton.value&&this.closeButton.value.focus()}}async load(){this.requestedIcon=LA(vxe,this.icon,this.kind)}willUpdate(e){e.has("open")&&(this.hasUpdated||this.open!==!1)&&Xle(this),(e.has("icon")||e.has("kind")&&(this.hasUpdated||this.kind!=="brand"))&&(this.requestedIcon=LA(vxe,this.icon,this.kind))}onBeforeClose(){this.calciteNoticeBeforeClose.emit()}onBeforeOpen(){this.calciteNoticeBeforeOpen.emit()}onClose(){this.calciteNoticeClose.emit()}onOpen(){this.calciteNoticeOpen.emit()}setTransitionEl(e){e&&(this.transitionEl=e)}close(){this.open=!1}handleActionsEndSlotChange(e){this.hasActionEnd=Os(e)}render(){const e=ce`<button .ariaLabel=${this.messages.close} class=${ge(UO.close)} @click=${this.close} ${xr(this.closeButton)}><calcite-icon icon=x .scale=${Ya(this.scale)}></calcite-icon></button>`;return ce`<div class=${ge(UO.container)} ${xr(this.setTransitionEl)}>${this.requestedIcon?ce`<div class=${ge(UO.icon)}><calcite-icon .flipRtl=${this.iconFlipRtl} .icon=${this.requestedIcon} .scale=${Ya(this.scale)}></calcite-icon></div>`:null}<div class=${ge(UO.content)}><slot name=${a4.title}></slot><slot name=${a4.message}></slot><slot name=${a4.link}></slot></div><div class=${ge(UO.actionsEnd)} .hidden=${!this.hasActionEnd}><slot name=${a4.actionsEnd} @slotchange=${this.handleActionsEndSlotChange}></slot></div>${this.closable?e:null}</div>`}};Tj.properties={hasActionEnd:[16,{},{state:!0}],closable:[7,{},{reflect:!0,type:Boolean}],icon:[3,{converter:P3},{reflect:!0}],iconFlipRtl:[7,{},{reflect:!0,type:Boolean}],kind:[3,{},{reflect:!0}],messageOverrides:[0,{},{attribute:!1}],open:[7,{},{reflect:!0,type:Boolean}],scale:[3,{},{reflect:!0}],width:[3,{},{reflect:!0}]},Tj.styles=WGt;let rj=Tj;Io("calcite-notice",rj);const hgi=Object.freeze(Object.defineProperty({__proto__:null,Notice:rj},Symbol.toStringTag,{value:"Module"}));var ZGt=Object.defineProperty,YGt=Object.getOwnPropertyDescriptor,$M=(t,e,i,r)=>{for(var s=r>1?void 0:r?YGt(e,i):e,n=t.length-1,o;n>=0;n--)(o=t[n])&&(s=(r?o(e,i,s):o(s))||s);return r&&s&&ZGt(e,i,s),s};let ew=class extends sf{constructor(){super(...arguments),this.view=null,this.otherView=null,this.layers=[],this.inputUrl="",this.error="",this._layersWatcher=null,this._otherLayersWatcher=null}updated(t){if(t.has("view")&&this.view){if(!this.otherView){const e=window.appViews;e&&(e.mapView===this.view||e.sceneView===this.view)&&(this.otherView=e.mapView===this.view?e.sceneView:e.mapView)}this.refreshLayers(),this.view.ui.find(e=>e===this)||(this.view.ui.add(this,"manual"),this.style.position="absolute",this.style.left="50%",this.style.bottom="30px",this.style.transform="translateX(-50%)"),this.view.when&&this.view.when(()=>{this.refreshLayers()}),this.view.map&&this.view.map.layers&&!this._layersWatcher&&(this._layersWatcher=this.view.map.layers.on("change",()=>this.refreshLayers())),setTimeout(()=>this.refreshLayers(),0)}}disconnectedCallback(){var t,e,i,r;super.disconnectedCallback(),(e=(t=this._layersWatcher)==null?void 0:t.remove)==null||e.call(t),(r=(i=this._otherLayersWatcher)==null?void 0:i.remove)==null||r.call(i)}refreshLayers(){if(!this.view||!this.view.map){this.layers=[];return}this.layers=this.view.map.layers.toArray()}async handleAddLayer(){this.error="";const t=this.inputUrl.trim();if(!t)return;let e=null;try{const r=await fetch(t+(t.includes("?")?"&":"?")+"f=json");if(!r.ok)throw new Error("Service not found");if(e=await r.json(),e.error)throw new Error(e.error.message||"Service error")}catch(r){this.error="Could not load service: "+((r==null?void 0:r.message)||r);return}let i;try{e.type==="Feature Layer"||/FeatureServer/i.test(t)?i=(await G(async()=>{const{default:r}=await Promise.resolve().then(()=>Yk);return{default:r}},void 0)).default:e.type==="Map Service"||/MapServer/i.test(t)?i=(await G(async()=>{const{default:r}=await import("./MapImageLayer-HAWhrLnx.js");return{default:r}},__vite__mapDeps([388,389,375,376,41,39,40,109,169,205,167,390]))).default:e.type==="Image Service"||/ImageServer/i.test(t)?i=(await G(async()=>{const{default:r}=await import("./ImageryLayer-CY0MZByG.js");return{default:r}},__vite__mapDeps([391,195,392,79,80,81,3,8,104,105,390,199,393,376,41,39,40,109]))).default:e.type==="Scene Service"||/SceneServer/i.test(t)?i=(await G(async()=>{const{default:r}=await import("./SceneLayer-D-fzgAEL.js");return{default:r}},__vite__mapDeps([394,395,373,396,247,121,246,248,122,255,256,88,77,170]))).default:/VectorTileServer/i.test(t)?i=(await G(async()=>{const{default:r}=await import("./VectorTileLayer-B-ju8PYR.js");return{default:r}},__vite__mapDeps([397,114,115,116,94]))).default:/TileServer/i.test(t)||/\/tiles\//i.test(t)?i=(await G(async()=>{const{default:r}=await import("./TileLayer-DWDoyRiG.js");return{default:r}},__vite__mapDeps([398,114,115,116,389,375,376,41,39,40,109,169,390]))).default:i=(await G(async()=>{const{default:r}=await Promise.resolve().then(()=>Yk);return{default:r}},void 0)).default}catch(r){this.error="Could not load layer type: "+((r==null?void 0:r.message)||r);return}try{const r=new i({url:t});if(this.view.map.add(r),this.otherView&&this.otherView.map&&!this.otherView.map.layers.find(s=>s.url===t)){const s=new i({url:t});this.otherView.map.add(s)}r.when(()=>this.refreshLayers()),this.inputUrl=""}catch(r){this.error="Could not add layer: "+((r==null?void 0:r.message)||r)}}handleInput(t){this.inputUrl=t.target.value}handleRemoveLayer(t){try{const e=t.url;if(this.view&&this.view.map&&e){const i=this.view.map.layers.find(r=>r.url===e);i&&this.view.map.layers.remove(i)}if(this.otherView&&this.otherView.map&&e){const i=this.otherView.map.layers.find(r=>r.url===e);i&&this.otherView.map.layers.remove(i)}this.refreshLayers()}catch(e){this.error="Could not remove layer: "+((e==null?void 0:e.message)||e)}}async handleLayerChange(t,e){if(!(!e||!e.map)){if(t.added&&t.added.length){for(const i of t.added)if(i.url&&!e.map.layers.find(r=>r.url===i.url)){let r;try{r=i.declaredClass?(await G(()=>import(`@arcgis/core/layers/${i.declaredClass.split(".").pop()}`),[])).default:(await G(async()=>{const{default:s}=await Promise.resolve().then(()=>Yk);return{default:s}},void 0)).default}catch{r=(await G(async()=>{const{default:s}=await Promise.resolve().then(()=>Yk);return{default:s}},void 0)).default}try{const s=new r({url:i.url});e.map.layers.add(s)}catch(s){this.error="Could not sync added layer: "+((s==null?void 0:s.message)||s)}}}if(t.removed&&t.removed.length){for(const i of t.removed)if(i.url){const r=e.map.layers.find(s=>s.url===i.url);r&&e.map.layers.remove(r)}}this.refreshLayers()}}async showFeatureLayerExtent(t){if(!(!t||!t.queryExtent))try{const e=await t.queryExtent();if(e&&e.extent){const i=new Pl({geometry:_i.fromJSON(e.extent.toJSON()),symbol:{type:"simple-fill",color:[0,0,255,.08],outline:{color:[0,0,255,1],width:2}},popupTemplate:{title:"FeatureLayer Query Extent",content:`<pre>${JSON.stringify(e.extent.toJSON(),null,2)}</pre>`}});let r=this.view.map.findLayerById("feature-query-extent-layer");if(!r){const[s]=await Promise.all([G(()=>import("./GraphicsLayer-C8-bjLvb.js"),[])]);r=new s.default({id:"feature-query-extent-layer"}),this.view.map.add(r)}r.removeAll(),r.add(i),await this.view.goTo(e.extent),this.view.popup&&typeof this.view.popup.open=="function"&&this.view.popup.open({features:[i],location:e.extent.center})}}catch(e){this.error="Could not show query extent: "+((e==null?void 0:e.message)||e)}}render(){return ce`
      <div class="layer-list">
        <calcite-list>
          ${this.layers.length===0?ce`<calcite-list-item disabled><span slot="content"><div class="empty">No operational layers</div></span></calcite-list-item>`:this.layers.map(t=>ce`
                  <calcite-list-item
                    label=${t.title||t.id||t.url||"Layer"}
                    description=${t.url||""}
                    value=${t.id||t.url||""}
                  >
                    ${t.type==="feature"&&t.queryExtent?ce`<calcite-button
                          slot="actions-end"
                          appearance="outline"
                          color="yellow"
                          scale="s"
                          icon-start="bounding-rectangle"
                          aria-label="Show Query Extent"
                          @click=${()=>this.showFeatureLayerExtent(t)}
                        >Extent</calcite-button>`:""}
                    <calcite-button
                      slot="actions-end"
                      appearance="outline"
                      color="blue"
                      scale="s"
                      icon-start="launch"
                      aria-label="Open REST URL"
                      @click=${()=>window.open(t.url,"_blank","noopener")}
                    >Open</calcite-button>
                    <calcite-button
                      slot="actions-end"
                      appearance="outline"
                      color="red"
                      scale="s"
                      icon-start="trash"
                      aria-label="Remove layer"
                      @click=${()=>this.handleRemoveLayer(t)}
                    >Remove</calcite-button>
                  </calcite-list-item>
                `)}
        </calcite-list>
      </div>
      <div class="add-row">
        <calcite-input
          type="text"
          placeholder="Add layer by REST URL"
          .value=${this.inputUrl}
          @input=${this.handleInput}
          @keydown=${t=>{t.key==="Enter"&&this.handleAddLayer()}}
          aria-label="Layer URL"
          scale="m"
        ></calcite-input>
        <calcite-button
          appearance="solid"
          color="blue"
          scale="m"
          icon-start="plus"
          @click=${this.handleAddLayer}
          >Add</calcite-button>
      </div>
      ${this.error?ce`<calcite-notice open color="red" icon="exclamation-mark-triangle-f" scale="s">
            <div slot="message">${this.error}</div>
          </calcite-notice>`:""}
    `}};ew.styles=Ks`
    :host {
      display: block;
      position: absolute;
      left: 50%;
      bottom: 30px;
      transform: translateX(-50%);
      z-index: 40;
      min-width: 350px;
      max-width: 600px;
      background: white;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      padding: 12px 18px 16px 18px;
      font-size: 14px;
      user-select: text;
    }
    .layer-list {
      max-height: 220px;
      overflow-y: auto;
      margin-bottom: 10px;
    }
    .layer-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
      border-bottom: 1px solid #eee;
      padding-bottom: 3px;
    }
    .layer-title {
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      margin-right: 10px;
    }
    .remove-btn {
      background: #e74c3c;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 2px 10px;
      cursor: pointer;
      font-size: 12px;
    }
    .add-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 10px;
    }
    input[type="text"] {
      flex: 1;
      padding: 5px 8px;
      font-size: 13px;
      border-radius: 4px;
      border: 1px solid #aaa;
    }
    .add-btn {
      background: #3498db;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 5px 14px;
      cursor: pointer;
      font-size: 13px;
    }
    .error {
      color: #b00;
      font-size: 12px;
      margin-top: 4px;
    }
    .empty {
      color: #888;
      font-size: 13px;
      text-align: center;
      margin: 12px 0;
    }
  `;$M([jA({attribute:!1})],ew.prototype,"view",2);$M([jA({attribute:!1})],ew.prototype,"otherView",2);$M([zv()],ew.prototype,"layers",2);$M([zv()],ew.prototype,"inputUrl",2);$M([zv()],ew.prototype,"error",2);ew=$M([Ij("layer-manager")],ew);/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const uVe=({children:t,...e})=>{const i=e.level?MUt(`h${e.level}`):_D`div`;return er(e.key,Rle`<${i} class=${ge(e.class)}>${t}</${i}>`)};/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const _xe={arrow:"calcite-floating-ui-arrow",arrowStroke:"calcite-floating-ui-arrow__stroke"},JGt={width:12,height:6,strokeWidth:1},XGt=({floatingLayout:t,key:e,ref:i})=>{const{width:r,height:s,strokeWidth:n}=JGt,o=r/2,a=t==="vertical",l=`M0,0 H${r} L${r-o},${s} Q${o},${s} ${o},${s} Z`;return er(e,ce`<svg aria-hidden=true class=${ge(_xe.arrow)} height=${r} viewBox=${`0 0 ${r} ${r+(a?0:n)}`} width=${r+(a?n:0)} ${xr(i)}>${t3`${t3`<path class=${ge(_xe.arrowStroke)} d=${l??Ke} fill=none stroke-width=${n+1} />`||""}<path d=${l??Ke} stroke=none />`}</svg>`)};/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var hVe=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],sj=hVe.join(","),dVe=typeof Element>"u",jS=dVe?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,nj=!dVe&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t==null?void 0:t.ownerDocument},oj=function t(e,i){var r;i===void 0&&(i=!0);var s=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"inert"),n=s===""||s==="true",o=n||i&&e&&t(e.parentNode);return o},KGt=function(e){var i,r=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"contenteditable");return r===""||r==="true"},pVe=function(e,i,r){if(oj(e))return[];var s=Array.prototype.slice.apply(e.querySelectorAll(sj));return i&&jS.call(e,sj)&&s.unshift(e),s=s.filter(r),s},fVe=function t(e,i,r){for(var s=[],n=Array.from(e);n.length;){var o=n.shift();if(!oj(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=t(l,!0,r);r.flatten?s.push.apply(s,c):s.push({scopeParent:o,candidates:c})}else{var h=jS.call(o,sj);h&&r.filter(o)&&(i||!e.includes(o))&&s.push(o);var d=o.shadowRoot||typeof r.getShadowRoot=="function"&&r.getShadowRoot(o),f=!oj(d,!1)&&(!r.shadowRootFilter||r.shadowRootFilter(o));if(d&&f){var m=t(d===!0?o.children:d.children,!0,r);r.flatten?s.push.apply(s,m):s.push({scopeParent:o,candidates:m})}else n.unshift.apply(n,o.children)}}return s},mVe=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},Tx=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||KGt(e))&&!mVe(e)?0:e.tabIndex},QGt=function(e,i){var r=Tx(e);return r<0&&i&&!mVe(e)?0:r},e6t=function(e,i){return e.tabIndex===i.tabIndex?e.documentOrder-i.documentOrder:e.tabIndex-i.tabIndex},gVe=function(e){return e.tagName==="INPUT"},t6t=function(e){return gVe(e)&&e.type==="hidden"},i6t=function(e){var i=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(r){return r.tagName==="SUMMARY"});return i},r6t=function(e,i){for(var r=0;r<e.length;r++)if(e[r].checked&&e[r].form===i)return e[r]},s6t=function(e){if(!e.name)return!0;var i=e.form||nj(e),r=function(a){return i.querySelectorAll('input[type="radio"][name="'+a+'"]')},s;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")s=r(window.CSS.escape(e.name));else try{s=r(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var n=r6t(s,e.form);return!n||n===e},n6t=function(e){return gVe(e)&&e.type==="radio"},o6t=function(e){return n6t(e)&&!s6t(e)},a6t=function(e){var i,r=e&&nj(e),s=(i=r)===null||i===void 0?void 0:i.host,n=!1;if(r&&r!==e){var o,a,l;for(n=!!((o=s)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(s)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!n&&s;){var c,h,d;r=nj(s),s=(c=r)===null||c===void 0?void 0:c.host,n=!!((h=s)!==null&&h!==void 0&&(d=h.ownerDocument)!==null&&d!==void 0&&d.contains(s))}}return n},bxe=function(e){var i=e.getBoundingClientRect(),r=i.width,s=i.height;return r===0&&s===0},l6t=function(e,i){var r=i.displayCheck,s=i.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var n=jS.call(e,"details>summary:first-of-type"),o=n?e.parentElement:e;if(jS.call(o,"details:not([open]) *"))return!0;if(!r||r==="full"||r==="legacy-full"){if(typeof s=="function"){for(var a=e;e;){var l=e.parentElement,c=nj(e);if(l&&!l.shadowRoot&&s(l)===!0)return bxe(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=a}if(a6t(e))return!e.getClientRects().length;if(r!=="legacy-full")return!0}else if(r==="non-zero-area")return bxe(e);return!1},c6t=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var i=e.parentElement;i;){if(i.tagName==="FIELDSET"&&i.disabled){for(var r=0;r<i.children.length;r++){var s=i.children.item(r);if(s.tagName==="LEGEND")return jS.call(i,"fieldset[disabled] *")?!0:!s.contains(e)}return!0}i=i.parentElement}return!1},aj=function(e,i){return!(i.disabled||oj(i)||t6t(i)||l6t(i,e)||i6t(i)||c6t(i))},Ute=function(e,i){return!(o6t(i)||Tx(i)<0||!aj(e,i))},u6t=function(e){var i=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(i)||i>=0)},h6t=function t(e){var i=[],r=[];return e.forEach(function(s,n){var o=!!s.scopeParent,a=o?s.scopeParent:s,l=QGt(a,o),c=o?t(s.candidates):a;l===0?o?i.push.apply(i,c):i.push(a):r.push({documentOrder:n,tabIndex:l,item:s,isScope:o,content:c})}),r.sort(e6t).reduce(function(s,n){return n.isScope?s.push.apply(s,n.content):s.push(n.content),s},[]).concat(i)},d6t=function(e,i){i=i||{};var r;return i.getShadowRoot?r=fVe([e],i.includeContainer,{filter:Ute.bind(null,i),flatten:!1,getShadowRoot:i.getShadowRoot,shadowRootFilter:u6t}):r=pVe(e,i.includeContainer,Ute.bind(null,i)),h6t(r)},p6t=function(e,i){i=i||{};var r;return i.getShadowRoot?r=fVe([e],i.includeContainer,{filter:aj.bind(null,i),flatten:!0,getShadowRoot:i.getShadowRoot}):r=pVe(e,i.includeContainer,aj.bind(null,i)),r},IE=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return jS.call(e,sj)===!1?!1:Ute(i,e)},f6t=hVe.concat("iframe").join(","),gW=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return jS.call(e,f6t)===!1?!1:aj(i,e)};/*!
* focus-trap 7.6.5
* @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
*/function Bte(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,r=Array(e);i<e;i++)r[i]=t[i];return r}function m6t(t){if(Array.isArray(t))return Bte(t)}function g6t(t,e,i){return(e=w6t(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function y6t(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function v6t(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function wxe(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),i.push.apply(i,r)}return i}function xxe(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?wxe(Object(i),!0).forEach(function(r){g6t(t,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):wxe(Object(i)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))})}return t}function _6t(t){return m6t(t)||y6t(t)||x6t(t)||v6t()}function b6t(t,e){if(typeof t!="object"||!t)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var r=i.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function w6t(t){var e=b6t(t,"string");return typeof e=="symbol"?e:e+""}function x6t(t,e){if(t){if(typeof t=="string")return Bte(t,e);var i={}.toString.call(t).slice(8,-1);return i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set"?Array.from(t):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Bte(t,e):void 0}}var Sxe={activateTrap:function(e,i){if(e.length>0){var r=e[e.length-1];r!==i&&r._setPausedState(!0)}var s=e.indexOf(i);s===-1||e.splice(s,1),e.push(i)},deactivateTrap:function(e,i){var r=e.indexOf(i);r!==-1&&e.splice(r,1),e.length>0&&!e[e.length-1]._isManuallyPaused()&&e[e.length-1]._setPausedState(!1)}},S6t=function(e){return e.tagName&&e.tagName.toLowerCase()==="input"&&typeof e.select=="function"},T6t=function(e){return(e==null?void 0:e.key)==="Escape"||(e==null?void 0:e.key)==="Esc"||(e==null?void 0:e.keyCode)===27},ZP=function(e){return(e==null?void 0:e.key)==="Tab"||(e==null?void 0:e.keyCode)===9},E6t=function(e){return ZP(e)&&!e.shiftKey},C6t=function(e){return ZP(e)&&e.shiftKey},Txe=function(e){return setTimeout(e,0)},BO=function(e){for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];return typeof e=="function"?e.apply(void 0,r):e},l4=function(e){return e.target.shadowRoot&&typeof e.composedPath=="function"?e.composedPath()[0]:e.target},$6t=[],A6t=function(e,i){var r=(i==null?void 0:i.document)||document,s=(i==null?void 0:i.trapStack)||$6t,n=xxe({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0,isKeyForward:E6t,isKeyBackward:C6t},i),o={containers:[],containerGroups:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,manuallyPaused:!1,delayInitialFocusTimer:void 0,recentNavEvent:void 0},a,l=function(N,R,k){return N&&N[R]!==void 0?N[R]:n[k||R]},c=function(N,R){var k=typeof(R==null?void 0:R.composedPath)=="function"?R.composedPath():void 0;return o.containerGroups.findIndex(function(W){var j=W.container,B=W.tabbableNodes;return j.contains(N)||(k==null?void 0:k.includes(j))||B.find(function(te){return te===N})})},h=function(N){var R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},k=R.hasFallback,W=k===void 0?!1:k,j=R.params,B=j===void 0?[]:j,te=n[N];if(typeof te=="function"&&(te=te.apply(void 0,_6t(B))),te===!0&&(te=void 0),!te){if(te===void 0||te===!1)return te;throw new Error("`".concat(N,"` was specified but was not a node, or did not return a node"))}var le=te;if(typeof te=="string"){try{le=r.querySelector(te)}catch(de){throw new Error("`".concat(N,'` appears to be an invalid selector; error="').concat(de.message,'"'))}if(!le&&!W)throw new Error("`".concat(N,"` as selector refers to no known node"))}return le},d=function(){var N=h("initialFocus",{hasFallback:!0});if(N===!1)return!1;if(N===void 0||N&&!gW(N,n.tabbableOptions))if(c(r.activeElement)>=0)N=r.activeElement;else{var R=o.tabbableGroups[0],k=R&&R.firstTabbableNode;N=k||h("fallbackFocus")}else N===null&&(N=h("fallbackFocus"));if(!N)throw new Error("Your focus-trap needs to have at least one focusable element");return N},f=function(){if(o.containerGroups=o.containers.map(function(N){var R=d6t(N,n.tabbableOptions),k=p6t(N,n.tabbableOptions),W=R.length>0?R[0]:void 0,j=R.length>0?R[R.length-1]:void 0,B=k.find(function(de){return IE(de)}),te=k.slice().reverse().find(function(de){return IE(de)}),le=!!R.find(function(de){return Tx(de)>0});return{container:N,tabbableNodes:R,focusableNodes:k,posTabIndexesFound:le,firstTabbableNode:W,lastTabbableNode:j,firstDomTabbableNode:B,lastDomTabbableNode:te,nextTabbableNode:function(Ae){var We=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,Ue=R.indexOf(Ae);return Ue<0?We?k.slice(k.indexOf(Ae)+1).find(function(it){return IE(it)}):k.slice(0,k.indexOf(Ae)).reverse().find(function(it){return IE(it)}):R[Ue+(We?1:-1)]}}}),o.tabbableGroups=o.containerGroups.filter(function(N){return N.tabbableNodes.length>0}),o.tabbableGroups.length<=0&&!h("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times");if(o.containerGroups.find(function(N){return N.posTabIndexesFound})&&o.containerGroups.length>1)throw new Error("At least one node with a positive tabindex was found in one of your focus-trap's multiple containers. Positive tabindexes are only supported in single-container focus-traps.")},m=function(N){var R=N.activeElement;if(R)return R.shadowRoot&&R.shadowRoot.activeElement!==null?m(R.shadowRoot):R},g=function(N){if(N!==!1&&N!==m(document)){if(!N||!N.focus){g(d());return}N.focus({preventScroll:!!n.preventScroll}),o.mostRecentlyFocusedNode=N,S6t(N)&&N.select()}},v=function(N){var R=h("setReturnFocus",{params:[N]});return R||(R===!1?!1:N)},_=function(N){var R=N.target,k=N.event,W=N.isBackward,j=W===void 0?!1:W;R=R||l4(k),f();var B=null;if(o.tabbableGroups.length>0){var te=c(R,k),le=te>=0?o.containerGroups[te]:void 0;if(te<0)j?B=o.tabbableGroups[o.tabbableGroups.length-1].lastTabbableNode:B=o.tabbableGroups[0].firstTabbableNode;else if(j){var de=o.tabbableGroups.findIndex(function(Jt){var wt=Jt.firstTabbableNode;return R===wt});if(de<0&&(le.container===R||gW(R,n.tabbableOptions)&&!IE(R,n.tabbableOptions)&&!le.nextTabbableNode(R,!1))&&(de=te),de>=0){var Ae=de===0?o.tabbableGroups.length-1:de-1,We=o.tabbableGroups[Ae];B=Tx(R)>=0?We.lastTabbableNode:We.lastDomTabbableNode}else ZP(k)||(B=le.nextTabbableNode(R,!1))}else{var Ue=o.tabbableGroups.findIndex(function(Jt){var wt=Jt.lastTabbableNode;return R===wt});if(Ue<0&&(le.container===R||gW(R,n.tabbableOptions)&&!IE(R,n.tabbableOptions)&&!le.nextTabbableNode(R))&&(Ue=te),Ue>=0){var it=Ue===o.tabbableGroups.length-1?0:Ue+1,Et=o.tabbableGroups[it];B=Tx(R)>=0?Et.firstTabbableNode:Et.firstDomTabbableNode}else ZP(k)||(B=le.nextTabbableNode(R))}}else B=h("fallbackFocus");return B},b=function(N){var R=l4(N);if(!(c(R,N)>=0)){if(BO(n.clickOutsideDeactivates,N)){a.deactivate({returnFocus:n.returnFocusOnDeactivate});return}BO(n.allowOutsideClick,N)||N.preventDefault()}},w=function(N){var R=l4(N),k=c(R,N)>=0;if(k||R instanceof Document)k&&(o.mostRecentlyFocusedNode=R);else{N.stopImmediatePropagation();var W,j=!0;if(o.mostRecentlyFocusedNode)if(Tx(o.mostRecentlyFocusedNode)>0){var B=c(o.mostRecentlyFocusedNode),te=o.containerGroups[B].tabbableNodes;if(te.length>0){var le=te.findIndex(function(de){return de===o.mostRecentlyFocusedNode});le>=0&&(n.isKeyForward(o.recentNavEvent)?le+1<te.length&&(W=te[le+1],j=!1):le-1>=0&&(W=te[le-1],j=!1))}}else o.containerGroups.some(function(de){return de.tabbableNodes.some(function(Ae){return Tx(Ae)>0})})||(j=!1);else j=!1;j&&(W=_({target:o.mostRecentlyFocusedNode,isBackward:n.isKeyBackward(o.recentNavEvent)})),g(W||o.mostRecentlyFocusedNode||d())}o.recentNavEvent=void 0},x=function(N){var R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;o.recentNavEvent=N;var k=_({event:N,isBackward:R});k&&(ZP(N)&&N.preventDefault(),g(k))},S=function(N){(n.isKeyForward(N)||n.isKeyBackward(N))&&x(N,n.isKeyBackward(N))},C=function(N){T6t(N)&&BO(n.escapeDeactivates,N)!==!1&&(N.preventDefault(),a.deactivate())},T=function(N){var R=l4(N);c(R,N)>=0||BO(n.clickOutsideDeactivates,N)||BO(n.allowOutsideClick,N)||(N.preventDefault(),N.stopImmediatePropagation())},M=function(){if(o.active)return Sxe.activateTrap(s,a),o.delayInitialFocusTimer=n.delayInitialFocus?Txe(function(){g(d())}):g(d()),r.addEventListener("focusin",w,!0),r.addEventListener("mousedown",b,{capture:!0,passive:!1}),r.addEventListener("touchstart",b,{capture:!0,passive:!1}),r.addEventListener("click",T,{capture:!0,passive:!1}),r.addEventListener("keydown",S,{capture:!0,passive:!1}),r.addEventListener("keydown",C),a},I=function(){if(o.active)return r.removeEventListener("focusin",w,!0),r.removeEventListener("mousedown",b,!0),r.removeEventListener("touchstart",b,!0),r.removeEventListener("click",T,!0),r.removeEventListener("keydown",S,!0),r.removeEventListener("keydown",C),a},D=function(N){var R=N.some(function(k){var W=Array.from(k.removedNodes);return W.some(function(j){return j===o.mostRecentlyFocusedNode})});R&&g(d())},P=typeof window<"u"&&"MutationObserver"in window?new MutationObserver(D):void 0,F=function(){P&&(P.disconnect(),o.active&&!o.paused&&o.containers.map(function(N){P.observe(N,{subtree:!0,childList:!0})}))};return a={get active(){return o.active},get paused(){return o.paused},activate:function(N){if(o.active)return this;var R=l(N,"onActivate"),k=l(N,"onPostActivate"),W=l(N,"checkCanFocusTrap");W||f(),o.active=!0,o.paused=!1,o.nodeFocusedBeforeActivation=m(r),R==null||R();var j=function(){W&&f(),M(),F(),k==null||k()};return W?(W(o.containers.concat()).then(j,j),this):(j(),this)},deactivate:function(N){if(!o.active)return this;var R=xxe({onDeactivate:n.onDeactivate,onPostDeactivate:n.onPostDeactivate,checkCanReturnFocus:n.checkCanReturnFocus},N);clearTimeout(o.delayInitialFocusTimer),o.delayInitialFocusTimer=void 0,I(),o.active=!1,o.paused=!1,F(),Sxe.deactivateTrap(s,a);var k=l(R,"onDeactivate"),W=l(R,"onPostDeactivate"),j=l(R,"checkCanReturnFocus"),B=l(R,"returnFocus","returnFocusOnDeactivate");k==null||k();var te=function(){Txe(function(){B&&g(v(o.nodeFocusedBeforeActivation)),W==null||W()})};return B&&j?(j(v(o.nodeFocusedBeforeActivation)).then(te,te),this):(te(),this)},pause:function(N){return o.active?(o.manuallyPaused=!0,this._setPausedState(!0,N)):this},unpause:function(N){return o.active?(o.manuallyPaused=!1,s[s.length-1]!==this?this:this._setPausedState(!1,N)):this},updateContainerElements:function(N){var R=[].concat(N).filter(Boolean);return o.containers=R.map(function(k){return typeof k=="string"?r.querySelector(k):k}),o.active&&f(),F(),this}},Object.defineProperties(a,{_isManuallyPaused:{value:function(){return o.manuallyPaused}},_setPausedState:{value:function(N,R){if(o.paused===N)return this;if(o.paused=N,N){var k=l(R,"onPause"),W=l(R,"onPostPause");k==null||k(),I(),F(),W==null||W()}else{var j=l(R,"onUnpause"),B=l(R,"onPostUnpause");j==null||j(),f(),M(),F(),B==null||B()}return this}}}),a.updateContainerElements(e),a};/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const c4=new WeakSet;function M6t(t,e){const i=(e==null?void 0:e.fallbackFocus)||t,r=(e==null?void 0:e.clickOutsideDeactivates)??!0;return{fallbackFocus:i,setReturnFocus:s=>(c4.has(t)||vD(s),!1),...e,document:t.ownerDocument,tabbableOptions:XUe,trapStack:Zot,clickOutsideDeactivates:s=>(c4.has(t)||c4.add(t),typeof r=="function"?r(s):r),onPostDeactivate:()=>{c4.delete(t)}}}function Exe(t,{focusTrapOptions:e},i){return!(e!=null&&e.extraContainers)&&!i?t:[t,...Cxe(e==null?void 0:e.extraContainers),...Cxe(i)]}function Cxe(t=[]){return Array.isArray(t)?t:[t]}const O6t=t=>Rzt((e,i)=>{let r,s,n;const o=t.focusTrapOptions;i.onConnected(()=>{e[t.triggerProp]&&r&&a.activate()}),i.onUpdate(l=>{e.hasUpdated&&l.has("focusTrapDisabled")&&(e.focusTrapDisabled?a.deactivate():a.activate())}),i.onDisconnected(()=>a.deactivate());const a={activate:()=>{const l=s||e.el;if(l.isConnected){if(!r){const c={...o,...e.focusTrapOptions};n||(n=Exe(l,e)),r=A6t(n,M6t(l,c))}(typeof e.focusTrapDisabledOverride=="function"?!e.focusTrapDisabledOverride():!e.focusTrapDisabled)&&r.activate()}},deactivate:()=>r==null?void 0:r.deactivate(),overrideFocusTrapEl:l=>{if(r)throw new Error("Focus trap already created");s=l},setExtraContainers:l=>{const c=s||e.el;n=Exe(c,e,l)},updateContainerElements:()=>r==null?void 0:r.updateContainerElements(n)};return a});/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */class I6t{constructor(){this.registeredElements=new Map,this.registeredElementCount=0,this.queryPopover=e=>{const{registeredElements:i}=this,r=e.find(s=>i.has(s));return i.get(r)},this.togglePopovers=e=>{const i=e.composedPath(),r=this.queryPopover(i);r&&!r.triggerDisabled&&(r.open=!r.open),Array.from(this.registeredElements.values()).filter(s=>s!==r&&s.autoClose&&s.open&&!i.includes(s)).forEach(s=>s.open=!1)},this.keyDownHandler=e=>{e.defaultPrevented||(e.key==="Escape"?this.closeAllPopovers():Fle(e.key)&&this.togglePopovers(e))},this.clickHandler=e=>{hUt(e)||e.defaultPrevented||this.togglePopovers(e)}}registerElement(e,i){this.registeredElementCount++,this.registeredElements.set(e,i),this.registeredElementCount===1&&this.addListeners()}unregisterElement(e){this.registeredElements.delete(e)&&this.registeredElementCount--,this.registeredElementCount===0&&this.removeListeners()}closeAllPopovers(){Array.from(this.registeredElements.values()).forEach(e=>e.open=!1)}addListeners(){window.addEventListener("click",this.clickHandler),window.addEventListener("keydown",this.keyDownHandler)}removeListeners(){window.removeEventListener("click",this.clickHandler),window.removeEventListener("keydown",this.keyDownHandler)}}const up={positionContainer:"position-container",container:"container",closeButtonContainer:"close-button-container",closeButton:"close-button",content:"content",hasHeader:"has-header",header:"header",headerContainer:"header-container",heading:"heading"},$xe="auto",Axe="aria-controls",Mxe="aria-expanded",R6t=Ks`:host{display:contents;--calcite-floating-ui-z-index: var(--calcite-popover-z-index, var(--calcite-z-index-popup))}.position-container{inline-size:max-content;display:none;max-inline-size:100vw;max-block-size:100vh;inset-block-start:0;left:0;z-index:var(--calcite-floating-ui-z-index)}.position-container .calcite-floating-ui-anim{position:relative;transition:var(--calcite-floating-ui-transition);transition-property:inset,left,opacity;opacity:0;box-shadow:0 0 16px #00000029;z-index:var(--calcite-z-index);border-radius:.25rem}.position-container[data-placement^=bottom] .calcite-floating-ui-anim{inset-block-start:-5px}.position-container[data-placement^=top] .calcite-floating-ui-anim{inset-block-start:5px}.position-container[data-placement^=left] .calcite-floating-ui-anim{left:5px}.position-container[data-placement^=right] .calcite-floating-ui-anim{left:-5px}.position-container[data-placement] .calcite-floating-ui-anim--active{opacity:1;inset-block-start:0;left:0}.calcite-floating-ui-arrow{pointer-events:none;position:absolute;z-index:calc(var(--calcite-z-index) * -1);fill:var(--calcite-color-foreground-1)}.calcite-floating-ui-arrow__stroke{stroke:var(--calcite-color-border-3)}:host([scale=s]) .heading{padding:.5rem .75rem;font-size:var(--calcite-font-size--1);line-height:1.375}:host([scale=m]) .heading{padding:.75rem 1rem;font-size:var(--calcite-font-size-0);line-height:1.375}:host([scale=l]) .heading{padding:1rem 1.25rem;font-size:var(--calcite-font-size-1);line-height:1.375}.position-container .calcite-floating-ui-anim{border-width:1px;border-style:solid;background-color:var(--calcite-popover-background-color, var(--calcite-color-foreground-1));border-color:var(--calcite-popover-border-color, var(--calcite-color-border-3));border-radius:var(--calcite-popover-corner-radius, var(--calcite-corner-radius-round))}.calcite-floating-ui-arrow{fill:var(--calcite-popover-background-color, var(--calcite-color-foreground-1))}.calcite-floating-ui-arrow__stroke{stroke:var(--calcite-popover-border-color, var(--calcite-color-border-3))}.header{display:flex;flex:1 1 auto;align-items:stretch;justify-content:flex-start;border-width:0px;border-bottom-width:1px;border-style:solid;border-block-end-color:var(--calcite-popover-border-color, var(--calcite-color-border-3))}.heading{margin:0;display:block;flex:1 1 auto;align-self:center;white-space:normal;font-weight:var(--calcite-font-weight-medium);word-wrap:break-word;word-break:break-word;color:var(--calcite-popover-text-color, var(--calcite-color-text-1))}.header-container{position:relative;display:flex;height:100%;flex-direction:row;flex-wrap:nowrap;border-radius:.25rem;color:var(--calcite-popover-text-color, var(--calcite-color-text-1))}.header-container.has-header{flex-direction:column}.content{display:flex;height:100%;width:100%;flex-direction:column;flex-wrap:nowrap;align-self:center;word-wrap:break-word;word-break:break-word}.close-button-container{display:flex;overflow:hidden;flex:0 0 auto;border-start-end-radius:var(--calcite-popover-corner-radius, var(--calcite-corner-radius-round));border-end-end-radius:var(--calcite-popover-corner-radius, var(--calcite-corner-radius-round));--calcite-action-corner-radius-start-end: var(--calcite-popover-corner-radius, var(--calcite-corner-radius-sharp));--calcite-action-corner-radius-end-end: var(--calcite-popover-corner-radius, var(--calcite-corner-radius-sharp))}::slotted(calcite-panel),::slotted(calcite-flow){height:100%}:host([hidden]){display:none}[hidden]{display:none}`,Oxe=new I6t,Ej=class Ej extends Hn{constructor(){super(...arguments),this.closeButtonEl=Yc(),this.focusTrap=O6t({triggerProp:"open",focusTrapOptions:{allowOutsideClick:!0,escapeDeactivates:e=>(e.defaultPrevented||(this.open=!1,e.preventDefault()),!1)}})(this),this.guid=`calcite-popover-${vT()}`,this.hasLoaded=!1,this.mutationObserver=Tf("mutation",()=>this.focusTrap.updateContainerElements()),this.transitionProp="opacity",this.messages=Vd(),this.floatingLayout="vertical",this.autoClose=!1,this.closable=!1,this.flipDisabled=!1,this.focusTrapDisabled=!1,this.offsetDistance=uxe,this.offsetSkidding=0,this.open=!1,this.overlayPositioning="absolute",this.placement=$xe,this.pointerDisabled=!1,this.scale="m",this.triggerDisabled=!1,this.calcitePopoverBeforeClose=Gt({cancelable:!1}),this.calcitePopoverBeforeOpen=Gt({cancelable:!1}),this.calcitePopoverClose=Gt({cancelable:!1}),this.calcitePopoverOpen=Gt({cancelable:!1})}async reposition(e=!1){const{referenceEl:i,placement:r,overlayPositioning:s,flipDisabled:n,filteredFlipPlacements:o,offsetDistance:a,offsetSkidding:l,arrowEl:c,floatingEl:h}=this;return lVe(this,{floatingEl:h,referenceEl:i,overlayPositioning:s,placement:r,flipDisabled:n,flipPlacements:o,offsetDistance:a,offsetSkidding:l,arrowEl:c,type:"popover"},e)}async setFocus(){await yh(this),this.requestUpdate(),uH(this.el)}async updateFocusTrapElements(){this.focusTrap.updateContainerElements()}connectedCallback(){var e;super.connectedCallback(),(e=this.mutationObserver)==null||e.observe(this.el,{childList:!0,subtree:!0}),this.setFilteredPlacements(),requestAnimationFrame(()=>this.setUpReferenceElement(this.hasLoaded))}willUpdate(e){e.has("flipPlacements")&&this.flipPlacementsHandler(),e.has("open")&&(this.hasUpdated||this.open!==!1)&&this.openHandler(),(e.has("offsetDistance")&&(this.hasUpdated||this.offsetDistance!==uxe)||e.has("offsetSkidding")&&(this.hasUpdated||this.offsetSkidding!==0)||e.has("overlayPositioning")&&(this.hasUpdated||this.overlayPositioning!=="absolute")||e.has("placement")&&(this.hasUpdated||this.placement!==$xe))&&this.reposition(!0),e.has("referenceElement")&&this.referenceElementHandler()}loaded(){this.referenceElement&&!this.referenceEl&&this.setUpReferenceElement(),this.hasLoaded=!0}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this.mutationObserver)==null||e.disconnect(),this.removeReferences(),Jle(this)}flipPlacementsHandler(){this.setFilteredPlacements(),this.reposition(!0)}openHandler(){Xle(this),this.reposition(!0),this.setExpandedAttr()}referenceElementHandler(){this.setUpReferenceElement(),this.reposition(!0)}setFloatingEl(e){this.floatingEl=e,e&&requestAnimationFrame(()=>this.setUpReferenceElement())}setTransitionEl(e){e&&(this.transitionEl=e)}setFilteredPlacements(){const{el:e,flipPlacements:i}=this;this.filteredFlipPlacements=i?aVe(i,e):null}setUpReferenceElement(e=!0){this.removeReferences(),this.referenceEl=this.getReferenceElement(),VR(this);const{el:i,referenceElement:r,referenceEl:s}=this;e&&r&&!s&&console.warn(`${i.tagName}: reference-element id "${r}" was not found.`,{el:i}),this.addReferences()}getId(){return this.el.id||this.guid}setExpandedAttr(){const{referenceEl:e,open:i}=this;e&&"setAttribute"in e&&e.setAttribute(Mxe,hH(i))}addReferences(){const{referenceEl:e}=this;if(!e)return;const i=this.getId();"setAttribute"in e&&e.setAttribute(Axe,i),Oxe.registerElement(e,this.el),this.setExpandedAttr()}removeReferences(){const{referenceEl:e}=this;e&&("removeAttribute"in e&&(e.removeAttribute(Axe),e.removeAttribute(Mxe)),Oxe.unregisterElement(e))}getReferenceElement(){const{referenceElement:e,el:i}=this;return(typeof e=="string"?cH(i,{id:e}):e)||null}hide(){this.open=!1}onBeforeOpen(){this.calcitePopoverBeforeOpen.emit()}onOpen(){this.calcitePopoverOpen.emit(),this.focusTrap.activate()}onBeforeClose(){this.calcitePopoverBeforeClose.emit()}onClose(){this.calcitePopoverClose.emit(),Yle(this),this.focusTrap.deactivate()}storeArrowEl(e){this.arrowEl=e,this.reposition(!0)}renderCloseButton(){const{messages:e,closable:i}=this;return i?er(up.closeButtonContainer,ce`<div class=${ge(up.closeButtonContainer)}><calcite-action appearance=transparent class=${ge(up.closeButton)} @click=${this.hide} .scale=${this.scale} .text=${e.close} ${xr(this.closeButtonEl)}><calcite-icon icon=x .scale=${Ya(this.scale)}></calcite-icon></calcite-action></div>`):null}renderHeader(){const{heading:e,headingLevel:i}=this,r=e?uVe({class:up.heading,level:i,children:e}):null;return r?er(up.header,ce`<div class=${ge(up.header)}>${r}${this.renderCloseButton()}</div>`):null}render(){const{referenceEl:e,heading:i,label:r,open:s,pointerDisabled:n,floatingLayout:o}=this,a=e&&s,l=!a,c=n?null:er("floating-arrow",XGt({floatingLayout:o,ref:this.storeArrowEl}));return this.el.inert=l,this.el.ariaLabel=r,this.el.ariaLive="polite",FG(this.el,"id",this.getId()),this.el.role="dialog",ce`<div class=${ge(up.positionContainer)} ${xr(this.setFloatingEl)}><div class=${ge({[up.container]:!0,[JV.animation]:!0,[JV.animationActive]:a})} ${xr(this.setTransitionEl)}>${c}<div class=${ge({[up.hasHeader]:!!i,[up.headerContainer]:!0})}>${this.renderHeader()}<div class=${ge(up.content)}><slot></slot></div>${i?null:this.renderCloseButton()}</div></div></div>`}};Ej.properties={floatingLayout:[16,{},{state:!0}],referenceEl:[16,{},{state:!0}],autoClose:[7,{},{reflect:!0,type:Boolean}],closable:[7,{},{reflect:!0,type:Boolean}],flipDisabled:[7,{},{reflect:!0,type:Boolean}],flipPlacements:[0,{},{attribute:!1}],focusTrapDisabled:[7,{},{reflect:!0,type:Boolean}],focusTrapOptions:[0,{},{attribute:!1}],heading:1,headingLevel:[11,{},{type:Number,reflect:!0}],label:1,messageOverrides:[0,{},{attribute:!1}],offsetDistance:[11,{},{type:Number,reflect:!0}],offsetSkidding:[11,{},{reflect:!0,type:Number}],open:[7,{},{reflect:!0,type:Boolean}],overlayPositioning:[3,{},{reflect:!0}],placement:[3,{},{reflect:!0}],pointerDisabled:[7,{},{reflect:!0,type:Boolean}],referenceElement:1,scale:[3,{},{reflect:!0}],triggerDisabled:[7,{},{reflect:!0,type:Boolean}]},Ej.styles=R6t;let lj=Ej;Io("calcite-popover",lj);const P6t=Object.freeze(Object.defineProperty({__proto__:null,Popover:lj},Symbol.toStringTag,{value:"Module"}));/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */function Ixe(t,e){return(t+e)%e}/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const Rxe={menu:"menu",defaultTrigger:"default-trigger"},Vte={tooltip:"tooltip",trigger:"trigger"},D6t={menu:"ellipsis"},L6t="data-active";/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const N6t=Ks`:host{box-sizing:border-box;display:flex;flex-direction:column;font-size:var(--calcite-font-size-1)}::slotted(calcite-action-group:not(:last-of-type)){border-block-end-width:var(--calcite-border-width-sm)}.default-trigger{position:relative;block-size:100%;flex:0 1 auto;align-self:stretch}slot[name=trigger]::slotted(calcite-action),calcite-action::slotted([slot=trigger]){position:relative;block-size:100%;flex:0 1 auto;align-self:stretch}.menu{display:flex;max-block-size:45vh;flex-direction:column;flex-wrap:nowrap;overflow-y:auto;overflow-x:hidden;outline:2px solid transparent;outline-offset:2px;gap:var(--calcite-action-menu-items-space, 0)}:host([hidden]){display:none}[hidden]{display:none}`,F6t=["ArrowUp","ArrowDown","End","Home"],Cj=class Cj extends Hn{constructor(){super(...arguments),this.guid=`calcite-action-menu-${vT()}`,this.actionElements=[],this.menuButtonClick=()=>{this.toggleOpen()},this.menuButtonId=`${this.guid}-menu-button`,this.menuButtonKeyDown=e=>{const{key:i}=e,{actionElements:r,activeMenuItemIndex:s,open:n}=this;if(r.length){if(Fle(i)){if(e.preventDefault(),!n){this.toggleOpen();return}const o=r[s];o?o.click():this.toggleOpen(!1)}if(i==="Tab"){this.open=!1;return}if(i==="Escape"){this.toggleOpen(!1),e.preventDefault();return}this.handleActionNavigation(e,i,r)}},this.menuId=`${this.guid}-menu`,this._open=!1,this.updateAction=(e,i)=>{const{guid:r,activeMenuItemIndex:s}=this,n=`${r}-action-${i}`;e.tabIndex=-1,e.setAttribute("role","menuitem"),e.id||(e.id=n),e.toggleAttribute(L6t,i===s)},this.activeMenuItemIndex=-1,this.appearance="solid",this.expanded=!1,this.overlayPositioning="absolute",this.placement="auto",this.scale="m",this.calciteActionMenuOpen=Gt({cancelable:!1})}get open(){return this._open}set open(e){const i=this._open;e!==i&&(this._open=e,this.openHandler(e))}async setFocus(){return await yh(this),vD(this.menuButtonEl)}connectedCallback(){super.connectedCallback(),this.connectMenuButtonEl()}willUpdate(e){e.has("expanded")&&(this.hasUpdated||this.expanded!==!1)&&this.expandedHandler(),e.has("activeMenuItemIndex")&&(this.hasUpdated||this.activeMenuItemIndex!==-1)&&this.updateActions(this.actionElements)}disconnectedCallback(){super.disconnectedCallback(),this.disconnectMenuButtonEl()}expandedHandler(){this.open=!1,this.setTooltipReferenceElement()}openHandler(e){this.menuButtonEl&&(this.menuButtonEl.active=e),this.popoverEl&&(this.popoverEl.open=e),this.activeMenuItemIndex=this.open?0:-1,this.calciteActionMenuOpen.emit(),this.setTooltipReferenceElement()}connectMenuButtonEl(){const{menuButtonId:e,menuId:i,open:r,label:s}=this,n=this.slottedMenuButtonEl||this.defaultMenuButtonEl;this.menuButtonEl!==n&&(this.disconnectMenuButtonEl(),this.menuButtonEl=n,this.setTooltipReferenceElement(),n&&(n.active=r,n.setAttribute("aria-controls",i),n.setAttribute("aria-expanded",hH(r)),n.setAttribute("aria-haspopup","true"),n.id||(n.id=e),n.label||(n.label=s),n.text||(n.text=s),n.addEventListener("click",this.menuButtonClick),n.addEventListener("keydown",this.menuButtonKeyDown)))}disconnectMenuButtonEl(){const{menuButtonEl:e}=this;e&&(e.removeEventListener("click",this.menuButtonClick),e.removeEventListener("keydown",this.menuButtonKeyDown),this.menuButtonEl=null)}setMenuButtonEl(e){const i=e.target.assignedElements({flatten:!0}).filter(r=>r==null?void 0:r.matches("calcite-action"));this.slottedMenuButtonEl=i[0],this.connectMenuButtonEl()}setDefaultMenuButtonEl(e){this.defaultMenuButtonEl=e,e&&this.connectMenuButtonEl()}setPopoverEl(e){e&&(this.popoverEl=e,e.open=this.open)}handleCalciteActionClick(){this.open=!1,this.setFocus()}updateTooltip(e){const i=e.target.assignedElements({flatten:!0}).filter(r=>r==null?void 0:r.matches("calcite-tooltip"));this.tooltipEl=i[0],this.setTooltipReferenceElement()}setTooltipReferenceElement(){const{tooltipEl:e,expanded:i,menuButtonEl:r,open:s}=this;e&&(e.referenceElement=!i&&!s?r:null)}updateActions(e){e==null||e.forEach(this.updateAction)}handleDefaultSlotChange(e){const i=e.target.assignedElements({flatten:!0}).reduce((r,s)=>s!=null&&s.matches("calcite-action")?(r.push(s),r):s!=null&&s.matches("calcite-action-group")?r.concat(Array.from(s.querySelectorAll("calcite-action"))):r,[]);this.actionElements=i.filter(r=>!r.disabled&&!r.hidden)}isValidKey(e,i){return!!i.find(r=>r===e)}handleActionNavigation(e,i,r){if(!this.isValidKey(i,F6t))return;if(e.preventDefault(),!this.open){this.toggleOpen(),(i==="Home"||i==="ArrowDown")&&(this.activeMenuItemIndex=0),(i==="End"||i==="ArrowUp")&&(this.activeMenuItemIndex=r.length-1);return}i==="Home"&&(this.activeMenuItemIndex=0),i==="End"&&(this.activeMenuItemIndex=r.length-1);const s=this.activeMenuItemIndex;i==="ArrowUp"&&(this.activeMenuItemIndex=Ixe(Math.max(s-1,-1),r.length)),i==="ArrowDown"&&(this.activeMenuItemIndex=Ixe(s+1,r.length))}toggleOpen(e=!this.open){this.open=e}handlePopoverOpen(e){e.stopPropagation(),this.open=!0,this.setFocus()}handlePopoverClose(e){e.stopPropagation(),this.open=!1}renderMenuButton(){const{appearance:e,label:i,scale:r,expanded:s}=this;return ce`<slot name=${Vte.trigger} @slotchange=${this.setMenuButtonEl}><calcite-action .appearance=${e} class=${ge(Rxe.defaultTrigger)} .icon=${D6t.menu} .scale=${r} .text=${i} .textEnabled=${s} ${xr(this.setDefaultMenuButtonEl)}></calcite-action></slot>`}renderMenuItems(){const{actionElements:e,activeMenuItemIndex:i,menuId:r,menuButtonEl:s,label:n,placement:o,overlayPositioning:a,flipPlacements:l}=this,c=e[i],h=(c==null?void 0:c.id)||null;return ce`<calcite-popover auto-close .flipPlacements=${l} focus-trap-disabled .label=${n} offset-distance=0 @calcitePopoverClose=${this.handlePopoverClose} @calcitePopoverOpen=${this.handlePopoverOpen} .overlayPositioning=${a} .placement=${o} pointer-disabled .referenceElement=${s} trigger-disabled ${xr(this.setPopoverEl)}><div aria-activedescendant=${h??Ke} aria-labelledby=${(s==null?void 0:s.id)??Ke} class=${ge(Rxe.menu)} id=${r??Ke} @click=${this.handleCalciteActionClick} role=menu tabindex=-1><slot @slotchange=${this.handleDefaultSlotChange}></slot></div></calcite-popover>`}render(){return ce`${this.renderMenuButton()}${this.renderMenuItems()}<slot name=${Vte.tooltip} @slotchange=${this.updateTooltip}></slot>`}};Cj.properties={activeMenuItemIndex:[16,{},{state:!0}],menuButtonEl:[16,{},{state:!0}],appearance:[3,{},{reflect:!0}],expanded:[7,{},{reflect:!0,type:Boolean}],flipPlacements:[0,{},{attribute:!1}],label:1,open:[7,{},{reflect:!0,type:Boolean}],overlayPositioning:[3,{},{reflect:!0}],placement:[3,{},{reflect:!0}],scale:[3,{},{reflect:!0}]},Cj.styles=N6t;let cj=Cj;Io("calcite-action-menu",cj);const dgi=Object.freeze(Object.defineProperty({__proto__:null,ActionMenu:cj},Symbol.toStringTag,{value:"Module"}));/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const en={actionBarContainer:"action-bar-container",container:"container",contentBottom:"content-bottom",contentTop:"content-top",header:"header",headerContainer:"header-container",headerContainerBorderEnd:"header-container--border-end",heading:"heading",description:"description",headerContent:"header-content",headerActions:"header-actions",headerActionsEnd:"header-actions--end",headerActionsStart:"header-actions--start",contentWrapper:"content-wrapper",fabContainer:"fab-container",footer:"footer",footerContent:"footer-content",footerActions:"footer-actions",footerStart:"footer-start",footerEnd:"footer-end",headerSlottedContent:"header-slotted-content",menuAction:"menu-action"},Pxe={close:"close",collapse:"collapse"},u4={close:"x",menu:"ellipsis",expand:"chevron-down",collapse:"chevron-up"},Tu={actionBar:"action-bar",alerts:"alerts",contentBottom:"content-bottom",contentTop:"content-top",headerActionsStart:"header-actions-start",headerActionsEnd:"header-actions-end",headerMenuActions:"header-menu-actions",headerContent:"header-content",fab:"fab",footer:"footer",footerEnd:"footer-end",footerStart:"footer-start",footerActions:"footer-actions"};/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const k6t=Ks`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{position:relative;box-sizing:border-box;display:flex;block-size:100%;inline-size:100%;flex:1 1 auto;overflow:hidden;--calcite-min-header-height: calc(var(--calcite-icon-size) * 3);border-radius:var(--calcite-panel-corner-radius, var(--calcite-corner-radius-sharp))}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}.header{margin:0;display:flex;align-content:space-between;align-items:center;fill:var(--calcite-color-text-2);color:var(--calcite-color-text-2)}.heading{margin:0;padding:0;font-weight:var(--calcite-font-weight-medium)}.header .heading{flex:1 1 auto;padding:.5rem}:host([scale=s]){--calcite-internal-panel-default-space: var(--calcite-spacing-sm);--calcite-internal-panel-header-vertical-padding: var(--calcite-spacing-sm-plus)}:host([scale=s]) .header-content .heading{font-size:var(--calcite-font-size--1)}:host([scale=s]) .header-content .description{font-size:var(--calcite-font-size--2)}:host([scale=m]){--calcite-internal-panel-default-space: var(--calcite-spacing-md);--calcite-internal-panel-header-vertical-padding: var(--calcite-spacing-md-plus)}:host([scale=m]) .header-content .heading{font-size:var(--calcite-font-size-0)}:host([scale=m]) .header-content .description{font-size:var(--calcite-font-size--1)}:host([scale=l]){--calcite-internal-panel-default-space: var(--calcite-spacing-lg);--calcite-internal-panel-header-vertical-padding: var(--calcite-spacing-xl)}:host([scale=l]) .header-content .heading{font-size:var(--calcite-font-size-1)}:host([scale=l]) .header-content .description{font-size:var(--calcite-font-size-0)}.content-top,.content-bottom{display:flex;align-items:flex-start;align-self:stretch;padding:var(--calcite-internal-panel-default-space);border-block-start:1px solid var(--calcite-panel-border-color, var(--calcite-color-border-3));background-color:var(--calcite-panel-background-color, var(--calcite-color-foreground-1))}.container{position:relative;margin:0;display:flex;inline-size:100%;flex:1 1 auto;flex-direction:column;align-items:stretch;overflow:hidden;background-color:var(--calcite-color-background);padding:0;color:var(--calcite-color-text-2);transition:max-block-size var(--calcite-animation-timing),inline-size var(--calcite-animation-timing);box-sizing:border-box;font-size:var(--calcite-font-size--1)}.container *{box-sizing:border-box}.container[hidden]{display:none}.header{z-index:var(--calcite-z-index-header);display:flex;flex-direction:column;background-color:var(--calcite-panel-header-background-color, var(--calcite-color-foreground-1));border-block-end:1px solid var(--calcite-panel-border-color, var(--calcite-panel-header-border-block-end, var(--calcite-color-border-3)))}.header-container{display:flex;inline-size:100%;flex-direction:row;align-items:stretch;justify-content:flex-start;flex:0 0 auto}.header-container--border-end{border-block-end:1px solid var(--calcite-panel-border-color, var(--calcite-color-border-3))}.action-bar-container{inline-size:100%}.action-bar-container ::slotted(calcite-action-bar){inline-size:100%}.header-content{display:flex;flex-direction:column;overflow:hidden;padding-inline:.75rem;padding-block:.875rem;margin-inline-end:auto;justify-content:center}.header-content .heading,.header-content .description{display:block;flex:none;overflow-wrap:break-word;padding:0;line-height:var(--calcite-font-line-height-relative-snug)}.header-content .heading{font-weight:var(--calcite-font-weight-medium);color:var(--calcite-panel-heading-text-color, var(--calcite-color-text-1))}.header-content .heading:only-child{margin-block-end:0px}.header-content .description{color:var(--calcite-panel-description-text-color, var(--calcite-color-text-2))}#close,#collapse,.back-button,calcite-action-menu{--calcite-action-background-color: var(--calcite-panel-header-action-background-color);--calcite-action-background-color-hover: var(--calcite-panel-header-action-background-color-hover);--calcite-action-background-color-press: var(--calcite-panel-header-action-background-color-press);--calcite-action-text-color: var(--calcite-panel-header-action-text-color);--calcite-action-text-color-press: var(--calcite-panel-header-action-text-color-press)}.back-button{border-width:0px;border-style:solid;border-inline-end-width:1px;border-color:var(--calcite-panel-border-color, var(--calcite-color-border-3))}.header-actions{display:flex;flex-direction:row;flex-wrap:nowrap;align-items:stretch}.header-actions--end{margin-inline-start:auto}.content-wrapper{position:relative;display:flex;block-size:100%;flex:1 1 auto;flex-direction:column;flex-wrap:nowrap;align-items:stretch;overflow:auto;color:var(--calcite-color-text-2);outline-color:transparent;padding:var(--calcite-panel-space, var(--calcite-panel-content-space, 0));background:var(--calcite-panel-background-color, var(--calcite-color-background))}.content-wrapper:focus-visible{outline:2px solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline-offset:calc(-2px*(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}.header-content{flex:1 1 auto;justify-content:center;padding-block:var(--calcite-internal-panel-header-vertical-padding);padding-inline:var(--calcite-internal-panel-default-space)}.header-content.header-slotted-content{padding:var(--calcite-panel-header-content-space, var(--calcite-internal-panel-header-vertical-padding) var(--calcite-internal-panel-default-space))}.footer{margin-block-start:auto;display:flex;flex-direction:row;align-content:space-between;align-items:center;justify-content:center;font-size:var(--calcite-font-size--2);line-height:1.375;border-block-start:1px solid var(--calcite-panel-border-color, var(--calcite-color-border-3));padding:var(--calcite-panel-footer-space, var(--calcite-panel-footer-padding, var(--calcite-internal-panel-default-space)));background-color:var(--calcite-panel-footer-background-color, var(--calcite-color-foreground-1))}.footer-content{display:flex;flex:1 1 0%;flex-direction:row;align-items:center;justify-content:center}.footer-actions{display:flex;flex:1 1 0%;flex-direction:row;align-items:center;justify-content:space-evenly;gap:var(--calcite-internal-panel-default-space)}.footer-start{display:flex;flex:1 1 0%;flex-direction:row;align-items:center;justify-content:flex-start;margin-inline-end:auto;gap:var(--calcite-internal-panel-default-space)}.footer-end{display:flex;flex:1 1 0%;flex-direction:row;align-items:center;justify-content:flex-end;margin-inline-start:auto;gap:var(--calcite-internal-panel-default-space)}.fab-container{position:sticky;inset-block-end:0px;z-index:var(--calcite-z-index-sticky);margin-block:0px;margin-inline:auto;display:block;padding:.5rem;inset-inline:0;inline-size:fit-content}:host([hidden]){display:none}[hidden]{display:none}`,$j=class $j extends Hn{constructor(){super(),this.resizeObserver=Tf("resize",()=>this.resizeHandler()),this.messages=Vd(),this.hasActionBar=!1,this.hasContentBottom=!1,this.hasContentTop=!1,this.hasEndActions=!1,this.hasFab=!1,this.hasFooterActions=!1,this.hasFooterContent=!1,this.hasFooterEndContent=!1,this.hasFooterStartContent=!1,this.hasHeaderContent=!1,this.hasMenuItems=!1,this.hasStartActions=!1,this.isClosed=!1,this.showHeaderContent=!1,this.closable=!1,this.closed=!1,this.collapseDirection="down",this.collapsed=!1,this.collapsible=!1,this.disabled=!1,this.loading=!1,this.menuOpen=!1,this.menuPlacement=RGt,this.overlayPositioning="absolute",this.scale="m",this.calcitePanelClose=Gt({cancelable:!1}),this.calcitePanelScroll=Gt({cancelable:!1}),this.calcitePanelToggle=Gt({cancelable:!1}),this.listen("keydown",this.panelKeyDownHandler)}async scrollContentTo(e){var i;(i=this.panelScrollEl)==null||i.scrollTo(e)}async setFocus(){await yh(this),uH(this.containerEl)}async load(){this.isClosed=this.closed}willUpdate(e){e.has("closed")&&this.hasUpdated&&(this.closed?this.close():this.open())}updated(){Cg(this)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this.resizeObserver)==null||e.disconnect()}resizeHandler(){const{panelScrollEl:e}=this;if(!e||typeof e.scrollHeight!="number"||typeof e.offsetHeight!="number")return;e.scrollHeight>e.offsetHeight?e.setAttribute("tabindex","0"):e.removeAttribute("tabindex")}setContainerRef(e){this.containerEl=e}panelKeyDownHandler(e){this.closable&&e.key==="Escape"&&!e.defaultPrevented&&(this.handleUserClose(),e.preventDefault())}handleUserClose(){this.closed=!0,this.calcitePanelClose.emit()}open(){this.isClosed=!1}async close(){const e=this.beforeClose??(()=>Promise.resolve());try{await e()}catch{requestAnimationFrame(()=>{this.closed=!1});return}this.isClosed=!0}collapse(){this.collapsed=!this.collapsed,this.calcitePanelToggle.emit()}panelScrollHandler(){this.calcitePanelScroll.emit()}handleHeaderActionsStartSlotChange(e){this.hasStartActions=Os(e)}handleHeaderActionsEndSlotChange(e){this.hasEndActions=Os(e)}handleHeaderMenuActionsSlotChange(e){this.hasMenuItems=Os(e)}handleActionBarSlotChange(e){const i=bte(e).filter(r=>r==null?void 0:r.matches("calcite-action-bar"));i.forEach(r=>r.layout="horizontal"),this.hasActionBar=!!i.length}handleHeaderContentSlotChange(e){this.hasHeaderContent=Os(e)}handleFabSlotChange(e){this.hasFab=Os(e)}handleFooterActionsSlotChange(e){this.hasFooterActions=Os(e)}handleFooterEndSlotChange(e){this.hasFooterEndContent=Os(e)}handleFooterStartSlotChange(e){this.hasFooterStartContent=Os(e)}handleFooterSlotChange(e){this.hasFooterContent=Os(e)}contentBottomSlotChangeHandler(e){this.hasContentBottom=Os(e)}contentTopSlotChangeHandler(e){this.hasContentTop=Os(e)}setPanelScrollEl(e){var i,r;this.panelScrollEl=e,(i=this.resizeObserver)==null||i.disconnect(),e&&((r=this.resizeObserver)==null||r.observe(e),this.resizeHandler())}handleAlertsSlotChange(e){var i;(i=bte(e))==null||i.map(r=>{r.nodeName==="CALCITE-ALERT"&&(r.embedded=!0)})}renderHeaderContent(){const{heading:e,headingLevel:i,description:r,hasHeaderContent:s}=this,n=e?uVe({class:en.heading,level:i,children:e}):null,o=r?ce`<span class=${ge(en.description)}>${r}</span>`:null;return!s&&(n||o)?er("header-content",ce`<div class=${ge(en.headerContent)}>${n}${o}</div>`):null}renderActionBar(){return ce`<div class=${ge(en.actionBarContainer)} .hidden=${!this.hasActionBar}><slot name=${Tu.actionBar} @slotchange=${this.handleActionBarSlotChange}></slot></div>`}renderHeaderSlottedContent(){return er("slotted-header-content",ce`<div class=${ge({[en.headerContent]:!0,[en.headerSlottedContent]:!0})} .hidden=${!this.hasHeaderContent}><slot name=${Tu.headerContent} @slotchange=${this.handleHeaderContentSlotChange}></slot></div>`)}renderHeaderStartActions(){const{hasStartActions:e}=this;return er("header-actions-start",ce`<div class=${ge({[en.headerActionsStart]:!0,[en.headerActions]:!0})} .hidden=${!e}><slot name=${Tu.headerActionsStart} @slotchange=${this.handleHeaderActionsStartSlotChange}></slot></div>`)}renderHeaderActionsEnd(){const{hasEndActions:e,messages:i,closable:r,collapsed:s,collapseDirection:n,collapsible:o,hasMenuItems:a}=this,{collapse:l,expand:c,close:h}=i,d=[u4.expand,u4.collapse];n==="up"&&d.reverse();const f=o?ce`<calcite-action .ariaExpanded=${!s} .ariaLabel=${l} .icon=${s?d[0]:d[1]} id=${Pxe.collapse} @click=${this.collapse} .scale=${this.scale} .text=${l} title=${(s?c:l)??Ke}></calcite-action>`:null,m=r?ce`<calcite-action .ariaLabel=${h} .icon=${u4.close} id=${Pxe.close} @click=${this.handleUserClose} .scale=${this.scale} .text=${h} title=${h??Ke}></calcite-action>`:null,g=ce`<slot name=${Tu.headerActionsEnd} @slotchange=${this.handleHeaderActionsEndSlotChange}></slot>`,v=e||f||m||a;return er("header-actions-end",ce`<div class=${ge({[en.headerActionsEnd]:!0,[en.headerActions]:!0})} .hidden=${!v}>${g}${this.renderMenu()}${f}${m}</div>`)}renderMenu(){const{hasMenuItems:e,messages:i,menuOpen:r,menuFlipPlacements:s,menuPlacement:n}=this;return er("menu",ce`<calcite-action-menu .flipPlacements=${s??["top","bottom"]} .hidden=${!e} .label=${i.options} .open=${r} .overlayPositioning=${this.overlayPositioning} .placement=${n}><calcite-action class=${ge(en.menuAction)} .icon=${u4.menu} .scale=${this.scale} slot=${Vte.trigger} .text=${i.options}></calcite-action><slot name=${Tu.headerMenuActions} @slotchange=${this.handleHeaderMenuActionsSlotChange}></slot></calcite-action-menu>`)}renderHeaderNode(){const{hasHeaderContent:e,hasStartActions:i,hasEndActions:r,closable:s,collapsible:n,hasMenuItems:o,hasActionBar:a}=this,l=this.renderHeaderContent(),c=e||!!l||i||r||n||s||o;return this.showHeaderContent=c,ce`<header class=${ge(en.header)} .hidden=${!(c||a)}><div class=${ge({[en.headerContainer]:!0,[en.headerContainerBorderEnd]:a})} .hidden=${!c}>${this.renderHeaderStartActions()}${this.renderHeaderSlottedContent()}${l}${this.renderHeaderActionsEnd()}</div>${this.renderActionBar()}${this.renderContentTop()}</header>`}renderFooterNode(){const{hasFooterEndContent:e,hasFooterStartContent:i,hasFooterContent:r,hasFooterActions:s}=this,n=i||e||r||s;return ce`<footer class=${ge(en.footer)} .hidden=${!n}><div class=${ge(en.footerContent)} .hidden=${!r}><slot name=${Tu.footer} @slotchange=${this.handleFooterSlotChange}></slot></div><div class=${ge(en.footerStart)} .hidden=${r||!i}><slot name=${Tu.footerStart} @slotchange=${this.handleFooterStartSlotChange}></slot></div><div class=${ge(en.footerEnd)} .hidden=${r||!e}><slot name=${Tu.footerEnd} @slotchange=${this.handleFooterEndSlotChange}></slot></div><div class=${ge(en.footerActions)} .hidden=${r||!s}>${er("footer-actions-slot",ce`<slot name=${Tu.footerActions} @slotchange=${this.handleFooterActionsSlotChange}></slot>`)}</div></footer>`}renderContent(){return ce`<div class=${ge(en.contentWrapper)} .hidden=${this.collapsible&&this.collapsed} @scroll=${this.panelScrollHandler} ${xr(this.setPanelScrollEl)}><slot></slot>${this.renderFab()}</div>`}renderContentBottom(){return ce`<div class=${ge(en.contentBottom)} .hidden=${!this.hasContentBottom}><slot name=${Tu.contentBottom} @slotchange=${this.contentBottomSlotChangeHandler}></slot></div>`}renderContentTop(){return ce`<div class=${ge(en.contentTop)} .hidden=${!this.hasContentTop}><slot name=${Tu.contentTop} @slotchange=${this.contentTopSlotChangeHandler}></slot></div>`}renderFab(){return ce`<div class=${ge(en.fabContainer)} .hidden=${!this.hasFab}><slot name=${Tu.fab} @slotchange=${this.handleFabSlotChange}></slot></div>`}render(){const{disabled:e,loading:i,isClosed:r}=this,s=ce`<article .ariaBusy=${i} class=${ge(en.container)} .hidden=${r} ${xr(this.setContainerRef)}>${this.renderHeaderNode()}${this.renderContent()}${this.renderContentBottom()}${this.renderFooterNode()}${er("alerts",ce`<slot name=${Tu.alerts} @slotchange=${this.handleAlertsSlotChange}></slot>`)}</article>`;return $g({disabled:e,children:ce`${i?ce`<calcite-scrim .loading=${i}></calcite-scrim>`:null}${s}`})}};$j.properties={hasActionBar:[16,{},{state:!0}],hasContentBottom:[16,{},{state:!0}],hasContentTop:[16,{},{state:!0}],hasEndActions:[16,{},{state:!0}],hasFab:[16,{},{state:!0}],hasFooterActions:[16,{},{state:!0}],hasFooterContent:[16,{},{state:!0}],hasFooterEndContent:[16,{},{state:!0}],hasFooterStartContent:[16,{},{state:!0}],hasHeaderContent:[16,{},{state:!0}],hasMenuItems:[16,{},{state:!0}],hasStartActions:[16,{},{state:!0}],isClosed:[16,{},{state:!0}],showHeaderContent:[16,{},{state:!0}],beforeClose:[0,{},{attribute:!1}],closable:[7,{},{reflect:!0,type:Boolean}],closed:[7,{},{reflect:!0,type:Boolean}],collapseDirection:1,collapsed:[7,{},{reflect:!0,type:Boolean}],collapsible:[7,{},{reflect:!0,type:Boolean}],description:1,disabled:[7,{},{reflect:!0,type:Boolean}],heading:1,headingLevel:[11,{},{type:Number,reflect:!0}],loading:[7,{},{reflect:!0,type:Boolean}],menuFlipPlacements:[0,{},{attribute:!1}],menuOpen:[7,{},{reflect:!0,type:Boolean}],menuPlacement:[3,{},{reflect:!0}],messageOverrides:[0,{},{attribute:!1}],overlayPositioning:[3,{},{reflect:!0}],scale:[3,{},{reflect:!0}]},$j.styles=k6t;let uj=$j;Io("calcite-panel",uj);const z6t=Object.freeze(Object.defineProperty({__proto__:null,Panel:uj},Symbol.toStringTag,{value:"Module"})),Qi=new Iat({container:"mapViewContainer",map:new p5t({portalItem:{id:"7ee3c8a93f254753a83ac0195757f137"}}),center:[-122.4376,37.7728],zoom:12}),js=new eDt({container:"sceneViewContainer",map:new czt({portalItem:{id:"c8cf26d7acab4e45afcd5e20080983c1"}}),center:[-122.4376,37.7728],zoom:12});window.appViews={mapView:Qi,sceneView:js};const U6t=new vn,B6t=new PC({portal:U6t,query:{id:"bdb9d65e0b5c480c8dcc6916e7f4e099"}}),jte=new wzt({view:Qi,source:B6t,container:document.createElement("div")}),N_=new Szt({view:Qi,content:jte,expandIcon:"basemap",group:"top-left"});Qi.ui.add(N_,"top-left");const F_=document.createElement("view-extent");F_.view=Qi;Qi.ui.add(F_,"bottom-right");const k_=document.createElement("draw-extent");k_.view=Qi;Qi.ui.add(k_,"bottom-left");const Um=document.createElement("calcite-panel");Um.style.margin="10px";Um.heading="Spatial Reference";Um.id="srPanel";Um.innerHTML='<div id="srPanelContent" style="font-size:16px;padding:4px 0;"></div>';function GS(t){var i;const e=Um.querySelector("#srPanelContent");e&&(e.innerHTML=`map.spatialReference.wkid = <b>${(i=t.spatialReference)==null?void 0:i.wkid}</b>`)}H(()=>Qi.spatialReference,()=>GS(Qi));H(()=>js.spatialReference,()=>GS(js));Qi.on("layerview-create",()=>GS(Qi));js.on("layerview-create",()=>GS(js));GS(Qi);Qi.ui.add(Um,"top-right");Qi.ui.add(N_,{position:"top-right",index:1});const y$=document.querySelector("view-switcher");y$.setView(Qi);Qi.ui.add(y$,"top-left");js.ui.add(y$,"top-left");const pd=document.createElement("layer-manager");pd.view=Qi;Qi.ui.add(pd,"manual");function Dxe(t,e){if(!(t!=null&&t.map)||!(e!=null&&e.map))return;const i=t.map.layers.map(r=>r.url).filter(r=>!!r);e.map.layers.filter(r=>r.url&&!i.includes(r.url)).forEach(r=>e.map.layers.remove(r)),t.map.layers.forEach(r=>{if(r.url&&!e.map.layers.find(s=>s.url===r.url)){const s=r.declaredClass?require(`@arcgis/core/layers/${r.declaredClass.split(".").pop()}`).default:require("@arcgis/core/layers/FeatureLayer").default;try{const n=new s({url:r.url});e.map.layers.add(n)}catch{}}}),t.extent&&e.goTo(t.extent).catch(()=>{})}y$.addEventListener("view-switch",t=>{const e=t.detail.is3D,i=document.getElementById("mapViewContainer"),r=document.getElementById("sceneViewContainer");e?(i.style.display="none",r.style.display="",y$.setView(js),Qi.ui.remove(N_),js.ui.add(N_,{position:"top-right",index:1}),N_.view=js,jte.view=js,GS(js),Qi.ui.remove(Um),js.ui.add(Um,"top-right"),Qi.ui.remove(F_),js.ui.add(F_,"bottom-right"),F_.view=js,Qi.ui.remove(k_),js.ui.add(k_,"bottom-left"),k_.view=js,Qi.ui.remove(pd),js.ui.add(pd,"manual"),pd.view=js,Dxe(Qi,js)):(r.style.display="none",i.style.display="",y$.setView(Qi),js.ui.remove(N_),Qi.ui.add(N_,{position:"top-right",index:1}),N_.view=Qi,jte.view=Qi,GS(Qi),js.ui.remove(Um),Qi.ui.add(Um,"top-right"),js.ui.remove(F_),Qi.ui.add(F_,"bottom-right"),F_.view=Qi,js.ui.remove(k_),Qi.ui.add(k_,"bottom-left"),k_.view=Qi,js.ui.remove(pd),Qi.ui.add(pd,"manual"),pd.view=Qi,Dxe(js,Qi))});document.getElementById("sceneViewContainer").style.display="none";document.getElementById("mapViewContainer").style.display="";pd.style.position="absolute";pd.style.left="50%";pd.style.bottom="30px";pd.style.transform="translateX(-50%)";const V6t=Object.freeze(Object.defineProperty({__proto__:null,build:MDe},Symbol.toStringTag,{value:"Module"})),j6t=Object.freeze(Object.defineProperty({__proto__:null,build:ODe,getRadius:S6},Symbol.toStringTag,{value:"Module"})),G6t=Object.freeze(Object.defineProperty({__proto__:null,build:kDe},Symbol.toStringTag,{value:"Module"})),H6t=Object.freeze(Object.defineProperty({__proto__:null,build:UDe},Symbol.toStringTag,{value:"Module"})),q6t=Object.freeze(Object.defineProperty({__proto__:null,build:oLe},Symbol.toStringTag,{value:"Module"})),W6t=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:hoe,blurSize:doe,build:nLe,gridCellPixelSize:db,outlineSize:G3},Symbol.toStringTag,{value:"Module"})),Z6t=Object.freeze(Object.defineProperty({__proto__:null,build:aLe},Symbol.toStringTag,{value:"Module"})),Y6t=Object.freeze(Object.defineProperty({__proto__:null,build:lLe},Symbol.toStringTag,{value:"Module"})),J6t=Object.freeze(Object.defineProperty({__proto__:null,SingleHighlightBlurDrawParameters:poe,build:cLe},Symbol.toStringTag,{value:"Module"})),X6t=Object.freeze(Object.defineProperty({__proto__:null,build:FLe,ribbonlineNumRoundJoinSubdivisions:q3},Symbol.toStringTag,{value:"Module"})),K6t=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:uoe,build:iLe},Symbol.toStringTag,{value:"Module"})),Q6t=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:woe,build:VLe},Symbol.toStringTag,{value:"Module"})),eHt=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaColorPassParameters:Toe,build:YLe},Symbol.toStringTag,{value:"Module"})),tHt=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaMaskDrawParameters:Eoe,build:JLe},Symbol.toStringTag,{value:"Module"})),iHt=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:Poe,build:RNe,cubeMapSize:n$},Symbol.toStringTag,{value:"Module"})),rHt=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:Doe,build:PNe},Symbol.toStringTag,{value:"Module"})),sHt=Object.freeze(Object.defineProperty({__proto__:null,build:FNe},Symbol.toStringTag,{value:"Module"})),nHt=Object.freeze(Object.defineProperty({__proto__:null,build:jFe,calculateAnchorPosition:iD},Symbol.toStringTag,{value:"Module"})),oHt=Object.freeze(Object.defineProperty({__proto__:null,build:YFe},Symbol.toStringTag,{value:"Module"})),aHt=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:_ae,build:r4e},Symbol.toStringTag,{value:"Module"})),lHt=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return Nv},build:E4e},Symbol.toStringTag,{value:"Module"})),cHt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:I4e,ColorizerStretchUniforms:O4e,ColorizerUniforms:W6,build:R4e},Symbol.toStringTag,{value:"Module"})),uHt=Object.freeze(Object.defineProperty({__proto__:null,build:Y4e},Symbol.toStringTag,{value:"Module"})),hHt=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:Lae,build:X4e},Symbol.toStringTag,{value:"Module"})),dHt=Object.freeze(Object.defineProperty({__proto__:null,build:K4e},Symbol.toStringTag,{value:"Module"})),pHt=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:Nae,build:Q4e},Symbol.toStringTag,{value:"Module"})),fHt=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:kae,SimpleAtmospherePassParameters:Y6,build:e5e},Symbol.toStringTag,{value:"Module"})),mHt=Object.freeze(Object.defineProperty({__proto__:null,build:n5e},Symbol.toStringTag,{value:"Module"})),gHt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:J6,build:c5e},Symbol.toStringTag,{value:"Module"})),yHt=Object.freeze(Object.defineProperty({__proto__:null,HazeCompositingPassParameters:Bae,build:h5e},Symbol.toStringTag,{value:"Module"})),vHt=Object.freeze(Object.defineProperty({__proto__:null,build:d5e},Symbol.toStringTag,{value:"Module"})),_Ht=Object.freeze(Object.defineProperty({__proto__:null,build:p5e},Symbol.toStringTag,{value:"Module"})),bHt=Object.freeze(Object.defineProperty({__proto__:null,MagnifierPassParameters:jae,build:f5e},Symbol.toStringTag,{value:"Module"})),wHt=Object.freeze(Object.defineProperty({__proto__:null,build:m5e},Symbol.toStringTag,{value:"Module"})),xHt=Object.freeze(Object.defineProperty({__proto__:null,build:g5e},Symbol.toStringTag,{value:"Module"})),SHt=Object.freeze(Object.defineProperty({__proto__:null,build:y5e},Symbol.toStringTag,{value:"Module"})),THt=Object.freeze(Object.defineProperty({__proto__:null,build:v5e},Symbol.toStringTag,{value:"Module"})),EHt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:Gae,build:b5e},Symbol.toStringTag,{value:"Module"})),CHt=Object.freeze(Object.defineProperty({__proto__:null,OITBlendPassParameters:qae,build:R5e},Symbol.toStringTag,{value:"Module"})),$Ht=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:Wae,build:N5e},Symbol.toStringTag,{value:"Module"})),AHt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:VL,build:L5e},Symbol.toStringTag,{value:"Module"}));export{Ymi as $,Ks as A,$Yt as A$,CXe as A0,q7 as A1,mKe as A2,fKe as A3,Lre as A4,tZ as A5,h9t as A6,iZ as A7,$U as A8,CU as A9,n2t as AA,nWt as AB,Yj as AC,Fri as AD,Cse as AE,Cht as AF,xlt as AG,Q$ as AH,Hfi as AI,oQ as AJ,Cfi as AK,Vfi as AL,yfi as AM,Afi as AN,Efi as AO,gkt as AP,$fi as AQ,zwe as AR,Fwe as AS,kwe as AT,Dfi as AU,Pfi as AV,JTt as AW,Nfi as AX,Lfi as AY,TYt as AZ,mkt as A_,IFe as Aa,yqt as Ab,gqt as Ac,FHe as Ad,yMe as Ae,MGe as Af,AGe as Ag,jnt as Ah,Q9t as Ai,Wo as Aj,fA as Ak,Yfi as Al,ZZt as Am,r0e as An,KJe as Ao,h7t as Ap,YYt as Aq,tfi as Ar,vce as As,x7t as At,JYt as Au,fQ as Av,RKe as Aw,i2t as Ax,gSe as Ay,c8t as Az,Io as B,n0e as B$,Idi as B0,vkt as B1,SYt as B2,bfi as B3,Zst as B4,xYt as B5,fpe as B6,KZt as B7,QZt as B8,XTt as B9,_0e as BA,Hqt as BB,E0e as BC,j0e as BD,G0e as BE,H0e as BF,D8e as BG,Dqt as BH,y8e as BI,aZ as BJ,q0e as BK,Lqt as BL,Gtt as BM,Tfi as BN,kfi as BO,qfi as BP,kqt as BQ,pke as BR,Rfi as BS,Ifi as BT,e_e as BU,f0e as BV,i_e as BW,Q0e as BX,C0e as BY,a0e as BZ,o0e as B_,AYt as Ba,MYt as Bb,kYt as Bc,zYt as Bd,cYt as Be,UYt as Bf,BYt as Bg,Rst as Bh,Nst as Bi,DNe as Bj,ga as Bk,yYt as Bl,HVe as Bm,Sv as Bn,yMt as Bo,hIe as Bp,OYt as Bq,ATe as Br,wRt as Bs,Jtt as Bt,x0e as Bu,y0e as Bv,m8e as Bw,v0e as Bx,mEe as By,L0e as Bz,nLt as C,Ti as C$,p0e as C0,wG as C1,Mfi as C2,Ofi as C3,WHe as C4,qHe as C5,Tqt as C6,oje as C7,sKe as C8,E9t as C9,UW as CA,WYt as CB,qYt as CC,HYt as CD,snt as CE,ZOe as CF,hYt as CG,uYt as CH,Mi as CI,tnt as CJ,ZYt as CK,WZt as CL,Wet as CM,cr as CN,Qy as CO,ub as CP,AL as CQ,cb as CR,Yne as CS,C6 as CT,Te as CU,E as CV,yM as CW,mt as CX,It as CY,Hi as CZ,Bi as C_,C9t as Ca,Kri as Cb,Ire as Cc,p4 as Cd,aKe as Ce,S3 as Cf,E3 as Cg,iA as Ch,oKe as Ci,i8t as Cj,id as Ck,xzt as Cl,xat as Cm,i9t as Cn,x9 as Co,S9 as Cp,Ast as Cq,Aie as Cr,hTt as Cs,Bqt as Ct,Spi as Cu,$ni as Cv,gqe as Cw,Hpi as Cx,Gpi as Cy,tpe as Cz,Ykt as D,Bti as D$,wi as D0,aft as D1,GX as D2,Gne as D3,OB as D4,Di as D5,d6 as D6,Z3e as D7,zne as D8,F3e as D9,Ga as DA,SL as DB,o6 as DC,kKe as DD,LKe as DE,Coi as DF,hoi as DG,GK as DH,ERe as DI,VJt as DJ,jJt as DK,UJt as DL,bqt as DM,pc as DN,Fne as DO,Rne as DP,B8t as DQ,RS as DR,Uyt as DS,Rvt as DT,$v as DU,Va as DV,RB as DW,Un as DX,TL as DY,vP as DZ,LLe as D_,gM as Da,nft as Db,ws as Dc,Zm as Dd,Ko as De,ie as Df,n6 as Dg,xL as Dh,oft as Di,Dpt as Dj,$3e as Dk,$ft as Dl,a6 as Dm,xft as Dn,rWt as Do,NKe as Dp,lWt as Dq,dQt as Dr,aDe as Ds,Wne as Dt,$o as Du,Qne as Dv,yc as Dw,su as Dx,uw as Dy,EL as Dz,jn as E,$t as E$,Fft as E0,kfe as E1,Ld as E2,Nft as E3,Pft as E4,Rft as E5,vu as E6,wKt as E7,PS as E8,amt as E9,t7t as EA,$wt as EB,zse as EC,Bat as ED,bOe as EE,tJe as EF,mJe as EG,Fse as EH,cv as EI,vvt as EJ,gr as EK,Ho as EL,nM as EM,x6 as EN,jne as EO,wre as EP,ia as EQ,xpt as ER,Sg as ES,_De as ET,CL as EU,oo as EV,jmt as EW,dw as EX,gd as EY,Af as EZ,dt as E_,_6 as Ea,iS as Eb,bKt as Ec,ipt as Ed,Dd as Ee,fRe as Ef,e7t as Eg,FJt as Eh,yg as Ei,ure as Ej,QRe as Ek,Wb as El,$r as Em,kne as En,_Kt as Eo,Eft as Ep,Bne as Eq,sWt as Er,tui as Es,eui as Et,m_t as Eu,Coe as Ev,Iie as Ew,N_e as Ex,Nlt as Ey,SRe as Ez,e4t as F,DQt as F$,Mft as F0,Oft as F1,Ud as F2,vA as F3,SDe as F4,RKt as F5,ag as F6,IKt as F7,lr as F8,hw as F9,jPe as FA,Ka as FB,eu as FC,hu as FD,u5e as FE,_a as FF,DJt as FG,Dfe as FH,Vat as FI,fC as FJ,kXt as FK,tWt as FL,But as FM,jDe as FN,zut as FO,gfi as FP,eC as FQ,Uni as FR,PQt as FS,Aii as FT,Zsi as FU,Wsi as FV,pSt as FW,dSt as FX,Tut as FY,qm as FZ,ife as F_,a5e as Fa,KIt as Fb,Afe as Fc,zae as Fd,apt as Fe,Gy as Ff,Vh as Fg,FA as Fh,rBt as Fi,pH as Fj,cBt as Fk,pBt as Fl,yni as Fm,bXt as Fn,jqt as Fo,iSe as Fp,fli as Fq,Nqt as Fr,vni as Fs,oc as Ft,aw as Fu,tve as Fv,Lh as Fw,mw as Fx,uA as Fy,Npt as Fz,Lr as G,Hut as G$,hSt as G0,ene as G1,oSt as G2,omt as G3,OQt as G4,MLe as G5,hXt as G6,FKe as G7,hq as G8,Gsi as G9,tB as GA,qut as GB,j8t as GC,Ret as GD,dq as GE,Zft as GF,g6 as GG,soe as GH,v6 as GI,k$t as GJ,Hne as GK,Jne as GL,Pne as GM,wA as GN,T6 as GO,$pt as GP,E6 as GQ,bA as GR,Av as GS,Ct as GT,yf as GU,Fpt as GV,io as GW,aq as GX,$fe as GY,K3e as GZ,Gut as G_,dPe as Ga,spt as Gb,iht as Gc,jat as Gd,rfe as Ge,ppt as Gf,Vut as Gg,dT as Gh,Kdt as Gi,gXt as Gj,OAe as Gk,zdt as Gl,dKt as Gm,_Oe as Gn,jdt as Go,pgt as Gp,hgt as Gq,kp as Gr,eq as Gs,jsi as Gt,TXt as Gu,NQt as Gv,tXt as Gw,AXt as Gx,uft as Gy,ufe as Gz,U as H,Uut as H0,TPe as H1,IKe as H2,HJt as H3,A5 as H4,j3 as H5,Vsi as H6,ygt as H7,jLe as H8,Dei as H9,_9t as HA,w9t as HB,JM as HC,lXt as HD,Qpi as HE,Yk as HF,Zmi as HG,oBe as HH,Nle as HI,rgi as HJ,sgi as HK,ngi as HL,ogi as HM,BGt as HN,agi as HO,lgi as HP,ugi as HQ,hgi as HR,P6t as HS,dgi as HT,Lei as Ha,uii as Hb,Fei as Hc,BTt as Hd,wC as He,jK as Hf,QTt as Hg,jAe as Hh,oQe as Hi,Xni as Hj,LTt as Hk,NTt as Hl,Jni as Hm,HTt as Hn,FTt as Ho,uSt as Hp,Wni as Hq,Yni as Hr,Kei as Hs,IDe as Ht,syt as Hu,cg as Hv,HSe as Hw,Nei as Hx,hA as Hy,yii as Hz,$g as I,Wc as J,Ri as K,Hn as L,d3 as M,gt as N,fG as O,Ut as P,ve as Q,rw as R,jL as S,JLt as T,O6t as U,Tf as V,uH as W,Xle as X,YL as Y,tgi as Z,G as _,LNe as a,UNt as a$,FG as a0,er as a1,NGt as a2,pP as a3,dJt as a4,hJt as a5,ILt as a6,d4t as a7,c4t as a8,l4t as a9,J as aA,rT as aB,Pl as aC,Je as aD,ft as aE,Rm as aF,Ce as aG,BAe as aH,jre as aI,tT as aJ,nQe as aK,lM as aL,dC as aM,Eb as aN,HNt as aO,H as aP,Yt as aQ,cXt as aR,uXt as aS,Qct as aT,Pi as aU,ng as aV,Mt as aW,wXt as aX,zni as aY,tXe as aZ,xE as a_,sLt as aa,RLt as ab,Q_ as ac,Oi as ad,QJt as ae,MU as af,Eo as ag,_i as ah,KD as ai,x4t as aj,es as ak,UU as al,_e as am,Ii as an,Oe as ao,yn as ap,Rb as aq,xU as ar,cqt as as,Jc as at,ti as au,QR as av,lu as aw,jai as ax,Roe as ay,Sa as az,u as b,Fe as b$,df as b0,A7t as b1,mG as b2,$A as b3,ii as b4,_W as b5,GHt as b6,Sst as b7,eSe as b8,K9t as b9,kZe as bA,tw as bB,MD as bC,Vm as bD,LD as bE,HS as bF,y9t as bG,m9t as bH,g9t as bI,rg as bJ,GA as bK,_d as bL,boi as bM,f$e as bN,fd as bO,A3 as bP,Met as bQ,Oy as bR,eB as bS,jo as bT,AMe as bU,md as bV,qD as bW,Pt as bX,tu as bY,z$ as bZ,WS as b_,kx as ba,nh as bb,vn as bc,hi as bd,Hce as be,lP as bf,qLt as bg,KZ as bh,PD as bi,Pj as bj,JD as bk,rG as bl,A1t as bm,mr as bn,Bj as bo,F6 as bp,Ob as bq,to as br,as as bs,vc as bt,$ as bu,Ye as bv,Let as bw,Zet as bx,ne as by,se as bz,A as c,Gfi as c$,XJe as c0,eXt as c1,lze as c2,BMe as c3,t6 as c4,X as c5,Ol as c6,CG as c7,ee as c8,ni as c9,lme as cA,nJe as cB,$l as cC,T$e as cD,zd as cE,TSe as cF,lqt as cG,Lj as cH,BD as cI,p3 as cJ,f5t as cK,rh as cL,W6e as cM,D$ as cN,Sie as cO,Z6e as cP,cUe as cQ,dL as cR,Od as cS,iqt as cT,G6e as cU,hpe as cV,cB as cW,XYt as cX,fMt as cY,Qx as cZ,Bfi as c_,Ve as ca,wfi as cb,Sfi as cc,xfi as cd,fkt as ce,pkt as cf,eNt as cg,UD as ch,K6e as ci,Eie as cj,eHe as ck,tHe as cl,PQ as cm,Ele as cn,ote as co,x5t as cp,Cle as cq,H$ as cr,Ggt as cs,De as ct,xq as cu,os as cv,tti as cw,iti as cx,qe as cy,EB as cz,jm as d,bv as d$,jfi as d0,q as d1,Ffi as d2,b7t as d3,cOt as d4,vfi as d5,_fi as d6,_le as d7,NEe as d8,wYt as d9,uSe as dA,sd as dB,nOe as dC,hc as dD,PN as dE,Bie as dF,Uie as dG,wb as dH,Jj as dI,Gqt as dJ,UMe as dK,si as dL,Ox as dM,vEe as dN,nQ as dO,A8t as dP,Xa as dQ,gi as dR,Tt as dS,rt as dT,o9t as dU,P7e as dV,rKe as dW,u9t as dX,wYe as dY,tKe as dZ,WXe as d_,Dst as da,une as db,cze as dc,EJe as dd,CJe as de,kSt as df,BSt as dg,USt as dh,zSt as di,i5 as dj,Ta as dk,LU as dl,Ji as dm,Qo as dn,zD as dp,ta as dq,bi as dr,YA as ds,uu as dt,eJt as du,ZTt as dv,ki as dw,Js as dx,xf as dy,Gi as dz,Yc as e,vf as e$,RTt as e0,XA as e1,z6e as e2,XNt as e3,Ypi as e4,jpi as e5,tMe as e6,aP as e7,qY as e8,JNt as e9,Jae as eA,Y5e as eB,Bd as eC,z as eD,h6 as eE,lft as eF,rYe as eG,ch as eH,bWe as eI,nV as eJ,VRe as eK,Yi as eL,skt as eM,ab as eN,CHe as eO,sni as eP,Xfi as eQ,qhe as eR,Jfi as eS,xS as eT,a3 as eU,Er as eV,oWt as eW,Mni as eX,fh as eY,yv as eZ,bn as e_,Jpi as ea,Xpi as eb,St as ec,ON as ed,c9t as ee,l9t as ef,a9t as eg,uAe as eh,R7t as ei,P7t as ej,Fb as ek,get as el,Id as em,HWt as en,kCt as eo,zai as ep,J3t as eq,Wdi as er,dai as es,cD as et,imi as eu,iw as ev,Ss as ew,so as ex,VD as ey,Rr as ez,Vd as f,be as f$,gre as f0,Nd as f1,Uv as f2,vv as f3,Mo as f4,JW as f5,qs as f6,AU as f7,YW as f8,KW as f9,_L as fA,$a as fB,zn as fC,Qt as fD,Mse as fE,je as fF,cc as fG,yr as fH,tWe as fI,oh as fJ,di as fK,Bet as fL,ph as fM,Co as fN,voi as fO,ln as fP,SCe as fQ,Yp as fR,i7t as fS,PJt as fT,joe as fU,dM as fV,Nn as fW,qb as fX,Xr as fY,JJt as fZ,Gr as f_,xCe as fa,QX as fb,qdi as fc,gg as fd,fc as fe,w7t as ff,iKe as fg,Ydi as fh,_ri as fi,eD as fj,bri as fk,bf as fl,C3 as fm,ct as fn,ae as fo,j$ as fp,Oo as fq,I_ as fr,lt as fs,VLt as ft,ue as fu,Ar as fv,ar as fw,TS as fx,spe as fy,bYe as fz,he as g,IY as g$,GJt as g0,dA as g1,Ee as g2,kJt as g3,fe as g4,re as g5,oe as g6,Cr as g7,$Re as g8,tS as g9,yoi as gA,At as gB,Nt as gC,eGe as gD,rc as gE,GD as gF,fmi as gG,W4t as gH,dtt as gI,ptt as gJ,Z4t as gK,_st as gL,VZt as gM,GZt as gN,KYt as gO,og as gP,A7e as gQ,pf as gR,eM as gS,IQe as gT,OQe as gU,Ds as gV,vs as gW,oM as gX,emi as gY,pv as gZ,PH as g_,xd as ga,UG as gb,Lvt as gc,lOt as gd,BXt as ge,Gv as gf,v5 as gg,$gt as gh,Cd as gi,$6 as gj,Zei as gk,qei as gl,Wei as gm,s0t as gn,NJt as go,Sr as gp,cn as gq,Le as gr,xre as gs,m$e as gt,uT as gu,Fi as gv,Qn as gw,Loi as gx,Foi as gy,Noi as gz,rv as h,Tb as h$,qqt as h0,CAe as h1,aWt as h2,epi as h3,Rbe as h4,Kl as h5,zS as h6,eg as h7,vW as h8,o$e as h9,Hre as hA,FXe as hB,I7t as hC,_Tt as hD,bTt as hE,HD as hF,cke as hG,Sni as hH,xni as hI,SXe as hJ,gG as hK,nu as hL,ZXe as hM,N7t as hN,Xu as hO,L7t as hP,Mre as hQ,e6e as hR,jTe as hS,Cie as hT,SHe as hU,Tni as hV,iTt as hW,VO as hX,e3e as hY,Gn as hZ,tX as h_,gw as ha,PFt as hb,nH as hc,CNt as hd,$Nt as he,ANt as hf,Cpi as hg,iwe as hh,xtt as hi,SYe as hj,nJt as hk,pS as hl,afi as hm,D7t as hn,Pb as ho,P4t as hp,mmi as hq,kD as hr,iu as hs,e8t as ht,zKt as hu,_pt as hv,Jv as hw,Rut as hx,YTe as hy,eUe as hz,Gt as i,HGt as i$,Zc as i0,Hc as i1,Qje as i2,f8t as i3,CTe as i4,P$ as i5,_ie as i6,XD as i7,FEe as i8,X6e as i9,Eoi as iA,xoi as iB,Toi as iC,KLt as iD,fU as iE,xle as iF,kC as iG,pWe as iH,Hx as iI,ro as iJ,pZ as iK,td as iL,MMe as iM,nw as iN,Rd as iO,k0e as iP,D0e as iQ,Mqt as iR,V$ as iS,kri as iT,zle as iU,bte as iV,dB as iW,Vte as iX,Ke as iY,tBe as iZ,RGt as i_,sqt as ia,LMt as ib,RD as ic,Kte as id,dDt as ie,S4t as ig,XLt as ih,mh as ii,Qa as ij,_g as ik,nL as il,ZJe as im,qJe as io,UJe as ip,xl as iq,m5t as ir,jZ as is,wUe as it,Ml as iu,Ao as iv,ot as iw,KTe as ix,yOe as iy,vOe as iz,Ea as j,woi as j$,uVe as j0,Lle as j1,igi as j2,Ete as j3,vD as j4,dH as j5,FUt as j6,gBe as j7,zUt as j8,Ixe as j9,egi as jA,Tu as jB,cgi as jC,nCe as jD,TOt as jE,nni as jF,oni as jG,pWt as jH,zfi as jI,UHt as jJ,I$ as jK,aJe as jL,ySe as jM,u8t as jN,fqt as jO,BHt as jP,VHt as jQ,mqt as jR,sw as jS,p7t as jT,mg as jU,f7t as jV,d7t as jW,Cx as jX,g7t as jY,iv as jZ,oie as j_,Cte as ja,BUt as jb,P3 as jc,wBt as jd,Pp as je,t3 as jf,V_ as jg,ese as jh,bct as ji,Git as jj,vT as jk,uxe as jl,lVe as jm,Jle as jn,Yle as jo,VR as jp,XGt as jq,JV as jr,cH as js,Kmi as jt,ofi as ju,eqt as jv,aqt as jw,Jbe as jx,iWt as jy,uWt as jz,yh as k,xpi as k$,yGe as k0,r3 as k1,Rzt as k2,a8t as k3,bWt as k4,Qu as k5,jie as k6,Kbe as k7,ore as k8,cT as k9,El as kA,zXt as kB,xs as kC,Lb as kD,gs as kE,voe as kF,ff as kG,Dn as kH,hZ as kI,dD as kJ,Api as kK,Il as kL,T4t as kM,yFt as kN,m4t as kO,Mkt as kP,tH as kQ,cCe as kR,ys as kS,K as kT,YO as kU,qx as kV,Ci as kW,c8 as kX,Cre as kY,jLt as kZ,bmi as k_,Jte as ka,Xte as kb,ZHt as kc,mpt as kd,vKt as ke,kn as kf,fpt as kg,WHt as kh,M8e as ki,y3 as kj,Ylt as kk,vdt as kl,btt as km,pYt as kn,rQ as ko,sQ as kp,Zee as kq,U8t as kr,EYt as ks,b4 as kt,OZ as ku,K2 as kv,Wj as kw,Wqt as kx,qS as ky,Jo as kz,Cg as l,Fj as l$,efi as l0,O7t as l1,S7t as l2,C7t as l3,T7t as l4,$7t as l5,SS as l6,E7t as l7,M7t as l8,dc as l9,E1t as lA,Xje as lB,U4t as lC,Xk as lD,zj as lE,fg as lF,ZA as lG,Lie as lH,a8e as lI,Ua as lJ,xo as lK,yWe as lL,KR as lM,aue as lN,nqt as lO,wFt as lP,eLt as lQ,twe as lR,$z as lS,Epi as lT,lee as lU,aie as lV,APe as lW,ufi as lX,B4t as lY,zCt as lZ,Pii as l_,oXt as la,nXt as lb,xB as lc,foi as ld,mB as le,Kse as lf,Qse as lg,wEe as lh,uc as li,uM as lj,Ts as lk,cL as ll,qtt as lm,aL as ln,R$ as lo,Dt as lp,W6 as lq,Dnt as lr,C1t as ls,xqt as lt,Gp as lu,dlt as lv,Xo as lw,WJt as lx,PXt as ly,pA as lz,p as m,YLt as m$,xWe as m0,uZ as m1,IS as m2,Sne as m3,nZ as m4,nse as m5,iPe as m6,H8t as m7,nPe as m8,sT as m9,xA as mA,loe as mB,Sut as mC,Kx as mD,KHt as mE,QHt as mF,XHt as mG,z3 as mH,vL as mI,K_ as mJ,tg as mK,X3t as mL,$ke as mM,fS as mN,Qkt as mO,kLt as mP,Wkt as mQ,HLt as mR,f4t as mS,Qhe as mT,tAe as mU,rNt as mV,iH as mW,V7 as mX,qL as mY,vee as mZ,WL as m_,OU as ma,KA as mb,QA as mc,_Xt as md,G8t as me,_n as mf,eo as mg,qct as mh,Bn as mi,gc as mj,jb as mk,KJt as ml,Gj as mm,YG as mn,qU as mo,pni as mp,vCe as mq,ZSt as mr,zye as ms,jHt as mt,uni as mu,Td as mv,Ls as mw,Lm as mx,LJt as my,sct as mz,XS as n,nA as n$,wle as n0,t8t as n1,rA as n2,eWt as n3,Ske as n4,yue as n5,pUe as n6,bb as n7,U6e as n8,ig as n9,cJt as nA,lJt as nB,aJt as nC,uJt as nD,vd as nE,$Ie as nF,t4 as nG,gL as nH,Qdi as nI,Zze as nJ,tie as nK,GE as nL,Bze as nM,tFt as nN,lmi as nO,OFt as nP,Jkt as nQ,uUe as nR,IFt as nS,Lp as nT,lh as nU,tD as nV,$Ge as nW,iut as nX,rXt as nY,yXt as nZ,$3 as n_,Ed as na,gD as nb,mle as nc,iNt as nd,tNt as ne,wCe as nf,QLt as ng,moi as nh,kpi as ni,sA as nj,eb as nk,vYe as nl,Y3t as nm,gYe as nn,Qqt as no,gS as np,l2t as nq,no as nr,To as ns,ple as nt,zHe as nu,IHe as nv,aEe as nw,pL as nx,fL as ny,zy as nz,IL as o,mx as o$,bni as o0,Bt as o1,YWt as o2,RG as o3,ES as o4,DG as o5,wr as o6,PG as o7,gpe as o8,Tw as o9,fie as oA,wie as oB,zHt as oC,tr as oD,Ui as oE,JMe as oF,iL as oG,oPe as oH,BU as oI,OL as oJ,Jke as oK,Y as oL,xe as oM,o$t as oN,kdt as oO,Udt as oP,Bdt as oQ,Vdt as oR,Zni as oS,Koe as oT,kti as oU,NB as oV,YKt as oW,Al as oX,Uti as oY,zti as oZ,bs as o_,xa as oa,nv as ob,FMe as oc,Cm as od,kPe as oe,o3 as of,qo as og,r8t as oh,$m as oi,r7t as oj,e6 as ok,MKe as ol,e8e as om,U$ as on,u2t as oo,gni as op,Qp as oq,Zre as or,BJt as os,TRe as ot,fr as ou,FB as ov,yLe as ow,foe as ox,U3t as oy,nr as oz,Fle as p,dUe as p$,eh as p0,G$e as p1,Wt as p2,bo as p3,D2t as p4,_ct as p5,HB as p6,Hs as p7,ane as p8,Ooi as p9,STe as pA,or as pB,qA as pC,Qze as pD,dle as pE,Kv as pF,sui as pG,w4t as pH,mFt as pI,_Ft as pJ,Ize as pK,lle as pL,bV as pM,ZLt as pN,Xs as pO,TFt as pP,iFt as pQ,rFt as pR,oFt as pS,aFt as pT,vFt as pU,lFt as pV,cFt as pW,uFt as pX,hFt as pY,dFt as pZ,pFt as p_,fit as pa,mit as pb,oRe as pc,oCt as pd,vai as pe,rCt as pf,fOe as pg,V3 as ph,Fn as pi,WKt as pj,LMe as pk,kr as pl,mA as pm,lg as pn,Ane as po,sPe as pp,l3e as pq,u3e as pr,JKt as ps,M3e as pt,QDt as pu,ekt as pv,BLt as pw,sFt as px,fFt as py,gTe as pz,Os as q,Zri as q$,hfi as q0,uqt as q1,h6e as q2,Nri as q3,Hdi as q4,rm as q5,sqe as q6,Oqt as q7,fEe as q8,LFt as q9,sJe as qA,Lat as qB,kui as qC,Ys as qD,zIt as qE,Cft as qF,Ln as qG,Kr as qH,Bui as qI,l6 as qJ,gii as qK,g3e as qL,Mne as qM,$ne as qN,Sqt as qO,IU as qP,wqt as qQ,UHe as qR,gT as qS,Lri as qT,Vri as qU,qri as qV,O1t as qW,k6 as qX,Hri as qY,Yri as qZ,Gri as q_,Kve as qa,rpe as qb,oYt as qc,nYt as qd,sYt as qe,rYt as qf,lYt as qg,aYt as qh,iYt as qi,tYt as qj,Nie as qk,UH as ql,YSt as qm,MAe as qn,mhe as qo,FCt as qp,Put as qq,p6 as qr,Roi as qs,fJt as qt,mJt as qu,dat as qv,XTe as qw,lL as qx,aT as qy,uh as qz,x3t as r,eMt as r$,jri as r0,Wri as r1,Jri as r2,Xri as r3,Ub as r4,Pm as r5,c2t as r6,Kci as r7,Ase as r8,FXt as r9,dXe as rA,Jnt as rB,iqe as rC,Eze as rD,ZK as rE,uit as rF,aQ as rG,q_ as rH,e$t as rI,t$t as rJ,lw as rK,WA as rL,lT as rM,yri as rN,Cv as rO,on as rP,kse as rQ,Pd as rR,Ise as rS,QYe as rT,an as rU,Ztt as rV,eYt as rW,I3 as rX,dMt as rY,VAt as rZ,oMt as r_,mMt as ra,O as rb,Q6e as rc,GSe as rd,M8t as re,cfi as rf,lfi as rg,Gze as rh,Vze as ri,d4 as rj,Ani as rk,rke as rl,ake as rm,nke as rn,wni as ro,kye as rp,Oni as rq,s8e as rr,h8e as rs,lke as rt,jD as ru,$qt as rv,GPe as rw,By as rx,Gce as ry,E8t as rz,E3t as s,mni as s$,sMt as s0,jli as s1,GAt as s2,gMt as s3,iQ as s4,ici as s5,Qve as s6,GNt as s7,Ja as s8,nT as s9,Hct as sA,WJ as sB,flt as sC,Lse as sD,wf as sE,hri as sF,xEe as sG,Ese as sH,ea as sI,OS as sJ,Tke as sK,goi as sL,sL as sM,eT as sN,qoi as sO,w3 as sP,l8t as sQ,nb as sR,m7t as sS,efe as sT,aut as sU,rni as sV,DEe as sW,x8e as sX,Pqt as sY,bG as sZ,Kc as s_,Zb as sa,sme as sb,cie as sc,D8t as sd,P8t as se,Cni as sf,Eni as sg,PGe as sh,RGe as si,Fqt as sj,QYt as sk,pqt as sl,oT as sm,mL as sn,ei as so,Ev as sp,yJt as sq,Yo as sr,umi as ss,Bb as st,Mfe as su,vXt as sv,jct as sw,tPe as sx,Wct as sy,YOt as sz,ge as t,lci as t$,lPe as t0,WSt as t1,Vnt as t2,SZe as t3,YVe as t4,tqt as t5,b6e as t6,Vj as t7,oqt as t8,Gm as t9,US as tA,CFt as tB,nfi as tC,sfi as tD,Soi as tE,qwe as tF,Mb as tG,X$ as tH,h4t as tI,ipe as tJ,_Ee as tK,Wtt as tL,tne as tM,HSt as tN,ani as tO,VSt as tP,lni as tQ,cni as tR,oB as tS,gYt as tT,fYt as tU,mYt as tV,Pst as tW,Upi as tX,Bpi as tY,zpi as tZ,Vi as t_,ont as ta,lnt as tb,cnt as tc,uzt as td,hqt as te,wv as tf,Ib as tg,i6e as th,$1t as ti,rd as tj,zst as tk,xM as tl,vYt as tm,bYt as tn,W_ as to,Wp as tp,dV as tq,_Yt as tr,Kpi as ts,Dri as tt,zri as tu,Uri as tv,cEe as tw,Ilt as tx,ORe as ty,wit as tz,$e as u,M3 as u$,$f as u0,TTe as u1,eJe as u2,sRe as u3,sne as u4,Ku as u5,h3e as u6,c3e as u7,c6 as u8,Cne as u9,OMe as uA,V8t as uB,rqt as uC,jSe as uD,dKe as uE,t6e as uF,qCe as uG,rSe as uH,$Te as uI,Q8t as uJ,JTe as uK,Kce as uL,PTe as uM,Cke as uN,r2t as uO,_oi as uP,kHe as uQ,ltt as uR,Xre as uS,rs as uT,Kht as uU,zht as uV,b8e as uW,Iqt as uX,CYt as uY,s8t as uZ,eOe as u_,Ine as ua,Ene as ub,Zt as uc,qHt as ud,Qxe as ue,HHt as uf,yne as ug,zJt as uh,bne as ui,Tne as uj,Wlt as uk,L3 as ul,Tg as um,bg as un,kre as uo,DKe as up,uti as uq,qr as ur,cu as us,yi as ut,vei as uu,Ppt as uv,jOe as uw,Bst as ux,Mti as uy,fn as uz,ce as v,_B as v$,Yre as v0,_7t as v1,kz as v2,NMe as v3,Kre as v4,Jet as v5,MG as v6,$he as v7,wOt as v8,BL as v9,_v as vA,bit as vB,Dni as vC,wo as vD,wa as vE,Boi as vF,zLe as vG,j_ as vH,Kh as vI,Bk as vJ,_ni as vK,ghe as vL,dni as vM,cSt as vN,xG as vO,Vpi as vP,PTt as vQ,Vb as vR,QG as vS,lv as vT,wke as vU,Yse as vV,hle as vW,mNt as vX,aA as vY,YJt as vZ,d2t as v_,XKe as va,hWt as vb,v7t as vc,YS as vd,jp as ve,fXe as vf,q8t as vg,Q7t as vh,OKe as vi,yie as vj,oJe as vk,v$e as vl,Fit as vm,Qei as vn,Yv as vo,$se as vp,Dut as vq,eti as vr,zei as vs,IAe as vt,ITt as vu,ESt as vv,SSt as vw,xut as vx,Iei as vy,Oei as vz,pi as w,Vli as w$,Ba as w0,o2t as w1,Uqt as w2,zqt as w3,Jci as w4,rui as w5,vde as w6,gde as w7,s2t as w8,VXt as w9,Uht as wA,tci as wB,Yci as wC,xOt as wD,GM as wE,Dy as wF,oci as wG,nci as wH,sci as wI,rci as wJ,sp as wK,_qt as wL,vqt as wM,lA as wN,nqe as wO,_f as wP,Ovt as wQ,Qte as wR,NWt as wS,jRt as wT,H3 as wU,WEe as wV,eCe as wW,Ytt as wX,Xli as wY,Iae as wZ,pV as w_,jXt as wa,yde as wb,g$e as wc,Eht as wd,Qci as we,Dae as wf,K$ as wg,UXt as wh,cfe as wi,Xci as wj,n9t as wk,dqt as wl,bAe as wm,Mpi as wn,Yze as wo,Nb as wp,MLt as wq,zLt as wr,ULt as ws,OLt as wt,GLt as wu,Lkt as wv,Kkt as ww,TE as wx,Jht as wy,Dat as wz,Eg as x,LFe as x$,Yli as x0,C4e as x1,Kli as x2,Jli as x3,sc as x4,cQ as x5,uQ as x6,lQ as x7,eci as x8,Hli as x9,Xqt as xA,$8t as xB,zB as xC,m3 as xD,kb as xE,sXt as xF,WDe as xG,qDe as xH,pXt as xI,t3e as xJ,Hat as xK,hb as xL,Im as xM,TJ as xN,N2t as xO,wve as xP,nNt as xQ,Aht as xR,VPe as xS,GPt as xT,dYt as xU,dpe as xV,XZt as xW,bat as xX,PFe as xY,Qr as xZ,IG as x_,Wli as xa,aSe as xb,WVe as xc,Tfe as xd,Aoi as xe,dae as xf,rk as xg,xLe as xh,v9t as xi,MS as xj,$Xt as xk,ss as xl,od as xm,_Pe as xn,bPe as xo,xXt as xp,ja as xq,Hm as xr,_vt as xs,zTe as xt,BRe as xu,AS as xv,nct as xw,iui as xx,ZKt as xy,EOt as xz,Ya as y,wWt as y$,NFe as y0,ZMe as y1,XMe as y2,$tt as y3,JWt as y4,Ntt as y5,Vn as y6,XWt as y7,EM as y8,nle as y9,mc as yA,LPe as yB,Qut as yC,Tht as yD,cWt as yE,SXt as yF,wD as yG,Xmi as yH,HUe as yI,Tte as yJ,LA as yK,cBe as yL,EBt as yM,Ope as yN,cUt as yO,Qmi as yP,Jmi as yQ,hH as yR,uUt as yS,OIe as yT,Mx as yU,TG as yV,rre as yW,C8t as yX,lMe as yY,JHt as yZ,YMe as y_,hNt as ya,uNt as yb,rH as yc,Oze as yd,vut as ye,wPe as yf,SV as yg,$ze as yh,NP as yi,Bri as yj,XSe as yk,Cet as yl,$et as ym,HG as yn,Fet as yo,VG as yp,$S as yq,Het as yr,AG as ys,Dse as yt,Sb as yu,qJt as yv,vB as yw,vlt as yx,Rqt as yy,yT as yz,xr as z,Zdi as z$,xWt as z0,SWt as z1,Bm as z2,Odi as z3,Xet as z4,ype as z5,YOe as z6,IYt as z7,RYt as z8,PYt as z9,mf as zA,wS as zB,Ini as zC,LYt as zD,BOe as zE,vZe as zF,Bnt as zG,F7t as zH,vNt as zI,p1e as zJ,qmi as zK,Aqt as zL,Qli as zM,hV as zN,Ufi as zO,FYt as zP,NYt as zQ,YZt as zR,JZt as zS,t0e as zT,T9t as zU,Vqt as zV,htt as zW,J9t as zX,X9t as zY,Y9t as zZ,Z9t as z_,DYt as za,vTt as zb,ant as zc,YYe as zd,s6 as ze,n7t as zf,cse as zg,iXt as zh,j8 as zi,o7t as zj,rB as zk,ZJt as zl,ult as zm,Qlt as zn,q$ as zo,Hlt as zp,qse as zq,wRe as zr,Md as zs,IMe as zt,Zxt as zu,nSt as zv,zKe as zw,Rni as zx,Dv as zy,Lv as zz};
