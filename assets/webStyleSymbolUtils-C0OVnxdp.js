import{c as A,a as S}from"./devEnvironmentUtils-CnNDiFMM.js";import{bc as D,ap as u,H as c,e0 as C,e1 as w,e2 as v,e3 as F,e4 as O,e5 as P,e6 as H,e7 as N,e8 as U,e9 as M,ea as R,eb as W}from"./index-CfYeSufM.js";function J(t,e,a){const l=t.name;return l==null?Promise.reject(new c("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):t.styleName==="Esri2DPointSymbolsStyle"?z(l,e,a):M(t,e,a).then(n=>q(n,l,e,R,a))}function k(t,e){return e.items.find(a=>a.name===t)}async function q(t,e,a,l,n){var h,g;const o=(a==null?void 0:a.portal)!=null?a.portal:D.getDefault(),r={portal:o,url:u(t.baseUrl)},m=k(e,t.data);if(!m)throw new c("symbolstyleutils:symbol-name-not-found",`The symbol name '${e}' could not be found`,{symbolName:e});const b=(n==null?void 0:n.acceptedFormats)??C,p=l(m,b);if(!p)throw new c("symbolstyleutils:symbol-reference-no-accepted-format",`The symbol name '${e}' does not have an accepted format (one of ${b})`,{symbolName:e});const{url:T,format:E}=p;let i=w(T,r),y=((h=m.thumbnail)==null?void 0:h.href)??null;const f=(g=m.thumbnail)==null?void 0:g.imageData;A()&&(i=S(i)??"",y=S(y));const I={portal:o,url:u(v(i)),origin:"portal-item"};return F(i,n).then(d=>{const $=E==="cim"?O(d.data):d.data,s=P($,I);if(s&&H(s)){if(y){const x=w(y,r);s.thumbnail=new N({url:x})}else f&&(s.thumbnail=new N({url:`data:image/png;base64,${f}`}));t.styleUrl?s.styleOrigin=new U({portal:a.portal,styleUrl:t.styleUrl,name:e}):t.styleName&&(s.styleOrigin=new U({portal:a.portal,styleName:t.styleName,name:e}))}return s})}function z(t,e,a){const l=W.replaceAll(/\{SymbolName\}/gi,t),n=e.portal!=null?e.portal:D.getDefault();return F(l,a).then(o=>{const r=O(o.data);return P(r,{portal:n,url:u(v(l)),origin:"portal-item"})})}export{q as fetchSymbolFromStyle,k as getStyleItemFromStyle,J as resolveWebStyleSymbol};
