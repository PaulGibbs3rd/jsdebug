const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/editingTools-Ch-vsZhH.js","assets/index-CfYeSufM.js","assets/SnappingVisualizer2D-BlNHuATY.js","assets/SnappingManager-uFSx-TIH.js","assets/keybindings-CtvTi62R.js","assets/geodesicUtils-AyGMpq1K.js","assets/geometry2dUtils-BECZf0GS.js","assets/viewUtils-D24sG8PY.js","assets/SnappingVisualizer-yY-u8LGd.js","assets/PointSnappingHint-DFT7U_tQ.js","assets/editPlaneUtils-CZLCDjdA.js","assets/SketchTooltipInfo-nGjeMflC.js","assets/MeshTransform-CpEmJDpm.js","assets/memoize-DmxaQ-k8.js","assets/quantityFormatUtils-D4QC4M5H.js","assets/angularMeasurementUtils-qlhFG6W2.js","assets/directionModeIcons-H3VlGLqc.js","assets/ReactiveSet-CYtgD1tN.js","assets/dehydratedFeatureComparison-Cqp8Y6mL.js","assets/EditGeometryOperations-wQHypEHr.js","assets/InteractiveToolBase-XZur83Y0.js","assets/SketchOptions-_RdOU_mt.js","assets/SnappingOperation-DKQngwsY.js","assets/geometryEngine-DZQmjC3o.js","assets/geometryEngineBase-B0ZyeKAX.js","assets/_commonjsHelpers-DCkdB7M8.js","assets/hydrated-8eZrnzf3.js","assets/GraphicsLayer-C8-bjLvb.js","assets/automaticAreaMeasurementUtils-D2fbyRWB.js","assets/geodesicLengthMeasurementUtils-BMbcKd8T.js","assets/euclideanAreaMeasurementUtils-Bq7qOqGe.js","assets/automaticLengthMeasurementUtils-Bwa3LUxz.js","assets/cimSymbolUtils-Bu2r_l8n.js","assets/GraphicManipulator--7x_0vOG.js","assets/drapedUtils-DkjinvLd.js","assets/drawUtils-zB07QfdF.js","assets/editingTools-DsOcydN7.js","assets/TextOverlayItem-qJgBhmzl.js","assets/VerticesVisualElement-BXsfgcDz.js","assets/ExtendedLineVisualElement-CBfpCsiY.js","assets/EngineVisualElement-Djb2vZdf.js","assets/LineVisualElement-BWm41HKU.js","assets/line-fv3IcO5w.js","assets/LaserlinePath.glsl-TLzB8BAx.js","assets/RightAngleQuadVisualElement-COFJ4VQS.js","assets/ColorMaterial.glsl-CJmBIFgr.js","assets/TriangleMaterial-hfPtYTfz.js","assets/ShadedColorMaterial.glsl-r6VhJShH.js","assets/interfaces-BMKdHaUK.js","assets/MoveManipulation-BPIm28RV.js","assets/dragEventPipeline3D-DEevdCQY.js","assets/lineStippleUtils-C89mzWlO.js","assets/manipulatorUtils-BqSExnaA.js","assets/SelectedVertexTooltipInfo-4uoF0jK_.js","assets/TranslateTooltipInfo-rvsDjyyV.js","assets/utils-L9BGy6Hj.js","assets/SlicePlaneMaterial.glsl-BbzkiuB_.js","assets/sliceToolConfig-DVyCZsWF.js","assets/ImageMaterial.glsl-CTuPf0ue.js","assets/DefaultLayouts-DCPHPEww.js","assets/persistable-m7kW6qgj.js","assets/resourceExtension-bESjAEBg.js","assets/Factory-KRWEugbI.js","assets/ExtentScaleTooltipInfo-BrzFZOe2.js","assets/GraphicsLayerView3D-CDDjdQB5.js","assets/LayerView3D-D9EaTEMQ.js","assets/queryForSymbologySnapping-BkLDyReP.js","assets/GraphicsProcessor-BxMyfHFl.js","assets/ExtentSet-pIH4MlfY.js","assets/rendererConversion-BFQl1ElB.js","assets/optimizedFeatureQueryEngineAdapter-HsAI-PQN.js","assets/PooledRBush-pKd6bsUR.js","assets/popupUtils-DB8vJbLy.js","assets/Graphics3DObjectStates-H05F6leY.js","assets/highlightUtils-LdbT_5Gd.js","assets/projectExtentUtils-BOQDrrn9.js","assets/geometryServiceUtils-D_K144mp.js","assets/LayerView-Ck8FMSD2.js","assets/GraphicMover-DhoMgT58.js","assets/featureUtils-BoL5pG_W.js","assets/utils-BhrB4brX.js","assets/Box-BcG0xZ-C.js","assets/settings-DytjC6KO.js","assets/Reshape-B-TFuJkw.js"])))=>i.map(i=>d[i]);
import{sK as lt,nh as ht,sL as ct,ew as st,mt as dt,b as y,m as g,c as L,h as ut,ik as N,aB as yt,ii as gt,sM as vt,aG as W,sN as mt,ex as Z,aP as H,aW as V,u as D,_ as S,e_ as _t,fe as F,dr as q,bs as ft,aw as bt,f2 as wt,f3 as Ot,f1 as Gt,sO as Et,sP as Tt,fH as St,bD as w,q5 as Y,sQ as A,iR as z,aA as At,H as Mt,em as B,j_ as Ct,eU as Q,sR as k}from"./index-CfYeSufM.js";import kt from"./GraphicsLayer-C8-bjLvb.js";import{P as E,l as rt,r as Rt,E as J,c as Ht,a as Dt,b as It}from"./SketchOptions-_RdOU_mt.js";import{p as _}from"./keybindings-CtvTi62R.js";import{q as nt,I as X,H as Pt}from"./SnappingManager-uFSx-TIH.js";function Ut(t){return xt(t).result}function xt(t){var a;if(t.graphic&&((a=t.graphic.layer)==null?void 0:a.type)!=="graphics")return{result:E.GRAPHICS_LAYER_MISSING};if(!t.operations)return{result:E.GEOMETRY_MISSING};if(lt(t.elevationInfo))return{result:E.ELEVATION_MODE_UNSUPPORTED};const e=t.operations.data.type,o=t.operations.data.geometry;return e==="point"||e==="mesh"||e==="polyline"||e==="polygon"?{result:E.SUPPORTED,geometry:o}:{result:E.GEOMETRY_TYPE_UNSUPPORTED}}function Lt(t){var o;if(((o=t.layer)==null?void 0:o.type)!=="graphics")return E.GRAPHICS_LAYER_MISSING;if(t.geometry==null)return E.GEOMETRY_MISSING;switch(t.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return E.SUPPORTED;default:return E.GEOMETRY_TYPE_UNSUPPORTED}const e=t.symbol!=null&&t.symbol.type==="point-3d"&&t.symbol.symbolLayers;return!e||!e.some(a=>a.type==="object")?E.SYMBOL_TYPE_UNSUPPORTED:ht(t)!=="on-the-ground"&&ct(t)?E.ELEVATION_MODE_UNSUPPORTED:E.SUPPORTED}function tt(t,e,o){if(!e||!(t!=null&&t.map))return;const{map:a}=t;a.layers.find(s=>s===e)||a.add(e,o)}function Yt(t,e){const o=(e==null?void 0:e.type)==="subtype-sublayer"?e.parent:e;return t.allLayerViews.find(a=>{const i=a.layer;return i===o||"sublayers"in i&&i.sublayers!=null&&i.sublayers.includes(o)})}let G=class extends st.EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:dt(this.activeComponent)}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){var e;(e=this.activeComponent)==null||e.reset()}refreshComponent(){const e=this.activeComponent;e&&(e.type!=="box"&&e.type!=="reshape"&&e.type!=="graphic-mover"||e.refresh())}set undo(e){this._set("undo",()=>{this.canUndo()&&e()})}set redo(e){this._set("redo",()=>{this.canRedo()&&e()})}};y([g()],G.prototype,"activeComponent",void 0),y([g()],G.prototype,"cancelled",void 0),y([g()],G.prototype,"history",void 0),y([g()],G.prototype,"tool",null),y([g()],G.prototype,"type",void 0),y([g()],G.prototype,"canUndo",null),y([g()],G.prototype,"canRedo",null),y([g()],G.prototype,"onEnd",void 0),y([g()],G.prototype,"undo",null),y([g()],G.prototype,"redo",null),y([g()],G.prototype,"toggleTool",void 0),y([g()],G.prototype,"addToSelection",void 0),y([g()],G.prototype,"removeFromSelection",void 0),G=y([L("esri.widgets.Sketch.support.OperationHandle")],G);let x=class extends G{};y([g()],x.prototype,"activeComponent",void 0),x=y([L("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],x);let M=class extends G{};y([g()],M.prototype,"activeComponent",void 0),M=y([L("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],M);function Vt(t,e){return e==="freehandPolygon"||e==="freehandPolyline"?"freehand":t??(e==="rectangle"||e==="circle"?"hybrid":"click")}function Ft(t){switch(t){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";default:return t}}var et;(function(t){t[t.ForceCollapse=-1]="ForceCollapse",t[t.Low=0]="Low",t[t.Medium=10]="Medium",t[t.High=100]="High",t[t.Max=1e3]="Max"})(et||(et={}));const ot={defaultZ:0},R={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0},tool:"transform"};let m=class extends st.EventedAccessor{constructor(t){var e;super(t),this._defaultSnappingManager=null,this._updatingHandles=new ut,this._internalGraphicsLayer=new kt({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new N({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new yt({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new gt({color:[130,130,130,1],width:2}),this.meshSymbol=new vt({symbolLayers:new W([new mt])}),this.updateGraphics=new W,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new N({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new rt,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._originalPopupEnabled=null,this.defaultCreateOptions=ot,this.defaultUpdateOptions=R,this.snappingOptions=((e=t==null?void 0:t.snappingManager)==null?void 0:e.options)??(t==null?void 0:t.snappingOptions)??new nt}initialize(){this.addHandles([Z(()=>{var t,e;return(e=(t=this.view)==null?void 0:t.map)==null?void 0:e.layers},"change",t=>{t.removed.includes(this.layer)&&this.cancel()}),Z(()=>{var t;return(t=this.layer)==null?void 0:t.graphics},"change",t=>{if(this._operationHandle!=null)for(const e of t.removed)this.updateGraphics.includes(e)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(e):this._operationHandle.cancel())}),H(()=>{var t;return((t=this.layer)==null?void 0:t.elevationInfo)??null},t=>{t!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=t)},V),H(()=>this.view,t=>{this._defaultSnappingManager=D(this._defaultSnappingManager),t&&(this.snappingManager||(this._defaultSnappingManager=new X({view:t,options:this.snappingOptions})),t.type==="2d"?S(()=>import("./editingTools-Ch-vsZhH.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35])):t.type==="3d"&&(S(()=>import("./editingTools-DsOcydN7.js"),__vite__mapDeps([36,1,7,14,37,31,29,23,24,25,26,5,38,39,40,41,42,43,44,45,46,3,4,6,8,9,47,48,49,50,20,19,51,10,11,12,13,15,16,17,18,21,22,27,28,30,52,53,54,55,32,56,57,58,59,60,61,62,63,33,34])),S(()=>import("./GraphicsLayerView3D-CDDjdQB5.js"),__vite__mapDeps([64,1,65,66,67,68,69,70,71,72,73,74,75,76,77]))))},V),H(()=>{var t;return(t=this.view)==null?void 0:t.spatialReference},(t,e)=>{t&&e&&!t.equals(e)&&this.cancel()})]),Pt(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=D(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get updating(){return this._updatingHandles.updating||this.snappingManager!=null&&this.snappingManager.updating}get activeTool(){var t;return((t=this._operationHandle)==null?void 0:t.tool)??null}get activeCreateToolDrawMode(){var t;return((t=this._operationHandle)==null?void 0:t.type)==="create"&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){const{activeComponent:t,destroyed:e}=this,o=!e&&t&&"tooltip"in t?t.tooltip:null;return o!=null&&o.visible?o:null}get activeComponent(){var t;return((t=this._operationHandle)==null?void 0:t.activeComponent)??null}get createGraphic(){return this.activeComponent==null||this.activeComponent.type!=="draw-3d"&&this.activeComponent.type!=="draw-2d"?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(t){this._set("defaultCreateOptions",{...ot,...t})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(t){this._set("defaultUpdateOptions",{...R,...t,reshapeOptions:{...R.reshapeOptions,...t==null?void 0:t.reshapeOptions},highlightOptions:{...R.highlightOptions,...t==null?void 0:t.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(t){this.sketchOptions.labels=t}get snappingOptions(){var t;return((t=this.snappingManager)==null?void 0:t.options)??this._get("snappingOptions")}set snappingOptions(t){this._defaultSnappingManager!=null&&(this._defaultSnappingManager.options=t),this._set("snappingOptions",t)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(t){if(t)this._isOverridden("snappingManager")||(this._defaultSnappingManager=D(this._defaultSnappingManager)),this._override("snappingManager",t);else{const{view:e}=this;!this._defaultSnappingManager&&e&&(this._defaultSnappingManager=new X({options:this.snappingOptions,view:e})),this._clearOverride("snappingManager")}}get state(){var o;const t=!(!((o=this.view)!=null&&o.ready)||!this.layer),e=this._operationHandle;return t&&e?"active":t?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(t){this.sketchOptions.tooltips=t}get valueOptions(){return this.sketchOptions.values}set valueOptions(t){this.sketchOptions.values=t}get view(){return this._get("view")}set view(t){const e=this._get("view");if(e){const{container:a,map:i}=e;a&&(e.cursor=null),i==null||i.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const o="view-ready";this.removeHandles(o),t&&this.addHandles(_t(()=>t.ready,a=>{this.removeHandles(this._viewHandlesKey),a&&this.addHandles(this._generateViewHandles(t),this._viewHandlesKey)},V),o),this._set("view",t)}cancel(){this._moduleLoaderAbortController=F(this._moduleLoaderAbortController),this._viewReadyAbortController=F(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:t,updateGraphics:e}=this;if(t==="active"&&e.length){const{activeTool:o,layer:a}=this,i=e.toArray();a.removeMany(i),this.cancel(),this._emitDeleteEvent({graphics:i,tool:o})}}duplicate(){if(this.state==="active"&&this.updateGraphics.length){const t=this.updateGraphics.map(e=>e.clone()).toArray();return this.layer.addMany(t),this.emit("duplicate",{graphics:t,type:"duplicate"}),t}return[]}async create(t,e){this.cancel(),await this._waitViewReady();const{view:o,layer:a}=this;if(!o||this.state==="disabled")throw a||this._logMissingLayer(),q();if(o.activeTool!=null&&(o.activeTool=null),!t)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");tt(o,this._internalGraphicsLayer);const i=await this._updatingHandles.addPromise(this._setupCreateOperation(t,e));if(i==null||this.destroyed)return void o.map.remove(this._internalGraphicsLayer);const s=()=>{var c;if(i===this._operationHandle){const r=this.createGraphic,h=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),(c=this.view)!=null&&c.map&&this.view.map.remove(this._internalGraphicsLayer),i.cancelled||r==null||a.add(r),this._sketchContinuationFlag=!1,this.emit("create",{graphic:r,state:h?"cancel":"complete",tool:t,toolEventInfo:null,type:"create"}),h||this._sketchContinuationFlag)return;const{creationMode:n}=this;if(n==="continuous"){if(e!=null&&e.geometryToPlace)return;this._updatingHandles.addPromise(Q(this.create(t,e)))}else n==="update"&&r&&this._updatingHandles.addPromise(Q(this.update([r])))}};i.on("complete",s),this._operationHandle=i,o.ready&&o.focus()}async place(t,e){return this.create("mesh",{mode:"click",hasZ:t.hasZ,geometryToPlace:t,...e})}async update(t,e){this.cancel(),await this._waitViewReady();const{layer:o,view:a,state:i}=this;if(!a||i==="disabled")throw o||this._logMissingLayer(),q();a.activeTool!=null&&(a.activeTool=null);const s=Array.isArray(t)?t:[t];if(t==null||!(s!=null&&s.length))return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(s.some(r=>r.layer!==o?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):r.geometry==null&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0)))return;const c=await this._updatingHandles.addPromise(this._setupUpdateOperation(s,e));this.destroyed||c==null||b(c)||(tt(a,this._internalGraphicsLayer),this._setUpdateOperationHandle(c,e),this.emit("update",{graphics:s,state:"start",aborted:!1,tool:c.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(t){const e=this.view;if(e){t=Array.isArray(t)?t:[t];for(const o of t)o.geometry==null||o.geometry.type==="mesh"||ft(o.geometry.spatialReference,e.spatialReference)||(bt(o.geometry.spatialReference,e.spatialReference)||wt()||await Ot(),o.geometry=Gt(o.geometry,e.spatialReference))}else this._logMissingView()}undo(){var t;this.canUndo()&&((t=this._operationHandle)==null||t.undo())}redo(){var t;this.canRedo()&&((t=this._operationHandle)==null||t.redo())}canUndo(){var t;return!!((t=this._operationHandle)!=null&&t.canUndo())}canRedo(){var t;return!!((t=this._operationHandle)!=null&&t.canRedo())}toggleUpdateTool(){var t;(t=this._operationHandle)==null||t.toggleTool()}async _getFirstHit(t){const e=this.view;if(!e)return this._logMissingView(),null;if(e.type==="2d"){const i=[];e.map.allLayers.forEach(c=>{c.type!=="vector-tile"&&c.type!=="imagery"||i.push(c)});const s=await e.hitTest(t,{exclude:i});return Et(s.results)}const o=[e.map.ground];e.map.allLayers.forEach(i=>{Tt(i.type)&&o.push(i)});const a=await e.hitTest(t,{exclude:o});if(a.results.length>0){const i=a.results[0];if(i!=null&&i.type==="graphic"&&i.graphic&&(!a.ground.mapPoint||e.map.ground.opacity<1||a.ground.distance-(i.distance??0)>-Math.min(3*a.ground.distance,e.viewingMode==="global"?St(e.renderCoordsHelper.spatialReference).radius/e.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return i}return null}_generateViewHandles(t){return[t.on("immediate-click",async e=>{var a;const o=this.state==="active"&&((a=this._operationHandle)==null?void 0:a.type)==="create";this.state!=="disabled"&&!o&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(e))},w.WIDGET)]}async _handleImmediateClick(t){var a;const e=await t.async(()=>this._getFirstHit(Y(t)));let o=null;if(e!=null){const i=e.graphic;this.updateGraphics.includes(i)||i.layer===this.layer?(t.stopPropagation(),o=i):((a=this.view)==null?void 0:a.type)!=="2d"||this._isComponentGraphic(i)||this.state!=="active"||this.cancel()}else this.state==="active"&&this.cancel();o==null||this.updateGraphics.includes(o)||await this.update([o],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}})}async _setupCreateOperation(t,e){const o=this.view;if(!o)return this._logMissingView(),null;const a={hasZ:o.type==="3d",...this.defaultCreateOptions,...e},i=await this._setupDrawGraphicTool(t,o,a);return i==null?null:(o.tools.add(i),o.activeTool=i,this._setupCreateOperationHandle(i))}async _setupDrawGraphicTool(t,e,o){var O;if(t==="multipoint"&&e.type==="3d")return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!e)return this._logMissingView(),null;const{cursor:a,defaultZ:i,hasZ:s,geometryToPlace:c,graphicProperties:r,mode:h,preserveAspectRatio:n}=o,l=Vt(h,t),p=Ft(t),v=(O=o==null?void 0:o.optionsPerTool)!=null&&O.has(t)?o.optionsPerTool.get(t):{},u=(v==null?void 0:v.preserveAspectRatio)??n??t!=="rectangle",d={centered:t!=="rectangle"&&!(t==="circle"&&!u),cursor:a,defaultZ:i,forceUniformSize:u,graphicProperties:{...r,attributes:{...r==null?void 0:r.attributes}},geometryToPlace:c,geometryType:p,mode:l,graphicSymbol:this._getGraphicSymbolFromTool(t),hasZ:s,snappingManager:this.snappingManager,snapToScene:!1,view:e,...v};return e.type==="2d"?this._makeDrawGraphicTool2D(d):this._makeDrawGraphicTool3D(d)}async _makeDrawGraphicTool2D(t){const e=await this._requireModule(S(()=>import("./editingTools-Ch-vsZhH.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35])));return b(e)||this.destroyed?null:new e.module.DrawGraphicTool2D({...t,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:Kt(t.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions})}async _makeDrawGraphicTool3D(t){const e=await this._requireModule(S(()=>import("./editingTools-DsOcydN7.js"),__vite__mapDeps([36,1,7,14,37,31,29,23,24,25,26,5,38,39,40,41,42,43,44,45,46,3,4,6,8,9,47,48,49,50,20,19,51,10,11,12,13,15,16,17,18,21,22,27,28,30,52,53,54,55,32,56,57,58,59,60,61,62,63,33,34])));if(b(e)||this.destroyed)return null;const{elevationInfo:o}=this.layer;return new e.module.DrawGraphicTool3D({...t,elevationInfo:o,snapToScene:!0,sketchOptions:this.sketchOptions})}_setupCreateOperationHandle(t){const e=this.view;if(!e)return this._logMissingView(),null;let o=null;const a=t.forceUniformSize,i=t.centered,s=[e.on("key-down",r=>{if(r.key===_.pan)r.stopPropagation(),r.repeat||(t.enabled=!1);else if(r.key===_.complete)r.stopPropagation(),t.completeCreateOperation();else if(r.key!==_.vertexAdd||r.repeat)r.key===_.undo?(r.stopPropagation(),c.undo()):r.key===_.redo?(r.stopPropagation(),c.redo()):r.key!==_.constraint||t.geometryType!=="rectangle"&&t.geometryType!=="circle"||r.repeat?r.key===_.center&&(r.repeat||(t.centered=!i,r.stopPropagation())):(t.forceUniformSize=!a,r.stopPropagation());else{const h=t.drawOperation.geometryType;h!=="polyline"&&h!=="polygon"&&h!=="multipoint"||(r.stopPropagation(),t.drawOperation.commitStagedVertex())}},w.WIDGET),e.on("key-up",r=>{r.key===_.pan?t.enabled=!0:r.key!==_.constraint||t.geometryType!=="rectangle"&&t.geometryType!=="circle"?r.key===_.center&&(t.centered=i,r.stopPropagation()):(t.forceUniformSize=a,r.stopPropagation())},w.WIDGET),t.on("vertex-add",r=>{switch(o=o==null?"start":"active",r.operation){case"apply":this.emit("create",{graphic:t.graphic,state:o,tool:this.activeTool,toolEventInfo:r,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[t.graphic],tool:t.geometryType});break;case"redo":this._emitRedoEvent({graphics:[t.graphic],tool:t.geometryType})}}),t.on("cursor-update",r=>{t.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:t.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:r.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),t.on("vertex-remove",r=>{switch(r.operation){case"apply":this.emit("create",{graphic:t.graphic,state:"active",tool:this.activeTool,toolEventInfo:r,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[t.graphic],tool:t.geometryType});break;case"redo":this._emitRedoEvent({graphics:[t.graphic],tool:t.geometryType})}}),t.on("complete",r=>{this._set("createGraphic",r.graphic),o="complete",r.aborted?c&&c.cancel():c&&c.complete()}),H(()=>this._getGraphicSymbolFromTool(t.geometryType),r=>{t.graphicSymbol=r})],c=new x({activeComponent:t,tool:t.geometryType,type:"create",onEnd:()=>{var r;A(s),(r=e.tools)==null||r.remove(t)},undo:()=>{t.canUndo&&t.undo()},redo:()=>{t.canRedo&&t.redo()},canUndo:()=>t.canUndo,canRedo:()=>t.canRedo});return c}_getGraphicSymbolFromTool(t){switch(t){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol}}async _setupUpdateOperation(t,e){var c;const{layer:o,view:a}=this;if(!a)return this._logMissingView(),null;const i={...this.defaultUpdateOptions,...e,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...e==null?void 0:e.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...e==null?void 0:e.highlightOptions}};let s=i.tool??R.tool;for(const r of t)o.remove(r),o.add(r);if(a.type==="3d"){if(t.length===0)return null;switch(s){case"move":return this._setupMove3DOperation(t,i,a,s);case"reshape":return t.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(t[0],i,a);case"transform":return this._setupGraphicTransform3DOperation(t,i,a)}}switch(s){case"move":return this._setupMove2DOperation(t,i,a);case"reshape":return t.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(t,s,i,a);case"transform":if(t.length===1){const r=(c=t[0].geometry)==null?void 0:c.type;r!=="point"&&r!=="multipoint"||(s="reshape")}return this._setupTransformOrReshape2DOperation(t,s,i,a)}}async _setupMove3DOperation(t,e,o,a,i=!1){const s=await this._requireModule(S(()=>import("./editingTools-DsOcydN7.js"),__vite__mapDeps([36,1,7,14,37,31,29,23,24,25,26,5,38,39,40,41,42,43,44,45,46,3,4,6,8,9,47,48,49,50,20,19,51,10,11,12,13,15,16,17,18,21,22,27,28,30,52,53,54,55,32,56,57,58,59,60,61,62,63,33,34])));if(b(s))return s;const{ManipulatedObject3DGraphic:c,MoveTool3D:r}=s.module,h=new Map,n=()=>{h.forEach(u=>u.destroy()),h.clear()};for(const u of t){const d=new c({view:o,graphic:u}),O=Rt(d);if(O!==E.SUPPORTED)return n(),this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${J(O)}).`),null;h.set(u,d)}const l=new r({view:o,enableZ:e.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});o.tools.add(l),l.objects.addMany(Array.from(h.values())),i||this.updateGraphics.addMany(t);const p=[],v=new M({activeComponent:l,tool:a,type:"update",onEnd:()=>{A(p),U(o,l),n()},undo:()=>{it(this.view,l),I(v,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a})},redo:()=>{P(v,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a})},addToSelection:u=>{this.updateGraphics.push(u);const d=new c({view:o,graphic:u});h.set(u,d),l.objects.push(d),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[u],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:u=>{const d=this.updateGraphics.indexOf(u);if(v.history.undo.forEach(T=>T.updates.splice(d,1)),v.history.redo.forEach(T=>T.updates.splice(d,1)),this.updateGraphics.remove(u),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[u],type:"selection-change"},type:"update"}),this.updateGraphics.length===0)return void v.complete();const O=h.get(u);O&&(l.objects.remove(O),O.destroy(),h.delete(u))},toggleTool:async()=>{if(this.updateGraphics.length!==1||e.toggleToolOnClick===!1||a!=="transform")return;const u=this.updateGraphics.at(0),d=await this._setupReshape3DOperation(u,e,o,!0);d&&!b(d)&&(v.onEnd(),v.destroy(),this._setUpdateOperationHandle(d,e))}});return p.push(...this._getHandlesForComponent(v,e),o.on("immediate-click",u=>this._getCommonUpdateOperationClickHandlers(v,u,e),w.WIDGET),o.on("key-down",u=>{this._getCommonUpdateOperationKeyDownHandlers(v,u)},w.WIDGET)),v}_setupGraphicTransform3DOperation(t,e,o,a=!1){if(t.length===1&&Lt(t[0])===E.SUPPORTED){const i=t[0],s=i.geometry;if(s!=null&&(s.type==="point"||s.type==="mesh"))return this._setupPointTransform3DOperation(i,e,o);if(s!=null&&(s.type==="polygon"||s.type==="polyline"))return this._setupPolyTransform3DOperation(i,e,o,a)}return this._setupMove3DOperation(t,e,o,"transform",a)}async _setupPointTransform3DOperation(t,e,o){const a="transform",{enableRotation:i,enableScaling:s,enableZ:c}=e,r=await this._requireModule(S(()=>import("./editingTools-DsOcydN7.js"),__vite__mapDeps([36,1,7,14,37,31,29,23,24,25,26,5,38,39,40,41,42,43,44,45,46,3,4,6,8,9,47,48,49,50,20,19,51,10,11,12,13,15,16,17,18,21,22,27,28,30,52,53,54,55,32,56,57,58,59,60,61,62,63,33,34])));if(b(r))return r;const{TransformTool3D:h,ManipulatedObject3DGraphic:n}=r.module,l=new n({graphic:t,view:o}),p=new h({object:l,view:o,enableRotation:i,enableScaling:s,enableZ:c,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});o.tools.add(p),this.updateGraphics.add(t);const v=[],u=new M({activeComponent:p,tool:a,type:"update",onEnd:()=>{A(v),U(o,p),l.destroy()},undo:()=>{it(this.view,p),I(u,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a})},redo:()=>{P(u,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a})},addToSelection:async d=>{this.updateGraphics.add(d),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[d],removed:[],type:"selection-change"},type:"update"}),u.onEnd(),u.destroy();const O=await this._setupMove3DOperation(this.updateGraphics.toArray(),e,o,"transform",!0);b(O)||this._setUpdateOperationHandle(O,e)},removeFromSelection:d=>{this.updateGraphics.remove(d),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[d],type:"selection-change"},type:"update"}),u.complete()},toggleTool:()=>{}});return v.push(...this._getHandlesForComponent(u,e),o.on("immediate-click",d=>this._getCommonUpdateOperationClickHandlers(u,d,e),w.WIDGET),o.on("key-down",d=>{this._getCommonUpdateOperationKeyDownHandlers(u,d)},w.WIDGET)),u}async _setupPolyTransform3DOperation(t,e,o,a=!1){var j,K;const i="transform",{enableRotation:s,enableScaling:c,enableZ:r,preserveAspectRatio:h}=e,n=await this._requireModule(S(()=>import("./editingTools-DsOcydN7.js"),__vite__mapDeps([36,1,7,14,37,31,29,23,24,25,26,5,38,39,40,41,42,43,44,45,46,3,4,6,8,9,47,48,49,50,20,19,51,10,11,12,13,15,16,17,18,21,22,27,28,30,52,53,54,55,32,56,57,58,59,60,61,62,63,33,34])));if(b(n))return n;const{ManipulatedObject3DGraphic:l,ExtentTransformTool:p}=n.module,v=(K=(j=this.view)==null?void 0:j.inputManager)==null?void 0:K.isModifierKeyDown(_.constraint),u=new l({view:o,graphic:t}),d=new p({object:u,view:o,enableRotation:s,enableScaling:c,enableZ:r,preserveAspectRatio:!!h!=!!v,sketchOptions:this.sketchOptions});o.tools.add(d),a||this.updateGraphics.add(t);const O=[],T=new M({activeComponent:d,tool:i,type:"update",onEnd:()=>{A(O),U(o,d),u.destroy()},canUndo:()=>!d.destroyed&&d.canUndo,undo:()=>{d.destroyed||(d.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i}))},canRedo:()=>!d.destroyed&&d.canRedo,redo:()=>{d.destroyed||(d.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i}))},addToSelection:async f=>{this.updateGraphics.add(f),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[f],removed:[],type:"selection-change"},type:"update"}),T.onEnd(),T.destroy();const $=await this._setupMove3DOperation(this.updateGraphics.toArray(),e,o,"transform",!0);b($)||this._setUpdateOperationHandle($,e)},removeFromSelection:f=>{this.updateGraphics.remove(f),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[f],type:"selection-change"},type:"update"}),T.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||e.toggleToolOnClick===!1)return;const f=await this._setupReshape3DOperation(t,e,o,!0);f&&!b(f)&&(T.onEnd(),T.destroy(),this._setUpdateOperationHandle(f,e))}});return O.push(...this._getHandlesForComponent(T,e),o.on("immediate-click",f=>this._getCommonUpdateOperationClickHandlers(T,f,e),w.WIDGET),o.on("key-down",f=>this._getCommonUpdateOperationKeyDownHandlers(T,f),w.WIDGET),o.on("key-down",f=>{f.key!==_.constraint||f.repeat||(d.preserveAspectRatio=!d.preserveAspectRatio,f.stopPropagation())},w.WIDGET),o.on("key-up",f=>{f.key===_.constraint&&(d.preserveAspectRatio=!d.preserveAspectRatio,f.stopPropagation())},w.WIDGET)),T}async _setupMove2DOperation(t,e,o){const a="move";this.updateGraphics.addMany(t),await this._updatingHandles.addPromise(this._updateSpatialReference(t));const i=await this._getGraphicMover(t,e,o);if(b(i))return i;const s=new M({activeComponent:i,tool:a,type:"update",onEnd:()=>{var n;this._displayDefaultCursor(),A(h),A(r),i.destroy(),(n=this._internalGraphicsLayer)==null||n.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const n=this.updateGraphics.toArray();I(s,n),s.refreshComponent(),this._emitUndoEvent({graphics:n,tool:a})},redo:()=>{const n=this.updateGraphics.toArray();P(s,n),s.refreshComponent(),this._emitRedoEvent({graphics:n,tool:a})},addToSelection:async n=>{await this._updatingHandles.addPromise(this._updateSpatialReference(n)),this.updateGraphics.push(n),i.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[n],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:n=>{const l=this.updateGraphics.indexOf(n);s.history.undo.forEach(v=>v.updates.splice(l,1)),s.history.redo.forEach(v=>v.updates.splice(l,1)),this.updateGraphics.remove(n);const p=this.updateGraphics.toArray();this.emit("update",{graphics:p,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[n],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?i.graphics=p:s.complete()}});let c=!1;const r=[o.on("immediate-click",n=>this._getCommonUpdateOperationClickHandlers(s,n,e),w.WIDGET),o.on("key-down",n=>{this._getCommonUpdateOperationKeyDownHandlers(s,n),n.key!==_.constraint||n.repeat||(c=!0,i.enableMoveAllGraphics=!i.enableMoveAllGraphics)},w.WIDGET),o.on("key-up",n=>{n.key===_.constraint&&c&&(c=!1,i.enableMoveAllGraphics=!i.enableMoveAllGraphics)},w.WIDGET)],h=this._getHandlesForComponent(s,e);return s}async _setupReshape3DOperation(t,e,o,a=!1){const i="reshape",s=await this._requireModule(S(()=>import("./editingTools-DsOcydN7.js"),__vite__mapDeps([36,1,7,14,37,31,29,23,24,25,26,5,38,39,40,41,42,43,44,45,46,3,4,6,8,9,47,48,49,50,20,19,51,10,11,12,13,15,16,17,18,21,22,27,28,30,52,53,54,55,32,56,57,58,59,60,61,62,63,33,34])));if(b(s))return s;const{ManipulatedObject3DGraphic:c,ReshapeTool3D:r}=s.module,h=new c({view:o,graphic:t}),n=Ut(h);if(n!==E.SUPPORTED)return h.destroy(),this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${J(n)}).`),null;const l=e.reshapeOptions,p=new r({view:o,object:h,enableZVertex:e.enableZ&&(l==null?void 0:l.vertexOperation)==="move",enableZShape:e.enableZ&&(l==null?void 0:l.shapeOperation)==="move",enableMoveObject:(l==null?void 0:l.shapeOperation)==="move"||(l==null?void 0:l.shapeOperation)==="move-xy",enableMidpoints:(l==null?void 0:l.edgeOperation)==="split",enableEdgeOffset:(l==null?void 0:l.edgeOperation)==="offset",snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});o.tools.add(p),a||this.updateGraphics.add(h.graphic);const v=[],u=new M({activeComponent:p,tool:i,type:"update",onEnd:()=>{A(v),U(o,p),h.destroy()},canUndo:()=>!p.destroyed&&p.canUndo,undo:()=>{p.destroyed||(p.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i}))},canRedo:()=>!p.destroyed&&p.canRedo,redo:()=>{p.destroyed||(p.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i}))},addToSelection:async d=>{this.updateGraphics.add(d),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[d],removed:[],type:"selection-change"},type:"update"}),u.onEnd(),u.destroy();const O=await this._setupMove3DOperation(this.updateGraphics.toArray(),e,o,"transform",!0);b(O)||this._setUpdateOperationHandle(O,e)},removeFromSelection:d=>{this.updateGraphics.remove(d),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[d],type:"selection-change"},type:"update"}),u.complete()},toggleTool:async()=>{if(e.toggleToolOnClick===!1)return;u.onEnd(),u.destroy();const d=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),e,o,!0);b(d)||this._setUpdateOperationHandle(d,e)}});return v.push(...this._getHandlesForComponent(u,e),o.on("immediate-click",d=>this._getCommonUpdateOperationClickHandlers(u,d,e),w.WIDGET),o.on("key-down",d=>{this._getCommonUpdateOperationKeyDownHandlers(u,d)},w.WIDGET)),u}async _setupTransformOrReshape2DOperation(t,e,o,a){this.updateGraphics.addMany(t),await this._updatingHandles.addPromise(this._updateSpatialReference(t));const i=e==="transform"?await this._getBox(t,o,a):await this._getReshape(t,o,a);if(b(i))return i;const s=new M({activeComponent:i,type:"update",onEnd:()=>{A(r),A(c),s.activeComponent&&!s.activeComponent.destroyed&&s.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{I(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},redo:()=>{P(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},addToSelection:async h=>{let n=s.activeComponent;if((n==null?void 0:n.type)==="reshape"){const l=[...this.updateGraphics,h];this.updateGraphics.removeAll(),s.onEnd(),s.destroy();const p=await this._setupTransformOrReshape2DOperation(l,"transform",o,a);if(b(p))return;this._setUpdateOperationHandle(p,o)}else this.updateGraphics.add(h),n.graphics=this.updateGraphics.toArray(),n.refresh(),s.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[h],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async h=>{const n=this.updateGraphics.indexOf(h);s.history.undo.forEach(p=>p.updates.splice(n,1)),s.history.redo.forEach(p=>p.updates.splice(n,1)),this.updateGraphics.remove(h);const l=this.updateGraphics.toArray();if(l.length===0)s.complete();else{const p=l[0].geometry;l.length!==1||p==null||p.type!=="point"&&p.type!=="multipoint"?s.activeComponent.graphics=l:s.toggleTool()}this.emit("update",{graphics:l,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[h],type:"selection-change"},type:"update"})},toggleTool:async()=>{var p;if(this.updateGraphics.length>1)return;const h=this.updateGraphics.at(0),n=h.geometry;if(n!=null&&(s.tool==="reshape"&&(n.type==="point"||n.type==="multipoint")||s.tool==="transform"&&n.type==="extent"))return;let l=null;s.tool==="transform"?l=await this._getReshape([h],o,a):s.tool==="reshape"&&(l=await this._getBox([h],o,a)),b(l)||((p=s.activeComponent)==null||p.destroy(),s.activeComponent=l,s.activeComponent&&(A(r),r=this._getHandlesForComponent(s,o)))}}),c=[a.on("immediate-click",h=>this._getCommonUpdateOperationClickHandlers(s,h,o),w.WIDGET),a.on("key-down",h=>{if(this._getCommonUpdateOperationKeyDownHandlers(s,h),h.key===_.constraint&&!h.repeat&&s){const n=s.activeComponent;n&&n.type==="box"&&(n.preserveAspectRatio=!n.preserveAspectRatio)}},w.WIDGET),a.on("key-up",h=>{if(h.key===_.constraint&&s){const n=s.activeComponent;n&&n.type==="box"&&(n.preserveAspectRatio=!n.preserveAspectRatio)}},w.WIDGET)];let r=this._getHandlesForComponent(s,o);return s}async _getGraphicMover(t,e,o){const{enableMoveAllGraphics:a,highlightOptions:i}=e,s=await this._requireModule(S(()=>import("./GraphicMover-DhoMgT58.js").then(c=>c.G),__vite__mapDeps([78,1,27,35,79,80,33,34])));return b(s)?s:new s.module.default({enableMoveAllGraphics:a,highlightsEnabled:!!(i!=null&&i.enabled),indicatorsEnabled:!1,graphics:t,view:o,callbacks:{onGraphicMoveStart:({dx:c,dy:r,graphic:h})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:c,dy:r,mover:h,type:"move-start"},type:"update"})},onGraphicMove:({dx:c,dy:r,graphic:h})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:c,dy:r,mover:h,type:"move"},type:"update"}),onGraphicMoveStop:({dx:c,dy:r,graphic:h})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:c,dy:r,mover:h,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(t,e,o){var n,l;const{enableRotation:a,enableScaling:i,highlightOptions:s,preserveAspectRatio:c}=e,r=await this._requireModule(S(()=>import("./Box-BcG0xZ-C.js"),__vite__mapDeps([81,1,35,78,27,79,80,33,34,82,21,15,5,11,12,4,13,14,16,17,18,19,6,20,3,7,22,23,24,25,26,63,31,29,54])));if(b(r))return r;const h=(l=(n=this.view)==null?void 0:n.inputManager)==null?void 0:l.isModifierKeyDown(_.constraint);return new r.module.default({graphics:t,enableRotation:a,enableScaling:i,highlightsEnabled:!!(s!=null&&s.enabled),preserveAspectRatio:!!c!=!!h,layer:this._internalGraphicsLayer,view:o,sketchOptions:this.sketchOptions,callbacks:{onMoveStart:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onMove:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onMoveStop:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onScaleStart:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onScale:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onScaleStop:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onRotateStart:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onRotate:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onRotateStop:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"})}})}async _getReshape(t,e,o){var r,h,n;const a=((r=e.reshapeOptions)==null?void 0:r.edgeOperation)==="split",i=((h=e.reshapeOptions)==null?void 0:h.shapeOperation)==="move",s=!!((n=e.highlightOptions)!=null&&n.enabled),c=await this._requireModule(S(()=>import("./Reshape-B-TFuJkw.js"),__vite__mapDeps([83,1,27,2,3,4,5,6,7,8,9,35,78,79,80,33,34,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,53,28,29,30,54,31,82])));return b(c)?c:new c.module.default({enableMidpoints:a,enableMovement:i,graphic:t[0],highlightsEnabled:s,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,view:o,callbacks:{onReshapeStart:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"}),onReshape:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"}),onReshapeStop:({mover:l,type:p})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:l,type:p},type:"update"}),onMoveStart:({dx:l,dy:p,mover:v,type:u})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:p,mover:v,type:u},type:"update"}),onMove:({dx:l,dy:p,mover:v,type:u})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:p,mover:v,type:u},type:"update"}),onMoveStop:({dx:l,dy:p,mover:v,type:u})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:p,mover:v,type:u},type:"update"}),onVertexAdd:({added:l,type:p,vertices:v})=>{const u=l.map(d=>z(d.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:u,vertices:v,type:p},type:"update"})},onVertexRemove:({removed:l,type:p,vertices:v})=>{const u=l.map(d=>z(d.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:u,vertices:v,type:p},type:"update"})}}})}_getHandlesForComponent(t,e){const o=t.activeComponent;if(!o)return[];switch(o.type){case"graphic-mover":return[o.on("graphic-click",({graphic:a,viewEvent:i})=>{var s;(s=i.native)!=null&&s.shiftKey&&(i.stopPropagation(),t.removeFromSelection(a))}),o.on("graphic-move-start",a=>t.addToHistory(C(a.allGraphics)))];case"box":return[o.on("graphic-click",a=>this._onTransformOrReshape2DGraphicClick(t,e,a)),o.on("move-start",a=>t.addToHistory(C(a.graphics))),o.on("rotate-start",a=>t.addToHistory(C(a.graphics))),o.on("scale-start",a=>t.addToHistory(C(a.graphics)))];case"reshape":return[o.on("graphic-click",a=>this._onTransformOrReshape2DGraphicClick(t,e,a)),o.on("move-start",a=>t.addToHistory(C([a.mover]))),o.on("reshape-start",a=>t.addToHistory(C([a.graphic]))),o.on("vertex-add",a=>t.addToHistory(C([a.oldGraphic]))),o.on("vertex-remove",a=>t.addToHistory(C([a.oldGraphic])))];case"move-3d":return[o.events.on("record-undo",({updates:a})=>{t.addToHistory({updates:a})}),o.events.on("move-start",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:a.objects.length>0?a.objects[0].graphic:null,type:"move-start"},type:"update"})}),o.events.on("move",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:a.dx,dy:a.dy,mover:a.objects.length>0?a.objects[0].graphic:null,type:"move"},type:"update"})}),o.events.on("move-stop",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:a.objects.length>0?a.objects[0].graphic:null,type:"move-stop"},type:"update"})}),o.events.on("immediate-click",a=>{a.shiftKey?this._toggleSelection([a.object.graphic],t,e):t.toggleTool()})];case"transform-3d":return[o.events.on("record-undo",({updates:a})=>{t.addToHistory({updates:a})}),o.events.on("translate-start",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,dx:a.dxScreen,dy:a.dyScreen,type:"move-start"},type:"update"})}),o.events.on("translate-stop",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,dx:a.dxScreen,dy:a.dyScreen,type:"move-stop"},type:"update"})}),o.events.on("rotate-start",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,angle:a.angle,type:"rotate-start"},type:"update"})}),o.events.on("rotate-stop",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,angle:a.angle,type:"rotate-stop"},type:"update"})}),o.events.on("scale-start",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,xScale:a.xScale,yScale:a.yScale,type:"scale-start"},type:"update"})}),o.events.on("scale-stop",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,xScale:a.xScale,yScale:a.yScale,type:"scale-stop"},type:"update"})}),o.events.on("translate",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,dx:a.dxScreen,dy:a.dyScreen,type:"move"},type:"update"})}),o.events.on("rotate",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,angle:a.angle,type:"rotate"},type:"update"})}),o.events.on("scale",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,xScale:a.xScale,yScale:a.yScale,type:"scale"},type:"update"})}),o.events.on("immediate-click",a=>{a.shiftKey?this._toggleSelection([a.object.graphic],t,e):t.toggleTool()})];case"reshape-3d":return[o.events.on("reshape",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...a,mover:a.object.graphic},type:"update"})}),o.events.on("move",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...a,mover:a.object.graphic},type:"update"})}),o.events.on("vertex-add",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:a,type:"update"})}),o.events.on("vertex-remove",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:a,type:"update"})}),o.events.on("immediate-click",a=>{a.shiftKey?this._toggleSelection([a.object.graphic],t,e):t.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(t,e,o){var s;const{graphic:a,viewEvent:i}=o;return(s=i.native)!=null&&s.shiftKey&&a.layer===this.layer?(i.stopPropagation(),t.removeFromSelection(a)):e.toggleToolOnClick?(i.stopPropagation(),t.toggleTool()):void 0}_setUpdateOperationHandle(t,e){var i;this._operationHandle=t;const o=(i=this.view)==null?void 0:i.map;this._disablePopup(e);const a=()=>{if(t===this._operationHandle){const s=this.updateGraphics.toArray(),c=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),o&&o.remove(this._internalGraphicsLayer),this._restorePopup(e),this.emit("update",{graphics:s,state:"complete",aborted:t.cancelled,tool:c,toolEventInfo:null,type:"update"})}};t.on("complete",a)}async _getCommonUpdateOperationClickHandlers(t,e,o){const a=Y(e),i=await e.async(()=>this._getFirstHit(a));if(i==null)return void t.complete();if(e.native.shiftKey&&this._toggleSelection([i.graphic],t,o))return void e.stopPropagation();this.updateGraphics.includes(i.graphic)?e.stopPropagation():t.complete()}_toggleSelection(t,e,o){const a=!!o.multipleSelectionEnabled;return t.some(i=>i!=null&&!(!a||i.layer!==this.layer)&&(this.updateGraphics.includes(i)?e.removeFromSelection(i):e.addToSelection(i),!0))}_getCommonUpdateOperationKeyDownHandlers(t,e){if(!t)return;const o=e.key;o===_.undo&&t.canUndo()?(e.stopPropagation(),t.undo()):o===_.redo&&t.canRedo()?(e.stopPropagation(),t.redo()):o===_.cancel?(e.stopPropagation(),t.cancel()):this.allowDeleteKey&&_.delete.includes(o)&&this._onDeleteKey(e)}_onDeleteKey(t){var a;if(!this._operationHandle||this._operationHandle.type!=="update")return;const e=this.activeComponent,o=this.updateGraphics.toArray();e!=null&&(e.type!=="reshape"||o.length===1&&((a=o[0].geometry)==null?void 0:a.type)==="point")&&(t.stopPropagation(),this.delete())}_removeDefaultLayer(){var t,e;this._internalGraphicsLayer&&((e=(t=this.view)==null?void 0:t.map)==null||e.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=D(this._internalGraphicsLayer))}_isComponentGraphic(t){var o;const{activeComponent:e}=this;return!(!t||e==null)&&(((o=t.attributes)==null?void 0:o.esriSketchTool)||e.type==="draw-2d"&&e.graphic===t||(e.type==="box"||e.type==="reshape")&&e.isUIGraphic(t))}_displayPointerCursor(){var t;(t=this.view)!=null&&t.container&&this.view.cursor!=="pointer"&&(this.view.cursor="pointer")}_displayGrabbingCursor(){var t;(t=this.view)!=null&&t.container&&this.view.cursor!=="grabbing"&&(this.view.cursor="grabbing")}_displayDefaultCursor(){var t;(t=this.view)!=null&&t.container&&this.view.cursor!==null&&(this.view.cursor=null)}_logError(t,e,o){At.getLogger(this).error(new Mt(t,e,o))}async _requireModule(t){const e=new AbortController;this._moduleLoaderAbortController=e;const o=await t;return this._moduleLoaderAbortController!==e||e.signal.aborted?{requireError:"aborted"}:{module:o}}_emitUndoEvent(t){this.emit("undo",{...t,type:"undo"})}_emitRedoEvent(t){this.emit("redo",{...t,type:"redo"})}_emitDeleteEvent(t){this.emit("delete",{...t,type:"delete"})}get test(){}wait(){return B(()=>!this.updating)}_disablePopupEnabled(t){var e;return((e=this.view)==null?void 0:e.type)!=="3d"||this.updateOnGraphicClick||((t==null?void 0:t.toggleToolOnClick)??!1)}_disablePopup(t){this._disablePopupEnabled(t)&&this.view&&this._originalPopupEnabled==null&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(t){this._disablePopupEnabled(t)&&this.view&&this._originalPopupEnabled!=null&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const t=this.view;t?(F(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await Ct(B(()=>t==null?void 0:t.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",at("view"))}_logMissingLayer(){this._logError(jt,at("layer"))}};y([g()],m.prototype,"_defaultSnappingManager",void 0),y([g()],m.prototype,"updating",null),y([g({readOnly:!0})],m.prototype,"_updatingHandles",void 0),y([g()],m.prototype,"_operationHandle",void 0),y([g({readOnly:!0})],m.prototype,"activeTool",null),y([g({readOnly:!0})],m.prototype,"activeCreateToolDrawMode",null),y([g()],m.prototype,"activeTooltip",null),y([g({types:k})],m.prototype,"activeFillSymbol",void 0),y([g()],m.prototype,"activeLineSymbol",void 0),y([g()],m.prototype,"activeVertexSymbol",void 0),y([g()],m.prototype,"allowDeleteKey",void 0),y([g({readOnly:!0})],m.prototype,"createGraphic",null),y([g()],m.prototype,"defaultCreateOptions",null),y([g()],m.prototype,"defaultUpdateOptions",null),y([g({type:Ht,nonNullable:!0})],m.prototype,"labelOptions",null),y([g()],m.prototype,"layer",void 0),y([g({types:k})],m.prototype,"pointSymbol",void 0),y([g({types:k})],m.prototype,"polygonSymbol",void 0),y([g({types:k})],m.prototype,"polylineSymbol",void 0),y([g()],m.prototype,"meshSymbol",void 0),y([g({type:nt,nonNullable:!0})],m.prototype,"snappingOptions",null),y([g()],m.prototype,"snappingManager",null),y([g({readOnly:!0})],m.prototype,"state",null),y([g({type:Dt,nonNullable:!0})],m.prototype,"tooltipOptions",null),y([g({readOnly:!0})],m.prototype,"updateGraphics",void 0),y([g()],m.prototype,"updateOnGraphicClick",void 0),y([g()],m.prototype,"creationMode",void 0),y([g({type:It,nonNullable:!0})],m.prototype,"valueOptions",null),y([g({types:k})],m.prototype,"vertexSymbol",void 0),y([g({value:null})],m.prototype,"view",null),y([g({constructOnly:!0,type:rt})],m.prototype,"sketchOptions",void 0),m=y([L("esri.widgets.Sketch.SketchViewModel")],m);const jt="sketch:missing-property",at=t=>`Property '${t}' is missing on SketchViewModel.`;function Kt(t){return t==="polygon"||t==="rectangle"||t==="circle"}function I(t,e){pt("undo",t.history.undo,t.history.redo,e)}function P(t,e){pt("redo",t.history.redo,t.history.undo,e)}function pt(t,e,o,a){const i=e.pop();if(!i)return;const s=i.updates,c=[];a.forEach((r,h)=>{const n=s[h];n!=null&&("geometry"in n&&n.geometry!=null&&(c.push({geometry:r.geometry}),r.geometry=n.geometry),"symbol"in n&&n.symbol!=null&&(c.push({symbol:r.symbol}),r.symbol=n.symbol),"undo"in n&&(c.push(n),n[t](r)))}),o.push({updates:c})}function it(t,e){t!=null&&e.hasGrabbedManipulators&&(t.activeTool=null)}function C(t){return{updates:t.map(({geometry:e})=>(e==null?void 0:e.type)==="mesh"?{geometry:e.cloneShallow()}:{geometry:e})}}function U(t,e){var o;(o=t.tools)==null||o.remove(e),e.destroyed||e.destroy()}function b(t){return"requireError"in t&&t.requireError==="aborted"}const Bt=m;export{tt as e,et as o,Yt as r,Bt as y};
