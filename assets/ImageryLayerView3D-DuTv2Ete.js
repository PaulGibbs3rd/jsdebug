import{ch as m,e_ as h,b as s,m as o,c as p}from"./index-CzvLtnX1.js";import{N as g}from"./DynamicLayerView3D-DAh8gR10.js";import{m as u}from"./ImageryLayerView-BUHXhULY.js";import"./LayerView3D-C3wz0Xd_.js";import"./projectExtentUtils-dd9OO2QQ.js";import"./geometryServiceUtils-DDNHyfMa.js";import"./ImageMaterial.glsl-DcxC6lC7.js";import"./DefaultLayouts-CGjC8rk2.js";import"./TriangleMaterial-DGLj9Hvg.js";import"./LayerView-DMEwuW7Q.js";import"./RefreshableLayerView-CoTThkI-.js";import"./timeSupport-CgS5mQjm.js";import"./rasterProjectionHelper-B6RYh9HO.js";import"./popupUtils-C5Xxoh_A.js";let r=class extends u(g){constructor(){super(...arguments),this.type="imagery-3d",this.redrawDebounced=m(async e=>{this.redraw((t,i)=>this._redrawImage(t,i),e)},2e3)}get highlightOptions(){return null}get pixelData(){return null}initialize(){this.addHandles([h(()=>this.view.basemapTerrain.ready,()=>this._initializeMaximumDataResolution(),{once:!0,initial:!0}),this.layer.on("redraw",()=>this._updatingHandles.addPromise(this.redrawDebounced()))]),this._updatingHandles.add(()=>this.layer?.exportImageServiceParameters?.version,()=>{this._updatingHandles.addPromise(this.refreshDebounced())}),this._updatingHandles.add(()=>this.layer?.renderer,()=>{this._updatingHandles.addPromise(this.refreshDebounced())}),this._updatingHandles.add(()=>this.timeExtent,()=>this._updatingHandles.addPromise(this.refreshDebounced()))}_initializeMaximumDataResolution(){this.maximumDataResolution=this.layer.loaded?this.layer.serviceRasterInfo.pixelSize:null}getFetchOptions(){return{timeExtent:this.timeExtent}}async processResult(e,t,i){t.imageOrCanvasElement?e.image=t.imageOrCanvasElement:(e.image=document.createElement("canvas"),e.pixelData=t.pixelData,await this._redrawImage(e,i))}async _redrawImage(e,t){if(!(e.image instanceof HTMLCanvasElement)||e.pixelData==null)throw new Error;const i=e.image,n=i.getContext("2d"),d=await this.layer.applyRenderer(e.pixelData,{signal:t}),a=this.layer.applyFilter(d).pixelBlock;if(a==null)throw new Error;i.width=a.width,i.height=a.height;const l=n.createImageData(a.width,a.height);l.data.set(a.getAsRGBA()),n.putImageData(l,0,0)}highlight(e){throw new Error("Not implemented")}};s([o()],r.prototype,"highlightOptions",null),s([o()],r.prototype,"pixelData",null),r=s([p("esri.views.3d.layers.ImageryLayerView3D")],r);const P=r;export{P as default};
