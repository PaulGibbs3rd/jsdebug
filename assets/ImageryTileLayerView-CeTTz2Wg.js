import{b as n,m as u,c as j,H as O,aC as P}from"./index-CfYeSufM.js";import{V as L,t as y,n as _}from"./rasterFieldUtils-CEK67CIr.js";import{i as $}from"./timeSupport-BAwZ8uOa.js";import{_ as A,x as b,O as C}from"./rasterProjectionHelper-BOOOTgKx.js";import{p as z}from"./popupUtils-DB8vJbLy.js";const B=R=>{let t=class extends R{constructor(){super(...arguments),this.layer=null,this.tileInfo=null}get fullExtent(){try{return this.layer.loaded?this._getFullExtent():null}catch{return null}}get timeExtent(){var a;return $(this.layer,(a=this.view)==null?void 0:a.timeExtent,this._get("timeExtent"))}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){try{return this.layer.loaded?A(this.layer.fullExtent,this.view.spatialReference,!0):null}catch{return null}}supportsSpatialReference(a){try{return!this.layer.loaded||!!b(this.layer.serviceRasterInfo,a)}catch{return!1}}async fetchPopupFeaturesAtLocation(a,m){var g,x;const{layer:e}=this;if(!a)throw new O("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:e});const{popupEnabled:T}=e,I=z(e,m);if(!T||I==null)return[];const p=[],{value:l,magdirValue:s,processedValue:d}=await e.identify(a,{timeExtent:this.timeExtent,signal:m==null?void 0:m.signal});let h="";if(l!=null&&l.length){h=e.type==="imagery-tile"&&e.hasStandardTime()&&l[0]!=null?l.map(c=>e.getStandardTimeValue(c)).join(", "):l.join(", ");const r={ObjectId:0};r[y.servicePixelValue]=e.type==="imagery-tile"&&e.raster.datasetFormat==="Function"?d==null?void 0:d.join(", "):h,r[y.rawServicePixelValue]=h;const o=((g=e.raster)==null?void 0:g.rasterInfo)??e.serviceRasterInfo,v=o==null?void 0:o.attributeTable;if(v!=null){const{fields:c,features:F}=v,w=c.find(({name:i})=>i.toLowerCase()==="value"),S=r[y.servicePixelValue],f=w?F.find(i=>String(i.attributes[w.name])===S):null;if(f)for(const i in f.attributes)f.attributes.hasOwnProperty(i)&&(r[_+i]=f.attributes[i])}const E=o==null?void 0:o.dataType;if(E!=="vector-magdir"&&E!=="vector-uv"||(r[y.magnitude]=s==null?void 0:s[0],r[y.direction]=s==null?void 0:s[1]),e.type==="imagery-tile"){const{multidimensionalDefinition:c}=this.layer.normalizeRasterFetchOptions({timeExtent:this.timeExtent});L(e.rasterFields,r,c)}const V=new P({geometry:(x=this.fullExtent)==null?void 0:x.clone(),attributes:r,layer:e,sourceLayer:e});p.push(V)}return p}async getSourceScale(){return await this.layer.load(),C(this.layer.serviceRasterInfo,this.view.spatialReference)}_getFullExtent(){return b(this.layer.serviceRasterInfo,this.view.spatialReference)}};return n([u()],t.prototype,"fullExtent",null),n([u()],t.prototype,"layer",void 0),n([u({readOnly:!0})],t.prototype,"timeExtent",null),n([u()],t.prototype,"tileInfo",void 0),n([u({readOnly:!0})],t.prototype,"hasTilingEffects",null),n([u()],t.prototype,"datumTransformation",null),t=n([j("esri.views.layers.ImageryTileLayerView")],t),t};export{B as y};
