const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/IdentityManager-O8k6Z88T.js","assets/substitute-DjOBkIlW.js","assets/pe-wasm-CRA-qgEz.js","assets/_commonjsHelpers-DCkdB7M8.js","assets/statsWorker-DH4X2Rqh.js","assets/utils-BeXlThvO.js","assets/utils-CtGOd0WT.js","assets/utils-BJJHgLwi.js","assets/ClassBreaksDefinition-CXt_rIOj.js","assets/geometryEngineWorker-BG_WtZnW.js","assets/geometryEngineJSON-oRyFp_Dn.js","assets/geometryEngineBase-C-gsyNi-.js","assets/json-Wa8cmqdu.js","assets/CSVSourceWorker-CAMudcED.js","assets/date-DCujAECq.js","assets/executeQueryForSnapping-Iy3V_e0n.js","assets/queryUtils-6TLl6Zev.js","assets/QueryEngine-BW9qTl6x.js","assets/WhereClauseCache-9TmBMoEG.js","assets/WhereClause-D7Picv4q.js","assets/TimeOnly-DUjwkvaH.js","assets/timeSupport-C95NcD1h.js","assets/QueryEngineCapabilities-B_pTbIiR.js","assets/FixedIntervalBinParameters-BzwSDYbq.js","assets/FeatureStore-B1CjHmrb.js","assets/BoundsStore-CrM5VOwr.js","assets/PooledRBush-IF1bQTeP.js","assets/optimizedFeatureQueryEngineAdapter-C01vnci5.js","assets/number-Caga42RA.js","assets/clientSideDefaults-CPaCyHtW.js","assets/EdgeProcessingWorker-B5RJYhoT.js","assets/workerHelper-D0TyaW8K.js","assets/bufferLayouts-DagIujEF.js","assets/edgeProcessing-4i7zt-YS.js","assets/ElevationSamplerWorker-DgedOdFf.js","assets/vertexSpaceConversion-ClJv1rEP.js","assets/vec4-CILgnwpT.js","assets/FeatureServiceSnappingSourceWorker-CnFjUQhc.js","assets/symbologySnappingCandidates-CjXRV9wJ.js","assets/pbfQueryUtils-CboXUN80.js","assets/pbf-DU6DDbsT.js","assets/query-Dy8NjPeC.js","assets/GeoJSONSourceWorker-C41dZDI4.js","assets/geojson-BBbbR4XW.js","assets/sourceUtils-CcYz-imp.js","assets/MemorySourceWorker-Ce3bx_WM.js","assets/objectIdUtils-BmFjqQA3.js","assets/PBFDecoderWorker-BcnW-rC8.js","assets/FeaturePipelineWorker-CqHh9MOF.js","assets/AttributeStore-XuGbXzoi.js","assets/Utils-B-HfPvxQ.js","assets/BoundingBox-CfNhF6-u.js","assets/UpdateTracking2D-DgMtH1pt.js","assets/CIMSymbolHelper-Dul3J0hn.js","assets/BidiEngine-QXap_35O.js","assets/rasterizingUtils-C1i-aeFk.js","assets/Rect-CUzevAry.js","assets/streamLayerUtils-CKwt2uXH.js","assets/MeshWriterRegistry-GURey9qz.js","assets/TechniqueType-uMFRS8dR.js","assets/PieChartMeshWriter-mxIEcnPS.js","assets/TurboLine-B7KOcmk4.js","assets/utils-BDxBHtAv.js","assets/grouping-B3DRll1Q.js","assets/QueueProcessor-BH4vjdGx.js","assets/operatorGeodeticDensify-CYwAvxVz.js","assets/SimpleGeometryCursor-B92kdZ15.js","assets/geodeticCurveType-CirnHLSB.js","assets/normalizeUtilsSync-Cc40aJ8I.js","assets/ogcFeatureUtils-Cn0Ie6sa.js","assets/parquet-CyT-A7vO.js","assets/StreamFeatureManager-CGclBv1z.js","assets/CircularArray-CujHzHWW.js","assets/createConnection-DjeUhJQN.js","assets/PointCloudWorker-CX2oTPQ_.js","assets/PointCloudWorkerUtil-CfU1BtjN.js","assets/PointCloudUniqueValueRenderer-BO91v843.js","assets/I3SBinaryReader-ciU6-RUE.js","assets/RasterWorker-ZPK6CDTD.js","assets/dataUtils-DUduw_0w.js","assets/pixelRangeUtils-CDdoTPKf.js","assets/RasterSymbolizer-i_m9Zjg5.js","assets/rasterFunctionHelper-Dv_fFNZf.js","assets/rasterProjectionHelper-B6RYh9HO.js","assets/PolynomialTransform-nd5x-2Mk.js","assets/SceneLayerSnappingSourceWorker-4dFtKhhK.js","assets/SceneLayerWorker-D82C_ofm.js","assets/I3SNode-WMiCmM9v.js","assets/I3SUtil-BmjEU8DT.js","assets/WFSSourceWorker-B8qvI_Eh.js","assets/wfsUtils-0m9a6bOJ.js","assets/xmlUtils-CtUoQO7q.js","assets/WorkerTileHandler-BWksXoyQ.js","assets/SourceLayerData-CvlejIJ2.js","assets/StyleRepository-C0j9wqrG.js","assets/Lyr3DWorker-BhK8LRgR.js","assets/ILyr3DWasmPerSceneView-QwgNPJGT.js","assets/Lyr3DModule-DXIQ7OX8.js","assets/Feature3DPipelineWorker-ZwOP-49X.js","assets/FeaturePipelineRenderManager-iwQkY04O.js","assets/LodRenderer-Cb6GUm6T.js","assets/Popup-wZTdBOSD.js","assets/AttachmentInfo-DLXTQE7T.js","assets/featureUtils-nB1KYXwd.js","assets/utils-CICEYmO-.js","assets/cimSymbolUtils-D5sHtYK8.js","assets/symbolUtils-CBw3yFrR.js","assets/webStyleSymbolUtils-DI4Hu7Mk.js","assets/devEnvironmentUtils-8WtPGj6h.js","assets/executeQueryJSON-C4ALe5Ii.js","assets/shared-BuUhWXQe.js","assets/ReactiveSet-67kD2XpC.js","assets/vmEvent-D4Ubqkbq.js","assets/ElevationLayer-Cx1d9aS6.js","assets/ArcGISCachedService-9k3aUx7G.js","assets/TileInfoTilemapCache-DXFeRw56.js","assets/TilemapCache-DLCZdZ6F.js","assets/LercDecoder-61AoppJf.js","assets/layersCreator-oRwakYTV.js","assets/loadUtils-CyhMMpqf.js","assets/fetchService-Cxb-2UbM.js","assets/associatedFeatureServiceUtils-C-p16ht_.js","assets/lazyLayerLoader-CSrw2Rmo.js","assets/portalLayers-DUzgriCZ.js","assets/arcgisLayers-D7GVNASB.js","assets/arcadeUtils-WwErNi4-.js","assets/arcade-BgB3Zzbi.js","assets/unitConversion-DnvB3s42.js","assets/ImmutableArray-BPVd6ESQ.js","assets/hash-CcEbRgUF.js","assets/webglDeps-luVOL3P9.js","assets/ShaderCompiler-G2XYGDs6.js","assets/programUtils-CwiKxPbA.js","assets/ProgramTemplate-PyQiTsc3.js","assets/mapViewDeps-BbE8qZ8X.js","assets/FeatureCommandQueue-C6yVidQ1.js","assets/GraphShaderModule-fiAQC1Zo.js","assets/heatmapTextureUtils-C4N7TM8m.js","assets/WGLContainer-UBqTgyqK.js","assets/WGLBrushVTLSymbol-Ds8R82mK.js","assets/Container-BrN4Ui-E.js","assets/EffectView-BiQ7qc0o.js","assets/SDFHelper-vuGQIIFe.js","assets/OverrideHelper-DIx2mYgX.js","assets/callExpressionWithFeature-BqIGys1L.js","assets/VTLMaterialManager-By-Uq-tk.js","assets/GridShader-3X71BwHW.js","assets/MaterialPrograms-ChoSzsBE.js","assets/CIMResourceManager-DkXJjrjP.js","assets/utils-B6hDAdC_.js","assets/VertexStream-CvOgQEEd.js","assets/utils-ehcGqGxa.js","assets/GraphicsView2D-CBTRavXz.js","assets/GraphicContainer-B78C-enC.js","assets/AGraphicContainer-DyapwdFp.js","assets/TechniqueInstance-ChSshhqb.js","assets/TileContainer-Bq-a2BCj.js","assets/gridUtils-CJWQau1Q.js","assets/geodesicUtils-C0S8HwBT.js","assets/TileLayerView2D-C1K2Sqfo.js","assets/imageUtils-C2ZLcGA9.js","assets/BitmapTechnique-YcmA_Lg2.js","assets/LayerView2D--e9gSTDz.js","assets/HighlightGraphicContainer-DhyPHvEN.js","assets/LayerView-DMEwuW7Q.js","assets/RefreshableLayerView-CoTThkI-.js","assets/MapServiceLayerViewHelper-D_a4EVrv.js","assets/floorFilterUtils-DKzVzLpH.js","assets/drapedUtils-EmUI5byW.js","assets/sublayerUtils-vo1-sn1O.js","assets/popupUtils-C5Xxoh_A.js","assets/FeatureLayerView2D-ekV4vqBu.js","assets/timeSupport-CgS5mQjm.js","assets/AttributeBinsFeatureSet-BHhVaxs1.js","assets/AttributeBinsQuery-CUaDaAln.js","assets/featureReductionUtils-Caulfaw_.js","assets/constants-B4mRqufT.js","assets/FeatureLayerView-C-uC0TMb.js","assets/BaseDynamicLayerView2D-D5t8Lfni.js","assets/BitmapContainer-CYTA_SEf.js","assets/ExportStrategy-BYuDRw9l.js","assets/CatalogLayerView2D-BrXYfI86.js","assets/CatalogLayerView-05uLr-q4.js","assets/CatalogDynamicGroupLayerView2D-Cv2X3T-A.js","assets/CatalogDynamicGroupLayerView-CuwyT3R_.js","assets/CatalogFootprintLayerView2D-DLtBtj7F.js","assets/CatalogFootprintLayerView-ak9rscLD.js","assets/GeoRSSLayerView2D-Dywkj5iR.js","assets/GraphicsLayerView2D-xb11c42F.js","assets/GroupLayerView2D-B4CQbpN8.js","assets/GroupLayerView-CcSmVcUG.js","assets/ImageryLayerView2D-C9J33B-K.js","assets/RasterVFDisplayObject-B-Dbv-ZP.js","assets/ImageryLayerView-BUHXhULY.js","assets/ImageryTileLayerView2D-BYElftdz.js","assets/multidimensionalUtils-aBUDJrq_.js","assets/rasterUtils-q_qJHJk_.js","assets/RawBlockCache-GmYxie0K.js","assets/ImageryTileLayerView-C0ib4sPl.js","assets/rasterFieldUtils-B7rAGycz.js","assets/KMLLayerView2D-CQy4IZL5.js","assets/kmlUtils-DLlXyJ2y.js","assets/KnowledgeGraphLayerView2D-CQljMyhM.js","assets/MapImageLayerView2D-CgogAMw2.js","assets/MapImageLayerView-qaeBGERh.js","assets/ExportImageParameters-BWRvZJrm.js","assets/MapNotesLayerView2D-C3BFhU5c.js","assets/MediaLayerView2D-CitqsjVE.js","assets/perspectiveUtils-DOQiwYp2.js","assets/mediaLayerUtils-BJ-DU5EY.js","assets/OverlayContainer-LT4ugZ4d.js","assets/MediaLayerView-Dno1i6UL.js","assets/OGCFeatureLayerView2D-BxmJPTL5.js","assets/OGCFeatureLayerView-BG6jAOWW.js","assets/RouteLayerView2D-DAst-JdC.js","assets/Stop-CORppJjm.js","assets/networkEnums-DR19Uw7m.js","assets/StreamLayerView2D-BJewL21s.js","assets/StreamLayerView-jbZELj7M.js","assets/SubtypeGroupLayerView2D-CuP1fmlK.js","assets/VectorTileLayerView2D-CpjgS9go.js","assets/TileInfoViewPOT-BUYkevOY.js","assets/VideoLayerView2D-COKrdb-g.js","assets/GraphicsLayer-BaW3rFbI.js","assets/TelemetryDisplay-CCyTnivY.js","assets/WMSLayerView2D-B5apS6tx.js","assets/WMSLayerView-DNW7Ee-x.js","assets/ExportWMSImageParameters-DTHUeVI2.js","assets/WMTSLayerView2D-BqVpSapO.js","assets/apng-B03vlLwb.js","assets/Lyr3DWasmPerSceneView-bcg-2vZo.js","assets/TileLayerView3D-j-urUfxm.js","assets/LayerView3D-C3wz0Xd_.js","assets/TiledLayerView3D-k4JOMenH.js","assets/fetchTile-4kM03LGo.js","assets/ElevationLayerView3D-vExFKrtw.js","assets/BaseDynamicLayerView3D-Bfh6MbL-.js","assets/DynamicLayerView3D-DAh8gR10.js","assets/projectExtentUtils-dd9OO2QQ.js","assets/geometryServiceUtils-DDNHyfMa.js","assets/ImageMaterial.glsl-DcxC6lC7.js","assets/DefaultLayouts-CGjC8rk2.js","assets/TriangleMaterial-DGLj9Hvg.js","assets/BuildingSceneLayerView3D-DEmj86sv.js","assets/BuildingGroupSublayer-qg7R_Fe6.js","assets/BuildingComponentSublayer-CNJGVt4Y.js","assets/capabilities-B4c8vV3b.js","assets/I3SIndexInfo-MCyed1-U.js","assets/I3SLayerDefinitions-AOZp7r4d.js","assets/I3SMeshView3D-DK94hHOV.js","assets/Transform-4a20F1TP.js","assets/RenderTexture-Bmcrz2_n.js","assets/I3SOverrides-ByAbX-OO.js","assets/resourceUtils-DkMU3AYG.js","assets/SceneModification-DyCQqYsQ.js","assets/persistable-DWAxeq4W.js","assets/resourceExtension-DZqQPpff.js","assets/ExtentSet-qWs8Lc6G.js","assets/rendererConversion-CGpNLgtM.js","assets/attributeUtils-Dc8--CBJ.js","assets/highlightUtils-D2lMfk8z.js","assets/I3SQueryFeatureStore-DnagV2R_.js","assets/TemporalSceneLayerView-CmFt6qu9.js","assets/CatalogLayerView3D-CRHStucf.js","assets/CatalogDynamicGroupLayerView3D-BrFFLlLp.js","assets/CatalogFootprintLayerView3D-CijQWiEm.js","assets/FeatureLayerViewBase3D-DKz4Ln__.js","assets/HeatmapDensity.glsl-B4Yrhe_U.js","assets/dehydratedFeatureComparison-BBO76xQi.js","assets/queryForSymbologySnapping-Bij8ZnaA.js","assets/Graphics3DFeatureProcessor-DGpSCVsO.js","assets/Graphics3DObjectStates-DZcqh-aC.js","assets/EventedSet-CB4NBdOg.js","assets/CSVLayerView3D-gnPFuOIS.js","assets/DimensionLayerView3D-K5x9GVya.js","assets/FeatureLayerView3D-TV5okZA6.js","assets/GeoJSONLayerView3D-bRNsxry2.js","assets/GraphicsLayerView3D-DtFiw4Go.js","assets/GraphicsProcessor-BmJgUgo2.js","assets/GroupLayerView3D-Ck3Majke.js","assets/ImageryLayerView3D-DuTv2Ete.js","assets/IntegratedMeshLayerView3D-BiebvmiW.js","assets/IntegratedMesh3DTilesLayerView3D-BQPGjDlj.js","assets/LineOfSightLayerView3D-BpOaYfd_.js","assets/MapImageLayerView3D-D7ASI1ZX.js","assets/MediaLayerView3D-Dfic_9Qh.js","assets/EditGeometryOperations-B_ujSqy0.js","assets/geometry2dUtils-C5OK12a_.js","assets/keybindings-DIxDEOyk.js","assets/SnappingManagerPool-DZxX4HjI.js","assets/SnappingManager-DEKGuS80.js","assets/viewUtils-D5G6nsnP.js","assets/OGCFeatureLayerView3D-D53-E_xJ.js","assets/PointCloudLayerView3D-ChHyD36e.js","assets/PopupSceneLayerView-DxnfrSf0.js","assets/ViewshedLayerView3D-F2vkIDLc.js","assets/VoxelLayerView3D-D3yaIKgw.js","assets/VoxelGraphic-dvt8DG_Z.js","assets/RouteLayerView3D-BwZ9V9nh.js","assets/SceneLayerView3D-Cbcb_3QL.js","assets/SceneLayerView-A2zk7vGf.js","assets/SceneLayerGraphicsView3D-DlOilbJd.js","assets/StreamLayerView3D-Cl2EVh42.js","assets/ImageryTileLayerView3D-CCNU-D-a.js","assets/VectorTileLayerView3D-DDnDMzSL.js","assets/WFSLayerView3D-DzUMX-9y.js","assets/WMSLayerView3D-DiNS5DpY.js","assets/WMTSLayerView3D-BEkZSYmk.js","assets/AreaMeasurementAnalysisView3D-BYAFXn-s.js","assets/defaultUnit-CJt4JLKh.js","assets/quantityFormatUtils-DKqV-Ju2.js","assets/AnalysisView3D-BKZHpM3V.js","assets/interfaces-js1RL7O8.js","assets/euclideanAreaMeasurementUtils-B2AM7mQd.js","assets/geometryEngine-CfNZEGqf.js","assets/hydrated-BSJF97b-.js","assets/geodesicLengthMeasurementUtils-1KCptDKk.js","assets/LineVisualElement-Dmig6oYe.js","assets/line-sE7VsM4I.js","assets/Segment-mPBsDr12.js","assets/TextOverlayItem-152VUesa.js","assets/lineStippleUtils-CCavR4OV.js","assets/DimensionAnalysisView3D-B2XeOAqT.js","assets/LengthDimension-bHuPM0Z4.js","assets/automaticLengthMeasurementUtils-CjX17wm-.js","assets/ShadedColorMaterial.glsl-ftyccgmu.js","assets/ColorMaterial.glsl-C-PiVLm-.js","assets/dragEventPipeline3D-BgOPl69K.js","assets/InteractiveToolBase-CXcuwHxr.js","assets/memoize-DmxaQ-k8.js","assets/Factory-y-ZtQUmf.js","assets/VerticesVisualElement-DqnH-H5D.js","assets/ExtendedLineVisualElement-Ds1RnamP.js","assets/EngineVisualElement-D9oh89bd.js","assets/LaserlinePath.glsl-7piOlJpM.js","assets/RightAngleQuadVisualElement-r2_Rd_lk.js","assets/SnappingVisualizer-CMv9S1yr.js","assets/PointSnappingHint-Dmq3EHae.js","assets/SnappingOperation-D7WosXl0.js","assets/analysisViewUtils-LLUt6l8J.js","assets/ToolIntersector-DI2Et5aL.js","assets/LineMarker.glsl-BRlFIcDf.js","assets/DirectLineMeasurementAnalysisView3D-DNdcgvQ8.js","assets/LineOfSightAnalysisView3D-CYfG6_Iy.js","assets/featureReferenceUtils-Bk8cvZgN.js","assets/LineOfSightAnalysisTarget-D_E870qR.js","assets/manipulatorUtils-BJgBLxjS.js","assets/SliceAnalysisView3D-B4IYMTCJ.js","assets/SlicePlaneMaterial.glsl-BkhkrmoY.js","assets/sliceToolConfig-keiWzNcS.js","assets/ViewshedAnalysisView3D-32-txqMS.js","assets/Viewshed-DAXA_m8H.js","assets/MoveManipulation-B_C3dVDr.js","assets/VoxelWasmPerSceneView-C4Vq2f2U.js","assets/Graphics3DSymbolLayerFactory-C5gPt9PW.js","assets/interfaces-BDwT84Az.js","assets/MeshComponent-COGmOMBd.js","assets/meshProperties-C4iW0Ukm.js","assets/projectMeshVertexPositions-D67G1xww.js","assets/objectResourceUtils-CzZH4I_S.js","assets/indexUtils-BmXZRBdE.js","assets/loader-BKMYljBs.js","assets/TerrainTileTree3DDebugger-CxSg5O0K.js","assets/TileTreeDebugger-DS28bFpU.js","assets/EdgeView-CE9ssDPM.js","assets/EdgeWorkerHandle-CIkUjmJ-.js","assets/FeatureTileTree3DDebugger-DBVZWuoc.js","assets/GraphicsView3D-i9mFEAy7.js","assets/layersLoader-B3KuHVlW.js","assets/featureLayerUtils-kMtRtEXt.js","assets/utils-CvZeHudG.js","assets/FeatureLayerSource-BHwRnupK.js","assets/External-CIdaeqOx.js","assets/MeshTransform-Bv7hOi4j.js","assets/editingSupport-DEpUndvr.js","assets/QueryTask-DwpM7zko.js","assets/executeForIds-BDcdKIww.js","assets/queryAssociations-DbN0_do5.js","assets/Association-DFLDc9x-.js","assets/synthesizeAssociationGeometries-B-aTcLpB.js","assets/index-jZnFjr-R.js","assets/usePreventDocumentScroll-1IGg61KF.js","assets/math-Ctbd4j0u.js","assets/Sketch-B3HpmcYe.js","assets/SketchOptions-CyxQazxr.js","assets/angularMeasurementUtils-DI0dMEin.js","assets/SketchViewModel-CTTg9q51.js","assets/directionModeIcons-B1HTO4eU.js","assets/MapImageLayer-DqW1aytC.js","assets/SublayersOwner-CKcRDA6F.js","assets/imageBitmapUtils-CM52zmIx.js","assets/ImageryLayer-B6RnnUDZ.js","assets/ImageHistogramParameters-zrbX4tJ9.js","assets/RasterPresetRendererMixin-C1UuS6qM.js","assets/SceneLayer-D3aN2zdt.js","assets/meshSpatialReferenceScaleUtils-C9Q848AO.js","assets/SceneService-DEIro17f.js","assets/VectorTileLayer-Cd1iYfz-.js","assets/TileLayer-Bggtom7-.js"])))=>i.map(i=>d[i]);
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}})();/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const xk=globalThis,fee=xk.ShadowRoot&&(xk.ShadyCSS===void 0||xk.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,mee=Symbol(),Mae=new WeakMap;let r1e=class{constructor(e,i,r){if(this._$cssResult$=!0,r!==mee)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=i}get styleSheet(){let e=this.o;const i=this.t;if(fee&&e===void 0){const r=i!==void 0&&i.length===1;r&&(e=Mae.get(i)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),r&&Mae.set(i,e))}return e}toString(){return this.cssText}};const jUe=t=>new r1e(typeof t=="string"?t:t+"",void 0,mee),Js=(t,...e)=>{const i=t.length===1?t[0]:e.reduce((r,s,n)=>r+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(s)+t[n+1],t[0]);return new r1e(i,t,mee)},GUe=(t,e)=>{if(fee)t.adoptedStyleSheets=e.map(i=>i instanceof CSSStyleSheet?i:i.styleSheet);else for(const i of e){const r=document.createElement("style"),s=xk.litNonce;s!==void 0&&r.setAttribute("nonce",s),r.textContent=i.cssText,t.appendChild(r)}},Oae=fee?t=>t:t=>t instanceof CSSStyleSheet?(e=>{let i="";for(const r of e.cssRules)i+=r.cssText;return jUe(i)})(t):t;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:HUe,defineProperty:qUe,getOwnPropertyDescriptor:WUe,getOwnPropertyNames:ZUe,getOwnPropertySymbols:YUe,getPrototypeOf:JUe}=Object,nV=globalThis,Iae=nV.trustedTypes,XUe=Iae?Iae.emptyScript:"",KUe=nV.reactiveElementPolyfillSupport,cR=(t,e)=>t,fz={toAttribute(t,e){switch(e){case Boolean:t=t?XUe:null;break;case Object:case Array:t=t==null?t:JSON.stringify(t)}return t},fromAttribute(t,e){let i=t;switch(e){case Boolean:i=t!==null;break;case Number:i=t===null?null:Number(t);break;case Object:case Array:try{i=JSON.parse(t)}catch{i=null}}return i}},oV=(t,e)=>!HUe(t,e),Rae={attribute:!0,type:String,converter:fz,reflect:!1,useDefault:!1,hasChanged:oV};Symbol.metadata??=Symbol("metadata"),nV.litPropertyMetadata??=new WeakMap;let hE=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,i=Rae){if(i.state&&(i.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((i=Object.create(i)).wrapped=!0),this.elementProperties.set(e,i),!i.noAccessor){const r=Symbol(),s=this.getPropertyDescriptor(e,r,i);s!==void 0&&qUe(this.prototype,e,s)}}static getPropertyDescriptor(e,i,r){const{get:s,set:n}=WUe(this.prototype,e)??{get(){return this[i]},set(o){this[i]=o}};return{get:s,set(o){const a=s?.call(this);n?.call(this,o),this.requestUpdate(e,a,r)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??Rae}static _$Ei(){if(this.hasOwnProperty(cR("elementProperties")))return;const e=JUe(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(cR("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(cR("properties"))){const i=this.properties,r=[...ZUe(i),...YUe(i)];for(const s of r)this.createProperty(s,i[s])}const e=this[Symbol.metadata];if(e!==null){const i=litPropertyMetadata.get(e);if(i!==void 0)for(const[r,s]of i)this.elementProperties.set(r,s)}this._$Eh=new Map;for(const[i,r]of this.elementProperties){const s=this._$Eu(i,r);s!==void 0&&this._$Eh.set(s,i)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const i=[];if(Array.isArray(e)){const r=new Set(e.flat(1/0).reverse());for(const s of r)i.unshift(Oae(s))}else e!==void 0&&i.push(Oae(e));return i}static _$Eu(e,i){const r=i.attribute;return r===!1?void 0:typeof r=="string"?r:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(e=>e(this))}addController(e){(this._$EO??=new Set).add(e),this.renderRoot!==void 0&&this.isConnected&&e.hostConnected?.()}removeController(e){this._$EO?.delete(e)}_$E_(){const e=new Map,i=this.constructor.elementProperties;for(const r of i.keys())this.hasOwnProperty(r)&&(e.set(r,this[r]),delete this[r]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return GUe(e,this.constructor.elementStyles),e}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach(e=>e.hostConnected?.())}enableUpdating(e){}disconnectedCallback(){this._$EO?.forEach(e=>e.hostDisconnected?.())}attributeChangedCallback(e,i,r){this._$AK(e,r)}_$ET(e,i){const r=this.constructor.elementProperties.get(e),s=this.constructor._$Eu(e,r);if(s!==void 0&&r.reflect===!0){const n=(r.converter?.toAttribute!==void 0?r.converter:fz).toAttribute(i,r.type);this._$Em=e,n==null?this.removeAttribute(s):this.setAttribute(s,n),this._$Em=null}}_$AK(e,i){const r=this.constructor,s=r._$Eh.get(e);if(s!==void 0&&this._$Em!==s){const n=r.getPropertyOptions(s),o=typeof n.converter=="function"?{fromAttribute:n.converter}:n.converter?.fromAttribute!==void 0?n.converter:fz;this._$Em=s,this[s]=o.fromAttribute(i,n.type)??this._$Ej?.get(s)??null,this._$Em=null}}requestUpdate(e,i,r){if(e!==void 0){const s=this.constructor,n=this[e];if(r??=s.getPropertyOptions(e),!((r.hasChanged??oV)(n,i)||r.useDefault&&r.reflect&&n===this._$Ej?.get(e)&&!this.hasAttribute(s._$Eu(e,r))))return;this.C(e,i,r)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(e,i,{useDefault:r,reflect:s,wrapped:n},o){r&&!(this._$Ej??=new Map).has(e)&&(this._$Ej.set(e,o??i??this[e]),n!==!0||o!==void 0)||(this._$AL.has(e)||(this.hasUpdated||r||(i=void 0),this._$AL.set(e,i)),s===!0&&this._$Em!==e&&(this._$Eq??=new Set).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(i){Promise.reject(i)}const e=this.scheduleUpdate();return e!=null&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[s,n]of this._$Ep)this[s]=n;this._$Ep=void 0}const r=this.constructor.elementProperties;if(r.size>0)for(const[s,n]of r){const{wrapped:o}=n,a=this[s];o!==!0||this._$AL.has(s)||a===void 0||this.C(s,void 0,n,a)}}let e=!1;const i=this._$AL;try{e=this.shouldUpdate(i),e?(this.willUpdate(i),this._$EO?.forEach(r=>r.hostUpdate?.()),this.update(i)):this._$EM()}catch(r){throw e=!1,this._$EM(),r}e&&this._$AE(i)}willUpdate(e){}_$AE(e){this._$EO?.forEach(i=>i.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&=this._$Eq.forEach(i=>this._$ET(i,this[i])),this._$EM()}updated(e){}firstUpdated(e){}};hE.elementStyles=[],hE.shadowRootOptions={mode:"open"},hE[cR("elementProperties")]=new Map,hE[cR("finalized")]=new Map,KUe?.({ReactiveElement:hE}),(nV.reactiveElementVersions??=[]).push("2.1.0");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const gee=globalThis,mz=gee.trustedTypes,Pae=mz?mz.createPolicy("lit-html",{createHTML:t=>t}):void 0,s1e="$lit$",C_=`lit$${Math.random().toFixed(9).slice(2)}$`,n1e="?"+C_,QUe=`<${n1e}>`,Gx=document,fP=()=>Gx.createComment(""),mP=t=>t===null||typeof t!="object"&&typeof t!="function",yee=Array.isArray,eBe=t=>yee(t)||typeof t?.[Symbol.iterator]=="function",i6=`[ 	
\f\r]`,ZA=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Dae=/-->/g,Lae=/>/g,nw=RegExp(`>|${i6}(?:([^\\s"'>=/]+)(${i6}*=${i6}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Nae=/'/g,Fae=/"/g,o1e=/^(?:script|style|textarea|title)$/i,a1e=t=>(e,...i)=>({_$litType$:t,strings:e,values:i}),le=a1e(1),gP=a1e(2),pd=Symbol.for("lit-noChange"),Ze=Symbol.for("lit-nothing"),kae=new WeakMap,cx=Gx.createTreeWalker(Gx,129);function l1e(t,e){if(!yee(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return Pae!==void 0?Pae.createHTML(e):e}const tBe=(t,e)=>{const i=t.length-1,r=[];let s,n=e===2?"<svg>":e===3?"<math>":"",o=ZA;for(let a=0;a<i;a++){const l=t[a];let c,h,d=-1,f=0;for(;f<l.length&&(o.lastIndex=f,h=o.exec(l),h!==null);)f=o.lastIndex,o===ZA?h[1]==="!--"?o=Dae:h[1]!==void 0?o=Lae:h[2]!==void 0?(o1e.test(h[2])&&(s=RegExp("</"+h[2],"g")),o=nw):h[3]!==void 0&&(o=nw):o===nw?h[0]===">"?(o=s??ZA,d=-1):h[1]===void 0?d=-2:(d=o.lastIndex-h[2].length,c=h[1],o=h[3]===void 0?nw:h[3]==='"'?Fae:Nae):o===Fae||o===Nae?o=nw:o===Dae||o===Lae?o=ZA:(o=nw,s=void 0);const m=o===nw&&t[a+1].startsWith("/>")?" ":"";n+=o===ZA?l+QUe:d>=0?(r.push(c),l.slice(0,d)+s1e+l.slice(d)+C_+m):l+C_+(d===-2?a:m)}return[l1e(t,n+(t[i]||"<?>")+(e===2?"</svg>":e===3?"</math>":"")),r]};let H9=class c1e{constructor({strings:e,_$litType$:i},r){let s;this.parts=[];let n=0,o=0;const a=e.length-1,l=this.parts,[c,h]=tBe(e,i);if(this.el=c1e.createElement(c,r),cx.currentNode=this.el.content,i===2||i===3){const d=this.el.content.firstChild;d.replaceWith(...d.childNodes)}for(;(s=cx.nextNode())!==null&&l.length<a;){if(s.nodeType===1){if(s.hasAttributes())for(const d of s.getAttributeNames())if(d.endsWith(s1e)){const f=h[o++],m=s.getAttribute(d).split(C_),y=/([.?@])?(.*)/.exec(f);l.push({type:1,index:n,name:y[2],strings:m,ctor:y[1]==="."?rBe:y[1]==="?"?sBe:y[1]==="@"?nBe:lV}),s.removeAttribute(d)}else d.startsWith(C_)&&(l.push({type:6,index:n}),s.removeAttribute(d));if(o1e.test(s.tagName)){const d=s.textContent.split(C_),f=d.length-1;if(f>0){s.textContent=mz?mz.emptyScript:"";for(let m=0;m<f;m++)s.append(d[m],fP()),cx.nextNode(),l.push({type:2,index:++n});s.append(d[f],fP())}}}else if(s.nodeType===8)if(s.data===n1e)l.push({type:2,index:n});else{let d=-1;for(;(d=s.data.indexOf(C_,d+1))!==-1;)l.push({type:7,index:n}),d+=C_.length-1}n++}}static createElement(e,i){const r=Gx.createElement("template");return r.innerHTML=e,r}};function KC(t,e,i=t,r){if(e===pd)return e;let s=r!==void 0?i._$Co?.[r]:i._$Cl;const n=mP(e)?void 0:e._$litDirective$;return s?.constructor!==n&&(s?._$AO?.(!1),n===void 0?s=void 0:(s=new n(t),s._$AT(t,i,r)),r!==void 0?(i._$Co??=[])[r]=s:i._$Cl=s),s!==void 0&&(e=KC(t,s._$AS(t,e.values),s,r)),e}let iBe=class{constructor(e,i){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=i}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:i},parts:r}=this._$AD,s=(e?.creationScope??Gx).importNode(i,!0);cx.currentNode=s;let n=cx.nextNode(),o=0,a=0,l=r[0];for(;l!==void 0;){if(o===l.index){let c;l.type===2?c=new aV(n,n.nextSibling,this,e):l.type===1?c=new l.ctor(n,l.name,l.strings,this,e):l.type===6&&(c=new oBe(n,this,e)),this._$AV.push(c),l=r[++a]}o!==l?.index&&(n=cx.nextNode(),o++)}return cx.currentNode=Gx,s}p(e){let i=0;for(const r of this._$AV)r!==void 0&&(r.strings!==void 0?(r._$AI(e,r,i),i+=r.strings.length-2):r._$AI(e[i])),i++}},aV=class u1e{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,i,r,s){this.type=2,this._$AH=Ze,this._$AN=void 0,this._$AA=e,this._$AB=i,this._$AM=r,this.options=s,this._$Cv=s?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const i=this._$AM;return i!==void 0&&e?.nodeType===11&&(e=i.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,i=this){e=KC(this,e,i),mP(e)?e===Ze||e==null||e===""?(this._$AH!==Ze&&this._$AR(),this._$AH=Ze):e!==this._$AH&&e!==pd&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):eBe(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==Ze&&mP(this._$AH)?this._$AA.nextSibling.data=e:this.T(Gx.createTextNode(e)),this._$AH=e}$(e){const{values:i,_$litType$:r}=e,s=typeof r=="number"?this._$AC(e):(r.el===void 0&&(r.el=H9.createElement(l1e(r.h,r.h[0]),this.options)),r);if(this._$AH?._$AD===s)this._$AH.p(i);else{const n=new iBe(s,this),o=n.u(this.options);n.p(i),this.T(o),this._$AH=n}}_$AC(e){let i=kae.get(e.strings);return i===void 0&&kae.set(e.strings,i=new H9(e)),i}k(e){yee(this._$AH)||(this._$AH=[],this._$AR());const i=this._$AH;let r,s=0;for(const n of e)s===i.length?i.push(r=new u1e(this.O(fP()),this.O(fP()),this,this.options)):r=i[s],r._$AI(n),s++;s<i.length&&(this._$AR(r&&r._$AB.nextSibling,s),i.length=s)}_$AR(e=this._$AA.nextSibling,i){for(this._$AP?.(!1,!0,i);e&&e!==this._$AB;){const r=e.nextSibling;e.remove(),e=r}}setConnected(e){this._$AM===void 0&&(this._$Cv=e,this._$AP?.(e))}},lV=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,i,r,s,n){this.type=1,this._$AH=Ze,this._$AN=void 0,this.element=e,this.name=i,this._$AM=s,this.options=n,r.length>2||r[0]!==""||r[1]!==""?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=Ze}_$AI(e,i=this,r,s){const n=this.strings;let o=!1;if(n===void 0)e=KC(this,e,i,0),o=!mP(e)||e!==this._$AH&&e!==pd,o&&(this._$AH=e);else{const a=e;let l,c;for(e=n[0],l=0;l<n.length-1;l++)c=KC(this,a[r+l],i,l),c===pd&&(c=this._$AH[l]),o||=!mP(c)||c!==this._$AH[l],c===Ze?e=Ze:e!==Ze&&(e+=(c??"")+n[l+1]),this._$AH[l]=c}o&&!s&&this.j(e)}j(e){e===Ze?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}},rBe=class extends lV{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Ze?void 0:e}},sBe=class extends lV{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==Ze)}},nBe=class extends lV{constructor(e,i,r,s,n){super(e,i,r,s,n),this.type=5}_$AI(e,i=this){if((e=KC(this,e,i,0)??Ze)===pd)return;const r=this._$AH,s=e===Ze&&r!==Ze||e.capture!==r.capture||e.once!==r.once||e.passive!==r.passive,n=e!==Ze&&(r===Ze||s);s&&this.element.removeEventListener(this.name,this,r),n&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){typeof this._$AH=="function"?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}},oBe=class{constructor(e,i,r){this.element=e,this.type=6,this._$AN=void 0,this._$AM=i,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(e){KC(this,e)}};const aBe={I:aV},lBe=gee.litHtmlPolyfillSupport;lBe?.(H9,aV),(gee.litHtmlVersions??=[]).push("3.3.0");const cBe=(t,e,i)=>{const r=i?.renderBefore??e;let s=r._$litPart$;if(s===void 0){const n=i?.renderBefore??null;r._$litPart$=s=new aV(e.insertBefore(fP(),n),n,void 0,i??{})}return s._$AI(t),s};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const vee=globalThis;let Xp=class extends hE{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const e=super.createRenderRoot();return this.renderOptions.renderBefore??=e.firstChild,e}update(e){const i=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=cBe(i,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return pd}};Xp._$litElement$=!0,Xp.finalized=!0,vee.litElementHydrateSupport?.({LitElement:Xp});const uBe=vee.litElementPolyfillSupport;uBe?.({LitElement:Xp});(vee.litElementVersions??=[]).push("4.2.0");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const cV=t=>(e,i)=>{i!==void 0?i.addInitializer(()=>{customElements.define(t,e)}):customElements.define(t,e)};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const hBe={attribute:!0,type:String,converter:fz,reflect:!1,hasChanged:oV},dBe=(t=hBe,e,i)=>{const{kind:r,metadata:s}=i;let n=globalThis.litPropertyMetadata.get(s);if(n===void 0&&globalThis.litPropertyMetadata.set(s,n=new Map),r==="setter"&&((t=Object.create(t)).wrapped=!0),n.set(i.name,t),r==="accessor"){const{name:o}=i;return{set(a){const l=e.get.call(this);e.set.call(this,a),this.requestUpdate(o,l,t)},init(a){return a!==void 0&&this.C(o,void 0,t,a),a}}}if(r==="setter"){const{name:o}=i;return function(a){const l=this[o];e.call(this,a),this.requestUpdate(o,l,t)}}throw Error("Unsupported decorator location: "+r)};function cA(t){return(e,i)=>typeof i=="object"?dBe(t,e,i):((r,s,n)=>{const o=s.hasOwnProperty(n);return s.constructor.createProperty(n,r),o?Object.getOwnPropertyDescriptor(s,n):void 0})(t,e,i)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function Cv(t){return cA({...t,state:!0,attribute:!1})}var pBe=Object.defineProperty,fBe=Object.getOwnPropertyDescriptor,_ee=(t,e,i,r)=>{for(var s=r>1?void 0:r?fBe(e,i):e,n=t.length-1,o;n>=0;n--)(o=t[n])&&(s=(r?o(e,i,s):o(s))||s);return r&&s&&pBe(e,i,s),s};let yP=class extends Xp{constructor(){super(...arguments),this.view=null,this.is3D=!1}updated(t){t.has("view")&&this.view&&this.view.ui.add(this,"top-left")}setView(t){this.view=t}toggleView(){this.is3D=!this.is3D,this.dispatchEvent(new CustomEvent("view-switch",{detail:{is3D:this.is3D},bubbles:!0,composed:!0}))}render(){return le`
      <button @click=${this.toggleView}>
        Switch to ${this.is3D?"2D":"3D"}
      </button>
    `}};yP.styles=Js`
    :host {
      display: block;
    }
    button {
      /* Remove absolute positioning, let ArcGIS UI handle it */
      background: white;
      border: 1px solid #999;
      padding: 0.5rem 1rem;
      font-size: 14px;
      cursor: pointer;
    }
  `;_ee([cA({attribute:!1})],yP.prototype,"view",2);_ee([Cv()],yP.prototype,"is3D",2);yP=_ee([cV("view-switcher")],yP);function u(t,e,i,r){var s,n=arguments.length,o=n<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,i):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(o=(n<3?s(o):n>3?s(e,i,o):s(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o}function m6t(t,e){return function(i,r){e(i,r,t)}}function g6t(t,e,i,r){function s(n){return n instanceof i?n:new i(function(o){o(n)})}return new(i||(i=Promise))(function(n,o){function a(h){try{c(r.next(h))}catch(d){o(d)}}function l(h){try{c(r.throw(h))}catch(d){o(d)}}function c(h){h.done?n(h.value):s(h.value).then(a,l)}c((r=r.apply(t,[])).next())})}function y6t(t,e,i){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose]}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(n){return Promise.reject(n)}}),t.stack.push({value:e,dispose:r,async:i})}return e}var mBe=typeof SuppressedError=="function"?SuppressedError:function(t,e,i){var r=new Error(i);return r.name="SuppressedError",r.error=t,r.suppressed=e,r};function v6t(t){function e(n){t.error=t.hasError?new mBe(n,t.error,"An error was suppressed during disposal."):n,t.hasError=!0}var i,r=0;function s(){for(;i=t.stack.pop();)try{if(!i.async&&r===1)return r=0,t.stack.push(i),Promise.resolve().then(s);if(i.dispose){var n=i.dispose.call(i.value);if(i.async)return r|=2,Promise.resolve(n).then(s,function(o){return e(o),s()})}else r|=1}catch(o){e(o)}if(r===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return s()}let F_;function X(t){return typeof F_[t]=="function"?F_[t]=F_[t](globalThis):F_[t]}F_=globalThis.dojoConfig?.has||globalThis.esriConfig?.has?{...globalThis.dojoConfig?.has,...globalThis.esriConfig?.has}:{},X.add=(t,e,i,r)=>{(r||F_[t]===void 0)&&(F_[t]=e),i&&X(t)},X.cache=F_,X.add("big-integer-warning-enabled",!0),X.add("esri-deprecation-warnings",!0),X.add("esri-tests-disable-screenshots",!1),X.add("esri-tests-use-full-window",!1),X.add("esri-tests-post-to-influx",!0),X.add("esri-cim-animations-enable-status","enabled"),X.add("esri-cim-animations-spotlight",!1),X.add("esri-cim-animations-freeze-time",!1),X.add("enable-feature:multiple-highlights",!0),(()=>{X.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(X.add("host-browser",t),X.add("host-node",typeof globalThis.process=="object"&&globalThis.process.versions?.node&&globalThis.process.versions.v8),X.add("dom",t),X("host-browser")){const e=navigator,i=e.userAgent,r=e.appVersion,s=parseFloat(r);if(X.add("wp",parseFloat(i.split("Windows Phone")[1])||void 0),X.add("msapp",parseFloat(i.split("MSAppHost/")[1])||void 0),X.add("khtml",r.includes("Konqueror")?s:void 0),X.add("edge",parseFloat(i.split("Edge/")[1])||void 0),X.add("opr",parseFloat(i.split("OPR/")[1])||void 0),X.add("webkit",!X("wp")&&!X("edge")&&parseFloat(i.split("WebKit/")[1])||void 0),X.add("chrome",!X("edge")&&!X("opr")&&parseFloat(i.split("Chrome/")[1])||void 0),X.add("android",!X("wp")&&parseFloat(i.split("Android ")[1])||void 0),X.add("safari",!r.includes("Safari")||X("wp")||X("chrome")||X("android")||X("edge")||X("opr")?void 0:parseFloat(r.split("Version/")[1])),X.add("mac",r.includes("Macintosh")),!X("wp")&&/(iPhone|iPod|iPad)/.test(i)){const n=RegExp.$1.replace(/P/,"p"),o=/OS ([\d_]+)/.test(i)?RegExp.$1:"1",a=parseFloat(o.replace(/_/,".").replaceAll("_",""));X.add(n,a),X.add("ios",a)}X("webkit")||(!i.includes("Gecko")||X("wp")||X("khtml")||X("edge")||X.add("mozilla",s),X("mozilla")&&X.add("ff",parseFloat(i.split("Firefox/")[1]||i.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),i=/iPhone/i.test(t);e&&X.add("esri-mobile",e),i&&X.add("esri-iPhone",i),X.add("esri-geolocation",!!navigator.geolocation)}X.add("esri-wasm","WebAssembly"in globalThis),X.add("esri-performance-mode-frames-between-render",20),X.add("esri-force-performance-mode",!1),X.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),X.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),X.add("esri-atomics","Atomics"in globalThis),X.add("esri-workers","Worker"in globalThis),X.add("web-feat:cache","caches"in globalThis),X.add("esri-workers-arraybuffer-transfer",!X("safari")||Number(X("safari"))>=12),X.add("workers-pool-size",8),X.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),X.add("featurelayer-simplify-payload-size-factors",[1,1,4]),X.add("featurelayer-fast-triangulation-enabled",!0),X.add("featurelayer-animation-enabled",!0),X.add("featurelayer-snapshot-enabled",!0),X.add("featurelayer-snapshot-point-min-threshold",8e4),X.add("featurelayer-snapshot-point-max-threshold",4e5),X.add("featurelayer-snapshot-point-coverage",.1),X.add("featurelayer-query-max-depth",4),X.add("featurelayer-query-pausing-enabled",!1),X.add("featurelayer-advanced-symbols",!1),X.add("featurelayer-pbf",!0),X.add("featurelayer-pbf-statistics",!1),X.add("feature-layers-workers",!0),X.add("feature-polyline-generalization-factor",1),X.add("mapview-transitions-duration",200),X.add("mapview-essential-goto-duration",200),X.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),X.add("mapserver-pbf-version-support",10.81),X.add("mapservice-popup-identify-max-tolerance",20),X.add("request-queue-concurrency-hosted",16),X.add("request-queue-concurrency-non-hosted",4),X.add("curve-densification-coarse-segments",128),X.add("curve-densification-max-segments",2e3),X.add("curve-densification-min-segments",3),X.add("curve-densification-pixels-per-segment",16),X.add("view-readyState-waiting-delay",1e3),X.add("gradient-depth-bias",.01),X.add("gradient-depth-epsilon",1e-8),X("host-webworker")||X("host-browser")&&(X.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),X.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{X.add("esri-image-decode",!0,!0,!0)}).catch(()=>{X.add("esri-image-decode",!1,!0,!0)})}return!1}),X.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();function _6t(t){}function gBe(t){return()=>t}function b6t(t){return t}let Sk=class jw{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*jw._m}getInt(){return this._seed=(jw._a*this._seed+jw._c)%jw._m,this._seed}getFloat(){return this.getInt()/(jw._m-1)}getIntRange(e,i){return Math.round(this.getFloatRange(e,i))}getFloatRange(e,i){const r=i-e;return e+this.getInt()/jw._m*r}};Sk._m=2147483647,Sk._a=48271,Sk._c=0;const h1e=1.5,w6t=1/h1e,x6t=.5;function Tk(t,e){return e?t.filter((i,r,s)=>s.findIndex(e.bind(null,i))===r):Array.from(new Set(t))}function Hm(t,e,i){if(t==null&&e==null)return!0;if(t==null||e==null||t.length!==e.length)return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function yBe(t,e){let i=t.length!==e.length;i&&(t.length=e.length);for(let r=0;r<e.length;++r)t[r]!==e[r]&&(t[r]=e[r],i=!0);return i}function q9(t,e,i){let r,s;return i?(r=e.filter(n=>!t.some(o=>i(o,n))),s=t.filter(n=>!e.some(o=>i(o,n)))):(r=e.filter(n=>!t.includes(n)),s=t.filter(n=>!e.includes(n))),{added:r,removed:s}}function vBe(t){return t&&typeof t.length=="number"}function S6t(t,e){const i=t.length;if(i===0)return[];const r=[];for(let s=0;s<i;s+=e)r.push(t.slice(s,s+e));return r}function T6t(t,e,i){const r=t.length;let s=0,n=r-1;for(;s<n;){const a=s+Math.floor((n-s)/2);e>t[a]?s=a+1:n=a}const o=t[s];return i?e>=t[r-1]?-1:o===e?s:s-1:o===e?s:-1}let d1e=class{constructor(){this.last=0}};const p1e=new d1e;function W9(t,e,i,r){r=r||p1e;const s=Math.max(0,r.last-10);for(let o=s;o<i;++o)if(t[o]===e)return r.last=o,o;const n=Math.min(s,i);for(let o=0;o<n;++o)if(t[o]===e)return r.last=o,o;return-1}function vP(t,e,i,r){const s=t.length,n=W9(t,e,s,r);if(n!==-1)return t[n]=t[s-1],t.pop(),e}const Bd=new Set;function _Be(t,e,i=t.length,r=e.length,s,n){if(r===0||i===0)return i;Bd.clear();for(let a=0;a<r;++a)Bd.add(e[a]);s=s||p1e;const o=Math.max(0,s.last-10);for(let a=o;a<i;++a)if(Bd.has(t[a])&&(n?.push(t[a]),Bd.delete(t[a]),t[a]=t[i-1],--i,--a,Bd.size===0||i===0))return Bd.clear(),i;for(let a=0;a<o;++a)if(Bd.has(t[a])&&(n?.push(t[a]),Bd.delete(t[a]),t[a]=t[i-1],--i,--a,Bd.size===0||i===0))return Bd.clear(),i;return Bd.clear(),i}function bBe(t,e){let i=0;for(let r=0;r<t.length;++r){const s=t[r];e(s,r)&&(t[i]=s,i++)}t.length=i}function C6t(t,e,i){const r=t.length;if(e>=r)return t.slice();const s=bee(i),n=new Set,o=[];for(;o.length<e;){const a=Math.floor(s()*r);n.has(a)||(n.add(a),o.push(t[a]))}return o}function bee(t){return t?(zae.seed=t,()=>zae.getFloat()):Math.random}const zae=new Sk;function f1e(t,e){const i=bee(e);for(let r=t.length-1;r>0;r--){const s=Math.floor(i()*(r+1)),n=t[r];t[r]=t[s],t[s]=n}return t}function U3(t,e){const i=t.indexOf(e);return i!==-1?(t.splice(i,1),e):null}function of(t,e){return t!=null}const wBe=[];function lO(t){return t instanceof ArrayBuffer}function wee(t){return t?.constructor?.name==="Int8Array"}function k_(t){return t?.constructor?.name==="Uint8Array"}function m1e(t){return t?.constructor?.name==="Uint8ClampedArray"}function xee(t){return t?.constructor?.name==="Int16Array"}function uV(t){return t?.constructor?.name==="Uint16Array"}function See(t){return t?.constructor?.name==="Int32Array"}function Tee(t){return t?.constructor?.name==="Uint32Array"}function B3(t){return t?.constructor?.name==="Float32Array"}function V3(t){return t?.constructor?.name==="Float64Array"}function j3(t){return"buffer"in t}const rh=1024;function $6t(t){return V3(t)||B3(t)||See(t)||xee(t)||wee(t)}function A6t(t){return V3(t)||B3(t)}function M6t(t){return V3(t)?179769e303:B3(t)?3402823e32:Tee(t)?4294967295:uV(t)?65535:k_(t)||m1e(t)?255:See(t)?2147483647:xee(t)?32767:wee(t)?127:256}function xBe(t,e){let i;for(i in t)t.hasOwnProperty(i)&&t[i]===void 0&&delete t[i];return t}function q(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=v1e(t);if(e!=null)return e;if(gz(t))return t.clone();if(g1e(t))return t.map(q);if(y1e(t))throw new Error("Trying to clone an unclonable Accessor instance");const i={};for(const r of Object.getOwnPropertyNames(t))i[r]=q(t[r]);return i}function Z9(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=v1e(t);if(e!=null)return e;if(g1e(t)){let r=!0;const s=t.map(n=>{const o=Z9(n);return n!=null&&o==null&&(r=!1),o});return r?s:null}if(gz(t))return t.clone();if(t instanceof File||t instanceof Blob)return t;if(y1e(t))return null;const i=new(Object.getPrototypeOf(t)).constructor;for(const r of Object.getOwnPropertyNames(t)){const s=t[r],n=Z9(s);if(s!=null&&n==null)return null;i[r]=n}return i}function gz(t){return typeof t.clone=="function"}function g1e(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function y1e(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function Uae(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function v1e(t){if(wee(t)||k_(t)||m1e(t)||xee(t)||uV(t)||See(t)||Tee(t)||B3(t)||V3(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[i,r]of t)e.set(i,q(r));return e}if(t instanceof Set){const e=new Set;for(const i of t)e.add(q(i));return e}return null}function Eee(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof t?.getTime=="function"&&typeof e?.getTime=="function"&&t.getTime()===e.getTime()||!1}function _1e(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&Hm(t,e):t instanceof Set?e instanceof Set&&TBe(t,e):t instanceof Map?e instanceof Map&&EBe(t,e):!!Uae(t)&&Uae(e)&&SBe(t,e))}function SBe(t,e){if(t===null||e===null)return!1;const i=Object.keys(t);if(e===null||Object.keys(e).length!==i.length)return!1;for(const r of i)if(t[r]!==e[r]||!Object.prototype.hasOwnProperty.call(e,r))return!1;return!0}function TBe(t,e){if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function EBe(t,e){if(t.size!==e.size)return!1;for(const[i,r]of t){const s=e.get(i);if(s!==r||s===void 0&&!e.has(i))return!1}return!0}function Cee(t,e,i=!1){return w1e(t,e,i)}function hV(t,e){if(e!=null)return e[t]||b1e(t.split("."),!1,e)}function to(t,e,i){const r=t.split("."),s=r.pop(),n=b1e(r,!0,i);n&&s&&(n[s]=e)}function Bae(t,e){if(t==null&&e==null)return!1;if(t==null||e==null)return!0;if(typeof t=="object"){if(Array.isArray(t)){const i=e;if(t.length!==i.length)return!0;for(let r=0;r<t.length;r++)if(Bae(t[r],i[r]))return!0;return!1}if(Object.keys(t).length!==Object.keys(e).length)return!0;for(const i in t)if(Bae(t[i],e[i]))return!0;return!1}return t!==e}function b1e(t,e,i){let r=i;for(const s of t){if(r==null)return;if(!(s in r)){if(!e)return;r[s]={}}r=r[s]}return r}function w1e(t,e,i){return e?Object.keys(e).reduce((r,s)=>{let n=r[s],o=e[s];return n===o?r:n===void 0?(r[s]=q(o),r):(Array.isArray(o)||Array.isArray(r)?(n=n?Array.isArray(n)?r[s]=n.slice():r[s]=[n]:r[s]=[],o&&(Array.isArray(o)||(o=[o]),i?o.forEach(a=>{n.includes(a)||n.push(a)}):r[s]=o.slice())):o&&typeof o=="object"?r[s]=w1e(n,o,i):r.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(r[s]=o),r)},t||{}):t}const Ir={apiKey:void 0,applicationName:"",applicationUrl:globalThis.location?.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!0,portalUrl:"https://www.arcgis.com",respectPrefersReducedMotion:!0,routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],internalInterceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:62e3,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(Cee(Ir,globalThis.esriConfig,!0),delete Ir.has),!Ir.assetsPath){{const t="4.32";Ir.assetsPath=`https://js.arcgis.com/${t}/@arcgis/core/assets`}Ir.defaultAssetsPath=Ir.assetsPath}const CBe=/\{([^}]+)\}/g;function Vae(t){return t??""}function G3(t,e){return e?t.replaceAll(CBe,typeof e=="object"?(i,r)=>Vae(hV(r,e)):(i,r)=>Vae(e(r))):t}function O6t(t,e){return t.replaceAll(/([.$?*|{}()[\]\\/+\-^])/g,i=>e?.includes(i)?i:`\\${i}`)}function x1e(t){let e=0;for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return e}let jae;function I6t(t){return jae??=new DOMParser,jae.parseFromString(t||"","text/html").body.innerText||""}function R6t(t,e){return new RegExp(`{${e}}`,"ig").test(t)}function $Be(t,...e){let i=t[0];for(let r=0;r<e.length;++r)i+=e[r]+t[r+1];return i}const Gae={info:0,warn:1,error:2,none:3};let J=class bu{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,bu._loggers.set(this.module,this);const i=this.module.lastIndexOf(".");i!==-1&&(this._parent=bu.getLogger(this.module.slice(0,i)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){}static get test(){}static getLogger(e){return e=typeof e!="string"?e.declaredClass:e,bu._loggers.get(e)||new bu({module:e})}_log(e,i,...r){if(this._matchLevel(e)){if(i!=="always"&&!bu._throttlingDisabled){const s=MBe(r),n=this._loggedMessages[e].get(s);if(i==="once"&&n!=null||i==="oncePerTick"&&n&&n>=bu._tickCounter)return;this._loggedMessages[e].set(s,bu._tickCounter),bu._scheduleTickCounterIncrement()}for(const s of Ir.log.interceptors)if(s(e,this.module,...r))return;this._inheritedWriter()(e,this.module,...r)}}_parentWithMember(e,i){let r=this;for(;r!=null;){const s=r[e];if(s!=null)return s;r=r.parent}return i}_inheritedWriter(){return this._parentWithMember("writer",ABe)}_matchLevel(e){const i=Ir.log.level||"warn";return Gae[this._parentWithMember("level",i)]<=Gae[e]}static _scheduleTickCounterIncrement(){bu._tickCounterScheduled||(bu._tickCounterScheduled=!0,Promise.resolve().then(()=>{bu._tickCounter++,bu._tickCounterScheduled=!1}))}};function ABe(t,e,...i){console[t](`[${e}]`,...i)}function MBe(...t){return x1e(JSON.stringify(t,(i,r)=>typeof r!="object"||Array.isArray(r)?r:"[Object]"))}J._loggers=new Map,J._tickCounter=0,J._tickCounterScheduled=!1,J._throttlingDisabled=!1;function vm(t,e){for(const i of t.values())if(e(i))return!0;return!1}function P6t(t,e){for(const i of t.values())if(e(i))return i;return null}function zb(t,e,i){const r=t.get(e);if(r!==void 0)return r;const s=i();return t.set(e,s),s}function D6t(t){const e=new Map;return i=>(e.has(i)||e.set(i,t(i)),e.get(i))}const gC=()=>J.getLogger("esri.core.accessorSupport.ensureTypes");function OBe(t){return t==null?t:new Date(t)}function IBe(t){return t==null?t:!!t}function H3(t){return t==null?t:t.toString()}function ec(t,e=0){return t==null?t:(t=parseFloat(t),isNaN(t)?e:t)}function $ee(t){return t==null?t:Math.round(parseFloat(t))}function RBe(t){return null}function PBe(t,e){return i=>{let r=t(i);return e.step!=null&&(r=Math.round(r/e.step)*e.step),e.min!=null&&(r=Math.max(e.min,r)),e.max!=null&&(r=Math.min(e.max,r)),r}}function S1e(t){return t?.constructor&&t.constructor.__accessorMetadata__!==void 0}function yz(t,e){return e!=null&&t&&!(e instanceof t)}function T1e(t){return t&&"isCollection"in t}function Hae(t){return t?.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function DBe(t,e){if(!e?.constructor||!T1e(e.constructor))return Y9(t,e)?e:new t(e);const i=Hae(t.prototype.itemType),r=Hae(e.constructor.prototype.itemType);return i?r?i===r?e:i.prototype.isPrototypeOf(r.prototype)?new t(e):(Y9(t,e),e):new t(e):e}function Y9(t,e){return!!S1e(e)&&(gC().error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+dV(t)+"'"),!0)}function uA(t,e){return e==null?e:T1e(t)?DBe(t,e):yz(t,e)?Y9(t,e)?e:new t(e):e}function dV(t){return t?.prototype?.declaredClass||"unknown"}const LBe=new WeakMap;function NBe(t){switch(t){case Number:return e=>ec(e);case Ei:return $ee;case Boolean:return IBe;case String:return H3;case Date:return OBe;case hA:return RBe;default:return zb(LBe,t,()=>uA.bind(null,t))}}function Is(t,e){const i=NBe(t);return arguments.length===1?i:i(e)}function _P(t,e,i){return arguments.length===1?_P.bind(null,t):e&&(Array.isArray(e)?e.map(r=>t(r,i)):[t(e,i)])}function FBe(t,e){return arguments.length===1?_P(i=>Is(t,i)):_P(i=>Is(t,i),e)}function E1e(t,e,i){return e!==0&&Array.isArray(i)?i.map(r=>E1e(t,e-1,r)):t(i)}function vz(t,e,i){if(arguments.length===2)return n=>vz(t,e,n);if(!i)return i;i=E1e(t,e,i);let r=e,s=i;for(;r>0&&Array.isArray(s);)r--,s=s[0];if(s!==void 0)for(let n=0;n<r;n++)i=[i];return i}function kBe(t,e,i){return arguments.length===2?vz(r=>Is(t,r),e):vz(r=>Is(t,r),e,i)}function C1e(t){return!!Array.isArray(t)&&!t.some(e=>{const i=typeof e;return!(i==="string"||i==="number"||i==="function"&&t.length>1)})}function J9(t,e){if(arguments.length===2)return J9(t).call(null,e);const i=new Set,r=t.filter(a=>typeof a!="function"),s=t.filter(a=>typeof a=="function");for(const a of t)typeof a!="string"&&typeof a!="number"||i.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,h=c==="string"||c==="number";return h&&(i.has(a)||s.some(d=>c==="string"&&d===String||c==="number"&&d===Number))||c==="object"&&s.some(d=>!yz(a,d))?a:(h&&r.length?(n||(n=r.map(d=>typeof d=="string"?`'${d}'`:`${d}`).join(", ")),gC().error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(d=>dV(d)).join(", ")),gC().error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):gC().error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function Sd(t,e){if(arguments.length===2)return Sd(t).call(null,e);const i={},r=[],s=[];for(const l in t.typeMap){const c=t.typeMap[l];i[l]=Is(c),r.push(dV(c)),s.push(l)}const n=()=>`'${r.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!yz(t.base,l)||l==null)return l;const c=a(l)||t.defaultKeyValue,h=i[c];if(!h)return gC().error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!yz(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!S1e(l)){const d={};for(const f in l)f!==t.key&&(d[f]=l[f]);return h(d)}return h(l)}}let Ei=class{},hA=class{};const F6t={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function zBe(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function $1e(t){switch(t.type){case"native":return Is(t.value);case"array":return _P($1e(t.value));case"one-of":return UBe(t);default:return null}}function UBe(t){let e=null;return(i,r)=>K9(i,t)?i:(e==null&&(e=X9(t)),gC().error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),r&&(r.valid=!1),null)}function X9(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Ei:return"integer";case Date:return"date";case hA:return"null";default:return dV(t.value)}case"array":return`array of ${X9(t.value)}`;case"one-of":{const e=t.values.map(i=>X9(i));return`one of ${e.slice(0,-1)} or ${e[e.length-1]}`}}return"unknown"}function K9(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case Ei:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string";case hA:return t===null}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(i=>!K9(i,e.value));case"one-of":return e.values.some(i=>K9(t,i))}}const BBe={remove:()=>{}};function $i(t){return t?{remove(){t&&(t(),t=void 0)}}:BBe}function A1e(t){t.forEach(e=>e?.remove())}function k6t(t){A1e(t),t.length=0}function q3(t){return $i(()=>A1e(t))}function z6t(t){return $i(()=>t()?.remove())}function U6t(t){return $i(()=>t?.abort())}function M1e(t){return $i(t!=null?()=>t.destroy():void 0)}function El(t){return t.__accessor__??null}function VBe(t,e){return t?.metadata?.[e]!=null}function Ek(t,e,i){return i?_z(t,e,{policy:i,path:""}):_z(t,e,null)}function _z(t,e,i){return e?Object.keys(e).reduce((r,s)=>{const n=s;let o=null,a="merge";if(i&&(o=i.path?`${i.path}.${s}`:s,a=i.policy(o)),a==="replace"||a==="replace-arrays"&&Array.isArray(r[n]))return r[n]=e[n],r;if(r[n]===void 0)return r[n]=q(e[n]),r;let l=r[n],c=e[n];if(l===c)return r;if(Array.isArray(c)||Array.isArray(r))l=l?Array.isArray(l)?r[n]=l.slice():r[n]=[l]:r[n]=[],c&&(Array.isArray(c)||(c=[c]),c.forEach(h=>{l.includes(h)||l.push(h)}));else if(c&&typeof c=="object")if(i){const h=i.path;i.path=o,r[n]=_z(l,c,i),i.path=h}else r[n]=_z(l,c,null);else r.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(r[n]=c);return r},t||{}):t}function O1e(t){return Array.isArray(t)?t:t.split(".")}function qae(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function jBe(t){if(Array.isArray(t)){const e=[];for(const i of t)e.push(...qae(i));return e}return qae(t)}function I1e(t,e,i,r){const s=jBe(e);if(s.length!==1){const n=s.map(o=>r(t,o,i));return q3(n)}return r(t,s[0],i)}function R1e(t,e){const i=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const s=parseInt(i,10);if(!isNaN(s))return Array.isArray(e)?e[s]:e.at(s)}const r=El(e);return VBe(r,i)?r.get(i):e[i]}function P1e(t,e,i){if(t==null)return t;const r=R1e(e[i],t);return!r&&i<e.length-1?void 0:i===e.length-1?r:P1e(r,e,i+1)}function W3(t,e,i=0){return typeof e!="string"||e.includes(".")?P1e(t,O1e(e),i):R1e(e,t)}function Rm(t,e){return W3(t,e)}function Wae(t,e){return W3(e,t)!==void 0}function Z3(t){let e=t.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!i){e=Object.create(e);for(const r in e)e[r]=q(e[r]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function pV(t,e){const i=Z3(t);let r=i[e];return r||(r=i[e]={}),r}function GBe(t,e){return Ek(t,e,qBe)}const HBe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function qBe(t){return HBe.test(t)?"replace":"merge"}function WBe(t,e){return t.replaceAll(/\$\{([^\s:}]*)(?::([^\s:}]+))?\}/g,(i,r)=>r===""?"$":(hV(r,e)??"").toString())}let D1e=class{constructor(e,i,r=void 0){this.name=e,this.details=r,this.message=(i&&WBe(i,r))??""}toString(){return"["+this.name+"]: "+this.message}},U=class L1e extends D1e{constructor(e,i,r){super(e,i,r)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,i)=>{if(i&&typeof i=="object"&&typeof i.toJSON=="function")return i;try{return q(i)}catch{return"[object]"}}))}}catch(e){throw J.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new L1e(e.name,e.message,e.details)}};U.prototype.type="error";function bz(t,e,i){if(t&&e)if(typeof e=="object")for(const r of Object.getOwnPropertyNames(e))bz(t,r,e[r]);else{if(e.includes(".")){const s=e.split("."),n=s.splice(-1,1)[0];return void bz(Rm(t,s),n,i)}const r=t.__accessor__;r!=null&&ZBe(e,r),t[e]=i}}function ZBe(t,e){if(X("esri-unknown-property-errors")&&!YBe(t,e))throw new U("set:unknown-property",JBe(t,e))}function YBe(t,e){return e.metadata[t]!=null}function JBe(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}function p(t={}){return(e,i)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${i}. Accessor does not support static properties.`);const r=Object.getOwnPropertyDescriptor(e,i),s=pV(e,i);r&&(r.get||r.set?(s.get=r.get||s.get,s.set=r.set||s.set):"value"in r&&("value"in t&&J.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${e.constructor.name}" already defined in the metadata`,t),s.value=t.value=r.value)),t.readOnly!=null&&(s.readOnly=t.readOnly);const n=t.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let h;s.dependsOn=[l],s.get=function(){let d=Rm(this,l);if(typeof d=="function"){h||(h=l.split(".").slice(0,-1).join("."));const f=Rm(this,h);f&&(d=d.bind(f))}return d},s.readOnly||(s.set=c?function(d){this._override(i,d)}:function(d){bz(this,l,d)})}const o=t.type,a=t.types;if(!s.cast){let l;o?l=XBe(o):a&&(l=Array.isArray(a)?_P(Sd(a[0])):Sd(a)),t.cast=KBe(t.cast,l)}GBe(s,t),t.range&&(s.cast=PBe(s.cast,t.range))}}function N1e(t,e,i){const r=pV(t,i);r.json||(r.json={});let s=r.json;return e!==void 0&&(s.origins||(s.origins={}),s.origins[e]||(s.origins[e]={}),s=s.origins[e]),s}function XBe(t){let e=0,i=t;if(zBe(t))return $1e(t);for(;Array.isArray(i)&&i.length===1&&typeof i[0]!="string"&&typeof i[0]!="number";)i=i[0],e++;const r=i;if(C1e(r))return e===0?J9(r):vz(J9(r),e);if(e===1)return FBe(r);if(e>1)return kBe(r,e);const s=t;return s.from?s.from:Is(s)}function KBe(t,e){if(t||e)return t?e?(i,r)=>e(t(i,r),r):t:e}const F1e=Symbol("Accessor-beforeDestroy");var Bc;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED",t[t.DESTROYED=3]="DESTROYED"})(Bc||(Bc={}));var Ur;(function(t){t[t.Dirty=1]="Dirty",t[t.Overridden=2]="Overridden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(Ur||(Ur={}));let fV=class{constructor(e){this.accessed=void 0,this._handles=void 0,this._observer=e}destroy(){this.accessed?.clear(),this.clear()}onAccessed(e){this._observer!=null&&e!==this._observer&&(this.accessed==null&&(this.accessed=new Set),this.accessed.add(e))}onTrackingEnd(){this._observer!=null&&(this.clear(),this.accessed!=null&&(this._handles==null&&(this._handles=[]),this.accessed.forEach(e=>{this._handles.push(e.observe(this._observer))}),this.accessed.clear()))}clear(){if(this._handles!=null){for(let e=0;e<this._handles.length;++e)this._handles[e].remove();this._handles.length=0}}};const wz=new fV,cO=[];let uR=wz;function It(t){uR.onAccessed(t)}let Ck=!1,$k=!1;function iv(t,e,i){if(Ck)return Aee(t,e,i);let r=null;return k1e(t),r=e.call(i),z1e(),r}function QBe(t,e){return iv(wz,t,e)}function Aee(t,e,i){const r=Ck;Ck=!0,k1e(t);let s=null;try{s=e.call(i)}catch(n){$k&&J.getLogger("esri.core.accessorSupport.tracking").error(n)}return z1e(),Ck=r,s}function k1e(t){uR=t,cO.push(t)}function z1e(){const t=cO.length;if(t>1){const e=cO.pop();uR=cO[t-2],e.onTrackingEnd()}else if(t===1){const e=cO.pop();uR=wz,e.onTrackingEnd()}else uR=wz}function U1e(t,e){if(e.flags&Ur.DepTrackingInitialized)return;e.flags|=Ur.DepTrackingInitialized;const i=$k;$k=!1,e.flags&Ur.AutoTracked?Aee(e.trackingTarget,e.metadata.get,t):B1e(t,e),$k=i}const eVe=[];function B1e(t,e){e.flags&Ur.ExplicitlyTracking||(e.flags|=Ur.ExplicitlyTracking,Aee(e.trackingTarget,()=>{const i=e.metadata.dependsOn||eVe;for(const r of i)if(typeof r!="string"||r.includes(".")){const s=O1e(r);for(let n=0,o=t;n<s.length&&o!=null&&typeof o=="object";++n)o=Zae(o,s[n],n!==s.length-1)}else Zae(t,r,!1)}),e.flags&=~Ur.ExplicitlyTracking)}function Zae(t,e,i){const r=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const n=parseInt(r,10);if(!isNaN(n))return Array.isArray(t)?t[n]:t.at(n)}const s=El(t);if(s){const n=s.propertiesByName.get(r);n&&(It(n),U1e(t,n))}return i?t[r]:void 0}function tVe(t){if(t.json&&t.json.origins){const e=t.json.origins,i={"web-document":["web-scene","web-map"]};for(const r in i)if(e[r]){const s=e[r];i[r].forEach(n=>{e[n]=s}),delete e[r]}}}let sh=class extends D1e{constructor(e,i,r){super(e,i,r)}};sh.prototype.type="warning";function V1e(t){return!!t&&t.prototype?.declaredClass&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const Q9=()=>J.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function Yae(t,e,i){t&&(!i&&!e.read||e.read?.reader||e.read?.enabled===!1||sVe(t)&&to("read.reader",dA(t),e))}function dA(t){const e=t.ndimArray??0;if(e>1)return rVe(t);if(e===1)return Jae(t);if("type"in t&&G1e(t.type)){const i=t.type.prototype?.itemType?.Type,r=Jae(typeof i=="function"?{type:i}:{types:i});return(s,n,o)=>{const a=r(s,n,o);return a&&new t.type(a)}}return Mee(t)}function Mee(t){return"type"in t?iVe(t.type):nVe(t.types)}function iVe(t){return t.prototype.read?(e,i,r)=>{if(e==null)return e;const s=typeof e;if(s!=="object")return void Q9().error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${s}'`);const n=new t;return n.read(e,r),n}:t.fromJSON}function j1e(t,e,i,r){return r!==0&&Array.isArray(e)?e.map(s=>j1e(t,s,i,r-1)):t(e,void 0,i)}function rVe(t){const e=Mee(t),i=j1e.bind(null,e),r=t.ndimArray??0;return(s,n,o)=>{if(s==null)return s;s=i(s,o,r);let a=r,l=s;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)s=[s];return s}}function Jae(t){const e=Mee(t);return(i,r,s)=>{if(i==null)return i;if(Array.isArray(i)){const o=[];for(const a of i){const l=e(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=e(i,void 0,s);return n!==void 0?[n]:void 0}}function G1e(t){if(!V1e(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?Oee(e.Type):H1e(e.Type))}function sVe(t){return"types"in t?H1e(t.types):Oee(t.type)}function Oee(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||G1e(t))}function H1e(t){for(const e in t.typeMap)if(!Oee(t.typeMap[e]))return!1;return!0}function nVe(t){let e=null;const i=t.errorContext??"type",r=t.validate;return(s,n,o)=>{if(s==null)return s;const a=typeof s;if(a!=="object")return void Q9().error(`Expected JSON value of type 'object' to deserialize, but got '${a}'`);e||(e=oVe(t));const l=t.key;if(typeof l!="string")return;const c=s[l],h=c?e[c]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!h){const f=`Type '${c||"unknown"}' is not supported`;return o?.messages&&s&&o.messages.push(new sh(`${i}:unsupported`,f,{definition:s,context:o})),void Q9().error(f)}const d=new h;return d.read(s,o),r?r(d):d}}function oVe(t){const e={};for(const i in t.typeMap){const r=t.typeMap[i],s=Z3(r.prototype);if(typeof t.key=="function")continue;const n=s[t.key];if(!n)continue;if(n.json?.type&&Array.isArray(n.json.type)&&n.json.type.length===1&&typeof n.json.type[0]=="string"){e[n.json.type[0]]=r;continue}const o=n.json?.write;if(!o?.writer){e[i]=r;continue}const a=o.target,l=typeof a=="string"?a:t.key,c={};o.writer(i,c,l),c[l]&&(e[c[l]]=r)}return e}function aVe(t){if(t.json||(t.json={}),Kae(t.json),Qae(t.json),Xae(t.json),t.json.origins)for(const e in t.json.origins)Kae(t.json.origins[e]),Qae(t.json.origins[e]),Xae(t.json.origins[e]);return!0}function Xae(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function Kae(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function Qae(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function ele(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const i=t?.ndimArray??0;t&&(i===1||"type"in t&&V1e(t.type))?e.write.writer=uVe:i>1?e.write.writer=hVe(i):e.types?Array.isArray(e.types)?e.write.writer=cVe(e.types[0]):e.write.writer=lVe(e.types):e.write.writer=bP}function lVe(t){return(e,i,r,s)=>e?q1e(e,t,s)?bP(e,i,r,s):void 0:bP(e,i,r,s)}function q1e(t,e,i){for(const r in e.typeMap)if(t instanceof e.typeMap[r])return!0;if(i?.messages){const r=e.errorContext??"type",s=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;i&&i.messages&&t&&i.messages.push(new U(`${r}:unsupported`,s,{definition:t,context:i})),J.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(s)}return!1}function cVe(t){return(e,i,r,s)=>!e||!Array.isArray(e)?bP(e,i,r,s):bP(e.filter(n=>q1e(n,t,s)),i,r,s)}function bP(t,e,i,r){to(i,xz(t,r),e)}function xz(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?Sz(t):t}function Sz(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function uVe(t,e,i,r){let s;t===null?s=null:t&&typeof t.map=="function"?(s=t.map(n=>xz(n,r)),typeof s.toArray=="function"&&(s=s.toArray())):s=[xz(t,r)],to(i,s,e)}function W1e(t,e,i){return i!==0&&Array.isArray(t)?t.map(r=>W1e(r,e,i-1)):xz(t,e)}function hVe(t){return(e,i,r,s)=>{let n;if(e===null)n=null;else{n=W1e(e,s,t);let o=t,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}to(r,n,i)}}function dVe(t,e){return Iee(t,"any",e?.origin)}function e7(t,e){return Iee(t,"read",e?.origin)}function Z1e(t,e){return Iee(t,"write",e?.origin)}function Iee(t,e,i){let r=t?.json;if(r?.origins&&i){let s;s=i==="link-chart"?r.origins[i]&&(e==="any"||e in r.origins[i])?r.origins[i]:r.origins["web-map"]:r.origins[i],s&&(e==="any"||e in s)&&(r=s)}return r}function pVe(t){const e=fVe(t);if(t.json.origins)for(const i in t.json.origins){const r=t.json.origins[i],s=r.types?mVe(r):e;Yae(s,r,!1),r.types&&!r.write&&t.json.write?.enabled&&(r.write={...t.json.write}),ele(s,r)}Yae(e,t.json,!0),ele(e,t.json)}function fVe(t){return t.json.types?t7(t.json):t.type?Y1e(t):t7(t)}function mVe(t){return t.type?Y1e(t):t7(t)}function Y1e(t){if(!t.type)return;let e=0,i=t.type;for(;Array.isArray(i)&&!C1e(i);)i=i[0],e++;return{type:i,ndimArray:e}}function t7(t){if(!t.types)return;let e=0,i=t.types;for(;Array.isArray(i);)i=i[0],e++;return{types:i,ndimArray:e}}function gVe(t){aVe(t)&&(tVe(t),pVe(t))}const r6=new Set,s6=new Set;function A(t){return e=>{t??="esri.core.Accessor",e.prototype.declaredClass=t,vVe(e);const i=[],r=[];let s=e.prototype;for(;s;)s.hasOwnProperty("initialize")&&!r6.has(s.initialize)&&(r6.add(s.initialize),i.push(s.initialize)),s.hasOwnProperty("destroy")&&!s6.has(s.destroy)&&(s6.add(s.destroy),r.push(s.destroy)),s=Object.getPrototypeOf(s);r6.clear(),s6.clear();const n=class extends e{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=i.length-1;l>=0;l--)i[l].call(this)}}),r.length){let l=!1;const c=this[F1e];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let h=0;h<r.length;h++)r[h].call(this)}}})}Object.defineProperty(this,Symbol.dispose,{enumerable:!1,configurable:!0,value(){this.destroy()}}),this.postscript()}}};n.__accessorMetadata__=Z3(e.prototype),n.prototype.declaredClass=t;const o=(t||"AccessorSubclass").split(".").slice(-1)[0];return Object.defineProperty(n,"name",{value:o,configurable:!0}),n}}function yVe(t,e){return e.get==null?function(){const i=this.__accessor__,r=i.propertiesByName.get(t);if(r===void 0)return;i.mutable&&It(r);const s=i.store;return s.has(t)?s.get(t):r.metadata.value}:function(){const i=this.__accessor__,r=i.propertiesByName.get(t);if(r!==void 0)return r.getComputed(i)}}function vVe(t){const e=t.prototype,i=Z3(e),r={};for(const s of Object.getOwnPropertyNames(i)){const n=i[s];gVe(n),r[s]={enumerable:!0,configurable:!0,get:yVe(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(a.mutable)return a.initialized&&n.readOnly?tle("read-only",s):a.lifecycle===Bc.CONSTRUCTED&&n.constructOnly?tle("construct-only",s):void a.set(s,o)}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(t.prototype,r)}const tle=(t,e)=>{J.getLogger("esri.core.Accessor").error(`cannot assign to ${t} property '${e}'`)},_Ve="modulepreload",bVe=function(t){return"/jsdebug/"+t},ile={},V=function(e,i,r){let s=Promise.resolve();if(i&&i.length>0){let o=function(c){return Promise.all(c.map(h=>Promise.resolve(h).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=a?.nonce||a?.getAttribute("nonce");s=o(i.map(c=>{if(c=bVe(c),c in ile)return;ile[c]=!0;const h=c.endsWith(".css"),d=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const f=document.createElement("link");if(f.rel=h?"stylesheet":_Ve,h||(f.as="script"),f.crossOrigin="",f.href=c,l&&f.setAttribute("nonce",l),document.head.appendChild(f),h)return new Promise((m,y)=>{f.addEventListener("load",m),f.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${c}`)))})}))}function n(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return s.then(o=>{for(const a of o||[])a.status==="rejected"&&n(a.reason);return e().catch(n)})},rle=new WeakMap;function wVe(t,e,i=!1){const r=`🛑 DEPRECATED - ${e}`;if(!i)return void t.warn(r);let s=rle.get(t);s||(s=new Set,rle.set(t,s)),s.has(e)||(s.add(e),t.warn(r))}const sle="https://www.esriurl.com/";function xVe(t,e,i,r={}){X("esri-deprecation-warnings")&&QC(t,`This widget is deprecated. Use the ${e} component instead.`,{see:[`${e} component reference: ${sle}${i}/`,`Esri's move to web components: ${sle}components-transition-plan/`],replacement:`<${i}></${i}>`,warnOnce:!0,...r})}function SVe(t,e,i={}){if(X("esri-deprecation-warnings")){const{moduleName:r}=i;QC(t,`Function: ${(r?r+"::":"")+e+"()"}`,i)}}function TVe(t,e,i={}){if(X("esri-deprecation-warnings")){const{moduleName:r}=i;QC(t,`Property: ${(r?r+"::":"")+e}`,i)}}function EVe(t,e,i={}){X("esri-deprecation-warnings")&&QC(t,`Multiple argument constructor: ${e}`,{warnOnce:!0,replacement:`new ${e}({ <your properties here> })`,...i})}function QC(t,e,i={}){if(X("esri-deprecation-warnings")){const{replacement:r,version:s,see:n,warnOnce:o}=i;let a=e;if(r&&(a+=`
	🛠️ Replacement: ${r}`),s&&(a+=`
	⚙️ Version: ${s}`),n)if(Array.isArray(n)){a+=`
	🔗 See for more details:`;for(const l of n)a+=`
		${l}`}else a+=`
	🔗 See ${n} for more details.`;wVe(t,a,o)}}function G6t(t){const e=[];return function*(){yield*e;for(const i of t)e.push(i),yield i}}function CVe(t,e){for(const i of t)if(i!=null&&e(i))return i}function wP(t){return t!=null&&typeof t[Symbol.iterator]=="function"}let ng=class{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(i=>{e+=i.length}),e}add(e,i){if(wP(e)){const r=this._getOrCreateGroup(i);for(const s of e)ole(s)&&r.push(s)}else ole(e)&&this._getOrCreateGroup(i).push(e);return this}forEach(e,i){if(typeof e=="function")this._groups.forEach(r=>r.forEach(e));else{const r=this._getGroup(e);r&&i&&r.forEach(i)}}has(e){return this._groups.has(pL(e))}remove(e){if(typeof e!="string"&&wP(e)){for(const i of e)this.remove(i);return this}return this.has(e)?(nle(this._getGroup(e)),this._groups.delete(pL(e)),this):this}removeAll(){return this._groups.forEach(nle),this._groups.clear(),this}removeReference(e){return this._groups.delete(e),this}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const i=[];return this._groups.set(pL(e),i),i}_getGroup(e){return this._groups.get(pL(e))}};function pL(t){return t||"_default_"}function nle(t){for(const e of t)e instanceof ng?e.removeAll():e.remove()}function ole(t){return t!=null&&(!!t.remove||t instanceof ng)}function mV(t,e){if(t==null)throw new Error(e??"value is None")}function Ce(t){return t?.destroy(),null}function Rt(t){return t?.dispose(),null}function Hi(t){return t?.remove(),null}function hc(t){return t?.abort(),null}function Dr(t){return t?.release(),null}function $Ve(t,e,i){return t!=null&&e!=null?i!=null?i(t,e):t.equals(e):t===e}function ale(t,e){return t?.[e]}function J1e(t,e){let i;return t.some((r,s)=>(i=e(r,s),i!=null)),i??void 0}function AVe(t){return t?.release&&typeof t.release=="function"}function MVe(t){return t?.acquire&&typeof t.acquire=="function"}let Cl=class i7{constructor(e,i,r,s=1,n=0){this._ctor=e,this._acquireFunction=i,this._releaseFunction=r,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n;for(let o=0;o<n;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...e){let i;if(i7.test.disabled)i=new this._ctor;else{if(this._pool.length===0){const r=this.allocationSize;for(let s=0;s<r;s++)this._pool[s]=new this._ctor}i=this._pool.pop()}return this._acquireFunction?this._acquireFunction(i,...e):MVe(i)&&i.acquire(...e),i}release(e){e&&!i7.test.disabled&&(this._releaseFunction?this._releaseFunction(e):AVe(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let i=e;i<this._pool.length;++i){const r=this._pool[i];this._dispose(r)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};Cl.test={disabled:!1};let OVe=class{constructor(e,i){this._observers=e,this._observer=i}remove(){U3(this._observers,this._observer)}},X1e=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return IVe;this._observers==null&&(this._observers=[]);const i=this._observers;let r=!1,s=!1;const n=i.length;for(let o=0;o<n;++o){const a=i[o];if(a.destroyed)s=!0;else if(a===e){r=!0;break}}return r||(i.push(e),s&&this._removeDestroyedObservers()),new OVe(i,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const i=e.length;let r=0;for(let s=0;s<i;++s){for(;s+r<i&&e[s+r].destroyed;)++r;if(r>0){if(!(s+r<i))break;e[s]=e[s+r]}}e.length=i-r}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const i of e)i.onCommitted();this._observers=null}}};const IVe=$i();var Ti;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.LINK_CHART=6]="LINK_CHART",t[t.USER=7]="USER"})(Ti||(Ti={}));const r7=Ti.USER+1;function z_(t){switch(t){case"defaults":return Ti.DEFAULTS;case"service":return Ti.SERVICE;case"portal-item":return Ti.PORTAL_ITEM;case"web-scene":return Ti.WEB_SCENE;case"web-map":return Ti.WEB_MAP;case"link-chart":return Ti.LINK_CHART;case"user":return Ti.USER;default:return null}}function Tz(t){switch(t){case Ti.DEFAULTS:return"defaults";case Ti.SERVICE:return"service";case Ti.PORTAL_ITEM:return"portal-item";case Ti.WEB_SCENE:return"web-scene";case Ti.WEB_MAP:return"web-map";case Ti.LINK_CHART:return"link-chart";case Ti.USER:return"user"}}function RVe(t){return Tz(t)}let lle=class extends X1e{constructor(e,i){super(),this.propertyName=e,this.metadata=i,this.trackingTarget=new fV(this),this.flags=0,this.flags=Ur.Dirty|(i.nonNullable?Ur.NonNullable:0)|(i.hasOwnProperty("value")?Ur.HasDefaultValue:0)|(i.get===void 0?Ur.DepTrackingInitialized:0)|(i.dependsOn===void 0?Ur.AutoTracked:0)}destroy(){this.flags&Ur.Dirty&&this.onCommitted(),super.destroy(),this.trackingTarget.destroy()}getComputed(e){e.mutable&&It(this);const i=e.store,r=this.propertyName,s=this.flags,n=i.get(r);if(s&Ur.Computing||~s&Ur.Dirty&&i.has(r))return n;this.flags|=Ur.Computing;const o=e.host;let a;s&Ur.AutoTracked?a=iv(this.trackingTarget,this.metadata.get,o):(B1e(o,this),a=this.metadata.get.call(o)),this.flags|=Ur.DepTrackingInitialized,i.set(r,a,Ti.COMPUTED);const l=i.get(r);return l===n?this.flags&=~Ur.Dirty:QBe(this.commit,this),this.flags&=~Ur.Computing,l}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}commit(){this.flags&=~Ur.Dirty,this.onCommitted()}onInvalidated(){~this.flags&Ur.Overridden&&(this.flags|=Ur.Dirty);const e=this._observers;if(e&&e.length>0)for(const i of e)i.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onCommitted()}}},PVe=class K1e{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new K1e;return this._values.forEach((r,s)=>{e&&e.has(s)||i.set(s,q(r))}),i}get(e){return this._values.get(e)}originOf(){return Ti.USER}keys(){return[...this._values.keys()]}set(e,i){this._values.set(e,i)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function fL(t,e,i){return t!==void 0}function cle(t,e,i,r){return t!==void 0&&(!(i==null&&t.flags&Ur.NonNullable)||(r.lifecycle,Bc.INITIALIZING,!1))}let DVe=class{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.lifecycle=Bc.INITIALIZING,this.store=new PVe,this.mutable=!0,this._origin=Ti.USER;const i=this.host.constructor.__accessorMetadata__;for(const r in i){const s=new lle(r,i[r]);this.propertiesByName.set(r,s)}this.metadata=i}initialize(){this.lifecycle=Bc.CONSTRUCTING}constructed(){this.lifecycle=Bc.CONSTRUCTED}destroy(){this.lifecycle=Bc.DESTROYED,this.propertiesByName.forEach(e=>e.destroy())}get initialized(){return this.lifecycle!==Bc.INITIALIZING}get(e){const i=this.propertiesByName.get(e);if(i.metadata.get)return i.getComputed(this);this.mutable&&It(i);const r=this.store;return r.has(e)?r.get(e):i.metadata.value}originOf(e){const i=this.store.originOf(e);if(i===void 0){const r=this.propertiesByName.get(e);if(r!==void 0&&r.flags&Ur.HasDefaultValue)return"defaults"}return Tz(i)}has(e){return this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const i=this.propertiesByName.get(e);if(fL(i))return this.store.has(e)?this.store.get(e):i.metadata.value}internalSet(e,i){const r=this.propertiesByName.get(e);fL(r)&&this._internalSet(r,i)}getDependsInfo(e,i,r){const s=this.propertiesByName.get(i);if(!fL(s))return"";const n=new fV,o=iv(n,()=>s.metadata.get?.call(e));let a=`${r}${e.declaredClass.split(".").pop()}.${i}: ${o}
`;const l=n.accessed??new Set;if(l.size===0)return a;r+="  ";for(const c of l)c instanceof lle&&(a+=`${r}${c.propertyName}: undefined
`);return a}setAtOrigin(e,i,r){const s=this.propertiesByName.get(e);if(fL(s))return this._setAtOrigin(s,i,r)}isOverridden(e){const i=this.propertiesByName.get(e);return i!==void 0&&!!(i.flags&Ur.Overridden)}clearOverride(e){const i=this.propertiesByName.get(e);i&&i.flags&Ur.Overridden&&(i.flags&=~Ur.Overridden,i.notifyChange())}override(e,i){const r=this.propertiesByName.get(e);if(!cle(r,e,i,this))return;const s=r.metadata.cast;if(s){const n=this._cast(s,i),{valid:o,value:a}=n;if(n6.release(n),!o)return;i=a}r.flags|=Ur.Overridden,this._internalSet(r,i)}set(e,i){const r=this.propertiesByName.get(e);if(!cle(r,e,i,this))return;const s=r.metadata.cast;if(s){const o=this._cast(s,i),{valid:a,value:l}=o;if(n6.release(o),!a)return;i=l}const n=r.metadata.set;n?n.call(this.host,i):this._internalSet(r,i)}setDefaultOrigin(e){this._origin=z_(e)}getDefaultOrigin(){return Tz(this._origin)}notifyChange(e){const i=this.propertiesByName.get(e);i!==void 0&&i.notifyChange()}invalidate(e){const i=this.propertiesByName.get(e);i!==void 0&&i.invalidate()}commit(e){const i=this.propertiesByName.get(e);i!==void 0&&i.commit()}_internalSet(e,i){const r=this.lifecycle!==Bc.INITIALIZING?this._origin:Ti.DEFAULTS;this._setAtOrigin(e,i,r)}_setAtOrigin(e,i,r){const s=this.store,n=e.propertyName;s.has(n,r)&&Eee(i,s.get(n))&&~e.flags&Ur.Overridden&&r===s.originOf(n)||(e.invalidate(),s.set(n,i,r),e.commit(),U1e(this.host,e))}_cast(e,i){const r=n6.acquire();return r.valid=!0,r.value=i,e&&(r.value=e.call(this.host,i,r)),r}},LVe=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const n6=new Cl(LVe);let NVe;function FVe(){return NVe}var ule;(function(t){t[t.Ignore=0]="Ignore",t[t.Destroy=1]="Destroy",t[t.ThrowError=2]="ThrowError"})(ule||(ule={}));function kVe(t){t.length=0}let tc=class{constructor(e=50,i=50){this._pool=new Cl(Array,void 0,kVe,i,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return o6.acquire()}static release(e){return o6.release(e)}static prune(){o6.prune()}};const o6=new tc(100);let Q1e=class extends Cl{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=null}acquire(...e){const i=super.acquire(...e);return this._set.delete(i),i}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const mL=[];function e$(t){mL.push(t),mL.length===1&&queueMicrotask(()=>{const e=mL.slice();mL.length=0;for(const i of e)i()})}let zy=class{constructor(e,i=30){this.name=e,this._counter=0,this._samples=new Array(i)}push(e){e!=null&&(this._samples[++this._counter%this._samples.length]=e)}set(e){e!=null&&(this._samples[this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,i)=>e-i)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,i)=>e+i,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var s7;(function(t){const e=(n,o,a,l)=>{let c=o,h=o;const d=a>>>1,f=n[c-1];for(;h<=d;){h=c<<1,h<a&&l(n[h-1],n[h])<0&&++h;const m=n[h-1];if(l(m,f)<=0)break;n[c-1]=m,c=h}n[c-1]=f},i=(n,o)=>n<o?-1:n>o?1:0;function r(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)e(n,h,a,l);const c=o+1;for(let h=a-1;h>o;h--){const d=n[o];n[o]=n[h],n[h]=d,e(n,c,h,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)e(n,h,a,l),yield;const c=o+1;for(let h=a-1;h>o;h--){const d=n[o];n[o]=n[h],n[h]=d,e(n,c,h,l),yield}}t.sort=r,t.iterableSort=s})(s7||(s7={}));const hle=s7,zVe=1.5,UVe=1.1;let Jt=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new d1e,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>dle(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const i=new Array;for(let r=0;r<this._length;r++){const s=this.data[r];e(s)&&i.push(s)}return i}at(e){if((e=Math.trunc(e)||0)<0&&(e+=this._length),!(e<0||e>=this._length))return this.data[e]}includes(e,i){const r=this.data.indexOf(e,i);return r!==-1&&r<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let i=e;i<this._length;++i)this.data[i]=this._deallocator(this.data[i]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,i=e.length){for(let r=0;r<i;r++)this.data[this._length++]=e[r]}fill(e,i){for(let r=0;r<i;r++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,dle(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const i=W9(this.data,e,this.length,this._hint);if(i!==-1)return this.data.splice(i,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(W9(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,i=e.length,r){this.length=_Be(this.data,e,this.length,i,this._hint,r),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,i){if(e>=this.length||i>=this.length||e===i)return;const r=this.data[e];this.data[e]=this.data[i],this.data[i]=r}sort(e){hle.sort(this.data,0,this.length,e)}iterableSort(e){return hle.iterableSort(this.data,0,this.length,e)}some(e,i){for(let r=0;r<this.length;++r)if(e.call(i,this.data[r],r,this.data))return!0;return!1}find(e,i){const{data:r,length:s}=this;for(let n=0;n<s;++n)if(e.call(i,r[n]))return r[n]}filterInPlace(e,i){let r=0;for(let s=0;s<this._length;++s){const n=this.data[s];e.call(i,n,s,this.data)&&(this.data[s]=this.data[r],this.data[r]=n,r++)}if(this._deallocator)for(let s=r;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=r,this._shrink(),this}forAll(e,i){const{data:r,length:s}=this;for(let n=0;n<s;++n)e.call(i,r[n],n,r)}forEach(e,i){this.data.slice(0,this.length).forEach(e,i)}map(e,i){const r=new Array(this.length);for(let s=0;s<this.length;++s)r[s]=e.call(i,this.data[s],s,this.data);return r}reduce(e,i){let r=i;for(let s=0;s<this.length;++s)r=e(r,this.data[s],s,this.data);return r}has(e){const i=this.length,r=this.data;for(let s=0;s<i;++s)if(r[s]===e)return!0;return!1}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.data[e]}};function dle(t){t.data.length>zVe*t.length&&(t.data.length=Math.floor(t.length*UVe))}function BVe(t){return{setTimeout:(e,i)=>{const r=t.setTimeout(e,i);return $i(()=>t.clearTimeout(r))}}}const pA=BVe(globalThis);function gV(t){return VVe(t)||exe(t)}function VVe(t){return t!=null&&typeof t=="object"&&"on"in t&&typeof t.on=="function"}function exe(t){return t!=null&&typeof t=="object"&&"addEventListener"in t&&typeof t.addEventListener=="function"}function fA(t,e,i){if(!gV(t))throw new TypeError("target is not a Evented or EventTarget object");return exe(t)?jVe(t,e,i):t.on(e,i)}function jVe(t,e,i,r){if(Array.isArray(e)){const s=e.slice();for(const n of s)t.addEventListener(n,i,r);return $i(()=>{for(const n of s)t.removeEventListener(n,i,r)})}return t.addEventListener(e,i,r),$i(()=>t.removeEventListener(e,i,r))}function txe(t,e,i){if(!gV(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,i);const r=fA(t,e,s=>{r.remove(),i.call(t,s)});return r}function vi(t="Aborted"){return new U("AbortError",t)}function gt(t,e="Aborted"){if(wa(t))throw vi(e)}function Y3(t){return t instanceof AbortSignal?t:t?.signal??void 0}function wa(t){const e=Y3(t);return e!=null&&e.aborted}function Vc(t){if(Xr(t))throw t}function ple(t){if(!Xr(t))throw t}function Xo(t,e){const i=Y3(t);if(i!=null){if(!i.aborted)return txe(i,"abort",()=>e());e()}}function J3(t,e){const i=Y3(t);if(i!=null)return gt(i),txe(i,"abort",()=>e(vi()))}function Ree(t,e){return Y3(e)==null?t:new Promise((i,r)=>{let s=Xo(e,()=>r(vi()));const n=()=>{s=Hi(s)};t.then(n,n),t.then(i,r)})}function Xr(t){return t?.name==="AbortError"}async function xP(t){try{return await t}catch(e){if(!Xr(e))throw e;return}}async function tHt(t,e=J.getLogger("esri")){try{return await t}catch(i){Xr(i)||e.error(i)}}async function yV(t){if(!t)return;if(typeof t.forEach!="function"){const i=Object.keys(t),r=i.map(o=>t[o]),s=await yV(r),n={};return i.map((o,a)=>n[o]=s[a]),n}const e=t;return Promise.allSettled(e).then(i=>Array.from(e,(r,s)=>{const n=i[s];return n.status==="fulfilled"?{promise:r,value:n.value}:{promise:r,error:n.reason}}))}async function GVe(t){return(await Promise.allSettled(t)).filter(e=>e.status==="fulfilled").map(e=>e.value)}async function HVe(t){return(await Promise.allSettled(t)).filter(e=>e.status==="rejected").map(e=>e.reason)}function Pee(t,e=void 0,i){const r=new AbortController;return Xo(i,()=>r.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(e)},t);Xo(r,()=>{o&&(clearTimeout(o),n(vi()))})})}function iHt(t,e,i,r){const s=i&&"abort"in i?i:null;r!=null||s||(r=i);let n=setTimeout(()=>{n=0,s?.abort()},e);const o=()=>r||new U("promiseUtils:timeout","The wrapped promise did not resolve within "+e+" ms");return t.then(a=>{if(n===0)throw o();return clearTimeout(n),a},a=>{throw clearTimeout(n),n===0?o():a})}function qVe(t,e){const i=new AbortController,r=setTimeout(()=>i.abort(),e);return Xo(t,()=>{i.abort(),clearTimeout(r)}),{...t,signal:i.signal}}function nu(t){return t&&typeof t.then=="function"}function n7(t){return nu(t)?t:Promise.resolve(t)}function X3(t,e=-1){let i,r,s,n,o=null;const a=(...l)=>{if(i){r=l,n&&n.reject(vi()),n=Qo();const f=n.promise;if(o){const m=o;o=null,m.abort()}return f}if(s=n||Qo(),n=null,e>0){const f=new AbortController;i=n7(t(...l,f.signal));const m=i;Pee(e).then(()=>{i===m&&(n?f.abort():o=f)})}else i=1,i=n7(t(...l));const c=()=>{const f=r;r=s=i=o=null,f!=null&&a(...f)},h=i,d=s;return h.then(c,c),h.then(d.resolve,d.reject),d.promise};return a}function Qo(){let t,e;const i=new Promise((s,n)=>{t=s,e=n}),r=s=>{t(s)};return r.resolve=s=>t(s),r.reject=s=>e(s),r.timeout=(s,n)=>pA.setTimeout(()=>r.reject(n),s),r.promise=i,r}function rHt(t,e){return t.then(e,e)}async function fle(t){await Promise.resolve(),gt(t)}function sHt(t){return t}function ixe(t){return 1e3*t}function nHt(t){return t}function rxe(t){return .001*t}let WVe=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},ZVe=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},o7=0,a7=0;const YA={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},l7=["prepare","preRender","render","postRender","update","finish"],c7=[],Hx=new Jt;let YVe=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1,sxe()}};function JVe(){Sx!=null&&(cancelAnimationFrame(Sx),Sx=requestAnimationFrame(Dee))}function sxe(){Sx==null&&(o7=performance.now(),Sx=requestAnimationFrame(Dee))}const Ez={frameTasks:Hx,willDispatch:!1,clearFrameTasks:XVe,dispatch:oxe,executeFrameTasks:QVe,reschedule:JVe};function mA(t){const e=new ZVe(t);return c7.push(e),Ez.willDispatch||(Ez.willDispatch=!0,e$(oxe)),e}function qm(t){const e=new WVe(t);return Hx.push(e),sxe(),new YVe(e)}let Sx=null;function XVe(t=!1){Hx.forAll(e=>{e.removed=!0}),t&&nxe()}function KVe(t){a7=Math.max(0,t)}function Dee(){const t=performance.now();Sx=null,Sx=Hx.some(i=>!i.paused&&!i.removed)?requestAnimationFrame(Dee):null,Ez.executeFrameTasks(t)}function QVe(t){const e=t-o7;o7=t;const i=a7>0?a7:1e3/60,r=Math.max(0,e-i);YA.time=t,YA.frameDuration=i-r;for(let s=0;s<l7.length;s++){const n=performance.now(),o=l7[s];Hx.forAll(a=>{a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(YA.elapsedFrameTime=performance.now()-t,YA.deltaTime=a.ticks===0?0:e,a.phases[o]?.call(a,YA)))}),rje[s].push(performance.now()-n)}nxe(),sje.push(performance.now()-t)}const gL=new Jt;function nxe(){Hx.forAll(t=>{t.removed&&gL.push(t)}),Hx.removeUnorderedMany(gL.data,gL.length),gL.clear()}function oxe(){for(;c7.length;){const t=c7.shift();t.isActive&&t.callback()}Ez.willDispatch=!1}function eje(t=1,e){const i=Qo(),r=()=>{wa(e)?i.reject(vi()):t===0?i():(--t,e$(()=>r()))};return r(),i.promise}function tje(t){return eje(1,t)}async function ije(t){await tje(t),await new Promise(e=>requestAnimationFrame(()=>{t?.aborted||e()}))}const rje=l7.map(t=>new zy(t)),sje=new zy("total");function hR(t,e){for(const i of t.values())if(e(i))return!0;return!1}function SP(t,e){if(!e)return t;for(const i of e)i!=null&&t.add(i);return t}function mle(t,e){return e!=null&&t.add(e),t}function Lee(t,e){const i=new Set;return SP(i,t),SP(i,e),i}function nje(t,e){const i=new Set;for(const r of e)t.has(r)&&i.add(r);return i}function cHt(t,e){if(!t||!e)return!1;if(t===e)return!0;for(const i of t)if(!e.has(i))return!1;return!0}function uHt(t,e){if(t==null&&e==null)return!0;if(t==null||e==null||t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function oje(t,e){const i=new Set(t);for(const r of e)i.delete(r);return i}function aje(t,e){return oje(Lee(t,e),nje(t,e))}let lje=0;const cje=0;function _d(){return++lje}let vV=class extends fV{constructor(e){super(new uje(e)),this._observer&&gle.register(this,new WeakRef(this._observer),this)}destroy(){this._observer&&gle.unregister(this._observer),this.accessed?.clear(),this.clear(),this._observer?.destroy()}},uje=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=hje}};const gle=new FinalizationRegistry(t=>{t.deref()?.destroy()});function hje(){}let yC=!1;const Cz=[];function axe(t,e){let i=new vV(n),r=null,s=!1;function n(){if(!i||s)return;if(yC)return void uxe(n);const a=r;i.clear(),yC=!0,s=!0,r=iv(i,t),s=!1,yC=!1,e(r,a),hxe()}function o(){i&&(i.destroy(),i=null,r=null)}return s=!0,r=iv(i,t),s=!1,$i(o)}function lxe(t,e){let i=new vV(s),r=null;function s(){e(r,o)}function n(){i&&(i.destroy(),i=null),r=null}function o(){return i?(i.clear(),r=iv(i,t),r):null}return o(),$i(n)}function cxe(t,e){let i=!1,r=!1;const s=!!e?.sync;let n=new vV(()=>{i||r||(r=!0,s?o():queueMicrotask(o))});function o(){r=!1,n&&!i&&(yC?uxe(o):(n.clear(),yC=!0,i=!0,iv(n,t),i=!1,yC=!1,hxe()))}function a(){n&&(n.destroy(),n=null)}return i=!0,iv(n,t),i=!1,$i(a)}function uxe(t){Cz.includes(t)||Cz.unshift(t)}function hxe(){for(;Cz.length;)Cz.pop()()}var dR;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})(dR||(dR={}));let TP=class{constructor(){this.uid=_d(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,i,r,s,n){return this.pool.acquire(dR.Untracked,e,i,r,s,n,Eee)}static acquireTracked(e,i,r,s){return this.pool.acquire(dR.Tracked,e,i,r,null,null,s)}notify(e,i){this.type===dR.Untracked?this.callback.call(this.target,e,i,this.path,this.target):this.callback.call(null,e,i,void 0,void 0)}acquire(e,i,r,s,n,o,a){this.uid=_d(),this.removed=!1,this.type=e,this.oldValue=i,this.callback=r,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=_d(),this.removed=!0}};TP.pool=new Q1e(TP);const Ak=new tc,jy=new Set;let $z;function Az(t){jy.delete(t),jy.add(t),$z||($z=mA(fje))}function dje(t){if(t.removed)return;const e=t.oldValue,i=t.getValue();t.equals(e,i)||(t.oldValue=i,t.notify(i,e))}function pje(t){for(const e of jy.values())e.target===t&&(e.removed=!0)}function fje(){let t=10;for(;$z&&t--;){$z=null;const e=mje(),i=Ak.acquire();for(const r of e){const s=r.uid;dje(r),s===r.uid&&r.removed&&i.push(r)}for(const r of jy)r.removed&&(i.push(r),jy.delete(r));for(const r of i)TP.pool.release(r);Ak.release(i),Ak.release(e),u7.forEach(r=>r())}}function mje(){const t=Ak.acquire();t.length=jy.size;let e=0;for(const i of jy)t[e]=i,++e;return jy.clear(),t}const u7=new Set;function dxe(t){return u7.add(t),$i(()=>u7.delete(t))}function gje(t,e,i){let r=I1e(t,e,i,(s,n,o)=>{let a,l,c=lxe(()=>W3(s,n),(h,d)=>{s.__accessor__?.lifecycle===Bc.DESTROYED||a&&a.uid!==l?r.remove():(a||(a=TP.acquireUntracked(h,o,d,s,n),l=a.uid),Az(a))});return $i(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,Az(a)),a=null),r=c=null})});return r}function yje(t,e,i){const r=I1e(t,e,i,(s,n,o)=>{let a=!1;return axe(()=>W3(s,n),(l,c)=>{s.__accessor__.lifecycle!==Bc.DESTROYED?a||(a=!0,Eee(c,l)||o.call(s,l,c,n,s),a=!1):r.remove()})});return r}function vje(t,e,i,r=!1){return t.__accessor__&&t.__accessor__.lifecycle!==Bc.DESTROYED?r?yje(t,e,i):gje(t,e,i):$i()}function _je(t,e,i){let r,s,n=lxe(t,(o,a)=>{r&&r.uid!==s?n.remove():(r||(r=TP.acquireTracked(o,e,a,i),s=r.uid),Az(r))});return $i(()=>{n.remove(),r&&(r.uid!==s||r.removed||(r.removed=!0,Az(r)),r=null),n=null})}function bje(t,e,i){let r=!1;return axe(t,(s,n)=>{r||(r=!0,i(n,s)||e(s,n),r=!1)})}function wje(t,e,i=!1,r=_1e){return i?bje(t,e,r):_je(t,e,r)}function yle(t){return hR(jy,e=>e.oldValue===t)}var pxe,fxe;function xje(t){if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return t.constructor?.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const S0=Symbol("Accessor-Handles"),h7=Symbol("Accessor-Initialized");let ue=class Mk{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:i,declaredClass:r,constructor:s}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}Z3(o.prototype);for(const a in e){const l=e[a];o.prototype[a]=typeof l=="function"?function(...c){const h=this.inherited;let d;this.inherited=function(...f){if(n.prototype[a])return n.prototype[a].apply(this,f)};try{d=l.apply(this,c)}catch(f){throw this.inherited=h,f}return this.inherited=h,d}:e[a]}for(const a in i){const l=xje(i[a]);p(l)(o.prototype,a)}return A(r)(o)}static freeze(e){return e instanceof Mk?e.__accessor__.mutable=!1:Object.freeze(e),e}static isFrozen(e){return e instanceof Mk?!e.__accessor__.mutable:Object.isFrozen(e)}constructor(...e){if(this[pxe]=null,this[fxe]=!1,this.constructor===Mk)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const i=new DVe(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:i}),e.length>0&&(i.ctorArgs=this.normalizeCtorArgs?.apply(this,e)??e[0])}postscript(){const e=this.__accessor__,i=e.ctorArgs;e.initialize(),i&&(this.set(i),e.ctorArgs=null),e.constructed(),this.initialize(),this[h7]=!0}initialize(){}[F1e](){this[S0]=Ce(this[S0])}destroy(){this.destroyed||(pje(this),this.__accessor__.destroy(),FVe()?.onInstanceDestroy(this))}[Symbol.dispose](){this.destroy()}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[h7]}get destroyed(){return this.__accessor__?.lifecycle===Bc.DESTROYED||!1}commitProperty(e){Rm(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,i){return bz(this,e,i),this}watch(e,i,r){return SVe(J.getLogger(this),"`watch` is deprecated in favor of reactiveUtils.watch",{replacement:"reactiveUtils.watch",version:"4.32",see:"https://developers.arcgis.com/javascript/latest/api-reference/esri-core-reactiveUtils.html#watch",warnOnce:!0}),vje(this,e,i,r)}addHandles(e,i){if(this.destroyed){const r=Array.isArray(e)?e:[e];for(const s of r)s.remove();return}(this[S0]??=new ng).add(e,i)}removeHandles(e){this[S0]?.remove(e)}removeAllHandles(){this[S0]?.removeAll()}removeHandlesReference(e){this[S0]?.removeReference(e)}hasHandles(e){return this[S0]?.has(e)===!0}_override(e,i){i===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,i){i==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,i){return this.__accessor__.internalSet(e,i),this}};pxe=S0,fxe=h7;const mxe=t=>{let e=class extends t{clone(){const i=El(this);mV(i,"unable to clone instance of non-accessor class");const r=i.metadata,s=i.store,n={},o=new Map;for(const l in r){const c=r[l],h=s?.originOf(l),d=c.clonable;if(c.readOnly||d===!1||h!==Ti.USER&&h!==Ti.DEFAULTS&&h!==Ti.WEB_MAP&&h!==Ti.WEB_SCENE)continue;const f=this[l];let m=null;m=typeof d=="function"?d(f):d==="reference"?f:Z9(f),f!=null&&m==null||(h===Ti.DEFAULTS?o.set(l,m):n[l]=m)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){const l=El(a)?.store;if(l)for(const[c,h]of o)l.set(c,h,Ti.DEFAULTS)}return a}};return e=u([A("esri.core.Clonable")],e),e};let uO=class extends mxe(ue){};uO=u([A("esri.core.Clonable")],uO),function(t){t.ClonableMixin=mxe}(uO||(uO={}));const Dt=uO;let Gw=class extends Dt{constructor(e){super(e),this.row=0,this.column=0,this.rows=1,this.columns=1}equals(e){return e!=null&&this.row===e.row&&this.rows===e.rows&&this.column===e.column&&this.columns===e.columns}};u([p({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Gw.prototype,"row",void 0),u([p({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Gw.prototype,"column",void 0),u([p({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Gw.prototype,"rows",void 0),u([p({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Gw.prototype,"columns",void 0),Gw=u([A("esri.CameraLayout")],Gw);const gxe=Gw,vle=new Float32Array(1);function yxe(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function ce(t,e,i){return Math.min(Math.max(t,e),i)}function EP(t){return!(t&t-1)}function gHt(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function yHt(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function dt(t,e,i){return t+(e-t)*i}function vHt(t,e,i,r,s){return dt(r,s,(t-e)/(i-e))}function wt(t){return t*Math.PI/180}function $o(t){return 180*t/Math.PI}function _Ht(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function Za(t){return Math.acos(ce(t,-1,1))}function Td(t){return Math.asin(ce(t,-1,1))}function Jc(t,e,i=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=i}function vxe(t,e,i=1e-6){return!Jc(t,e,i)&&t>e}function d7(t,e,i=1e-6){return!Jc(t,e,i)&&t<e}function Sje(t,e,i=1e-6){return Jc(t,e,i)||t>e}const Mz=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function p7(t){return Mz.setFloat64(0,t),Mz.getBigInt64(0)}function Tje(t){return Mz.setBigInt64(0,t),Mz.getFloat64(0)}const Ok=BigInt("1000000"),Eje=_xe(1);function _xe(t){const e=p7(t=Math.abs(t)),i=Tje(e<=Ok?Ok:e-Ok);return Math.abs(t-i)}function bHt(t,e,i=Eje){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;if(i!=null&&_xe(Math.min(Math.abs(t),Math.abs(e)))<i)return Math.abs(t-e)<=i;const r=p7(t),s=p7(e);return r<0!=s<0?!1:!((r<s?s-r:r-s)>Ok)}function Cje(t,e,i=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const r=Math.abs(t-e),s=Math.abs(t),n=Math.abs(e);if(t===0||e===0||s<1e-12&&n<1e-12){if(r>.01*i)return!1}else if(r/(s+n)>i)return!1;return!0}function $je(t){return bxe(Math.max(-f7,Math.min(t,f7)))}function bxe(t){return vle[0]=t,vle[0]}function CP(t,e,i){const r=ce((i-t)/(e-t),0,1);return r*r*(3-2*r)}function wHt(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],r=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(Jc(e,1)&&Jc(i,1)&&Jc(r,1))}function Aje(t,e){return(t%e+e)%e}const f7=bxe(34028234663852886e22);function xHt(t,e,i){if(i===void 0||+i==0)return Math[t](e);if(e=+e,i=+i,isNaN(e)||typeof i!="number"||i%1!=0)return NaN;let r=e.toString().split("e");return r=(e=Math[t](+(r[0]+"e"+(r[1]?+r[1]-i:-i)))).toString().split("e"),+(r[0]+"e"+(r[1]?+r[1]+i:i))}let fb=class{constructor(e,i){this.min=e,this.max=i,this.range=i-e}normalize(e,i=0,r=!1){return _le(this.range,this.min,this.max,e,i,r)}clamp(e,i=0){return ce(e-i,this.min,this.max)+i}monotonic(e,i,r){return e<i?i:i+m7(this.range,e-i,r)}minimalMonotonic(e,i,r){return _le(this.range,e,e+this.range,i,r)}center(e,i,r){return i=this.monotonic(e,i,r),this.normalize((e+i)/2,r)}diff(e,i,r){return this.monotonic(e,i,r)-e}shortestSignedDiff(e,i){e=this.normalize(e);const r=(i=this.normalize(i))-e,s=i<e?this.minimalMonotonic(e,i)-e:i-this.minimalMonotonic(i,e);return Math.abs(r)<Math.abs(s)?r:s}contains(e,i,r){return i=this.minimalMonotonic(e,i),(r=this.minimalMonotonic(e,r))>e&&r<i}};function _le(t,e,i,r,s=0,n=!1){return(r-=s)<e?r+=m7(t,e-r):r>i&&(r-=m7(t,r-i)),n&&r===i&&(r=e),r+s}function m7(t,e,i=0){return Math.ceil((e-i)/t)*t+i}const Mje=new fb(0,2*Math.PI),mb=new fb(-Math.PI,Math.PI),_V=new fb(0,360);let Oje=class wxe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new wxe;return this._values.forEach((r,s)=>{e&&e.has(s)||i.set(s,q(r.value),r.origin)}),i}get(e,i){i=this._normalizeOrigin(i);const r=this._values.get(e);return i==null||r?.origin===i?r?.value:void 0}originOf(e){return this._values.get(e)?.origin??Ti.USER}keys(e){e=this._normalizeOrigin(e);const i=[...this._values.keys()];return e==null?i:i.filter(r=>this._values.get(r)?.origin===e)}set(e,i,r){if((r=this._normalizeOrigin(r))===Ti.DEFAULTS){const s=this._values.get(e);if(s?.origin!=null&&s.origin>r)return}this._values.set(e,new Ije(i,r))}delete(e,i){(i=this._normalizeOrigin(i))!=null&&this._values.get(e)?.origin!==i||this._values.delete(e)}has(e,i){return(i=this._normalizeOrigin(i))!=null?this._values.get(e)?.origin===i:this._values.has(e)}forEach(e){this._values.forEach(({value:i},r)=>e(i,r))}_normalizeOrigin(e){if(e!=null)return e===Ti.DEFAULTS?e:Ti.USER}},Ije=class{constructor(e,i){this.value=e,this.origin=i}};function xxe(t,e,i){e.keys().forEach(s=>{i.set(s,e.get(s),Ti.DEFAULTS)});const r=t.metadata;Object.keys(r).forEach(s=>{t.internalGet(s)&&i.set(s,t.internalGet(s),Ti.DEFAULTS)})}function Rje(t,e,i){if(!t?.read||t.read.enabled===!1||!t.read.source)return!1;const r=t.read.source;if(typeof r=="string"){if(r===e||r.includes(".")&&r.indexOf(e)===0&&Wae(r,i))return!0}else for(const s of r)if(s===e||s.includes(".")&&s.indexOf(e)===0&&Wae(s,i))return!0;return!1}function Pje(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function Dje(t,e,i,r,s){let n=e7(e[i],s);Pje(n)&&(t[i]=!0);for(const o of Object.getOwnPropertyNames(e))n=e7(e[o],s),Rje(n,i,r)&&(t[o]=!0)}function Lje(t,e,i,r){const s=i.metadata,n=dVe(s[e],r),o=n?.default;if(o===void 0)return;const a=typeof o=="function"?o.call(t,e,r):o;a!==void 0&&i.set(e,a)}const Sxe={origin:"service"};function Txe(t,e,i=Sxe){if(!e||typeof e!="object")return;const r=El(t),s=r.metadata,n={};for(const o of Object.getOwnPropertyNames(e))Dje(n,s,o,e,i);r.setDefaultOrigin(i.origin);for(const o of Object.getOwnPropertyNames(n)){const a=e7(s[o],i).read,l=a?.source;let c;c=l&&typeof l=="string"?W3(e,l):e[o],a?.reader&&(c=a.reader.call(t,c,e,i)),c!==void 0&&r.set(o,c)}if(!i||!i.ignoreDefaults){r.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||Lje(t,o,r,i)}r.setDefaultOrigin("user")}function Nee(t,e,i,r=Sxe){const s={...r,messages:[]};i(s),s.messages?.forEach(n=>{n.type!=="warning"||t.loaded?r?.messages&&r.messages.push(n):t.loadWarnings.push(n)})}function Nje(t,e,i,r,s){const n={};return e.write?.writer?.call(t,r,n,i,s),n}function Exe(t,e,i,r,s,n){if(!r?.write)return!1;const o=Rm(t,i);if(!s&&r.write.overridePolicy){const a=r.write.overridePolicy.call(t,o,i,n??void 0);a!==void 0&&(s=a)}if(s||(s=r.write),!s||s.enabled===!1||s.layerContainerTypes&&n?.layerContainerType&&!s.layerContainerTypes.includes(n.layerContainerType))return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new U("web-document-write:property-required",`Missing value for required property '${i}' on '${t.declaredClass}'`,{propertyName:i,target:t});return a&&n?.messages?n.messages.push(a):a&&!n&&J.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||!s.alwaysWriteDefaults&&(!e.store.multipleOriginsSupported||e.store.originOf(i)===Ti.DEFAULTS)&&Fje(t,i,n,r,o)||!s.ignoreOrigin&&n?.origin&&e.store.multipleOriginsSupported&&e.store.originOf(i)<z_(n.origin))}function Fje(t,e,i,r,s){const n=r.default;if(n===void 0)return!1;if(r.defaultEquals!=null)return r.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(t,e,i??void 0);return Hm(o,s)}return!1}return n===s}function kje(t,e,i,r){const s=El(t),n=s.metadata,o=Z1e(n[e],r);return!!o&&Exe(t,s,e,o,i,r)}function Cxe(t,e,i){if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return Ek(e,t.toJSON(i));const r=El(t),s=r.metadata;for(const n in s){const o=Z1e(s[n],i);if(!Exe(t,r,n,o,void 0,i))continue;const a=Rm(t,n),l=Nje(t,o,o.write&&typeof o.write.target=="string"?o.write.target:n,a,i);Object.keys(l).length>0&&(e=Ek(e,l),i?.resources?.pendingOperations?.length&&i.resources.pendingOperations.push(Promise.all(i.resources.pendingOperations).then(()=>Ek(e,l,()=>"replace-arrays"))),i?.writtenProperties&&i.writtenProperties.push({target:t,propName:n,oldOrigin:RVe(r.store.originOf(n)),newOrigin:i.origin}))}return e}const $xe=t=>{let e=class extends t{constructor(...i){super(...i);const r=El(this),s=r.store,n=new Oje;r.store=n,xxe(r,s,n)}read(i,r){Txe(this,i,r)}write(i,r){return Cxe(this,i??{},r)}toJSON(i){return this.write({},i)}static fromJSON(i,r){return zje.call(this,i,r)}};return e=u([A("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function zje(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(t,e),i}let hO=class extends $xe(ue){};hO=u([A("esri.core.JSONSupport")],hO),function(t){function e(i){return i&&typeof i=="object"&&"toJSON"in i&&typeof i.toJSON=="function"}t.JSONSupportMixin=$xe,t.isSerializable=e}(hO||(hO={}));const ee=hO,Uje=Object.prototype.toString;function Bje(t){const e="__accessorMetadata__"in t?Is(t):t;return function(...i){if(i.push(e),typeof i[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return Vje.apply(this,i)}}function Vje(t,e,i,r){pV(t,e).cast=r}function jje(t){return(e,i)=>{pV(e,t).cast=e[i]}}function Yt(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&Uje.call(t[0])==="[object Function]"?Bje(t[0]):t.length===1&&typeof t[0]=="string"?jje(t[0]):void 0}function me(t,e,i){let r,s;return e===void 0||Array.isArray(e)?(s=t,i=e,r=[void 0]):(s=e,r=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;r.forEach(l=>{const c=N1e(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],i&&(c.read.source=(c.read.source||[]).concat(i))})}}function ge(t,e,i){let r,s;return e===void 0?(s=t,r=[void 0]):typeof e!="string"?(s=t,r=[void 0],i=e):(s=e,r=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;for(const l of r){const c=N1e(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),i&&(c.write.target=i),c.write.writer=a[o]}}}let ei=class{constructor(e,i={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=i,this.apiValues=[],this.jsonValues=[],this._apiToJSON=Gje(e),this.apiValues=ble(this._apiToJSON),this.jsonValues=ble(this._jsonToAPI),this.read=r=>this.fromJSON(r),this.write=(r,s,n)=>{const o=this.toJSON(r);o!==void 0&&to(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const i=this._apiToJSON[e];return this._options.useNumericKeys?+i:i}return this._options.ignoreUnknown?null:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}};function Gje(t){const e={};for(const i in t)e[t[i]]=i;return e}function ble(t){const e=[];for(const i in t)e.push(i);return e.sort(),e}function Mo(){return function(t,e){return new ei(t,{ignoreUnknown:!0,...e})}}let Fee=class{constructor(e,i,r,s,n,o){this.semiMajorAxis=e,this.flattening=i,this.outerAtmosphereRimWidth=r,this.atmosphereHeight=s,this.scaleHeight=n;const a=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*a,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=o||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const xi=new Fee(6378137,1/298.257223563,3e5,1e5,.085,.006694379990137799),Kp=new Fee(3396190,1/169.8944472236118,23e4,6e4,.111),rv=new Fee(1737400,0,0,0,0),Hje=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,qje={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function wle(t){const e=t?.match(Hje);if(!e)return null;const[,i,r,s]=e;if(!i)return null;let n=null,o=null,a=null;const{devext:l,qaext:c,www:h}=qje;if(r)if(n=i,s)switch(s.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=h);else switch(i.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=h);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:n}}function Wje(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}function Axe(t){const e=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,i=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,r=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;return e.test(t)?t=t.replace(e,"https://www.arcgis.com"):i.test(t)?t=t.replace(i,"https://devext.arcgis.com"):r.test(t)&&(t=t.replace(r,"https://qaext.arcgis.com")),t}function Mxe(t){const e=atob(t),i=new Uint8Array(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return i.buffer}function Zje(t){const e=new Uint8Array(t);let i="";for(let r=0;r<e.length;r++)i+=String.fromCharCode(e[r]);return btoa(i)}const Yje=()=>J.getLogger("esri.core.urlUtils"),gA=Ir.request,xle="esri/config: esriConfig.request.proxyUrl is not set.",Oxe=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,Ixe=/^\s*http:/i,Jje=/^\s*https:/i,Xje=/^\s*file:/i,Kje=/:\d+$/,Qje=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,eGe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),tGe=new RegExp("^((([^[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^[:]*))(:([0-9]+))?$");let sb=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let i=this.uri.match(eGe);this.scheme=i[2]||(i[1]?"":null),this.authority=i[4]||(i[3]?"":null),this.path=i[5],this.query=i[7]||(i[6]?"":null),this.fragment=i[9]||(i[8]?"":null),this.authority!=null&&(i=this.authority.match(tGe),this.user=i[3]||null,this.password=i[4]||null,this.host=i[6]||i[7],this.port=i[9]||null)}toString(){return this.uri}};const yL={},iGe=new sb(Ir.applicationUrl);let _l=iGe;const rGe=sGe();let kee=rGe;const zee=()=>_l,MHt=()=>kee;function sGe(){const t=_l.path,e=t.slice(0,t.lastIndexOf("/")+1);return`${`${_l.scheme}://${_l.host}${_l.port!=null?`:${_l.port}`:""}`}${e}`}function pn(t){if(!t)return null;const e={path:null,query:null},i=new sb(t),r=t.indexOf("?");return i.query===null?e.path=t:(e.path=t.slice(0,r),e.query=Uee(i.query)),i.fragment&&(e.hash=i.fragment,i.query===null&&(e.path=e.path.slice(0,e.path.length-(i.fragment.length+1)))),e}function Uee(t){const e=t.split("&"),i={};for(const r of e){if(!r)continue;const s=r.indexOf("=");let n,o;s<0?(n=decodeURIComponent(r),o=""):(n=decodeURIComponent(r.slice(0,s)),o=decodeURIComponent(r.slice(s+1)));let a=i[n];typeof a=="string"&&(a=i[n]=[a]),Array.isArray(a)?a.push(o):i[n]=o}return i}function $P(t,e){return t?Object.keys(t).map(i=>{const r=t[i];if(r==null)return"";const s=encodeURIComponent(i)+"=",n=e?.[i];return n?s+encodeURIComponent(n(r)):Array.isArray(r)?r.map(o=>ee.isSerializable(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):ee.isSerializable(r)?s+encodeURIComponent(JSON.stringify(r)):s+encodeURIComponent(r)}).filter(i=>i).join("&"):""}function Rxe(t=!1){let e,i=gA.proxyUrl;if(typeof t=="string"){e=kxe(t);const r=bV(t);r&&(i=r.proxyUrl)}else e=!!t;if(!i)throw Yje().warn(xle),new U("urlUtils:proxy-not-set",xle);return e&&y7()&&(i=Hee(i)),pn(i)}function OHt(t,e=!1){const i=bV(t);let r,s;if(i){const n=Bee(i.proxyUrl);r=n.path,s=n.query?Uee(n.query):null}else if(e){const n=Rxe(t);r=n.path,s=n.query}if(r){const n=pn(t);t=r+"?"+n.path;const o=$P({...s,...n.query});o&&(t=`${t}?${o}`)}return t}const JA={path:"",query:""};function Bee(t){const e=t.indexOf("?");return e!==-1?(JA.path=t.slice(0,e),JA.query=t.slice(e+1)):(JA.path=t,JA.query=null),JA}function Pxe(t){return t=(t=Iz(t=pGe(t=Bee(t).path),!0)).toLowerCase()}function nGe(t){const e={proxyUrl:t.proxyUrl,urlPrefix:Pxe(t.urlPrefix)},i=gA.proxyRules,r=e.urlPrefix;let s=i.length;for(let n=0;n<i.length;n++){const o=i[n].urlPrefix;if(r.indexOf(o)===0){if(r.length===o.length)return-1;s=n;break}o.indexOf(r)===0&&(s=n+1)}return i.splice(s,0,e),s}function bV(t){const e=gA.proxyRules,i=Pxe(t);for(let r=0;r<e.length;r++)if(i.indexOf(e[r].urlPrefix)===0)return e[r]}function Dxe(t,e){if(!t||!e)return!1;t=Oz(t),e=Oz(e);const i=wle(t),r=wle(e);return i!=null&&r!=null?i.portalHostname===r.portalHostname:i==null&&r==null&&t$(t,e,!0)}function Lxe(t,e){return t=Oz(t),e=Oz(e),Iz(t)===Iz(e)}function Oz(t){const e=(t=bd(t)).indexOf("/sharing");return e>0?t.slice(0,e):t.replace(/\/+$/,"")}function g7(t,e=gA.interceptors){const i=r=>r==null||r instanceof RegExp&&r.test(t)||typeof r=="string"&&t.startsWith(r);if(e){for(const r of e)if(Array.isArray(r.urls)){if(r.urls.some(i))return r}else if(i(r.urls))return r}return null}function t$(t,e,i=!1){if(!t||!e)return!1;const r=_7(t),s=_7(e);return!(!i&&r.scheme!==s.scheme)&&r.host!=null&&s.host!=null&&r.host.toLowerCase()===s.host.toLowerCase()&&r.port===s.port}function Vee(t){if(typeof t=="string"){if(!Ku(t))return!0;t=_7(t)}if(t$(t,_l))return!0;const e=gA.trustedServers||[];for(let i=0;i<e.length;i++){const r=oGe(e[i]);for(let s=0;s<r.length;s++)if(t$(t,r[s]))return!0}return!1}function oGe(t){return yL[t]||(Gee(t)||Wm(t)?yL[t]=[new sb(Hc(t))]:yL[t]=[new sb(`http://${t}`),new sb(`https://${t}`)]),yL[t]}function Hc(t,e=kee,i){return Wm(t)?i?.preserveProtocolRelative?t:_l.scheme==="http"&&_l.authority===Xu(t).slice(2)?`http:${t}`:`https:${t}`:Gee(t)?t:Ed(t[0]==="/"?hGe(e):e,t)}function jee(t,e=kee,i){if(t==null||!Ku(t))return t;const r=bd(t),s=r.toLowerCase(),n=bd(e).toLowerCase().replace(/\/+$/,""),o=i?bd(i).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return t;const a=(d,f,m)=>(m=d.indexOf(f,m))===-1?d.length:m;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return t;t=r.slice(c);const h=n.slice(c-1).replaceAll(/[^/]+/g,"").length;if(h>0)for(let d=0;d<h;d++)t=`../${t}`;else t=`./${t}`;return t}function bd(t){return t=gGe(t=mGe(t=fGe(t=Hc(t=t.trim()))))}function Ed(...t){const e=t.filter(of);if(!e?.length)return;const i=[];if(Ku(e[0])){const s=e[0],n=s.indexOf("//");n!==-1&&(i.push(s.slice(0,n+1)),cGe(e[0])&&(i[0]+="/"),e[0]=s.slice(n+2))}else e[0][0]==="/"&&i.push("");const r=e.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<r.length;s++){const n=r[s];n===".."&&i.length>0&&i[i.length-1]!==".."?i.pop():(!n&&s===r.length-1||n&&(n!=="."||i.length===0))&&i.push(n)}return i.join("/")}function Xu(t,e=!1){if(t==null||i$(t)||wf(t))return null;let i=t.indexOf("://");if(i===-1&&Wm(t))i=2;else{if(i===-1)return null;i+=3}const r=t.indexOf("/",i);return r!==-1&&(t=t.slice(0,r)),e&&(t=Iz(t,!0)),t}function Ku(t){return Wm(t)||Gee(t)}function i$(t){return t!=null&&t.slice(0,5)==="blob:"}function wf(t){return t!=null&&t.slice(0,5)==="data:"}function Nxe(t){const e=qx(t);return e?.isBase64?Mxe(e.data):null}function IHt(t){return Zje(t).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const aGe=/^data:(.*?)(;base64)?,(.*)$/;function qx(t){const e=t.match(aGe);if(!e)return null;const[,i,r,s]=e;return{mediaType:i,isBase64:!!r,data:s}}function Fxe(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}async function RHt(t){return(await fetch(t)).blob()}function PHt(t){const e=Nxe(t);if(!e)return null;const i=qx(t);return new Blob([e],{type:i.mediaType})}function Wm(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function Gee(t){return t!=null&&Oxe.test(t)}function kxe(t){return t!=null&&Jje.test(t)||_l.scheme==="https"&&Wm(t)}function lGe(t){return t!=null&&Ixe.test(t)||_l.scheme==="http"&&Wm(t)}function cGe(t){return t!=null&&Xje.test(t)}function Hee(t){return Wm(t)?`https:${t}`:t.replace(Ixe,"https:")}function uGe(){return _l.scheme==="http"}function y7(){return _l.scheme==="https"}function Iz(t,e=!1){return Wm(t)?t.slice(2):(t=t.replace(Oxe,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function hGe(t){const e=t.indexOf("//"),i=t.indexOf("/",e+2);return i===-1?t:t.slice(0,i)}function dGe(t){let e=0;if(Ku(t)){const r=t.indexOf("//");r!==-1&&(e=r+2)}const i=t.lastIndexOf("/");return i<e?t:t.slice(0,i+1)}function DHt(t,e){if(!t)return"";const i=pn(t).path.replace(/\/+$/,""),r=i.slice(i.lastIndexOf("/")+1);if(!e?.length)return r;const s=new RegExp(`\\.(${e.join("|")})$`,"i");return r.replace(s,"")}function pGe(t){return t.endsWith("/")?t:`${t}/`}function zxe(t){return t.replace(/\/+$/,"")}function fGe(t){if(/^https?:\/\//i.test(t)){const e=Bee(t);t=(t=e.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function mGe(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function gGe(t){const e=gA.httpsDomains;if(!lGe(t))return t;const i=t.indexOf("/",7);let r;if(r=i===-1?t:t.slice(0,i),r=r.toLowerCase().slice(7),Kje.test(r)){if(!r.endsWith(":80"))return t;r=r.slice(0,-3),t=t.replace(":80","")}return uGe()&&r===_l.authority&&!Qje.test(t)||(y7()&&r===_l.authority||e&&e.some(s=>r===s||r.endsWith(`.${s}`))||y7()&&!bV(t))&&(t=Hee(t)),t}function v7(t,e,i){if(!(e&&i&&t&&Ku(t)))return t;const r=t.indexOf("//"),s=t.indexOf("/",r+2),n=t.indexOf(":",r+2),o=Math.min(s<0?t.length:s,n<0?t.length:n);return t.slice(r+2,o).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,r+2)}${i}${t.slice(o)}`}function _7(t){return typeof t=="string"?new sb(Hc(t)):(t.scheme||(t.scheme=_l.scheme),t)}function Uxe(t){return vGe.test(t)}function Bxe(t,e){const i=pn(t),r=Object.keys(i.query||{});return r.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function qee(t,e,i){const r=pn(t),s=r.query||{};return s[e]=String(i),`${r.path}?${$P(s)}`}function a6(t,e){if(!e)return t;const i=pn(t),r=i.query||{};for(const[n,o]of Object.entries(e))o!=null&&(r[n]=o);const s=$P(r);return s?`${i.path}?${s}`:i.path}function yGe(t){if(t==null)return null;const e=t.match(Vxe);return e?e[2]:null}function Sle(t){if(t==null)return null;const e=t.match(Vxe);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}async function LHt(t){return typeof t=="string"?qx(t)??{data:t}:new Promise((e,i)=>{const r=new FileReader;r.readAsDataURL(t),r.onload=()=>e(qx(r.result)),r.onerror=s=>i(s)})}const Vxe=/([^.]*)\.([^/]*)$/,vGe=/(^data:image\/svg|\.svg$)/i,jxe="20250407",Gxe="04d2b42da93678ca718b23aaf7e216985f10fa8e";Symbol.dispose??=Symbol("Symbol.dispose"),Symbol.asyncDispose??=Symbol("Symbol.asyncDispose");const Wee="4.32";let mr,Zee=Wee;Zee="4.32.10";function NHt(t){mr=t}function FHt(t){const e=mr?.findCredential(t);return e?.token?qee(t,"token",e.token):t}X("host-webworker")||globalThis.$arcgis||Object.defineProperty(globalThis,"$arcgis",{configurable:!1,enumerable:!0,writable:!1,value:{}}),X("host-webworker");function yA(t,e){const i=e?.url?.path;if(t&&i&&(t=Hc(t,i,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const r=jee(t,e.portalItem.itemUrl);r!=null&&_Ge.test(r)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(r).path)}return(t=b7(t,e?.portal))&&wV.test(t)?Jee(t):t}function K3(t,e,i=AP.YES){if((t=t&&wV.test(t)?qxe(t):t)==null)return t;!Ku(t)&&e?.blockedRelativeUrls&&e.blockedRelativeUrls.push(t);let r=Hc(t);if(e){const s=e.verifyItemRelativeUrls?.rootPath||e.url?.path;if(s){const n=b7(s,e.portal),o=b7(r,e.portal);r=jee(o,n,n),r!=null&&r!==o&&r!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=Hxe(r,e?.portal),Ku(r)&&(r=bd(r)),e?.resources&&e?.portalItem&&!Ku(r)&&!wf(r)&&i===AP.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(r),compress:!1}),r}function Yee(t,e,i){return yA(t,i)}function Wx(t,e,i,r){const s=K3(t,r);s!==void 0&&(e[i]=s)}const wV=/\/items\/([^/]+)\/resources\/(.*)/,_Ge=/^\.\/resources\//;function bGe(t){return(t?.match(wV)??null)?.[1]??null}function wGe(t){const e=t?.match(wV)??null;if(e==null)return null;const i=e[2],r=i.lastIndexOf("/");if(r===-1){const{path:o,extension:a}=Sle(i);return{prefix:null,filename:o,extension:a}}const{path:s,extension:n}=Sle(i.slice(r+1));return{prefix:i.slice(0,r),filename:s,extension:n}}function Hxe(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?v7(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function b7(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const i=`${e.urlKey}.${e.customBaseUrl}`,r=zee();return t$(r,`${r.scheme}://${i}`)?v7(t,e.portalHostname,i):v7(t,i,e.portalHostname)}function Jee(t){if(!t)return t||null;let e=t;return e&&mr&&!mr.findCredential(e)&&(e=Axe(e),e=e.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),e=e.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),e=e.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),e}function qxe(t){if(!t)return t||null;let e=t;return e=e.replace(/^https?:\/\/cdn\.arcgis\.com/,"https://www.arcgis.com"),e=e.replace(/^https?:\/\/cdndev\.arcgis\.com/,"https://devext.arcgis.com"),e=e.replace(/^https?:\/\/cdnqa\.arcgis\.com/,"https://qaext.arcgis.com"),e&&mr&&!mr.findCredential(e)&&(e=Axe(e)),e}var AP;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(AP||(AP={}));const kHt=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return AP},ensureMainOnlineDomain:Hxe,fromCDNUrl:qxe,fromJSON:yA,itemIdFromResourceUrl:bGe,prefixAndFilenameFromResourceUrl:wGe,read:Yee,toCDNUrl:Jee,toJSON:K3,write:Wx},Symbol.toStringTag,{value:"Module"})),Wxe={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",knowledgegraphserver:"KnowledgeGraphServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer","3dtilesserver":"3DTilesServer",videoserver:"VideoServer"},Zxe=Object.values(Wxe),Yxe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${Zxe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),xGe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^/\\n]+)\\/(${Zxe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),SGe=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function zHt(t){return Yxe.test(t)}function gb(t){if(t==null)return null;const e=pn(t),i=e?.path.match(Yxe)||e?.path.match(xGe);if(!i)return null;const[,r,s,n,o]=i,a=s.indexOf("/");return{title:Xee(a!==-1?s.slice(a+1):s),serverType:Wxe[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:r}}}function TGe(t){const e=pn(t).path.match(SGe);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function Xee(t){return(t=t.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function EGe(t,e){const i=[];if(t){const r=gb(t);r!=null&&r.title&&i.push(r.title)}if(e){const r=Xee(e);i.push(r)}if(i.length===2){if(i[0].toLowerCase().includes(i[1].toLowerCase()))return i[0];if(i[1].toLowerCase().includes(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function Rz(t){let e=Xu(t,!0);return!!e&&(e=e.toLowerCase(),e.endsWith(".arcgis.com")&&(e.startsWith("services")||e.startsWith("tiles")||e.startsWith("features")))}function CGe(t,e){return t&&zxe(Bxe(t,e))}function $Ge(t){let{url:e}=t;if(!e)return{url:e};e=Bxe(e,t.logger);const i=pn(e),r=gb(i.path);let s;if(r!=null)r.sublayer!=null&&t.layer.layerId==null&&(s=r.sublayer),e=r.url.path;else if(t.nonStandardUrlAllowed){const n=TGe(i.path);n!=null&&(e=n.serviceUrl,s=n.sublayerId)}return{url:zxe(e),layerId:s}}function AGe(t,e,i,r,s){Wx(e,r,"url",s),r.url&&t.layerId!=null&&(r.url=Ed(r.url,i,t.layerId.toString()))}function UHt(t){if(!t)return!1;const e=t.toLowerCase(),i=e.includes("/services/"),r=e.includes("/mapserver/wmsserver"),s=e.includes("/imageserver/wmsserver"),n=e.includes("/wmsserver");return i&&(r||s||n)}function MGe(t){if(!t)return!1;const e=new sb(Hc(t)),i=e.authority?.toLowerCase();return i==="server.arcgisonline.com"||i==="services.arcgisonline.com"}const OGe=new Set(["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"]);function IGe(t){const e=Xu(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!OGe.has(e)&&!t.endsWith("/sharing/rest/generateToken")}function Jxe(t,e){return!(!Ir.apiKey||!IGe(t))}function Xxe(t,e,i=!1,r){return new Promise((s,n)=>{if(wa(r))return void n(Tle());let o=()=>{c(),n(new Error(`Unable to load ${e}`))},a=()=>{const h=t;c(),s(h)},l=()=>{if(!t)return;const h=t;c(),h.src="",n(Tle())};const c=()=>{X("esri-image-decode")||(t.removeEventListener("error",o),t.removeEventListener("load",a)),o=null,a=null,t=null,r?.removeEventListener("abort",l),l=null,i&&URL.revokeObjectURL(e)};r?.addEventListener("abort",l),X("esri-image-decode")?t.decode().then(a,o):(t.addEventListener("error",o),t.addEventListener("load",a))})}function Tle(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}const Kxe="Timeout exceeded";function RGe(){return new Error(Kxe)}function BHt(t){return typeof t=="object"&&!!t&&"message"in t&&t.message===Kxe}function PGe(t){Ir.request.crossOriginNoCorsDomains||(Ir.request.crossOriginNoCorsDomains={});const e=Ir.request.crossOriginNoCorsDomains;for(let i of t)i=i.toLowerCase(),/^https?:\/\//.test(i)?e[Xu(i)??""]=0:(e[Xu("http://"+i)??""]=0,e[Xu("https://"+i)??""]=0)}function DGe(t){const e=Ir.request.crossOriginNoCorsDomains;if(e){let i=Xu(t);if(i)return i=i.toLowerCase(),!t$(i,zee())&&e[i]<Date.now()-36e5}return!1}async function LGe(t){const e=pn(t);t=e.path,e.query?.f==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}const i=Ir.request.crossOriginNoCorsDomains,r=Xu(t);i&&r&&(i[r.toLowerCase()]=Date.now())}async function Ci(t,e){t instanceof URL&&(t=t.toString()),e?.query instanceof URLSearchParams&&(e.query=Uee(e.query.toString().replaceAll("+"," ")));const i=wf(t),r=i$(t);r||i||(t=bd(t));const s={url:t,requestOptions:{...e}},n=m=>({data:m,getAllHeaders:r$,getHeader:r$,httpStatus:200,requestOptions:s.requestOptions,url:s.url}),o=g7(t,qh.internalInterceptors);if(o){const m=await Cle(o,s);if(m!=null)return n(m)}let a=g7(t);if(a){const m=await Cle(a,s);if(m!=null)return n(m);a.after||a.error||(a=null)}if(t=s.url,(e=s.requestOptions).responseType==="image"&&(X("host-webworker")||X("host-node")))throw Qp("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s);if(e.method==="head"){if(e.body)throw Qp("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(i||r)throw Qp("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await UGe(),Pz)return Pz.execute(t,e);const l=new AbortController,c=Xo(e,()=>l.abort()),h={controller:l,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:a,params:s,redoRequest:!1,useIdentity:qh.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},d=e.useRequestQueue?HGe(h):x7(h),f=await d.finally(()=>c?.remove());return a?.after?.(f),f}let Pz;const qh=Ir.request,Qxe="FormData"in globalThis,NGe=new Set([499,498,403,401]),FGe=new Set(["COM_0056","COM_0057","SB_0008"]),kGe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],r$=()=>null,Dz=Symbol();function zGe(t){const e=Xu(t);e&&!Ci._corsServers.includes(e)&&Ci._corsServers.push(e)}function Ele(t){const e=Xu(t);return!e||e.endsWith(".arcgis.com")||Ci._corsServers.includes(e)||Vee(e)}function Qp(t,e,i,r){let s="Error";const n={url:i.url,requestOptions:i.requestOptions,getAllHeaders:r$,getHeader:r$,ssl:!1};if(e instanceof U)return e.details?(e.details=q(e.details),e.details.url=i.url,e.details.requestOptions=i.requestOptions):e.details=n,e;if(e){const o=r&&(()=>Array.from(r.headers)),a=r&&(h=>r.headers.get(h)),l=r?.status,c=e.message;c&&(s=c),o&&a&&(n.getAllHeaders=o,n.getHeader=a),n.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||l||0,n.subCode=e.subcode,n.messageCode=e.messageCode,typeof e.details=="string"?n.messages=[e.details]:n.messages=e.details,n.raw=Dz in e?e[Dz]:e}return Xr(e)?vi():new U(t,s,n)}async function UGe(){X("host-webworker")&&!Pz&&(Pz=await V(()=>import("./request-7hbPjSHA.js"),[]))}async function w7(){mr||await V(()=>import("./IdentityManager-O8k6Z88T.js"),__vite__mapDeps([0,1]))}async function BGe(t){const e=t.params.url,i=t.params.requestOptions,r=t.controller.signal,s=i.body;let n=null,o=null;if(Qxe&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(o=s),t.fetchOptions={cache:i.cacheBust?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},method:i.method==="head"?"HEAD":"GET",mode:"cors",priority:qh.priority,redirect:"follow",signal:r},(n||o)&&(t.fetchOptions.body=n||o),i.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||i.query?.token||n?.get("token")),!t.hasToken&&Jxe(e)&&(i.query||(i.query={}),i.query.token=Ir.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!eSe(e)&&!wa(r)){let a;i.authMode==="immediate"?(await w7(),a=await mr.getCredential(e,{signal:r}),t.credential=a):i.authMode==="no-prompt"?(await w7(),a=await mr.getCredential(e,{prompt:!1,signal:r}).catch(()=>{}),t.credential=a):mr&&(a=mr.findCredential(e)),a&&(t.credentialToken=a.token,t.useSSL=!!a.ssl)}}function eSe(t){return kGe.some(e=>e.test(t))}async function VGe(t){let e=t.params.url;const i=t.params.requestOptions,r=t.fetchOptions??{},s=i$(e)||wf(e),n=i.responseType||"json",o=s?0:i.timeout!=null?i.timeout:qh.timeout;let a=!1;if(!s){t.useSSL&&(e=Hee(e));let f={...i.query};t.credentialToken&&(f.token=t.credentialToken);let m=$P(f);X("esri-url-encodes-apostrophe")&&(m=m.replaceAll("'","%27"));const y=e.length+1+m.length;let v;a=i.method==="delete"||i.method==="post"||i.method==="put"||!!i.body||y>qh.maxUrlLength;const _=i.useProxy||!!bV(e);if(_){const b=Rxe(e);v=b.path,!a&&v.length+1+y>qh.maxUrlLength&&(a=!0),b.query&&(f={...b.query,...f})}if(r.method==="HEAD"&&(a||_)){if(a)throw y>qh.maxUrlLength?Qp("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):Qp("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(_)throw Qp("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}a?(r.method=i.method==="delete"?"DELETE":i.method==="put"?"PUT":"POST",i.body?e=a6(e,f):(r.body=$P(f),r.headers||(r.headers={}),r.headers["Content-Type"]="application/x-www-form-urlencoded")):e=a6(e,f),_&&(t.useProxy=!0,e=`${v}?${e}`),f.token&&Qxe&&r.body instanceof FormData&&!Wje(e)&&r.body.set("token",f.token),i.hasOwnProperty("withCredentials")?t.withCredentials=i.withCredentials:t$(e,zee())||(Vee(e)||mr&&mr.findServerInfo(e)?.webTierAuth)&&(t.withCredentials=!0),t.withCredentials&&(r.credentials="include",DGe(e)&&await LGe(a?a6(e,f):e))}let l,c,h=0,d=!1;o>0&&(h=setTimeout(()=>{d=!0,t.controller.abort()},o));try{if(i.responseType==="native-request-init")c=r,c.url=e,i.signal?c.signal=i.signal:delete c.signal;else if(i.responseType!=="image"||r.cache!=="default"||r.method!=="GET"||a||jGe(i.headers)||!s&&!t.useProxy&&qh.proxyUrl&&!Ele(e)){if(Ci._beforeFetch&&await Ci._beforeFetch(e,r),l=await fetch(e,r),Ci._afterFetch&&await Ci._afterFetch(l),t.useProxy||zGe(e),i.responseType==="native")c=l;else if(r.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(h&&(clearTimeout(h),h=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=$le(c,"application/xml");break;case"document":c=$le(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const f=l.headers.get("Content-Type");if(f&&/application\/json|text\/plain/i.test(f)&&c[n==="blob"?"size":"byteLength"]<=750)try{const m=await new Response(c).json();m.error&&(c=m)}catch{}}n==="image"&&c instanceof Blob&&(c=await Ale(URL.createObjectURL(c),t,!0))}}else{c=await l.text();try{c=JSON.parse(c)}catch{}}}else c=await Ale(e,t)}catch(f){if(f.name==="AbortError")throw d?RGe():vi("Request canceled");if(!(!l&&f instanceof TypeError&&qh.proxyUrl)||i.body||i.method==="delete"||i.method==="head"||i.method==="post"||i.method==="put"||t.useProxy||Ele(e))throw f;t.redoRequest=!0,nGe({proxyUrl:qh.proxyUrl,urlPrefix:Xu(e)??""})}finally{h&&clearTimeout(h)}return[l,c]}async function Cle(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let i,r;try{r=await t.before(e)}catch(s){i=Qp("request:interceptor",s,e)}if((r instanceof Error||r instanceof U)&&(i=Qp("request:interceptor",r,e)),i)throw t.error&&t.error(i),i;return r}}function jGe(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function $le(t,e){let i;try{i=new DOMParser().parseFromString(t,e)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}Ci._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"],Ci._beforeFetch=void 0,Ci._afterFetch=void 0;const GGe=new Map;async function HGe(t){const e=WGe(t.params.url);if(!e)return x7(t);const{QueueProcessor:i}=await V(()=>import("./QueueProcessor-BH4vjdGx.js"),[]);return zb(GGe,e.origin,()=>{const s=e.isHosted?X("request-queue-concurrency-hosted"):X("request-queue-concurrency-non-hosted");return new i({concurrency:s,process:n=>{if(wa(n.params.requestOptions))throw Qp("",vi("Request canceled"),n.params);return x7(n)}})}).push(t)}async function x7(t){let e,i;await BGe(t);try{do[e,i]=await VGe(t);while(!await qGe(t,e,i))}catch(n){const o=Qp("request:server",n,t.params,e);throw o.details.ssl=t.useSSL,t.interceptor?.error&&t.interceptor.error(o),o}const r=t.params.url;if(i&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(r)){if(!t.hasToken&&!t.credentialToken&&i.user?.username&&!Vee(r)){const n=Xu(r,!0);n&&qh.trustedServers.push(n)}Array.isArray(i.authorizedCrossOriginNoCorsDomains)&&PGe(i.authorizedCrossOriginNoCorsDomains)}const s=t.credential;if(s&&mr){let o=mr.findServerInfo(s.server)?.owningSystemUrl;if(o){o=o.replace(/\/?$/,"/sharing");const a=mr.findCredential(o,s.userId);a&&mr._getIdenticalSvcIdx(o,a)===-1&&a.resources.unshift(o)}}return{data:i,getAllHeaders:e?()=>Array.from(e.headers):r$,getHeader:e?n=>e.headers.get(n):r$,httpStatus:e?.status??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function qGe(t,e,i){if(t.redoRequest)return t.redoRequest=!1,!1;const r=t.params.requestOptions;if(!e||r.responseType==="native"||r.responseType==="native-request-init")return!0;let s,n;if(i&&(i.error&&typeof i.error=="object"?s=i.error:i.status==="error"&&Array.isArray(i.messages)&&(s={...i},s[Dz]=i,s.details=i.messages)),!s&&!e.ok)throw s=new Error(`Unable to load ${e.url} status: ${e.status}`),s[Dz]=i,s;let o,a=null;s&&(n=Number(s.code),a=s.hasOwnProperty("subcode")?Number(s.subcode):null,o=s.messageCode,o=o?.toUpperCase());const l=r.authMode;if(n===403&&(a===4||s.message?.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||n===498)&&n!==void 0&&NGe.has(n)&&!eSe(t.params.url)&&(n!==403||(!o||!FGe.has(o))&&(a==null||a===2&&t.credentialToken))){await w7();try{const c=await mr.getCredential(t.params.url,{error:Qp("request:server",s,t.params),prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=c,t.credentialToken=c.token,t.useSSL=t.useSSL||c.ssl,!1}catch(c){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;s=c}}if(s)throw s;return!0}function Ale(t,e,i=!1){const r=e.controller.signal,s=new Image;return e.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=qh.priority,s.src=t,Xxe(s,t,i,r)}function WGe(t){let e,i;return typeof t=="string"?(e=Xu(t,!0),i=Rz(t)):(e=t.origin,i=Rz(t.toString())),e==null?null:{origin:e,isHosted:i}}function ZGe(t,e){return Ci(gs(t),e)}function gs(t){if(!Ir.assetsPath)throw J.getLogger("esri.assets").errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new U("assets:path-not-set","config.assetsPath is not set");return Ed(Ir.assetsPath,t)}let l6,Z=null;function Kee(){return!!Z}function YGe(){return!!X("esri-wasm")}function tSe(){return l6||(l6=V(()=>import("./pe-wasm-CRA-qgEz.js"),__vite__mapDeps([2,3])).then(t=>t.p).then(({default:t})=>t({locateFile:e=>gs(`esri/geometry/support/${e}`)})).then(t=>{sSe(t)}),l6)}var S7,Gs;(function(t){function e(n,o,a){Z.ensureCache.prepare();const l=Y1(a),c=a===l,h=Z.ensureFloat64(l),d=Z._pe_geog_to_proj(Z.getPointer(n),o,h);return d&&$_(a,o,h,c),d}function i(n,o,a,l){switch(l){case Gs.PE_TRANSFORM_P_TO_G:return r(n,o,a);case Gs.PE_TRANSFORM_G_TO_P:return e(n,o,a)}return 0}function r(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){Z.ensureCache.prepare();const c=Y1(a),h=a===c,d=Z.ensureFloat64(c),f=Z._pe_proj_to_geog_center(Z.getPointer(n),o,d,l);return f&&$_(a,o,d,h),f}t.geogToProj=e,t.projGeog=i,t.projToGeog=r,t.projToGeogCenter=s})(S7||(S7={})),function(t){function e(){t.PE_BUFFER_MAX=Z.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=Z.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=Z.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=Z.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=Z.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=Z.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=Z.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=Z.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=Z.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=Z.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=Z.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=Z.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=Z.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=Z.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=Z.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=Z.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=Z.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=Z.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=Z.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=Z.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_STR_FMT_WKT=Z.PeDefs.prototype.PE_STR_FMT_WKT,t.PE_STR_FMT_WKT2=Z.PeDefs.prototype.PE_STR_FMT_WKT2,t.PE_PARM_X0=Z.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=Z.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=Z.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=Z.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=Z.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=Z.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=Z.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=Z.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=Z.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=Z.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}(Gs||(Gs={}));let iSe=null;var T7;(function(t){const e={},i={},r=m=>{const y=m.getType();switch(y){case Gs.PE_TYPE_GEOGCS:m=Z.castObject(m,Z.PeGeogcs);break;case Gs.PE_TYPE_PROJCS:m=Z.castObject(m,Z.PeProjcs);break;case Gs.PE_TYPE_GEOGTRAN:m=Z.castObject(m,Z.PeGeogtran);break;default:y&Gs.PE_TYPE_UNIT&&(m=Z.castObject(m,Z.PeUnit))}return m};function s(){Z.PeFactory.prototype.initialize(null)}function n(m){return o(Gs.PE_TYPE_COORDSYS,m)}function o(m,y){let v=null,_=e[m];if(_||(_={},e[m]=_),_.hasOwnProperty(String(y))&&(v=_[y],Z.compare(v,Z.NULL)&&(v=null)),!v){const b=Z.PeFactory.prototype.factoryByType(m,y);Z.compare(b,Z.NULL)||(v=r(b),_[y]=v)}return v}function a(m,y){let v=null,_=i[m];if(_||(_={},i[m]=_),_.hasOwnProperty(y)&&(v=_[y],Z.compare(v,Z.NULL)&&(v=null)),!v){const b=Z.PeFactory.prototype.fromString(m,y);Z.compare(b,Z.NULL)||(v=r(b),_[y]=v)}return v}function l(m){return o(Gs.PE_TYPE_GEOGCS,m)}function c(m){return o(Gs.PE_TYPE_GEOGTRAN,m)}function h(m){return Z.PeFactory.prototype.getCode(m)}function d(m){return o(Gs.PE_TYPE_PROJCS,m)}function f(m){return o(Gs.PE_TYPE_UNIT,m)}t.initialize=s,t.coordsys=n,t.factoryByType=o,t.fromString=a,t.geogcs=l,t.geogtran=c,t.getCode=h,t.projcs=d,t.unit=f})(T7||(T7={}));let rSe=null;var Lz,E7,C7,$7,A7,M7,Nz,O7,Fz,kz,I7;function sSe(t){function e(n,o,a){n[o]=a(n[o])}Z=t,Gs.init(),Lz.init(),Nz.init(),Fz.init(),kz.init(),iSe=class extends Z.PeDouble{constructor(n=NaN){super(n)}destroy(){Z.destroy(this)}[Symbol.dispose](){this.destroy()}},rSe=class extends Z.PeGCSExtent{destroy(){Z.destroy(this)}[Symbol.dispose](){this.destroy()}};const i=[Z.PeAngunit,Z.PeDatum,Z.PeGeogcs,Z.PeGeogtran,Z.PeObject,Z.PeParameter,Z.PePrimem,Z.PeProjcs,Z.PeSpheroid,Z.PeUnit];for(const n of i)e(n.prototype,"getName",o=>function(){return o.call(this,new Array(Gs.PE_NAME_MAX))});for(const n of[Z.PeGeogtran,Z.PeProjcs])e(n.prototype,"getParameters",o=>function(){const a=new Array(Gs.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const h=Z.getValue(l,"*");a[c]=h?Z.wrapPointer(h,Z.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});e(Z.PeHorizon.prototype,"getCoord",n=>function(o=!1){const a=this.getSize();if(!a)return null;const l=[];return $_(l,a,n.call(this),o),l}),e(Z.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=Z._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!Z.compare(l,Z.NULL)){a=[l];const c=this.getSteps();if(c>1){const h=Z.getPointer(l);for(let d=1;d<c;d++)a.push(Z.wrapPointer(h+o*d,Z.PeGTlistExtendedGTs))}}return a}});const r=Z._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!Z.compare(l,Z.NULL)){a=[l];const c=l.getNump();if(c>1){const h=Z.getPointer(l);for(let d=1;d<c;d++)a.push(Z.wrapPointer(h+r*d,Z.PeHorizon))}}return o.set(n,a),a};e(Z.PeProjcs.prototype,"horizonGcsGenerate",s),e(Z.PeProjcs.prototype,"horizonPcsGenerate",s),Z.PeObject.prototype.toString=function(n=Gs.PE_STR_OPTS_NONE){Z.ensureCache.prepare();const o=Z.getPointer(this),a=Z.ensureInt8(new Array(Gs.PE_BUFFER_MAX));return Z.UTF8ToString(Z._pe_object_to_string_ext(o,n,a))},Z.PeGeogcs.prototype.destroy=function(){this.Delete(),Ep(this),this.ptr=0},Z.PeGeogcs.prototype[Symbol.dispose]=function(){this.destroy()},Z.PeProjcs.prototype.destroy=function(){this.Delete(),Ep(this),this.ptr=0},Z.PeProjcs.prototype[Symbol.dispose]=function(){this.destroy()}}function Ep(t){if(!t)return;const e=Z.getClass(t);if(!e)return;const i=Z.getCache(e);if(!i)return;const r=Z.getPointer(t);r&&delete i[r]}function vL(t,e){const i=[],r=new Array(e);for(let s=0;s<t;s++)i.push(Z.ensureInt8(r));return i}function Y1(t){return ArrayBuffer.isView(t)?t:Array.isArray(t[0])?t.flat():t}function $_(t,e,i,r=!1){if(r)for(let s=0;s<2*e;s++)t[s]=Z.getValue(i+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=t.length===0;for(let n=0;n<e;n++)s&&(t[n]=new Array(2)),t[n][0]=Z.getValue(i,"double"),t[n][1]=Z.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function i(){t.PE_GTLIST_OPTS_COMMON=Z.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=Z._pe_getPeGTlistExtendedEntrySize()}function r(s,n,o,a,l,c){let h=null;const d=new Z.PeInteger(c);try{const f=Z.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,d);if((c=d.val)&&(h=[f],c>1)){const m=Z.getPointer(f);for(let y=1;y<c;y++)h.push(Z.wrapPointer(m+e*y,Z.PeGTlistExtendedEntry))}}finally{Z.destroy(d)}return h}t.init=i,t.getGTlist=r})(Lz||(Lz={})),function(t){function e(i){if(i?.length){for(const r of i)Ep(r),r.getEntries().forEach(s=>{Ep(s);const n=s.getGeogtran();Ep(n),n.getParameters().forEach(Ep),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{Ep(o);const a=o.getDatum();Ep(a),Ep(a.getSpheroid()),Ep(o.getPrimem()),Ep(o.getUnit())})});Z.PeGTlistExtendedEntry.prototype.Delete(i[0])}}t.destroy=e}(E7||(E7={})),function(t){function e(i,r,s,n,o){Z.ensureCache.prepare();const a=Y1(s),l=s===a,c=Z.ensureFloat64(a);let h=0;n&&(h=Z.ensureFloat64(n));const d=Z._pe_geog_to_geog(Z.getPointer(i),r,c,h,o);return d&&$_(s,r,c,l),d}t.geogToGeog=e}(C7||(C7={})),function(t){function e(n,o,a,l,c,h,d,f){Z.PeLineType.prototype.geodesic_coordinate(n,o,a,l,c,h,d,f)}function i(n,o,a,l,c,h,d,f,m){Z.PeLineType.prototype.geodetic_coordinate(n,o,a,l,c,h,d,f,m)}function r(n,o,a,l,c,h,d,f,m,y){Z.PeLineType.prototype.geodetic_distance(n,o,a,l,c,h,d,f,m,y)}function s(n,o,a,l,c,h,d,f,m){Z.PeLineType.prototype.great_elliptic_distance(n,o,a,l,c,h,d,f,m)}t.geodesicCoordinate=e,t.geodeticCoordinate=i,t.geodeticDistance=r,t.greatEllipticDistance=s}($7||($7={})),function(t){function e(o,a){return Z.PeMath.prototype.phi_to_eta(o,a)}function i(o,a){return Z.PeMath.prototype.eta_to_phi(o,a)}function r(o,a){return Z.PeMath.prototype.phi_to_phig(o,a)}function s(o,a,l){return Z.PeMath.prototype.q(o,a,l)}function n(o,a){return Z.PeMath.prototype.q90(o,a)}t.phiToEta=e,t.etaToPhi=i,t.phiToPhig=r,t.q=s,t.q90=n}(A7||(A7={})),function(t){const e=(c,h,d,f,m,y)=>{let v,_;switch(Z.ensureCache.prepare(),c){case"dd":v=Z._pe_geog_to_dd,_=Gs.PE_DD_MAX;break;case"ddm":v=Z._pe_geog_to_ddm,_=Gs.PE_DDM_MAX;break;case"dms":v=Z._pe_geog_to_dms,_=Gs.PE_DMS_MAX}let b=0;h&&(b=Z.getPointer(h));const w=Y1(f),x=Z.ensureFloat64(w),S=vL(d,_),C=v(b,d,x,m,Z.ensureInt32(S));if(C)for(let T=0;T<d;T++)y[T]=Z.UTF8ToString(S[T]);return C},i=(c,h,d,f,m)=>{let y;switch(Z.ensureCache.prepare(),c){case"dd":y=Z._pe_dd_to_geog;break;case"ddm":y=Z._pe_ddm_to_geog;break;case"dms":y=Z._pe_dms_to_geog}let v=0;h&&(v=Z.getPointer(h));const _=f.map(S=>Z.ensureString(S)),b=Z.ensureInt32(_),w=Z.ensureFloat64(new Array(2*d)),x=y(v,d,b,w);return x&&$_(m,d,w),x};function r(c,h,d,f,m){return e("dms",c,h,d,f,m)}function s(c,h,d,f){return i("dms",c,h,d,f)}function n(c,h,d,f,m){return e("ddm",c,h,d,f,m)}function o(c,h,d,f){return i("ddm",c,h,d,f)}function a(c,h,d,f,m){return e("dd",c,h,d,f,m)}function l(c,h,d,f){return i("dd",c,h,d,f)}t.geogToDms=r,t.dmsToGeog=s,t.geogToDdm=n,t.ddmToGeog=o,t.geogToDd=a,t.ddToGeog=l}(M7||(M7={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=Z.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=Z.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=Z.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=Z.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=Z.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function i(s,n,o,a,l,c,h){Z.ensureCache.prepare();let d=0;s&&(d=Z.getPointer(s));const f=Y1(o),m=Z.ensureFloat64(f),y=vL(n,Gs.PE_MGRS_MAX),v=Z.ensureInt32(y),_=Z._pe_geog_to_mgrs_extended(d,n,m,a,l,c,v);if(_)for(let b=0;b<n;b++)h[b]=Z.UTF8ToString(y[b]);return _}function r(s,n,o,a,l){Z.ensureCache.prepare();let c=0;s&&(c=Z.getPointer(s));const h=o.map(y=>Z.ensureString(y)),d=Z.ensureInt32(h),f=Z.ensureFloat64(new Array(2*n)),m=Z._pe_mgrs_to_geog_extended(c,n,d,a,f);return m&&$_(l,n,f),m}t.init=e,t.geogToMgrsExtended=i,t.mgrsToGeogExtended=r}(Nz||(Nz={})),function(t){function e(r,s,n,o,a,l,c){Z.ensureCache.prepare();let h=0;r&&(h=Z.getPointer(r));const d=Y1(n),f=Z.ensureFloat64(d),m=vL(s,Gs.PE_MGRS_MAX),y=Z.ensureInt32(m),v=Z._pe_geog_to_usng(h,s,f,o,a,l,y);if(v)for(let _=0;_<s;_++)c[_]=Z.UTF8ToString(m[_]);return v}function i(r,s,n,o){Z.ensureCache.prepare();let a=0;r&&(a=Z.getPointer(r));const l=n.map(f=>Z.ensureString(f)),c=Z.ensureInt32(l),h=Z.ensureFloat64(new Array(2*s)),d=Z._pe_usng_to_geog(a,s,c,h);return d&&$_(o,s,h),d}t.geogToUsng=e,t.usngToGeog=i}(O7||(O7={})),function(t){function e(){t.PE_UTM_OPTS_NONE=Z.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=Z.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=Z.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function i(s,n,o,a,l){Z.ensureCache.prepare();let c=0;s&&(c=Z.getPointer(s));const h=Y1(o),d=Z.ensureFloat64(h),f=vL(n,Gs.PE_UTM_MAX),m=Z.ensureInt32(f),y=Z._pe_geog_to_utm(c,n,d,a,m);if(y)for(let v=0;v<n;v++)l[v]=Z.UTF8ToString(f[v]);return y}function r(s,n,o,a,l){Z.ensureCache.prepare();let c=0;s&&(c=Z.getPointer(s));const h=o.map(y=>Z.ensureString(y)),d=Z.ensureInt32(h),f=Z.ensureFloat64(new Array(2*n)),m=Z._pe_utm_to_geog(c,n,d,a,f);return m&&$_(l,n,f),m}t.init=e,t.geogToUtm=i,t.utmToGeog=r}(Fz||(Fz={})),function(t){const e=new Map;function i(){t.PE_PCSINFO_OPTION_NONE=Z.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=Z.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=Z.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=Z.PePCSInfo.prototype.PE_POLE_POINT}function r(s,n=t.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return e.has(s)&&(a=e.get(s),a[n]&&(o=a[n])),o||(o=Z.PePCSInfo.prototype.generate(s,n),a||(a=[],e.set(s,a)),a[n]=o),o}t.init=i,t.generate=r}(kz||(kz={})),function(t){function e(){return Z.PeVersion.prototype.version_string()}t.versionString=e}(I7||(I7={}));const JGe=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return S7},get PeDefs(){return Gs},get PeDouble(){return iSe},get PeFactory(){return T7},get PeGCSExtent(){return rSe},get PeGTTransformations(){return C7},get PeGTlistExtended(){return Lz},get PeGTlistExtendedEntry(){return E7},get PeLineType(){return $7},get PeMath(){return A7},get PeNotationDms(){return M7},get PeNotationMgrs(){return Nz},get PeNotationUsng(){return O7},get PeNotationUtm(){return Fz},get PePCSInfo(){return kz},get PeVersion(){return I7},_init:sSe,get _pe(){return Z},isLoaded:Kee,isSupported:YGe,load:tSe},Symbol.toStringTag,{value:"Module"}));var qc;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})(qc||(qc={}));let g;const O={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9895:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,10160:0,10183:0,10188:0,10194:0,10199:0,10207:0,10212:0,10217:0,10222:0,10227:0,10235:0,10240:0,10250:0,10254:0,10270:0,10275:0,10280:0,10306:0,10329:0,10471:0,10477:0,10481:2,10516:2,10592:0,10594:0,10596:0,10598:0,10601:0,10603:0,10626:0,10632:0,10665:0,20002:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2,103897:1,103978:2,103979:0,103980:2,103981:0};for(g=2e3;g<=2045;g++)O[g]=0;for(g=2056;g<=2065;g++)O[g]=0;for(g=2067;g<=2135;g++)O[g]=0;for(g=2137;g<=2154;g++)O[g]=0;for(g=2161;g<=2170;g++)O[g]=0;for(g=2172;g<=2193;g++)O[g]=0;for(g=2195;g<=2198;g++)O[g]=0;for(g=2200;g<=2203;g++)O[g]=0;for(g=2205;g<=2217;g++)O[g]=0;for(g=2222;g<=2224;g++)O[g]=1;for(g=2225;g<=2250;g++)O[g]=2;for(g=2251;g<=2253;g++)O[g]=1;for(g=2257;g<=2264;g++)O[g]=2;for(g=2274;g<=2279;g++)O[g]=2;for(g=2280;g<=2282;g++)O[g]=1;for(g=2283;g<=2289;g++)O[g]=2;for(g=2290;g<=2292;g++)O[g]=0;for(g=2308;g<=2313;g++)O[g]=0;for(g=2315;g<=2491;g++)O[g]=0;for(g=2494;g<=2866;g++)O[g]=0;for(g=2867;g<=2869;g++)O[g]=1;for(g=2870;g<=2888;g++)O[g]=2;for(g=2891;g<=2895;g++)O[g]=2;for(g=2896;g<=2898;g++)O[g]=1;for(g=2902;g<=2908;g++)O[g]=2;for(g=2915;g<=2920;g++)O[g]=2;for(g=2921;g<=2923;g++)O[g]=1;for(g=2924;g<=2930;g++)O[g]=2;for(g=2931;g<=2962;g++)O[g]=0;for(g=2964;g<=2968;g++)O[g]=2;for(g=2969;g<=2973;g++)O[g]=0;for(g=2975;g<=2991;g++)O[g]=0;for(g=2995;g<=3051;g++)O[g]=0;for(g=3054;g<=3079;g++)O[g]=0;for(g=3081;g<=3088;g++)O[g]=0;for(g=3092;g<=3101;g++)O[g]=0;for(g=3106;g<=3138;g++)O[g]=0;for(g=3146;g<=3151;g++)O[g]=0;for(g=3153;g<=3166;g++)O[g]=0;for(g=3168;g<=3172;g++)O[g]=0;for(g=3174;g<=3203;g++)O[g]=0;for(g=3294;g<=3358;g++)O[g]=0;for(g=3367;g<=3403;g++)O[g]=0;for(g=3408;g<=3416;g++)O[g]=0;for(g=3417;g<=3438;g++)O[g]=2;for(g=3441;g<=3446;g++)O[g]=2;for(g=3447;g<=3450;g++)O[g]=0;for(g=3451;g<=3459;g++)O[g]=2;for(g=3460;g<=3478;g++)O[g]=0;for(g=3554;g<=3559;g++)O[g]=0;for(g=3560;g<=3570;g++)O[g]=2;for(g=3571;g<=3581;g++)O[g]=0;for(g=3594;g<=3597;g++)O[g]=0;for(g=3601;g<=3604;g++)O[g]=0;for(g=3637;g<=3639;g++)O[g]=0;for(g=3665;g<=3667;g++)O[g]=0;for(g=3693;g<=3695;g++)O[g]=0;for(g=3701;g<=3727;g++)O[g]=0;for(g=3728;g<=3739;g++)O[g]=2;for(g=3740;g<=3751;g++)O[g]=0;for(g=3753;g<=3760;g++)O[g]=2;for(g=3761;g<=3773;g++)O[g]=0;for(g=3775;g<=3777;g++)O[g]=0;for(g=3779;g<=3781;g++)O[g]=0;for(g=3783;g<=3785;g++)O[g]=0;for(g=3788;g<=3791;g++)O[g]=0;for(g=3797;g<=3802;g++)O[g]=0;for(g=3814;g<=3816;g++)O[g]=0;for(g=3825;g<=3829;g++)O[g]=0;for(g=3832;g<=3841;g++)O[g]=0;for(g=3844;g<=3852;g++)O[g]=0;for(g=3873;g<=3885;g++)O[g]=0;for(g=3890;g<=3893;g++)O[g]=0;for(g=3907;g<=3912;g++)O[g]=0;for(g=3942;g<=3950;g++)O[g]=0;for(g=3968;g<=3970;g++)O[g]=0;for(g=3973;g<=3976;g++)O[g]=0;for(g=3986;g<=3989;g++)O[g]=0;for(g=3994;g<=3997;g++)O[g]=0;for(g=4048;g<=4051;g++)O[g]=0;for(g=4056;g<=4063;g++)O[g]=0;for(g=4093;g<=4096;g++)O[g]=0;for(g=4390;g<=4398;g++)O[g]=0;for(g=4399;g<=4413;g++)O[g]=2;for(g=4418;g<=4433;g++)O[g]=2;for(g=4455;g<=4457;g++)O[g]=2;for(g=4484;g<=4489;g++)O[g]=0;for(g=4491;g<=4554;g++)O[g]=0;for(g=4568;g<=4589;g++)O[g]=0;for(g=4652;g<=4656;g++)O[g]=0;for(g=4766;g<=4800;g++)O[g]=0;for(g=5014;g<=5016;g++)O[g]=0;for(g=5069;g<=5072;g++)O[g]=0;for(g=5105;g<=5130;g++)O[g]=0;for(g=5167;g<=5188;g++)O[g]=0;for(g=5253;g<=5259;g++)O[g]=0;for(g=5269;g<=5275;g++)O[g]=0;for(g=5292;g<=5311;g++)O[g]=0;for(g=5329;g<=5331;g++)O[g]=0;for(g=5343;g<=5349;g++)O[g]=0;for(g=5355;g<=5357;g++)O[g]=0;for(g=5387;g<=5389;g++)O[g]=0;for(g=5459;g<=5463;g++)O[g]=0;for(g=5479;g<=5482;g++)O[g]=0;for(g=5518;g<=5520;g++)O[g]=0;for(g=5530;g<=5539;g++)O[g]=0;for(g=5550;g<=5552;g++)O[g]=0;for(g=5562;g<=5583;g++)O[g]=0;for(g=5623;g<=5625;g++)O[g]=2;for(g=5631;g<=5639;g++)O[g]=0;for(g=5649;g<=5653;g++)O[g]=0;for(g=5663;g<=5680;g++)O[g]=0;for(g=5682;g<=5685;g++)O[g]=0;for(g=5875;g<=5877;g++)O[g]=0;for(g=5896;g<=5899;g++)O[g]=0;for(g=5921;g<=5940;g++)O[g]=0;for(g=6050;g<=6125;g++)O[g]=0;for(g=6244;g<=6275;g++)O[g]=0;for(g=6328;g<=6348;g++)O[g]=0;for(g=6350;g<=6356;g++)O[g]=0;for(g=6366;g<=6372;g++)O[g]=0;for(g=6381;g<=6387;g++)O[g]=0;for(g=6393;g<=6404;g++)O[g]=0;for(g=6480;g<=6483;g++)O[g]=0;for(g=6511;g<=6514;g++)O[g]=0;for(g=6579;g<=6581;g++)O[g]=0;for(g=6619;g<=6624;g++)O[g]=0;for(g=6625;g<=6627;g++)O[g]=2;for(g=6628;g<=6632;g++)O[g]=0;for(g=6634;g<=6637;g++)O[g]=0;for(g=6669;g<=6692;g++)O[g]=0;for(g=6707;g<=6709;g++)O[g]=0;for(g=6720;g<=6723;g++)O[g]=0;for(g=6732;g<=6738;g++)O[g]=0;for(g=6931;g<=6933;g++)O[g]=0;for(g=6956;g<=6959;g++)O[g]=0;for(g=7005;g<=7007;g++)O[g]=0;for(g=7057;g<=7070;g++)O[g]=2;for(g=7074;g<=7082;g++)O[g]=0;for(g=7109;g<=7118;g++)O[g]=0;for(g=7119;g<=7127;g++)O[g]=1;for(g=7374;g<=7376;g++)O[g]=0;for(g=7528;g<=7586;g++)O[g]=0;for(g=7587;g<=7645;g++)O[g]=2;for(g=7692;g<=7696;g++)O[g]=0;for(g=7755;g<=7787;g++)O[g]=0;for(g=7791;g<=7795;g++)O[g]=0;for(g=7799;g<=7801;g++)O[g]=0;for(g=7803;g<=7805;g++)O[g]=0;for(g=7825;g<=7831;g++)O[g]=0;for(g=7845;g<=7859;g++)O[g]=0;for(g=8013;g<=8032;g++)O[g]=0;for(g=8065;g<=8068;g++)O[g]=1;for(g=8518;g<=8529;g++)O[g]=2;for(g=8533;g<=8536;g++)O[g]=2;for(g=8538;g<=8540;g++)O[g]=2;for(g=8677;g<=8679;g++)O[g]=0;for(g=8836;g<=8840;g++)O[g]=0;for(g=8857;g<=8859;g++)O[g]=0;for(g=8908;g<=8910;g++)O[g]=0;for(g=9154;g<=9159;g++)O[g]=0;for(g=9205;g<=9218;g++)O[g]=0;for(g=9271;g<=9273;g++)O[g]=0;for(g=9295;g<=9297;g++)O[g]=0;for(g=9356;g<=9360;g++)O[g]=0;for(g=9404;g<=9407;g++)O[g]=0;for(g=9476;g<=9482;g++)O[g]=0;for(g=9487;g<=9494;g++)O[g]=0;for(g=9697;g<=9699;g++)O[g]=0;for(g=9821;g<=9865;g++)O[g]=0;for(g=10285;g<=10291;g++)O[g]=0;for(g=10314;g<=10317;g++)O[g]=0;for(g=10448;g<=10465;g++)O[g]=0;for(g=10731;g<=10733;g++)O[g]=0;for(g=11114;g<=11118;g++)O[g]=0;for(g=20004;g<=20032;g++)O[g]=0;for(g=20047;g<=20049;g++)O[g]=0;for(g=20062;g<=20092;g++)O[g]=0;for(g=20135;g<=20138;g++)O[g]=0;for(g=20248;g<=20258;g++)O[g]=0;for(g=20348;g<=20358;g++)O[g]=0;for(g=20436;g<=20440;g++)O[g]=0;for(g=20822;g<=20824;g++)O[g]=0;for(g=20904;g<=20932;g++)O[g]=0;for(g=20934;g<=20936;g++)O[g]=0;for(g=21004;g<=21032;g++)O[g]=0;for(g=21035;g<=21037;g++)O[g]=0;for(g=21095;g<=21097;g++)O[g]=0;for(g=21148;g<=21150;g++)O[g]=0;for(g=21207;g<=21264;g++)O[g]=0;for(g=21307;g<=21364;g++)O[g]=0;for(g=21413;g<=21423;g++)O[g]=0;for(g=21453;g<=21463;g++)O[g]=0;for(g=21473;g<=21483;g++)O[g]=0;for(g=21780;g<=21782;g++)O[g]=0;for(g=21891;g<=21894;g++)O[g]=0;for(g=21896;g<=21899;g++)O[g]=0;for(g=22171;g<=22177;g++)O[g]=0;for(g=22181;g<=22187;g++)O[g]=0;for(g=22191;g<=22197;g++)O[g]=0;for(g=22207;g<=22222;g++)O[g]=0;for(g=22229;g<=22232;g++)O[g]=0;for(g=22234;g<=22236;g++)O[g]=0;for(g=22243;g<=22250;g++)O[g]=0;for(g=22262;g<=22265;g++)O[g]=0;for(g=22307;g<=22322;g++)O[g]=0;for(g=22348;g<=22357;g++)O[g]=0;for(g=22407;g<=22422;g++)O[g]=0;for(g=22462;g<=22465;g++)O[g]=0;for(g=22521;g<=22525;g++)O[g]=0;for(g=22607;g<=22622;g++)O[g]=0;for(g=22641;g<=22646;g++)O[g]=0;for(g=22648;g<=22657;g++)O[g]=0;for(g=22707;g<=22722;g++)O[g]=0;for(g=22762;g<=22765;g++)O[g]=0;for(g=22807;g<=22822;g++)O[g]=0;for(g=22991;g<=22994;g++)O[g]=0;for(g=23028;g<=23038;g++)O[g]=0;for(g=23301;g<=23333;g++)O[g]=2;for(g=23830;g<=23853;g++)O[g]=0;for(g=23866;g<=23872;g++)O[g]=0;for(g=23877;g<=23884;g++)O[g]=0;for(g=23886;g<=23894;g++)O[g]=0;for(g=23946;g<=23948;g++)O[g]=0;for(g=24311;g<=24313;g++)O[g]=0;for(g=24342;g<=24347;g++)O[g]=0;for(g=24370;g<=24374;g++)O[g]=10;for(g=24375;g<=24381;g++)O[g]=0;for(g=24718;g<=24721;g++)O[g]=0;for(g=24817;g<=24821;g++)O[g]=0;for(g=24877;g<=24882;g++)O[g]=0;for(g=24891;g<=24893;g++)O[g]=0;for(g=25391;g<=25395;g++)O[g]=0;for(g=25828;g<=25838;g++)O[g]=0;for(g=26191;g<=26195;g++)O[g]=0;for(g=26391;g<=26393;g++)O[g]=0;for(g=26701;g<=26722;g++)O[g]=0;for(g=26729;g<=26799;g++)O[g]=2;for(g=26801;g<=26803;g++)O[g]=2;for(g=26811;g<=26813;g++)O[g]=2;for(g=26847;g<=26870;g++)O[g]=2;for(g=26891;g<=26899;g++)O[g]=0;for(g=26901;g<=26923;g++)O[g]=0;for(g=26929;g<=26946;g++)O[g]=0;for(g=26948;g<=26998;g++)O[g]=0;for(g=27037;g<=27040;g++)O[g]=0;for(g=27205;g<=27232;g++)O[g]=0;for(g=27258;g<=27260;g++)O[g]=0;for(g=27391;g<=27398;g++)O[g]=0;for(g=27561;g<=27564;g++)O[g]=0;for(g=27571;g<=27574;g++)O[g]=0;for(g=27581;g<=27584;g++)O[g]=0;for(g=27591;g<=27594;g++)O[g]=0;for(g=27700;g<=27707;g++)O[g]=0;for(g=28191;g<=28193;g++)O[g]=0;for(g=28348;g<=28358;g++)O[g]=0;for(g=28402;g<=28432;g++)O[g]=0;for(g=28462;g<=28492;g++)O[g]=0;for(g=29118;g<=29122;g++)O[g]=0;for(g=29168;g<=29172;g++)O[g]=0;for(g=29177;g<=29185;g++)O[g]=0;for(g=29187;g<=29195;g++)O[g]=0;for(g=29900;g<=29903;g++)O[g]=0;for(g=30161;g<=30179;g++)O[g]=0;for(g=30491;g<=30494;g++)O[g]=0;for(g=30729;g<=30732;g++)O[g]=0;for(g=31251;g<=31259;g++)O[g]=0;for(g=31265;g<=31268;g++)O[g]=0;for(g=31275;g<=31279;g++)O[g]=0;for(g=31281;g<=31297;g++)O[g]=0;for(g=31461;g<=31469;g++)O[g]=0;for(g=31491;g<=31495;g++)O[g]=0;for(g=31917;g<=31922;g++)O[g]=0;for(g=31965;g<=32e3;g++)O[g]=0;for(g=32001;g<=32003;g++)O[g]=2;for(g=32005;g<=32031;g++)O[g]=2;for(g=32033;g<=32060;g++)O[g]=2;for(g=32064;g<=32067;g++)O[g]=2;for(g=32074;g<=32077;g++)O[g]=2;for(g=32081;g<=32086;g++)O[g]=0;for(g=32107;g<=32130;g++)O[g]=0;for(g=32133;g<=32159;g++)O[g]=0;for(g=32164;g<=32167;g++)O[g]=2;for(g=32180;g<=32199;g++)O[g]=0;for(g=32201;g<=32260;g++)O[g]=0;for(g=32301;g<=32360;g++)O[g]=0;for(g=32401;g<=32460;g++)O[g]=0;for(g=32501;g<=32560;g++)O[g]=0;for(g=32601;g<=32662;g++)O[g]=0;for(g=32664;g<=32667;g++)O[g]=2;for(g=32701;g<=32761;g++)O[g]=0;for(g=53001;g<=53004;g++)O[g]=0;for(g=53008;g<=53019;g++)O[g]=0;for(g=53021;g<=53032;g++)O[g]=0;for(g=53034;g<=53037;g++)O[g]=0;for(g=53042;g<=53046;g++)O[g]=0;for(g=53074;g<=53080;g++)O[g]=0;for(g=54001;g<=54004;g++)O[g]=0;for(g=54008;g<=54019;g++)O[g]=0;for(g=54021;g<=54032;g++)O[g]=0;for(g=54034;g<=54037;g++)O[g]=0;for(g=54042;g<=54046;g++)O[g]=0;for(g=54048;g<=54053;g++)O[g]=0;for(g=54074;g<=54080;g++)O[g]=0;for(g=54098;g<=54101;g++)O[g]=0;for(g=102001;g<=102040;g++)O[g]=0;for(g=102042;g<=102063;g++)O[g]=0;for(g=102065;g<=102067;g++)O[g]=0;for(g=102070;g<=102117;g++)O[g]=0;for(g=102122;g<=102216;g++)O[g]=0;for(g=102221;g<=102377;g++)O[g]=0;for(g=102382;g<=102388;g++)O[g]=0;for(g=102389;g<=102398;g++)O[g]=2;for(g=102399;g<=102444;g++)O[g]=0;for(g=102445;g<=102447;g++)O[g]=2;for(g=102448;g<=102458;g++)O[g]=0;for(g=102459;g<=102468;g++)O[g]=2;for(g=102469;g<=102499;g++)O[g]=0;for(g=102500;g<=102519;g++)O[g]=1;for(g=102520;g<=102524;g++)O[g]=0;for(g=102525;g<=102529;g++)O[g]=2;for(g=102530;g<=102588;g++)O[g]=0;for(g=102590;g<=102598;g++)O[g]=0;for(g=102601;g<=102603;g++)O[g]=0;for(g=102605;g<=102628;g++)O[g]=0;for(g=102629;g<=102646;g++)O[g]=2;for(g=102648;g<=102700;g++)O[g]=2;for(g=102701;g<=102703;g++)O[g]=0;for(g=102707;g<=102730;g++)O[g]=2;for(g=102733;g<=102758;g++)O[g]=2;for(g=102767;g<=102900;g++)O[g]=0;for(g=102901;g<=102933;g++)O[g]=2;for(g=102934;g<=102950;g++)O[g]=13;for(g=102951;g<=102963;g++)O[g]=0;for(g=102965;g<=102969;g++)O[g]=0;for(g=102971;g<=102973;g++)O[g]=0;for(g=102975;g<=102989;g++)O[g]=0;for(g=102990;g<=102992;g++)O[g]=1;for(g=102997;g<=103002;g++)O[g]=0;for(g=103003;g<=103008;g++)O[g]=2;for(g=103009;g<=103011;g++)O[g]=0;for(g=103012;g<=103014;g++)O[g]=2;for(g=103019;g<=103021;g++)O[g]=0;for(g=103022;g<=103024;g++)O[g]=2;for(g=103029;g<=103031;g++)O[g]=0;for(g=103032;g<=103034;g++)O[g]=2;for(g=103065;g<=103068;g++)O[g]=0;for(g=103074;g<=103076;g++)O[g]=0;for(g=103077;g<=103079;g++)O[g]=1;for(g=103080;g<=103082;g++)O[g]=0;for(g=103083;g<=103085;g++)O[g]=2;for(g=103090;g<=103093;g++)O[g]=0;for(g=103097;g<=103099;g++)O[g]=0;for(g=103100;g<=103102;g++)O[g]=2;for(g=103107;g<=103109;g++)O[g]=0;for(g=103110;g<=103112;g++)O[g]=2;for(g=103113;g<=103116;g++)O[g]=0;for(g=103117;g<=103120;g++)O[g]=2;for(g=103153;g<=103157;g++)O[g]=0;for(g=103158;g<=103162;g++)O[g]=2;for(g=103163;g<=103165;g++)O[g]=0;for(g=103166;g<=103168;g++)O[g]=1;for(g=103169;g<=103171;g++)O[g]=2;for(g=103186;g<=103188;g++)O[g]=0;for(g=103189;g<=103191;g++)O[g]=2;for(g=103192;g<=103195;g++)O[g]=0;for(g=103196;g<=103199;g++)O[g]=2;for(g=103200;g<=103224;g++)O[g]=0;for(g=103225;g<=103227;g++)O[g]=1;for(g=103232;g<=103237;g++)O[g]=0;for(g=103238;g<=103243;g++)O[g]=2;for(g=103244;g<=103246;g++)O[g]=0;for(g=103247;g<=103249;g++)O[g]=2;for(g=103254;g<=103256;g++)O[g]=0;for(g=103257;g<=103259;g++)O[g]=2;for(g=103264;g<=103266;g++)O[g]=0;for(g=103267;g<=103269;g++)O[g]=2;for(g=103300;g<=103375;g++)O[g]=0;for(g=103381;g<=103383;g++)O[g]=0;for(g=103384;g<=103386;g++)O[g]=1;for(g=103387;g<=103389;g++)O[g]=0;for(g=103390;g<=103392;g++)O[g]=2;for(g=103397;g<=103399;g++)O[g]=0;for(g=103400;g<=103471;g++)O[g]=2;for(g=103476;g<=103478;g++)O[g]=0;for(g=103479;g<=103481;g++)O[g]=2;for(g=103486;g<=103488;g++)O[g]=0;for(g=103489;g<=103491;g++)O[g]=2;for(g=103492;g<=103495;g++)O[g]=0;for(g=103496;g<=103499;g++)O[g]=2;for(g=103528;g<=103543;g++)O[g]=0;for(g=103544;g<=103548;g++)O[g]=2;for(g=103549;g<=103551;g++)O[g]=0;for(g=103552;g<=103554;g++)O[g]=1;for(g=103555;g<=103557;g++)O[g]=2;for(g=103558;g<=103560;g++)O[g]=0;for(g=103571;g<=103573;g++)O[g]=0;for(g=103574;g<=103576;g++)O[g]=2;for(g=103577;g<=103580;g++)O[g]=0;for(g=103581;g<=103583;g++)O[g]=2;for(g=103595;g<=103694;g++)O[g]=0;for(g=103696;g<=103699;g++)O[g]=0;for(g=103700;g<=103793;g++)O[g]=2;for(g=103794;g<=103890;g++)O[g]=0;for(g=103891;g<=103896;g++)O[g]=2;for(g=103900;g<=103971;g++)O[g]=2;for(g=103972;g<=103977;g++)O[g]=0;for(g=112e3;g<=112101;g++)O[g]=0;const nSe=[102100,102113,3857,3785,900913],XGe=[104905,104971],KGe=[4326,...nSe,...XGe],MP=[-20037508342788905e-9,20037508342788905e-9],R7=[-20037508342787e-6,20037508342787e-6],c6={wkTemplate:'PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',valid:MP,origin:R7,dx:1e-5},oSe={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:MP,origin:R7,dx:1e-5},102100:c6,3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:MP,origin:R7,dx:1e-5},3857:c6,4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},900913:c6};function rs(t,e){if(t===e)return!0;if(t==null||e==null)return!1;const i=t.wkid,r=e.wkid;if(i!=null||r!=null){if(i===r||Zm(t)&&Zm(e))return!0;const o=t.latestWkid;if(o!=null&&r===o)return!0;const a=e.latestWkid;return a!=null&&i===a}let s,n;return t.wkt2&&e.wkt2?(s=t.wkt2,n=e.wkt2):t.wkt&&e.wkt&&(s=t.wkt,n=e.wkt),!(!s||!n)&&s.toUpperCase()===n.toUpperCase()}function lc(t){const e=t?.wkid;return e!=null&&e>=2e3&&oSe[e]||null}function zz(t){if(!t)return;const{wkid:e,vcsWkid:i}=t;if(e)return i?JSON.stringify({wkid:e,vcsWkid:i}):String(e);const r=t.wkt||t.wkt2;return JSON.stringify(r?i?{wkt:r,vcsWkid:i}:{wkt:r}:{})}function TS(t){if(!qu(t))return!1;const{wkid:e}=t;if(e)return O[e]==null;const i=t.wkt2||t.wkt;return!!i&&/^\s*(?:GEOGCS|GEOGCRS|GEOGRAPHICCRS)/i.test(i)}function xV(t){return!(vA(t)||_A(t))}function yb(t){return t?.wkid===4326}function VHt(t){return/^\s*(?:GEOD|GEODETIC|GEOG|GEOGRAPHIC|PROJ|PROJECTED|VERT|VERTICAL|ENG|ENGINEERING|PARAMETRIC|TIME|DERIVEDPROJ|COMPOUND|BOUND)CRS/i.test(t)}function Uz(t){return t?.wkid===qc.CGCS2000}function Zm(t){const e=t?.wkid;return e!=null&&e>=2e3&&nSe.includes(e)}function OP(t){return t?.wkid===32662}function s$(t){return t===qc.GCSMARS2000||t===qc.GCSMARS2000_SPHERE}function vA(t){return s$(t?.wkid)}function n$(t){return t===qc.GCSMOON2000}function _A(t){return n$(t?.wkid)}function QGe(t){const e=t?.wkid;return e!=null&&e>=2e3&&KGe.includes(e)}function qu(t){if(t==null)return!1;const e=t.wkid;return e!=null&&e>=2e3||t.wkt2!=null||t.wkt!=null}const aSe={wkid:4326,wkt:G3(oSe[4326].wkTemplate,{Central_Meridian:"0.0"})},lSe={wkid:102100,latestWkid:3857},e6e={wkid:32662};function Qee(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const cSe=Qee(xi),SV=Qee(Kp),TV=Qee(rv),uSe={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${xi.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`},t6e=SV.wkt.toUpperCase(),i6e=TV.wkt.toUpperCase();function gr(t){if(t!=null&&qu(t)){const e=t.wkid,i=t.wkt2??t.wkt;if(s$(e))return Kp;const r=i?.toUpperCase();if(i&&r===t6e)return Kp;if(n$(e)||r&&r===i6e)return rv}return xi}function jHt(t){return s$(t)?Kp:n$(t)?rv:xi}function Bz(t){return rs(t,cSe)}function vb(t){return Bz(t)||rs(t,SV)||rs(t,TV)}const ete=39.37,r6e=xi.radius*Math.PI/200,hSe=/(?:LENGTH)?UNIT\[([^\]]+)]]$/i,o$=O,dSe=/UNIT\[([^\]]+)]/i,s6e=new Set([4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104025,104026,104139,104140]),n6e=Mo()({millimeter:"millimeters",centimeter:"centimeters",meter:"meters",meter_german:"german-meters",kilometer:"kilometers",decimeter:"decimeters",micrometer:"micrometers",nanometer:"nanometers","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",fathom:"fathoms",nautical_mile:"nautical-miles",chain_us:"us-chains",link_us:"us-links",mile_us:"us-miles",yard_clarke:"clarke-yards",chain_clarke:"clarke-chains",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",link_sears:"sears-links",yard_benoit_1895_a:"benoit-1895-a-yards",foot_benoit_1895_a:"benoit-1895-a-feet",chain_benoit_1895_a:"benoit-1895-a-chains",link_benoit_1895_a:"benoit-1895-a-links",yard_benoit_1895_b:"benoit-1895-b-yards",foot_benoit_1895_b:"benoit-1895-b-feet",chain_benoit_1895_b:"benoit-1895-b-chains",link_benoit_1895_b:"benoit-1895-b-links",foot_1865:"1865-feet",foot_indian:"indian-feet",foot_indian_1937:"indian-1937-feet",foot_indian_1962:"indian-1962-feet",foot_indian_1975:"indian-1975-feet",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",yard_indian_1962:"indian-1962-yards",yard_indian_1975:"indian-1975-yards",statute_mile:"statute-miles",foot_gold_coast:"gold-coast-feet",foot_british_1936:"british-1936-feet",yard:"yards",chain:"chains",link:"links",yard_sears_1922_truncated:"sears-1922-truncated-yards",foot_sears_1922_truncated:"sears-1922-truncated-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains",link_sears_1922_truncated:"sears-1922-truncated-links",yard_us:"us-yards",inch:"inches",inch_us:"us-inches",rod:"rods",rod_us:"us-rods",nautical_mile_us:"us-nautical-miles",nautical_mile_uk:"uk-nautical-miles",smoot:"smoots",vara_tx:"tx-vara",point:"points"}),Vd=t=>t*t,Gv=t=>t*t*t,IP={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},meters:{inBaseUnits:1},feet:{inBaseUnits:.3048},"us-feet":{inBaseUnits:.3048006096012192},"clarke-feet":{inBaseUnits:.3047972654},fathoms:{inBaseUnits:1.8288},"nautical-miles":{inBaseUnits:1852},"german-meters":{inBaseUnits:1.0000135965},"us-chains":{inBaseUnits:20.11684023368047},"us-links":{inBaseUnits:.2011684023368047},"us-miles":{inBaseUnits:1609.347218694438},kilometers:{inBaseUnits:1e3},"clarke-yards":{inBaseUnits:.9143917962},"clarke-chains":{inBaseUnits:20.1166195164},"clarke-links":{inBaseUnits:.201166195164},"sears-yards":{inBaseUnits:.9143984146160287},"sears-feet":{inBaseUnits:.3047994715386762},"sears-chains":{inBaseUnits:20.11676512155263},"sears-links":{inBaseUnits:.2011676512155263},"benoit-1895-a-yards":{inBaseUnits:.9143992},"benoit-1895-a-feet":{inBaseUnits:.3047997333333333},"benoit-1895-a-chains":{inBaseUnits:20.1167824},"benoit-1895-a-links":{inBaseUnits:.201167824},"benoit-1895-b-yards":{inBaseUnits:.9143992042898124},"benoit-1895-b-feet":{inBaseUnits:.3047997347632708},"benoit-1895-b-chains":{inBaseUnits:20.11678249437587},"benoit-1895-b-links":{inBaseUnits:.2011678249437587},"1865-feet":{inBaseUnits:.3048008333333334},"indian-feet":{inBaseUnits:.3047995102481469},"indian-1937-feet":{inBaseUnits:.30479841},"indian-1962-feet":{inBaseUnits:.3047996},"indian-1975-feet":{inBaseUnits:.3047995},"indian-yards":{inBaseUnits:.9143985307444408},"indian-1937-yards":{inBaseUnits:.91439523},"indian-1962-yards":{inBaseUnits:.9143988},"indian-1975-yards":{inBaseUnits:.9143985},miles:{inBaseUnits:1609.344},"statute-miles":{inBaseUnits:1609.344},"gold-coast-feet":{inBaseUnits:.3047997101815088},"british-1936-feet":{inBaseUnits:.3048007491},yards:{inBaseUnits:.9144},chains:{inBaseUnits:20.1168},links:{inBaseUnits:.201168},"sears-1922-truncated-yards":{inBaseUnits:.914398},"sears-1922-truncated-feet":{inBaseUnits:.3047993333333334},"sears-1922-truncated-chains":{inBaseUnits:20.116756},"sears-1922-truncated-links":{inBaseUnits:.20116756},"us-yards":{inBaseUnits:.9144018288036576},decimeters:{inBaseUnits:.1},inches:{inBaseUnits:.0254},"us-inches":{inBaseUnits:.0254000508001016},rods:{inBaseUnits:5.0292},"us-rods":{inBaseUnits:5.029210058420118},"us-nautical-miles":{inBaseUnits:1853.248},"uk-nautical-miles":{inBaseUnits:1853.184},smoots:{inBaseUnits:1.7018},"tx-vara":{inBaseUnits:.8466683600033867},points:{inBaseUnits:.0003527777777777778},micrometers:{inBaseUnits:1e-6},nanometers:{inBaseUnits:1e-9},"50-kilometers":{inBaseUnits:5e4},"150-kilometers":{inBaseUnits:15e4}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:Vd(.001)},"square-centimeters":{inBaseUnits:Vd(.01)},"square-decimeters":{inBaseUnits:Vd(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:Vd(1e3)},"square-inches":{inBaseUnits:Vd(.0254)},"square-feet":{inBaseUnits:Vd(.3048)},"square-yards":{inBaseUnits:Vd(.9144)},"square-miles":{inBaseUnits:Vd(1609.344)},"square-nautical-miles":{inBaseUnits:Vd(1852)},"square-us-feet":{inBaseUnits:Vd(1200/3937)},acres:{inBaseUnits:.0015625*Vd(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*Gv(.001)},"cubic-centimeters":{inBaseUnits:1e3*Gv(.01)},"cubic-decimeters":{inBaseUnits:1e3*Gv(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*Gv(1e3)},"cubic-inches":{inBaseUnits:1e3*Gv(.0254)},"cubic-feet":{inBaseUnits:1e3*Gv(.3048)},"cubic-yards":{inBaseUnits:1e3*Gv(.9144)},"cubic-miles":{inBaseUnits:1e3*Gv(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},o6e=(()=>{const t={};for(const e in IP)for(const i in IP[e].units)t[i]=e;return t})();function a6e(t,e,i){return t*IP[i].units[e].inBaseUnits}function l6e(t,e,i){return t/IP[i].units[e].inBaseUnits}const pSe=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"],c6e=new Map([["meters","square-meters"],["feet","square-feet"],["us-feet","square-us-feet"]]);function Zx(t){const e=o6e[t];if(!e)throw new Error("unknown type");return e}function Mle(t,e=null){return e=e||Zx(t),IP[e].baseUnit===t}function pr(t,e,i){if(e===i)return t;const r=Zx(e);if(r!==Zx(i))throw new Error("incompatible units");const s=Mle(e,r)?t:a6e(t,e,r);return Mle(i,r)?s:l6e(s,i,r)}function GHt(t,e,i,r=!1){if(!r&&TS(e))throw new Error("Unable to convert from an angular unit to a linear unit.");const s=ES(e);return s!==i&&(t=s?pr(t,s,i):pr(t*=Ao(e),"meters",i)),t}function HHt(t,e,i,r=!1){if(!r&&TS(i))throw new Error("Unable to convert from a linear unit to an angular unit.");const s=ES(i);return e!==s&&(t=s?pr(t,e,s):pr(t,e,"meters")/Ao(i)),t}function u6e(t){switch(t){case"metric":return"meters";case"imperial":return"feet";default:return t}}function qHt(t){return u6e(t)}function WHt(t){switch(t){case"metric":return"square-meters";case"imperial":return"square-feet";default:return t}}function ZHt(t,e,i){switch(i){case"metric":return tte(t,e);case"imperial":return rte(t,e);default:return i}}function YHt(t,e,i){switch(i){case"metric":return ite(t,e);case"imperial":return ste(t,e);default:return i}}function tte(t,e){const i=pr(t,e,"meters");return Math.abs(i)<3e3?"meters":"kilometers"}function ite(t,e){const i=pr(t,e,"meters");return Math.abs(i)<1e5?"meters":"kilometers"}function rte(t,e){const i=pr(t,e,"feet");return Math.abs(i)<1e3?"feet":"miles"}function ste(t,e){const i=pr(t,e,"feet");return Math.abs(i)<1e5?"feet":"miles"}function fSe(t,e){const i=pr(t,e,"square-meters");return Math.abs(i)<3e6?"square-meters":"square-kilometers"}function mSe(t,e){const i=pr(t,e,"square-feet");return Math.abs(i)<1e6?"square-feet":"square-miles"}function JHt(t,e,i){switch(i){case"metric":return fSe(t,e);case"imperial":return mSe(t,e);default:return i}}function h6e(t,e,i){return pr(t,e,"meters")/(i*Math.PI/180)}function nte(t){return n6e.fromJSON(t.toLowerCase())||null}function Yx(t){if(t!=null&&!xV(t))return 1;const e=Ao(t);return e>1e5?1:e}function gSe(t){return Ao(t)>=gr(t).metersPerDegree?"meters":ES(t)}function Ao(t,e=xi.metersPerDegree){return d6e(t,!0)??e}function d6e(t,e=!1){const i=t?.wkid??null,r=t?.wkt2??t?.wkt??null;let s=null;if(i){if(s$(i))return Kp.metersPerDegree;if(n$(i))return rv.metersPerDegree;s=o$.values[o$[i]],!s&&e&&s6e.has(i)&&(s=r6e)}else r&&(_Se(r)?s=Ile(hSe.exec(r),s):vSe(r)&&(s=Ile(dSe.exec(r),s)));return s}function Ole(t){return TS(t)?1:Ao(t)}function Ile(t,e){return t?.[1]?ySe(t[1]):e}function ySe(t){return parseFloat(t.split(",")[1])}function ES(t){const e=t?.wkid??null,i=t?.wkt2??t?.wkt??null;let r=null;if(e)r=o$.units[o$[e]];else if(i){const s=_Se(i)?hSe:vSe(i)?dSe:null;if(s){const n=s.exec(i);n?.[1]&&(r=m6e(n[1]))}}return r!=null?nte(r):null}function XHt(t){const e=ES(t);return e!=null&&pSe.includes(e)?e:null}function p6e(t){const e=gSe(t);return e!=null&&pSe.includes(e)?e:null}function KHt(t){const e=ES(t);return e==null?null:c6e.get(e)}function vSe(t){return/^GEOCCS/i.test(t)}function _Se(t){return/^\s*(?:PROJCS|PROJCRS|PROJECTEDCRS)/i.test(t)}const f6e=1e-7;function m6e(t){let i=/[\\"']{1}([^\\"']+)/.exec(t)?.[1];if(!i||!nte(i)){const r=ySe(t);i=null;const s=o$.values;for(let n=0;n<s.length;++n)if(Math.abs(r-s[n])<f6e){i=o$.units[n];break}}return i}function QHt(t){const e=ES(t);if(e==null)return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"fathoms":case"nautical-miles":case"us-chains":case"us-links":case"us-miles":case"clarke-yards":case"clarke-chains":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"sears-links":case"benoit-1895-a-yards":case"benoit-1895-a-feet":case"benoit-1895-a-chains":case"benoit-1895-a-links":case"benoit-1895-b-yards":case"benoit-1895-b-feet":case"benoit-1895-b-chains":case"benoit-1895-b-links":case"1865-feet":case"indian-feet":case"indian-1937-feet":case"indian-1962-feet":case"indian-1975-feet":case"indian-yards":case"indian-1937-yards":case"indian-1962-yards":case"indian-1975-yards":case"statute-miles":case"gold-coast-feet":case"british-1936-feet":case"yards":case"chains":case"links":case"sears-1922-truncated-yards":case"sears-1922-truncated-feet":case"sears-1922-truncated-chains":case"sears-1922-truncated-links":case"us-yards":case"inches":case"us-inches":case"rods":case"us-rods":case"us-nautical-miles":case"uk-nautical-miles":case"smoots":case"tx-vara":case"points":return"imperial";case"millimeters":case"centimeters":case"meters":case"german-meters":case"kilometers":case"decimeters":case"micrometers":case"nanometers":case"50-kilometers":case"150-kilometers":return"metric"}return null}const g6e={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},y6e={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},v6e={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},_6e=Mo()(g6e),b6e=Mo()(y6e),e8t=Mo()(v6e);var Uf;let qr=Uf=class extends ee{static fromJSON(t){if(!t)return null;if(t?.wkid===102100)return Uf.WebMercator;if(t?.wkid===4326)return Uf.WGS84;const e=new Uf;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.wkt2=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return yb(this)}get isWebMercator(){return Zm(this)}get isGeographic(){return TS(this)}get isWrappable(){return QGe(this)}get metersPerUnit(){return Ao(this)}get unit(){return ES(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===Uf.WGS84)return new Uf(aSe);if(this===Uf.WebMercator)return new Uf(lSe);const t=new Uf;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):(this.wkt!=null&&(t.wkt=this.wkt),this.wkt2!=null&&(t.wkt2=this.wkt2)),this.imageCoordinateSystem&&(t.imageCoordinateSystem=q(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:i}=t.imageCoordinateSystem,{geodataXform:r}=t.imageCoordinateSystem,s=this.imageCoordinateSystem;return e==null||r?JSON.stringify(s)===JSON.stringify(t.imageCoordinateSystem):i?s.id===e&&s.referenceServiceName===i:s.id===e}return rs(this,t)}toJSON(t){return this.write(void 0,t)}};qr.GCS_NAD_1927=null,qr.WGS84=null,qr.WebMercator=null,qr.PlateCarree=null,u([p({readOnly:!0})],qr.prototype,"isWGS84",null),u([p({readOnly:!0})],qr.prototype,"isWebMercator",null),u([p({readOnly:!0})],qr.prototype,"isGeographic",null),u([p({readOnly:!0})],qr.prototype,"isWrappable",null),u([p({type:Ei,json:{write:!0}})],qr.prototype,"latestWkid",void 0),u([p({readOnly:!0})],qr.prototype,"metersPerUnit",null),u([p({readOnly:!0})],qr.prototype,"unit",null),u([p({type:Ei,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt==null}}}}}}})],qr.prototype,"wkid",void 0),u([p({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid==null}}}}}}})],qr.prototype,"wkt",void 0),u([ge("wkt"),ge("web-scene","wkt")],qr.prototype,"writeWkt",null),u([p({type:String,json:{write:!1}})],qr.prototype,"wkt2",void 0),u([p({type:Ei,json:{write:!0}})],qr.prototype,"vcsWkid",void 0),u([p({type:Ei,json:{write:!0}})],qr.prototype,"latestVcsWkid",void 0),u([p()],qr.prototype,"imageCoordinateSystem",void 0),qr=Uf=u([A("esri.geometry.SpatialReference")],qr),qr.prototype.toJSON.isDefaultToJSON=!0,qr.GCS_NAD_1927=ue.freeze(new qr({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'})),qr.WGS84=ue.freeze(new qr(aSe)),qr.WebMercator=ue.freeze(new qr(lSe)),qr.PlateCarree=ue.freeze(new qr(e6e));const Ae=qr;let Bf=class extends ee{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=Ae.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,i){if(e instanceof Ae)return e;if(e!=null){const r=new Ae;return r.read(e,i),r}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,i){this.cache[e]=i}};u([p()],Bf.prototype,"type",void 0),u([p({readOnly:!0})],Bf.prototype,"cache",null),u([p({readOnly:!0})],Bf.prototype,"extent",null),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Bf.prototype,"hasM",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Bf.prototype,"hasZ",void 0),u([p({type:Ae,json:{write:!0},value:Ae.WGS84})],Bf.prototype,"spatialReference",void 0),u([me("spatialReference")],Bf.prototype,"readSpatialReference",null),Bf=u([A("esri.geometry.Geometry")],Bf);const og=Bf;function a$(t){if(t&&typeof t=="object"&&"type"in t&&t.type==="mesh")throw new U("Mesh geometries are not supported for this operation")}function w6e(t){t.forEach(a$)}const x6e=57.29577951308232,S6e=.017453292519943;function Rle(t){return t*x6e}function Ple(t){return t*S6e}function Dle(t){return t/xi.radius}function P7(t){return Math.PI/2-2*Math.atan(Math.exp(-t/xi.radius))}function D7(t){return t.wkid!=null||t.wkt!=null}const u6=[0,0];function Vz(t,e,i,r,s){const n=t,o=s;if(o.spatialReference=i,"x"in n&&"x"in o)[o.x,o.y]=e(n.x,n.y,u6,r);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=e(n.xmin,n.ymin,u6,r),[o.xmax,o.ymax]=e(n.xmax,n.ymax,u6,r);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let h=0;h<a.length;h++){const d=a[h];c=[],l.push(c);for(let f=0;f<d.length;f++)c.push(e(d[f][0],d[f][1],[0,0],r)),d[f].length>2&&c[f].push(d[f][2]),d[f].length>3&&c[f].push(d[f][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=e(a[c][0],a[c][1],[0,0],r),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function Ik(t,e){const i=t&&(D7(t)?t:t.spatialReference),r=e&&(D7(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!i||!r)&&(!!rs(r,i)||Zm(r)&&yb(i)||Zm(i)&&yb(r))}function Q3(t,e){if(t==null)return null;const i=t.spatialReference,r=e&&(D7(e)?e:e.spatialReference);return Ik(i,r)?rs(i,r)?q(t):Zm(r)?Vz(t,I2,Ae.WebMercator,!1,q(t)):yb(r)?Vz(t,EV,Ae.WGS84,!1,q(t)):null:null}function I2(t,e,i=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const r=Ple(e);return i[0]=Ple(t)*xi.radius,i[1]=xi.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function EV(t,e,i=[0,0],r=!1){if(t===MP[0])i[0]=-180;else if(t===MP[1])i[0]=180;else{const s=Rle(t/xi.radius);i[0]=r?s:s-360*Math.floor((s+180)/360)}return i[1]=Rle(Math.PI/2-2*Math.atan(Math.exp(-e/xi.radius))),i}function Gy(t,e=!1,i=q(t)){return a$(t),a$(i),Vz(t,I2,Ae.WebMercator,e,i)}function ux(t,e=!1,i=q(t)){return a$(t),a$(i),Vz(t,EV,Ae.WGS84,e,i)}function bSe(t,e){const i=t.x-e.x,r=t.y-e.y,s=t.z!=null&&e.z!=null?t.z-e.z:0;return Math.sqrt(i*i+r*r+s*s)}function T6e(t){return wSe(t,xSe)?.[0]??null}function E6e(t){return wSe(t,xSe)?.[1]??null}function wSe({x:t,y:e,spatialReference:i},r=[0,0]){if(i){if(Zm(i))return EV(t,e,r);if(TS(i))return r[0]=t,r[1]=e,r}return null}const xSe=[0,0];var Rk;const h6=[0,0];function Lle(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let Fl=Rk=class extends og{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const i=t._get("spatialReference");e._set("spatialReference",ue.isFrozen(i)?i:i.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,i,r,s){let n;if(Array.isArray(t))n=t,s=e,t=n[0],e=n[1],i=n[2],r=n[3];else if(t&&typeof t=="object"){if(n=t,t=n.x!=null?n.x:n.longitude,e=n.y!=null?n.y:n.latitude,i=n.z,r=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new Ae(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)J.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)J.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s?.isWebMercator){const a=I2(n.longitude,n.latitude,h6);t=a[0],e=a[1]}}}else Lle(i)?(s=i,i=null):Lle(r)&&(s=r,r=null);const o={x:t,y:e};return o.x==null&&o.y!=null?J.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&J.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),i!=null&&(o.z=i),r!=null&&(o.m=r),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){return E6e(this)}set latitude(t){const{spatialReference:e,x:i}=this;t!=null&&e&&(e.isWebMercator?this._set("y",I2(i,t,h6)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){return T6e(this)}set longitude(t){const{y:e,spatialReference:i}=this;t!=null&&i&&(i.isWebMercator?this._set("x",I2(t,e,h6)[0]):i.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,i){e[i]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new Rk;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return Rk.copy(t,this),this}equals(t){if(t==null)return!1;const{x:e,y:i,z:r,m:s,spatialReference:n}=this,{z:o,m:a}=t;let{x:l,y:c,spatialReference:h}=t;if(!n.equals(h))if(n.isWebMercator&&h.isWGS84)[l,c]=I2(l,c),h=n;else{if(!n.isWGS84||!h.isWebMercator)return!1;[l,c]=EV(l,c),h=n}return e===l&&i===c&&r===o&&s===a&&n.wkid===h.wkid}offset(t,e,i){return this.x+=t,this.y+=e,i!=null&&(this.z=(this.z??0)+i),this}normalize(){if(!this.spatialReference)return this;const t=lc(this.spatialReference);if(!t)return this;let e=this.x;const[i,r]=t.valid,s=2*r;let n;return e>r?(n=Math.ceil(Math.abs(e-r)/s),e-=n*s):e<i&&(n=Math.ceil(Math.abs(e-i)/s),e+=n*s),this._set("x",e),this}distance(t){return bSe(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};u([p({readOnly:!0})],Fl.prototype,"cache",null),u([p({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Fl.prototype,"hasM",null),u([p({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Fl.prototype,"hasZ",null),u([p({type:Number})],Fl.prototype,"latitude",null),u([p({type:Number})],Fl.prototype,"longitude",null),u([p({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),Yt(t=>isNaN(t)?t:ec(t))],Fl.prototype,"x",void 0),u([ge("x")],Fl.prototype,"writeX",null),u([me("x")],Fl.prototype,"readX",null),u([p({type:Number,json:{write:!0}})],Fl.prototype,"y",void 0),u([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Fl.prototype,"z",void 0),u([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],Fl.prototype,"m",void 0),Fl=Rk=u([A("esri.geometry.Point")],Fl),Fl.prototype.toJSON.isDefaultToJSON=!0;const ke=Fl;let Vf=class extends Dt.ClonableMixin(ee){constructor(...e){super(...e),this.position=new ke([0,0,0]),this.heading=0,this.tilt=0,this.fov=55,this.layout=new gxe}normalizeCtorArgs(e,i,r,s){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const n={position:e};return i!=null&&(n.heading=i),r!=null&&(n.tilt=r),s!=null&&(n.fov=s),n}return e}writePosition(e,i,r,s){const n=e.clone();n.x=ec(e.x||0),n.y=ec(e.y||0),n.z=e.hasZ?ec(e.z||0):e.z,i[r]=n.write({},s)}readPosition(e,i){const r=new ke;return r.read(e,i),r.x=ec(r.x||0),r.y=ec(r.y||0),r.z=r.hasZ?ec(r.z||0):r.z,r}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)&&this.layout.equals(e.layout)}};u([p({type:ke,json:{write:{isRequired:!0}}})],Vf.prototype,"position",void 0),u([ge("position")],Vf.prototype,"writePosition",null),u([me("position")],Vf.prototype,"readPosition",null),u([p({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Yt(t=>_V.normalize(ec(t)))],Vf.prototype,"heading",void 0),u([p({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Yt(t=>ce(ec(t),-180,180))],Vf.prototype,"tilt",void 0),u([p({type:Number,nonNullable:!0,json:{default:55,write:!0}}),Yt(t=>ce(ec(t,55),1,170))],Vf.prototype,"fov",void 0),u([p({type:gxe,nonNullable:!0,json:{read:!1,write:!1}})],Vf.prototype,"layout",void 0),Vf=u([A("esri.Camera")],Vf);const tu=Vf,d6=[0,0];function eD(t,e){return e!=null&&fl(t,e.x,e.y,e.z)}function r8t(t,e){if(!e.points?.length)return!1;for(const i of e.points)if(!l$(t,i))return!1;return!0}function C6e(t,e){const{xmin:i,ymin:r,zmin:s,xmax:n,ymax:o,zmax:a}=e;return t.hasZ&&e.hasZ?fl(t,i,r,s)&&fl(t,i,o,s)&&fl(t,n,o,s)&&fl(t,n,r,s)&&fl(t,i,r,a)&&fl(t,i,o,a)&&fl(t,n,o,a)&&fl(t,n,r,a):fl(t,i,r)&&fl(t,i,o)&&fl(t,n,o)&&fl(t,n,r)}function l$(t,e){return fl(t,e[0],e[1])}function $6e(t,e){return fl(t,e[0],e[1],e[2])}function fl(t,e,i,r){return e>=t.xmin&&e<=t.xmax&&i>=t.ymin&&i<=t.ymax&&(r==null||!t.hasZ||r>=t.zmin&&r<=t.zmax)}function ote(t,e){return d6[1]=e.y,d6[0]=e.x,A6e(t,d6)}function A6e(t,e){return ate(t.rings,e)}function ate(t,e){if(!t)return!1;if(M6e(t))return Nle(!1,t,e);let i=!1;for(let r=0,s=t.length;r<s;r++)i=Nle(i,t[r],e);return i}function M6e(t){return!Array.isArray(t[0][0])}function Nle(t,e,i){const[r,s]=i;let n=t,o=0;for(let a=0,l=e.length;a<l;a++){o++,o===l&&(o=0);const[c,h]=e[a],[d,f]=e[o];(h<s&&f>=s||f<s&&h>=s)&&c+(s-h)/(f-h)*(d-c)<r&&(n=!n)}return n}function O6e(t,e){return eD(t,e)}function I6e(t,e){const i=t.hasZ&&e.hasZ;let r,s,n;if(t.xmin<=e.xmin){if(r=e.xmin,t.xmax<r)return!1}else if(r=t.xmin,e.xmax<r)return!1;if(t.ymin<=e.ymin){if(s=e.ymin,t.ymax<s)return!1}else if(s=t.ymin,e.ymax<s)return!1;if(i&&e.hasZ){if(t.zmin<=e.zmin){if(n=e.zmin,t.zmax<n)return!1}else if(n=t.zmin,e.zmax<n)return!1}return!0}function R6e(t,e){const{points:i,hasZ:r}=e,s=r?$6e:l$;for(const n of i)if(s(t,n))return!0;return!1}const Jx=[0,0],Xx=[0,0],Kx=[0,0],Qx=[0,0],P6e=[Jx,Xx,Kx,Qx],SSe=[[Kx,Jx],[Jx,Xx],[Xx,Qx],[Qx,Kx]];function D6e(t,e){return L6e(t,e.rings)}function L6e(t,e){Jx[0]=t.xmin,Jx[1]=t.ymax,Xx[0]=t.xmax,Xx[1]=t.ymax,Kx[0]=t.xmin,Kx[1]=t.ymin,Qx[0]=t.xmax,Qx[1]=t.ymin;for(const i of P6e)if(ate(e,i))return!0;for(const i of e){if(!i.length)continue;let r=i[0];if(l$(t,r))return!0;for(let s=1;s<i.length;s++){const n=i[s];if(l$(t,n)||TSe(r,n,SSe))return!0;r=n}}return!1}function N6e(t,e){Jx[0]=t.xmin,Jx[1]=t.ymax,Xx[0]=t.xmax,Xx[1]=t.ymax,Kx[0]=t.xmin,Kx[1]=t.ymin,Qx[0]=t.xmax,Qx[1]=t.ymin;const i=e.paths;for(const r of i){if(!i.length)continue;let s=r[0];if(l$(t,s))return!0;for(let n=1;n<r.length;n++){const o=r[n];if(l$(t,o)||TSe(s,o,SSe))return!0;s=o}}return!1}const ia=[0,0];function F6e(t){for(let e=0;e<t.length;e++){const i=t[e];for(let s=0;s<i.length-1;s++){const n=i[s],o=i[s+1];for(let a=e+1;a<t.length;a++)for(let l=0;l<t[a].length-1;l++){const c=t[a][l],h=t[a][l+1];if(L7(n,o,c,h,ia)&&!(ia[0]===n[0]&&ia[1]===n[1]||ia[0]===c[0]&&ia[1]===c[1]||ia[0]===o[0]&&ia[1]===o[1]||ia[0]===h[0]&&ia[1]===h[1]))return!0}}const r=i.length;if(!(r<=4))for(let s=0;s<r-3;s++){let n=r-1;s===0&&(n=r-2);const o=i[s],a=i[s+1];for(let l=s+2;l<n;l++){const c=i[l],h=i[l+1];if(L7(o,a,c,h,ia)&&!(ia[0]===o[0]&&ia[1]===o[1]||ia[0]===c[0]&&ia[1]===c[1]||ia[0]===a[0]&&ia[1]===a[1]||ia[0]===h[0]&&ia[1]===h[1]))return!0}}}return!1}function TSe(t,e,i){for(let r=0;r<i.length;r++)if(L7(t,e,i[r][0],i[r][1]))return!0;return!1}function L7(t,e,i,r,s){const[n,o]=t,[a,l]=e,[c,h]=i,[d,f]=r,m=d-c,y=n-c,v=a-n,_=f-h,b=o-h,w=l-o,x=_*v-m*w;if(x===0)return!1;const S=(m*b-_*y)/x,C=(v*b-w*y)/x;return S>=0&&S<=1&&C>=0&&C<=1&&(s&&(s[0]=n+S*(a-n),s[1]=o+S*(l-o)),!0)}function k6e(t){switch(t){case"esriGeometryEnvelope":case"extent":return I6e;case"esriGeometryMultipoint":case"multipoint":return R6e;case"esriGeometryPoint":case"point":return O6e;case"esriGeometryMultiPatch":case"multipatch":case"esriGeometryPolygon":case"polygon":return D6e;case"esriGeometryPolyline":case"polyline":return N6e}}var op;function z6e(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function Hv(t,e,i){return e==null?i:i==null?e:t(e,i)}let Lo=op=class extends og{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,i,r,s){return z6e(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?Ae.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:i,ymax:r,spatialReference:s??Ae.WGS84}}static fromPoint(t){return new op({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new ke({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new op;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&Ik(e,i)&&(t=e.isWebMercator?Gy(t):ux(t,!0)),t.type==="point"?eD(this,t):t.type==="extent"&&C6e(this,t)}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&Ik(e,i)&&(t=e.isWebMercator?Gy(t):ux(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),i=this.width*e,r=this.height*e;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const s=(this.zmax-this.zmin)*e;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*e;this.mmin+=s,this.mmax-=s}return this}intersects(t){if(t==null)return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,i=t.spatialReference;return e&&i&&!rs(e,i)&&Ik(e,i)&&(t=e.isWebMercator?Gy(t):ux(t,!0)),k6e(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,i){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,i!=null&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=Hv(Math.min,this.zmin,t.zmin),this.zmax=Hv(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=Hv(Math.min,this.mmin,t.mmin),this.mmax=Hv(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:t!=null&&this.intersects(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=Hv(Math.max,this.zmin,t.zmin),this.zmax=Hv(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=Hv(Math.max,this.mmin,t.mmin),this.mmax=Hv(Math.min,this.mmax,t.mmax)),this):null}toJSON(t){return this.write({},t)}_shiftCM(t=lc(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,i=this._getCM(t);if(i){const r=e.isWebMercator?ux(i):i;this.xmin-=i.x,this.xmax-=i.x,e.isWebMercator||(r.x=p6(r.x,t).x),this.spatialReference=new Ae(G3((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(t){let e=null;const[i,r]=t.valid,s=this.xmin,n=this.xmax;return s>=i&&s<=r&&n>=i&&n<=r||(e=this.center),e}_normalize(t,e,i){const r=this.spatialReference;if(!r)return this;const s=i??lc(r);if(s==null)return this;const n=this._getParts(s).map(l=>l.extent);if(n.length<2)return n[0]||this;if(n.length>2)return t?this._shiftCM(s):this.set({xmin:s.valid[0],xmax:s.valid[1]});if(t)return this._shiftCM(s);if(e)return n;let o=!0,a=!0;return n.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:n.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const h=(l.zmax-l.zmin)/2;for(let d=0;d<c.length;d++)c[d].push(h)}if(a){const h=(l.mmax-l.mmin)/2;for(let d=0;d<c.length;d++)c[d].push(h)}return c}),hasZ:o,hasM:a,spatialReference:r}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let h;t=t||lc(o);const[d,f]=t.valid;h=p6(this.xmin,t);const m=h.x,y=h.frameId;h=p6(this.xmax,t);const v=h.x,_=h.frameId,b=m===v&&a>0;if(a>2*f){const w=new op(l<c?m:v,s,f,n,o),x=new op(d,s,l<c?v:m,n,o),S=new op(0,s,f,n,o),C=new op(d,s,0,n,o),T=[],M=[];w.contains(S)&&T.push(y),w.contains(C)&&M.push(y),x.contains(S)&&T.push(_),x.contains(C)&&M.push(_);for(let I=y+1;I<_;I++)T.push(I),M.push(I);e.push({extent:w,frameIds:[y]},{extent:x,frameIds:[_]},{extent:S,frameIds:T},{extent:C,frameIds:M})}else m>v||b?e.push({extent:new op(m,s,f,n,o),frameIds:[y]},{extent:new op(d,s,v,n,o),frameIds:[_]}):e.push({extent:new op(m,s,v,n,o),frameIds:[y]});this.cache._parts=e}const i=this.hasZ,r=this.hasM;if(i||r){const s={};i&&(s.zmin=this.zmin,s.zmax=this.zmax),r&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<e.length;n++)e[n].extent.set(s)}return e}};function p6(t,e){const[i,r]=e.valid,s=2*r;let n,o=0;return t>r?(n=Math.ceil(Math.abs(t-r)/s),t-=n*s,o=n):t<i&&(n=Math.ceil(Math.abs(t-i)/s),t+=n*s,o=-n),{x:t,frameId:o}}u([p({readOnly:!0})],Lo.prototype,"cache",null),u([p({readOnly:!0})],Lo.prototype,"center",null),u([p({readOnly:!0})],Lo.prototype,"extent",null),u([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Lo.prototype,"hasM",null),u([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Lo.prototype,"hasZ",null),u([p({readOnly:!0})],Lo.prototype,"height",null),u([p({readOnly:!0})],Lo.prototype,"width",null),u([p({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],Lo.prototype,"xmin",void 0),u([p({type:Number,json:{write:!0}})],Lo.prototype,"ymin",void 0),u([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Lo.prototype,"mmin",void 0),u([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Lo.prototype,"zmin",void 0),u([p({type:Number,json:{write:!0}})],Lo.prototype,"xmax",void 0),u([p({type:Number,json:{write:!0}})],Lo.prototype,"ymax",void 0),u([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Lo.prototype,"mmax",void 0),u([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Lo.prototype,"zmax",void 0),Lo=op=u([A("esri.geometry.Extent")],Lo),Lo.prototype.toJSON.isDefaultToJSON=!0;const gi=Lo,U6e=Object.freeze(Object.defineProperty({__proto__:null,default:gi},Symbol.toStringTag,{value:"Module"}));function c$(t,e,i=!1){let{hasM:r,hasZ:s}=t;Array.isArray(e)?e.length!==4||r||s?e.length===3&&i&&!r?(s=!0,r=!1):e.length===3&&r&&s&&(r=!1,s=!1):(r=!0,s=!0):(s=!s&&e.hasZ&&(!r||e.hasM),r=!r&&e.hasM&&(!s||e.hasZ)),t.hasZ=s,t.hasM=r}var N7;function Fle(t){return(e,i)=>e==null?i:i==null?e:t(e,i)}function B6e(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let T0=N7=class extends og{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){if(!t&&!e)return{};const i={};Array.isArray(t)?(i.points=t,i.spatialReference=e):B6e(t)?i.spatialReference=t:(t.points&&(i.points=t.points),t.spatialReference&&(i.spatialReference=t.spatialReference),t.hasZ&&(i.hasZ=t.hasZ),t.hasM&&(i.hasM=t.hasM));const r=i.points?.[0];return r&&(i.hasZ===void 0&&i.hasM===void 0?(i.hasZ=r.length>2,i.hasM=!1):i.hasZ===void 0?i.hasZ=r.length>3:i.hasM===void 0&&(i.hasM=r.length>3)),i}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new gi,i=this.hasZ,r=this.hasM,s=i?3:2,n=t[0],o=Fle(Math.min),a=Fle(Math.max);let l,c,h,d,[f,m]=n,[y,v]=n;for(let _=0,b=t.length;_<b;_++){const w=t[_],[x,S]=w;if(f=o(f,x),m=o(m,S),y=a(y,x),v=a(v,S),i&&w.length>2){const C=w[2];l=o(l,C),h=a(h,C)}if(r&&w.length>s){const C=w[s];c=o(c,C),d=a(d,C)}}return e.xmin=f,e.ymin=m,e.xmax=y,e.ymax=v,e.spatialReference=this.spatialReference,i?(e.zmin=l,e.zmax=h):(e.zmin=void 0,e.zmax=void 0),r?(e.mmin=c,e.mmax=d):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=q(this.points)}addPoint(t){return c$(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:q(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new N7(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],i={x:e[0],y:e[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=e[2],r=3),this.hasM&&(i.m=e[r]),new ke(i)}removePoint(t){if(!this._validateInputs(t))return null;const e=new ke(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(c$(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};u([p({readOnly:!0})],T0.prototype,"cache",null),u([p()],T0.prototype,"extent",null),u([p({type:[[Number]],json:{write:{isRequired:!0}}})],T0.prototype,"points",void 0),u([ge("points")],T0.prototype,"writePoints",null),T0=N7=u([A("esri.geometry.Multipoint")],T0),T0.prototype.toJSON.isDefaultToJSON=!0;const CS=T0;function s8t(t){const e=[];for(t.reset();t.nextPath();){const i=[];for(;t.nextPoint();)i.push([t.x,t.y]);e.push(i)}return t.reset(),e}function V6e(t){const e=[];for(;t.nextPoint();)e.push([t.x,t.y]);return t.seekPathStart(),e}var Qr;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})(Qr||(Qr={}));function n8t(t){if(!t)return null;if(Array.isArray(t))return t;const e=t.hasZ,i=t.hasM;if(t.type==="point")return i&&e?[t.x,t.y,t.z,t.m]:e?[t.x,t.y,t.z]:i?[t.x,t.y,t.m]:[t.x,t.y];if(t.type==="polygon")return t.rings.slice();if(t.type==="polyline")return t.paths.slice();if(t.type==="multipoint")return t.points.slice();if(t.type==="extent"){const r=t.clone().normalize();if(!r)return null;let s=!1,n=!1;return r.forEach(o=>{o.hasZ&&(s=!0),o.hasM&&(n=!0)}),r.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(s&&o.hasZ){const l=.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(n&&o.hasM){const l=.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a})}return null}function CV(t,e){const i=e[0]-t[0],r=e[1]-t[1];if(t.length>2&&e.length>2){const s=t[2]-e[2];return Math.sqrt(i*i+r*r+s*s)}return Math.sqrt(i*i+r*r)}function ESe(t,e,i){const r=t[0]+i*(e[0]-t[0]),s=t[1]+i*(e[1]-t[1]);return t.length>2&&e.length>2?[r,s,t[2]+i*(e[2]-t[2])]:[r,s]}function j6e(t,e,i,r){return G6e(t,e,i[r],i[r+1])}function G6e(t,e,i,r){const[s,n]=e,[o,a]=i,[l,c]=r,h=l-o,d=c-a,f=h*h+d*d,m=(s-o)*h+(n-a)*d,y=Math.min(1,Math.max(0,m/f));return t[0]=o+h*y,t[1]=a+d*y,t}function H6e(t,e,i,r,s,n){let o=i,a=r,l=s-o,c=n-a;if(l!==0||c!==0){const h=((t-o)*l+(e-a)*c)/(l*l+c*c);h>1?(o=s,a=n):h>0&&(o+=l*h,a+=c*h)}return l=t-o,c=e-a,l*l+c*c}function CSe(t,e){return ESe(t,e,.5)}function $Se(t){const e=t.length;let i=0;for(let r=0;r<e-1;++r)i+=CV(t[r],t[r+1]);return i}function ASe(t,e){if(e<=0)return t[0];const i=t.length;let r=0;for(let s=0;s<i-1;++s){const n=CV(t[s],t[s+1]);if(e-r<n){const o=(e-r)/n;return ESe(t[s],t[s+1],o)}r+=n}return t[i-1]}function U_(t,e=Qr.X,i=Qr.Y){let r=0;const s=t.length;let n=t[0];for(let o=1;o<s;o++){const a=t[o];r+=(a[e]-n[e])*(a[i]+n[i]),n=a}if(!MSe(t)){const o=t[0];r+=(o[e]-n[e])*(o[i]+n[i])}return r>=0}function MSe(t){const e=t.length;return e<3||Hm(t[0],t[e-1])}function o8t(t){"rings"in t&&(OSe(t),q6e(t))}function OSe(t){if(!("rings"in t))return!1;let e=!1;for(const i of t.rings)MSe(i)||(i.push(i[0].slice()),e=!0);return e}function q6e(t){if(!("rings"in t)||t.rings.length===0||U_(t.rings[0]))return!1;for(const e of t.rings)e.reverse();return!0}function a8t(t){return t.type!=="polygon"&&t.type!=="polyline"||W6e(t.type==="polygon"?t.rings:t.paths,t.spatialReference),t}function W6e(t,e){const i=lc(e);if(!i)return;const r=i.valid[0],s=i.valid[1],n=s-r;for(const o of t){let a=1/0,l=-1/0;for(const h of o){const d=Z6e(h[0],r,s);a=Math.min(a,d),l=Math.max(l,d),h[0]=d}const c=l-a;n-c<c&&o.forEach(h=>{h[0]<0&&(h[0]+=n)})}}function Z6e(t,e,i){const r=i-e;return t<e?i-(e-t)%r:t>i?e+(t-e)%r:t}function l8t(t,e){if(t===e)return!0;if(t.type!==e.type)return!1;if(t.type==="point"||t.type==="mesh"||t.type==="extent")return!0;if(t.type==="multipoint")return t.points.length===e.points.length;const[i,r]=t.type==="polyline"?[t.paths,e.paths]:[t.rings,e.rings];return i.length===r.length&&i.every((s,n)=>s.length===r[n].length)}function c8t(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function Y6e(t){return t?ISe(t.rings,t.hasZ??!1):null}function ISe(t,e){if(!t?.length)return null;const i=[],r=[],s=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=t.length;n<o;n++){const a=RSe(t[n],e,s);a&&r.push(a)}if(r.sort((n,o)=>{let a=n[2]-o[2];return a===0&&e&&(a=n[4]-o[4]),a}),r.length&&(i[0]=r[0][0],i[1]=r[0][1],e&&(i[2]=r[0][3]),(i[0]<s[0]||i[0]>s[1]||i[1]<s[2]||i[1]>s[3]||e&&(i[2]<s[4]||i[2]>s[5]))&&(i.length=0)),!i.length){const n=t[0]&&t[0].length?J6e(t[0],e):null;if(!n)return null;i[0]=n[0],i[1]=n[1],e&&n.length>2&&(i[2]=n[2])}return i}function RSe(t,e,i){let r=0,s=0,n=0,o=0,a=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,h=t.length&&e?t[0][2]:0;for(let f=0;f<t.length;f++){const m=t[f],y=t[(f+1)%t.length],[v,_,b]=m,w=v-l,x=_-c,[S,C,T]=y,M=S-l,I=C-c,P=w*I-M*x;if(o+=P,r+=(w+M)*P,s+=(x+I)*P,e&&m.length>2&&y.length>2){const D=b-h,F=T-h,L=w*F-M*D;n+=(D+F)*L,a+=L}v<i[0]&&(i[0]=v),v>i[1]&&(i[1]=v),_<i[2]&&(i[2]=_),_>i[3]&&(i[3]=_),e&&(b<i[4]&&(i[4]=b),b>i[5]&&(i[5]=b))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const d=[r/(6*o)+l,s/(6*o)+c,o];return e&&(i[4]===i[5]||a===0?(d[3]=(i[4]+i[5])/2,d[4]=0):(d[3]=n/(6*a)+h,d[4]=a)),d}function u8t(t,e){let i=0,r=0,s=0;t.nextPoint();const n=t.pathSize?t.x:0,o=t.pathSize?t.y:0;for(let a=0;a<t.pathSize;a++){t.seekInPath(a);const l=[t.x,t.y];t.seekInPath((a+1)%t.pathSize);const c=[t.x,t.y],[h,d]=l,f=h-n,m=d-o,[y,v]=c,_=y-n,b=v-o,w=f*b-_*m;s+=w,i+=(f+_)*w,r+=(m+b)*w,h<e[0]&&(e[0]=h),h>e[1]&&(e[1]=h),d<e[2]&&(e[2]=d),d>e[3]&&(e[3]=d)}return s>0&&(s*=-1),s?(s*=.5,[i/(6*s)+n,r/(6*s)+o,s]):null}function J6e(t,e){const i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=t.length;l<c-1;l++){const h=t[l],d=t[l+1];if(h&&d){i[0]=h[0],i[1]=h[1],r[0]=d[0],r[1]=d[1],e&&h.length>2&&d.length>2&&(i[2]=h[2],r[2]=d[2]);const f=CV(i,r);if(f){s+=f;const m=CSe(h,d);n+=f*m[0],o+=f*m[1],e&&m.length>2&&(a+=f*m[2])}}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.length?t[0]:null}function X6e(t){const{hasZ:e,totalSize:i}=t;if(i===0)return null;const r=[],s=[],n=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t.reset();t.nextPath();){const o=RSe(V6e(t),t.hasZ,n);o&&s.push(o)}if(s.sort((o,a)=>{let l=o[2]-a[2];return l===0&&e&&(l=o[4]-a[4]),l}),s.length&&(r[0]=s[0][0],r[1]=s[0][1],e&&(r[2]=s[0][3]),(r[0]<n[0]||r[0]>n[1]||r[1]<n[2]||r[1]>n[3]||e&&(r[2]<n[4]||r[2]>n[5]))&&(r.length=0)),!r.length){t.reset(),t.nextPath();const o=t.pathSize?K6e(t):null;if(!o)return null;r[0]=o[0],r[1]=o[1],e&&o.length>2&&(r[2]=o[2])}return r}function K6e(t){const{hasZ:e}=t,i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;if(t.nextPoint()){let l=t.x,c=t.y,h=t.z;for(;t.nextPoint();){const d=t.x,f=t.y,m=t.z;i[0]=l,i[1]=c,r[0]=d,r[1]=f,e&&(i[2]=h,r[2]=m);const y=CV(i,r);if(y){s+=y;const v=CSe(i,r);n+=y*v[0],o+=y*v[1],e&&v.length>2&&(a+=y*v[2])}l=d,c=f,h=m}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.pathSize?(t.seekPathStart(),t.nextPoint(),[t.x,t.y]):null}const Q6e=1e-6;function h8t(t){let e=0;for(t.reset();t.nextPath();)e+=t.getCurrentRingArea();if(e<Q6e){const s=X6e(t);return s?[s[0],s[1]]:null}const i=[0,0];if(t.reset(),!t.nextPath()||!t.nextPoint())return null;const r=[t.x,t.y];for(t.reset();t.nextPath();)tHe(i,r,t);return i[0]*=1/e,i[1]*=1/e,i[0]+=r[0],i[1]+=r[1],i}const eHe=1/3;function tHe(t,e,i){if(!i||i.pathSize<3)return null;i.nextPoint();const r=i.x,s=i.y;i.nextPoint();let n,o=i.x-r,a=i.y-s,l=0,c=0;for(;i.nextPoint();)l=i.x-r,c=i.y-s,n=.5*eHe*(l*a-c*o),t[0]+=n*(o+l),t[1]+=n*(a+c),o=l,a=c;const h=i.getCurrentRingArea(),d=[r,s];return d[0]-=e[0],d[1]-=e[1],d[0]*=h,d[1]*=h,t[0]+=d[0],t[1]+=d[1],t}function Qt(t=oHe){return[t[0],t[1],t[2],t[3]]}function d8t(t){return[t[0],t[1],t[2],t[3]]}function _b(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function lte(t,e,i,r,s=Qt()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function PSe(t,e=Qt()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function tD(t,e,i=new gi){return i.xmin=t[0],i.ymin=t[1],i.xmax=t[2],i.ymax=t[3],i.spatialReference=e,i}function iHe(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function vC(t,e,i){if(e!=null)if("length"in e)U7(e)?(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[2]),i[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[0]),i[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":i[0]=Math.min(t[0],e.xmin),i[1]=Math.min(t[1],e.ymin),i[2]=Math.max(t[2],e.xmax),i[3]=Math.max(t[3],e.ymax);break;case"point":i[0]=Math.min(t[0],e.x),i[1]=Math.min(t[1],e.y),i[2]=Math.max(t[2],e.x),i[3]=Math.max(t[3],e.y)}else _b(i,t)}function f6(t,e,i=t){const r=e.length;let s=t[0],n=t[1],o=t[2],a=t[3];for(let l=0;l<r;l++){const c=e[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return i[0]=s,i[1]=n,i[2]=o,i[3]=a,i}function F7(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function Zo(t){return t==null||t[0]>=t[2]?0:t[2]-t[0]}function wl(t){return t==null||t[1]>=t[3]?0:t[3]-t[1]}function p8t(t){return Zo(t)*wl(t)}function jz(t){return Zo(t)>0&&wl(t)>0}function DSe(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function f8t(t){const e=Zo(t),i=wl(t);return Math.sqrt(e*e+i*i)}function rHe(t,e){return $V(t,e[0],e[1])}function kle(t,e){const i=e[3],r=.5*(t[0]+t[2]),s=Math.abs(e[0]-r),n=.5*(t[2]-t[0]);if(s>i+n)return!1;const o=.5*(t[1]+t[3]),a=.5*(t[3]-t[1]),l=Math.abs(e[1]-o);if(l>i+a)return!1;if(s<n||l<a)return!0;const c=s-n,h=l-a;return c*c+h*h<=i*i}function m8t(t,e,i){const r=t[0],s=t[1],n=t[2],o=t[3],{x:a,y:l}=e,{x:c,y:h}=i,d=(_,b)=>(h-l)*_+(a-c)*b+(c*l-a*h)<0,f=d(r,o),m=d(n,o),y=d(n,s),v=d(r,s);return!(f===m&&m===y&&y===v&&v===f||a<r&&c<r||a>n&&c>n||l>o&&h>o||l<s&&h<s)}function g8t(t,e){return $V(t,e.x,e.y)}function $V(t,e,i){return e>=t[0]&&i>=t[1]&&e<=t[2]&&i<=t[3]}function RP(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function y8t(t,e,i){return Math.max(e[0],t[0])-i<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])-i<=Math.min(e[3],t[3])}function k7(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function z7(t,e,i){if(e==null)return _b(i,t);const r=e[0],s=e[1],n=e[2],o=e[3];return i[0]=ce(t[0],r,n),i[1]=ce(t[1],s,o),i[2]=ce(t[2],r,n),i[3]=ce(t[3],s,o),i}function sHe(t,e){const i=(t[0]+t[2])/2,r=(t[1]+t[3])/2,s=Math.max(Math.abs(e[0]-i)-Zo(t)/2,0),n=Math.max(Math.abs(e[1]-r)-wl(t)/2,0);return Math.sqrt(s*s+n*n)}function Gz(t,e,i,r=t){return r[0]=t[0]+e,r[1]=t[1]+i,r[2]=t[2]+e,r[3]=t[3]+i,r}function v8t(t,e,i=t){return i[0]=t[0]-e,i[1]=t[1]-e,i[2]=t[2]+e,i[3]=t[3]+e,i}function sv(t){return t?_b(t,B7):Qt(B7)}function U7(t){return t!=null&&t.length===4}function nHe(t){return!(Zo(t)!==0&&isFinite(t[0])||wl(t)!==0&&isFinite(t[1]))}function Tx(t,e){return U7(t)&&U7(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const _8t=[-1/0,-1/0,1/0,1/0],B7=[1/0,1/0,-1/0,-1/0],oHe=[0,0,0,0];function LSe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function NSe(t){return t.points!==void 0}function FSe(t){return t.x!==void 0&&t.y!==void 0}function kSe(t){return t.paths!==void 0}function zSe(t){return t.rings!==void 0}function USe(t){function e(i,r){return i==null?r:r==null?i:t(i,r)}return e}const B_=USe(Math.min),V_=USe(Math.max);function b8t(t,e){return kSe(e)?u$(t,e.paths,!1,!1):zSe(e)?u$(t,e.rings,!1,!1):NSe(e)?cte(t,e.points,!1,!1,!1,!1):LSe(e)?BSe(t,e):(FSe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function w8t(t){let e,i,r,s;for(t.reset(),e=r=1/0,i=s=-1/0;t.nextPath();){const n=aHe(t);e=Math.min(n[0],e),r=Math.min(n[1],r),i=Math.max(n[2],i),s=Math.max(n[3],s)}return Qt([e,r,i,s])}function aHe(t){let e,i,r,s;for(e=r=1/0,i=s=-1/0;t.nextPoint();)e=Math.min(t.x,e),r=Math.min(t.y,r),i=Math.max(t.x,i),s=Math.max(t.y,s);return Qt([e,r,i,s])}function x8t(t,e){return kSe(e)?u$(t,e.paths,!0,!1):zSe(e)?u$(t,e.rings,!0,!1):NSe(e)?cte(t,e.points,!0,!1,!0,!1):LSe(e)?BSe(t,e,!0,!1,!0,!1):(FSe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function u$(t,e,i,r){const s=i?3:2;if(!e.length||!e[0].length)return null;let n,o,a,l,[c,h]=e[0][0],[d,f]=e[0][0];for(let m=0;m<e.length;m++){const y=e[m];for(let v=0;v<y.length;v++){const _=y[v],[b,w]=_;if(c=B_(c,b),h=B_(h,w),d=V_(d,b),f=V_(f,w),i&&_.length>2){const x=_[2];n=B_(n,x),o=V_(o,x)}if(r&&_.length>s){const x=_[s];a=B_(n,x),l=V_(o,x)}}}return i?r?(t[0]=c,t[1]=h,t[2]=n,t[3]=a,t[4]=d,t[5]=f,t[6]=o,t[7]=l,t.length=8,t):(t[0]=c,t[1]=h,t[2]=n,t[3]=d,t[4]=f,t[5]=o,t.length=6,t):r?(t[0]=c,t[1]=h,t[2]=a,t[3]=d,t[4]=f,t[5]=l,t.length=6,t):(t[0]=c,t[1]=h,t[2]=d,t[3]=f,t.length=4,t)}function BSe(t,e,i,r,s,n){const o=e.xmin,a=e.xmax,l=e.ymin,c=e.ymax;let h=e.zmin,d=e.zmax,f=e.mmin,m=e.mmax;return s?(h=h||0,d=d||0,n?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=h,t[3]=f,t[4]=a,t[5]=c,t[6]=d,t[7]=m,t):(t[0]=o,t[1]=l,t[2]=h,t[3]=a,t[4]=c,t[5]=d,t)):n?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=f,t[3]=a,t[4]=c,t[5]=m,t):(t[0]=o,t[1]=l,t[2]=a,t[3]=c,t)}function cte(t,e,i,r,s,n){const o=i?3:2,a=r&&n,l=i&&s;if(!e.length||!e[0].length)return null;let c,h,d,f,[m,y]=e[0],[v,_]=e[0];for(let b=0;b<e.length;b++){const w=e[b],[x,S]=w;if(m=B_(m,x),y=B_(y,S),v=V_(v,x),_=V_(_,S),l&&w.length>2){const C=w[2];c=B_(c,C),h=V_(h,C)}if(a&&w.length>o){const C=w[o];d=B_(c,C),f=V_(h,C)}}return s?(c=c||0,h=h||0,n?(d=d||0,f=f||0,t[0]=m,t[1]=y,t[2]=c,t[3]=d,t[4]=v,t[5]=_,t[6]=h,t[7]=f,t):(t[0]=m,t[1]=y,t[2]=c,t[3]=v,t[4]=_,t[5]=h,t)):n?(d=d||0,f=f||0,t[0]=m,t[1]=y,t[2]=d,t[3]=v,t[4]=_,t[5]=f,t):(t[0]=m,t[1]=y,t[2]=v,t[3]=_,t)}function lHe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function cHe(t){return t.points!==void 0}function uHe(t){return t.x!==void 0&&t.y!==void 0}function hHe(t){return t.paths!==void 0}function dHe(t){return t.rings!==void 0}const ute=[];function VSe(t,e,i,r){return{xmin:t,ymin:e,xmax:i,ymax:r}}function jSe(t,e,i,r,s,n){return{xmin:t,ymin:e,zmin:i,xmax:r,ymax:s,zmax:n}}function GSe(t,e,i,r,s,n){return{xmin:t,ymin:e,mmin:i,xmax:r,ymax:s,mmax:n}}function HSe(t,e,i,r,s,n,o,a){return{xmin:t,ymin:e,zmin:i,mmin:r,xmax:s,ymax:n,zmax:o,mmax:a}}function hte(t,e=!1,i=!1){return e?i?HSe(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):jSe(t[0],t[1],t[2],t[3],t[4],t[5]):i?GSe(t[0],t[1],t[2],t[3],t[4],t[5]):VSe(t[0],t[1],t[2],t[3])}function S8t(t){return t?lHe(t)?t:uHe(t)?fHe(t):dHe(t)?qSe(t):hHe(t)?WSe(t):cHe(t)?pHe(t):null:null}function pHe(t){const{hasZ:e,hasM:i,points:r}=t;return hte(cte(ute,r,e??!1,i??!1),e,i)}function fHe(t){const{x:e,y:i,z:r,m:s}=t,n=s!=null;return r!=null?n?HSe(e,i,r,s,e,i,r,s):jSe(e,i,r,e,i,r):n?GSe(e,i,s,e,i,s):VSe(e,i,e,i)}function qSe(t){const{hasZ:e,hasM:i,rings:r}=t,s=u$(ute,r,e??!1,i??!1);return s?hte(s,e,i):null}function WSe(t){const{hasZ:e,hasM:i,paths:r}=t,s=u$(ute,r,e??!1,i??!1);return s?hte(s,e,i):null}var Pk;function zle(t){return!Array.isArray(t[0])}function mHe(t){return typeof t[0]?.[0]=="number"}function gHe(t){if(!t)return;let{rings:e,hasM:i,hasZ:r,spatialReference:s}=t;switch(e??=[],mHe(e)&&(e=[e]),e[0]?.[0]?.length){case 4:r??=!0,i??=!0;break;case 3:r??=i!==!0,i??=!r;break;default:r??=!1,i??=!1}return s??=Ae.WGS84,{...t,hasM:i,hasZ:r,rings:e,spatialReference:s}}let Lh=Pk=class extends og{static fromExtent(t){const e=t.clone().normalize(),{spatialReference:i}=t;let r=!1,s=!1;for(const o of e)o.hasZ&&(r=!0),o.hasM&&(s=!0);const n={rings:e.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(r&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:i};return r&&(n.hasZ=!0),s&&(n.hasM=!0),new Pk(n)}constructor(t){super(gHe(t)),this.curveRings=void 0,this.rings=[],this.type="polygon"}get cache(){return this.commitProperty("curveRings"),this.commitProperty("hasM"),this.commitProperty("hasZ"),this.commitProperty("rings"),this.commitProperty("spatialReference"),{}}get centroid(){const t=Y6e(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new ke;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}writeCurveRings(t,e){e.curveRings=q(t)}get extent(){const t=qSe(this),{spatialReference:e}=this;return t?new gi({...t,spatialReference:e}):null}get isSelfIntersecting(){return F6e(this.rings)}writeRings(t,e){e.rings=q(this.rings)}addRing(t){if(!t)return;const e=this.rings,i=e.length;if(zle(t)){const r=[];for(let s=0,n=t.length;s<n;s++)r[s]=t[s].toArray();e[i]=r}else e[i]=t.slice();return this.notifyChange("rings"),this}clone(){const t=new Pk;return t.spatialReference=this.spatialReference,t.rings=q(this.rings),t.curveRings=q(this.curveRings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,i=t.spatialReference;if(e!=null!=(i!=null)||e!=null&&i!=null&&!e.equals(i)||this.rings.length!==t.rings.length)return!1;const r=([s,n,o,a],[l,c,h,d])=>s===l&&n===c&&(o==null&&h==null||o===h)&&(a==null&&d==null||a===d);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=t.rings[s];if(!Hm(n,o,r))return!1}return!0}contains(t){if(!t)return!1;const e=Q3(t,this.spatialReference);return ote(this,e??t)}isClockwise(t){const e=zle(t)?t.map(i=>this.hasZ?this.hasM?[i.x,i.y,i.z,i.m]:[i.x,i.y,i.z]:[i.x,i.y]):t;return U_(e)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.rings[t][e],r=this.hasZ,s=this.hasM;return r&&!s?new ke(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new ke(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new ke(i[0],i[1],i[2],i[3],this.spatialReference):new ke(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(c$(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t].splice(e,0,i),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new ke(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],i=this.spatialReference,r=e.map(s=>new ke(s,i));return this.notifyChange("rings"),r}setPoint(t,e,i){return this._validateInputs(t,e)?(c$(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t][e]=i,this.notifyChange("rings"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const r=this.rings[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};u([p({readOnly:!0})],Lh.prototype,"cache",null),u([p({readOnly:!0})],Lh.prototype,"centroid",null),u([p({json:{write:!0,origins:{"portal-item":{write:!1},"web-map":{write:!1},"web-scene":{write:!1}}}})],Lh.prototype,"curveRings",void 0),u([ge("curveRings")],Lh.prototype,"writeCurveRings",null),u([p({readOnly:!0})],Lh.prototype,"extent",null),u([p({readOnly:!0})],Lh.prototype,"isSelfIntersecting",null),u([p({type:[[[Number]]],json:{write:{isRequired:!0}}})],Lh.prototype,"rings",void 0),u([ge("rings")],Lh.prototype,"writeRings",null),Lh=Pk=u([A("esri.geometry.Polygon")],Lh);const Sa=Lh;Lh.prototype.toJSON.isDefaultToJSON=!0;var V7;function yHe(t){return!Array.isArray(t[0])}function vHe(t){return typeof t[0]?.[0]=="number"}function _He(t){if(!t)return;let{paths:e,hasM:i,hasZ:r,spatialReference:s}=t;switch(e??=[],vHe(e)&&(e=[e]),e[0]?.[0]?.length){case 4:r??=!0,i??=!0;break;case 3:r??=i!==!0,i??=!r;break;default:r??=!1,i??=!1}return s??=Ae.WGS84,{...t,hasM:i,hasZ:r,paths:e,spatialReference:s}}let hm=V7=class extends og{constructor(t){super(_He(t)),this.curvePaths=void 0,this.paths=[],this.type="polyline"}get cache(){return this.commitProperty("curvePaths"),this.commitProperty("hasM"),this.commitProperty("hasZ"),this.commitProperty("paths"),this.commitProperty("spatialReference"),{}}writeCurvePaths(t,e){e.curvePaths=q(t)}get extent(){const t=WSe(this),{spatialReference:e}=this;return t?new gi({...t,spatialReference:e}):null}writePaths(t,e){e.paths=q(this.paths)}addPath(t){if(!t)return;const e=this.paths,i=e.length;if(yHe(t)){const r=[];for(let s=0,n=t.length;s<n;s++)r[s]=t[s].toArray();e[i]=r}else e[i]=t.slice();return this.notifyChange("paths"),this}clone(){const t=new V7;return t.spatialReference=this.spatialReference,t.paths=q(this.paths),t.curvePaths=q(this.curvePaths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.paths[t][e],r=this.hasZ,s=this.hasM;return r&&!s?new ke(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new ke(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new ke(i[0],i[1],i[2],i[3],this.spatialReference):new ke(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(c$(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t].splice(e,0,i),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],i=this.spatialReference,r=e.map(s=>new ke(s,i));return this.notifyChange("paths"),r}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new ke(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(t,e,i){return this._validateInputs(t,e)?(c$(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t][e]=i,this.notifyChange("paths"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const r=this.paths[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};u([p({readOnly:!0})],hm.prototype,"cache",null),u([p({json:{write:!0,origins:{"portal-item":{write:!1},"web-map":{write:!1},"web-scene":{write:!1}}}})],hm.prototype,"curvePaths",void 0),u([ge("curvePaths")],hm.prototype,"writeCurvePaths",null),u([p({readOnly:!0})],hm.prototype,"extent",null),u([p({type:[[[Number]]],json:{write:{isRequired:!0}}})],hm.prototype,"paths",void 0),u([ge("paths")],hm.prototype,"writePaths",null),hm=V7=u([A("esri.geometry.Polyline")],hm);const fd=hm;hm.prototype.toJSON.isDefaultToJSON=!0;function ZSe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function dte(t){return t.points!==void 0}function pte(t){return t.x!==void 0&&t.y!==void 0}function AV(t){return t.paths!==void 0||t.curvePaths!==void 0}function nb(t){return t.rings!==void 0||t.curveRings!==void 0}function af(t){return t==null?null:t instanceof og?t:pte(t)?ke.fromJSON(t):AV(t)?fd.fromJSON(t):nb(t)?Sa.fromJSON(t):dte(t)?CS.fromJSON(t):ZSe(t)?gi.fromJSON(t):null}function iD(t){return t?pte(t)?"esriGeometryPoint":AV(t)?"esriGeometryPolyline":nb(t)?"esriGeometryPolygon":ZSe(t)?"esriGeometryEnvelope":dte(t)?"esriGeometryMultipoint":null:null}const bHe={esriGeometryPoint:ke,esriGeometryPolyline:fd,esriGeometryPolygon:Sa,esriGeometryEnvelope:gi,esriGeometryMultipoint:CS,esriGeometryMultiPatch:Sa};function wHe(t){return t&&bHe[t]||null}const YSe=Mo()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),Ule=Mo()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"}),bA={base:og,key:"type",typeMap:{extent:gi,multipoint:CS,point:ke,polyline:fd,polygon:Sa}};var j7;let E0=j7=class extends ee{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new j7({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};u([p({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:m6}}}}})],E0.prototype,"rotation",void 0),u([Yt("rotation")],E0.prototype,"castRotation",null),u([p({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:m6}}}}})],E0.prototype,"scale",void 0),u([p({types:bA,json:{read:af,write:!0,origins:{"web-scene":{read:af,write:{overridePolicy:m6}}}}})],E0.prototype,"targetGeometry",void 0),u([p({type:tu,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}})],E0.prototype,"camera",void 0),E0=j7=u([A("esri.Viewpoint")],E0);const Jr=E0;function m6(){return{enabled:!this.camera}}let ws=class JSe{constructor(){this._emitter=new JSe.EventEmitter(this)}emit(e,i){return this._emitter.emit(e,i)}on(e,i){return this._emitter.on(e,i)}once(e,i){return this._emitter.once(e,i)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(s=null){this._target=s,this._listenersMap=null}clear(){this._listenersMap?.clear(),this._listenersMap=null}destroy(){this.clear()}emit(s,n){let o=this._listenersMap?.get(s);if(!o)return!1;const a=this._target||this;let l=!1;for(const c of o.slice()){const h="deref"in c?c.deref():c;h?h?.call(a,n):l=!0}return l&&(o=o.filter(c=>!("deref"in c)||c.deref()!=null),this._listenersMap.set(s,o)),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return q3(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap??=new Map;const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),$i(()=>{const a=this._listenersMap?.get(s),l=a?.indexOf(n)??-1;l>=0&&a.splice(l,1)})}once(s,n){const o=this.on(s,a=>{o.remove(),("deref"in n?n.deref():n)?.call(null,a)});return o}hasEventListener(s){const n=this._listenersMap?.get(s);return n!=null&&n.length>0}}t.EventEmitter=e,t.EventedMixin=r=>{let s=class extends r{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=u([A("esri.core.Evented")],s),s};let i=class extends ue{constructor(){super(...arguments),this._emitter=new ws.EventEmitter(this)}destroy(){this._emitter.clear()}emit(r,s){return this._emitter.emit(r,s)}on(r,s){return this._emitter.on(r,s)}once(r,s){return this._emitter.once(r,s)}hasEventListener(r){return this._emitter.hasEventListener(r)}};i=u([A("esri.core.Evented.EventedAccessor")],i),t.EventedAccessor=i})(ws);var Tr;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(Tr||(Tr={}));function fte(t){return(e,i)=>{e[i]=t}}let rD=class extends X1e{notify(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onInvalidated(),r.onCommitted()}}};var Ay;let xHe=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}},SHe=class{constructor(e,i,r,s,n){this.target=e,this.added=i,this.removed=r,this.start=s,this.deleteCount=n}};const fh=new Cl(xHe,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1});function Ble(t){t&&typeof t=="object"&&"destroy"in t&&typeof t.destroy=="function"&&t.destroy()}function g6(t){return t?t instanceof by?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function y6(t){if(t?.length)return t[0]}function THe(t,e,i,r){const s=Math.min(t.length-i,e.length-r);let n=0;for(;n<s&&t[i+n]===e[r+n];)n++;return n}function XSe(t,e,i,r){e&&e.forEach((s,n,o)=>{t.push(s),XSe(t,i.call(r,s,n,o),i,r)})}const qv=new Set,Wv=new Set,Zv=new Set,v6=new Map;let EHe=0,by=Ay=class extends ws.EventedAccessor{static isCollection(t){return t!=null&&t instanceof Ay}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._updating=!1,this._timer=null,this._observable=new rD,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:EHe++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof Ay?{items:t}:t:{}}destroy(){this._removeAllRaw(),this._timer&&this._timer.remove(),this._emitter.destroy(),this._notifications=null}*[Symbol.iterator](){yield*this.items}get items(){return It(this._observable),this._items}set items(t){this._emitBeforeChanges(Tr.ADD)||(this._splice(0,this.length,g6(t)),this._emitAfterChanges(Tr.ADD))}hasEventListener(t){return!this.destroyed&&(t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t))}on(t,e){if(this.destroyed)return $i();if(t==="change"){const i=this._chgListeners,r={removed:!1,callback:e};return i.push(r),this._notifications&&this._notifications.push({listeners:i.slice(),items:this._items.slice(),changes:[]}),$i(()=>{r.removed=!0,i.splice(i.indexOf(r),1)})}return this._emitter.on(t,e)}once(t,e){const i="deref"in e?()=>e.deref():()=>e,r=this.on(t,s=>{i()?.call(null,s),r.remove()});return r}add(t,e){if(It(this._observable),this._emitBeforeChanges(Tr.ADD))return this;const i=this.getNextIndex(e??null);return this._splice(i,0,[t]),this._emitAfterChanges(Tr.ADD),this}addMany(t,e=this._items.length){if(It(this._observable),!t?.length)return this;if(this._emitBeforeChanges(Tr.ADD))return this;const i=this.getNextIndex(e);return this._splice(i,0,g6(t)),this._emitAfterChanges(Tr.ADD),this}at(t){if(It(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(It(this._observable),!this.length||this._emitBeforeChanges(Tr.REMOVE))return[];const t=this._removeAllRaw();return this._emitAfterChanges(Tr.REMOVE),t}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return It(this._observable),this._createNewInstance({items:this._items.map(q)})}concat(...t){It(this._observable);const e=t.map(g6);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(It(this._observable),!this.length||this._emitBeforeChanges(Tr.REMOVE))return;const i=this._splice(0,this.length),r=i.length;for(let s=0;s<r;s++)t.call(e,i[s],s,i);this._emitAfterChanges(Tr.REMOVE)}destroyAll(){this.drain(Ble)}destroyMany(t){const e=this.removeMany(t);return e.forEach(Ble),e}every(t,e){return It(this._observable),this._items.every(t,e)}filter(t,e){It(this._observable);const i=arguments.length===2?this._items.filter(t,e):this._items.filter(t);return this._createNewInstance({items:i})}find(t,e){return It(this._observable),this._items.find(t,e)}findIndex(t,e){return It(this._observable),this._items.findIndex(t,e)}flatten(t,e){It(this._observable);const i=[];return XSe(i,this,t,e),new Ay(i)}forEach(t,e){return It(this._observable),this._items.forEach(t,e)}getItemAt(t){return It(this._observable),this._items[t]}getNextIndex(t){It(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return It(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return It(this._observable),this._items.indexOf(t,e)}join(t=","){return It(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return It(this._observable),this._items.lastIndexOf(t,e)}map(t,e){It(this._observable);const i=this._items.map(t,e);return new Ay({items:i})}reorder(t,e=this.length-1){It(this._observable);const i=this.indexOf(t);if(i!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),i!==e){if(this._emitBeforeChanges(Tr.MOVE))return t;this._splice(i,1),this._splice(e,0,[t]),this._emitAfterChanges(Tr.MOVE)}return t}}pop(){if(It(this._observable),!this.length||this._emitBeforeChanges(Tr.REMOVE))return;const t=y6(this._splice(this.length-1,1));return this._emitAfterChanges(Tr.REMOVE),t}push(...t){return It(this._observable),this._emitBeforeChanges(Tr.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(Tr.ADD)),this.length}reduce(t,e){It(this._observable);const i=this._items;return arguments.length===2?i.reduce(t,e):i.reduce(t)}reduceRight(t,e){It(this._observable);const i=this._items;return arguments.length===2?i.reduceRight(t,e):i.reduceRight(t)}remove(t){return It(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(It(this._observable),t<0||t>=this.length||this._emitBeforeChanges(Tr.REMOVE))return;const e=y6(this._splice(t,1));return this._emitAfterChanges(Tr.REMOVE),e}removeMany(t){if(It(this._observable),!t?.length||this._emitBeforeChanges(Tr.REMOVE))return[];const e=t instanceof Ay?t.toArray():t,i=this._items,r=[],s=e.length;for(let n=0;n<s;n++){const o=e[n],a=i.indexOf(o);if(a>-1){const l=1+THe(e,i,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&r.push.apply(r,c),n+=l-1}}return this._emitAfterChanges(Tr.REMOVE),r}reverse(){if(It(this._observable),this._emitBeforeChanges(Tr.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(Tr.MOVE),this}shift(){if(It(this._observable),!this.length||this._emitBeforeChanges(Tr.REMOVE))return;const t=y6(this._splice(0,1));return this._emitAfterChanges(Tr.REMOVE),t}slice(t=0,e=this.length){return It(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return It(this._observable),this._items.some(t,e)}sort(t){if(It(this._observable),!this.length||this._emitBeforeChanges(Tr.MOVE)||!this._requiresSort(t))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(Tr.MOVE),this}_requiresSort(t=(e,i)=>e===i?0:e<i?-1:1){const e=this.length-1;for(let i=0;i<e;i++)if(t(this.items[i],this.items[i+1])>0)return!0;return!1}splice(t,e,...i){It(this._observable);const r=(e?Tr.REMOVE:0)|(i.length?Tr.ADD:0);if(this._emitBeforeChanges(r))return[];const s=this._splice(t,e,i)||[];return this._emitAfterChanges(r),s}toArray(){return It(this._observable),this._items.slice()}toJSON(){return It(this._observable),this.toArray()}toLocaleString(){return It(this._observable),this._items.toLocaleString()}toString(){return It(this._observable),this._items.toString()}unshift(...t){return It(this._observable),!t.length||this._emitBeforeChanges(Tr.ADD)||(this._splice(0,0,t),this._emitAfterChanges(Tr.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,i){const r=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._updating=!0,this._timer=mA(()=>this._dispatchChange())),t<0&&(t+=this.length),e){if(o=r.splice(t,e),this.hasEventListener("before-remove")){const a=fh.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),r.splice(t,0,n),t+=1,l-=1,c-=1);fh.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=fh.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);fh.release(a)}}if(i?.length){if(s){const h=[];for(const d of i){const f=s.ensureType(d);f==null&&d!=null||h.push(f)}i=h}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(a||l){const h=fh.acquire();h.target=this,h.cancellable=!0;const d=fh.acquire();d.target=this,d.cancellable=!1;for(const f of i)a?(h.reset(f),this.emit("before-add",h),h.defaultPrevented||(c?r.push(f):r.splice(t++,0,f),this._set("length",r.length),l&&(d.reset(f),this.emit("after-add",d)))):(c?r.push(f):r.splice(t++,0,f),this._set("length",r.length),d.reset(f),this.emit("after-add",d));fh.release(d),fh.release(h)}else{if(c)for(const h of i)r.push(h);else r.splice(t,0,...i);this._set("length",r.length)}}if((i?.length||o?.length)&&this._notifyChangeEvent(i,o),this.hasEventListener("after-splice")){const a=new SHe(this,i,o,t,e);this.emit("after-splice",a)}return o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const i=fh.acquire();i.target=this,i.cancellable=!0,i.type=t,this.emit("before-changes",i),e=i.defaultPrevented,fh.release(i)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=fh.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),fh.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}get updating(){return this._updating}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),this._updating=!1,!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const i=e.changes;qv.clear(),Wv.clear(),Zv.clear();for(const{added:l,removed:c}of i){if(l)if(Zv.size===0&&Wv.size===0)for(const h of l)qv.add(h);else for(const h of l)Wv.has(h)?(Zv.add(h),Wv.delete(h)):Zv.has(h)||qv.add(h);if(c)if(Zv.size===0&&qv.size===0)for(const h of c)Wv.add(h);else for(const h of c)qv.has(h)?qv.delete(h):(Zv.delete(h),Wv.add(h))}const r=tc.acquire();qv.forEach(l=>{r.push(l)});const s=tc.acquire();Wv.forEach(l=>{s.push(l)});const n=this._items,o=e.items,a=tc.acquire();if(Zv.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),e.listeners&&(r.length||s.length||a.length)){const l={target:this,added:r,removed:s,moved:a},c=e.listeners.length;for(let h=0;h<c;h++){const d=e.listeners[h];d.removed||d.callback.call(this,l)}}tc.release(r),tc.release(s),tc.release(a)}qv.clear(),Wv.clear(),Zv.clear()}};by.ofType=t=>{if(!t)return Ay;if(v6.has(t))return v6.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const r in t.typeMap){const s=t.typeMap[r].prototype.declaredClass;e?e+=` | ${s}`:e=s}let i=class extends Ay{};return u([fte({Type:t,ensureType:typeof t=="function"?Is(t):Sd(t)})],i.prototype,"itemType",void 0),i=u([A(`esri.core.Collection<${e}>`)],i),v6.set(t,i),i},u([p()],by.prototype,"_updating",void 0),u([p()],by.prototype,"length",void 0),u([p()],by.prototype,"items",null),u([p({readOnly:!0})],by.prototype,"updating",null),by=Ay=u([A("esri.core.Collection")],by);const Ee=by;function mte(t,e,i){return yV(t.map((r,s)=>e.apply(i,[r,s])))}async function CHe(t,e,i){return(await yV(t.map((r,s)=>e.apply(i,[r,s])))).map(r=>r.value)}function gte(t){return{ok:!0,value:t}}function yte(t){return{ok:!1,error:t}}function $He(t){return t!=null&&t.ok===!0?t.value:null}function AHe(t){return t!=null&&t.ok===!1?t.error:null}async function lf(t){if(t==null)return{ok:!1,error:new Error("no promise provided")};try{return gte(await t)}catch(e){return yte(e)}}async function MHe(t){try{return gte(await t)}catch(e){return Vc(e),yte(e)}}function $8t(t){if(t.ok===!0)return t.value;throw t.error}function ag(t,e){return new C0(t,e)}let C0=class extends ue{get value(){return $He(this._result)}get error(){return AHe(this._result)}get finished(){return this._result!=null}constructor(e,i){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=hc(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:r}=this._abortController;this.promise=e(r),this.promise.then(s=>{this._result=gte(s),this._cleanup()},s=>{this._result=yte(s),this._cleanup()}),this._abortHandle=Xo(i,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=Hi(this._abortHandle),this._abortController=null}};u([p()],C0.prototype,"value",null),u([p()],C0.prototype,"error",null),u([p()],C0.prototype,"finished",null),u([p()],C0.prototype,"promise",void 0),u([p()],C0.prototype,"_result",void 0),C0=u([A("esri.core.asyncUtils.ReactiveTask")],C0);function H(t,e,i={}){return vte(t,e,i,KSe)}function gn(t,e,i={}){return vte(t,e,i,QSe)}function vte(t,e,i={},r){let s=null;const n=i.once?(o,a)=>{r(o)&&(Hi(s),e(o,a))}:(o,a)=>{r(o)&&e(o,a)};if(s=wje(t,n,i.sync,i.equals),i.initial){const o=t();n(o,o)}return s}function io(t,e,i,r={}){let s=null,n=null,o=null;function a(){s&&n&&(n.remove(),r.onListenerRemove?.(s),s=null,n=null)}function l(h){r.once&&r.once&&Hi(o),i(h)}const c=H(t,(h,d)=>{a(),gV(h)&&(s=h,n=fA(h,e,l),r.onListenerAdd?.(h))},{sync:r.sync,initial:!0});return o=$i(()=>{c.remove(),a()}),o}function Cd(t,e){return OHe(t,QSe,e)}function OHe(t,e,i){if(wa(i))return Promise.reject(vi());const r=t();if(e?.(r))return Promise.resolve(r);let s=null;function n(){s=Hi(s)}return new Promise((o,a)=>{s=q3([Xo(i,()=>{n(),a(vi())}),vte(t,l=>{n(),o(l)},{sync:!1,once:!0},e??KSe)])})}function KSe(t){return!0}function QSe(t){return!!t}function IHe(t,e,i={}){let r=!1;const s=H(t,(n,o)=>{r||e(n,o)},i);return{remove(){s.remove()},pause(){r=!0},resume(){r=!1}}}function RHe(t,e){const i=new Ee,r=io(t,"after-splice",({added:s,start:n,deleteCount:o})=>{const a=i.splice(n,o);for(const l of a)l.remove();if(s?.length){const l=s.map(e);i.addMany(l,n)}},{sync:!0,onListenerRemove:()=>i.drain(s=>s.remove()),onListenerAdd:s=>i.addMany(s.items.map(e))});return i.addHandles(r),i}function M8t(t,e){const i=new Ee,r=RHe(t,a=>ag(async l=>{const c=await e(a,l);if(wa(l))throw c.remove(),vi();return c})),s=()=>null,n=async a=>{const l=await a.promise,c=r.indexOf(a);c<0||i.splice(c,1,l)};i.addMany(r.items.map(s));for(const a of r)xP(n(a));const o=r.on("after-splice",({added:a,start:l,deleteCount:c})=>{const h=i.splice(l,c);for(const d of h)d?.remove();if(a?.length){i.addMany(a.map(s),l);for(const d of a)xP(n(d))}});return i.addHandles([M1e(r),o]),i}const Gt={sync:!0},Nt={initial:!0},St={sync:!0,initial:!0};let dE=class extends Ee{constructor(e){super(e),this.getCollections=null}initialize(){this.addHandles(cxe(()=>this._refresh(),Gt))}destroy(){this.getCollections=null}_refresh(){const e=this.getCollections!=null?this.getCollections():null;if(e==null)return void this.removeAll();let i=0;for(const r of e)r!=null&&(i=this._processCollection(i,r));this.splice(i,this.length)}_createNewInstance(e){return new Ee(e)}_processCollection(e,i){if(!i)return e;const r=this.itemFilterFunction??(s=>!!s);for(const s of i)if(s){if(r(s)){const n=this.indexOf(s,e);n>=0?n!==e&&this.reorder(s,e):this.add(s,e),++e}if(this.getChildrenFunction){const n=this.getChildrenFunction(s);if(Array.isArray(n))for(const o of n)e=this._processCollection(e,o);else e=this._processCollection(e,n)}}return e}};u([p()],dE.prototype,"getCollections",void 0),u([p()],dE.prototype,"getChildrenFunction",void 0),u([p()],dE.prototype,"itemFilterFunction",void 0),dE=u([A("esri.core.CollectionFlattener")],dE);const h$=dE;let Hz=class{constructor(e=i=>i.values().next().value){this._peeker=e,this._observable=new rD,this._items=new Set}get length(){return It(this._observable),this._items.size}clear(){this.length!==0&&(this._items.clear(),this._observable.notify())}last(){if(this.length===0)return;let e;for(e of this._items);return e}peek(){if(this.length!==0)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(e){return It(this._observable),this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const i=this.length;return this._items.forEach(r=>{e(r)||this._items.delete(r)}),i!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){It(this._observable),yield*this._items}};const eTe=new FinalizationRegistry(t=>{t.close()});function PHe(t,e){eTe.register(t,e,e)}function DHe(t){eTe.unregister(t)}function tTe(t,e){return new Proxy({},{get:(i,r,s)=>(...n)=>{let o,a;const l=n[n.length-1];return LHe(l)&&(o=l.signal,a=l.transferList,n.pop()),t.apply(e?`${e}.${r.toString()}`:r.toString(),n,{transferList:a,signal:o})}})}function LHe(t){return typeof t=="object"&&!Array.isArray(t)&&t!=null&&("signal"in t||"transferList"in t||Object.keys(t).length===0)}const NHe={statsWorker:()=>V(()=>import("./statsWorker-DH4X2Rqh.js"),__vite__mapDeps([4,5,6,7,8])),geometryEngineWorker:()=>V(()=>import("./geometryEngineWorker-BG_WtZnW.js"),__vite__mapDeps([9,10,11,3,12])),arcadeGeometryOperatorsWorker:()=>V(()=>import("./operatorsWorker-CR51DvjX.js"),[]),CSVSourceWorker:()=>V(()=>import("./CSVSourceWorker-CAMudcED.js"),__vite__mapDeps([13,14,12,15,16,17,18,19,20,21,22,5,6,7,8,23,24,25,26,27,28,29])),EdgeProcessingWorker:()=>V(()=>import("./EdgeProcessingWorker-B5RJYhoT.js"),__vite__mapDeps([30,31,32,33])),ElevationSamplerWorker:()=>V(()=>import("./ElevationSamplerWorker-DgedOdFf.js"),__vite__mapDeps([34,26,35,36])),FeatureServiceSnappingSourceWorker:()=>V(()=>import("./FeatureServiceSnappingSourceWorker-CnFjUQhc.js"),__vite__mapDeps([37,15,16,12,17,18,19,20,21,22,5,6,7,8,23,24,25,26,27,38,39,40,41])),GeoJSONSourceWorker:()=>V(()=>import("./GeoJSONSourceWorker-C41dZDI4.js"),__vite__mapDeps([42,15,16,12,17,18,19,20,21,22,5,6,7,8,23,24,25,26,27,43,14,29,44])),LercWorker:()=>V(()=>import("./LercWorker-DBXXUtJl.js"),[]),MemorySourceWorker:()=>V(()=>import("./MemorySourceWorker-Ce3bx_WM.js"),__vite__mapDeps([45,46,15,16,12,17,18,19,20,21,22,5,6,7,8,23,24,25,26,27,29,44,14])),PBFDecoderWorker:()=>V(()=>import("./PBFDecoderWorker-BcnW-rC8.js"),__vite__mapDeps([47,39,40])),FeaturePipelineWorker:()=>V(()=>import("./FeaturePipelineWorker-CqHh9MOF.js"),__vite__mapDeps([48,49,50,51,52,16,12,21,20,53,54,55,56,57,58,59,60,61,62,63,64,27,17,18,19,22,5,6,7,8,23,65,66,67,68,41,39,40,69,43,14,29,44,70,71,72,73])),PointCloudWorker:()=>V(()=>import("./PointCloudWorker-CX2oTPQ_.js"),__vite__mapDeps([74,75,76,77])),RasterWorker:()=>V(()=>import("./RasterWorker-ZPK6CDTD.js"),__vite__mapDeps([78,79,80,81,3,82,83,84])),SceneLayerSnappingSourceWorker:()=>V(()=>import("./SceneLayerSnappingSourceWorker-4dFtKhhK.js"),__vite__mapDeps([85,33,32])),SceneLayerWorker:()=>V(()=>import("./SceneLayerWorker-D82C_ofm.js").then(t=>t.b),__vite__mapDeps([86,87,88,77])),WFSSourceWorker:()=>V(()=>import("./WFSSourceWorker-B8qvI_Eh.js"),__vite__mapDeps([89,15,16,12,17,18,19,20,21,22,5,6,7,8,23,24,25,26,27,43,14,44,90,91])),WorkerTileHandler:()=>V(()=>import("./WorkerTileHandler-BWksXoyQ.js"),__vite__mapDeps([92,56,40,61,93,94,54])),Lyr3DWorker:()=>V(()=>import("./Lyr3DWorker-BhK8LRgR.js"),__vite__mapDeps([95,96,97])),Feature3DPipelineWorker:()=>V(()=>import("./Feature3DPipelineWorker-ZwOP-49X.js"),__vite__mapDeps([98,17,18,19,20,21,16,12,22,5,6,7,8,23,26,41,39,40,99,100])),TextureCompressionWorker:()=>V(()=>import("./TextureCompressionWorker-BJcDV2fQ.js"),[])},iTe="worker:port-closed";var ma;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(ma||(ma={}));let FHe=0;function rTe(){return FHe++}function kHe(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function PP(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function _te(t,e,i,r){if(e.type===ma.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==ma.INVOKE&&e.type!==ma.RESPONSE)return void t.postMessage(e);let s;if(kHe(i)?(s=Vle(i.transferList),e.data=i.result):(s=Vle(r),e.data=i),s){if(X("ff")){for(const n of s)if("byteLength"in n&&n.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case ma.INVOKE:throw o;case ma.RESPONSE:return void _te(t,{type:ma.RESPONSE,jobId:e.jobId,error:PP(o)})}}}t.postMessage(e,s)}else t.postMessage(e)}function DP(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function Vle(t){if(!t?.length)return null;if(X("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(i=>!zHe(i));return e.length?e:null}function zHe(t){return t instanceof ArrayBuffer||t?.constructor?.name==="ArrayBuffer"}async function R8t(t){try{return await t}catch(e){const i=e?.name===iTe;if(!(Xr(e)||i))throw e;return}}const{CLOSE:jle,ABORT:Gle,INVOKE:Hle,RESPONSE:XA,OPEN_PORT:qle,ON:UHe}=ma,BHe=2;let VHe=class{constructor(e){this._invoke=e,this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._timer=null,this._process=this._process.bind(this)}push(e){e.type===ma.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},bb=class pE{static connect(e,i){const r=new MessageChannel;let s;s=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const n=new pE(r.port1,{channel:r,client:s,schedule:i});return typeof s=="object"&&"remoteClient"in s&&(s.remoteClient=n),pE.clients.set(n,s),r.port2}static loadWorker(e){const i=NHe[e];return i?i():Promise.resolve(null)}constructor(e,i,r){this._port=e,this._jobQueue=r,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new VHe(s=>this._onInvokeMessage(s)),this._client=i.client,this._onMessage=this._onMessage.bind(this),this._channel=i.channel,this._schedule=i.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:jle}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,i,r){return this.apply(e,[i],r)}apply(e,i,r){const s=r?.signal,n=r?.transferList;if(!this._port)return Promise.reject(new U(iTe,`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:i}));const o=rTe();return new Promise((a,l)=>{if(wa(s))return this._processWork(),void l(vi());const c=Xo(s,()=>{const d=this._outJobs.get(o);d&&(this._outJobs.delete(o),this._processWork(),Hi(d.abortHandle),this._post({type:Gle,jobId:o}),l(vi()))}),h={resolve:a,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(o,h),this._post({type:Hle,jobId:o,methodName:e,abortable:s!=null},i,n)})}createInvokeProxy(e){return tTe(this,e)}on(e,i){const r=new MessageChannel;function s(n){i(n.data)}return this._port.postMessage({type:ma.ON,eventType:e,port:r.port2},[r.port2]),r.port1.addEventListener("message",s),r.port1.start(),$i(()=>{r.port1.postMessage({type:ma.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",s)})}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:qle,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=BHe)return;const e=this._jobQueue?.pop();if(!e)return;const{methodName:i,data:r,invokeOptions:s,resolver:n}=e;this.apply(i,r,s).then(o=>n.resolve(o)).catch(o=>n.reject(o))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{Hi(e.abortHandle),e.reject(vi(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){this._schedule!=null?this._schedule(()=>this._processMessage(e,!0)):this._processMessage(e,!1)}_processMessage(e,i){const r=DP(e);if(r)switch(r.type){case XA:this._onResponseMessage(r);break;case Hle:i?this._onInvokeMessage(r):this._invokeQueue.push(r);break;case Gle:this._onAbortMessage(r);break;case jle:this._onCloseMessage();break;case qle:this._onOpenPortMessage(r);break;case UHe:this._onOnMessage(r)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,s=i.get(r);this._invokeQueue.push(e),s&&(s.controller&&s.controller.abort(),i.delete(r))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&pE.clients.get(this)===e&&e.destroy(),pE.clients.delete(this),e?.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:i,jobId:r,data:s=[],abortable:n}=e,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,h=c[i];try{if(!h&&i&&i.includes(".")){const d=i.split(".");for(let f=0;f<d.length-1;f++)c=c[d[f]],h=c[d[f+1]]}if(typeof h!="function")throw new TypeError(`${i} is not a function`);s.push({client:this,signal:o?o.signal:null}),l=h.apply(c,s)}catch(d){return void this._post({type:XA,jobId:r,error:PP(d)})}nu(l)?(a.set(r,{controller:o,promise:l}),l.then(d=>{a.has(r)&&(a.delete(r),this._post({type:XA,jobId:r},d))},d=>{a.has(r)&&(a.delete(r),Xr(d)||this._post({type:XA,jobId:r,error:PP(d||{message:`Error encountered at method ${i}`})}))})):this._post({type:XA,jobId:r},l)}_onOpenPortMessage(e){new pE(e.port,{client:this._client})}_onOnMessage(e){const{port:i}=e,r=this._client.on(e.eventType,n=>{i.postMessage(n)}),s=fA(e.port,"message",n=>{DP(n)?.type===ma.CLOSE&&(s.remove(),r.remove(),i.close())})}_onResponseMessage(e){const{jobId:i,error:r,data:s}=e,n=this._outJobs;if(!n.has(i))return;const o=n.get(i);n.delete(i),this._processWork(),Hi(o.abortHandle),r?o.reject(U.fromJSON(JSON.parse(r))):o.resolve(s)}_post(e,i,r){return _te(this._port,e,i,r)}};bb.kernelInfo={buildDate:jxe,fullVersion:Zee,revision:Gxe},bb.clients=new Map;let jHe=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new Hz}destroy(){this.close()}get closed(){return!this._clients?.length}open(e,i){return new Promise((r,s)=>{let n=!0;const o=a=>{gt(i.signal),n&&(n=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const l=e[a];nu(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new bb(c,i,this._ongoingJobsQueue),o(r),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new bb(l,i,this._ongoingJobsQueue),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(r))}})}broadcast(e,i,r){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a?.invoke(e,i,r))}return s}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(vi(`Worker closing, aborting job calling '${e.methodName}'`));for(const i of this._clientPromises)i.then(r=>r?.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,DHe(this)}invoke(e,i,r){return this.apply(e,[i],r)}apply(e,i,r){const s=Qo();this._ongoingJobsQueue.push({methodName:e,data:i,invokeOptions:r,resolver:s});for(let n=0;n<this._clientPromises.length;n++){const o=this._clients[n];o?o.jobAdded():this._clientPromises[n].then(a=>a?.jobAdded())}return s.promise}createInvokeProxy(e){return tTe(this,e)}on(e,i){return Promise.all(this._clientPromises).then(()=>q3(this._clients.map(r=>r.on(e,i))))}openPorts(){return new Promise(e=>{const i=new Array(this._clientPromises.length);let r=i.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{n&&(i[s]=n.openPort()),--r==0&&e(i)})})}get test(){}};const GHe={async request(t,e){const i=t.options,r=i.responseType;i.signal=e?.signal,i.responseType=r==="native"||r==="native-request-init"?"native-request-init":r&&["blob","json","text"].includes(r)&&g7(t.url)?.after?r:"array-buffer";const s=await Ci(t.url,i),n={data:s.data,httpStatus:s.httpStatus,ssl:s.ssl};switch(s.requestOptions?.responseType){case"native-request-init":return delete n.data.signal,n;case"blob":n.data=await n.data.arrayBuffer();break;case"json":n.data=new TextEncoder().encode(JSON.stringify(n.data)).buffer;break;case"text":n.data=new TextEncoder().encode(n.data).buffer}return{result:n,transferList:[n.data]}}};let pR;const HHe=globalThis.esriConfig?.locale??globalThis.dojoConfig?.locale,G7=globalThis.document?.documentElement;function sTe(){const t=G7?.getAttribute("lang"),e=globalThis.navigator?.language;return HHe??t??e??"en"}function Xc(){return pR===void 0&&(pR=sTe()),pR}function L8t(t=Xc()){return/^([a-zA-Z]{2,3})(?:[_-][a-zA-Z0-9]+)*$/.exec(t)?.[1].toLowerCase()}const Dk=[];function nTe(t){return Dk.push(t),$i(()=>Dk.splice(Dk.indexOf(t),1))}const Lk=[];function bte(t){return Lk.push(t),$i(()=>Lk.splice(Lk.indexOf(t),1))}function Wle(){const t=sTe();pR!==t&&([...Lk].forEach(e=>e(t)),pR=t,[...Dk].forEach(e=>e(t)))}globalThis.addEventListener?.("languagechange",Wle),G7&&new MutationObserver(()=>{Wle()}).observe(G7,{attributeFilter:["lang"]});const cf="system",eS="unknown",wb="UTC",qHe=Intl.DateTimeFormat().resolvedOptions().timeZone,Zle=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Bishkek"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);class $S extends Error{}class WHe extends $S{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class ZHe extends $S{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class YHe extends $S{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class R2 extends $S{}class oTe extends $S{constructor(e){super(`Invalid unit ${e}`)}}class ml extends $S{}class Yv extends $S{constructor(){super("Zone is an abstract class")}}const Ye="numeric",uf="short",Qu="long",qz={year:Ye,month:Ye,day:Ye},aTe={year:Ye,month:uf,day:Ye},JHe={year:Ye,month:uf,day:Ye,weekday:uf},lTe={year:Ye,month:Qu,day:Ye},cTe={year:Ye,month:Qu,day:Ye,weekday:Qu},uTe={hour:Ye,minute:Ye},hTe={hour:Ye,minute:Ye,second:Ye},dTe={hour:Ye,minute:Ye,second:Ye,timeZoneName:uf},pTe={hour:Ye,minute:Ye,second:Ye,timeZoneName:Qu},fTe={hour:Ye,minute:Ye,hourCycle:"h23"},mTe={hour:Ye,minute:Ye,second:Ye,hourCycle:"h23"},gTe={hour:Ye,minute:Ye,second:Ye,hourCycle:"h23",timeZoneName:uf},yTe={hour:Ye,minute:Ye,second:Ye,hourCycle:"h23",timeZoneName:Qu},vTe={year:Ye,month:Ye,day:Ye,hour:Ye,minute:Ye},_Te={year:Ye,month:Ye,day:Ye,hour:Ye,minute:Ye,second:Ye},bTe={year:Ye,month:uf,day:Ye,hour:Ye,minute:Ye},wTe={year:Ye,month:uf,day:Ye,hour:Ye,minute:Ye,second:Ye},XHe={year:Ye,month:uf,day:Ye,weekday:uf,hour:Ye,minute:Ye},xTe={year:Ye,month:Qu,day:Ye,hour:Ye,minute:Ye,timeZoneName:uf},STe={year:Ye,month:Qu,day:Ye,hour:Ye,minute:Ye,second:Ye,timeZoneName:uf},TTe={year:Ye,month:Qu,day:Ye,weekday:Qu,hour:Ye,minute:Ye,timeZoneName:Qu},ETe={year:Ye,month:Qu,day:Ye,weekday:Qu,hour:Ye,minute:Ye,second:Ye,timeZoneName:Qu};class AS{get type(){throw new Yv}get name(){throw new Yv}get ianaName(){return this.name}get isUniversal(){throw new Yv}offsetName(e,i){throw new Yv}formatOffset(e,i){throw new Yv}offset(e){throw new Yv}equals(e){throw new Yv}get isValid(){throw new Yv}}let _6=null;class MV extends AS{static get instance(){return _6===null&&(_6=new MV),_6}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return DTe(e,i,r)}formatOffset(e,i){return fR(this.offset(e),i)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let Nk={};function KHe(t){return Nk[t]||(Nk[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),Nk[t]}const QHe={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function e8e(t,e){const i=t.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(i),[,s,n,o,a,l,c,h]=r;return[o,s,n,a,l,c,h]}function t8e(t,e){const i=t.formatToParts(e),r=[];for(let s=0;s<i.length;s++){const{type:n,value:o}=i[s],a=QHe[n];n==="era"?r[a]=o:mi(a)||(r[a]=parseInt(o,10))}return r}let _L={};class iu extends AS{static create(e){return _L[e]||(_L[e]=new iu(e)),_L[e]}static resetCache(){_L={},Nk={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=iu.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return DTe(e,i,r,this.name)}formatOffset(e,i){return fR(this.offset(e),i)}offset(e){const i=new Date(e);if(isNaN(i))return NaN;const r=KHe(this.name);let[s,n,o,a,l,c,h]=r.formatToParts?t8e(r,i):e8e(r,i);a==="BC"&&(s=-Math.abs(s)+1);const f=IV({year:s,month:n,day:o,hour:l===24?0:l,minute:c,second:h,millisecond:0});let m=+i;const y=m%1e3;return m-=y>=0?y:1e3+y,(f-m)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let Yle={};function i8e(t,e={}){const i=JSON.stringify([t,e]);let r=Yle[i];return r||(r=new Intl.ListFormat(t,e),Yle[i]=r),r}let H7={};function q7(t,e={}){const i=JSON.stringify([t,e]);let r=H7[i];return r||(r=new Intl.DateTimeFormat(t,e),H7[i]=r),r}let W7={};function r8e(t,e={}){const i=JSON.stringify([t,e]);let r=W7[i];return r||(r=new Intl.NumberFormat(t,e),W7[i]=r),r}let Z7={};function s8e(t,e={}){const{base:i,...r}=e,s=JSON.stringify([t,r]);let n=Z7[s];return n||(n=new Intl.RelativeTimeFormat(t,e),Z7[s]=n),n}let dO=null;function n8e(){return dO||(dO=new Intl.DateTimeFormat().resolvedOptions().locale,dO)}let Jle={};function o8e(t){let e=Jle[t];if(!e){const i=new Intl.Locale(t);e="getWeekInfo"in i?i.getWeekInfo():i.weekInfo,Jle[t]=e}return e}function a8e(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const i=t.indexOf("-u-");if(i===-1)return[t];{let r,s;try{r=q7(t).resolvedOptions(),s=t}catch{const l=t.substring(0,i);r=q7(l).resolvedOptions(),s=l}const{numberingSystem:n,calendar:o}=r;return[s,n,o]}}function l8e(t,e,i){return(i||e)&&(t.includes("-u-")||(t+="-u"),i&&(t+=`-ca-${i}`),e&&(t+=`-nu-${e}`)),t}function c8e(t){const e=[];for(let i=1;i<=12;i++){const r=yt.utc(2009,i,1);e.push(t(r))}return e}function u8e(t){const e=[];for(let i=1;i<=7;i++){const r=yt.utc(2016,11,13+i);e.push(t(r))}return e}function bL(t,e,i,r){const s=t.listingMode();return s==="error"?null:s==="en"?i(e):r(e)}function h8e(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class d8e{constructor(e,i,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const{padTo:s,floor:n,...o}=r;if(!i||Object.keys(o).length>0){const a={useGrouping:!1,...r};r.padTo>0&&(a.minimumIntegerDigits=r.padTo),this.inf=r8e(e,a)}}format(e){if(this.inf){const i=this.floor?Math.floor(e):e;return this.inf.format(i)}else{const i=this.floor?Math.floor(e):Ete(e,3);return yo(i,this.padTo)}}}class p8e{constructor(e,i,r){this.opts=r,this.originalZone=void 0;let s;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const o=-1*(e.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;e.offset!==0&&iu.create(a).valid?(s=a,this.dt=e):(s="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,s=e.zone.name):(s="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const n={...this.opts};n.timeZone=n.timeZone||s,this.dtf=q7(i,n)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(i=>{if(i.type==="timeZoneName"){const r=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...i,value:r}}else return i}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class f8e{constructor(e,i,r){this.opts={style:"long",...r},!i&&RTe()&&(this.rtf=s8e(e,r))}format(e,i){return this.rtf?this.rtf.format(e,i):F8e(i,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,i){return this.rtf?this.rtf.formatToParts(e,i):[]}}const m8e={firstDay:1,minimalDays:4,weekend:[6,7]};class Wr{static fromOpts(e){return Wr.create(e.locale,e.numberingSystem,e.outputCalendar,e.weekSettings,e.defaultToEN)}static create(e,i,r,s,n=!1){const o=e||On.defaultLocale,a=o||(n?"en-US":n8e()),l=i||On.defaultNumberingSystem,c=r||On.defaultOutputCalendar,h=Y7(s)||On.defaultWeekSettings;return new Wr(a,l,c,h,o)}static resetCache(){dO=null,H7={},W7={},Z7={}}static fromObject({locale:e,numberingSystem:i,outputCalendar:r,weekSettings:s}={}){return Wr.create(e,i,r,s)}constructor(e,i,r,s,n){const[o,a,l]=a8e(e);this.locale=o,this.numberingSystem=i||a||null,this.outputCalendar=r||l||null,this.weekSettings=s,this.intl=l8e(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=n,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=h8e(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),i=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&i?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:Wr.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,Y7(e.weekSettings)||this.weekSettings,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,i=!1){return bL(this,e,FTe,()=>{const r=i?{month:e,day:"numeric"}:{month:e},s=i?"format":"standalone";return this.monthsCache[s][e]||(this.monthsCache[s][e]=c8e(n=>this.extract(n,r,"month"))),this.monthsCache[s][e]})}weekdays(e,i=!1){return bL(this,e,UTe,()=>{const r=i?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},s=i?"format":"standalone";return this.weekdaysCache[s][e]||(this.weekdaysCache[s][e]=u8e(n=>this.extract(n,r,"weekday"))),this.weekdaysCache[s][e]})}meridiems(){return bL(this,void 0,()=>BTe,()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[yt.utc(2016,11,13,9),yt.utc(2016,11,13,19)].map(i=>this.extract(i,e,"dayperiod"))}return this.meridiemCache})}eras(e){return bL(this,e,VTe,()=>{const i={era:e};return this.eraCache[e]||(this.eraCache[e]=[yt.utc(-40,1,1),yt.utc(2017,1,1)].map(r=>this.extract(r,i,"era"))),this.eraCache[e]})}extract(e,i,r){const s=this.dtFormatter(e,i),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===r);return o?o.value:null}numberFormatter(e={}){return new d8e(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,i={}){return new p8e(e,this.intl,i)}relFormatter(e={}){return new f8e(this.intl,this.isEnglish(),e)}listFormatter(e={}){return i8e(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:PTe()?o8e(this.locale):m8e}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}toString(){return`Locale(${this.locale}, ${this.numberingSystem}, ${this.outputCalendar})`}}let b6=null;class ba extends AS{static get utcInstance(){return b6===null&&(b6=new ba(0)),b6}static instance(e){return e===0?ba.utcInstance:new ba(e)}static parseSpecifier(e){if(e){const i=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(i)return new ba(RV(i[1],i[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${fR(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${fR(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,i){return fR(this.fixed,i)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class g8e extends AS{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function A_(t,e){if(mi(t)||t===null)return e;if(t instanceof AS)return t;if(x8e(t)){const i=t.toLowerCase();return i==="default"?e:i==="local"||i==="system"?MV.instance:i==="utc"||i==="gmt"?ba.utcInstance:ba.parseSpecifier(i)||iu.create(t)}else return ob(t)?ba.instance(t):typeof t=="object"&&"offset"in t&&typeof t.offset=="function"?t:new g8e(t)}const wte={arab:"[٠-٩]",arabext:"[۰-۹]",bali:"[᭐-᭙]",beng:"[০-৯]",deva:"[०-९]",fullwide:"[０-９]",gujr:"[૦-૯]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[០-៩]",knda:"[೦-೯]",laoo:"[໐-໙]",limb:"[᥆-᥏]",mlym:"[൦-൯]",mong:"[᠐-᠙]",mymr:"[၀-၉]",orya:"[୦-୯]",tamldec:"[௦-௯]",telu:"[౦-౯]",thai:"[๐-๙]",tibt:"[༠-༩]",latn:"\\d"},Xle={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},y8e=wte.hanidec.replace(/[\[|\]]/g,"").split("");function v8e(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);if(t[i].search(wte.hanidec)!==-1)e+=y8e.indexOf(t[i]);else for(const s in Xle){const[n,o]=Xle[s];r>=n&&r<=o&&(e+=r-n)}}return parseInt(e,10)}else return e}let fE={};function _8e(){fE={}}function jd({numberingSystem:t},e=""){const i=t||"latn";return fE[i]||(fE[i]={}),fE[i][e]||(fE[i][e]=new RegExp(`${wte[i]}${e}`)),fE[i][e]}let Kle=()=>Date.now(),Qle="system",ece=null,tce=null,ice=null,rce=60,sce,nce=null;class On{static get now(){return Kle}static set now(e){Kle=e}static set defaultZone(e){Qle=e}static get defaultZone(){return A_(Qle,MV.instance)}static get defaultLocale(){return ece}static set defaultLocale(e){ece=e}static get defaultNumberingSystem(){return tce}static set defaultNumberingSystem(e){tce=e}static get defaultOutputCalendar(){return ice}static set defaultOutputCalendar(e){ice=e}static get defaultWeekSettings(){return nce}static set defaultWeekSettings(e){nce=Y7(e)}static get twoDigitCutoffYear(){return rce}static set twoDigitCutoffYear(e){rce=e%100}static get throwOnInvalid(){return sce}static set throwOnInvalid(e){sce=e}static resetCaches(){Wr.resetCache(),iu.resetCache(),yt.resetCache(),_8e()}}class qp{constructor(e,i){this.reason=e,this.explanation=i}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const CTe=[0,31,59,90,120,151,181,212,243,273,304,334],$Te=[0,31,60,91,121,152,182,213,244,274,305,335];function md(t,e){return new qp("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function xte(t,e,i){const r=new Date(Date.UTC(t,e-1,i));t<100&&t>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const s=r.getUTCDay();return s===0?7:s}function ATe(t,e,i){return i+(sD(t)?$Te:CTe)[e-1]}function MTe(t,e){const i=sD(t)?$Te:CTe,r=i.findIndex(n=>n<e),s=e-i[r];return{month:r+1,day:s}}function Ste(t,e){return(t-e+7)%7+1}function Wz(t,e=4,i=1){const{year:r,month:s,day:n}=t,o=ATe(r,s,n),a=Ste(xte(r,s,n),i);let l=Math.floor((o-a+14-e)/7),c;return l<1?(c=r-1,l=LP(c,e,i)):l>LP(r,e,i)?(c=r+1,l=1):c=r,{weekYear:c,weekNumber:l,weekday:a,...PV(t)}}function oce(t,e=4,i=1){const{weekYear:r,weekNumber:s,weekday:n}=t,o=Ste(xte(r,1,e),i),a=_C(r);let l=s*7+n-o-7+e,c;l<1?(c=r-1,l+=_C(c)):l>a?(c=r+1,l-=_C(r)):c=r;const{month:h,day:d}=MTe(c,l);return{year:c,month:h,day:d,...PV(t)}}function w6(t){const{year:e,month:i,day:r}=t,s=ATe(e,i,r);return{year:e,ordinal:s,...PV(t)}}function ace(t){const{year:e,ordinal:i}=t,{month:r,day:s}=MTe(e,i);return{year:e,month:r,day:s,...PV(t)}}function lce(t,e){if(!mi(t.localWeekday)||!mi(t.localWeekNumber)||!mi(t.localWeekYear)){if(!mi(t.weekday)||!mi(t.weekNumber)||!mi(t.weekYear))throw new R2("Cannot mix locale-based week fields with ISO-based week fields");return mi(t.localWeekday)||(t.weekday=t.localWeekday),mi(t.localWeekNumber)||(t.weekNumber=t.localWeekNumber),mi(t.localWeekYear)||(t.weekYear=t.localWeekYear),delete t.localWeekday,delete t.localWeekNumber,delete t.localWeekYear,{minDaysInFirstWeek:e.getMinDaysInFirstWeek(),startOfWeek:e.getStartOfWeek()}}else return{minDaysInFirstWeek:4,startOfWeek:1}}function b8e(t,e=4,i=1){const r=OV(t.weekYear),s=gd(t.weekNumber,1,LP(t.weekYear,e,i)),n=gd(t.weekday,1,7);return r?s?n?!1:md("weekday",t.weekday):md("week",t.weekNumber):md("weekYear",t.weekYear)}function w8e(t){const e=OV(t.year),i=gd(t.ordinal,1,_C(t.year));return e?i?!1:md("ordinal",t.ordinal):md("year",t.year)}function OTe(t){const e=OV(t.year),i=gd(t.month,1,12),r=gd(t.day,1,Zz(t.year,t.month));return e?i?r?!1:md("day",t.day):md("month",t.month):md("year",t.year)}function ITe(t){const{hour:e,minute:i,second:r,millisecond:s}=t,n=gd(e,0,23)||e===24&&i===0&&r===0&&s===0,o=gd(i,0,59),a=gd(r,0,59),l=gd(s,0,999);return n?o?a?l?!1:md("millisecond",s):md("second",r):md("minute",i):md("hour",e)}function mi(t){return typeof t>"u"}function ob(t){return typeof t=="number"}function OV(t){return typeof t=="number"&&t%1===0}function x8e(t){return typeof t=="string"}function S8e(t){return Object.prototype.toString.call(t)==="[object Date]"}function RTe(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function PTe(){try{return typeof Intl<"u"&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch{return!1}}function T8e(t){return Array.isArray(t)?t:[t]}function cce(t,e,i){if(t.length!==0)return t.reduce((r,s)=>{const n=[e(s),s];return r&&i(r[0],n[0])===r[0]?r:n},null)[1]}function E8e(t,e){return e.reduce((i,r)=>(i[r]=t[r],i),{})}function d$(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Y7(t){if(t==null)return null;if(typeof t!="object")throw new ml("Week settings must be an object");if(!gd(t.firstDay,1,7)||!gd(t.minimalDays,1,7)||!Array.isArray(t.weekend)||t.weekend.some(e=>!gd(e,1,7)))throw new ml("Invalid week settings");return{firstDay:t.firstDay,minimalDays:t.minimalDays,weekend:Array.from(t.weekend)}}function gd(t,e,i){return OV(t)&&t>=e&&t<=i}function C8e(t,e){return t-e*Math.floor(t/e)}function yo(t,e=2){const i=t<0;let r;return i?r="-"+(""+-t).padStart(e,"0"):r=(""+t).padStart(e,"0"),r}function p_(t){if(!(mi(t)||t===null||t===""))return parseInt(t,10)}function ow(t){if(!(mi(t)||t===null||t===""))return parseFloat(t)}function Tte(t){if(!(mi(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function Ete(t,e,i=!1){const r=10**e;return(i?Math.trunc:Math.round)(t*r)/r}function sD(t){return t%4===0&&(t%100!==0||t%400===0)}function _C(t){return sD(t)?366:365}function Zz(t,e){const i=C8e(e-1,12)+1,r=t+(e-i)/12;return i===2?sD(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function IV(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(t.year,t.month-1,t.day)),+e}function uce(t,e,i){return-Ste(xte(t,1,e),i)+e-1}function LP(t,e=4,i=1){const r=uce(t,e,i),s=uce(t+1,e,i);return(_C(t)-r+s)/7}function J7(t){return t>99?t:t>On.twoDigitCutoffYear?1900+t:2e3+t}function DTe(t,e,i,r=null){const s=new Date(t),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(n.timeZone=r);const o={timeZoneName:e,...n},a=new Intl.DateTimeFormat(i,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function RV(t,e){let i=parseInt(t,10);Number.isNaN(i)&&(i=0);const r=parseInt(e,10)||0,s=i<0||Object.is(i,-0)?-r:r;return i*60+s}function LTe(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new ml(`Invalid unit value ${t}`);return e}function Yz(t,e){const i={};for(const r in t)if(d$(t,r)){const s=t[r];if(s==null)continue;i[e(r)]=LTe(s)}return i}function fR(t,e){const i=Math.trunc(Math.abs(t/60)),r=Math.trunc(Math.abs(t%60)),s=t>=0?"+":"-";switch(e){case"short":return`${s}${yo(i,2)}:${yo(r,2)}`;case"narrow":return`${s}${i}${r>0?`:${r}`:""}`;case"techie":return`${s}${yo(i,2)}${yo(r,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function PV(t){return E8e(t,["hour","minute","second","millisecond"])}const $8e=["January","February","March","April","May","June","July","August","September","October","November","December"],NTe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],A8e=["J","F","M","A","M","J","J","A","S","O","N","D"];function FTe(t){switch(t){case"narrow":return[...A8e];case"short":return[...NTe];case"long":return[...$8e];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const kTe=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],zTe=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],M8e=["M","T","W","T","F","S","S"];function UTe(t){switch(t){case"narrow":return[...M8e];case"short":return[...zTe];case"long":return[...kTe];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const BTe=["AM","PM"],O8e=["Before Christ","Anno Domini"],I8e=["BC","AD"],R8e=["B","A"];function VTe(t){switch(t){case"narrow":return[...R8e];case"short":return[...I8e];case"long":return[...O8e];default:return null}}function P8e(t){return BTe[t.hour<12?0:1]}function D8e(t,e){return UTe(e)[t.weekday-1]}function L8e(t,e){return FTe(e)[t.month-1]}function N8e(t,e){return VTe(e)[t.year<0?0:1]}function F8e(t,e,i="always",r=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(t)===-1;if(i==="auto"&&n){const d=t==="days";switch(e){case 1:return d?"tomorrow":`next ${s[t][0]}`;case-1:return d?"yesterday":`last ${s[t][0]}`;case 0:return d?"today":`this ${s[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=s[t],h=r?l?c[1]:c[2]||c[1]:l?s[t][0]:t;return o?`${a} ${h} ago`:`in ${a} ${h}`}function hce(t,e){let i="";for(const r of t)r.literal?i+=r.val:i+=e(r.val);return i}const k8e={D:qz,DD:aTe,DDD:lTe,DDDD:cTe,t:uTe,tt:hTe,ttt:dTe,tttt:pTe,T:fTe,TT:mTe,TTT:gTe,TTTT:yTe,f:vTe,ff:bTe,fff:xTe,ffff:TTe,F:_Te,FF:wTe,FFF:STe,FFFF:ETe};class bl{static create(e,i={}){return new bl(e,i)}static parseFormat(e){let i=null,r="",s=!1;const n=[];for(let o=0;o<e.length;o++){const a=e.charAt(o);a==="'"?(r.length>0&&n.push({literal:s||/^\s+$/.test(r),val:r}),i=null,r="",s=!s):s||a===i?r+=a:(r.length>0&&n.push({literal:/^\s+$/.test(r),val:r}),r=a,i=a)}return r.length>0&&n.push({literal:s||/^\s+$/.test(r),val:r}),n}static macroTokenToFormatOpts(e){return k8e[e]}constructor(e,i){this.opts=i,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,i){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...i}).format()}dtFormatter(e,i={}){return this.loc.dtFormatter(e,{...this.opts,...i})}formatDateTime(e,i){return this.dtFormatter(e,i).format()}formatDateTimeParts(e,i){return this.dtFormatter(e,i).formatToParts()}formatInterval(e,i){return this.dtFormatter(e.start,i).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,i){return this.dtFormatter(e,i).resolvedOptions()}num(e,i=0){if(this.opts.forceSimple)return yo(e,i);const r={...this.opts};return i>0&&(r.padTo=i),this.loc.numberFormatter(r).format(e)}formatDateTimeFromString(e,i){const r=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(m,y)=>this.loc.extract(e,m,y),o=m=>e.isOffsetFixed&&e.offset===0&&m.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,m.format):"",a=()=>r?P8e(e):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(m,y)=>r?L8e(e,m):n(y?{month:m}:{month:m,day:"numeric"},"month"),c=(m,y)=>r?D8e(e,m):n(y?{weekday:m}:{weekday:m,month:"long",day:"numeric"},"weekday"),h=m=>{const y=bl.macroTokenToFormatOpts(m);return y?this.formatWithSystemDefault(e,y):m},d=m=>r?N8e(e,m):n({era:m},"era"),f=m=>{switch(m){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(e.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(e.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(e.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(e.year,6);case"G":return d("short");case"GG":return d("long");case"GGGGG":return d("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"n":return this.num(e.localWeekNumber);case"nn":return this.num(e.localWeekNumber,2);case"ii":return this.num(e.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(e.localWeekYear,4);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return h(m)}};return hce(bl.parseFormat(i),f)}formatDurationFromString(e,i){const r=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const h=r(c);return h?this.num(l.get(h),c.length):c},n=bl.parseFormat(i),o=n.reduce((l,{literal:c,val:h})=>c?l:l.concat(h),[]),a=e.shiftTo(...o.map(r).filter(l=>l));return hce(n,s(a))}}const jTe=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function wA(...t){const e=t.reduce((i,r)=>i+r.source,"");return RegExp(`^${e}$`)}function xA(...t){return e=>t.reduce(([i,r,s],n)=>{const[o,a,l]=n(e,s);return[{...i,...o},a||r,l]},[{},null,1]).slice(0,2)}function SA(t,...e){if(t==null)return[null,null];for(const[i,r]of e){const s=i.exec(t);if(s)return r(s)}return[null,null]}function GTe(...t){return(e,i)=>{const r={};let s;for(s=0;s<t.length;s++)r[t[s]]=p_(e[i+s]);return[r,null,i+s]}}const HTe=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,z8e=`(?:${HTe.source}?(?:\\[(${jTe.source})\\])?)?`,Cte=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,qTe=RegExp(`${Cte.source}${z8e}`),$te=RegExp(`(?:T${qTe.source})?`),U8e=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,B8e=/(\d{4})-?W(\d\d)(?:-?(\d))?/,V8e=/(\d{4})-?(\d{3})/,j8e=GTe("weekYear","weekNumber","weekDay"),G8e=GTe("year","ordinal"),H8e=/(\d{4})-(\d\d)-(\d\d)/,WTe=RegExp(`${Cte.source} ?(?:${HTe.source}|(${jTe.source}))?`),q8e=RegExp(`(?: ${WTe.source})?`);function bC(t,e,i){const r=t[e];return mi(r)?i:p_(r)}function W8e(t,e){return[{year:bC(t,e),month:bC(t,e+1,1),day:bC(t,e+2,1)},null,e+3]}function TA(t,e){return[{hours:bC(t,e,0),minutes:bC(t,e+1,0),seconds:bC(t,e+2,0),milliseconds:Tte(t[e+3])},null,e+4]}function nD(t,e){const i=!t[e]&&!t[e+1],r=RV(t[e+1],t[e+2]),s=i?null:ba.instance(r);return[{},s,e+3]}function oD(t,e){const i=t[e]?iu.create(t[e]):null;return[{},i,e+1]}const Z8e=RegExp(`^T?${Cte.source}$`),Y8e=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function J8e(t){const[e,i,r,s,n,o,a,l,c]=t,h=e[0]==="-",d=l&&l[0]==="-",f=(m,y=!1)=>m!==void 0&&(y||m&&h)?-m:m;return[{years:f(ow(i)),months:f(ow(r)),weeks:f(ow(s)),days:f(ow(n)),hours:f(ow(o)),minutes:f(ow(a)),seconds:f(ow(l),l==="-0"),milliseconds:f(Tte(c),d)}]}const X8e={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function Ate(t,e,i,r,s,n,o){const a={year:e.length===2?J7(p_(e)):p_(e),month:NTe.indexOf(i)+1,day:p_(r),hour:p_(s),minute:p_(n)};return o&&(a.second=p_(o)),t&&(a.weekday=t.length>3?kTe.indexOf(t)+1:zTe.indexOf(t)+1),a}const K8e=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function Q8e(t){const[,e,i,r,s,n,o,a,l,c,h,d]=t,f=Ate(e,s,r,i,n,o,a);let m;return l?m=X8e[l]:c?m=0:m=RV(h,d),[f,new ba(m)]}function eqe(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const tqe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,iqe=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,rqe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function dce(t){const[,e,i,r,s,n,o,a]=t;return[Ate(e,s,r,i,n,o,a),ba.utcInstance]}function sqe(t){const[,e,i,r,s,n,o,a]=t;return[Ate(e,a,i,r,s,n,o),ba.utcInstance]}const nqe=wA(U8e,$te),oqe=wA(B8e,$te),aqe=wA(V8e,$te),lqe=wA(qTe),ZTe=xA(W8e,TA,nD,oD),cqe=xA(j8e,TA,nD,oD),uqe=xA(G8e,TA,nD,oD),hqe=xA(TA,nD,oD);function dqe(t){return SA(t,[nqe,ZTe],[oqe,cqe],[aqe,uqe],[lqe,hqe])}function pqe(t){return SA(eqe(t),[K8e,Q8e])}function fqe(t){return SA(t,[tqe,dce],[iqe,dce],[rqe,sqe])}function mqe(t){return SA(t,[Y8e,J8e])}const gqe=xA(TA);function yqe(t){return SA(t,[Z8e,gqe])}const vqe=wA(H8e,q8e),_qe=wA(WTe),bqe=xA(TA,nD,oD);function wqe(t){return SA(t,[vqe,ZTe],[_qe,bqe])}const pce="Invalid Duration",YTe={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},xqe={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...YTe},mh=146097/400,iT=146097/4800,Sqe={years:{quarters:4,months:12,weeks:mh/7,days:mh,hours:mh*24,minutes:mh*24*60,seconds:mh*24*60*60,milliseconds:mh*24*60*60*1e3},quarters:{months:3,weeks:mh/28,days:mh/4,hours:mh*24/4,minutes:mh*24*60/4,seconds:mh*24*60*60/4,milliseconds:mh*24*60*60*1e3/4},months:{weeks:iT/7,days:iT,hours:iT*24,minutes:iT*24*60,seconds:iT*24*60*60,milliseconds:iT*24*60*60*1e3},...YTe},hx=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],Tqe=hx.slice(0).reverse();function Jv(t,e,i=!1){const r={values:i?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new Or(r)}function JTe(t,e){let i=e.milliseconds??0;for(const r of Tqe.slice(1))e[r]&&(i+=e[r]*t[r].milliseconds);return i}function fce(t,e){const i=JTe(t,e)<0?-1:1;hx.reduceRight((r,s)=>{if(mi(e[s]))return r;if(r){const n=e[r]*i,o=t[s][r],a=Math.floor(n/o);e[s]+=a*i,e[r]-=a*o*i}return s},null),hx.reduce((r,s)=>{if(mi(e[s]))return r;if(r){const n=e[r]%1;e[r]-=n,e[s]+=n*t[r][s]}return s},null)}function Eqe(t){const e={};for(const[i,r]of Object.entries(t))r!==0&&(e[i]=r);return e}class Or{constructor(e){const i=e.conversionAccuracy==="longterm"||!1;let r=i?Sqe:xqe;e.matrix&&(r=e.matrix),this.values=e.values,this.loc=e.loc||Wr.create(),this.conversionAccuracy=i?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=r,this.isLuxonDuration=!0}static fromMillis(e,i){return Or.fromObject({milliseconds:e},i)}static fromObject(e,i={}){if(e==null||typeof e!="object")throw new ml(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new Or({values:Yz(e,Or.normalizeUnit),loc:Wr.fromObject(i),conversionAccuracy:i.conversionAccuracy,matrix:i.matrix})}static fromDurationLike(e){if(ob(e))return Or.fromMillis(e);if(Or.isDuration(e))return e;if(typeof e=="object")return Or.fromObject(e);throw new ml(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,i){const[r]=mqe(e);return r?Or.fromObject(r,i):Or.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,i){const[r]=yqe(e);return r?Or.fromObject(r,i):Or.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,i=null){if(!e)throw new ml("need to specify a reason the Duration is invalid");const r=e instanceof qp?e:new qp(e,i);if(On.throwOnInvalid)throw new YHe(r);return new Or({invalid:r})}static normalizeUnit(e){const i={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!i)throw new oTe(e);return i}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,i={}){const r={...i,floor:i.round!==!1&&i.floor!==!1};return this.isValid?bl.create(this.loc,r).formatDurationFromString(this,e):pce}toHuman(e={}){if(!this.isValid)return pce;const i=hx.map(r=>{const s=this.values[r];return mi(s)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:r.slice(0,-1)}).format(s)}).filter(r=>r);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(i)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=Ete(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const i=this.toMillis();return i<0||i>=864e5?null:(e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1},yt.fromMillis(i,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Duration { values: ${JSON.stringify(this.values)} }`:`Duration { Invalid, reason: ${this.invalidReason} }`}toMillis(){return this.isValid?JTe(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const i=Or.fromDurationLike(e),r={};for(const s of hx)(d$(i.values,s)||d$(this.values,s))&&(r[s]=i.get(s)+this.get(s));return Jv(this,{values:r},!0)}minus(e){if(!this.isValid)return this;const i=Or.fromDurationLike(e);return this.plus(i.negate())}mapUnits(e){if(!this.isValid)return this;const i={};for(const r of Object.keys(this.values))i[r]=LTe(e(this.values[r],r));return Jv(this,{values:i},!0)}get(e){return this[Or.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const i={...this.values,...Yz(e,Or.normalizeUnit)};return Jv(this,{values:i})}reconfigure({locale:e,numberingSystem:i,conversionAccuracy:r,matrix:s}={}){const o={loc:this.loc.clone({locale:e,numberingSystem:i}),matrix:s,conversionAccuracy:r};return Jv(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return fce(this.matrix,e),Jv(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=Eqe(this.normalize().shiftToAll().toObject());return Jv(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(o=>Or.normalizeUnit(o));const i={},r={},s=this.toObject();let n;for(const o of hx)if(e.indexOf(o)>=0){n=o;let a=0;for(const c in r)a+=this.matrix[c][o]*r[c],r[c]=0;ob(s[o])&&(a+=s[o]);const l=Math.trunc(a);i[o]=l,r[o]=(a*1e3-l*1e3)/1e3}else ob(s[o])&&(r[o]=s[o]);for(const o in r)r[o]!==0&&(i[n]+=o===n?r[o]:r[o]/this.matrix[n][o]);return fce(this.matrix,i),Jv(this,{values:i},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const i of Object.keys(this.values))e[i]=this.values[i]===0?0:-this.values[i];return Jv(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function i(r,s){return r===void 0||r===0?s===void 0||s===0:r===s}for(const r of hx)if(!i(this.values[r],e.values[r]))return!1;return!0}}const rT="Invalid Interval";function Cqe(t,e){return!t||!t.isValid?$n.invalid("missing or invalid start"):!e||!e.isValid?$n.invalid("missing or invalid end"):e<t?$n.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class $n{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,i=null){if(!e)throw new ml("need to specify a reason the Interval is invalid");const r=e instanceof qp?e:new qp(e,i);if(On.throwOnInvalid)throw new ZHe(r);return new $n({invalid:r})}static fromDateTimes(e,i){const r=KA(e),s=KA(i),n=Cqe(r,s);return n??new $n({start:r,end:s})}static after(e,i){const r=Or.fromDurationLike(i),s=KA(e);return $n.fromDateTimes(s,s.plus(r))}static before(e,i){const r=Or.fromDurationLike(i),s=KA(e);return $n.fromDateTimes(s.minus(r),s)}static fromISO(e,i){const[r,s]=(e||"").split("/",2);if(r&&s){let n,o;try{n=yt.fromISO(r,i),o=n.isValid}catch{o=!1}let a,l;try{a=yt.fromISO(s,i),l=a.isValid}catch{l=!1}if(o&&l)return $n.fromDateTimes(n,a);if(o){const c=Or.fromISO(s,i);if(c.isValid)return $n.after(n,c)}else if(l){const c=Or.fromISO(r,i);if(c.isValid)return $n.before(a,c)}}return $n.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds",i){if(!this.isValid)return NaN;const r=this.start.startOf(e,i);let s;return i?.useLocaleWeeks?s=this.end.reconfigure({locale:r.locale}):s=this.end,s=s.startOf(e,i),Math.floor(s.diff(r,e).get(e))+(s.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:i}={}){return this.isValid?$n.fromDateTimes(e||this.s,i||this.e):this}splitAt(...e){if(!this.isValid)return[];const i=e.map(KA).filter(o=>this.contains(o)).sort((o,a)=>o.toMillis()-a.toMillis()),r=[];let{s}=this,n=0;for(;s<this.e;){const o=i[n]||this.e,a=+o>+this.e?this.e:o;r.push($n.fromDateTimes(s,a)),s=a,n+=1}return r}splitBy(e){const i=Or.fromDurationLike(e);if(!this.isValid||!i.isValid||i.as("milliseconds")===0)return[];let{s:r}=this,s=1,n;const o=[];for(;r<this.e;){const a=this.start.plus(i.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push($n.fromDateTimes(r,n)),r=n,s+=1}return o}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const i=this.s>e.s?this.s:e.s,r=this.e<e.e?this.e:e.e;return i>=r?null:$n.fromDateTimes(i,r)}union(e){if(!this.isValid)return this;const i=this.s<e.s?this.s:e.s,r=this.e>e.e?this.e:e.e;return $n.fromDateTimes(i,r)}static merge(e){const[i,r]=e.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return r&&i.push(r),i}static xor(e){let i=null,r=0;const s=[],n=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)r+=l.type==="s"?1:-1,r===1?i=l.time:(i&&+i!=+l.time&&s.push($n.fromDateTimes(i,l.time)),i=null);return $n.merge(s)}difference(...e){return $n.xor([this].concat(e)).map(i=>this.intersection(i)).filter(i=>i&&!i.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} – ${this.e.toISO()})`:rT}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Interval { start: ${this.s.toISO()}, end: ${this.e.toISO()} }`:`Interval { Invalid, reason: ${this.invalidReason} }`}toLocaleString(e=qz,i={}){return this.isValid?bl.create(this.s.loc.clone(i),e).formatInterval(this):rT}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:rT}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:rT}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:rT}toFormat(e,{separator:i=" – "}={}){return this.isValid?`${this.s.toFormat(e)}${i}${this.e.toFormat(e)}`:rT}toDuration(e,i){return this.isValid?this.e.diff(this.s,e,i):Or.invalid(this.invalidReason)}mapEndpoints(e){return $n.fromDateTimes(e(this.s),e(this.e))}}class wL{static hasDST(e=On.defaultZone){const i=yt.now().setZone(e).set({month:12});return!e.isUniversal&&i.offset!==i.set({month:6}).offset}static isValidIANAZone(e){return iu.isValidZone(e)}static normalizeZone(e){return A_(e,On.defaultZone)}static getStartOfWeek({locale:e=null,locObj:i=null}={}){return(i||Wr.create(e)).getStartOfWeek()}static getMinimumDaysInFirstWeek({locale:e=null,locObj:i=null}={}){return(i||Wr.create(e)).getMinDaysInFirstWeek()}static getWeekendWeekdays({locale:e=null,locObj:i=null}={}){return(i||Wr.create(e)).getWeekendDays().slice()}static months(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Wr.create(i,r,n)).months(e)}static monthsFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Wr.create(i,r,n)).months(e,!0)}static weekdays(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||Wr.create(i,r,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||Wr.create(i,r,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return Wr.create(e).meridiems()}static eras(e="short",{locale:i=null}={}){return Wr.create(i,null,"gregory").eras(e)}static features(){return{relative:RTe(),localeWeek:PTe()}}}function mce(t,e){const i=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=i(e)-i(t);return Math.floor(Or.fromMillis(r).as("days"))}function $qe(t,e,i){const r=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const h=mce(l,c);return(h-h%7)/7}],["days",mce]],s={},n=t;let o,a;for(const[l,c]of r)i.indexOf(l)>=0&&(o=l,s[l]=c(t,e),a=n.plus(s),a>e?(s[l]--,t=n.plus(s),t>e&&(a=t,s[l]--,t=n.plus(s))):t=a);return[t,s,a,o]}function Aqe(t,e,i,r){let[s,n,o,a]=$qe(t,e,i);const l=e-s,c=i.filter(d=>["hours","minutes","seconds","milliseconds"].indexOf(d)>=0);c.length===0&&(o<e&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const h=Or.fromObject(n,r);return c.length>0?Or.fromMillis(l,r).shiftTo(...c).plus(h):h}const Mqe="missing Intl.DateTimeFormat.formatToParts support";function zr(t,e=i=>i){return{regex:t,deser:([i])=>e(v8e(i))}}const Oqe=" ",XTe=`[ ${Oqe}]`,KTe=new RegExp(XTe,"g");function Iqe(t){return t.replace(/\./g,"\\.?").replace(KTe,XTe)}function gce(t){return t.replace(/\./g,"").replace(KTe," ").toLowerCase()}function Gd(t,e){return t===null?null:{regex:RegExp(t.map(Iqe).join("|")),deser:([i])=>t.findIndex(r=>gce(i)===gce(r))+e}}function yce(t,e){return{regex:t,deser:([,i,r])=>RV(i,r),groups:e}}function xL(t){return{regex:t,deser:([e])=>e}}function Rqe(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Pqe(t,e){const i=jd(e),r=jd(e,"{2}"),s=jd(e,"{3}"),n=jd(e,"{4}"),o=jd(e,"{6}"),a=jd(e,"{1,2}"),l=jd(e,"{1,3}"),c=jd(e,"{1,6}"),h=jd(e,"{1,9}"),d=jd(e,"{2,4}"),f=jd(e,"{4,6}"),m=_=>({regex:RegExp(Rqe(_.val)),deser:([b])=>b,literal:!0}),v=(_=>{if(t.literal)return m(_);switch(_.val){case"G":return Gd(e.eras("short"),0);case"GG":return Gd(e.eras("long"),0);case"y":return zr(c);case"yy":return zr(d,J7);case"yyyy":return zr(n);case"yyyyy":return zr(f);case"yyyyyy":return zr(o);case"M":return zr(a);case"MM":return zr(r);case"MMM":return Gd(e.months("short",!0),1);case"MMMM":return Gd(e.months("long",!0),1);case"L":return zr(a);case"LL":return zr(r);case"LLL":return Gd(e.months("short",!1),1);case"LLLL":return Gd(e.months("long",!1),1);case"d":return zr(a);case"dd":return zr(r);case"o":return zr(l);case"ooo":return zr(s);case"HH":return zr(r);case"H":return zr(a);case"hh":return zr(r);case"h":return zr(a);case"mm":return zr(r);case"m":return zr(a);case"q":return zr(a);case"qq":return zr(r);case"s":return zr(a);case"ss":return zr(r);case"S":return zr(l);case"SSS":return zr(s);case"u":return xL(h);case"uu":return xL(a);case"uuu":return zr(i);case"a":return Gd(e.meridiems(),0);case"kkkk":return zr(n);case"kk":return zr(d,J7);case"W":return zr(a);case"WW":return zr(r);case"E":case"c":return zr(i);case"EEE":return Gd(e.weekdays("short",!1),1);case"EEEE":return Gd(e.weekdays("long",!1),1);case"ccc":return Gd(e.weekdays("short",!0),1);case"cccc":return Gd(e.weekdays("long",!0),1);case"Z":case"ZZ":return yce(new RegExp(`([+-]${a.source})(?::(${r.source}))?`),2);case"ZZZ":return yce(new RegExp(`([+-]${a.source})(${r.source})?`),2);case"z":return xL(/[a-z_+-/]{1,256}?/i);case" ":return xL(/[^\S\n\r]/);default:return m(_)}})(t)||{invalidReason:Mqe};return v.token=t,v}const Dqe={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function Lqe(t,e,i){const{type:r,value:s}=t;if(r==="literal"){const l=/^\s+$/.test(s);return{literal:!l,val:l?" ":s}}const n=e[r];let o=r;r==="hour"&&(e.hour12!=null?o=e.hour12?"hour12":"hour24":e.hourCycle!=null?e.hourCycle==="h11"||e.hourCycle==="h12"?o="hour12":o="hour24":o=i.hour12?"hour12":"hour24");let a=Dqe[o];if(typeof a=="object"&&(a=a[n]),a)return{literal:!1,val:a}}function Nqe(t){return[`^${t.map(i=>i.regex).reduce((i,r)=>`${i}(${r.source})`,"")}$`,t]}function Fqe(t,e,i){const r=t.match(e);if(r){const s={};let n=1;for(const o in i)if(d$(i,o)){const a=i[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(r.slice(n,n+l))),n+=l}return[r,s]}else return[r,{}]}function kqe(t){const e=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let i=null,r;return mi(t.z)||(i=iu.create(t.z)),mi(t.Z)||(i||(i=new ba(t.Z)),r=t.Z),mi(t.q)||(t.M=(t.q-1)*3+1),mi(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),mi(t.u)||(t.S=Tte(t.u)),[Object.keys(t).reduce((n,o)=>{const a=e(o);return a&&(n[a]=t[o]),n},{}),i,r]}let x6=null;function zqe(){return x6||(x6=yt.fromMillis(1555555555555)),x6}function Uqe(t,e){if(t.literal)return t;const i=bl.macroTokenToFormatOpts(t.val),r=iEe(i,e);return r==null||r.includes(void 0)?t:r}function QTe(t,e){return Array.prototype.concat(...t.map(i=>Uqe(i,e)))}class eEe{constructor(e,i){if(this.locale=e,this.format=i,this.tokens=QTe(bl.parseFormat(i),e),this.units=this.tokens.map(r=>Pqe(r,e)),this.disqualifyingUnit=this.units.find(r=>r.invalidReason),!this.disqualifyingUnit){const[r,s]=Nqe(this.units);this.regex=RegExp(r,"i"),this.handlers=s}}explainFromTokens(e){if(this.isValid){const[i,r]=Fqe(e,this.regex,this.handlers),[s,n,o]=r?kqe(r):[null,null,void 0];if(d$(r,"a")&&d$(r,"H"))throw new R2("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:this.tokens,regex:this.regex,rawMatches:i,matches:r,result:s,zone:n,specificOffset:o}}else return{input:e,tokens:this.tokens,invalidReason:this.invalidReason}}get isValid(){return!this.disqualifyingUnit}get invalidReason(){return this.disqualifyingUnit?this.disqualifyingUnit.invalidReason:null}}function tEe(t,e,i){return new eEe(t,i).explainFromTokens(e)}function Bqe(t,e,i){const{result:r,zone:s,specificOffset:n,invalidReason:o}=tEe(t,e,i);return[r,s,n,o]}function iEe(t,e){if(!t)return null;const r=bl.create(e,t).dtFormatter(zqe()),s=r.formatToParts(),n=r.resolvedOptions();return s.map(o=>Lqe(o,t,n))}const S6="Invalid DateTime",Vqe=864e13;function pO(t){return new qp("unsupported zone",`the zone "${t.name}" is not supported`)}function T6(t){return t.weekData===null&&(t.weekData=Wz(t.c)),t.weekData}function E6(t){return t.localWeekData===null&&(t.localWeekData=Wz(t.c,t.loc.getMinDaysInFirstWeek(),t.loc.getStartOfWeek())),t.localWeekData}function aw(t,e){const i={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new yt({...i,...e,old:i})}function rEe(t,e,i){let r=t-e*60*1e3;const s=i.offset(r);if(e===s)return[r,e];r-=(s-e)*60*1e3;const n=i.offset(r);return s===n?[r,s]:[t-Math.min(s,n)*60*1e3,Math.max(s,n)]}function SL(t,e){t+=e*60*1e3;const i=new Date(t);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function Fk(t,e,i){return rEe(IV(t),e,i)}function vce(t,e){const i=t.o,r=t.c.year+Math.trunc(e.years),s=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,n={...t.c,year:r,month:s,day:Math.min(t.c.day,Zz(r,s))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},o=Or.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=IV(n);let[l,c]=rEe(a,i,t.zone);return o!==0&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function sT(t,e,i,r,s,n){const{setZone:o,zone:a}=i;if(t&&Object.keys(t).length!==0||e){const l=e||a,c=yt.fromObject(t,{...i,zone:l,specificOffset:n});return o?c:c.setZone(a)}else return yt.invalid(new qp("unparsable",`the input "${s}" can't be parsed as ${r}`))}function TL(t,e,i=!0){return t.isValid?bl.create(Wr.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(t,e):null}function C6(t,e){const i=t.c.year>9999||t.c.year<0;let r="";return i&&t.c.year>=0&&(r+="+"),r+=yo(t.c.year,i?6:4),e?(r+="-",r+=yo(t.c.month),r+="-",r+=yo(t.c.day)):(r+=yo(t.c.month),r+=yo(t.c.day)),r}function _ce(t,e,i,r,s,n){let o=yo(t.c.hour);return e?(o+=":",o+=yo(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!i)&&(o+=":")):o+=yo(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!i)&&(o+=yo(t.c.second),(t.c.millisecond!==0||!r)&&(o+=".",o+=yo(t.c.millisecond,3))),s&&(t.isOffsetFixed&&t.offset===0&&!n?o+="Z":t.o<0?(o+="-",o+=yo(Math.trunc(-t.o/60)),o+=":",o+=yo(Math.trunc(-t.o%60))):(o+="+",o+=yo(Math.trunc(t.o/60)),o+=":",o+=yo(Math.trunc(t.o%60)))),n&&(o+="["+t.zone.ianaName+"]"),o}const sEe={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},jqe={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},Gqe={ordinal:1,hour:0,minute:0,second:0,millisecond:0},nEe=["year","month","day","hour","minute","second","millisecond"],Hqe=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],qqe=["year","ordinal","hour","minute","second","millisecond"];function Wqe(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new oTe(t);return e}function bce(t){switch(t.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return Wqe(t)}}function Zqe(t){return zk[t]||(kk===void 0&&(kk=On.now()),zk[t]=t.offset(kk)),zk[t]}function wce(t,e){const i=A_(e.zone,On.defaultZone);if(!i.isValid)return yt.invalid(pO(i));const r=Wr.fromObject(e);let s,n;if(mi(t.year))s=On.now();else{for(const l of nEe)mi(t[l])&&(t[l]=sEe[l]);const o=OTe(t)||ITe(t);if(o)return yt.invalid(o);const a=Zqe(i);[s,n]=Fk(t,a,i)}return new yt({ts:s,zone:i,loc:r,o:n})}function xce(t,e,i){const r=mi(i.round)?!0:i.round,s=(o,a)=>(o=Ete(o,r||i.calendary?0:2,!0),e.loc.clone(i).relFormatter(i).format(o,a)),n=o=>i.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(i.unit)return s(n(i.unit),i.unit);for(const o of i.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(t>e?-0:0,i.units[i.units.length-1])}function Sce(t){let e={},i;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],i=Array.from(t).slice(0,t.length-1)):i=Array.from(t),[e,i]}let kk,zk={};class yt{constructor(e){const i=e.zone||On.defaultZone;let r=e.invalid||(Number.isNaN(e.ts)?new qp("invalid input"):null)||(i.isValid?null:pO(i));this.ts=mi(e.ts)?On.now():e.ts;let s=null,n=null;if(!r)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(i))[s,n]=[e.old.c,e.old.o];else{const a=ob(e.o)&&!e.old?e.o:i.offset(this.ts);s=SL(this.ts,a),r=Number.isNaN(s.year)?new qp("invalid input"):null,s=r?null:s,n=r?null:a}this._zone=i,this.loc=e.loc||Wr.create(),this.invalid=r,this.weekData=null,this.localWeekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new yt({})}static local(){const[e,i]=Sce(arguments),[r,s,n,o,a,l,c]=i;return wce({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static utc(){const[e,i]=Sce(arguments),[r,s,n,o,a,l,c]=i;return e.zone=ba.utcInstance,wce({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,i={}){const r=S8e(e)?e.valueOf():NaN;if(Number.isNaN(r))return yt.invalid("invalid input");const s=A_(i.zone,On.defaultZone);return s.isValid?new yt({ts:r,zone:s,loc:Wr.fromObject(i)}):yt.invalid(pO(s))}static fromMillis(e,i={}){if(ob(e))return e<-864e13||e>Vqe?yt.invalid("Timestamp out of range"):new yt({ts:e,zone:A_(i.zone,On.defaultZone),loc:Wr.fromObject(i)});throw new ml(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,i={}){if(ob(e))return new yt({ts:e*1e3,zone:A_(i.zone,On.defaultZone),loc:Wr.fromObject(i)});throw new ml("fromSeconds requires a numerical input")}static fromObject(e,i={}){e=e||{};const r=A_(i.zone,On.defaultZone);if(!r.isValid)return yt.invalid(pO(r));const s=Wr.fromObject(i),n=Yz(e,bce),{minDaysInFirstWeek:o,startOfWeek:a}=lce(n,s),l=On.now(),c=mi(i.specificOffset)?r.offset(l):i.specificOffset,h=!mi(n.ordinal),d=!mi(n.year),f=!mi(n.month)||!mi(n.day),m=d||f,y=n.weekYear||n.weekNumber;if((m||h)&&y)throw new R2("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(f&&h)throw new R2("Can't mix ordinal dates with month/day");const v=y||n.weekday&&!m;let _,b,w=SL(l,c);v?(_=Hqe,b=jqe,w=Wz(w,o,a)):h?(_=qqe,b=Gqe,w=w6(w)):(_=nEe,b=sEe);let x=!1;for(const D of _){const F=n[D];mi(F)?x?n[D]=b[D]:n[D]=w[D]:x=!0}const S=v?b8e(n,o,a):h?w8e(n):OTe(n),C=S||ITe(n);if(C)return yt.invalid(C);const T=v?oce(n,o,a):h?ace(n):n,[M,I]=Fk(T,c,r),P=new yt({ts:M,zone:r,o:I,loc:s});return n.weekday&&m&&e.weekday!==P.weekday?yt.invalid("mismatched weekday",`you can't specify both a weekday of ${n.weekday} and a date of ${P.toISO()}`):P.isValid?P:yt.invalid(P.invalid)}static fromISO(e,i={}){const[r,s]=dqe(e);return sT(r,s,i,"ISO 8601",e)}static fromRFC2822(e,i={}){const[r,s]=pqe(e);return sT(r,s,i,"RFC 2822",e)}static fromHTTP(e,i={}){const[r,s]=fqe(e);return sT(r,s,i,"HTTP",i)}static fromFormat(e,i,r={}){if(mi(e)||mi(i))throw new ml("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=r,o=Wr.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,h]=Bqe(o,e,i);return h?yt.invalid(h):sT(a,l,r,`format ${i}`,e,c)}static fromString(e,i,r={}){return yt.fromFormat(e,i,r)}static fromSQL(e,i={}){const[r,s]=wqe(e);return sT(r,s,i,"SQL",e)}static invalid(e,i=null){if(!e)throw new ml("need to specify a reason the DateTime is invalid");const r=e instanceof qp?e:new qp(e,i);if(On.throwOnInvalid)throw new WHe(r);return new yt({invalid:r})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,i={}){const r=iEe(e,Wr.fromObject(i));return r?r.map(s=>s?s.val:null).join(""):null}static expandFormat(e,i={}){return QTe(bl.parseFormat(e),Wr.fromObject(i)).map(s=>s.val).join("")}static resetCache(){kk=void 0,zk={}}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?T6(this).weekYear:NaN}get weekNumber(){return this.isValid?T6(this).weekNumber:NaN}get weekday(){return this.isValid?T6(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?E6(this).weekday:NaN}get localWeekNumber(){return this.isValid?E6(this).weekNumber:NaN}get localWeekYear(){return this.isValid?E6(this).weekYear:NaN}get ordinal(){return this.isValid?w6(this.c).ordinal:NaN}get monthShort(){return this.isValid?wL.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?wL.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?wL.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?wL.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,i=6e4,r=IV(this.c),s=this.zone.offset(r-e),n=this.zone.offset(r+e),o=this.zone.offset(r-s*i),a=this.zone.offset(r-n*i);if(o===a)return[this];const l=r-o*i,c=r-a*i,h=SL(l,o),d=SL(c,a);return h.hour===d.hour&&h.minute===d.minute&&h.second===d.second&&h.millisecond===d.millisecond?[aw(this,{ts:l}),aw(this,{ts:c})]:[this]}get isInLeapYear(){return sD(this.year)}get daysInMonth(){return Zz(this.year,this.month)}get daysInYear(){return this.isValid?_C(this.year):NaN}get weeksInWeekYear(){return this.isValid?LP(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?LP(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(e={}){const{locale:i,numberingSystem:r,calendar:s}=bl.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:i,numberingSystem:r,outputCalendar:s}}toUTC(e=0,i={}){return this.setZone(ba.instance(e),i)}toLocal(){return this.setZone(On.defaultZone)}setZone(e,{keepLocalTime:i=!1,keepCalendarTime:r=!1}={}){if(e=A_(e,On.defaultZone),e.equals(this.zone))return this;if(e.isValid){let s=this.ts;if(i||r){const n=e.offset(this.ts),o=this.toObject();[s]=Fk(o,n,e)}return aw(this,{ts:s,zone:e})}else return yt.invalid(pO(e))}reconfigure({locale:e,numberingSystem:i,outputCalendar:r}={}){const s=this.loc.clone({locale:e,numberingSystem:i,outputCalendar:r});return aw(this,{loc:s})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const i=Yz(e,bce),{minDaysInFirstWeek:r,startOfWeek:s}=lce(i,this.loc),n=!mi(i.weekYear)||!mi(i.weekNumber)||!mi(i.weekday),o=!mi(i.ordinal),a=!mi(i.year),l=!mi(i.month)||!mi(i.day),c=a||l,h=i.weekYear||i.weekNumber;if((c||o)&&h)throw new R2("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(l&&o)throw new R2("Can't mix ordinal dates with month/day");let d;n?d=oce({...Wz(this.c,r,s),...i},r,s):mi(i.ordinal)?(d={...this.toObject(),...i},mi(i.day)&&(d.day=Math.min(Zz(d.year,d.month),d.day))):d=ace({...w6(this.c),...i});const[f,m]=Fk(d,this.o,this.zone);return aw(this,{ts:f,o:m})}plus(e){if(!this.isValid)return this;const i=Or.fromDurationLike(e);return aw(this,vce(this,i))}minus(e){if(!this.isValid)return this;const i=Or.fromDurationLike(e).negate();return aw(this,vce(this,i))}startOf(e,{useLocaleWeeks:i=!1}={}){if(!this.isValid)return this;const r={},s=Or.normalizeUnit(e);switch(s){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(s==="weeks")if(i){const n=this.loc.getStartOfWeek(),{weekday:o}=this;o<n&&(r.weekNumber=this.weekNumber-1),r.weekday=n}else r.weekday=1;if(s==="quarters"){const n=Math.ceil(this.month/3);r.month=(n-1)*3+1}return this.set(r)}endOf(e,i){return this.isValid?this.plus({[e]:1}).startOf(e,i).minus(1):this}toFormat(e,i={}){return this.isValid?bl.create(this.loc.redefaultToEN(i)).formatDateTimeFromString(this,e):S6}toLocaleString(e=qz,i={}){return this.isValid?bl.create(this.loc.clone(i),e).formatDateTime(this):S6}toLocaleParts(e={}){return this.isValid?bl.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:i=!1,suppressMilliseconds:r=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const o=e==="extended";let a=C6(this,o);return a+="T",a+=_ce(this,o,i,r,s,n),a}toISODate({format:e="extended"}={}){return this.isValid?C6(this,e==="extended"):null}toISOWeekDate(){return TL(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:i=!1,includeOffset:r=!0,includePrefix:s=!1,extendedZone:n=!1,format:o="extended"}={}){return this.isValid?(s?"T":"")+_ce(this,o==="extended",i,e,r,n):null}toRFC2822(){return TL(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return TL(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?C6(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:i=!1,includeOffsetSpace:r=!0}={}){let s="HH:mm:ss.SSS";return(i||e)&&(r&&(s+=" "),i?s+="z":e&&(s+="ZZ")),TL(this,s,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():S6}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`DateTime { ts: ${this.toISO()}, zone: ${this.zone.name}, locale: ${this.locale} }`:`DateTime { Invalid, reason: ${this.invalidReason} }`}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const i={...this.c};return e.includeConfig&&(i.outputCalendar=this.outputCalendar,i.numberingSystem=this.loc.numberingSystem,i.locale=this.loc.locale),i}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,i="milliseconds",r={}){if(!this.isValid||!e.isValid)return Or.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...r},n=T8e(i).map(Or.normalizeUnit),o=e.valueOf()>this.valueOf(),a=o?this:e,l=o?e:this,c=Aqe(a,l,n,s);return o?c.negate():c}diffNow(e="milliseconds",i={}){return this.diff(yt.now(),e,i)}until(e){return this.isValid?$n.fromDateTimes(this,e):this}hasSame(e,i,r){if(!this.isValid)return!1;const s=e.valueOf(),n=this.setZone(e.zone,{keepLocalTime:!0});return n.startOf(i,r)<=s&&s<=n.endOf(i,r)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const i=e.base||yt.fromObject({},{zone:this.zone}),r=e.padding?this<i?-e.padding:e.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=e.unit;return Array.isArray(e.unit)&&(s=e.unit,n=void 0),xce(i,this.plus(r),{...e,numeric:"always",units:s,unit:n})}toRelativeCalendar(e={}){return this.isValid?xce(e.base||yt.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(yt.isDateTime))throw new ml("min requires all arguments be DateTimes");return cce(e,i=>i.valueOf(),Math.min)}static max(...e){if(!e.every(yt.isDateTime))throw new ml("max requires all arguments be DateTimes");return cce(e,i=>i.valueOf(),Math.max)}static fromFormatExplain(e,i,r={}){const{locale:s=null,numberingSystem:n=null}=r,o=Wr.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return tEe(o,e,i)}static fromStringExplain(e,i,r={}){return yt.fromFormatExplain(e,i,r)}static buildFormatParser(e,i={}){const{locale:r=null,numberingSystem:s=null}=i,n=Wr.fromOpts({locale:r,numberingSystem:s,defaultToEN:!0});return new eEe(n,e)}static fromFormatParser(e,i,r={}){if(mi(e)||mi(i))throw new ml("fromFormatParser requires an input string and a format parser");const{locale:s=null,numberingSystem:n=null}=r,o=Wr.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});if(!o.equals(i.locale))throw new ml(`fromFormatParser called with a locale of ${o}, but the format parser was created for ${i.locale}`);const{result:a,zone:l,specificOffset:c,invalidReason:h}=i.explainFromTokens(e);return h?yt.invalid(h):sT(a,l,r,`format ${i.format}`,e,c)}static get DATE_SHORT(){return qz}static get DATE_MED(){return aTe}static get DATE_MED_WITH_WEEKDAY(){return JHe}static get DATE_FULL(){return lTe}static get DATE_HUGE(){return cTe}static get TIME_SIMPLE(){return uTe}static get TIME_WITH_SECONDS(){return hTe}static get TIME_WITH_SHORT_OFFSET(){return dTe}static get TIME_WITH_LONG_OFFSET(){return pTe}static get TIME_24_SIMPLE(){return fTe}static get TIME_24_WITH_SECONDS(){return mTe}static get TIME_24_WITH_SHORT_OFFSET(){return gTe}static get TIME_24_WITH_LONG_OFFSET(){return yTe}static get DATETIME_SHORT(){return vTe}static get DATETIME_SHORT_WITH_SECONDS(){return _Te}static get DATETIME_MED(){return bTe}static get DATETIME_MED_WITH_SECONDS(){return wTe}static get DATETIME_MED_WITH_WEEKDAY(){return XHe}static get DATETIME_FULL(){return xTe}static get DATETIME_FULL_WITH_SECONDS(){return STe}static get DATETIME_HUGE(){return TTe}static get DATETIME_HUGE_WITH_SECONDS(){return ETe}}function KA(t){if(yt.isDateTime(t))return t;if(t&&t.valueOf&&ob(t.valueOf()))return yt.fromJSDate(t);if(t&&typeof t=="object")return yt.fromObject(t);throw new ml(`Unknown datetime argument: ${t}, of type ${typeof t}`)}const Yqe="shortOffset";function Jqe(t){return"timeZoneIANA"in t}function Xqe(t){return t.startsWith("UTC")}function Jz(t,e=!1){return{json:{read:{source:t,reader:(i,r)=>r[t]?Uk(r[t]):null},write:!!e&&{allowNull:!0,writer(i,r){r[t]=i?Kqe(i):null}}}}}function Uk(t,e=cf){return t?Jqe(t)?t.timeZoneIANA:Qqe(t,e):e}function Kqe(t){return{timeZoneIANA:t}}function Qqe(t,e=cf){if(!t||!Zle.has(t.timeZone))return e;const i=Zle.get(t.timeZone);return Xqe(t.timeZone)||t.respectsDaylightSaving?i:e9e(i)}function e9e(t){const e=yt.local().setZone(t),i=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return i===0?"Etc/UTC":`Etc/GMT${ba.instance(-i).formatOffset(0,"narrow")}`}function N8t(t,e,i,r,s){if(e&&s==="date")return{timeZone:wb,timeZoneName:void 0};const n=r.timeStyle||r.hour,o=i===eS;return{timeZone:o?s==="timestamp-offset"?void 0:t??wb:i,timeZoneName:o&&n?Yqe:void 0}}function t9e(t){const e=new Set(["etc/utc","etc/gmt","gmt"]),i=new Set(Intl.supportedValuesOf("timeZone").map(r=>r.toLowerCase()));return t===cf||t===eS||e.has(t.toLowerCase())||i.has(t.toLowerCase())}const i9e={year:void 0,month:void 0,day:void 0,weekday:void 0},r9e={hour:void 0,minute:void 0,second:void 0},oEe={timeZone:wb},Cf={year:"numeric",month:"numeric",day:"numeric"},QA={year:"numeric",month:"long",day:"numeric"},eM={year:"numeric",month:"short",day:"numeric"},tM={year:"numeric",month:"long",weekday:"long",day:"numeric"},f_={hour:"numeric",minute:"numeric"},Hw={...f_,second:"numeric"},aEe={hourCycle:"h23"},iM={...f_,...aEe},rM={...Hw,...aEe},lEe={"short-date":Cf,"short-date-short-time":{...Cf,...f_},"short-date-short-time-24":{...Cf,...iM},"short-date-long-time":{...Cf,...Hw},"short-date-long-time-24":{...Cf,...rM},"short-date-le":Cf,"short-date-le-short-time":{...Cf,...f_},"short-date-le-short-time-24":{...Cf,...iM},"short-date-le-long-time":{...Cf,...Hw},"short-date-le-long-time-24":{...Cf,...rM},"long-month-day-year":QA,"long-month-day-year-short-time":{...QA,...f_},"long-month-day-year-short-time-24":{...QA,...iM},"long-month-day-year-long-time":{...QA,...Hw},"long-month-day-year-long-time-24":{...QA,...rM},"day-short-month-year":eM,"day-short-month-year-short-time":{...eM,...f_},"day-short-month-year-short-time-24":{...eM,...iM},"day-short-month-year-long-time":{...eM,...Hw},"day-short-month-year-long-time-24":{...eM,...rM},"long-date":tM,"long-date-short-time":{...tM,...f_},"long-date-short-time-24":{...tM,...iM},"long-date-long-time":{...tM,...Hw},"long-date-long-time-24":{...tM,...rM},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":f_,"long-time":Hw},s9e=Mo()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),cEe={ar:"ar-u-nu-latn-ca-gregory"};let X7=new WeakMap;const DV=lEe["short-date-short-time"];function n9e(t){let e=X7.get(t);if(!e){const i=Xc(),r=cEe[i]||i,s=Mte(t.timeZone??cf),n={...t,timeZone:s};e=new Intl.DateTimeFormat(r,n),X7.set(t,e)}return e}function o9e(t){return lEe[t]}function LV(t,e=DV){return n9e(e).format(t)}function F8t(t,e=DV){return LV(new Date(t),{...e,...oEe,...r9e})}function k8t(t,e=DV){return LV(new Date(`1970-01-01T${t}Z`),{...e,...oEe,...i9e})}function z8t(t,e=DV){if(e.timeZone)return LV(new Date(t),e);const i=yt.fromISO(t,{setZone:!0}),r=Xc(),s=cEe[r]??r,n=i.offset===0?wb:e.timeZone,o={...e,timeZone:n};return i.toLocaleString(o,{locale:s})}function Mte(t){switch(t){case cf:return qHe;case eS:return wb;default:return t}}bte(()=>{X7=new WeakMap});const a9e={ar:"ar-u-nu-latn"};let Bk=new WeakMap,uEe={};function K7(t){const e=t||uEe;if(!Bk.has(e)){const i=Xc(),r=a9e[Xc()]||i;Bk.set(e,new Intl.NumberFormat(r,t))}return Bk.get(e)}function U8t(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function aD(t,e){return Object.is(t,-0)&&(t=0),K7(e).format(t)}function B8t(t,e=Xc()){if(!t)return null;let i=Tce.get(e);if(!i){const r=K7().formatToParts(12345.6),s=[...K7({useGrouping:!1}).format(9876543210)].reverse(),n=new Map(s.map((d,f)=>[d,f])),o=new RegExp(`[${r.find(d=>d.type==="group")?.value}]`,"g"),a=new RegExp(`[${r.find(d=>d.type==="decimal")?.value}]`),l=new RegExp(`[${s.join("")}]`,"g"),c=/[\u200E\u200F\u202A\u202B\u202C\u202D\u202E\u2066\u2067\u2068\u2069\u061C]/g,h=/[-\u2212\u2013\u2014\u2015]/g;i=d=>{if((d=d.trim().replaceAll(o,"").replace(a,".").replace(l,m=>String(n.get(m))).replaceAll(c,"").replaceAll(h,"-"))==="")return null;const f=Number(d);return isNaN(f)?null:f},Tce.set(e,i)}return i(t)}bte(()=>{Bk=new WeakMap,uEe={}});const Tce=new Map,Ece=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,hEe={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:"no",nl:!0,no:!0,pl:!0,pt:"pt-BR","pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,zh:"zh-CN","zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function l9e(t){return t in hEe}function Cce(t){if(l9e(t)){const e=hEe[t];return e===!0?t:e}return null}const fO=[],wC=new Map;function $ce(t){for(const e of wC.keys())fEe(t.pattern,e)&&wC.delete(e)}function c9e(t){return fO.includes(t)||($ce(t),fO.unshift(t)),$i(()=>{const e=fO.indexOf(t);e>-1&&(fO.splice(e,1),$ce(t))})}async function dEe(t){const e=Xc();wC.has(t)||wC.set(t,u9e(t,e));const i=wC.get(t);return i&&await h9e.add(i),i}function pEe(t){if(!Ece.test(t))return null;const e=Ece.exec(t);if(e===null)return null;const[,i,r]=e;return Cce(i+(r?"-"+r.toUpperCase():""))??Cce(i)}async function u9e(t,e){const i=[];for(const r of fO)if(fEe(r.pattern,t))try{return await r.fetchMessageBundle(t,e)}catch(s){i.push(s)}throw i.length?new U("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:i}):new U("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function fEe(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}bte(()=>{wC.clear()});const h9e=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=Qo())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function d9e(t,e,i,r){const s=e.exec(i);if(!s)throw new U("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${e}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=pEe(r),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let h;try{h=await Ace(t(c))}catch(d){if(c===l)throw new U("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:d});try{h=await Ace(t(l))}catch(f){throw new U("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:f})}}return h}async function Ace(t){if(Mce.fetchBundleAsset!=null)return Mce.fetchBundleAsset(t);const e=await Ci(t,{responseType:"text"});return JSON.parse(e.data)}let p9e=class{constructor({base:e="",pattern:i,location:r=new URL(window.location.href)}){let s;s=typeof r=="string"?n=>new URL(n,new URL(r,window.location.href)).href:r instanceof URL?n=>new URL(n,r).href:r,this.pattern=typeof i=="string"?new RegExp(`^${i}`):i,this.getAssetUrl=s,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)\\/)?(.*)$`)}fetchMessageBundle(e,i){return d9e(this.getAssetUrl,this.matcher,e,i)}};function f9e(t){return new p9e(t)}const Mce={};c9e(f9e({pattern:"esri/",location:gs}));const Oce={};function m9e(t){const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:t.packages?.slice()||[],paths:{...Oce.paths,...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=Oce.baseUrl),e}let g9e=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(i=>{this[i]=(...r)=>e[i](...r)})}},Vk=class{constructor(){this._dispatcher=new g9e,this._workerPostMessage({type:ma.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){e$(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,i,r){this._dispatcher.addEventListener(e,i,r)}removeEventListener(e,i,r){this._dispatcher.removeEventListener(e,i,r)}_workerPostMessage(e){e$(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const i=DP(e);if(i&&i.type===ma.OPEN){const{modulePath:r,jobId:s}=i;let n=await bb.loadWorker(r);n||(n=await import(r));const o=bb.connect(n);this._workerPostMessage({type:ma.OPENED,jobId:s,data:o})}}};const Q7=()=>J.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:y9e}=ma,v9e='let globalId=0;const outgoing=new Map,configuration={CONFIGURATION};self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;let s=null;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());s=()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))},t.addEventListener("abort",s)}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})})).finally((()=>{t&&t.removeEventListener("abort",s)}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\nModules version: ${r}\nAssets version: ${n??s}\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let EL,CL;const Ice="Failed to create Worker. Fallback to execute module in main thread";async function _9e(){if(!X("esri-workers"))return Rce(new Vk);if(!EL&&!CL)try{const e=v9e.split("{CONFIGURATION}").join(b9e());EL=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){CL=e||{}}let t;if(EL)try{t=new Worker(EL,{name:"esri-worker-"+w9e++})}catch{Q7().warn(Ice,CL),t=new Vk}else Q7().warn(Ice,CL),t=new Vk;return Rce(t)}async function Rce(t){return new Promise(e=>{function i(s){const n=DP(s);n&&n.type===y9e&&(t.removeEventListener("message",i),t.removeEventListener("error",r),e(t))}function r(s){s.preventDefault(),t.removeEventListener("message",i),t.removeEventListener("error",r),Q7().warn("Failed to create Worker. Fallback to execute module in main thread",s),(t=new Vk).addEventListener("message",i),t.addEventListener("error",r)}t.addEventListener("message",i),t.addEventListener("error",r)})}function b9e(){let t;if(Ir.default!=null){const s={...Ir};delete s.default,t=JSON.parse(JSON.stringify(s))}else t=JSON.parse(JSON.stringify(Ir));t.assetsPath=Hc(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?Hc(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=Xc(),t.has={"esri-csp-restrictions":X("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":X("esri-2d-update-debug"),"esri-2d-log-updating":X("esri-2d-log-updating"),"featurelayer-pbf":X("featurelayer-pbf"),"featurelayer-fast-triangulation-enabled":X("featurelayer-fast-triangulation-enabled"),"featurelayer-simplify-thresholds":X("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":X("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":X("featurelayer-simplify-mobile-factor"),"featurelayer-query-max-depth":X("featurelayer-query-max-depth"),"featurelayer-query-pausing-enabled":X("featurelayer-query-pausing-enabled"),"featurelayer-snapshot-enabled":X("featurelayer-snapshot-enabled"),"esri-atomics":X("esri-atomics"),"esri-shared-array-buffer":X("esri-shared-array-buffer"),"esri-tiles-debug":X("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":X("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":X("feature-polyline-generalization-factor"),"host-webworker":1},t.workers.loaderUrl&&(t.workers.loaderUrl=Hc(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=Hc(t.workers.workerPath):t.workers.workerPath=Hc(gs("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=Ir.workers.loaderConfig,i=m9e({baseUrl:e?.baseUrl,locale:Xc(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e?.has},map:{...e?.map},paths:{...e?.paths},packages:e?.packages||[]});return JSON.stringify({esriConfig:t,loaderConfig:i,kernelInfo:{buildDate:jxe,fullVersion:Zee,revision:Gxe}})}let w9e=0;const{ABORT:Pce,INVOKE:x9e,OPEN:S9e,OPENED:T9e,RESPONSE:sM}=ma;let E9e=class mEe{static async create(e){const i=await _9e();return new mEe(i,e)}constructor(e,i){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=i,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",r=>{r.preventDefault(),J.getLogger("esri.core.workers.WorkerOwner").error(r)})}terminate(){this.worker.terminate()}async open(e,i={}){const{signal:r}=i,s=rTe();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:J3(r,()=>{this._outJobs.delete(s),this._post({type:Pce,jobId:s})})};this._outJobs.set(s,a),this._post({type:S9e,jobId:s,modulePath:e})})}_onMessage(e){const i=DP(e);if(i)switch(i.type){case T9e:this._onOpenedMessage(i);break;case sM:this._onResponseMessage(i);break;case Pce:this._onAbortMessage(i);break;case x9e:this._onInvokeMessage(i)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,s=i.get(r);s&&(s.controller&&s.controller.abort(),i.delete(r))}_onInvokeMessage(e){const{methodName:i,jobId:r,data:s,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs,l=GHe[i];let c;try{if(typeof l!="function")throw new TypeError(`${i} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(h){return void this._post({type:sM,jobId:r,error:PP(h)})}nu(c)?(a.set(r,{controller:o,promise:c}),c.then(h=>{a.has(r)&&(a.delete(r),this._post({type:sM,jobId:r},h))},h=>{a.has(r)&&(a.delete(r),h||(h={message:"Error encountered at method"+i}),Xr(h)||this._post({type:sM,jobId:r,error:PP(h||{message:`Error encountered at method ${i}`})}))})):this._post({type:sM,jobId:r},c)}_onOpenedMessage(e){const{jobId:i,data:r}=e,s=this._outJobs.get(i);s&&(this._outJobs.delete(i),Hi(s.abortHandle),s.resolve(r))}_onResponseMessage(e){const{jobId:i,error:r,data:s}=e,n=this._outJobs.get(i);n&&(this._outJobs.delete(i),Hi(n.abortHandle),r?n.reject(U.fromJSON(JSON.parse(r))):n.resolve(s))}_post(e,i,r){return _te(this.worker,e,i,r)}};const Dce=X("host-browser")?Math.min(navigator.hardwareConcurrency-1,X("workers-pool-size")??8):0;let dx=X("esri-mobile")?Math.min(Dce,3):Dce;dx||(dx=X("safari")&&X("mac")?7:2);let Lce=0;const jk=[];function gEe(){vEe()}async function $L(t,e){const i=new jHe,{registryTarget:r,...s}=e;return await i.open(t,s),r&&PHe(r,i),i}async function yEe(t,e={}){if(typeof t!="string")throw new U("workers:undefined-module","modulePath is missing");let i=e.strategy||"distributed";if(X("host-webworker")&&!X("esri-workers")&&(i="local"),i==="local"){let r=await bb.loadWorker(t);r||(r=await import(t)),gt(e.signal);const s=e.client||r;return $L([bb.connect(r,e.schedule)],{...e,client:s})}if(await vEe(),gt(e.signal),i==="dedicated"){const r=Lce++%dx;return $L([await jk[r].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const r=Math.min(e.maxNumWorkers,dx);if(r<dx){const s=new Array(r);for(let n=0;n<r;++n){const o=Lce++%dx;s[n]=jk[o].open(t,e)}return $L(s,e)}}return $L(jk.map(r=>r.open(t,e)),e)}let AL=null;async function vEe(){if(AL)return AL;new AbortController;const t=[];for(let e=0;e<dx;e++){const i=E9e.create(e).then(r=>(jk[e]=r,r));t.push(i)}return AL=Promise.all(t),AL}function $(){return[0,0,0]}function is(t){return[t[0],t[1],t[2]]}function Le(t,e,i){return[t,e,i]}function hf(t,e,i){return[t,e,i]}function p$(t,e=$()){const i=Math.min(3,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function C9e(t,e){return new Float64Array(t,e,3)}function EA(){return $()}function Ote(){return Le(1,1,1)}function _Ee(){return Le(1,0,0)}function bEe(){return Le(0,1,0)}function Ite(){return Le(0,0,1)}const on=EA(),Rte=Ote(),Pte=_Ee(),Dte=bEe(),f$=Ite();Object.freeze(Object.defineProperty({__proto__:null,ONES:Rte,UNIT_X:Pte,UNIT_Y:Dte,UNIT_Z:f$,ZEROS:on,clone:is,create:$,createView:C9e,freeze:hf,fromArray:p$,fromValues:Le,ones:Ote,unitX:_Ee,unitY:bEe,unitZ:Ite,zeros:EA},Symbol.toStringTag,{value:"Module"}));const H8t=Math.PI/180,q8t=/(?:SPHEROID|ELLIPSOID)\[([^\]]+)]/i,Xv=xi.radius,Hd=xi.eccentricitySquared,$9e={a1:Xv*Hd,a2:Xv*Hd*Xv*Hd,a3:Xv*Hd*Hd/2,a4:Xv*Hd*Xv*Hd*2.5,a5:Xv*Hd+Xv*Hd*Hd/2,a6:1-Hd},W8t={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:xi.radius,f:xi.flattening},4490:{a:6378137,f:1/298.257222101},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:rv.radius,f:rv.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:Kp.radius,f:Kp.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:Kp.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};var K;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.SPHERICAL_MARS_PCPF=6]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=7]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=8]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=9]="GCSMOON2000",t[t.LON_LAT=10]="LON_LAT",t[t.PLATE_CARREE=11]="PLATE_CARREE"})(K||(K={}));const mO={[K.WGS84]:{[K.CGCS2000]:ms,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:ms,[K.SPHERICAL_ECEF]:TC,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:Ex,[K.PLATE_CARREE]:Cx,[K.WGS84]:ms,[K.WGS84_ECEF]:Ax},[K.CGCS2000]:{[K.CGCS2000]:ms,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:ms,[K.SPHERICAL_ECEF]:TC,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:Ex,[K.PLATE_CARREE]:Cx,[K.WGS84]:ms,[K.WGS84_ECEF]:Ax},[K.GCSMARS2000]:{[K.CGCS2000]:null,[K.GCSMARS2000]:ms,[K.GCSMOON2000]:null,[K.LON_LAT]:ms,[K.SPHERICAL_ECEF]:null,[K.SPHERICAL_MARS_PCPF]:tW,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:null,[K.WGS84]:null,[K.WGS84_ECEF]:null},[K.GCSMOON2000]:{[K.CGCS2000]:null,[K.GCSMARS2000]:null,[K.GCSMOON2000]:ms,[K.LON_LAT]:ms,[K.SPHERICAL_ECEF]:null,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:eW,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:null,[K.WGS84]:null,[K.WGS84_ECEF]:null},[K.WEB_MERCATOR]:{[K.CGCS2000]:xC,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:xC,[K.SPHERICAL_ECEF]:xEe,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:ms,[K.PLATE_CARREE]:TEe,[K.WGS84]:xC,[K.WGS84_ECEF]:SEe},[K.WGS84_ECEF]:{[K.CGCS2000]:Mx,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:Mx,[K.SPHERICAL_ECEF]:$Ee,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:AEe,[K.PLATE_CARREE]:M9e,[K.WGS84]:Mx,[K.WGS84_ECEF]:ms},[K.SPHERICAL_ECEF]:{[K.CGCS2000]:$x,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:$x,[K.SPHERICAL_ECEF]:ms,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:EEe,[K.PLATE_CARREE]:O9e,[K.WGS84]:$x,[K.WGS84_ECEF]:CEe},[K.SPHERICAL_MARS_PCPF]:{[K.CGCS2000]:null,[K.GCSMARS2000]:rW,[K.GCSMOON2000]:null,[K.LON_LAT]:rW,[K.SPHERICAL_ECEF]:null,[K.SPHERICAL_MARS_PCPF]:ms,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:null,[K.WGS84]:null,[K.WGS84_ECEF]:null},[K.SPHERICAL_MOON_PCPF]:{[K.CGCS2000]:null,[K.GCSMARS2000]:null,[K.GCSMOON2000]:iW,[K.LON_LAT]:iW,[K.SPHERICAL_ECEF]:null,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:ms,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:null,[K.WGS84]:null,[K.WGS84_ECEF]:null},[K.UNKNOWN]:{[K.CGCS2000]:null,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:null,[K.SPHERICAL_ECEF]:null,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:ms,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:null,[K.WGS84]:null,[K.WGS84_ECEF]:null},[K.LON_LAT]:{[K.CGCS2000]:ms,[K.GCSMARS2000]:ms,[K.GCSMOON2000]:ms,[K.LON_LAT]:ms,[K.SPHERICAL_ECEF]:TC,[K.SPHERICAL_MARS_PCPF]:tW,[K.SPHERICAL_MOON_PCPF]:eW,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:Ex,[K.PLATE_CARREE]:Cx,[K.WGS84]:ms,[K.WGS84_ECEF]:Ax},[K.PLATE_CARREE]:{[K.CGCS2000]:SC,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:SC,[K.SPHERICAL_ECEF]:I9e,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:R9e,[K.PLATE_CARREE]:ms,[K.WGS84]:SC,[K.WGS84_ECEF]:P9e}};function xb(t,e){return wEe(t,e)?.projector}function wEe(t,e){if(t==null||e==null)return null;if(wg.source.spatialReference===t&&wg.dest.spatialReference===e)return wg;const i=Nce(t,wg.source),r=Nce(e,wg.dest);return i===K.UNKNOWN&&r===K.UNKNOWN?rs(t,e)?wg.projector=ms:wg.projector=null:wg.projector=mO[i][r],wg}function Z8t(t,e){switch(xb(t,e)){case ms:return"copy3";case TC:return"wgs84ToSphericalECEF";case Ex:return"wgs84ToWebMercator";case Cx:return"wgs84ToPlateCarree";case Ax:return"wgs84ToWGS84ECEF";case xC:return"webMercatorToWGS84";case xEe:return"webMercatorToSphericalECEF";case SEe:return"webMercatorToWGS84ECEF";case TEe:return"webMercatorToPlateCarree";case Mx:return"wgs84ECEFToWGS84";case $Ee:return"wgs84ECEFToSphericalECEF";case AEe:return"wgs84ECEFToWebMercator";case $x:return"sphericalECEFToWGS84";case EEe:return"sphericalECEFToWebMercator";case rW:return"sphericalMarsPCPFToMars2000";case iW:return"sphericalMoonPCPFToMoon2000";case CEe:return"sphericalECEFToWGS84ECEF";case tW:return"mars2000ToSphericalPCPF";case eW:return"moon2000ToSphericalPCPF";default:return null}}function Nce(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=Ao(t,1)),Bz(t)?e.spatialReferenceId=K.SPHERICAL_ECEF:yb(t)?e.spatialReferenceId=K.WGS84:Zm(t)?e.spatialReferenceId=K.WEB_MERCATOR:OP(t)?e.spatialReferenceId=K.PLATE_CARREE:t.wkt===uSe.wkt?e.spatialReferenceId=K.WGS84_ECEF:t.wkid===qc.CGCS2000?e.spatialReferenceId=K.CGCS2000:t.wkt===SV.wkt?e.spatialReferenceId=K.SPHERICAL_MARS_PCPF:t.wkt===TV.wkt?e.spatialReferenceId=K.SPHERICAL_MOON_PCPF:vA(t)?e.spatialReferenceId=K.GCSMARS2000:_A(t)?e.spatialReferenceId=K.GCSMOON2000:e.spatialReferenceId=K.UNKNOWN):K.UNKNOWN}function ms(t,e,i,r){t!==i&&(i[r++]=t[e++],i[r++]=t[e++],i[r]=t[e])}function xC(t,e,i,r){i[r]=g$*(t[e]/Ox),i[r+1]=g$*(MEe-2*Math.atan(Math.exp(-t[e+1]/Ox))),i[r+2]=t[e+2]}function xEe(t,e,i,r){const s=t[e]/Ox,n=MEe-2*Math.atan(Math.exp(-t[e+1]/Ox)),o=Ox+t[e+2],a=Math.cos(n)*o;i[r]=Math.cos(s)*a,i[r+1]=Math.sin(s)*a,i[r+2]=Math.sin(n)*o}function SEe(t,e,i,r){xC(t,e,i,r),Ax(i,r,i,r)}function A9e(t,e,i,r,s){const n=.4999999*Math.PI,o=ce(m$*t[e+1],-n,n),a=Math.sin(o);i[r++]=m$*t[e]*s.radius,i[r++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),i[r]=t[e+2]}function Ex(t,e,i,r){A9e(t,e,i,r,xi)}function Cx(t,e,i,r){i[r]=t[e]*Fce,i[r+1]=t[e+1]*Fce,i[r+2]=t[e+2]}function SC(t,e,i,r){i[r]=t[e]*kce,i[r+1]=t[e+1]*kce,i[r+2]=t[e+2]}function TEe(t,e,i,r){xC(t,e,i,r),Cx(i,r,i,r)}function M9e(t,e,i,r){Mx(t,e,i,r),Cx(i,r,i,r)}function O9e(t,e,i,r){$x(t,e,i,r),Cx(i,r,i,r)}function I9e(t,e,i,r){SC(t,e,i,r),TC(i,r,i,r)}function R9e(t,e,i,r){SC(t,e,i,r),Ex(i,r,i,r)}function P9e(t,e,i,r){SC(t,e,i,r),Ax(i,r,i,r)}function Lte(t,e,i,r,s){const n=s+t[e+2],o=m$*t[e+1],a=m$*t[e],l=Math.cos(o)*n;i[r]=Math.cos(a)*l,i[r+1]=Math.sin(a)*l,i[r+2]=Math.sin(o)*n}function eW(t,e,i,r){Lte(t,e,i,r,rv.radius)}function tW(t,e,i,r){Lte(t,e,i,r,Kp.radius)}function TC(t,e,i,r){Lte(t,e,i,r,xi.radius)}function Nte(t,e,i,r,s){const n=t[e],o=t[e+1],a=t[e+2],l=Math.sqrt(n*n+o*o+a*a),c=Td(a/(l===0?1:l)),h=Math.atan2(o,n);i[r++]=g$*h,i[r++]=g$*c,i[r]=l-s}function iW(t,e,i,r){Nte(t,e,i,r,rv.radius)}function rW(t,e,i,r){Nte(t,e,i,r,Kp.radius)}function $x(t,e,i,r){Nte(t,e,i,r,xi.radius)}function EEe(t,e,i,r){$x(t,e,i,r),Ex(i,r,i,r)}function CEe(t,e,i,r){$x(t,e,i,r),Ax(i,r,i,r)}function D9e(t,e,i,r,s){const n=m$*t[e],o=m$*t[e+1],a=t[e+2],l=Math.sin(o),c=Math.cos(o),h=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);i[r++]=(h+a)*c*Math.cos(n),i[r++]=(h+a)*c*Math.sin(n),i[r++]=(h*(1-s.eccentricitySquared)+a)*l}function Ax(t,e,i,r){D9e(t,e,i,r,xi)}function Mx(t,e,i,r){const s=$9e,n=t[e],o=t[e+1],a=t[e+2];let l,c,h,d,f,m,y,v,_,b,w,x,S,C,T,M,I,P,D,F,L;l=Math.abs(a),c=n*n+o*o,h=Math.sqrt(c),d=c+a*a,f=Math.sqrt(d),F=Math.atan2(o,n),m=a*a/d,y=c/d,C=s.a2/f,T=s.a3-s.a4/f,y>.3?(v=l/f*(1+y*(s.a1+C+m*T)/f),D=Math.asin(v),b=v*v,_=Math.sqrt(1-b)):(_=h/f*(1-m*(s.a5-C-y*T)/f),D=Math.acos(_),b=1-_*_,v=Math.sqrt(b)),w=1-xi.eccentricitySquared*b,x=xi.radius/Math.sqrt(w),S=s.a6*x,C=h-x*_,T=l-S*v,I=_*C+v*T,M=_*T-v*C,P=M/(S/w+I),D+=P,L=I+M*P/2,a<0&&(D=-D),i[r++]=g$*F,i[r++]=g$*D,i[r]=L}function $Ee(t,e,i,r){Mx(t,e,i,r),TC(i,r,i,r)}function AEe(t,e,i,r){Mx(t,e,i,r),Ex(i,r,i,r)}const wg={source:{spatialReference:null,spatialReferenceId:K.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:K.UNKNOWN,metersPerUnit:1},projector:ms},m$=wt(1),g$=$o(1),MEe=.5*Math.PI,Ox=xi.radius,Fce=Ox*Math.PI/180,kce=180/(Ox*Math.PI);function Bn(t,e,i,r,s,n,o=Math.floor(t.length/3)){const a=xb(e,s);if(a==null)return!1;if(a===ms){if(t===r&&i===n)return!0;const c=i+3*o;for(let h=i,d=n;h<c;h++,d++)r[d]=t[h];return!0}const l=i+3*o;for(let c=i,h=n;c<l;c+=3,h+=3)a(t,c,r,h);return!0}const Y8t=Object.freeze(Object.defineProperty({__proto__:null,projectBuffer:Bn},Symbol.toStringTag,{value:"Module"}));function zce(t,e,i,r,s,n){return ML[0]=t,ML[1]=e,ML[2]=i,Bn(ML,r,0,s,n,0)}const ML=$();let OL=0,$6=class sW{static fromGE(e){const i=new sW;return i._wkt=e.wkt,i._wkid=e.wkid,i._isInverse=e.isInverse,i}constructor(e){this.uid=OL++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=OL++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=OL++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=OL++}getInverse(){const e=new sW;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},Xz=class gO{static cacheKey(e,i){return[e.wkid?.toString()??"-1",e.wkt?.toString()??"",e.wkt2?.toString()??"",i.wkid?.toString()??"-1",i.wkt?.toString()??"",i.wkt2?.toString()??""].join()}static fromGE(e){const i=new gO;let r="";for(const s of e.steps){const n=$6.fromGE(s);i.steps.push(n),r+=n.uid.toString()+","}return i._cachedProjection={},i._gtlistentry=null,i._chain=r,i}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e?.steps)for(const i of e.steps)i instanceof $6?this.steps.push(i):this.steps.push(new $6({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}getInverse(){const e=new gO;e.steps=[];for(let i=this.steps.length-1;i>=0;i--){const r=this.steps[i];e.steps.push(r.getInverse())}return e}getGTListEntry(){let e="";for(const i of this.steps)e+=i.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,i,r){this._cachedProjection[gO.cacheKey(e,i)]=r}getCachedGeTransformation(e,i){let r="";for(const n of this.steps)r+=n.uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=r);const s=this._cachedProjection[gO.cacheKey(e,i)];return s===void 0?null:s}};function OEe(t,e,i){if(e==null||i==null||i.vcsWkid||rs(e,i)||vb(e)||vb(i))return null;const r=Yx(e)/Yx(i);if(r===1)return null;switch(t){case"point":case"esriGeometryPoint":return s=>L9e(s,r);case"polyline":case"esriGeometryPolyline":return s=>F9e(s,r);case"polygon":case"esriGeometryPolygon":return s=>N9e(s,r);case"multipoint":case"esriGeometryMultipoint":return s=>k9e(s,r);case"extent":case"esriGeometryEnvelope":return s=>z9e(s,r);default:return null}}function L9e(t,e){t?.z!=null&&(t.z*=e)}function N9e(t,e){if(t)for(const i of t.rings)for(const r of i)r.length>2&&(r[2]*=e)}function F9e(t,e){if(t)for(const i of t.paths)for(const r of i)r.length>2&&(r[2]*=e)}function k9e(t,e){if(t)for(const i of t.points)i.length>2&&(i[2]*=e)}function z9e(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let ef=null,Sb=null,mR=null,Gk={};const Fte=new rD;function $v(){return!!ef&&Kee()}function IEe(){return!!$v()||(It(Fte),nv(),!1)}function M_(t,e){return!t||!e||ru(t,e)||IEe()}function REe(t,e){return!ru(t,e)&&!$v()}function nv(t){return mR==null&&(mR=Promise.all([tSe(),V(()=>import("./geometryEngineBase-C-gsyNi-.js"),__vite__mapDeps([11,3])).then(e=>e.g),V(()=>import("./hydrated-BSJF97b-.js"),[])])),mR.then(([,e,{hydratedAdapter:i}])=>{gt(t),Sb=i,ef=e.default,ef._enableProjection(JGe),Fte.notify()})}function Id(t,e,i=null,r=null){return Array.isArray(t)?t.length===0?[]:(w6e(t),nW(Sb,t,t[0].spatialReference,e,i,r)):(a$(t),nW(Sb,[t],t.spatialReference,e,i,r)[0])}function nW(t,e,i,r,s=null,n=null){if(i==null||r==null)return e;if(ru(i,r,s))return e.map(o=>gR(o,i,r));if(s==null&&Bz(i))return e.map(o=>gR(o,i,Ae.WGS84)).map(o=>Tb(o,r));if(s==null&&Bz(r))return e.map(o=>Tb(o,Ae.WGS84)).map(o=>gR(o,Ae.WGS84,r));if(s==null){const o=Xz.cacheKey(i,r);Gk[o]!==void 0?s=Gk[o]:((s=DEe(i,r,void 0))==null&&(s=new Xz),Gk[o]=s)}if(ef==null||t==null)throw new NV;return n!=null?ef._project(t,e,i,r,s,n):ef._project(t,e,i,r,s)}function U9e(t,e){const i=PEe([t],e);return i.pending!=null?{pending:i.pending,geometry:null}:i.geometries!=null?{pending:null,geometry:i.geometries[0]}:{pending:null,geometry:null}}function PEe(t,e){if(!$v()){for(const i of t)if(i!=null&&!rs(i.spatialReference,e)&&qu(i.spatialReference)&&qu(e)&&!ru(i.spatialReference,e))return It(Fte),{pending:nv(),geometries:null}}return{pending:null,geometries:t.map(i=>i==null?null:rs(i.spatialReference,e)?i:qu(i.spatialReference)&&qu(e)?Tb(i,e):null)}}function DEe(t,e,i=null){if(t==null||e==null)return null;if(ef==null||Sb==null)throw new NV;const r=ef._getTransformation(Sb,t,e,i,i?.spatialReference);return r!==null?Xz.fromGE(r):null}function B9e(t,e,i=null){if(ef==null||Sb==null)throw new NV;const r=ef._getTransformationBySuitability(Sb,t,e,i,i?.spatialReference);if(r!==null){const s=[];for(const n of r)s.push(Xz.fromGE(n));return s}return[]}let NV=class extends U{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}};function V9e(){ef=null,Sb=null,mR=null,Gk={}}const j9e={get loadPromise(){return mR}};function Tb(t,e){try{const i=Id(t,e);if(i==null)return null;"xmin"in t&&"xmin"in i&&(i.zmin=t.zmin,i.zmax=t.zmax);const r=OEe(i.type,t.spatialReference,e);return r?.(i),i}catch(i){if(!(i instanceof NV))throw i;return null}}async function Eb(t,e,i){const r=t.spatialReference;return r!=null&&e!=null&&await lD(r,e,null,i),Tb(t,e)}function ru(t,e,i){return!i&&(!!rs(t,e)||qu(t)&&qu(e)&&!!xb(t,e))}function G9e(t,e){if(rs(t,e))return!0;if(!qu(t)||!qu(e))return!1;const i=yb(t)||Zm(t)||Uz(t),r=yb(e)||Zm(e)||Uz(e);return i&&r}async function lD(t,e,i,r){if($v())return fle(r);if(Array.isArray(t)){for(const{source:s,dest:n,geographicTransformation:o}of t)if(s&&n&&!ru(s,n,o))return nv(r)}else if(t&&e&&!ru(t,e,i))return nv(r);return fle(r)}function gR(t,e,i){return t?"x"in t?NEe(t,e,new ke,i,0):"xmin"in t?UEe(t,e,new gi,i,0):"rings"in t?zEe(t,e,new Sa,i,0):"paths"in t?kEe(t,e,new fd,i,0):"points"in t?FEe(t,e,new CS,i,0):null:null}function LEe(t,e,i=e.spatialReference,r=0){return i!=null&&t.spatialReference!=null&&NEe(t,t.spatialReference,e,i,r)!=null}function NEe(t,e,i,r,s){gl[0]=t.x,gl[1]=t.y;const n=t.z;return gl[2]=n!==void 0?n:s,Bn(gl,e,0,gl,r,0)?(i.x=gl[0],i.y=gl[1],i.spatialReference=r,n!==void 0||vb(r)?(i.z=gl[2],i.hasZ=!0):(i.z=void 0,i.hasZ=!1),t.m===void 0?(i.m=void 0,i.hasM=!1):(i.m=t.m,i.hasM=!0),i):null}function H9e(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&FEe(t,t.spatialReference,e,i,r)!=null}function FEe(t,e,i,r,s){const{points:n,hasZ:o,hasM:a}=t,l=[],c=n.length,h=[];for(const f of n)h.push(f[0],f[1],o?f[2]:s);if(!Bn(h,e,0,h,r,0,c))return null;const d=o||vb(r);for(let f=0;f<c;++f){const m=3*f,y=h[m],v=h[m+1];d&&a?l.push([y,v,h[m+2],n[f][3]]):d?l.push([y,v,h[m+2]]):a?l.push([y,v,n[f][2]]):l.push([y,v])}return i.points=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i}function q9e(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&kEe(t,t.spatialReference,e,i,r)!=null}function kEe(t,e,i,r,s){const{paths:n,hasZ:o,hasM:a}=t,l=[];if(!BEe(n,o??!1,a??!1,e,l,r,s))return null;const c=o||vb(r);return i.paths=l,i.spatialReference=r,i.hasZ=c,i.hasM=a,i}function W9e(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&zEe(t,t.spatialReference,e,i,r)!=null}function zEe(t,e,i,r,s){const{rings:n,hasZ:o,hasM:a}=t,l=[];if(!BEe(n,o??!1,a??!1,e,l,r,s))return null;const c=o||vb(r);return i.rings=l,i.spatialReference=r,i.hasZ=c,i.hasM=a,i}function Z9e(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&UEe(t,t.spatialReference,e,i,r)!=null}function UEe(t,e,i,r,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:h}=t,d=c?t.zmin:s;if(!zce(n,o,d,e,gl,r))return null;const f=c||vb(r);i.xmin=gl[0],i.ymin=gl[1],f&&(i.zmin=gl[2]);const m=c?t.zmax:s;return zce(a,l,m,e,gl,r)?(i.xmax=gl[0],i.ymax=gl[1],f&&(i.zmax=gl[2]),h&&(i.mmin=t.mmin,i.mmax=t.mmax),i.spatialReference=r,i):null}function BEe(t,e,i,r,s,n,o=0){const a=new Array;for(const h of t)for(const d of h)a.push(d[0],d[1],e?d[2]:o);if(!Bn(a,r,0,a,n,0))return!1;let l=0;s.length=0;const c=e||vb(n);for(const h of t){const d=new Array;for(const f of h)c&&i?d.push([a[l++],a[l++],a[l++],f[3]]):c?d.push([a[l++],a[l++],a[l++]]):i?(d.push([a[l++],a[l++],f[2]]),l++):(d.push([a[l++],a[l++]]),l++);s.push(d)}return!0}const gl=$(),X8t=Object.freeze(Object.defineProperty({__proto__:null,canProjectWithoutEngine:ru,getTransformation:DEe,getTransformations:B9e,initializeProjection:lD,isEqualBaseGCS:G9e,isLoaded:$v,isLoadedOrLoad:IEe,isLoadedOrLoadFor:M_,load:nv,project:Id,projectExtent:Z9e,projectMany:nW,projectMultipoint:H9e,projectOrLoad:U9e,projectOrLoadMany:PEe,projectPoint:LEe,projectPolygon:W9e,projectPolyline:q9e,projectWithZConversion:Eb,projectWithoutEngine:gR,requiresLoad:REe,test:j9e,tryProjectWithZConversion:Tb,unload:V9e},Symbol.toStringTag,{value:"Module"}));var oW;let jf=oW=class extends ee{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new oW({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};u([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],jf.prototype,"cols",void 0),u([p({type:Ei,json:{write:!0}})],jf.prototype,"level",void 0),u([p({type:String,json:{write:!0}})],jf.prototype,"levelValue",void 0),u([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],jf.prototype,"origin",void 0),u([p({type:Number,json:{write:!0}})],jf.prototype,"resolution",void 0),u([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],jf.prototype,"rows",void 0),u([p({type:Number,json:{write:!0}})],jf.prototype,"scale",void 0),jf=oW=u([A("esri.layers.support.LOD")],jf);const Jh=jf;let Y9e=class{constructor(e,i,r,s,n=void 0){this.id=e,this.level=i,this.row=r,this.col=s,this.extent=n}};var $0;const Uce=new ei({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let Pa=$0=class extends ee{static create(t={}){const{resolutionFactor:e=1,scales:i,size:r=256,spatialReference:s=Ae.WebMercator,numLODs:n=24}=t;if(!qu(s)){const d=[];if(i)for(let f=0;f<i.length;f++){const m=i[f];d.push(new Jh({level:f,scale:m,resolution:m}))}else{let f=5e-4;for(let m=n-1;m>=0;m--)d.unshift(new Jh({level:m,scale:f,resolution:f})),f*=2}return new $0({dpi:96,lods:d,origin:new ke(0,0,s),size:[r,r],spatialReference:s})}const o=lc(s),a=t.origin?new ke({x:t.origin.x,y:t.origin.y,spatialReference:s}):new ke(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/(Ao(s)*39.37*l),h=[];if(i)for(let d=0;d<i.length;d++){const f=i[d],m=f*c;h.push(new Jh({level:d,scale:f,resolution:m}))}else{let d=TS(s)?512/r*5916575275917094e-7:256/r*591657527591555e-6;const f=Math.ceil(n/e);h.push(new Jh({level:0,scale:d,resolution:d*c}));for(let m=1;m<f;m++){const y=d/2**e,v=y*c;h.push(new Jh({level:m,scale:y,resolution:v})),d=y}}return new $0({dpi:l,lods:h,origin:a,size:[r,r],spatialReference:s})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const i=lc(t);return t.isWrappable&&!!i&&Math.abs(i.origin[0]-e.x)<=i.dx}return!1}readOrigin(t,e){return ke.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,i=0;const r=[],s=this._levelToLOD={};t&&(e=-1/0,i=1/0,t.forEach(n=>{r.push(n.scale),e=n.scale>e?n.scale:e,i=n.scale<i?n.scale:i,s[n.level]=n})),this._set("scales",r),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const i=Math.floor(t),r=i+1;return e[i]/(e[i]/e[r])**(t-i)}scaleToZoom(t){const e=this.scales,i=e.length-1;let r=0;for(;r<i;r++){const s=e[r],n=e[r+1];if(s<=t)return r;if(n===t)return r+1;if(s>t&&n<t)return r+Math.log(s/t)/Math.log(s/n)}return r}tileAt(t,e,i,r){const s=this.lodAt(t);if(!s)return null;let n,o;if(typeof e=="number")n=e,o=i;else if(rs(e.spatialReference,this.spatialReference))n=e.x,o=e.y,r=i;else{const c=Q3(e,this.spatialReference);if(c==null)return null;n=c.x,o=c.y,r=i}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return r||(r=new Y9e(null,0,0,0,Qt())),r.level=t,r.row=Math.floor((this.origin.y-o)/l+.001),r.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(r),r}updateTileInfo(t,e=$0.ExtrapolateOptions.NONE){let i=this.lodAt(t.level);if(!i&&e===$0.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<t.level&&(i=o)}if(!i)return;const r=t.level-i.level,s=i.resolution*this.size[0]/2**r,n=i.resolution*this.size[1]/2**r;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=Qt()),t.extent[0]=this.origin.x+t.col*s,t.extent[1]=this.origin.y-(t.row+1)*n,t.extent[2]=t.extent[0]+s,t.extent[3]=t.extent[1]+n}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const i=this.lodAt(e.level);if(i==null)return null;const{resolution:r}=i,s=r*this.size[0],n=r*this.size[1];return t[0]=this.origin.x+e.col*s,t[1]=this.origin.y-(e.row+1)*n,t[2]=t[0]+s,t[3]=t[1]+n,t}lodAt(t){return this._levelToLOD?.[t]??null}clone(){return $0.fromJSON(this.write({}))}getCompatibleForVTL(t){if(this.size[0]!==this.size[1]||this.size[0]===256&&t===512)return null;const e=(this.size[0]===512&&t===256?-1:0)+(this.spatialReference.isGeographic?1:0);if(this.size[0]===t&&e===0)return this;const i=[],r=this.lods.length-e;for(let s=0;s<r;s++){const n=s+e,{scale:o,resolution:a}=n>=0?this.lods[n]:{scale:2*this.lods[0].scale,resolution:2*this.lods[0].resolution};i.push(new Jh({level:s,scale:o,resolution:a}))}return new $0({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let i=0;i<t.length;i++){const r=t[i];this._upsampleLevels[r.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/r.resolution:0},e=r}}};u([p({type:Number,json:{write:!0}})],Pa.prototype,"compressionQuality",void 0),u([p({type:Number,json:{write:!0}})],Pa.prototype,"dpi",void 0),u([p({type:String,json:{read:Uce.read,write:Uce.write,origins:{"web-scene":{read:!1,write:!1}}}})],Pa.prototype,"format",void 0),u([p({readOnly:!0})],Pa.prototype,"isWrappable",null),u([p({type:ke,json:{write:!0}})],Pa.prototype,"origin",void 0),u([me("origin")],Pa.prototype,"readOrigin",null),u([p({type:[Jh],value:null,json:{write:!0}})],Pa.prototype,"lods",null),u([p({readOnly:!0})],Pa.prototype,"scales",void 0),u([p({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],Pa.prototype,"size",void 0),u([me("size",["rows","cols"])],Pa.prototype,"readSize",null),u([ge("size",{cols:{type:Ei},rows:{type:Ei}})],Pa.prototype,"writeSize",null),u([p({type:Ae,json:{write:!0}})],Pa.prototype,"spatialReference",void 0),Pa=$0=u([A("esri.layers.support.TileInfo")],Pa),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(Pa||(Pa={}));const yR=Pa,Hk={widthBreakpoint:{getValue(t){const e=t.viewSize[0],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,i=e[0],r=e[1],s=this.values;return r>=i?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},A6={xsmall:544,small:768,medium:992,large:1200};function J9e(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function M6(t,e){return e?Hk[t].valueToClassName[e].split(" "):[]}const VEe=t=>{let e=class extends t{constructor(...i){super(...i),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=A6}initialize(){this.addHandles(H(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Nt))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(i){if(i!==this._get("breakpoints")){if(!J9e(i)){const r=JSON.stringify(A6,null,2);console.warn("provided breakpoints are not valid, using defaults:"+r),i=A6}this._set("breakpoints",{...i})}}_updateClassNames(){if(!this.container)return;const i=tc.acquire(),r=tc.acquire();let s,n=!1;for(s in Hk){const o=this[s],a=Hk[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,M6(s,o).forEach(l=>r.push(l)),M6(s,a).forEach(l=>i.push(l)))}n&&(this._applyClassNameChanges(i,r),tc.release(i),tc.release(r))}_applyClassNameChanges(i,r){const s=this.container;s&&(r.forEach(n=>s.classList.remove(n)),i.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const i=this.container;if(!i)return;let r;for(r in Hk)M6(r,this[r]).forEach(s=>i.classList.remove(s))}};return u([p()],e.prototype,"breakpoints",null),u([p()],e.prototype,"orientation",void 0),u([p()],e.prototype,"widthBreakpoint",void 0),u([p()],e.prototype,"heightBreakpoint",void 0),e=u([A("esri.views.BreakpointsOwner")],e),e};function FV(t){return typeof t=="string"?document.getElementById(t):t??null}function Bce(t,e){for(;;){const i=t.firstChild;if(!i)break;e.appendChild(i)}}let Hy=class extends ue{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(e,i,r={}){return this._installWatch(e,i,r,H)}addWhen(e,i,r={}){return this._installWatch(e,i,r,gn)}addOnCollectionChange(e,i,{initial:r=!1,final:s=!1}={}){const n=++this._handleId;return this.addHandles([io(e,"after-changes",this._createSyncUpdatingCallback(),Gt),io(e,"change",i,{onListenerAdd:r?o=>i({added:o.toArray(),removed:[]}):void 0,onListenerRemove:s?o=>i({added:[],removed:o.toArray()}):void 0})],n),$i(()=>this.removeHandles(n))}addPromise(e){if(e==null)return e;const i=++this._handleId;this.addHandles($i(()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this.hasHandles(IL)||this._set("updating",!1))}),i),this._pendingPromises.add(e),this._set("updating",!0);const r=()=>this.removeHandles(i);return e.then(r,r),e}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set("updating",!1)}_installWatch(e,i,r={},s){const n=++this._handleId;r.sync||this._installSyncUpdatingWatch(e,n);const o=s(e,i,r);return this.addHandles(o,n),$i(()=>this.removeHandles(n))}_installSyncUpdatingWatch(e,i){const r=this._createSyncUpdatingCallback(),s=H(e,r,{sync:!0,equals:()=>!1});return this.addHandles(s,i),s}_createSyncUpdatingCallback(){return()=>{this.removeHandles(IL),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this.addHandles(mA(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this.removeHandles(IL))}),IL)}}};u([p({readOnly:!0})],Hy.prototype,"updating",void 0),Hy=u([A("esri.core.support.UpdatingHandles")],Hy);const IL=-42;/*!
 * @esri/arcgis-html-sanitizer - v4.1.0 - Tue Dec 03 2024 09:13:28 GMT-0500 (Eastern Standard Time)
 * Copyright (c) 2024 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Kz=function(){return Kz=Object.assign||function(e){for(var i,r=1,s=arguments.length;r<s;r++){i=arguments[r];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},Kz.apply(this,arguments)},aW={exports:{}},yn={},lW={exports:{}},MS={};function jEe(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function X9e(t,e,i){}function K9e(t,e,i){}var Q9e=/javascript\s*\:/img;function e7e(t,e){return Q9e.test(e)?"":e}MS.whiteList=jEe();MS.getDefaultWhiteList=jEe;MS.onAttr=X9e;MS.onIgnoreAttr=K9e;MS.safeAttrValue=e7e;var t7e={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,s;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,s=t.length;r<s;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},nM=t7e;function i7e(t,e){t=nM.trimRight(t),t[t.length-1]!==";"&&(t+=";");var i=t.length,r=!1,s=0,n=0,o="";function a(){if(!r){var h=nM.trim(t.slice(s,n)),d=h.indexOf(":");if(d!==-1){var f=nM.trim(h.slice(0,d)),m=nM.trim(h.slice(d+1));if(f){var y=e(s,o.length,f,m,h);y&&(o+=y+"; ")}}}s=n+1}for(;n<i;n++){var l=t[n];if(l==="/"&&t[n+1]==="*"){var c=t.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,r=!1}else l==="("?r=!0:l===")"?r=!1:l===";"?r||a():l===`
`&&a()}return nM.trim(o)}var r7e=i7e,RL=MS,s7e=r7e;function Vce(t){return t==null}function n7e(t){var e={};for(var i in t)e[i]=t[i];return e}function GEe(t){t=n7e(t||{}),t.whiteList=t.whiteList||RL.whiteList,t.onAttr=t.onAttr||RL.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||RL.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||RL.safeAttrValue,this.options=t}GEe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,s=i.onAttr,n=i.onIgnoreAttr,o=i.safeAttrValue,a=s7e(t,function(l,c,h,d,f){var m=r[h],y=!1;if(m===!0?y=m:typeof m=="function"?y=m(d):m instanceof RegExp&&(y=m.test(d)),y!==!0&&(y=!1),d=o(h,d),!!d){var v={position:c,sourcePosition:l,source:f,isWhite:y};if(y){var _=s(h,d,v);return Vce(_)?h+":"+d:_}else{var _=n(h,d,v);if(!Vce(_))return _}}});return a};var o7e=GEe;(function(t,e){var i=MS,r=o7e;function s(o,a){var l=new r(a);return l.process(o)}e=t.exports=s,e.FilterCSS=r;for(var n in i)e[n]=i[n]})(lW,lW.exports);var kte=lW.exports,zte={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,s;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,s=t.length;r<s;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,i=e.exec(t);return i?i.index:-1}},a7e=kte.FilterCSS,l7e=kte.getDefaultWhiteList,Qz=zte;function HEe(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var qEe=new a7e;function c7e(t,e,i){}function u7e(t,e,i){}function h7e(t,e,i){}function d7e(t,e,i){}function WEe(t){return t.replace(f7e,"&lt;").replace(m7e,"&gt;")}function p7e(t,e,i,r){if(i=QEe(i),e==="href"||e==="src"){if(i=Qz.trim(i),i==="#")return"#";if(!(i.substr(0,7)==="http://"||i.substr(0,8)==="https://"||i.substr(0,7)==="mailto:"||i.substr(0,4)==="tel:"||i.substr(0,11)==="data:image/"||i.substr(0,6)==="ftp://"||i.substr(0,2)==="./"||i.substr(0,3)==="../"||i[0]==="#"||i[0]==="/"))return""}else if(e==="background"){if(PL.lastIndex=0,PL.test(i))return""}else if(e==="style"){if(jce.lastIndex=0,jce.test(i)||(Gce.lastIndex=0,Gce.test(i)&&(PL.lastIndex=0,PL.test(i))))return"";r!==!1&&(r=r||qEe,i=r.process(i))}return i=e2e(i),i}var f7e=/</g,m7e=/>/g,g7e=/"/g,y7e=/&quot;/g,v7e=/&#([a-zA-Z0-9]*);?/gim,_7e=/&colon;?/gim,b7e=/&newline;?/gim,PL=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,jce=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,Gce=/u\s*r\s*l\s*\(.*/gi;function ZEe(t){return t.replace(g7e,"&quot;")}function YEe(t){return t.replace(y7e,'"')}function JEe(t){return t.replace(v7e,function(i,r){return r[0]==="x"||r[0]==="X"?String.fromCharCode(parseInt(r.substr(1),16)):String.fromCharCode(parseInt(r,10))})}function XEe(t){return t.replace(_7e,":").replace(b7e," ")}function KEe(t){for(var e="",i=0,r=t.length;i<r;i++)e+=t.charCodeAt(i)<32?" ":t.charAt(i);return Qz.trim(e)}function QEe(t){return t=YEe(t),t=JEe(t),t=XEe(t),t=KEe(t),t}function e2e(t){return t=ZEe(t),t=WEe(t),t}function w7e(){return""}function x7e(t,e){typeof e!="function"&&(e=function(){});var i=!Array.isArray(t);function r(o){return i?!0:Qz.indexOf(t,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(r(o))if(l.isClosing){var c="[/removed]",h=l.position+c.length;return s.push([n!==!1?n:l.position,h]),n=!1,c}else return n||(n=l.position),"[removed]";else return e(o,a,l)},remove:function(o){var a="",l=0;return Qz.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function S7e(t){for(var e="",i=0;i<t.length;){var r=t.indexOf("<!--",i);if(r===-1){e+=t.slice(i);break}e+=t.slice(i,r);var s=t.indexOf("-->",r);if(s===-1)break;i=s+3}return e}function T7e(t){var e=t.split("");return e=e.filter(function(i){var r=i.charCodeAt(0);return r===127?!1:r<=31?r===10||r===13:!0}),e.join("")}yn.whiteList=HEe();yn.getDefaultWhiteList=HEe;yn.onTag=c7e;yn.onIgnoreTag=u7e;yn.onTagAttr=h7e;yn.onIgnoreTagAttr=d7e;yn.safeAttrValue=p7e;yn.escapeHtml=WEe;yn.escapeQuote=ZEe;yn.unescapeQuote=YEe;yn.escapeHtmlEntities=JEe;yn.escapeDangerHtml5Entities=XEe;yn.clearNonPrintableCharacter=KEe;yn.friendlyAttrValue=QEe;yn.escapeAttrValue=e2e;yn.onIgnoreTagStripAll=w7e;yn.StripTagBody=x7e;yn.stripCommentTag=S7e;yn.stripBlankChar=T7e;yn.cssFilter=qEe;yn.getDefaultCSSWhiteList=l7e;var kV={},m_=zte;function E7e(t){var e=m_.spaceIndex(t),i;return e===-1?i=t.slice(1,-1):i=t.slice(1,e+1),i=m_.trim(i).toLowerCase(),i.slice(0,1)==="/"&&(i=i.slice(1)),i.slice(-1)==="/"&&(i=i.slice(0,-1)),i}function C7e(t){return t.slice(0,2)==="</"}function $7e(t,e,i){var r="",s=0,n=!1,o=!1,a=0,l=t.length,c="",h="";e:for(a=0;a<l;a++){var d=t.charAt(a);if(n===!1){if(d==="<"){n=a;continue}}else if(o===!1){if(d==="<"){r+=i(t.slice(s,a)),n=a,s=a;continue}if(d===">"){r+=i(t.slice(s,n)),h=t.slice(n,a+1),c=E7e(h),r+=e(n,r.length,c,h,C7e(h)),s=a+1,n=!1;continue}if(d==='"'||d==="'")for(var f=1,m=t.charAt(a-f);m.trim()===""||m==="=";){if(m==="="){o=d;continue e}m=t.charAt(a-++f)}}else if(d===o){o=!1;continue}}return s<t.length&&(r+=i(t.substr(s))),r}var A7e=/[^a-zA-Z0-9\\_:.-]/gim;function M7e(t,e){var i=0,r=0,s=[],n=!1,o=t.length;function a(f,m){if(f=m_.trim(f),f=f.replace(A7e,"").toLowerCase(),!(f.length<1)){var y=e(f,m||"");y&&s.push(y)}}for(var l=0;l<o;l++){var c=t.charAt(l),h,d;if(n===!1&&c==="="){n=t.slice(i,l),i=l+1,r=t.charAt(i)==='"'||t.charAt(i)==="'"?i:I7e(t,l+1);continue}if(n!==!1&&l===r){if(d=t.indexOf(c,l+1),d===-1)break;h=m_.trim(t.slice(r+1,d)),a(n,h),n=!1,l=d,i=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),n===!1)if(d=O7e(t,l),d===-1){h=m_.trim(t.slice(i,l)),a(h),n=!1,i=l+1;continue}else{l=d-1;continue}else if(d=R7e(t,l-1),d===-1){h=m_.trim(t.slice(i,l)),h=Hce(h),a(n,h),n=!1,i=l+1;continue}else continue}return i<t.length&&(n===!1?a(t.slice(i)):a(n,Hce(m_.trim(t.slice(i))))),m_.trim(s.join(" "))}function O7e(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="="?e:-1}}function I7e(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="'"||i==='"'?e:-1}}function R7e(t,e){for(;e>0;e--){var i=t[e];if(i!==" ")return i==="="?e:-1}}function P7e(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function Hce(t){return P7e(t)?t.substr(1,t.length-2):t}kV.parseTag=$7e;kV.parseAttr=M7e;var D7e=kte.FilterCSS,$p=yn,t2e=kV,L7e=t2e.parseTag,N7e=t2e.parseAttr,qk=zte;function DL(t){return t==null}function F7e(t){var e=qk.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=qk.trim(t.slice(e+1,-1));var i=t[t.length-1]==="/";return i&&(t=qk.trim(t.slice(0,-1))),{html:t,closing:i}}function k7e(t){var e={};for(var i in t)e[i]=t[i];return e}function z7e(t){var e={};for(var i in t)Array.isArray(t[i])?e[i.toLowerCase()]=t[i].map(function(r){return r.toLowerCase()}):e[i.toLowerCase()]=t[i];return e}function i2e(t){t=k7e(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=$p.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=z7e(t.whiteList||t.allowList):t.whiteList=$p.whiteList,t.onTag=t.onTag||$p.onTag,t.onTagAttr=t.onTagAttr||$p.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||$p.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||$p.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||$p.safeAttrValue,t.escapeHtml=t.escapeHtml||$p.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new D7e(t.css))}i2e.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,s=i.onTag,n=i.onIgnoreTag,o=i.onTagAttr,a=i.onIgnoreTagAttr,l=i.safeAttrValue,c=i.escapeHtml,h=e.cssFilter;i.stripBlankChar&&(t=$p.stripBlankChar(t)),i.allowCommentTag||(t=$p.stripCommentTag(t));var d=!1;i.stripIgnoreTagBody&&(d=$p.StripTagBody(i.stripIgnoreTagBody,n),n=d.onIgnoreTag);var f=L7e(t,function(m,y,v,_,b){var w={sourcePosition:m,position:y,isClosing:b,isWhite:Object.prototype.hasOwnProperty.call(r,v)},x=s(v,_,w);if(!DL(x))return x;if(w.isWhite){if(w.isClosing)return"</"+v+">";var S=F7e(_),C=r[v],T=N7e(S.html,function(M,I){var P=qk.indexOf(C,M)!==-1,D=o(v,M,I,P);return DL(D)?P?(I=l(v,M,I,h),I?M+'="'+I+'"':M):(D=a(v,M,I,P),DL(D)?void 0:D):D});return _="<"+v,T&&(_+=" "+T),S.closing&&(_+=" /"),_+=">",_}else return x=n(v,_,w),DL(x)?c(_):x},c);return d&&(f=d.remove(f)),f};var U7e=i2e;(function(t,e){var i=yn,r=kV,s=U7e;function n(a,l){var c=new s(l);return c.process(a)}e=t.exports=n,e.filterXSS=n,e.FilterXSS=s,function(){for(var a in i)e[a]=i[a];for(var l in r)e[l]=r[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=t.exports)})(aW,aW.exports);var nT=aW.exports,B7e=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},V7e=function(){function t(e,i){var r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],article:["style"],aside:["style"],audio:["autoplay","controls","loop","muted","preload"],b:[],blockquote:["style"],br:[],code:["style"],dd:["style"],del:["style"],details:["open","style"],div:["align","aria-hidden","aria-label","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],footer:["style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],header:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],main:["style"],mark:["style"],nav:["style"],ol:[],p:["style"],pre:["style"],section:["style"],source:["media","src","type"],span:["aria-hidden","aria-label","style"],strong:[],sub:["style"],summary:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],time:["style"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.arcgisCSSWhiteList=Kz(Kz({},nT.getDefaultCSSWhiteList()),{"align-items":!0,"align-self":!0,flex:!0,"flex-basis":!0,"flex-direction":!0,"flex-flow":!0,"flex-grow":!0,"flex-shrink":!0,"flex-wrap":!0,float:!0,gap:!0,grid:!0,"grid-area":!0,"grid-auto-columns":!0,"grid-auto-flow":!0,"grid-auto-rows":!0,"grid-column":!0,"grid-column-end":!0,"grid-column-start":!0,"grid-row":!0,"grid-row-end":!0,"grid-row-start":!0,"grid-template":!0,"grid-template-areas":!0,"grid-template-columns":!0,"grid-template-rows":!0,"justify-content":!0,"justify-items":!0,"justify-self":!0,"line-height":!0,overflow:!0}),this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?r.sanitizeUrl(a):nT.safeAttrValue(n,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var s;e&&!i?s=e:e&&i?(s=Object.create(this.arcgisFilterOptions),s.css={whiteList:this.arcgisCSSWhiteList},Object.keys(e).forEach(function(n){if(n==="whiteList")s.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,e.whiteList||{}]);else if(n==="css"){var o=e.css.whiteList;o!=null&&e.css instanceof Object&&Object.keys(o).forEach(function(a){return s.css.whiteList[a]=o[a]})}else s[n]=e[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList,s.css={whiteList:this.arcgisCSSWhiteList}),this.xssFilterOptions=s,this._xssFilter=new nT.FilterXSS(s)}return t.prototype.sanitize=function(e,i){switch(i===void 0&&(i={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,i);default:return i.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,i){var r=(i??{}).isProtocolRequired,s=r===void 0?!0:r,n=this._trim(e.substring(0,e.indexOf(":"))),o=e==="/",a=/^#/.test(e),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?nT.escapeAttrValue(e):!n&&!s?nT.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,i,r,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,i,r,s):nT.safeAttrValue(e,i,r,s)},t.prototype.validate=function(e,i){i===void 0&&(i={});var r=this.sanitize(e,i);return{isValid:e===r,sanitized:r}},t.prototype.encodeHTML=function(e){var i=this;return String(e).replace(/[&<>"'\/]/g,function(r){return i._entityMap[r]})},t.prototype.encodeAttrValue=function(e){var i=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(r,s){return i.test(r)?r:"&#x".concat(Number(e.charCodeAt(s)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var i={};return e.forEach(function(r){Object.keys(r).forEach(function(s){Array.isArray(r[s])&&Array.isArray(i[s])?i[s]=i[s].concat(r[s]):i[s]=r[s]})}),i},t.prototype._iterateOverObject=function(e,i){var r=this;i===void 0&&(i={});try{var s=!1,n=void 0;if(Array.isArray(e))n=e.reduce(function(a,l){var c=r.validate(l,i);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(B7e(e)){var o=Object.keys(e);n=o.reduce(function(a,l){var c=e[l],h=r.validate(c,i);return h.isValid?a[l]=c:(s=!0,a[l]=h.sanitized),a},{})}else return i.allowUndefined&&typeof e>"u"?void 0:null;return s?n:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const zV=new Map;function r2e(){zV.clear()}function j7e(t){return zV.get(t)}function G7e(t,e){zV.set(t,e)}function O6(t){zV.delete(t)}function s2e(...t){const e=tc.acquire();for(let r=0;r<t.length;r++){const s=t[r],n=typeof s;if(n==="string")e.push(s);else if(Array.isArray(s))e.push.apply(e,s);else if(n==="object")for(const o in s)s[o]&&e.push(o)}const i=e.join(" ");return tc.release(e),i}const eqt=(()=>{const t=new Map,e=new ResizeObserver(r=>{r2e();for(const s of r)t.get(s.target)?.(s)}),i=(r,s,n)=>(t.set(r,s),e.observe(r,n),$i(()=>{e.unobserve(r),t.delete(r)}));return(r,s,n)=>{let o=null;return q3([H(()=>typeof r=="function"?r():r,a=>{o?.remove(),a&&(o=i(a,s,n))},St),$i(()=>o?.remove())])}})();function H7e(t){const e=t?.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function tqt(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function iqt(t){const e="data-node-ref";this[t.getAttribute(e)]=t}const q7e=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],W7e=q7e.reduce((t,e)=>(t[e]=[],t),{}),Z7e=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],n2e=new V7e({whiteList:W7e,onTagAttr:(t,e,i)=>{const r=`${e}="${i}"`;if(Z7e.includes(e))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function Y7e(t){return t==="Enter"||t===" "}async function J7e(t,e){await ije(Y3(e));const i=typeof t=="function"?t():t;i&&("setFocus"in i&&typeof i.setFocus=="function"?await i.setFocus():i instanceof HTMLElement&&i.focus())}const o2e="http://www.w3.org/",UV=`${o2e}2000/svg`,a2e=`${o2e}1999/xlink`;let qce=[],Ute=(t,e)=>{let i={};return Object.keys(t).forEach(r=>{i[r]=t[r]}),e&&Object.keys(e).forEach(r=>{i[r]=e[r]}),i},Bte=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),l2e=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},X7e=(t,e,i)=>{if(e.vnodeSelector!==""){for(let r=i;r<t.length;r++)if(Bte(t[r],e))return r}return-1},I6=(t,e,i,r)=>{let s=t[e];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let o=0;o<t.length;o++)if(o!==e){let a=t[o];if(Bte(a,s))throw new Error(`${i.vnodeSelector} had a ${s.vnodeSelector} child ${r==="added"?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},K7e=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},cW=[],uW=!1,c2e=t=>{(t.children||[]).forEach(c2e),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},Wce=()=>{uW=!1,cW.forEach(c2e),cW.length=0},Zce=t=>{cW.push(t),uW||(uW=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(Wce,{timeout:16}):setTimeout(Wce,16))},Yce=t=>{let e=t.domNode;if(t.properties){let i=t.properties.exitAnimation;if(i)return e.style.pointerEvents="none",void i(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),Zce(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),Zce(t))},Q7e=(t,e,i)=>{if(!e)return;let r=i.eventHandlerInterceptor,s=Object.keys(e),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=e[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")dW(t,l,!0);else if(a==="classes"){let c=Object.keys(l),h=c.length;for(let d=0;d<h;d++){let f=c[d];l[f]&&t.classList.add(f)}}else if(a==="styles"){let c=Object.keys(l),h=c.length;for(let d=0;d<h;d++){let f=c[d],m=l[f];m&&(l2e(m),i.styleApplyer(t,f,m))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(r&&(l=r(a,l,t,e)),a==="oninput"&&function(){let h=l;l=function(d){h.apply(this,[d]),d.target["oninput-value"]=d.target.value}}()),t[a]=l):i.namespace===UV?a==="href"?t.setAttributeNS(a2e,a,l):t.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?t[a]=n2e.sanitize(l):hW(t)&&a in t?t[a]=l:t.setAttribute(a,l):t[a]=l}}};function hW(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let eU,eWe=(t,e,i)=>{if(e)for(let r of e)vR(r,t,void 0,i)},u2e=(t,e,i)=>{eWe(t,e.children,i),e.text&&(t.textContent=e.text),Q7e(t,e.properties,i),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,i,e.vnodeSelector,e.properties,e.children])},vR=(t,e,i,r)=>{let s,n=0,o=t.vnodeSelector,a=e.ownerDocument;if(o==="")s=t.domNode=a.createTextNode(t.text),i!==void 0?e.insertBefore(s,i):e.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let h=o.charAt(n-1),d=o.slice(n,l);h==="."?s.classList.add(d):h==="#"?s.id=d:(d==="svg"&&(r=Ute(r,{namespace:UV})),r.namespace!==void 0?s=t.domNode=a.createElementNS(r.namespace,d):(s=t.domNode=t.domNode||a.createElement(d),d==="input"&&t.properties&&t.properties.type!==void 0&&s.setAttribute("type",t.properties.type)),i!==void 0?e.insertBefore(s,i):s.parentNode!==e&&e.appendChild(s)),n=l+1}}u2e(s,t,r)}},dW=(t,e,i)=>{e&&e.split(" ").forEach(r=>{r&&t.classList.toggle(r,i)})},tWe=(t,e,i,r)=>{if(!i)return;let s=!1,n=Object.keys(i),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=i[l],h=e[l];if(l==="class")h!==c&&(dW(t,h,!1),dW(t,c,!0));else if(l==="classes"){let d=t.classList,f=Object.keys(c),m=f.length;for(let y=0;y<m;y++){let v=f[y],_=!!c[v];_!==!!h[v]&&(s=!0,_?d.add(v):d.remove(v))}}else if(l==="styles"){let d=Object.keys(c),f=d.length;for(let m=0;m<f;m++){let y=d[m],v=c[y];v!==h[y]&&(s=!0,v?(l2e(v),r.styleApplyer(t,y,v)):r.styleApplyer(t,y,""))}}else if(c||typeof h!="string"||(c=""),l!=="value"||hW(t)){if(c!==h){let d=typeof c;d==="function"&&r.eventHandlerInterceptor||(r.namespace===UV?l==="href"?t.setAttributeNS(a2e,l,c):t.setAttribute(l,c):d==="string"?l==="innerHTML"?t[l]=n2e.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):hW(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),s=!0)}}else{let d=t[l];d!==c&&(t["oninput-value"]?d===t["oninput-value"]:c!==h)&&(t[l]=c,t["oninput-value"]=void 0),c!==h&&(s=!0)}}return s},iWe=(t,e,i,r,s)=>{if(i===r)return!1;r=r||qce;let n,o=(i=i||qce).length,a=r.length,l=0,c=0,h=!1;for(;c<a;){let d=l<o?i[l]:void 0,f=r[c];if(d!==void 0&&Bte(d,f))h=eU(d,f,s)||h,l++;else{let m=X7e(i,f,l+1);if(m>=0){for(n=l;n<m;n++)Yce(i[n]),I6(i,n,t,"removed");h=eU(i[m],f,s)||h,l=m+1}else vR(f,e,l<o?i[l].domNode:void 0,s),K7e(f),I6(r,c,t,"added")}c++}if(o>l)for(n=l;n<o;n++)Yce(i[n]),I6(i,n,t,"removed");return h};eU=(t,e,i)=>{let r=t.domNode,s=!1;if(t===e)return!1;let n=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let o=r.ownerDocument.createTextNode(e.text);return r.parentNode.replaceChild(o,r),e.domNode=o,s=!0,s}e.domNode=r}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(i=Ute(i,{namespace:UV})),t.text!==e.text&&(n=!0,e.text===void 0?r.removeChild(r.firstChild):r.textContent=e.text),e.domNode=r,n=iWe(e,r,t.children,e.children,i)||n,n=tWe(r,t.properties,e.properties,i)||n,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[r,i,e.vnodeSelector,e.properties,e.children]);return n&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(r,e.properties,t.properties),s};let LL=(t,e)=>({getLastRender:()=>t,update:i=>{if(t.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=t;t=i,eU(r,i,e)},domNode:t.domNode});const rWe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.charAt(0)==="-"?t.style.setProperty(e,i):t.style[e]=i}};let yO=t=>Ute(rWe,t),j_={append:(t,e,i)=>(i=yO(i),vR(e,t,void 0,i),LL(e,i)),insertBefore:(t,e,i)=>(i=yO(i),vR(e,t.parentNode,t,i),LL(e,i)),merge:(t,e,i)=>(i=yO(i),e.domNode=t,u2e(t,e,i),LL(e,i)),replace:(t,e,i)=>(i=yO(i),vR(e,t.parentNode,t,i),t.parentNode.removeChild(t),LL(e,i))},h2e,sWe=(t,e)=>{let i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i};h2e=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let nWe=(t,e)=>{let i=t;return e.forEach(r=>{i=i&&i.children?h2e(i.children,s=>s.domNode===r):void 0}),i},oWe=(t,e,i)=>{let r=function(s){i("domEvent",s);let n=e(),o=sWe(s.currentTarget,n.domNode);o.reverse();let a,l=nWe(n.getLastRender(),o);return t.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),i("domEventProcessed",s),a};return(s,n,o,a)=>r},Jce=t=>{let e,i,r=yO(t),s=r.performanceLogger,n=!0,o=!1,a=[],l=[],c=(d,f,m)=>{let y,v=()=>y;r.eventHandlerInterceptor=oWe(e,v,s),y=d(f,m(),r),a.push(y),l.push(m)},h=()=>{if(i=void 0,n){n=!1,s("renderStart",void 0);for(let d=0;d<a.length;d++){let f=l[d]();s("rendered",void 0),a[d].update(f),s("patched",void 0)}s("renderDone",void 0),n=!0}};return e={renderNow:h,scheduleRender:()=>{i||o||(i=requestAnimationFrame(h))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),o=!0},resume:()=>{o=!1,n=!0,e.scheduleRender()},append:(d,f)=>{c(j_.append,d,f)},insertBefore:(d,f)=>{c(j_.insertBefore,d,f)},merge:(d,f)=>{c(j_.merge,d,f)},replace:(d,f)=>{c(j_.replace,d,f)},detach:d=>{for(let f=0;f<l.length;f++)if(l[f]===d)return l.splice(f,1),a.splice(f,1)[0];throw new Error("renderFunction was not found")}},e},A0=class extends ue{constructor(){super(...arguments),this.items=new Ee,this._watchUpdatingTracking=new Hy,this._callbacks=new Map,this._projector=Jce(),this._hiddenProjector=Jce()}get needsRender(){return this.items.length>0}get updating(){return this._watchUpdatingTracking?.updating??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,i=>{for(const r of i.added){const s=()=>r.render();this._callbacks.set(r,s),this._projector.append(this.surface,s)}for(const r of i.removed){const s=this._projector.detach(this._callbacks.get(r));this.surface.removeChild(s.domNode),this._callbacks.delete(r)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const i=this._hiddenSurface,r=this._hiddenProjector;let s;const n=()=>(s=e.render(),s);r.append(i,n),r.renderNow();const o={left:0,top:0,right:0,bottom:0};if(s?.domNode){const a=s.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(r.detach(n);i.firstChild;)i.removeChild(i.firstChild);return o}overlaps(e,i){const r=this.computeBoundingRect(e),s=this.computeBoundingRect(i);return Math.max(r.left,s.left)<=Math.min(r.right,s.right)&&Math.max(r.top,s.top)<=Math.min(r.bottom,s.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e,i){const r=!!i?.disableDecorations;if(!this.items.some(n=>n.visible&&!(r&&n.isDecoration)))return;const s=e.getContext("2d");s.save(),s.font=this._fontString(),this.items.forEach(n=>{r&&n.isDecoration||(s.save(),n.renderCanvas(s),s.restore())}),s.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};u([p({readOnly:!0})],A0.prototype,"surface",void 0),u([p({readOnly:!0})],A0.prototype,"items",void 0),u([p({readOnly:!0})],A0.prototype,"needsRender",null),u([p({readOnly:!0})],A0.prototype,"_watchUpdatingTracking",void 0),u([p({readOnly:!0})],A0.prototype,"updating",null),A0=u([A("esri.views.overlay.ViewOverlay")],A0);const Xce=A0,R6=[0,0];function aWe(t){const e=(t.ownerDocument||window.document).defaultView,i=t.getBoundingClientRect();return R6[0]=i.left+(e?.pageXOffset??0),R6[1]=i.top+(e?.pageYOffset??0),R6}function Kce(t){t&&(t.textContent="",t.parentNode&&t.parentNode.removeChild(t))}function lWe(t){const e=document.createElement("div");return t.appendChild(e),e}const oT=16,oM=750,cWe=512,uWe=2,d2e=t=>{let e=class extends t{constructor(...i){super(...i),this._freqInfo={freq:oT,time:oM},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([H(()=>this.cursor,r=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",r)}),H(()=>this.navigating,r=>{const{surface:s}=this;s&&s.setAttribute("data-navigating",r.toString())})])}initialize(){this.addHandles([H(()=>this.ui,(i,r)=>this._handleUIChange(i,r),Nt),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui?.destroy(),this.container=null)}get container(){return this._get("container")??null}set container(i){const r=this._get("container"),s=FV(i);if(s||typeof i!="string"||J.getLogger(this).error("#container",`element with id '${i}' not found`),r===s)return;if(this._stopMeasuring(),r&&(r.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(Kce(this.root),this._set("root",null)),this.userContent&&(Bce(this.userContent,r),Kce(this.userContent),this._set("userContent",null))),!s)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);s.classList.add("esri-view");const n=document.createElement("div");n.className="esri-view-user-storage",Bce(s,n),s.appendChild(n),this._set("userContent",n);const o=document.createElement("div");o.className="esri-view-root",s.insertBefore(o,s.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new Xce;o.appendChild(l.surface),this._set("overlay",l),this.addHandles(H(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=qm({render:()=>this.overlay?.render()}):this._overlayRenderTaskHandle=Hi(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",s),this._startMeasuring()}get focused(){const i=document.activeElement===this.surface;return document.hasFocus()&&i}get size(){return[this.width,this.height]}blur(){this.surface?.blur()}focus(){this.surface?.focus()}pageToContainer(i,r,s){const n=this.position;return i-=n?n[0]:0,r-=n?n[1]:0,s?(s[0]=i,s[1]=r):s=[i,r],s}containerToPage(i,r,s){const n=this.position;return i+=n?n[0]:0,r+=n?n[1]:0,s?(s[0]=i,s[1]=r):s=[i,r],s}_handleUIChange(i,r){this.removeHandles("ui"),r&&r!==i&&r.destroy(),i&&(i.view=this,this.addHandles(H(()=>this.root,s=>{i.container=s?lWe(s):null},Nt),"ui")),this._set("ui",i)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const i=this._freqInfo;i.freq=oT,i.time=oM;const r=qm({prepare:o=>{const a=this._measure(),l=this._freqInfo;if(l.time+=o.deltaTime,a&&(l.freq=oT,this._get("resizing")||this._set("resizing",!0)),l.time<l.freq)return;l.time=0;const c=this._position();l.freq=c||a?oT:Math.min(oM,l.freq*uWe),!a&&l.freq>=cWe&&(r.pause(),this._get("resizing")&&this._set("resizing",!1))}}),s=new ResizeObserver(o=>{i.freq=oT,i.time=oM,r.resume()});this.container!=null&&s.observe(this.container);const n=$i(()=>s.disconnect());this.addHandles([fA(window,"resize",()=>{i.freq=oT,i.time=oM,r.resume()}),n,r],"measuring"),this._measure(),this._position()}_measure(){const i=this.container,r=i?i.clientWidth:0,s=i?i.clientHeight:0;if(r===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return r===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",r),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:r,height:s}),!0)}_position(){const i=this.container,r=this.position,s=i&&aWe(i);return!!s&&(!r||s[0]!==r[0]||s[1]!==r[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return u([p()],e.prototype,"container",null),u([p({readOnly:!0})],e.prototype,"focused",null),u([p({readOnly:!0})],e.prototype,"height",void 0),u([p()],e.prototype,"messagesCommon",void 0),u([p({type:Xce})],e.prototype,"overlay",void 0),u([p({readOnly:!0})],e.prototype,"position",void 0),u([p({readOnly:!0})],e.prototype,"resizing",void 0),u([p({readOnly:!0})],e.prototype,"root",void 0),u([p({value:null,readOnly:!0})],e.prototype,"size",null),u([p({readOnly:!0})],e.prototype,"surface",void 0),u([p({readOnly:!0})],e.prototype,"suspended",void 0),u([p({nonNullable:!0})],e.prototype,"ui",void 0),u([p({readOnly:!0})],e.prototype,"userContent",void 0),u([p({readOnly:!0})],e.prototype,"width",void 0),u([p()],e.prototype,"widthBreakpoint",void 0),e=u([A("esri.views.DOMContainer")],e),e},hWe=X("mac")?"Meta":"Control",dWe=new Set(["Alt","Control","Meta","Shift","Ctrl","Primary"]),pWe=t=>dWe.has(t);let fWe=class{constructor(e,i=[]){this.eventType=e,this.keyModifiers=i}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const i=e.modifiers;for(const r of this.keyModifiers)if(!i.has(r))return!1;return!0}},ss=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const i=this._incoming[e];for(const r of i)this._incomingEventMatches.push(r.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager||(e.setEventCallback(i=>this._handleEvent(i)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,i,r){let s;typeof i=="function"?(r=i,s=[]):s=i||[];const n=typeof e=="string"?new fWe(e,s):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=h=>{const d=this._incoming[h.match.eventType];if(d){const f=d.indexOf(h);d.splice(f,1),o(),this._manager&&this._manager.updateDependencies()}},l=new mWe(n,r,{onPause:a,onRemove:a,onResume:h=>{const d=this._incoming[h.match.eventType];d&&!d.includes(h)&&(d.push(h),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const i=new gWe(e,{onEmit:(r,s,n,o)=>{this._manager?.emit(r.eventType,s,n,o)},onRemove:r=>{delete this._outgoing[r.eventType],this._manager?.updateDependencies()}});return this._outgoing[e]=i,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),i}startCapturingPointer(e){this._manager?.setPointerCapture(e,!0)}stopCapturingPointer(e){this._manager?.setPointerCapture(e,!1)}refreshHasPendingInputs(){this._manager?.refreshHasPendingInputs()}_onUninstall(){this._manager&&(this.onUninstall(),this._manager=null)}_handleEvent(e){const i=this._incoming[e.type];if(i){for(const r of i)if(r.match.matches(e)&&(r.callback?.(e),e.shouldStopPropagation()))break}}},mWe=class{constructor(e,i,r){this.match=e,this._callback=i,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},gWe=class{constructor(e,i){this.eventType=e,this._removed=!1,this._handler=i}emit(e,i,r){this._removed||this._handler.onEmit(this,e,i,r)}remove(){this._removed=!0,this._handler.onRemove(this)}},yWe=class extends ss{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",i=>this._update(i.data))}_update(e){const i=e.native.pointerType==="touch"?"touch":"mouse",{x:r,y:s}=e;i===this._value&&this._x===r&&this._y===s||(this._value=i,this._x=r,this._y=s,this._onChange(i,r,s))}},vWe=class{constructor(e,i){this._observable=new rD,this._value=e,this._equalityFunction=i}get value(){return It(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}};function xa(t,e=_1e){return new vWe(t,e)}let _We=class extends ss{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=xa(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},ov=class{constructor(e,i){this._owner=i,this._properties={},this._afterDispatchHandle=null;for(const r in e){const s=e[r],n=new Q1e(s,void 0,void 0,2,2);this._properties[r]={pool:n,acquired:[]}}this._afterDispatchHandle=dxe(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const i=this._properties[e];for(const r of i.acquired)yle(r)||i.pool.release(r);i.pool.destroy(),i.pool=null,i.acquired=null}this._properties=null,this._owner=null}get(e){const i=this._owner._get(e),r=this._properties[e];let s=r.pool.acquire();for(r.acquired.push(s);s===i;)r.acquired.push(s),s=r.pool.acquire();return s}_release(){for(const e in this._properties){const i=this._properties[e];let r=0;for(const s of i.acquired)yle(s)?i.acquired[r++]=s:i.pool.release(s);i.acquired.length=r}}},Du=class extends ue{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=hWe,this._latestPointerType="mouse",this._propertiesPool=new ov({latestPointerLocation:xWe},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const i of e)this.uninstallHandlers(i);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,i,r=Pm.INTERNAL){if(this._nameToGroup[e]||i.length===0)return;const s={name:e,handlers:i.map(n=>({handler:n,active:!0,removed:!1,priorityIndex:0,groupPriority:r,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=s;for(let n=s.handlers.length-1;n>=0;n--){const o=s.handlers[n];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,c,h,d)=>{this._emitInputEvent(o.priorityIndex+1,a,l,c,d,h)},setPointerCapture:(a,l)=>{this._setPointerCapture(s,o,a,l)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const i=this._nameToGroup[e];i?(i.handlers.forEach(r=>{r.removed=!0,r.uninstallCallback?.()}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):J.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}isModifierKeyDown(e){return this._activeKeyModifiers.has(e)}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,i=new Set;this._handlersPriority=[];for(let r=this._handlers.length-1;r>=0;r--){const s=this._handlers[r];s.priorityIndex=r,this._handlersPriority.push(s)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let r=this._handlersPriority.length-1;r>=0;r--){const s=this._handlersPriority[r];s.priorityIndex=r;let n=s.handler.hasSideEffects;if(!n){for(const o of s.handler.outgoingEventTypes)if(e.has(o)){n=!0;break}}if(n)for(const o of s.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)pWe(a)||i.add(a)}s.active=n}this._sourceEvents=e,this._keyModifiers=i,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,i,r){this._latestPointerType=e;const s=this._get("latestPointerLocation");if(s==null||s.x!==i||s.y!==r){const n=this._propertiesPool.get("latestPointerLocation");n.x=i,n.y=r,this._set("latestPointerLocation",n)}}_onEventReceived(e,i){if(e==="pointer-capture-lost"){const n=i;this._pointerCaptures.delete(n.native.pointerId)}this._updateKeyModifiers(e,i);const r=this.test.timestamp!=null?this.test.timestamp:i.native?i.native.timestamp:void 0,s=i.native?i.native.cancelable:void 0;this._emitInputEventFromSource(e,i,r,s)}_updateKeyModifiers(e,i){if(!i)return;let r=!1;const s=()=>{r||(this._activeKeyModifiers=new Set(this._activeKeyModifiers),r=!0)},n=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(s(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(s(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=i.key;this._keyModifiers.has(a)&&n(a,e==="key-down")}const o=i.native;n("Alt",!!o?.altKey),n("Control",!!o?.ctrlKey),n("Ctrl",!!o?.ctrlKey),n("Shift",!!o?.shiftKey),n("Meta",!!o?.metaKey),n("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new yWe((e,i,r)=>this._setLatestPointer(e,i,r)),this._multiTouchHandler=new _We,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],Pm.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,Pm.INTERNAL)}_setPointerCapture(e,i,r,s){const n=e.name+"-"+i.priorityIndex,o=this._pointerCaptures.get(r.pointerId)||new Set;this._pointerCaptures.set(r.pointerId,o),s?(o.add(n),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(r,!0)):o.has(n)&&(o.delete(n),o.size===0&&(this._pointerCaptures.delete(r.pointerId),this.eventSource&&this.eventSource.setPointerCapture(r,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,i,r,s){this._emitInputEvent(0,e,i,r,s)}_emitInputEvent(e,i,r,s,n,o){const a=s!==void 0?s:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=n!==void 0&&n,c={event:new bWe(i,r,a,o||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new Hz,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:i,priorityIndex:r}=e.events.pop(),s=i.data?.eventId;if(!(s!=null&&this._stoppedPropagationEventIds.has(s)))for(e.currentHandler=this._handlersPriority[r];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!i.shouldStopPropagation()&&e.currentHandler.eventCallback?.(i),i.shouldStopPropagation()){s!=null&&this._stoppedPropagationEventIds.add(s);break}if(i.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:i,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const i=new Hz;i.push(e);const r=this._currentPropagation;if(r){for(;r.events.length;)i.push(r.events.pop());r.events=i,r.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,i){if(e.handler.hasSideEffects!==i.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==i.groupPriority)return e.groupPriority>i.groupPriority?-1:1;for(const r of e.handler.incomingEventMatches)for(const s of i.handler.incomingEventMatches){if(r.eventType!==s.eventType)continue;const n=r.keyModifiers.filter(o=>s.keyModifiers.includes(o));if(n.length===r.keyModifiers.length!=(n.length===s.keyModifiers.length))return r.keyModifiers.length>s.keyModifiers.length?-1:1}return e.priorityIndex>i.priorityIndex?-1:1}_sortHandlersPriority(e){const i=[];for(const r of e){let s=0;for(;s<i.length&&this._compareHandlerPriority(r,i[s])>=0;)s++;i.splice(s,0,r)}return i}get debug(){const e=i=>{const r=this._setPointerCapture;this._setPointerCapture=()=>{},i(),this._setPointerCapture=r};return{injectEvent:(i,r)=>{e(()=>this._onEventReceived(i,r))},disablePointerCapture:e}}};u([p({readOnly:!0})],Du.prototype,"hasPendingInputs",null),u([p({constructOnly:!0})],Du.prototype,"eventSource",void 0),u([p({constructOnly:!0})],Du.prototype,"recognizers",void 0),u([p()],Du.prototype,"_latestPointerType",void 0),u([p()],Du.prototype,"latestPointerType",null),u([p()],Du.prototype,"multiTouchActive",null),u([p({readOnly:!0})],Du.prototype,"latestPointerLocation",void 0),u([p()],Du.prototype,"_paused",void 0),u([p({readOnly:!0})],Du.prototype,"updating",null),Du=u([A("esri.views.input.InputManager")],Du);let bWe=class{constructor(e,i,r,s,n){this.type=e,this.data=i,this.timestamp=r,this.modifiers=s,this.cancelable=n,this._propagationState=g_.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=g_.STOPPED}shouldStopPropagation(){return!!(this._propagationState&g_.STOPPED)}async(e){this._propagationState|=g_.PAUSED;const i=(r,s)=>{this._propagationState&=~g_.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw r;return r};return(typeof e=="function"?e():e).then(r=>i(r,!1),r=>i(r,!0))}shouldPausePropagation(e){return!!(this._propagationState&g_.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var g_;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(g_||(g_={}));const Pm={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let wWe=class{};const xWe=wWe;function Kv(t){return t!=null&&"open"in t&&"declaredClass"in t}function Qce(t){return t!=null&&"declaredClass"in t&&"dockOptions"in t}const p2e=t=>{let e=class extends t{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([H(()=>[this.ui,this.popup],([i,r],s)=>{const n="popup",o="manual";if(s){const[a,l]=s;a&&Kv(l)&&(l.view=null,Qce(l)&&a.remove(l,n))}i&&Kv(r)&&(r.view=this,Qce(r)&&i.add(r,{key:n,position:o,internal:!0}))},Nt),this.on("click",i=>{this.popup&&this.popupEnabled&&(i.pointerType!=="mouse"||i.button===0)&&(Kv(this.popup)?this.popup.viewModel.handleViewClick(i):i.async(async()=>{await this.setupPopup(),Kv(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(i)}))},Pm.WIDGET)]),Cd(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{V(()=>import("./Popup-wZTdBOSD.js").then(i=>i.P),__vite__mapDeps([101,1,102,103,6,104,105,106,107,108,109,41,39,40,110,20,111,112]))})}destroy(){this.destroyed||this.closePopup()}async openPopup(i){if(Kv(this.popup))return this.popup.open(i);try{if(await this.setupPopup(),!this.popup)return void J.getLogger(this).error(new U("view:null-popup","Popup is null and can't be opened"));this.popup.open(i)}catch{}}closePopup(){this._popupSetupTask?.abort(),Kv(this.popup)&&this.popup.close()}async fetchPopupFeatures(i,r){return await this.when(),this._popupHitsToFeatures(await this._getPopupHits(i,r),r)}async setupPopup(){if(this._popupSetupTask?.abort(),this.popup&&!Kv(this.popup))return this._popupSetupTask=ag(async i=>{const{default:r}=await V(()=>import("./Popup-wZTdBOSD.js").then(n=>n.P),__vite__mapDeps([101,1,102,103,6,104,105,106,107,108,109,41,39,40,110,20,111,112]));if(gt(i),!this.popup||Kv(this.popup))return;const s=this.popup;delete s.open,delete s.close,this.popup=new r(s)}),this._popupSetupTask.promise}async _popupHitsToFeatures({location:i,hits:r},s){const n=[],o=[];let a=!1;const l=qVe(s,X("popup-view-fetch-timeout")??TWe),c=f=>{const m=new SWe(f);return o.push(m),n.push(m.promise),m},h=f=>{const m=o.at(-1);return m&&m.layerView===f&&!a?m:c(f)};for(const f of r)"graphic"in f?(h(f.layerView).graphics.push(f.graphic),a=!1):(n.push(f.layerView.fetchPopupFeaturesAtLocation(f.mapPoint,l)),a=!0);o.map(f=>f.resolve(l));const d=GVe(n).then(f=>f.filter(m=>!!m).flat());return{pendingFeatures:n,allGraphicsPromise:d,location:i}}async _getPopupHits(i,r){const{hits:s,location:n}=await this.popupHitTest(i);gt(r);const o=[];for(const a of s)if("graphic"in a){if(this._isValidPopupGraphic(a.graphic,r)){const l=this._isValidPopupGraphicsLayerView(a.layerView)?a.layerView:void 0;o.push({graphic:a.graphic,layerView:l})}}else this._isValidPopupLocationLayerView(a.layerView)&&o.push({mapPoint:a.mapPoint,layerView:a.layerView});return{hits:o,location:n}}_isValidPopupGraphic(i,r){return i&&!!i.getEffectivePopupTemplate(r?.defaultPopupTemplateEnabled)}_isValidPopupGraphicsLayerView(i){return!i||(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesFromGraphics"in i}_isValidPopupLocationLayerView(i){return(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesAtLocation"in i}};return u([p()],e.prototype,"popup",void 0),u([p()],e.prototype,"popupEnabled",void 0),e=u([A("esri.views.PopupView")],e),e};let SWe=class{constructor(e){this.layerView=e,this._resolver=Qo(),this.graphics=[]}get promise(){return this._resolver.promise}resolve(e){const{layerView:i,graphics:r,_resolver:s}=this;if(!i)return s.resolve(r),s.promise;let n;return i.fetchPopupFeaturesFromGraphics(r,e).catch(o=>(n=o,null)).then(o=>{o?s.resolve(o):s.reject(n)}),s.promise}};const TWe=5e3;function df(t,e,i=Ee){return e||(e=new i),e===t||(e.removeAll(),EWe(t)?e.addMany(t):t&&e.add(t)),e}function Vte(t){return t}function EWe(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}var y_;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(y_||(y_={}));let CWe=class{constructor(){this._resolver=Qo(),this._status=y_.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=y_.RESOLVED,this._cleanUp()},()=>{this._status=y_.REJECTED,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===y_.RESOLVED}isRejected(){return this._status===y_.REJECTED}isFulfilled(){return this._status!==y_.PENDING}abort(){this._resolver.reject(vi())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=Qo(),i=[...this._resolvingPromises,e.promise],r=this._allPromise=Promise.all(i);r.then(()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve()},s=>{this.isFulfilled()||this._allPromise!==r||Xr(s)||this._resolver.reject(s)}),e.resolve()}};const f2e=t=>{let e=class extends t{constructor(...i){super(...i),this._promiseProps=new CWe,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(i,r){return this._promiseProps.promise.then(()=>this).then(i,r)}catch(i){return this.when(null,i)}addResolvingPromise(i){i&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in i?i.when():i)}};return e=u([A("esri.core.Promise")],e),e};let vO=class extends f2e(ue){};vO=u([A("esri.core.Promise")],vO),function(t){t.EsriPromiseMixin=f2e}(vO||(vO={}));const Ub=vO,$We="not-loaded",AWe="loading",MWe="failed",eue="loaded",m2e=t=>{let e=class extends t{constructor(...i){super(...i),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(r=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=J3(n,l);this.destroyed&&l(new U("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===$We){this._set("loadStatus",AWe);const a=this._loadController=new AbortController;s({signal:a.signal})}return r(),o}})),this.when(()=>{this._set("loadStatus",eue),this._loadController=null},r=>{this._set("loadStatus",MWe),this._set("loadError",r),this._loadController=null})}destroy(){this._loadController&&(this._loadController=hc(this._loadController),this._promiseProps.abort()),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===eue}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){return this.isFulfilled()||(this._set("loadError",new U("load:cancelled","Cancelled")),this._loadController?.abort(),this._promiseProps.abort()),this}};return u([p({readOnly:!0})],e.prototype,"loaded",null),u([p({readOnly:!0})],e.prototype,"loadError",void 0),u([p({clonable:!1})],e.prototype,"loadStatus",void 0),u([p({type:[sh],readOnly:!0})],e.prototype,"loadWarnings",null),e=u([A("esri.core.Loadable")],e),e};let _O=class extends m2e(Ub){};_O=u([A("esri.core.Loadable")],_O),function(t){function e(i){return!(!i||!i.load)}t.LoadableMixin=m2e,t.isLoadable=e}(_O||(_O={}));const $l=_O;async function cD(t,e){return await t.load(),OWe(t,e)}async function OWe(t,e){const i=[],r=(...n)=>{for(const o of n)o!=null&&(Array.isArray(o)?r(...o):Ee.isCollection(o)?o.forEach(a=>r(a)):$l.isLoadable(o)&&i.push(o))};e(r);let s=null;if(await CHe(i,async n=>{const o=await lf(IWe(n)?n.loadAll():n.load());o.ok!==!1||s||(s=o)}),s)throw s.error;return t}function IWe(t){return"loadAll"in t&&typeof t.loadAll=="function"}let NL;function RWe(t){return NL&&!NL.destroyed||(NL=t()),NL}var pW;const PWe=new ei({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let Sh=pW=class extends ue{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new pW({categories:this.categories?q(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let i=[];this.categories&&(i=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let r="";if(this.extent){const o=Q3(this.extent,Ae.WGS84);o!=null&&(r=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&t.extraQuery&&(s="("+s+")"+t.extraQuery);const n={categories:i,bbox:r,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>PWe.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:{...e,...n}}}};u([p()],Sh.prototype,"categories",void 0),u([p()],Sh.prototype,"disableExtraQuery",void 0),u([p({type:gi})],Sh.prototype,"extent",void 0),u([p()],Sh.prototype,"filter",void 0),u([p()],Sh.prototype,"num",void 0),u([p()],Sh.prototype,"query",void 0),u([p()],Sh.prototype,"sortField",void 0),u([p()],Sh.prototype,"sortOrder",null),u([p()],Sh.prototype,"start",void 0),Sh=pW=u([A("esri.portal.PortalQueryParams")],Sh);const Vp=Sh;var fW;let oo=fW=class extends ee{constructor(t){super(t),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.sourceJSON=null,this.tags=null,this.title=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e&&this.portal?this.portal?.normalizeUrl(`${t}/info/${e}?f=json`):null}get url(){const t=this.portal?.restUrl;return t?t+"/community/groups/"+this.id:null}fetchCategorySchema(t){return this.portal.request(this.url+"/categorySchema",t).then(e=>{const i=e.categorySchema||[];return i.some(r=>r.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",t):i})}fetchMembers(t){return this.portal.request(this.url+"/users",t)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}toJSON(){throw new U("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new fW({sourceJSON:t});return e.read(t),e}queryItems(t,e){let i=Is(Vp,t);const r=this.portal;return parseFloat(r.currentVersion)>5?(i=i||new Vp,r.queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",e)):(i=i?i.clone():new Vp,i.query="group:"+this.id+(i.query?" "+i.query:""),r.queryItems(i,e))}_fetchCategorySchemaSet(t,e){const i=this.portal;return i.fetchSelf(i.authMode,!0,e).then(r=>{const s=r.contentCategorySetsGroupQuery;if(s){const n=new Vp({disableExtraQuery:!0,num:1,query:s});return i.queryGroups(n,e)}throw new U("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(r=>{if(r.total){const s=r.results[0],n=new Vp({num:1,query:`typekeywords:"${t}"`});return s.queryItems(n,e)}throw new U("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(r=>r.total?r.results[0].fetchData("json",e).then(s=>{const n=s?.categorySchema;return n?.length?n:[]}):[])}};u([p()],oo.prototype,"access",void 0),u([p({type:Date})],oo.prototype,"created",void 0),u([p()],oo.prototype,"description",void 0),u([p()],oo.prototype,"id",void 0),u([p()],oo.prototype,"isInvitationOnly",void 0),u([p({type:Date})],oo.prototype,"modified",void 0),u([p()],oo.prototype,"owner",void 0),u([p()],oo.prototype,"portal",void 0),u([p()],oo.prototype,"snippet",void 0),u([p()],oo.prototype,"sortField",void 0),u([p()],oo.prototype,"sortOrder",void 0),u([p()],oo.prototype,"sourceJSON",void 0),u([p()],oo.prototype,"tags",void 0),u([p()],oo.prototype,"thumbnail",void 0),u([p({readOnly:!0})],oo.prototype,"thumbnailUrl",null),u([p()],oo.prototype,"title",void 0),u([p({readOnly:!0})],oo.prototype,"url",null),oo=fW=u([A("esri.portal.PortalGroup")],oo);const mW=oo;let qw=class extends ue{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};u([p()],qw.prototype,"nextQueryParams",void 0),u([p()],qw.prototype,"queryParams",void 0),u([p()],qw.prototype,"results",void 0),u([p()],qw.prototype,"total",void 0),qw=u([A("esri.portal.PortalQueryResult")],qw);const DWe=qw;let Ug=class extends ee{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.portal?.restUrl;return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new U("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};u([p({type:Date})],Ug.prototype,"created",void 0),u([p()],Ug.prototype,"id",void 0),u([p()],Ug.prototype,"portal",void 0),u([p()],Ug.prototype,"title",void 0),u([p({readOnly:!0})],Ug.prototype,"url",null),u([p()],Ug.prototype,"username",void 0),Ug=u([A("esri.portal.PortalFolder")],Ug);const LWe=Ug;var gW;let ps=gW=class extends ee{constructor(t){super(t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userLicenseTypeId=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){const t=this.portal?.restUrl;return t?`${t}/content/users/${this.username}`:null}get url(){const t=this.portal?.restUrl;return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,i=t?.data,r=t?.folder,s={method:"post"};e&&(s.query=e.createPostQuery(),i!=null&&(typeof i=="string"?s.query.text=i:typeof i=="object"&&(s.query.text=JSON.stringify(i))));let n=this.userContentUrl;return r&&(n+="/"+(typeof r=="string"?r:r.id)),this.portal.request(n+"/addItem",s).then(o=>(e.id=o.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}async deleteItem(t,e=!1){let i=this.userContentUrl;t.ownerFolder&&(i+="/"+t.ownerFolder);const r=e?{permanentDelete:!0}:{};await this.portal.request(i+`/items/${t.id}/delete`,{method:"post",query:r}),t.id=null,t.portal=null}async deleteItems(t,e=!1){t=t.slice();const i=this.userContentUrl+"/deleteItems",r=[],s=t.map(n=>n.id);if(s.length){const n={method:"post",query:{items:s.join(","),permanentDelete:e}},o=await this.portal.request(i,n);for(const a of o.results){const l=t.find(d=>a.itemId===d.id),c=a.success;let h=null;c?(l.id=null,l.portal=null):a.error&&(h=new U("portal:delete-item-failed",a.error.message,a.error)),r.push({item:l,success:c,error:h})}}return r}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let i;return i=e&&e.folders?e.folders.map(r=>{const s=LWe.fromJSON(r);return s.portal=this.portal,s}):[],i})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(i=>{const r=mW.fromJSON(i);return r.portal=this.portal,r}):[],e})}async fetchItems(t){t??={};let e=this.userContentUrl??"";t.folder&&(e+="/"+t.folder.id);const{default:i}=await V(()=>Promise.resolve().then(()=>g2e),void 0),r={folders:!1,inRecycleBin:!!t.inRecycleBin||null,foldersContent:!(t.folder||!t.includeSubfolderItems)||null,num:t.num||10,start:t.start||1,sortField:t.sortField||"created",sortOrder:t.sortOrder||"asc"},s=await this.portal.request(e,{query:r});let n;return s?.items?(n=s.items.map(o=>{const a=i.fromJSON(o);return a.portal=this.portal,a}),await Promise.all(n.map(o=>o.load())),{items:n,nextStart:s.nextStart,total:s.total}):{items:[],nextStart:-1,total:0}}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new mW({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new U("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}async restoreItem(t,e){const i=this.userContentUrl,r=e?{folderID:typeof e=="string"?e:e.id}:null;await this.portal.request(i+`/items/${t.id}/restore`,{method:"post",query:r})}toJSON(){throw new U("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new gW({sourceJSON:t});return e.read(t),e}};u([p()],ps.prototype,"access",void 0),u([p({type:Date})],ps.prototype,"created",void 0),u([p()],ps.prototype,"culture",void 0),u([p()],ps.prototype,"description",void 0),u([p()],ps.prototype,"email",void 0),u([p()],ps.prototype,"favGroupId",void 0),u([p()],ps.prototype,"fullName",void 0),u([p({type:Date})],ps.prototype,"modified",void 0),u([p()],ps.prototype,"orgId",void 0),u([p()],ps.prototype,"portal",void 0),u([p()],ps.prototype,"preferredView",void 0),u([p()],ps.prototype,"privileges",void 0),u([p()],ps.prototype,"region",void 0),u([p()],ps.prototype,"role",void 0),u([p()],ps.prototype,"roleId",void 0),u([p()],ps.prototype,"sourceJSON",void 0),u([p()],ps.prototype,"thumbnail",void 0),u([p({readOnly:!0})],ps.prototype,"thumbnailUrl",null),u([p()],ps.prototype,"units",void 0),u([p({readOnly:!0})],ps.prototype,"userContentUrl",null),u([p({readOnly:!0})],ps.prototype,"url",null),u([p()],ps.prototype,"username",void 0),u([p()],ps.prototype,"userLicenseTypeId",void 0),u([p()],ps.prototype,"userType",void 0),ps=gW=u([A("esri.portal.PortalUser")],ps);const jte=ps;var wu;let aM;const tue={PortalGroup:()=>Promise.resolve({default:mW}),PortalItem:()=>V(()=>Promise.resolve().then(()=>g2e),void 0),PortalUser:()=>Promise.resolve({default:jte})};let Ie=wu=class extends ee.JSONSupportMixin($l){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.default3DBasemapQuery=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.layoutGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.hasClassificationSchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.recycleBinEnabled=!1,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=Ir.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useDefault3dBasemap=!1,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){iue.unregister(this),this.defaultBasemap=Ce(this.defaultBasemap),this.defaultDevBasemap=Ce(this.defaultDevBasemap),this.defaultVectorBasemap=Ce(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=Hi(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)Ir.request.trustedServers.includes(e)||Ir.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){const t=this.user?.orgId,e=!t||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get hasAPIKey(){return Jxe(this.url)}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.slice(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=jte.fromJSON(t),e.portal=this),e}load(t){const e=V(()=>Promise.resolve().then(()=>oZe),void 0).then(({default:i})=>{gt(t),aM=i}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(i=>{if(!this.hasAPIKey&&mr){const r=mr;this.credential=r.findCredential(this.restUrl),this.credential||this.authMode!==wu.AUTH_MODE_AUTO&&this.authMode!==wu.AUTH_MODE_NO_PROMPT||(this._esriIdCredentialCreateHandle?.remove(),this._esriIdCredentialCreateHandle=r.on("credential-create",NWe(new WeakRef(this))),iue.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await V(async()=>{const{default:i}=await import("./ElevationLayer-Cx1d9aS6.js");return{default:i}},__vite__mapDeps([113,114,115,116,117]))).default;return t?t.map(i=>new e({id:i.id,url:i.url})):[]}async fetchBasemaps(t,e){const i=await this._fetchBasemaps(t,e);if(e?.include3d===!0&&this.use3dBasemaps!==!1){const r=await this._fetchBasemaps3D(t,e);i.unshift(...r)}return i}async fetchDefault3DBasemap(t){if(!this.useDefault3dBasemap||!this.default3DBasemapQuery||this.default3DBasemapQuery==="none")return null;const e=new Vp;e.query=this.default3DBasemapQuery,e.disableExtraQuery=!0;const i=(await this.queryItems(e,t)).results.find(r=>r.type==="Web Scene");return i?new aM({portalItem:i}):null}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):wa(t)?Promise.reject(vi()):Promise.resolve([])}async fetchClassificationSchema(t){return this.hasClassificationSchema?this.request(this.restUrl+"/portals/self/classification/classificationSchema",t).then(e=>e.classificationSchema):null}fetchFeaturedGroups(t){const e=this.featuredGroups,i=new Vp({num:100,sortField:"title"});if(e?.length){const r=[];for(const s of e)r.push(`(title:"${s.title}" AND owner:${s.owner})`);return i.query=r.join(" OR "),this.queryGroups(i,t).then(s=>s.results)}return wa(t)?Promise.reject(vi()):Promise.resolve([])}fetchRegions(t){const e=this.user?.culture||this.culture||Xc();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){const e=this.user?.culture||this.culture||Xc();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return RWe(()=>new wu)}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,i){const r=this.restUrl+"/portals/self",s={authMode:t,query:{culture:Xc().toLowerCase()},withCredentials:!0,...i};return s.authMode==="auto"&&(s.authMode="no-prompt"),e&&(s.query.default=!0),this.request(r,s)}queryPortal(t,e,i,r){const s=Is(Vp,e),n=o=>this.request(this.restUrl+t,{...s.toRequestOptions(this),...r}).then(a=>{const l=s.clone();return l.start=a.nextStart,new DWe({nextQueryParams:l,queryParams:s,total:a.total,results:wu._resultsToTypedArray(o,{portal:this},a,r)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(Vc(l),a)));return i&&tue[i]?tue[i]().then(({default:o})=>(gt(r),n(o))):n()}signIn(){if(this.hasAPIKey)return this.load().then(()=>{if(!this.user)throw new U("portal:not-authenticated","Unable to authenticate user. Portal.user is missing")});if(this.authMode===wu.AUTH_MODE_ANONYMOUS||this.authMode===wu.AUTH_MODE_NO_PROMPT&&!mr)return Promise.reject(new U("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(i=>{i&&(this.sourceJSON=i,this.read(i))});return mr?mr.getCredential(this.restUrl,{prompt:this.authMode!==wu.AUTH_MODE_NO_PROMPT}).then(e=>t(e)):t(this.credential)}normalizeUrl(t){const e=this.credential?.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,i){return this.request(t,e).then(r=>{const s=wu._resultsToTypedArray(i,{portal:this},r);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():r)).then(()=>s,()=>s)})}request(t,e={}){const i={f:"json",...e.query},{authMode:r=this.authMode===wu.AUTH_MODE_ANONYMOUS||this.authMode===wu.AUTH_MODE_NO_PROMPT?this.authMode:"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=e,c={authMode:r,body:s,cacheBust:n,method:o,query:i,responseType:a,timeout:0,signal:l};return e.withCredentials&&(c.withCredentials=!0),Ci(this._normalizeSSL(t),c).then(h=>h.data)}toJSON(){throw new U("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new wu({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new U("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}async _fetchBasemaps(t,e){const i=new Vp;i.query=t||(this.hasAPIKey?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0;const r=await this.queryGroups(i,e);if(!r.total)return[];const s=r.results[0];i.num=100,i.query='type:"Web Map" -type:"Web Application"',i.sortField=s.sortField||"name",i.sortOrder=s.sortOrder||"desc";const n=await s.queryItems(i,e);return n.total?n.results.filter(o=>o.type==="Web Map").map(o=>new aM({portalItem:o})):[]}async _fetchBasemaps3D(t,e){const i=t||this.basemapGalleryGroupQuery3D;if(!i)return[];if(this.hasAPIKey)return[];const r=new Vp({query:i,disableExtraQuery:!0}),s=await this.queryGroups(r,e);if(!s.total)return[];const n=s.results[0];r.num=100,r.query='type:"Web Scene"',r.sortField=n.sortField||"name",r.sortOrder=n.sortOrder||"desc";const o=await n.queryItems(r,e);return o.total?o.results.filter(a=>a.type==="Web Scene").map(a=>new aM({portalItem:a})):[]}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=aM.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,i,r){let s;if(i){const n=r!=null?r.signal:null;s=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(t||e)&&(s=s.map(o=>{const a=Object.assign(t?t.fromJSON(o):o,e);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};Ie.AUTH_MODE_ANONYMOUS="anonymous",Ie.AUTH_MODE_AUTO="auto",Ie.AUTH_MODE_IMMEDIATE="immediate",Ie.AUTH_MODE_NO_PROMPT="no-prompt",u([p()],Ie.prototype,"access",void 0),u([p()],Ie.prototype,"allSSL",void 0),u([p()],Ie.prototype,"authMode",void 0),u([p()],Ie.prototype,"authorizedCrossOriginDomains",void 0),u([me("authorizedCrossOriginDomains")],Ie.prototype,"readAuthorizedCrossOriginDomains",null),u([p()],Ie.prototype,"basemapGalleryGroupQuery",void 0),u([p({json:{name:"3DBasemapGalleryGroupQuery"}})],Ie.prototype,"basemapGalleryGroupQuery3D",void 0),u([p()],Ie.prototype,"bingKey",void 0),u([p()],Ie.prototype,"canListApps",void 0),u([p()],Ie.prototype,"canListData",void 0),u([p()],Ie.prototype,"canListPreProvisionedItems",void 0),u([p()],Ie.prototype,"canProvisionDirectPurchase",void 0),u([p()],Ie.prototype,"canSearchPublic",void 0),u([p()],Ie.prototype,"canShareBingPublic",void 0),u([p()],Ie.prototype,"canSharePublic",void 0),u([p()],Ie.prototype,"canSignInArcGIS",void 0),u([p()],Ie.prototype,"canSignInIDP",void 0),u([p()],Ie.prototype,"colorSetsGroupQuery",void 0),u([p()],Ie.prototype,"commentsEnabled",void 0),u([p({type:Date})],Ie.prototype,"created",void 0),u([p()],Ie.prototype,"credential",void 0),u([p()],Ie.prototype,"culture",void 0),u([p()],Ie.prototype,"currentVersion",void 0),u([p()],Ie.prototype,"customBaseUrl",void 0),u([p()],Ie.prototype,"default3DBasemapQuery",void 0),u([p()],Ie.prototype,"defaultBasemap",void 0),u([me("defaultBasemap")],Ie.prototype,"readDefaultBasemap",null),u([p()],Ie.prototype,"defaultDevBasemap",void 0),u([me("defaultDevBasemap")],Ie.prototype,"readDefaultDevBasemap",null),u([p({type:gi})],Ie.prototype,"defaultExtent",void 0),u([p()],Ie.prototype,"defaultVectorBasemap",void 0),u([me("defaultVectorBasemap")],Ie.prototype,"readDefaultVectorBasemap",null),u([p()],Ie.prototype,"description",void 0),u([p()],Ie.prototype,"devBasemapGalleryGroupQuery",void 0),u([p()],Ie.prototype,"eueiEnabled",void 0),u([p({readOnly:!0})],Ie.prototype,"extraQuery",null),u([p()],Ie.prototype,"featuredGroups",void 0),u([p()],Ie.prototype,"featuredItemsGroupQuery",void 0),u([p()],Ie.prototype,"galleryTemplatesGroupQuery",void 0),u([p()],Ie.prototype,"layoutGroupQuery",void 0),u([p()],Ie.prototype,"livingAtlasGroupQuery",void 0),u([p({readOnly:!0})],Ie.prototype,"hasAPIKey",null),u([p()],Ie.prototype,"hasCategorySchema",void 0),u([p()],Ie.prototype,"hasClassificationSchema",void 0),u([p()],Ie.prototype,"helpBase",void 0),u([p()],Ie.prototype,"helperServices",void 0),u([p()],Ie.prototype,"helpMap",void 0),u([p()],Ie.prototype,"homePageFeaturedContent",void 0),u([p()],Ie.prototype,"homePageFeaturedContentCount",void 0),u([p()],Ie.prototype,"httpPort",void 0),u([p()],Ie.prototype,"httpsPort",void 0),u([p()],Ie.prototype,"id",void 0),u([p()],Ie.prototype,"ipCntryCode",void 0),u([p({readOnly:!0})],Ie.prototype,"isOrganization",null),u([p()],Ie.prototype,"isPortal",void 0),u([p()],Ie.prototype,"isReadOnly",void 0),u([p({readOnly:!0})],Ie.prototype,"itemPageUrl",null),u([p()],Ie.prototype,"layerTemplatesGroupQuery",void 0),u([p()],Ie.prototype,"maxTokenExpirationMinutes",void 0),u([p({type:Date})],Ie.prototype,"modified",void 0),u([p()],Ie.prototype,"name",void 0),u([p()],Ie.prototype,"portalHostname",void 0),u([p()],Ie.prototype,"portalMode",void 0),u([p()],Ie.prototype,"portalProperties",void 0),u([p()],Ie.prototype,"region",void 0),u([p()],Ie.prototype,"recycleBinEnabled",void 0),u([p({readOnly:!0})],Ie.prototype,"restUrl",null),u([p()],Ie.prototype,"rotatorPanels",void 0),u([p()],Ie.prototype,"showHomePageDescription",void 0),u([p()],Ie.prototype,"sourceJSON",void 0),u([p()],Ie.prototype,"staticImagesUrl",void 0),u([p({json:{name:"2DStylesGroupQuery"}})],Ie.prototype,"stylesGroupQuery2d",void 0),u([p({json:{name:"stylesGroupQuery"}})],Ie.prototype,"stylesGroupQuery3d",void 0),u([p()],Ie.prototype,"supportsHostedServices",void 0),u([p()],Ie.prototype,"symbolSetsGroupQuery",void 0),u([p()],Ie.prototype,"templatesGroupQuery",void 0),u([p()],Ie.prototype,"thumbnail",void 0),u([p({readOnly:!0})],Ie.prototype,"thumbnailUrl",null),u([p()],Ie.prototype,"units",void 0),u([p()],Ie.prototype,"url",void 0),u([p()],Ie.prototype,"urlKey",void 0),u([me("urlKey")],Ie.prototype,"readUrlKey",null),u([p()],Ie.prototype,"user",void 0),u([me("user")],Ie.prototype,"readUser",null),u([p()],Ie.prototype,"use3dBasemaps",void 0),u([p()],Ie.prototype,"useDefault3dBasemap",void 0),u([p()],Ie.prototype,"useStandardizedQuery",void 0),u([p()],Ie.prototype,"useVectorBasemaps",void 0),u([p()],Ie.prototype,"vectorBasemapGalleryGroupQuery",void 0),Ie=wu=u([A("esri.portal.Portal")],Ie);const fn=Ie,iue=new FinalizationRegistry(t=>{t.remove()});function NWe(t){const e=mr;return()=>{const i=t.deref();i&&e.findCredential(i.restUrl)&&i.signIn().catch(()=>{})}}let Bg=class extends ue{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e?.portalItem&&e.path?{...e,path:rue(e.path,e.portalItem)}:e}set path(e){e!=null&&Ku(e)?J.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return rue(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",i){const r=this.cdnUrl;if(r==null)throw new U("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(r,{responseType:e,query:{token:this.portalItem.apiKey,_ts:i?.cacheBust?Date.now():null},signal:i?.signal})}async update(e,i){const{addOrUpdateResources:r}=await V(()=>Promise.resolve().then(()=>uC),void 0);return await r(this.portalItem,[{resource:this,content:e,compress:i?.compress,access:i?.access}],"update",i),this}hasPath(){return this.path!=null}};function rue(t,e){return t==null?t:(t=t.replace(/^\/+/,""),e!=null&&Ku(t)&&(t=jee(t,e.itemUrl)),t?.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}u([p()],Bg.prototype,"portalItem",void 0),u([p({type:String,value:null})],Bg.prototype,"path",null),u([Yt("path")],Bg.prototype,"_castPath",null),u([p({type:String,readOnly:!0})],Bg.prototype,"url",null),u([p({type:String,readOnly:!0})],Bg.prototype,"cdnUrl",null),u([p({type:String,readOnly:!0})],Bg.prototype,"itemRelativeUrl",null),Bg=u([A("esri.portal.PortalItemResource")],Bg);const FWe=Bg;let bO=class extends ue{constructor(e){super(e),this.created=null,this.rating=null}};u([p({type:Date})],bO.prototype,"created",void 0),u([p()],bO.prototype,"rating",void 0),bO=u([A("esri.portal.PortalRating")],bO);const P6=bO;var Ww;const kWe=new Set(["3DTiles Service","CSV","Feature Collection","Feature Service","Feed","GeoJson","Group Layer","Image Service","KML","Map Service","Media Layer","Scene Service","Stream Service","Vector Tile Service","WFS","WMS","WMTS"]),zWe=new Set(["KML","GeoJson","CSV"]);let hi=Ww=class extends ee.JSONSupportMixin($l){static from(t){return uA(Ww,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.classification=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let i=t;return t==="Feature Service"||t==="Feature Collection"?i=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?i=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?i="Scene Layer":t==="Video Service"?i="Video Layer":t==="Scene Package"?i="Scene Layer Package":t==="Stream Service"?i="Feature Layer":t==="Geoprocessing Service"?i=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geoenrichment Service"?i="GeoEnrichment Service":t==="Geocoding Service"?i="Locator":t==="Microsoft Powerpoint"?i="Microsoft PowerPoint":t==="GeoJson"?i="GeoJSON":t==="Globe Service"?i="Globe Layer":t==="Vector Tile Service"?i="Tile Layer":t==="netCDF"?i="NetCDF":t==="Map Service"?i=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t?.toLowerCase().includes("add in")?i=t.replaceAll(/(add in)/gi,"Add-In"):t==="datastore catalog service"?i="Big Data File Share":t==="Compact Tile Package"?i="Tile Package (tpkx)":t==="Raster function template"?i="Raster Function Template":t==="OGCFeatureServer"?i="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?i="Instant App":t==="Insights Page"?i="Insights Report":t==="Excalibur Imagery Project"?i="Excalibur Project":t==="3DTiles Service"?i="3D tiles layer":t==="3DTiles Package"&&(i="3D tiles package"),i}readExtent(t){return t&&t.length?new gi(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){const t=this.type?.toLowerCase()||"",e=this.typeKeywords||[],i="esri/images/portal/",r="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,h=!1,d=!1,f=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(n=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(o=e.includes("Table"),a=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),h=e.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":h?"utilitynetwork":n?"featureshosted":"features"):t==="map service"||t==="wms"||t==="wmts"?(c=e.includes("Spatiotemporal"),d=e.includes("Relational"),s=c||d?"mapimages":n||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages"):s=t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="video service"?e.includes("Live Stream")?"livestreamvideolayer":"videolayer":t==="geoprocessing service"?e.includes("Web Tool")?"tool":"layers":t==="geodata service"?"geodataservice":t==="3dtiles service"?e.includes("3DObject")?"3dobjecttileslayer":e.includes("IntegratedMesh")?"integratedmeshtileslayer":"3dtileslayer":"layers"):t==="web map"||t==="cityengine web scene"?s="maps":t==="web scene"?s=e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?s="instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?s="apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?s="mapsgray":t==="service definition"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="netcdf"||t==="administrative report"?s="datafiles":t==="360 vr experience"?s="360vr":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?s="appsgray":t==="arcgis pro add in"||t==="arcgis pro configuration"?s="addindesktop":t==="pdf"?s="pdf":t==="microsoft word"?s="word":t==="microsoft excel"?s="excel":t==="microsoft powerpoint"?s="ppt":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?s="datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?s="toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?s="layersgray":t==="analysis model"?s="analysismodel":t==="scene package"?s="scenepackage":t==="3dtiles package"?s="3dtileslayerpackage":t==="3dtiles service"?s="3dtileslayer":t==="mobile scene package"?s="mobilescenepackage":t==="tile package"||t==="compact tile package"?s="tilepackage":t==="task file"?s="taskfile":t==="report template"?s="report-template":t==="statistical data collection"?s="statisticaldatacollection":t==="insights workbook"?s="workbook":t==="insights model"?s="insightsmodel":t==="insights page"?s="insightspage":t==="insights theme"?s="insightstheme":t==="hub initiative"?s="hubinitiative":t==="hub page"?s="hubpage":t==="hub site application"?s="hubsite":t==="hub event"?s="hubevent":t==="hub project"?s="hubproject":t==="relational database connection"?s="relationaldatabaseconnection":t==="big data file share"?s="datastorecollection":t==="image collection"?s="imagecollection":t==="desktop style"?s="desktopstyle":t==="style"?s=e.includes("Dictionary")?"dictionarystyle":"style":t==="dashboard"?s="dashboard":t==="raster function template"?s="rasterprocessingtemplate":t==="vector tile package"?s="vectortilepackage":t==="ortho mapping project"?s="orthomappingproject":t==="ortho mapping template"?s="orthomappingtemplate":t==="solution"?s="solutions":t==="geopackage"?s="geopackage":t==="deep learning package"?s="deeplearningpackage":t==="real time analytic"?s="realtimeanalytics":t==="reality mapping project"?s="realitymappingproject":t==="big data analytic"?s="bigdataanalytics":t==="feed"?s="feed":t==="excalibur imagery project"?s="excaliburimageryproject":t==="notebook"?s="notebook":t==="storymap"?s="storymap":t==="survey123 add in"?s="survey123addin":t==="mission"?s="mission":t==="mission report"?s="missionreport":t==="mission template"?s="missiontemplate":t==="quickcapture project"?s="quickcaptureproject":t==="pro report"?s="proreport":t==="pro report template"?s="proreporttemplate":t==="urban model"?s="urbanmodel":t==="urban project"?s="urbanproject":t==="web experience"?s="experiencebuilder":t==="web experience template"?s="webexperiencetemplate":t==="experience builder widget"?s="experiencebuilderwidget":t==="experience builder widget package"?s="experiencebuilderwidgetpackage":t==="workflow"?s="workflow":t==="kernel gateway connection"?s="kernelgatewayconnection":t==="insights script"?s="insightsscript":t==="hub initiative template"?s="hubinitiativetemplate":t==="storymap theme"?s="storymaptheme":t==="knowledge graph"?s="knowledgegraph":t==="knowledge graph layer"?s="knowledgegraphlayer":t==="knowledge studio project"?s="knowledgestudio":t==="native application"?s="nativeapp":t==="native application installer"?s="nativeappinstaller":t==="web link chart"?s="linkchart":t==="knowledge graph web investigation"?s="investigation":t==="ogcfeatureserver"?s="features":t==="pro presentation"?s="propresentation":t==="pro project"?s="proproject":t==="insights workbook package"?s="insightsworkbookpackage":t==="apache parquet"?s="apacheparquet":t==="notebook code snippet library"?s="notebookcodesnippets":t==="suitability model"?s="suitabilitymodel":t==="esri classifier definition"?s="classifierdefinition":t==="esri classification schema"?s="classificationschema":t==="insights data engineering workbook"?s="dataengineeringworkbook":t==="insights data engineering model"?s="dataengineeringmodel":t==="deep learning studio project"?s="deeplearningproject":t==="discussion"?s="discussion":t==="allsource project"?s="allsourceproject":t==="api key"?s="apikey":t==="data pipeline"?s="datapipelines":t==="group layer"?(f=e.includes("Map"),s=f?"layergroup2d":"layergroup"):s=t==="media layer"?"onlinemedialayer":t==="form"?e.includes("Survey123")?"survey":"datafilesgray":t==="csv"?"csv":t==="image"?"image":"maps",s?gs(i+s+r+".png"):null}get isLayer(){return this.type!=null&&kWe.has(this.type)}get itemCdnUrl(){return Jee(this.itemUrl)}get itemPageUrl(){const t=this.portal?.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){const t=this.portal?.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){const t=this.itemUrl,e=this.thumbnail;return t&&e?this.portal?.normalizeUrl(`${t}/info/${e}?f=json`)??null:null}get userItemUrl(){const t=this.portal?.restUrl;if(!t)return null;const e=this.owner||this.portal?.user?.username;return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=fn.getDefault()),i=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:t!=null?t.signal:null,query:{token:this.apiKey}}):{}).then(r=>{this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(i),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}},i=t instanceof P6?t.rating:t;return i==null||isNaN(i)||typeof t!="number"||(e.query.rating=i),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new P6({rating:i,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:q(this.applicationProxies),avgRating:this.avgRating,categories:q(this.categories),classification:q(this.classification),created:q(this.created),culture:this.culture,description:this.description,extent:q(this.extent),groupCategories:q(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:q(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:q(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:q(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:q(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new Ww({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){const t=this.toJSON();for(const e of["tags","typeKeywords","categories"])t[e]=t[e]?.join(", ");for(const e of["extent","classification"]){const i=t[e];i&&(t[e]=JSON.stringify(i))}return t}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return this.portal.request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await this.portal.request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new P6(e)):null}fetchRelatedItems(t,e){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},Ww)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.applicationProxies&&!Object.hasOwn(t,"appProxies")&&(this.applicationProxies=null),this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t?.data,i={method:"post"};i.query=this.createPostQuery();for(const r in i.query)i.query[r]===null&&(i.query[r]="");return i.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?i.query.text=e:typeof e=="object"&&(i.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,i).then(()=>this.reload())}):Promise.reject(new U("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new U("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:i}=this;await e.signIn();const{copyResources:r,folder:s,tags:n,title:o}=t||{},a={method:"post",query:{copyPrivateResources:r==="all",folder:typeof s=="string"?s:s?.id,includeResources:!!r,tags:n?.join(","),title:o}},{itemId:l}=await e.request(`${i}/copy`,a);return new Ww({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,i=t.filename,r={method:"post"};if(typeof e=="string")wf(e)?r.query={data:e}:r.query={url:Hc(e)},i!=null&&(r.query.filename=i);else{const s=new FormData;i!=null?s.append("file",e,i):s.append("file",e),r.body=s}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,r).then(()=>this.reload())}):Promise.reject(new U("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){const{fetchResources:i}=await V(()=>Promise.resolve().then(()=>uC),void 0);return i(this,t,e)}async addResource(t,e,i){const{addOrUpdateResources:r}=await V(()=>Promise.resolve().then(()=>uC),void 0);return t.portalItem=this,await r(this,[{resource:t,content:e,compress:i?.compress,access:i?.access}],"add",i),t}async removeResource(t,e){const{removeResource:i}=await V(()=>Promise.resolve().then(()=>uC),void 0);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new U("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i(this,t,e)}async removeAllResources(t){const{removeAllResources:e}=await V(()=>Promise.resolve().then(()=>uC),void 0);return e(this,t)}resourceFromPath(t){return new FWe({portalItem:this,path:t})}toJSON(){const t=this.extent,e={accessInformation:this.accessInformation,categories:q(this.categories),classification:q(this.classification),created:this.created?.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified?.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:q(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:q(this.typeKeywords),url:this.url};return xBe(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new Ww({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};u([p({type:["private","shared","org","public"]})],hi.prototype,"access",void 0),u([p()],hi.prototype,"accessInformation",void 0),u([p({type:String})],hi.prototype,"apiKey",void 0),u([p({json:{read:{source:"appProxies"}}})],hi.prototype,"applicationProxies",void 0),u([p()],hi.prototype,"avgRating",void 0),u([p()],hi.prototype,"categories",void 0),u([p()],hi.prototype,"classification",void 0),u([p({type:Date})],hi.prototype,"created",void 0),u([p()],hi.prototype,"culture",void 0),u([p()],hi.prototype,"description",void 0),u([p({readOnly:!0})],hi.prototype,"displayName",null),u([p({type:gi})],hi.prototype,"extent",void 0),u([me("extent")],hi.prototype,"readExtent",null),u([p()],hi.prototype,"groupCategories",void 0),u([p({readOnly:!0})],hi.prototype,"iconUrl",null),u([p()],hi.prototype,"id",void 0),u([p({readOnly:!0})],hi.prototype,"isLayer",null),u([p({type:Boolean,readOnly:!0})],hi.prototype,"isOrgItem",void 0),u([p()],hi.prototype,"itemControl",void 0),u([p({readOnly:!0})],hi.prototype,"itemPageUrl",null),u([p({readOnly:!0})],hi.prototype,"itemUrl",null),u([p()],hi.prototype,"licenseInfo",void 0),u([p({type:Date})],hi.prototype,"modified",void 0),u([p()],hi.prototype,"name",void 0),u([p()],hi.prototype,"numComments",void 0),u([p()],hi.prototype,"numRatings",void 0),u([p()],hi.prototype,"numViews",void 0),u([p()],hi.prototype,"owner",void 0),u([p()],hi.prototype,"ownerFolder",void 0),u([p({type:fn})],hi.prototype,"portal",void 0),u([p()],hi.prototype,"screenshots",void 0),u([p()],hi.prototype,"size",void 0),u([p()],hi.prototype,"snippet",void 0),u([p()],hi.prototype,"sourceJSON",void 0),u([p({type:String})],hi.prototype,"sourceUrl",void 0),u([p({type:String})],hi.prototype,"spatialReference",void 0),u([p()],hi.prototype,"tags",void 0),u([p()],hi.prototype,"thumbnail",void 0),u([p({readOnly:!0})],hi.prototype,"thumbnailUrl",null),u([p()],hi.prototype,"title",void 0),u([p()],hi.prototype,"type",void 0),u([p()],hi.prototype,"typeKeywords",void 0),u([p({type:String,json:{read(t,e){if(zWe.has(e.type)){const i=this.portal?.restUrl;t||=i&&this.id?`${i}/content/items/${this.id}/data`:null}return t}}})],hi.prototype,"url",void 0),u([p({readOnly:!0})],hi.prototype,"userItemUrl",null),hi=Ww=u([A("esri.portal.PortalItem")],hi);const eh=hi,g2e=Object.freeze(Object.defineProperty({__proto__:null,default:eh},Symbol.toStringTag,{value:"Module"}));async function UWe(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t.includes("-3d")?t.slice(0,t.indexOf("-3d")):t,i=await dEe("esri/t9n/basemaps");return i[t]||i[e]}const y$={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return gs("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return gs("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return gs("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return gs("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return gs("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return gs("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return gs("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return gs("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return gs("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return gs("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return gs("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return gs("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return gs("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return gs("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return gs("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return gs("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return gs("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]}};let Vg=class extends ue{constructor(e){super(e),this.apiKey=null,this.id=null,this.language=null,this.places=null,this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2",this.worldview=null}get languageParameter(){const e=this.language;let i=e==="local"||e==="global"?e:pEe(e??Xc())??"global";return i=i==="no"?"nb":i,i}};u([p()],Vg.prototype,"apiKey",void 0),u([p()],Vg.prototype,"id",void 0),u([p()],Vg.prototype,"language",void 0),u([p()],Vg.prototype,"places",void 0),u([p()],Vg.prototype,"serviceUrl",void 0),u([p()],Vg.prototype,"worldview",void 0),Vg=u([A("esri.support.BasemapStyle")],Vg);const BWe=Vg;function VWe(t){return y2e(t)||GWe(t)}function jWe(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="feature"}function Tqt(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="graphics"}function Eqt(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="map-notes"&&"sublayers"in t}function Cqt(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="knowledge-graph"&&"layers"in t}function $qt(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="link-chart"&&"layers"in t}function GWe(t){return t?.type==="scene"}function HWe(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="subtype-group"&&"sublayers"in t}function Xh(t){return t?.type==="subtype-sublayer"}function y2e(t){const e=t?.type;return e==="imagery-tile"||e==="tile"||e==="open-street-map"||e==="vector-tile"||e==="web-tile"||e==="wmts"}function EC(t){const e=t?.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function v$(t){return t!=null&&"type"in t&&t.type==="group"}const Aqt={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function yW(t){const e=t?.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function qWe(t){return t==="IntegratedMeshLayer"||t==="IntegratedMesh3DTilesLayer"}function NP(t){return t==="integrated-mesh"||t==="integrated-mesh-3dtiles"}function sue(t){return t?.type==="voxel"}function nue(t){return t?.type==="imagery-tile"}function Wk(t){return t?.parent!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function uD(t){return t?.type==="feature"&&!t.url&&t.source?.type==="memory"}function v2e(t){const e=t?.type;return(e==="feature"||e==="subtype-group"||e==="oriented-imagery")&&t?.source?.type==="feature-layer"}function WWe(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const i=t.activeLayer.tileMatrixSets;if(i)return i}return null}async function Gte(t,e){const i=mr?.findServerInfo(t);if(i?.currentVersion!=null)return i.owningSystemUrl||null;const r=t.toLowerCase().indexOf("/rest/services");if(r===-1)return null;const s=`${t.slice(0,r)}/rest/info`,n=e!=null?e.signal:null,{data:o}=await Ci(s,{query:{f:"json"},responseType:"json",signal:n});return o?.owningSystemUrl||null}function _2e(t){if(!("capabilities"in t))return!1;switch(t.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"sublayer":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function ZWe(t){return _2e(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function YWe(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function JWe(t){return!!YWe(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}const XWe=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wcs","wms","wmts"]),b2e=new Set(["catalog","csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","knowledge-graph","map-image","map-notes","media","ogc-feature","oriented-imagery","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wcs","wfs","wms","wmts"]),KWe=new Set([...b2e,"link-chart"]);function QWe(t){switch(t.layerContainerType){case"basemap":return XWe;case"operational-layers":return t.origin==="link-chart"?KWe:b2e;default:return null}}function eZe(t,e){if(e.restrictedWebMapWriting){const i=QWe(e);return i==null||i.has(t.type)&&!uD(t)}return!0}function tZe(t,e){if(e)if(uD(t)){const i=hV("featureCollection.layers",e),r=i?.[0]?.layerDefinition;r&&oue(t,r)}else t.type!=="group"&&oue(t,e)}function oue(t,e){"maxScale"in t&&(e.maxScale=Sz(t.maxScale)??void 0),"minScale"in t&&(e.minScale=Sz(t.minScale)??void 0)}function iZe(t,e){if(tZe(t,e),e&&(e.id=t.id,"blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=Sz(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(uD(t)){const i=e.featureCollection;i&&(i.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function vW(t,e,i){if(!t.persistenceEnabled)return null;if(!("write"in t)||!t.write)return i?.messages&&i.messages.push(new U("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(uD(t)&&!t.isTable)e=t.resourceInfo;else if(eZe(t,i)){const r={};return t.write(r,i)?r:null}return e!=null&&iZe(t,e=q(e)),e}var wO;let rZe=0,xu=wO=class extends ee.JSONSupportMixin($l){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.style=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+rZe++,this.baseLayers=new Ee,this.referenceLayers=new Ee;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type==="elevation"&&J.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=r=>{r.parent=null};this.addHandles([this.baseLayers.on("after-add",r=>e(r.item)),this.referenceLayers.on("after-add",r=>e(r.item)),this.baseLayers.on("after-remove",r=>i(r.item)),this.referenceLayers.on("after-remove",r=>i(r.item))])}initialize(){this.when().catch(t=>{J.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.baseLayers.toArray();for(const i of t)i.destroy();const e=this.referenceLayers.toArray();for(const i of e)i.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem=Ce(this.portalItem)}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",df(t,this._get("baseLayers")))}_writeBaseLayers(t,e,i){const r=[];t&&(i={...i,layerContainerType:"basemap"},this.baseLayers.forEach(s=>{const n=vW(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);n!=null&&r.push(n)}),this.referenceLayers.forEach(s=>{const n=vW(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);n!=null&&(s.type!=="scene"&&(n.isReference=!0),r.push(n))})),e.baseMapLayers=r}set referenceLayers(t){this._set("referenceLayers",df(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return cD(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(e=>gz(e)?e.clone():e),referenceLayers:this.referenceLayers.map(e=>gz(e)?e.clone():e)};return this.loaded&&(t.loadStatus="loaded"),new wO({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){return t=t||{},e?.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&this.resourceInfo?.data.baseMapLayers&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(i=>{const r=q(i);return r.url&&Wm(r.url)&&(r.url=`https:${r.url}`),r.templateUrl&&Wm(r.templateUrl)&&(r.templateUrl=`https:${r.templateUrl}`),r})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:i,style:r}=this;gt(t);const s=[];if(e){const n=e.context?e.context.url:null;if(s.push(this._loadLayersFromJSON(e.data,n,t)),e.data.id&&!e.data.title){const o=e.data.id;s.push(UWe(o).then(a=>{a&&this.read({title:a},e.context)}))}}else i?s.push(this._loadFromItem(i,t)):r&&s.push(this._loadFromStylesService(r,t));await Promise.all(s)}async _loadLayersFromJSON(t,e,i){const r=this.resourceInfo?.context,s=this.portalItem?.portal||r?.portal||null,n=nZe[r?.origin||""]??"web-map",{populateOperationalLayers:o}=await V(async()=>{const{populateOperationalLayers:l}=await import("./layersCreator-oRwakYTV.js");return{populateOperationalLayers:l}},__vite__mapDeps([118,119,120,121,122,123])),a=[];if(gt(i),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const l={context:{...r,origin:n,url:e,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=f=>n==="web-scene"&&f.layerType==="ArcGISSceneServiceLayer"||f.isReference,h=o(this.baseLayers,t.baseMapLayers.filter(f=>!c(f)),l);a.push(h);const d=o(this.referenceLayers,t.baseMapLayers.filter(c),l);a.push(d)}await Promise.allSettled(a)}async _loadFromItem(t,e){const i=await t.load(e),r=await i.fetchData("json",e),s=pn(t.itemUrl??"");return this._set("resourceInfo",{data:r.baseMap??{},context:{origin:sZe[t.type||""]??"web-map",portal:t.portal||fn.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||fn.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,e)}async _loadFromStylesService(t,e){const i=t.serviceUrl.endsWith("/webmaps")?t.serviceUrl.slice(0,-8):t.serviceUrl,r=`${i}/styles/${t.id}/self`,s=`${i}/webmaps/${t.id}`,[n,o]=await Promise.all([(await Ci(r,{query:{token:t.apiKey},signal:e?.signal})).data,(await Ci(s,{query:{language:t.languageParameter,places:t.places,worldview:t.worldview,token:t.apiKey},signal:e?.signal})).data]);this.thumbnailUrl??=n.thumbnailUrl;const a=pn(s);if(this._set("resourceInfo",{data:o.baseMap??{},context:{origin:"web-map",url:a}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:o.spatialReference},this.resourceInfo.context),await this._loadLayersFromJSON(this.resourceInfo.data,a,e),t.apiKey)for(const l of[...this.baseLayers,...this.referenceLayers])"apiKey"in l&&(l.apiKey=t.apiKey)}static fromId(t){const e=y$[t];return e?e.itemId?new wO({portalItem:{id:e.itemId,portal:{url:"https://www.arcgis.com"}}}):wO.fromJSON(e,{origin:e.is3d?"web-scene":"web-map"}):null}};u([p({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,i,r){this._writeBaseLayers(t,e,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:Ee}},writer(t,e,i,r){this._writeBaseLayers(t,e,r)}}}}}})],xu.prototype,"baseLayers",null),u([p({type:String,json:{origins:{"web-scene":{write:!0}}}})],xu.prototype,"id",void 0),u([p({type:eh})],xu.prototype,"portalItem",void 0),u([p()],xu.prototype,"referenceLayers",null),u([p({readOnly:!0})],xu.prototype,"resourceInfo",void 0),u([p({type:Ae})],xu.prototype,"spatialReference",void 0),u([p({type:BWe})],xu.prototype,"style",void 0),u([p()],xu.prototype,"thumbnailUrl",void 0),u([p({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],xu.prototype,"title",void 0),u([ge("title")],xu.prototype,"writeTitle",null),xu=wO=u([A("esri.Basemap")],xu);const sZe={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},nZe={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},qy=xu,oZe=Object.freeze(Object.defineProperty({__proto__:null,default:qy},Symbol.toStringTag,{value:"Module"})),tU={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function w2e(t){return!!tU[t]||!!tU[t.toLowerCase()]}function Hte(t){return tU[t]??tU[t.toLowerCase()]}function aZe(t){return[...Hte(t)]}function D6(t,e,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?t+(e-t)*r:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}function x2e(t,e,i,r=1){const s=(t%360+360)%360/360,n=i<=.5?i*(e+1):i+e-i*e,o=2*i-n;return[Math.round(255*D6(o,n,s+1/3)),Math.round(255*D6(o,n,s)),Math.round(255*D6(o,n,s-1/3)),r]}function lZe(t){const e=t.length>5,i=e?8:4,r=(1<<i)-1,s=e?1:17,n=e?t.length===9:t.length===5;let o=+("0x"+t.slice(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&r,o>>=i,a[3]=s*l/255),l=o&r,o>>=i,a[2]=s*l,l=o&r,o>>=i,a[1]=s*l,l=o&r,o>>=i,a[0]=s*l,a}const iU=2.2;function FL(t){return ce($ee(t),0,255)}function kL(t,e,i){return t=Number(t),isNaN(t)?i:t<e?e:t>i?i:t}function zL(t,e){const i=t.toString(16).padStart(2,"0");return e?i.slice(0,1):i}let qe=class No{static blendColors(e,i,r,s=new No){return s.r=Math.round(e.r+(i.r-e.r)*r),s.g=Math.round(e.g+(i.g-e.g)*r),s.b=Math.round(e.b+(i.b-e.b)*r),s.a=e.a+(i.a-e.a)*r,s._sanitize()}static fromRgb(e,i){const r=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s.\-,%0-9]+)\)/);if(r){const s=r[2].split(/\s*,\s*/),n=r[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),No.fromArray(a,i)}return No.fromArray(s.map(a=>parseFloat(a)),i)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return No.fromArray(x2e(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),i)}return null}static fromHex(e,i=new No){if(e[0]!=="#"||isNaN(+`0x${e.slice(1)}`))return null;switch(e.length){case 4:case 5:{const r=parseInt(e.slice(1,2),16),s=parseInt(e.slice(2,3),16),n=parseInt(e.slice(3,4),16),o=e.length===5?15:parseInt(e.slice(4),16);return No.fromArray([r+16*r,s+16*s,n+16*n,(o+16*o)/255],i)}case 7:case 9:{const r=parseInt(e.slice(1,3),16),s=parseInt(e.slice(3,5),16),n=parseInt(e.slice(5,7),16),o=e.length===7?255:parseInt(e.slice(7),16);return No.fromArray([r,s,n,o/255],i)}default:return null}}static fromArray(e,i=new No){return i._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(i.a)&&(i.a=1),i._sanitize()}static fromString(e,i){const r=w2e(e)?Hte(e):null;return r&&No.fromArray(r,i)||No.fromRgb(e,i)||No.fromHex(e,i)}static fromJSON(e){return e!=null?new No([e[0],e[1],e[2],(e[3]??255)/255]):void 0}static toUnitRGB(e){return e!=null?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return e!=null?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?No.fromString(e,this):Array.isArray(e)?No.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof No||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(e){const i=e?.capitalize??!1,r=e?.digits??6,s=r===3||r===4,n=r===4||r===8,o=`#${zL(this.r,s)}${zL(this.g,s)}${zL(this.b,s)}${n?zL(Math.round(255*this.a),s):""}`;return i?o.toUpperCase():o}toCss(e=!1){const i=this.r+", "+this.g+", "+this.b;return e?`rgba(${i}, ${this.a})`:`rgb(${i})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=No.AlphaMode.ALWAYS){const i=FL(this.r),r=FL(this.g),s=FL(this.b);return e===No.AlphaMode.ALWAYS||this.a!==1?[i,r,s,FL(255*this.a)]:[i,r,s]}clone(){return new No(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return e!=null&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(kL(this.r,0,255)),this.g=Math.round(kL(this.g,0,255)),this.b=Math.round(kL(this.b,0,255)),this.a=kL(this.a,0,1),this}_set(e,i,r,s){this.r=e,this.g=i,this.b=r,this.a=s}};qe.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(qe);function Ue(t,e={}){const i=t instanceof ei?t:new ei(t,e),{alwaysWriteDefaults:r,default:s,ignoreUnknown:n=!0,name:o,nonNullable:a,readOnly:l=!1}=e;return p({type:n?i.apiValues:String,json:{type:i.jsonValues,default:s,name:o,read:!l&&{reader:i.read},write:{writer:i.write,alwaysWriteDefaults:r}},nonNullable:a,readOnly:l})}var _W;let Zk=_W=class extends ee{constructor(t){super(t),this.type="none"}clone(){return new _W({type:this.type})}};u([Ue({none:"none",stayAbove:"stay-above"}),p({json:{write:{isRequired:!0}}})],Zk.prototype,"type",void 0),Zk=_W=u([A("esri.ground.NavigationConstraint")],Zk);const cZe=Symbol("GroundInstance");function hD(t){const e=$ee(100*(1-t));return Math.max(0,Math.min(e,100))}function _$(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}var S2e,bW;let jg=bW=class extends ee.JSONSupportMixin($l){constructor(t){super(t),this[S2e]=!0,this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new Ee;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&J.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=r=>{r.parent=null};this.addHandles([this.layers.on("after-add",r=>e(r.item)),this.layers.on("after-remove",r=>i(r.item))])}initialize(){this.when().catch(t=>{Xr(t)||J.getLogger(this).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)Ce(e);this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}get layers(){return this._get("layers")}set layers(t){this._set("layers",df(t,this._get("layers")))}writeLayers(t,e,i,r){const s=[];t&&(r={...r,layerContainerType:"ground"},t.forEach(n=>{if("write"in n){const o={};gBe(n)().write(o,r)&&s.push(o)}else r?.messages&&r.messages.push(new U("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),e.layers=s}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return cD(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e?.signal});const{ElevationQuery:i}=await V(()=>import("./ElevationQuery-CgkvMVSW.js"),[]);gt(e);const r=new i,s=this.layers.filter(aue).toArray();return r.queryAll(s,t,e)}async createElevationSampler(t,e){await this.load({signal:e?.signal});const{ElevationQuery:i}=await V(()=>import("./ElevationQuery-CgkvMVSW.js"),[]);gt(e);const r=new i,s=this.layers.filter(aue).toArray();return r.createSamplerAll(s,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:q(this.surfaceColor),navigationConstraint:q(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new bW({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}async _loadLayersFromJSON(t,e,i){const r=e?.origin||"web-scene",s=e?.portal||null,n=e?.url||null,{populateOperationalLayers:o}=await V(async()=>{const{populateOperationalLayers:l}=await import("./layersCreator-oRwakYTV.js");return{populateOperationalLayers:l}},__vite__mapDeps([118,119,120,121,122,123]));gt(i);const a=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:r,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,t.layers,l))}await Promise.allSettled(a)}};function uZe(t){return t&&"createElevationSampler"in t}function aue(t){return t.type==="elevation"||uZe(t)}S2e=cZe,u([p({json:{read:!1,write:{isRequired:!0}}})],jg.prototype,"layers",null),u([ge("layers")],jg.prototype,"writeLayers",null),u([p({readOnly:!0})],jg.prototype,"resourceInfo",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Ei,read:{reader:_$,source:"transparency"},write:{writer:(t,e)=>{e.transparency=hD(t)},target:"transparency"}}})],jg.prototype,"opacity",void 0),u([p({type:qe,json:{type:[Ei],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],jg.prototype,"surfaceColor",void 0),u([p({type:Zk,json:{write:!0}})],jg.prototype,"navigationConstraint",void 0),jg=bW=u([A("esri.Ground")],jg);const FP=jg,UL=new WeakMap;function T2e(t){return!t.destroyed&&(UL.has(t)||t.addHandles([H(()=>{const e=t.parent;return!(!e||!("type"in e))&&(e.type==="catalog-dynamic-group"||T2e(e))},e=>UL.set(t,e),St),$i(()=>UL.delete(t))]),UL.get(t))}function hZe(t){return typeof t=="object"&&t!=null&&"loaded"in t&&t.loaded===!0&&"type"in t}function dZe(t){return!(!hZe(t)||!ZWe(t)?.operations?.supportsEditing||"editingEnabled"in t&&!JWe(t)||T2e(t))}const pZe=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,fZe="screenUtils.toPt: input not recognized!",E2e=96;function tS(t){return t?t/72*E2e:0}function $d(t){return t?72*t/E2e:0}function sr(t){if(typeof t=="string"){const e=t.match(pZe);if(e){const i=Number(e[1]),r=e[3]&&e[3].toLowerCase(),s=t.charAt(0)==="-",n=r==="px"?$d(i):i;return s?-n:n}return console.warn(fZe),null}return t}function wo(t=0,e=0){return{x:t,y:e}}function Mqt(t){return t?wo(t.x,t.y):null}function nn(t=0,e=0){return[t,e]}function C2e(t=0,e=0){return[t,e]}function Wp(t=0,e=0,i=0){return[t,e,i]}function Oqt(t){return t}function Iqt(t){return t}function Rqt(t){return t}function jp(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}function BV(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function mZe(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function gZe(t,e,i,r,s,n,o,a,l,c,h,d,f,m,y,v){const _=new Float32Array(16);return _[0]=t,_[1]=e,_[2]=i,_[3]=r,_[4]=s,_[5]=n,_[6]=o,_[7]=a,_[8]=l,_[9]=c,_[10]=h,_[11]=d,_[12]=f,_[13]=m,_[14]=y,_[15]=v,_}function yZe(t,e){return new Float32Array(t,e,16)}const vZe=BV();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:vZe,clone:mZe,create:BV,createView:yZe,fromValues:gZe},Symbol.toStringTag,{value:"Module"}));let qte=1e-6;function So(){return qte}function _Ze(t){qte=t}const dD=Math.random,bZe=Math.PI/180,wZe=180/Math.PI;function pD(t){return t*bZe}function xZe(t){return t*wZe}function SZe(t,e){return Math.abs(t-e)<=qte*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:dD,equals:SZe,getEpsilon:So,setEpsilon:_Ze,toDegree:xZe,toRadian:pD},Symbol.toStringTag,{value:"Module"}));function mn(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function lg(t,e,i,r,s,n,o,a,l,c,h,d,f,m,y,v,_){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=h,t[10]=d,t[11]=f,t[12]=m,t[13]=y,t[14]=v,t[15]=_,t}function pf(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function dc(t,e){if(t===e){const i=e[1],r=e[2],s=e[3],n=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=n,t[11]=e[14],t[12]=s,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Wte(t,e){return Sl(t,e)||pf(t),t}function Sl(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=e[9],f=e[10],m=e[11],y=e[12],v=e[13],_=e[14],b=e[15],w=i*a-r*o,x=i*l-s*o,S=i*c-n*o,C=r*l-s*a,T=r*c-n*a,M=s*c-n*l,I=h*v-d*y,P=h*_-f*y,D=h*b-m*y,F=d*_-f*v,L=d*b-m*v,N=f*b-m*_;let R=w*N-x*L+S*F+C*D-T*P+M*I;return R?(R=1/R,t[0]=(a*N-l*L+c*F)*R,t[1]=(s*L-r*N-n*F)*R,t[2]=(v*M-_*T+b*C)*R,t[3]=(f*T-d*M-m*C)*R,t[4]=(l*D-o*N-c*P)*R,t[5]=(i*N-s*D+n*P)*R,t[6]=(_*S-y*M-b*x)*R,t[7]=(h*M-f*S+m*x)*R,t[8]=(o*L-a*D+c*I)*R,t[9]=(r*D-i*L-n*I)*R,t[10]=(y*T-v*S+b*w)*R,t[11]=(d*S-h*T-m*w)*R,t[12]=(a*P-o*F-l*I)*R,t[13]=(i*F-r*P+s*I)*R,t[14]=(v*x-y*C-_*w)*R,t[15]=(h*C-d*x+f*w)*R,t):null}function TZe(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=e[9],f=e[10],m=e[11],y=e[12],v=e[13],_=e[14],b=e[15];return t[0]=a*(f*b-m*_)-d*(l*b-c*_)+v*(l*m-c*f),t[1]=-(r*(f*b-m*_)-d*(s*b-n*_)+v*(s*m-n*f)),t[2]=r*(l*b-c*_)-a*(s*b-n*_)+v*(s*c-n*l),t[3]=-(r*(l*m-c*f)-a*(s*m-n*f)+d*(s*c-n*l)),t[4]=-(o*(f*b-m*_)-h*(l*b-c*_)+y*(l*m-c*f)),t[5]=i*(f*b-m*_)-h*(s*b-n*_)+y*(s*m-n*f),t[6]=-(i*(l*b-c*_)-o*(s*b-n*_)+y*(s*c-n*l)),t[7]=i*(l*m-c*f)-o*(s*m-n*f)+h*(s*c-n*l),t[8]=o*(d*b-m*v)-h*(a*b-c*v)+y*(a*m-c*d),t[9]=-(i*(d*b-m*v)-h*(r*b-n*v)+y*(r*m-n*d)),t[10]=i*(a*b-c*v)-o*(r*b-n*v)+y*(r*c-n*a),t[11]=-(i*(a*m-c*d)-o*(r*m-n*d)+h*(r*c-n*a)),t[12]=-(o*(d*_-f*v)-h*(a*_-l*v)+y*(a*f-l*d)),t[13]=i*(d*_-f*v)-h*(r*_-s*v)+y*(r*f-s*d),t[14]=-(i*(a*_-l*v)-o*(r*_-s*v)+y*(r*l-s*a)),t[15]=i*(a*f-l*d)-o*(r*f-s*d)+h*(r*l-s*a),t}function EZe(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],d=t[10],f=t[11],m=t[12],y=t[13],v=t[14],_=t[15];return(e*o-i*n)*(d*_-f*v)-(e*a-r*n)*(h*_-f*y)+(e*l-s*n)*(h*v-d*y)+(i*a-r*o)*(c*_-f*m)-(i*l-s*o)*(c*v-d*m)+(r*l-s*a)*(c*y-h*m)}function kn(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],f=e[9],m=e[10],y=e[11],v=e[12],_=e[13],b=e[14],w=e[15];let x=i[0],S=i[1],C=i[2],T=i[3];return t[0]=x*r+S*a+C*d+T*v,t[1]=x*s+S*l+C*f+T*_,t[2]=x*n+S*c+C*m+T*b,t[3]=x*o+S*h+C*y+T*w,x=i[4],S=i[5],C=i[6],T=i[7],t[4]=x*r+S*a+C*d+T*v,t[5]=x*s+S*l+C*f+T*_,t[6]=x*n+S*c+C*m+T*b,t[7]=x*o+S*h+C*y+T*w,x=i[8],S=i[9],C=i[10],T=i[11],t[8]=x*r+S*a+C*d+T*v,t[9]=x*s+S*l+C*f+T*_,t[10]=x*n+S*c+C*m+T*b,t[11]=x*o+S*h+C*y+T*w,x=i[12],S=i[13],C=i[14],T=i[15],t[12]=x*r+S*a+C*d+T*v,t[13]=x*s+S*l+C*f+T*_,t[14]=x*n+S*c+C*m+T*b,t[15]=x*o+S*h+C*y+T*w,t}function nh(t,e,i){const r=i[0],s=i[1],n=i[2];if(e===t)t[12]=e[0]*r+e[4]*s+e[8]*n+e[12],t[13]=e[1]*r+e[5]*s+e[9]*n+e[13],t[14]=e[2]*r+e[6]*s+e[10]*n+e[14],t[15]=e[3]*r+e[7]*s+e[11]*n+e[15];else{const o=e[0],a=e[1],l=e[2],c=e[3],h=e[4],d=e[5],f=e[6],m=e[7],y=e[8],v=e[9],_=e[10],b=e[11];t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=h,t[5]=d,t[6]=f,t[7]=m,t[8]=y,t[9]=v,t[10]=_,t[11]=b,t[12]=o*r+h*s+y*n+e[12],t[13]=a*r+d*s+v*n+e[13],t[14]=l*r+f*s+_*n+e[14],t[15]=c*r+m*s+b*n+e[15]}return t}function $2e(t,e,i){const r=i[0],s=i[1],n=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Wu(t,e,i,r){let s=r[0],n=r[1],o=r[2],a=Math.sqrt(s*s+n*n+o*o);if(a<=So())return void mn(t,e);a=1/a,s*=a,n*=a,o*=a;const l=Math.sin(i),c=Math.cos(i),h=1-c,d=e[0],f=e[1],m=e[2],y=e[3],v=e[4],_=e[5],b=e[6],w=e[7],x=e[8],S=e[9],C=e[10],T=e[11],M=s*s*h+c,I=n*s*h+o*l,P=o*s*h-n*l,D=s*n*h-o*l,F=n*n*h+c,L=o*n*h+s*l,N=s*o*h+n*l,R=n*o*h-s*l,k=o*o*h+c;t[0]=d*M+v*I+x*P,t[1]=f*M+_*I+S*P,t[2]=m*M+b*I+C*P,t[3]=y*M+w*I+T*P,t[4]=d*D+v*F+x*L,t[5]=f*D+_*F+S*L,t[6]=m*D+b*F+C*L,t[7]=y*D+w*F+T*L,t[8]=d*N+v*R+x*k,t[9]=f*N+_*R+S*k,t[10]=m*N+b*R+C*k,t[11]=y*N+w*R+T*k,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15])}function b$(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],d=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*s+c*r,t[5]=o*s+h*r,t[6]=a*s+d*r,t[7]=l*s+f*r,t[8]=c*s-n*r,t[9]=h*s-o*r,t[10]=d*s-a*r,t[11]=f*s-l*r,t}function VV(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[0],o=e[1],a=e[2],l=e[3],c=e[8],h=e[9],d=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s-c*r,t[1]=o*s-h*r,t[2]=a*s-d*r,t[3]=l*s-f*r,t[8]=n*r+c*s,t[9]=o*r+h*s,t[10]=a*r+d*s,t[11]=l*r+f*s,t}function w$(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[0],o=e[1],a=e[2],l=e[3],c=e[4],h=e[5],d=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s+c*r,t[1]=o*s+h*r,t[2]=a*s+d*r,t[3]=l*s+f*r,t[4]=c*s-n*r,t[5]=h*s-o*r,t[6]=d*s-a*r,t[7]=f*s-l*r,t}function Zte(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function CZe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ad(t,e,i){if(e===0)return pf(t);let r=i[0],s=i[1],n=i[2],o=Math.sqrt(r*r+s*s+n*n);if(o<=So())return null;o=1/o,r*=o,s*=o,n*=o;const a=Math.sin(e),l=Math.cos(e),c=1-l;return t[0]=r*r*c+l,t[1]=s*r*c+n*a,t[2]=n*r*c-s*a,t[3]=0,t[4]=r*s*c-n*a,t[5]=s*s*c+l,t[6]=n*s*c+r*a,t[7]=0,t[8]=r*n*c+s*a,t[9]=s*n*c-r*a,t[10]=n*n*c+l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function $Ze(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function AZe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function A2e(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function M2e(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=r+r,l=s+s,c=n+n,h=r*a,d=r*l,f=r*c,m=s*l,y=s*c,v=n*c,_=o*a,b=o*l,w=o*c;return t[0]=1-(m+v),t[1]=d+w,t[2]=f-b,t[3]=0,t[4]=d-w,t[5]=1-(h+v),t[6]=y+_,t[7]=0,t[8]=f+b,t[9]=y-_,t[10]=1-(h+m),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function MZe(t,e){const i=OZe,r=-e[0],s=-e[1],n=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=r*r+s*s+n*n+o*o;return d>0?(i[0]=2*(a*o+h*r+l*n-c*s)/d,i[1]=2*(l*o+h*s+c*r-a*n)/d,i[2]=2*(c*o+h*n+a*s-l*r)/d):(i[0]=2*(a*o+h*r+l*n-c*s),i[1]=2*(l*o+h*s+c*r-a*n),i[2]=2*(c*o+h*n+a*s-l*r)),M2e(t,e,i),t}const OZe=$();function IZe(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function O2e(t,e){const i=e[0],r=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10];return t[0]=Math.sqrt(i*i+r*r+s*s),t[1]=Math.sqrt(n*n+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+h*h),t}function I2e(t,e){const i=e[0]+e[5]+e[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),t[3]=.25*r,t[0]=(e[6]-e[9])/r,t[1]=(e[8]-e[2])/r,t[2]=(e[1]-e[4])/r):e[0]>e[5]&&e[0]>e[10]?(r=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/r,t[0]=.25*r,t[1]=(e[1]+e[4])/r,t[2]=(e[8]+e[2])/r):e[5]>e[10]?(r=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/r,t[0]=(e[1]+e[4])/r,t[1]=.25*r,t[2]=(e[6]+e[9])/r):(r=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/r,t[0]=(e[8]+e[2])/r,t[1]=(e[6]+e[9])/r,t[2]=.25*r),t}function RZe(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=e[3],l=s+s,c=n+n,h=o+o,d=s*l,f=s*c,m=s*h,y=n*c,v=n*h,_=o*h,b=a*l,w=a*c,x=a*h,S=r[0],C=r[1],T=r[2];return t[0]=(1-(y+_))*S,t[1]=(f+x)*S,t[2]=(m-w)*S,t[3]=0,t[4]=(f-x)*C,t[5]=(1-(d+_))*C,t[6]=(v+b)*C,t[7]=0,t[8]=(m+w)*T,t[9]=(v-b)*T,t[10]=(1-(d+y))*T,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function PZe(t,e,i,r,s){const n=e[0],o=e[1],a=e[2],l=e[3],c=n+n,h=o+o,d=a+a,f=n*c,m=n*h,y=n*d,v=o*h,_=o*d,b=a*d,w=l*c,x=l*h,S=l*d,C=r[0],T=r[1],M=r[2],I=s[0],P=s[1],D=s[2],F=(1-(v+b))*C,L=(m+S)*C,N=(y-x)*C,R=(m-S)*T,k=(1-(f+b))*T,W=(_+w)*T,G=(y+x)*M,j=(_-w)*M,re=(1-(f+v))*M;return t[0]=F,t[1]=L,t[2]=N,t[3]=0,t[4]=R,t[5]=k,t[6]=W,t[7]=0,t[8]=G,t[9]=j,t[10]=re,t[11]=0,t[12]=i[0]+I-(F*I+R*P+G*D),t[13]=i[1]+P-(L*I+k*P+j*D),t[14]=i[2]+D-(N*I+W*P+re*D),t[15]=1,t}function DZe(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=i+i,a=r+r,l=s+s,c=i*o,h=r*o,d=r*a,f=s*o,m=s*a,y=s*l,v=n*o,_=n*a,b=n*l;return t[0]=1-d-y,t[1]=h+b,t[2]=f-_,t[3]=0,t[4]=h-b,t[5]=1-c-y,t[6]=m+v,t[7]=0,t[8]=f+_,t[9]=m-v,t[10]=1-c-d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function R2e(t,e,i,r,s,n,o){const a=1/(i-e),l=1/(s-r),c=1/(n-o);return t[0]=2*n*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*l,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(s+r)*l,t[10]=(o+n)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*n*2*c,t[15]=0,t}function LZe(t,e,i,r,s){const n=1/Math.tan(e/2);let o;return t[0]=n/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(o=1/(r-s),t[10]=(s+r)*o,t[14]=2*s*r*o):(t[10]=-1,t[14]=-2*r),t}function NZe(t,e,i,r){const s=Math.tan(e.upDegrees*Math.PI/180),n=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(s-n)*c*.5,t[10]=r/(i-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*i/(i-r),t[15]=0,t}function P2e(t,e,i,r,s,n,o){const a=1/(e-i),l=1/(r-s),c=1/(n-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(s+r)*l,t[14]=(o+n)*c,t[15]=1,t}function jV(t,e,i,r){const s=e[0],n=e[1],o=e[2];let a=s-i[0],l=n-i[1],c=o-i[2];const h=So();if(Math.abs(a)<h&&Math.abs(l)<h&&Math.abs(c)<h)return void pf(t);let d=1/Math.sqrt(a*a+l*l+c*c);a*=d,l*=d,c*=d;const f=r[0],m=r[1],y=r[2];let v=m*c-y*l,_=y*a-f*c,b=f*l-m*a;d=Math.sqrt(v*v+_*_+b*b),d?(d=1/d,v*=d,_*=d,b*=d):(v=0,_=0,b=0);let w=l*b-c*_,x=c*v-a*b,S=a*_-l*v;d=Math.sqrt(w*w+x*x+S*S),d?(d=1/d,w*=d,x*=d,S*=d):(w=0,x=0,S=0),t[0]=v,t[1]=w,t[2]=a,t[3]=0,t[4]=_,t[5]=x,t[6]=l,t[7]=0,t[8]=b,t[9]=S,t[10]=c,t[11]=0,t[12]=-(v*s+_*n+b*o),t[13]=-(w*s+x*n+S*o),t[14]=-(a*s+l*n+c*o),t[15]=1}function D2e(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=r[0],l=r[1],c=r[2];let h=s-i[0],d=n-i[1],f=o-i[2],m=h*h+d*d+f*f;m>0&&(m=1/Math.sqrt(m),h*=m,d*=m,f*=m);let y=l*f-c*d,v=c*h-a*f,_=a*d-l*h;return m=y*y+v*v+_*_,m>0&&(m=1/Math.sqrt(m),y*=m,v*=m,_*=m),t[0]=y,t[1]=v,t[2]=_,t[3]=0,t[4]=d*_-f*v,t[5]=f*y-h*_,t[6]=h*v-d*y,t[7]=0,t[8]=h,t[9]=d,t[10]=f,t[11]=0,t[12]=s,t[13]=n,t[14]=o,t[15]=1,t}function FZe(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function kZe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function zZe(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t}function L2e(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}function UZe(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t}function BZe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t[9]=e[9]+i[9]*r,t[10]=e[10]+i[10]*r,t[11]=e[11]+i[11]*r,t[12]=e[12]+i[12]*r,t[13]=e[13]+i[13]*r,t[14]=e[14]+i[14]*r,t[15]=e[15]+i[15]*r,t}function N2e(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Yte(t,e){if(t===e)return!0;const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],d=t[9],f=t[10],m=t[11],y=t[12],v=t[13],_=t[14],b=t[15],w=e[0],x=e[1],S=e[2],C=e[3],T=e[4],M=e[5],I=e[6],P=e[7],D=e[8],F=e[9],L=e[10],N=e[11],R=e[12],k=e[13],W=e[14],G=e[15],j=So();return Math.abs(i-w)<=j*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(r-x)<=j*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(s-S)<=j*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(n-C)<=j*Math.max(1,Math.abs(n),Math.abs(C))&&Math.abs(o-T)<=j*Math.max(1,Math.abs(o),Math.abs(T))&&Math.abs(a-M)<=j*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(l-I)<=j*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(c-P)<=j*Math.max(1,Math.abs(c),Math.abs(P))&&Math.abs(h-D)<=j*Math.max(1,Math.abs(h),Math.abs(D))&&Math.abs(d-F)<=j*Math.max(1,Math.abs(d),Math.abs(F))&&Math.abs(f-L)<=j*Math.max(1,Math.abs(f),Math.abs(L))&&Math.abs(m-N)<=j*Math.max(1,Math.abs(m),Math.abs(N))&&Math.abs(y-R)<=j*Math.max(1,Math.abs(y),Math.abs(R))&&Math.abs(v-k)<=j*Math.max(1,Math.abs(v),Math.abs(k))&&Math.abs(_-W)<=j*Math.max(1,Math.abs(_),Math.abs(W))&&Math.abs(b-G)<=j*Math.max(1,Math.abs(b),Math.abs(G))}function Jte(t){const e=So(),i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10];return Math.abs(1-(i*i+n*n+l*l))<=e&&Math.abs(1-(r*r+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+h*h))<=e}function GV(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const VZe=kn,jZe=L2e;Object.freeze(Object.defineProperty({__proto__:null,add:zZe,adjoint:TZe,copy:mn,determinant:EZe,equals:Yte,exactEquals:N2e,frob:kZe,fromQuat:DZe,fromQuat2:MZe,fromRotation:Ad,fromRotationTranslation:M2e,fromRotationTranslationScale:RZe,fromRotationTranslationScaleOrigin:PZe,fromScaling:CZe,fromTranslation:Zte,fromXRotation:$Ze,fromYRotation:AZe,fromZRotation:A2e,frustum:R2e,getRotation:I2e,getScaling:O2e,getTranslation:IZe,hasIdentityRotation:GV,identity:pf,invert:Sl,invertOrIdentity:Wte,isOrthoNormal:Jte,lookAt:jV,mul:VZe,multiply:kn,multiplyScalar:UZe,multiplyScalarAndAdd:BZe,ortho:P2e,perspective:LZe,perspectiveFromFieldOfView:NZe,rotate:Wu,rotateX:b$,rotateY:VV,rotateZ:w$,scale:$2e,set:lg,str:FZe,sub:jZe,subtract:L2e,targetTo:D2e,translate:nh,transpose:dc},Symbol.toStringTag,{value:"Module"}));const GZe=(t,e)=>{const i=lg(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return dc(i,i)},HZe=(t,e)=>{const i=lg(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return dc(i,i)},qZe=(t,e)=>{const i=1-e,r=lg(t,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return dc(r,r)},WZe=(t,e)=>{const i=Math.sin(e*Math.PI/180),r=Math.cos(e*Math.PI/180),s=lg(t,.213+.787*r-.213*i,.715-.715*r-.715*i,.072-.072*r+.928*i,0,.213-.213*r+.143*i,.715+.285*r+.14*i,.072-.072*r-.283*i,0,.213-.213*r-.787*i,.715-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,1);return dc(s,s)},ZZe=(t,e)=>{const i=1-2*e,r=lg(t,i,0,0,e,0,i,0,e,0,0,i,e,0,0,0,1);return dc(r,r)},YZe=(t,e)=>{const i=lg(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return dc(i,i)},JZe=(t,e)=>{const i=1-e,r=lg(t,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return dc(r,r)};let F2e=class k2e{constructor(e,i,r){this.strength=e,this.radius=i,this.threshold=r,this.type="bloom"}interpolate(e,i,r){this.strength=zc(e.strength,i.strength,r),this.radius=zc(e.radius,i.radius,r),this.threshold=zc(e.threshold,i.threshold,r)}clone(){return new k2e(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:_R(this.radius),strength:this.strength,threshold:this.threshold}}},z2e=class U2e{constructor(e){this.radius=e,this.type="blur"}interpolate(e,i,r){this.radius=Math.round(zc(e.radius,i.radius,r))}clone(){return new U2e(this.radius)}toJSON(){return{type:"blur",radius:_R(this.radius)}}},wW=class B2e{constructor(e,i){this.type=e,this.amount=i,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.amount=zc(e.amount,i.amount,r),this._updateMatrix()}clone(){return new B2e(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||BV();switch(this.type){case"brightness":this._colorMatrix=GZe(e,this.amount);break;case"contrast":this._colorMatrix=HZe(e,this.amount);break;case"grayscale":this._colorMatrix=qZe(e,this.amount);break;case"invert":this._colorMatrix=ZZe(e,this.amount);break;case"saturate":this._colorMatrix=YZe(e,this.amount);break;case"sepia":this._colorMatrix=JZe(e,this.amount)}}},V2e=class j2e{constructor(e,i,r,s){this.offsetX=e,this.offsetY=i,this.blurRadius=r,this.color=s,this.type="drop-shadow"}interpolate(e,i,r){this.offsetX=zc(e.offsetX,i.offsetX,r),this.offsetY=zc(e.offsetY,i.offsetY,r),this.blurRadius=zc(e.blurRadius,i.blurRadius,r),this.color[0]=Math.round(zc(e.color[0],i.color[0],r)),this.color[1]=Math.round(zc(e.color[1],i.color[1],r)),this.color[2]=Math.round(zc(e.color[2],i.color[2],r)),this.color[3]=zc(e.color[3],i.color[3],r)}clone(){return new j2e(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:_R(this.offsetX),yoffset:_R(this.offsetY),blurRadius:_R(this.blurRadius),color:e}}},G2e=class H2e{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.angle=zc(e.angle,i.angle,r),this._updateMatrix()}clone(){return new H2e(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||BV();this._colorMatrix=WZe(e,this.angle)}},q2e=class W2e{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,i,r){this.amount=zc(e.amount,i.amount,r)}clone(){return new W2e(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function zc(t,e,i){return t+(e-t)*i}function _R(t){return Math.round(1e3*$d(t))/1e3}function XZe(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new wW(t.type,0);case"saturate":case"brightness":case"contrast":return new wW(t.type,1);case"opacity":return new q2e(1);case"hue-rotate":return new G2e(0);case"blur":return new z2e(0);case"drop-shadow":return new V2e(0,0,0,[...Hte("transparent")]);case"bloom":return new F2e(0,0,1)}}function KZe(t,e){const i=t.length>e.length?t:e;return(t.length>e.length?e:t).every((r,s)=>r.type===i[s].type)}function QZe(t,e){const i=t.length>e.length?t:e,r=t.length>e.length?e:t;for(let s=r.length;s<i.length;s++)r.push(XZe(i[s]))}function eYe(t){const e=t[0];return!!e&&"type"in e}function tYe(t,e){return JSON.stringify(t??null)===JSON.stringify(e??null)}function iYe(t){return t.portalItem?.type==="Web Scene"||t.referenceLayers.some(e=>e.type==="scene")}function rYe(t){return!!t?.portalItem?.tags?.some(e=>e.toLowerCase()==="beta")}function Pqt(t,e){return!(!t.basemap?.referenceLayers?.some(i=>i.uid===e)&&!t.basemap?.baseLayers?.some(i=>i.uid===e))}function sYe(t){let e=null;const i=SW(t),r=!i?.baseLayers.length;for(const s in y$){const n=X2e(i,J2e(y$[s]),{mustMatchReferences:r});if(n==="equal"){e=s;break}n==="base-layers-equal"&&(e=s)}return e}function nYe(t,e){return t===e||t?.portalItem?.id!=null&&t.portalItem.id===e?.portalItem?.id?!0:X2e(SW(t),SW(e),{mustMatchReferences:!0})==="equal"}function xW(t){return!!t?.baseLayers.concat(t.referenceLayers).some(Z2e)}function Z2e(t){if(lue(t.url))return!0;if(t.type==="vector-tile")for(const e in t.sourceNameToSource){const i=t.sourceNameToSource[e];if(lue(i?.sourceUrl))return!0}return!1}function Y2e(t,e){if(e==null||t==null)return{spatialReference:null,updating:!1};if(e.loadStatus==="not-loaded")return e.load(),{spatialReference:null,updating:!0};if(e.spatialReference)return{spatialReference:e.spatialReference,updating:!1};if(e.baseLayers.length===0)return{spatialReference:null,updating:!1};const i=e.baseLayers.at(0);switch(i.loadStatus){case"not-loaded":i.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}const r=(("supportedSpatialReferences"in i?i.supportedSpatialReferences:null)||["tileInfo"in i?i.tileInfo?.spatialReference:i.spatialReference]).filter(Boolean),s=t.spatialReference;return s?{spatialReference:r.find(n=>s.equals(n))??r[0]??null,updating:!1}:{spatialReference:r[0],updating:!1}}const oYe=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function lue(t){if(!t)return!1;const e=new sb(Hc(t));return!!e.authority&&oYe.test(e.authority)}function SW(t){return t?!t.loaded&&t.resourceInfo?J2e(t.resourceInfo.data):{baseLayers:cue(t.baseLayers),referenceLayers:cue(t.referenceLayers)}:null}function cue(t){return(Ee.isCollection(t)?t.toArray():t).map(TW)}function TW(t){return{type:t.type,effect:"effect"in t?t.effect:void 0,url:Q2e("urlTemplate"in t&&t.urlTemplate||t.url||"styleUrl"in t&&t.styleUrl||""),minScale:"minScale"in t&&t.minScale!=null?t.minScale:0,maxScale:"maxScale"in t&&t.maxScale!=null?t.maxScale:0,opacity:t.opacity!=null?t.opacity:1,visible:t.visible==null||!!t.visible,sublayers:t.type!=="map-image"&&t.type!=="wms"||t.sublayers==null?void 0:t.sublayers?.map(e=>({id:e.id,visible:e.visible})),activeLayerId:t.type==="wmts"?t.activeLayer?.id:void 0}}function uue(t){return t.isReference||t.layerType==="ArcGISSceneServiceLayer"}function J2e(t){return t?{baseLayers:hue((t.baseMapLayers??[]).filter(e=>!uue(e))),referenceLayers:hue((t.baseMapLayers??[]).filter(e=>uue(e)))}:null}function hue(t){return t.map(e=>aYe(e))}function aYe(t){let e;switch(t.layerType){case"VectorTileLayer":e="vector-tile";break;case"ArcGISTiledMapServiceLayer":e="tile";break;case"ArcGISSceneServiceLayer":e="scene";break;default:e="unknown"}return{type:e,effect:t.effect,url:Q2e(t.templateUrl||t.urlTemplate||t.styleUrl||t.url),minScale:t.minScale??0,maxScale:t.maxScale??0,opacity:t.opacity??1,visible:t.visibility==null||!!t.visibility,sublayers:void 0,activeLayerId:void 0}}function X2e(t,e,i){return t!=null!=(e!=null)?"not-equal":!t||!e?"equal":due(t.baseLayers,e.baseLayers)?due(t.referenceLayers,e.referenceLayers)?"equal":i.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal"}function due(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!K2e(t[i],e[i]))return!1;return!0}function K2e(t,e){if(t.type!==e.type||t.url!==e.url||t.minScale!==e.minScale||t.maxScale!==e.maxScale||t.visible!==e.visible||t.opacity!==e.opacity||!tYe(t.effect,e.effect))return!1;if(t.activeLayerId!=null||e.activeLayerId!=null)return t.activeLayerId===e.activeLayerId;if(t.sublayers!=null||e.sublayers!=null){if(t.sublayers==null||e.sublayers==null||t.sublayers.length!==e.sublayers.length)return!1;for(let i=0;i<t.sublayers.length;i++){const r=t.sublayers.at(i),s=e.sublayers.at(i);if(r?.id!==s?.id||r?.visible!==s?.visible)return!1}}return!0}function Q2e(t){return t?bd(t).replace(/^\s*https?:/i,"").toLowerCase():""}function lYe(t){if(!t)return null;const{thumbnailUrl:e}=t;if(e)return e;const i=sYe(t);return i?y$[i].thumbnailUrl:J1e(t.baseLayers,cYe)}function cYe(t){return"portalItem"in t?t.portalItem?.thumbnailUrl:void 0}const L6=()=>J.getLogger("esri.support.basemapUtils");function uYe(){return{}}function hYe(t){for(const e in t){const i=t[e];Ce(i),delete t[e]}}function HV(t,e){let i;if(typeof t=="string"){const r=t in y$,s=!r&&t.includes("/");if(!r&&!s){if(Ir.apiKey)L6().warn(`Unable to find basemap definition for: ${t}. See available styles at https://developers.arcgis.com/rest/basemap-styles/`);else{const n=Object.entries(y$).filter(([o,a])=>a.classic||a.is3d).map(([o])=>`"${o}"`).sort().join(", ");L6().warn(`Unable to find basemap definition for: ${t}. Try one of these: ${n}`)}return null}e&&(i=e[t]),i||(i=r?qy.fromId(t):new qy({style:{id:t}}),e&&(e[t]=i))}else i=Is(qy,t);return i?.destroyed&&(L6().warn("The provided basemap is already destroyed",{basemap:i}),i=null),i}function dYe(t,e=null){const i=HV(t);if(!i)return null;const r=i.clone();return e&&(r.baseLayers=pue(r.baseLayers,e.baseLayers),r.referenceLayers=pue(r.referenceLayers,e.referenceLayers)),r}function pue(t,e){const i=new Ee;return t.forEach(r=>{const s=e.find(n=>n.type!=="scene"&&K2e(TW(r),TW(n)))||r;i.includes(s)?i.push(r):i.push(s)}),i}function pYe(t){return new h$({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const i=[];return"tables"in e&&i.push(e.tables),"layers"in e&&i.push(e.layers),i},itemFilterFunction:e=>{const i=e.parent;return!!i&&"tables"in i&&i.tables.includes(e)}})}function N6(t){for(const e of t.values())e?.destroy();t.clear()}const fue={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function fYe(t){let e=null;if(typeof t=="string")if(t in fue){const i=fue[t];e=new FP({resourceInfo:{data:{layers:[i]}}})}else J.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=Is(FP,t);return e}let eCe=0;const tCe=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+eCe++})}};return e=u([A("esri.core.Identifiable")],e),e},mYe=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:eCe++})}};return e=u([A("esri.core.Identifiable.NumericIdentifiable")],e),e};let xO=class extends tCe(class{}){};xO=u([A("esri.core.Identifiable")],xO),function(t){t.IdentifiableMixin=tCe,t.NumericIdentifiableMixin=mYe}(xO||(xO={}));const OS=xO;async function gYe(t){const e="portalItem"in t?t:{portalItem:t},{fromItem:i}=await V(async()=>{const{fromItem:r}=await import("./portalLayers-DUzgriCZ.js");return{fromItem:r}},__vite__mapDeps([123,121,120,119,122]));try{return await i(e)}catch(r){const s=e?.portalItem,n=s?.id||"unset",o=s?.portal?.url||Ir.portalUrl;throw J.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+n+"')",r),r}}const mue={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8};function F6(t,e,i,r=cf){const s=new iu(Mte(r)),n=yt.fromJSDate(t,{zone:s}),o=i==="decades"||i==="centuries"?"year":rCe(i);return i==="decades"&&(e*=10),i==="centuries"&&(e*=100),n.plus({[o]:e}).toJSDate()}function Lqt(t,e,i="milliseconds"){const r=t.getTime(),s=iCe(e,i,"milliseconds");return new Date(r+s)}function gue(t,e,i=cf){const r=new iu(Mte(i)),s=yt.fromJSDate(t,{zone:r});if(e==="decades"||e==="centuries"){const o=s.startOf("year"),{year:a}=o,l=a-a%(e==="decades"?10:100);return o.set({year:l}).toJSDate()}const n=rCe(e);return s.startOf(n).toJSDate()}function iCe(t,e,i){return t===0?0:t*mue[e]/mue[i]}function Nqt(t,e){return t&&e?t.intersection(e):t||e}function rCe(t){switch(t){case"milliseconds":return"millisecond";case"seconds":return"second";case"minutes":return"minute";case"hours":return"hour";case"days":return"day";case"weeks":return"week";case"months":return"month";case"years":return"year"}}var Th;let ku=Th=class extends ee{static get allTime(){return yue}static get empty(){return yYe}static fromArray(t){return new Th({start:t[0]!=null?new Date(t[0]):t[0],end:t[1]!=null?new Date(t[1]):t[1]})}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=t?.getTime()??null}get isAllTime(){return this.equals(Th.allTime)}get isEmpty(){return this.equals(Th.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=t?.getTime()??null}clone(){return new Th({end:this.end,start:this.start})}equals(t){if(!t)return!1;const e=this.start?.getTime()??this.start,i=this.end?.getTime()??this.end,r=t.start?.getTime()??t.start,s=t.end?.getTime()??t.end;return e===r&&i===s}expandTo(t,e=cf){if(this.isEmpty||this.isAllTime)return this.clone();let i=this.start;i&&(i=gue(i,t,e));let r=this.end;if(r){const s=gue(r,t,e);r=r.getTime()===s.getTime()?s:F6(s,1,t,e)}return new Th({start:i,end:r})}intersection(t){if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return Th.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=this.start?.getTime()??-1/0,i=this.end?.getTime()??1/0,r=t.start?.getTime()??-1/0,s=t.end?.getTime()??1/0;let n,o;return r>=e&&r<=i?n=r:e>=r&&e<=s&&(n=e),i>=r&&i<=s?o=i:s>=e&&s<=i&&(o=s),n==null||o==null||isNaN(n)||isNaN(o)?Th.empty:new Th({start:n===-1/0?null:new Date(n),end:o===1/0?null:new Date(o)})}offset(t,e,i=cf){if(this.isEmpty||this.isAllTime)return this.clone();const r=new Th,{start:s,end:n}=this;return s!=null&&(r.start=F6(s,t,e,i)),n!=null&&(r.end=F6(n,t,e,i)),r}toArray(){return this.isEmpty?[void 0,void 0]:[this.start?.getTime()??null,this.end?.getTime()??null]}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return yue.clone();const e=this.start!=null&&t.start!=null?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,i=this.end!=null&&t.end!=null?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new Th({start:e,end:i})}};u([p({type:Date,json:{write:{allowNull:!0}}})],ku.prototype,"end",void 0),u([me("end")],ku.prototype,"readEnd",null),u([ge("end")],ku.prototype,"writeEnd",null),u([p({readOnly:!0,json:{read:!1}})],ku.prototype,"isAllTime",null),u([p({readOnly:!0,json:{read:!1}})],ku.prototype,"isEmpty",null),u([p({type:Date,json:{write:{allowNull:!0}}})],ku.prototype,"start",void 0),u([me("start")],ku.prototype,"readStart",null),u([ge("start")],ku.prototype,"writeStart",null),ku=Th=u([A("esri.time.TimeExtent")],ku);const To=ku,yue=new ku,yYe=new ku({start:void 0,end:void 0});let vYe=0,bn=class extends ws.EventedMixin(OS.IdentifiableMixin($l)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new gi(-180,-90,180,90,Ae.WGS84),this.id=Date.now().toString(16)+"-layer-"+vYe++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.persistenceEnabled=!1,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=Ae.WGS84,this.title=null,this.type=null,this.url=null,this.visibilityTimeExtent=null,this.visible=!0}static async fromArcGISServerUrl(e){const i=typeof e=="string"?{url:e}:e;return(await V(async()=>{const{fromUrl:r}=await import("./arcgisLayers-D7GVNASB.js");return{fromUrl:r}},__vite__mapDeps([124,121,120,122]))).fromUrl(i)}static fromPortalItem(e){return gYe(e)}initialize(){this.when().catch(e=>{Xr(e)||J.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){const e=this.parent;if(e){const i=this;"layers"in e&&e.layers.includes(i)?e.layers.remove(i):"tables"in e&&e.tables.includes(i)?e.tables.remove(i):"baseLayers"in e&&e.baseLayers.includes(i)?e.baseLayers.remove(i):"referenceLayers"in e&&e.referenceLayers.includes(i)&&e.referenceLayers.remove(i),this._set("parent",null)}}get effectiveVisible(){let e=this.visible;const i=this.parent;return e&&i&&"effectiveVisible"in i&&(e&&=i.effectiveVisible),e}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return pn(this.url)}createLayerView(e,i){return Promise.reject(new U("layer:create-layer-view","Layer does not support creating a layer view"))}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await Ci(e,{query:{f:"json"},responseType:"json"})).data;throw new U("layer:no-attribution-data","Layer does not have attribution data")}};u([p({type:String})],bn.prototype,"attributionDataUrl",void 0),u([p({readOnly:!0})],bn.prototype,"effectiveVisible",null),u([p({type:gi})],bn.prototype,"fullExtent",void 0),u([p({readOnly:!0})],bn.prototype,"hasAttributionData",null),u([p({type:String,clonable:!1})],bn.prototype,"id",void 0),u([p({type:Boolean,nonNullable:!0})],bn.prototype,"legendEnabled",void 0),u([p({type:["show","hide","hide-children"]})],bn.prototype,"listMode",void 0),u([p({type:Number,range:{min:0,max:1},nonNullable:!0})],bn.prototype,"opacity",void 0),u([p({clonable:!1})],bn.prototype,"parent",void 0),u([p({readOnly:!0})],bn.prototype,"parsedUrl",null),u([p({type:Boolean,readOnly:!0})],bn.prototype,"persistenceEnabled",void 0),u([p({type:Boolean})],bn.prototype,"popupEnabled",void 0),u([p({type:Boolean})],bn.prototype,"attributionVisible",void 0),u([p({type:Ae})],bn.prototype,"spatialReference",void 0),u([p({type:String})],bn.prototype,"title",void 0),u([p({readOnly:!0,json:{read:!1}})],bn.prototype,"type",void 0),u([p()],bn.prototype,"url",void 0),u([p({type:To})],bn.prototype,"visibilityTimeExtent",void 0),u([p({type:Boolean,nonNullable:!0})],bn.prototype,"visible",void 0),bn=u([A("esri.layers.Layer")],bn);const qV=bn;function EW(t,e,i){let r,s;if(t)for(let n=0,o=t.length;n<o;n++){if(r=t.at(n),r?.[e]===i)return r;if(r?.type==="group"&&(s=EW(r.layers,e,i),s))return s}}const _Ye=t=>{let e=class extends t{constructor(...i){super(...i),this.layers=new Ee;const r=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||J.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.addHandles([this.layers.on("before-add",o=>{if(o.item===this)return o.preventDefault(),void J.getLogger(this).error("#add()","Cannot add layer to itself.");r(o.item)}),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))])}destroy(){const i=this.layers.toArray();for(const r of i)r.destroy();this.layers.destroy()}set layers(i){this._set("layers",df(i,this._get("layers")))}add(i,r){const s=this.layers;if(r=s.getNextIndex(r),i instanceof qV){const n=i;n.parent===this?this.reorder(n,r):s.add(n,r)}else nu(i)?i.then(n=>{this.destroyed||this.add(n,r)}):J.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(i,r){const s=this.layers;let n=s.getNextIndex(r);i.slice().forEach(o=>{o.parent!==this?(s.add(o,n),n+=1):this.reorder(o,n)})}findLayerById(i){return EW(this.layers,"id",i)}findLayerByUid(i){return EW(this.layers,"uid",i)}remove(i){return this.layers.remove(i)}removeMany(i){return this.layers.removeMany(i)}removeAll(){return this.layers.removeAll()}reorder(i,r){return this.layers.reorder(i,r)}layerAdded(i){}layerRemoved(i){}};return u([p()],e.prototype,"layers",null),e=u([A("esri.support.LayersMixin")],e),e},bYe=new Set(["feature","subtype-group"]);function CW(t,e,i){if(t)for(let r=0,s=t.length;r<s;r++){const n=t.at(r);if(n[e]===i)return n;if(n?.type==="group"){const o=CW(n.tables,e,i);if(o)return o}}}const wYe=t=>{let e=class extends t{constructor(...i){super(...i),this.tables=new Ee,this.addHandles([this.tables.on("after-add",r=>{const s=r.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,bYe.has(s.type)||J.getLogger(this).error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",r=>{r.item.parent=null})])}destroy(){const i=this.tables.toArray();for(const r of i)r.destroy();this.tables.destroy()}set tables(i){this._set("tables",df(i,this._get("tables")))}findTableById(i){return CW(this.tables,"id",i)}findTableByUid(i){return CW(this.tables,"uid",i)}};return u([p()],e.prototype,"tables",null),e=u([A("esri.support.TablesMixin")],e),e};let ap=class extends wYe(_Ye(ws.EventedMixin(ue))){constructor(e){super(e),this.allLayers=new h$({getCollections:()=>[this.basemap?.baseLayers,this.ground?.layers,this.layers,this.basemap?.referenceLayers],getChildrenFunction:i=>"layers"in i?i.layers:null}),this.allTables=pYe(this),this.basemap=null,this.editableLayers=new h$({getCollections:()=>[this.allLayers],itemFilterFunction:dZe}),this.ground=new FP,this._basemapCache=uYe()}destroy(){hYe(this._basemapCache),this._basemapCache=null,this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=Ce(this.basemap),Ce(this.ground),this._set("ground",null)}castBasemap(e){return HV(e,this._basemapCache)}castGround(e){return fYe(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(i=>i.id===e)}findTableById(e){return this.allTables.find(i=>i.id===e)}};u([p({readOnly:!0,dependsOn:[]})],ap.prototype,"allLayers",void 0),u([p({readOnly:!0})],ap.prototype,"allTables",void 0),u([p({type:qy,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],ap.prototype,"basemap",void 0),u([Yt("basemap")],ap.prototype,"castBasemap",null),u([p({readOnly:!0})],ap.prototype,"editableLayers",void 0),u([p({type:FP,nonNullable:!0})],ap.prototype,"ground",void 0),u([Yt("ground")],ap.prototype,"castGround",null),u([p()],ap.prototype,"undoRedo",void 0),ap=u([A("esri.Map")],ap);const Xte=ap;let bR=class extends Ee{constructor(e){super(e),this.addHandles([this.on("before-add",i=>{i.item==null&&i.preventDefault()}),this.on("after-add",i=>this._own(i.item)),this.on("after-remove",i=>this._release(i.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(Ee.ofType(this.itemType.Type))(e):new Ee(e)}};function $W(t,e){return{type:t,cast:Vte,set(i){const r=df(i,this._get(e),t);r.owner=this,this._set(e,r)}}}u([p()],bR.prototype,"owner",null),bR=u([A("esri.core.support.OwningCollection")],bR);var SO;const rU=Mo()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),sCe=rU.jsonValues.slice();vP(sCe,"orthometric");const wR=Mo()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let lp=SO=class extends ee{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,i){return rU.write(t,e,i)}readHeightModel(t,e,i){return rU.read(t)||(i?.messages&&i.messages.push(xYe(t,{context:i})),null)}readHeightUnit(t,e,i){return wR.read(t)||(i?.messages&&i.messages.push(vue(t,{context:i})),null)}readHeightUnitService(t,e,i){return nte(t)||wR.read(t)||(i?.messages&&i.messages.push(vue(t,{context:i})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new SO({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const i=gSe(e);return new SO({heightModel:t.heightModel,heightUnit:i??void 0,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new SO;return e.read(t,{origin:"web-scene"}),e}};function vue(t,e){return new sh("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function xYe(t,e){return new sh("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}u([p({type:rU.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:sCe,default:"ellipsoidal",write:{isRequired:!0}}}}})],lp.prototype,"heightModel",void 0),u([ge("web-scene","heightModel")],lp.prototype,"writeHeightModel",null),u([me(["web-scene","service"],"heightModel")],lp.prototype,"readHeightModel",null),u([p({type:wR.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:wR.jsonValues,write:{writer:wR.write,isRequired:!0}}}}})],lp.prototype,"heightUnit",void 0),u([me("web-scene","heightUnit")],lp.prototype,"readHeightUnit",null),u([me("service","heightUnit")],lp.prototype,"readHeightUnitService",null),u([p({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],lp.prototype,"vertCRS",void 0),u([me("service","vertCRS",["vertCRS","ellipsoid","geoid"])],lp.prototype,"readVertCRS",null),lp=SO=u([A("esri.geometry.HeightModelInfo")],lp);const Bb=lp;let x$=class extends bR{constructor(e){super(e),this.addHandles(this.on("before-add",i=>{i.item!=null&&i.item.parent===this.owner&&(J.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),i.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};x$=u([A("esri.support.AnalysesCollection")],x$);let k6;async function SYe(){return k6==null&&(k6=V(()=>import("./WhereClauseCache-9TmBMoEG.js"),__vite__mapDeps([18,19,20])).then(t=>new t.WhereClauseCache(500,500))),k6}async function Kte(t,e){const i=await SYe(),r=i.get(t,e);if(r==null)throw i.getError(t,e);return r}function TYe(t,e){return t||=null,e||=null,t==="1=1"?e??t:e==="1=1"?t??e:t&&e?`(${t}) AND (${e})`:t??e}function EYe(t,e){return t||=null,e||=null,t==="1=1"||e==="1=1"||t===e?t==="1=1"?t:e:t&&e?`(${t}) OR (${e})`:t??e}function Bqt(t,e){return e.length===0?null:`${t} IN (${CYe(e)})`}function CYe(t){return t.map(e=>typeof e=="string"?$Ye(e):e).join(",")}function $Ye(t){return`'${t.replaceAll("'","''")}'`}function v_(t){return typeof t=="number"}function Vqt(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t}function jqt(t){return typeof t=="boolean"}function Vb(t){return typeof t=="string"||t instanceof String}function nCe(t){return t==null||Vb(t)}function Gqt(t){return Array.isArray(t)}function AYe(t){return t?.declaredClass==="esri.Graphic"}function Hqt(t){return t?.declaredClass==="esri.rest.support.Query"}function qqt(t){return t instanceof Date}const MYe="HH:mm",OYe="HH:mm:ss",IYe="HH:mm:ss.SSS",RYe=[IYe,OYe,MYe,"TT"],PYe="yyyy-MM-dd";function _ue(t){if(!t||!Vb(t))return null;const e=yt.fromFormat(t,PYe);return e.isValid?e:null}function bue(t){return t&&Vb(t)?J1e(RYe,e=>{const i=yt.fromFormat(t,e);return i.isValid?i:null})??null:null}function wue(t){if(!t||!Vb(t))return null;const e=yt.fromISO(t);return e.isValid?e:null}var sU;(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(sU||(sU={}));const oCe=new Set(["integer","small-integer","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]);function DYe(t){return t!=null&&oCe.has(t.type)}function aCe(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function lCe(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function cCe(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}const LYe=new Set(["single","double","esriFieldTypeSingle","esriFieldTypeDouble"]);Lee(oCe,LYe);function NYe(t,e){const i=t?.domain;if(!i||i.type!=="range")return;const r="range"in i?i.range[0]:i.minValue,s="range"in i?i.range[1]:i.maxValue,n=DYe(t);return aCe(t)||cCe(t)||lCe(t)?{...FYe(t,s,r),isInteger:n}:{min:r!=null&&typeof r=="number"?r:null,max:s!=null&&typeof s=="number"?s:null,rawMin:r,rawMax:s,isInteger:n}}function FYe(t,e,i){return aCe(t)?{min:_ue(i)?.toMillis(),max:_ue(e)?.toMillis(),rawMin:i,rawMax:e}:cCe(t)?{min:bue(i)?.toMillis(),max:bue(e)?.toMillis(),rawMin:i,rawMax:e}:lCe(t)?{min:wue(i)?.toMillis(),max:wue(e)?.toMillis(),rawMin:i,rawMax:e}:{max:null,min:null}}function uCe(t){if(!t)return;const e=t.match(kYe);return e?.groups?e.groups.doubleQuoted??e.groups.singleQuoted??e.groups.dotNotation:void 0}const kYe=/^(\$feature\[(?:"(?<doubleQuoted>[^"]+)"|'(?<singleQuoted>[^']+)')\]|\$feature\.(?<dotNotation>[a-zA-Z_][a-zA-Z0-9_]*))$/i;function zYe(t){return t.match(UYe)?.[1]?.replace(/\\'/g,"'")??null}const UYe=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;let Fp=class{};function BYe(t){return t instanceof AS?t===Fp.instance:t?.toString().toLowerCase()==="unknown"}function Zqt(t){return BYe(t)?Fp.instance:t}Fp.instance=new iu("Etc/UTC");var nU;(function(t){t.TimeZoneNotRecognized="TimeZoneNotRecognized"})(nU||(nU={}));const VYe={[nU.TimeZoneNotRecognized]:"Timezone identifier has not been recognized."};let jYe=class hCe extends Error{constructor(e,i){super(G3(VYe[e],i)),this.declaredRootClass="esri.arcade.arcadedate.dateerror",Error.captureStackTrace&&Error.captureStackTrace(this,hCe)}};function aT(t,e,i){return t<e?t-e:t>i?t-i:0}function lT(t,e,i){return t<e?e:t>i?i:t}let BL=class Hn{constructor(e){this._date=e,this.declaredRootClass="esri.arcade.arcadedate"}static fromParts(e=0,i=1,r=1,s=0,n=0,o=0,a=0,l){if(isNaN(e)||isNaN(i)||isNaN(r)||isNaN(s)||isNaN(n)||isNaN(o)||isNaN(a))return null;const c=yt.local(e,i).daysInMonth;let h=yt.fromObject({day:lT(r,1,c),year:e,month:lT(i,1,12),hour:lT(s,0,23),minute:lT(n,0,59),second:lT(o,0,59),millisecond:lT(a,0,999)},{zone:lw(l)});return h=h.plus({months:aT(i,1,12),days:aT(r,1,c),hours:aT(s,0,23),minutes:aT(n,0,59),seconds:aT(o,0,59),milliseconds:aT(a,0,999)}),new Hn(h)}static get systemTimeZoneCanonicalName(){return Intl.DateTimeFormat().resolvedOptions().timeZone??"system"}static arcadeDateAndZoneToArcadeDate(e,i){const r=lw(i);return e.isUnknownTimeZone||r===Fp.instance?Hn.fromParts(e.year,e.monthJS+1,e.day,e.hour,e.minute,e.second,e.millisecond,r):new Hn(e._date.setZone(r))}static dateJSToArcadeDate(e){return new Hn(yt.fromJSDate(e,{zone:"system"}))}static dateJSAndZoneToArcadeDate(e,i="system"){const r=lw(i);return new Hn(yt.fromJSDate(e,{zone:r}))}static unknownEpochToArcadeDate(e){return new Hn(yt.fromMillis(e,{zone:Fp.instance}))}static unknownDateJSToArcadeDate(e){return new Hn(yt.fromMillis(e.getTime(),{zone:Fp.instance}))}static epochToArcadeDate(e,i="system"){const r=lw(i);return new Hn(yt.fromMillis(e,{zone:r}))}static dateTimeToArcadeDate(e){return new Hn(e)}clone(){return new Hn(this._date)}changeTimeZone(e){const i=lw(e);return Hn.dateTimeToArcadeDate(this._date.setZone(i))}static dateTimeAndZoneToArcadeDate(e,i){const r=lw(i);return e.zone===Fp.instance||r===Fp.instance?Hn.fromParts(e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond,r):new Hn(e.setZone(r))}static nowToArcadeDate(e){const i=lw(e);return new Hn(yt.fromJSDate(new Date,{zone:i}))}static nowUTCToArcadeDate(){return new Hn(yt.utc())}get isSystem(){return this.timeZone==="system"||this.timeZone===Hn.systemTimeZoneCanonicalName}equals(e){return this.isSystem&&e.isSystem?this.toNumber()===e.toNumber():this.isUnknownTimeZone===e.isUnknownTimeZone&&this._date.equals(e._date)}get isUnknownTimeZone(){return this._date.zone===Fp.instance}get isValid(){return this._date.isValid}get hour(){return this._date.hour}get second(){return this._date.second}get day(){return this._date.day}get dayOfWeekISO(){return this._date.weekday}get dayOfWeekJS(){let e=this._date.weekday;return e>6&&(e=0),e}get millisecond(){return this._date.millisecond}get monthISO(){return this._date.month}get weekISO(){return this._date.weekNumber}get yearISO(){return this._date.weekYear}get monthJS(){return this._date.month-1}get year(){return this._date.year}get minute(){return this._date.minute}get zone(){return this._date.zone}get timeZoneOffset(){return this.isUnknownTimeZone?0:this._date.offset}get timeZone(){if(this.isUnknownTimeZone)return"unknown";if(this._date.zone.type==="system")return"system";const e=this.zone;return e.type==="fixed"?e.fixed===0?"UTC":e.formatOffset(0,"short"):e.name}stringify(){return JSON.stringify(this.toJSDate())}plus(e){return new Hn(this._date.plus(e))}diff(e,i="milliseconds"){return this._date.diff(e._date,i)[i]}toISODate(){return this._date.toISODate()}toISOString(e){return e?this._date.toISO({suppressMilliseconds:!0,includeOffset:!this.isUnknownTimeZone}):this._date.toISO({includeOffset:!this.isUnknownTimeZone})}toISOTime(e,i){return this._date.toISOTime({suppressMilliseconds:e,includeOffset:i&&!this.isUnknownTimeZone})}toFormat(e,i){return this.isUnknownTimeZone&&(e=e.replaceAll("Z","")),this._date.toFormat(e,i)}toJSDate(){return this._date.toJSDate()}toSQLValue(){return this._date.toFormat("yyyy-LL-dd HH:mm:ss")}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}toDateTime(){return this._date}toNumber(){return this._date.toMillis()}getTime(){return this._date.toMillis()}toUTC(){return new Hn(this._date.toUTC())}toLocal(){return new Hn(this._date.toLocal())}toString(){return this.toISOString(!0)}static fromReaderAsTimeStampOffset(e){if(!e)return null;const i=yt.fromISO(e,{setZone:!0});return new Hn(i)}};function lw(t,e=!0){if(t instanceof AS)return t;if(t.toLowerCase()==="system")return"system";if(t.toLowerCase()==="utc")return"UTC";if(t.toLowerCase()==="unknown")return Fp.instance;if(/^[+-]?[0-9]{1,2}([:][0-9]{2})?$/.test(t)){const r=ba.parseSpecifier("UTC"+(t.startsWith("+")||t.startsWith("-")?"":"+")+t);if(r)return r}const i=iu.create(t);if(!i.isValid){if(e)throw new jYe(nU.TimeZoneNotRecognized);return null}return i}const GYe=()=>J.getLogger("esri.support.arcadeOnDemand"),HYe=["geometry","scale","timeProperties"];function Yqt(t,e){if(e!=null)for(const i of HYe)e.hasArcadeDependency(i)&&t.add(i);return t}let z6;function av(){return z6||(z6=(async()=>{const t=await V(()=>import("./arcadeUtils-WwErNi4-.js"),__vite__mapDeps([125,126,127,128,110,20,28,19,129]));return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature,Voxel:t.Voxel}})()),z6}const qYe=(t,e,i)=>Qte.create(t,e,i,null,["$feature","$view"],[]),Jqt=(t,e,i)=>Qte.create(t,e,i,null,["$feature","$view"],[]),WYe=(t,e,i,r)=>Qte.create(t,e,i,r,["$feature","$view"],[]);let Qte=class dCe{constructor(e,i,r,s,n,o,a){this._dependencies=new Map,this.services=null,this.script=e,this.evaluate=s;const l=Array.isArray(o)?o:o?.fields;this.fields=l??[],this._syntaxTree=r,this._arcade=i,this._arcadeFeature=n,this._spatialReference=a,this._dependencies.set("geometry",i.scriptTouchesGeometry(this._syntaxTree)),this._dependencies.set("scale",this._arcade.referencesMember(this._syntaxTree,"scale")),this._dependencies.set("timeProperties",this._arcade.scriptUsesViewProperties(this._syntaxTree,["timeProperties"]))}static async create(e,i,r,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await av(),h=i instanceof Ae?i:Ae.fromJSON(i);let d;try{d=a.parseScript(e,o)}catch(I){return GYe().error(new U("arcade-bad-expression","Failed to parse arcade script",{script:e,error:I})),null}const f=n.reduce((I,P)=>({...I,[P]:null}),{});let m=null;s!=null&&(m=new c(s),m.immutable=!0,f.$config=null);const y=a.scriptUsesGeometryEngine(d),v=y&&a.enableGeometrySupport(),_=a.scriptUsesFeatureSet(d)&&a.enableFeatureSetSupport(),b=a.scriptIsAsync(d),w=b&&a.enableAsyncSupport(),x={vars:f,spatialReference:h,useAsync:!!w};await Promise.all([v,_,w]);const S=new Set;await a.loadDependentModules(S,d,null,b,y);const C=new c;C.immutable=!1,C.setField("scale",0);const T=a.compileScript(d,x),M=(I,P)=>{const D=I.$view?.timeZone;if("$view"in I&&I.$view){let F;if(C.setField("scale",typeof I.$view=="object"&&"scale"in I.$view?I.$view.scale:void 0),typeof I.$view=="object"&&"timeProperties"in I.$view&&I.$view.timeProperties!=null){const{currentStart:L,currentEnd:N}=I.$view.timeProperties;F=new c({currentStart:L!=null?D!=null?BL.epochToArcadeDate(L,D):BL.unknownEpochToArcadeDate(L):void 0,currentEnd:N!=null?D!=null?BL.epochToArcadeDate(N,D):BL.unknownEpochToArcadeDate(N):void 0,startIncluded:!0,endIncluded:!0})}C.setField("timeProperties",F),I.$view=C}return m&&(I.$config=m),T({vars:I,spatialReference:h,services:P,timeZone:D})};return new dCe(e,a,d,M,new l,r,h)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}references(e){return this._dependencies.get(e)??!1}};const ZYe=/^([0-9_])/,YYe=/[^a-z0-9_\u0080-\uffff]+/gi;function JYe(t){return t==null?null:t.trim().replaceAll(YYe,"_").replace(ZYe,"F$1")||null}const XYe=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],KYe=["field","normalizationField"];function xue(t,e){if(t!=null&&e!=null){for(const i of Array.isArray(t)?t:[t])if(Sue(XYe,i,e),"visualVariables"in i&&i.visualVariables)for(const r of i.visualVariables)Sue(KYe,r,e)}}function Sue(t,e,i){if(t)for(const r of t){const s=hV(r,e),n=s&&typeof s!="function"&&i.get(s);n&&to(r,n.name,e)}}function pCe(t,e){if(t!=null&&e?.fields?.length)if("startField"in t){const i=e.get(t.startField),r=e.get(t.endField);t.startField=i?.name??null,t.endField=r?.name??null}else{const i=e.get(t.startTimeField),r=e.get(t.endTimeField);t.startTimeField=i?.name??null,t.endTimeField=r?.name??null}}const U6=new Set;function WV(t,e){return t&&e?(U6.clear(),iS(U6,t,e),Array.from(U6).sort()):[]}function iS(t,e,i){if(i)if(e?.fields?.length)if(i.includes("*"))for(const{name:r}of e.fields)t.add(r);else for(const r of i)cc(t,e,r);else{if(i.includes("*"))return t.clear(),void t.add("*");for(const r of i)r!=null&&t.add(r)}}function cc(t,e,i){if(typeof i=="string")if(e){const r=e.get(i);r&&t.add(r.name)}else t.add(i)}function Xqt(t,e){return e==null||t==null?[]:e.includes("*")?(t.fields??[]).map(i=>i.name):e}function Kqt(t,e,i=1){if(!e||!t)return[];if(e.includes("*"))return["*"];const r=WV(t,e);return r.length/t.fields.length>=i?["*"]:r}async function Al(t,e,i){if(!i)return;let r;const s=uCe(i);if(s)r=[s];else{const{arcadeUtils:n}=await av();r=n.extractFieldNames(i,e?.fields?.map(o=>o.name))}for(const n of r)cc(t,e,n)}async function eie(t,e,i){if(i&&i!=="1=1"){const r=await Kte(i,e);if(!r.isStandardized)throw new U("fieldUtils:collectFilterFields","Where clause is not standardized",{where:i});iS(t,e,r.fieldNames)}}function QYe({displayField:t,fields:e}){return t||(e?.length?B6(e,"name-or-title")||B6(e,"unique-identifier")||B6(e,"type-or-category")||eJe(e):null)}function eJe(t){for(const e of t){if(!e?.name)continue;const i=e.name.toLowerCase();if(i.includes("name")||i.includes("title"))return e.name}return null}function B6(t,e){for(const i of t)if(i?.valueType&&i.valueType===e)return i.name;return null}async function Qqt(t,e){if(!e)return;const i=e.elevationInfo?.featureExpressionInfo;return i?i.collectRequiredFields(t,e.fieldsIndex):void 0}function tJe(t,e,i){i.onStatisticExpression?Al(t,e,i.onStatisticExpression.expression):t.add(i.onStatisticField)}async function e9t(t,e,i){if(!e||!i||!("fields"in i))return;const r=[],s=i.popupTemplate;r.push(fCe(t,e,s)),i.fields&&r.push(...i.fields.map(async n=>tJe(t,e.fieldsIndex,n))),await Promise.all(r)}async function t9t(t,e){const{fieldsIndex:i,trackInfo:r}=e;if(!e||!r||!i)return;const s=[r.latestObservations.renderer?.collectRequiredFields(t,i),r.previousObservations.renderer?.collectRequiredFields(t,i),r.trackLines.renderer?.collectRequiredFields(t,i)];r.popupTemplate&&s.push(fCe(t,e,r.popupTemplate));for(const n of[r.latestObservations.labelingInfo,r.previousObservations.labelingInfo,r.trackLines.labelingInfo])if(n)for(const o of n)s.push(yCe(t,i,o));await Promise.all(s)}async function fCe(t,e,i){const r=[];i?.expressionInfos&&r.push(...i.expressionInfos.map(n=>Al(t,e.fieldsIndex,n.expression)));const s=i?.content;if(Array.isArray(s))for(const n of s)n.type==="expression"&&n.expressionInfo&&r.push(Al(t,e.fieldsIndex,n.expressionInfo.expression));await Promise.all(r)}async function i9t(t,e,i){e&&(e.timeInfo&&i?.timeExtent&&iS(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&iS(t,e.fieldsIndex,[e.floorInfo.floorField]),i?.where!=null&&await eie(t,e.fieldsIndex,i.where))}async function r9t(t,e,i){e&&i&&await Promise.all(i.map(r=>iJe(t,e,r)))}async function iJe(t,e,i){e&&i&&(i.valueExpression?await Al(t,e.fieldsIndex,i.valueExpression):i.field&&cc(t,e.fieldsIndex,i.field))}function s9t(t){return t?WV(t.fieldsIndex,mCe(t)):[]}function rJe(t){if(!t)return[];const e=t.geometryFieldsInfo;return e?WV(t.fieldsIndex,[e.shapeAreaField,e.shapeLengthField]):[]}async function n9t(t,e,i){if(!e||!i)return;const r=e.fieldsIndex;await Promise.all(i.filters.map(s=>eie(t,r,s.where)))}const sJe=new Set(["oid","global-id","guid"]),nJe=new Set(["oid","global-id"]),oJe=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^shape$/i,/^shape_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/perimeter/i,/objectid/i,/_i$/i];function aJe(t){const e=new Set;gCe(t).forEach(r=>e.add(r)),rJe(t).forEach(r=>e.add(r.toLowerCase()));const i=t&&"infoFor3D"in t?t.infoFor3D:void 0;return i&&(Object.values(i.assetMapFieldRoles).forEach(r=>e.add(r.toLowerCase())),Object.values(i.transformFieldRoles).forEach(r=>e.add(r.toLowerCase()))),Array.from(e)}function mCe(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;if(!e)return[];const{creationDateField:i,creatorField:r,editDateField:s,editorField:n}=e;return[i,r,s,n].filter(Boolean)}function gCe(t){return mCe(t).map(e=>e.toLowerCase())}function lJe(t,e){return t.editable&&!sJe.has(t.type)&&!gCe(e).includes(t.name?.toLowerCase()??"")}function cJe(t,e){const i=t.name?.toLowerCase()??"";return!(e?.objectIdField!=null&&i===e.objectIdField.toLowerCase()||e?.globalIdField!=null&&i===e.globalIdField.toLowerCase()||aJe(e).includes(i)||nJe.has(t.type)||oJe.some(r=>r.test(i)))}async function o9t(t,e){const{labelingInfo:i,fieldsIndex:r}=e;i?.length&&await Promise.all(i.map(s=>yCe(t,r,s)))}async function yCe(t,e,i){if(!i)return;const r=i.getLabelExpression(),s=i.where;if(r.type==="arcade")await Al(t,e,r.expression);else{const n=r.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{cc(t,e,o.slice(1,-1))})}await eie(t,e,s)}function uJe(t){const e=t.defaultValue;return e!==void 0&&_Ce(t,e)?e:t.nullable?null:void 0}function a9t(t){const e=typeof t=="string"?{type:t}:t;return tie(e)?255:e.type==="esriFieldTypeDate"||e.type==="date"?8:void 0}function vCe(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function hJe(t){return t===null||vCe(t)}function dJe(t){return t===null||Number.isInteger(t)}function pJe(){return!0}function _Ce(t,e){let i;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"big-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":case"esriFieldTypeBigInteger":i=t.nullable?dJe:Number.isInteger;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=t.nullable?hJe:vCe;break;case"string":case"esriFieldTypeString":i=t.nullable?nCe:Vb;break;default:i=pJe}return arguments.length===1?i:i(e)}const fJe=["integer","small-integer","big-integer"],mJe=["single","double"],gJe=["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"],yJe=["esriFieldTypeSingle","esriFieldTypeDouble"],bCe=new Set([...fJe,...gJe]),vJe=new Set([...mJe,...yJe]),_Je=Lee(bCe,vJe);function wCe(t){return t!=null&&bCe.has(t.type)}function ZV(t){return t!=null&&_Je.has(t.type)}function tie(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}function xCe(t){return t!=null&&(t.type==="date"||t.type==="esriFieldTypeDate")}function l9t(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function c9t(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function bJe(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function Tue(t){return t!=null&&(t.type==="oid"||t.type==="esriFieldTypeOID")}function Eue(t){return t!=null&&(t.type==="global-id"||t.type==="esriFieldTypeGlobalID")}function u9t(t,e){return wJe(t,e)===null}var oU,aU;function h9t(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function wJe(t,e){return t==null||t.nullable&&e===null?null:_Ce(t,e)?ZV(t)&&!xJe(t.type,Number(e))?oU.OUT_OF_RANGE:null:aU.INVALID_TYPE}function xJe(t,e){const i=typeof t=="string"?SCe(t):t;if(!i)return!1;const r=i.min,s=i.max;return i.isInteger?Number.isInteger(e)&&e>=r&&e<=s:e>=r&&e<=s}function SCe(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return SJe;case"esriFieldTypeInteger":case"integer":return TJe;case"esriFieldTypeBigInteger":case"big-integer":return EJe;case"esriFieldTypeSingle":case"single":return CJe;case"esriFieldTypeDouble":case"double":return $Je}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(oU||(oU={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(aU||(aU={}));const SJe={min:-32768,max:32767,isInteger:!0,rawMin:-32768,rawMax:32767},TJe={min:-2147483648,max:2147483647,isInteger:!0,rawMin:-2147483648,rawMax:2147483647},EJe={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0,rawMin:-Number.MAX_SAFE_INTEGER,rawMax:Number.MAX_SAFE_INTEGER},CJe={min:-34e37,max:12e37,isInteger:!1,rawMin:-34e37,rawMax:12e37},$Je={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1,rawMin:-Number.MAX_VALUE,rawMax:Number.MAX_VALUE};function d9t(t,e,i){switch(t){case sU.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case sU.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case aU.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case oU.OUT_OF_RANGE:{const{min:r,max:s}=SCe(e.type);return`Value ${i} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${r} to ${s}`}}}function AJe(t,e){return!MJe(t,e,null)}function MJe(t,e,i){if(!e?.attributes||!t){if(i!=null)for(const n of t??[])i.add(n);return!0}const r=new Set(Object.keys(e.attributes));let s=!1;for(const n of t)if(!r.has(n)){if(s=!0,i==null)break;i.add(n)}return s}function OJe(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}async function p9t(t,e){const i=new Set;return t?.collectRequiredFields&&await t.collectRequiredFields(i,e),Array.from(i).sort()}function iie(t){const e=t?.match(/{[^}]+}/g);return e?e.map(i=>i.slice(1,-1).split(":")[0].trim()):[]}let Yk=class extends ee{constructor(e){super(e),this.type=null}};u([p({type:["attachments","custom","fields","media","text","expression","relationship","utility-network-associations"],readOnly:!0,json:{read:!1,write:!0}})],Yk.prototype,"type",void 0),Yk=u([A("esri.popup.content.Content")],Yk);const Av=Yk,VL=new ei({asc:"ascending",desc:"descending"});let TO=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.field=null,this.order="ascending"}};u([p({type:String,json:{write:!0}})],TO.prototype,"field",void 0),u([p({type:VL.apiValues,json:{type:VL.jsonValues,read:VL.read,write:VL.write}})],TO.prototype,"order",void 0),TO=u([A("esri.popup.support.AttachmentsOrderByInfo")],TO);const IJe=TO;let M0=class extends Dt.ClonableMixin(Av){constructor(e){super(e),this.description=null,this.displayType="auto",this.orderByFields=null,this.title=null,this.type="attachments"}};u([p({type:String,json:{write:!0}})],M0.prototype,"description",void 0),u([p({type:["auto","preview","list"],json:{write:!0}})],M0.prototype,"displayType",void 0),u([p({type:[IJe],json:{write:!0}})],M0.prototype,"orderByFields",void 0),u([p({type:String,json:{write:!0}})],M0.prototype,"title",void 0),u([p({type:["attachments"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],M0.prototype,"type",void 0),M0=u([A("esri.popup.content.AttachmentsContent")],M0);const S$=M0;var AW;let Zw=AW=class extends Av{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new AW({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?q(this.outFields):null})}};u([p()],Zw.prototype,"creator",void 0),u([p()],Zw.prototype,"destroyer",void 0),u([p()],Zw.prototype,"outFields",void 0),u([p({type:["custom"],readOnly:!0})],Zw.prototype,"type",void 0),Zw=AW=u([A("esri.popup.content.CustomContent")],Zw);const RJe=Zw;var MW;let mE=MW=class extends ee{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new MW({title:this.title,expression:this.expression})}};u([p({type:String,json:{write:!0}})],mE.prototype,"title",void 0),u([p({type:String,json:{write:!0}})],mE.prototype,"expression",void 0),u([p({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],mE.prototype,"returnType",void 0),mE=MW=u([A("esri.popup.ElementExpressionInfo")],mE);const PJe=mE;var OW;let EO=OW=class extends Av{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){return new OW({expressionInfo:this.expressionInfo?.clone()})}};u([p({type:PJe,json:{write:!0}})],EO.prototype,"expressionInfo",void 0),u([p({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],EO.prototype,"type",void 0),EO=OW=u([A("esri.popup.content.ExpressionContent")],EO);const YV=EO;let gE=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};u([Ue(s9e)],gE.prototype,"dateFormat",void 0),u([p({type:Boolean,json:{write:!0}})],gE.prototype,"digitSeparator",void 0),u([p({type:Ei,json:{write:!0}})],gE.prototype,"places",void 0),gE=u([A("esri.popup.support.FieldInfoFormat")],gE);const Jk=gE;var IW;let cp=IW=class extends ee{constructor(t){super(t),this.fieldName=null,this.format=void 0,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new IW({fieldName:this.fieldName,format:this.format?.clone(),isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};u([p({type:String,json:{write:!0}})],cp.prototype,"fieldName",void 0),u([p({type:Jk,json:{write:!0}})],cp.prototype,"format",void 0),u([p({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],cp.prototype,"isEditable",void 0),u([p({type:String,json:{write:!0}})],cp.prototype,"label",void 0),u([Ue(new ei({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],cp.prototype,"stringFieldOption",void 0),u([p({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],cp.prototype,"statisticType",void 0),u([p({type:String,json:{write:!0}})],cp.prototype,"tooltip",void 0),u([p({type:Boolean,json:{write:!0}})],cp.prototype,"visible",void 0),cp=IW=u([A("esri.popup.FieldInfo")],cp);const rie=cp;var RW;let Gg=RW=class extends Av{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(i=>i.toJSON())}clone(){return new RW(q({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};u([p({type:Object,json:{write:!0}})],Gg.prototype,"attributes",void 0),u([p({type:String,json:{write:!0}})],Gg.prototype,"description",void 0),u([p({type:[rie]})],Gg.prototype,"fieldInfos",void 0),u([ge("fieldInfos")],Gg.prototype,"writeFieldInfos",null),u([p({type:String,json:{write:!0}})],Gg.prototype,"title",void 0),u([p({type:["fields"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],Gg.prototype,"type",void 0),Gg=RW=u([A("esri.popup.content.FieldsContent")],Gg);const T$=Gg;let Yw=class extends ee{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};u([p({type:String,json:{write:!0}})],Yw.prototype,"altText",void 0),u([p({type:String,json:{write:!0}})],Yw.prototype,"caption",void 0),u([p({type:String,json:{write:!0}})],Yw.prototype,"title",void 0),u([p({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],Yw.prototype,"type",void 0),Yw=u([A("esri.popup.content.mixins.MediaInfo")],Yw);const sie=Yw;var PW;let Jw=PW=class extends ue{constructor(t){super(t),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new PW({color:this.color?.clone(),fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};u([p()],Jw.prototype,"color",void 0),u([p()],Jw.prototype,"fieldName",void 0),u([p()],Jw.prototype,"tooltip",void 0),u([p()],Jw.prototype,"value",void 0),Jw=PW=u([A("esri.popup.content.support.ChartMediaInfoValueSeries")],Jw);const DJe=Jw;var DW;let O0=DW=class extends ee{constructor(t){super(t),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new DW({colors:q(this.colors),fields:q(this.fields),normalizeField:this.normalizeField,series:q(this.series),tooltipField:this.tooltipField})}};u([p({type:[qe],json:{type:[[Ei]],write:!0}})],O0.prototype,"colors",void 0),u([p({type:[String],json:{write:{isRequired:!0}}})],O0.prototype,"fields",void 0),u([p({type:String,json:{write:!0}})],O0.prototype,"normalizeField",void 0),u([p({type:[DJe],json:{read:!1}})],O0.prototype,"series",void 0),u([p({type:String,json:{write:!0}})],O0.prototype,"tooltipField",void 0),O0=DW=u([A("esri.popup.content.support.ChartMediaInfoValue")],O0);const LJe=O0;let CO=class extends sie{constructor(e){super(e),this.type=null,this.value=void 0}};u([p({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],CO.prototype,"type",void 0),u([p({type:LJe,json:{write:{isRequired:!0}}})],CO.prototype,"value",void 0),CO=u([A("esri.popup.content.mixins.ChartMediaInfo")],CO);const JV=CO,XV=Mo()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var LW;let Xk=LW=class extends JV{constructor(t){super(t),this.type="bar-chart"}clone(){return new LW({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};u([p({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:{writer:XV.write,isRequired:!0}}})],Xk.prototype,"type",void 0),Xk=LW=u([A("esri.popup.content.BarChartMediaInfo")],Xk);const TCe=Xk;var NW;let Kk=NW=class extends JV{constructor(t){super(t),this.type="column-chart"}clone(){return new NW({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};u([p({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:{writer:XV.write,isRequired:!0}}})],Kk.prototype,"type",void 0),Kk=NW=u([A("esri.popup.content.ColumnChartMediaInfo")],Kk);const ECe=Kk;var FW;let $O=FW=class extends ee{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new FW({linkURL:this.linkURL,sourceURL:this.sourceURL})}};u([p({type:String,json:{write:!0}})],$O.prototype,"linkURL",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],$O.prototype,"sourceURL",void 0),$O=FW=u([A("esri.popup.content.support.ImageMediaInfoValue")],$O);const NJe=$O;var kW;let yE=kW=class extends sie{constructor(t){super(t),this.refreshInterval=0,this.type="image",this.value=void 0}clone(){return new kW({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?.clone()})}};u([p({type:Number,json:{write:!0}})],yE.prototype,"refreshInterval",void 0),u([p({type:["image"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],yE.prototype,"type",void 0),u([p({type:NJe,json:{write:{isRequired:!0}}})],yE.prototype,"value",void 0),yE=kW=u([A("esri.popup.content.ImageMediaInfo")],yE);const CCe=yE;var zW;let Qk=zW=class extends JV{constructor(t){super(t),this.type="line-chart"}clone(){return new zW({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};u([p({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:{writer:XV.write,isRequired:!0}}})],Qk.prototype,"type",void 0),Qk=zW=u([A("esri.popup.content.LineChartMediaInfo")],Qk);const $Ce=Qk;var UW;let e4=UW=class extends JV{constructor(t){super(t),this.type="pie-chart"}clone(){return new UW({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};u([p({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:{writer:XV.write,isRequired:!0}}})],e4.prototype,"type",void 0),e4=UW=u([A("esri.popup.content.PieChartMediaInfo")],e4);const ACe=e4,BW={base:sie,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":TCe,"column-chart":ECe,"line-chart":$Ce,"pie-chart":ACe,image:CCe}};var VW;let up=VW=class extends Av{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?CCe.fromJSON(e):e.type==="barchart"?TCe.fromJSON(e):e.type==="columnchart"?ECe.fromJSON(e):e.type==="linechart"?$Ce.fromJSON(e):e.type==="piechart"?ACe.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(i=>i.toJSON())}clone(){return new VW(q({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};u([p()],up.prototype,"activeMediaInfoIndex",void 0),u([p({type:Object,json:{write:!0}})],up.prototype,"attributes",void 0),u([p({type:String,json:{write:!0}})],up.prototype,"description",void 0),u([p({types:[BW]})],up.prototype,"mediaInfos",void 0),u([me("mediaInfos")],up.prototype,"readMediaInfos",null),u([ge("mediaInfos")],up.prototype,"writeMediaInfos",null),u([p({type:String,json:{write:!0}})],up.prototype,"title",void 0),u([p({type:["media"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],up.prototype,"type",void 0),up=VW=u([A("esri.popup.content.MediaContent")],up);const kP=up;var jW;let AO=jW=class extends ee{constructor(t){super(t),this.field=null,this.order=null}clone(){return new jW({field:this.field,order:this.order})}};u([p({type:String,json:{write:!0}})],AO.prototype,"field",void 0),u([p({type:["asc","desc"],json:{write:!0}})],AO.prototype,"order",void 0),AO=jW=u([A("esri.popup.support.RelatedRecordsInfoFieldOrder")],AO);const nie=AO;let Gf=class extends Dt.ClonableMixin(Av){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};u([p({type:String,json:{write:!0}})],Gf.prototype,"description",void 0),u([p({type:Number,json:{type:Ei,write:!0}})],Gf.prototype,"displayCount",void 0),u([p({type:["list"],json:{write:{isRequired:!0}}})],Gf.prototype,"displayType",void 0),u([p({type:[nie],json:{write:!0}})],Gf.prototype,"orderByFields",void 0),u([p({type:Number,json:{type:Ei,write:{isRequired:!0}}})],Gf.prototype,"relationshipId",void 0),u([p({type:String,json:{write:!0}})],Gf.prototype,"title",void 0),u([p({type:["relationship"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],Gf.prototype,"type",void 0),Gf=u([A("esri.popup.content.RelationshipContent")],Gf);const zP=Gf;var GW;let MO=GW=class extends Av{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new GW({text:this.text})}};u([p({type:String,json:{write:!0}})],MO.prototype,"text",void 0),u([p({type:["text"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],MO.prototype,"type",void 0),MO=GW=u([A("esri.popup.content.TextContent")],MO);const UP=MO;let Hg=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.title=null,this.description=null,this.type=null,this.associatedNetworkSourceId=null,this.associatedAssetGroup=null,this.associatedAssetType=null}};u([p({type:String,json:{write:!0}})],Hg.prototype,"title",void 0),u([p({type:String,json:{write:!0}})],Hg.prototype,"description",void 0),u([p({type:["attachment","connectivity","container","content","structure"],json:{write:!0}})],Hg.prototype,"type",void 0),u([p({type:Number,json:{type:Ei,write:!0}})],Hg.prototype,"associatedNetworkSourceId",void 0),u([p({type:Number,json:{type:Ei,write:!0}})],Hg.prototype,"associatedAssetGroup",void 0),u([p({type:Number,json:{type:Ei,write:!0}})],Hg.prototype,"associatedAssetType",void 0),Hg=u([A("esri.popup.support.UtilityNetworkAssociationType")],Hg);const MCe=Hg;let I0=class extends Dt.ClonableMixin(Av){constructor(e){super(e),this.description=null,this.displayCount=null,this.title=null,this.associationTypes=[],this.type="utility-network-associations"}};u([p({type:String,json:{write:!0}})],I0.prototype,"description",void 0),u([p({type:Number,json:{type:Ei,write:!0}})],I0.prototype,"displayCount",void 0),u([p({type:String,json:{write:!0}})],I0.prototype,"title",void 0),u([p({type:[MCe],json:{write:!0}})],I0.prototype,"associationTypes",void 0),u([Ue({utilityNetworkAssociations:"utility-network-associations"})],I0.prototype,"type",void 0),I0=u([A("esri.popup.content.UtilityNetworkAssociationsContent")],I0);const oie=I0,FJe={base:null,key:"type",typeMap:{attachment:S$,media:kP,text:UP,expression:YV,field:T$,relationship:zP,utilityNetworkAssociations:oie}},kJe={base:null,key:"type",typeMap:{attachment:S$,media:kP,text:UP,expression:YV,field:T$,relationship:zP}};var HW;let Xw=HW=class extends ee{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new HW({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([p({type:String,json:{write:!0}})],Xw.prototype,"name",void 0),u([p({type:String,json:{write:!0}})],Xw.prototype,"title",void 0),u([p({type:String,json:{write:!0}})],Xw.prototype,"expression",void 0),u([p({type:["string","number"],json:{write:!0}})],Xw.prototype,"returnType",void 0),Xw=HW=u([A("esri.popup.ExpressionInfo")],Xw);const zJe=Xw;var qW;let OO=qW=class extends ee{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new qW({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};u([p({type:Boolean,json:{write:!0}})],OO.prototype,"returnTopmostRaster",void 0),u([p({type:Boolean,json:{write:!0}})],OO.prototype,"showNoDataRecords",void 0),OO=qW=u([A("esri.popup.LayerOptions")],OO);const UJe=OO;var WW;let IO=WW=class extends ee{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new WW({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?q(this.orderByFields):null})}};u([p({type:Boolean,json:{write:!0}})],IO.prototype,"showRelatedRecords",void 0),u([p({type:[nie],json:{write:!0}})],IO.prototype,"orderByFields",void 0),IO=WW=u([A("esri.popup.RelatedRecordsInfo")],IO);const Cue=IO;var ZW;let Eh=ZW=class extends OS.IdentifiableMixin(ue){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new ZW({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};u([p()],Eh.prototype,"active",void 0),u([p()],Eh.prototype,"className",void 0),u([p()],Eh.prototype,"disabled",void 0),u([p()],Eh.prototype,"icon",void 0),u([p()],Eh.prototype,"id",void 0),u([p()],Eh.prototype,"indicator",void 0),u([p()],Eh.prototype,"title",void 0),u([p()],Eh.prototype,"type",void 0),u([p()],Eh.prototype,"visible",void 0),Eh=ZW=u([A("esri.support.actions.ActionBase")],Eh);const aie=Eh;var YW;let t4=YW=class extends aie{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new YW({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};u([p()],t4.prototype,"image",void 0),t4=YW=u([A("esri.support.actions.ActionButton")],t4);const BJe=t4;var JW;let RO=JW=class extends aie{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new JW({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};u([p()],RO.prototype,"image",void 0),u([p()],RO.prototype,"value",void 0),RO=JW=u([A("esri.support.actions.ActionToggle")],RO);const VJe=RO,lM="relationships/",$ue="expression/",jJe=Ee.ofType({key:"type",defaultKeyValue:"button",base:aie,typeMap:{button:BJe,toggle:VJe}}),GJe={base:Av,key:"type",typeMap:{media:kP,custom:RJe,text:UP,attachments:S$,fields:T$,expression:YV,relationship:zP,utilityNetworkAssociations:oie}},OCe=new Set(["attachments","fields","media","text","expression","relationship"]),HJe=new Set([...OCe,"utility-network-associations"]);let ao=class extends Dt.ClonableMixin(ee){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(i=>Sd(GJe,i)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||nu(e)?e:(J.getLogger(this).error("content error","unsupported content value",{value:e}),null)}readContent(e,i){const{popupElements:r}=i;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(i.description,i.mediaInfos,r):this._readPopupInfo(i)}writeWebSceneContent(e,i,r,s){this._writePopupTemplateContent(e,i,s)}writeWebMapContent(e,i,r,s){this._writePopupTemplateContent(e,i,s)}writeFieldInfos(e,i,r,s){const{content:n}=this,o=Array.isArray(n)?n:null;if(e){const a=o?o.filter(c=>c.type==="fields"):[],l=a.length&&a.every(c=>c.fieldInfos?.length);i.fieldInfos=e.filter(Boolean).map(c=>{const h=c.toJSON(s);return l&&(h.visible=!1),h})}if(o)for(const a of o)a.type==="fields"&&this._writeFieldsContent(a,i)}writeLayerOptions(e,i,r,s){i[r]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(s)}writeTitle(e,i){i.title=e||""}async collectRequiredFields(e,i){const r=this.expressionInfos||[];await this._collectExpressionInfoFields(e,i,[...r,...this._getContentExpressionInfos(this.content,r)]),iS(e,i,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const i=new Set;return await this.collectRequiredFields(i,e),[...i].sort()}_writePopupTemplateContent(e,i,r){typeof e!="string"?Array.isArray(e)&&(i.popupElements=e.filter(s=>r?.origin==="web-scene"?OCe.has(s.type):HJe.has(s.type)).map(s=>s?.toJSON(r)),i.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(i):s.type==="media"?this._writeMediaContent(s,i):s.type==="text"?this._writeTextContent(s,i):s.type==="relationship"&&this._writeRelationshipContent(s,i)})):i.description=e}_writeFieldsContent(e,i){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const r=q(e.fieldInfos);Array.isArray(i.fieldInfos)?r.forEach(s=>{const n=i.fieldInfos.find(o=>o.fieldName?.toLowerCase()===s.fieldName?.toLowerCase());n?n.visible=!0:i.fieldInfos.push(s)}):i.fieldInfos=r}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,i){const r=e.orderByFields?.map(n=>this._toFieldOrderJSON(n,e.relationshipId))||[],s=[...i.relatedRecordsInfo?.orderByFields||[],...r];i.relatedRecordsInfo={showRelatedRecords:!0,...s?.length&&{orderByFields:s}}}_writeTextContent(e,i){!i.description&&e.text&&(i.description=e.text)}_writeMediaContent(e,i){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const r=q(e.mediaInfos);Array.isArray(i.mediaInfos)?i.mediaInfos=[...i.mediaInfos,...r]:i.mediaInfos=r}_readPopupInfoElements(e,i,r){const s={description:!1,mediaInfos:!1};return r.map(n=>n.type==="media"?(n.mediaInfos||!i||s.mediaInfos||(n.mediaInfos=i,s.mediaInfos=!0),kP.fromJSON(n)):n.type==="text"?(n.text||!e||s.description||(n.text=e,s.description=!0),UP.fromJSON(n)):n.type==="attachments"?S$.fromJSON(n):n.type==="fields"?T$.fromJSON(n):n.type==="expression"?YV.fromJSON(n):n.type==="relationship"?zP.fromJSON(n):n.type==="utilityNetworkAssociations"?oie.fromJSON(n):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:i,order:r}=e;if(!i?.startsWith(lM))return null;const s=i.replace(lM,"").split("/");if(s.length!==2)return null;const n=parseInt(s[0],10),o=s[1];return!Number.isNaN(n)&&o?zP.fromJSON({relationshipId:n,orderByFields:[{field:o,order:r}]}):null}_toFieldOrderJSON(e,i){const{order:r,field:s}=e;return{field:`${lM}${i}/${s}`,order:r}}_readPopupInfo({description:e,mediaInfos:i,showAttachments:r,relatedRecordsInfo:s={showRelatedRecords:!1}}){const n=[];e?n.push(new UP({text:e})):n.push(new T$),Array.isArray(i)&&i.length&&n.push(kP.fromJSON({mediaInfos:i})),r&&n.push(S$.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=s;return o&&a?.length&&a.forEach(l=>{const c=this._toRelationshipContent(l);c&&n.push(c)}),n.length?n:e}_getContentElementFields(e){const i=e?.type;if(i==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(i==="custom")return e.outFields||[];if(i==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(i==="media"){const r=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...r.reduce((s,n)=>[...s,...this._getMediaInfoFields(n)],[])]}return i==="text"?this._extractFieldNames(e.text):i==="relationship"||i==="utility-network-associations"?[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)]:[]}_getMediaInfoFields(e){const{caption:i,title:r,value:s}=e,n=s||{},{fields:o,normalizeField:a,tooltipField:l,sourceURL:c,linkURL:h}=n,d=[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(c),...this._extractFieldNames(h),...o??[]];return a&&d.push(a),l&&d.push(l),d}_getContentExpressionInfos(e,i){return Array.isArray(e)?e.reduce((r,s)=>[...r,...s.type==="expression"&&s.expressionInfo?[s.expressionInfo]:[]],i):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((i,r)=>[...i,...this._getContentElementFields(r)],[]):[]}async _collectExpressionInfoFields(e,i,r){r&&await Promise.all(r.map(s=>Al(e,i,s.expression)))}_getFieldInfoFields(e){return e?e.filter(({fieldName:i,visible:r})=>!(r!==void 0&&!r||!i||i.startsWith(lM)||i.startsWith($ue))).map(i=>i.fieldName):[]}_getActionsFields(e){return e?e.toArray().reduce((i,r)=>[...i,...this._getActionFields(r)],[]):[]}_getActionFields(e){const{className:i,title:r,type:s}=e,n=s==="button"||s==="toggle"?e.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(n)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){return iie(e).filter(i=>!(i.indexOf(lM)===0||i.indexOf($ue)===0))}};u([p({type:jJe})],ao.prototype,"actions",void 0),u([p()],ao.prototype,"content",void 0),u([Yt("content")],ao.prototype,"castContent",null),u([me("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],ao.prototype,"readContent",null),u([ge("web-scene","content",{popupElements:{type:Ee.ofType(kJe)},showAttachments:{type:Boolean},mediaInfos:{type:Ee.ofType(BW)},description:{type:String},relatedRecordsInfo:{type:Cue}})],ao.prototype,"writeWebSceneContent",null),u([ge("content",{popupElements:{type:Ee.ofType(FJe)},showAttachments:{type:Boolean},mediaInfos:{type:Ee.ofType(BW)},description:{type:String},relatedRecordsInfo:{type:Cue}})],ao.prototype,"writeWebMapContent",null),u([p({type:[zJe],json:{write:!0}})],ao.prototype,"expressionInfos",void 0),u([p({type:[rie]})],ao.prototype,"fieldInfos",void 0),u([ge("fieldInfos")],ao.prototype,"writeFieldInfos",null),u([p({type:UJe})],ao.prototype,"layerOptions",void 0),u([ge("layerOptions")],ao.prototype,"writeLayerOptions",null),u([p({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],ao.prototype,"lastEditInfoEnabled",void 0),u([p()],ao.prototype,"outFields",void 0),u([p()],ao.prototype,"overwriteActions",void 0),u([p()],ao.prototype,"returnGeometry",void 0),u([p({json:{type:String}})],ao.prototype,"title",void 0),u([ge("title")],ao.prototype,"writeTitle",null),ao=u([A("esri.PopupTemplate")],ao);const CA=ao,Aue=new ei({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let qJe=0,vE=class extends ee{constructor(e){super(e),this.id="sym"+qJe++,this.type=null,this.color=new qe([0,0,0,1])}readColor(e){return e?.[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,i){}hash(){return JSON.stringify(this.toJSON())}clone(){}};u([p({type:Aue.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:Aue.write,isRequired:!0}}})],vE.prototype,"type",void 0),u([p({type:qe,json:{write:{allowNull:!0}}})],vE.prototype,"color",void 0),u([me("color")],vE.prototype,"readColor",null),vE=u([A("esri.symbols.Symbol")],vE);const Xa=vE;var XW;let R0=XW=class extends Xa{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){Object.assign(e,t)}async collectRequiredFields(t,e){if(this.data?.type==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const r=i.map(s=>{const n=s.valueExpressionInfo;return n?Al(t,e,n.expression):null});await Promise.all(r)}}}clone(){return new XW({data:q(this.data)})}hash(){return x1e(JSON.stringify(this.data)).toString()}};u([p({json:{write:!1}})],R0.prototype,"color",void 0),u([p({json:{write:!0}})],R0.prototype,"data",void 0),u([me("data",["symbol"])],R0.prototype,"readData",null),u([ge("data",{})],R0.prototype,"writeData",null),u([Ue({CIMSymbolReference:"cim"},{readOnly:!0})],R0.prototype,"type",void 0),R0=XW=u([A("esri.symbols.CIMSymbol")],R0);const jb=R0;let _E=class extends ee{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,i,r){e||(i[r]=e)}};u([p({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],_E.prototype,"enabled",void 0),u([ge("enabled")],_E.prototype,"writeEnabled",null),u([p({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0,json:{write:{isRequired:!0}}})],_E.prototype,"type",void 0),_E=u([A("esri.symbols.Symbol3DLayer")],_E);const cg=_E;function WJe(t,e){const i=e.transparency!=null?_$(e.transparency):1,r=e.color;return r&&Array.isArray(r)?new qe([r[0]||0,r[1]||0,r[2]||0,i]):null}function ZJe(t,e){e.color=t.toJSON().slice(0,3);const i=hD(t.a);i!==0&&(e.transparency=i)}function Mv(t){return{type:qe,nonNullable:t?.nonNullable,json:{type:[Ei],default:null,read:{source:["color","transparency"],reader:WJe},write:{target:{color:{type:[Ei],isRequired:t?.colorRequiredOnWrite},transparency:{type:Ei}},writer:ZJe}}}}const Ym={type:Number,cast:sr,json:{write:!0}};let Kw=class extends ee{constructor(e){super(e),this.color=new qe([0,0,0,1]),this.extensionLength=0,this.size=$d(1)}clone(){}cloneProperties(){return{color:q(this.color),size:this.size,extensionLength:this.extensionLength}}};u([p({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0,isRequired:!0}}})],Kw.prototype,"type",void 0),u([p(Mv({colorRequiredOnWrite:!0}))],Kw.prototype,"color",void 0),u([p({...Ym,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],Kw.prototype,"extensionLength",void 0),u([p(Ym)],Kw.prototype,"size",void 0),Kw=u([A("esri.symbols.edges.Edges3D")],Kw);const lie=Kw;var KW;let i4=KW=class extends lie{constructor(t){super(t),this.type="sketch"}clone(){return new KW(this.cloneProperties())}};u([Ue({sketch:"sketch"},{readOnly:!0})],i4.prototype,"type",void 0),i4=KW=u([A("esri.symbols.edges.SketchEdges3D")],i4);const YJe=i4;var QW;let r4=QW=class extends lie{constructor(t){super(t),this.type="solid"}clone(){return new QW(this.cloneProperties())}};u([Ue({solid:"solid"},{readOnly:!0})],r4.prototype,"type",void 0),r4=QW=u([A("esri.symbols.edges.SolidEdges3D")],r4);const ICe=r4,RCe={types:{key:"type",base:lie,typeMap:{solid:ICe,sketch:YJe}},json:{write:!0}};var eZ;let Zu=eZ=class extends ee{constructor(t){super(t),this.color=null,this.emissiveFactor=null}clone(){const t={color:this.color?.clone()??null,emissiveFactor:this.emissiveFactor?is(this.emissiveFactor):null};return new eZ(t)}};u([p(Mv())],Zu.prototype,"color",void 0),u([p({type:[Number],json:{write:!1}})],Zu.prototype,"emissiveFactor",void 0),Zu=eZ=u([A("esri.symbols.support.Symbol3DMaterial")],Zu);var tZ;let P0=tZ=class extends cg{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new tZ({edges:this.edges?.clone(),enabled:this.enabled,material:this.material?.clone(),castShadows:this.castShadows,size:this.size})}};u([Ue({Extrude:"extrude"},{readOnly:!0})],P0.prototype,"type",void 0),u([p({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],P0.prototype,"size",void 0),u([p({type:Zu,json:{write:!0}})],P0.prototype,"material",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],P0.prototype,"castShadows",void 0),u([p(RCe)],P0.prototype,"edges",void 0),P0=tZ=u([A("esri.symbols.ExtrudeSymbol3DLayer")],P0);const PCe=P0;let s4=class extends ee{constructor(e){super(e)}clone(){throw new Error("Subclasses of LinePattern3D should implement their own clone method.")}};u([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],s4.prototype,"type",void 0),s4=u([A("esri.symbols.patterns.LinePattern3D")],s4);const DCe=s4,JJe=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var iZ;const XJe=Mo()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let PO=iZ=class extends DCe{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new iZ(t)}};u([p({type:["style"],json:{write:{isRequired:!0}}})],PO.prototype,"type",void 0),u([Ue(XJe),p({type:JJe,json:{write:{isRequired:!0}}})],PO.prototype,"style",void 0),PO=iZ=u([A("esri.symbols.patterns.LineStylePattern3D")],PO);const cie=PO;let n4=class extends ee{constructor(e){super(e),this.type="style"}clone(){throw new Error("Subclasses of Pattern3D should implement their own clone method.")}};u([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],n4.prototype,"type",void 0),n4=u([A("esri.symbols.patterns.Pattern3D")],n4);const LCe=n4,KJe=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var rZ;let DO=rZ=class extends LCe{constructor(t){super(t),this.type="style",this.style="solid"}clone(){return new rZ({style:this.style})}};u([p({type:["style"],json:{write:{isRequired:!0}}})],DO.prototype,"type",void 0),u([p({type:KJe,json:{read:!0,write:{isRequired:!0}}})],DO.prototype,"style",void 0),DO=rZ=u([A("esri.symbols.patterns.StylePattern3D")],DO);const NCe=DO,QJe={types:{key:"type",base:LCe,typeMap:{style:NCe}},json:{write:!0}},FCe={types:{key:"type",base:DCe,typeMap:{style:cie}},json:{write:!0}},xR=new qe("white"),eXe=new qe([255,255,255,0]);function tXe(t){return t.r===0&&t.g===0&&t.b===0}var sZ;let SR=sZ=class extends Zu{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:this.color?.clone()??null,emissiveFactor:this.emissiveFactor?is(this.emissiveFactor):null,colorMixMode:this.colorMixMode};return new sZ(t)}};u([Ue({multiply:"multiply",replace:"replace",tint:"tint"})],SR.prototype,"colorMixMode",void 0),SR=sZ=u([A("esri.symbols.support.Symbol3DFillMaterial")],SR);function oc(t,e=!1){return t<=rh?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function iXe(t){return(j3(t)?t.byteLength/8:t.length)<=rh?Array.from(t):new Float64Array(t)}function Ix(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function ch(t=jCe){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function E$(t,e,i,r,s,n,o=ch()){return o[0]=t,o[1]=e,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function rXe(t,e=ch()){return sXe(t,0,t.length/3,e)}function sXe(t,e,i,r=ch()){return KV(r,oZ),nXe(r,t,e,i),r}function M9t(t,e=oc(24)){const[i,r,s,n,o,a]=t;return e[0]=i,e[1]=r,e[2]=s,e[3]=i,e[4]=r,e[5]=a,e[6]=i,e[7]=o,e[8]=s,e[9]=i,e[10]=o,e[11]=a,e[12]=n,e[13]=r,e[14]=s,e[15]=n,e[16]=r,e[17]=a,e[18]=n,e[19]=o,e[20]=s,e[21]=n,e[22]=o,e[23]=a,e}function O9t(t,e){const i=isFinite(t[2])||isFinite(t[5]);return new gi(i?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function kCe(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function I9t(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function BP(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function nXe(t,e,i=0,r=e.length/3){let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let h=0;h<r;h++)s=Math.min(s,e[i+3*h]),n=Math.min(n,e[i+3*h+1]),o=Math.min(o,e[i+3*h+2]),a=Math.max(a,e[i+3*h]),l=Math.max(l,e[i+3*h+1]),c=Math.max(c,e[i+3*h+2]);t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function V6(t,e,i){const r=e.length;let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];if(i)for(let h=0;h<r;h++){const d=e[h];s=Math.min(s,d[0]),n=Math.min(n,d[1]),o=Math.min(o,d[2]),a=Math.max(a,d[0]),l=Math.max(l,d[1]),c=Math.max(c,d[2])}else for(let h=0;h<r;h++){const d=e[h];s=Math.min(s,d[0]),n=Math.min(n,d[1]),a=Math.max(a,d[0]),l=Math.max(l,d[1])}t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function oXe(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function IS(t){return t[0]>=t[3]?0:t[3]-t[0]}function RS(t){return t[1]>=t[4]?0:t[4]-t[1]}function Gb(t){return t[2]>=t[5]?0:t[5]-t[2]}function aXe(t){const e=IS(t),i=Gb(t),r=RS(t);return Math.sqrt(e*e+i*i+r*r)}function uie(t,e=[0,0,0]){return e[0]=t[0]+IS(t)/2,e[1]=t[1]+RS(t)/2,e[2]=t[2]+Gb(t)/2,e}function R9t(t,e=[0,0,0]){return e[0]=IS(t),e[1]=RS(t),e[2]=Gb(t),e}function lXe(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function P9t(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function cXe(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function uXe(t,e){return e==null||cXe(t,e)}function hXe(t,e,i,r,s=t){return s[0]=t[0]+e,s[1]=t[1]+i,s[2]=t[2]+r,s[3]=t[3]+e,s[4]=t[4]+i,s[5]=t[5]+r,s}function D9t(t,e,i=t){const r=t[0]+IS(t)/2,s=t[1]+RS(t)/2,n=t[2]+Gb(t)/2;return i[0]=r+(t[0]-r)*e,i[1]=s+(t[1]-s)*e,i[2]=n+(t[2]-n)*e,i[3]=r+(t[3]-r)*e,i[4]=s+(t[4]-s)*e,i[5]=n+(t[5]-n)*e,i}function L9t(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function zCe(t,e,i=t){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i!==t&&(i[3]=t[3],i[4]=t[4],i[5]=t[5]),i}function UCe(t,e,i=t){return i[3]=e[0],i[4]=e[1],i[5]=e[2],i!==t&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),t}function KV(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function ff(t){return t?KV(t,oZ):ch(oZ)}function BCe(t,e){return e||(e=Qt()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function N9t(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function dXe(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=Number.NEGATIVE_INFINITY,t[3]=r,t[4]=s,t[5]=Number.POSITIVE_INFINITY,t}function nZ(t){return t.length===6}function VCe(t){return IS(t)===0&&RS(t)===0&&Gb(t)===0}function F9t(t,e,i){if(t==null||e==null)return t===e;if(!nZ(t)||!nZ(e))return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function pXe(t,e,i,r,s,n){return E$(t,e,i,r,s,n,fXe)}const k9t=[-1/0,-1/0,-1/0,1/0,1/0,1/0],oZ=[1/0,1/0,1/0,-1/0,-1/0,-1/0],jCe=[0,0,0,0,0,0],fXe=ch();function z9t(t,{isPrimitive:e,width:i,depth:r,height:s}){const n=e?10:1;if(i==null&&s==null&&r==null)return[n*t[0],n*t[1],n*t[2]];const o=Le(i,r,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/t[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=t[l]*a);return o}const mXe=E$(-.5,-.5,-.5,.5,.5,.5),gXe=E$(-.5,-.5,0,.5,.5,1),yXe=E$(-.5,-.5,0,.5,.5,.5);function U9t(t){switch(t){case"sphere":case"cube":case"diamond":return mXe;case"cylinder":case"cone":case"inverted-cone":return gXe;case"tetrahedron":return yXe;default:return}}const hie=["butt","square","round"],vXe=[...hie,"none"],GCe=["miter","bevel","round"];var aZ;let Qw=aZ=class extends ee{constructor(t){super(t),this.color=new qe([0,0,0,1]),this.size=$d(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size,pattern:this.pattern!=null?this.pattern.clone():null,patternCap:this.patternCap};return new aZ(t)}};u([p(Mv({colorRequiredOnWrite:!0}))],Qw.prototype,"color",void 0),u([p({...Ym,json:{write:{isRequired:!0}}})],Qw.prototype,"size",void 0),u([p(FCe)],Qw.prototype,"pattern",void 0),u([p({type:hie,json:{default:"butt",write:{overridePolicy(){return{enabled:this.pattern!=null}}}}})],Qw.prototype,"patternCap",void 0),Qw=aZ=u([A("esri.symbols.support.Symbol3DOutline")],Qw);var o4;let qg=o4=class extends cg{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:this.edges!=null?this.edges.clone():null,enabled:this.enabled,material:this.material!=null?this.material.clone():null,pattern:this.pattern!=null?this.pattern.clone():null,castShadows:this.castShadows,outline:this.outline!=null?this.outline.clone():null};return new o4(t)}static fromSimpleFillSymbol(t){const e=t.outline&&t.outline.style&&t.outline.style!=="solid"?new cie({style:t.outline.style}):null,i={size:t.outline?.width??0,color:(t.outline?.color??xR).clone(),pattern:e};return e&&t.outline?.cap&&(i.patternCap=t.outline.cap),new o4({material:new SR({color:(t.color??eXe).clone()}),pattern:t.style&&t.style!=="solid"?new NCe({style:t.style}):null,outline:i})}};u([Ue({Fill:"fill"},{readOnly:!0})],qg.prototype,"type",void 0),u([p({type:SR,json:{write:!0}})],qg.prototype,"material",void 0),u([p(QJe)],qg.prototype,"pattern",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],qg.prototype,"castShadows",void 0),u([p({type:Qw,json:{write:!0}})],qg.prototype,"outline",void 0),u([p(RCe)],qg.prototype,"edges",void 0),qg=o4=u([A("esri.symbols.FillSymbol3DLayer")],qg);const PS=qg;var lZ;const _Xe=Mo()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let e1=lZ=class extends ee{constructor(t){super(t)}readHref(t,e,i){return t?yA(t,i):e.dataURI}writeHref(t,e,i,r){t&&(wf(t)?e.dataURI=t:(e.href=K3(t,r),Ku(e.href)&&(e.href=bd(e.href))))}clone(){return new lZ({href:this.href,primitive:this.primitive})}};u([p({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],e1.prototype,"href",void 0),u([me("href")],e1.prototype,"readHref",null),u([ge("href",{href:{type:String},dataURI:{type:String}})],e1.prototype,"writeHref",null),u([Ue(_Xe)],e1.prototype,"primitive",void 0),e1=lZ=u([A("esri.symbols.support.IconSymbol3DLayerResource")],e1);const B9t="circle";var cZ;let P2=cZ=class extends ue{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new cZ({x:this.x,y:this.y})}};u([p({type:Number})],P2.prototype,"x",void 0),u([p({type:Number})],P2.prototype,"y",void 0),P2=cZ=u([A("esri.symbols.support.Symbol3DAnchorPosition2D")],P2);var uZ;let LO=uZ=class extends ee{constructor(t){super(t),this.color=new qe([0,0,0,1]),this.size=$d(1)}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size};return new uZ(t)}};u([p(Mv({colorRequiredOnWrite:!0}))],LO.prototype,"color",void 0),u([p({...Ym,json:{write:{isRequired:!0}}})],LO.prototype,"size",void 0),LO=uZ=u([A("esri.symbols.support.Symbol3DIconOutline")],LO);var bE;const HCe="esri.symbols.IconSymbol3DLayer";let hp=bE=class extends cg{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null,this.angle=0}clone(){return new bE({anchor:this.anchor,anchorPosition:q(this.anchorPosition),enabled:this.enabled,material:q(this.material),outline:q(this.outline),resource:q(this.resource),angle:this.angle,size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||xR,i=Mue(t),r=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||xR).clone()}:null;return new bE({size:t.size,angle:t.angle,resource:{primitive:wXe(t.style)},material:{color:e},outline:r,anchor:i?"relative":void 0,anchorPosition:i})}static fromPictureMarkerSymbol(t){const e=!t.color||tXe(t.color)?xR:t.color,i=Mue(t);return new bE({size:t.width<=t.height?t.height:t.width,angle:t.angle,resource:{href:t.url},material:{color:e.clone()},anchor:i?"relative":void 0,anchorPosition:i})}static fromCIMSymbol(t){return new bE({resource:{href:Fxe({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};u([p({type:Zu,json:{write:!0}})],hp.prototype,"material",void 0),u([p({type:e1,json:{write:!0}})],hp.prototype,"resource",void 0),u([Ue({Icon:"icon"},{readOnly:!0})],hp.prototype,"type",void 0),u([p({...Ym,json:{write:{isRequired:!0}}})],hp.prototype,"size",void 0),u([Ue({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"},{default:"center"})],hp.prototype,"anchor",void 0),u([p({type:P2,json:{type:[Number],read:{reader:t=>new P2({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],hp.prototype,"anchorPosition",void 0),u([p({type:LO,json:{write:!0}})],hp.prototype,"outline",void 0),u([p({type:Number,json:{write:!0,default:0}})],hp.prototype,"angle",void 0),hp=bE=u([A(HCe)],hp);const G_=hp;function Mue(t){const e="width"in t?t.width:t.size,i="height"in t?t.height:t.size,r=Oue(t.xoffset),s=Oue(t.yoffset);return(r||s)&&e&&i?{x:-r/e,y:s/i}:null}function Oue(t){return isFinite(t)?t:0}const bXe={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function wXe(t){return bXe[t]||(J.getLogger(HCe).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const xXe=["begin","end","begin-end"],qCe=["arrow","circle","square","diamond","cross","x"];let t1=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return e!=null&&e.placement===this.placement&&e.style===this.style&&(this.color==null&&e.color==null||this.color!=null&&e.color!=null&&this.color.toJSON()===e.color.toJSON())}};u([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0,isRequired:!0}}})],t1.prototype,"type",void 0),u([p({type:xXe,json:{default:"begin-end",write:!0}})],t1.prototype,"placement",void 0),u([p({type:qCe,json:{default:"arrow",write:!0}})],t1.prototype,"style",void 0),u([p({type:qe,json:{type:[Ei],default:null,write:!0}})],t1.prototype,"color",void 0),t1=u([A("esri.symbols.LineStyleMarker3D")],t1);const hZ=t1;var a4;let Hf=a4=class extends cg{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=$d(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:this.material!=null?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:this.pattern!=null?this.pattern.clone():null,marker:this.marker!=null?this.marker.clone():null};return new a4(t)}static fromSimpleLineSymbol(t){const e={enabled:!0,size:t.width??$d(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style?new cie({style:t.style}):null,material:new Zu({color:(t.color||xR).clone()}),marker:t.marker?new hZ({placement:t.marker.placement,style:t.marker.style,color:t.marker.color?.clone()??null}):null};return new a4(e)}};u([p({type:Zu,json:{write:!0}})],Hf.prototype,"material",void 0),u([Ue({Line:"line"},{readOnly:!0})],Hf.prototype,"type",void 0),u([p({type:GCe,json:{write:!0,default:"miter"}})],Hf.prototype,"join",void 0),u([p({type:hie,json:{write:!0,default:"butt"}})],Hf.prototype,"cap",void 0),u([p({...Ym,json:{write:{isRequired:!0}}})],Hf.prototype,"size",void 0),u([p(FCe)],Hf.prototype,"pattern",void 0),u([p({types:{key:"type",base:hZ,typeMap:{style:hZ}},json:{write:!0}})],Hf.prototype,"marker",void 0),Hf=a4=u([A("esri.symbols.LineSymbol3DLayer")],Hf);const $A=Hf;var dZ;const SXe=Mo()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let NO=dZ=class extends ee{clone(){return new dZ({href:this.href,primitive:this.primitive})}};u([p({type:String,json:{read:Yee,write:Wx}})],NO.prototype,"href",void 0),u([Ue(SXe)],NO.prototype,"primitive",void 0),NO=dZ=u([A("esri.symbols.support.ObjectSymbol3DLayerResource")],NO);const TXe="sphere";var pZ;let J1=pZ=class extends ue{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new pZ({x:this.x,y:this.y,z:this.z})}};u([p({type:Number})],J1.prototype,"x",void 0),u([p({type:Number})],J1.prototype,"y",void 0),u([p({type:Number})],J1.prototype,"z",void 0),J1=pZ=u([A("esri.symbols.support.Symbol3DAnchorPosition3D")],J1);var fZ;let ol=fZ=class extends cg{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new fZ({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition?.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:this.material?.clone()??null,castShadows:this.castShadows,resource:this.resource?.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};u([p({type:Zu,json:{write:!0}})],ol.prototype,"material",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],ol.prototype,"castShadows",void 0),u([p({type:NO,json:{write:!0}})],ol.prototype,"resource",void 0),u([Ue({Object:"object"},{readOnly:!0})],ol.prototype,"type",void 0),u([p({type:Number,json:{write:!0}})],ol.prototype,"width",void 0),u([p({type:Number,json:{write:!0}})],ol.prototype,"height",void 0),u([p({type:Number,json:{write:!0}})],ol.prototype,"depth",void 0),u([Ue({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"},{default:"origin"})],ol.prototype,"anchor",void 0),u([p({type:J1,json:{type:[Number],read:{reader:t=>new J1({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],ol.prototype,"anchorPosition",void 0),u([p({type:Number,json:{write:!0}})],ol.prototype,"heading",void 0),u([p({type:Number,json:{write:!0}})],ol.prototype,"tilt",void 0),u([p({type:Number,json:{write:!0}})],ol.prototype,"roll",void 0),u([p({readOnly:!0})],ol.prototype,"isPrimitive",null),ol=fZ=u([A("esri.symbols.ObjectSymbol3DLayer")],ol);const die=ol;var mZ;let kl=mZ=class extends cg{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new mZ({enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};u([p({type:Zu,json:{write:!0}})],kl.prototype,"material",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],kl.prototype,"castShadows",void 0),u([Ue({Path:"path"},{readOnly:!0})],kl.prototype,"type",void 0),u([p({type:["circle","quad"],json:{write:!0,default:"circle"}})],kl.prototype,"profile",void 0),u([p({type:GCe,json:{write:!0,default:"miter"}})],kl.prototype,"join",void 0),u([p({type:vXe,json:{write:!0,default:"butt"}})],kl.prototype,"cap",void 0),u([p({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],kl.prototype,"width",void 0),u([me("width",["width","size","height"])],kl.prototype,"readWidth",null),u([p({type:Number,json:{write:!0}})],kl.prototype,"height",void 0),u([me("height",["height","size","width"])],kl.prototype,"readHeight",null),u([p({type:["center","bottom","top"],json:{write:!0,default:"center"}})],kl.prototype,"anchor",void 0),u([p({type:["heading","all"],json:{write:!0,default:"all"}})],kl.prototype,"profileRotation",void 0),kl=mZ=u([A("esri.symbols.PathSymbol3DLayer")],kl);const pie=kl,EXe=["none","underline","line-through"],CXe=["normal","italic","oblique"],$Xe=["normal","lighter","bold","bolder"],WCe={type:Number,cast:t=>{const e=ec(t);return e===0?1:ce(e,.1,4)},nonNullable:!0},AXe=["left","right","center"],MXe=["baseline","top","middle","bottom"],ZCe={type:AXe,nonNullable:!0},YCe={type:MXe,nonNullable:!0},j9t=8;var gZ;let Wg=gZ=class extends ee{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return sr(t)}clone(){return new gZ({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};u([p({type:EXe,json:{default:"none",write:!0}})],Wg.prototype,"decoration",void 0),u([p({type:String,json:{write:!0}})],Wg.prototype,"family",void 0),u([p({type:Number,json:{write:{overridePolicy:(t,e,i)=>({enabled:!i||!i.textSymbol3D})}}})],Wg.prototype,"size",void 0),u([Yt("size")],Wg.prototype,"castSize",null),u([p({type:CXe,json:{default:"normal",write:!0}})],Wg.prototype,"style",void 0),u([p({type:$Xe,json:{default:"normal",write:!0}})],Wg.prototype,"weight",void 0),Wg=gZ=u([A("esri.symbols.Font")],Wg);const QV=Wg;var yZ;let D2=yZ=class extends ee{constructor(){super(...arguments),this.color=new qe([0,0,0,1]),this.size=0}clone(){const t={color:q(this.color),size:this.size};return new yZ(t)}};u([p(Mv())],D2.prototype,"color",void 0),u([p(Ym)],D2.prototype,"size",void 0),D2=yZ=u([A("esri.symbols.support.Symbol3DHalo")],D2);let TR=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.color=null}};u([p(Mv())],TR.prototype,"color",void 0),TR=u([A("esri.symbols.support.Symbol3DTextBackground")],TR);var l4;let xc=l4=class extends cg{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){t!=null&&this._userSize!=null&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,i,r){const s={...r,textSymbol3D:!0};e.font=t.write({},s),delete e.font.size}get size(){return this._userSize!=null?this._userSize:this.font?.size!=null?this.font.size:9}set size(t){this._userSize=t,this.font!=null&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new l4({enabled:this.enabled,font:this.font&&q(this.font),halo:this.halo&&q(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:this.material!=null?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:q(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new l4({font:t.font!=null?t.font.clone():new QV,halo:OXe(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new Zu({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new TR({color:t.backgroundColor.clone()}):null})}};function OXe(t,e){return t&&e!=null&&e>0?new D2({color:q(t),size:e}):null}u([p({type:QV,json:{write:!0}})],xc.prototype,"font",null),u([ge("font")],xc.prototype,"writeFont",null),u([p({type:D2,json:{write:!0}})],xc.prototype,"halo",void 0),u([p({...ZCe,json:{default:"center",write:!0}})],xc.prototype,"horizontalAlignment",void 0),u([p({...WCe,json:{default:1,write:!0}})],xc.prototype,"lineHeight",void 0),u([p({type:Zu,json:{write:!0}})],xc.prototype,"material",void 0),u([p({type:TR,json:{write:!0}})],xc.prototype,"background",void 0),u([p(Ym)],xc.prototype,"size",null),u([p({type:String,json:{write:!0}})],xc.prototype,"text",void 0),u([Ue({Text:"text"},{readOnly:!0})],xc.prototype,"type",void 0),u([p({...YCe,json:{default:"baseline",write:!0}})],xc.prototype,"verticalAlignment",void 0),xc=l4=u([A("esri.symbols.TextSymbol3DLayer")],xc);const DS=xc;var vZ;let D0=vZ=class extends cg{constructor(t){super(t),this.color=_Z.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new vZ({color:q(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};u([p({type:qe,nonNullable:!0,json:{type:[Ei],write:(t,e,i)=>e[i]=t.toArray(qe.AlphaMode.UNLESS_OPAQUE),default:()=>_Z.clone(),defaultEquals:t=>t.toCss(!0)===_Z.toCss(!0)}})],D0.prototype,"color",void 0),u([Ue({Water:"water"},{readOnly:!0})],D0.prototype,"type",void 0),u([p({type:["small","medium","large"],json:{write:!0,default:"medium"}})],D0.prototype,"waterbodySize",void 0),u([p({type:Number,json:{write:!0,default:null}})],D0.prototype,"waveDirection",void 0),u([p({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],D0.prototype,"waveStrength",void 0),D0=vZ=u([A("esri.symbols.WaterSymbol3DLayer")],D0);const JCe=D0,_Z=new qe([0,119,190]);var bZ;let i1=bZ=class extends ue{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new bZ({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};u([p({type:String})],i1.prototype,"name",void 0),u([p({type:String})],i1.prototype,"styleUrl",void 0),u([p({type:String})],i1.prototype,"styleName",void 0),u([p({type:fn})],i1.prototype,"portal",void 0),i1=bZ=u([A("esri.symbols.support.StyleOrigin")],i1);const wZ=i1;var xZ;let ER=xZ=class extends ue{constructor(){super(...arguments),this.url=""}clone(){return new xZ({url:this.url})}};u([p({type:String})],ER.prototype,"url",void 0),ER=xZ=u([A("esri.symbols.support.Thumbnail")],ER);const XCe={icon:G_,object:die,line:$A,path:pie,fill:PS,extrude:PCe,text:DS,water:JCe},IXe=Ee.ofType({base:cg,key:"type",typeMap:XCe,errorContext:"symbol-layer"});let qf=class extends Xa{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const i=this.__accessor__&&this.__accessor__.metadata&&this.__accessor__.metadata.symbolLayers,r=i?.type,s=r||Ee;this._set("symbolLayers",new s)}get color(){return null}set color(e){this.constructed&&J.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){df(e,this._get("symbolLayers"))}readStyleOrigin(e,i,r){if(e.styleUrl&&e.name){const s=yA(e.styleUrl,r);return new wZ({styleUrl:s,name:e.name})}if(e.styleName&&e.name)return new wZ({portal:r?.portal||fn.getDefault(),styleName:e.styleName,name:e.name});r?.messages&&r.messages.push(new sh("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:r,definition:e}))}writeStyleOrigin(e,i,r,s){if(e.styleUrl&&e.name){let n=K3(e.styleUrl,s);Ku(n)&&(n=bd(n)),i.styleOrigin={styleUrl:n,name:e.name}}else e.styleName&&e.name&&(e.portal&&s?.portal&&!Lxe(e.portal.restUrl,s.portal.restUrl)?s?.messages&&s.messages.push(new sh("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):i.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof cg||e&&XCe[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};u([p({json:{read:!1,write:!1}})],qf.prototype,"color",null),u([p({type:IXe,nonNullable:!0,json:{write:!0}}),Yt(Vte)],qf.prototype,"symbolLayers",null),u([p({type:wZ})],qf.prototype,"styleOrigin",void 0),u([me("styleOrigin")],qf.prototype,"readStyleOrigin",null),u([ge("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],qf.prototype,"writeStyleOrigin",null),u([p({type:ER,json:{read:!1}})],qf.prototype,"thumbnail",void 0),u([p({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],qf.prototype,"type",void 0),qf=u([A("esri.symbols.Symbol3D")],qf);const fD=qf;let FO=class extends ee{constructor(e){super(e),this.visible=!0}clone(){throw new Error("Subclasses of Callout3D should implement their own clone method.")}};u([p({type:["line"],constructOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,isRequired:!0}}})],FO.prototype,"type",void 0),u([p({readOnly:!0})],FO.prototype,"visible",void 0),FO=u([A("esri.symbols.callouts.Callout3D")],FO);const KCe=FO;var SZ;let c4=SZ=class extends ee{constructor(t){super(t),this.color=new qe("white")}clone(){return new SZ({color:q(this.color)})}};u([p(Mv({colorRequiredOnWrite:!0}))],c4.prototype,"color",void 0),c4=SZ=u([A("esri.symbols.callouts.LineCallout3DBorder")],c4);const RXe=c4;var TZ;let L0=TZ=class extends KCe{constructor(t){super(t),this.type="line",this.color=new qe([0,0,0,1]),this.size=$d(1),this.border=null}get visible(){return this.size>0&&this.color!=null&&this.color.a>0}clone(){return new TZ({color:q(this.color),size:this.size,border:q(this.border)})}};u([Ue({line:"line"})],L0.prototype,"type",void 0),u([p(Mv({colorRequiredOnWrite:!0}))],L0.prototype,"color",void 0),u([p({...Ym,json:{write:{isRequired:!0}}})],L0.prototype,"size",void 0),u([p({type:RXe,json:{write:!0}})],L0.prototype,"border",void 0),u([p({readOnly:!0})],L0.prototype,"visible",null),L0=TZ=u([A("esri.symbols.callouts.LineCallout3D")],L0);const QCe=L0;function fie(t){if(!t)return!1;const e=t.verticalOffset;return!(!e||e.screenLength<=0||e.maxWorldLength!=null&&e.maxWorldLength<=0)}function e$e(t){return!t||!t.supportsCallout||!t.supportsCallout()?!1:!!t.callout?.visible&&!!fie(t)}function t$e(t){return t.type==="point-3d"||t.type==="label-3d"}function PXe(t){return t.horizontalAlignment==="center"}const i$e={types:{key:"type",base:KCe,typeMap:{line:QCe}},json:{write:!0}};var EZ;let wE=EZ=class extends ee{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new EZ({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};u([p({...Ym,json:{write:{isRequired:!0}}})],wE.prototype,"screenLength",void 0),u([p({type:Number,nonNullable:!0,json:{write:!0,default:0}})],wE.prototype,"minWorldLength",void 0),u([p({type:Number,json:{write:!0}})],wE.prototype,"maxWorldLength",void 0),wE=EZ=u([A("esri.symbols.support.Symbol3DVerticalOffset")],wE);const mie=wE;var u4;const r$e=Ee.ofType({base:null,key:"type",typeMap:{text:DS}});let N0=u4=class extends fD{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new r$e,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return e$e(this)}hasVisibleVerticalOffset(){return fie(this)}clone(){return new u4({styleOrigin:q(this.styleOrigin),symbolLayers:q(this.symbolLayers),thumbnail:q(this.thumbnail),callout:q(this.callout),verticalOffset:q(this.verticalOffset)})}static fromTextSymbol(t){return new u4({symbolLayers:new Ee([DS.fromTextSymbol(t)])})}};u([p({type:mie,json:{write:!0}})],N0.prototype,"verticalOffset",void 0),u([p(i$e)],N0.prototype,"callout",void 0),u([p({json:{read:!1,write:!1}})],N0.prototype,"styleOrigin",void 0),u([p({type:r$e})],N0.prototype,"symbolLayers",void 0),u([Ue({LabelSymbol3D:"label-3d"},{readOnly:!0})],N0.prototype,"type",void 0),N0=u4=u([A("esri.symbols.LabelSymbol3D")],N0);const ej=N0;var h4;const s$e=Ee.ofType({base:null,key:"type",typeMap:{line:$A,path:pie}}),DXe=Ee.ofType({base:null,key:"type",typeMap:{line:$A,path:pie}});let kO=h4=class extends fD{constructor(t){super(t),this.symbolLayers=new s$e,this.type="line-3d"}clone(){return new h4({styleOrigin:q(this.styleOrigin),symbolLayers:q(this.symbolLayers),thumbnail:q(this.thumbnail)})}static fromSimpleLineSymbol(t){return new h4({symbolLayers:new Ee([$A.fromSimpleLineSymbol(t)])})}};u([p({type:s$e,json:{type:DXe}})],kO.prototype,"symbolLayers",void 0),u([Ue({LineSymbol3D:"line-3d"},{readOnly:!0})],kO.prototype,"type",void 0),kO=h4=u([A("esri.symbols.LineSymbol3D")],kO);const LS=kO;var d4;const n$e=Ee.ofType({base:null,key:"type",typeMap:{fill:PS}});let zO=d4=class extends fD{constructor(t){super(t),this.symbolLayers=new n$e,this.type="mesh-3d"}clone(){return new d4({styleOrigin:q(this.styleOrigin),symbolLayers:q(this.symbolLayers),thumbnail:q(this.thumbnail)})}static fromSimpleFillSymbol(t){return new d4({symbolLayers:new Ee([PS.fromSimpleFillSymbol(t)])})}};u([p({type:n$e})],zO.prototype,"symbolLayers",void 0),u([Ue({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],zO.prototype,"type",void 0),zO=d4=u([A("esri.symbols.MeshSymbol3D")],zO);const mD=zO;let UO=class extends Xa{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};u([Ue({esriSLS:"simple-line"},{readOnly:!0})],UO.prototype,"type",void 0),u([p({type:Number,cast:sr,json:{write:!0}})],UO.prototype,"width",void 0),UO=u([A("esri.symbols.LineSymbol")],UO);const LXe=UO;var CZ;let Wf=CZ=class extends ee{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,i,r){e[i]=r?.origin==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return t?.[0]!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,i,r){r?.origin==="web-map"||(e[i]=t)}clone(){return new CZ({color:q(this.color),placement:this.placement,style:this.style})}hash(){return`${this.placement}.${this.color?.hash()}.${this.style}`}};u([p({type:["begin","end","begin-end"],json:{write:!0}})],Wf.prototype,"placement",void 0),u([Ue({"line-marker":"line-marker"},{readOnly:!0}),p({json:{origins:{"web-map":{write:!1}}}})],Wf.prototype,"type",void 0),u([p({type:qCe})],Wf.prototype,"style",void 0),u([ge("style")],Wf.prototype,"writeStyle",null),u([p({type:qe,value:null,json:{write:{allowNull:!0}}})],Wf.prototype,"color",null),u([me("color")],Wf.prototype,"readColor",null),u([ge("color")],Wf.prototype,"writeColor",null),Wf=CZ=u([A("esri.symbols.LineSymbolMarker")],Wf);const NXe=Wf;var $Z;const j6=new ei({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let Zg=$Z=class extends LXe{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,i,r,s,n){if(t&&typeof t!="string")return t;const o={};return t!=null&&(o.style=t),e!=null&&(o.color=e),i!=null&&(o.width=sr(i)),r!=null&&(o.cap=r),s!=null&&(o.join=s),n!=null&&(o.miterLimit=sr(n)),o}clone(){return new $Z({color:q(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:this.marker?.clone()})}hash(){return`${super.hash()}.${this.color?.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${this.marker?.hash()}`}};u([Ue({esriSLS:"simple-line"},{readOnly:!0})],Zg.prototype,"type",void 0),u([p({type:j6.apiValues,json:{read:j6.read,write:j6.write}})],Zg.prototype,"style",void 0),u([p({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&i?.origin==null})}}})],Zg.prototype,"cap",void 0),u([p({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&i?.origin==null})}}})],Zg.prototype,"join",void 0),u([p({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":NXe}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],Zg.prototype,"marker",void 0),u([p({type:Number,json:{read:!1,write:!1}})],Zg.prototype,"miterLimit",void 0),Zg=$Z=u([A("esri.symbols.SimpleLineSymbol")],Zg);const uh=Zg;let BO=class extends Xa{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline?.hash()}`}};u([p({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":uh}},json:{default:null,write:!0}})],BO.prototype,"outline",void 0),u([p({type:["simple-fill","picture-fill"],readOnly:!0})],BO.prototype,"type",void 0),BO=u([A("esri.symbols.FillSymbol")],BO);const o$e=BO;function FXe(t,e,i){return e.imageData?Fxe({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):a$e(e.url,i)}function a$e(t,e){if(!Ku(t)){const i=zXe(e);if(i)return Ed(i,"images",t)}return yA(t,e)}function kXe(t,e,i,r){if(wf(t)){const s=qx(t);if(!s)return;e.contentType=s.mediaType,e.imageData=s.data,i&&i.imageData===e.imageData&&i.url&&Wx(i.url,e,"url",r)}else Wx(t,e,"url",r)}const l$e={json:{read:{source:["imageData","url"],reader:FXe},write:{writer(t,e,i,r){kXe(t,e,this.source,r)}}}},c$e={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,i){const r={};return e.imageData&&(r.imageData=e.imageData),e.contentType&&(r.contentType=e.contentType),e.url&&(r.url=a$e(e.url,i)),r}}}};function zXe(t){if(!t)return null;const{origin:e,layer:i}=t;if(e!=="service"&&e!=="portal-item")return null;const r=i?.type;return r==="feature"||r==="stream"?i.parsedUrl?.path:r==="map-image"||r==="tile"?t.url?.path:null}var AZ;let Ch=AZ=class extends o$e{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const s={};return t&&(s.url=t),e&&(s.outline=e),i!=null&&(s.width=sr(i)),r!=null&&(s.height=sr(r)),s}clone(){const t=new AZ({color:q(this.color),height:this.height,outline:q(this.outline),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",q(this.source)),t}hash(){return`${super.hash()}.${this.color?.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};u([Ue({esriPFS:"picture-fill"},{readOnly:!0})],Ch.prototype,"type",void 0),u([p(l$e)],Ch.prototype,"url",void 0),u([p({type:Number,json:{write:!0}})],Ch.prototype,"xscale",void 0),u([p({type:Number,json:{write:!0}})],Ch.prototype,"yscale",void 0),u([p({type:Number,cast:sr,json:{write:!0}})],Ch.prototype,"width",void 0),u([p({type:Number,cast:sr,json:{write:!0}})],Ch.prototype,"height",void 0),u([p({type:Number,cast:sr,json:{write:!0}})],Ch.prototype,"xoffset",void 0),u([p({type:Number,cast:sr,json:{write:!0}})],Ch.prototype,"yoffset",void 0),u([p(c$e)],Ch.prototype,"source",void 0),Ch=AZ=u([A("esri.symbols.PictureFillSymbol")],Ch);const gie=Ch;let F0=class extends Xa{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};u([p({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],F0.prototype,"angle",void 0),u([p({type:["simple-marker","picture-marker"],readOnly:!0})],F0.prototype,"type",void 0),u([p({type:Number,cast:sr,json:{write:!0}})],F0.prototype,"xoffset",void 0),u([p({type:Number,cast:sr,json:{write:!0}})],F0.prototype,"yoffset",void 0),u([p({cast:t=>t==="auto"?t:ec(sr(t)),json:{write:!0}})],F0.prototype,"size",void 0),F0=u([A("esri.symbols.MarkerSymbol")],F0);const u$e=F0;var MZ;let dp=MZ=class extends u$e{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const r={};return t&&(r.url=t),e!=null&&(r.width=sr(e)),i!=null&&(r.height=sr(i)),r}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new MZ({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",q(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};u([p({json:{write:!1}})],dp.prototype,"color",void 0),u([Ue({esriPMS:"picture-marker"},{readOnly:!0})],dp.prototype,"type",void 0),u([p(l$e)],dp.prototype,"url",void 0),u([p(c$e)],dp.prototype,"source",void 0),u([p({type:Number,cast:sr,json:{write:!0}})],dp.prototype,"height",void 0),u([me("height",["height","size"])],dp.prototype,"readHeight",null),u([p({type:Number,cast:sr,json:{write:!0}})],dp.prototype,"width",void 0),u([p({json:{write:!1}})],dp.prototype,"size",void 0),dp=MZ=u([A("esri.symbols.PictureMarkerSymbol")],dp);const gD=dp;var r1;const h$e=Ee.ofType({base:null,key:"type",typeMap:{icon:G_,object:die,text:DS}});let s1=r1=class extends fD{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new h$e,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return e$e(this)}hasVisibleVerticalOffset(){return fie(this)}clone(){return new r1({verticalOffset:q(this.verticalOffset),callout:q(this.callout),styleOrigin:q(this.styleOrigin),symbolLayers:q(this.symbolLayers),thumbnail:q(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new r1({symbolLayers:new Ee([G_.fromSimpleMarkerSymbol(t)])})}static fromPictureMarkerSymbol(t){return new r1({symbolLayers:new Ee([G_.fromPictureMarkerSymbol(t)])})}static fromCIMSymbol(t){if(t.data?.symbol?.type!=="CIMPointSymbol")return null;const i=t.data.symbol;return new r1(i?.callout?{symbolLayers:new Ee([G_.fromCIMSymbol(t)]),callout:new QCe({size:.5,color:new qe([0,0,0])}),verticalOffset:new mie({screenLength:40})}:{symbolLayers:new Ee([G_.fromCIMSymbol(t)])})}static fromTextSymbol(t){return new r1({symbolLayers:new Ee([DS.fromTextSymbol(t)])})}};u([p({type:mie,json:{write:!0}})],s1.prototype,"verticalOffset",void 0),u([p(i$e)],s1.prototype,"callout",void 0),u([p({type:h$e,json:{origins:{"web-scene":{write:!0}}}})],s1.prototype,"symbolLayers",void 0),u([Ue({PointSymbol3D:"point-3d"},{readOnly:!0})],s1.prototype,"type",void 0),s1=r1=u([A("esri.symbols.PointSymbol3D")],s1);const Sm=s1;var VO;const d$e=Ee.ofType({base:null,key:"type",typeMap:{extrude:PCe,fill:PS,icon:G_,line:$A,object:die,text:DS,water:JCe}});let jO=VO=class extends fD{constructor(t){super(t),this.symbolLayers=new d$e,this.type="polygon-3d"}initialize(){const t=e=>{e.type==="line"&&QC(J.getLogger(this),"LineSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use FillSymbol3DLayer.outline instead.",version:"4.28"}),e.type==="text"&&QC(J.getLogger(this),"TextSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use Labels instead.",version:"4.28"})};for(const e of this.symbolLayers)t(e);this.addHandles(io(()=>this.symbolLayers,"after-add",({item:e})=>t(e),Gt))}clone(){return new VO({styleOrigin:q(this.styleOrigin),symbolLayers:q(this.symbolLayers),thumbnail:q(this.thumbnail)})}static fromJSON(t){const e=new VO;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.at(0).type==="fill"&&e.symbolLayers.at(1).type==="line"){const i=e.symbolLayers.at(0),r=e.symbolLayers.at(1);!r.enabled||t.symbolLayers?.[1]&&t.symbolLayers[1].enable===!1||(i.outline={size:r.size,color:r.material!=null?r.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new VO({symbolLayers:new Ee([PS.fromSimpleFillSymbol(t)])})}};u([p({type:d$e,json:{write:!0}})],jO.prototype,"symbolLayers",void 0),u([Ue({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],jO.prototype,"type",void 0),jO=VO=u([A("esri.symbols.PolygonSymbol3D")],jO);const Hb=jO;var OZ;const G6=new ei({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let n1=OZ=class extends o$e{constructor(...t){super(...t),this.color=new qe([0,0,0,.25]),this.outline=new uh,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.style=t),e&&(r.outline=e),i&&(r.color=i),r}clone(){return new OZ({color:q(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};u([p()],n1.prototype,"color",void 0),u([p()],n1.prototype,"outline",void 0),u([Ue({esriSFS:"simple-fill"},{readOnly:!0})],n1.prototype,"type",void 0),u([p({type:G6.apiValues,json:{read:G6.read,write:G6.write}})],n1.prototype,"style",void 0),n1=OZ=u([A("esri.symbols.SimpleFillSymbol")],n1);const NS=n1;var IZ;const H6=new ei({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let Zf=IZ=class extends u$e{constructor(...t){super(...t),this.color=new qe([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new uh}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string")return t;const s={};return t&&(s.style=t),e!=null&&(s.size=sr(e)),i&&(s.outline=i),r&&(s.color=r),s}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new IZ({angle:this.angle,color:q(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${this.outline?.hash()}`}};u([p()],Zf.prototype,"color",void 0),u([ge("color")],Zf.prototype,"writeColor",null),u([Ue({esriSMS:"simple-marker"},{readOnly:!0})],Zf.prototype,"type",void 0),u([p()],Zf.prototype,"size",void 0),u([p({type:H6.apiValues,json:{read:H6.read,write:H6.write}})],Zf.prototype,"style",void 0),u([p({type:String,json:{write:!0}})],Zf.prototype,"path",null),u([p({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":uh}},json:{default:null,write:!0}})],Zf.prototype,"outline",void 0),Zf=IZ=u([A("esri.symbols.SimpleMarkerSymbol")],Zf);const ug=Zf;var RZ;let Ns=RZ=class extends Xa{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new QV,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.text=t),e&&(r.font=e),i&&(r.color=i),r}writeLineWidth(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}castLineWidth(t){return sr(t)}writeLineHeight(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}clone(){return new RZ({angle:this.angle,backgroundColor:q(this.backgroundColor),borderLineColor:q(this.borderLineColor),borderLineSize:this.borderLineSize,color:q(this.color),font:this.font&&this.font.clone(),haloColor:q(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor?.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color?.hash()}.${this.font&&this.font.hash()}.${this.haloColor?.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};u([p({type:qe,json:{write:!0}})],Ns.prototype,"backgroundColor",void 0),u([p({type:qe,json:{write:!0}})],Ns.prototype,"borderLineColor",void 0),u([p({type:Number,json:{write:!0},cast:sr})],Ns.prototype,"borderLineSize",void 0),u([p({type:QV,json:{write:!0}})],Ns.prototype,"font",void 0),u([p({...ZCe,json:{write:!0}})],Ns.prototype,"horizontalAlignment",void 0),u([p({type:Boolean,json:{write:!0}})],Ns.prototype,"kerning",void 0),u([p({type:qe,json:{write:!0}})],Ns.prototype,"haloColor",void 0),u([p({type:Number,cast:sr,json:{write:!0}})],Ns.prototype,"haloSize",void 0),u([p({type:Boolean,json:{write:!0}})],Ns.prototype,"rightToLeft",void 0),u([p({type:Boolean,json:{write:!0}})],Ns.prototype,"rotated",void 0),u([p({type:String,json:{write:!0}})],Ns.prototype,"text",void 0),u([Ue({esriTS:"text"},{readOnly:!0})],Ns.prototype,"type",void 0),u([p({...YCe,json:{write:!0}})],Ns.prototype,"verticalAlignment",void 0),u([p({type:Number,cast:sr,json:{write:!0}})],Ns.prototype,"xoffset",void 0),u([p({type:Number,cast:sr,json:{write:!0}})],Ns.prototype,"yoffset",void 0),u([p({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],Ns.prototype,"angle",void 0),u([p({type:Number,json:{write:!0}})],Ns.prototype,"width",void 0),u([p({type:Number})],Ns.prototype,"lineWidth",void 0),u([ge("lineWidth")],Ns.prototype,"writeLineWidth",null),u([Yt("lineWidth")],Ns.prototype,"castLineWidth",null),u([p(WCe)],Ns.prototype,"lineHeight",void 0),u([ge("lineHeight")],Ns.prototype,"writeLineHeight",null),Ns=RZ=u([A("esri.symbols.TextSymbol")],Ns);const AA=Ns;var PZ;let pp=PZ=class extends Xa{constructor(t){super(t),this.color=null,this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=this.portal!=null?this.portal:fn.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e?.portal,super.read(t,e)}clone(){return new PZ({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){const e=t&&"acceptedFormats"in t?t.acceptedFormats:["web"];return this._fetchSymbol({...t,acceptedFormats:e})}async fetchCIMSymbol(t){const e=await this.fetchSymbol({...t,acceptedFormats:["cim"]});if(e?.type!=="cim")throw new U("webstylesymbol:fetchCIMSymbol","Resolved web style symbol is not of type 'cim'");return e}async _fetchSymbol(t){const e=t!=null?t.cache:null,i=e?this._fetchCacheKey:null;if(e!=null){const o=i&&e.get(i);if(o)return o.clone()}const{resolveWebStyleSymbol:r}=await V(()=>import("./webStyleSymbolUtils-DI4Hu7Mk.js"),__vite__mapDeps([107,108]));gt(t);const s=r(this,{portal:this.portal},t);s.catch(o=>{J.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",o)});const n=await s;return e?.set(i,n.clone()),n}};u([p({json:{write:!1}})],pp.prototype,"color",void 0),u([p({type:String,json:{write:!0}})],pp.prototype,"styleName",void 0),u([p({type:fn,json:{write:!1}})],pp.prototype,"portal",void 0),u([p({type:String,json:{read:Yee,write:Wx}})],pp.prototype,"styleUrl",void 0),u([p({type:ER,json:{read:!1}})],pp.prototype,"thumbnail",void 0),u([p({type:String,json:{write:!0}})],pp.prototype,"name",void 0),u([Ue({styleSymbolReference:"web-style"},{readOnly:!0})],pp.prototype,"type",void 0),u([p()],pp.prototype,"_fetchCacheKey",null),pp=PZ=u([A("esri.symbols.WebStyleSymbol")],pp);const Cb=pp;function J9t(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function p$e(t){switch(t?.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const H_={base:Xa,key:"type",typeMap:{"simple-fill":NS,"picture-fill":gie,"picture-marker":gD,"simple-line":uh,"simple-marker":ug,text:AA,"label-3d":ej,"line-3d":LS,"mesh-3d":mD,"point-3d":Sm,"polygon-3d":Hb,"web-style":Cb,cim:jb},errorContext:"symbol"},X9t={base:Xa,key:"type",typeMap:{"picture-marker":gD,"simple-marker":ug,"point-3d":Sm,cim:jb},errorContext:"symbol"},K9t={base:Xa,key:"type",typeMap:{"simple-line":uh,"line-3d":LS,cim:jb},errorContext:"symbol"},Q9t={base:Xa,key:"type",typeMap:{"simple-fill":NS,"picture-fill":gie,"polygon-3d":Hb,cim:jb},errorContext:"symbol"},UXe={base:Xa,key:"type",typeMap:{"picture-marker":gD,"simple-marker":ug,text:AA,"web-style":Cb,cim:jb},errorContext:"symbol"},BXe=dA({types:H_}),f$e={base:Xa,key:"type",typeMap:{"simple-fill":NS,"picture-fill":gie,"picture-marker":gD,"simple-line":uh,"simple-marker":ug,text:AA,"line-3d":LS,"mesh-3d":mD,"point-3d":Sm,"polygon-3d":Hb,"web-style":Cb,cim:jb},errorContext:"symbol"},VXe={base:Xa,key:"type",typeMap:{text:AA,"label-3d":ej},errorContext:"symbol"},Iue={base:Xa,key:"type",typeMap:{"line-3d":LS,"mesh-3d":mD,"point-3d":Sm,"polygon-3d":Hb,"web-style":Cb,cim:jb},errorContext:"symbol"},jXe={base:Xa,key:"type",typeMap:{"label-3d":ej},errorContext:"symbol"},m$e=Sd(H_);var DZ;function GXe(t){if(!t)return null;const e={};for(const i in t){const r=af(t[i]);r&&(e[i]=r)}return Object.keys(e).length!==0?e:null}function HXe(t){if(t==null)return null;const e={};for(const i in t){const r=t[i];r&&(e[i]=r.toJSON())}return Object.keys(e).length!==0?e:null}let Sc=DZ=class extends Dt.ClonableMixin(ee){constructor(t){super(t),this.isAggregate=!1,this.layer=null,this.origin=null,this.popupTemplate=null,this.sourceLayer=null,this._version=0,Object.defineProperty(this,"uid",{value:_d(),configurable:!0}),Object.defineProperty(this,"_lastMeshTransform",{value:{},configurable:!0,writable:!0,enumerable:!1}),arguments.length>1&&EVe(J.getLogger(this),"Graphic",{version:"4.30"})}initialize(){this._watchMeshGeometryChanges()}set aggregateGeometries(t){const e=this._get("aggregateGeometries");JSON.stringify(e)!==JSON.stringify(t)&&this._set("aggregateGeometries",t)}set attributes(t){const e=this._get("attributes");e!==t&&(this._set("attributes",t),this._notifyLayer("attributes",e,t))}set geometry(t){const e=this._get("geometry");e!==t&&(this._set("geometry",t),t?.type!=="mesh"&&this._notifyLayer("geometry",e,t))}set symbol(t){const e=this._get("symbol");e!==t&&(this._set("symbol",t),this._notifyLayer("symbol",e,t))}get version(){return this._version}set visible(t){const e=this._get("visible");e!==t&&(this._set("visible",t),this._notifyLayer("visible",e,t))}cloneShallow(){return new DZ({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible,origin:this.origin})}getEffectivePopupTemplate(t=!1){if(this.popupTemplate)return this.popupTemplate;const e=this.origin&&"layer"in this.origin?this.origin.layer:null;for(const i of[e,this.sourceLayer,this.layer])if(i){if("popupTemplate"in i&&i.popupTemplate)return i.popupTemplate;if(t&&"defaultPopupTemplate"in i&&i.defaultPopupTemplate!=null)return i.defaultPopupTemplate}return null}getAttribute(t){return this.attributes?.[t]}setAttribute(t,e){if(this.attributes){const i=this.getAttribute(t);this.attributes[t]=e,this._notifyLayer("attributes",i,e,t)}else this.attributes={[t]:e},this._notifyLayer("attributes",void 0,e,t)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:HXe(this.aggregateGeometries),geometry:this.geometry!=null?this.geometry.toJSON():null,symbol:this.symbol!=null?this.symbol.toJSON():null,attributes:ee.isSerializable(this.attributes)?this.attributes.toJSON():{...this.attributes},popupTemplate:this.popupTemplate?.toJSON()??null}}notifyMeshTransformChanged(t={}){const{geometry:e}=this;if(e?.type==="mesh"){const i={origin:e.origin,transform:e.transform};this._notifyLayer("origin-transform",i,i,t.action)}}_notifyLayer(t,e,i,r){if(this._version++,!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:t,oldValue:e,newValue:i};t==="origin-transform"&&(s.action=r),t==="attributes"&&(s.attributeName=r),this.layer.graphicChanged(s)}_watchMeshGeometryChanges(){this.addHandles([gn(()=>this.geometry?.type==="mesh"&&this.geometry.vertexSpace.origin?{localMatrix:this.geometry.transform?.localMatrix,origin:this.geometry.vertexSpace.origin}:void 0,({localMatrix:t,origin:e})=>{this._lastMeshTransform.localMatrix===t&&this._lastMeshTransform.origin===e||(this._lastMeshTransform.localMatrix=t,this._lastMeshTransform.origin=e,this.notifyMeshTransformChanged())}),gn(()=>this.geometry?.type==="mesh"?{vertexAttributes:this.geometry.vertexAttributes}:void 0,()=>{const t=this.geometry;t?.type==="mesh"&&t.vertexSpace.origin?(this._lastMeshTransform.localMatrix=t.transform?.localMatrix,this._lastMeshTransform.origin=t.vertexSpace.origin):(this._lastMeshTransform.localMatrix=void 0,this._lastMeshTransform.origin=void 0),this._notifyLayer("geometry",this.geometry,this.geometry)},{equals:(t,e)=>t===e,sync:!0})])}};u([p({value:null,json:{read:GXe}})],Sc.prototype,"aggregateGeometries",null),u([p({value:null})],Sc.prototype,"attributes",null),u([p({value:null,types:bA,json:{read:af}})],Sc.prototype,"geometry",null),u([p({type:Boolean})],Sc.prototype,"isAggregate",void 0),u([p({clonable:"reference"})],Sc.prototype,"layer",void 0),u([p({clonable:"reference"})],Sc.prototype,"origin",void 0),u([p({type:CA})],Sc.prototype,"popupTemplate",void 0),u([p({clonable:"reference"})],Sc.prototype,"sourceLayer",void 0),u([p({value:null,types:H_})],Sc.prototype,"symbol",null),u([p({clonable:!1,json:{read:!1,write:!1}})],Sc.prototype,"_version",void 0),u([p({type:Boolean,value:!0})],Sc.prototype,"visible",null),Sc=DZ=u([A("esri.Graphic")],Sc);const Ml=Sc,Rue=Object.freeze(Object.defineProperty({__proto__:null,default:Ml},Symbol.toStringTag,{value:"Module"}));let CR=class extends bR{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};u([fte({Type:Ml,ensureType:Is(Ml)})],CR.prototype,"itemType",void 0),CR=u([A("esri.support.GraphicsCollection")],CR);let k0=class extends ue{constructor(e){super(e),this.view=null,this.baseLayerViews=new Ee,this.referenceLayerViews=new Ee,this._loadingHandle=H(()=>this.view?.map?.basemap,i=>{i&&i.load().catch(()=>{})},Nt)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return this.view?.suspended??!0}get updating(){return this.view?.suspended?!1:!!this.view?.map?.basemap?.loaded&&(this.baseLayerViews.some(i=>i.updating)||this.referenceLayerViews.some(i=>i.updating))}};u([p({constructOnly:!0})],k0.prototype,"view",void 0),u([p({readOnly:!0})],k0.prototype,"baseLayerViews",void 0),u([p({readOnly:!0})],k0.prototype,"referenceLayerViews",void 0),u([p({readOnly:!0})],k0.prototype,"suspended",null),u([p({type:Boolean,readOnly:!0})],k0.prototype,"updating",null),k0=u([A("esri.views.BasemapView")],k0);const qXe=k0;function WXe(t){return"tryRecycleWith"in t}function ZXe(t){return t!=null&&typeof t=="object"&&"layerViews"in t}let YXe=class{constructor(e,i,r){this.layer=e,this.view=i,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=Qo(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,Xo(this._controller.signal,()=>{const s=new U("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(s)})}tryRecycle(e){if(!this.done||!this.layerView||!WXe(this.layerView))return null;const i=this.layer.type,r=this._controller.signal;for(let s=0;s<e.length;s++){const n=e[s];if(n.type!==i)continue;const o=this.layerView.tryRecycleWith(n,{signal:r});if(o){e.splice(s,1),this.layer=n;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(gt(this._controller.signal),n.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),n.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,h)=>Xo(this._controller.signal,()=>h(vi())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:i,view:r}=this;i.emit("layerview-destroy",{view:r,layerView:e}),r.emit("layerview-destroy",{layer:i,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:i,view:r}=this;this._map=r.map;try{let s,n;if(await i.load({signal:e}),i.prefetchResources&&await i.prefetchResources({signal:e}),XXe(i))s=await i.createLayerView(r,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new U("layer:view-not-supported","No layerview implementation was found");const l=await this.layerViewImporter.importLayerView(i);gt(e),s="default"in l?new l.default({layer:i,view:r}):new l({layer:i,view:r})}const o=()=>{n=Hi(n),s.destroyed||s.destroy(),s.layer=null,s.parent=null,s.view=null,this.done=!0};n=Xo(e,o),gt(e);try{await s.when()}catch(l){throw o(),l}if(!this._map?.allLayers?.includes(i))return o(),void this._deferred.reject(new U("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=s,i.emit("layerview-create",{view:r,layerView:s}),r.emit("layerview-create",{layer:i,layerView:s}),this.done=!0,this._deferred.resolve(s)}catch(s){i.emit("layerview-create-error",{view:r,error:s}),r.emit("layerview-create-error",{layer:i,error:s}),this.done=!0,this._deferred.reject(new U("layerview:create-error","layerview creation failed",{layer:i,error:s}))}}},$h=class extends ue{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new Hy,this.supportsGround=!0,this._preloadLayerViewModules=()=>{const i=this.view.map?.allLayers;if(i)for(const r of i)this.layerViewImporter.hasLayerViewModule(r)&&this.layerViewImporter.importLayerView(r)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=Qo(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(mA(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{if(this.destroyed)return;const i=this.view.map;if(this._map!==i&&(this.clear(),this._map=i),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const r=new Set,s=[],n=this.view.ready,o=l=>{if(l!=null){for(const c of l)if(c){r.add(c);const h=this._layerLayerViewInfoMap.get(c);h&&n?h.start():h||this._recyclingInfoMap.has(c)||s.push(c),"layers"in c&&c.layers&&o(c.layers)}}};for(const l of this._rootCollectionNames)o(Rm(this,l));for(const[l,c]of this._layerLayerViewInfoMap)if(!r.has(l)){this._layerLayerViewInfoMap.delete(c.layer);const h=c.tryRecycle(s);h?(this.notifyChange("updating"),this._recyclingInfoMap.set(c.layer,c),h.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),this._layerLayerViewInfoMap.set(c.layer,c),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),c.destroy(),this._reschedule()})):c.destroy()}for(const[l,c]of this._recyclingInfoMap)r.has(l)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),c.destroy());for(const l of s)this._createLayerView(l);this._refreshCollections();const a=[i?.ground?.layers,i?.basemap?.baseLayers,i?.basemap?.referenceLayers,i?.layers].filter(l=>!!l);r.forEach(l=>"layers"in l&&a.push(l.layers)),this.addHandles(a.map(l=>this._watchUpdatingTracking.addOnCollectionChange(()=>l,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.addHandles([io(()=>this.view?.map?.allLayers,"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),H(()=>{const e=this.view,i=e?.map;return[i?.basemap,i?.ground,i?.layers,e?.ready]},()=>this._reschedule(),St)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),N6(this._recyclingInfoMap),N6(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(vi()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||vm(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const i of this._layerLayerViewInfoMap.values())i.done||++e;return e}clear(){this.destroyed||(N6(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new U("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}isCreatingLayerViewsForLayer(e,i){this.commitProperty("updatingRemaining");const r=this._layerLayerViewInfoMap.get(e);if(!r?.done)return!0;const s=r.layerView;return!(!s||!i||s.parent===i)||!!(r.done&&s&&"layers"in e&&e.layers?.length)&&e.layers.some(n=>this.isCreatingLayerViewsForLayer(n,s))}_refreshCollections(){for(const[e,i]of this._layersToLayerViews)this._populateLayerViewsOwners(Rm(this,e),Rm(this,i),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,i,r){if(!e||!i)return void(i&&i.removeAll());let s=0;for(const n of e){const o=this._layerLayerViewInfoMap.get(n);if(!o?.layerView)continue;const a=o.layerView;a.layer=n,a.parent=r,i.at(s)!==a&&i.splice(s,0,a),"layers"in n&&ZXe(a)&&this._populateLayerViewsOwners(n.layers,a.layerViews,a),s+=1}s<i.length&&i.splice(s,i.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const i=new YXe(e,this.view,this.layerViewImporter);i.promise.then(()=>this._refreshCollections(),r=>{r&&(Xr(r)||r.name==="cancelled:layerview-create")||J.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:r}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,i),this.view.ready&&i.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};u([p()],$h.prototype,"_workPromise",void 0),u([p({readOnly:!0})],$h.prototype,"_watchUpdatingTracking",void 0),u([p({readOnly:!0})],$h.prototype,"_layersToLayerViews",null),u([p({readOnly:!0})],$h.prototype,"_rootCollectionNames",null),u([p()],$h.prototype,"layerViewImporter",void 0),u([p()],$h.prototype,"supportsGround",void 0),u([p({readOnly:!0})],$h.prototype,"updating",null),u([p({readOnly:!0})],$h.prototype,"updatingRemaining",null),u([p({constructOnly:!0})],$h.prototype,"view",void 0),$h=u([A("esri.views.LayerViewManager")],$h);const JXe=$h;function XXe(t){return t.createLayerView!==qV.prototype.createLayerView}let Su=class extends ue{constructor(e){super(e),this.factor=1.5,this.offset=wo(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};u([p({type:Number})],Su.prototype,"factor",void 0),u([p({nonNullable:!0})],Su.prototype,"offset",void 0),u([p()],Su.prototype,"position",void 0),u([p({type:Number,range:{min:0}})],Su.prototype,"size",void 0),u([p()],Su.prototype,"maskUrl",void 0),u([p()],Su.prototype,"maskEnabled",void 0),u([p()],Su.prototype,"overlayUrl",void 0),u([p()],Su.prototype,"overlayEnabled",void 0),u([p({readOnly:!0})],Su.prototype,"version",null),u([p({type:Boolean})],Su.prototype,"visible",void 0),Su=u([A("esri.views.Magnifier")],Su);const g$e=Su;let p4=class{constructor(e){this._observable=new rD,this._map=new Map(e)}get size(){return It(this._observable),this._map.size}clear(){this._map.size>0&&(this._map.clear(),this._observable.notify())}delete(e){const i=this._map.delete(e);return i&&this._observable.notify(),i}entries(){return It(this._observable),this._map.entries()}forEach(e,i){It(this._observable),this._map.forEach((r,s)=>e.call(i,r,s,this),i)}get(e){return It(this._observable),this._map.get(e)}has(e){return It(this._observable),this._map.has(e)}keys(){return It(this._observable),this._map.keys()}set(e,i){return this._map.set(e,i),this._observable.notify(),this}values(){return It(this._observable),this._map.values()}[Symbol.iterator](){return It(this._observable),this._map[Symbol.iterator]()}[Symbol.dispose](){this._observable.destroy()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}};var LZ;let px=LZ=class extends ee{constructor(t){super(t),this.name=null,this.code=null}clone(){return new LZ({name:this.name,code:this.code})}};u([p({type:String,json:{write:{isRequired:!0}}})],px.prototype,"name",void 0),u([p({type:[String,Number],json:{write:{isRequired:!0}}})],px.prototype,"code",void 0),px=LZ=u([A("esri.layers.support.CodedValue")],px);const KXe=new ei({inherited:"inherited",codedValue:"coded-value",range:"range"});let GO=class extends ee{constructor(e){super(e),this.name=null,this.type=null}};u([p({type:String,json:{write:!0}})],GO.prototype,"name",void 0),u([Ue(KXe),p({json:{write:{isRequired:!0}}})],GO.prototype,"type",void 0),GO=u([A("esri.layers.support.Domain")],GO);const tj=GO;var NZ;let HO=NZ=class extends tj{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const i=String(t);this.codedValues.some(r=>(String(r.code)===i&&(e=r.name),!!e))}return e}clone(){return new NZ({codedValues:q(this.codedValues),name:this.name})}};u([p({type:[px],json:{write:{isRequired:!0}}})],HO.prototype,"codedValues",void 0),u([Ue({codedValue:"coded-value"})],HO.prototype,"type",void 0),HO=NZ=u([A("esri.layers.support.CodedValueDomain")],HO);const ij=HO;var FZ;let f4=FZ=class extends tj{constructor(t){super(t),this.type="inherited"}clone(){return new FZ}};u([Ue({inherited:"inherited"})],f4.prototype,"type",void 0),f4=FZ=u([A("esri.layers.support.InheritedDomain")],f4);const y$e=f4;var kZ;let xE=kZ=class extends tj{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new kZ({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};u([p({json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range?.[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,i){e[i]=[this.minValue||0,t]},isRequired:!0}}})],xE.prototype,"maxValue",void 0),u([p({json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range?.[0]},write:{target:"range",writer(t,e,i){e[i]=[t,this.maxValue||0]},isRequired:!0}}})],xE.prototype,"minValue",void 0),u([Ue({range:"range"})],xE.prototype,"type",void 0),xE=kZ=u([A("esri.layers.support.RangeDomain")],xE);const v$e=xE,_$e={key:"type",base:tj,typeMap:{range:v$e,"coded-value":ij,inherited:y$e}};function rj(t){if(!t?.type)return null;switch(t.type){case"range":return v$e.fromJSON(t);case"codedValue":return ij.fromJSON(t);case"inherited":return y$e.fromJSON(t)}return null}const yie=new ei({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});var zZ;const QXe=new ei({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let al=zZ=class extends ee{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=void 0,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return i?.value??null}readValueType(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return i?QXe.fromJSON(i.fieldValueType):null}clone(){return new zZ({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain?.clone()??null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};u([p({type:String,json:{write:!0}})],al.prototype,"alias",void 0),u([p({type:[String,Number],json:{write:{allowNull:!0}}})],al.prototype,"defaultValue",void 0),u([p()],al.prototype,"description",void 0),u([me("description")],al.prototype,"readDescription",null),u([p({types:_$e,json:{read:{reader:rj},write:!0}})],al.prototype,"domain",void 0),u([p({type:Boolean,json:{write:!0}})],al.prototype,"editable",void 0),u([p({type:Ei,json:{write:{overridePolicy:t=>({enabled:Number.isFinite(t)})}}})],al.prototype,"length",void 0),u([p({type:String,json:{write:!0}})],al.prototype,"name",void 0),u([p({type:Boolean,json:{write:!0}})],al.prototype,"nullable",void 0),u([Ue(yie)],al.prototype,"type",void 0),u([p()],al.prototype,"valueType",void 0),u([me("valueType",["description"])],al.prototype,"readValueType",null),u([p({type:Boolean,json:{read:!1}})],al.prototype,"visible",void 0),al=zZ=u([A("esri.layers.support.Field")],al);const sj=al;var UZ;let SE=UZ=class extends ee{constructor(t){super(t),this.type="map-layer"}clone(){const{mapLayerId:t,gdbVersion:e}=this;return new UZ({mapLayerId:t,gdbVersion:e})}};u([Ue({mapLayer:"map-layer"}),p({json:{write:{isRequired:!0}}})],SE.prototype,"type",void 0),u([p({type:Ei,json:{write:{isRequired:!0}}})],SE.prototype,"mapLayerId",void 0),u([p({type:String,json:{write:!0}})],SE.prototype,"gdbVersion",void 0),SE=UZ=u([A("esri.layers.support.source.MapLayerSource")],SE);var BZ;let Yg=BZ=class extends ee{constructor(t){super(t),this.type="query-table"}clone(){const{workspaceId:t,query:e,oidFields:i,spatialReference:r,geometryType:s}=this,n={workspaceId:t,query:e,oidFields:i,spatialReference:r?.clone()??void 0,geometryType:s};return new BZ(n)}};u([Ue({queryTable:"query-table"}),p({json:{write:{isRequired:!0}}})],Yg.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],Yg.prototype,"workspaceId",void 0),u([p({type:String,json:{write:!0}})],Yg.prototype,"query",void 0),u([p({type:String,json:{write:!0}})],Yg.prototype,"oidFields",void 0),u([p({type:Ae,json:{write:!0}})],Yg.prototype,"spatialReference",void 0),u([Ue(YSe)],Yg.prototype,"geometryType",void 0),Yg=BZ=u([A("esri.layers.support.source.QueryTableDataSource")],Yg);var VZ;let TE=VZ=class extends ee{constructor(t){super(t),this.type="raster"}clone(){const{workspaceId:t,dataSourceName:e}=this;return new VZ({workspaceId:t,dataSourceName:e})}};u([Ue({raster:"raster"}),p({json:{write:{isRequired:!0}}})],TE.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],TE.prototype,"dataSourceName",void 0),u([p({type:String,json:{write:!0}})],TE.prototype,"workspaceId",void 0),TE=VZ=u([A("esri.layers.support.source.RasterDataSource")],TE);var jZ;let o1=jZ=class extends ee{constructor(t){super(t),this.type="table"}clone(){const{workspaceId:t,gdbVersion:e,dataSourceName:i}=this;return new jZ({workspaceId:t,gdbVersion:e,dataSourceName:i})}};u([Ue({table:"table"}),p({json:{write:{isRequired:!0}}})],o1.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],o1.prototype,"workspaceId",void 0),u([p({type:String,json:{write:!0}})],o1.prototype,"gdbVersion",void 0),u([p({type:String,json:{write:!0}})],o1.prototype,"dataSourceName",void 0),o1=jZ=u([A("esri.layers.support.source.TableDataSource")],o1);var GZ,HZ;const eKe=Mo()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let Tu=GZ=class extends ee{constructor(t){super(t),this.type="join-table"}readLeftTableSource(t,e,i){return Pue()(t,e,i)}castLeftTableSource(t){return Sd(qZ(),t)}readRightTableSource(t,e,i){return Pue()(t,e,i)}castRightTableSource(t){return Sd(qZ(),t)}clone(){const{leftTableKey:t,rightTableKey:e,leftTableSource:i,rightTableSource:r,joinType:s}=this,n={leftTableKey:t,rightTableKey:e,leftTableSource:i?.clone()??void 0,rightTableSource:r?.clone()??void 0,joinType:s};return new GZ(n)}};u([Ue({joinTable:"join-table"}),p({json:{write:{isRequired:!0}}})],Tu.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],Tu.prototype,"leftTableKey",void 0),u([p({type:String,json:{write:!0}})],Tu.prototype,"rightTableKey",void 0),u([p({json:{write:!0}})],Tu.prototype,"leftTableSource",void 0),u([me("leftTableSource")],Tu.prototype,"readLeftTableSource",null),u([Yt("leftTableSource")],Tu.prototype,"castLeftTableSource",null),u([p({json:{write:!0}})],Tu.prototype,"rightTableSource",void 0),u([me("rightTableSource")],Tu.prototype,"readRightTableSource",null),u([Yt("rightTableSource")],Tu.prototype,"castRightTableSource",null),u([Ue(eKe)],Tu.prototype,"joinType",void 0),Tu=GZ=u([A("esri.layers.support.source.JoinTableDataSource")],Tu);let q6=null;function Pue(){return q6||(q6=dA({types:qZ()})),q6}let W6=null;function qZ(){return W6||(W6={key:"type",base:null,typeMap:{"data-layer":Mp,"map-layer":SE}}),W6}const tKe={key:"type",base:null,typeMap:{"join-table":Tu,"query-table":Yg,raster:TE,table:o1}};let Mp=HZ=class extends ee{constructor(t){super(t),this.type="data-layer"}clone(){const{fields:t,dataSource:e}=this;return new HZ({fields:t,dataSource:e})}};u([Ue({dataLayer:"data-layer"}),p({json:{write:{isRequired:!0}}})],Mp.prototype,"type",void 0),u([p({type:[sj],json:{write:!0}})],Mp.prototype,"fields",void 0),u([p({types:tKe,json:{write:!0}})],Mp.prototype,"dataSource",void 0),Mp=HZ=u([A("esri.layers.support.source.DataLayerSource")],Mp),Mp.from=Is(Mp);let a1=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};u([p({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.onFields!=null&&this.onFields.length>0}}}}})],a1.prototype,"onFields",void 0),u([p({type:String,json:{write:!0}})],a1.prototype,"operator",void 0),u([p({type:String,json:{write:!0}})],a1.prototype,"searchTerm",void 0),u([p({type:String,json:{write:!0}})],a1.prototype,"searchType",void 0),a1=u([A("esri.rest.support.FullTextSearch")],a1);const iKe=a1;var WZ;const Due=new ei({upperLeft:"upper-left",lowerLeft:"lower-left"});let l1=WZ=class extends ee{constructor(t){super(t),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new WZ(q({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};u([p({type:gi,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],l1.prototype,"extent",void 0),u([p({type:["view","edit"],json:{write:!0}})],l1.prototype,"mode",void 0),u([p({type:String,json:{read:Due.read,write:Due.write}})],l1.prototype,"originPosition",void 0),u([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],l1.prototype,"tolerance",void 0),l1=WZ=u([A("esri.rest.support.QuantizationParameters")],l1);const b$e=l1,rKe=new ei({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"});var ZZ;const Lue=new ei({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let fp=ZZ=class extends ee{constructor(t){super(t),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(t,e){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(e.statisticParameters=q(t))}clone(){return new ZZ({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:q(this.statisticParameters)})}};u([p({type:Number,json:{write:!0}})],fp.prototype,"maxPointCount",void 0),u([p({type:Number,json:{write:!0}})],fp.prototype,"maxRecordCount",void 0),u([p({type:Number,json:{write:!0}})],fp.prototype,"maxVertexCount",void 0),u([p({type:String,json:{write:!0}})],fp.prototype,"onStatisticField",void 0),u([p({type:String,json:{write:!0}})],fp.prototype,"outStatisticFieldName",void 0),u([p({type:String,json:{read:{source:"statisticType",reader:Lue.read},write:{target:"statisticType",writer:Lue.write}}})],fp.prototype,"statisticType",void 0),u([p({type:Object})],fp.prototype,"statisticParameters",void 0),u([ge("statisticParameters")],fp.prototype,"writeStatisticParameters",null),fp=ZZ=u([A("esri.rest.support.StatisticDefinition")],fp);const sKe=fp;var m4;const nKe=new ei({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Ot=m4=class extends ee{static from(t){return uA(m4,t)}constructor(t){super(t),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.returnTrueCurves=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(t){return typeof t=="number"||typeof t=="object"?t:null}writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeParameterValues(t,e){if(t){const i={};for(const r in t){const s=t[r];Array.isArray(s)?i[r]=s.map(n=>n instanceof Date?n.getTime():n):s instanceof Date?i[r]=s.getTime():i[r]=s}e.parameterValues=i}}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,e.where="1=1"}writeWhere(t,e){e.where=t||"1=1"}clone(){return new m4(q({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:this.historicMoment!=null?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,returnTrueCurves:this.returnTrueCurves,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};Ot.MAX_MAX_RECORD_COUNT_FACTOR=5,u([p({json:{write:!0}})],Ot.prototype,"aggregateIds",void 0),u([p({type:Boolean,json:{write:!0}})],Ot.prototype,"cacheHint",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],Ot.prototype,"compactGeometryEnabled",void 0),u([p({json:{write:!0}})],Ot.prototype,"datumTransformation",void 0),u([Yt("datumTransformation")],Ot.prototype,"castDatumTransformation",null),u([p({type:Boolean,json:{default:!1,write:!0}})],Ot.prototype,"defaultSpatialReferenceEnabled",void 0),u([p({type:Number,json:{write:!0}})],Ot.prototype,"distance",void 0),u([p({type:Mp,json:{write:!0}})],Ot.prototype,"dynamicDataSource",void 0),u([p({type:String,json:{write:!0}})],Ot.prototype,"formatOf3DObjects",void 0),u([p({type:[iKe],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.fullText!=null&&this.fullText.length>0}}}}})],Ot.prototype,"fullText",void 0),u([p({type:String,json:{write:!0}})],Ot.prototype,"gdbVersion",void 0),u([p({types:bA,json:{read:af,write:!0}})],Ot.prototype,"geometry",void 0),u([p({type:Number,json:{write:!0}})],Ot.prototype,"geometryPrecision",void 0),u([p({type:[String],json:{write:!0}})],Ot.prototype,"groupByFieldsForStatistics",void 0),u([p({type:String,json:{write:!0}})],Ot.prototype,"having",void 0),u([p({type:Date})],Ot.prototype,"historicMoment",void 0),u([ge("historicMoment")],Ot.prototype,"writeHistoricMoment",null),u([p({type:Number,json:{write:!0}})],Ot.prototype,"maxAllowableOffset",void 0),u([p({type:Number,cast:t=>t<1?1:t>Ot.MAX_MAX_RECORD_COUNT_FACTOR?Ot.MAX_MAX_RECORD_COUNT_FACTOR:t,json:{write:{overridePolicy:t=>({enabled:t>1})}}})],Ot.prototype,"maxRecordCountFactor",void 0),u([p({type:["xyFootprint"],json:{write:!0}})],Ot.prototype,"multipatchOption",void 0),u([p({type:Number,json:{read:{source:"resultRecordCount"}}})],Ot.prototype,"num",void 0),u([p({json:{write:!0}})],Ot.prototype,"objectIds",void 0),u([p({type:[String],json:{write:!0}})],Ot.prototype,"orderByFields",void 0),u([p({type:[String],json:{write:!0}})],Ot.prototype,"outFields",void 0),u([p({type:Ae,json:{name:"outSR",write:!0}})],Ot.prototype,"outSpatialReference",void 0),u([p({type:[sKe],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.outStatistics!=null&&this.outStatistics.length>0}}}}})],Ot.prototype,"outStatistics",void 0),u([p({json:{write:!0}})],Ot.prototype,"parameterValues",void 0),u([ge("parameterValues")],Ot.prototype,"writeParameterValues",null),u([p({type:ke,json:{write:!0}})],Ot.prototype,"pixelSize",void 0),u([p({type:b$e,json:{write:!0}})],Ot.prototype,"quantizationParameters",void 0),u([p({type:[Object],json:{write:!0}})],Ot.prototype,"rangeValues",void 0),u([p({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],Ot.prototype,"relationParameter",void 0),u([p({type:String,json:{write:!0}})],Ot.prototype,"resultType",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],Ot.prototype,"returnCentroid",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],Ot.prototype,"returnDistinctValues",void 0),u([p({type:Boolean,json:{default:!0,write:!0}})],Ot.prototype,"returnExceededLimitFeatures",void 0),u([p({type:Boolean,json:{write:!0}})],Ot.prototype,"returnGeometry",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],Ot.prototype,"returnQueryGeometry",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],Ot.prototype,"returnM",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ot.prototype,"returnZ",void 0),u([p({type:Boolean,json:{write:!0}})],Ot.prototype,"returnTrueCurves",void 0),u([p({type:Ae,json:{write:!0}})],Ot.prototype,"sourceSpatialReference",void 0),u([Ue(rKe,{ignoreUnknown:!1,name:"spatialRel"})],Ot.prototype,"spatialRelationship",void 0),u([p({type:Number,json:{read:{source:"resultOffset"}}})],Ot.prototype,"start",void 0),u([ge("start"),ge("num")],Ot.prototype,"writeStart",null),u([p({type:String,json:{write:!0}})],Ot.prototype,"sqlFormat",void 0),u([p({type:String,json:{write:!0}})],Ot.prototype,"text",void 0),u([p({type:To,json:{write:!0}})],Ot.prototype,"timeExtent",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],Ot.prototype,"timeReferenceUnknownClient",void 0),u([Ue(nKe,{ignoreUnknown:!1}),p({json:{write:{overridePolicy(t){return{enabled:!!t&&this.distance!=null}}}}})],Ot.prototype,"units",void 0),u([p({type:String,json:{write:{overridePolicy(t){return{enabled:t!=null||this.start!=null&&this.start>0}}}}})],Ot.prototype,"where",void 0),u([ge("where")],Ot.prototype,"writeWhere",null),Ot=m4=u([A("esri.rest.support.Query")],Ot);const Jm=Ot;function jL(t){return!!(t!=null&&typeof t=="object"&&"createQuery"in t&&t.createQuery&&"on"in t&&t.on)}let Yf=class extends ws.EventedAccessor{constructor(e){super(e),this._selectionMap=new p4,this._sources=new Ee,this._trashCan=[],this._layerEditHandles=new Ee,this._vizTaskId=0,this.showHighlight=!0,this.highlightName="default"}initialize(){this.addHandles([H(()=>[this.view,this.showHighlight],()=>this._refreshVisualization()),io(()=>this.sources,"change",i=>{const r=this._selectionMap;for(const s of i.removed)r.delete(s);this._refreshListeners(),this._refreshVisualization()},{onListenerAdd:()=>this._refreshListeners()})]);const e=new Ee;this.view.when().then(()=>{this.view.map&&(this.view.map.allLayers.flatten(i=>"sublayers"in i&&i.sublayers?i.sublayers:null).forEach(i=>{(jL(i)&&!HWe(i)||Xh(i))&&e.add(i)}),this.sources=e)})}destroy(){this._layerEditHandles.drain(Hi)}get selections(){return Array.from(this._selectionMap.entries()).map(e=>{const[i,r]=e;return{layer:i,selection:[...r.selection]}})}get count(){let e=0;for(const i of this._selectionMap.values())e+=i.selection.length;return e}get hasSelection(){return this.count>0}get sources(){return this._sources}set sources(e){df(e,this._sources)}async getSelectedFeatures(e,i={},r="layerView"){const{view:s,selections:n}=this,o=(e!==void 0?n.filter(a=>e.includes(a.layer)):n).filter(a=>a.selection.length>0).map(async a=>{const{layer:l,selection:c}=a,h=Xh(l)?l.parent:l;if(h==null||!Fue(h))return null;if(r==="layer")return kue(h,c,i);if(Nue(h))return null;const d=await s.whenLayerView(h).catch(()=>null);return d?kue(d,c,i):null});return(await Promise.all(o)).filter(a=>a!=null)}updateSelection(e){const i=new Map;for(const[n,o]of this._selectionMap)i.set(n,[...o.selection]);let r=!1;const s=e.current.concat(e.added);for(const n of s){const o=n.sourceLayer,a=n.getObjectId();if(this.sources.includes(o)&&(jL(o)||Xh(o))&&a!==null){const l=zb(i,o,()=>[]);l.includes(a)||(l.push(a),r=!0)}}for(const n of e.removed){const o=n.sourceLayer,a=n.getObjectId();if(this.sources.includes(o)&&(jL(o)||Xh(o))&&a!==null){const l=i.get(o),c=l?.indexOf(a);c!==void 0&&c>=0&&(l?.splice(c,1),r=!0)}}if(r){const{_selectionMap:n,_trashCan:o}=this,a=[];for(const[l,c]of i){const h=n.get(l);h!==void 0&&o.push(h),n.set(l,{selection:c}),a.push({layer:l,selection:c,...q9(h!==void 0?h.selection:[],c)})}this._onSelectionChange(a)}}setSelection(e,i){this._setSelection(e,i)}getSelection(e){return this._selectionMap.get(e)?.selection}appendToSelection(e,i){const r=this._selectionMap.get(e),s=r!==void 0?[...r.selection]:[];for(const n of i)s.includes(n)||s.push(n);this._setSelection(e,s)}removeFromSelection(e,i){const r=this._selectionMap.get(e);if(!r)return;const s=[];for(const n of r.selection)i.includes(n)||s.push(n);this._setSelection(e,s)}toggleInSelection(e,i){const r=this._selectionMap.get(e);if(!r||r.selection.length===0)return void this._setSelection(e,i);const s=new Set(r.selection),n=new Set(i),o=aje(s,n);this._setSelection(e,Array.from(o))}clear(){const e=this._selectionMap.values();this._trashCan.push(...e);const i=[];for(const[r,s]of this._selectionMap.entries())i.push({layer:r,added:[],removed:[...s.selection],selection:[]});this._selectionMap.clear(),this._onSelectionChange(i)}_onSelectionChange(e){this._refreshVisualization(),this.emit("selection-change",{view:this.view,changes:e})}_refreshVisualization(){if(this.view==null||this.sources==null)return;for(this._vizTaskId++;this._trashCan.length>0;)this._trashCan.pop()?.highlightHandle?.remove();const{sources:e,view:i,_selectionMap:r,showHighlight:s}=this,n=this._vizTaskId;for(const o of e){const a=r.get(o),l=Xh(o)?o.parent:o;if(l!=null&&Fue(l)){if(Nue(l))continue;i.whenLayerView(l).then(c=>{a?.highlightHandle?.remove(),a!=null&&s&&n===this._vizTaskId&&"highlight"in c&&typeof c.highlight=="function"&&a.selection.length>0&&(a.highlightHandle=c.highlight(a.selection,this.highlightName))}).catch(()=>{a?.highlightHandle?.remove()})}}}_refreshListeners(){this._layerEditHandles.drain(Hi);for(const e of this.sources){const i=Xh(e)?e.parent:e;if(i!=null&&jL(i)){const r=i.on("edits",s=>{this._handleEditChanges(s,e)});this._layerEditHandles.push(r)}}}_handleEditChanges(e,i){if(e.deletedFeatures!==void 0&&e.deletedFeatures.length>0&&this._selectionMap.has(i)){const r=e.deletedFeatures.filter(s=>s.error==null).map(s=>s.objectId).filter(of);this.removeFromSelection(i,r)}}_setSelection(e,i){if(!this.sources.includes(e))throw new Error(`Cannot set selection on layer ${e.title} because it is not in 'sources'`);const r=this._selectionMap.get(e);if(r===void 0||!aKe(r,{selection:i})){r!==void 0&&this._trashCan.push(r),this._selectionMap.set(e,{selection:[...i]});const s={layer:e,selection:[...i],...q9(r!==void 0?r.selection:[],i)};this._onSelectionChange([s])}}};u([p({readOnly:!0,nonNullable:!0})],Yf.prototype,"selections",null),u([p({readOnly:!0,nonNullable:!0})],Yf.prototype,"count",null),u([p({constructOnly:!0,nonNullable:!0})],Yf.prototype,"view",void 0),u([p({readOnly:!0,nonNullable:!0})],Yf.prototype,"hasSelection",null),u([p()],Yf.prototype,"showHighlight",void 0),u([p()],Yf.prototype,"sources",null),u([p()],Yf.prototype,"highlightName",void 0),Yf=u([A("esri.views.SelectionManager")],Yf);const Nue=t=>Xh(t)?t.parent?.isTable===!0:t.isTable,oKe=t=>t.layer!==void 0,Fue=t=>t?.when!==void 0,aKe=(t,e)=>{if(t==null&&e==null)return!0;if(t!=null&&e==null||t==null&&e!=null)return!1;if(t!=null&&e!=null&&t.selection!=null&&e.selection!=null){const i=[...t.selection],r=[...e.selection];if(i.length!==r.length)return!1;i.sort(),r.sort();for(let s=0;s<i.length;s++)if(i[s]!==r[s])return!1}return!0},kue=async(t,e,i={})=>{let r;if(oKe(t)){const s=t;r=s===void 0?null:await s.queryFeatures(new Jm({...i,objectIds:e})).then(n=>({data:n,layer:t.layer}))}else{const s=t;r=s===void 0?null:await s.queryFeatures(new Jm({...i,objectIds:e})).then(n=>({data:n,layer:s}))}return r},lKe=Yf;let qO=class extends Dt.ClonableMixin(ue){constructor(e){super(e),this.accentColor=new qe([255,127,0]),this.textColor=new qe([255,255,255])}};u([p({type:qe,nonNullable:!0})],qO.prototype,"accentColor",void 0),u([p({type:qe,nonNullable:!0})],qO.prototype,"textColor",void 0),qO=u([A("esri.views.Theme")],qO);const YZ=qO;var zue;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(zue||(zue={}));const w$e=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],x$e={};function S$e(t){return!!x$e[t]}function cKe(t){for(const e of t)if(!S$e(e))return!1;return!0}w$e.forEach(t=>{x$e[t]=!0});let T$e=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:i,priority:r},s)=>this.inputManager?.installHandlers(s,[i],r))}disconnect(){this.inputManager&&this._handlers.forEach((e,i)=>this.inputManager?.uninstallHandlers(i)),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,i,r,s){const n=Array.isArray(e)?e:e.split(",");if(!cKe(n))return n.some(S$e)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(i)?a=i:(o=i,a=[]),typeof r=="function"?o=r:s=r,s=s??Pm.DEFAULT;const l=this._createUniqueGroupName(),c=new uKe(this.view,n,a,o);this._handlers.set(l,{handler:c,priority:s});for(const h of n){const d=this._handlerCounts.get(h)||0;this._handlerCounts.set(h,d+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),$i(()=>this._removeHandler(l,n))}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,i){if(this._handlers.has(e)){this._handlers.delete(e);for(const r of i){const s=this._handlerCounts.get(r);s===void 0||(s===1?this._handlerCounts.delete(r):this._handlerCounts.set(r,s-1))}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},uKe=class extends ss{constructor(e,i,r,s){super(!0),this._latestDragStart=void 0,this.view=e;for(const n of i)switch(n){case"click":this.registerIncoming("click",r,o=>s(pKe(e,o)));break;case"double-click":this.registerIncoming("double-click",r,o=>s(fKe(e,o)));break;case"immediate-click":this.registerIncoming("immediate-click",r,o=>s(mKe(e,o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,o=>s(gKe(e,o)));break;case"hold":this.registerIncoming("hold",r,o=>s(yKe(e,o)));break;case"drag":this.registerIncoming("drag",r,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",r,o=>s(vKe(o)));break;case"key-up":this.registerIncoming("key-up",r,o=>s(_Ke(o)));break;case"pointer-down":this.registerIncoming("pointer-down",r,o=>s(cM(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",r,o=>s(cM(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",r,o=>s(cM(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,o=>s(bKe(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,o=>s(wKe(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,o=>s(cM(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,o=>s(cM(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",r,o=>{s(xKe(o))});break;case"focus":this.registerIncoming("focus",r,o=>{s(hKe(o))});break;case"blur":this.registerIncoming("blur",r,o=>{s(dKe(o))})}}_wrapDrag(e){const i=e.data,{x:r,y:s}=i.center,{action:n,pointerType:o,button:a}=i;if(n==="start"&&(this._latestDragStart=i),!this._latestDragStart)return;const l=i.pointer.native,c=i.buttons,{cancelable:h,timestamp:d}=e,f={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return n==="end"&&(this._latestDragStart=void 0),{type:"drag",action:n,x:r,y:s,origin:f,pointerType:o,button:a,buttons:c,radius:i.radius,angle:$o(i.angle),native:l,timestamp:d,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}};function hKe(t){return{type:"focus",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function dKe(t){return{type:"blur",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function pKe(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:h,screenPoint:wo(n,o),mapPoint:yD(t,n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}function fKe(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"double-click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:h,mapPoint:yD(t,n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}function mKe(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:h,timestamp:d}=e;return{type:"immediate-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:d,mapPoint:yD(t,n,o),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}function gKe(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:h,timestamp:d}=e;return{type:"immediate-double-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:d,mapPoint:yD(t,n,o),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}function yKe(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:yD(t,n,o),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:h=>e.async(h),preventDefault:()=>e.preventDefault()}}function yD(t,e,i){return t.toMap(wo(e,i),{exclude:[]})}function vKe(t){const{key:e,repeat:i,native:r}=t.data,{cancelable:s,timestamp:n}=t;return{type:"key-down",key:e,repeat:i,native:r,timestamp:n,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:o=>t.async(o),preventDefault:()=>t.preventDefault()}}function _Ke(t){const{key:e,native:i}=t.data,{cancelable:r,timestamp:s}=t;return{type:"key-up",key:e,native:i,timestamp:s,cancelable:r,stopPropagation:()=>t.stopPropagation(),async:n=>t.async(n),preventDefault:()=>t.preventDefault()}}function cM(t,e){const{x:i,y:r,button:s,buttons:n,native:o,eventId:a}=t.data,l=o.pointerId,c=o.pointerType,{cancelable:h,timestamp:d}=t;return{type:e,x:i,y:r,pointerId:l,pointerType:c,button:s,buttons:n,native:o,timestamp:d,eventId:a,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:f=>t.async(f),preventDefault:()=>t.preventDefault()}}function bKe(t){const{x:e,y:i,buttons:r,native:s,eventId:n}=t.data.currentEvent,{button:o}=t.data.startEvent,a=t.data.startEvent.native.pointerId,l=t.data.startEvent.native.pointerType,c=t.data.action,h={x:t.data.startEvent.x,y:t.data.startEvent.y},{cancelable:d,timestamp:f}=t;return{type:"pointer-drag",x:e,y:i,pointerId:a,pointerType:l,button:o,buttons:r,action:c,origin:h,native:s,timestamp:f,eventId:n,cancelable:d,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}function wKe(t){const{cancelable:e,data:i,timestamp:r}=t,{x:s,y:n,deltaY:o,native:a}=i;return{type:"mouse-wheel",x:s,y:n,deltaY:o,native:a,timestamp:r,cancelable:e,stopPropagation:()=>t.stopPropagation(),async:l=>t.async(l),preventDefault:()=>t.preventDefault()}}function xKe(t){const{action:e,state:i,device:r}=t.data,{cancelable:s,timestamp:n}=t,{buttons:o,axes:a}=i;return{type:"gamepad",device:r,timestamp:n,action:e,buttons:o,axes:a,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:l=>t.async(l),preventDefault:()=>t.preventDefault()}}var VP,Uue,Bue;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(VP||(VP={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(Uue||(Uue={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(Bue||(Bue={}));function SKe(t){return[t.on("before-add",e=>{const i=e.item;if(i==null||t.includes(i))return J.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();i.onAdd()}),t.on("after-remove",e=>{const i=e.item;i.active&&(i.view.activeTool=null),i.destroy()})]}function JZ(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(VP.USER)&&t.getEditableFlag(VP.MANAGER)}function Jf(t){return wo(t.x,t.y)}function d7t(t){return nn(t.x,t.y)}function E$e(t,e){const i=(t instanceof HTMLElement?t:t.surface)?.getBoundingClientRect();return i?wo(e.clientX-i.left,e.clientY-i.top):wo(0,0)}function lU(t,e){return e instanceof Event?E$e(t,e):Jf(e)}function cU(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let TKe=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._externallyDragging=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,i){const r=()=>e.stopPropagation();switch(e.type){case"pointer-move":jue(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0?this._stopDrag=!0:e.action==="start"?this._externallyDragging=!0:e.action==="end"&&(this._externallyDragging=!1),this._stopDrag&&(r(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!Gue(e))break;const s=Jf(e),n=cT(s,e.pointerType,i.forEachTool);if(n==null)break;const o=n.manipulator,a=n.tool;o==null||a==null||!o.interactive||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._releaseManipulatorBeforeDragging(o,e,i),o!=null&&a!=null&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:s,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&i.activeTool==null&&(this._revertToNullActiveTool=!0,i.setActiveTool(n.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:s}),r());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,i);break;case"pointer-drag":{if(!Gue(e))break;const s=this._grabbedManipulators.get(e.pointerId),n=s?.manipulator,o=s?.tool;if(n==null||o==null)break;const a=Jf(e);a.x=ce(a.x,0,i.view.width),a.y=ce(a.y,0,i.view.height);const l=s.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(n.dragging=!0,c?n.events.emit("drag",{action:"update",start:l,screenPoint:a}):n.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:n,start:l}));break;case"end":n.dragging=!1,c&&n.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,i)}r();break}case"immediate-click":{const s=Jf(e),n=cT(s,e.pointerType,i.forEachTool);if(EKe(e)||i.forEachTool(c=>{if((n==null||n.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let h=!1;c.manipulators.forEach(({manipulator:d})=>{d.selected&&(d.selected=!1,h=!0)}),h&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),n==null)break;const{manipulator:o,tool:a}=n;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:r}),Z6(o,r);break}case"click":{const s=Jf(e),n=cT(s,e.pointerType,i.forEachTool),o=n?.manipulator;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a}),r();break}case"double-click":{const s=Jf(e),n=cT(s,e.pointerType,i.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r}),Z6(o,r);break}case"immediate-double-click":{const s=Jf(e),n=cT(s,e.pointerType,i.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r}),e.pointerType==="mouse"&&Z6(o,r);break}}this._onFocusChange(i.forEachTool)}_releaseManipulatorBeforeDragging(e,i,r){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:Jf(i)}),this._grabbedManipulators.forEach(({manipulator:s},n)=>{s===e&&this._grabbedManipulators.delete(n)}),this._afterManipulatorRelease(r.setActiveTool)}_handlePointerEnd(e,i){const r=this._grabbedManipulators.get(e.pointerId)?.manipulator;r!=null&&r.grabbing&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:Jf(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorRelease(i.setActiveTool))}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=Vue(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=Vue(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const i=new Set,r=new Set;this._grabbedManipulators.forEach(({tool:s})=>{i.add(s)}),this._hoveredManipulators.forEach(({tool:s})=>{r.add(s)}),e(s=>{s.hasGrabbedManipulators=i.has(s),s.hasHoveredManipulators=r.has(s);const n=this._grabbedManipulators.values(),o=CVe(n,({tool:a})=>a===s);s.firstGrabbedManipulator=o!=null?o.manipulator:null})}clearPointers(e,{forEachTool:i,setActiveTool:r},s=!0,n){const o=(a,l)=>a===e&&(n==null||n===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},h)=>{o(a,l)&&(this._grabbedManipulators.delete(h),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),s&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorRelease(r),this._onFocusChange(i)}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((i,r)=>{this._updateHoveredStateForPointerAtScreenPosition(wo(i.x,i.y),r,i.pointerType,e)})}handleHoverEvent(e,i){const r=e.type;r!=="pointer-up"&&r!=="immediate-click"&&r!=="pointer-move"||!jue(e.pointerType)||(r!=="pointer-up"&&this._externallyDragging?this._clearHoveredManipulatorStates(e.pointerId):this._updateHoveredStateForPointerAtScreenPosition(Jf(e),e.pointerId,e.pointerType,i))}_updateHoveredStateForPointerAtScreenPosition(e,i,r,s){let n=cT(e,r,s);const o=this._hoveredManipulators.get(i)?.manipulator;n==null||n.manipulator.interactive||(n=null),n!=null&&o===n.manipulator||(o!=null&&(o.hovering=!1),n!=null?(n.manipulator.hovering=!0,this._hoveredManipulators.set(i,n)):this._hoveredManipulators.delete(i),this._onFocusChange(s))}_afterManipulatorRelease(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}_clearHoveredManipulatorStates(e){this._hoveredManipulators.forEach(({manipulator:i},r)=>{e===r&&(this._hoveredManipulators.delete(e),i.hovering=!1)})}};function Vue(t){for(const{manipulator:e}of t.values())if(e!=null&&e.interactive){if(e.grabbing&&e.grabCursor)return e.grabCursor;if(e.cursor)return e.cursor}return null}function cT(t,e,i){let r=null;return i(s=>{if(s.manipulators==null||!JZ(s))return!1;const n=s.manipulators.intersect(t,e);return n!=null&&(r={tool:s,manipulator:n},!0)}),r}function jue(t){return t==="mouse"}function Gue(t){return t.pointerType!=="mouse"||t.button===0}function EKe(t){return!!t.native.shiftKey}function Z6(t,e){t?.consumesClicks&&e()}const Hue="attached",Y6="tools",CKe=1e3;let Xf=class extends ue{constructor(e){super(e),this._updatingHandles=new Hy,this._clock=pA,this._manipulatorState=new TKe,this.tools=new Ee,this.cursor=null,this._interacting=!1,this._interactingTimeout=CKe,this._interactingTimeoutHandle=null,this._forEachTool=i=>{for(const r of this.tools.items)if(i(r))return}}initialize(){this.addHandles([this.view.on(w$e,e=>{this._handleInputEvent(e)},Pm.TOOL),...SKe(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.activeTool=null,this.tools.drain(e=>e.destroy()),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void J.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const i=this.activeTool;this._set("activeTool",e),i?.deactivate(),e?.activate(),this._removeIncompleteTools(e);for(const r of this.tools){this._updateToolEditableFlag(r);const s=JZ(r);this.activeTool!=null&&s||this._manipulatorState.clearPointers(r,this._manipulatorStateEventArgs,!s)}this._updateCursor()}get updating(){return this._updatingHandles.updating||this.tools.some(e=>e.updating)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=Hi(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout(()=>this._interacting=!1,this._interactingTimeout)}attach(){this.view.type==="3d"?this.addHandles([H(()=>{const{state:e}=this.view;return"camera"in e&&e.camera},()=>this._forEachManipulator(e=>e.onViewChange())),this.view.elevationProvider?.on("elevation-change",e=>this._forEachManipulator(i=>i.onElevationChange(e)))],Hue):this.addHandles(H(()=>this.view.extent,()=>this._forEachManipulator(e=>e.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(Hue),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(i=>{i.manipulators&&i.manipulators.forEach(({manipulator:r})=>e(r,i))})}_handleInputEvent(e){let i=!1;const r={...e,stopPropagation:()=>{i=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(r):this._forEachTool(s=>{!i&&s.visible&&s.handleInputEvent(r)}),!i&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(r,this._manipulatorStateEventArgs),i||this.activeTool==null||this.activeTool.handleInputEventAfter(r),this._manipulatorState.handleHoverEvent(r,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles(Y6),this._forEachTool(e=>{if(e instanceof ue){const i=H(()=>[e.cursor,e.visible,e.editable],()=>{JZ(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.addHandles(i,Y6)}e.manipulators&&this.addHandles([e.manipulators.on("after-remove",i=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,i.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],Y6)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){e.setEditableFlag?.(VP.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(i=>!(i.cursor==null||!i.visible)&&(e=i.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(i=>(e==null||i!==e)&&!i.created&&i.removeIncompleteOnCancel).forEach(i=>{this.tools.remove(i)})}get test(){}};u([p({constructOnly:!0,nonNullable:!0})],Xf.prototype,"view",void 0),u([p({value:null})],Xf.prototype,"activeTool",null),u([p({readOnly:!0,type:Ee})],Xf.prototype,"tools",void 0),u([p({readOnly:!0})],Xf.prototype,"cursor",void 0),u([p({readOnly:!0})],Xf.prototype,"updating",null),u([p()],Xf.prototype,"_interacting",void 0),u([p({readOnly:!0})],Xf.prototype,"interacting",null),Xf=u([A("esri.views.ToolViewManager")],Xf);const $Ke=new qe("cyan"),AKe=1,MKe=.25,C$e=new qe("black"),$$e=.4,A$e=.2,OKe=.25,Dm="default",IKe="temporary",RKe=new qe("yellow"),PKe=8;var XZ;let Eu=XZ=class extends ue{constructor(t){super(t),this.name=Dm,this.color=$Ke.clone(),this.haloColor=null,this.haloOpacity=AKe,this.fillOpacity=MKe,this.shadowColor=C$e.clone(),this.shadowOpacity=$$e,this.shadowDifference=A$e,this.haloWidth=2.1,this.haloBlur=.8/this.haloWidth}equals(t){return this.color.equals(t.color)&&(this.haloColor||this.color).equals(t.haloColor||t.color)&&this.haloOpacity===t.haloOpacity&&this.fillOpacity===t.fillOpacity&&this.haloWidth===t.haloWidth&&this.haloBlur===t.haloBlur&&this.shadowColor.equals(t.shadowColor)&&this.shadowOpacity===t.shadowOpacity&&this.shadowDifference===t.shadowDifference}clone(){return new XZ({...this,color:this.color.clone(),haloColor:this.haloColor?.clone(),shadowColor:this.shadowColor?.clone()})}assignFrom(t){this.color=t.color.clone(),this.haloColor=t.haloColor?.clone(),this.haloOpacity=t.haloOpacity,this.fillOpacity=t.fillOpacity,this.shadowColor=t.shadowColor.clone(),this.shadowDifference=t.shadowDifference,this.shadowOpacity=t.shadowOpacity,this.haloBlur=t.haloBlur,this.haloWidth=t.haloWidth}};u([p({type:String,constructOnly:!0,nonNullable:!0})],Eu.prototype,"name",void 0),u([p({type:qe,nonNullable:!0})],Eu.prototype,"color",void 0),u([p({type:qe})],Eu.prototype,"haloColor",void 0),u([p({nonNullable:!0})],Eu.prototype,"haloOpacity",void 0),u([p({nonNullable:!0})],Eu.prototype,"fillOpacity",void 0),u([p({type:qe,nonNullable:!0})],Eu.prototype,"shadowColor",void 0),u([p({nonNullable:!0})],Eu.prototype,"shadowOpacity",void 0),u([p({nonNullable:!0})],Eu.prototype,"shadowDifference",void 0),u([p({nonNullable:!0})],Eu.prototype,"haloWidth",void 0),u([p({nonNullable:!0})],Eu.prototype,"haloBlur",void 0),Eu=XZ=u([A("esri.views.support.HighlightOptions")],Eu);const Lm=Eu;function DKe(){return new(Ee.ofType(Lm))([new Lm({name:Dm}),new Lm({name:IKe,color:RKe})])}let EE=class extends ue{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":LKe.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return NKe[this.deviceType]}};u([p({nonNullable:!0,readOnly:!0})],EE.prototype,"nativeIndex",void 0),u([p({type:String,readOnly:!0})],EE.prototype,"deviceType",null),u([p({type:Number,readOnly:!0})],EE.prototype,"axisThreshold",null),EE=u([A("esri.views.input.gamepad.GamepadInputDevice")],EE);const vie=EE,LKe=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),NKe={standard:.15,spacemouse:.025,unknown:0};let WO=class extends ue{constructor(...e){super(...e),this.devices=new Ee,this.enabledFocusMode="document"}};u([p({type:Ee.ofType(vie),readOnly:!0})],WO.prototype,"devices",void 0),u([p({type:["document","view","none"]})],WO.prototype,"enabledFocusMode",void 0),WO=u([A("esri.views.input.gamepad.GamepadSettings")],WO);const FKe=WO;let g4=class extends ue{constructor(){super(...arguments),this.gamepad=new FKe}};u([p({readOnly:!0})],g4.prototype,"gamepad",void 0),g4=u([A("esri.views.input.Input")],g4);const kKe=g4,M$e=()=>Ir.respectPrefersReducedMotion&&window.matchMedia("(prefers-reduced-motion: reduce)").matches,J6=()=>p({type:["pan","rotate","zoom","none"],nonNullable:!0});let c1=class extends ue{constructor(e){super(e),this.dragPrimary="pan",this.dragSecondary="rotate",this.dragTertiary="zoom",this.mouseWheel="zoom"}};u([J6()],c1.prototype,"dragPrimary",void 0),u([J6()],c1.prototype,"dragSecondary",void 0),u([J6()],c1.prototype,"dragTertiary",void 0),u([p({type:["zoom","none"],nonNullable:!0})],c1.prototype,"mouseWheel",void 0),c1=u([A("esri.views.navigation.NavigationActionMap")],c1);const _ie=c1;let z0=class extends ue{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};u([p({type:Boolean,nonNullable:!0})],z0.prototype,"enabled",void 0),u([p({type:vie})],z0.prototype,"device",void 0),u([p({type:["pan","zoom"],nonNullable:!0})],z0.prototype,"mode",void 0),u([p({type:["forward-down","forward-up"],nonNullable:!0})],z0.prototype,"tiltDirection",void 0),u([p({type:Number,nonNullable:!0})],z0.prototype,"velocityFactor",void 0),z0=u([A("esri.views.navigation.gamepad.GamepadSettings")],z0);const O$e=z0;let U0=class extends ue{constructor(e){super(e),this.actionMap=new _ie,this.browserTouchPanEnabled=!0,this.gamepad=new O$e,this.momentumEnabled=!0}get effectiveMomentumEnabled(){return this.momentumEnabled&&!M$e()}get mouseWheelZoomEnabled(){return this.actionMap.mouseWheel==="zoom"}set mouseWheelZoomEnabled(e){TVe(J.getLogger(this),"mouseWheelZoomEnabled",{replacement:"actionMap.mouseWheel",version:"4.32",warnOnce:!0}),this.actionMap.mouseWheel=e?"zoom":"none"}};u([p({type:_ie,nonNullable:!0})],U0.prototype,"actionMap",void 0),u([p({type:Boolean})],U0.prototype,"browserTouchPanEnabled",void 0),u([p({type:O$e,nonNullable:!0})],U0.prototype,"gamepad",void 0),u([p({type:Boolean})],U0.prototype,"momentumEnabled",void 0),u([p({type:Boolean})],U0.prototype,"mouseWheelZoomEnabled",null),U0=u([A("esri.views.navigation.Navigation")],U0);const nj=U0;function zKe(t,e){if(!t)return null;if(!KZ(t))return new U("webscene:unsupported-height-model-info","The vertical coordinate system of the scene is not supported",{heightModelInfo:t});const i=t.heightUnit,r=Bb.deriveUnitFromSR(t,e).heightUnit;return i!==r?new U("webscene:incompatible-height-unit",`The vertical units of the scene (${i}) must match the horizontal units of the scene (${r})`,{verticalUnit:i,horizontalUnit:r}):null}function w7t(t,e,i){const r=I$e(t),s=e,n=UKe(r,s,i);if(r){const o=Bb.deriveUnitFromSR(r,t.spatialReference).heightUnit;if(!i&&o!==r.heightUnit){const a=new U("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new U("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r,error:a})}}if(!BKe(t)||n===Fc.Unsupported)return new U("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r});switch(n){case Fc.Units:{const o=r?.heightUnit||"unknown",a=s?.heightUnit||"unknown",l=new U("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new U("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case Fc.HeightModel:{const o=r?.heightModel||"unknown",a=s?.heightModel||"unknown",l=new U("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new U("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case Fc.CRS:{const o=r?.vertCRS||"unknown",a=s?.vertCRS||"unknown",l=new U("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new U("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}}return null}function UKe(t,e,i){if(!KZ(t)||!KZ(e))return Fc.Unsupported;if(t==null||e==null)return Fc.Ok;if(!i&&t.heightUnit!==e.heightUnit)return Fc.Units;if(t.heightModel!==e.heightModel)return Fc.HeightModel;switch(t.heightModel){case"gravity-related-height":return Fc.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?Fc.Ok:Fc.CRS;default:return Fc.Unsupported}}var Fc;function KZ(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function BKe(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!D$e(t)}function I$e(t){if(t.type==="integrated-mesh-3dtiles")return null;const e=t.url?gb(t.url):void 0;return!(t.spatialReference?.vcsWkid==null&&e!=null&&e.serverType==="ImageServer")&&R$e(t)&&t.heightModelInfo?t.heightModelInfo:D$e(t)?Bb.deriveUnitFromSR(jKe,t.spatialReference):null}function R$e(t){return"heightModelInfo"in t}function P$e(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function D$e(t){return P$e(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):L$e(t)}function VKe(t){return t.layers!=null||L$e(t)||P$e(t)||R$e(t)}function L$e(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"integrated-mesh-3dtiles":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"catalog":case"catalog-footprint":case"catalog-dynamic-group":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"parquet":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"viewshed":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(Fc||(Fc={}));const jKe=new Bb({heightModel:"gravity-related-height"});var Be;function QZ(t){return t==="global"?Be.Global:Be.Local}function $R(t){return t===Be.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})(Be||(Be={}));let eY,X6=null;async function GKe(t){X6||(X6=V(()=>import("./geometryServiceUtils-DDNHyfMa.js"),[]).then(e=>eY=e)),await X6,gt(t)}async function N$e(t,e,i,r){if(!t)return null;const s=t.spatialReference;return $v()||ru(s,e)?Id(t,e):eY?eY.projectGeometry(t,e,i,r):(await Promise.race([GKe(r),nv(r)]),N$e(t,e,i,r))}let as=class extends ue{constructor(e){super(e),this.required={extent:!1,heightModelInfo:!1,tileInfo:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=hc(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference??this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){const e=this.map?.(),i=[];return this.priorityCollection!=null&&i.push(this.priorityCollection),i.push({parent:e?.basemap,layers:e?.basemap?.baseLayers},{layers:e?.layers},{parent:e?.ground,layers:e?.ground?.layers},{parent:e?.basemap,layers:e?.basemap?.referenceLayers}),i}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};let e;if(this._collectLayers(this.mapCollections,r=>{const s=this._getSupportedSpatialReferences(r);if(s.length>0){const n=this._narrowDownSpatialReferenceCandidates(e,s);n!=null&&(e=n)}return e?.length===1})&&e?.length!==1)return{updating:!0};const i=this._pickSpatialReferenceCandidate(e);return{spatialReference:i?.spatialReference??null,viewingMode:i?.viewingMode??null,updating:!1}}get _tileInfoTask(){if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};const e=this.map?.(),i=this.spatialReference;if(!i)return{updating:this._spatialReferenceTask.updating};let r;const s=this._collectLayers([{parent:e?.basemap,layers:e?.basemap?.baseLayers},{layers:e?.layers}],n=>!(!("tileInfo"in n)||!n.tileInfo?.spatialReference.equals(i))&&(r=n,!0),n=>"tileInfo"in n);return r?{tileInfo:r.tileInfo,updating:!1}:{updating:s}}get _heightModelInfoTask(){if(!this.required.heightModelInfo||this.suspended&&this._get("_heightModelInfoTask")?.heightModelInfo)return this._get("_heightModelInfoTask")??{updating:!1};let e={};const i=this._collectLayers(this.mapCollections,r=>{const s=I$e(r);return!!s&&(e={heightModelInfo:s,vcsWkid:r.spatialReference?.vcsWkid,latestVcsWkid:r.spatialReference?.latestVcsWkid},!0)},r=>VKe(r));return{...e,updating:i}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=[],i=this._collectLayers(this.mapCollections,r=>{const s="fullExtents"in r&&r.fullExtents||(r.fullExtent!=null?[r.fullExtent]:[]),n=this.requiresExtentInSpatialReference?null:s[0],o=s.find(a=>a.spatialReference.equals(this.spatialReference))??n;if(o)return e.push({extent:o,layer:r}),!0;if(this._getSupportedSpatialReferences(r).length>0)for(const a of s)e.push({extent:a,layer:r});return!1});return{candidates:e,updating:i}}get _extentTask(){const{candidates:e,updating:i}=this._extentCandidatesTask;if(i)return{updating:i};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const r=this._pickExtentCandidate(e),s=this.spatialReference;return r.extent.equals(this._projectExtentTask.input)&&s.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=hc(this._projectExtentTask.task)),this._projectExtentTask={input:r.extent.clone(),output:null,spatialReference:s.clone(),task:ag(async n=>{try{const o=await N$e(r.extent,s,"portalItem"in r.layer?r.layer.portalItem:void 0,n);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(wa(n))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,i){if(e==null)return i;const r=new Array;for(const s of e)for(const n of i){if(!s.spatialReference.equals(n.spatialReference))continue;const o=qKe(s.viewingMode,n.viewingMode);if(o!==!1){r.push({spatialReference:s.spatialReference,viewingMode:o});break}}return r.length>0?r:null}_pickSpatialReferenceCandidate(e){const i=this.defaultSpatialReference;return e==null||e.length<1?i?{spatialReference:i,viewingMode:null}:null:(i!=null&&e.length>1&&e.some(({spatialReference:r})=>r.equals(i))&&(e=e.filter(({spatialReference:r})=>r.equals(i))),e.length>1&&e.some(({viewingMode:r})=>r!==Be.Local)&&(e=e.filter(({viewingMode:r})=>r!==Be.Local)),e[0])}_getSupportedSpatialReferences(e){const i="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(i.length===0)return[];const r=[];for(const s of i){const n=this.getSpatialReferenceSupport(s,e);if(n!=null){const o=n.constraints??[{spatialReference:s,viewingMode:null}];for(const{spatialReference:a,viewingMode:l}of o)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!a.equals(this.userSpatialReference)||r.push({spatialReference:a,viewingMode:l})}}return r}_pickExtentCandidate(e){const i=this.spatialReference;return e.find(({extent:r})=>i.equals(r.spatialReference))||e[0]}_collectLayers(e,i,r=()=>!0){switch(this._loadMaybe(this.map?.())){case"loading":return!0;case"failed":return!1}const s=new HKe(r,i);for(const n of e)if(this._collectCollection(n,s),s.done||s.preloading===this.sourcePreloadCount)break;return s.updating}_collectCollection(e,i){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return i.updating=!0,void++i.preloading;case"failed":return}for(const r of e.layers)if(i.layerFilter(r)){switch(this._loadMaybe(r)){case"failed":continue;case"loading":i.updating=!0,++i.preloading;break;case"loaded":if(i.updating||(i.done=i.pushLayer(r)),i.done||i.preloading===this.sourcePreloadCount)break;"layers"in r&&this._collectCollection({layers:r.layers},i)}if(i.done||i.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(i=>{Xr(i)}),"loading"):e.loadStatus:"loaded"}};u([p()],as.prototype,"required",void 0),u([p({constructOnly:!0})],as.prototype,"map",void 0),u([p({constructOnly:!0})],as.prototype,"getSpatialReferenceSupport",void 0),u([p()],as.prototype,"defaultSpatialReference",void 0),u([p()],as.prototype,"userSpatialReference",void 0),u([p()],as.prototype,"sourcePreloadCount",void 0),u([p()],as.prototype,"priorityCollection",void 0),u([p()],as.prototype,"requiresExtentInSpatialReference",void 0),u([p()],as.prototype,"suspended",void 0),u([p({readOnly:!0})],as.prototype,"ready",null),u([p({readOnly:!0})],as.prototype,"heightModelInfoReady",null),u([p({readOnly:!0})],as.prototype,"spatialReference",null),u([p({readOnly:!0})],as.prototype,"extent",null),u([p({readOnly:!0})],as.prototype,"heightModelInfo",null),u([p({readOnly:!0})],as.prototype,"vcsWkid",null),u([p({readOnly:!0})],as.prototype,"latestVcsWkid",null),u([p({readOnly:!0})],as.prototype,"viewingMode",null),u([p({readOnly:!0})],as.prototype,"tileInfo",null),u([p({readOnly:!0})],as.prototype,"mapCollections",null),u([p({readOnly:!0})],as.prototype,"_spatialReferenceTask",null),u([p({readOnly:!0})],as.prototype,"_tileInfoTask",null),u([p({readOnly:!0})],as.prototype,"_heightModelInfoTask",null),u([p({readOnly:!0})],as.prototype,"_extentCandidatesTask",null),u([p()],as.prototype,"_extentTask",null),u([p()],as.prototype,"_projectExtentTask",void 0),as=u([A("esri.views.support.DefaultsFromMap")],as);let HKe=class{constructor(e,i){this.layerFilter=e,this.pushLayer=i,this.preloading=-1,this.updating=!1,this.done=!1}};function qKe(t,e){return t!=null?e!=null?t===e&&t:t:e}let CE=class extends ue{constructor(e){super(e),this.featureTitleFields=!1,this.utilityNetworkFields=!1,this.globalIdField=!1}};u([p()],CE.prototype,"featureTitleFields",void 0),u([p()],CE.prototype,"utilityNetworkFields",void 0),u([p()],CE.prototype,"globalIdField",void 0),CE=u([A("esri.views.support.RequiredFieldsOptions")],CE);const WKe=CE;var ZO;let ht=ZO=class extends ws.EventedMixin(Ub.EsriPromiseMixin(ue)){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.handles=new ng,this.updatingHandles=new Hy,this.allLayerViews=new h$({getCollections:()=>[this.basemapView?.baseLayerViews,this.groundView?.layerViews,this.layerViews,this.basemapView?.referenceLayerViews],getChildrenFunction:ZKe}),this.groundView=null,this.basemapView=null,this.displayFilterEnabled=!0,this.fatalError=null,this.graphics=new CR,this.analyses=new x$,this.typeSpecificPreconditionsReady=!0,this.layerViews=new Ee,this.magnifier=new g$e,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this._readyStateWaitingTask=null,this.supportsGround=!0,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new kKe,this.navigation=new nj,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new T$e(this),this.persistableViewModels=new Ee,this.requiredFieldsOptions=new WKe,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this._userTimeExtent=null,this._lockedTimeExtent=null,this.theme=null,this.handles.add(H(()=>this.preconditionsReady,e=>{const i=this.ready;if(e?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,this._lockedTimeExtent=this.timeExtent,ZO.views.add(this)):(this._lockedSpatialReference=null,ZO.views.remove(this)),this.notifyChange("spatialReference"),!e&&i)this.toolViewManager?.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),this.layerViewManager?.clear(),this._teardown();else if(e&&!i){try{this._startup()}catch(r){return void queueMicrotask(()=>{this.fatalError=new U("startup-error",null,r)})}this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach()}},Gt))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this.validate()]).then(()=>(this._isValid=!0,Cd(()=>this.ready)))),this.basemapView=new qXe({view:this}),this.layerViewManager=new JXe({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new Xf({view:this}),this.selectionManager=new lKe({view:this}),this.addHandles([gn(()=>this.readyState==="map-content-error"&&!this.spatialReference,()=>{J.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),H(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},St),H(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},Gt),H(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},St)])}destroy(){this.destroyed||(ZO.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=Ce(this.graphics),this.analyses=Ce(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),Ce(this.analysisViewManager),this.toolViewManager=Ce(this.toolViewManager),this.layerViewManager=Ce(this.layerViewManager),this.selectionManager=Ce(this.selectionManager),this.basemapView=Ce(this.basemapView),this.groundView?.destroy(),this.layerViews?.forEach(t=>t.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.destroy(),this.map=Ce(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return J.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){return this.toolViewManager?.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new as({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:(t,e)=>this.getSpatialReferenceSupport(t,e),...this.defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get highlights(){return this._get("highlights")??DKe()}set highlights(t){this._set("highlights",df(t,this._get("highlights"),Ee.ofType(Lm)))}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||$l.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!this.defaultsFromMap?.ready||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t?.destroyed&&(J.getLogger(this).warn("#map","The provided map is already destroyed",{map:t}),t=null),$l.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",t))}get readyState(){if(this.destroyed)return this._get("readyState");if(!this.map)return"missing-map";if("container"in this&&!this.container)return"missing-container";if(this.fatalError)return"rendering-error";if((this.defaultsFromMap?.ready??!1)&&!this.spatialReference){const t=!("loaded"in this.map)||this.map.loaded,e=this.map.ground.loaded,i=this.map.basemap?.loaded??!0;return t&&i&&e&&!this.map?.allLayers.length?"empty-map":(this._readyStateWaitingTask||(this._readyStateWaitingTask=ag(r=>Pee(X("view-readyState-waiting-delay"),null,r)),this.addHandles(this._readyStateWaitingTask),this.addHandles(this._readyStateWaitingTask,"ready-state-task")),this._readyStateWaitingTask?.finished?"map-content-error":"loading")}return this._readyStateWaitingTask=hc(this._readyStateWaitingTask),this.removeHandles("ready-state-task"),this.ready?"ready":"loading"}get spatialReference(){const t=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;if(t&&this.defaultsFromMap?.required?.heightModelInfo){const e=t.clone();return e.vcsWkid=this.defaultsFromMap.vcsWkid,e.latestVcsWkid=this.defaultsFromMap.latestVcsWkid,e}return t}set spatialReference(t){const e=!rs(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeExtent(){return this._userTimeExtent??this._lockedTimeExtent??this.getDefaultTimeExtent()??null}set timeExtent(t){this._userTimeExtent=t}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??cf}set timeZone(t){this._userTimeZone=t,t9e(t)||J.getLogger(this).warn("#timeZone",`the parsed value '${t}' may not be a valid IANA time zone`)}get tools(){return this.toolViewManager?.tools}get initialExtent(){return this.defaultsFromMap?.extent}get cursor(){return this.toolViewManager?.cursor??this._cursor??"default"}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new YZ}whenLayerView(t){return this.layerViewManager?.whenLayerView(t)??Promise.reject()}getDefaultSpatialReference(){return this.defaultsFromMap?.spatialReference}getDefaultHeightModelInfo(){return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??this.defaultsFromMap?.heightModelInfo??null}getDefaultTimeZone(){return null}getDefaultTimeExtent(){return null}importLayerView(t){throw new U("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}async loadAsyncDependencies(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return this.getSpatialReferenceSupport(t)!=null}when(t,e){return this.isResolved()&&!this.ready&&J.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(gn(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};ht.views=new Ee,u([p()],ht.prototype,"_userSpatialReference",void 0),u([p()],ht.prototype,"activeTool",null),u([p({readOnly:!0})],ht.prototype,"allLayerViews",void 0),u([p()],ht.prototype,"groundView",void 0),u([p()],ht.prototype,"animation",null),u([p()],ht.prototype,"basemapView",void 0),u([p()],ht.prototype,"center",null),u([p()],ht.prototype,"defaultsFromMapSettings",null),u([p()],ht.prototype,"defaultsFromMap",null),u([p()],ht.prototype,"displayFilterEnabled",void 0),u([p()],ht.prototype,"fatalError",void 0),u([p({type:gi})],ht.prototype,"extent",null),u([p($W(CR,"graphics"))],ht.prototype,"graphics",void 0),u([p($W(x$,"analyses"))],ht.prototype,"analyses",void 0),u([p({readOnly:!0,type:Bb})],ht.prototype,"heightModelInfo",null),u([p({type:Ee.ofType(Lm)})],ht.prototype,"highlights",null),u([p({readOnly:!0})],ht.prototype,"interacting",null),u([p({readOnly:!0})],ht.prototype,"navigating",null),u([p({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],ht.prototype,"preconditionsReady",null),u([p({readOnly:!0})],ht.prototype,"typeSpecificPreconditionsReady",void 0),u([p({type:Ee,readOnly:!0})],ht.prototype,"layerViews",void 0),u([p()],ht.prototype,"resolution",null),u([p({type:g$e})],ht.prototype,"magnifier",void 0),u([p({value:null,type:Xte})],ht.prototype,"map",null),u([p()],ht.prototype,"padding",void 0),u([p({readOnly:!0})],ht.prototype,"ready",void 0),u([p()],ht.prototype,"_readyStateWaitingTask",void 0),u([p({readOnly:!0})],ht.prototype,"readyState",null),u([p({type:Ae})],ht.prototype,"spatialReference",null),u([p()],ht.prototype,"stationary",null),u([p({readOnly:!0})],ht.prototype,"supportsGround",void 0),u([p({type:To})],ht.prototype,"timeExtent",null),u([p({type:String,nonNullable:!0})],ht.prototype,"timeZone",null),u([p()],ht.prototype,"tools",null),u([p()],ht.prototype,"toolViewManager",void 0),u([p({readOnly:!0})],ht.prototype,"type",void 0),u([p({type:Number})],ht.prototype,"scale",void 0),u([p({readOnly:!0})],ht.prototype,"updating",void 0),u([p({readOnly:!0})],ht.prototype,"initialExtentRequired",void 0),u([p({readOnly:!0})],ht.prototype,"initialExtent",null),u([p()],ht.prototype,"cursor",null),u([p({readOnly:!0})],ht.prototype,"input",void 0),u([p({type:nj,nonNullable:!0})],ht.prototype,"navigation",void 0),u([p()],ht.prototype,"layerViewManager",void 0),u([p()],ht.prototype,"analysisViewManager",void 0),u([p()],ht.prototype,"selectionManager",void 0),u([p()],ht.prototype,"width",void 0),u([p()],ht.prototype,"height",void 0),u([p({readOnly:!0})],ht.prototype,"resizing",void 0),u([p({value:null,readOnly:!0})],ht.prototype,"size",null),u([p({readOnly:!0})],ht.prototype,"suspended",void 0),u([p({readOnly:!0})],ht.prototype,"viewEvents",void 0),u([p({readOnly:!0})],ht.prototype,"persistableViewModels",void 0),u([p()],ht.prototype,"_isValid",void 0),u([p()],ht.prototype,"_readyCycleForced",void 0),u([p()],ht.prototype,"_lockedSpatialReference",void 0),u([p()],ht.prototype,"_userTimeZone",void 0),u([p()],ht.prototype,"_lockedTimeZone",void 0),u([p()],ht.prototype,"_userTimeExtent",void 0),u([p()],ht.prototype,"_lockedTimeExtent",void 0),u([p({type:YZ})],ht.prototype,"theme",void 0),u([p({readOnly:!0,type:YZ})],ht.prototype,"effectiveTheme",null),ht=ZO=u([A("esri.views.View")],ht);const K6=globalThis.$arcgis;K6&&!K6.views&&Object.defineProperty(K6,"views",{configurable:!1,enumerable:!0,writable:!1,value:ht.views});const F$e=ht;function ZKe(t){return t.layerViews}function zn(t,e){return t[0]=e[0],t[1]=e[1],t}function li(t,e,i){return t[0]=e,t[1]=i,t}function wy(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function cd(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function k$e(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function z$e(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function YKe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function JKe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function XKe(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t}function KKe(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t}function QKe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function ud(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function eQe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t}function lv(t,e){const i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)}function C$(t,e){const i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r}function uU(t){const e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}function U$e(t){const e=t[0],i=t[1];return e*e+i*i}function bie(t,e){return t[0]=-e[0],t[1]=-e[1],t}function tQe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function jP(t,e){const i=e[0],r=e[1];let s=i*i+r*r;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s),t}function Bo(t,e){return t[0]*e[0]+t[1]*e[1]}function B$e(t,e,i){const r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t}function Kh(t,e,i,r){const s=e[0],n=e[1];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t}function iQe(t,e=1){const i=2*dD()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t}function rQe(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[2]*s,t[1]=i[1]*r+i[3]*s,t}function ym(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[2]*s+i[4],t[1]=i[1]*r+i[3]*s+i[5],t}function sQe(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[3]*s+i[6],t[1]=i[1]*r+i[4]*s+i[7],t}function nQe(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[4]*s+i[12],t[1]=i[1]*r+i[5]*s+i[13],t}function V$e(t,e,i,r){const s=e[0]-i[0],n=e[1]-i[1],o=Math.sin(r),a=Math.cos(r);return t[0]=s*a-n*o+i[0],t[1]=s*o+n*a+i[1],t}function oQe(t,e){const i=t[0],r=t[1],s=e[0],n=e[1];let o=i*i+r*r;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(i*s+r*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function aQe(t){return"vec2("+t[0]+", "+t[1]+")"}function j$e(t,e){return t[0]===e[0]&&t[1]===e[1]}function oj(t,e){const i=t[0],r=t[1],s=e[0],n=e[1],o=So();return Math.abs(i-s)<=o*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-n)<=o*Math.max(1,Math.abs(r),Math.abs(n))}function lQe(t,e,i,r,s){let n=e[0]-i[0],o=e[1]-i[1];const a=(r[0]*n+r[1]*o)*(s-1);return n=r[0]*a,o=r[1]*a,t[0]=e[0]+n,t[1]=e[1]+o,t}const cQe=uU,wie=cd,uQe=k$e,hQe=z$e,dQe=lv,pQe=C$,fQe=U$e;Object.freeze(Object.defineProperty({__proto__:null,add:wy,angle:oQe,ceil:YKe,copy:zn,cross:B$e,dist:dQe,distance:lv,div:hQe,divide:z$e,dot:Bo,equals:oj,exactEquals:j$e,floor:JKe,inverse:tQe,len:cQe,length:uU,lerp:Kh,max:KKe,min:XKe,mul:uQe,multiply:k$e,negate:bie,normalize:jP,projectAndScale:lQe,random:iQe,rotate:V$e,round:QKe,scale:ud,scaleAndAdd:eQe,set:li,sqrDist:pQe,sqrLen:fQe,squaredDistance:C$,squaredLength:U$e,str:aQe,sub:wie,subtract:cd,transformMat2:rQe,transformMat2d:ym,transformMat3:sQe,transformMat4:nQe},Symbol.toStringTag,{value:"Module"}));function He(){return[0,0]}function hU(t){return[t[0],t[1]]}function un(t,e){return[t,e]}function mQe(t,e){return[t,e]}function gQe(t,e=He()){const i=Math.min(2,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function yQe(t,e){return new Float64Array(t,e,2)}function xie(){return He()}function G$e(){return un(1,1)}function H$e(){return un(1,0)}function q$e(){return un(0,1)}const rS=xie(),W$e=G$e(),vQe=H$e(),_Qe=q$e();Object.freeze(Object.defineProperty({__proto__:null,ONES:W$e,UNIT_X:vQe,UNIT_Y:_Qe,ZEROS:rS,clone:hU,create:He,createView:yQe,freeze:mQe,fromArray:gQe,fromValues:un,ones:G$e,unitX:H$e,unitY:q$e,zeros:xie},Symbol.toStringTag,{value:"Module"}));function bQe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function wQe(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function xQe(t,e,i,r,s,n,o){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=o,t}function Sie(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5];let l=i*n-r*s;return l?(l=1/l,t[0]=n*l,t[1]=-r*l,t[2]=-s*l,t[3]=i*l,t[4]=(s*a-n*o)*l,t[5]=(r*o-i*a)*l,t):null}function SQe(t){return t[0]*t[3]-t[1]*t[2]}function Z$e(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=i[0],h=i[1],d=i[2],f=i[3],m=i[4],y=i[5];return t[0]=r*c+n*h,t[1]=s*c+o*h,t[2]=r*d+n*f,t[3]=s*d+o*f,t[4]=r*m+n*y+a,t[5]=s*m+o*y+l,t}function aj(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=Math.sin(i),h=Math.cos(i);return t[0]=r*h+n*c,t[1]=s*h+o*c,t[2]=r*-c+n*h,t[3]=s*-c+o*h,t[4]=a,t[5]=l,t}function Tie(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=i[0],h=i[1];return t[0]=r*c,t[1]=s*c,t[2]=n*h,t[3]=o*h,t[4]=a,t[5]=l,t}function GP(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=i[0],h=i[1];return t[0]=r,t[1]=s,t[2]=n,t[3]=o,t[4]=r*c+n*h+a,t[5]=s*c+o*h+l,t}function Y$e(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t[4]=0,t[5]=0,t}function J$e(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function Eie(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function TQe(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function EQe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function CQe(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t}function X$e(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}function $Qe(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t}function AQe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t}function MQe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function OQe(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=e[0],c=e[1],h=e[2],d=e[3],f=e[4],m=e[5],y=So();return Math.abs(i-l)<=y*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-c)<=y*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(s-h)<=y*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(n-d)<=y*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(o-f)<=y*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-m)<=y*Math.max(1,Math.abs(a),Math.abs(m))}const IQe=Z$e,RQe=X$e;Object.freeze(Object.defineProperty({__proto__:null,add:CQe,copy:bQe,determinant:SQe,equals:OQe,exactEquals:MQe,frob:EQe,fromRotation:Y$e,fromScaling:J$e,fromTranslation:Eie,identity:wQe,invert:Sie,mul:IQe,multiply:Z$e,multiplyScalar:$Qe,multiplyScalarAndAdd:AQe,rotate:aj,scale:Tie,set:xQe,str:TQe,sub:RQe,subtract:X$e,translate:GP},Symbol.toStringTag,{value:"Module"}));function Wy(){return[1,0,0,1,0,0]}function PQe(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function DQe(t,e,i,r,s,n){return[t,e,i,r,s,n]}function LQe(t,e){return new Float64Array(t,e,6)}const NQe=Wy();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:NQe,clone:PQe,create:Wy,createView:LQe,fromValues:DQe},Symbol.toStringTag,{value:"Module"}));const GL={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new fd({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:Ae.WebMercator}),minus180Line:new fd({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:Ae.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new fd({paths:[[[180,-180],[180,180]]],spatialReference:Ae.WGS84}),minus180Line:new fd({paths:[[[-180,-180],[-180,180]]],spatialReference:Ae.WGS84})}};function fx(t,e){return Math.ceil((t-e)/(2*e))}function K$e(t,e){const i=AR(t);for(const r of i)for(const s of r)s[0]+=e;return t}function AR(t){return nb(t)?t.rings:t.paths}function FQe(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function Q$e(t){return typeof t=="string"?pn(t):q(t)}function kQe(t,e,i){const r={};for(const s in t){if(s==="declaredClass")continue;const n=t[s];if(n!=null&&typeof n!="function")if(Array.isArray(n))r[s]=n.map(o=>kQe(o));else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(i?.[s]);r[s]=e?o:JSON.stringify(o)}else r[s]=e?n:JSON.stringify(n);else r[s]=n}return r}async function zQe(t,e,i,r){const s=Q$e(t),n=e[0].spatialReference,o={...r,responseType:"json",query:{...s.query,f:"json",sr:zz(n),target:JSON.stringify({geometryType:iD(e[0]),geometries:e}),cutter:JSON.stringify(i)}},a=await Ci(s.path+"/cut",o),{cutIndexes:l,geometries:c=[]}=a.data;return{cutIndexes:l,geometries:c.map(h=>{const d=af(h);return d.spatialReference=n,d})}}function UQe(t){return{geometryType:iD(t[0]),geometries:t.map(e=>e.toJSON())}}function eAe(t,e,i){const r=wHe(e);return t.map(s=>{const n=r.fromJSON(s);return n.spatialReference=i,n})}async function BQe(t,e,i){const r=typeof t=="string"?pn(t):t,s=e[0].spatialReference,n=iD(e[0]),o={...i,query:{...r.query,f:"json",sr:zz(s),geometries:JSON.stringify(UQe(e))}},{data:a}=await Ci(r.path+"/simplify",o);return eAe(a.geometries,n,s)}const tAe=()=>J.getLogger("esri.geometry.support.normalizeUtils");function VQe(t){return t.type==="polygon"}function jQe(t){return t[0].type==="polygon"}function GQe(t){return t[0].type==="polyline"}function que(t){const e=[];let i=0,r=0;for(let s=0;s<t.length;s++){const n=t[s];let o=null;for(let a=0;a<n.length;a++)o=n[a],e.push(o),a===0?(i=o[0],r=i):(i=Math.min(i,o[0]),r=Math.max(r,o[0]));o&&e.push([(i+r)/2,0])}return e}function HQe(t,e){if(!(t instanceof fd||t instanceof Sa)){const s="straightLineDensify: the input geometry is neither polyline nor polygon";throw tAe().error(s),new U(s)}const i=AR(t),r=[];for(const s of i){const n=[];r.push(n),n.push([s[0][0],s[0][1]]);for(let o=0;o<s.length-1;o++){const a=s[o][0],l=s[o][1],c=s[o+1][0],h=s[o+1][1],d=Math.sqrt((c-a)*(c-a)+(h-l)*(h-l)),f=(h-l)/d,m=(c-a)/d,y=d/e;if(y>1){for(let w=1;w<=y-1;w++){const x=w*e,S=m*x+a,C=f*x+l;n.push([S,C])}const v=(d+Math.floor(y-1)*e)/2,_=m*v+a,b=f*v+l;n.push([_,b])}n.push([c,h])}}return VQe(t)?new Sa({rings:r,spatialReference:t.spatialReference}):new fd({paths:r,spatialReference:t.spatialReference})}function Wue(t,e,i){if(e){const r=HQe(t,1e6);t=ux(r,!0)}return i&&(t=K$e(t,i)),t}function Zue(t,e,i){if(Array.isArray(t)){const r=t[0];if(r>e){const s=fx(r,e);t[0]=r+s*(-2*e)}else if(r<i){const s=fx(r,i);t[0]=r+s*(-2*i)}}else{const r=t.x;if(r>e){const s=fx(r,e);t=t.clone().offset(s*(-2*e),0)}else if(r<i){const s=fx(r,i);t=t.clone().offset(s*(-2*i),0)}}return t}function qQe(t,e){let i=-1;for(let r=0;r<e.cutIndexes.length;r++){const s=e.cutIndexes[r],n=e.geometries[r],o=AR(n);for(let a=0;a<o.length;a++){const l=o[a];l.some(c=>{if(c[0]<180)return!0;{let h=0;for(let f=0;f<l.length;f++){const m=l[f][0];h=m>h?m:h}h=Number(h.toFixed(9));const d=-360*fx(h,180);for(let f=0;f<l.length;f++){const m=n.getPoint(a,f);n.setPoint(a,f,m.clone().offset(d,0))}return!0}})}if(s===i){if(jQe(t))for(const a of AR(n))t[s]=t[s].addRing(a);else if(GQe(t))for(const a of AR(n))t[s]=t[s].addPath(a)}else i=s,t[s]=n}return t}async function WQe(t,e,i){if(!Array.isArray(t))return WQe([t],e);e&&typeof e!="string"&&tAe().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const r=typeof e=="string"?e:e?.url??Ir.geometryServiceUrl;let s,n,o,a,l,c,h,d,f=0;const m=[],y=[];for(const S of t)if(S!=null)if(s||(s=S.spatialReference,n=lc(s),o=s.isWebMercator,c=o?102100:4326,a=GL[c].maxX,l=GL[c].minX,h=GL[c].plus180Line,d=GL[c].minus180Line),n)if(S.type==="mesh")y.push(S);else if(S.type==="point")y.push(Zue(S.clone(),a,l));else if(S.type==="multipoint"){const C=S.clone();C.points=C.points.map(T=>Zue(T,a,l)),y.push(C)}else if(S.type==="extent"){const C=S.clone()._normalize(!1,!1,n);y.push(C.rings?new Sa(C):C)}else if(S.extent){const C=S.extent,T=fx(C.xmin,l)*(2*a);let M=T===0?S.clone():K$e(S.clone(),T);C.offset(T,0);let{xmin:I,xmax:P}=C;I=Number(I.toFixed(9)),P=Number(P.toFixed(9)),C.intersects(h)&&P!==a?(f=P>f?P:f,M=Wue(M,o),m.push(M),y.push("cut")):C.intersects(d)&&I!==l?(f=P*(2*a)>f?P*(2*a):f,M=Wue(M,o,360),m.push(M),y.push("cut")):y.push(M)}else y.push(S.clone());else y.push(S);else y.push(S);let v=fx(f,a),_=-90;const b=v,w=new fd;for(;v>0;){const S=360*v-180;w.addPath([[S,_],[S,-1*_]]),_*=-1,v--}if(m.length>0&&b>0){const S=qQe(m,await zQe(r,m,w,i)),C=[],T=[];for(let P=0;P<y.length;P++){const D=y[P];if(D!=="cut")T.push(D);else{const F=S.shift(),L=t[P];L!=null&&L.type==="polygon"&&L.rings&&L.rings.length>1&&F.rings.length>=L.rings.length?(C.push(F),T.push("simplify")):T.push(o?Gy(F):F)}}if(!C.length)return T;const M=await BQe(r,C,i),I=[];for(let P=0;P<T.length;P++){const D=T[P];D!=="simplify"?I.push(D):I.push(o?Gy(M.shift()):M.shift())}return I}const x=[];for(let S=0;S<y.length;S++){const C=y[S];if(C!=="cut")x.push(C);else{const T=m.shift();x.push(o===!0?Gy(T):T)}}return x}function ZQe(t){if(!t)return null;const e=t.extent;if(!e)return null;const i=t.spatialReference&&lc(t.spatialReference);if(!i)return e;const[r,s]=i.valid,n=2*s,{width:o}=e;let a,{xmin:l,xmax:c}=e;if([l,c]=[c,l],t.type==="extent"||o===0||o<=s||o>n||l<r||c>s)return e;switch(t.type){case"polygon":if(!(t.rings.length>1))return e;a=que(t.rings);break;case"polyline":if(!(t.paths.length>1))return e;a=que(t.paths);break;case"multipoint":a=t.points}const h=e.clone();for(let d=0;d<a.length;d++){let f=a[d][0];f<0?(f+=s,c=Math.max(f,c)):(f-=s,l=Math.min(f,l))}return h.xmin=l,h.xmax=c,h.width<o?(h.xmin-=s,h.xmax-=s,h):e}function Cie(t,e,i){const r=lc(i);if(r==null)return t;const[s,n]=r.valid,o=2*n;let a=0,l=0;e>n?a=Math.ceil(Math.abs(e-n)/o):e<s&&(a=-Math.ceil(Math.abs(e-s)/o)),t>n?l=Math.ceil(Math.abs(t-n)/o):t<s&&(l=-Math.ceil(Math.abs(t-s)/o));let c=t+(a-l)*o;const h=c-e;return h>n?c-=o:h<s&&(c+=o),c}function E7t(t,e){const i=lc(e);if(i){const[r,s]=i.valid,n=s-r;if(t<r)for(;t<r;)t+=n;if(t>s)for(;t>s;)t-=n}return t}const iAe=96,rAe=39.37,YQe=180/Math.PI;function sAe(t){return t.wkid?t:t.spatialReference||Ae.WGS84}function $ie(t,e){return e.type?li(t,e.x,e.y):zn(t,e)}function nAe(t){return Ao(t)}function lj(t,e,i=0){let r=t.width,s=t.height;if(i!==0){const a=wt(i),l=Math.abs(Math.cos(a)),c=Math.abs(Math.sin(a));r=t.width*l+t.height*c,s=t.width*c+t.height*l}const n=Math.max(1,e[0]),o=Math.max(1,e[1]);return Math.max(r/n,s/o)*ret(t.spatialReference)}async function YO(t,e,i,r){let s,n;if(!t||Array.isArray(t)&&!t.length)return null;if(Ee.isCollection(t)&&(t=t.toArray()),Array.isArray(t)&&t.length&&typeof t[0]=="object"){const a=t.every(h=>"attributes"in h),l=t.some(h=>!h.geometry);let c=t;if(a&&l&&e&&e.allLayerViews){const h=new Map;for(const y of t){const v=y.layer,_=h.get(v)||[],b=y.attributes[v.objectIdField];b!=null&&_.push(b),h.set(v,_)}const d=[];h.forEach((y,v)=>{const _=e.allLayerViews?.find(b=>b.layer.id===v.id);if(_&&"queryFeatures"in _){const b=v.createQuery();b.objectIds=y,b.returnGeometry=!0,d.push(_.queryFeatures(b))}});const f=await Promise.all(d),m=[];for(const y of f)if(y&&y.features&&y.features.length)for(const v of y.features)v.geometry!=null&&m.push(v.geometry);c=m}for(const h of c)r=await YO(h,e,i,r);return r}if(Array.isArray(t)&&t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number")s=new ke(t);else if(t instanceof og)s=t;else if("geometry"in t){if(t.geometry)s=t.geometry;else if(t.layer){const a=t.layer,l=e.allLayerViews?.find(c=>c.layer.id===a.id);if(l&&"queryFeatures"in l){const c=a.createQuery();c.objectIds=[t.attributes[a.objectIdField]],c.returnGeometry=!0,s=(await l.queryFeatures(c))?.features?.[0]?.geometry}}}if(s==null)return null;switch(s.type){case"point":n=new gi({xmin:s.x,ymin:s.y,xmax:s.x,ymax:s.y,spatialReference:s.spatialReference});break;case"extent":case"multipoint":case"polygon":case"polyline":n=ZQe(s);break;default:n=s.extent}if(!n)return null;$v()||ru(n.spatialReference,i)||await nv();const o=Id(n,i);if(!o)return null;if(r){const a=o.center,l=a.clone();l.x=Cie(a.x,r.center.x,i),l.x!==a.x&&o.centerAt(l),r=r.union(o)}else r=o;return r}function JQe(t){if(t&&(!Array.isArray(t)||typeof t[0]!="number")&&(typeof t=="object"||Array.isArray(t)&&typeof t[0]=="object")){if("layer"in t&&t.layer?.minScale!=null&&t.layer.maxScale!=null){const e=t.layer;return{min:e.minScale,max:e.maxScale}}if(Array.isArray(t)&&t.length&&t.every(e=>"layer"in e)){let e=0,i=0;for(const r of t){const s=r.layer;s?.minScale&&s.maxScale&&(e=s.minScale<e?s.minScale:e,i=s.maxScale>i?s.maxScale:i)}return e&&i?{min:e,max:i}:null}}}function Yue(t,e){const i=sAe(t);return rs(i,e)||i.imageCoordinateSystem||e.imageCoordinateSystem?t:Id(t,e)}async function XQe(t,e){if(!t||!e)return new Jr({targetGeometry:new ke,scale:0,rotation:0});let i=e.spatialReference;const{constraints:r,padding:s,viewpoint:n,size:o}=e,a=[s?o[0]-s.left-s.right:o[0],s?o[1]-s.top-s.bottom:o[1]];let l=null;t instanceof Jr?l=t:t.viewpoint?l=t.viewpoint:t.target&&t.target.declaredClass==="esri.Viewpoint"&&(l=t.target);let c=null;l?.targetGeometry?c=l.targetGeometry:t instanceof gi?c=t:t instanceof og?c=await YO(t,e,i):t&&(c=await YO(t.center,e,i)||await YO(t.target,e,i)||await YO(t,e,i)),!c&&n?.targetGeometry?c=n.targetGeometry:!c&&e.extent&&(c=e.extent),i||(i=sAe(e.spatialReference||e.extent||c)),$v()||rs(c.spatialReference,i)||ru(c.spatialReference,i)||await nv();const h=Yue(c,i),d="center"in h?h.center:h;e.pickClosestTarget!==!1&&d.type==="point"&&n.targetGeometry?.type==="point"&&(d.x=Cie(d.x,n.targetGeometry.x,d.spatialReference));let f=0;l?f=l.rotation:t.hasOwnProperty("rotation")?f=t.rotation:n&&(f=n.rotation);let m=0;m=l?.targetGeometry!=null&&l.targetGeometry.type==="point"?l.scale:"scale"in t&&t.scale?t.scale:"zoom"in t&&t.zoom!==-1&&r&&r.effectiveLODs?r.zoomToScale(t.zoom):Array.isArray(c)||c.type==="point"||c.type==="extent"&&c.width===0&&c.height===0?n.scale:lj(Yue(c.extent,i),a,f);const y=JQe(t.target??t);y&&(y.min&&y.min<m?m=y.min:y.max&&y.max>m&&(m=y.max));let v=new Jr({targetGeometry:d,scale:m,rotation:f});return r&&(v=r.fit(v),r.constrainByGeometry(v),r.rotationEnabled||(v.rotation=n.rotation)),v}function xl(t,e){const i=t.targetGeometry,r=e.targetGeometry;return i.x=r.x,i.y=r.y,i.spatialReference=r.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}function KQe(t,e,i){return i?li(t,.5*(e[0]-i.right+i.left),.5*(e[1]-i.bottom+i.top)):ud(t,e,.5)}const QQe=function(){const t=He();return function(e,i,r){const s=i.targetGeometry;$ie(t,s);const n=.5*MA(i);return e.xmin=t[0]-n*r[0],e.ymin=t[1]-n*r[1],e.xmax=t[0]+n*r[0],e.ymax=t[1]+n*r[1],e.spatialReference=s.spatialReference,e}}();function eet(t,e,i,r,s){return tY(t,e,i.center),t.scale=lj(i,r),s?.constraints?.constrain(t),t}function tet(t,e,i,r){return Oie(t,e,i,r),Sie(t,t)}const oAe=function(){const t=He();return function(e,i,r){return wie(e,set(e,i),KQe(t,i,r))}}(),iet=function(){const t=Wy(),e=He();return function(i,r,s,n){const o=MA(r),a=Aie(r);return li(e,o,o),J$e(t,e),aj(t,t,a),GP(t,t,oAe(e,s,n)),GP(t,t,[0,n.top-n.bottom]),li(i,t[4],t[5])}}();function MA(t){return t.scale*aAe(t.targetGeometry?.spatialReference)}function aAe(t){return qu(t)?1/(nAe(t)*rAe*iAe):1}function Aie(t){return pD(t.rotation)||0}function ret(t){return qu(t)?nAe(t)*rAe*iAe:1}function set(t,e){return ud(t,e,.5)}const Mie=function(){const t=He(),e=He(),i=He();return function(r,s,n,o,a,l){return bie(t,s),ud(e,n,.5*l),li(i,1/o*l,-1/o*l),Eie(r,e),a&&aj(r,r,a),Tie(r,r,i),GP(r,r,t),r}}(),Oie=function(){const t=He();return function(e,i,r,s){const n=MA(i),o=Aie(i);return $ie(t,i.targetGeometry),Mie(e,t,r,n,o,s)}}(),net=function(){const t=He();return function(e,i,r,s){const n=MA(i);return $ie(t,i.targetGeometry),Mie(e,t,r,n,0,s)}}();function lAe(t){const e=lc(t);return e?e.valid[1]-e.valid[0]:0}function oet(t,e){return Math.round(lAe(t)/e)}const aet=function(){const t=He(),e=He(),i=[0,0,0];return function(r,s,n){cd(t,r,s),jP(t,t),cd(e,r,n),jP(e,e),B$e(i,t,e);let o=Math.acos(Bo(t,e)/(uU(t)*uU(e)))*YQe;return i[2]<0&&(o=-o),isNaN(o)&&(o=0),o}}(),cet=function(){const t=He();return function(e,i,r,s){const n=e.targetGeometry;return xl(e,i),iet(t,i,r,s),n.x+=t[0],n.y+=t[1],e}}(),tY=function(t,e,i){xl(t,e);const r=t.targetGeometry;return r.x=i.x,r.y=i.y,r.spatialReference=i.spatialReference,t},uet=function(){const t=He();return function(e,i,r,s,n){n||(n="center"),wie(t,r,s),ud(t,t,.5);const o=t[0],a=t[1];switch(n){case"center":li(t,0,0);break;case"left":li(t,-o,0);break;case"top":li(t,0,a);break;case"right":li(t,o,0);break;case"bottom":li(t,0,-a);break;case"top-left":li(t,-o,a);break;case"bottom-left":li(t,-o,-a);break;case"top-right":li(t,o,a);break;case"bottom-right":li(t,o,-a)}return cj(e,i,t),e}}();function C7t(t,e,i){return xl(t,e),t.rotation+=i,t}function het(t,e,i){return xl(t,e),t.rotation=i,t}const det=function(){const t=He();return function(e,i,r,s,n){return xl(e,i),isNaN(r)||r===0||(uAe(t,s,i,n),e.scale=i.scale*r,hAe(t,t,e,n),cj(e,e,li(t,t[0]-s[0],s[1]-t[1]))),e}}();function Jue(t,e,i){return xl(t,e),t.scale=i,t}const cAe=function(){const t=He();return function(e,i,r,s,n,o){return xl(e,i),isNaN(r)||r===0||(uAe(t,n,i,o),e.scale=i.scale*r,e.rotation+=s,hAe(t,t,e,o),cj(e,e,li(t,t[0]-n[0],n[1]-t[1]))),e}}(),$7t=function(){const t=He(),e=He();return function(i,r,s,n,o,a,l){return oAe(e,a,l),wy(t,o,e),n?cAe(i,r,s,n,t,a):det(i,r,s,t,a)}}(),uAe=function(){const t=Wy();return function(e,i,r,s){return ym(e,i,tet(t,r,s,1))}}(),hAe=function(){const t=Wy();return function(e,i,r,s){return ym(e,i,Oie(t,r,s,1))}}(),cj=function(){const t=He(),e=Wy();return function(i,r,s){xl(i,r);const n=MA(r),o=i.targetGeometry;return Y$e(e,Aie(r)),Tie(e,e,un(n,n)),ym(t,s,e),o.x+=t[0],o.y+=t[1],i}}();function dAe(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function pet(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function fet(t,e,i,r,s,n){const o=new Float32Array(6);return o[0]=t,o[1]=e,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function met(t,e){return new Float32Array(t,e,6)}function pAe(t,e,i,r){const s=e[r],n=e[r+1];t[r]=i[0]*s+i[2]*n+i[4],t[r+1]=i[1]*s+i[3]*n+i[5]}function get(t,e,i,r=0,s=0,n=2){const o=s||e.length/n;for(let a=r;a<o;a++)pAe(t,e,i,a*n)}Object.freeze(Object.defineProperty({__proto__:null,clone:pet,create:dAe,createView:met,fromValues:fet,transform:pAe,transformMany:get},Symbol.toStringTag,{value:"Module"}));function FS(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function yet(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function vD(t,e,i,r,s,n,o,a,l,c){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t}function uj(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function OA(t,e){if(t===e){const i=e[1],r=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function _D(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=h*o-a*c,f=-h*n+a*l,m=c*n-o*l;let y=i*d+r*f+s*m;return y?(y=1/y,t[0]=d*y,t[1]=(-h*r+s*c)*y,t[2]=(a*r-s*o)*y,t[3]=f*y,t[4]=(h*i-s*l)*y,t[5]=(-a*i+s*n)*y,t[6]=m*y,t[7]=(-c*i+r*l)*y,t[8]=(o*i-r*n)*y,t):null}function vet(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return t[0]=o*h-a*c,t[1]=s*c-r*h,t[2]=r*a-s*o,t[3]=a*l-n*h,t[4]=i*h-s*l,t[5]=s*n-i*a,t[6]=n*c-o*l,t[7]=r*l-i*c,t[8]=i*o-r*n,t}function _et(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*n-o*l)+i*(-c*s+o*a)+r*(l*s-n*a)}function bD(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],f=i[0],m=i[1],y=i[2],v=i[3],_=i[4],b=i[5],w=i[6],x=i[7],S=i[8];return t[0]=f*r+m*o+y*c,t[1]=f*s+m*a+y*h,t[2]=f*n+m*l+y*d,t[3]=v*r+_*o+b*c,t[4]=v*s+_*a+b*h,t[5]=v*n+_*l+b*d,t[6]=w*r+x*o+S*c,t[7]=w*s+x*a+S*h,t[8]=w*n+x*l+S*d,t}function sS(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],f=i[0],m=i[1];return t[0]=r,t[1]=s,t[2]=n,t[3]=o,t[4]=a,t[5]=l,t[6]=f*r+m*o+c,t[7]=f*s+m*a+h,t[8]=f*n+m*l+d,t}function hj(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],f=Math.sin(i),m=Math.cos(i);return t[0]=m*r+f*o,t[1]=m*s+f*a,t[2]=m*n+f*l,t[3]=m*o-f*r,t[4]=m*a-f*s,t[5]=m*l-f*n,t[6]=c,t[7]=h,t[8]=d,t}function dj(t,e,i){const r=i[0],s=i[1],n=i[2];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=n*e[6],t[7]=n*e[7],t[8]=n*e[8],t}function bet(t,e,i){const r=i[0],s=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t}function wet(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function xet(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Tet(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Eet(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function HP(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=i+i,a=r+r,l=s+s,c=i*o,h=r*o,d=r*a,f=s*o,m=s*a,y=s*l,v=n*o,_=n*a,b=n*l;return t[0]=1-d-y,t[3]=h-b,t[6]=f+_,t[1]=h+b,t[4]=1-c-y,t[7]=m-v,t[2]=f-_,t[5]=m+v,t[8]=1-c-d,t}function fAe(t,e){const i=e[0],r=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10],d=h*o-a*c,f=-h*n+a*l,m=c*n-o*l,y=i*d+r*f+s*m;if(!y)return null;const v=1/y;return t[0]=d*v,t[1]=(-h*r+s*c)*v,t[2]=(a*r-s*o)*v,t[3]=f*v,t[4]=(h*i-s*l)*v,t[5]=(-a*i+s*n)*v,t[6]=m*v,t[7]=(-c*i+r*l)*v,t[8]=(o*i-r*n)*v,t}function Iie(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=e[9],f=e[10],m=e[11],y=e[12],v=e[13],_=e[14],b=e[15],w=i*a-r*o,x=i*l-s*o,S=i*c-n*o,C=r*l-s*a,T=r*c-n*a,M=s*c-n*l,I=h*v-d*y,P=h*_-f*y,D=h*b-m*y,F=d*_-f*v,L=d*b-m*v,N=f*b-m*_;let R=w*N-x*L+S*F+C*D-T*P+M*I;return R?(R=1/R,t[0]=(a*N-l*L+c*F)*R,t[1]=(l*D-o*N-c*P)*R,t[2]=(o*L-a*D+c*I)*R,t[3]=(s*L-r*N-n*F)*R,t[4]=(i*N-s*D+n*P)*R,t[5]=(r*D-i*L-n*I)*R,t[6]=(v*M-_*T+b*C)*R,t[7]=(_*S-y*M-b*x)*R,t[8]=(y*T-v*S+b*w)*R,t):null}function Cet(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function $et(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function Aet(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function Met(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t}function mAe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}function Oet(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t}function Iet(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t}function Ret(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function Pet(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],d=e[0],f=e[1],m=e[2],y=e[3],v=e[4],_=e[5],b=e[6],w=e[7],x=e[8],S=So();return Math.abs(i-d)<=S*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(r-f)<=S*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(s-m)<=S*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(n-y)<=S*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(o-v)<=S*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(a-_)<=S*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(l-b)<=S*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(c-w)<=S*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(h-x)<=S*Math.max(1,Math.abs(h),Math.abs(x))}function Det(t){const e=So(),i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8];return Math.abs(1-(i*i+n*n+l*l))<=e&&Math.abs(1-(r*r+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+h*h))<=e}const Let=bD,Net=mAe;Object.freeze(Object.defineProperty({__proto__:null,add:Met,adjoint:vet,copy:yet,determinant:_et,equals:Pet,exactEquals:Ret,frob:Aet,fromMat2d:Eet,fromMat4:FS,fromQuat:HP,fromRotation:xet,fromScaling:Tet,fromTranslation:wet,identity:uj,invert:_D,isOrthoNormal:Det,mul:Let,multiply:bD,multiplyScalar:Oet,multiplyScalarAndAdd:Iet,normalFromMat4:Iie,normalFromMat4Legacy:fAe,projection:Cet,rotate:hj,scale:dj,scaleByVec2:bet,set:vD,str:$et,sub:Net,subtract:mAe,translate:sS,transpose:OA},Symbol.toStringTag,{value:"Module"}));function Rx(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function gAe(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Fet(t,e,i,r,s,n,o,a,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=i,c[3]=r,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function ket(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:gAe,create:Rx,createView:ket,fromValues:Fet},Symbol.toStringTag,{value:"Module"}));function yAe(){return new Float32Array(2)}function zet(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function Qh(t,e){const i=new Float32Array(2);return i[0]=t,i[1]=e,i}function Uet(t,e){return new Float32Array(t,e,2)}function vAe(){return yAe()}function _Ae(){return Qh(1,1)}function bAe(){return Qh(1,0)}function wAe(){return Qh(0,1)}const Bet=vAe(),Vet=_Ae(),jet=bAe(),Get=wAe();Object.freeze(Object.defineProperty({__proto__:null,ONES:Vet,UNIT_X:jet,UNIT_Y:Get,ZEROS:Bet,clone:zet,create:yAe,createView:Uet,fromValues:Qh,ones:_Ae,unitX:bAe,unitY:wAe,zeros:vAe},Symbol.toStringTag,{value:"Module"}));function Het(t){return t instanceof Float32Array&&t.length>=2}function qet(t){return Array.isArray(t)&&t.length>=2}function Q6(t){return Het(t)||qet(t)}var iY;const xg=[0,0];let Jg=iY=class extends ee{constructor(t){super(t),this._viewpoint2D={center:He(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new gi,this.id=0,this.inverseTransform=Wy(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=Wy(),this.transformNoRotation=Wy(),this.displayMat3=Rx(),this.displayViewMat3=Rx(),this.viewMat3=Rx(),this.viewMat2d=dAe(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(t){this._set("pixelRatio",t),this._update()}set size(t){this._set("size",t),this._update()}set viewpoint(t){if(t){const e=this._viewpoint2D,i=t.targetGeometry;e.center[0]=i.x,e.center[1]=i.y,e.rotation=t.rotation,e.scale=t.scale,e.spatialReference=i.spatialReference}this._update()}get visibleArea(){const[t,e]=this.size;return[this.toMap([0,0],0,0),this.toMap([0,0],0,e),this.toMap([0,0],t,e),this.toMap([0,0],t,0)]}copy(t){const e=this.size,i=this.viewpoint;return i&&e?(this.viewpoint=xl(i,t.viewpoint),this._set("size",zn(e,t.size))):(this.viewpoint=t.viewpoint.clone(),this._set("size",[t.size[0],t.size[1]])),this._set("pixelRatio",t.pixelRatio),this}clone(){return new iY({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(t,e,i){return Q6(e)?ym(t,e,this.inverseTransform):(xg[0]=e,xg[1]=i,ym(t,xg,this.inverseTransform))}toScreen(t,e,i){return Q6(e)?ym(t,e,this.transform):(xg[0]=e,xg[1]=i,ym(t,xg,this.transform))}toScreenNoRotation(t,e,i){return Q6(e)?ym(t,e,this.transformNoRotation):(xg[0]=e,xg[1]=i,ym(t,xg,this.transformNoRotation))}wrapMapCoordinate(t,e){zn(t,e);const[i]=e,[r]=this.center,{extent:s,spatialReference:n}=this;let{xmin:o,xmax:a}=s;if(n.isWrappable){const l=lAe(n)/2;o=Math.max(o,r-l),a=Math.min(a,r+l)}return(i<o||i>a)&&(t[0]=Cie(i,r,n)),t}getScreenTransform(t,e){const{center:i}=this._viewpoint2D,r=this._get("pixelRatio")||1,s=this._get("size");return Mie(t,i,s,e,0,r),t}_update(){const{center:t,spatialReference:e,scale:i,rotation:r}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),o=new Jr({targetGeometry:new ke(t[0],t[1],e),scale:i,rotation:r});if(this._set("viewpoint",o),!n||!e||!i)return;this.resolution=MA(o),this.rotation=r,this.scale=i,this.spatialReference=e,zn(this.center,t);const a=n[0]!==0?2/n[0]:0,l=n[1]!==0?-2/n[1]:0;vD(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=uj(this.viewMat3),h=Qh(n[0]/2,n[1]/2),d=Qh(-n[0]/2,-n[1]/2),f=pD(r);sS(c,c,h),hj(c,c,f),sS(c,c,d),bD(this.displayViewMat3,this.displayMat3,c);const m=Eie(this.viewMat2d,h);return aj(m,m,f),GP(m,m,d),QQe(this.extent,o,n),Oie(this.transform,o,n,s),Sie(this.inverseTransform,this.transform),net(this.transformNoRotation,o,n,s),this.worldScreenWidth=oet(this.spatialReference,this.resolution),this._set("id",this.id+1),this.notifyChange("visibleArea"),this}};u([p({readOnly:!0})],Jg.prototype,"id",void 0),u([p({value:1,json:{write:!0}})],Jg.prototype,"pixelRatio",null),u([p({json:{write:!0}})],Jg.prototype,"size",null),u([p()],Jg.prototype,"spatialReference",void 0),u([p({type:Jr,json:{write:!0}})],Jg.prototype,"viewpoint",null),u([p({readOnly:!0})],Jg.prototype,"visibleArea",null),Jg=iY=u([A("esri.views.2d.ViewState")],Jg);const Xue=Jg;var rY,sY;let My=rY=class extends ue{constructor(){super(...arguments),this.left=0,this.top=0,this.right=0,this.bottom=0}clone(){return new rY({left:this.left,top:this.top,right:this.right,bottom:this.bottom})}};u([p()],My.prototype,"left",void 0),u([p()],My.prototype,"top",void 0),u([p()],My.prototype,"right",void 0),u([p()],My.prototype,"bottom",void 0),My=rY=u([A("esri.views.2d.PaddedViewState.Padding")],My);let $E=sY=class extends Xue{constructor(...t){super(...t),this.paddedViewState=new Xue,this._updateContent=(()=>{const e=He();return()=>{const i=this._get("size"),r=this._get("padding");if(!i||!r)return;const s=this.paddedViewState;li(e,r.left+r.right,r.top+r.bottom),cd(e,i,e),zn(s.size,e);const n=s.viewpoint;n&&(this.viewpoint=n)}})(),this.addHandles(H(()=>[this.size,this.padding],()=>this._updateContent(),Gt)),this.padding=new My,this.size=[0,0]}set padding(t){this._set("padding",t||new My)}set viewpoint(t){if(t){this.paddedViewState.viewpoint=t;let e=t;const i=this._get("padding");i&&(e=cet(t.clone(),t,this._get("size"),i));const{targetGeometry:r,rotation:s,scale:n}=e,{x:o,y:a,spatialReference:l}=r,c=this._viewpoint2D;c.center[0]=o,c.center[1]=a,c.rotation=s,c.scale=n,c.spatialReference=l,this._update()}}clone(){return new sY({padding:this.padding.clone(),size:this.size.slice(),viewpoint:this.paddedViewState.viewpoint.clone(),pixelRatio:this.pixelRatio})}};u([p()],$E.prototype,"paddedViewState",void 0),u([p({type:My})],$E.prototype,"padding",null),u([p()],$E.prototype,"viewpoint",null),$E=sY=u([A("esri.views.2d.PaddedViewState")],$E);const Rie=$E;var ai;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})(ai||(ai={}));const Ko=Symbol("Yield");let Wet=class{constructor(){this._tasks=new Array,this._runningTasks=xa(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(e){if(this.length===0)return Ko;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,i,r){return++this._runningTasks.value,new Promise((s,n)=>this._tasks.push(new Kue(s,n,e,i,r))).finally(()=>--this._runningTasks.value)}unshift(e,i,r){return++this._runningTasks.value,new Promise((s,n)=>this._tasks.unshift(new Kue(s,n,e,i,r))).finally(()=>--this._runningTasks.value)}_process(e){if(this._tasks.length===0)return!1;const i=this._tasks.shift();try{const r=wa(i.signal);if(r&&!i.abortCallback)i.reject(vi());else{const s=r?i.abortCallback?.(vi()):i.callback(e);nu(s)?s.then(i.resolve,i.reject):i.resolve(s)}}catch(r){i.reject(r)}return!0}cancelAll(){const e=vi();for(const i of this._tasks)if(i.abortCallback){const r=i.abortCallback(e);i.resolve(r)}else i.reject(e);this._tasks.length=0}},Kue=class{constructor(e,i,r,s=void 0,n=void 0){this.resolve=e,this.reject=i,this.callback=r,this.signal=s,this.abortCallback=n}},JO=class extends ue{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};u([p()],JO.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),u([p()],JO.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),JO=u([A("esri.views.support.debugFlags")],JO);const Zet=new JO;function xAe(){return new dU.Scheduler}var at;(function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t.MAPVIEW_FETCH_QUEUE="mapview fetch queue",t.MAPVIEW_LAYERVIEW_UPDATE="mapview layerview update",t.MAPVIEW_VECTOR_TILE_PARSING_QUEUE="mapview vector tile parsing queue",t[t.NONE=0]="NONE",t[t.TEST_PRIO=1]="TEST_PRIO"})(at||(at={}));const kh=0,Que=new Map([[at.RESOURCE_CONTROLLER_IMMEDIATE,kh],[at.RESOURCE_CONTROLLER,4],[at.SLIDE,kh],[at.STREAM_DATA_LOADER,kh],[at.ELEVATION_QUERY,kh],[at.TERRAIN_SURFACE,1],[at.SURFACE_GEOMETRY_UPDATES,1],[at.LOD_RENDERER,2],[at.GRAPHICS_CORE,2],[at.I3S_CONTROLLER,2],[at.POINT_CLOUD_LAYER,2],[at.FEATURE_TILE_FETCHER,2],[at.CLOUDS_GENERATOR,2],[at.OVERLAY,4],[at.STAGE,4],[at.GRAPHICS_DECONFLICTOR,4],[at.FILTER_VISIBILITY,4],[at.SCALE_VISIBILITY,4],[at.FRUSTUM_VISIBILITY,4],[at.POINT_OF_INTEREST_FREQUENT,6],[at.POINT_OF_INTEREST_INFREQUENT,30],[at.LABELER,8],[at.FEATURE_QUERY_ENGINE,8],[at.FEATURE_TILE_TREE,16],[at.FEATURE_TILE_TREE_ACTIVE,kh],[at.ELEVATION_ALIGNMENT,12],[at.ELEVATION_ALIGNMENT_SCENE,14],[at.TEXT_TEXTURE_ATLAS,12],[at.TEXTURE_UNLOAD,12],[at.LINE_OF_SIGHT_TOOL,16],[at.LINE_OF_SIGHT_TOOL_INTERACTIVE,kh],[at.SNAPPING,kh],[at.SHADOW_ACCUMULATOR,30],[at.MAPVIEW_FETCH_QUEUE,kh],[at.MAPVIEW_LAYERVIEW_UPDATE,2],[at.MAPVIEW_VECTOR_TILE_PARSING_QUEUE,kh]]);function ehe(t){return Que.has(t)?Que.get(t):typeof t=="number"?t:1}const Yet=6.5,the=1,Jet=30,Xet=1e3/30,Ket=100,ihe=.9;var dU,cw;(function(t){class e{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(n=>n.needsUpdate)}constructor(){this._updating=xa(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new zy("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=ai.INTERACTING,this._tasks=new Jt,this._runQueue=new Jt,this._load=0,this._idleStateCallbacks=new Jt,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=H(()=>Zet.SCHEDULER_LOG_SLOW_TASKS,n=>this._debug=n,Nt);for(const n of Object.keys(at))this.performanceInfo.tasks.set(at[n],new zy(at[n]))}destroy(){this._tasks.toArray().forEach(n=>n.remove()),this._tasks.clear(),Hi(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(n){this._updatingChanged(),n&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this._runFrame())}))}registerTask(n,o){const a=new i(this,n,o);return this._tasks.push(a),this._updatingChanged(),this.performanceInfo.tasks.has(n)||this.performanceInfo.tasks.set(n,new zy(n)),a}registerIdleStateCallbacks(n,o){const a={idleBegin:n,idleEnd:o};this._idleStateCallbacks.push(a),this.state===ai.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===ai.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(n){this._state!==n&&(this._state=n,this.state!==ai.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}frame(n){this._startFrameTaskTimes();const o=this._updateBudget(n);if(o){const a=this._budget.now();this._runFrame(),this._recordFrameTaskTimes(this._budget.now()-a)}else this._recordFrameTaskTimes(0);return o}_updateBudget(n){this._test&&(this._test.usedBudget=0),++this._frameNumber;let o=Yet,a=n.frameDuration,l=the;switch(this.state){case ai.IDLE:o=0,a=Math.max(Ket,n.frameDuration),l=Jet;break;case ai.INTERACTING:a=Math.max(Xet,n.frameDuration);case ai.ANIMATING:}return a=a-n.elapsedFrameTime-o,this.state!==ai.IDLE&&a<the&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}_runFrame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case ai.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(n=>n.idleBegin())),this._runIdle();break;case ai.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test&&(this._test.usedBudget=this._budget.elapsed)}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(n){this._idleUpdatesStartFired&&n.idleEnd(),this._idleStateCallbacks.removeUnordered(n)}removeTask(n){this._tasks.removeUnordered(n),this._runQueue.removeUnordered(n),this._updatingChanged()}_updateTask(n){this._tasks.forAll(o=>{o.name===n&&o.setPriority(n)})}_getState(n){if(this._runQueue.some(a=>a.name===n))return cw.SCHEDULED;let o=cw.IDLE;return this._tasks.forAll(a=>{a.name===n&&a.needsUpdate&&(a.schedulePriority<=1?o=cw.READY:o!==cw.READY&&(o=cw.WAITING))}),o}_getRuntime(n){let o=0;return this._tasks.forAll(a=>{a.name===n&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(n=>n.runtime=0)}_getRunning(){const n=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&n.set(a.name,(n.get(a.name)||0)+1)}),n.size===0)return null;let o="";return n.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const n=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*ihe+n*(1-ihe)}_schedule(){for(this._runQueue.filterInPlace(n=>!!n.needsUpdate||(n.schedulePriority=n.basePriority,!1)),this._tasks.forAll(n=>{n.basePriority===kh&&n.needsUpdate&&!this._runQueue.includes(n)&&n.blockFrame!==this._frameNumber&&this._runQueue.unshift(n)});this._runQueue.length===0;){let n=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==kh&&a.blockFrame!==this._frameNumber&&(n=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!n)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){do for(;this._runQueue.length>0;){const n=this._budget.now(),o=this._runQueue.pop();this._budget.resetProgress();try{o.task.runTask(this._budget)===Ko&&(o.blockFrame=this._frameNumber)}catch(l){J.getLogger("esri.views.support.Scheduler").error(`Exception in task "${o.name}"`,l),o.blockFrame=this._frameNumber}!this._budget.hasProgressed&&o.blockFrame!==this._frameNumber&&o.needsUpdate&&(o.name,at.I3S_CONTROLLER,o.blockFrame=this._frameNumber),o.schedulePriority=o.basePriority;const a=this._budget.now()-n;if(o.runtime+=a,this._frameTaskTimes.set(o.priority,this._frameTaskTimes.get(o.priority)+a),this._budget.remaining<=0)return void this._updatingChanged()}while(this._schedule());this._updatingChanged()}_startFrameTaskTimes(){for(const n of Object.keys(at))this._frameTaskTimes.set(at[n],0)}_recordFrameTaskTimes(n){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).push(o)),this.performanceInfo.total.push(n)}get test(){return this._test}}t.Scheduler=e;class i{get task(){return this._task.value}get updating(){return this._queue.running}constructor(n,o,a){this._scheduler=n,this.name=o,this.blockFrame=0,this.runtime=0,this._queue=new Wet,this._handles=new ng,this._basePriority=ehe(o),this.schedulePriority=this._basePriority,this._task=xa(a??this._queue),this._handles.add(gn(()=>this.task.running,l=>n.taskRunningChanged(l)))}remove(){this.processQueue(Wc),this._scheduler.removeTask(this),this.schedule=$$.schedule,this.reschedule=$$.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(n){if(this.name===n)return;this.name=n;const o=ehe(n);this._basePriority!==kh&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(n){this.setPriority(n)}get needsUpdate(){return this.updating||this.task.running}schedule(n,o,a){return this._queue.push(n,o,a)}reschedule(n,o,a){return this._queue.unshift(n,o,a)}processQueue(n){return this._queue.runTask(n)}}class r{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=ai.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=r})(dU||(dU={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(cw||(cw={}));const Wc=(()=>{const t=new dU.Budget;return t.enabled=!1,t})();let Qet=class{remove(){}processQueue(){}schedule(e,i,r){try{if(wa(i)){const s=vi();return r?Promise.resolve(r(s)):Promise.reject(s)}return n7(e(Wc))}catch(s){return Promise.reject(s)}}reschedule(e,i,r){return this.schedule(e,i,r)}};const $$=new Qet;let ett=class{constructor(e){this.view=e,this._stationaryHandle=null,this._frameTaskHandle=null,this._updateParameters=null,this._updateRequested=!1,this._scheduler=xAe(),this._schedulerHandle=gn(()=>this._scheduler.updating,()=>this.requestFrame()),this.stationary=!0,this.prepare=()=>{this._updateParameters&&(this._updateParameters.state=this.view.state,this._updateParameters.stationary=this.view.stationary,this._updateParameters.pixelRatio=window.devicePixelRatio,this._updateParameters.renderingOptions=this.view.renderingOptions,this._updateParameters.targetState.copy(this.view.state),this.view.animation?.target==null||nu(this.view.animation.target)||(this._updateParameters.targetState.viewpoint=this.view.animation.target))},this.update=i=>{if(this._updateRequested=!1,this.view?.destroyed)return;const{allLayerViews:r,graphicsView:s,labelManager:n,state:{id:o}}=this.view;r?.forEach(this._updateLayerView,this),n!=null&&(n.lastUpdateId!==o&&(n.viewChange(),n.lastUpdateId=o),n.updateRequested&&n.processUpdate(this._updateParameters)),s!=null&&(s.lastUpdateId!==o&&(s.viewChange(),s.lastUpdateId=o),s.updateRequested&&s.processUpdate(this._updateParameters)),this.view.graphicsTileStore?.setViewState(this._updateParameters.state),this.view.animation?this._scheduler.state=ai.ANIMATING:this.view.interacting?this._scheduler.state=ai.INTERACTING:this._scheduler.state=ai.IDLE,this._scheduler.frame(i)||this._updateRequested||this._scheduler.state!==ai.IDLE||this._frameTaskHandle?.pause()}}destroy(){this.stop(),this._schedulerHandle.remove(),this._scheduler.destroy()}get scheduler(){return this._scheduler}start(){if(this._frameTaskHandle)return;const e=this.view;this.stationary=e.stationary,this._updateParameters={state:e.state,targetState:new Rie,pixelRatio:window.devicePixelRatio,stationary:this.stationary,renderingOptions:e.renderingOptions},this._stationaryHandle=H(()=>e.stationary,i=>{this.stationary=i,this.requestFrame()}),this._frameTaskHandle=qm(this),this.requestUpdate()}stop(){this._frameTaskHandle&&(this._updateRequested=!1,this._stationaryHandle?.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._frameTaskHandle=null,this.stationary=!0)}requestUpdate(){this._updateRequested||(this._updateRequested=!0,this.requestFrame())}requestFrame(){this._frameTaskHandle&&this._frameTaskHandle.resume()}_updateLayerView(e){if(!e.attached)return void this.requestUpdate();const i=this.view.state,r=e.lastUpdateId;r!=null&&(this.stationary||e.moving)||(e.moving=!0),r!==i.id&&e.viewChange(),this.stationary&&e.moving&&(e.moving=!1,e.moveEnd()),e.lastUpdateId=i.id,e.updateRequested&&e.processUpdate(this._updateParameters),"layerViews"in e&&e.layerViews?.forEach(this._updateLayerView,this)}},B0=class extends Ub{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=Qo(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),this._resolver?.reject(new U("ViewAnimation stopped")))}finish(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),this._resolver?.resolve())}update(e,i){i||(i=nu(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",i)}};u([p({readOnly:!0})],B0.prototype,"done",null),u([p({readOnly:!0,type:String})],B0.prototype,"state",void 0),u([p()],B0.prototype,"target",void 0),B0=u([A("esri.views.ViewAnimation")],B0),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(B0||(B0={}));const cv=B0;let y4=class extends ue{constructor(e){super(e),this._gotoTask=null}destroy(){this._gotoTask=null}async goTo(e,i){if(!e)return void J.getLogger(this).error("#goTo()","target cannot be null or undefined");const r=new cv;this.view.animation=r,await Cd(()=>this.view.ready,i);const s={...i,animate:i?.animate??!M$e(),animationMode:i?.animationMode??"auto"},{extent:n,spatialReference:o,size:a,viewpoint:l,constraints:c,padding:h,allLayerViews:d}=this.view,f=XQe(e,{extent:n,spatialReference:o,size:a,viewpoint:l,constraints:c,padding:h,allLayerViews:d,pickClosestTarget:i?.pickClosestTarget??!0});return r?.update(f),this._gotoTask={},s.animate?this._gotoAnimated(f,s):this._gotoImmediate(f,s)}_gotoImmediate(e,i){const r=this._gotoTask,s=this.view.animation,n=e.then(o=>{if(gt(i),r!==this._gotoTask)throw new U("view:goto-interrupted","Goto was interrupted");this.view.viewpoint=s.target=o,s.finish()});return this._cancellableGoTo(r,s,n,i)}_gotoAnimated(e,i){const r=this._gotoTask,s=this.view.animation;if(!s)return Promise.resolve();const n=e.then(o=>{if(gt(i),r!==this._gotoTask)throw new U("view:goto-interrupted","Goto was interrupted");return s.update(o),this.view.animationManager.animate(s,this.view.viewpoint,i),s.when().then(()=>{},()=>{})});return this._cancellableGoTo(r,s,n,i)}_cancellableGoTo(e,i,r,s){const n=()=>e===this._gotoTask;return Ree(r,s).finally(()=>{n()&&(i.done||i.stop())})}};u([p({constructOnly:!0})],y4.prototype,"view",void 0),y4=u([A("esri.views.2d.GoToManager")],y4);function ttt(t,e){const{spatialReference:i}=e,r=[e.x,e.y];let s,n,o,a;const l=[0,0],c=itt(t);for(let f=0;f<c.length;f++){const m=c[f];for(let y=0;y<m.length-1;y++){j6e(l,r,m,y);const v=lv(r,l);(s==null||v<s)&&(s=v,n=[...l],o=f,a=y)}}if(s==null||!n||o==null||a==null)throw new U("nearest-coordinate:failed","Failed to find the nearest coordinate");const[h,d]=n;return{coordinate:new ke({x:h,y:d,spatialReference:i}),distance:s}}function itt(t){switch(t.type){case"extent":return[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]];case"polygon":return t.rings;case"polyline":return t.paths}}var nY;let X1=nY=class extends OS.NumericIdentifiableMixin(ue){constructor(t){super(t),this.geometry=null,this.spatialReference=null}get normalizedGeometry(){if(this.geometry==null||!this.spatialReference)return null;if(!this.spatialReference.equals(this.geometry.spatialReference))try{return Id(this.geometry,this.spatialReference)}catch(t){return J.getLogger(this).error("#constraints.geometry","could not project the geometry to the view's spatial reference",{geometry:this.geometry,spatialReference:this.spatialReference,error:t}),null}return this.geometry}constrain(t,e){if(this.normalizedGeometry==null)return t;const i=t.targetGeometry;if(this.normalizedGeometry.type==="extent"?eD(this.normalizedGeometry,i):ote(this.normalizedGeometry,i))return t;const{coordinate:r}=ttt(this.normalizedGeometry,i);return r&&(t.targetGeometry=r),t}clone(){return new nY({geometry:this.geometry?.clone(),spatialReference:this.spatialReference?.clone()})}};u([p({constructOnly:!0})],X1.prototype,"geometry",void 0),u([p({readOnly:!0})],X1.prototype,"normalizedGeometry",null),u([p({constructOnly:!0})],X1.prototype,"spatialReference",void 0),X1=nY=u([A("esri.views.2d.constraints.GeometryConstraint")],X1);var oY;let XO=oY=class extends OS.NumericIdentifiableMixin(ue){constructor(){super(...arguments),this.enabled=!0,this.rotationEnabled=!0}constrain(t,e){return this.enabled&&e&&(this.rotationEnabled||(t.rotation=e.rotation)),t}clone(){return new oY({enabled:this.enabled,rotationEnabled:this.rotationEnabled})}};u([p()],XO.prototype,"enabled",void 0),u([p()],XO.prototype,"rotationEnabled",void 0),XO=oY=u([A("esri.views.2d.constraints.RotationConstraint")],XO);const SAe=XO;var aY;let Tc=aY=class extends OS.NumericIdentifiableMixin(ue){constructor(t){super(t),this._lodByScale={},this._scales=[],this.effectiveLODs=null,this.effectiveMinZoom=-1,this.effectiveMaxZoom=-1,this.effectiveMinScale=0,this.effectiveMaxScale=0,this.lods=null,this.minZoom=-1,this.maxZoom=-1,this.minScale=0,this.maxScale=0,this.snapToZoom=!0}initialize(){let t,{lods:e,minScale:i,maxScale:r,minZoom:s,maxZoom:n}=this,o=-1,a=-1,l=!1,c=!1;if(i!==0&&r!==0&&i<r&&([i,r]=[r,i]),!e?.length)return this._set("effectiveMinScale",i),void this._set("effectiveMaxScale",r);e=e.map(h=>h.clone()),e.sort((h,d)=>d.scale-h.scale),e.forEach((h,d)=>h.level=d);for(const h of e)!l&&i>0&&i>=h.scale&&(o=h.level,l=!0),!c&&r>0&&r>=h.scale&&(a=t?t.level:-1,c=!0),t=h;s===-1&&(s=i===0?0:o),n===-1&&(n=r===0?e.length-1:a),s=Math.max(s,0),s=Math.min(s,e.length-1),n=Math.max(n,0),n=Math.min(n,e.length-1),s>n&&([s,n]=[n,s]),i=e[s].scale,r=e[n].scale,e.splice(0,s),e.splice(n-s+1,e.length),e.forEach((h,d)=>{this._lodByScale[h.scale]=h,this._scales[d]=h.scale}),this._set("effectiveLODs",e),this._set("effectiveMinZoom",s),this._set("effectiveMaxZoom",n),this._set("effectiveMinScale",i),this._set("effectiveMaxScale",r)}constrain(t,e){if(e&&t.scale===e.scale)return t;const i=this.effectiveMinScale,r=this.effectiveMaxScale,s=t.targetGeometry,n=e&&e.targetGeometry,o=r!==0&&t.scale<r,a=i!==0&&t.scale>i;if(o||a){const l=a?i:r;if(e&&n){const c=(l-e.scale)/(t.scale-e.scale);s.x=n.x+(s.x-n.x)*c,s.y=n.y+(s.y-n.y)*c}t.scale=l}return this.snapToZoom&&this.effectiveLODs&&(t.scale=this._getClosestScale(t.scale)),t}fit(t){if(!this.effectiveLODs||!this.snapToZoom)return this.constrain(t,null);const e=this.scaleToZoom(t.scale),i=Math.abs(e-Math.floor(e));return t.scale=this.zoomToScale(i>.99?Math.round(e):Math.floor(e)),t}zoomToScale(t){if(!this.effectiveLODs)return 0;t-=this.effectiveMinZoom,t=Math.max(0,t);const e=this._scales;if(t<=0)return e[0];if(t>=e.length)return e[e.length-1];const i=Math.floor(t),r=Math.ceil(t);return e[i]+(t-i)*(e[r]-e[i])}scaleToZoom(t){if(!this.effectiveLODs)return-1;const e=this._scales;let i,r;if(t>=e[0])return this.effectiveMinZoom;if(t<=e[e.length-1])return this.effectiveMaxZoom;for(let s=0;s<e.length-1;s++){if(i=e[s],r=e[s+1],r===t)return s+this.effectiveMinZoom+1;if(i>t&&r<t)return s+this.effectiveMinZoom+1-(t-r)/(i-r)}return-1}snapToClosestScale(t){if(!this.effectiveLODs)return t;const e=this.scaleToZoom(t);return this.zoomToScale(Math.round(e))}snapToNextScale(t,e=.5){if(!this.effectiveLODs)return t*e;const i=Math.round(this.scaleToZoom(t));return this.zoomToScale(i+1)}snapToPreviousScale(t,e=2){if(!this.effectiveLODs)return t*e;const i=Math.round(this.scaleToZoom(t));return this.zoomToScale(i-1)}clone(){return new aY({lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})}_getClosestScale(t){return this._lodByScale[t]||(t=this._scales.reduce((e,i)=>Math.abs(i-t)<=Math.abs(e-t)?i:e,this._scales[0])),this._lodByScale[t].scale}};u([p({readOnly:!0})],Tc.prototype,"effectiveLODs",void 0),u([p({readOnly:!0})],Tc.prototype,"effectiveMinZoom",void 0),u([p({readOnly:!0})],Tc.prototype,"effectiveMaxZoom",void 0),u([p({readOnly:!0})],Tc.prototype,"effectiveMinScale",void 0),u([p({readOnly:!0})],Tc.prototype,"effectiveMaxScale",void 0),u([p()],Tc.prototype,"lods",void 0),u([p()],Tc.prototype,"minZoom",void 0),u([p()],Tc.prototype,"maxZoom",void 0),u([p()],Tc.prototype,"minScale",void 0),u([p()],Tc.prototype,"maxScale",void 0),u([p()],Tc.prototype,"snapToZoom",void 0),Tc=aY=u([A("esri.views.2d.constraints.ZoomConstraint")],Tc);const TAe=Tc,rtt={base:null,key:"type",typeMap:{extent:gi,polygon:Sa}};let wn=class extends ue{constructor(e){super(e),this.lods=null,this.minScale=0,this.maxScale=0,this.minZoom=-1,this.maxZoom=-1,this.rotationEnabled=!0,this.snapToZoom=!0,this.customConstraints=new Ee}destroy(){this.view=null}get effectiveLODs(){return this._zoom.effectiveLODs}get effectiveMinScale(){return this._zoom.effectiveMinScale}get effectiveMaxScale(){return this._zoom.effectiveMaxScale}get effectiveMinZoom(){return this._zoom.effectiveMinZoom}get effectiveMaxZoom(){return this._zoom.effectiveMaxZoom}set geometry(e){e?this._set("geometry",e):this._set("geometry",null)}get version(){return`${this._zoom?.uid}/${this._rotation?.uid}/${this._geometry?.uid}`}get _geometry(){const e=this._get("_geometry");return e&&this.geometry===e.geometry&&this.view?.constraintsInfo.spatialReference===e.spatialReference?e:new X1({geometry:this.geometry,spatialReference:this.view?.constraintsInfo.spatialReference})}get _rotation(){return new SAe({rotationEnabled:this.rotationEnabled})}get _zoom(){const e=this._get("_zoom"),i=this.lods||this.view?.constraintsInfo.lods,r=this.minZoom,s=this.maxZoom,n=this.minScale,o=this.maxScale,a=this.snapToZoom;return e&&e.lods===i&&e.minZoom===r&&e.maxZoom===s&&e.minScale===n&&e.maxScale===o&&e.snapToZoom===a?e:new TAe({lods:i,minZoom:r,maxZoom:s,minScale:n,maxScale:o,snapToZoom:a})}canZoomInTo(e){const i=this.effectiveMaxScale;return i===0||e>=i}canZoomOutTo(e){const i=this.effectiveMinScale;return i===0||e<=i}constrain(e,i){return this._zoom.constrain(e,i),this._rotation.constrain(e,i),this._geometry.constrain(e,i),this.customConstraints.forEach(r=>r.constrain(e,i)),e}constrainByGeometry(e){return this._geometry.constrain(e),this.customConstraints.forEach(i=>i.applyPanConstraint?.(e)),e}fit(e){return this._zoom.fit(e)}zoomToScale(e){return this._zoom.zoomToScale(e)}scaleToZoom(e){return this._zoom.scaleToZoom(e)}snapScale(e){return this._zoom.snapToClosestScale(e)}snapToNextScale(e){return this._zoom.snapToNextScale(e)}snapToPreviousScale(e){return this._zoom.snapToPreviousScale(e)}};u([p({readOnly:!0})],wn.prototype,"effectiveLODs",null),u([p({readOnly:!0})],wn.prototype,"effectiveMinScale",null),u([p({readOnly:!0})],wn.prototype,"effectiveMaxScale",null),u([p({readOnly:!0})],wn.prototype,"effectiveMinZoom",null),u([p({readOnly:!0})],wn.prototype,"effectiveMaxZoom",null),u([p({types:rtt,value:null})],wn.prototype,"geometry",null),u([p({type:[Jh]})],wn.prototype,"lods",void 0),u([p()],wn.prototype,"minScale",void 0),u([p()],wn.prototype,"maxScale",void 0),u([p()],wn.prototype,"minZoom",void 0),u([p()],wn.prototype,"maxZoom",void 0),u([p()],wn.prototype,"rotationEnabled",void 0),u([p()],wn.prototype,"snapToZoom",void 0),u([p({type:Ee})],wn.prototype,"customConstraints",void 0),u([p()],wn.prototype,"view",void 0),u([p({readOnly:!0})],wn.prototype,"version",null),u([p({type:X1,readOnly:!0})],wn.prototype,"_geometry",null),u([p({type:SAe})],wn.prototype,"_rotation",null),u([p({readOnly:!0,type:TAe})],wn.prototype,"_zoom",null),wn=u([A("esri.views.2d.MapViewConstraints")],wn);const rhe=wn;let ll=class extends ue{constructor(e){super(e),this.constraints=null,this.ready=!1,this.resizeAlign="center",this.addHandles([H(()=>this.constraints?.version,i=>{this.constraints&&i&&this.ready&&(this.state.viewpoint=this.constraints.fit(this.state.paddedViewState.viewpoint))},Gt)])}get center(){if(!this.ready)return this._get("center");const{center:e,spatialReference:i}=this.state.paddedViewState;return this.state.commitProperty("id"),new ke({x:e[0],y:e[1],spatialReference:i})}set center(e){if(e==null)return;if(!this.ready)return void this._set("center",e);let i;try{i=this._project(e,this.state.spatialReference)}catch(s){return void J.getLogger(this).error(new U("mapview:invalid-center","could not project the value in the view's spatial reference",{input:e,error:s}))}const r=this.viewpoint;tY(r,r,i),this.viewpoint=r}get extent(){return this.ready?(this.state.commitProperty("id"),this.state.paddedViewState.extent.clone()):this._get("extent")}set extent(e){if(e==null)return;if(!e.width||!e.height)return void J.getLogger(this).error(new U("mapview:invalid-extent","invalid extent size"));if(!this.ready)return this._set("extent",e),this._set("center",void 0),this._set("viewpoint",void 0),this._set("scale",void 0),void this._set("zoom",void 0);let i;try{i=this._project(e,this.state.spatialReference)}catch(s){return void J.getLogger(this).error(new U("mapview:invalid-extent","could not project the value in the view's spatial reference",{error:s}))}const r=this.viewpoint;eet(r,r,i,this.state.size,{constraints:this.constraints}),this.viewpoint=r}get padding(){return this.ready?this.state.padding:this._get("padding")}set padding(e){this.ready?(this.state.padding=e,this._set("padding",this.state.padding)):this._set("padding",e)}get resolution(){return this.ready?(this.state.commitProperty("id"),this.state.resolution):0}get rotation(){return this.ready?(this.state.commitProperty("id"),this.state.rotation):this._get("rotation")}set rotation(e){if(isNaN(e))return;if(!this.ready)return void this._set("rotation",e);const i=this.viewpoint;het(i,i,e),this.viewpoint=i}get scale(){return this.ready?(this.state.commitProperty("id"),this.state.scale):this._get("scale")}set scale(e){if(!e||isNaN(e))return;if(!this.ready){this._set("scale",e),this._set("zoom",void 0);const r=this._get("extent");return void(r&&(this._set("extent",void 0),this._set("center",r.center)))}const i=this.viewpoint;Jue(i,i,e),this.viewpoint=i}get viewpoint(){return this.ready?this.state.paddedViewState.viewpoint.clone():this._get("viewpoint")}set viewpoint(e){if(e==null)return;if(!this.ready)return this._set("viewpoint",e),this._set("extent",void 0),this._set("center",void 0),this._set("zoom",void 0),void this._set("scale",void 0);let i,r;try{i=this._project(e,this.state.spatialReference),!e.scale||isNaN(e.scale)?r=new U("mapview:invalid-viewpoint",`invalid scale value of ${e.scale}`):e.targetGeometry==null&&(r=new U("mapview:invalid-viewpoint","geometry not defined"))}catch(n){r=new U("mapview:invalid-viewpoint","could not project the value in the view's spatial reference",{error:n})}if(r)return void J.getLogger(this).error(r);this._scaleBeforeChangingSpatialReference=null;const s=new Jr({targetGeometry:new ke,scale:0,rotation:0});xl(s,i),this.constraints?.constrain(s,this.state.paddedViewState.viewpoint),this.state.viewpoint=s,this._set("viewpoint",s)}get visibleArea(){return this.ready?this.state.visibleArea:null}get zoom(){return this.ready?this.constraints?.scaleToZoom(this.scale)??-1:this._get("zoom")}set zoom(e){if(!(e>=0))return;if(!this.ready){this._set("zoom",e),this._set("scale",void 0);const s=this._get("extent");return void(s&&(this._set("extent",void 0),this._set("center",s.center)))}const i=this.constraints?.zoomToScale(e)??0;if(!i)return void this._set("zoom",-1);const r=this.viewpoint;Jue(r,r,i),this.viewpoint=r,this._set("zoom",this.constraints?.scaleToZoom(this.scale)??-1)}getUserStartupOptions(e){if(!e[0]&&!e[1])return{center:void 0,rotation:void 0,scale:void 0};const{padding:i,constraints:r}=this,s=this._get("center"),n=this._get("extent"),o=this._get("scale"),a=this._get("rotation"),l=this._get("viewpoint"),c=this._get("zoom"),h=c!=null&&r!=null&&r.zoomToScale(c)||void 0;let d,f,m;const y=l?.rotation,v=l?.targetGeometry;v?.type==="extent"?d=v:v?.type==="point"&&(f=v,m=l?.scale);const _=n??d;return{center:s??f??_?.center,rotation:a??y,scale:(o??h??m??(_&&lj(_,[e[0]-i.left-i.right,e[1]-i.top-i.bottom])))||void 0}}startup(e,i,r,s){const n=e.targetGeometry;try{this._project(e,r)}catch(o){J.getLogger(this).warn(new sh("mapview:startup-projection-error","projection of initial viewpoint to the view's spatial reference, defaulting to the initial viewpoint.",{center:n.toJSON(),spatialReference:r,error:o})),e.targetGeometry=s||new ke({x:0,y:0,spatialReference:r})}this.constraints?.fit(e),this._set("state",new Rie({padding:this.padding,size:i,viewpoint:e})),this._set("ready",!0)}teardown(){this._set("ready",!1);const{center:[e,i],spatialReference:r,rotation:s,scale:n}=this.state.paddedViewState,o=new ke({x:e,y:i,spatialReference:r});this._set("viewpoint",null),this._set("extent",null),this._set("center",o),this._set("zoom",-1),this._set("rotation",s),this._set("scale",n),this._set("state",null)}changeSpatialReference(e){const i=this.state.paddedViewState.clone();if(this._scaleBeforeChangingSpatialReference==null)this._scaleBeforeChangingSpatialReference=i.scale;else{const l=i.viewpoint.clone();l.scale=this._scaleBeforeChangingSpatialReference,i.viewpoint=l}const r=i.clone(),[s,n]=i.center;let o=null;try{o=this._project(new ke({x:s,y:n,spatialReference:i.spatialReference}),e)}catch(l){Kee()||J.getLogger(this).warn(new sh("mapview:spatial-reference-change","could not project the view's center to the new spatial reference",{center:o?.toJSON(),spatialReference:e,error:l}))}o||(o=new ke({x:0,y:0,spatialReference:e}));const a=tY(new Jr({targetGeometry:new ke,scale:0,rotation:0}),i.viewpoint,o);r.viewpoint=a;try{const c=[i.size[0]/2,i.size[1]/2],h=[c[0]+20,c[1]],d=i.toMap([0,0],h),{x:f,y:m}=this._project(new ke({x:d[0],y:d[1],spatialReference:i.spatialReference}),e);d[0]=f,d[1]=m,r.toScreen(d,d);const y=aet(c,d,h),v=Math.hypot(d[0]-c[0],d[1]-c[1])/20;!Number.isFinite(v)||Math.abs(v)>4?(a.rotation=0,a.targetGeometry=new ke({x:0,y:0,spatialReference:e})):(a.scale*=v,a.scale>X("mapview-srswitch-adjust-rotation-scale-threshold")?a.rotation=0:a.rotation+=Number.isFinite(y)?y:0)}catch{}this._get("constraints")?.constrain(a,void 0),this._get("state").viewpoint=a}resize(e,i){if(!this.ready)return;const r=this.state;let s=this.state.paddedViewState.viewpoint;const n=this.state.paddedViewState.size.slice();r.size=[e,i],uet(s,s,n,this.state.paddedViewState.size,this.resizeAlign),s=this.constraints?.constrain(s,void 0)??s,this.state.viewpoint=s}toMap(e){if(!this.ready)return null;const i=[0,0],[r,s]=this.state.toMap(i,[e.x,e.y]),n=this.state.spatialReference;return new ke({x:r,y:s,spatialReference:n})}toScreen(e,i){if(!this.ready)return null;const r=this._project(e,this.state.spatialReference),s=[r.x,r.y];return i?.pickClosestTarget===!1||this.state.paddedViewState.wrapMapCoordinate(s,s),this.state.toScreen(s,s),wo(s[0],s[1])}_project(e,i){const r=e?.targetGeometry||e;if(!i)return e;if(!r)return null;if(i.imageCoordinateSystem||r.spatialReference?.imageCoordinateSystem||rs(i,r.spatialReference))return e;const s=Id(r,i);if(!s)throw new U("mapview:projection-not-possible","projecting input geometry to target spatial reference returned a null value",{geometry:r,spatialReference:i});return stt(e)?(e.targetGeometry=s,e):s}};function stt(t){return t?.declaredClass==="esri.Viewpoint"}u([p({type:ke})],ll.prototype,"center",null),u([p()],ll.prototype,"constraints",void 0),u([p({type:gi})],ll.prototype,"extent",null),u([p({value:{top:0,right:0,bottom:0,left:0},cast:t=>({top:0,right:0,bottom:0,left:0,...t})})],ll.prototype,"padding",null),u([p()],ll.prototype,"ready",void 0),u([p()],ll.prototype,"resizeAlign",void 0),u([p({readOnly:!0})],ll.prototype,"resolution",null),u([p({type:Number})],ll.prototype,"rotation",null),u([p({type:Number})],ll.prototype,"scale",null),u([p({readOnly:!0})],ll.prototype,"state",void 0),u([p({type:Jr})],ll.prototype,"viewpoint",null),u([p({readOnly:!0})],ll.prototype,"visibleArea",null),u([p()],ll.prototype,"zoom",null),ll=u([A("esri.views.2d.ViewStateManager")],ll);function Pie(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function EAe(t,e){return e.some(i=>Pie(t,i))}function Die(t,e){const{button:i,pointerType:r}=t;return r!=="touch"&&e.some(s=>s==="primary"&&i===0||s==="secondary"&&i===2||s==="tertiary"&&i===1)}function MR(t,{dragPrimary:e,dragSecondary:i,dragTertiary:r}){return[{key:"primary",value:e},{key:"secondary",value:i},{key:"tertiary",value:r}].filter(s=>s.value===t).map(s=>s.key)}let she=class extends ss{constructor(e,i){super(!0),this._view=e,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r,i))}_handleDoubleClick(e,i){Pie(e.data,"primary")&&(e.stopPropagation(),i?this._view.mapViewNavigation.zoomOut([e.data.x,e.data.y]):this._view.mapViewNavigation.zoomIn([e.data.x,e.data.y]))}},ntt=class extends ss{constructor(e,i,r){super(!0),this.view=e,this.pointerType=i,this.registerIncoming("double-tap-drag",r,s=>this._handleDoubleTapDrag(s))}_handleDoubleTapDrag(e){const{data:i}=e,{pointerType:r}=i;if(r!==this.pointerType)return;e.stopPropagation();const{action:s,delta:n}=i,{view:o}=this,{mapViewNavigation:a}=o;switch(s){case"begin":{const{scale:l}=o;this._startScale=l,this._currentScale=l,this._previousDelta=n,a.begin();break}case"update":{if(this._previousDelta.y===n.y)return;this._previousDelta=n;const l=1.015**n.y,c=this._startScale*l,h=c/this._currentScale;a.setViewpointImmediate(h),this._currentScale=c;break}case"end":{const{constraints:l}=o,{effectiveLODs:c,snapToZoom:h}=l;if(!h||!c)return void a.end();const d=l.snapScale(this._currentScale),f=(n.y>0?Math.max(d,l.snapToPreviousScale(this._startScale)):Math.min(d,l.snapToNextScale(this._startScale)))/this._currentScale;a.zoom(f).then(()=>{a.end()});break}}}},wD=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const i=e.data,r=i.pointers.size;switch(i.action){case"start":this._currentCount=r,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){this._startEvent=e,this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},ott=class extends ss{constructor(e,i,r){super(!0),this.view=e,this.pointerActions=i,this.registerIncoming("drag",r,s=>this._handleDrag(s)),this.registerIncoming("pointer-down",()=>this.stopMomentumNavigation())}onInstall(e){super.onInstall(e),this._dragEventSeparator=new wD({start:(i,r)=>{this.view.mapViewNavigation.pan.begin(this.view,r.data),r.stopPropagation()},update:(i,r)=>{this.view.mapViewNavigation.pan.update(this.view,r.data),r.stopPropagation()},end:(i,r)=>{this.view.mapViewNavigation.pan.end(this.view,r.data),r.stopPropagation()},condition:(i,r)=>i===1&&EAe(r.data,this.pointerActions)})}_handleDrag(e){const i=this.view.mapViewNavigation;i.pinch.zoomMomentum||i.pinch.rotateMomentum?this.stopMomentumNavigation():this._dragEventSeparator.handle(e)}stopMomentumNavigation(){this.view.mapViewNavigation.pan.stopMomentumNavigation()}},att=class extends ss{constructor(e,i,r){super(!0),this._view=e,this.pointerActions=i;const s=this._view.mapViewNavigation;this._dragEventSeparator=new wD({start:(n,o)=>{s.rotate.begin(this._view,o.data),o.stopPropagation()},update:(n,o)=>{s.rotate.update(this._view,o.data),o.stopPropagation()},end:(n,o)=>{s.rotate.end(),o.stopPropagation()},condition:(n,o)=>n===1&&EAe(o.data,this.pointerActions)}),this.registerIncoming("drag",r,n=>this._dragEventSeparator.handle(n))}};function Te(t){const e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function ne(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function se(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t}function oe(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function ye(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Lie(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function CAe(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function ltt(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function $Ae(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function A$(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function AAe(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function MAe(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function OAe(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function IAe(t,e=0,i=1){return t[0]=Math.min(Math.max(t[0],e),i),t[1]=Math.min(Math.max(t[1],e),i),t[2]=Math.min(Math.max(t[2],e),i),t}function ctt(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function ie(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function Xn(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t}function xr(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return Math.sqrt(i*i+r*r+s*s)}function ro(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return i*i+r*r+s*s}function Yo(t){const e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}function wd(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function utt(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function ae(t,e){const i=e[0],r=e[1],s=e[2];let n=i*i+r*r+s*s;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n),t}function de(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function lt(t,e,i){const r=e[0],s=e[1],n=e[2],o=i[0],a=i[1],l=i[2];return t[0]=s*l-n*a,t[1]=n*o-r*l,t[2]=r*a-s*o,t}function htt(t,e,i){const r=e[0],s=e[1],n=e[2],o=i[0],a=i[1],l=i[2],c=s*l-n*a,h=n*o-r*l,d=r*a-s*o,f=Math.sqrt(c*c+h*h+d*d);return t[0]=c/f,t[1]=h/f,t[2]=d/f,t}function dr(t,e,i,r){const s=e[0],n=e[1],o=e[2];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t[2]=o+r*(i[2]-o),t}function dtt(t,e,i,r,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),h=o*(3-2*n);return t[0]=e[0]*a+i[0]*l+r[0]*c+s[0]*h,t[1]=e[1]*a+i[1]*l+r[1]*c+s[1]*h,t[2]=e[2]*a+i[2]*l+r[2]*c+s[2]*h,t}function ptt(t,e,i,r,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,h=3*n*a,d=3*l*o,f=l*n;return t[0]=e[0]*c+i[0]*h+r[0]*d+s[0]*f,t[1]=e[1]*c+i[1]*h+r[1]*d+s[1]*f,t[2]=e[2]*c+i[2]*h+r[2]*d+s[2]*f,t}function ftt(t,e=1){const i=dD,r=2*i()*Math.PI,s=2*i()-1,n=Math.sqrt(1-s*s)*e;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t[2]=s*e,t}function st(t,e,i){const r=e[0],s=e[1],n=e[2];return t[0]=i[0]*r+i[4]*s+i[8]*n+i[12],t[1]=i[1]*r+i[5]*s+i[9]*n+i[13],t[2]=i[2]*r+i[6]*s+i[10]*n+i[14],t}function ac(t,e,i){const r=e[0],s=e[1],n=e[2];return t[0]=r*i[0]+s*i[3]+n*i[6],t[1]=r*i[1]+s*i[4]+n*i[7],t[2]=r*i[2]+s*i[5]+n*i[8],t}function Uc(t,e,i){const r=i[0],s=i[1],n=i[2],o=i[3],a=e[0],l=e[1],c=e[2],h=s*c-n*l,d=n*a-r*c,f=r*l-s*a,m=s*f-n*d,y=n*h-r*f,v=r*d-s*h,_=2*o;return t[0]=a+h*_+2*m,t[1]=l+d*_+2*y,t[2]=c+f*_+2*v,t}function mtt(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[0],n[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),n[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function gtt(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),n[1]=s[1],n[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function ytt(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),n[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),n[2]=s[2],t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function RAe(t,e){ae(nhe,t),ae(ohe,e);const i=de(nhe,ohe);return i>1?0:i<-1?Math.PI:Math.acos(i)}const nhe=$(),ohe=$();function vtt(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Qn(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function M$(t,e){if(t===e)return!0;const i=t[0],r=t[1],s=t[2],n=e[0],o=e[1],a=e[2],l=So();return Math.abs(i-n)<=l*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-o)<=l*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-a)<=l*Math.max(1,Math.abs(s),Math.abs(a))}function kS(t,e,i){const r=i[0]-e[0],s=i[1]-e[1],n=i[2]-e[2];let o=r*r+s*s+n*n;return o>0?(o=1/Math.sqrt(o),t[0]=r*o,t[1]=s*o,t[2]=n*o,t):(t[0]=0,t[1]=0,t[2]=0,t)}const Ri=ye,_tt=Lie,btt=CAe,za=xr,O$=ro,Ba=Te,pU=Yo,ahe=Object.freeze(Object.defineProperty({__proto__:null,abs:A$,add:oe,angle:RAe,bezier:ptt,ceil:ltt,clamp:IAe,copy:ne,cross:lt,crossAndNormalize:htt,direction:kS,dist:za,distance:xr,div:btt,divide:CAe,dot:de,equals:M$,exactEquals:Qn,floor:$Ae,hermite:dtt,inverse:utt,len:Ba,length:Te,lerp:dr,max:OAe,min:MAe,mul:_tt,multiply:Lie,negate:wd,normalize:ae,random:ftt,rotateX:mtt,rotateY:gtt,rotateZ:ytt,round:ctt,scale:ie,scaleAndAdd:Xn,set:se,sign:AAe,sqrDist:O$,sqrLen:pU,squaredDistance:ro,squaredLength:Yo,str:vtt,sub:Ri,subtract:ye,transformMat3:ac,transformMat4:st,transformQuat:Uc},Symbol.toStringTag,{value:"Module"}));function qd(t){let e=t*t;return t<0&&(e*=-1),e}function wtt(t){return t.translation[0]=0,t.translation[1]=0,t.translation[2]=0,t.heading=0,t.tilt=0,t}function lY(t,e,i){const r=i,s=t.state,n=t.device,o=e.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(r.translation[0]=qd(s.axes[0]),r.translation[1]=qd(s.axes[1]),r.translation[2]=qd(s.buttons[7])-qd(s.buttons[6]),r.heading=qd(s.axes[2]),r.tilt=qd(s.axes[3])):n.deviceType==="spacemouse"&&(r.translation[0]=1.2*qd(s.axes[0]),r.translation[1]=1.2*qd(s.axes[1]),r.translation[2]=2*-qd(s.axes[2]),r.heading=1.2*qd(s.axes[5]),r.tilt=1.2*qd(s.axes[3])),r.tilt*=o,ie(r.translation,r.translation,a),r}function lhe(t,e){const i=e;return i.translation[0]=t[1]-t[0],i.translation[1]=t[3]-t[2],i.translation[2]=t[4]-t[5],i.heading=t[7]-t[6],i.tilt=t[8]-t[9],i.zoom=t[10]-t[11],i}function v4(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let xtt=class extends ss{constructor(e){super(!0),this._view=e,this._frameTask=null,this._watchHandles=new ng,this._currentDevice=null,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._handle=this.registerIncoming("gamepad",i=>this._handleGamePadEvent(i)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([H(()=>this._view.navigation.gamepad?.enabled,i=>{i?(this._handle.resume(),this._frameTask||(this._frameTask=qm({update:r=>this._frameUpdate(r.deltaTime)}))):(this._handle.pause(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null))},Nt)])}onUninstall(){this._watchHandles.removeAll(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null),super.onUninstall()}_handleGamePadEvent(e){const i=this._view.navigation.gamepad.device;i&&e.data.device!==i||this._currentDevice&&this._currentDevice!==e.data.device||(e.data.action==="end"?(this._currentDevice=null,wtt(this._transformation)):(this._currentDevice=e.data.device,lY(e.data,this._view.navigation.gamepad,this._transformation)),this._frameTask?.resume())}_frameUpdate(e){const i=this._transformation;if(v4(i))return void this._frameTask?.pause();const r=this._view.viewpoint.clone(),s=this._view.navigation.gamepad.velocityFactor,n=Ttt*s*e;cj(r,r,[i.translation[0]*n,-i.translation[1]*n]);const o=1+i.translation[2]*Ett*e,a=this._view.constraints.rotationEnabled?-i.heading*Stt*e:0,l=this._view.size,c=[l[0]/2,l[1]];cAe(r,r,o,a,c,l);const h=this._view.constraints.constrain(r,this._view.viewpoint);this._view.viewpoint=h}};const Stt=.06,Ttt=.7,Ett=6e-4;function Nie(t){const e=()=>t(document.visibilityState==="visible");return document.addEventListener("visibilitychange",e),$i(()=>document.removeEventListener("visibilitychange",e))}let Ctt=class extends ss{constructor(e,i,r){super(!0),this.view=e,this.keys=i,this._isSticky=!1,this._pressedKeys=new Set,this._timeout=void 0,this._currentDirection=void 0,this._stickyKeyDuration=200,this._handleKey=s=>{const n=this._keyMap[s.data.key];if(s.modifiers.has("Meta")||s.modifiers.has("Control"))return void this._stopMovement();if(n==null)return;s.stopPropagation(),s.preventDefault();const o=s.type==="key-down";if(this._pressedKeys[o?"add":"delete"](n),o){if(this._direction===n)return;this._direction=n,this._isSticky=!1,this._setTimeout(()=>{this._isSticky&&this._handlePopKey()})}else{const a=this._timeout===void 0,l=this._pressedKeys.size>0;a||l?this._handlePopKey():this._isSticky=!0}},this._handlePopKey=()=>{this._direction=Array.from(this._pressedKeys).pop(),this._direction==null&&this._stopMovement()},this._stopMovement=()=>{this._isSticky=!1,this._direction=void 0,this._pressedKeys.clear(),this._setTimeout(void 0)},this._keyMap={[i.left]:"left",[i.right]:"right",[i.up]:"up",[i.down]:"down"},this.registerIncoming("key-down",r,this._handleKey),this.registerIncoming("key-up",r,this._handleKey),this.registerIncoming("blur",r,this._stopMovement),this._visibilityHandle=Nie(s=>s?null:this._stopMovement())}onUninstall(){this._stopMovement(),this._visibilityHandle?.remove()}get _direction(){return this._currentDirection}set _direction(e){const i=this._currentDirection!=null;if(e!=null){if(i||this.view.mapViewNavigation.begin(),this._currentDirection!==e)switch(e){case"left":this.view.mapViewNavigation.continuousPanLeft();break;case"right":this.view.mapViewNavigation.continuousPanRight();break;case"up":this.view.mapViewNavigation.continuousPanUp();break;case"down":this.view.mapViewNavigation.continuousPanDown()}}else i&&this.view.mapViewNavigation.stop();this._currentDirection=e}_setTimeout(e){clearTimeout(this._timeout),this._timeout=e===void 0?void 0:setTimeout(()=>{this._timeout=void 0,e()},this._stickyKeyDuration)}},$tt=class extends ss{constructor(e,i,r){super(!0),this.view=e,this.keys=i,this._keyToDirection=new Map,this._pressed=!1,this._addKeysMapping(i),this.registerIncoming("key-down",r,s=>this._handleKeyDown(s)),this.registerIncoming("key-up",r,s=>this._handleKeyUp(s)),this.registerIncoming("blur",r,()=>this._handleStop()),this._visibilityHandle=Nie(s=>s?null:this._handleStop())}onUninstall(){this._visibilityHandle?.remove(),this._handleStop()}_addKeysMapping(e){this._addKeyMapping(e.clockwise,"clockwise"),this._addKeyMapping(e.counterClockwise,"counterClockwise"),this._addKeyMapping(e.reset,"reset")}_addKeyMapping(e,i){for(const r of e)this._keyToDirection.set(r,i)}_handleKeyDown(e){e.data.repeat||this._handleKey(e,!0)}_handleKeyUp(e){this._handleKey(e,!1)}_handleStop(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}_handleKey(e,i){const r=e.modifiers;if(r.size>0&&!r.has("Shift")||!this.view.constraints.rotationEnabled)return;const s=this._keyToDirection.get(e.data.key);if(this._pressed=s!=null,this._pressed){if(e.preventDefault(),i)switch(this.view.mapViewNavigation.begin(),s){case"clockwise":this.view.mapViewNavigation.continuousRotateClockwise();break;case"counterClockwise":this.view.mapViewNavigation.continuousRotateCounterclockwise();break;case"reset":this.view.mapViewNavigation.resetRotation()}else this._pressed=!1,this.view.mapViewNavigation.stop();e.stopPropagation()}}};var L2;(function(t){t[t.IN=0]="IN",t[t.OUT=1]="OUT"})(L2||(L2={}));let Att=class extends ss{constructor(e,i,r){super(!0),this.view=e,this.keys=i,this._keysToZoomAction={},this.registerIncoming("key-down",r,s=>this._handleKeyDown(s)),i.zoomIn.forEach(s=>this._keysToZoomAction[s]=L2.IN),i.zoomOut.forEach(s=>this._keysToZoomAction[s]=L2.OUT)}_handleKeyDown(e){this._handleKey(e)}_handleKey(e){const i=e.modifiers;if(i.size>0&&!i.has("Shift"))return;const{key:r}=e.data;if(!(r in this._keysToZoomAction))return;const s=this._keysToZoomAction[r],{mapViewNavigation:n}=this.view;let o=null;switch(s){case L2.IN:o=n.zoomIn();break;case L2.OUT:o=n.zoomOut();break;default:return}n.begin(),o.then(()=>n.end()),e.stopPropagation()}};const Mtt=.6;let Ott=class extends ss{constructor(e,i){super(!0),this._view=e,this._canZoom=!0,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(e){if(this._view.navigation.actionMap.mouseWheel!=="zoom"||(e.preventDefault(),e.stopPropagation(),!this._canZoom))return;const i=this._view.mapViewNavigation,{x:r,y:s,deltaY:n}=e.data,o=1/Mtt**(1/60*n),a=i.zoom(o,[r,s]);a&&(this._canZoom=!1,a.catch(()=>{}).then(()=>{this._canZoom=!0,i.end()}))}},Itt=class extends ss{constructor(e){super(!0),this.view=e,this.registerIncoming("drag",r=>this._handleDrag(r)),this.registerIncoming("pointer-down",()=>this._stopMomentumNavigation());const i=this.view.mapViewNavigation;this._dragEventSeparator=new wD({start:(r,s)=>{i.pinch.begin(this.view,s.data),s.stopPropagation()},update:(r,s)=>{i.pinch.update(this.view,s.data),s.stopPropagation()},end:(r,s)=>{i.pinch.end(this.view),s.stopPropagation()},condition:r=>r>=2})}_handleDrag(e){this._dragEventSeparator.handle(e)}_stopMomentumNavigation(){this.view.mapViewNavigation.pinch.stopMomentumNavigation()}};function che(t){const e=t.native;return e?{buttons:e.buttons.map(i=>i.pressed?i.value||1:0),axes:e.axes.map(i=>Dtt(i,t.axisThreshold))}:{buttons:[],axes:[]}}function Rtt(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let i=0;i<t.axes.length;i++)if(t.axes[i]!==e.axes[i])return!1;for(let i=0;i<t.buttons.length;i++)if(t.buttons[i]!==e.buttons[i])return!1;return!0}function Ptt(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function Dtt(t,e){const i=Math.abs(t);return i<e?0:Math.sign(t)*(i-e)/(1-e)}let Ltt=class{constructor(e,i){this._element=e,this._input=i,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,che(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const r="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=r&&s,this.supported&&(uhe(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const i=new vie(e);i.deviceType!=="unknown"&&(this._inputDevices[e.index]=i,this._input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=qm({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),i=this._element.contains(document.activeElement),r=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!i;uhe(s=>{const n=this._inputDevices[s.index];if(!n)return;const o=this._latestUpdate[s.index],a=che(n),l=r||Ptt(a);o&&(o.timestamp===s.timestamp||!o.active&&l||Rtt(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_emitGamepadEvent(e,i,r){const s=this._latestUpdate[e.index],n=s&&s.active;if(!n&&!r)return;const o=!n&&r?"start":n&&r?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:i,active:r},this._callback&&this._callback({device:this._inputDevices[e.index],state:i,action:o})}};function Ntt(t){if(!t||!t.connected)return!1;for(let e=0;e<t.axes.length;e++)if(isNaN(t.axes[e]))return!1;return!0}function uhe(t){for(const e of navigator.getGamepads())Ntt(e)&&t(e)}const hhe=X("edge"),Ftt=X("chrome"),ktt=X("ff"),ztt=X("safari"),dhe="esri-view-surface",uT={touchNone:`${dhe}--touch-none`,touchPan:`${dhe}--touch-pan`};let Fie=class PAe{constructor(e,i){this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new Ltt(e,i),this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>this._releasePointerCaptureSafe(e)),this._activePointerCaptures.clear(),this._gamepadSource=Ce(this._gamepadSource),this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const i in this._active)if(!e||!e.has(i)){const r=this._active[i];this._element.removeEventListener(eH[i],r),delete this._active[i]}e&&e.forEach(i=>{if(!this._active[i]&&eH[i]){const r=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener(eH[i],r),this._active[i]=r}}),this._gamepadSource&&(this._gamepadSource.hasEventListeners=e?.has("gamepad")??!1)}setPointerCapture(e,i){i?this._setPointerCaptureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?uT.touchNone:uT.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?uT.touchPan:uT.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(uT.touchNone),this._element.classList.remove(uT.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCaptureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,i){const r=E$e(this._element,e);return PAe.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),i.x=r.x,i.y=r.y,i}_handleKey(e,i){const{key:r}=i;r&&e==="key-up"&&this._keyDownState.delete(r);const s={native:i,key:r,repeat:!!r&&this._keyDownState.has(r)};r&&e==="key-down"&&this._keyDownState.add(s.key),this._callback(e,s)}_handlePointer(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(e,r)}_handlePointerPreventDefault(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(e,r)}_getDeltaFromTrackpadOrMouseWheel(e){return e.shiftKey&&X("mac")&&e.deltaY===0?e.deltaX:e.deltaY}_handleMouseWheel(e,i){let r=this._getDeltaFromTrackpadOrMouseWheel(i);switch(i.deltaMode){case 0:hhe&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}hhe?r*=.7:Ftt||ztt?r*=.6:ktt&&(r*=1.375);const s=100,n=Math.abs(r);n>s&&(r=r/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:r});this._callback(e,o)}_handlePointerCaptureLost(e,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(e,i)}_handleDefault(e,i){const r={native:i};i.preventDefault(),this._callback(e,r)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};Fie.test={disableSubpixelCoordinates:!1};const eH={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let DAe=class extends ss{constructor(){super(!0),this.registerIncoming("context-menu",e=>e.data.native.preventDefault())}};const qa={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};function fU(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function Utt(t,e){const i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)}function Btt(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:wo()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[x,S]=t,[C,T]=[S.x-x.x,S.y-x.y];return e.radius=Math.sqrt(C*C+T*T)/2,e.center.x=(x.x+S.x)/2,e.center.y=(x.y+S.y)/2,e}let i=0,r=0;for(let x=0;x<t.length;x++)i+=t[x].x,r+=t[x].y;i/=t.length,r/=t.length;const s=t.map(x=>x.x-i),n=t.map(x=>x.y-r);let o=0,a=0,l=0,c=0,h=0,d=0,f=0;for(let x=0;x<s.length;x++){const S=s[x],C=n[x],T=S*S,M=C*C;o+=T,a+=M,l+=S*C,c+=T*S,h+=M*C,d+=S*M,f+=C*T}const m=.5*(c+d),y=.5*(h+f),v=o*a-l*l,_=(m*a-y*l)/v,b=(o*y-l*m)/v,w=wo(_+i,b+r);return{radius:Math.sqrt(_*_+b*b+(o+a)/t.length),center:w}}function Px(t){const{native:e}=t,{pointerId:i,button:r,pointerType:s}=e;return s==="mouse"?`${i}:${r}`:`${s}`}let Vtt=class extends ss{constructor(e=qa.maximumDoubleClickDelay,i=qa.maximumDoubleClickDistance,r=qa.maximumDoubleTouchDelay,s=qa.maximumDoubleTouchDistance,n=pA){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=n,this._doubleTapDragReady=!1,this._doubleTapDragActive=!1,this._dragStartCenter=wo(0,0),this._pointerState=new Map,this._doubleTapDrag=this.registerOutgoing("double-tap-drag"),this._dragEventSeparator=new wD({start:(o,a)=>this._dragStart(o,a),update:(o,a)=>this._dragUpdate(a),end:(o,a)=>this._dragEnd(a)}),this.registerIncoming("drag",o=>this._dragEventSeparator.handle(o)),this.registerIncoming("pointer-down",o=>this._handlePointerDown(o)),this.registerIncoming("pointer-up",()=>this._handlePointerUp())}onUninstall(){this._pointerState.forEach(e=>{e.doubleTapTimeout=Hi(e.doubleTapTimeout)})}get hasPendingInputs(){for(const e of this._pointerState.values())if(e.doubleTapTimeout!=null)return!0;return!1}_clearPointerDown(e){const i=this._pointerState.get(e);i&&(i.doubleTapTimeout=Hi(i.doubleTapTimeout),this._pointerState.delete(e),this.refreshHasPendingInputs())}_dragStart(e,i){if(!this._doubleTapDragReady||e!==1)return;this._doubleTapDragReady=!1,this._doubleTapDragActive=!0;const{data:r,modifiers:s}=i,{center:n}=r;this._dragStartCenter=n;const o=tH("begin",wo(0,0),r);this._doubleTapDrag.emit(o,void 0,s),i.stopPropagation()}_dragUpdate(e){if(!this._doubleTapDragActive)return;const{data:i,modifiers:r}=e,{center:s}=i,n=tH("update",wo(s.x-this._dragStartCenter.x,s.y-this._dragStartCenter.y),i);this._doubleTapDrag.emit(n,void 0,r),e.stopPropagation()}_dragEnd(e){if(!this._doubleTapDragActive)return;const{data:i,modifiers:r}=e,{center:s}=i,n=tH("end",wo(s.x-this._dragStartCenter.x,s.y-this._dragStartCenter.y),i);this._doubleTapDrag.emit(n,void 0,r),this._doubleTapDragActive=!1,e.stopPropagation()}_handlePointerDown(e){const{data:i}=e,r=Px(i),s=this._pointerState.get(r),{pointerType:n}=i.native;if(s){const o=n==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;this._clearPointerDown(r),fU(s.event.data,i)>o?this._storePointerDown(e):this._doubleTapDragReady=!0}else this._storePointerDown(e)}_handlePointerUp(){this._doubleTapDragReady=!1}_storePointerDown(e){const{data:i}=e,{pointerType:r}=i.native,s=Px(i),n=r==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._clearPointerDown(s),n);this._pointerState.set(s,{event:e,doubleTapTimeout:o}),this.refreshHasPendingInputs()}};function tH(t,e,i){const{button:r,buttons:s,pointer:n,pointers:o,pointerType:a,timestamp:l}=i;return{action:t,delta:e,button:r,buttons:s,pointer:n,pointers:o,pointerType:a,timestamp:l}}let LAe=class extends ss{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,i,r,s){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:i.buttons,timestamp:s,pointers:jtt(this._activePointerMap),pointer:i,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(e){const i=e.native.pointerId,r=HL(this._activePointerMap).angle,s={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(i,s);const n=_4(s,NAe(this._activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(r)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const i=e.native.pointerId,r=this._activePointerMap.get(i);r?r.event=e:this._addPointer(e)}_removePointer(e){const i=HL(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(i)}_updatePointerAngles(e){const i=HL(this._activePointerMap);this._activePointerMap.forEach(r=>{r.initialAngle=_4(r,i)-e,r.lastAngle=_4(r,i)-e})}_emitEvent(e,i,r){const s=HL(this._activePointerMap);this._drag.emit(this._createPayload(e,i,s,r),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const i=e.data.native.pointerId,r=e.timestamp;this._activePointerMap.get(i)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,r),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const i=e.data,r=i.currentEvent,s=e.timestamp;switch(i.action){case"start":case"update":this._isDragging?this._activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this._isCurrentDragSuppressed&&this._emitEvent("update",r,s)):(this._addPointer(r),this._emitEvent("added",r,s),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(r),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",r,s))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function NAe(t){const e=[];return t.forEach(i=>{e.push(wo(i.event.x,i.event.y))}),Btt(e)}function HL(t){const e=NAe(t);let i=0;return t.forEach(r=>{let s=_4(r,e),n=s-r.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=r.lastAngle+n,r.lastAngle=s;const o=s-r.initialAngle;i+=o}),i/=t.size||1,{angle:i,radius:e.radius,center:e.center}}function jtt(t){const e=new Map;return t.forEach((i,r)=>e.set(r,i.event)),e}function _4(t,e){const i=t.event,r=i.x-e.center.x,s=i.y-e.center.y;return Math.atan2(s,r)}var phe;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(phe||(phe={}));let FAe=class extends ss{constructor(e=qa.maximumDoubleClickDelay,i=qa.maximumDoubleClickDistance,r=qa.maximumDoubleTouchDelay,s=qa.maximumDoubleTouchDistance,n=pA){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=Px(i);if(!this._pointerState.has(r)){const s={downButton:i.native.button,x:i.x,y:i.y,immediateDoubleClick:null};this._pointerState.set(r,s),this.startCapturingPointer(i.native)}}_handlePointerUp(e){const i=e.data,r=Px(i),s=this._pointerState.get(r);if(s&&s.downButton===i.native.button){const n=s.immediateDoubleClick,o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;n?(n.timeoutHandle.remove(),fU(n,e.data)>o?this._startImmediateDoubleClick(e,s):(this._immediateDoubleClick.emit(e.data,void 0,n.modifiers),this._removeState(i))):fU(s,e.data)>o?this._removeState(i):this._startImmediateDoubleClick(e,s)}}_startImmediateDoubleClick(e,i){const r=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;i.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),r)}}_removeState(e){const i=Px(e);this._pointerState.delete(i),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}},kAe=class extends ss{constructor(e=qa.maximumClickDelay,i=qa.movementUntilMouseDrag,r=qa.movementUntilPenDrag,s=qa.movementUntilTouchDrag,n=qa.holdDelay,o=pA){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=i,this._movementUntilPenDrag=r,this._movementUntilTouchDrag=s,this._holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",a=>this._handlePointerDown(a)),this.registerIncoming("pointer-up",a=>this._handlePointerLoss(a,"pointer-up")),this.registerIncoming("pointer-capture-lost",a=>this._handlePointerLoss(a,"pointer-capture-lost")),this.registerIncoming("pointer-cancel",a=>this._handlePointerLoss(a,"pointer-cancel")),this._moveHandle=this.registerIncoming("pointer-move",a=>this._handlePointerMove(a)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=Hi(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=i.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(r);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const n={startEvent:i,previousEvent:i,startTimestamp:e.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(r,n),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_handlePointerMove(e){const i=e.data,r=i.native.pointerId,s=this._pointerState.get(r);s&&(s.isDragging?this._pointerDrag.emit(qL("update",s,i),void 0,s.modifiers):Utt(i,s.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(e),s.previousEvent=i)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const i=e.data,r=i.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=e.modifiers,s.isDragging=!0,r===s.startEvent.native.pointerId?this._pointerDrag.emit(qL("start",s,i)):this._pointerDrag.emit(qL("start",s,s.previousEvent),e.timestamp))})}_handlePointerLoss(e,i){const r=e.data,s=r.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(qL("end",n,i==="pointer-up"?r:n.previousEvent),void 0,n.modifiers):i==="pointer-up"&&n.downButton===r.native.button&&e.timestamp-n.startTimestamp<=this._maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(s),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}};function qL(t,e,i){return{action:t,startEvent:e.startEvent,previousEvent:e.previousEvent,currentEvent:i}}let zAe=class extends ss{constructor(e=qa.maximumDoubleClickDelay,i=qa.maximumDoubleClickDistance,r=qa.maximumDoubleTouchDelay,s=qa.maximumDoubleTouchDistance,n=pA){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",o=>this._handleImmediateClick(o)),this.registerIncoming("pointer-down",o=>this._handlePointerDown(o))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=Hi(e.doubleClickTimer))}get hasPendingInputs(){for(const e of this._pointerState.values())if(e.doubleClickTimer!=null)return!0;return!1}_clearDoubleClickTimer(e,i){const r=this._pointerState.get(e);r&&(r.doubleClickTimer=Hi(r.doubleClickTimer),i&&this._click.emit(r.event.data,void 0,r.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const i=this._pointerState.get(e);i.pointerDownCount===1&&this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_handleImmediateClick(e){const i=e.data,{pointerType:r}=i.native,s=Gtt(i);if(!this._pointerState.has(s))return void this._startClick(e);const n=this._pointerState.get(s),{data:o,modifiers:a}=n.event,l=r==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;fU(o,i)>l?(this._clearDoubleClickTimer(s,!0),this._startClick(e)):(this._clearDoubleClickTimer(s,!1),n.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const i=Px(e.data),r=this._pointerState.get(i);r&&(r.pointerDownCount+=1)}_startClick(e){const{data:i}=e,{native:{pointerType:r}}=i,s=Px(i),n=r==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(s),n);this._pointerState.set(s,{event:e,doubleClickTimer:o,pointerDownCount:1}),this.refreshHasPendingInputs()}};function Gtt(t){const{pointerId:e,pointerType:i,button:r}=t.native;return i==="mouse"?`${e}:${r}`:`${i}`}const WL={counter:"Control",pan:{left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},zoom:{zoomIn:["=","+"],zoomOut:["-","_"]},rotate:{clockwise:["a","A"],counterClockwise:["d","D"],reset:["n","N"]}},fhe=Symbol("handles");let u1=class extends ue{initialize(){const e=()=>this.view?.ready;this.addHandles([gn(()=>!e(),()=>this._disconnect()),gn(e,()=>this._connect())])}destroy(){this._disconnect()}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}get multiTouchActive(){return this._inputManager?.multiTouchActive??!1}isModifierKeyDown(e){return this._inputManager?.isModifierKeyDown(e)??!1}_disconnect(){this.view.viewEvents.disconnect(),this.removeHandles(fhe),this._inputManager=Ce(this._inputManager)}_connect(){const e=this.view.surface,i=new Fie(e,this.view.input),r=[new FAe,new kAe,new zAe,new LAe(this.view.navigation),new Vtt],s=new Du({eventSource:i,recognizers:r}),n=new ott(this.view,["primary"]),o=new att(this.view,["secondary"]);s.installHandlers("prevent-context-menu",[new DAe],Pm.INTERNAL),s.installHandlers("navigation",[new Itt(this.view),new xtt(this.view),new Ott(this.view),new she(this.view),new she(this.view,[WL.counter]),n,new Ctt(this.view,WL.pan),new Att(this.view,WL.zoom),new $tt(this.view,WL.rotate),o,new ntt(this.view,"touch")],Pm.INTERNAL),this.view.viewEvents.connect(s),this._source=i,this._inputManager=s,this.addHandles([H(()=>this.view?.navigation?.browserTouchPanEnabled,a=>{this._source&&(this._source.browserTouchPanningEnabled=!a)},Nt),H(()=>{const{actionMap:a}=this.view.navigation;return{panActions:MR("pan",a),rotateActions:MR("rotate",a)}},({panActions:a,rotateActions:l})=>{n.pointerActions=a,o.pointerActions=l},St)],fhe)}get test(){}};u([p()],u1.prototype,"view",void 0),u([p()],u1.prototype,"latestPointerType",null),u([p()],u1.prototype,"latestPointerLocation",null),u([p()],u1.prototype,"multiTouchActive",null),u1=u([A("esri.views.2d.input.MapViewInputManager")],u1);const Htt=u1,mhe=160;let KO=class extends ue{constructor(){super(...arguments),this._timer=void 0}get stationary(){return!this._timer}flip(){this._timestamp=performance.now(),this._timer==null&&(this._timer=setInterval(()=>{performance.now()-this._timestamp>=mhe&&this.clear()},mhe))}clear(){this._timer&&(clearInterval(this._timer),this._timer=void 0)}};u([p()],KO.prototype,"_timer",void 0),u([p()],KO.prototype,"stationary",null),KO=u([A("esri.views.2d.support.StationaryManager")],KO);const qtt=t=>{let e=class extends t{constructor(...i){super(...i),this.fullOpacity=1,this.stateManager=new ll({constraints:new rhe({view:this})}),this.goToManager=new y4({view:this}),this.stationaryManager=new KO,this.mapViewNavigation=null,this.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!1,labelsAnimationTime:0,labelCollisionsEnabled:!1},this.frameTask=new ett(this),this.inputManager=new Htt({view:this}),this.viewEvents=new T$e(this),this.padding={top:0,right:0,bottom:0,left:0},this.addHandles([H(()=>this.viewpoint,()=>this.stationaryManager.flip(),Gt),this.on("resize",r=>this.stateManager.resize(r.width,r.height))])}get constraintsInfo(){return{lods:null,spatialReference:null}}get extent(){return this.stateManager?.extent??null}set extent(i){this.stateManager.extent=i}get state(){return this.stateManager.state}get interacting(){return this.navigating}get stationary(){return!this.animation&&!this.navigating&&!this.resizing&&this.stationaryManager.stationary}set animation(i){const r=this._get("animation");if(i===r)return;if(r&&r.stop(),i!==this.animationManager.animation&&this.animationManager.stop(),!i||i.isFulfilled())return void this._set("animation",null);this._set("animation",i);const s=()=>{this.destroyed||i===this._get("animation")&&(this._set("animation",null),this.frameTask?.requestFrame())};i.when(s,s)}get constraints(){return this.stateManager?.constraints}set constraints(i){i.view=this;const r=this.stateManager.constraints;this.stateManager.constraints=i,r?.destroy()}get padding(){return this.stateManager?.padding}set padding(i){this.stateManager&&(this.stateManager.padding=i)}get resizeAlign(){return this.stateManager.resizeAlign}set resizeAlign(i){this.stateManager.resizeAlign=i}get rotation(){return this.stateManager.rotation??0}set rotation(i){const{rotationEnabled:r}=this.constraints;this.constraints.rotationEnabled=!0,this.stateManager.rotation=i,this.constraints.rotationEnabled=r}get viewpoint(){return this.stateManager.viewpoint??null}set viewpoint(i){this.stateManager.viewpoint=i,this.frameTask.requestFrame()}on(i,r,s,n){return this.inputManager&&this.viewEvents.on(i,r,s,n)||super.on(i,r)}hasEventListener(i){return super.hasEventListener(i)||this.viewEvents.hasHandler(i)}goTo(i,r){return this.goToManager.goTo(i,r)}};return u([p({readOnly:!0})],e.prototype,"animationManager",void 0),u([p({readOnly:!0})],e.prototype,"fullOpacity",void 0),u([p()],e.prototype,"stateManager",void 0),u([p()],e.prototype,"constraintsInfo",null),u([p()],e.prototype,"extent",null),u([p()],e.prototype,"goToManager",void 0),u([p({readOnly:!0})],e.prototype,"state",null),u([p({readOnly:!0})],e.prototype,"mapViewNavigation",void 0),u([p()],e.prototype,"renderingOptions",void 0),u([p({readOnly:!0})],e.prototype,"interacting",null),u([p()],e.prototype,"stationary",null),u([p()],e.prototype,"animation",null),u([p({type:rhe})],e.prototype,"constraints",null),u([p({readOnly:!0})],e.prototype,"inputManager",void 0),u([p()],e.prototype,"padding",null),u([p()],e.prototype,"resizeAlign",null),u([p()],e.prototype,"rotation",null),u([p({readOnly:!0})],e.prototype,"viewEvents",void 0),u([p({type:Jr})],e.prototype,"viewpoint",null),e=u([A("esri.views.Viewport2DMixin")],e),e};let ghe=class{constructor(e){this._view=e,this.viewpoint=new Jr({targetGeometry:new ke,scale:0,rotation:0})}get view(){return this._view}get size(){const[e,i]=this._view.size;return Math.sqrt(e*e+i*i)}get scale(){return this.viewpoint.scale}get rotation(){return this.viewpoint.rotation}get center(){return this.viewpoint.targetGeometry}get scaleToResolutionFactor(){return aAe(this.center.spatialReference)}pixelsPerPanAtZoom(e){return 1/(e*this.scaleToResolutionFactor)}zoomAtPixelsPerPan(e){return 1/(e*this.scaleToResolutionFactor)}pixelsPerRotate(){return this.size/2}compareTo(e,i){i.pan=bSe(this.center,e.center);let r=Math.abs(e.rotation-this.rotation);r=r>=180?360-r:r,i.rotate=wt(r),i.sourceZoom=this.scale,i.targetZoom=e.scale}interpolate(e,i,r){const{pan:s,rotate:n,zoom:o,zoomOffset:a}=r,{center:l}=this;l.spatialReference=e.center.spatialReference,l.x=dt(e.center.x,i.center.x,s),l.y=dt(e.center.y,i.center.y,s),this.viewpoint.scale=dt(e.scale,i.scale+a,o);let c=e.rotation;const h=i.rotation;Math.abs(h-c)>=180&&(c+=360*(c<h?1:-1)),this.viewpoint.rotation=dt(c,h,n)}copyFrom(e){xl(this.viewpoint,e.viewpoint),this._view=e.view}};function uM(t,e,i,r){const s=3*t,n=3*(i-t)-s,o=1-s-n,a=3*e,l=3*(r-e)-a,c=1-a-l;function h(y){return((o*y+n)*y+s)*y}function d(y){return((c*y+l)*y+a)*y}function f(y){return(3*o*y+2*n)*y+s}function m(y,v){let _,b,w,x,S,C;for(w=y,C=0;C<8;C++){if(x=h(w)-y,Math.abs(x)<v)return w;if(S=f(w),Math.abs(S)<1e-6)break;w-=x/S}if(_=0,b=1,w=y,w<_)return _;if(w>b)return b;for(;_<b;){if(x=h(w),Math.abs(x-y)<v)return w;y>x?_=w:b=w,w=.5*(b-_)+_}return w}return function(y,v=1e-6){return d(m(y,v))}}const Vh={};Vh.ease=uM(.25,.1,.25,1),Vh.linear=uM(0,0,1,1),Vh.easeIn=Vh["ease-in"]=uM(.42,0,1,1),Vh.easeOut=Vh["ease-out"]=uM(0,0,.58,1),Vh.easeInOut=Vh["ease-in-out"]=uM(.42,0,.58,1);const Wtt=t=>t,pj=t=>t*t,kie=t=>1-pj(1-t),Ztt=t=>t<.5?pj(2*t)/2:(kie(2*(t-.5))+1)/2,zie=t=>t*t*t,UAe=t=>1-zie(1-t),BAe=t=>t<.5?zie(2*t)/2:(UAe(2*(t-.5))+1)/2,Uie=t=>t*t*t*t,VAe=t=>1-Uie(1-t),Ytt=t=>t<.5?Uie(2*t)/2:(VAe(2*(t-.5))+1)/2,Bie=t=>t*t*t*t*t,jAe=t=>1-Bie(1-t),Jtt=t=>t<.5?Bie(2*t)/2:(jAe(2*(t-.5))+1)/2,Vie=t=>1-Math.cos(t*Math.PI/2),GAe=t=>1-Vie(1-t),Xtt=t=>t<.5?Vie(2*t)/2:(GAe(2*(t-.5))+1)/2,jie=t=>2**(10*(t-1)),xD=t=>1-jie(1-t),Ktt=t=>t<.5?jie(2*t)/2:(xD(2*(t-.5))+1)/2,Gie=t=>-(Math.sqrt(1-t*t)-1),HAe=t=>1-Gie(1-t),Qtt=t=>t<.5?Gie(2*t)/2:(HAe(2*(t-.5))+1)/2;function Rd(t){const e=2*(t-Math.sqrt((t-1)*t)),i=e/2/t;return r=>r<i?t*r*r:e*r-e+1}function Pd(t,e){return(i,r)=>i<e?e*t(i/e,r):1-t((1-i)/(1-e),r)*(1-e)}const eit=Pd(Rd(1),1),tit=Pd(Rd(1),0),cY=Pd(Rd(1),.5),iit=Pd(Rd(2),1),rit=Pd(Rd(2),0),sit=Pd(Rd(2),.5),nit=Pd(Rd(3),1),oit=Pd(Rd(3),0),ait=Pd(Rd(3),.5),lit=Pd(Rd(4),1),cit=Pd(Rd(4),0),uit=Pd(Rd(4),.5),uY={linear:Wtt,"in-quad":pj,"out-quad":kie,"in-out-quad":Ztt,"in-coast-quad":eit,"out-coast-quad":tit,"in-out-coast-quad":cY,"in-cubic":zie,"out-cubic":UAe,"in-out-cubic":BAe,"in-coast-cubic":iit,"out-coast-cubic":rit,"in-out-coast-cubic":sit,"in-quart":Uie,"out-quart":VAe,"in-out-quart":Ytt,"in-coast-quart":nit,"out-coast-quart":oit,"in-out-coast-quart":ait,"in-quint":Bie,"out-quint":jAe,"in-out-quint":Jtt,"in-coast-quint":lit,"out-coast-quint":cit,"in-out-coast-quint":uit,"in-sine":Vie,"out-sine":GAe,"in-out-sine":Xtt,"in-expo":jie,"out-expo":xD,"in-out-expo":Ktt,"in-circ":Gie,"out-circ":HAe,"in-out-circ":Qtt,ease:t=>Vh.ease(t),"ease-in":t=>Vh.easeIn(t),"ease-out":t=>Vh.easeOut(t),"ease-in-out":t=>Vh.easeInOut(t)};let hit=class{constructor(){this.pan=0,this.rotate=0,this.fov=0,this.sourceZoom=0,this.targetZoom=0}};const mU={desiredScreenFlow:2,minDuration:500,maxDuration:8e3},qAe={maxDuration:4e3};let dit=class WAe{constructor(e){this._createCamera=e,this.compared=new hit,this.segmentStart=0,this.segmentEnd=1,this.settings={desiredScreenFlow:mU.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new WAe(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,i,r){this.source!==e&&this.source.copyFrom(e),this.target!==i&&this.target.copyFrom(i),this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow??mU.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const i=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>So()}get hasFov(){return Math.abs(this.compared.fov)>So()}get hasRotate(){return this.compared.rotate>So()}},pit=class{constructor(){this.pan=0,this.rotate=0,this.zoom=0,this.fov=0,this.zoomOffset=0}},fit=class{constructor(){this.segments=new Array}get time(){return this.segments.reduce((e,i)=>e+i.time,0)}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),e*=this.time;let r=0,s=0;const n=this.definition,o=this.segments.reduce((a,l)=>a||l.definition.hasZoom,!1);for(let a=0;a<this.segments.length;a++){const l=this.segments[a],c=l.definition;if(e<=l.time||a===this.segments.length-1){if(this.segmentInterpolateComponentsAt(l,l.time===0?0:e/l.time,i),n.hasPan&&!isNaN(i.pan)&&isFinite(n.compared.pan)?i.pan=(r+c.compared.pan*i.pan)/n.compared.pan:i.pan=1,n.hasRotate&&!isNaN(i.rotate)&&isFinite(n.compared.rotate)?i.rotate=(s+c.compared.rotate*i.rotate)/n.compared.rotate:i.rotate=1,o&&!isNaN(i.zoom)&&isFinite(c.compared.targetZoom)){const{sourceZoom:h,targetZoom:d}=c.compared,f=i.zoom*(d-h)+h,m=this.segments[0].definition.compared.sourceZoom,y=this.segments[this.segments.length-1].definition.compared.targetZoom,v=Math.abs(d-m)>Math.abs(h-m)?d:h;i.zoomOffset=v-y,i.zoom=(f-m)/(v-m)}else i.zoom=1;return i}e-=l.time,r+=c.compared.pan,s+=c.compared.rotate}}segmentInterpolateComponentsAt(e,i,r){e.interpolateComponentsAt(i,r)}},iH=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,i=e.compared,r=i.sourceZoom,s=i.targetZoom;this._zoomSign=r>s?1:-1,this._panPixelsAtSource=i.pan*e.source.pixelsPerPanAtZoom(r);const n=(e.source.pixelsPerRotate()+e.target.pixelsPerRotate())/2;this._rotatePixels=i.rotate*n}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:r,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;r&&(s&&(o=(i/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(e/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(r&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(r&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(r&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,h=1+c;this._panPixelFlow=c/h*l,this._rotatePixelFlow=1/h*l}else s?this._panPixelFlow=l:r?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);if(this._time=Math.max(this.rotateTime,this.zoomTime,this.panTime),this.fovTime>this._time){const c=this.fovTime/this._time;this._time=this.fovTime,this._zoomPixelFlow/=c,this._panPixelFlow/=c,this._rotatePixelFlow/=c}}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get fovTime(){return this.definition.hasFov?Math.abs(this.definition.compared.fov)/mit:0}get panTime(){if(!this.definition.hasPan)return 0;if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=e*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const i=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(i*(i/r)**-e-i)/(r-i)}return e}_interpolateComponentsFov(e){if(e===0)return this.definition.segmentStart;if(e===1)return this.definition.segmentEnd;if(this.definition.hasFov){const{segmentStart:i,segmentEnd:r}=this.definition;return i+e*(r-i)}return this.definition.segmentStart}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*e*this._time)-1))/(i*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),i.zoom=this._interpolateComponentsZoom(e),i.pan=this._interpolateComponentsPan(e),i.rotate=this._interpolateComponentsRotate(e),i.zoomOffset=0,i.fov=this._interpolateComponentsFov(e)}};const mit=wt(45);function git(t,e,i){const r=e-t.compared.sourceZoom,s=t.halfWindowPanAtZoom(r);return-t.halfWindowSize*(i.ascensionFactor*Math.LN2*t.compared.pan+s)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*s)}function yit(t,e,i){const r=1/e,s=Math.log(t.compared.sourceZoom*r),n=1/t.desiredPixelFlow,o=1/Math.LN2,a=e-t.compared.sourceZoom,l=1/a,c=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(a))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*r*n*o*l*c-t.halfWindowSize*s*n*o*l+t.halfWindowSize*s*n*o*c/(a*a)}function vit(t,e,i){const r=e-t.compared.sourceZoom,s=1/r,n=1/e,o=Math.log(t.compared.sourceZoom*n),a=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(r))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(r*r)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function _it(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function bit(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function wit(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function xit(t,e,i){return-t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function Sit(t,e,i){return t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function Tit(t,e,i){return-2*t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function Eit(t,e,i){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function Cit(t,e,i){const r=Math.log(e/t.compared.targetZoom),s=1/t.desiredPixelFlow,n=1/Math.LN2,o=-e+t.compared.targetZoom,a=1/o,l=(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*r*s*n*a+t.halfWindowSize*r*s*n*l/(o*o)+t.halfWindowSize*s*n*a*l/e}function $it(t,e,i){const r=e-t.compared.targetZoom,s=1/r,n=1/e,o=Math.log(e/t.compared.targetZoom),a=(t.halfWindowPanAtZoom(e)+i.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(r*r)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function Ait(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function Mit(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function Oit(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function Iit(t){const e=t.compared.sourceZoom-t.compared.targetZoom;if(e===0)return t.compared.pan*t.halfWindowSize/(t.desiredPixelFlow*t.halfWindowPanAtZoom(t.compared.sourceZoom));const i=Math.LN2*t.compared.pan,r=e,s=t.halfWindowPanAtZoom(r),n=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*s);return t.compared.sourceZoom<=t.compared.targetZoom?n*(i-s):n*(i+s)}function Rit(t,e){let i=Pit(t,e);const r={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},s=r.ascensionFactor===0,n=r.descensionFactor===0,o=s?_it:git,a=s?bit:yit,l=s?wit:vit,c=n?Ait:Eit,h=n?Mit:Cit,d=n?Oit:$it,f=S=>o(t,S,r)+xit(t,S,r)+c(t,S,r),m=S=>a(t,S,r)+Sit(t,S,r)+h(t,S,r),y=S=>l(t,S,r)+Tit(t,S,r)+d(t,S,r);let v=f(i);const _=Iit(t);let b;const w=e.maximumIterations||20,x=e.maximumDistance!=null?e.maximumDistance:1/0;for(b=0;b<w;b++){const S=e.desiredSlope??1e-6;let C=m(i);Math.abs(C)>S&&(C+=S);const T=C/y(i);if(isNaN(T)||i>=x&&T<0){if(!isFinite(x))return null;i=x,v=f(i);break}if(i-=T,i<t.compared.sourceZoom||i<t.compared.targetZoom)return null;const M=f(i);if(Math.abs(M-v)/v<=.005)break;v=M}return v>_*(1-.3)||i<t.compared.sourceZoom||i<t.compared.targetZoom?null:i}function Pit(t,e){const i=Math.max(t.compared.sourceZoom,t.compared.targetZoom),r=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return r<i?e.maximumDistance!=null?i+(e.maximumDistance-i)/2:1.5*i:e.maximumDistance?Math.min(e.maximumDistance,r):r}let Dit=class extends fit{constructor(e,i){super(),this._preallocSegments=[new iH,new iH,new iH],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,i)}update(e,i){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();const r=i?.apex?Rit(e,i.apex):null;this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r?this._updateWithApex(r,i?.apex):this._updateWithoutApex()}segmentInterpolateComponentsAt(e,i,r){e.interpolateComponentsAt(i,r),e===this._ascensionSegment?r.zoom=kie(r.zoom):e===this._descensionSegment&&(r.zoom=pj(r.zoom))}_updateWithApex(e,i){const[r,s,n]=this._preallocSegments,o=i?.ascensionFactor??.5,a=Math.min(1-o,i?.ascensionFactor!=null&&i.descensionFactor!=null?i.descensionFactor:.5),l=1-o-a;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=e,r.definition.compared.pan=this.definition.compared.pan*o,r.definition.compared.rotate=this.definition.compared.rotate*o,r.definition.segmentEnd=o,r.update(),this._ascensionSegment=r,this.segments.push(r),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=e,s.definition.compared.targetZoom=e,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.definition.segmentStart=r.definition.segmentEnd,s.definition.segmentEnd=r.definition.segmentEnd+l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=e,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.definition.segmentStart=o+l,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const Lit=new pit;let ZAe=class{get time(){return this._time}get isLinear(){return this.path.segments.length===1}constructor(e){this._time=0,this._easing=cY,this.definition=new dit(e),this.path=new Dit}update(e,i,r){this.definition.update(e,i,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings(ixe(isFinite(this.path.time)?this.path.time:0),r),this._easing=r.easing??(this._time>=1e3?cY:xD)}cameraAt(e,i){e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const r=this.path.interpolateComponentsAt(e,Lit);i.interpolate(this.definition.source,this.definition.target,r)}_normalizedEasing(e){const i=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(e,this._time)-i)/(r-i)}_applyTimeSettings(e,i){const r=i.speedFactor!=null?i.speedFactor:1,s=i.minDuration??mU.minDuration/r,n=i.maxDuration??mU.maxDuration/r;return e=i.duration!=null?i.duration:Math.min(Math.max(e/r,s),n)}};const Nit=2e3,Fit=64;let kit=class{constructor(e){this._view=e,this._animation=new ZAe(()=>new ghe(this._view)),this._current=new ghe(this._view)}get _source(){return this._animation.definition.source}get _target(){return this._animation.definition.target}get duration(){return this._animation.time}get animation(){return this._animation}update(e,i,r={}){xl(this._current.viewpoint,e),xl(this._source.viewpoint,e),xl(this._target.viewpoint,i),this._animation.update(this._source,this._target,r)}applyRatio(e,i){this._animation.cameraAt(i,this._current),xl(e,this._current.viewpoint)}},AE=class extends ue{constructor(e){super(e),this._animation=null,this._destinationViewState=new Rie,this.updateFunction=null,this.easing=uY.ease,this.viewpoint=new Jr({targetGeometry:new ke,scale:0,rotation:0}),this._updateTask=qm({postRender:this._postRender.bind(this)}),this._updateTask.pause(),this._transition=new kit(e.view)}destroy(){this._updateTask=Hi(this._updateTask)}get animation(){return this._animation}set animation(e){this._animation=e,this.view.animation=e}animate(e,i,r){this.stop();const s=this.viewpoint;xl(s,i);const n=e.target;this._transition.update(this.viewpoint,n,{apex:{maximumDistance:Math.min(Math.min(i.scale,n.scale)*Fit,this.view.constraints.effectiveMinScale),desiredSlope:5e-8},duration:r?.duration,maxDuration:r?.animationMode==="auto"?1/0:r?.maxDuration??qAe.maxDuration,speedFactor:r?.speedFactor,easing:(typeof r?.easing=="string"?uY[r.easing]:r?.easing)||this.easing}),r?.animationMode==="auto"&&(this._destinationViewState.copy(this.view.state),this._destinationViewState.viewpoint=n,zit(this._transition.animation,r,this.view.state,this._destinationViewState)||this._transition.update(this.viewpoint,n,{duration:0}));const o=()=>{this.animation===e&&this._updateTask&&(e.state==="finished"&&(this._transition.applyRatio(this.viewpoint,1),this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())),this.animation=null,this.updateFunction=null)};return e.when(o,o),this._startTime=performance.now(),this._updateTask.resume(),this.animation=e,e}animateContinuous(e,i){this.stop(),this.updateFunction=i,this.viewpoint=e;const r=new cv({target:e.clone()}),s=()=>{this.animation===r&&this._updateTask&&(this.animation=null,this.updateFunction=null)};return r.when(s,s),this._startTime=performance.now(),this._updateTask.resume(),this.animation=r,r}stop(){this.animation&&(this.animation.stop(),this.animation=null,this.updateFunction=null)}_postRender(e){const i=this.animation;if(i&&i.state!==cv.State.STOPPED){if(this.updateFunction)this.updateFunction(this.viewpoint,e.deltaTime),this.animation?.update(this.viewpoint);else{const r=performance.now()-this._startTime,s=this._transition.duration,n=s>0?r/s:1,o=n>=1;this._transition.applyRatio(this.viewpoint,n),o&&this.animation?.finish()}this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())}else this._updateTask.pause()}};function zit(t,e,i,r){if(e?.duration!=null)return!0;const{time:s,isLinear:n}=t,o=e?.speedFactor||1;if(s>(e?.maxDuration??qAe.maxDuration/o))return!1;if(n){const l=He(),c=wo(...r.toScreen(l,...i.center)),h=wo(...i.toScreen(l,...r.center)),d=h!=null&&h.x>-1*i.size[0]&&h.x<(1.5+.5)*i.size[0]&&h.y>-1*i.size[1]&&h.y<(1.5+.5)*i.size[1],f=c!=null&&c.x>-1*r.size[0]&&c.x<(1.5+.5)*r.size[0]&&c.y>-1*r.size[1]&&c.y<(1.5+.5)*r.size[1];if(s>Nit/o&&!d&&!f)return!1}return!0}u([p()],AE.prototype,"easing",void 0),u([p()],AE.prototype,"view",void 0),u([p()],AE.prototype,"viewpoint",void 0),AE=u([A("esri.views.2d.AnimationManager")],AE);const Uit=AE;function Ts(){return Promise.all([V(()=>import("./webglDeps-luVOL3P9.js"),__vite__mapDeps([130,131,132,133])),V(()=>import("./mapViewDeps-BbE8qZ8X.js"),__vite__mapDeps([134,135,53,54,55,56,51,59,136,52,137,138,50,139,131,133,140,141,57,64,142,60,61,62,143,144,145,132,146,72,49,16,12,21,20,147,148,40,149,63,150,151,58,152,68,153,154,155,156,157,158]))])}const hM=()=>Ts().then(()=>V(()=>import("./TileLayerView2D-C1K2Sqfo.js"),__vite__mapDeps([159,52,53,54,55,56,51,143,144,141,138,50,139,131,133,140,146,136,135,59,137,57,64,72,49,16,12,21,20,40,60,61,62,152,68,160,161,156,162,163,154,155,164,165,166,167,168,169,170]))),uw=()=>Ts().then(()=>V(()=>import("./FeatureLayerView2D-ekV4vqBu.js").then(t=>t.F),__vite__mapDeps([171,141,172,173,174,16,12,23,162,140,155,52,50,51,156,138,139,131,133,135,53,54,55,56,59,136,137,57,64,72,175,142,176,70,177,167,170,164,165]))),yhe={"base-dynamic":()=>Ts().then(()=>V(()=>import("./BaseDynamicLayerView2D-D5t8Lfni.js"),__vite__mapDeps([178,179,138,50,51,139,131,133,140,141,161,136,59,162,180,164,165]))),"base-tile":hM,"bing-maps":hM,catalog:()=>Ts().then(()=>V(()=>import("./CatalogLayerView2D-BrXYfI86.js"),__vite__mapDeps([181,162,140,141,182,164]))),"catalog-dynamic-group":()=>Ts().then(()=>V(()=>import("./CatalogDynamicGroupLayerView2D-Cv2X3T-A.js"),__vite__mapDeps([183,162,140,141,184,164]))),"catalog-footprint":()=>Ts().then(()=>V(()=>import("./CatalogFootprintLayerView2D-DLtBtj7F.js"),__vite__mapDeps([185,171,141,172,173,174,16,12,23,162,140,155,52,50,51,156,138,139,131,133,135,53,54,55,56,59,136,137,57,64,72,175,142,176,70,177,167,170,164,165,186]))),csv:uw,"geo-rss":()=>Ts().then(()=>V(()=>import("./GeoRSSLayerView2D-Dywkj5iR.js"),__vite__mapDeps([187,162,140,141,153,154,155,52,50,51,156,138,139,131,133,135,53,54,55,56,59,136,137,57,64,152,143,144,49,16,12,21,20,68,164]))),feature:uw,geojson:uw,parquet:uw,graphics:()=>Ts().then(()=>V(()=>import("./GraphicsLayerView2D-xb11c42F.js"),__vite__mapDeps([188,162,140,141,153,154,155,52,50,51,156,138,139,131,133,135,53,54,55,56,59,136,137,57,64,152,143,144,49,16,12,21,20,68,164]))),group:()=>Ts().then(()=>V(()=>import("./GroupLayerView2D-B4CQbpN8.js"),__vite__mapDeps([189,162,140,141,190,164]))),imagery:()=>Ts().then(()=>V(()=>import("./ImageryLayerView2D-C9J33B-K.js"),__vite__mapDeps([191,192,79,80,139,138,50,51,131,133,140,141,162,152,53,54,55,56,143,144,49,52,16,12,21,20,135,59,136,137,57,64,68,163,154,155,156,179,161,180,83,193,172,170,164,165]))),"imagery-tile":()=>Ts().then(()=>V(()=>import("./ImageryTileLayerView2D-BYElftdz.js"),__vite__mapDeps([194,195,192,79,80,139,138,50,51,131,133,140,141,162,196,150,62,156,197,83,198,199,172,170,164,165]))),kml:()=>Ts().then(()=>V(()=>import("./KMLLayerView2D-CQy4IZL5.js"),__vite__mapDeps([200,201,161,136,59,179,138,50,51,139,131,133,140,141,162,153,154,155,52,156,135,53,54,55,56,137,57,64,152,143,144,49,16,12,21,20,68,164,83,150,62,147,132,196]))),"knowledge-graph":()=>Ts().then(()=>V(()=>import("./KnowledgeGraphLayerView2D-CQljMyhM.js"),__vite__mapDeps([202,162,140,141,164]))),"link-chart":()=>Ts().then(()=>V(()=>import("./KnowledgeGraphLayerView2D-CQljMyhM.js"),__vite__mapDeps([202,162,140,141,164]))),"knowledge-graph-sublayer":uw,"map-image":()=>Ts().then(()=>V(()=>import("./MapImageLayerView2D-CgogAMw2.js"),__vite__mapDeps([203,179,138,50,51,139,131,133,140,141,161,136,59,162,152,53,54,55,56,143,144,49,52,16,12,21,20,135,137,57,64,68,163,154,155,156,180,164,204,205,167,169,172,165,166,168,170]))),"map-notes":()=>Ts().then(()=>V(()=>import("./MapNotesLayerView2D-C3BFhU5c.js"),__vite__mapDeps([206,162,140,141,153,154,155,52,50,51,156,138,139,131,133,135,53,54,55,56,59,136,137,57,64,152,143,144,49,16,12,21,20,68,164]))),media:()=>Ts().then(()=>V(()=>import("./MediaLayerView2D-CitqsjVE.js"),__vite__mapDeps([207,208,68,52,53,54,55,56,51,143,144,141,138,50,139,131,133,140,146,136,135,59,137,57,64,72,49,16,12,21,20,40,60,61,62,152,209,149,63,210,151,162,164,211]))),"ogc-feature":()=>Ts().then(()=>V(()=>import("./OGCFeatureLayerView2D-BxmJPTL5.js"),__vite__mapDeps([212,171,141,172,173,174,16,12,23,162,140,155,52,50,51,156,138,139,131,133,135,53,54,55,56,59,136,137,57,64,72,175,142,176,70,177,167,170,164,165,213]))),"open-street-map":hM,"oriented-imagery":uw,route:()=>Ts().then(()=>V(()=>import("./RouteLayerView2D-DAst-JdC.js"),__vite__mapDeps([214,215,216,162,140,141,153,154,155,52,50,51,156,138,139,131,133,135,53,54,55,56,59,136,137,57,64,152,143,144,49,16,12,21,20,68,164]))),stream:()=>Ts().then(()=>V(()=>import("./StreamLayerView2D-BJewL21s.js"),__vite__mapDeps([217,171,141,172,173,174,16,12,23,162,140,155,52,50,51,156,138,139,131,133,135,53,54,55,56,59,136,137,57,64,72,175,142,176,70,177,167,170,164,165,218]))),"subtype-group":()=>Ts().then(()=>V(()=>import("./SubtypeGroupLayerView2D-CuP1fmlK.js"),__vite__mapDeps([219,171,141,172,173,174,16,12,23,162,140,155,52,50,51,156,138,139,131,133,135,53,54,55,56,59,136,137,57,64,72,175,142,176,70,177,167,170,164,165]))),tile:hM,"vector-tile":()=>Ts().then(()=>V(()=>import("./VectorTileLayerView2D-CpjgS9go.js"),__vite__mapDeps([220,221,56,40,55,156,138,50,51,139,131,133,140,141,26,93,94,162,164,165]))),video:()=>Ts().then(()=>V(()=>import("./VideoLayerView2D-COKrdb-g.js"),__vite__mapDeps([222,223,224,210,138,50,51,139,131,133,140,141,135,53,54,55,56,59,136,52,137,57,64,151,162,153,154,155,156,152,143,144,49,16,12,21,20,68,164]))),wcs:()=>Ts().then(()=>V(()=>import("./ImageryTileLayerView2D-BYElftdz.js"),__vite__mapDeps([194,195,192,79,80,139,138,50,51,131,133,140,141,162,196,150,62,156,197,83,198,199,172,170,164,165]))),"web-tile":hM,wfs:uw,wms:()=>Ts().then(()=>V(()=>import("./WMSLayerView2D-B5apS6tx.js"),__vite__mapDeps([225,179,138,50,51,139,131,133,140,141,161,136,59,162,180,164,165,226,227,172]))),wmts:()=>Ts().then(()=>V(()=>import("./WMTSLayerView2D-BqVpSapO.js"),__vite__mapDeps([228,160,161,136,59,156,138,50,51,139,131,133,140,141,162,164,165]))),"line-of-sight":null,"base-elevation":null,"building-scene":null,dimension:null,elevation:null,"integrated-mesh":null,"integrated-mesh-3dtiles":null,"point-cloud":null,viewshed:null,voxel:null,scene:null,unknown:null,unsupported:null};function Bit(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",i=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new U(`${i}:view-not-supported`,`${e} is not supported in 2D`)}const vhe={hasLayerViewModule:t=>yhe[t.type]!=null,importLayerView:t=>{const e=yhe[t.type];if(e==null)throw Bit(t);return e(t)}};let Xm=class h1{static getId(e,i,r,s){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${i}/${r}/${s}`}constructor(e,i,r,s){this.set(e,i,r,s)}get key(){return this}get id(){return this.toString()}get normalizedId(){return`${this.level}/${this.row}/${this.col}`}set id(e){this.set(e)}get hash(){const e=4095&this.row,i=4095&this.col,r=63&this.level;return(3&this.world)<<30|i<<22|e<<8|r}acquire(e,i,r,s){this.set(e,i,r,s)}contains(e){const i=e.level-this.level;return i>=0&&this.row===e.row>>i&&this.col===e.col>>i&&this.world===e.world}containsChild(e){const i=e.level-this.level;return i>0&&this.row===e.row>>i&&this.col===e.col>>i&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new h1(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,i,r,s){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[n,o,a,l]=e.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+i,this.col=+r,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new h1(this.level-1,this.row>>1,this.col>>1,this.world)}getNormalizedNeighbor(e,i,r){const s=this.clone();return s.col+=e,s.row+=i,r.normalizeKey(s),s}getChildKeys(){const e=this.level+1,i=this.row<<1,r=this.col<<1,s=this.world;return[new h1(e,i,r,s),new h1(e,i,r+1,s),new h1(e,i+1,r,s),new h1(e,i+1,r+1,s)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};Xm.pool=new Cl(Xm,null,null,25,50);function hT(t,e){return[t,e]}function hw(t,e,i){return t[0]=e,t[1]=i,t}function Vit(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}const Wd=new Xm("0/0/0/0");let jit=class YAe{static create(e,i,r=null){const s=lc(e.spatialReference),n=i.origin||hT(e.origin.x,e.origin.y),o=hT(e.size[0]*i.resolution,e.size[1]*i.resolution),a=hT(-1/0,-1/0),l=hT(1/0,1/0),c=hT(1/0,1/0);r!=null&&(hw(a,Math.max(0,Math.floor((r.xmin-n[0])/o[0])),Math.max(0,Math.floor((n[1]-r.ymax)/o[1]))),hw(l,Math.max(0,Math.floor((r.xmax-n[0])/o[0])),Math.max(0,Math.floor((n[1]-r.ymin)/o[1]))),hw(c,l[0]-a[0]+1,l[1]-a[1]+1));const{cols:h,rows:d}=i;let f,m,y,v;return!r&&h&&d&&(hw(a,h[0],d[0]),hw(l,h[1],d[1]),hw(c,h[1]-h[0]+1,d[1]-d[0]+1)),e.isWrappable?(f=hT(Math.ceil(Math.round((s.valid[1]-s.valid[0])/i.resolution)/e.size[0]),c[1]),m=!0,y=s.origin,v=s.valid):(f=c,m=!1),new YAe(i.level,i.resolution,i.scale,n,a,l,c,o,f,m,y,v)}constructor(e,i,r,s,n,o,a,l,c,h,d,f){this.level=e,this.resolution=i,this.scale=r,this.origin=s,this.first=n,this.last=o,this.size=a,this.norm=l,this.worldSize=c,this.wrap=h,this._spatialReferenceOrigin=d,this._spatialReferenceValid=f}normalizeCol(e){if(!this.wrap)return e;const i=this.worldSize[0];return e<0?i-1-Math.abs((e+1)%i):e%i}normalizeKey(e){if(!this.wrap)return;const i=this.worldSize[0],r=e.col;r<0?(e.col=r+i,e.world-=1):r>=i&&(e.col=r-i,e.world+=1)}denormalizeCol(e,i){return this.wrap?this.worldSize[0]*i+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){const i=this.origin[0]+e*this.norm[0],r=this._spatialReferenceOrigin,s=this._spatialReferenceValid;return this.wrap&&r&&s?i===r[0]?s[0]:this.origin[0]===r[0]&&e===this.worldSize[0]?s[1]:i:i}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,i,r=!1){Wd.set(i);const s=r?Wd.col:this.denormalizeCol(Wd.col,Wd.world),n=Wd.row;return Vit(e,this.getXForColumn(s),this.getYForRow(n+1),this.getXForColumn(s+1),this.getYForRow(n)),e}getTileCoords(e,i,r=!1){Wd.set(i);const s=r?Wd.col:this.denormalizeCol(Wd.col,Wd.world);return Array.isArray(e)?hw(e,this.getXForColumn(s),this.getYForRow(Wd.row)):(e.x=this.getXForColumn(s),e.y=this.getYForRow(Wd.row)),e}},qP=class{constructor(){this.spans=[]}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}*keys(){const e=this.lodInfo;for(const{row:i,colFrom:r,colTo:s}of this.spans)for(let n=r;n<=s;n++){const o=e.getWorldForColumn(n);yield new Xm(e.level,i,e.normalizeCol(n),o)}}forEach(e,i){const{spans:r,lodInfo:s}=this,{level:n}=s;if(r.length!==0)for(const{row:o,colFrom:a,colTo:l}of r)for(let c=a;c<=l;c++)e.call(i,n,o,s.normalizeCol(c),s.getWorldForColumn(c))}};qP.pool=new Cl(qP);let rH=class{constructor(e,i,r){this.row=e,this.colFrom=i,this.colTo=r}};const Ls=new Xm("0/0/0/0");let Git=class JAe{static create(e,i){e[1]>i[1]&&([e,i]=[i,e]);const[r,s]=e,[n,o]=i,a=n-r,l=o-s,c=l!==0?a/l:0,h=(Math.ceil(s)-s)*c,d=(Math.floor(s)-s)*c;return new JAe(r,Math.floor(s),Math.ceil(o),c,a<0?h:d,a<0?d:h,a<0?n:r,a<0?r:n)}constructor(e,i,r,s,n,o,a,l){this.x=e,this.ymin=i,this.ymax=r,this.invM=s,this.leftAdjust=n,this.rightAdjust=o,this.leftBound=a,this.rightBound=l}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}};const lu=[[0,0],[0,0],[0,0],[0,0]],Hit=1e-6;let qit=class{constructor(e,i=null,r=e.lods[0].level,s=e.lods[e.lods.length-1].level){this.tileInfo=e,this.fullExtent=i,this.scales=[],this._infoByScale={},this._infoByLevel={};const n=e.lods.filter(a=>a.level>=r&&a.level<=s);this.minScale=n[0].scale,this.maxScale=n[n.length-1].scale;const o=this._lodInfos=n.map(a=>jit.create(e,a,i));n.forEach((a,l)=>{this._infoByLevel[a.level]=o[l],this._infoByScale[a.scale]=o[l],this.scales[l]=a.scale},this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel[typeof e=="number"?e:e.level]}getTileBounds(e,i,r=!1){Ls.set(i);const s=this._infoByLevel[Ls.level];return s?s.getTileBounds(e,Ls,r):e}getTileCoords(e,i,r=!1){Ls.set(i);const s=this._infoByLevel[Ls.level];return s?s.getTileCoords(e,Ls,r):e}getTileCoverage(e,i=192,r=!0,s="closest"){if(!r&&(e.scale>this.minScale||e.scale<this.maxScale))return null;const n=s==="closest"?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),o=qP.pool.acquire(n),a=this._wrap;let l,c,h,d=1/0,f=-1/0;const m=o.spans;lu[0][0]=lu[0][1]=lu[1][1]=lu[3][0]=-i,lu[1][0]=lu[2][0]=e.size[0]+i,lu[2][1]=lu[3][1]=e.size[1]+i;for(const b of lu)e.toMap(b,b),b[0]=n.getColumnForX(b[0]),b[1]=n.getRowForY(b[1]);const y=[];let v=3;for(let b=0;b<4;b++){if(lu[b][1]===lu[v][1]){v=b;continue}const w=Git.create(lu[b],lu[v]);d=Math.min(w.ymin,d),f=Math.max(w.ymax,f),y[w.ymin]===void 0&&(y[w.ymin]=[]),y[w.ymin].push(w),v=b}if(d==null||f==null||f-d>100)return null;let _=[];for(l=d;l<f;){y[l]!=null&&(_=_.concat(y[l])),c=1/0,h=-1/0;for(let b=_.length-1;b>=0;b--){const w=_[b];c=Math.min(c,w.getLeftCol()),h=Math.max(h,w.getRightCol())}if(c=Math.floor(c),h=Math.floor(h),l>=n.first[1]&&l<=n.last[1])if(a)if(n.size[0]<n.worldSize[0]){const b=Math.floor(h/n.worldSize[0]);for(let w=Math.floor(c/n.worldSize[0]);w<=b;w++)m.push(new rH(l,Math.max(n.getFirstColumnForWorld(w),c),Math.min(n.getLastColumnForWorld(w),h)))}else m.push(new rH(l,c,h));else c>n.last[0]||h<n.first[0]||(c=Math.max(c,n.first[0]),h=Math.min(h,n.last[0]),m.push(new rH(l,c,h)));l+=1;for(let b=_.length-1;b>=0;b--){const w=_[b];w.ymax>=l?w.incrRow():_.splice(b,1)}}return o}getTileParentId(e){Ls.set(e);const i=this._infoByLevel[Ls.level],r=this._lodInfos.indexOf(i)-1;return r<0?null:(this._getTileIdAtLOD(Ls,this._lodInfos[r],Ls),Ls.id)}getTileResolution(e){const i=this._infoByLevel[typeof e=="object"?e.level:e];return i?i.resolution:-1}getTileScale(e){const i=this._infoByLevel[e.level];return i?i.scale:-1}intersects(e,i){Ls.set(i);const r=this._infoByLevel[Ls.level],s=e.lodInfo;if(s.resolution>r.resolution){this._getTileIdAtLOD(Ls,s,Ls);const o=s.denormalizeCol(Ls.col,Ls.world);for(const a of e.spans)if(a.row===Ls.row&&a.colFrom<=o&&a.colTo>=o)return!0}if(s.resolution<r.resolution){const[o,a,l,c]=e.spans.reduce((v,_)=>(v[0]=Math.min(v[0],_.row),v[1]=Math.max(v[1],_.row),v[2]=Math.min(v[2],_.colFrom),v[3]=Math.max(v[3],_.colTo),v),[1/0,-1/0,1/0,-1/0]),h=r.denormalizeCol(Ls.col,Ls.world),d=s.getColumnForX(r.getXForColumn(h)),f=s.getRowForY(r.getYForRow(Ls.row)),m=s.getColumnForX(r.getXForColumn(h+1))-1,y=s.getRowForY(r.getYForRow(Ls.row+1))-1;return!(d>c||m<l||f>a||y<o)}const n=s.denormalizeCol(Ls.col,Ls.world);return e.spans.some(o=>o.row===Ls.row&&o.colFrom<=n&&o.colTo>=n)}normalizeBounds(e,i,r){if(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],this._wrap){const s=lc(this.tileInfo.spatialReference),n=-r*(s.valid[1]-s.valid[0]);e[0]+=n,e[2]+=n}return e}getSmallestInfoForScale(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>i[0])return this._infoByScale[i[0]];for(let r=1;r<i.length-1;r++)if(e>i[r]+Hit)return this._infoByScale[i[r-1]];return this._infoByScale[i[i.length-1]]}getClosestInfoForScale(e){const i=this.scales;return this._infoByScale[e]||(e=i.reduce((r,s)=>Math.abs(s-e)<Math.abs(r-e)?s:r,i[0])),this._infoByScale[e]}scaleToLevel(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let r=i.length-1;r>=0;r--)if(e<i[r])return r===i.length-1?this._infoByScale[i[i.length-1]].level:this._infoByScale[i[r]].level+(i[r]-e)/(i[r]-i[r+1]);return this._infoByScale[i[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}zoomToScale(e){return this.tileInfo.zoomToScale(e)}_getTileIdAtLOD(e,i,r){const s=this._infoByLevel[r.level];return e.set(r),i.resolution<s.resolution?null:(i.resolution===s.resolution||(e.level=i.level,e.col=Math.floor(r.col*s.resolution/i.resolution+.01),e.row=Math.floor(r.row*s.resolution/i.resolution+.01)),e)}},Wit=class{constructor(e,i){this.item=e,this.controller=i,this.promise=null}},Zit=class{constructor(e){this._schedule=null,this._task=null,this._deferreds=new p4,this._controllers=new p4,this._processingItems=new p4,this._pausedSignal=xa(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new Hz(e.peeker),this.process=e.process;const i=e.scheduler;e.priority&&i&&(this._task=i.registerTask(e.priority,this))}destroy(){this.clear(),this._schedule=Hi(this._schedule),this._task=Hi(this._task)}get updating(){return!!this._task?.updating||this.running}get length(){return this._processingItems.size+this._queue.length}abort(e){const i=this._controllers.get(e);i&&i.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(i=>e.push(i)),this._controllers.clear(),e.forEach(i=>i.abort()),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach((i,r)=>e(r))}get(e){const i=this._deferreds.get(e);return i?i.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,i){const r=this.get(e);if(r)return r;const s=new AbortController;let n=null;i&&(n=Xo(i,()=>s.abort()));const o=()=>{const h=this._processingItems.get(e);h&&h.controller.abort(),a(),c.reject(vi())},a=()=>{l.remove(),n?.remove(),this._removeItem(e),this._queue.remove(e),this._scheduleNext()},l=J3(s.signal,o),c=Qo();return this._deferreds.set(e,c),this._controllers.set(e,s),c.promise.then(a,a),this._queue.push(e),this._scheduleNext(),c.promise}last(){return this._queue.last()}lastPromise(){const e=this.last();return e?this.get(e):null}peek(){return this._queue.peek()}popLast(){const e=this._queue.popLast();return e&&(this._deferreds.get(e)?.reject(vi()),this._removeItem(e)),e}reset(){const e=Array.from(this._processingItems.values());this._processingItems.clear();for(const i of e)this._queue.push(i.item),i.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_removeItem(e){this._deferreds.delete(e),this._controllers.delete(e),this._processingItems.delete(e)}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=mA(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(i))}_processError(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(i))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(e==null)return;let i;const r=new AbortController,s=new Wit(e,r);this._processingItems.set(e,s);try{i=this.process(e,r.signal)}catch(n){this._processError(s,n)}nu(i)?(s.promise=i,i.then(n=>this._processResult(s,n),n=>this._processError(s,n))):this._processResult(s,i)}get test(){}};const _he=[0,0];let Xg=class extends ue{constructor(e){super(e),this._keyToItem=new Map,this._tilesByScale=new Map,this.concurrency=6}initialize(){const{concurrency:e,process:i,scheduler:r,priority:s}=this;this._queue=new Zit({concurrency:e,scheduler:r,priority:s,process:(n,o)=>{const a=this._keyToItem.get(n);return i(a,{signal:o})},peeker:n=>this._peek(n)})}destroy(){this.clear(),this._queue=Ce(this._queue)}get length(){return this._queue?this._queue.length:0}abort(e){const i=typeof e=="string"?e:e.id;this._queue.abort(i)}clear(){this._queue.clear(),this._keyToItem.clear(),this._tilesByScale.clear()}has(e){return typeof e=="string"?this._keyToItem.has(e):this._keyToItem.has(e.id)}pause(){this._queue.pause()}push(e){const i=e.key.id;if(this._queue.has(i))return this._queue.get(i);const r=this._queue.push(i),s=this.tileInfoView.getTileScale(e.key),n=zb(this._tilesByScale,s,()=>new Set),o=()=>{n.delete(e.key),n.size===0&&this._tilesByScale.delete(s),this._keyToItem.delete(i)};return n.add(e.key),this._keyToItem.set(i,e),r.then(o,o),r}reset(){this._queue.reset()}resume(){this._queue.resume()}_peek(e){if(!this.state)return e.values().next().value;const i=new Set;for(const o of e)i.add(this._keyToItem.get(o).key);const r=this.state.scale;let s,n=Number.POSITIVE_INFINITY;for(const[o,a]of this._tilesByScale)if(hR(a,l=>i.has(l))){const l=Math.abs(o-r);l<n&&(s=a,n=l)}return this._getClosestTileKey(s,e).id}_getClosestTileKey(e,i){const r=this.tileInfoView,s=this.state.center;let n,o=Number.POSITIVE_INFINITY;for(const a of e)if(i.has(a.id)){r.getTileCoords(_he,a);const l=lv(_he,s);l<o&&(o=l,n=a)}return n}};u([p({constructOnly:!0})],Xg.prototype,"concurrency",void 0),u([p({constructOnly:!0})],Xg.prototype,"priority",void 0),u([p({constructOnly:!0})],Xg.prototype,"process",void 0),u([p({constructOnly:!0})],Xg.prototype,"scheduler",void 0),u([p()],Xg.prototype,"state",void 0),u([p({constructOnly:!0})],Xg.prototype,"tileInfoView",void 0),Xg=u([A("esri.views.2d.tiling.TileQueue")],Xg);const vWt=Xg;let Yit=class{constructor(e,i,r){this.maxSize=e,this._tileInfoView=i,this._removedFunc=r,this._tilePerId=new Map,this._tileKeysPerLevel=[]}clear(){this._tilePerId.clear(),this._tileKeysPerLevel=[]}has(e){return this._tilePerId.has(e)}get(e){return this._tilePerId.get(e)}pop(e){const i=this._tilePerId.get(e);if(!i)return;const r=i.key.level,s=this._tileKeysPerLevel[r];bhe(this._tilePerId,e);for(let n=0;n<s.length;n++)if(s[n].id===e){s.splice(n,1);break}return i.visible=!0,i}add(e){e.visible=!1;const i=e.key,r=i.id;if(this._tilePerId.has(r))return;this._tilePerId.set(r,e);const s=i.level;this._tileKeysPerLevel[s]||(this._tileKeysPerLevel[s]=[]),this._tileKeysPerLevel[s].push(i)}prune(e,i,r){let s=this._tilePerId.size;if(s<=this.maxSize)return;let n=this._tileKeysPerLevel.length-1;for(;s>this.maxSize&&n>=0;)n!==e&&(s=this._pruneAroundCenterTile(s,i,r,n)),n--;s>this.maxSize&&(s=this._pruneAroundCenterTile(s,i,r,e))}_pruneAroundCenterTile(e,i,r,s){const n=this._tileKeysPerLevel[s];if(!n||n.length===0)return e;const{size:o,origin:a}=this._tileInfoView.tileInfo,l=r*o[0],c=r*o[1],h=[0,0],d=[0,0];for(n.sort((f,m)=>(h[0]=a.x+l*(f.col+.5),h[1]=a.y-c*(f.row+.5),d[0]=a.x+l*(m.col+.5),d[1]=a.y-c*(m.row+.5),C$(h,i)-C$(d,i)));n.length>0;){const f=n.pop();if(this._removeTile(f.id),--e===this.maxSize)break}return e}_removeTile(e){const i=this._tilePerId.get(e);this._removedFunc&&i&&this._removedFunc(i),bhe(this._tilePerId,e)}};function bhe(t,e){t.delete(e)}const dw=new Xm(0,0,0,0),Sg=new Map,dM=[],sH=[];let bWt=class{constructor(e){this._previousScale=Number.POSITIVE_INFINITY,this.cachePolicy="keep",this.coveragePolicy="closest",this.resampling=!0,this.tileIndex=new Map,this.tiles=[],this.buffer=192,this.acquireTile=e.acquireTile,this.releaseTile=e.releaseTile,this.tileInfoView=e.tileInfoView,e.resampling!=null&&(this.resampling=e.resampling),e.cachePolicy&&(this.cachePolicy=e.cachePolicy),e.coveragePolicy&&(this.coveragePolicy=e.coveragePolicy),e.buffer!=null&&(this.buffer=e.buffer),e.cacheSize&&(this._tileCache=new Yit(e.cacheSize,this.tileInfoView,i=>{this.releaseTile(i)}))}destroy(){this.tileIndex.clear()}update(e){const{resampling:i,tileIndex:r}=this,{scale:s,center:n,resolution:o}=e.state,{minScale:a,maxScale:l}=this.tileInfoView,c=!e.stationary&&s>this._previousScale;if(this._previousScale=s,!i&&(s>a||s<l))return this.tiles.length=0,void this.clear();const h=this.tileInfoView.getTileCoverage(e.state,this.buffer,this.resampling,this.coveragePolicy);if(!h)return this.tiles.length=0,void this.clear();const{spans:d,lodInfo:f}=h,{level:m}=f;this.tiles.length=0,r.forEach(b=>b.visible=!0);let y=0,v=0;if(d.length>0)for(const{row:b,colFrom:w,colTo:x}of d)for(let S=w;S<=x;S++){y++;const C=dw.set(m,b,f.normalizeCol(S),f.getWorldForColumn(S)).id;let T=r.get(C);if(T)T.isReady?(Sg.set(C,T),v++):c||this._addParentTile(C,Sg);else{if(this._tileCache?.has(C)){if(T=this._tileCache.pop(C),this.tileIndex.set(C,T),T.isReady){Sg.set(C,T),v++;continue}}else T=this.acquireTile(dw),this.tileIndex.set(C,T);c||this._addParentTile(C,Sg)}}const _=v===y;for(const[b,w]of r){if(Sg.has(b))continue;dw.set(b);const x=this.tileInfoView.intersects(h,dw),S=this.cachePolicy==="purge"?dw.level!==m:dw.level>m;!x||!c&&_?!S&&x||dM.push(w):w.isReady?S&&this.cachePolicy==="purge"&&this._hasReadyAncestor(dw,m)?dM.push(w):sH.push(w):S&&dM.push(w)}for(const b of sH)b.isReady&&Sg.set(b.key.id,b);for(const b of dM)this._tileCache?this._tileCache.add(b):this.releaseTile(b),r.delete(b.key.id);for(const b of Sg.values())this.tiles.push(b);for(const b of r.values())Sg.has(b.key.id)||(b.visible=!1);this._tileCache?.prune(m,n,o),qP.pool.release(h),sH.length=0,dM.length=0,Sg.clear()}clear(){const{tileIndex:e}=this;for(const i of e.values())this.releaseTile(i);e.clear()}refresh(e){for(const i of this.tileIndex.values())e(i);this._tileCache?.clear()}updateCacheSize(e){this._tileCache&&(this._tileCache.maxSize=e)}_addParentTile(e,i){let r=e,s=null;for(;r=this.tileInfoView.getTileParentId(r),r;)if(this.tileIndex.has(r)){if(s=this.tileIndex.get(r),s?.isReady){i.has(s.key.id)||i.set(s.key.id,s);break}}else if(this._tileCache?.has(r)&&(s=this._tileCache.pop(r),this.tileIndex.set(r,s),s?.isReady)){i.has(s.key.id)||i.set(s.key.id,s);break}}_hasReadyAncestor(e,i){const r=Qt();this.tileInfoView.getTileBounds(r,e,!0);for(const s of this.tileIndex.values())if(s.isReady&&s.key.level>=i&&s.key.level<e.level){const n=Qt();if(this.tileInfoView.getTileBounds(n,s.key,!0),k7(n,r))return!0}return!1}};function Jit(t,e,i,r,s){XAe(t,e,i||0,r||t.length-1,s||Xit)}function XAe(t,e,i,r,s){for(;r>i;){if(r-i>600){var n=r-i+1,o=e-i+1,a=Math.log(n),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(n-l)/n)*(o-n/2<0?-1:1);XAe(t,e,Math.max(i,Math.floor(e-o*l/n+c)),Math.min(r,Math.floor(e+(n-o)*l/n+c)),s)}var h=t[e],d=i,f=r;for(pM(t,i,e),s(t[r],h)>0&&pM(t,i,r);d<f;){for(pM(t,d,f),d++,f--;s(t[d],h)<0;)d++;for(;s(t[f],h)>0;)f--}s(t[i],h)===0?pM(t,i,f):pM(t,++f,r),f<=e&&(i=f+1),e<=f&&(r=f-1)}}function pM(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function Xit(t,e){return t<e?-1:t>e?1:0}function gU(t,e){if(!(this instanceof gU))return new gU(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&(typeof e=="function"?this.toBBox=e:this._initFormat(e)),this.clear()}function Kit(t,e,i){if(!i)return e.indexOf(t);for(var r=0;r<e.length;r++)if(i(t,e[r]))return r;return-1}function dT(t,e){QO(t,0,t.children.length,e,t)}function QO(t,e,i,r,s){s||(s=ME(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var n,o=e;o<i;o++)n=t.children[o],eI(s,t.leaf?r(n):n);return s}function eI(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function whe(t,e){return t.minX-e.minX}function xhe(t,e){return t.minY-e.minY}function nH(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function ZL(t){return t.maxX-t.minX+(t.maxY-t.minY)}function Qit(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function ert(t,e){var i=Math.max(t.minX,e.minX),r=Math.max(t.minY,e.minY),s=Math.min(t.maxX,e.maxX),n=Math.min(t.maxY,e.maxY);return Math.max(0,s-i)*Math.max(0,n-r)}function oH(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function YL(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function ME(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function She(t,e,i,r,s){for(var n,o=[e,i];o.length;)(i=o.pop())-(e=o.pop())<=r||(n=e+Math.ceil((i-e)/r/2)*r,Jit(t,n,e,i,s),o.push(e,n,n,i))}gU.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,i=[],r=this.toBBox;if(!YL(t,e))return i;for(var s,n,o,a,l=[];e;){for(s=0,n=e.children.length;s<n;s++)o=e.children[s],YL(t,a=e.leaf?r(o):o)&&(e.leaf?i.push(o):oH(t,a)?this._all(o,i):l.push(o));e=l.pop()}return i},collides:function(t){var e=this.data,i=this.toBBox;if(!YL(t,e))return!1;for(var r,s,n,o,a=[];e;){for(r=0,s=e.children.length;r<s;r++)if(n=e.children[r],YL(t,o=e.leaf?i(n):n)){if(e.leaf||oH(t,o))return!0;a.push(n)}e=a.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,i=t.length;e<i;e++)this.insert(t[e]);return this}var r=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var s=this.data;this.data=r,r=s}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(t){return t!=null&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=ME([]),this},remove:function(t,e){if(t==null)return this;for(var i,r,s,n,o=this.data,a=this.toBBox(t),l=[],c=[];o||l.length;){if(o||(o=l.pop(),r=l[l.length-1],i=c.pop(),n=!0),o.leaf&&(s=Kit(t,o.children,e))!==-1)return o.children.splice(s,1),l.push(o),this._condense(l),this;n||o.leaf||!oH(o,a)?r?(i++,o=r.children[i],n=!1):o=null:(l.push(o),c.push(i),i=0,r=o,o=o.children[0])}return this},toBBox:function(t){return t},compareMinX:whe,compareMinY:xhe,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},_build:function(t,e,i,r){var s,n=i-e+1,o=this._maxEntries;if(n<=o)return dT(s=ME(t.slice(e,i+1)),this.toBBox),s;r||(r=Math.ceil(Math.log(n)/Math.log(o)),o=Math.ceil(n/Math.pow(o,r-1))),(s=ME([])).leaf=!1,s.height=r;var a,l,c,h,d=Math.ceil(n/o),f=d*Math.ceil(Math.sqrt(o));for(She(t,e,i,f,this.compareMinX),a=e;a<=i;a+=f)for(She(t,a,c=Math.min(a+f-1,i),d,this.compareMinY),l=a;l<=c;l+=d)h=Math.min(l+d-1,c),s.children.push(this._build(t,l,h,r-1));return dT(s,this.toBBox),s},_chooseSubtree:function(t,e,i,r){for(var s,n,o,a,l,c,h,d;r.push(e),!e.leaf&&r.length-1!==i;){for(h=d=1/0,s=0,n=e.children.length;s<n;s++)l=nH(o=e.children[s]),(c=Qit(t,o)-l)<d?(d=c,h=l<h?l:h,a=o):c===d&&l<h&&(h=l,a=o);e=a||e.children[0]}return e},_insert:function(t,e,i){var r=this.toBBox,s=i?t:r(t),n=[],o=this._chooseSubtree(s,this.data,e,n);for(o.children.push(t),eI(o,s);e>=0&&n[e].children.length>this._maxEntries;)this._split(n,e),e--;this._adjustParentBBoxes(s,n,e)},_split:function(t,e){var i=t[e],r=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,r);var n=this._chooseSplitIndex(i,s,r),o=ME(i.children.splice(n,i.children.length-n));o.height=i.height,o.leaf=i.leaf,dT(i,this.toBBox),dT(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(i,o)},_splitRoot:function(t,e){this.data=ME([t,e]),this.data.height=t.height+1,this.data.leaf=!1,dT(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,i){var r,s,n,o,a,l,c,h;for(l=c=1/0,r=e;r<=i-e;r++)o=ert(s=QO(t,0,r,this.toBBox),n=QO(t,r,i,this.toBBox)),a=nH(s)+nH(n),o<l?(l=o,h=r,c=a<c?a:c):o===l&&a<c&&(c=a,h=r);return h},_chooseSplitAxis:function(t,e,i){var r=t.leaf?this.compareMinX:whe,s=t.leaf?this.compareMinY:xhe;this._allDistMargin(t,e,i,r)<this._allDistMargin(t,e,i,s)&&t.children.sort(r)},_allDistMargin:function(t,e,i,r){t.children.sort(r);var s,n,o=this.toBBox,a=QO(t,0,e,o),l=QO(t,i-e,i,o),c=ZL(a)+ZL(l);for(s=e;s<i-e;s++)n=t.children[s],eI(a,t.leaf?o(n):n),c+=ZL(a);for(s=i-e-1;s>=e;s--)n=t.children[s],eI(l,t.leaf?o(n):n),c+=ZL(l);return c},_adjustParentBBoxes:function(t,e,i){for(var r=i;r>=0;r--)eI(e[r],t)},_condense:function(t){for(var e,i=t.length-1;i>=0;i--)t[i].children.length===0?i>0?(e=t[i-1].children).splice(e.indexOf(t[i]),1):this.clear():dT(t[i],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};function trt(t,{timeZone:e,timeExtent:i}){return{$view:{scale:t,timeZone:e,timeProperties:{currentStart:i?.start,currentEnd:i?.end}}}}let The=class KAe{constructor(e,i){this.key=new Xm(0,0,0,0),this.bounds=Qt(),this.objectIds=new Set,this.key.set(i);const r=e.getLODInfoAt(this.key);this.tileInfoView=e,this.tileInfoView.getTileBounds(this.bounds,this.key,!0),this.resolution=r.resolution,this.level=r.level,this.scale=r.scale,this.minScale=e.zoomToScale(r.level-1),this.maxScale=e.zoomToScale(r.level+1)}get lod(){return this.tileInfoView.getLODInfoAt(this.key)}get id(){return this.key.id}get extent(){return tD(this.bounds,this.tileInfoView.tileInfo.spatialReference)}get transform(){return{originPosition:"upperLeft",scale:[this.resolution,this.resolution],translate:[this.bounds[0],this.bounds[3]]}}createArcadeEvaluationOptions(e){return trt(this.scale,e)}createChildTiles(){const e=this.key.getChildKeys(),i=tc.acquire();for(let r=0;r<e.length;r++)i[r]=new KAe(this.tileInfoView,e[r]);return i}getQuantizationParameters(){return b$e.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})}};const pw={added:[],removed:[]},aH=new Set,irt=new Xm(0,0,0,0);function rrt(t,e){const i=lc(e);if(!i)return null;const[r,s]=i.valid;return t[2]>s?[Qt([t[0],t[1],s,t[3]]),Qt([r,t[1],r+t[2]-s,t[3]])]:t[0]<r?[Qt([r,t[1],t[2],t[3]]),Qt([s-(r-t[0]),t[1],s,t[3]])]:null}let srt=class extends ws{constructor(e){super(),this._tiles=new Map,this._index=gU(9,X("esri-csp-restrictions")?i=>({minX:i.bounds[0],minY:i.bounds[1],maxX:i.bounds[2],maxY:i.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this.tiles=[],this.tileScheme=e}destroy(){this.clear()}clear(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}has(e){return this._tiles.has(e)}get(e){return this._tiles.get(e)}getIntersectingTiles(e){if(!e||Zo(e)===0||wl(e)===0)return[];const i=rrt(e,this.tileScheme.spatialReference);return i!=null?[...new Set([...this.boundsIntersections(i[0]),...this.boundsIntersections(i[1])])]:this.boundsIntersections(e)}boundsIntersections(e){return this._index.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]})}updateTiles(e){const i={added:[],removed:[]};for(const r of e.added)if(!this.has(r)){const s=new The(this.tileScheme,r);this._tiles.set(r,s),this._index.insert(s),i.added.push(s)}for(const r of e.removed)if(this.has(r)){const s=this.get(r);this._tiles.delete(r),this._index.remove(s),i.removed.push(s)}this.tiles.length=0,this._tiles.forEach(r=>this.tiles.push(r)),(i.added.length||i.removed.length)&&this.emit("update",i)}setViewState(e){const i=this.tileScheme.getTileCoverage(e,0);if(!i)return;const{spans:r,lodInfo:s}=i,{level:n}=s;if(r.length>0)for(const{row:o,colFrom:a,colTo:l}of r)for(let c=a;c<=l;c++){const h=irt.set(n,o,s.normalizeCol(c),s.getWorldForColumn(c)).id;if(aH.add(h),!this.has(h)){const d=new The(this.tileScheme,h);this._tiles.set(h,d),this._index.insert(d),this.tiles.push(d),pw.added.push(d)}}for(let o=this.tiles.length-1;o>=0;o--){const a=this.tiles[o];aH.has(a.id)||(this._tiles.delete(a.id),this.tiles.splice(o,1),this._index.remove(a),pw.removed.push(a))}(pw.added.length||pw.removed.length)&&this.emit("update",pw),qP.pool.release(i),aH.clear(),pw.added.length=0,pw.removed.length=0}};const SWt=1e-30,Ehe=512,JL=16777216,TWt=8,EWt=29,CWt=24,$Wt=4,AWt=0,MWt=0,OWt=0,IWt=1,RWt=2,PWt=3,DWt=4,LWt=5,NWt=6,FWt=12,kWt=13,zWt=5,nrt=6,UWt=5,BWt=6;var Che;(function(t){t[t.FilterFlags=0]="FilterFlags",t[t.Animation=1]="Animation",t[t.GPGPU=2]="GPGPU",t[t.VV=3]="VV",t[t.DD0=4]="DD0",t[t.DD1=5]="DD1",t[t.DD2=6]="DD2",t[t.LocalTimeOrigin=7]="LocalTimeOrigin"})(Che||(Che={}));const QAe=6,ort=1<<QAe,VWt=ort<<1,jWt=1.05,GWt=3,HWt=1,qWt=3,WWt=3,ZWt=5,YWt=6,JWt=1.15,art=4,XWt=128,lrt=256,KWt=lrt-2*art,QWt=2,eZt=128,tZt=1,iZt=10,rZt=1024,sZt=128,nZt=4,oZt=1,aZt=1<<20,lZt=.75,cZt=10,uZt=.75,hZt=256,dZt=32,pZt=512,fZt=0,mZt=1,crt=1,gZt=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],yZt=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],fM=256;var Si,Ui,Ft,uv,ct,Yu,I$,Pi,Ni,Yi,di,nr,ts,vt,Qe,Ya,fa,Zs,ju,Fa;(function(t){t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL",t[t.COLOR=16384]="COLOR"})(Si||(Si={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Ui||(Ui={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(Ft||(Ft={})),function(t){t[t.ADD=32774]="ADD",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(uv||(uv={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER"}(ct||(ct={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(Yu||(Yu={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(I$||(I$={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.HALF_FLOAT=5131]="HALF_FLOAT"}(Pi||(Pi={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(Ni||(Ni={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(Yi||(Yi={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(di||(di={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(nr||(nr={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(ts||(ts={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(vt||(vt={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(Qe||(Qe={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(Ya||(Ya={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(fa||(fa={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(Zs||(Zs={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(ju||(ju={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(Fa||(Fa={}));const lH=33984;var Hs,rr,Va;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.TransformFeedback=7]="TransformFeedback",t[t.Sync=8]="Sync",t[t.UNCOUNTED=9]="UNCOUNTED",t[t.LinesOfCode=9]="LinesOfCode",t[t.Uniform=10]="Uniform",t[t.COUNT=11]="COUNT"})(Hs||(Hs={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(rr||(rr={})),function(t){t[t.NONE=0]="NONE",t[t.BACK=1029]="BACK"}(Va||(Va={}));const nS=33306;var vs,$he,Ahe,Mhe,yU,hY,Ohe;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(vs||(vs={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}($he||($he={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(Ahe||(Ahe={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(Mhe||(Mhe={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(yU||(yU={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(hY||(hY={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(Ohe||(Ohe={}));const urt=()=>J.getLogger("esri.views.webgl.checkWebGLError");function hrt(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const vU=!!X("enable-feature:webgl-debug");function Op(){return vU}function dY(){return vU}function ed(t){if(Op()){const e=t.getError();if(e){const i=hrt(t,e),r=new Error().stack;urt().error(new U("webgl-error","WebGL error occurred",{message:i,stack:r}))}}}var hv;(function(t){t[t.Texture=0]="Texture",t[t.RenderBuffer=1]="RenderBuffer"})(hv||(hv={}));function drt(t){switch(t){case Pi.BYTE:case Pi.UNSIGNED_BYTE:return 1;case Pi.SHORT:case Pi.UNSIGNED_SHORT:case Pi.HALF_FLOAT:return 2;case Pi.FLOAT:case Pi.INT:case Pi.UNSIGNED_INT:return 4}}function eMe(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function R$(t,e){return(t.vertexBuffers.get(e)?.usedMemory??0)/prt(t.layout.get(e))}function prt(t){return t[0].stride}function tMe(t,e,i,r,s=0){const n=t.gl;t.bindBuffer(i);for(const o of r){const a=e.get(o.name);if(a==null){console.warn(`There is no location for vertex attribute '${o.name}' defined.`);continue}const l=s*o.stride;if(o.count<=4)n.vertexAttribPointer(a,o.count,o.type,o.normalized,o.stride,o.offset+l),n.enableVertexAttribArray(a),o.divisor>0&&t.gl.vertexAttribDivisor(a,o.divisor);else if(o.count===9)for(let c=0;c<3;c++)n.vertexAttribPointer(a+c,3,o.type,o.normalized,o.stride,o.offset+12*c+l),n.enableVertexAttribArray(a+c),o.divisor>0&&t.gl.vertexAttribDivisor(a+c,o.divisor);else if(o.count===16)for(let c=0;c<4;c++)n.vertexAttribPointer(a+c,4,o.type,o.normalized,o.stride,o.offset+16*c+l),n.enableVertexAttribArray(a+c),o.divisor>0&&t.gl?.vertexAttribDivisor(a+c,o.divisor);else console.error("Unsupported vertex attribute element count: "+o.count);if(Op()){const c=eMe(t),h=drt(o.type),d=o.offset,f=Math.round(h/d)!==h/d?`. Offset not a multiple of stride. DataType requires ${h} bytes, but descriptor has an offset of ${d}`:"";c&&console.error(`Unable to bind vertex attribute "${o.name}" with baseInstanceOffset ${l}${f}:`,c,o)}}}function frt(t,e,i,r){const s=t.gl;t.bindBuffer(i);for(const n of r){const o=e.get(n.name);if(n.count<=4)s.disableVertexAttribArray(o),n.divisor&&n.divisor>0&&t.gl?.vertexAttribDivisor(o,0);else if(n.count===9)for(let a=0;a<3;a++)s.disableVertexAttribArray(o+a),n.divisor&&n.divisor>0&&t.gl?.vertexAttribDivisor(o+a,0);else if(n.count===16)for(let a=0;a<4;a++)s.disableVertexAttribArray(o+a),n.divisor&&n.divisor>0&&t.gl?.vertexAttribDivisor(o+a,0);else console.error("Unsupported vertex attribute element count: "+n.count)}t.unbindBuffer(ct.ARRAY_BUFFER)}function Hie(t){switch(t){case vt.ALPHA:case vt.LUMINANCE:case vt.RED:case vt.RED_INTEGER:case Qe.R8:case Qe.R8I:case Qe.R8UI:case Qe.R8_SNORM:case fa.STENCIL_INDEX8:return 1;case vt.LUMINANCE_ALPHA:case vt.RG:case vt.RG_INTEGER:case Qe.RGBA4:case Qe.R16F:case Qe.R16I:case Qe.R16UI:case Qe.RG8:case Qe.RG8I:case Qe.RG8UI:case Qe.RG8_SNORM:case Qe.RGB565:case Qe.RGB5_A1:case fa.DEPTH_COMPONENT16:return 2;case vt.DEPTH_COMPONENT:case vt.RGB:case vt.RGB_INTEGER:case Qe.RGB8:case Qe.RGB8I:case Qe.RGB8UI:case Qe.RGB8_SNORM:case Qe.SRGB8:case fa.DEPTH_COMPONENT24:return 3;case vt.DEPTH_STENCIL:case vt.DEPTH24_STENCIL8:case vt.RGBA:case vt.RGBA_INTEGER:case Qe.RGBA8:case Qe.R32F:case Qe.R11F_G11F_B10F:case Qe.RG16F:case Qe.R32I:case Qe.R32UI:case Qe.RG16I:case Qe.RG16UI:case Qe.RGBA8I:case Qe.RGBA8UI:case Qe.RGBA8_SNORM:case Qe.SRGB8_ALPHA8:case Qe.RGB9_E5:case Qe.RGB10_A2UI:case Qe.RGB10_A2:case fa.DEPTH_STENCIL:case fa.DEPTH_COMPONENT32F:case fa.DEPTH24_STENCIL8:return 4;case fa.DEPTH32F_STENCIL8:return 5;case Qe.RGB16F:case Qe.RGB16I:case Qe.RGB16UI:return 6;case Qe.RG32F:case Qe.RG32I:case Qe.RG32UI:case Qe.RGBA16F:case Qe.RGBA16I:case Qe.RGBA16UI:return 8;case Qe.RGB32F:case Qe.RGB32I:case Qe.RGB32UI:return 12;case Qe.RGBA32F:case Qe.RGBA32I:case Qe.RGBA32UI:return 16;case vs.COMPRESSED_RGB_S3TC_DXT1_EXT:case vs.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case vs.COMPRESSED_RGBA_S3TC_DXT3_EXT:case vs.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case vs.COMPRESSED_R11_EAC:case vs.COMPRESSED_SIGNED_R11_EAC:case vs.COMPRESSED_RGB8_ETC2:case vs.COMPRESSED_SRGB8_ETC2:case vs.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case vs.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case vs.COMPRESSED_RG11_EAC:case vs.COMPRESSED_SIGNED_RG11_EAC:case vs.COMPRESSED_RGBA8_ETC2_EAC:case vs.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}let $r=class{constructor(e=0,i=e){this.width=e,this.height=i,this.target=ts.TEXTURE_2D,this.pixelFormat=vt.RGBA,this.dataType=Ya.UNSIGNED_BYTE,this.samplingMode=di.LINEAR,this.wrapMode=nr.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.shouldCompress=!1,this.depth=1,this.isImmutable=!1}};function mrt(t){return t.width<=0||t.height<=0?0:Math.round(t.width*t.height*t.depth*(t.hasMipmap?4/3:1)*(t.internalFormat==null?4:Hie(t.internalFormat))*(t.target===ts.TEXTURE_CUBE_MAP?6:1))}const grt=()=>J.getLogger("esri/views/webgl/textureUtils");function XL(t){(t.width!=null&&t.width<0||t.height!=null&&t.height<0||t.depth!=null&&t.depth<0)&&grt().error("Negative dimension parameters are not allowed!")}function yrt(t){return t in Qe}function iMe(t){return t in vs}function OE(t){return t!=null&&"type"in t&&t.type==="compressed"}function vrt(t){return!!t.descriptor.internalFormat&&iMe(t.descriptor.internalFormat)}function _rt(t){return t!=null&&"byteLength"in t}function Ihe(t){return t!=null&&!OE(t)&&!_rt(t)}function pT(t){return t===ts.TEXTURE_3D||t===ts.TEXTURE_2D_ARRAY}function Rhe(t,e,i,r=1){let s=Math.max(e,i);return t===ts.TEXTURE_3D&&(s=Math.max(s,r)),Math.floor(Math.log2(s))+1}function KL(t){if(t.internalFormat!=null)return t.internalFormat===vt.DEPTH_STENCIL?vt.DEPTH24_STENCIL8:t.internalFormat;switch(t.dataType){case Ya.FLOAT:switch(t.pixelFormat){case vt.RGBA:return Qe.RGBA32F;case vt.RGB:return Qe.RGB32F;default:throw new U("Unable to derive format")}case Ya.UNSIGNED_BYTE:switch(t.pixelFormat){case vt.RGBA:return Qe.RGBA8;case vt.RGB:return Qe.RGB8}}return t.internalFormat=t.pixelFormat===vt.DEPTH_STENCIL?vt.DEPTH24_STENCIL8:t.pixelFormat}function brt(t){let e="width"in t?t.width:t.codedWidth,i="height"in t?t.height:t.codedHeight;return t instanceof HTMLVideoElement&&(e=t.videoWidth,i=t.videoHeight),{width:e,height:i,depth:1}}let wrt=class rMe extends $r{constructor(e,i){switch(super(),this.context=e,Object.assign(this,i),this.internalFormat){case Qe.R16F:case Qe.R16I:case Qe.R16UI:case Qe.R32F:case Qe.R32I:case Qe.R32UI:case Qe.R8_SNORM:case Qe.R8:case Qe.R8I:case Qe.R8UI:this.pixelFormat=vt.RED}}static validate(e,i){return new rMe(e,i)}};const Qv=()=>J.getLogger("esri/views/webgl/Texture");let yi=class zl{constructor(e,i=null,r=null){if(this.type=hv.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,this._compressionAbortController=xa(null),"context"in e)this._descriptor=e,r=i;else{const s=wrt.validate(e,i);if(!s)throw new U("Texture descriptor invalid");this._descriptor=s}this._descriptor.target===ts.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return mrt(this._descriptor)}get cachedMemory(){return this.usedMemory}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}get isCompressing(){return this._compressionAbortController.value!==null}dispose(){this.abortCompression(),this._glName&&this._descriptor.context.instanceCounter.decrement(Hs.Texture,this),this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(e,i){const r=this._descriptor;if(r.width!==e||r.height!==i){if(this._wasImmutablyAllocated)throw new U("Immutable textures can't be resized!");r.width=e,r.height=i,this._descriptor.target===ts.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}enableCompression(e){this._descriptor.shouldCompress=e}setData(e){this.abortCompression(),!OE(e)&&this._descriptor.internalFormat&&this._descriptor.internalFormat in vs&&(this._descriptor.internalFormat=void 0),this._setData(e),!OE(e)&&this._descriptor.shouldCompress&&this._compressOnWorker(e)}updateData(e,i,r,s,n,o,a=0){o||Qv().error("An attempt to use uninitialized data!"),this._glName||Qv().error("An attempt to update uninitialized texture!");const l=this._descriptor;l.internalFormat=KL(l);const{context:c,pixelFormat:h,dataType:d,target:f,isImmutable:m}=l;if(m&&!this._wasImmutablyAllocated)throw new U("Cannot update immutable texture before allocation!");const y=c.bindTexture(this,zl.TEXTURE_UNIT_FOR_UPDATES,!0);(i<0||r<0||i+s>l.width||r+n>l.height)&&Qv().error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:v}=c;a&&(s&&n||Qv().warn("Must pass width and height if `UNPACK_SKIP_ROWS` is used"),v.pixelStorei(v.UNPACK_SKIP_ROWS,a)),Ihe(o)?v.texSubImage2D(f,e,i,r,s,n,h,d,o):OE(o)?v.compressedTexSubImage2D(f,e,i,r,s,n,l.internalFormat,o.levels[e]):v.texSubImage2D(f,e,i,r,s,n,h,d,o),a&&v.pixelStorei(v.UNPACK_SKIP_ROWS,0),c.bindTexture(y,zl.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,i,r,s,n,o,a,l){l||Qv().error("An attempt to use uninitialized data!"),this._glName||Qv().error("An attempt to update an uninitialized texture!");const c=this._descriptor;c.internalFormat=KL(c);const{context:h,pixelFormat:d,dataType:f,isImmutable:m,target:y}=c;if(m&&!this._wasImmutablyAllocated)throw new U("Cannot update immutable texture before allocation!");pT(y)||Qv().warn("Attempting to set 3D texture data on a non-3D texture");const v=h.bindTexture(this,zl.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(zl.TEXTURE_UNIT_FOR_UPDATES),(i<0||r<0||s<0||i+n>c.width||r+o>c.height||s+a>c.depth)&&Qv().error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:_}=h;if(OE(l))l=l.levels[e],_.compressedTexSubImage3D(y,e,i,r,s,n,o,a,c.internalFormat,l);else{const b=l;_.texSubImage3D(y,e,i,r,s,n,o,a,d,f,b)}h.bindTexture(v,zl.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(e.width===0||e.height===0)return;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new U("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,XL(e)}e.samplingMode===di.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=di.LINEAR_MIPMAP_NEAREST):e.samplingMode===di.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=di.NEAREST_MIPMAP_NEAREST);const i=this._descriptor.context.bindTexture(this,zl.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(zl.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(i,zl.TEXTURE_UNIT_FOR_UPDATES)}clearMipmap(){const e=this._descriptor;if(e.hasMipmap){if(this._wasImmutablyAllocated)throw new U("Cannot delete mipmaps to immutable texture after allocation");e.hasMipmap=!1,this._samplingModeDirty=!0,XL(e)}e.samplingMode===di.LINEAR_MIPMAP_NEAREST?(this._samplingModeDirty=!0,e.samplingMode=di.LINEAR):e.samplingMode===di.NEAREST_MIPMAP_NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=di.NEAREST)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,XL(this._descriptor),this._wrapModeDirty=!0)}applyChanges(){this._samplingModeDirty&&(this._applySamplingMode(),this._samplingModeDirty=!1),this._wrapModeDirty&&(this._applyWrapMode(),this._wrapModeDirty=!1)}abortCompression(){this.isCompressing&&(this._compressionAbortController.value=hc(this._compressionAbortController.value))}_setData(e,i){const r=this._descriptor,s=r.context?.gl;if(!s)return;ed(s),this._glName||(this._glName=s.createTexture(),this._glName&&r.context.instanceCounter.increment(Hs.Texture,this)),XL(r);const n=r.context.bindTexture(this,zl.TEXTURE_UNIT_FOR_UPDATES);r.context.setActiveTexture(zl.TEXTURE_UNIT_FOR_UPDATES),this._configurePixelStorage(),ed(s);const o=i??r.target,a=pT(o);if(Ihe(e))this._setDataFromTexImageSource(e,o);else{const{width:l,height:c,depth:h}=r;if(l==null||c==null)throw new U("Width and height must be specified!");if(a&&h==null)throw new U("Depth must be specified!");if(r.internalFormat=KL(r),r.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(o,r.internalFormat,r.hasMipmap,l,c,h),OE(e)){if(!iMe(r.internalFormat))throw new U("Attempting to use compressed data with an uncompressed format!");this._setDataFromCompressedSource(e,r.internalFormat,o)}else this._texImage(o,0,r.internalFormat,l,c,h,e),ed(s),r.hasMipmap&&this.generateMipmap()}this._applySamplingMode(),this._applyWrapMode(),this._applyAnisotropicFilteringParameters(),ed(s),r.context.bindTexture(n,zl.TEXTURE_UNIT_FOR_UPDATES)}_setDataCubeMap(e=null){for(let i=ts.TEXTURE_CUBE_MAP_POSITIVE_X;i<=ts.TEXTURE_CUBE_MAP_NEGATIVE_Z;i++)this._setData(e,i)}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:i,flipped:r,preMultiplyAlpha:s}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,i),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_setDataFromTexImageSource(e,i){const{gl:r}=this._descriptor.context,s=this._descriptor;s.internalFormat=KL(s);const n=pT(i),{width:o,height:a,depth:l}=brt(e);s.width&&s.height,s.width||(s.width=o),s.height||(s.height=a),n&&s.depth,n&&(s.depth=l),s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(i,s.internalFormat,s.hasMipmap,o,a,l),this._texImage(i,0,s.internalFormat,o,a,l,e),ed(r),s.hasMipmap&&(this.generateMipmap(),ed(r))}_setDataFromCompressedSource(e,i,r){const s=this._descriptor,{width:n,height:o,depth:a}=s,l=e.levels,c=Rhe(r,n,o,a),h=Math.min(c,l.length)-1;this._descriptor.context.gl.texParameteri(s.target,s.context.gl.TEXTURE_MAX_LEVEL,h),this._forEachMipmapLevel((d,f,m,y)=>{const v=l[Math.min(d,l.length-1)];this._compressedTexImage(r,d,i,f,m,y,v)},h)}_texStorage(e,i,r,s,n,o){const{gl:a}=this._descriptor.context;if(!yrt(i))throw new U("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=r?Rhe(e,s,n,o):1;if(pT(e)){if(o==null)throw new U("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,i,s,n,o)}else a.texStorage2D(e,l,i,s,n);this._wasImmutablyAllocated=!0}_texImage(e,i,r,s,n,o,a){const l=this._descriptor.context.gl,c=pT(e),{isImmutable:h,pixelFormat:d,dataType:f}=this._descriptor;if(h){if(a!=null){const m=a;if(c){if(o==null)throw new U("Missing depth dimension for 3D texture upload");l.texSubImage3D(e,i,0,0,0,s,n,o,d,f,m)}else l.texSubImage2D(e,i,0,0,s,n,d,f,m)}}else{const m=a;if(c){if(o==null)throw new U("Missing depth dimension for 3D texture upload");l.texImage3D(e,i,r,s,n,o,0,d,f,m)}else l.texImage2D(e,i,r,s,n,0,d,f,m)}}_compressedTexImage(e,i,r,s,n,o,a){const l=this._descriptor.context.gl,c=pT(e);if(this._descriptor.isImmutable){if(a!=null)if(c){if(o==null)throw new U("Missing depth dimension for 3D texture upload");l.compressedTexSubImage3D(e,i,0,0,0,s,n,o,r,a)}else l.compressedTexSubImage2D(e,i,0,0,s,n,r,a)}else if(c){if(o==null)throw new U("Missing depth dimension for 3D texture upload");l.compressedTexImage3D(e,i,r,s,n,o,0,a)}else l.compressedTexImage2D(e,i,r,s,n,0,a)}async _compressOnWorker(e){if(!zl.compressionWorkerHandle||!zl.compressionWorkerHandle.isCompressible(e))return;const i=this._descriptor.context?.gl.getExtension("WEBGL_compressed_texture_etc"),r=this._descriptor.context?.gl.getExtension("WEBGL_compressed_texture_s3tc");if(i||r){const s=new AbortController;this._compressionAbortController.value=s;const n={data:await createImageBitmap(e),flipped:this.descriptor.flipped,width:e.width,height:e.height,hasMipmap:this._descriptor.hasMipmap,hasETC:!!i,hasS3TC:!!r};zl.compressionWorkerHandle.invoke(n,this._compressionAbortController.value.signal).then(o=>{o&&this.isCompressing&&this.glName&&(this._descriptor.internalFormat=o.internalFormat,this._setData(o.compressedTexture)),s===this._compressionAbortController.value&&(this._compressionAbortController.value=null)}).catch(o=>{Xr(o)||s!==this._compressionAbortController.value||(this._compressionAbortController.value=null)})}}_forEachMipmapLevel(e,i=1/0){let{width:r,height:s,depth:n,hasMipmap:o,target:a}=this._descriptor;const l=a===ts.TEXTURE_3D;if(r==null||s==null||l&&n==null)throw new U("Missing texture dimensions for mipmap calculation");for(let c=0;e(c,r,s,n),o&&(r!==1||s!==1||l&&n!==1)&&!(c>=i);++c)r=Math.max(1,r>>1),s=Math.max(1,s>>1),l&&(n=Math.max(1,n>>1))}_applySamplingMode(){const e=this._descriptor,i=e.context?.gl;let r=e.samplingMode,s=e.samplingMode;r===di.LINEAR_MIPMAP_NEAREST||r===di.LINEAR_MIPMAP_LINEAR?(r=di.LINEAR,e.hasMipmap||(s=di.LINEAR)):r!==di.NEAREST_MIPMAP_NEAREST&&r!==di.NEAREST_MIPMAP_LINEAR||(r=di.NEAREST,e.hasMipmap||(s=di.NEAREST)),i.texParameteri(e.target,i.TEXTURE_MAG_FILTER,r),i.texParameteri(e.target,i.TEXTURE_MIN_FILTER,s)}_applyWrapMode(){const e=this._descriptor,i=e.context?.gl;typeof e.wrapMode=="number"?(i.texParameteri(e.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(e.target,i.TEXTURE_WRAP_T,e.wrapMode)):(i.texParameteri(e.target,i.TEXTURE_WRAP_S,e.wrapMode.s),i.texParameteri(e.target,i.TEXTURE_WRAP_T,e.wrapMode.t))}_applyAnisotropicFilteringParameters(){const e=this._descriptor,i=e.context.capabilities.textureFilterAnisotropic;i&&e.context.gl.texParameterf(e.target,i.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}};yi.TEXTURE_UNIT_FOR_UPDATES=0,yi.compressionWorkerHandle=null;const cH=()=>J.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient");function xrt(t,e){e.fillColor[0]=t.color.r/255,e.fillColor[1]=t.color.g/255,e.fillColor[2]=t.color.b/255,e.fillColor[3]=t.color.a,t.haloColor?(e.outlineColor[0]=t.haloColor.r/255,e.outlineColor[1]=t.haloColor.g/255,e.outlineColor[2]=t.haloColor.b/255,e.outlineColor[3]=t.haloColor.a):(e.outlineColor[0]=e.fillColor[0],e.outlineColor[1]=e.fillColor[1],e.outlineColor[2]=e.fillColor[2],e.outlineColor[3]=e.fillColor[3]),e.fillColor[3]*=t.fillOpacity,e.outlineColor[3]*=t.haloOpacity,e.fillColor[0]*=e.fillColor[3],e.fillColor[1]*=e.fillColor[3],e.fillColor[2]*=e.fillColor[3],e.outlineColor[0]*=e.outlineColor[3],e.outlineColor[1]*=e.outlineColor[3],e.outlineColor[2]*=e.outlineColor[3],e.outlineWidth=(1-t.haloBlur)*t.haloWidth,e.outerHaloWidth=t.haloBlur*t.haloWidth/2,e.innerHaloWidth=t.haloBlur*t.haloWidth/2,e.outlinePosition=0}const Srt=[0,0,0,0];let sMe=class{constructor(){this.type="single",this._highlightOptions=new Lm,this._convertedHighlightOptions={fillColor:[0,0,0,0],outlineColor:[0,0,0,0],outlinePosition:0,outlineWidth:0,innerHaloWidth:0,outerHaloWidth:0},this._optionsShadeTexKey="",this._texelData=new Uint8Array(4*fM),this._minMaxDistance=[0,0]}setHighlightOptions(e){this._highlightOptions=e}applyHighlightOptions(e,i){this._updateGradientTexture(e),e.bindTexture(this._shadeTex,nrt),i.setUniform2fv("u_minMaxDistance",this._minMaxDistance)}destroy(){this._shadeTex?.dispose(),this._shadeTex=null}getReasonsWithGradients(){return[{activeReasons:(1<<QAe)-1,activeGradient:this}]}_updateGradientTexture(e){const i=Trt(this._highlightOptions);if(i===this._optionsShadeTexKey)return;this._optionsShadeTexKey=i,xrt(this._highlightOptions,this._convertedHighlightOptions);const r=this._convertedHighlightOptions,s=r.outlinePosition-r.outlineWidth/2-r.outerHaloWidth,n=r.outlinePosition-r.outlineWidth/2,o=r.outlinePosition+r.outlineWidth/2,a=r.outlinePosition+r.outlineWidth/2+r.innerHaloWidth,l=Math.sqrt(Math.PI/2)*crt,c=Math.abs(s)>l?Math.round(10*(Math.abs(s)-l))/10:0,h=Math.abs(a)>l?Math.round(10*(Math.abs(a)-l))/10:0;let d;c&&!h?cH().error("The outer rim of the highlight is "+c+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!c&&h?cH().error("The inner rim of the highlight is "+h+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):c&&h&&cH().error("The highlight is "+Math.max(c,h)+"px away from the edge of the feature; consider reducing some width values.");const f=[void 0,void 0,void 0,void 0];function m(v,_,b){f[0]=(1-b)*v[0]+b*_[0],f[1]=(1-b)*v[1]+b*_[1],f[2]=(1-b)*v[2]+b*_[2],f[3]=(1-b)*v[3]+b*_[3]}const{_texelData:y}=this;for(let v=0;v<fM;++v)d=s+v/(fM-1)*(a-s),d<s?(f[0]=0,f[1]=0,f[2]=0,f[3]=0):d<n?m(Srt,r.outlineColor,(d-s)/(n-s)):d<o?[f[0],f[1],f[2],f[3]]=r.outlineColor:d<a?m(r.outlineColor,r.fillColor,(d-o)/(a-o)):[f[0],f[1],f[2],f[3]]=r.fillColor,y[4*v]=255*f[0],y[4*v+1]=255*f[1],y[4*v+2]=255*f[2],y[4*v+3]=255*f[3];if(this._minMaxDistance[0]=s,this._minMaxDistance[1]=a,!this._shadeTex){const v=new $r;v.wrapMode=nr.CLAMP_TO_EDGE,v.width=fM,v.height=1,this._shadeTex=new yi(e,v)}this._shadeTex.updateData(0,0,0,fM,1,this._texelData)}};function Trt(t){return`${t.color};${t.haloColor};${t.haloOpacity};${t.fillOpacity};${t.haloWidth};${t.haloBlur}`}let Ert=class{constructor(){this.type="multi",this.gradients=[]}setHighlightOptions(e){for(let i=0;i<e.length;i++)this.gradients[i]||(this.gradients[i]=new sMe),this.gradients[i].setHighlightOptions(e[i]);for(let i=e.length+1;i<this.gradients.length;i++)this.gradients[i].destroy();this.gradients.length=e.length}destroy(){for(const e of this.gradients)e.destroy()}getReasonsWithGradients(){let e=1;const i=[];for(let r=0;r<this.gradients.length;r++){const s=this.gradients[r];i.push({activeReasons:e,activeGradient:s}),e<<=1}return i}};var Phe,Dhe,Lhe,Nhe,Fhe,khe,_U,zhe,Uhe;(function(t){t[t.FILL=0]="FILL",t[t.LINE=1]="LINE",t[t.MARKER=2]="MARKER",t[t.TEXT=3]="TEXT",t[t.LABEL=4]="LABEL"})(Phe||(Phe={})),function(t){t[t.NONE=0]="NONE",t[t.MAP=1]="MAP",t[t.LABEL=2]="LABEL",t[t.LABEL_ALPHA=4]="LABEL_ALPHA",t[t.HITTEST=8]="HITTEST",t[t.HIGHLIGHT=16]="HIGHLIGHT",t[t.CLIP=32]="CLIP",t[t.DEBUG=64]="DEBUG",t[t.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES"}(Dhe||(Dhe={})),function(t){t[t.SIZE=0]="SIZE",t[t.COLOR=1]="COLOR",t[t.OPACITY=2]="OPACITY",t[t.ROTATION=3]="ROTATION"}(Lhe||(Lhe={})),function(t){t[t.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE",t[t.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE",t[t.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE",t[t.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"}(Nhe||(Nhe={})),function(t){t[t.SPRITE=0]="SPRITE",t[t.GLYPH=1]="GLYPH"}(Fhe||(Fhe={})),function(t){t[t.DEFAULT=0]="DEFAULT",t[t.SIMPLE=1]="SIMPLE",t[t.DOT_DENSITY=2]="DOT_DENSITY",t[t.OUTLINE_FILL=3]="OUTLINE_FILL",t[t.OUTLINE_FILL_SIMPLE=4]="OUTLINE_FILL_SIMPLE",t[t.HEATMAP=5]="HEATMAP",t[t.PIE_CHART=6]="PIE_CHART"}(khe||(khe={})),function(t){t[t.All=0]="All",t[t.Highlight=1]="Highlight",t[t.InsideEffect=2]="InsideEffect",t[t.OutsideEffect=3]="OutsideEffect"}(_U||(_U={})),function(t){t[t.BATCHING=0]="BATCHING",t[t.STRICT_ORDER=1]="STRICT_ORDER",t[t.STRICT_MARKERS_AND_TEXT=2]="STRICT_MARKERS_AND_TEXT"}(zhe||(zhe={})),function(t){t[t.FILL=0]="FILL",t[t.LINE=1]="LINE",t[t.MARKER=2]="MARKER",t[t.TEXT=3]="TEXT"}(Uhe||(Uhe={}));const nMe={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:{write:!1,test:{ref:t=>t.stencilRef,compare:Ni.EQUAL,mask:255,op:{fail:Yi.KEEP,zFail:Yi.KEEP,zPass:Yi.REPLACE}}}},Crt={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:!1},$rt={...nMe,color:{write:[!0,!0,!0,!0],blendMode:"delete"}};function Art({pixelRatio:t,state:e,displayLevel:i,requiredLevel:r},s){const n=1/2**(i-s.key.level),o=1/2**(r-s.key.level);return{displayMat3:e.displayMat3,displayViewMat3:e.displayViewMat3,displayViewScreenMat3:s.transforms.displayViewScreenMat3,viewMat3:e.viewMat3,tileMat3:s.transforms.tileMat3,displayZoomFactor:n,requiredZoomFactor:o,tileOffset:[s.x,s.y],currentScale:e.scale,currentZoom:i,metersPerSRUnit:Ao(e.spatialReference),rotation:e.rotation,pixelRatio:t}}function oMe(t){return t.passOptions?.type==="highlight"}function aMe(t){return t.passOptions?.type==="hittest"}function Mrt(t){if(!aMe(t))return null;const{position:e,distance:i,smallSymbolDistance:r,smallSymbolSizeThreshold:s}=t.passOptions;return{position:e,distance:i,smallSymbolDistance:r,smallSymbolSizeThreshold:s}}function Ort(t){if(!oMe(t))return null;const{activeReasons:e,highlightAll:i}=t.passOptions;return{activeReasons:e,highlightAll:i?1:0}}function wZt(t,e,i){const r={};for(const s in i)i[s]instanceof Function?r[s]=i[s](t,e):r[s]=i[s];return r}function xZt(t,e){const{attributeView:i,context:r}=t;return{storage:i.getUniforms(r),view:Art(t,e),hittestRequest:Mrt(t),highlight:Ort(t)}}function SZt(t){return{inside:t.selection===_U.InsideEffect,outside:t.selection===_U.OutsideEffect}}function Irt(t){return aMe(t)?Crt:oMe(t)&&t.passOptions.stepType==="clear"?$rt:nMe}function TZt(t){const{row:e,col:i}=t.key,r=i*Ehe,s=e*Ehe;return{tileOffsetFromLocalOrigin:[r%JL,s%JL],maxIntsToLocalOrigin:[Math.floor(r/JL),Math.floor(s/JL)]}}const Rrt=new ei({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function EZt(t){return Rrt.toJSON(t)}function CZt(t){const{bandCount:e,attributeTable:i,colormap:r,pixelType:s}=t.raster.rasterInfo;return e===1&&(i!=null||r!=null||s==="u8"||s==="s8")}function Prt(t,e){return e==null?(t?.destroy(),null):(t?.type==="single"&&Array.isArray(e)&&(t.destroy(),t=null),t?.type!=="multi"||Array.isArray(e)||(t.destroy(),t=null),t||(t=Array.isArray(e)?new Ert:new sMe),Array.isArray(e)?t.type==="multi"&&t.setHighlightOptions(e):t.type==="single"&&t.setHighlightOptions(e),t)}function $Zt(t,e,i,r){const{painter:s,highlightGradient:n}=t,{highlight:o}=s.effects;if(!n)return;const a=t.passOptions,l=n.getReasonsWithGradients();for(let c=0;c<l.length;c++){const h={...t,passOptions:{type:"highlight",activeGradient:l[c].activeGradient,activeReasons:l[c].activeReasons,stepType:"burn",highlightAll:e}};if(o.bind(h),i(h),c<l.length-1){let f=0;for(let m=c+1;m<l.length;m++)f|=l[m].activeReasons;i({...t,passOptions:{type:"highlight",activeGradient:l[c].activeGradient,activeReasons:f,stepType:"clear",highlightAll:e}})}const d={...t,passOptions:{type:"highlight",activeGradient:l[c].activeGradient,activeReasons:l[c].activeReasons,stepType:"draw",highlightAll:e}};s.setPipelineState(Irt(t)),s.updatePipelineState(t.context),o.draw(d),o.unbind()}t.passOptions=a}function AZt(t){if(!t)return[];let e=AYe(t)?[t]:Ee.isCollection(t)?t.toArray():Array.isArray(t)?t:[];return e=e?.filter(of),(e?.length??0)===0?[]:e}const QL=t=>parseFloat(t)/100;function Drt(t,e,i){const r=typeof t.left=="string"?QL(t.left)*e:t.left,s=typeof t.right=="string"?QL(t.right)*e:t.right,n=typeof t.top=="string"?QL(t.top)*i:t.top,o=typeof t.bottom=="string"?QL(t.bottom)*i:t.bottom,a=n;return{xmin:r,xmax:Math.max(e-s,r),ymin:a,ymax:Math.max(i-o,n)}}function lMe(t,e,i,r){switch(e.type){case"rect":{const{width:s,height:n}=t,{xmin:o,xmax:a,ymin:l,ymax:c}=Drt(e,s,n),{x:h,y:d}=i;return h>o&&h<a&&d>l&&d<c}case"path":return e.path.length===0||!Array.isArray(e.path[0][0])||ate(e.path,[i.x,i.y]);case"geometry":return e.geometry==null||(e.geometry.type==="polygon"?ote(e.geometry,r):eD(e.geometry,r))}}function Lrt(t){if(!t.highlights)return null;const e=t.highlights.findIndex(i=>i.name==="default");return e===-1?null:t.highlights.items[e]}function Nrt(t,e){if(!t.highlights){if(!e)return;t.highlights=new Ee([new Lm])}const i=t.highlights.findIndex(r=>r.name==="default");e?t.highlights.items[i].assignFrom(e):(t.highlights.removeAt(i),t.highlights.length===0&&(t.highlights=null))}async function Frt(t,e,i){const r=cU(e)?lU(t,e):e;if(!t.ready||isNaN(r.x)||isNaN(r.y))return{screenPoint:r,results:[]};let s=new Set;const n=new Set;let o=!1,a=null,l=null;i?.include?Vhe(i.include,Bhe(t,f=>{s.add(f),uH(f,m=>n.add(m))},(f,m)=>{n.add(f),s.add(m)},f=>{a||(a=new Set),a.add(f)},f=>s.add(f),()=>o=!0)):(o=!0,s=new Set(t.allLayerViews),s.forEach(f=>{uH(f,m=>n.add(m))})),i?.exclude&&Vhe(i.exclude,Bhe(t,f=>{s.delete(f),uH(f,m=>n.delete(m))},f=>n.delete(f),f=>{l||(l=new Set),l.add(f)}));const c=t.toMap(r),h=t.allLayerViews.filter(f=>!f.suspended&&s.has(f)&&f.clips.every(m=>lMe(t,m,r,c))).reverse();let d=[...o?t.graphicsView.hitTest(c).map(f=>({type:"graphic",graphic:f,layer:null,mapPoint:c})):[],...await Promise.all(h.map(f=>f.hitTest(c,r)).toArray())].filter(of).flat().filter(of);return d=d.filter(f=>f.type!=="graphic"||f.layer?.type!=="subtype-group"||n.has(f.graphic.layer)),a&&(d=d.filter(f=>!("graphic"in f)||!f.graphic||a?.has(pY(f.graphic)))),l&&(d=d.filter(f=>!("graphic"in f)||!f.graphic||!l?.has(pY(f.graphic)))),{screenPoint:r,results:d}}function Bhe(t,e,i,r,s,n){return o=>{if(o instanceof Ml){if(o.layer===t)n?.();else{const a=t.allLayerViews.find(l=>l.layer===o.layer);a&&s?.(a)}r(pY(o))}else if(!("layer"in o&&"element"in o))if(o.type==="subtype-sublayer"){const a=t.allLayerViews.find(l=>l.layer===o.parent);a&&i(o,a)}else{const a=t.allLayerViews.find(l=>l.layer===o);a&&e(a)}}}function Vhe(t,e){if(t)if(wP(t))for(const i of t)if(wP(i))for(const r of i)e(r);else e(i);else e(t)}function pY(t){const e=t.getObjectId();return e?`${t.layer?.uid??t.sourceLayer?.uid??"MapView"}/${e}`:`"MapView/${t.uid}`}function uH({layer:t},e){t?.type==="subtype-group"&&t.sublayers.forEach(i=>{e(i)})}let mM=null,bU=!0;function b4(t,e,i){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(bU)try{return new ImageData(t,e)}catch{bU=!1}return cMe(t,e,i)}function MZt(t,e,i,r){if(!e||!i)throw new Error("Cannot construct image data without dimensions");if(bU)try{return new ImageData(t,e,i)}catch{bU=!1}const s=cMe(e,i,r);return s.data.set(t,0),s}function krt(){return mM||(mM=document.createElement("canvas"),mM.width=1,mM.height=1),mM}function cMe(t,e,i){return i||(i=krt()),i.getContext("2d").createImageData(t,e)}async function zrt(t,e){const i=window.URL.createObjectURL(t);try{const{data:r}=await Ci(i,{...e,responseType:"image"});return r}catch(r){throw Xr(r)?r:new U("invalid-image",`Could not fetch requested image at ${i}`)}finally{window.URL.revokeObjectURL(i)}}async function OZt(t,e){const{arrayBuffer:i,mediaType:r}=await Urt(t,e),s=r==="image/png";if(r==="image/gif"){const{isAnimatedGIF:n,parseGif:o}=await V(()=>import("./gif-DJVAB9o0.js"),[]);if(n(i))return o(i,e)}if(s){const{isAnimatedPNG:n,parseApng:o}=await V(()=>import("./apng-B03vlLwb.js"),__vite__mapDeps([229,3]));if(n(i))return o(i,e)}return zrt(new Blob([i],{type:r}),e)}async function Urt(t,e){const i=qx(t);if(i?.isBase64)return{arrayBuffer:Mxe(i.data),mediaType:i.mediaType};const r=await Ci(t,{responseType:"array-buffer",...e});return{arrayBuffer:r.data,mediaType:r.getHeader?.("Content-Type")??""}}const jhe=2048,Brt=1.5,Vrt=8;function uMe(t,e){const{format:i,quality:r,rotation:s,disableDecorations:n}=t||{},o=qie(t,e.padding),a=Wrt(t,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:l,height:c}=qrt(t,a),h=_Me(i),d=bMe[h];return{format:h,quality:ce(r??d,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!!t?.ignoreBackground,ignorePadding:!!t?.ignorePadding}}function jrt(t,e){const i=uMe(t,e),r=i.area,s=i.width/r.width,n=qie(i,e.padding),o=n.left+n.right,a=n.top+n.bottom,l=e.width-o,c=e.height-a,h=Math.floor(l*s+o),d=Math.floor(c*s+a),f=t?.layers??[],m=i.ignoreBackground,y=i.ignorePadding;return{framebufferWidth:h,framebufferHeight:d,region:{x:Math.floor(r.x*s)+n.left,y:Math.floor(r.y*s)+n.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:s,layers:f,disableDecorations:i.disableDecorations,ignoreBackground:m,ignorePadding:y,objectAndLayerIdColor:!1}}function hMe(t,e,i){const{ctx:r,canvas:s}=pMe(t,i),n=r.getImageData(0,0,t.width,t.height),o=mMe(s,e);return fMe(s),{dataUrl:o,data:n}}function dMe(t,e){const{ctx:i,canvas:r}=pMe(t,e),s=i.getImageData(0,0,t.width,t.height);return fMe(r),s}function pMe(t,e){const i=Grt();e.premultipliedAlpha&&Xrt(t),i.width=t.width,i.height=t.height;const r=i.getContext("2d",{willReadFrequently:!0});return r.putImageData(t,0,0),e.flipY&&Jrt(r),{ctx:r,canvas:i}}function fMe(t){t.width=0,t.height=0}function Grt(){return hH==null&&(hH=document.createElement("canvas")),hH}let hH=null;function mMe(t,e){const i=Krt[e.format],r=e.quality/100;return t.toDataURL(i,r)}function gMe(t,e){const i=_Me(t),r=bMe[i];return{format:i,quality:ce(e??r,0,100)}}function yMe(t,e){return e/Math.max(t[0],t[1])}function vMe(t,e,i,r=0,s=0,n=t.width-r,o=t.height-s,a=!1){const{data:l}=t,{width:c,height:h,data:d}=e,f=n/c,m=o/h,y=Math.ceil(f/2),v=Math.ceil(m/2),_=t.width;for(let b=0;b<h;b++)for(let w=0;w<c;w++){const x=4*(w+(a?h-b-1:b)*c);let S=0,C=0,T=0,M=0,I=0,P=0;const D=(b+.5)*m;for(let F=Math.floor(b*m);F<(b+1)*m;F++){const L=Math.abs(D-(F+.5))/v,N=(w+.5)*f,R=L*L;for(let k=Math.floor(w*f);k<(w+1)*f;k++){const W=Math.abs(N-(k+.5))/y,G=Math.sqrt(R+W*W);if(G>=1)continue;let j=2*G*G*G-3*G*G+1;const re=4*(r+k+(s+F)*_);P+=j*l[re+3],C+=j,!i&&l[re+3]<255&&(j=j*l[re+3]/255),T+=j*l[re],M+=j*l[re+1],I+=j*l[re+2],S+=j}}d[x]=T/S,d[x+1]=M/S,d[x+2]=I/S,d[x+3]=P/C}return e}function Hrt(t,e,i){if(!e)return t;const{framebufferWidth:r,framebufferHeight:s,pixelRatio:n,region:o}=t,a=qie(t,i),l=a.left+a.right,c=a.top+a.bottom,h=r-l,d=s-c,f=Math.min(Vrt,Math.min((jhe-l)/h,(jhe-c)/d));return f<Brt?t:{...t,framebufferWidth:Math.round(h*f)+l,framebufferHeight:Math.round(d*f)+c,pixelRatio:n*f,resample:{region:{x:Math.round((o.x-a.left)*f)+a.left,y:Math.round((o.y-a.top)*f)+a.top,width:Math.round(o.width*f),height:Math.round(o.height*f)},width:r,height:s}}}function qrt(t,e){if(!t)return e;const i=t.width,r=t.height;if(i!=null&&r!=null)return{width:Math.floor(i),height:Math.floor(r)};if(i==null&&r==null)return e;const s=e.width/e.height;return r==null?{width:Math.floor(i),height:Math.floor(i/s)}:{width:Math.floor(r*s),height:Math.floor(r)}}function Wrt(t,e){const i={x:0,y:0,width:e.width,height:e.height};if(t?.area){t.area.x!=null&&(i.x=Math.floor(t.area.x)),t.area.y!=null&&(i.y=Math.floor(t.area.y));const r=t.area.width!=null?Math.floor(t.area.width):null,s=t.area.height!=null?Math.floor(t.area.height):null;if(i.width=e.width-i.x,i.height=e.height-i.y,r!=null&&s!=null)i.width=Math.min(i.width,r),i.height=Math.min(i.height,s);else if(r==null&&s!=null){const n=Math.min(i.width,r);i.height=n/i.width*i.height,i.width=n}else if(r!=null&&s==null){const n=Math.min(i.height,s);i.width=n/i.height*i.width,i.height=n}}return Zrt(Yrt(i,t),e)}function Zrt(t,e){const i=Math.floor(Math.max(t.x,0)),r=Math.floor(Math.max(t.y,0)),s={x:i,y:r,width:Math.floor(Math.min(t.width,e.width-i)),height:Math.floor(Math.min(t.height,e.height-r))},n=s.width/s.height,o=t.width/t.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),h=s.height-c;return{x:s.x,y:Math.floor(s.y+h/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function Yrt(t,e){if(e?.width==null||e.height==null)return t;const i=e.width/e.height,r=t.width/t.height;if(r===i)return t;if(r<i){const n=Math.floor(t.height*i);return t.x-=(n-t.width)/2,t.width=n,t}const s=Math.floor(t.width/i);return t.y-=(s-t.height)/2,t.height=s,t}function qie(t,e){return!e||t?.ignorePadding?est:e}function _Me(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return Qrt}}function Jrt(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function Xrt(t){const e=t.data,i=e.length;for(let r=0;r<i;r+=4){const s=e[r+3];if(s!==255&&s>0){const n=255/s;e[r]=e[r]*n,e[r+1]=e[r+1]*n,e[r+2]=e[r+2]*n}}}const Krt={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},Ghe=98,Qrt="png",bMe={png:100,jpg:Ghe,jpeg:Ghe},est={top:0,right:0,bottom:0,left:0},gM=Object.freeze(Object.defineProperty({__proto__:null,completeUserSettings:uMe,createEmptyImageData:b4,encode:hMe,encodeData:dMe,getFormatAndQuality:gMe,getMaximumResolutionScale:yMe,resampleHermite:vMe,screenshotSuperSampleSettings:Hrt,toDataUrl:mMe,toRenderSettings:jrt},Symbol.toStringTag,{value:"Module"})),wMe={flipY:!0,premultipliedAlpha:!0};async function tst(t,e){const i=await xMe(t,e),{format:r,quality:s}=gMe(e?.format,e?.quality);return hMe(i,{format:r,quality:s},wMe)}async function ist(t,e){const i=await xMe(t,e);return dMe(i,wMe)}function xMe(t,e){const i=nst(e||{},sst(t.stage,t.size),t.size,t.padding),r=rst(e,t.allLayerViews);return t.stage.takeScreenshot(i,r,t.backgroundColor,e?.rotation)}function rst(t={},e){if(!t.layers)return;const i=[];return t.layers.forEach(r=>{const s=e.find(n=>n.layer.id===r.id);s?.container&&i.push(s.container)}),i}function sst(t,e){return Math.min(4,yMe(e,Math.min(4096,t.context.parameters.maxTextureSize)))}function nst(t,e,i,r){t.ignorePadding&&(r={left:0,right:0,top:0,bottom:0});let s=null;t.width!=null&&t.height!=null?s=[t.width,t.height]:t.width==null&&t.height!=null?s=[t.height,t.height]:t.width!=null&&t.height==null?s=[t.width,t.width]:t.width==null&&t.height==null&&(s=null);const n=i[0]-(r.left+r.right),o=i[1]-(r.top+r.bottom);let a,l,c=t.area||{x:0,y:0,width:n,height:o};if(s){const h=n/o,d=s[0]/s[1];if(d>h){const f=c.width/d;c={x:c.x,y:Math.round(c.y+(c.height-f)/2),width:c.width,height:Math.round(f)}}else{const f=c.height*d;c={x:Math.round(c.x+(c.width-f)/2),y:c.y,width:Math.round(f),height:c.height}}}else s=[c.width,c.height];return s[0]>c.width?(a=Math.min(s[0]/c.width,e),l=s[0]/c.width/a):(a=1,l=s[0]/c.width),{cropArea:{x:Math.round((c.x+r.left)*a),y:Math.round((c.y+r.top)*a),width:Math.round(c.width*a),height:Math.round(c.height*a)},outputScale:l,resolutionScale:a}}const ost=t=>t.includes("Brush");let SMe=class{constructor(){this._names=new Map}begin(e){this._names.has(e)||(this._names.set(e,!1),ost(e)&&this.record("Esri.FirstDraw"),performance.mark(`Esri.${e}.Start`))}end(e){this._names.has(e)&&!this._names.get(e)&&(this._names.set(e,!0),performance.mark(`Esri.${e}.End`))}record(e){this._names.has(e)||(this._names.set(e,!0),performance.mark(`Esri.${e}`))}};function TMe(t,e){const i=e.debugRendererInfo&&t.getExtension("WEBGL_debug_renderer_info");return i?{getUnmaskedRendererWebGL:()=>t.getParameter(i.UNMASKED_RENDERER_WEBGL)}:null}let Hhe;function ast(){return Hhe??=ust(),Hhe}let lst=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1,this.unmaskedRenderer="unloaded"}};function cst(t){if(typeof WebGL2RenderingContext>"u")return null;const e=document.createElement("canvas");if(!e)return null;let i=e.getContext("webgl2",{failIfMajorPerformanceCaveat:!0});if(i==null&&(i=e.getContext("webgl2"),i!=null&&(t.majorPerformanceCaveat=!0)),i==null)return i;t.available=!0,t.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const r=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return r&&(t.supportsHighPrecisionFragment=r.precision>0),i}function ust(){const t=new lst,e=cst(t);return e==null||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null,t.unmaskedRenderer=TMe(e,{debugRendererInfo:!0})?.getUnmaskedRendererWebGL()??"unknown"),t}function EMe(t){const e=ast();return e.available?t==="3d"&&e.majorPerformanceCaveat?new U("webgl:major-performance-caveat-detected",`Your WebGL implementation (${e.unmaskedRenderer}) doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.`):e.supportsHighPrecisionFragment?e.supportsVertexShaderSamplers?null:new U("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new U("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new U("webgl:required","WebGL2 is required but not supported.",new Error().stack)}function hst(t){return t&&"nodeType"in t}function dst(t){return t&&typeof t.render=="function"}const qhe={component:"esri-component"};let d1=class extends ue{constructor(){super(...arguments),this.widget=null}destroy(){this.node=null,this.widget?.destroy()}get id(){return this._get("id")??this.widget?.id??this.node?.id}set id(e){this._set("id",e)}set node(e){const i=this._get("node");e!==i&&(e&&e.classList.add(qhe.component),i&&i.classList.remove(qhe.component),this._set("node",e))}castNode(e){return this.widget?.destroy(),e?typeof e=="string"||hst(e)?(this._set("widget",null),FV(e)):(dst(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};u([p()],d1.prototype,"id",null),u([p()],d1.prototype,"node",null),u([Yt("node")],d1.prototype,"castNode",null),u([p({readOnly:!0})],d1.prototype,"widget",void 0),d1=u([A("esri.views.ui.Component")],d1);const OR=d1,CMe="calcite-mode-";function pst(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"")}function fst(){return pst().startsWith("dark")}function mst(){return`${CMe}${fst()?"dark":"light"}`}function gst(t){yst(t),t.classList.add(mst())}function yst(t){Array.from(t.classList).forEach(e=>{e.startsWith(CMe)&&t.classList.remove(e)})}const vst={left:0,top:0,bottom:0,right:0},$Me={bottom:30,top:15,right:15,left:15},Tg="esri-ui",gc={ui:Tg,corner:`${Tg}-corner`,innerContainer:`${Tg}-inner-container`,manualContainer:`${Tg}-manual-container`,cornerContainer:`${Tg}-corner-container`,topLeft:`${Tg}-top-left`,topRight:`${Tg}-top-right`,bottomLeft:`${Tg}-bottom-left`,bottomRight:`${Tg}-bottom-right`};function _st(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function eN(t){return t===0?"0":`${t}px`}function dH(t){const e=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(e===null||e===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function pH(t,{top:e,bottom:i,left:r,right:s}){t.style.top=e,t.style.bottom=i,t.style.left=r,t.style.right=s}let Kf=class extends ws.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._removeWidgetHandleKey=Symbol("componentOnRemoveSymbol"),this._locale=Xc(),this.view=null,this._applyViewPadding=()=>{const i=this.container;i&&pH(i,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const i=this._innerContainer;i&&pH(i,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([H(()=>[this.view?.padding,this.container],this._applyViewPadding,Nt),H(()=>this.padding,this._applyUIPadding,Nt),H(()=>[this.container,this._locale],([e,i])=>{e&&e.setAttribute("lang",i)},Nt),nTe(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentMap.clear()}set container(e){const i=this._get("container");e!==i&&(e&&(e.classList.add(gc.ui),gst(e),this._attachContainers(e)),i&&(i.classList.remove(gc.ui),pH(i,{top:"",bottom:"",left:"",right:""}),i.textContent=""),this._set("container",e))}get height(){const e=this.view?.height??0;if(e===0)return e;const i=this._getViewPadding(),{top:r,bottom:s}=i;return Math.max(e-r-s,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...$Me,...e}}get width(){const e=this.view?.width??0;if(e===0)return e;const i=this._getViewPadding(),{left:r,right:s}=i;return Math.max(e-r-s,0)}add(e,i){let r,s,n;if(Array.isArray(e))return void e.forEach(a=>this.add(a,i));const o=dH(e);o&&({index:r,position:i,component:e,key:s}=o),i&&typeof i=="object"&&({index:r,key:s,position:i,internal:n}=i),!e||i&&!this._isValidPosition(i)||this._add(e,i,r,s,n)}remove(e,i){if(!e)return;if(Array.isArray(e))return e.map(s=>this.remove(s,i));const r=this._find(e);if(r){if(this._componentMap.has(r)&&this._componentMap.get(r)?.key!==i)return;const s=this._components.indexOf(r);return r.node.parentNode?.removeChild(r.node),this._componentMap.delete(r),r.widget?.removeHandlesReference(this._removeWidgetHandleKey),this._components.splice(s,1)[0]}}empty(e,i={removeInternal:!1}){if(Array.isArray(e)){for(const n of e)this.empty(n,i);return}const r=this._positionNameToContainerLookup[e??"manual"],s=Array.prototype.slice.call(r.children).map(n=>this._findByNode(n)).filter(n=>n==null?!1:!(this._componentMap.get(n)?.internal??!1)||i.removeInternal);for(const n of s)this.remove(n)}move(e,i){if(Array.isArray(e)&&e.forEach(o=>this.move(o,i)),!e)return;let r;const s=dH(e)||dH(i);if(s&&(r=s.index,i=s.position,e=s.component||e),i&&!this._isValidPosition(i))return;const n=this.remove(e);n&&this.add(n,{position:i,index:r})}find(e){if(!e)return null;const i=this._findById(e);return i&&(i.widget||i.node)}getComponents(e,i={includeInternal:!1}){return e?Array.isArray(e)?e.flatMap(r=>this._getComponentsAtPosition(r,i)):this._getComponentsAtPosition(e,i):this._components.filter(r=>i.includeInternal||!this._componentMap.get(r)?.internal).map(({widget:r,node:s})=>r??s)}getPosition(e){for(const i in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[i].contains(e))return i;return null}_add(e,i,r,s,n){e instanceof OR||(e=new OR({node:e}));const{widget:o}=e;o!=null&&o instanceof ue&&o.addHandles($i(()=>{queueMicrotask(()=>this.remove(e))}),this._removeWidgetHandleKey),this._place({component:e,position:i,index:r}),this._components.push(e),this._componentMap.set(e,{key:s,internal:n})}_find(e){return e?e instanceof OR?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.view?.padding??vst}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(gc.innerContainer,gc.cornerContainer);const i=document.createElement("div");i.classList.add(gc.innerContainer,gc.manualContainer);const r=document.createElement("div");r.classList.add(gc.topLeft,gc.corner),e.appendChild(r);const s=document.createElement("div");s.classList.add(gc.topRight,gc.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(gc.bottomLeft,gc.corner),e.appendChild(n);const o=document.createElement("div");o.classList.add(gc.bottomRight,gc.corner),e.appendChild(o),this._innerContainer=e,this._manualContainer=i;const a=H7e();this._cornerNameToContainerLookup={"top-left":r,"top-right":s,"bottom-left":n,"bottom-right":o,"top-leading":a?s:r,"top-trailing":a?r:s,"bottom-leading":a?o:n,"bottom-trailing":a?n:o},this._positionNameToContainerLookup={manual:i,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const i=e.position??"manual",{component:r,index:s}=e,n=this._positionNameToContainerLookup[i],o=s!=null&&s>-1;if(_st(r.widget)&&r.widget.startup(),!o)return void n.appendChild(r.node);const a=Array.from(n.children);if(s===0){const{firstChild:c}=n;return void(c?c.parentNode?.insertBefore(r.node,c):n.appendChild(r.node))}if(s>=a.length)return void n.appendChild(r.node);const l=a[s];l.parentNode?.insertBefore(r.node,l)}_toPixelPosition(e){return{top:eN(e.top),left:eN(e.left),right:eN(e.right),bottom:eN(e.bottom)}}_findByComponent(e){return this._components.find(i=>i===e)??null}_findById(e){return this._components.find(({id:i})=>i===e)??null}_findByNode(e){return this._components.find(({node:i})=>i===e)??null}_getComponentsAtPosition(e,i){const r=this._positionNameToContainerLookup[e];return Array.prototype.slice.call(r.children).map(s=>this._findByNode(s)).filter(of).filter(s=>i.includeInternal||!this._componentMap.get(s)?.internal).map(({widget:s,node:n})=>s??n)}};u([p()],Kf.prototype,"_locale",void 0),u([p()],Kf.prototype,"container",null),u([p()],Kf.prototype,"height",null),u([p({value:$Me})],Kf.prototype,"padding",null),u([Yt("padding")],Kf.prototype,"castPadding",null),u([p()],Kf.prototype,"view",void 0),u([p()],Kf.prototype,"width",null),Kf=u([A("esri.views.ui.UI")],Kf);const bst=Kf,wst="randomUUID"in crypto;function SD(){if(wst)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=i=>t[i].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}function LZt(){return`{${SD().toUpperCase()}}`}function xst(){return`{${SD()}}`}function Sst(t){const e=t.toUpperCase();return t[0]!=="{"?`{${e}}`:e}const Tst={handleInterceptedEvent:(t,e,i,r)=>(t.scheduleRender(),e.properties[`on${r.type}`].apply(e.properties.bind||i,[r]))},Est={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.charAt(0)==="-"?t.style.setProperty(e,i):t.style[e]=i}},Cst=t=>({...Est,...t}),$st=(t,e)=>{const i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i},Ast=(t,e)=>t.find(e),Whe=(t,e,i=!1)=>{let r=t;return e.forEach((s,n)=>{const o=r?.children?Ast(r.children,a=>a.domNode===s):void 0;i&&!o&&n!==e.length-1||(r=o)}),r},Mst=t=>{let e;const i={...Tst,...t},r=Cst(i),s=r.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],h=(f,m,y)=>{let v;r.eventHandlerInterceptor=(b,w,x,S)=>function(C){let T;s("domEvent",C);const M=$st(C.currentTarget,v.domNode),I=M.some(D=>customElements.get(D?.tagName?.toLowerCase()));if(C.eventPhase===Event.CAPTURING_PHASE||!I)M.reverse(),T=Whe(v.getLastRender(),M);else{const D=C.composedPath(),F=D.slice(D.indexOf(C.currentTarget),D.indexOf(v.domNode)).reverse();T=Whe(v.getLastRender(),F,!0)}let P;return T&&(P=i.handleInterceptedEvent(e,T,this,C)),s("domEventProcessed",C),P},i.postProcessProjectionOptions?.(r);const _=y();v=f(m,_,r),r.eventHandlerInterceptor=void 0,l.push(v),c.push(y),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(v,_)};let d=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let f=0;f<l.length;f++){const m=c[f]();s("rendered",void 0);try{l[f].update(m)}catch(y){console.error(y)}s("patched",void 0)}s("renderDone",void 0),o=!0}};return i.modifyDoRenderImplementation&&(d=i.modifyDoRenderImplementation(d,l,c)),e={renderNow:d,scheduleRender:()=>{n||a||(n=requestAnimationFrame(d))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(f,m)=>{h(j_.append,f,m)},insertBefore:(f,m)=>{h(j_.insertBefore,f,m)},merge:(f,m)=>{h(j_.merge,f,m)},replace:(f,m)=>{h(j_.replace,f,m)},detach:f=>{for(let m=0;m<c.length;m++)if(c[m]===f)return c.splice(m,1),l.splice(m,1)[0];throw new Error("renderFunction was not found")}},e};class WP{constructor(){this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}}const Ost=(t,e)=>{let i=t;for(;i;){if(i===e)return!0;if(!i.parentNode)return!1;i.parentNode instanceof ShadowRoot?i=i.parentNode.host:i=i.parentNode}return!1},Ist=(t,e,i)=>{const r=Rst(e).subscribe;return r(s=>{s.some(o=>Ost(t,o.target))&&i()})},fH={},Rst=t=>{const e=t.join(","),i=fH[e];if(i!==void 0)return i;const r=new Set,s=new MutationObserver(o=>r.forEach(a=>a(o)));globalThis.document&&s.observe(document.documentElement,{attributes:!0,attributeFilter:t,subtree:!0});const n={subscribe:o=>(r.add(o),()=>{r.delete(o),r.size===0&&(s.disconnect(),fH[e]=void 0)})};return fH[e]=n,n},Pst=(t,e)=>{let i=t;for(;i;){const r=i.closest?.(e);if(r)return r;const s=i.getRootNode?.();if(s===globalThis.document)return null;i=s.host}return null},Dst=(t,e,i)=>Pst(t,`[${e}]`)?.getAttribute(e)??i,cn=(t,e,...i)=>{try{return t?.call(e,...i)}catch(r){console.error(r,t)}},fY=async(t,e,...i)=>{try{return await t?.call(e,...i)}catch(r){console.error(r,t)}},Lst="ar,bg,bs,ca,cs,da,de,el,en,es,et,fi,fr,he,hr,hu,id,it,ja,ko,lt,lv,nl,nb,no,pl,pt-BR,pt-PT,ro,ru,sk,sl,sr,sv,th,tr,uk,vi,zh-CN,zh-HK,zh-TW".split(","),Nst=new Set(Lst),wU="en",Fst={pt:"pt-PT",nb:"no",nn:"no",zh:"zh-CN"},kst=async(t,e,i="")=>{const r=`${e}/${i}`,s=`${r}${t}.json`;return mH[s]??(mH[s]=AMe(t,r)),await mH[s]},mH={},AMe=async(t,e)=>{const i=`${e}${t}.json`;try{const r=await fetch(i);if(r.ok)return await r.json()}catch(r){return console.error(r),{}}return t===wU?{}:await AMe(wU,e)},MMe=t=>{const e=Dst(t,"lang",globalThis.navigator?.language||wU);return{lang:e,t9nLocale:OMe(e)}},OMe=t=>{const[e,i]=t.split("-"),r=e.toLowerCase();let s=r;return i&&(s=`${r}-${i.toUpperCase()}`),s=Fst[s]??s,Nst.has(s)?s:i?OMe(r):wU},zst=(t,e,i,r)=>{let s;const n=()=>Ust(t,e(),r).then(o=>{(s?.lang!==o.lang||s.t9nLocale!==o.t9nLocale||s.t9nStrings!==o.t9nStrings)&&i(o),s=o}).catch(console.error);return queueMicrotask(n),Ist(t,["lang"],n)},Ust=async(t,e,i=t.localName.split("-").slice(1).join("-"))=>{const{lang:r,t9nLocale:s}=MMe(t),n=`${e}/${i}/t9n`,a=i===null?{}:await kst(s,n,"messages.");return{lang:r,t9nLocale:s,t9nStrings:a}},Bst=t=>t.replace(Vst,(e,i)=>`${i===0?"":"-"}${e.toLowerCase()}`),Vst=/[A-Z]+(?![a-z])|[A-Z]/gu,jst=(t,e)=>{const i=e/Gst;let r=0;const s=setInterval(()=>{r+=i,r>=e&&(clearInterval(s),t())},i);return s},Gst=4,Wie=Symbol.for("controller"),Hst=t=>typeof t=="object"&&t!==null&&(Wie in t||"hostConnected"in t||"hostDisconnected"in t||"hostUpdate"in t||"hostUpdated"in t),qst=t=>typeof t?.then=="function";let tI;const N2=t=>{tI!==t&&(tI=t,queueMicrotask(()=>tI===t?tI=void 0:0))},fj=t=>tI;let p1=[];const IMe=t=>{if(t===void 0){p1=[];return}const e=p1.indexOf(t);p1=e===-1?[...p1,t]:p1.slice(0,e+1),queueMicrotask(()=>p1=[])},RMe=()=>p1;let F2;const Wst=t=>{F2!==t&&(F2=t,queueMicrotask(()=>F2===t?F2=void 0:0))},Zst=()=>{const t=F2;return F2=void 0,t},Yst=async(t,e)=>{const i=Zie(t);if(i===void 0)return t;if(await i.ready,typeof e=="function"){const r=i.watchExports(s=>e(s,r))}return i.exports},Jst=async t=>{const e=Zie(t);return await e.ready,e},Zie=t=>{const i=fj().manager.X(t);if(i!==void 0)return i;if(Hst(t))return t;const r=Zst();if(r!==void 0)return r};let mY=!1;const Xst=t=>{mY=!0;try{return t()}finally{mY=!1}},Kst=(t,e,i)=>{const r=Object.keys(t),s=r.length;k2===void 0&&queueMicrotask(Yie),k2??=new Map;let n=k2.get(t);return n===void 0&&(n={callbacks:[],keyCount:s},k2.set(t,n)),n.keyCount!==s&&(n.callbacks.forEach(o=>o(r)),n.callbacks=[],n.keyCount=s),n.callbacks.push(o=>{const a=c=>cn(e,null,c),l=o[s];l===void 0?a(void 0):t[l]===i?a(l):a(void 0)}),i};let k2;const Yie=()=>{k2?.forEach(({callbacks:t},e)=>{const i=Object.keys(e);t.forEach(r=>r(i))}),k2=void 0},Qst=(t,e,i)=>{const r=t.manager;return r.V!==Ze&&r.V!==i&&r.S(void 0,void 0),r.T.length===0&&queueMicrotask(()=>r.S(void 0,void 0)),r.V=i,r.T.push((s,n)=>cn(e,void 0,i===n?s:void 0)),i},PMe=(t=[fj(),...RMe()],e,i)=>{const r=Array.isArray(t)?t:[t];let s=r.length+1;const n=o=>{s-=1,o!==void 0&&(s=Math.min(s,0)),s===0&&e(o)};r.forEach(o=>Kst(o,a=>n(a===void 0?void 0:{key:a,host:o,isReactive:!1}),i));for(const o of r)if("manager"in o&&o.manager.component===o){Qst(o,a=>n(a===void 0?void 0:{key:a,host:o,isReactive:!0}),i);break}return i},ent=(t="",e={},i=fj())=>{const r={emit:s=>{t===""&&Yie();const n=new CustomEvent(t,{detail:s,cancelable:!0,bubbles:!0,composed:!0,...e});return i.el.dispatchEvent(n),n}};return t===""&&PMe(void 0,s=>t=s.key,r),r},Ut=ent.bind(null,"");var DMe;DMe=Wie;class Jie{constructor(e){this.#e=[],this.#t=[],this.#i=[],this.#r=[],this.#s=[],this.#l=[],this.#c=[],this.#d=[],this.#u=[],this.#h=!1,this.P=new WP,this.connectedCalled=!1,this.loadedCalled=!1,this[DMe]=!0,this.#a=[];const i=this,r=e??fj();i.#n=r,i.ready=i.P.promise,i.#o=Yhe(i),i.component=r,i.#n.addController(i),i.#n.manager===void 0||(IMe(i),queueMicrotask(()=>i.catchUpLifecycle()))}#e;#t;#i;#r;#s;#l;#c;#d;#u;#h;#n;catchUpLifecycle(){const{manager:e}=this.#n;e.connectedCalled&&!this.connectedCalled&&this.triggerConnected(),e.#h&&this.triggerLoad().then(()=>e.loadedCalled&&this.triggerLoaded()).catch(console.error)}#o;get exports(){return this.#o}set exports(e){const i=this.#o;i!==e&&(this.#o=e,this.#a.forEach(cn),this.connectedCalled&&this.O!==!1&&this.#n.requestUpdate(this.O,i)),this.P.resolve(e)}setProvisionalExports(e,i=!0){this.#o=i?Yhe(e):e,this.#a.forEach(cn)}#a;watchExports(e){const i=()=>e(this.#o);return this.#a.push(i),()=>void this.#a.splice(this.#a.indexOf(i),1)}get use(){return N2(this.#n),Yst}get useRef(){return N2(this.#n),Jst}get useRefSync(){return N2(this.#n),Zie}controllerRemoved(){this.#n.el.isConnected&&this.triggerDisconnected(),this.triggerDestroy()}onConnected(e){this.#e.push(e)}onDisconnected(e){this.#t.push(e)}onLoad(e){this.#i.push(e)}onLoaded(e){this.#r.push(e)}onUpdate(e){this.#s.push(e)}onUpdated(e){this.#l.push(e)}onDestroy(e){this.#c.push(e)}onLifecycle(e){this.#d.push(e),this.connectedCalled&&this.#n.el.isConnected&&this.#p(e)}triggerConnected(){const e=this;e.hostConnected&&cn(e.hostConnected,e),e.#e.forEach(cn),e.triggerLifecycle(),e.connectedCalled=!0}triggerDisconnected(){const e=this;e.hostDisconnected&&cn(e.hostDisconnected,e),e.#t.forEach(cn),e.#u.forEach(cn),e.#u=[]}async triggerLoad(){if(this.#h)return;this.#h=!0;const e=this;e.hostLoad&&await fY(e.hostLoad,e),this.#i.length>0&&await Promise.allSettled(this.#i.map(fY)),this.P.resolve(this.#o)}triggerLoaded(){this.loadedCalled||(this.hostLoaded&&cn(this.hostLoaded,this),this.#r.forEach(cn),this.loadedCalled=!0)}triggerUpdate(e){this.hostUpdate&&cn(this.hostUpdate,this,e),this.#s.forEach(Zhe,e)}triggerUpdated(e){this.hostUpdated&&cn(this.hostUpdated,this,e),this.#l.forEach(Zhe,e)}triggerDestroy(){this.hostDestroy&&cn(this.hostDestroy,this),this.#c.forEach(cn)}triggerLifecycle(){this.hostLifecycle&&this.#p(()=>this.hostLifecycle()),this.#d.forEach(this.#p,this)}#p(e){N2(this.#n);const i=cn(e);(Array.isArray(i)?i:[i]).forEach(s=>{typeof s=="function"?this.#u.push(s):typeof s=="object"&&typeof s.remove=="function"&&this.#u.push(s.remove)})}}function Zhe(t){cn(t,void 0,this)}const tnt=Jie,Yhe=t=>{if(typeof t!="object"&&typeof t!="function"||t===null)return t;const e={get(r,s,n){if(!((s==="exports"||s==="_exports")&&s in r&&r[s]===i)&&(s in r||s in Promise.prototype||typeof s=="symbol"))return typeof r=="function"?r[s]:Reflect.get(r,s,n)}},i=new Proxy(t,e);return i},int=1,rnt=2,snt=4,nnt=8,ont=16,ant=32,lnt=64,LMe=t=>{let e=t;for(;e=e.parentNode??e.host;)if(e?.constructor?.lumina){const i=e;return i.manager?.loadedCalled||(i.J??i._offspring).push(t),(i.I??i._postLoad).promise}return!1},Jhe={};function NMe(){}const w4=Object.defineProperty,cnt=globalThis.HTMLElement??NMe;class NZt extends cnt{constructor(){super(),this.#t={},this.#i=[],this.I=new WP,this.H=new WP,this.J=[];const e=this,i=e.constructor;e._offspring=e.J,e._postLoad=e.I,i.C?.forEach(r=>{Object.hasOwn(e,r)&&(e.#t[r]=e[r],delete e[r])}),i.A?e.#r({a:i.A}):i.B.then(async r=>{await i.K.p,e.#r(await(r.default?.then(s=>typeof s=="function"?{a:s}:s)??r))}).catch(r=>{e.H.reject(r),setTimeout(()=>{throw r})})}static{this.lumina=!0}static F(){for(const e of this.C??[])w4(this.prototype,e,{configurable:!0,enumerable:!0,get(){return this.#t[e]},set(i){this.#t[e]=i}});for(const e of this.E??[])w4(this.prototype,e,{async value(...i){return this.#e||await this.H.promise,await this.#e[e](...i)},configurable:!0});for(const e of this.D??[])w4(this.prototype,e,{value(...i){return this.#e[e](...i)},configurable:!0})}#e;#t;#i;get manager(){return this.#e?.manager}attributeChangedCallback(e,i,r){this.#e?.attributeChangedCallback(e,i,r),this.#e||this.#i.push(e)}connectedCallback(){this.#e?this.#e.connectedCallback?.():queueMicrotask(()=>this.G=LMe(this))}disconnectedCallback(){this.#e?.disconnectedCallback?.()}async componentOnReady(){return await this.H.promise,this}#r(e){const i=this.constructor,r=i.L,s=this.#t,n=Object.values(e).find(d=>d.L===r),o=`${r}--lazy`;let a=n;for(;a&&!Object.hasOwn(a,"lumina");)a=Object.getPrototypeOf(a);hnt(a),!i.A&&(i.A=n,customElements.define(o,n)),n.N=this;const c=document.createElement(o);n.N=void 0,this.#e=c,this.#t=c,this.#i.forEach(d=>c.attributeChangedCallback(d,null,this.getAttribute(d))),Object.entries(s).forEach(unt,c);const h=this.isConnected;(h||this.G)&&(c.connectedCallback?.(),h||c.disconnectedCallback())}addController(){}requestUpdate(){this.#e?.requestUpdate()}}function unt([t,e]){this[t]=e}const hnt=t=>{const e=t.prototype,i=Element.prototype;Object.hasOwn(e,"isConnected")||(e.setAttribute=function(s,n){i.setAttribute.call(this.el,s,n)},e.removeAttribute=function(s){i.removeAttribute.call(this.el,s)},w4(e,"isConnected",{get(){return Reflect.get(i,"isConnected",this.el)}}))};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Oy={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4},TD=t=>(...e)=>({_$litDirective$:t,values:e});let ED=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,i,r){this._$Ct=e,this._$AM=i,this._$Ci=r}_$AS(e,i){return this.update(e,i)}update(e,i){return this.render(...i)}};/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const dnt=TD(class extends ED{constructor(t){if(super(t),t.type!==Oy.ATTRIBUTE||t.name!=="class"||t.strings?.length>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(t){return" "+Object.keys(t).filter(e=>t[e]).join(" ")+" "}update(t,[e]){if(this.st===void 0){this.st=new Set,t.strings!==void 0&&(this.nt=new Set(t.strings.join(" ").split(/\s/).filter(r=>r!=="")));for(const r in e)e[r]&&!this.nt?.has(r)&&this.st.add(r);return this.render(e)}const i=t.element.classList;for(const r of this.st)r in e||(i.remove(r),this.st.delete(r));for(const r in e){const s=!!e[r];s===this.st.has(r)||this.nt?.has(r)||(s?(i.add(r),this.st.add(r)):(i.remove(r),this.st.delete(r)))}return pd}});/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const FMe="important",pnt=" !"+FMe,fnt=TD(class extends ED{constructor(t){if(super(t),t.type!==Oy.ATTRIBUTE||t.name!=="style"||t.strings?.length>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(t){return Object.keys(t).reduce((e,i)=>{const r=t[i];return r==null?e:e+`${i=i.includes("-")?i:i.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${r};`},"")}update(t,[e]){const{style:i}=t.element;if(this.ft===void 0)return this.ft=new Set(Object.keys(e)),this.render(e);for(const r of this.ft)e[r]==null&&(this.ft.delete(r),r.includes("-")?i.removeProperty(r):i[r]=null);for(const r in e){const s=e[r];if(s!=null){this.ft.add(r);const n=typeof s=="string"&&s.endsWith(pnt);r.includes("-")||n?i.setProperty(r,n?s.slice(0,-11):s,n?FMe:""):i[r]=s}}return pd}});/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{I:mnt}=aBe,kMe=t=>t.strings===void 0,Xhe=()=>document.createComment(""),kZt=(t,e,i)=>{const r=t._$AA.parentNode,s=e===void 0?t._$AB:e._$AA;if(i===void 0){const n=r.insertBefore(Xhe(),s),o=r.insertBefore(Xhe(),s);i=new mnt(n,o,t,t.options)}else{const n=i._$AB.nextSibling,o=i._$AM,a=o!==t;if(a){let l;i._$AQ?.(t),i._$AM=t,i._$AP!==void 0&&(l=t._$AU)!==o._$AU&&i._$AP(l)}if(n!==s||a){let l=i._$AA;for(;l!==n;){const c=l.nextSibling;r.insertBefore(l,s),l=c}}}return i},zZt=(t,e,i=t)=>(t._$AI(e,i),t),gnt={},zMe=(t,e=gnt)=>t._$AH=e,UZt=t=>t._$AH,BZt=t=>{t._$AP?.(!1,!0);let e=t._$AA;const i=t._$AB.nextSibling;for(;e!==i;){const r=e.nextSibling;e.remove(),e=r}};/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Khe=TD(class extends ED{constructor(t){if(super(t),t.type!==Oy.PROPERTY&&t.type!==Oy.ATTRIBUTE&&t.type!==Oy.BOOLEAN_ATTRIBUTE)throw Error("The `live` directive is not allowed on child or event bindings");if(!kMe(t))throw Error("`live` bindings can only contain a single expression")}render(t){return t}update(t,[e]){if(e===pd||e===Ze)return e;const i=t.element,r=t.name;if(t.type===Oy.PROPERTY){if(e===i[r])return pd}else if(t.type===Oy.BOOLEAN_ATTRIBUTE){if(!!e===i.hasAttribute(r))return pd}else if(t.type===Oy.ATTRIBUTE&&i.getAttribute(r)===e+"")return pd;return zMe(t),e}});class ynt extends tnt{constructor(e){super(e),this.destroyed=!1,this.R=!1,this.V=Ze,this.T=[],this.#i=new WeakMap,this.#t=e,this.exports=void 0,this.hasDestroy=gY in e&&typeof e.destroy=="function",Xp.prototype.addController.call(e,{hostConnected:()=>{if(this.destroyed){const i=e.el.localName;throw e.el.remove(),new Error(`The ${i} component has already been destroyed. It cannot be used again. If you meant to disconnect and reconnect a component without automatic destroy, set the ${gY} prop.`)}this.#e!==void 0&&clearTimeout(this.#e),Yie();for(const i of e.M)"triggerConnected"in i?i.triggerConnected():cn(i.hostConnected,i)},hostDisconnected:()=>{for(const i of e.M)"triggerDisconnected"in i?i.triggerDisconnected():cn(i.hostDisconnected,i);this.hasDestroy&&!this.destroyed&&this.U()},hostUpdate:()=>{for(const i of e.M)"triggerUpdate"in i?i.triggerUpdate(this.Q):cn(i.hostUpdate,i,this.Q)},hostUpdated:()=>{for(const i of e.M)"triggerUpdated"in i?i.triggerUpdated(this.Q):cn(i.hostUpdated,i,this.Q);this.Q=void 0}}),queueMicrotask(()=>this.R=!0),N2(e)}#e;#t;async destroy(){if(!this.destroyed){this.#t.el.isConnected&&(this.hasDestroy=!1,this.#t.el.remove()),this.#e=void 0,this.destroyed=!0;for(const e of this.#t.M)"triggerDestroy"in e?e.triggerDestroy():cn(e.hostDestroy,e);this.#t.M.splice(0)}}U(){if(this.#e!==void 0&&clearTimeout(this.#e),!this.#t.el.isConnected&&!this.#t.autoDestroyDisabled){const e=()=>void this.#t.destroy();this.#e=jst(e,vnt)}}S(e,i){const r=this.T;this.V=Ze,this.T=[],r.forEach(s=>s(e,i))}#i;W(e,i){(typeof i=="object"&&i!==null||typeof i=="function")&&this.#i.set(i,e)}X(e){if(typeof e=="object"&&e!==null||typeof e=="function")return this.#i.get(e)}}let vnt=1e3;const gY="autoDestroyDisabled";class Vn extends Xp{constructor(){super(),this.M=[],this.manager=new ynt(this);const e=this,i=e.constructor,r=i.N,s=i.K.o,n=Vn.prototype.shouldUpdate;e.#r=r?.H??new WP,e.I=r?.I??new WP,e.J=r?.J??[],e._offspring=e.J,e._postLoad=e.I,e.el=r??e,e.#i=e.enableUpdating,e.enableUpdating=NMe,e.shouldUpdate!==n&&(e.#t=e.shouldUpdate,e.shouldUpdate=n),s&&(e.#e=new Map,i.elementProperties.forEach((o,a)=>e.#e.set(a,s())))}static finalizeStyles(e){const i=super.finalizeStyles(e),r=this.shadowRootOptions===Jhe;return this.K?.commonStyles===void 0||r?i:[this.K.commonStyles,...i]}static createProperty(e,i){const r=typeof i=="number"?i:Array.isArray(i)?i[0]:0,s=Array.isArray(i)?i[1]:void 0,n=s?.hasChanged??oV,o={attribute:r&int&&typeof e=="string"?Bst(e):!1,reflect:!!(r&rnt),type:r&snt?Boolean:r&nnt?Number:void 0,state:!!(r&ont),readOnly:!!(r&ant),noAccessor:!!(r&lnt),c:!1,...s,hasChanged(a,l){const c=n(a,l);return o.c=c,c}};super.createProperty(e,o)}static getPropertyDescriptor(e,i,r){const s=this.K,n=super.getPropertyDescriptor(e,i,r);return r.d=n,{...n,get(){return s.t?.(this.#e.get(e)),n.get?.call(this)},set(o){const a=this.manager;if(r.readOnly&&!mY&&(a.R||a.connectedCalled))throw Error(`Cannot assign to read-only property "${e}" of ${this.el.localName}. Trying to assign "${o}"`);n.set.call(this,o??void 0),r.c&&this.#e?.get(e)?.notify(),a.T.length>0&&a?.S(e,o)}}}static{this.lumina=!0}#e;#t;#i;#r;#s;connectedCallback(){if(this.el.hasAttribute("defer-hydration"))return;const e=this.constructor.K.c?.(()=>this.requestUpdate());this.#s=e;const i=!this.manager.connectedCalled;super.connectedCallback(),i?queueMicrotask(()=>this.#c().catch(r=>{this.#r.reject(r),setTimeout(()=>{throw r})})):e&&this.requestUpdate()}#l(e){try{this.#s.clear(),this.constructor.K.r(this.#s,()=>super.update(e))}catch(i){throw this.#s.clear(),i}}disconnectedCallback(){super.disconnectedCallback(),this.#s?.destroy(),this.#s=void 0}createRenderRoot(){const e=this.el.shadowRoot,i=this.constructor,r=i.shadowRootOptions,n=e??(r===Jhe?this.el:this.el.attachShadow(r));if(e)return Xp.prototype.createRenderRoot.call(this),e;if(this.isConnected){const o=n.getRootNode();o.adoptedStyleSheets=[...o.adoptedStyleSheets,...i.elementStyles.map(a=>"styleSheet"in a?a.styleSheet:a)]}return n}async#c(){const e=this.el.G??LMe(this.el);e&&await e;const i=[];for(const s of this.M)"triggerLoad"in s?i.push(s.triggerLoad()):i.push(fY(s.hostLoad,s));await Promise.all(i),await this.load?.(),this.manager.hasDestroy&&this.manager.onUpdate(s=>s.has(gY)&&this.manager.U()),this.#i(!0),this.performUpdate(),this.I.resolve(),await Promise.resolve();const r=this.J.filter(s=>!s.manager?.loadedCalled);r.length&&await Promise.allSettled(r.map(async s=>await s.componentOnReady())),this.J.length=0,this.el.setAttribute(this.constructor.K.hydratedAttribute,"");for(const s of this.M)"triggerLoaded"in s?s.triggerLoaded():cn(s.hostLoaded,s);this.loaded?.(),this.#r.resolve()}shouldUpdate(e){return this.manager.Q=e,this.#t?.(e)??!0}update(e){this.#s?this.#l(e):super.update(e)}listen(e,i,r){const s=i?.bind(this)??i;this.manager.onLifecycle(()=>(this.el.addEventListener(e,s,r),()=>this.el.removeEventListener(e,s,r)))}listenOn(e,i,r,s){const n=r?.bind(this)??r;this.manager.onLifecycle(()=>(e.addEventListener(i,n,s),()=>e.removeEventListener(i,n,s)))}async componentOnReady(){return await this.#r.promise,this}addController(e){this.M.push(e),!(Wie in e)&&this.renderRoot&&this.el.isConnected&&e.hostConnected?.()}removeController(e){this.M.splice(this.M.indexOf(e),1),e.controllerRemoved?.()}}const _nt=t=>{let e;const i=s=>{e=new URL(s,globalThis.location?.href||void 0).href},r={...t,getAssetPath(s){const n=new URL(s,e);return n.origin!==globalThis.location?.origin?n.href:n.pathname},setAssetPath:i,customElement(s,n){n.K=r,n.L=s,customElements.get(s)||customElements.define(s,n)}};return i(t.defaultAssetPath),r},fe=t=>typeof t=="object"&&t!=null?dnt(t):t,UMe=t=>typeof t=="object"&&t!=null?fnt(t):t,Ap=Ze;function mj(t,e,i){i==null?t.removeAttribute(e):t.setAttribute(e,i)}const ZP={toAttribute:t=>t===!0?"":t===!1?null:t};/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const BMe="calcite-mode-auto",VMe="calcite-mode-dark",bnt="calcite-mode-light",IR={autoMode:BMe,darkMode:VMe,lightMode:bnt,rtl:"calcite--rtl"},xU={filter:250,nextTick:0,resize:150,reposition:100},VZt=10,jZt=25;function Qhe(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,i=()=>t.contains(VMe)||t.contains(BMe)&&e?"dark":"light",r=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),s=o=>{n!==o&&r(o),n=o};let n=i();r(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>s(o.matches?"dark":"light")),new MutationObserver(()=>s(i())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}const RR=globalThis.calciteConfig,wnt=RR?.focusTrapStack||[],xnt=RR?.logLevel||"info",ede="3.2.1",Snt="2025-05-29",Tnt="618973fec";function Ent(){if(RR&&RR.version)return;console.info(`Using Calcite Components ${ede} [Date: ${Snt}, Revision: ${Tnt}]`);const t=RR||globalThis.calciteConfig||{};Object.defineProperty(t,"version",{value:ede,writable:!1}),globalThis.calciteConfig=t}function Cnt(){document.readyState==="interactive"?Qhe():document.addEventListener("DOMContentLoaded",()=>Qhe(),{once:!0}),Ent()}Cnt();const $nt=_nt({defaultAssetPath:"https://js.arcgis.com/calcite-components/3.2.1/",hydratedAttribute:"calcite-hydrated"}),{customElement:Oo,getAssetPath:jMe,setAssetPath:Ant}=$nt;/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */let GMe=!1;const Mnt=t=>{GMe=!0,Ant(t)};let HMe;function Ont(){GMe||Mnt(Hc(gs(HMe)))}function CD(t){const e=[];for(const i of Object.keys(t))customElements.get(`calcite-${i}`)||e.push(t[i]?.());return e.length>0?Promise.all(e):null}HMe="components/assets";const qMe=Symbol("widget"),WMe=Symbol("widget-test-data"),Int=[],Rnt={},SU=new WeakMap;function ZMe(t,e){let i=e.children;if(i?.length)for(let s=0;s<i.length;++s)i[s]=ZMe(t,i[s]);else i=Int;const r=e.vnodeSelector;if(TU(r)){const s=e.properties||Rnt,n=s.key||r,o={key:n,afterCreate:Pnt,afterUpdate:Dnt,afterRemoved:YMe,parentWidget:t,widgetConstructor:r,widgetProperties:{...s,key:n,children:i}};return{vnodeSelector:r.vnodeSelector,properties:o,children:void 0,text:void 0,domNode:null}}return e}function Pnt(t,e,i,{parentWidget:r,widgetConstructor:s,widgetProperties:n}){const o=new s(n);o.container=t,SU.set(t,o),o.afterCreate?.(o,t),r.addHandles($i(()=>YMe(t))),queueMicrotask(()=>{o[WMe].projector.renderNow()})}function Dnt(t,e,i,{widgetProperties:r}){const s=SU.get(t);s&&(s.set(r),s.afterUpdate?.(s,t))}function YMe(t){const e=SU.get(t);e&&(e.afterRemoved?.(e,t),e.destroy(),SU.delete(t))}function TU(t){return typeof t=="function"&&t[qMe]}const tde=new Set;function Lnt(t){tde.add(t),t.finally(()=>tde.delete(t))}var JMe;const Nnt="esri.widgets.Widget";let Fnt=0;function XMe(t,e){const i=Object.prototype.hasOwnProperty;for(const r in e)i.call(e,r)&&i.call(t,r)&&(t[r]!=null&&e[r]!=null&&typeof t[r]=="object"&&typeof e[r]=="object"?XMe(t[r],e[r]):t[r]=e[r]);return t}const knt=Mst({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,i=/capture$/i;t.eventHandlerInterceptor=(r,s,n,o)=>{const a=e?.(r,s,n,o),l=i.test(r);if(!((r=r.replace(i,"")).toLowerCase()in n)||l){const c=r[2].toLowerCase()+r.slice(3),h=m=>a?.call(n,m);n.addEventListener(c,h,l);const d=()=>n.removeEventListener(c,h,l),f=o.afterRemoved;o.afterRemoved=m=>{f?.(m),d()}}return a}},handleInterceptedEvent(t,e,i,r){const{eventPhase:s,type:n}=r,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=e.properties;(l&&a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,l&&a in l))&&(r2e(),t.scheduleRender(),l[a].call(l.bind||i,r))}});let gH=!1,lo=class extends Ub.EsriPromiseMixin(ws.EventedAccessor){constructor(e,i){super(e,i),this._attached=!1,this._projector=knt,this._readyForTrueRender=!1,this.key=this,this.autoRenderingEnabled=!0,this._loadLocale=X3(async()=>{if(this._messageBundleProps?.length){const l=await Promise.allSettled(this._messageBundleProps.map(async({bundlePath:c,propertyName:h})=>{if(this.destroyed)return;let d=await dEe(c);this.uiStrings&&Object.keys(this.uiStrings)&&(d=XMe(q(d),this.uiStrings)),this[h]=d}));if(this.destroyed)return;for(const c of l)c.status==="rejected"&&J.getLogger(this).error("widget-intl:locale-error",this.declaredClass,c.reason)}await this.loadLocale()}),Ont();const r="esri-widget-uid-"+SD(),s=this.render.bind(this);this._trackingTarget=new vV(()=>{this.autoRenderingEnabled&&this.scheduleRender()});const n=()=>({vnodeSelector:"div",properties:{key:`${r}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}),o=()=>{if(!this._readyForTrueRender||this.destroyed)return null;const l=s()??n(),c=l.properties??={};if(c.key??=r,TU(l.vnodeSelector)){if(!this.visible)return n()}else this.visible?c.styles||(c.styles={}):(c.class="",c.styles={display:"none"}),c.styles.display??="";let h=0;return l.children?.forEach(d=>{TU(d.vnodeSelector)||(d.properties??={},d.properties.key??=`${this.id}--${h++}`)}),ZMe(this,l)};this.render=()=>{if(gH)return o();let l=j7e(this)??null;if(l)return l;this._trackingTarget.clear(),gH=!0;try{l=iv(this._trackingTarget,o)}catch(c){throw J.getLogger(this).error(c),c}finally{gH=!1}return l&&G7e(this,l),l};const a=this.beforeFirstRender();a?this._resourcesFetch=a.then(()=>{this._readyForTrueRender=!0,this._postInitialize()}):(this._resourcesFetch=Promise.resolve().then(()=>{this._postInitialize()}),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),Lnt(this._resourcesFetch)}normalizeCtorArgs(e,i){const r={...e};return i&&(r.container=i),r}postInitialize(){}beforeFirstRender(){const e=this.loadDependencies();return this._messageBundleProps?.length||e?Promise.all([e,this._loadLocale()]).then(()=>{}).catch(ple):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||(Ce(this._trackingTarget),Ce(this.viewModel),this._detach(this.container),this._set("container",null),this._emitter.clear(),this.render=()=>null,this._projector=null,O6(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return FV(e)}get domNode(){return this.container}set domNode(e){this.container=e}get icon(){return null}set icon(e){this._overrideIfSome("icon",e)}get id(){return this._get("id")||this.container?.id||Date.now().toString(16)+"-widget-"+Fnt++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(JMe=qMe,WMe)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(O6(this),this._projector.scheduleRender())}classes(...e){return s2e.apply(this,e)}renderNow(){O6(this),this._projector.renderNow()}_postInitialize(){if(this.destroyed)return;this.scheduleRender(),this._delegatedEventNames?.length&&this.addHandles(H(()=>this.viewModel,(i,r)=>{r&&this.removeHandles("delegated-events"),i&&gV(i)&&this.addHandles(this._delegatedEventNames.map(s=>fA(i,s,n=>{this.emit(s,n)})),"delegated-events")},St)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(ple),this.scheduleRender()};this.addHandles([nTe(e),H(()=>this.uiStrings,e),gn(()=>this.container,i=>{this.destroyed||this._attach(i)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){this._attached&&(this._projector.detach(this.render),this._attached=!1),e?.parentNode?.removeChild(e)}};lo[JMe]=!0,lo.vnodeSelector="div",u([p()],lo.prototype,"_readyForTrueRender",void 0),u([p({value:null})],lo.prototype,"container",null),u([Yt("container")],lo.prototype,"castContainer",null),u([p()],lo.prototype,"icon",null),u([p()],lo.prototype,"id",null),u([p()],lo.prototype,"label",null),u([p()],lo.prototype,"renderable",null),u([p()],lo.prototype,"uiStrings",void 0),u([p()],lo.prototype,"viewModel",void 0),u([p({value:!0})],lo.prototype,"visible",null),u([p()],lo.prototype,"key",void 0),u([p()],lo.prototype,"children",void 0),u([p()],lo.prototype,"afterCreate",void 0),u([p()],lo.prototype,"afterUpdate",void 0),u([p()],lo.prototype,"afterRemoved",void 0),lo=u([A(Nnt)],lo);const zS=lo;let x4,S4=null;const CC=new Map;async function HZt(t){S4==null&&(x4==null&&(x4=V(()=>import("./Lyr3DWasmPerSceneView-bcg-2vZo.js"),__vite__mapDeps([230,96,97]))),S4=await x4);const e=t.view;let i=CC.get(e);i||(i=new S4.default({view:e}),CC.set(e,i));const r=!!e._stage.renderView.renderingContext.capabilities.compressedTextureS3TC,s=!!e._stage.renderView.renderingContext.capabilities.compressedTextureETC;return await i.initializeWasm(r,s),i.add3DTilesLayerView(t)}function znt(t){return CC.get(t)}function qZt(t){const e=t.view,i=CC.get(e);i&&i.remove3DTilesLayerView(t)<1&&(CC.delete(e),CC.size===0&&(x4=null,S4=null))}function ide(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function Unt(t,e){return t.length!==e.length||t.some((i,r)=>i.text!==e[r].text)}function yM(t,e,i){!i||!e||t.find(r=>r.layerView===e&&r.text===i)||t.push({text:i,layerView:e})}function Bnt(t){return t.type==="bing-maps"}const Eg=[];let IE=class extends ue{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new Ee,this.view=null,this._allLayerViewsChange=i=>{this.removeHandles("suspension"),this.removeHandles("visible-geometry-changed");const r=this.view?.allLayerViews;r&&(this.addHandles(r.map(s=>H(()=>[s.suspended,s.layer?.attributionVisible],()=>this._updateAttributionItems())).toArray(),"suspension"),r.forEach(s=>{s.declaredClass==="esri.views.3d.layers.Tiles3DLayerView3D"&&this.addHandles(s.on("visible-geometry-changed",()=>this._updateAttributionItems()),"visible-geometry-changed")})),i?.removed&&i.removed.forEach(s=>{this._pendingAttributions.delete(s),this._fetchedAttributionData.delete(s)}),this._updateAttributionItems()},this.addHandles([io(()=>this.view?.allLayerViews,"change",i=>this._allLayerViewsChange(i),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),gn(()=>this.view?.stationary===!0,()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.view?.ready?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,i=e?.allLayerViews;if(Eg.length=0,!e||!i)return void this._clear();i.forEach(s=>{if(s.suspended||!s.layer?.attributionVisible)return;const n=s.layer;if(ide(n,"user"))return void yM(Eg,s,n.copyright);if(n.hasAttributionData){if(this._fetchedAttributionData.has(s)){const a=this._fetchedAttributionData.get(s);return void(a?yM(Eg,s,this._getDynamicAttribution(a,e,n)):ide(n)&&yM(Eg,s,n.copyright))}return void this._fetchAttributionData(s)}const o="portalItem"in n?n.portalItem?.accessInformation:void 0;yM(Eg,s,o||n.copyright)});const r=i.find(s=>s.layer?.type==="integrated-mesh-3dtiles");if(this.view&&r){const s=znt(this.view);if(s){const n=s.getAttributionText();for(let o=0;o<n.length;++o)yM(Eg,r,n[o])}}Unt(this.items,Eg)&&(this.items.removeAll(),this.items.addMany(Eg)),Eg.length=0,this.notifyChange("state")}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const i=await lf(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const r=i.ok?this._createContributionIndex(i.value,Bnt(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,r)}this._updateAttributionItems()}_createContributionIndex(e,i){const r=e.contributors,s={};if(!r)return s;for(let n=0;n<r.length;n++){const o=r[n],a=o.coverageAreas;if(!a)return;for(const l of a){const c=l.bbox,h=l.zoomMin-(i&&l.zoomMin?1:0),d=l.zoomMax-(i&&l.zoomMax?1:0),f=new gi({xmin:c[1],ymin:c[0],xmax:c[3],ymax:c[2],spatialReference:Ae.WGS84}),m={extent:Gy(f),attribution:o.attribution||"",score:l.score!=null?l.score:100,id:n};for(let y=h;y<=d;y++)s[y]??=[],s[y].push(m)}}return s.maxKey=Math.max.apply(null,Object.keys(s)),s}_getDynamicAttribution(e,i,r){const{extent:s,scale:n}=i;let o=r.tileInfo?.scaleToZoom(n)??0;if(o=Math.min(e.maxKey??0,Math.round(o)),!s||o==null||o<=-1)return"";const a=e[o],l=Q3(s.center.clone().normalize(),Ae.WebMercator),c=new Set;return a?a.filter(h=>{const d=h.id,f=!c.has(d)&&l&&h.extent&&eD(h.extent,l);return f&&c.add(d),f}).sort((h,d)=>d.score-h.score||h.objectId-d.objectId).map(h=>h.attribution).join(", "):""}};u([p({readOnly:!0,type:Ee})],IE.prototype,"items",void 0),u([p({readOnly:!0})],IE.prototype,"state",null),u([p()],IE.prototype,"view",void 0),IE=u([A("esri.widgets.Attribution.AttributionViewModel")],IE);const KMe=IE,Wo={button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",empty:"esri-widget__content--empty",heading:"esri-widget__heading",interactive:"esri-interactive",loaderAnimation:"esri-widget__loader-animation",panel:"esri-widget--panel",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button"};function QMe(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${String(e)}'`);return{value:jnt(t[e])}}}function Vnt(t){const e=t?.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function jnt(t){return function(e,...i){Vnt(e)?Y7e(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...i)}}function dv(t){return(e,i)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:i})}}var Gnt=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},eOe=function(t,e){for(var i=0,r=t.length;i<r;i++){var s=t[i];Array.isArray(s)?eOe(s,e):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=Gnt(s)),e.push(s))}},Hnt=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(i.length===1&&typeof i[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:i[0],domNode:null};var s=[];return eOe(i,s),{vnodeSelector:t,properties:e||void 0,children:s,text:void 0,domNode:null}};function Zt(t,e,...i){return typeof t!="function"||TU(t)?Hnt(t,e??null,...i):t(e,...i)}function ZZt(...t){return t}const fT="esri-attribution",mT={base:fT,poweredBy:`${fT}__powered-by`,sources:`${fT}__sources`,open:`${fT}--open`,sourcesOpen:`${fT}__sources--open`,link:`${fT}__link`};let Ul=class extends zS{constructor(e,i){super(e,i),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(r=>r.forEach(({target:s})=>this._checkSourceTextOverflow(s))),this.itemDelimiter=" | ",this.messages=null,this.viewModel=new KMe}initialize(){this.addHandles(io(()=>this.viewModel?.items,"change",()=>this.scheduleRender()))}destroy(){this._resizeObserver?.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,i)=>(e.includes(i.text)||e.push(i.text),e),[]).join(this.itemDelimiter)}get icon(){return"description"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[mT.open]:this._isOpen};return Zt("div",{bind:this,class:this.classes(mT.base,Wo.widget,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return Zt("div",{class:mT.poweredBy},"Powered by"," ",Zt("a",{class:mT.link,href:"https://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const e=this._isOpen,i=this._isInteractive,r=i?0:void 0,{attributionText:s}=this,n={[mT.sourcesOpen]:e,[Wo.interactive]:i};return Zt("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(mT.sources,n),innerHTML:s,tabIndex:r})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let i=!1;const{clientHeight:r,clientWidth:s,scrollWidth:n}=e,o=n>s,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(i=!0),this._isOpen){const l=r<this._prevSourceNodeHeight;this._prevSourceNodeHeight=r,l&&(this._isOpen=!1,i=!0)}i&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};u([p()],Ul.prototype,"_isOpen",void 0),u([p()],Ul.prototype,"_isInteractive",null),u([p()],Ul.prototype,"_attributionTextOverflowed",void 0),u([p()],Ul.prototype,"_prevSourceNodeHeight",void 0),u([p({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],Ul.prototype,"attributionText",null),u([p()],Ul.prototype,"icon",null),u([p()],Ul.prototype,"itemDelimiter",void 0),u([p()],Ul.prototype,"label",null),u([p(),dv("esri/widgets/Attribution/t9n/Attribution")],Ul.prototype,"messages",void 0),u([p()],Ul.prototype,"view",null),u([p({type:KMe})],Ul.prototype,"viewModel",void 0),u([QMe()],Ul.prototype,"_toggleState",null),Ul=u([A("esri.widgets.Attribution")],Ul);const qnt=Ul;function Wnt(){const t=X("mapview-essential-goto-duration");return t==null?t:t}function Znt(t){return t?.spatialReference?.isWebMercator||t?.spatialReference?.isGeographic||!1}const Ynt=t=>{let e=class extends t{constructor(...i){super(...i),this.goToOverride=null,this.view=null}callGoTo(i){const{view:r}=this;return mV(r),this.goToOverride?this.goToOverride(r,i):r.goTo(i.target,i.options)}};return u([p()],e.prototype,"goToOverride",void 0),u([p()],e.prototype,"view",void 0),e=u([A("esri.widgets.support.GoTo")],e),e};let f1=class extends Ynt(ue){constructor(e){super(e),this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._watchForView(Nt)}destroy(){this.view=null}get canShowNorth(){return Znt(this.view)}get state(){return!this.view?.ready||this.view.type==="2d"&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){this.view?.ready&&(this.view?.type==="2d"?this.callGoTo({target:{rotation:0},options:{animationMode:"always",duration:Wnt()}}):this.callGoTo({target:{heading:0}}))}_updateForRotation(e){e!=null&&this._set("orientation",{z:e})}_updateForCamera(e){if(!e)return;const i=-e.heading;this._set("orientation",{x:0,y:0,z:i})}_updateRotationWatcher(e){this.removeAllHandles(),this._watchForView(),e&&this.addHandles(e.type==="2d"?H(()=>e?.rotation,this._updateForRotation,Nt):H(()=>e?.camera,this._updateForCamera,Nt))}_watchForView(e){this.addHandles(H(()=>this.view,this._updateRotationWatcher,e))}};u([p({readOnly:!0})],f1.prototype,"canShowNorth",null),u([p({readOnly:!0})],f1.prototype,"orientation",void 0),u([p({readOnly:!0})],f1.prototype,"state",null),u([p()],f1.prototype,"view",void 0),f1=u([A("esri.widgets.Compass.CompassViewModel")],f1);const tOe=f1,rde="esri-compass",sde={base:rde,iconContainer:`${rde}__icon-container`};let Kg=class extends zS{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new tOe,this._reset=()=>{this.viewModel.reset()},this._toRotationTransform=r=>({transform:`rotateZ(${r.z}deg)`})}loadDependencies(){return CD({button:()=>V(()=>Promise.resolve().then(()=>lae),void 0),icon:()=>V(()=>Promise.resolve().then(()=>vze),void 0)})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return this.viewModel.state==="rotation"?"arrow-up":"compass-needle"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:i}=this.viewModel,{messages:r}=this;return Zt("div",{class:this.classes(sde.base,Wo.widget)},Zt("calcite-button",{class:Wo.widgetButton,disabled:i==="disabled",kind:"neutral",label:r.reset,onclick:this._reset,round:!0,scale:"s",title:r.reset},Zt("div",{"aria-hidden":"true",class:sde.iconContainer,title:r.reset},Zt("calcite-icon",{icon:this.icon,styles:this._toRotationTransform(e)}))))}};u([p()],Kg.prototype,"goToOverride",null),u([p()],Kg.prototype,"icon",null),u([p()],Kg.prototype,"label",null),u([p(),dv("esri/widgets/Compass/t9n/Compass")],Kg.prototype,"messages",void 0),u([p()],Kg.prototype,"view",null),u([p({type:tOe})],Kg.prototype,"viewModel",void 0),Kg=u([A("esri.widgets.Compass")],Kg);const Jnt=Kg,nde="esri-navigation-toggle",ode={base:nde,isLayoutHorizontal:`${nde}--horizontal`};let RE=class extends ue{constructor(e){super(e),this._navigationMode="pan",this.view=null}initialize(){this.addHandles(gn(()=>this.view?.navigation?.actionMap,()=>this._updateNavigationActionMap()))}destroy(){this.view=null}get state(){return this.view?.ready&&this.view?.type==="3d"?"ready":"disabled"}get navigationMode(){return this._navigationMode}set navigationMode(e){this._navigationMode=e,this._updateNavigationActionMap()}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate")}_updateNavigationActionMap(){const e=this.view?.navigation?.actionMap;if(!e)return;const i=this._navigationMode==="pan";e.dragPrimary=i?"pan":"rotate",e.dragSecondary=i?"rotate":"pan"}};u([p({readOnly:!0})],RE.prototype,"state",null),u([p()],RE.prototype,"_navigationMode",void 0),u([p()],RE.prototype,"view",void 0),RE=u([A("esri.widgets.NavigationToggle.NavigationToggleViewModel")],RE);const iOe=RE;let Qg=class extends zS{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new iOe,this.toggle=()=>this.viewModel.toggle(),this._panButton=null,this._rotateButton=null,this._toggle=()=>{const r=this.viewModel?.navigationMode==="pan"?this._rotateButton:this._panButton;J7e(r),this.toggle()}}loadDependencies(){return CD({button:()=>V(()=>Promise.resolve().then(()=>lae),void 0)})}get icon(){return"move"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e=this.viewModel?.state==="disabled",i=this.viewModel?.navigationMode==="pan",r=this.messages.toggle;return Zt("div",{class:this.classes(ode.base,Wo.widget,{[ode.isLayoutHorizontal]:this.layout==="horizontal"})},Zt("calcite-button",{afterCreate:s=>{this._panButton=s},appearance:i?"outline-fill":"solid",class:Wo.widgetButton,disabled:e,iconStart:"move",kind:"neutral",label:r,onclick:this._toggle,tabIndex:i?void 0:-1,title:r}),Zt("calcite-button",{afterCreate:s=>{this._rotateButton=s},appearance:i?"solid":"outline-fill",class:Wo.widgetButton,disabled:e,iconStart:"rotate",kind:"neutral",label:r,onclick:this._toggle,tabIndex:i?-1:void 0,title:r}))}};u([p()],Qg.prototype,"icon",null),u([p()],Qg.prototype,"label",null),u([p({value:"vertical"})],Qg.prototype,"layout",null),u([p(),dv("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Qg.prototype,"messages",void 0),u([p()],Qg.prototype,"view",null),u([p({type:iOe})],Qg.prototype,"viewModel",void 0),Qg=u([A("esri.widgets.NavigationToggle")],Qg);const Xnt=Qg;let m1=class extends ue{get canZoomIn(){if(!this.view?.ready)return!1;const i=this.view?.constraints?.effectiveMaxScale;return i===0||this._scale>i}get canZoomOut(){const{view:e}=this;if(!e?.ready)return!1;const r=e.constraints?.effectiveMinScale;return r===0||this._scale<r}get _scale(){const e=this.view?.animation?.target;return(e&&"then"in e?void 0:e?.scale)??this.view?.scale??0}};u([p({readOnly:!0})],m1.prototype,"canZoomIn",null),u([p({readOnly:!0})],m1.prototype,"canZoomOut",null),u([p()],m1.prototype,"view",void 0),u([p()],m1.prototype,"_scale",null),m1=u([A("esri.widgets.Zoom.ZoomConditions2D")],m1);const Knt=m1;let PE=class extends ue{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};u([p({readOnly:!0})],PE.prototype,"canZoomIn",null),u([p({readOnly:!0})],PE.prototype,"canZoomOut",null),u([p()],PE.prototype,"view",void 0),PE=u([A("esri.widgets.Zoom.ZoomConditions3D")],PE);const Qnt=PE;let V0=class extends ue{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){return this._zoomConditions!=null&&this._zoomConditions?.canZoomOut}get state(){return this.view?.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new Knt({view:e}):e.type==="3d"&&(this._zoomConditions=new Qnt({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){const e=this.view;this.canZoomIn&&e&&(e.type==="2d"?e.mapViewNavigation.zoomIn():xP(e.goTo({zoomFactor:2})))}zoomOut(){const e=this.view;this.canZoomOut&&e&&(e.type==="2d"?e.mapViewNavigation.zoomOut():xP(e.goTo({zoomFactor:.5})))}};u([p()],V0.prototype,"_zoomConditions",void 0),u([p()],V0.prototype,"canZoomIn",null),u([p()],V0.prototype,"canZoomOut",null),u([p({readOnly:!0})],V0.prototype,"state",null),u([p()],V0.prototype,"view",null),V0=u([A("esri.widgets.Zoom.ZoomViewModel")],V0);const rOe=V0,ade={base:"esri-zoom",horizontalLayout:"esri-zoom--horizontal"};let ey=class extends zS{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new rOe,this.zoomIn=()=>this.viewModel.zoomIn(),this.zoomOut=()=>this.viewModel.zoomOut()}loadDependencies(){return CD({button:()=>V(()=>Promise.resolve().then(()=>lae),void 0)})}get icon(){return"magnifying-glass-plus"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e={[ade.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:i,canZoomOut:r}=this.viewModel,{zoomIn:s,zoomOut:n}=this.messages;return Zt("div",{class:this.classes(ade.base,Wo.widget,e)},Zt("calcite-button",{class:Wo.widgetButton,disabled:!i,iconStart:"plus",kind:"neutral",label:s,onclick:this.zoomIn,title:s}),Zt("calcite-button",{class:Wo.widgetButton,disabled:!r,iconStart:"minus",kind:"neutral",label:n,onclick:this.zoomOut,title:n}))}};u([p()],ey.prototype,"icon",null),u([p()],ey.prototype,"label",null),u([p({value:"vertical"})],ey.prototype,"layout",null),u([p(),dv("esri/widgets/Zoom/t9n/Zoom")],ey.prototype,"messages",void 0),u([p()],ey.prototype,"view",null),u([p({type:rOe})],ey.prototype,"viewModel",void 0),ey=u([A("esri.widgets.Zoom")],ey);const eot=ey;function tot(t){return t?.view!==void 0}let T4=class extends bst{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=i=>{this.components.forEach(r=>{const s=this._find(r),n=s?.widget;tot(n)&&(n.view=i)})},this._componentsWatcher=(i,r)=>{this._removeComponents(r),this._addComponents(i),this._adjustPadding(i)}}initialize(){this.addHandles([H(()=>this.components,this._componentsWatcher,Nt),H(()=>this.view,this._updateViewAwareWidgets,Nt)])}_add(e,i,r,s,n){let o=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;o=this._createComponent(e)}super._add(o,i,r,s,n)}_removeComponents(e){e.forEach(i=>{const r=this._find(i);r&&(this.remove(r),r.destroy())})}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:i}=this.padding;this.padding=i}}_addComponents(e){this.constructed&&e.forEach(i=>this.add(this._createComponent(i),this._defaultPositionLookup[i]))}_createComponent(e){const i=this._createWidget(e);return new OR({id:e,node:i})}_createWidget(e){const i=this.view;switch(e){case"attribution":return new qnt({view:i});case"compass":return new Jnt({view:i});case"navigation-toggle":return new Xnt({view:i});case"zoom":return new eot({view:i})}}};u([p()],T4.prototype,"components",void 0),T4=u([A("esri.views.ui.DefaultUI")],T4);const gj=T4;let E4=class extends gj{constructor(e){super(e),this.components=["attribution","zoom"]}};u([p()],E4.prototype,"components",void 0),E4=u([A("esri.views.ui.2d.DefaultUI2D")],E4);const sOe=E4;let $D=class yY{constructor(e,i,r=""){this.major=e,this.minor=i,this._context=r}lessThan(e,i){return this.major<e||e===this.major&&this.minor<i}greaterEqual(e,i){return!this.lessThan(e,i)}validate(e){if(this.major!==e.major){const i=this._context&&this._context+":",r=this._context&&this._context+" ";throw new U(i+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new yY(this.major,this.minor,this._context)}static parse(e,i=""){const[r,s]=e.split("."),n=/^\s*\d+\s*$/;if(!r?.match||!n.test(r))throw new U((i&&i+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!s?.match||!n.test(s))throw new U((i&&i+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(r,10),a=parseInt(s,10);return new yY(o,a,i)}},$C=class extends $D{constructor(e,i){super(e,i,"webmap")}};function yH(t){return t!=null&&typeof t=="object"&&"declaredClass"in t&&t.declaredClass==="esri.WebMap"}const nOe=new $C(2,33);var vY;let C4=vY=class extends ee{constructor(t){super(t),this.color=new qe([0,0,0,1])}clone(){return new vY(q({color:this.color}))}};u([p({type:qe,json:{write:!0}})],C4.prototype,"color",void 0),C4=vY=u([A("esri.webmap.background.ColorBackground")],C4);const yj=C4;let oOe,aOe,lOe,cOe,uOe,hOe,dOe;async function iot(){const[,{GraphicsView2D:t,GraphicContainer:e,LabelManager:i,MapViewNavigation:r,MagnifierView2D:s,GridView2D:n,Stage:o}]=await Promise.all([V(()=>import("./webglDeps-luVOL3P9.js"),__vite__mapDeps([130,131,132,133])),V(()=>import("./mapViewDeps-BbE8qZ8X.js"),__vite__mapDeps([134,135,53,54,55,56,51,59,136,52,137,138,50,139,131,133,140,141,57,64,142,60,61,62,143,144,145,132,146,72,49,16,12,21,20,147,148,40,149,63,150,151,58,152,68,153,154,155,156,157,158]))]);aOe=t,lOe=e,cOe=i,uOe=r,hOe=s,dOe=n,oOe=o}let ji=class extends qtt(VEe(p2e(d2e(F$e)))){constructor(e){super(e),this._magnifierView=null,this._gridView=null,this.stage=null,this._resolveWhenReady=[],this.rootLayerViews=new h$({getCollections:()=>[this.basemapView?.baseLayerViews,this.layerViews,this.basemapView?.referenceLayerViews],getChildrenFunction:()=>null}),this.featuresTilingScheme=null,this.graphicsView=null,this.labelManager=null,this.navigation=new nj({actionMap:new _ie({dragTertiary:"none"})}),this.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!0,labelsAnimationTime:125,labelCollisionsEnabled:!0},this.supersampleScreenshotsEnabled=!0,this.supportsGround=!1,this.floors=new Ee,this.grid=null,this.map=null,this.spatialReferenceLocked=!1,this.timeline=new SMe,this.type="2d",this.view2dType=null,this.ui=new sOe,this.test={takeScreenshot:async i=>ist(this._getScreenshotView(i),i)},this.padding={top:0,right:0,bottom:0,left:0},gEe()}destroy(){this.layerViewManager.clear(),this._set("preconditionsReady",!1),this.frameTask=Ce(this.frameTask),this.goToManager.destroy(),this.rootLayerViews.destroy(),this.inputManager.destroy(),this._set("inputManager",null)}get graphicsTileStore(){return new srt(this.featuresTilingScheme)}get constraintsInfo(){const e=this.defaultsFromMap?.tileInfo,i=this.spatialReference;return{lods:e?.spatialReference?.equals(i)?e.lods:null,spatialReference:i}}get initialExtentRequired(){if(!this.stateManager)return!1;const{scale:e,constraints:i,center:r,viewpoint:s,extent:n}=this;let o=this.zoom;return!(this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties?.viewpoint)&&!n&&(i?.effectiveLODs||(o=-1),(!r||e===0&&o===-1)&&(s?.targetGeometry==null||s.targetGeometry.type!=="extent"&&!s.scale))}get defaultsFromMapSettings(){return{required:{extent:!1,heightModelInfo:!1,tileInfo:!0},requiresExtentInSpatialReference:this.spatialReferenceLocked}}get scheduler(){return this.frameTask.scheduler}get typeSpecificPreconditionsReady(){const e=this._getDefaultViewpoint();if(!e)return!1;const i=e.targetGeometry,r=this.spatialReference;return M_(i.spatialReference,r)}get background(){return yH(this.map)?this.map.initialViewProperties.background:null}set background(e){this._override("background",e)}get center(){return this.stateManager?.center??null}set center(e){this.stateManager.center=e}get highlightOptions(){return Lrt(this)}set highlightOptions(e){Nrt(this,e)}get padding(){return this.stateManager?.padding}set padding(e){this.stateManager&&(this.stateManager.padding=e)}get rendering(){return this.stage?.renderRequested??!1}get resolution(){return this.stateManager.resolution??0}get scale(){return this.stateManager?.scale??0}set scale(e){this.stateManager&&(this.stateManager.scale=e)}get tileInfo(){return this.featuresTilingScheme?.tileInfo}get updating(){const e=!(!this.magnifier.visible||this.magnifier.position===null||!this._magnifierView?.updatingHandles.updating),i=!this.destroyed&&(!this.layerViewManager||!this.labelManager||!this.graphicsView||this.layerViewManager.updating===!0||this.labelManager.updating===!0||this.graphicsView.updating===!0||this.allLayerViews.some(r=>!r.destroyed&&!("layerViews"in r)&&r.updating===!0)||e);if(X("esri-2d-log-updating")){const r=this.allLayerViews.reduce((s,n)=>({...s,[`${n.layer.id}(${n.layer.type})`]:!n.destroyed&&!("layerViews"in n)&&n.updating}),{});console.log(`Updating MapView: ${i}
-> Null LayerViewManager: ${!this.layerViewManager}
-> Null LabelManager: ${!this.labelManager}
-> Null GraphicsView: ${!this.graphicsView}
-> layerViewManager.updating: ${this.layerViewManager?.updating}
-> labelManager.updating: ${this.labelManager?.updating}
-> graphicsView.updating: ${this.graphicsView?.updating}
-> allLayerViews: ${JSON.stringify(r)}
-> updatingMagnifier: ${e}
`)}return i}get visibleArea(){const e=this.stateManager.visibleArea;return e&&new Sa({rings:[e.map(i=>[i[0],i[1]])],spatialReference:this.spatialReference})}get zoom(){return this.stateManager.zoom??-1}set zoom(e){this.stateManager.zoom=e}get navigating(){return this.mapViewNavigation?.interacting??!1}async hitTest(e,i){return Frt(this,e,i)}async takeScreenshot(e){return tst(this._getScreenshotView(e),e)}toMap(e){if(!this.ready)return null;const i=cU(e)?lU(this,e):e;return this.stateManager.toMap(i)}toScreen(e,i){return this.stateManager.toScreen(e,i)}whenLayerView(e){return super.whenLayerView(e)}graphicChanged(e){this.graphicsView&&this.graphicsView.graphicUpdateHandler(e)}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties.spatialReference||this.defaultsFromMap?.spatialReference||null}getDefaultTimeZone(){return yH(this.map)?this.map.initialViewProperties.timeZone:null}getDefaultTimeExtent(){return yH(this.map)?this.map.initialViewProperties.timeExtent:null}hasLayerViewModule(e){return vhe.hasLayerViewModule(e)}importLayerView(e){return vhe.importLayerView(e)}pixelSizeAt(){return this.ready?this.resolution:(J.getLogger(this).error("#pixelSizeAt()","Map view cannot be used before it is ready"),null)}async popupHitTest(e){const i=this.toMap(e),r=await this.hitTest(e),s=this.allLayerViews.toArray().filter(c=>c.clips.every(h=>lMe(this,h,e,i))).reverse(),n=new globalThis.Map(s.map(c=>[c.layer.uid,c])),o=[];let a=0,l=0;for(;a<r.results.length||l<s.length;){const c=r.results.at(a);if(c&&c.type!=="graphic"){++a;continue}const h=n.get((c?.layer??c?.graphic.layer)?.uid);if((!c||h)&&l<s.length&&s.at(l)!==h){const d=s.at(l);"fetchPopupFeaturesAtLocation"in d&&o.push({mapPoint:i,layerView:d}),++l}else c&&(o.push({graphic:c.graphic,layerView:h}),++a)}return{hits:o,location:i}}requestUpdate(){this.ready&&this.frameTask.requestUpdate()}async validate(){let e=EMe(this.type);if(X("safari")&&X("safari")<9&&(e=new U("mapview:browser-not-supported","This browser is not supported by MapView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:X("safari")})),e!=null)throw J.getLogger(this).warn("#validate()",e.message),e}loadAsyncDependencies(){return iot()}_getDefaultViewpoint(){const{constraints:e,initialExtent:i,map:r,padding:s,size:n}=this;if(!e)return null;const o=r&&"initialViewProperties"in r?r.initialViewProperties:void 0,a=this.stateManager.getUserStartupOptions(this.size),l=o?.viewpoint,c=l?.targetGeometry?.extent??i,h=c?.center,d=l?.rotation??0,f=l?.scale||c&&lj(c,[n[0]-s.left-s.right,n[1]-s.top-s.bottom]),m=a.center??h,y=a.rotation??d,v=a.scale??f;return m&&v?new Jr({targetGeometry:m,scale:v,rotation:y}):null}_startup(){this.timeline.begin("MapView Startup");const e=this._getDefaultViewpoint();this.stateManager.startup(e,this.size,this.spatialReference,this.defaultsFromMap.extent?.center),this.graphics.owner=this;const i=new oOe(this.surface,{canvas:this.renderCanvas,contextOptions:{disabledExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions},renderingOptions:this.renderingOptions,timeline:this.timeline});this.stage=i,this._magnifierView=new hOe,this._magnifierView.magnifier=this.magnifier,this._gridView=new dOe;const r=new cOe({view:this});this._set("labelManager",r);const s=new Uit({view:this});this._set("animationManager",s);const n=new uOe({view:this,animationManager:s});this._set("mapViewNavigation",n),this._setupSpatialReferenceDependentProperties(),this.addHandles([this.rootLayerViews.on("change",()=>this._updateStageChildren()),i.on("webgl-error",a=>this.fatalError=a.error),H(()=>this.stationary,a=>i.stationary=a,St),H(()=>this.background,a=>{i.backgroundColor=a?.color,this._magnifierView.backgroundColor=a?.color},St),H(()=>this.magnifier,a=>this._magnifierView.magnifier=a,St),H(()=>this.grid,a=>this._gridView.grid=a,St),H(()=>this.renderingOptions,a=>i.renderingOptions=a,St),H(()=>this.highlights.items.map(a=>({name:a.name,options:{fillColor:a.color,haloColor:a.haloColor,fillOpacity:a.fillOpacity,haloOpacity:a.haloOpacity,haloWidth:a.haloWidth,haloBlur:a.haloBlur}})),()=>{i.highlightGradient=Prt(i.highlightGradient,this.highlights.items)},St),H(()=>this.state.id,()=>i.state=this.state,St)],"map-view"),this._updateStageChildren();const o=this._resolveWhenReady;this._resolveWhenReady=[],o.forEach(a=>a(this)),this.timeline.end("MapView Startup"),this.frameTask.start(),this._set("ready",!0)}_teardown(){this._destroySpatialReferenceDependentProperties(),this.removeHandles("map-view"),this.mapViewNavigation.destroy(),this._set("mapViewNavigation",null),this.animation=null,this.animationManager.destroy(),this._set("animationManager",null),this.layerViewManager.clear(),this.labelManager.destroy(),this._magnifierView.destroy(),this._gridView.destroy(),this.stage.destroy(),this.stage=null,this._set("graphicsView",null),this._magnifierView=null,this._gridView=null,this._set("labelManager",null),this._set("mapViewNavigation",null),this.graphics.owner=null,this.frameTask.stop(),this.stationaryManager.clear(),this._set("ready",!1),this.stateManager.teardown()}_updateStageChildren(){this.stage.removeAllChildren(),this.rootLayerViews.forEach(i=>{this.stage.addChild(i.container)});const e=this.graphicsView;this.stage.addChild(e.container),this.stage.addChild(this._magnifierView),this.stage.addChild(this._gridView)}_setupSpatialReferenceDependentProperties(){const e=new qit(yR.create({spatialReference:this.spatialReference,size:512,numLODs:36}));this._set("featuresTilingScheme",e);const i=new aOe({view:this,graphics:this.graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new lOe(e)});this._set("graphicsView",i)}_destroySpatialReferenceDependentProperties(){const e=this.graphicsView;this._set("graphicsView",null),e.destroy(),this._set("featuresTilingScheme",null)}_getScreenshotView(e){const{allLayerViews:i,padding:r,size:s,stage:n}=this;return{allLayerViews:i,backgroundColor:e?.ignoreBackground?null:this.background?.color,padding:r,size:s,stage:n}}_spatialReferenceChanged(e){if(this.ready){this.frameTask.stop();for(const i of this.allLayerViews)i.processDetach();this._destroySpatialReferenceDependentProperties(),this.stateManager.changeSpatialReference(e),this.stage.state=this.state,this._setupSpatialReferenceDependentProperties();for(const i of this.allLayerViews)i.processAttach();this.frameTask.requestFrame(),this.frameTask.start(),this._updateStageChildren()}}};ji.type="2d",u([p({constructOnly:!0})],ji.prototype,"deactivatedWebGLExtensions",void 0),u([p({constructOnly:!0})],ji.prototype,"debugWebGLExtensions",void 0),u([p({readOnly:!0})],ji.prototype,"featuresTilingScheme",void 0),u([p({readOnly:!0})],ji.prototype,"graphicsTileStore",null),u([p()],ji.prototype,"graphicsView",void 0),u([p()],ji.prototype,"constraintsInfo",null),u([p()],ji.prototype,"initialExtentRequired",null),u([p()],ji.prototype,"labelManager",void 0),u([p({type:nj,nonNullable:!0})],ji.prototype,"navigation",void 0),u([p({constructOnly:!0})],ji.prototype,"renderCanvas",void 0),u([p()],ji.prototype,"renderingOptions",void 0),u([p({constructOnly:!0})],ji.prototype,"supersampleScreenshotsEnabled",void 0),u([p({readOnly:!0})],ji.prototype,"supportsGround",void 0),u([p()],ji.prototype,"defaultsFromMapSettings",null),u([p({readOnly:!0})],ji.prototype,"typeSpecificPreconditionsReady",null),u([p({type:yj})],ji.prototype,"background",null),u([p()],ji.prototype,"center",null),u([p({type:Ee})],ji.prototype,"floors",void 0),u([p()],ji.prototype,"grid",void 0),u([p({type:Lm})],ji.prototype,"highlightOptions",null),u([p()],ji.prototype,"map",void 0),u([p()],ji.prototype,"padding",null),u([p({readOnly:!0})],ji.prototype,"rendering",null),u([p({readOnly:!0})],ji.prototype,"resolution",null),u([p()],ji.prototype,"scale",null),u([p({constructOnly:!0})],ji.prototype,"spatialReferenceLocked",void 0),u([p({readOnly:!0})],ji.prototype,"tileInfo",null),u([p({type:SMe,readOnly:!0})],ji.prototype,"timeline",void 0),u([p({readOnly:!0})],ji.prototype,"type",void 0),u([p({readOnly:!0})],ji.prototype,"updating",null),u([p({readOnly:!0})],ji.prototype,"view2dType",void 0),u([p({readOnly:!0})],ji.prototype,"visibleArea",null),u([p()],ji.prototype,"zoom",null),u([p({readOnly:!0})],ji.prototype,"navigating",null),u([p(),Yt(t=>t instanceof gj?t:uA(sOe,t))],ji.prototype,"ui",void 0),ji=u([A("esri.views.View2D")],ji);const rot=ji;let $4=class extends rot{constructor(e){super(e),this.view2dType="map"}};u([p({readOnly:!0})],$4.prototype,"view2dType",void 0),$4=u([A("esri.views.MapView")],$4);const sot=$4;function pOe(t,e){const i=El(t),r=El(e),s=i.store,n=r.store,o=r.metadata;for(const a in o){const l=o[a],c=s.originOf(a),h=n.originOf(a);if(!l.readOnly&&h!==Ti.DEFAULTS)if(c===Ti.DEFAULTS)t.set(a,n.get(a));else{const d=s.get(a),f=n.get(a);d&&f&&f instanceof ue&&d instanceof ue&&d instanceof f.constructor&&pOe(d,f)}}}function Xie(t,e,i,r){return t!=null&&(rs(e,r)?(_b(i,t),!0):(yc[0]=t[0],yc[1]=t[1],yc[2]=0,!!Bn(yc,e,0,yc,r,0)&&(i[0]=yc[0],i[1]=yc[1],yc[0]=t[2],yc[1]=t[3],yc[2]=0,!!Bn(yc,e,0,yc,r,0)&&(i[2]=yc[0],i[3]=yc[1],!0))))}const yc=$();function pc(t,e,i,r){if(ru(t.spatialReference,i)){tN[0]=t.x,tN[1]=t.y;const n=t.z;return tN[2]=n??r??0,Bn(tN,t.spatialReference,0,e,i,0)}const s=Tb(t,i);return!!s&&(e[0]=s?.x,e[1]=s?.y,e[2]=s?.z??r??0,!0)}async function EU(t,e,i,r,s){return await lD(t.spatialReference,i,null,s),pc(t,e,i,r)}const tN=$();let Ov=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&e$(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*lde);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,lde));e++)this._items.push(this._allocator())}};const lde=1024;function Ve(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function fOe(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function Kie(t,e,i,r,s,n,o,a,l,c,h,d,f,m,y,v){return[t,e,i,r,s,n,o,a,l,c,h,d,f,m,y,v]}function not(t,e){return new Float64Array(t,e,16)}const Kn=Ve();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Kn,clone:fOe,create:Ve,createView:not,fromValues:Kie},Symbol.toStringTag,{value:"Module"}));function xs(){return[1,0,0,0,1,0,0,0,1]}function mOe(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function gOe(t,e,i,r,s,n,o,a,l){return[t,e,i,r,s,n,o,a,l]}function oot(t,e){return new Float64Array(t,e,9)}const US=xs();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:US,clone:mOe,create:xs,createView:oot,fromValues:gOe},Symbol.toStringTag,{value:"Module"}));function Dd(){return[0,0,0,1]}function aot(t){return[t[0],t[1],t[2],t[3]]}function lot(t,e,i,r){return[t,e,i,r]}const Qie=Dd();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Qie,clone:aot,create:Dd,fromValues:lot},Symbol.toStringTag,{value:"Module"}));function pi(){return[0,0,0,0]}function vj(t){return[t[0],t[1],t[2],t[3]]}function Gi(t,e,i,r){return[t,e,i,r]}function YP(t,e,i,r){return[t,e,i,r]}function ere(t,e=pi()){const i=Math.min(4,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function cot(t,e){return new Float64Array(t,e,4)}function yOe(){return pi()}function vOe(){return Gi(1,1,1,1)}function _Oe(){return Gi(1,0,0,0)}function bOe(){return Gi(0,1,0,0)}function wOe(){return Gi(0,0,1,0)}function xOe(){return Gi(0,0,0,1)}const sn=yOe(),tre=vOe(),uot=_Oe(),hot=bOe(),dot=wOe(),pot=xOe();Object.freeze(Object.defineProperty({__proto__:null,ONES:tre,UNIT_W:pot,UNIT_X:uot,UNIT_Y:hot,UNIT_Z:dot,ZEROS:sn,clone:vj,create:pi,createView:cot,freeze:YP,fromArray:ere,fromValues:Gi,ones:vOe,unitW:xOe,unitX:_Oe,unitY:bOe,unitZ:wOe,zeros:yOe},Symbol.toStringTag,{value:"Module"}));let IA=class g1{constructor(e){this._create=e,this._items=new Array,this._itemsPtr=0}get(){return this._itemsPtr===0&&e$(()=>this._reset()),this._itemsPtr>=this._items.length&&this._items.push(this._create()),this._items[this._itemsPtr++]}_reset(){const e=2*this._itemsPtr;this._items.length>e&&(this._items.length=e),this._itemsPtr=0}static createVec2f64(){return new g1(He)}static createVec3f64(){return new g1($)}static createVec4f64(){return new g1(pi)}static createMat3f64(){return new g1(xs)}static createMat4f64(){return new g1(Ve)}static createQuatf64(){return new g1(Dd)}get test(){}};const uYt=IA.createVec2f64(),Ne=IA.createVec3f64(),ire=IA.createVec4f64();IA.createMat3f64();const rre=IA.createMat4f64(),fot=IA.createQuatf64();function Iv(t){return t?{origin:is(t.origin),vector:is(t.vector)}:{origin:$(),vector:$()}}function SOe(t,e){const i=yot.get();return i.origin=t,i.vector=e,i}function hYt(t,e=Iv()){return mot(t.origin,t.vector,e)}function mot(t,e,i=Iv()){return ne(i.origin,t),ne(i.vector,e),i}function A4(t,e,i=Iv()){return ne(i.origin,t),ye(i.vector,e,t),i}function TOe(t,e){const i=ye(Ne.get(),e,t.origin),r=de(t.vector,i),s=de(t.vector,t.vector),n=ce(r/s,0,1),o=ye(Ne.get(),ie(Ne.get(),t.vector,n),i);return de(o,o)}function dYt(t,e,i){return _Y(t,e,0,1,i)}function pYt(t,e,i){return oe(i,t.origin,ie(i,t.vector,e))}function _Y(t,e,i,r,s){const{vector:n,origin:o}=t,a=ye(Ne.get(),e,o),l=de(n,a)/Yo(n);return ie(s,n,ce(l,i,r)),oe(s,s,t.origin)}function fYt(t,e){if(EOe(t,SOe(e.origin,e.direction),!1,CU)){const{tA:i,pB:r,distance2:s}=CU;if(i>=0&&i<=1)return s;if(i<0)return ro(t.origin,r);if(i>1)return ro(oe(Ne.get(),t.origin,t.vector),r)}return null}function got(t,e,i){return!!EOe(t,e,!0,CU)&&(ne(i,CU.pA),!0)}function EOe(t,e,i,r){const n=t.origin,o=oe(Ne.get(),n,t.vector),a=e.origin,l=oe(Ne.get(),a,e.vector),c=Ne.get(),h=Ne.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],h[0]=l[0]-a[0],h[1]=l[1]-a[1],h[2]=l[2]-a[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const d=Ne.get();if(d[0]=o[0]-n[0],d[1]=o[1]-n[1],d[2]=o[2]-n[2],Math.abs(d[0])<1e-6&&Math.abs(d[1])<1e-6&&Math.abs(d[2])<1e-6)return!1;const f=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],m=h[0]*d[0]+h[1]*d[1]+h[2]*d[2],y=c[0]*d[0]+c[1]*d[1]+c[2]*d[2],v=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],_=(d[0]*d[0]+d[1]*d[1]+d[2]*d[2])*v-m*m;if(Math.abs(_)<1e-6)return!1;let b=(f*m-y*v)/_,w=(f+m*b)/v;i&&(b=ce(b,0,1),w=ce(w,0,1));const x=Ne.get(),S=Ne.get();return x[0]=n[0]+b*d[0],x[1]=n[1]+b*d[1],x[2]=n[2]+b*d[2],S[0]=a[0]+w*h[0],S[1]=a[1]+w*h[1],S[2]=a[2]+w*h[2],r.tA=b,r.tB=w,r.pA=x,r.pB=S,r.distance2=ro(x,S),!0}const CU={tA:0,tB:0,pA:$(),pB:$(),distance2:0},yot=new Ov(()=>Iv());function yd(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function vot(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function es(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}function sre(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function COe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function $Oe(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function AOe(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function _ot(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function bot(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function wot(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t}function xot(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t}function Sot(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function P$(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function Tot(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}function MOe(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return Math.sqrt(i*i+r*r+s*s+n*n)}function $U(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return i*i+r*r+s*s+n*n}function nre(t){const e=t[0],i=t[1],r=t[2],s=t[3];return Math.sqrt(e*e+i*i+r*r+s*s)}function _j(t){const e=t[0],i=t[1],r=t[2],s=t[3];return e*e+i*i+r*r+s*s}function Eot(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function Cot(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function OOe(t,e){const i=e[0],r=e[1],s=e[2],n=e[3];let o=i*i+r*r+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),t[0]=i*o,t[1]=r*o,t[2]=s*o,t[3]=n*o),t}function IOe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function bj(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=e[3];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t[2]=o+r*(i[2]-o),t[3]=a+r*(i[3]-a),t}function $ot(t,e=1){const i=dD;let r,s,n,o,a,l;do r=2*i()-1,s=2*i()-1,a=r*r+s*s;while(a>=1);do n=2*i()-1,o=2*i()-1,l=n*n+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return t[0]=e*r,t[1]=e*s,t[2]=e*n*c,t[3]=e*o*c,t}function Yc(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3];return t[0]=i[0]*r+i[4]*s+i[8]*n+i[12]*o,t[1]=i[1]*r+i[5]*s+i[9]*n+i[13]*o,t[2]=i[2]*r+i[6]*s+i[10]*n+i[14]*o,t[3]=i[3]*r+i[7]*s+i[11]*n+i[15]*o,t}function Aot(t,e,i){const r=e[0],s=e[1],n=e[2],o=i[0],a=i[1],l=i[2],c=i[3],h=c*r+a*n-l*s,d=c*s+l*r-o*n,f=c*n+o*s-a*r,m=-o*r-a*s-l*n;return t[0]=h*c+m*-o+d*-l-f*-a,t[1]=d*c+m*-a+f*-o-h*-l,t[2]=f*c+m*-l+h*-a-d*-o,t[3]=e[3],t}function Mot(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function Dx(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function oS(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],h=So();return Math.abs(i-o)<=h*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=h*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=h*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=h*Math.max(1,Math.abs(n),Math.abs(c))}const Oot=COe,Iot=$Oe,Rot=AOe,Pot=MOe,Dot=$U,Lot=nre,Not=_j,ROe=Object.freeze(Object.defineProperty({__proto__:null,add:sre,ceil:_ot,copy:yd,copyVec3:vot,dist:Pot,distance:MOe,div:Rot,divide:AOe,dot:IOe,equals:oS,exactEquals:Dx,floor:bot,inverse:Cot,len:Lot,length:nre,lerp:bj,max:xot,min:wot,mul:Iot,multiply:$Oe,negate:Eot,normalize:OOe,random:$ot,round:Sot,scale:P$,scaleAndAdd:Tot,set:es,sqrDist:Dot,sqrLen:Not,squaredDistance:$U,squaredLength:_j,str:Mot,sub:Oot,subtract:COe,transformMat4:Yc,transformQuat:Aot},Symbol.toStringTag,{value:"Module"}));function mYt(t,e,i){const r=de(t,e)/de(t,t);return ie(i,t,r)}function ab(t,e){return de(t,e)/Te(t)}function ore(t,e){const i=de(t,e)/(Te(t)*Te(e));return-Za(i)}function POe(t,e,i){ae(iN,t),ae(vH,e);const r=de(iN,vH),s=Za(r),n=lt(iN,iN,vH);return de(n,i)<0?2*Math.PI-s:s}const iN=$(),vH=$();function JP(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],i=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],r=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,i,r))}function gYt(t,e){const i=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),r=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),s=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return se(t,i,r,s),t}function yYt(t,e,i){i=i||t;const r=de(t,e);se(i,t[0]-r*e[0],t[1]-r*e[1],t[2]-r*e[2]),ae(i,i)}function Fot(t,e,i){Math.abs(t[0])>Math.abs(t[1])?se(e,0,1,0):se(e,1,0,0),lt(i,t,e),lt(e,i,t),ae(i,i),ae(e,e)}function rN(t,e,i,r,s,n){const o=t+(e-t)*s;return o+(i+(r-i)*s-o)*n}function DOe(t,e,i,r=$()){const s=Te(t),n=Te(e),o=de(t,e)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-i)*s+i*n)/Math.sin(a),c=l/s*Math.sin((1-i)*a),h=l/n*Math.sin(i*a);return ie(mx,t,c),ie(gx,e,h),oe(r,mx,gx)}return dr(r,t,e,i)}function vYt(t,e,i,r=$(),s=$()){const n=Te(t),o=Te(e),a=de(t,e)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),h=Math.sin(i*l),d=Math.sin((1-i)*l),f=(1-i)*n+i*o;{const m=f/c,y=m/o*h;ie(mx,t,m/n*d),ie(gx,e,y),oe(r,mx,gx)}{const m=1/n*(-Math.cos((1-i)*l)*l*f+d*(-n+o));ie(mx,t,m);const y=1/o*(Math.cos(i*l)*l*f+h*(-n+o));ie(gx,e,y),oe(s,mx,gx),ie(s,s,1/c)}return s}return dr(r,t,e,i),ye(s,e,t),ae(s,s),s}function wj(t,e,i){t=ae(mx,t),e=ae(gx,e);const r=Za(de(t,e));if(i){const s=lt(kot,t,e);if(de(s,i)<0)return-r}return r}function M4(t){const e=t.length;return i=>{if(i<=t[0][0])return t[0][1];if(i>=t[e-1][0])return t[e-1][1];let r=1;for(;i>t[r][0];)r++;const s=t[r-1][0],n=t[r][0],o=(n-i)/(n-s);return o*t[r-1][1]+(1-o)*t[r][1]}}function _Yt(t,e,i,r){ye(cde,e,t),ye(ude,i,t),lt(r,cde,ude),ae(r,r),r[3]=-de(t,r)}function bYt(t,e){if(se(e,0,0,0),t.length>0){for(let i=0;i<t.length;++i)oe(e,e,t[i]);ie(e,e,1/t.length)}}const cde=$(),ude=$(),kot=$(),mx=$(),gx=$();function Br(t=iI){return[t[0],t[1],t[2],t[3]]}function zot(t=iI[0],e=iI[1],i=iI[2],r=iI[3]){return Iy(t,e,i,r,ire.get())}function are(t,e){return Iy(e[0],e[1],e[2],e[3],t)}function wYt(t){return t}function Iy(t,e,i,r,s=Br()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function LOe(t,e,i){return ne(i,t),i[3]=e,i}function D$(t,e,i){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function kp(t,e,i,r=Br()){const s=i[0]-e[0],n=i[1]-e[1],o=i[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],h=n*c-o*l,d=o*a-s*c,f=s*l-n*a,m=h*h+d*d+f*f,y=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return r[0]=h*y,r[1]=d*y,r[2]=f*y,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function lre(t,e,i,r=0,s=Math.floor(i*(1/3)),n=Math.floor(i*(2/3))){if(i<3)return!1;e(vM,r);let o=s,a=!1;for(;o<i-1&&!a;)e(gT,o),o++,a=!Qn(vM,gT);if(!a)return!1;for(o=Math.max(o,n),a=!1;o<i&&!a;)e(K1,o),o++,ye(sN,vM,gT),ae(sN,sN),ye(nN,gT,K1),ae(nN,nN),a=!Qn(vM,K1)&&!Qn(gT,K1)&&Math.abs(de(sN,nN))<Uot;return a?(kp(vM,gT,K1,t),!0):(r!==0||s!==1||n!==2)&&lre(t,e,i,0,1,2)}function xYt(t,e,i=!0){const r=e.length/3;return lre(t,(s,n)=>se(s,e[3*n+0],e[3*n+1],e[3*n+2]),i?r-1:r)}const Uot=.99619469809,vM=$(),gT=$(),K1=$(),sN=$(),nN=$();function bY(t,e,i){return e!==t&&are(t,e),t[3]=-de(t,i),t}function Bot(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function wY(t,e,i,r){return lt(K1,e,t),D$(i,K1,r)}function SYt(t,e,i,r){return xj(AD(t,e,ye(Ne.get(),i,e),Wot,r))}function RA(t,e,i){return e!=null&&xj(AD(t,e.origin,e.direction,Zot,i))}function NOe(t,e,i){return xj(AD(t,e.origin,e.vector,tf.NONE,i))}function Vot(t,e,i){return xj(AD(t,e.origin,e.vector,tf.CLAMP,i))}function AU(t,e){return rn(t,e)>=0}function jot(t,e){const i=de(t,e.ray.direction),r=-rn(t,e.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const s=r/i;return i>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function Got(t,e){const i=de(t,e.ray.direction),r=-rn(t,e.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const s=r/i;return i>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function Hot(t,e,i){const r=ie(Ne.get(),t,-t[3]),s=qot(t,ye(Ne.get(),e,r),Ne.get());return oe(i,s,r),i}function TYt(t,e,i,r){const s=t,n=Ne.get(),o=Ne.get();Fot(s,n,o);const a=ye(Ne.get(),i,e),l=ab(n,a),c=ab(o,a),h=ab(s,a);return se(r,l,c,h)}function qot(t,e,i){const r=ie(Ne.get(),t,de(t,e));return ye(i,e,r),i}function EYt(t,e){return Math.abs(rn(t,e))}function rn(t,e){return de(t,e)+t[3]}var ic;function xj(t){return t===ic.INTERSECTS_INSIDE_OUT||t===ic.INTERSECTS_OUTSIDE_IN}function AD(t,e,i,r,s){const n=de(t,i),o=rn(t,e);if(n===0)return o>=0?ic.INSIDE:ic.OUTSIDE;let a=-o/n;return r&tf.CLAMP&&(a=ce(a,0,1)),!(r&tf.INFINITE_MIN)&&a<0||!(r&tf.INFINITE_MAX)&&a>1?o>=0?ic.INSIDE:ic.OUTSIDE:(oe(s,e,ie(s,i,a)),o>=0?ic.INTERSECTS_INSIDE_OUT:ic.INTERSECTS_OUTSIDE_IN)}(function(t){t[t.INTERSECTS_INSIDE_OUT=0]="INTERSECTS_INSIDE_OUT",t[t.INTERSECTS_OUTSIDE_IN=1]="INTERSECTS_OUTSIDE_IN",t[t.INSIDE=2]="INSIDE",t[t.OUTSIDE=3]="OUTSIDE"})(ic||(ic={}));const iI=[0,0,1,0];var tf;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(tf||(tf={}));const Wot=tf.INFINITE_MIN|tf.INFINITE_MAX,Zot=tf.INFINITE_MAX;function Pn(t){return t?hde(is(t.origin),is(t.direction)):hde($(),$())}function hde(t,e){return{origin:t,direction:e}}function CYt(t,e){return Hm(t.origin,e.origin)&&Hm(t.direction,e.direction)}function mf(t,e){const i=Xot.get();return i.origin=t,i.direction=e,i}function MU(t,e=Pn()){return cre(t.origin,t.direction,e)}function FOe(t,e,i=Pn()){return ne(i.origin,t),ye(i.direction,e,t),i}function cre(t,e,i=Pn()){return ne(i.origin,t),ne(i.direction,e),i}function Yot(t,e){const i=lt(Ne.get(),ae(Ne.get(),t.direction),ye(Ne.get(),e,t.origin));return de(i,i)}function Jot(t,e,i){const r=de(t.direction,ye(i,e,t.origin));return oe(i,t.origin,ie(i,t.direction,r)),i}function $Yt(t,e,i,r){const s=t.origin,n=e.origin,o=t.direction,a=e.direction,l=de(ae(bH,o),ae(dde,a));if(Math.abs(l)>=1)return null;const c=lt(bH,o,a),h=Ri(_H,n,s),d=vD(pde,o[0],o[1],o[2],-a[0],-a[1],-a[2],c[0],c[1],c[2]),f=_D(pde,d);if(f==null)return[i,r];const m=de(se(bH,f[0],f[3],f[6]),h),y=de(se(dde,f[1],f[4],f[7]),h);return oe(i,s,ie(_H,o,m)),oe(r,n,ie(_H,a,y)),[i,r]}const Xot=new Ov(()=>Pn()),_H=$(),bH=$(),dde=$(),pde=xs(),wH=()=>J.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let Kot=class{constructor(){this.plane=Br(),this.origin=$(),this.basis1=$(),this.basis2=$()}};const kOe=Kot;function qb(t=YOe){return{plane:Br(t.plane),origin:is(t.origin),basis1:is(t.basis1),basis2:is(t.basis2)}}function Qot(t,e,i){const r=pat.get();return r.origin=t,r.basis1=e,r.basis2=i,r.plane=zot(0,0,0,0),Sj(r),r}function BS(t,e=qb()){return ure(t.origin,t.basis1,t.basis2,e)}function eat(t,e){ne(e.origin,t.origin),ne(e.basis1,t.basis1),ne(e.basis2,t.basis2),are(e.plane,t.plane)}function ure(t,e,i,r=qb()){return ne(r.origin,t),ne(r.basis1,e),ne(r.basis2,i),Sj(r),hat(r,"fromValues()"),r}function Sj(t){wY(t.basis2,t.basis1,t.origin,t.plane)}function zOe(t,e,i){t!==i&&BS(t,i);const r=ie(Ne.get(),pv(t),e);return oe(i.origin,i.origin,r),i.plane[3]-=e,i}function tat(t,e,i){return UOe(e,i),zOe(i,fre(t,t.origin),i),i}function iat(t,e){const i=t.basis1[0],r=t.basis2[1],[s,n]=t.origin;return lte(s-i,n-r,s+i,n+r,e)}function UOe(t,e=qb()){const i=(t[2]-t[0])/2,r=(t[3]-t[1])/2;return se(e.origin,t[0]+i,t[1]+r,0),se(e.basis1,i,0,0),se(e.basis2,0,r,0),Iy(0,0,1,0,e.plane),e}function hre(t,e,i){return!!RA(t.plane,e,i)&&WOe(t,i)}function rat(t,e,i){if(hre(t,e,i))return i;const r=BOe(t,e,Ne.get());return oe(i,e.origin,ie(Ne.get(),e.direction,xr(e.origin,r)/Te(e.direction))),i}function BOe(t,e,i){const r=OU.get();ZOe(t,e,r,OU.get());let s=Number.POSITIVE_INFINITY;for(const n of gre){const o=mre(t,n,Tj.get()),a=Ne.get();if(NOe(r,o,a)){const l=kS(Ne.get(),e.origin,a),c=Math.abs(Za(de(e.direction,l)));c<s&&(s=c,ne(i,a))}}return s===Number.POSITIVE_INFINITY?jOe(t,e,i):i}function VOe(t,e){return(e-t)/e}function jOe(t,e,i){if(hre(t,e,i))return i;const r=OU.get(),s=OU.get();ZOe(t,e,r,s);let n=Number.POSITIVE_INFINITY;for(const o of gre){const a=mre(t,o,Tj.get()),l=Ne.get();if(Vot(r,a,l)){const c=Yot(e,l);if(!AU(s,l))continue;c<n&&(n=c,ne(i,l))}}return dre(t,e.origin)<n&&GOe(t,e.origin,i),i}function GOe(t,e,i){const r=Hot(t.plane,e,Ne.get()),s=_Y(fde(t,t.basis1),r,-1,1,Ne.get()),n=_Y(fde(t,t.basis2),r,-1,1,Ne.get());return ye(i,oe(Ne.get(),s,n),t.origin),i}function HOe(t,e,i){const{origin:r,basis1:s,basis2:n}=t,o=ye(Ne.get(),e,r),a=ab(s,o),l=ab(n,o),c=ab(pv(t),o);return se(i,a,l,c)}function dre(t,e){const i=HOe(t,e,Ne.get()),{basis1:r,basis2:s}=t,n=Te(r),o=Te(s),a=Math.max(Math.abs(i[0])-n,0),l=Math.max(Math.abs(i[1])-o,0),c=i[2];return a*a+l*l+c*c}function sat(t,e){return Math.sqrt(dre(t,e))}function nat(t,e){let i=Number.NEGATIVE_INFINITY;for(const r of gre){const s=mre(t,r,Tj.get()),n=TOe(s,e);n>i&&(i=n)}return Math.sqrt(i)}function pre(t,e){return AU(t.plane,e)&&WOe(t,e)}function oat(t,e,i,r){return uat(t,i,r)}function fre(t,e){const i=-t.plane[3];return ab(pv(t),e)-i}function aat(t,e,i,r){const s=fre(t,e),n=ie(dat,pv(t),i-s);return oe(r,e,n),r}function lat(t,e){return Qn(t.basis1,e.basis1)&&Qn(t.basis2,e.basis2)&&Qn(t.origin,e.origin)}function qOe(t,e,i){return t!==i&&BS(t,i),Sl(yT,e),dc(yT,yT),st(i.basis1,t.basis1,yT),st(i.basis2,t.basis2,yT),st(i.plane,t.plane,yT),st(i.origin,t.origin,e),bY(i.plane,i.plane,i.origin),i}function cat(t,e,i,r){return t!==r&&BS(t,r),Ad(xH,e,i),st(r.basis1,t.basis1,xH),st(r.basis2,t.basis2,xH),Sj(r),r}function pv(t){return t.plane}function uat(t,e,i){switch(e){case Qr.X:ne(i,t.basis1),ae(i,i);break;case Qr.Y:ne(i,t.basis2),ae(i,i);break;case Qr.Z:ne(i,pv(t))}return i}function WOe(t,e){const i=ye(Ne.get(),e,t.origin),r=Yo(t.basis1),s=Yo(t.basis2),n=de(t.basis1,i),o=de(t.basis2,i);return-n-r<0&&n-r<0&&-o-s<0&&o-s<0}function fde(t,e){const i=Tj.get();return ne(i.origin,t.origin),ne(i.vector,e),i}function mre(t,e,i){const{basis1:r,basis2:s,origin:n}=t,o=ie(Ne.get(),r,e.origin[0]),a=ie(Ne.get(),s,e.origin[1]);oe(i.origin,o,a),oe(i.origin,i.origin,n);const l=ie(Ne.get(),r,e.direction[0]),c=ie(Ne.get(),s,e.direction[1]);return ie(i.vector,oe(l,l,c),2),i}function hat(t,e){Math.abs(de(t.basis1,t.basis2)/(Te(t.basis1)*Te(t.basis2)))>1e-6&&wH().warn(e,"Provided basis vectors are not perpendicular"),Math.abs(de(t.basis1,pv(t)))>1e-6&&wH().warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-de(pv(t),t.origin)-t.plane[3])>1e-6&&wH().warn(e,"Plane offset is not consistent with plane origin")}function ZOe(t,e,i,r){const s=pv(t);wY(s,e.direction,e.origin,i),wY(i,s,e.origin,r)}const YOe={plane:Br(),origin:Le(0,0,0),basis1:Le(1,0,0),basis2:Le(0,1,0)},OU=new Ov(Br),Tj=new Ov(Iv),dat=$(),pat=new Ov(()=>qb()),gre=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],yT=Ve(),xH=Ve(),fat=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:kOe,altitudeAt:fre,axisAt:oat,cameraFrustumCoverage:VOe,closestPoint:jOe,closestPointOnSilhouette:BOe,copy:BS,copyWithoutVerify:eat,create:qb,distance:sat,distance2:dre,distanceToSilhouette:nat,elevate:zOe,equals:lat,extrusionContainsPoint:pre,fromAABoundingRect:UOe,fromValues:ure,getExtent:iat,intersectRay:hre,intersectRayClosestSilhouette:rat,normal:pv,projectPoint:GOe,projectPointLocal:HOe,rotate:cat,setAltitudeAt:aat,setExtent:tat,transform:qOe,up:YOe,updateUnboundedPlane:Sj,wrap:Qot},Symbol.toStringTag,{value:"Module"})),mat=new Ae(cSe),z2=new Ae(SV),U2=new Ae(TV),MYt=new Ae(uSe);function $b(t){const e=mde.get(t);if(e)return e;let i=mat;if(t)if(t===z2)i=z2;else if(t===U2)i=U2;else{const r=t.wkid,s=t.latestWkid;if(r!=null||s!=null)s$(r)||s$(s)?i=z2:(n$(r)||n$(s))&&(i=U2);else{const n=t.wkt2??t.wkt;if(n){const o=n.toUpperCase();o===gat?i=z2:o===yat&&(i=U2)}}}return mde.set(t,i),i}const mde=new Map,gat=z2.wkt.toUpperCase(),yat=U2.wkt.toUpperCase();function gde(t,e){const i=Te(t),r=Td(t[2]/i),s=Math.atan2(t[1]/i,t[0]/i);return se(e,i,r,s),e}const JOe=Rs();function Rs(){return pi()}const vat=oS,_at=oS;function aS(t,e){return yd(e,t)}function XOe(t,e){return Gi(t[0],t[1],t[2],e)}function bat(t){return t}function wat(t){t[0]=t[1]=t[2]=t[3]=0}function PA(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function Nm(t){return t[3]}function xat(t){return t}function KOe(t,e,i,r){return Gi(t,e,i,r)}function Sat(t,e,i){return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),i[3]=t[3]+e,i}function Tat(t,e,i){return t!==i&&aS(t,i),i}function Eat(t,e){return e}function Wb(t,e,i){if(e==null||!QOe(t,e,IU))return!1;let{t0:r,t1:s}=IU;if((r<0||s<r&&s>0)&&(r=s),r<0)return!1;if(i){const{origin:n,direction:o}=e;i[0]=n[0]+o[0]*r,i[1]=n[1]+o[1]*r,i[2]=n[2]+o[2]*r}return!0}function Cat(t,e,i){const r=FOe(e,i);if(!QOe(t,r,IU))return[];const{origin:s,direction:n}=r,{t0:o,t1:a}=IU,l=c=>{const h=$();return Xn(h,s,n,c),vre(t,h,h)};return Math.abs(o-a)<So()?[l(o)]:[l(o),l(a)]}const IU={t0:0,t1:0};function QOe(t,e,i){const{origin:r,direction:s}=e,n=$at;n[0]=r[0]-t[0],n[1]=r[1]-t[1],n[2]=r[2]-t[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2];if(o===0)return!1;const a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);return i.t0=(-a-c)/(2*o),i.t1=(-a+c)/(2*o),!0}const $at=$();function xY(t,e){return Wb(t,e,null)}function Aat(t,e,i){if(Wb(t,e,i))return i;const r=DA(t,e,Ne.get());return oe(i,e.origin,ie(Ne.get(),e.direction,xr(e.origin,r)/Te(e.direction))),i}function DA(t,e,i){const r=Ne.get(),s=rre.get();lt(r,e.origin,e.direction);const n=Nm(t);lt(i,r,e.origin),ie(i,i,1/Te(i)*n);const o=tIe(t,e.origin),a=ore(e.origin,i);return Ad(s,a+o,r),st(i,i,s),i}function yre(t,e,i,r){const s=Nm(t),n=s*s,o=e+.5*Math.PI,a=i*i+n-2*Math.cos(o)*i*s,l=Math.sqrt(a),c=a-n;if(c<=0)return .5;const h=Math.sqrt(c),d=Math.acos(h/l)-Math.asin(s/(l/Math.sin(o)));return Math.min(1,(d+.5*r)/r)}function Mat(t,e,i){return Wb(t,e,i)?i:(Jot(e,t,i),vre(t,i,i))}function vre(t,e,i){const r=ye(Ne.get(),e,t),s=ie(Ne.get(),r,t[3]/Te(r));return oe(i,s,t)}function eIe(t,e){const i=ye(Ne.get(),e,t),r=Yo(i),s=t[3]*t[3];return Math.sqrt(Math.abs(r-s))}function tIe(t,e){const i=ye(Ne.get(),e,t),r=Te(i),s=Nm(t),n=s+Math.abs(s-r);return Za(s/n)}const SH=$();function iIe(t,e,i,r){const s=ye(SH,e,t);switch(i){case Qr.X:{const n=gde(s,SH)[2];return se(r,-Math.sin(n),Math.cos(n),0)}case Qr.Y:{const n=gde(s,SH),o=n[1],a=n[2],l=Math.sin(o);return se(r,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case Qr.Z:return ae(r,s);default:return}}function rIe(t,e){const i=ye(SY,e,t);return Te(i)-t[3]}function Oat(t,e,i,r){const s=rIe(t,e),n=iIe(t,e,Qr.Z,SY),o=ie(SY,n,i-s);return oe(r,e,o)}function Iat(t,e){const i=ro(t,e),r=Nm(t);return i<=r*r}function Rat(t,e,i=pi()){const r=xr(t,e),s=t[3],n=e[3];return r+n<s?(yd(i,t),i):r+s<n?(yd(i,e),i):(dr(i,t,e,(r+n-s)/(2*r)),i[3]=(r+s+n)/2,i)}const SY=$(),Ej=Rs(),Pat=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:JOe,altitudeAt:rIe,angleToSilhouette:tIe,axisAt:iIe,cameraFrustumCoverage:yre,clear:wat,closestPoint:Mat,closestPointOnSilhouette:DA,containsPoint:Iat,copy:aS,create:Rs,distanceToSilhouette:eIe,elevate:Sat,equals:_at,exactEquals:vat,fromCenterAndRadius:XOe,fromRadius:PA,fromValues:KOe,getCenter:xat,getExtent:Eat,getRadius:Nm,intersectLine:Cat,intersectRay:Wb,intersectRayClosestSilhouette:Aat,intersectsRay:xY,projectPoint:vre,setAltitudeAt:Oat,setExtent:Tat,tmpSphere:Ej,union:Rat,wrap:bat},Symbol.toStringTag,{value:"Module"}));function Dat(t){const{value:e,operations:i}=t;return{operations:i,value:i.create(e)}}function Lat(t,e,i){return t.operations.setExtent(t.value,e,i.value),i}function Nat(t,e){return t.operations.getExtent(t.value,e),e}function Fat(t){return{operations:t,value:t.create()}}function sIe(t,e,i=Fat(t)){return i.operations=t,t.copy(e,i.value),i}function kat(t){return sIe(Pat,KOe(0,0,0,gr(t).radius))}const yde=2**50;function zat(){return sIe(fat,ure([0,0,0],[yde,0,0],[0,yde,0]))}function Uat(t,e,i){return t.operations.axisAt(t.value,e,Qr.Z,i)}function Bat(t,e,i,r){return t.operations.axisAt(t.value,e,i,r)}function Vat(t,e,i){return t.operations.intersectRay(t.value,e,i)}function jat(t,e,i){return t.operations.intersectRayClosestSilhouette(t.value,e,i)}function Gat(t,e){return t.operations.altitudeAt(t.value,e)}function nIe(t,e,i,r){return t.operations.setAltitudeAt(t.value,e,i,r)}function Hat(t,e,i,r){return e!==r&&mn(r,e),se(vT,r[12],r[13],r[14]),nIe(t,vT,i,vT),r[12]=vT[0],r[13]=vT[1],r[14]=vT[2],r}function TH(t,e,i){return t.operations.elevate(t.value,e,i.value)}const vT=$();function vde(t,e,i,r,s){return s[0]=de(t,e),s[1]=de(t,i),s[2]=de(t,r),s}function TY(t,e,i,r,s){ne(i,t),ne(oN,e),ae(oN,oN),lt(r,oN,i),lt(s,r,i)}function qat(t,e){return t?$b(e):e.isGeographic?Ae.PlateCarree:e}const oN=$(),_re=96;function OYt(t,e){const i=t.extent,r=t.width,s=Ao(i?.spatialReference);return i&&r?i.width/r*s*ete*_re:0}function Wat(t,e){return t/(Ao(e)*ete*_re)}function Zat(t){return t/(ete*_re)}function IYt(t,e,i){return Yat(t,e)&&Jat(t,i)}function Yat(t,e){return e===0||Jc(t,e)||t<e}function Jat(t,e){return e===0||Jc(t,e)||t>e}function Xat(t,e){return Jc(t,e)?0:(t||Number.POSITIVE_INFINITY)>(e||Number.POSITIVE_INFINITY)?1:-1}function L$(t,e,i){i=i||2;var r,s,n,o,a,l,c,h=e&&e.length,d=h?e[0]*i:t.length,f=oIe(t,0,d,i,!0),m=[];if(!f||f.next===f.prev)return m;if(h&&(f=ilt(t,e,f,i)),t.length>80*i){r=n=t[0],s=o=t[1];for(var y=i;y<d;y+=i)(a=t[y])<r&&(r=a),(l=t[y+1])<s&&(s=l),a>n&&(n=a),l>o&&(o=l);c=(c=Math.max(n-r,o-s))!==0?1/c:0}return XP(f,m,i,r,s,c),m}function oIe(t,e,i,r,s){var n,o;if(s===$Y(t,e,i,r)>0)for(n=e;n<i;n+=r)o=_de(n,t[n],t[n+1],o);else for(n=i-r;n>=e;n-=r)o=_de(n,t[n],t[n+1],o);if(o&&Cj(o,o.next)){var a=o.next;QP(o),o=a}return o}function Ab(t,e){if(!t)return t;e||(e=t);var i,r=t;do if(i=!1,r.steiner||!Cj(r,r.next)&&dn(r.prev,r,r.next)!==0)r=r.next;else{var s=r.prev;if(QP(r),(r=e=s)===r.next)break;i=!0}while(i||r!==e);return e}function XP(t,e,i,r,s,n,o){if(t){!o&&n&&alt(t,r,s,n);for(var a,l,c=t;t.prev!==t.next;)if(a=t.prev,l=t.next,n?Qat(t,r,s,n):Kat(t))e.push(a.i/i),e.push(t.i/i),e.push(l.i/i),QP(t),t=l.next,c=l.next;else if((t=l)===c){o?o===1?XP(t=elt(Ab(t),e,i),e,i,r,s,n,2):o===2&&tlt(t,e,i,r,s,n):XP(Ab(t),e,i,r,s,n,1);break}}}function Kat(t){var e=t.prev,i=t,r=t.next;if(dn(e,i,r)>=0)return!1;for(var s=t.next.next;s!==t.prev;){if(B2(e.x,e.y,i.x,i.y,r.x,r.y,s.x,s.y)&&dn(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function Qat(t,e,i,r){var s=t.prev,n=t,o=t.next;if(dn(s,n,o)>=0)return!1;for(var a=s.x<n.x?s.x<o.x?s.x:o.x:n.x<o.x?n.x:o.x,l=s.y<n.y?s.y<o.y?s.y:o.y:n.y<o.y?n.y:o.y,c=s.x>n.x?s.x>o.x?s.x:o.x:n.x>o.x?n.x:o.x,h=s.y>n.y?s.y>o.y?s.y:o.y:n.y>o.y?n.y:o.y,d=EY(a,l,e,i,r),f=EY(c,h,e,i,r),m=t.prevZ,y=t.nextZ;m&&m.z>=d&&y&&y.z<=f;){if(m!==t.prev&&m!==t.next&&B2(s.x,s.y,n.x,n.y,o.x,o.y,m.x,m.y)&&dn(m.prev,m,m.next)>=0||(m=m.prevZ,y!==t.prev&&y!==t.next&&B2(s.x,s.y,n.x,n.y,o.x,o.y,y.x,y.y)&&dn(y.prev,y,y.next)>=0))return!1;y=y.nextZ}for(;m&&m.z>=d;){if(m!==t.prev&&m!==t.next&&B2(s.x,s.y,n.x,n.y,o.x,o.y,m.x,m.y)&&dn(m.prev,m,m.next)>=0)return!1;m=m.prevZ}for(;y&&y.z<=f;){if(y!==t.prev&&y!==t.next&&B2(s.x,s.y,n.x,n.y,o.x,o.y,y.x,y.y)&&dn(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function elt(t,e,i){var r=t;do{var s=r.prev,n=r.next.next;!Cj(s,n)&&aIe(s,r,r.next,n)&&KP(s,n)&&KP(n,s)&&(e.push(s.i/i),e.push(r.i/i),e.push(n.i/i),QP(r),QP(r.next),r=t=n),r=r.next}while(r!==t);return Ab(r)}function tlt(t,e,i,r,s,n){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&ult(o,a)){var l=lIe(o,a);return o=Ab(o,o.next),l=Ab(l,l.next),XP(o,e,i,r,s,n),void XP(l,e,i,r,s,n)}a=a.next}o=o.next}while(o!==t)}function ilt(t,e,i,r){var s,n,o,a=[];for(s=0,n=e.length;s<n;s++)(o=oIe(t,e[s]*r,s<n-1?e[s+1]*r:t.length,r,!1))===o.next&&(o.steiner=!0),a.push(clt(o));for(a.sort(rlt),s=0;s<a.length;s++)i=Ab(i=slt(a[s],i),i.next);return i}function rlt(t,e){return t.x-e.x}function EH(t){if(t.next.prev===t)return t;let e=t;for(;;){const i=e.next;if(i.prev===e||i===e||i===t)break;e=i}return e}function slt(t,e){var i=nlt(t,e);if(!i)return e;var r=lIe(i,t),s=Ab(i,i.next);let n=EH(r);return Ab(n,n.next),s=EH(s),EH(e===i?s:e)}function nlt(t,e){var i,r=e,s=t.x,n=t.y,o=-1/0;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){var a=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=s&&a>o){if(o=a,a===s){if(n===r.y)return r;if(n===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!i)return null;if(s===o)return i;var l,c=i,h=i.x,d=i.y,f=1/0;r=i;do s>=r.x&&r.x>=h&&s!==r.x&&B2(n<d?s:o,n,h,d,n<d?o:s,n,r.x,r.y)&&(l=Math.abs(n-r.y)/(s-r.x),KP(r,t)&&(l<f||l===f&&(r.x>i.x||r.x===i.x&&olt(i,r)))&&(i=r,f=l)),r=r.next;while(r!==c);return i}function olt(t,e){return dn(t.prev,t,e.prev)<0&&dn(e.next,t,t.next)<0}function alt(t,e,i,r){var s=t;do s.z===null&&(s.z=EY(s.x,s.y,e,i,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,llt(s)}function llt(t){var e,i,r,s,n,o,a,l,c=1;do{for(i=t,t=null,n=null,o=0;i;){for(o++,r=i,a=0,e=0;e<c&&(a++,r=r.nextZ);e++);for(l=c;a>0||l>0&&r;)a!==0&&(l===0||!r||i.z<=r.z)?(s=i,i=i.nextZ,a--):(s=r,r=r.nextZ,l--),n?n.nextZ=s:t=s,s.prevZ=n,n=s;i=r}n.nextZ=null,c*=2}while(o>1);return t}function EY(t,e,i,r,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*s)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*s)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function clt(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function B2(t,e,i,r,s,n,o,a){return(s-o)*(e-a)-(t-o)*(n-a)>=0&&(t-o)*(r-a)-(i-o)*(e-a)>=0&&(i-o)*(n-a)-(s-o)*(r-a)>=0}function ult(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!hlt(t,e)&&(KP(t,e)&&KP(e,t)&&dlt(t,e)&&(dn(t.prev,t,e.prev)||dn(t,e.prev,e))||Cj(t,e)&&dn(t.prev,t,t.next)>0&&dn(e.prev,e,e.next)>0)}function dn(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function Cj(t,e){return t.x===e.x&&t.y===e.y}function aIe(t,e,i,r){var s=lN(dn(t,e,i)),n=lN(dn(t,e,r)),o=lN(dn(i,r,t)),a=lN(dn(i,r,e));return s!==n&&o!==a||!(s!==0||!aN(t,i,e))||!(n!==0||!aN(t,r,e))||!(o!==0||!aN(i,t,r))||!(a!==0||!aN(i,e,r))}function aN(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function lN(t){return t>0?1:t<0?-1:0}function hlt(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&aIe(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function KP(t,e){return dn(t.prev,t,t.next)<0?dn(t,e,t.next)>=0&&dn(t,t.prev,e)>=0:dn(t,e,t.prev)<0||dn(t,t.next,e)<0}function dlt(t,e){var i=t,r=!1,s=(t.x+e.x)/2,n=(t.y+e.y)/2;do i.y>n!=i.next.y>n&&i.next.y!==i.y&&s<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==t);return r}function lIe(t,e){var i=new CY(t.i,t.x,t.y),r=new CY(e.i,e.x,e.y),s=t.next,n=e.prev;return t.next=e,e.prev=t,i.next=s,s.prev=i,r.next=i,i.prev=r,n.next=r,r.prev=n,r}function _de(t,e,i,r){var s=new CY(t,e,i);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function QP(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function CY(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function $Y(t,e,i,r){for(var s=0,n=e,o=i-r;n<i;n+=r)s+=(t[o]-t[n])*(t[n+1]+t[o+1]),o=n;return s}L$.deviation=function(t,e,i,r){var s=e&&e.length,n=s?e[0]*i:t.length,o=Math.abs($Y(t,0,n,i));if(s)for(var a=0,l=e.length;a<l;a++){var c=e[a]*i,h=a<l-1?e[a+1]*i:t.length;o-=Math.abs($Y(t,c,h,i))}var d=0;for(a=0;a<r.length;a+=3){var f=r[a]*i,m=r[a+1]*i,y=r[a+2]*i;d+=Math.abs((t[f]-t[y])*(t[m+1]-t[f+1])-(t[f]-t[m])*(t[y+1]-t[f+1]))}return o===0&&d===0?0:Math.abs((d-o)/o)},L$.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,s=0;s<t.length;s++){for(var n=0;n<t[s].length;n++)for(var o=0;o<e;o++)i.vertices.push(t[s][n][o]);s>0&&(r+=t[s-1].length,i.holes.push(r))}return i};function cIe(t,e,i){const r=Math.sin(t),s=Math.cos(t),n=Math.sin(e),o=Math.cos(e),a=i;return a[0]=-r,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*r,a[9]=o*r,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function plt(t,e,i){return cIe(t,e,i),dc(i,i),i}function VS(t,e,i,r){const s=wEe(t,r);if(s==null)return!1;const n=s.source.spatialReferenceId,o=s.dest.spatialReferenceId;if(n===o&&!CH(o)&&(n!==K.UNKNOWN||rs(t,r)))return Zte(i,e),!0;if(CH(o)){const l=mO[n][K.LON_LAT],c=mO[K.LON_LAT][o];return l!=null&&c!=null&&(l(e,0,e0,0),c(e0,0,t0,0),cIe(cN*e0[0],cN*e0[1],i),i[12]=t0[0],i[13]=t0[1],i[14]=t0[2],!0)}const a=CH(n);if((o===K.WEB_MERCATOR||o===K.PLATE_CARREE||o===K.WGS84||o===K.CGCS2000)&&(n===K.WGS84||a||n===K.WEB_MERCATOR||n===K.CGCS2000)){const l=mO[n][K.LON_LAT],c=mO[K.LON_LAT][o];return l!=null&&c!=null&&(l(e,0,e0,0),c(e0,0,t0,0),a?plt(cN*e0[0],cN*e0[1],i):pf(i),i[12]=t0[0],i[13]=t0[1],i[14]=t0[2],!0)}return!1}function CH(t){return t===K.SPHERICAL_ECEF||t===K.SPHERICAL_MARS_PCPF||t===K.SPHERICAL_MOON_PCPF||t===K.WGS84_ECEF}const cN=wt(1),e0=$(),t0=$();function lS(t){if(Array.isArray(t)){if(t.length<rh)return t}else if(t.length<rh)return Array.from(t);let e=!0,i=!0;return t.some((r,s)=>(e=e&&r===0,i=i&&r===s,!e&&!i)),e?OD(t.length):i?MD(t.length):j3(t)&&t.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT?t:flt(t)}function flt(t){let e=!0;for(const i of t){if(i>=65536)return j3(t)?t:new Uint32Array(t);i>=256&&(e=!1)}return e?new Uint8Array(t):new Uint16Array(t)}function e3(t){return t<=rh?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}function RYt(t){return t<=rh?new Array(t):new Uint32Array(t)}let rI=bre(131072);const uIe=[0],$H=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function MD(t){return t===1?uIe:t<rh?Array.from(new Uint16Array($H.buffer,0,t)):t<$H.length?new Uint16Array($H.buffer,0,t):(t>rI.length&&(rI=bre(Math.max(2*rI.length,t))),new Uint32Array(rI.buffer,0,t))}function bre(t){const e=new Uint32Array(t);for(let i=0;i<e.length;i++)e[i]=i;return e}let sI=new Uint8Array(65536);function OD(t){if(t===1)return uIe;if(t<rh)return new Array(t).fill(0);if(t>sI.length){const e=Math.max(2*sI.length,t);sI=new Uint8Array(e)}return new Uint8Array(sI.buffer,0,t)}function mlt(){rI=bre(131072),sI=new Uint8Array(65536)}function glt(t,e,i){$j(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function $j(t,e,i,r=3,s=r){if(t.length/r!==Math.ceil(e.length/s))return t;const n=t.length/r,o=i[0],a=i[1],l=i[2],c=i[4],h=i[5],d=i[6],f=i[8],m=i[9],y=i[10],v=i[12],_=i[13],b=i[14];let w=0,x=0;for(let S=0;S<n;S++){const C=e[w],T=e[w+1],M=e[w+2];t[x]=o*C+c*T+f*M+v,t[x+1]=a*C+h*T+m*M+_,t[x+2]=l*C+d*T+y*M+b,w+=s,x+=r}return t}function hIe(t,e,i){dIe(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function dIe(t,e,i,r=3,s=r){if(t.length/r!==Math.ceil(e.length/s))return;const n=t.length/r,o=i[0],a=i[1],l=i[2],c=i[3],h=i[4],d=i[5],f=i[6],m=i[7],y=i[8];let v=0,_=0;for(let b=0;b<n;b++){const w=e[v],x=e[v+1],S=e[v+2];t[_]=o*w+c*x+f*S,t[_+1]=a*w+h*x+m*S,t[_+2]=l*w+d*x+y*S,v+=s,_+=r}}function ylt(t,e,i){pIe(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function pIe(t,e,i,r=3,s=r){const n=Math.min(t.length/r,e.length/s);let o=0,a=0;for(let l=0;l<n;l++)t[a]=i*e[o],t[a+1]=i*e[o+1],t[a+2]=i*e[o+2],o+=s,a+=r;return t}function vlt(t,e,i,r){fIe(t.typedBuffer,e.typedBuffer,i,r,t.typedBufferStride,e.typedBufferStride)}function fIe(t,e,i,r,s=3,n=s){const o=Math.min(t.length/s,e.length/n);let a=0,l=0;const c=1/iU;for(let h=0;h<o;h++)t[l]=r*(i*e[a])**c,t[l+1]=r*(i*e[a+1])**c,t[l+2]=r*(i*e[a+2])**c,a+=n,l+=s}function _lt(t,e,i,r=3,s=r){const n=t.length/r;if(n!==Math.ceil(e.length/s))return t;let o=0,a=0;for(let l=0;l<n;l++)t[a]=e[o]+i[0],t[a+1]=e[o+1]+i[1],t[a+2]=e[o+2]+i[2],o+=s,a+=r;return t}function blt(t,e){mIe(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function mIe(t,e,i=3,r=i){const s=Math.min(t.length/i,e.length/r);let n=0,o=0;for(let a=0;a<s;a++){const l=e[n],c=e[n+1],h=e[n+2],d=l*l+c*c+h*h;if(d>0){const f=1/Math.sqrt(d);t[o]=f*l,t[o+1]=f*c,t[o+2]=f*h}n+=r,o+=i}}function wlt(t,e,i){const r=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;let l=0,c=0;for(let h=0;h<r;h++)s[c]=o[l]>>i,s[c+1]=o[l+1]>>i,s[c+2]=o[l+2]>>i,l+=a,c+=n}Object.freeze(Object.defineProperty({__proto__:null,linearToSRGB:fIe,linearToSRGBView:vlt,normalize:mIe,normalizeView:blt,scale:pIe,scaleView:ylt,shiftRight:wlt,transformMat3:dIe,transformMat3View:hIe,transformMat4:$j,transformMat4View:glt,translate:_lt},Symbol.toStringTag,{value:"Module"}));const N$={unknown:1,inches:pr(1,"meters","inches"),feet:pr(1,"meters","feet"),"us-feet":pr(1,"meters","us-feet"),yards:pr(1,"meters","yards"),miles:pr(1,"meters","miles"),"nautical-miles":pr(1,"meters","nautical-miles"),millimeters:pr(1,"meters","millimeters"),centimeters:pr(1,"meters","centimeters"),decimeters:pr(1,"meters","decimeters"),meters:pr(1,"meters","meters"),kilometers:pr(1,"meters","kilometers"),"decimal-degrees":1/h6e(1,"meters",xi.radius)};function xlt(t){return!!t&&N$[t]!=null}function gIe(t){return 1/(N$[t]||1)}function Slt(){const t=Object.keys(N$);return U3(t,"decimal-degrees"),t.sort(),t}const Tlt=Slt();function jS(t,e,i,r){return{x:t,y:e,z:i,hasZ:i!=null,hasM:!1,spatialReference:r,type:"point"}}function PYt(t,e,i,r,s){t.x=e,t.y=i,t.z=r,t.hasZ=r!=null,t.spatialReference=s}function yIe(t){return"declaredClass"in t}function bde(t){return"declaredClass"in t}function Elt(t){return"declaredClass"in t}function Clt(t,e){return t?Elt(t)?t:new Ml({layer:e,sourceLayer:e,visible:t.visible,symbol:q(t.symbol),attributes:q(t.attributes),geometry:vIe(t.geometry)}):null}function vIe(t){return t==null?null:yIe(t)?t:af($lt(t))}function $lt(t){const{wkid:e,wkt:i,wkt2:r,latestWkid:s}=t.spatialReference,n={wkid:e,wkt:i,wkt2:r,latestWkid:s};switch(t.type){case"point":{const{x:o,y:a,z:l,m:c}=t;return{x:o,y:a,z:l,m:c,spatialReference:n}}case"polygon":{const{rings:o,hasZ:a,hasM:l}=t;return{rings:wde(o),hasZ:a,hasM:l,spatialReference:n}}case"polyline":{const{paths:o,hasZ:a,hasM:l}=t;return{paths:wde(o),hasZ:a,hasM:l,spatialReference:n}}case"extent":{const{xmin:o,xmax:a,ymin:l,ymax:c,zmin:h,zmax:d,mmin:f,mmax:m,hasZ:y,hasM:v}=t;return{xmin:o,xmax:a,ymin:l,ymax:c,zmin:h,zmax:d,mmin:f,mmax:m,hasZ:y,hasM:v,spatialReference:n}}case"multipoint":{const{points:o,hasZ:a,hasM:l}=t;return{points:bIe(o)?_Ie(o):o,hasZ:a,hasM:l,spatialReference:n}}default:return}}function wde(t){return Alt(t)?t.map(e=>_Ie(e)):t}function _Ie(t){return t.map(e=>Array.from(e))}function Alt(t){for(const e of t)if(e.length!==0)return bIe(e);return!1}function bIe(t){return t.length>0&&(B3(t[0])||V3(t[0]))}function Mlt(t,e){if(!t)return null;let i;if(bde(t)){if(e==null)return t.clone();if(bde(e))return e.copy(t)}return e!=null?(i=e,i.x=t.x,i.y=t.y,i.spatialReference=t.spatialReference,t.hasZ?(i.z=t.z,i.hasZ=t.hasZ):(i.z=void 0,i.hasZ=!1),t.hasM?(i.m=t.m,i.hasM=!0):(i.m=void 0,i.hasM=!1)):(i=jS(t.x,t.y,t.z,t.spatialReference),t.hasM&&(i.m=t.m,i.hasM=!0)),i}function DYt(t){const{wkid:e,wkt:i,wkt2:r,latestWkid:s}=t,n={wkid:e,wkt:i,wkt2:r,latestWkid:s};return Ae.fromJSON(n)}const Olt=()=>J.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function Ilt(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function LYt(t){const e=t?.expression;if(typeof e=="string"){const i=TIe(e);if(i!=null)return{cachedResult:i}}return null}async function NYt(t,e,i,r){const s=t?.expression;if(typeof s!="string")return null;const n=TIe(s);if(n!=null)return{cachedResult:n};const o=await av();gt(i);const a=o.arcadeUtils,l=a.createSyntaxTree(s);return a.dependsOnView(l)?(r?.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:e}),modules:o}}}function wIe(t,e,i){return t.arcadeUtils.createFeature(e.attributes,e.geometry,i)}function xIe(t,e){if(t!=null&&!SIe(t)){if(!e||!t.arcade)return void Olt().errorOncePerTick("Arcade support required but not provided");const i=e;i._geometry&&(i._geometry=vIe(i._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function Rlt(t){if(t!=null){if(SIe(t))return t.cachedResult;const e=t.arcade;let i=e?.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof i!="number"&&(t.cachedResult=0,i=0),i}return 0}function FYt(t,e=!1){let i=t?.featureExpressionInfo;const r=i?.expression;return e||r==="0"||(i=null),i??null}const Plt={cachedResult:0};function SIe(t){return t.cachedResult!=null}function TIe(t){return t==="0"?0:null}let RU=class EIe{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=gIe(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,i){const r=this.calculateOffsetRenderUnits(i);return this.featureExpressionInfoContext!=null?r:e+r}calculateOffsetRenderUnits(e){let i=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return r!=null&&(i+=Rlt(r)*this._metersPerElevationInfoUnit),i/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=xlt(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,i,r){if(e==null)return void(this._featureExpressionInfoContext=null);const s=e?.arcade;s&&i!=null&&r!=null?(this._featureExpressionInfoContext=Ilt(e),xIe(this._featureExpressionInfoContext,wIe(s.modules,i,r))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const i=new EIe;return e!=null&&i.setFromElevationInfo(e),i}};function Dlt(t,e,i){return{objectId:t,target:e,distance:i,type:"vertex"}}function xde(t,e,i,r,s,n=!1){return{objectId:t,target:e,distance:i,type:"edge",start:r,end:s,draped:n}}let wre=class{constructor(e,i){this.renderer=e,this.symbol=i}};var Zy,Ho;function V2(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function t3(t){return t!=null&&!isNaN(t)&&isFinite(t)}function CIe(t){return t.valueExpression?Zy.Expression:t.field&&typeof t.field=="string"?Zy.Field:Zy.Unknown}function Llt(t,e){const i=e||CIe(t),r=t.valueUnit||"unknown";return i===Zy.Unknown?Ho.Constant:t.stops?Ho.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?Ho.ClampedLinear:r==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?Ho.Proportional:Ho.Additive:Ho.Identity:Ho.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(Zy||(Zy={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(Ho||(Ho={}));const $Ie=()=>J.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),Aj=t=>$Ie().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${t}`),Mj=()=>$Ie().error("Use of arcade expressions requires an arcade context"),Sde=new Ml,O4=Math.PI,AIe=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function MIe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(y=>y.type==="color"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void Aj("ColorVariable");const s=typeof e=="number",n=s?null:e,o=n?.attributes;let a=s?e:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let d=r.cache.compiledFunc;if(!l&&!h){const y=r.stops;return y&&y[0]&&y[0].color}if(typeof a!="number")if(h){if(i?.arcade==null)return void Mj();const y={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},v=i.arcade.arcadeUtils,_=v.getViewInfo(y),b=v.createExecContext(n,_,i.timeZone);if(!d){const w=v.createSyntaxTree(r.valueExpression);d=v.createFunction(w),r.cache.compiledFunc=d}a=v.executeFunction(d,b)}else o&&(a=o[l]);const f=r.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const y=Sre(a,c);if(y){const v=y[0],_=y[1],b=v===_?r.stops[v].color:qe.blendColors(r.stops[v].color,r.stops[_].color,y[2],i?.color);return new qe(b)}}}function OIe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(y=>y.type==="opacity"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void Aj("OpacityVariable");const s=typeof e=="number",n=s?null:e,o=n?.attributes;let a=s?e:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let d=r.cache.compiledFunc;if(!l&&!h){const y=r.stops;return y&&y[0]&&y[0].opacity}if(typeof a!="number")if(h){if(i?.arcade==null)return void Mj();const y={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},v=i.arcade.arcadeUtils,_=v.getViewInfo(y),b=v.createExecContext(n,_,i.timeZone);if(!d){const w=v.createSyntaxTree(r.valueExpression);d=v.createFunction(w),r.cache.compiledFunc=d}a=v.executeFunction(d,b)}else o&&(a=o[l]);const f=r.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const y=Sre(a,c);if(y){const v=y[0],_=y[1];if(v===_)return r.stops[v].opacity;{const b=r.stops[v].opacity;return b+(r.stops[_].opacity-b)*y[2]}}}}function IIe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(m=>m.type==="rotation"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void Aj("RotationVariable");const s=r.axis||"heading",n=s==="heading"&&r.rotationType==="arithmetic"?90:0,o=s==="heading"&&r.rotationType==="arithmetic"?-1:1,a=typeof e=="number"?null:e,l=a?.attributes,c=r.field,{hasExpression:h}=r.cache;let d=r.cache.compiledFunc,f=0;if(!c&&!h)return f;if(h){if(i?.arcade==null)return void Mj();const m={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},y=i.arcade.arcadeUtils,v=y.getViewInfo(m),_=y.createExecContext(a,v,i.timeZone);if(!d){const b=y.createSyntaxTree(r.valueExpression);d=y.createFunction(b),r.cache.compiledFunc=d}f=y.executeFunction(d,_)}else l&&(f=l[c]||0);return f=typeof f!="number"||isNaN(f)?null:n+o*f,f}function Nlt(t,e,i){const r=typeof e=="number",s=r?null:e,n=s?.attributes;let o=r?e:null;const{isScaleDriven:a}=t.cache;let l=t.cache.compiledFunc;if(a){const h=i?.scale,d=i?.view;o=h==null||d==="3d"?Flt(t):h}else if(!r)switch(t.inputValueType){case Zy.Expression:{if(i?.arcade==null)return void Mj();const h={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},d=i.arcade.arcadeUtils,f=d.getViewInfo(h),m=d.createExecContext(s,f,i.timeZone);if(!l){const y=d.createSyntaxTree(t.valueExpression);l=d.createFunction(y),t.cache.compiledFunc=l}o=d.executeFunction(l,m);break}case Zy.Field:n&&(o=n[t.field]);break;case Zy.Unknown:o=null}if(!t3(o))return null;if(r||!t.normalizationField)return o;const c=n?parseFloat(n[t.normalizationField]):null;return t3(c)&&c!==0?o/c:null}function Flt(t){let e=null,i=null;const r=t.stops;return r?(e=r[0].value,i=r[r.length-1].value):(e=t.minDataValue||0,i=t.maxDataValue||0),(e+i)/2}function Oj(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(n=>n.type==="size"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void Aj("SizeVariable");const s=PIe(Nlt(r,e,i),r,e,i,r.cache.ipData);return s==null||isNaN(s)?0:s}function Kc(t,e,i){return t==null?null:V2(t)?Oj(t,e,i):t3(t)?t:null}function RIe(t,e,i){return t3(i)&&t>i?i:t3(e)&&t<e?e:t}function klt(t,e,i,r){return t+((Kc(e.minSize,i,r)||e.minDataValue)??0)}function zlt(t,e,i){const r=t.stops;let s=r?.length&&r[0].size;return s==null&&(s=t.minSize),Kc(s,e,i)}function Ult(t,e,i,r){const s=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),n=Kc(e.minSize,i,r),o=Kc(e.maxSize,i,r),a=r?.shape;if(t<=e.minDataValue)return n;if(t>=e.maxDataValue)return o;if(n==null||o==null)return null;if(e.scaleBy==="area"&&a){const l=a==="circle",c=l?O4*(n/2)**2:n*n,h=c+s*((l?O4*(o/2)**2:o*o)-c);return l?2*Math.sqrt(h/O4):Math.sqrt(h)}return n+s*(o-n)}function Blt(t,e,i,r){const s=r?.shape,n=t/e.minDataValue,o=Kc(e.minSize,i,r),a=Kc(e.maxSize,i,r);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,RIe(l,o,a)}function Vlt(t,e,i,r,s){const[n,o,a]=Sre(t,s);if(n===o)return Kc(e.stops?.[n].size,i,r);{const l=Kc(e.stops?.[n].size,i,r);return l+(Kc(e.stops?.[o].size,i,r)-l)*a}}function jlt(t,e,i,r){const s=(r?.resolution??1)*N$[e.valueUnit],n=Kc(e.minSize,i,r),o=Kc(e.maxSize,i,r),{valueRepresentation:a}=e;let l=null;return l=a==="area"?2*Math.sqrt(t/O4)/s:a==="radius"||a==="distance"?2*t/s:t/s,RIe(l,n,o)}function PIe(t,e,i,r,s){switch(e.transformationType){case Ho.Additive:return klt(t,e,i,r);case Ho.Constant:return zlt(e,i,r);case Ho.ClampedLinear:return Ult(t,e,i,r);case Ho.Proportional:return Blt(t,e,i,r);case Ho.Stops:return Vlt(t,e,i,r,s);case Ho.RealWorldSize:return jlt(t,e,i,r);case Ho.Identity:return t;case Ho.Unknown:return null}}function Glt(t,e,i){const{isScaleDriven:r}=t.cache;if(!(r&&i==="3d"||e))return null;const s={scale:e,view:i};let n=Kc(t.minSize,Sde,s),o=Kc(t.maxSize,Sde,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function xre(t,e,i){if(!t.visualVariables)return;const r=[],s=[],n=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=MIe(l,e,i);r.push({variable:l,value:c})}),n.forEach(l=>{const c=OIe(l,e,i);r.push({variable:l,value:c})}),a.forEach(l=>{const c=IIe(l,e,i);r.push({variable:l,value:c})}),o.forEach(l=>{const c=Oj(l,e,i);r.push({variable:l,value:c})}),r.filter(l=>l.value!=null)}function Sre(t,e){if(!e)return;let i=0,r=e.length-1;return e.some((s,n)=>t<s?(r=n,!0):(i=n,!1)),[i,r,(t-e[i])/(e[r]-e[i])]}function Hlt(t,e,i){const r=["proportional","proportional","proportional"];for(const s of t){const n=s.useSymbolValue?"symbol-value":Oj(s,e,i);switch(s.axis){case"width":r[0]=n;break;case"depth":r[1]=n;break;case"height":r[2]=n;break;case"width-and-depth":r[0]=n,r[1]=n;break;case"all":case void 0:case null:r[0]=n,r[1]=n,r[2]=n;break;default:s.axis}}return r}const zYt=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:Hlt,getColor:MIe,getOpacity:OIe,getRotationAngle:IIe,getSize:Oj,getSizeForValue:PIe,getSizeFromNumberOrVariable:Kc,getSizeRangeAtScale:Glt,getVisualVariableValues:xre,viewScaleRE:AIe},Symbol.toStringTag,{value:"Module"}));function qlt(t,e){if(t.symbol!=null)return t.symbol;const i=e?.renderer;return i!=null&&i.type!=="dot-density"?i.getSymbol(t,e):null}function UYt(t,e){const i=qlt(t,e);if(i==null)return null;const r=e?.renderer,s=new wre(r,i);if(r==null||!("visualVariables"in r)||!r.visualVariables)return s;const n=xre(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)switch(a.type){case"color":s.color=l.toRgba();break;case"size":if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=h;break;case"depth":o[1]=h;break;case"height":o[2]=h;break;case"width-and-depth":o[0]=o[1]=h;break;default:o[0]=o[1]=o[2]=h}}break;case"opacity":s.opacity=l;break;case"rotation":switch(a.axis){case"tilt":s.tilt=l;break;case"roll":s.roll=l;break;default:s.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function Wlt(t,e){return t.symbol!=null?t.symbol:e?.renderer?.getSymbolAsync(t,e)??null}async function BYt(t,e){const i=await Wlt(t,e);if(!i)return null;const r=e?.renderer,s=new wre(r,i);if(!r||!("visualVariables"in r)||!r.visualVariables)return s;const n=xre(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)if(a.type==="color")s.color=qe.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=h:c==="depth"?o[1]=h:c==="height"?o[2]=h:o[0]=o[1]=c==="width-and-depth"?h:o[2]=h}else a.type==="opacity"?s.opacity=l:a.type==="rotation"&&a.axis==="tilt"?s.tilt=l:a.type==="rotation"&&a.axis==="roll"?s.roll=l:a.type==="rotation"&&(s.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function Zlt(t,e=0){const i=t[e];return typeof i=="number"&&isFinite(i)?i:null}function VYt(t){for(let e=0;e<3;e++){const i=t[e];if(typeof i=="number")return isFinite(i)?i:0}return 0}function PU(t){return t.type==="point"}let DIe=class{constructor(e,i=null,r=0){this.array=e,this.spatialReference=i,this.offset=r}};function LIe(t){return"array"in t}function Tm(t,e,i="ground"){if(PU(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,i);if(LIe(e)){let r=e.offset;return t.getElevation(e.array[r++],e.array[r++],e.array[r]||0,e.spatialReference??t.spatialReference,i)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,i)}var z;function Ylt(t){return t===z.POSITION}(function(t){t.POSITION="position",t.NORMAL="normal",t.NORMALCOMPRESSED="normalCompressed",t.UV0="uv0",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.ROTATION="rotation",t.TANGENT="tangent",t.OFFSET="offset",t.PERSPECTIVEDIVIDE="perspectiveDivide",t.CENTEROFFSETANDDISTANCE="centerOffsetAndDistance",t.LENGTH="length",t.PREVPOSITION="prevPosition",t.NEXTPOSITION="nextPosition",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.INSTANCEMODELORIGINHI="instanceModelOriginHi",t.INSTANCEMODELORIGINLO="instanceModelOriginLo",t.INSTANCEMODEL="instanceModel",t.INSTANCEMODELNORMAL="instanceModelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMAL2COMPRESSED="normal2Compressed",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.START_UP="startUp",t.END_UP="endUp",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})(z||(z={}));function Jlt(t,e,i,r,s,n,o,a,l,c,h){const d=rct[h.mode];let f,m,y=0;if(Bn(t,e,i,r,l.spatialReference,s,a))return d?.requiresAlignment(h)?(y=d.applyElevationAlignmentBuffer(r,s,n,o,a,l,c,h),f=n,m=o):(f=r,m=s),Bn(f,l.spatialReference,m,n,c.spatialReference,o,a)?y:void 0}function Tre(t,e,i,r,s){const n=(PU(t)?t.z:LIe(t)?t.array[t.offset+2]:t[2])||0;switch(i.mode){case"on-the-ground":{const o=Tm(e,t,"ground")??0;return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=Tm(e,t,"ground")??0,a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=Tm(e,t,"scene")??0,a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=i.geometryZWithOffset(n,r),a=Tm(e,t,"ground")??0;return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return void(s.z=0)}}function GYt(t,e,i,r){return Tre(t,e,i,r,j2),j2.z}function Xlt(t,e,i){return e==="on-the-ground"&&i==="on-the-ground"?t.staysOnTheGround:e===i||e!=="on-the-ground"&&i!=="on-the-ground"?e==null||i==null?t.definedChanged:Fm.UPDATE:t.onTheGroundChanged}function Tde(t){return t==="relative-to-ground"||t==="relative-to-scene"}function Ede(t){return t!=="absolute-height"}function NIe(t,e,i,r,s){Tre(e,i,s,r,j2),FIe(t,j2.verticalDistanceToGround);const n=j2.sampledElevation,o=mn(sct,t.transformation);return uN[0]=e.x,uN[1]=e.y,uN[2]=j2.z,VS(e.spatialReference,uN,o,r.spatialReference)?t.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function FIe(t,e){for(let i=0;i<t.geometries.length;++i){const r=t.geometries[i].getMutableAttribute(z.CENTEROFFSETANDDISTANCE);r&&r.data[3]!==e&&(r.data[3]=e,t.geometryVertexAttributeUpdated(t.geometries[i],z.CENTEROFFSETANDDISTANCE))}}function Klt(t,e,i,r,s,n){let o=0;const a=n.spatialReference;e*=3,r*=3;for(let l=0;l<s;++l){const c=t[e],h=t[e+1],d=t[e+2],f=n.getElevation(c,h,d,a,"ground")??0;o+=f,i[r]=c,i[r+1]=h,i[r+2]=f,e+=3,r+=3}return o/s}function Qlt(t,e,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,d=n.spatialReference;e*=3,r*=3;for(let f=0;f<s;++f){const m=t[e],y=t[e+1],v=t[e+2],_=n.getElevation(m,y,v,d,"ground")??0;l+=_,i[r]=m,i[r+1]=y,i[r+2]=h==null?v+_+c:_+c,e+=3,r+=3}return l/s}function ect(t,e,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,d=n.spatialReference;e*=3,r*=3;for(let f=0;f<s;++f){const m=t[e],y=t[e+1],v=t[e+2],_=n.getElevation(m,y,v,d,"scene")??0;l+=_,i[r]=m,i[r+1]=y,i[r+2]=h==null?v+_+c:_+c,e+=3,r+=3}return l/s}function tct(t){const e=t.meterUnitOffset,i=t.featureExpressionInfoContext;return e!==0||i!=null}function ict(t,e,i,r,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;e*=3,r*=3;for(let h=0;h<s;++h){const d=t[e],f=t[e+1],m=t[e+2];i[r]=d,i[r+1]=f,i[r+2]=c==null?m+l:l,e+=3,r+=3}return 0}let Ere=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var Fm;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(Fm||(Fm={}));const rct={"absolute-height":{applyElevationAlignmentBuffer:ict,requiresAlignment:tct},"on-the-ground":{applyElevationAlignmentBuffer:Klt,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:Qlt,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:ect,requiresAlignment:()=>!0}},sct=Ve(),j2=new Ere,uN=$();var AY;let DE=AY=class extends Dt.ClonableMixin(ee){constructor(t){super(t),this.type="georeferenced",this.origin=null}};DE.absolute=new AY,u([Ue({georeferenced:"georeferenced"},{readOnly:!0})],DE.prototype,"type",void 0),u([p({type:[Number],nonNullable:!1,json:{write:!0}})],DE.prototype,"origin",void 0),DE=AY=u([A("esri.geometry.support.MeshGeoreferencedVertexSpace")],DE);const nct=DE;let nI=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.type="local",this.origin=$()}};u([Ue({local:"local"},{readOnly:!0})],nI.prototype,"type",void 0),u([p({type:[Number],nonNullable:!0,json:{write:!0}})],nI.prototype,"origin",void 0),nI=u([A("esri.geometry.support.MeshLocalVertexSpace")],nI);const oct=nI;function WYt(t){return t.origin==null}function kIe(t){return t.origin!=null}function ZYt(t){return kIe(t.vertexSpace)}function act(t,e){if(!kIe(t))return null;const[i,r,s]=t.origin;return new ke({x:i,y:r,z:s,spatialReference:e})}function YYt(t,e){const{x:i,y:r,z:s,spatialReference:n}=t,o=[i,r,s??0];return(e?.vertexSpace??lct(n))==="local"?new oct({origin:o}):new nct({origin:o})}function lct(t){return t.isGeographic||t.isWebMercator?"local":"georeferenced"}function JYt(t,e){return t.type===e.type&&(t.origin===e.origin||t.origin!=null&&e.origin!=null&&Qn(t.origin,e.origin))}function Ij(t,e){if(t.type==="point")return i0(t,e,!1);if(yIe(t))switch(t.type){case"extent":return i0(t.center,e,!1);case"polygon":return i0(t.centroid,e,!1);case"polyline":return i0(Cde(t),e,!0);case"mesh":return i0(act(t.vertexSpace,t.spatialReference)??t.extent.center,e,!1);case"multipoint":return}else switch(t.type){case"extent":return i0(cct(t),e,!0);case"polygon":return i0(uct(t),e,!0);case"polyline":return i0(Cde(t),e,!0);case"multipoint":return}}function Cde(t){const e=t.paths[0];if(!e||e.length===0)return null;const i=ASe(e,$Se(e)/2);return jS(i[0],i[1],i[2],t.spatialReference)}function cct(t){return jS(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function uct(t){const e=t.rings[0];if(!e||e.length===0)return null;const i=ISe(t.rings,!!t.hasZ);return jS(i[0],i[1],i[2],t.spatialReference)}function i0(t,e,i){const r=i?t:Mlt(t);return e&&t?LEe(t,r,e)?r:null:r}function XYt(t){if(!t)return 0;switch(t.type){case"point":return t.z;case"extent":return t.zmax;case"polygon":return t.hasZ?t.rings.reduce((e,i)=>i.reduce((r,s)=>Math.max(r,s[2]),e),-1/0):void 0;case"polyline":return t.hasZ?t.paths.reduce((e,i)=>i.reduce((r,s)=>Math.max(r,s[2]),e),-1/0):void 0;case"mesh":return t.extent.zmax;case"multipoint":return}}function KYt(t,e,i,r=0){if(t){e||(e=Qt());const s=t;let n=.5*s.width*(i-1),o=.5*s.height*(i-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),es(e,s.xmin-n-r,s.ymin-o-r,s.xmax+n+r,s.ymax+o+r),e}return null}function AH(t,e,i=null){const r=vj(tre);return t!=null&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),e!=null?r[3]=e:t!=null&&t.length>3&&(r[3]=t[3]),i&&(r[0]*=i,r[1]*=i,r[2]*=i,r[3]*=i),r}function QYt(t,e,i,r,s,n){for(let o=0;o<3;++o)n[o]=t?.[o]!=null?t[o]:i?.[o]!=null?i[o]:s[o];return n[3]=e??r??s[3],n}function eJt(t=Rte,e,i,r=1){const s=new Array(3);if(e==null||i==null)s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=t[a],c=l!=null,h=a===0&&!n&&!c,d=i[a];let f;l==="symbol-value"||h?f=d!==0?e[a]/d:1:c&&l!=="proportional"&&isFinite(l)&&(f=d!==0?l/d:1),f!=null&&(s[a]=f,n=f,o=Math.max(o,Math.abs(f)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=r;return p$(s)}function hct(t){return t.isPrimitive!=null}function dct(t){return pct(hct(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function pct(t){const e=i=>i==null||i>=0;return Array.isArray(t)?t.every(e):e(t)}function tJt(t,e,i,r=Ve()){return t&&w$(r,r,-t/180*Math.PI),e&&b$(r,r,e/180*Math.PI),i&&VV(r,r,i/180*Math.PI),r}function fct(t,e,i){if(i.minDemResolution!=null)return i.minDemResolution;const r=Ao(e),s=IS(t)*r,n=RS(t)*r,o=Gb(t)*(e.isGeographic?1:r);return s===0&&n===0&&o===0?i.minDemResolutionForPoints:.01*Math.max(s,n,o)}var Tl,F$,bt,Mb,oh,cS,Dn,q_;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})(Tl||(Tl={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(F$||(F$={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(bt||(bt={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(Mb||(Mb={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(oh||(oh={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee"}(cS||(cS={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(Dn||(Dn={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(q_||(q_={}));var td;(function(t){t[t.TRANSPARENT=0]="TRANSPARENT",t[t.OPAQUE=1]="OPAQUE"})(td||(td={}));let mct=class{constructor(e,i,r){this.baseMaterial=e,this.edgeMaterial=i,this.hasSlicePlane=r}},Cre=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,i,r,s,n,o,a,l=null){this.graphics3DSymbolLayer=e,this.stageObject=i,this._uniqueGeometries=r,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const i=e.stage;i.addMany(this._uniqueMaterials),i.addMany(this._uniqueGeometries),i.add(this.stageObject)}destroy(){if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1),e.renderer.edgeView?.removeObject(this.stageObject),this.stageObject.dispose(),this._sharedResource?.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,i){const{stageObject:r,_edgeState:s,_stageLayer:n}=this;if(s==null)return;const o=$de(s.baseMaterial);s.edgeMaterial.objectTransparency!==o&&(s.edgeMaterial.objectTransparency=o,this.resetEdgeObject(i)),n.stage.renderer.withEdgeView(a=>a.updateAllComponentOpacities(r,[e]))}updateHighlights(e){}slicePlaneEnabledChanged(e,i){const{stageObject:r,_edgeState:s,_stageLayer:n}=this;s!=null&&n.stage.renderer.withEdgeView(o=>{o.updateAllComponentMaterials(r,s.edgeMaterial,e,!i),s.hasSlicePlane=e})}setVisibility(e){const{_edgeState:i,stageObject:r,_stageLayer:s}=this;s!=null&&this.visible!==e&&(this._visible=e,r.visible=e,e&&!this._addedToStage&&(s.add(r),this._addedToStage=!0),i!=null&&s.stage.renderer.withEdgeView(n=>{n.hasObject(r)?n.updateObjectVisibility(r,e):e&&this._addOrUpdateEdgeObject(i,n,!1)}))}get visible(){return this._visible}alignWithElevation(e,i,r,s){if(this.elevationAligner==null)return;r!=null&&xIe(this.elevationContext.featureExpressionInfoContext,r);const n=(o,a)=>Tre(o,e,this.elevationContext,i,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,i),this.resetEdgeObject(s)}alignWithAbsoluteElevation(e,i,r){const s=(n,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,s,i),this.resetEdgeObject(r)}getCenterObjectSpace(e=$()){return ne(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=ch()){const i=this.stageObject.boundingVolumeObjectSpace;return zCe(e,i.min),UCe(e,i.max),e}computeAttachmentOrigin(e){const i=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=i[12],e.render.origin[1]+=i[13],e.render.origin[2]+=i[14],e.render.num++;else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(Cg)&&(st(Cg,Cg,i),oe(e.render.origin,e.render.origin,Cg),e.render.num++)}async getProjectedBoundingBox(e,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=gct,l=VCe(o)?1:a.length;for(let h=0;h<l;h++){const d=a[h];r0[0]=o[d[0]],r0[1]=o[d[1]],r0[2]=o[d[2]],st(r0,r0,this.stageObject.transformation),fw[3*h]=r0[0],fw[3*h+1]=r0[1],fw[3*h+2]=r0[2]}if(!e(fw,0,l))return null;ff(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let d=0;d<3;d++)o[d]=Math.min(o[d],fw[h+d]),o[d+3]=Math.max(o[d+3],fw[h+d]);c&&r.push({location:fw.slice(h,h+3),screenSpaceBoundingRect:c})}if(i?.service&&this.elevationContext.mode!=="absolute-height"){uie(o,Cg);const h=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let d=0;if(i.useViewElevation)d=i.service.getElevation(Cg[0],Cg[1],h)??0;else try{const f=fct(o,i.service.spatialReference,i);d=await i.service.queryElevation(Cg[0],Cg[1],s,f,h)??0}catch{}hXe(o,0,0,-this.alignedSampledElevation+d)}return o}addObjectState(e){e.stateType===cS.Highlight&&e.addObject(this.stageObject,this.stageObject.highlight(e.highlightName)),e.stateType===cS.MaskOccludee&&e.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeByObject(this.stageObject)}resetEdgeObject(e){const{_edgeState:i,stageObject:r,_stageLayer:s,_visible:n}=this;i!=null&&s.stage.renderer.withEdgeView(o=>{n?this._addOrUpdateEdgeObject(i,o,e):o.removeObject(r)})}_addOrUpdateEdgeObject(e,i,r){const s=$de(e.baseMaterial);e.edgeMaterial.objectTransparency=s,i.addOrUpdateObject3D(this.stageObject,e.edgeMaterial,e.hasSlicePlane,!r).then(()=>this._stageLayer?.sync())}};function $de(t){return t.parameters.transparent?td.TRANSPARENT:td.OPAQUE}const fw=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r0=$(),Cg=$(),gct=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],yct=3,vct=3,_ct=10;function jc(){return new Float32Array(3)}function MY(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function br(t,e,i){const r=new Float32Array(3);return r[0]=t,r[1]=e,r[2]=i,r}function bct(t,e){return new Float32Array(t,e,3)}function zIe(){return jc()}function UIe(){return br(1,1,1)}function BIe(){return br(1,0,0)}function VIe(){return br(0,1,0)}function jIe(){return br(0,0,1)}const wct=zIe(),xct=UIe(),Sct=BIe(),Tct=VIe(),Ect=jIe();Object.freeze(Object.defineProperty({__proto__:null,ONES:xct,UNIT_X:Sct,UNIT_Y:Tct,UNIT_Z:Ect,ZEROS:wct,clone:MY,create:jc,createView:bct,fromValues:br,ones:UIe,unitX:BIe,unitY:VIe,unitZ:jIe,zeros:zIe},Symbol.toStringTag,{value:"Module"}));function th(t,e=!1){return t<=rh?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function sJt(t){return Array.isArray(t)?t.length<rh?t:new Float32Array(t):t.length<rh?Array.from(t):t}function Ade(t){return(Array.isArray(t)?t.length:t.byteLength/8)<=rh?Array.from(t):new Float32Array(t)}function nJt(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}let Rj=class{constructor(e,i,r=i){this.data=e,this.size=i,this.stride=r}},Wt=class extends Rj{constructor(e,i,r,s=!1,n=r){super(e,r,n),this.indices=i,this.exclusive=s}};var OY;(function(t){function e(o,a){const l=o[a],c=o[a+1],h=o[a+2];return Math.sqrt(l*l+c*c+h*h)}function i(o,a){const l=o[a],c=o[a+1],h=o[a+2],d=1/Math.sqrt(l*l+c*c+h*h);o[a]*=d,o[a+1]*=d,o[a+2]*=d}function r(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,h,d=a){(h=h||o)[d]=o[a]+l[c],h[d+1]=o[a+1]+l[c+1],h[d+2]=o[a+2]+l[c+2]}function n(o,a,l,c,h,d=a){(h=h||o)[d]=o[a]-l[c],h[d+1]=o[a+1]-l[c+1],h[d+2]=o[a+2]-l[c+2]}t.length=e,t.normalize=i,t.scale=r,t.add=s,t.subtract=n})(OY||(OY={}));var Nn;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(Nn||(Nn={}));function Cct(t){if(t.length<rh)return Array.from(t);if(Array.isArray(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return uV(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}const Ka=pi();let $ct=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function jt(t,e="Assertion"){if(!t){const i=new Error(e).stack;throw new $ct(`${e} at ${i}`)}}function _T(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function GIe(t,e,i,r){let s,n=(i[0]-t[0])/e[0],o=(r[0]-t[0])/e[0];n>o&&(s=n,n=o,o=s);let a=(i[1]-t[1])/e[1],l=(r[1]-t[1])/e[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(i[2]-t[2])/e[2],h=(r[2]-t[2])/e[2];return c>h&&(s=c,c=h,h=s),!(n>h||c>o)&&(h<o&&(o=h),!(o<0))}function hN(t,e,i,r,s,n=He()){const o=(r[s]-i[s])*(e[0]-t[0])-(r[0]-i[0])*(e[s]-t[s]),a=(r[0]-i[0])*(t[s]-i[s])-(r[s]-i[s])*(t[0]-i[0]);if(o===0)return!1;const l=a/o;return n[0]=t[0]+l*(e[0]-t[0]),n[1]=t[s]+l*(e[s]-t[s]),!0}function Mde(t,e,i,r,s){Ka[0]=t[0],Ka[1]=t[1],Ka[2]=t[2],Ka[3]=1,Yc(Ka,Ka,e),s.length>2&&(s[2]=-Ka[2]),Yc(Ka,Ka,i),jt(Ka[3]!==0),s[0]=Ka[0]/Ka[3],s[1]=Ka[1]/Ka[3],s[2]=Ka[2]/Ka[3],s[0]=(.5*s[0]+.5)*r[2]+r[0],s[1]=(.5*s[1]+.5)*r[3]+r[1]}function Act(t,e){return Math.log(t)/Math.log(e)}function Mct(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}let HIe=class qIe{constructor(e,i,r){this.primitiveIndices=e,this._numIndexPerPrimitive=i,this.position=r,this._children=void 0,jt(e.length>=1),jt(r.size===3||r.size===4);const{data:s,size:n,indices:o}=r;jt(o.length%this._numIndexPerPrimitive==0),jt(o.length>=e.length*this._numIndexPerPrimitive);const a=e.length;let l=n*o[this._numIndexPerPrimitive*e[0]];mw.clear(),mw.push(l);const c=Le(s[l],s[l+1],s[l+2]),h=is(c);for(let m=0;m<a;++m){const y=this._numIndexPerPrimitive*e[m];for(let v=0;v<this._numIndexPerPrimitive;++v){l=n*o[y+v],mw.push(l);let _=s[l];c[0]=Math.min(_,c[0]),h[0]=Math.max(_,h[0]),_=s[l+1],c[1]=Math.min(_,c[1]),h[1]=Math.max(_,h[1]),_=s[l+2],c[2]=Math.min(_,c[2]),h[2]=Math.max(_,h[2])}}this.bbMin=c,this.bbMax=h;const d=dr($(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(h[0]-c[0],h[1]-c[1]),h[2]-c[2]);let f=this.radius*this.radius;for(let m=0;m<mw.length;++m){l=mw.at(m);const y=s[l]-d[0],v=s[l+1]-d[1],_=s[l+2]-d[2],b=y*y+v*v+_*_;if(b<=f)continue;const w=Math.sqrt(b),x=.5*(w-this.radius);this.radius=this.radius+x,f=this.radius*this.radius;const S=x/w;d[0]+=y*S,d[1]+=v*S,d[2]+=_*S}this.center=d,mw.clear()}getChildren(){if(this._children||ro(this.bbMin,this.bbMax)<=1)return this._children;const e=dr($(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,r=new Uint8Array(i),s=new Array(8);for(let h=0;h<8;++h)s[h]=0;const{data:n,size:o,indices:a}=this.position;for(let h=0;h<i;++h){let d=0;const f=this._numIndexPerPrimitive*this.primitiveIndices[h];let m=o*a[f],y=n[m],v=n[m+1],_=n[m+2];for(let b=1;b<this._numIndexPerPrimitive;++b){m=o*a[f+b];const w=n[m],x=n[m+1],S=n[m+2];w<y&&(y=w),x<v&&(v=x),S<_&&(_=S)}y<e[0]&&(d|=1),v<e[1]&&(d|=2),_<e[2]&&(d|=4),r[h]=d,++s[d]}let l=0;for(let h=0;h<8;++h)s[h]>0&&++l;if(l<2)return;const c=new Array(8);for(let h=0;h<8;++h)c[h]=s[h]>0?new Uint32Array(s[h]):void 0;for(let h=0;h<8;++h)s[h]=0;for(let h=0;h<i;++h){const d=r[h];c[d][s[d]++]=this.primitiveIndices[h]}this._children=new Array;for(let h=0;h<8;++h)c[h]!==void 0&&this._children.push(new qIe(c[h],this._numIndexPerPrimitive,this.position));return this._children}static prune(){mw.prune()}};const mw=new Jt({deallocator:null});let ID=class{constructor(){this.id=_d()}};function Oct(t){return t?{p0:is(t.p0),p1:is(t.p1),p2:is(t.p2)}:{p0:$(),p1:$(),p2:$()}}function uJt(t,e,i){const r=e[0]-t[0],s=e[1]-t[1],n=i[0]-t[0],o=i[1]-t[1];return .5*Math.abs(r*o-s*n)}function Ict(t,e,i){return ye(MH,e,t),ye(Ode,i,t),.5*Te(lt(MH,MH,Ode))}new Ov(Iv);new Ov(()=>Oct());const MH=$(),Ode=$();function Rct(t,e){if(!t)return!1;const{size:i,data:r,indices:s}=t;se(e,0,0,0),se(jh,0,0,0);let n=0,o=0;for(let a=0;a<s.length-2;a+=3){const l=s[a]*i,c=s[a+1]*i,h=s[a+2]*i;se(go,r[l],r[l+1],r[l+2]),se(Ny,r[c],r[c+1],r[c+2]),se(dN,r[h],r[h+1],r[h+2]);const d=Ict(go,Ny,dN);d?(oe(go,go,Ny),oe(go,go,dN),ie(go,go,1/3*d),oe(e,e,go),n+=d):(oe(jh,jh,go),oe(jh,jh,Ny),oe(jh,jh,dN),o+=3)}return(o!==0||n!==0)&&(n!==0?(ie(e,e,1/n),!0):o!==0&&(ie(e,jh,1/o),!0))}function Pct(t,e){if(!t)return!1;const{size:i,data:r,indices:s}=t;se(e,0,0,0);let n=-1,o=0;for(let a=0;a<s.length;a++){const l=s[a]*i;n!==l&&(e[0]+=r[l],e[1]+=r[l+1],e[2]+=r[l+2],o++),n=l}return o>1&&ie(e,e,1/o),o>0}function Dct(t,e,i){if(!t)return!1;se(i,0,0,0),se(jh,0,0,0);let r=0,s=0;const{size:n,data:o,indices:a}=t,l=a.length-1,c=l+(e?2:0);for(let h=0;h<c;h+=2){const d=h<l?h+1:0,f=a[h<l?h:l]*n,m=a[d]*n;go[0]=o[f],go[1]=o[f+1],go[2]=o[f+2],Ny[0]=o[m],Ny[1]=o[m+1],Ny[2]=o[m+2],ie(go,oe(go,go,Ny),.5);const y=za(go,Ny);y>0?(oe(i,i,ie(go,go,y)),r+=y):r===0&&(oe(jh,jh,go),s++)}return r!==0?(ie(i,i,1/r),!0):s!==0&&(ie(i,jh,1/s),!0)}const go=$(),Ny=$(),dN=$(),jh=$();let WIe=class{constructor(){this.uid=_d()}},ZIe=class extends WIe{constructor(e){super(),this.highlightName=e,this.channel=cS.Highlight}},Lct=class extends WIe{constructor(){super(...arguments),this.channel=cS.MaskOccludee}},Ea=class YIe extends ID{constructor(e,i,r=null,s=Nn.Mesh,n=null,o=-1){super(),this.material=e,this.mapPositions=r,this.type=s,this.objectAndLayerIdColor=n,this.edgeIndicesLength=o,this.highlights=new Set,this._highlightOptionsCounts=new Map,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(const[a,l]of i)this._attributes.set(a,{...l,indices:lS(l.indices)}),a===z.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(a).indices.length:this.edgeIndicesLength)}instantiate(e={}){const i=new YIe(e.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach((r,s)=>{r.exclusive=!1,i._attributes.set(s,r)}),i._boundingInfo=this._boundingInfo,i.transformation=e.transformation||this.transformation,i}get attributes(){return this._attributes}getMutableAttribute(e){let i=this._attributes.get(e);return i&&!i.exclusive&&(i={...i,exclusive:!0,data:Cct(i.data)},this._attributes.set(e,i)),i}setAttributeData(e,i){const r=this._attributes.get(e);r&&this._attributes.set(e,{...r,exclusive:!0,data:i})}get indexCount(){return this._attributes.values().next().value?.indices?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===Nn.Mesh?this._computeAttachmentOriginTriangles(e):this.type===Nn.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(this._transformation!=null&&st(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const i=this.attributes.get(z.POSITION);return Rct(i,e)}_computeAttachmentOriginLines(e){const i=this.attributes.get(z.POSITION);return Dct(i,Nct(this.material.parameters,i),e)}_computeAttachmentOriginPoints(e){const i=this.attributes.get(z.POSITION);return Pct(i,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.attributes.get(z.POSITION);if(!e||e.indices.length===0)return null;const i=this.type===Nn.Mesh?3:1;jt(e.indices.length%i==0,"Indexing error: "+e.indices.length+" not divisible by "+i);const r=MD(e.indices.length/i);return new HIe(r,i,e)}get transformation(){return this._transformation??Kn}set transformation(e){this._transformation=e&&e!==Kn?fOe(e):null}get highlightNames(){return this._highlightOptionsCounts}get hasHighlights(){return this._highlightOptionsCounts.size>0}foreachHighlightOptions(e){this._highlightOptionsCounts.forEach((i,r)=>e(r))}allocateIdAndHighlight(e){const i=new ZIe(e);return this.addHighlight(i)}addHighlight(e){this.highlights.add(e);const{highlightName:i}=e,r=(this._highlightOptionsCounts.get(i)??0)+1;return this._highlightOptionsCounts.set(i,r),e}removeHighlight(e){if(this.highlights.delete(e)){const{highlightName:i}=e,r=this._highlightOptionsCounts.get(i)??0;r<=1?this._highlightOptionsCounts.delete(i):this._highlightOptionsCounts.set(i,r-1)}}};function Nct(t,e){return!(!("isClosed"in t)||!t.isClosed)&&e.indices.length>2}const bT=OY,OH=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],Fct=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],kct=[0,0,1,0,1,1,0,1],zct=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],JIe=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)JIe[6*t+e]=t;const y1=new Array(36);for(let t=0;t<6;t++)y1[6*t]=0,y1[6*t+1]=1,y1[6*t+2]=2,y1[6*t+3]=2,y1[6*t+4]=3,y1[6*t+5]=0;function Uct(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(24);for(let r=0;r<8;r++)i[3*r]=OH[r][0]*e[0],i[3*r+1]=OH[r][1]*e[1],i[3*r+2]=OH[r][2]*e[2];return new Ea(t,[[z.POSITION,new Wt(i,zct,3,!0)],[z.NORMAL,new Wt(Fct,JIe,3)],[z.UV0,new Wt(kct,y1,2)]])}const IH=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],Bct=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],Vct=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],jct=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function Gct(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(18);for(let r=0;r<6;r++)i[3*r]=IH[r][0]*e[0],i[3*r+1]=IH[r][1]*e[1],i[3*r+2]=IH[r][2]*e[2];return new Ea(t,[[z.POSITION,new Wt(i,Vct,3,!0)],[z.NORMAL,new Wt(Bct,jct,3)]])}const I4=br(-.5,0,-.5),R4=br(.5,0,-.5),P4=br(0,0,.5),D4=br(0,.5,0),wT=jc(),xT=jc(),AC=jc(),MC=jc(),OC=jc();ye(wT,I4,D4),ye(xT,I4,R4),lt(AC,wT,xT),ae(AC,AC),ye(wT,R4,D4),ye(xT,R4,P4),lt(MC,wT,xT),ae(MC,MC),ye(wT,P4,D4),ye(xT,P4,I4),lt(OC,wT,xT),ae(OC,OC);const RH=[I4,R4,P4,D4],Hct=[0,-1,0,AC[0],AC[1],AC[2],MC[0],MC[1],MC[2],OC[0],OC[1],OC[2]],qct=[0,1,2,3,1,0,3,2,1,3,0,2],Wct=[0,0,0,1,1,1,2,2,2,3,3,3];function Zct(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(12);for(let r=0;r<4;r++)i[3*r]=RH[r][0]*e[0],i[3*r+1]=RH[r][1]*e[1],i[3*r+2]=RH[r][2]*e[2];return new Ea(t,[[z.POSITION,new Wt(i,qct,3,!0)],[z.NORMAL,new Wt(Hct,Wct,3)]])}function fJt(t,e,i,r,s={uv:!0}){const n=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(i)),h=Math.max(2,Math.floor(r)),d=(c+1)*(h+1),f=th(3*d),m=th(3*d),y=th(2*d),v=[];let _=0;for(let x=0;x<=h;x++){const S=[],C=x/h,T=a+C*l,M=Math.cos(T);for(let I=0;I<=c;I++){const P=I/c,D=n+P*o,F=Math.cos(D)*M,L=Math.sin(T),N=-Math.sin(D)*M;f[3*_]=F*e,f[3*_+1]=L*e,f[3*_+2]=N*e,m[3*_]=F,m[3*_+1]=L,m[3*_+2]=N,y[2*_]=P,y[2*_+1]=C,S.push(_),++_}v.push(S)}const b=new Array;for(let x=0;x<h;x++)for(let S=0;S<c;S++){const C=v[x][S],T=v[x][S+1],M=v[x+1][S+1],I=v[x+1][S];x===0?(b.push(C),b.push(M),b.push(I)):x===h-1?(b.push(C),b.push(T),b.push(M)):(b.push(C),b.push(T),b.push(M),b.push(M),b.push(I),b.push(C))}const w=[[z.POSITION,new Wt(f,b,3,!0)],[z.NORMAL,new Wt(m,b,3,!0)]];return s.uv&&w.push([z.UV0,new Wt(y,b,2,!0)]),s.offset&&(w[0][0]=z.OFFSET,w.push([z.POSITION,new Wt(Float64Array.from(s.offset),OD(b.length),3,!0)])),new Ea(t,w)}function Yct(t,e,i,r){const s=XIe(e,i,r);return new Ea(t,s)}function XIe(t,e,i){const r=t;let s,n;if(i)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const c=r*(1+Math.sqrt(5))/2;s=[-r,c,0,r,c,0,-r,-c,0,r,-c,0,0,-r,c,0,r,c,0,-r,-c,0,r,-c,c,0,-r,c,0,r,-c,0,-r,-c,0,r],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let c=0;c<s.length;c+=3)bT.scale(s,c,t/bT.length(s,c));let o={};function a(c,h){c>h&&([c,h]=[h,c]);const d=c.toString()+"."+h.toString();if(o[d])return o[d];let f=s.length;return s.length+=3,bT.add(s,3*c,s,3*h,s,f),bT.scale(s,f,t/bT.length(s,f)),f/=3,o[d]=f,f}for(let c=0;c<e;c++){const h=n.length,d=new Array(4*h);for(let f=0;f<h;f+=3){const m=n[f],y=n[f+1],v=n[f+2],_=a(m,y),b=a(y,v),w=a(v,m),x=4*f;d[x]=m,d[x+1]=_,d[x+2]=w,d[x+3]=y,d[x+4]=b,d[x+5]=_,d[x+6]=v,d[x+7]=w,d[x+8]=b,d[x+9]=_,d[x+10]=b,d[x+11]=w}n=d,o={}}const l=Ade(s);for(let c=0;c<l.length;c+=3)bT.normalize(l,c);return[[z.POSITION,new Wt(Ade(s),n,3,!0)],[z.NORMAL,new Wt(l,n,3,!0)]]}function mJt(t,e={}){const{normal:i,position:r,color:s,rotation:n,size:o,centerOffsetAndDistance:a,uvs:l,featureAttribute:c,objectAndLayerIdColor:h=null}=e,d=r?is(r):$(),f=i?is(i):Le(0,0,1),m=s?[255*s[0],255*s[1],255*s[2],s.length>3?255*s[3]:255]:[255,255,255,255],y=o!=null&&o.length===2?o:[1,1],v=n!=null?[n]:[0],_=OD(1),b=[[z.POSITION,new Wt(d,_,3,!0)],[z.NORMAL,new Wt(f,_,3,!0)],[z.COLOR,new Wt(m,_,4,!0)],[z.SIZE,new Wt(y,_,2)],[z.ROTATION,new Wt(v,_,1,!0)]];if(l&&b.push([z.UV0,new Wt(l,_,l.length)]),a!=null){const w=[a[0],a[1],a[2],a[3]];b.push([z.CENTEROFFSETANDDISTANCE,new Wt(w,_,4)])}if(c){const w=[c[0],c[1],c[2],c[3]];b.push([z.FEATUREATTRIBUTE,new Wt(w,_,4)])}return new Ea(t,b,null,Nn.Point,h)}const Jct=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function gJt(t,e=Jct){const i=new Array(12);for(let c=0;c<4;c++)for(let h=0;h<3;h++)i[3*c+h]=e[c][h];const r=[0,1,2,2,3,0],s=[0,0,1],n=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[z.POSITION,new Wt(i,r,3,!0)],[z.NORMAL,new Wt(s,n,3,!0)],[z.UV0,new Wt(o,r,2,!0)],[z.COLOR,new Wt(a,n,4,!0)]];return new Ea(t,l)}function Xct(t,e,i,r,s=!0,n=!0){let o=0;const a=e,l=t;let c=br(0,o,0),h=br(0,o+l,0),d=br(0,-1,0),f=br(0,1,0);r&&(o=l,h=br(0,0,0),c=br(0,o,0),d=br(0,1,0),f=br(0,-1,0));const m=[h,c],y=[d,f],v=i+2,_=Math.sqrt(l*l+a*a);if(r)for(let C=i-1;C>=0;C--){const T=C*(2*Math.PI/i),M=br(Math.cos(T)*a,o,Math.sin(T)*a);m.push(M);const I=br(l*Math.cos(T)/_,-a/_,l*Math.sin(T)/_);y.push(I)}else for(let C=0;C<i;C++){const T=C*(2*Math.PI/i),M=br(Math.cos(T)*a,o,Math.sin(T)*a);m.push(M);const I=br(l*Math.cos(T)/_,a/_,l*Math.sin(T)/_);y.push(I)}const b=new Array,w=new Array;if(s){for(let C=3;C<m.length;C++)b.push(1),b.push(C-1),b.push(C),w.push(0),w.push(0),w.push(0);b.push(m.length-1),b.push(2),b.push(1),w.push(0),w.push(0),w.push(0)}if(n){for(let C=3;C<m.length;C++)b.push(C),b.push(C-1),b.push(0),w.push(C),w.push(C-1),w.push(1);b.push(0),b.push(2),b.push(m.length-1),w.push(1),w.push(2),w.push(y.length-1)}const x=th(3*v);for(let C=0;C<v;C++)x[3*C]=m[C][0],x[3*C+1]=m[C][1],x[3*C+2]=m[C][2];const S=th(3*v);for(let C=0;C<v;C++)S[3*C]=y[C][0],S[3*C+1]=y[C][1],S[3*C+2]=y[C][2];return[[z.POSITION,new Wt(x,b,3,!0)],[z.NORMAL,new Wt(S,w,3,!0)]]}function Ide(t,e,i,r,s,n=!0,o=!0){return new Ea(t,Xct(e,i,r,s,n,o))}function Kct(t,e,i,r,s,n,o){const a=s?MY(s):br(1,0,0),l=n?MY(n):br(0,0,0);o??=!0;const c=jc();ae(c,a);const h=jc();ie(h,c,Math.abs(e));const d=jc();ie(d,h,-.5),oe(d,d,l);const f=br(0,1,0);Math.abs(1-de(c,f))<.2&&se(f,0,0,1);const m=jc();lt(m,c,f),ae(m,m),lt(f,m,c);const y=2*r+(o?2:0),v=r+(o?2:0),_=th(3*y),b=th(3*v),w=th(2*y),x=new Array(3*r*(o?4:2)),S=new Array(3*r*(o?4:2));o&&(_[3*(y-2)]=d[0],_[3*(y-2)+1]=d[1],_[3*(y-2)+2]=d[2],w[2*(y-2)]=0,w[2*(y-2)+1]=0,_[3*(y-1)]=_[3*(y-2)]+h[0],_[3*(y-1)+1]=_[3*(y-2)+1]+h[1],_[3*(y-1)+2]=_[3*(y-2)+2]+h[2],w[2*(y-1)]=1,w[2*(y-1)+1]=1,b[3*(v-2)]=-c[0],b[3*(v-2)+1]=-c[1],b[3*(v-2)+2]=-c[2],b[3*(v-1)]=c[0],b[3*(v-1)+1]=c[1],b[3*(v-1)+2]=c[2]);const C=(D,F,L)=>{x[D]=F,S[D]=L};let T=0;const M=jc(),I=jc();for(let D=0;D<r;D++){const F=D*(2*Math.PI/r);ie(M,f,Math.sin(F)),ie(I,m,Math.cos(F)),oe(M,M,I),b[3*D]=M[0],b[3*D+1]=M[1],b[3*D+2]=M[2],ie(M,M,i),oe(M,M,d),_[3*D]=M[0],_[3*D+1]=M[1],_[3*D+2]=M[2],w[2*D]=D/r,w[2*D+1]=0,_[3*(D+r)]=_[3*D]+h[0],_[3*(D+r)+1]=_[3*D+1]+h[1],_[3*(D+r)+2]=_[3*D+2]+h[2],w[2*(D+r)]=D/r,w[2*D+1]=1;const L=(D+1)%r;C(T++,D,D),C(T++,D+r,D),C(T++,L,L),C(T++,L,L),C(T++,D+r,D),C(T++,L+r,L)}if(o){for(let D=0;D<r;D++){const F=(D+1)%r;C(T++,y-2,v-2),C(T++,D,v-2),C(T++,F,v-2)}for(let D=0;D<r;D++){const F=(D+1)%r;C(T++,D+r,v-1),C(T++,y-1,v-1),C(T++,F+r,v-1)}}const P=[[z.POSITION,new Wt(_,x,3,!0)],[z.NORMAL,new Wt(b,S,3,!0)],[z.UV0,new Wt(w,x,2,!0)]];return new Ea(t,P)}function yJt(t,e,i,r,s,n){r=r||10,s=s==null||s,jt(e.length>1);const o=[[0,0,0]],a=[],l=[];for(let c=0;c<r;c++){a.push([0,-c-1,-(c+1)%r-1]);const h=c/r*2*Math.PI;l.push([Math.cos(h)*i,Math.sin(h)*i])}return Qct(t,l,e,o,a,s,n)}function Qct(t,e,i,r,s,n,o=br(0,0,0)){const a=e.length,l=th(i.length*a*3+(6*r.length||0)),c=th(i.length*a*3+(r?6:0)),h=new Array,d=new Array;let f=0,m=0;const y=$(),v=$(),_=$(),b=$(),w=$(),x=$(),S=$(),C=$(),T=$(),M=$(),I=$(),P=$(),D=$(),F=Br();se(T,0,1,0),ye(v,i[1],i[0]),ae(v,v),n?(oe(C,i[0],o),ae(_,C)):se(_,0,0,1),Rde(v,_,T,T,w,_,Pde),ne(b,_),ne(P,w);for(let j=0;j<r.length;j++)ie(x,w,r[j][0]),ie(C,_,r[j][2]),oe(x,x,C),oe(x,x,i[0]),l[f++]=x[0],l[f++]=x[1],l[f++]=x[2];c[m++]=-v[0],c[m++]=-v[1],c[m++]=-v[2];for(let j=0;j<s.length;j++)h.push(s[j][0]>0?s[j][0]:-s[j][0]-1+r.length),h.push(s[j][1]>0?s[j][1]:-s[j][1]-1+r.length),h.push(s[j][2]>0?s[j][2]:-s[j][2]-1+r.length),d.push(0),d.push(0),d.push(0);let L=r.length;const N=r.length-1;for(let j=0;j<i.length;j++){let re=!1;j>0&&(ne(y,v),j<i.length-1?(ye(v,i[j+1],i[j]),ae(v,v)):re=!0,oe(M,y,v),ae(M,M),oe(I,i[j-1],b),D$(i[j],M,F),RA(F,mf(I,y),C)?(ye(C,C,i[j]),ae(_,C),lt(w,M,_),ae(w,w)):Rde(M,b,P,T,w,_,Pde),ne(b,_),ne(P,w)),n&&(oe(C,i[j],o),ae(D,C));for(let ve=0;ve<a;ve++)if(ie(x,w,e[ve][0]),ie(C,_,e[ve][1]),oe(x,x,C),ae(S,x),c[m++]=S[0],c[m++]=S[1],c[m++]=S[2],oe(x,x,i[j]),l[f++]=x[0],l[f++]=x[1],l[f++]=x[2],!re){const xe=(ve+1)%a;h.push(L+ve),h.push(L+a+ve),h.push(L+xe),h.push(L+xe),h.push(L+a+ve),h.push(L+a+xe);for(let De=0;De<6;De++){const Ke=h.length-6;d.push(h[Ke+De]-N)}}L+=a}const R=i[i.length-1];for(let j=0;j<r.length;j++)ie(x,w,r[j][0]),ie(C,_,r[j][1]),oe(x,x,C),oe(x,x,R),l[f++]=x[0],l[f++]=x[1],l[f++]=x[2];const k=m/3;c[m++]=v[0],c[m++]=v[1],c[m++]=v[2];const W=L-a;for(let j=0;j<s.length;j++)h.push(s[j][0]>=0?L+s[j][0]:-s[j][0]-1+W),h.push(s[j][2]>=0?L+s[j][2]:-s[j][2]-1+W),h.push(s[j][1]>=0?L+s[j][1]:-s[j][1]-1+W),d.push(k),d.push(k),d.push(k);const G=[[z.POSITION,new Wt(l,h,3,!0)],[z.NORMAL,new Wt(c,d,3,!0)]];return new Ea(t,G)}function vJt(t,e,i,r){jt(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),jt(e[0].length===3,"createPolylineGeometry(): malformed vertex"),jt(i==null||i.length===e.length,"createPolylineGeometry: need same number of points and normals"),jt(i==null||i[0].length===3,"createPolylineGeometry(): malformed normal");const s=oc(3*e.length),n=new Array(2*(e.length-1));let o=0,a=0;for(let c=0;c<e.length;c++){for(let h=0;h<3;h++)s[o++]=e[c][h];c>0&&(n[a++]=c-1,n[a++]=c)}const l=[[z.POSITION,new Wt(s,n,3,!0)]];if(i){const c=th(3*i.length);let h=0;for(let d=0;d<e.length;d++)for(let f=0;f<3;f++)c[h++]=i[d][f];l.push([z.NORMAL,new Wt(c,n,3,!0)])}return r&&l.push([z.COLOR,new Wt(r,MD(r.length/4),4)]),new Ea(t,l,null,Nn.Line)}function _Jt(t,e,i,r,s,n=0){const o=new Array(18),a=[[-i,n,s/2],[r,n,s/2],[0,e+n,s/2],[-i,n,-s/2],[r,n,-s/2],[0,e+n,-s/2]],l=[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5];for(let c=0;c<6;c++)o[3*c]=a[c][0],o[3*c+1]=a[c][1],o[3*c+2]=a[c][2];return new Ea(t,[[z.POSITION,new Wt(o,l,3,!0)]])}function bJt(t,e){const i=t.getMutableAttribute(z.POSITION).data;for(let r=0;r<i.length;r+=3){const s=i[r],n=i[r+1],o=i[r+2];se(ST,s,n,o),st(ST,ST,e),i[r]=ST[0],i[r+1]=ST[1],i[r+2]=ST[2]}}function eut(t,e=t){const i=t.attributes,r=i.get(z.POSITION).data,s=i.get(z.NORMAL).data;if(s){const n=e.getMutableAttribute(z.NORMAL).data;for(let o=0;o<s.length;o+=3){const a=s[o+1];n[o+1]=-s[o+2],n[o+2]=a}}if(r){const n=e.getMutableAttribute(z.POSITION).data;for(let o=0;o<r.length;o+=3){const a=r[o+1];n[o+1]=-r[o+2],n[o+2]=a}}}function PH(t,e,i,r,s){return!(Math.abs(de(e,t))>s)&&(lt(i,t,e),ae(i,i),lt(r,i,t),ae(r,r),!0)}function Rde(t,e,i,r,s,n,o){return PH(t,e,s,n,o)||PH(t,i,s,n,o)||PH(t,r,s,n,o)}const Pde=.99619469809,ST=$();function tut(t){return 32+t.length}const KIe=16;function $re(t){if(!t)return 0;let e=Ry;for(const i in t)t.hasOwnProperty(i)&&(e+=Are(t[i],!1));return e}function DU(t){if(!t)return 0;if(typeof t[0]=="number")return Pj(t);if(Array.isArray(t))return iut(t);let e=Ry;for(const i in t)t.hasOwnProperty(i)&&(e+=Are(t[i]));return e}function iut(t){const e=t.length;if(e===0||typeof t[0]=="number")return QIe(t,8);let i=eRe;for(let r=0;r<e;r++)i+=Are(t[r]);return i}function Are(t,e=!0){switch(typeof t){case"object":return e?DU(t):Ry;case"string":return tut(t);case"number":return KIe;case"boolean":return 4;default:return 8}}function Pj(...t){return t.reduce((e,i)=>e+(i?j3(i)?i.byteLength+Mre:Array.isArray(i)?QIe(i,KIe):0:0),0)}function QIe(t,e){return eRe+t.length*e}const Ry=32,eRe=16,Mre=145;var Zr,Eo;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL",t[t.TILES3D=8]="TILES3D"})(Zr||(Zr={}));let rut=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=Eo.ALL,this.normalRequired=!0,this.excludeLabels=!1}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(Eo||(Eo={}));let sut=class{constructor(e,i,r){this.object=e,this.geometryId=i,this.triangleNr=r}},nut=class extends sut{constructor(e,i,r,s){super(e,i,r),this.center=s!=null?is(s):null}},tRe=class{constructor(e){this.layerUid=e}},RD=class extends tRe{constructor(e,i){super(e),this.graphicUid=i}};function ah(t){return t?.dist!=null}function Dde(t){return(e,i,r)=>(dr(Lde,e,i,r),!pre(t,Lde))}function Dj(t){return ah(t)&&t.intersector===Zr.OBJECT&&!!t.target}function Lj(t){return ah(t)&&t.intersector===Zr.HUD&&!!t.target&&"center"in t.target&&t.target.center!=null}const Lde=$();function out(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function LU(t,e,i){i*=.5;const r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function Ore(t,e){const i=2*Math.acos(e[3]),r=Math.sin(i/2);return r>So()?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),i}function Nj(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=i[0],l=i[1],c=i[2],h=i[3];return t[0]=r*h+o*a+s*c-n*l,t[1]=s*h+o*l+n*a-r*c,t[2]=n*h+o*c+r*l-s*a,t[3]=o*h-r*a-s*l-n*c,t}function aut(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+o*a,t[1]=s*l+n*a,t[2]=n*l-s*a,t[3]=o*l-r*a,t}function lut(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l-n*a,t[1]=s*l+o*a,t[2]=n*l+r*a,t[3]=o*l-s*a,t}function cut(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+s*a,t[1]=s*l-r*a,t[2]=n*l+o*a,t[3]=o*l-n*a,t}function uut(t,e){const i=e[0],r=e[1],s=e[2];return t[0]=i,t[1]=r,t[2]=s,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-s*s)),t}function L4(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=e[3];let l,c,h,d,f,m=i[0],y=i[1],v=i[2],_=i[3];return c=s*m+n*y+o*v+a*_,c<0&&(c=-c,m=-m,y=-y,v=-v,_=-_),1-c>So()?(l=Math.acos(c),h=Math.sin(l),d=Math.sin((1-r)*l)/h,f=Math.sin(r*l)/h):(d=1-r,f=r),t[0]=d*s+f*m,t[1]=d*n+f*y,t[2]=d*o+f*v,t[3]=d*a+f*_,t}function hut(t){const e=dD,i=e(),r=e(),s=e(),n=Math.sqrt(1-i),o=Math.sqrt(i);return t[0]=n*Math.sin(2*Math.PI*r),t[1]=n*Math.cos(2*Math.PI*r),t[2]=o*Math.sin(2*Math.PI*s),t[3]=o*Math.cos(2*Math.PI*s),t}function dut(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=i*i+r*r+s*s+n*n,a=o?1/o:0;return t[0]=-i*a,t[1]=-r*a,t[2]=-s*a,t[3]=n*a,t}function lb(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function iRe(t,e){const i=e[0]+e[4]+e[8];let r;if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;r=Math.sqrt(e[3*s+s]-e[3*n+n]-e[3*o+o]+1),t[s]=.5*r,r=.5/r,t[3]=(e[3*n+o]-e[3*o+n])*r,t[n]=(e[3*n+s]+e[3*s+n])*r,t[o]=(e[3*o+s]+e[3*s+o])*r}return t}function put(t,e,i,r){const s=.5*Math.PI/180;e*=s,i*=s,r*=s;const n=Math.sin(e),o=Math.cos(e),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),h=Math.cos(r);return t[0]=n*l*h-o*a*c,t[1]=o*a*h+n*l*c,t[2]=o*l*c-n*a*h,t[3]=o*l*h+n*a*c,t}function fut(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const mut=yd,rRe=es,gut=sre,yut=Nj,vut=P$,_ut=IOe,but=bj,sRe=nre,wut=sRe,nRe=_j,xut=nRe,Ire=OOe,Sut=Dx,Tut=oS;function Eut(t,e,i){const r=de(e,i);return r<-.999999?(lt($f,Cut,e),Ba($f)<1e-6&&lt($f,$ut,e),ae($f,$f),LU(t,$f,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(lt($f,e,i),t[0]=$f[0],t[1]=$f[1],t[2]=$f[2],t[3]=1+r,Ire(t,t))}const $f=$(),Cut=Le(1,0,0),$ut=Le(0,1,0);function Aut(t,e,i,r,s,n){return L4(Nde,e,s,n),L4(Fde,i,r,n),L4(t,Nde,Fde,2*n*(1-n)),t}const Nde=Dd(),Fde=Dd();function Mut(t,e,i,r){const s=Out;return s[0]=i[0],s[3]=i[1],s[6]=i[2],s[1]=r[0],s[4]=r[1],s[7]=r[2],s[2]=-e[0],s[5]=-e[1],s[8]=-e[2],Ire(t,iRe(t,s))}const Out=xs();Object.freeze(Object.defineProperty({__proto__:null,add:gut,calculateW:uut,conjugate:lb,copy:mut,dot:_ut,equals:Tut,exactEquals:Sut,fromEuler:put,fromMat3:iRe,getAxisAngle:Ore,identity:out,invert:dut,len:wut,length:sRe,lerp:but,mul:yut,multiply:Nj,normalize:Ire,random:hut,rotateX:aut,rotateY:lut,rotateZ:cut,rotationTo:Eut,scale:vut,set:rRe,setAxes:Mut,setAxisAngle:LU,slerp:L4,sqlerp:Aut,sqrLen:xut,squaredLength:nRe,str:fut},Symbol.toStringTag,{value:"Module"}));const k$=1e-6,_M=$(),pN=$();function Iut(t,e){const{data:i,size:r}=t,s=i.length/r;if(s<=0)return;const n=new But(t);RY(_M,n.minProj,n.maxProj),oI(_M,_M,.5),id(pN,n.maxProj,n.minProj);const o=IY(pN),a=new Vut;a.quality=o,s<14&&(t=new Rj(new Float64Array(n.buffer,112,42),3));const l=$(),c=$(),h=$(),d=$(),f=$(),m=$(),y=$();switch(Rut(n,t,y,l,c,h,d,f,m,a)){case 1:return void Bde(_M,pN,e);case 2:return void zut(t,d,e)}Put(t,y,l,c,h,d,f,m,a),oRe(t,a.b0,a.b1,a.b2,RC,PC);const v=$();id(v,PC,RC),a.quality=IY(v),a.quality<o?aRe(a.b0,a.b1,a.b2,RC,PC,v,e):Bde(_M,pN,e)}function Rut(t,e,i,r,s,n,o,a,l,c){return Dut(t,r,s),PY(r,s)<k$?1:(id(o,r,s),ha(o,o),Lut(e,r,o,n)<k$?2:(id(a,s,n),ha(a,a),id(l,n,r),ha(l,l),rd(i,a,o),ha(i,i),v1(e,i,o,a,l,c),0))}const bM=$(),wM=$(),gh=$(),yh=$(),vh=$(),s0=$(),n0=$(),o0=$();function Put(t,e,i,r,s,n,o,a,l){Nut(t,e,i,bM,wM),bM[0]!==void 0&&(id(gh,bM,i),ha(gh,gh),id(yh,bM,r),ha(yh,yh),id(vh,bM,s),ha(vh,vh),rd(s0,yh,n),ha(s0,s0),rd(n0,vh,o),ha(n0,n0),rd(o0,gh,a),ha(o0,o0),v1(t,s0,n,yh,gh,l),v1(t,n0,o,vh,yh,l),v1(t,o0,a,gh,vh,l)),wM[0]!==void 0&&(id(gh,wM,i),ha(gh,gh),id(yh,wM,r),ha(yh,yh),id(vh,wM,s),ha(vh,vh),rd(s0,yh,n),ha(s0,s0),rd(n0,vh,o),ha(n0,n0),rd(o0,gh,a),ha(o0,o0),v1(t,s0,n,yh,gh,l),v1(t,n0,o,vh,yh,l),v1(t,o0,a,gh,vh,l))}function Dut(t,e,i){let r=PY(t.maxVert[0],t.minVert[0]),s=0;for(let n=1;n<7;++n){const o=PY(t.maxVert[n],t.minVert[n]);o>r&&(r=o,s=n)}Ju(e,t.minVert[s]),Ju(i,t.maxVert[s])}const _h=[0,0,0];function Lut(t,e,i,r){const{data:s,size:n}=t;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){_h[0]=s[l]-e[0],_h[1]=s[l+1]-e[1],_h[2]=s[l+2]-e[2];const c=i[0]*_h[0]+i[1]*_h[1]+i[2]*_h[2],h=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],d=_h[0]*_h[0]+_h[1]*_h[1]+_h[2]*_h[2]-c*c/h;d>o&&(o=d,a=l)}return Ju(r,s,a),o}const Zn=He();function Nut(t,e,i,r,s){kut(t,e,Zn,s,r);const n=cRe(i,e);Zn[1]-k$<=n&&(r[0]=void 0),Zn[0]+k$>=n&&(s[0]=void 0)}const kde=$(),zde=$(),Ude=$(),TT=$(),ET=$(),fN=$();function v1(t,e,i,r,s,n){if(lRe(e)<k$)return;rd(kde,i,e),rd(zde,r,e),rd(Ude,s,e),IC(t,e,Zn),ET[1]=Zn[0],TT[1]=Zn[1],fN[1]=TT[1]-ET[1];const o=[i,r,s],a=[kde,zde,Ude];for(let l=0;l<3;++l){IC(t,o[l],Zn),ET[0]=Zn[0],TT[0]=Zn[1],IC(t,a[l],Zn),ET[2]=Zn[0],TT[2]=Zn[1],fN[0]=TT[0]-ET[0],fN[2]=TT[2]-ET[2];const c=IY(fN);c<n.quality&&(Ju(n.b0,o[l]),Ju(n.b1,e),Ju(n.b2,a[l]),n.quality=c)}}const Fut=$();function IC(t,e,i){const{data:r,size:s}=t;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<r.length;n+=s){const o=r[n]*e[0]+r[n+1]*e[1]+r[n+2]*e[2];i[0]=Math.min(i[0],o),i[1]=Math.max(i[1],o)}}function kut(t,e,i,r,s){const{data:n,size:o}=t;Ju(r,n),Ju(s,r),i[0]=cRe(Fut,e),i[1]=i[0];for(let a=o;a<n.length;a+=o){const l=n[a]*e[0]+n[a+1]*e[1]+n[a+2]*e[2];l<i[0]&&(i[0]=l,Ju(r,n,a)),l>i[1]&&(i[1]=l,Ju(s,n,a))}}function Bde(t,e,i){i.center=t,i.halfSize=ie(e,e,.5),i.quaternion=Qie}const $g=$(),CT=$(),xM=$(),RC=$(),PC=$(),Vde=$();function zut(t,e,i){Ju($g,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?$g[0]=0:Math.abs(e[1])>Math.abs(e[2])?$g[1]=0:$g[2]=0,lRe($g)<k$&&($g[0]=$g[1]=$g[2]=1),rd(CT,e,$g),ha(CT,CT),rd(xM,e,CT),ha(xM,xM),oRe(t,e,CT,xM,RC,PC),id(Vde,PC,RC),aRe(e,CT,xM,RC,PC,Vde,i)}function oRe(t,e,i,r,s,n){IC(t,e,Zn),s[0]=Zn[0],n[0]=Zn[1],IC(t,i,Zn),s[1]=Zn[0],n[1]=Zn[1],IC(t,r,Zn),s[2]=Zn[0],n[2]=Zn[1]}const gw=$(),SM=$(),mN=$(),Af=gOe(1,0,0,0,1,0,0,0,1),Uut=Dd();function aRe(t,e,i,r,s,n,o){Af[0]=t[0],Af[1]=t[1],Af[2]=t[2],Af[3]=e[0],Af[4]=e[1],Af[5]=e[2],Af[6]=i[0],Af[7]=i[1],Af[8]=i[2],o.quaternion=jut(Uut,Af),RY(gw,r,s),oI(gw,gw,.5),oI(SM,t,gw[0]),oI(mN,e,gw[1]),RY(SM,SM,mN),oI(mN,i,gw[2]),o.center=oe(SM,SM,mN),o.halfSize=ie(gw,n,.5)}const cu=7;let But=class{constructor(e){this.minVert=new Array(cu),this.maxVert=new Array(cu);const i=64*cu;this.buffer=new ArrayBuffer(i);let r=0;this.minProj=new Float64Array(this.buffer,r,cu),r+=8*cu,this.maxProj=new Float64Array(this.buffer,r,cu),r+=8*cu;for(let l=0;l<cu;++l)this.minVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<cu;++l)this.maxVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<cu;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(cu),n=new Array(cu),{data:o,size:a}=e;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<cu;++l){let c=s[l];Ju(this.minVert[l],o,c),c=n[l],Ju(this.maxVert[l],o,c)}}},Vut=class{constructor(){this.b0=Le(1,0,0),this.b1=Le(0,1,0),this.b2=Le(0,0,1),this.quality=0}};function IY(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function RY(t,e,i){t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2]}function id(t,e,i){t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2]}function oI(t,e,i){t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}function Ju(t,e,i=0){t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2]}function rd(t,e,i){const r=e[0],s=e[1],n=e[2],o=i[0],a=i[1],l=i[2];t[0]=s*l-n*a,t[1]=n*o-r*l,t[2]=r*a-s*o}function ha(t,e){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(i>0){const r=1/Math.sqrt(i);t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}}function lRe(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function PY(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return i*i+r*r+s*s}function cRe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function jut(t,e){const i=e[0]+e[4]+e[8];if(i>0){let r=Math.sqrt(i+1);t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r}else{let r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);const s=(r+1)%3,n=(r+2)%3;let o=Math.sqrt(e[3*r+r]-e[3*s+s]-e[3*n+n]+1);t[r]=.5*o,o=.5/o,t[3]=(e[3*s+n]-e[3*n+s])*o,t[s]=(e[3*s+r]+e[3*r+s])*o,t[n]=(e[3*n+r]+e[3*r+n])*o}return t}let uRe=class N4{constructor(e=on,i=Qut,r=Qie){this._data=[e[0],e[1],e[2],i[0],i[1],i[2],r[0],r[1],r[2],r[3]]}clone(){const e=new N4;return e._data=this._data.slice(),e}invalidate(){this._data[3]=-1}get isValid(){return this._data[3]>=0}static fromData(e){const i=new N4;return i._data=e.slice(),i}static fromJSON(e){return new N4(e.center,e.halfSize,e.quaternion)}copy(e){this._data=e.data.slice()}get center(){return se(Ne.get(),this._data[0],this._data[1],this._data[2])}get centerX(){return this._data[0]}get centerY(){return this._data[1]}get centerZ(){return this._data[2]}getCenter(e){return e[0]=this._data[0],e[1]=this._data[1],e[2]=this._data[2],e}set center(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2]}setCenter(e,i,r){this._data[0]=e,this._data[1]=i,this._data[2]=r}get halfSize(){return se(Ne.get(),this._data[3],this._data[4],this._data[5])}get halfSizeX(){return this._data[3]}get halfSizeY(){return this._data[4]}get halfSizeZ(){return this._data[5]}getHalfSize(e){return e[0]=this._data[3],e[1]=this._data[4],e[2]=this._data[5],e}set halfSize(e){this._data[3]=e[0],this._data[4]=e[1],this._data[5]=e[2]}get quaternion(){return rRe(fot.get(),this._data[6],this._data[7],this._data[8],this._data[9])}getQuaternion(e){return e[0]=this._data[6],e[1]=this._data[7],e[2]=this._data[8],e[3]=this._data[9],e}set quaternion(e){this._data[6]=e[0],this._data[7]=e[1],this._data[8]=e[2],this._data[9]=e[3]}get data(){return this._data}getCorners(e){const i=Kr,r=this._data;i[0]=r[6],i[1]=r[7],i[2]=r[8],i[3]=r[9];for(let s=0;s<8;++s){const n=e[s];n[0]=(1&s?-1:1)*r[3],n[1]=(2&s?-1:1)*r[4],n[2]=(4&s?-1:1)*r[5],Uc(n,n,i),n[0]+=r[0],n[1]+=r[1],n[2]+=r[2]}}doesIntersectFrustumConservativeApproximation(e){return this.intersectPlane(e[0])<=0&&this.intersectPlane(e[1])<=0&&this.intersectPlane(e[2])<=0&&this.intersectPlane(e[3])<=0&&this.intersectPlane(e[4])<=0&&this.intersectPlane(e[5])<=0}get radius(){const e=this._data[3],i=this._data[4],r=this._data[5];return Math.sqrt(e*e+i*i+r*r)}intersectSphere(e){ui[0]=this._data[0]-e[0],ui[1]=this._data[1]-e[1],ui[2]=this._data[2]-e[2];const i=this.getQuaternion(Fy);return lb(Kr,i),Uc(ui,ui,Kr),A$(ui,ui),Ag[0]=Math.min(ui[0],this._data[3]),Ag[1]=Math.min(ui[1],this._data[4]),Ag[2]=Math.min(ui[2],this._data[5]),O$(Ag,ui)<e[3]*e[3]}intersectSphereWithMBS(e,i=this.radius){const r=this._data;ui[0]=r[0]-e[0],ui[1]=r[1]-e[1],ui[2]=r[2]-e[2];const s=e[3],n=s+i;return!(pU(ui)>n*n)&&(Kr[0]=-r[6],Kr[1]=-r[7],Kr[2]=-r[8],Kr[3]=r[9],Uc(ui,ui,Kr),A$(ui,ui),Ag[0]=Math.min(ui[0],r[3]),Ag[1]=Math.min(ui[1],r[4]),Ag[2]=Math.min(ui[2],r[5]),O$(Ag,ui)<s*s)}intersectPlane(e){const i=e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3],r=this.projectedRadius(e);return i>r?1:i<-r?-1:0}intersectRay(e,i,r=0){const s=this._data,n=Kr;n[0]=-s[6],n[1]=-s[7],n[2]=-s[8],n[3]=s[9],ui[0]=e[0]-s[0],ui[1]=e[1]-s[1],ui[2]=e[2]-s[2];const o=Uc(ui,ui,Kr),a=Uc(Ag,i,Kr);let l=-1/0,c=1/0;const h=this.getHalfSize(DC);for(let d=0;d<3;d++){const f=o[d],m=a[d],y=h[d]+r;if(Math.abs(m)>1e-6){const v=(y-f)/m,_=(-y-f)/m;l=Math.max(l,Math.min(v,_)),c=Math.min(c,Math.max(v,_))}else if(f>y||f<-y)return!1}return l<=c}projectedArea(e,i,r,s){const n=this.getQuaternion(Fy);lb(Kr,n),ui[0]=e[0]-this._data[0],ui[1]=e[1]-this._data[1],ui[2]=e[2]-this._data[2],Uc(ui,ui,Kr);const o=this.getHalfSize(DC),a=ui[0]<-o[0]?-1:ui[0]>o[0]?1:0,l=ui[1]<-o[1]?-1:ui[1]>o[1]?1:0,c=ui[2]<-o[2]?-1:ui[2]>o[2]?1:0,h=Math.abs(a)+Math.abs(l)+Math.abs(c);if(h===0)return 1/0;const d=h===1?4:6,f=6*(a+3*l+9*c+13);HP(LE,n),dj(LE,LE,o);const m=this.getCenter(Gp);for(let _=0;_<d;_++){const b=qut[f+_];se(ui,((1&b)<<1)-1,(2&b)-1,((4&b)>>1)-1),ac(ui,ui,LE),oe(yw,m,ui),yw[3]=1,Yc(yw,yw,i);const w=1/Math.max(1e-6,yw[3]);Zd[2*_]=yw[0]*w,Zd[2*_+1]=yw[1]*w}const y=2*d-2;let v=Zd[0]*(Zd[3]-Zd[y+1])+Zd[y]*(Zd[1]-Zd[y-1]);for(let _=2;_<y;_+=2)v+=Zd[_]*(Zd[_+3]-Zd[_-1]);return Math.abs(v)*r*s*.125}projectedRadius(e){const i=this.getQuaternion(Fy);return lb(Kr,i),Uc(ui,e,Kr),Math.abs(ui[0]*this._data[3])+Math.abs(ui[1]*this._data[4])+Math.abs(ui[2]*this._data[5])}minimumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]-this.projectedRadius(e)}maximumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]+this.projectedRadius(e)}toAaBoundingBox(e){const i=this.getQuaternion(Fy),r=HP(LE,i),s=this._data[3]*Math.abs(r[0])+this._data[4]*Math.abs(r[3])+this._data[5]*Math.abs(r[6]),n=this._data[3]*Math.abs(r[1])+this._data[4]*Math.abs(r[4])+this._data[5]*Math.abs(r[7]),o=this._data[3]*Math.abs(r[2])+this._data[4]*Math.abs(r[5])+this._data[5]*Math.abs(r[8]);e[0]=this._data[0]-s,e[1]=this._data[1]-n,e[2]=this._data[2]-o,e[3]=this._data[0]+s,e[4]=this._data[1]+n,e[5]=this._data[2]+o}transform(e,i,r,s=0,n=$b(r),o=$b(i),a=xb(i,o)){if(r===n)i.isGeographic?Jut(this,e,i,s,o):Yut(this,e,i,s,o,a);else if(i.isWGS84&&(r.isWebMercator||OP(r)))Wut(i,this,r,e,s);else if(i.isWebMercator&&OP(r))Zut(i,this,r,e,s);else{const l=this.getCenter(Gp);l[2]+=s,Bn(l,i,0,l,r,0),e.center=l,this!==e&&(e.quaternion=this.getQuaternion(Fy),e.halfSize=this.getHalfSize(DC))}}};const Kr=Dd(),Fy=Dd(),Gut=Dd(),ui=$(),Ag=$(),yw=pi();function Hut(t,e=new uRe){return Iut(t,e),e}const Zd=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],qut=(()=>{const t=new Int8Array(162);let e=0;const i=r=>{for(let s=0;s<r.length;s++)t[e+s]=r[s];e+=6};return i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4]),t})();function hRe(t,e,i,r,s){const n=t.getQuaternion(Fy);s.quaternion=n,lb(Kr,n);const o=t.getCenter(Gp),a=t.getHalfSize(DC);if(r===Be.Global){Uc(Lr,o,Kr),A$(Ip,Lr),MAe(hu,Ip,a),Ri(hu,Ip,hu);const l=Te(hu);oe(hu,Ip,a);const c=Te(hu);if(l<i)s.center=o,se(Lr,i,i,i),s.halfSize=oe(Lr,a,Lr);else{const h=c>0?1+e/c:1,d=l>0?1+i/l:1,f=(d+h)/2,m=(d-h)/2;ie(hu,Ip,m),s.halfSize=Xn(hu,hu,a,f),ie(hu,Ip,f),Xn(hu,hu,a,m),AAe(Lr,Lr),Lie(Lr,hu,Lr);const y=t.getQuaternion(Gut);s.center=Uc(Lr,Lr,y)}}else{s.center=Xn(Lr,o,f$,(i+e)/2);const l=Uc(Lr,f$,Kr);A$(l,l),s.halfSize=Xn(Ip,a,l,(i-e)/2)}return s}function Wut(t,e,i,r,s){e.getCenter(Gp),Gp[2]+=s;const n=$b(i);Bn(Gp,t,0,Gp,n,0),dRe(n,e,Gp,i,r)}function Zut(t,e,i,r,s){e.getCenter(Gp),Gp[2]+=s,dRe(t,e,Gp,i,r)}function dRe(t,e,i,r,s){const n=e.getQuaternion(Fy),o=HP(LE,n),a=e.getHalfSize(DC);for(let l=0;l<8;++l){for(let c=0;c<3;++c)_m[c]=a[c]*(l&1<<c?-1:1);for(let c=0;c<3;++c){let h=i[c];for(let d=0;d<3;++d)h+=_m[d]*o[3*d+c];F4[3*l+c]=h}}Bn(F4,t,0,F4,r,0,8),Hut(Xut,s)}function Yut(t,e,i,r,s=$b(i),n=xb(i,s)){t.getCorners(jde),t.getCenter(_m),_m[2]+=r,VS(i,_m,uu,s),e.setCenter(uu[12],uu[13],uu[14]);const o=2*Math.sqrt(1+uu[0]+uu[5]+uu[10]);Kr[0]=(uu[6]-uu[9])/o,Kr[1]=(uu[8]-uu[2])/o,Kr[2]=(uu[1]-uu[4])/o,Kr[3]=.25*o;const a=t.getQuaternion(Fy);e.quaternion=Nj(Kr,Kr,a),lb(Kr,Kr),se(Ip,0,0,0);const l=e.getCenter(Kut);for(const c of jde)c[2]+=r,n(c,0,c,0),Ri(Lr,c,l),Uc(Lr,Lr,Kr),A$(Lr,Lr),OAe(Ip,Ip,Lr);e.halfSize=Ip}function Jut(t,e,i,r,s=$b(i)){const n=gr(i),o=1+Math.max(0,r)/(n.radius+t.centerZ);t.getCenter(_m),_m[2]+=r,Bn(_m,i,0,_m,s,0),e.center=_m;const a=t.getQuaternion(Fy);e.quaternion=a,lb(Kr,a),se(Lr,0,0,1),Uc(Lr,Lr,Kr);const l=t.getHalfSize(DC);se(Lr,l[0]*Math.abs(Lr[0]),l[1]*Math.abs(Lr[1]),l[2]*Math.abs(Lr[2])),ie(Lr,Lr,n.inverseFlattening),oe(Lr,l,Lr),e.halfSize=ie(Lr,Lr,o)}const F4=new Array(24),Xut=new Rj(F4,3),_m=$(),Gp=$(),Kut=$(),DC=$(),LE=xs(),uu=Ve(),jde=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Lr=$(),Ip=$(),hu=$(),Qut=hf(-1,-1,-1);let eht=class{constructor(){this._transform=Ve(),this._transformInverse=new gN({value:this._transform},Sl,Ve),this._transformInverseTranspose=new gN(this._transformInverse,dc,Ve),this._transformTranspose=new gN({value:this._transform},dc,Ve),this._transformInverseRotation=new gN({value:this._transform},fAe,xs)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){mn(this._transform,e)}multiplyTransform(e){kn(this._transform,this._transform,e)}set(e){mn(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,i){this.setTransformMatrix(e),this.multiplyTransform(i),this._invalidateLazyTransforms()}},gN=class{constructor(e,i,r){this._original=e,this._update=i,this._dirty=!0,this._transform=r()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},tht=class{constructor(e=0){this.offset=e,this.tmpVertex=$()}applyToVertex(e,i,r){const s=se(Rre,e,i,r),n=oe(pRe,s,this.localOrigin),o=this.offset/Te(n);return Xn(this.tmpVertex,s,n,o),this.tmpVertex}applyToAabb(e){const i=nht,r=oht,s=aht;for(let l=0;l<3;++l)i[l]=e[0+l]+this.localOrigin[l],r[l]=e[3+l]+this.localOrigin[l],s[l]=i[l];const n=this.applyToVertex(i[0],i[1],i[2]);for(let l=0;l<3;++l)e[l]=n[l],e[l+3]=n[l];const o=l=>{const c=this.applyToVertex(l[0],l[1],l[2]);for(let h=0;h<3;++h)e[h]=Math.min(e[h],c[h]),e[h+3]=Math.max(e[h+3],c[h])};for(let l=1;l<8;++l){for(let c=0;c<3;++c)s[c]=l&1<<c?r[c]:i[c];o(s)}let a=0;for(let l=0;l<3;++l)i[l]*r[l]<0&&(a|=1<<l);if(a!==0&&a!==7){for(let l=0;l<8;++l)if(!(a&l)){for(let c=0;c<3;++c)s[c]=a&1<<c?0:l&1<<c?i[c]:r[c];o(s)}}for(let l=0;l<3;++l)e[l]-=this.localOrigin[l],e[l+3]-=this.localOrigin[l];return e}},iht=class{constructor(e=0){this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=$(),this._tmpMbs=Rs(),this._tmpObb=new uRe,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Te(e)}applyToVertex(e,i,r){const s=se(Rre,e,i,r),n=se(pRe,e,i,r+this.componentLocalOriginLength),o=this._totalOffset/Te(n);return Xn(this._tmpVertex,s,n,o),this._tmpVertex}applyToAabb(e){const i=this.componentLocalOriginLength,r=e[0],s=e[1],n=e[2]+i,o=e[3],a=e[4],l=e[5]+i,c=Math.abs(r),h=Math.abs(s),d=Math.abs(n),f=Math.abs(o),m=Math.abs(a),y=Math.abs(l),v=.5*(1+Math.sign(r*o))*Math.min(c,f),_=.5*(1+Math.sign(s*a))*Math.min(h,m),b=.5*(1+Math.sign(n*l))*Math.min(d,y),w=Math.max(c,f),x=Math.max(h,m),S=Math.max(d,y),C=Math.sqrt(v*v+_*_+b*b),T=Math.sign(c+r),M=Math.sign(h+s),I=Math.sign(d+n),P=Math.sign(f+o),D=Math.sign(m+a),F=Math.sign(y+l),L=this._totalOffset;if(C<L)return e[0]-=(1-T)*L,e[1]-=(1-M)*L,e[2]-=(1-I)*L,e[3]+=P*L,e[4]+=D*L,e[5]+=F*L,e;const N=L/Math.sqrt(w*w+x*x+S*S),R=L/C,k=R-N,W=-k;return e[0]+=r*(T*W+R),e[1]+=s*(M*W+R),e[2]+=n*(I*W+R),e[3]+=o*(P*k+N),e[4]+=a*(D*k+N),e[5]+=l*(F*k+N),e}applyToMbs(e){const i=Te(e),r=this._totalOffset/i;return Xn(this._tmpMbs,e,e,r),this._tmpMbs[3]=e[3]+e[3]*this._totalOffset/i,this._tmpMbs}applyToObb(e){return hRe(e,this._totalOffset,this._totalOffset,Be.Global,this._tmpObb),this._tmpObb}},rht=class{constructor(e=0){this.offset=e,this.sphere=Rs(),this.tmpVertex=$()}applyToVertex(e,i,r){const s=this.objectTransform.transform,n=se(Rre,e,i,r),o=st(n,n,s),a=this.offset/Te(o);Xn(o,o,o,a);const l=this.objectTransform.inverse;return st(this.tmpVertex,o,l),this.tmpVertex}applyToMinMax(e,i){const r=this.offset/Te(e);Xn(e,e,e,r);const s=this.offset/Te(i);Xn(i,i,i,s)}applyToAabb(e){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e}applyToBoundingSphere(e){const i=Te(e),r=this.offset/i;return Xn(this.sphere,e,e,r),this.sphere[3]=e[3]+e[3]*this.offset/i,this.sphere}};const Gde=new rht;function DY(t){return t!=null?(Gde.offset=t,Gde):null}const Hde=new iht;function qde(t){return t!=null?(Hde.offset=t,Hde):null}const Wde=new tht;function sht(t){return t!=null?(Wde.offset=t,Wde):null}const Ob="terrain",Rre=$(),pRe=$(),nht=$(),oht=$(),aht=$(),z$=1e-5;let lht=class{constructor(e){this.options=new rut,this._results=new cht,this.transform=new eht,this.tolerance=z$,this.verticalOffset=null,this._ray=Pn(),this._rayEnd=$(),this._rayBeginTransformed=$(),this._rayEndTransformed=$(),this.viewingMode=e??Be.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,i,r){this.resetWithRay(FOe(e,i,this._ray),r)}resetWithRay(e,i){this.camera=i,e!==this._ray&&MU(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===Be.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,oe(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,i,r,s,n){this.point=i,this.filterPredicate=s,this.tolerance=r??z$;const o=DY(this.verticalOffset);if(e&&e.length>0){const a=n?l=>{n(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of e){const c=l.getSpatialQueryAccelerator?.();c!=null?(o!=null?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(h=>a(h))}}this.sortResults()}intersectObject(e){const i=e.geometries;if(!i)return;const r=e.effectiveTransformation,s=DY(this.verticalOffset);for(const n of i){if(!n.visible)continue;const{material:o,id:a}=n;if(!o.visible)continue;this.transform.setAndInvalidateLazyTransforms(r,n.transformation),st(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),st(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;s!=null&&(s.objectTransform=this.transform),o.intersect(n,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,h,d,f,m,y)=>{if(c>=0){if(this.filterPredicate!=null&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const v=f?this._results.hud:this._results,_=f?b=>{const w=new nut(e,a,d,y);b.set(Zr.HUD,w,c,h,Kn,m)}:b=>b.set(Zr.OBJECT,{object:e,geometryId:a,triangleNr:d},c,h,l,m);if((v.min.drapedLayerOrder==null||m>=v.min.drapedLayerOrder)&&(v.min.dist==null||c<v.min.dist)&&_(v.min),this.options.store!==Eo.MIN&&(v.max.drapedLayerOrder==null||m<v.max.drapedLayerOrder)&&(v.max.dist==null||c>v.max.dist)&&_(v.max),this.options.store===Eo.ALL)if(f){const b=new LY(this._ray);_(b),this._results.hud.all.push(b)}else{const b=new LC(this._ray);_(b),this._results.all.push(b)}}})}}sortResults(e=this._results.all){e.sort((i,r)=>i.dist!==r.dist?(i.dist??0)-(r.dist??0):i.drapedLayerOrder!==r.drapedLayerOrder?Zde(i.drapedLayerOrder,r.drapedLayerOrder):Zde(i.drapedLayerGraphicOrder,r.drapedLayerGraphicOrder))}};function Zde(t,e){return(e??-Number.MAX_VALUE)-(t??-Number.MAX_VALUE)}function lh(t){return new lht(t)}let cht=class{constructor(){this.min=new LC(Pn()),this.max=new LC(Pn()),this.hud={min:new LY(Pn()),max:new LY(Pn()),all:new Array},this.ground=new LC(Pn()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},LC=class{get ray(){return this._ray}get distanceInRenderSpace(){return this.dist!=null?(ie(yN,this.ray.direction,this.dist),Te(yN)):null}withinDistance(e){return!!ah(this)&&this.distanceInRenderSpace<=e}getIntersectionPoint(e){return!!ah(this)&&(ie(yN,this.ray.direction,this.dist),oe(e,this.ray.origin,yN),!0)}getTransformedNormal(e){return ne(TM,this.normal),TM[3]=0,Yc(TM,TM,this.transformation),ne(e,TM),ae(e,e)}constructor(e){this.intersector=Zr.OBJECT,this.normal=$(),this.transformation=Ve(),this._ray=Pn(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=Zr.OBJECT,MU(e,this._ray)}set(e,i,r,s,n,o,a){this.intersector=e,this.dist=r,ne(this.normal,s??f$),mn(this.transformation,n??Kn),this.target=i,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){MU(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,ne(this.normal,e.normal),mn(this.transformation,e.transformation)}},LY=class extends LC{constructor(){super(...arguments),this.intersector=Zr.HUD}};function Pre(t){return new LC(t)}const yN=$(),TM=pi();let uht=class extends RD{constructor(e,i,r,s,n){super(e,i),this.layerUid=e,this.graphicUid=i,this.triangleNr=r,this.baseBoundingSphere=s,this.numLodLevels=n}};function Dre(t){return ah(t)&&t.intersector===Zr.LOD&&!!t.target}let hht=class{constructor(e,i,r,s){this.material=e,this.bufferWriter=e.createBufferWriter(),this.vertexBufferLayout=this.bufferWriter.vertexBufferLayout,this.buffer=i,this.elementCount=r,this.boundingInfo=s}get numTriangles(){return this.elementCount/3}get numVertices(){return this.elementCount}computeUsedMemory(){return this.buffer.byteLength+Mre}getRenderGeometry(){return this}intersect(e,i,r,s,n,o,a,l){const c=this.bufferWriter,h=this.buffer;c.intersect(h,e,r,s,(d,f,m,y,v)=>fRe(d,f,m,v,e,i,o,a,n,l))}},dht=class{constructor(e){this.engineGeometry=e}get material(){return this.engineGeometry.material}get numVertices(){return this.engineGeometry.attributes.get(z.POSITION).indices.length}get numTriangles(){return this.engineGeometry.indexCount/3}get boundingInfo(){return this.engineGeometry.boundingInfo}computeUsedMemory(){return Array.from(this.engineGeometry.attributes.values()).reduce((e,i)=>e+Pj(i.data,i.indices),0)}getRenderGeometry(){const e=this.material,i=this.engineGeometry,r=i.attributes,s=i.boundingInfo,n=e.createBufferWriter(),o=n.vertexBufferLayout,a=n.elementCount(r),l=o.createBuffer(a);return n.write(null,null,r,null,l,0),new hht(e,l.buffer,a,s)}intersect(e,i,r,s,n,o,a,l){const c=this.engineGeometry;this.material.intersect(c,e.transform.transform,e,r,s,(h,d,f,m,y)=>fRe(h,d,f,y,e,i,o,a,n,l))}};function fRe(t,e,i,r,s,n,o,a,l,c){if(t<0||n&&!n(s.rayBegin,s.rayEnd,t))return;const h=new uht(o.layerUid,o.graphicUid(l),i,a,c);if((s.results.min.drapedLayerOrder==null||r>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||t<s.results.min.dist)&&s.results.min.set(Zr.LOD,h,t,e,s.transform.transform,r),s.options.store!==Eo.MIN&&(s.results.max.drapedLayerOrder==null||r>=s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||t>s.results.max.dist)&&s.results.max.set(Zr.LOD,h,t,e,s.transform.transform,r),s.options.store===Eo.ALL){const d=Pre(s.results.min.ray);d.set(Zr.LOD,h,t,e,s.transform.transform,r),s.results.all.push(d)}}let pht=class{constructor(e,i=null){this.geometry=e,this.textures=i}get material(){return this.geometry.material}get numTriangles(){return this.geometry.numTriangles}},fht=class{constructor(e,i,r){this.components=e,this.minScreenSpaceRadius=i,this.pivotOffset=r;const s=Tk(this.components.map(n=>n.geometry));this.numVertices=s.reduce((n,o)=>n+o.numVertices,0)}},mht=class{constructor(e){this.levels=e,this.levels.sort((i,r)=>i.minScreenSpaceRadius===r.minScreenSpaceRadius?i.numVertices-r.numVertices:i.minScreenSpaceRadius-r.minScreenSpaceRadius)}getMaterials(){const e=[];return this.levels.forEach(i=>i.components.forEach(r=>e.push(r.geometry.material))),Tk(e)}getTextures(){const e=new Array;return this.levels.forEach(i=>i.components.forEach(r=>{r.textures!=null&&e.push(...r.textures)})),Tk(e)}getGeometries(){const e=new Array;return this.levels.forEach(i=>i.components.forEach(r=>{e.push(r.geometry)})),Tk(e)}getEngineGeometries(){return this.getGeometries().map(e=>e.engineGeometry).filter(e=>e!=null)}computeUsedMemory(){const e=this.getGeometries(),i=this.getTextures(),r=e.reduce((s,n)=>s+n.computeUsedMemory(),0);return i.reduce((s,n)=>s+n.memoryEstimate,0)+r}};function jJt(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function ght(t,e){const i=(r,s,n=!1)=>new mht(r.map(o=>{const a=s(o.tesselation);return n&&eut(a),new fht([new pht(new dht(a))],o.minScreenSpaceRadius)}));switch(t){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>Yct(e,.5,r,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>Uct(e,1));case"cone":return i(DH,r=>Ide(e,1,.5,r,!1),!0);case"inverted-cone":return i(DH,r=>Ide(e,1,.5,r,!0),!0);case"cylinder":return i(DH,r=>Kct(e,1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>Zct(e,1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>Gct(e,1),!0);default:return}}const DH=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];let Rp=class{constructor(e){this.estimated=!1,this.verticesPerFeature=e.verticesPerFeature??0,this.verticesPerCoordinate=e.verticesPerCoordinate??0,this.drawCallsPerFeature=e.drawCallsPerFeature??0,this.memory=e.memory??new mRe}},Lre=class extends Rp{constructor(e){super(e),this.estimated=!0}},yht=class extends Rp{constructor(e,i){super(i),this.numComplexities=e}},vht=class extends Lre{constructor(e,i){super(i),this.numComplexities=e}},mRe=class{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}};function _ht(t){return t.type==="fill"}function bht(t){return t.type==="extrude"}function Nre(t,e,i=0){const r=ce(t,0,Sht);for(let s=0;s<4;s++)e[i+s]=Math.floor(256*Tht(r*wht[s]))}function Fre(t,e=0){let i=0;for(let r=0;r<4;r++)i+=t[e+r]*xht[r];return i}const wht=[1,256,65536,16777216],xht=[1/256,1/65536,1/16777216,1/4294967296],Sht=Fre(new Uint8ClampedArray([255,255,255,255]));function Tht(t){return t-Math.floor(t)}var Ln;function YJt(t){switch(t){case"multiply":default:return Ln.Multiply;case"ignore":return Ln.Ignore;case"replace":return Ln.Replace;case"tint":return Ln.Tint}}function Eht(t,e,i){if(t==null||e===Ln.Ignore)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const r=ce(Math.round(t[3]*NU),0,NU),s=r===0||e===Ln.Tint?0:e===Ln.Replace?Cht:$ht;i[0]=ce(Math.round(t[0]*$T),0,$T),i[1]=ce(Math.round(t[1]*$T),0,$T),i[2]=ce(Math.round(t[2]*$T),0,$T),i[3]=r+s}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(Ln||(Ln={}));const $T=255,NU=85,Cht=NU,$ht=2*NU;function E(t,...e){let i="";for(let r=0;r<e.length;r++)i+=t[r]+e[r];return i+=t[t.length-1],i}function Se(t,e,i=""){return t?e:i}(function(t){function e(r){return Math.round(r).toString()}function i(r){return r.toPrecision(8)}t.int=e,t.float=i})(E);function gRe(t){t.vertex.code.add(E`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${E.int(Ln.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${E.int(Ln.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${E.int(Ln.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${E.int(Ln.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}var Y;function LH(t){return t===Y.Shadow||t===Y.ShadowHighlight||t===Y.ShadowExcludeHighlight||t===Y.ViewshedShadow}function Aht(t){return Rht(t)||t===Y.Normal}function Yde(t){return NY(t)||t===Y.Normal}function Fj(t){return t===Y.Highlight||t===Y.ObjectAndLayerIdColor}function Mht(t){return PD(t)||Fj(t)}function PD(t){return t===Y.Color}function _s(t){return PD(t)||kre(t)}function JJt(t){return PD(t)||t===Y.ObjectAndLayerIdColor}function XJt(t){return _s(t)||t===Y.ObjectAndLayerIdColor}function Oht(t){return PD(t)||t===Y.Highlight}function KJt(t){return Oht(t)||kj(t)}function Iht(t){return PD(t)||Fj(t)}function k4(t){return _s(t)||Fj(t)}function Rht(t){return Iht(t)||kj(t)}function NY(t){return k4(t)||kj(t)}function kj(t){return t===Y.Depth}function kre(t){return t===Y.ColorEmission}(function(t){t[t.Color=0]="Color",t[t.ColorEmission=1]="ColorEmission",t[t.Depth=2]="Depth",t[t.Normal=3]="Normal",t[t.Shadow=4]="Shadow",t[t.ShadowHighlight=5]="ShadowHighlight",t[t.ShadowExcludeHighlight=6]="ShadowExcludeHighlight",t[t.ViewshedShadow=7]="ViewshedShadow",t[t.Highlight=8]="Highlight",t[t.ObjectAndLayerIdColor=9]="ObjectAndLayerIdColor",t[t.COUNT=10]="COUNT"})(Y||(Y={}));function Zb(t){t.code.add(E`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}`),t.code.add(E`const vec4 RGBA_TO_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgbaTofloat(vec4 rgba) {
return dot(rgba, RGBA_TO_FLOAT_FACTORS);
}`),t.code.add(E`const vec4 uninterpolatedRGBAToFloatFactors = vec4(
1.0 / 256.0,
1.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0 / 256.0
);
float uninterpolatedRGBAToFloat(vec4 rgba) {
return (dot(round(rgba * 255.0), uninterpolatedRGBAToFloatFactors) - 0.5) * 2.0;
}`)}var Pt;(function(t){t[t.Bind=0]="Bind",t[t.Pass=1]="Pass",t[t.Draw=2]="Draw"})(Pt||(Pt={}));let or=class{constructor(e,i,r,s,n=null){if(this.name=e,this.type=i,this.arraySize=n,this.bind={[Pt.Bind]:null,[Pt.Pass]:null,[Pt.Draw]:null},s)switch(r){case void 0:break;case Pt.Bind:this.bind[Pt.Bind]=s;break;case Pt.Pass:this.bind[Pt.Pass]=s;break;case Pt.Draw:this.bind[Pt.Draw]=s}}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},i3=class extends or{constructor(e,i){super(e,"vec4",Pt.Draw,(r,s,n)=>r.setUniform4fv(e,i(s,n)))}},Pht=class extends or{constructor(e,i){super(e,"int",Pt.Draw,(r,s,n)=>r.setUniform1i(e,i(s,n)))}},Km=class extends or{constructor(e,i){super(e,"sampler2D",Pt.Draw,(r,s,n)=>r.bindTexture(e,i(s,n)))}};function Md(){return!!X("enable-feature:objectAndLayerId-rendering")}var km;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})(km||(km={}));const zre=429496.7296;function Dht(t,e){Nre(t/zre*.5+.5,e)}function Lht(t,e){switch(e.componentData){case km.Varying:return Nht(t,e);case km.Uniform:return Fht(t,e);case km.COUNT:return;default:e.componentData}}function Nht(t,e){const{vertex:i,fragment:r}=t;i.include(Zb),i.uniforms.add(new Km("componentColorTex",n=>n.componentParameters.texture.texture)),t.attributes.add(z.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const s=e.output===Y.ObjectAndLayerIdColor;s&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(gRe),i.constants.add("stride","float",Md()?3:2),i.code.add(E`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),i.code.add(E`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);
    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

  float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);
    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return uninterpolatedRGBAToFloat(encodedElevation) * ${E.float(zre)};
  }

  ${s?E`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);
            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:E`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),r.code.add(E`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${s?E`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function Fht(t,e){const{vertex:i,fragment:r}=t;t.varyings.add("vExternalColor","vec4"),i.uniforms.add(new i3("externalColor",n=>n.componentParameters.externalColor)).code.add(E`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);const s=e.output===Y.ObjectAndLayerIdColor;r.uniforms.add(new Pht("externalColorMixMode",n=>n.componentParameters.externalColorMixMode)).code.add(E`
    void readExternalColor(out vec4 color, out int colorMixMode) {
      color = vExternalColor;
      colorMixMode = externalColorMixMode;
    }

    void outputObjectAndLayerIdColor() {
      ${Se(s,"fragColor = vec4(0, 0, 0, 0);")}
    }
  `)}function LA(t,e){switch(e.normalType){case Fr.Compressed:t.attributes.add(z.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(E`vec3 decompressNormal(vec2 normal) {
float z = 1.0 - abs(normal.x) - abs(normal.y);
return vec3(normal + sign(normal) * min(z, 0.0), z);
}
vec3 normalModel() {
return decompressNormal(normalCompressed);
}`);break;case Fr.Attribute:t.attributes.add(z.NORMAL,"vec3"),t.vertex.code.add(E`vec3 normalModel() {
return normal;
}`);break;case Fr.ScreenDerivative:t.fragment.code.add(E`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case Fr.COUNT:}}var Fr;(function(t){t[t.Attribute=0]="Attribute",t[t.Compressed=1]="Compressed",t[t.ScreenDerivative=2]="ScreenDerivative",t[t.COUNT=3]="COUNT"})(Fr||(Fr={}));function Ure({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(E`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(E`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let Qc=class extends or{constructor(e,i){super(e,"vec3",Pt.Draw,(r,s,n,o)=>r.setUniform3fv(e,i(s,n,o)))}},Cr=class extends or{constructor(e,i){super(e,"vec3",Pt.Pass,(r,s,n)=>r.setUniform3fv(e,i(s,n)))}},FU=class extends or{constructor(e,i){super(e,"mat3",Pt.Draw,(r,s,n)=>r.setUniformMatrix3fv(e,i(s,n)))}},Ld=class extends or{constructor(e,i){super(e,"mat3",Pt.Pass,(r,s,n)=>r.setUniformMatrix3fv(e,i(s,n)))}},Co=class extends or{constructor(e,i){super(e,"mat4",Pt.Bind,(r,s)=>r.setUniformMatrix4fv(e,i(s)))}};function lXt(t,e){const i=t.vertex;i.include(Zb),t.include(LA,e);const{silhouette:r,legacy:s,spherical:n}=e;i.uniforms.add(new Km("componentDataTex",f=>f.componentDataTexture)),t.attributes.add(z.COMPONENTINDEX,"float"),i.constants.add("lineWidthFractionFactor","float",8),i.constants.add("extensionLengthOffset","float",128),i.code.add(E`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = ${E.float(3)}  * componentIndex + fieldOffset;
      float texSize = float(textureSize(componentDataTex, 0).x);
      float colIndex = mod(fieldIndex, texSize);
      float rowIndex = floor(fieldIndex / texSize);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      vec3 normal;
      vec3 normal2;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, ${E.float(0)});
      vec2 otherIndex = _componentTextureCoords(componentIndex, ${E.float(1)});
      vec2 verticalOffsetIndex = _componentTextureCoords(float(componentIndex), ${E.float(2)} );
      vec3 normal = normalModel();
      vec3 normal2 = ${r?E`decompressNormal(normal2Compressed)`:E`normal`};

      vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
      vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
      float verticalOffset = uninterpolatedRGBAToFloat(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) * ${E.float(zre)};

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        normal, normal2,
        otherValue.x * (255.0 / ${E.float(8)} ),
        otherValue.y * 255.0 - ${E.float(128)},
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `),s?i.code.add(E`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(i.uniforms.add(new FU("transformNormalGlobalFromModel",f=>f.transformNormalGlobalFromModel)),i.code.add(E`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),r?(t.attributes.add(z.NORMAL2COMPRESSED,"vec2"),i.code.add(E`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(normalize(data.normal + data.normal2));
}`)):i.code.add(E`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(data.normal);
}`),s?i.code.add(E`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(i.include(Ure,e),i.uniforms.add(new Ld("transformViewFromCameraRelativeRS",f=>f.transformViewFromCameraRelativeRS),new FU("transformWorldFromModelRS",f=>f.transformWorldFromModelRS),new Qc("transformWorldFromModelTL",f=>f.transformWorldFromModelTL),new Qc("transformWorldFromModelTH",f=>f.transformWorldFromModelTH),new Cr("transformWorldFromViewTL",f=>f.transformWorldFromViewTL),new Cr("transformWorldFromViewTH",f=>f.transformWorldFromViewTH)),i.code.add(E`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${n?"normalize(transformWorldFromModelTL + rotatedModelPosition);":"vec3(0.0, 0.0, 1.0);"}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),i.uniforms.add(new Co("transformProjFromView",f=>f.camera.projectionMatrix)).code.add(E`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),i.code.add(E`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function cXt(t){return t===U$.Sketch||t===U$.Mixed}var U$,Jde;(function(t){t[t.Solid=0]="Solid",t[t.Sketch=1]="Sketch",t[t.Mixed=2]="Mixed",t[t.COUNT=3]="COUNT"})(U$||(U$={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(Jde||(Jde={}));function kht(t){return t&&t.enabled&&(bht(t)||_ht(t))&&t.edges!=null}function zht(t){return t&&t.enabled&&t.edges||null}function Uht(t,e){return Bht(zht(t),e)}function Bht(t,e){if(t==null)return null;const i=t.color!=null?ere(qe.toUnitRGBA(t.color)):Gi(0,0,0,0),r=tS(t.size),s=tS(t.extensionLength);switch(t.type){case"solid":return Vht({color:i,size:r,extensionLength:s,...e});case"sketch":return jht({color:i,size:r,extensionLength:s,...e});default:return}}function Vht(t){return{...Ght,...t,type:U$.Solid}}function jht(t){return{...Hht,...t,type:U$.Sketch}}const Ght={color:Gi(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:td.OPAQUE,hasSlicePlane:!1},Hht={color:Gi(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:td.OPAQUE,hasSlicePlane:!1};let Bre=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<9;s++)i[s]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[r++]=i[s]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};Bre.ElementCount=9;let Vre=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<16;s++)i[s]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[r++]=i[s]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){this.copyFromTypedBuffer(e,i.typedBuffer,r*i.typedBufferStride)}copyFromTypedBuffer(e,i,r){const s=this.typedBuffer;let n=e*this.typedBufferStride;for(let o=0;o<16;++o)s[n++]=i[r++]}get buffer(){return this.typedBuffer.buffer}};Vre.ElementCount=16;let Rv=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.stride=s,this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,i){this.typedBuffer[e*this.typedBufferStride]=i}get buffer(){return this.typedBuffer.buffer}};Rv.ElementCount=1;let Pv=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,li(i,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e]=i[1]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e]=r}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};Pv.ElementCount=2;let Dv=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,se(i,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e]=i[2]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,s){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e]=s}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};Dv.ElementCount=3;let Lv=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.start=r,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,es(i,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e++]=i[2],this.typedBuffer[e]=i[3]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,s,n){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e++]=s,this.typedBuffer[e]=n}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};Lv.ElementCount=4;let zj=class yRe extends Rv{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}static fromTypedArray(e,i){return new yRe(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};zj.ElementType="f32";let Uj=class FY extends Pv{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(FY,e,i)}static fromTypedArray(e,i){return new FY(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Uj.ElementType="f32";let uS=class kY extends Dv{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(kY,e,i)}static fromTypedArray(e,i){return new kY(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};uS.ElementType="f32";let r3=class zY extends Lv{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(zY,e,i)}static fromTypedArray(e,i){return new zY(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};r3.ElementType="f32";let jre=class UY extends Bre{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(UY,e,i)}static fromTypedArray(e,i){return new UY(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};jre.ElementType="f32";let Gre=class BY extends Bre{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(BY,e,i)}static fromTypedArray(e,i){return new BY(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Gre.ElementType="f64";let Hre=class VY extends Vre{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(VY,e,i)}static fromTypedArray(e,i){return new VY(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Hre.ElementType="f32";let qre=class jY extends Vre{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(jY,e,i)}static fromTypedArray(e,i){return new jY(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};qre.ElementType="f64";let Wre=class GY extends Rv{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(GY,e,i)}static fromTypedArray(e,i){return new GY(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Wre.ElementType="f64";let Zre=class HY extends Pv{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(HY,e,i)}static fromTypedArray(e,i){return new HY(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Zre.ElementType="f64";let Yre=class qY extends Dv{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(qY,e,i)}static fromTypedArray(e,i){return new qY(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Yre.ElementType="f64";let Jre=class WY extends Lv{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(WY,e,i)}static fromTypedArray(e,i){return new WY(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Jre.ElementType="f64";let Xre=class ZY extends Rv{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(ZY,e,i)}static fromTypedArray(e,i){return new ZY(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Xre.ElementType="u8";let Kre=class YY extends Pv{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(YY,e,i)}static fromTypedArray(e,i){return new YY(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Kre.ElementType="u8";let vRe=class JY extends Dv{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(JY,e,i)}static fromTypedArray(e,i){return new JY(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};vRe.ElementType="u8";let Qm=class XY extends Lv{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(XY,e,i)}static fromTypedArray(e,i){return new XY(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Qm.ElementType="u8";let Qre=class KY extends Rv{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(KY,e,i)}static fromTypedArray(e,i){return new KY(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Qre.ElementType="u16";let _Re=class QY extends Pv{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(QY,e,i)}static fromTypedArray(e,i){return new QY(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};_Re.ElementType="u16";let bRe=class eJ extends Dv{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(eJ,e,i)}static fromTypedArray(e,i){return new eJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};bRe.ElementType="u16";let ese=class tJ extends Lv{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(tJ,e,i)}static fromTypedArray(e,i){return new tJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ese.ElementType="u16";let tse=class iJ extends Rv{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(iJ,e,i)}static fromTypedArray(e,i){return new iJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};tse.ElementType="u32";let wRe=class rJ extends Pv{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(rJ,e,i)}static fromTypedArray(e,i){return new rJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};wRe.ElementType="u32";let xRe=class sJ extends Dv{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(sJ,e,i)}static fromTypedArray(e,i){return new sJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};xRe.ElementType="u32";let SRe=class nJ extends Lv{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(nJ,e,i)}static fromTypedArray(e,i){return new nJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};SRe.ElementType="u32";let ise=class oJ extends Rv{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(oJ,e,i)}static fromTypedArray(e,i){return new oJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ise.ElementType="i8";let rse=class aJ extends Pv{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(aJ,e,i)}static fromTypedArray(e,i){return new aJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};rse.ElementType="i8";let TRe=class lJ extends Dv{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(lJ,e,i)}static fromTypedArray(e,i){return new lJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};TRe.ElementType="i8";let ERe=class cJ extends Lv{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(cJ,e,i)}static fromTypedArray(e,i){return new cJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ERe.ElementType="i8";let CRe=class uJ extends Rv{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(uJ,e,i)}static fromTypedArray(e,i){return new uJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};CRe.ElementType="i16";let Bj=class hJ extends Pv{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(hJ,e,i)}static fromTypedArray(e,i){return new hJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Bj.ElementType="i16";let $Re=class dJ extends Dv{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(dJ,e,i)}static fromTypedArray(e,i){return new dJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};$Re.ElementType="i16";let ARe=class pJ extends Lv{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(pJ,e,i)}static fromTypedArray(e,i){return new pJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ARe.ElementType="i16";let MRe=class fJ extends Rv{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(fJ,e,i)}static fromTypedArray(e,i){return new fJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};MRe.ElementType="i32";let ORe=class mJ extends Pv{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(mJ,e,i)}static fromTypedArray(e,i){return new mJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ORe.ElementType="i32";let IRe=class gJ extends Dv{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(gJ,e,i)}static fromTypedArray(e,i){return new gJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};IRe.ElementType="i32";let RRe=class yJ extends Lv{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(yJ,e,i)}static fromTypedArray(e,i){return new yJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};RRe.ElementType="i32";function Xde(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}let Kde=class PRe{constructor(e,i){this.layout=e,this.buffer=typeof i=="number"?new ArrayBuffer(i*e.stride):i;for(const r of e.fields.keys()){const s=e.fields.get(r);this[r]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,i){const r=this[e];return r&&r.elementCount===i.ElementCount&&r.elementType===i.ElementType?r:null}slice(e,i){return new PRe(this.layout,this.buffer.slice(e*this.stride,i*this.stride))}copyFrom(e,i=0,r=0,s=e.count){const n=this.stride;if(n%4==0){const o=new Uint32Array(e.buffer,i*n,s*n/4);new Uint32Array(this.buffer,r*n,s*n/4).set(o)}else{const o=new Uint8Array(e.buffer,i*n,s*n);new Uint8Array(this.buffer,r*n,s*n).set(o)}return this}get cachedMemory(){return this.byteLength}dispose(){}},qht=class DRe{constructor(e){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach(i=>this._fields.set(i[0],{...i[1],constructor:Zht(i[1].constructor)})))}freeze(){return this}vec2f(e,i){return this._appendField(e,Uj,i),this}vec2f64(e,i){return this._appendField(e,Zre,i),this}vec3f(e,i){return this._appendField(e,uS,i),this}vec3f64(e,i){return this._appendField(e,Yre,i),this}vec4f(e,i){return this._appendField(e,r3,i),this}vec4f64(e,i){return this._appendField(e,Jre,i),this}mat3f(e,i){return this._appendField(e,jre,i),this}mat3f64(e,i){return this._appendField(e,Gre,i),this}mat4f(e,i){return this._appendField(e,Hre,i),this}mat4f64(e,i){return this._appendField(e,qre,i),this}vec4u8(e,i){return this._appendField(e,Qm,i),this}f32(e,i){return this._appendField(e,zj,i),this}f64(e,i){return this._appendField(e,Wre,i),this}u8(e,i){return this._appendField(e,Xre,i),this}u16(e,i){return this._appendField(e,Qre,i),this}i8(e,i){return this._appendField(e,ise,i),this}vec2i8(e,i){return this._appendField(e,rse,i),this}vec2i16(e,i){return this._appendField(e,Bj,i),this}vec2u8(e,i){return this._appendField(e,Kre,i),this}vec4u16(e,i){return this._appendField(e,ese,i),this}u32(e,i){return this._appendField(e,tse,i),this}_appendField(e,i,r){if(this._fields.has(e))return void jt(!1,`${e} already added to vertex buffer layout`);const s=i.ElementCount*Xde(i.ElementType),n=this._stride;this._stride+=s,this._fields.set(e,{size:s,constructor:i,offset:n,optional:r})}createBuffer(e){return new Kde(this,e)}createView(e){return new Kde(this,e)}clone(){const e=new DRe;return e._stride=this._stride,e._fields=new Map,this._fields.forEach((i,r)=>e._fields.set(r,i)),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach(i=>e=Math.max(e,Xde(i.constructor.ElementType))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}};function Nd(){return new qht}let gXt=class{constructor(e){this.fields=new Array,e.fields.forEach((i,r)=>{const s={...i,constructor:LRe(i.constructor)};this.fields.push([r,s])}),this.stride=e.stride}};const Wht=[zj,Uj,uS,r3,jre,Hre,Wre,Zre,Yre,Jre,Gre,qre,Xre,Kre,vRe,Qm,Qre,_Re,bRe,ese,tse,wRe,xRe,SRe,ise,rse,TRe,ERe,CRe,Bj,$Re,ARe,MRe,ORe,IRe,RRe];function LRe(t){return`${t.ElementType}_${t.ElementCount}`}function Zht(t){return NRe.get(t)}const NRe=new Map;Wht.forEach(t=>NRe.set(LRe(t),t));var Ws;function Uy(t,e){switch(e.textureCoordinateType){case Ws.Default:return t.attributes.add(z.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(E`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case Ws.Compressed:return t.attributes.add(z.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(E`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case Ws.Atlas:return t.attributes.add(z.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(z.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(E`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case Ws.None:return void t.vertex.code.add(E`void forwardTextureCoordinates() {}`);case Ws.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(Ws||(Ws={}));function Yht(t){t.fragment.code.add(E`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function Vj(t,e){const{textureCoordinateType:i}=e;if(i===Ws.None||i===Ws.COUNT)return;t.include(Uy,e);const r=i===Ws.Atlas;r&&t.include(Yht),t.fragment.code.add(E`
    vec4 textureLookup(sampler2D tex, vec2 uv) {
      return ${r?"textureAtlasLookup(tex, uv, vuvRegion)":"texture(tex, uv)"};
    }
  `)}let $t=class extends or{constructor(e,i){super(e,"sampler2D",Pt.Pass,(r,s,n)=>r.bindTexture(e,i(s,n)))}},sse=class{constructor(e){this._material=e.material,this._techniques=e.techniques,this._output=e.output}dispose(){}get _stippleTextures(){return this._techniques.context.stippleTextures}get _markerTextures(){return this._techniques.context.markerTextures}getTechnique(e,i){return this._techniques.get(e,this._material.getConfiguration(this._output,i))}ensureResources(e){return Mb.LOADED}},Jht=class{};const ar=Jht,Xht=new ar;let FRe=class extends sse{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textures=e.textures,this.updateTexture(e.textureId),this._acquire(e.normalTextureId,i=>this._textureNormal=i),this._acquire(e.emissiveTextureId,i=>this._textureEmissive=i),this._acquire(e.occlusionTextureId,i=>this._textureOcclusion=i),this._acquire(e.metallicRoughnessTextureId,i=>this._textureMetallicRoughness=i)}dispose(){super.dispose(),this._texture=Dr(this._texture),this._textureNormal=Dr(this._textureNormal),this._textureEmissive=Dr(this._textureEmissive),this._textureOcclusion=Dr(this._textureOcclusion),this._textureMetallicRoughness=Dr(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?Mb.LOADED:Mb.LOADING}get textureBindParameters(){return new kRe(this._texture!=null?this._texture.glTexture:null,this._textureNormal!=null?this._textureNormal.glTexture:null,this._textureEmissive!=null?this._textureEmissive.glTexture:null,this._textureOcclusion!=null?this._textureOcclusion.glTexture:null,this._textureMetallicRoughness!=null?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){this._texture!=null&&e===this._texture.id||(this._texture=Dr(this._texture),this._textureId=e,this._acquire(this._textureId,i=>this._texture=i))}_acquire(e,i){if(e==null)return void i(null);const r=this._textures.acquire(e);if(nu(r))return++this._numLoading,void r.then(s=>{if(this._disposed)return Dr(s),void i(null);i(s)}).finally(()=>--this._numLoading);i(r)}},Kht=class extends ar{constructor(e=null){super(),this.textureEmissive=e}},kRe=class extends Kht{constructor(e=null,i=null,r=null,s=null,n=null,o,a){super(r),this.texture=e,this.textureNormal=i,this.textureOcclusion=s,this.textureMetallicRoughness=n,this.scale=o,this.normalTextureTransformMatrix=a}};var Jo;(function(t){t[t.None=0]="None",t[t.Value=1]="Value",t[t.Texture=2]="Texture",t[t.COUNT=3]="COUNT"})(Jo||(Jo={}));function Qht(t,e){if(!_s(e.output))return;const{emissionSource:i,hasEmissiveTextureTransform:r,bindType:s}=e,n=i===Jo.Texture;n&&(t.include(Vj,e),t.fragment.uniforms.add(s===Pt.Pass?new $t("texEmission",a=>a.textureEmissive):new Km("texEmission",a=>a.textureEmissive)));const o=i===Jo.Value||n;o&&t.fragment.uniforms.add(s===Pt.Pass?new Cr("emissionFactor",a=>a.emissiveFactor):new Qc("emissionFactor",a=>a.emissiveFactor)),t.fragment.code.add(E`
    vec4 getEmissions() {
      vec4 emissions = ${o?"vec4(emissionFactor, 1.0)":"vec4(0.0)"};
      ${Se(n,`emissions *= textureLookup(texEmission, ${r?"emissiveUV":"vuv0"});
         emissions.w = emissions.rgb == vec3(0.0) ? 0.0: emissions.w;`)}
      return emissions;
    }
  `)}function edt(t,e){const i=t.fragment;switch(i.code.add(E`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case eo.None:i.code.add(E`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case eo.View:i.code.add(E`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case eo.WindingOrder:i.code.add(E`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case eo.COUNT:}}var eo;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(eo||(eo={}));function TXt({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:i,roughnessFactor:r,emissiveTexture:s,emissiveFactor:n,occlusionTexture:o}){return t==null&&e==null&&s==null&&(n==null||Qn(n,on))&&o==null&&(r==null||r===1)&&(i==null||i===1)}function EXt({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:i,roughnessFactor:r,emissiveTexture:s,emissiveFactor:n,occlusionTexture:o}){return t==null&&e==null&&s==null&&(n==null||Qn(n,on))&&o==null&&(r==null||r===1)&&(i==null||i===1||i===0)}const zRe=hf(1,1,.5),CXt=hf(0,.6,.2),$Xt=hf(0,1,.2);var _t;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Simplified=5]="Simplified",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(_t||(_t={}));function nse(t,e){const i=e.pbrMode,r=t.fragment;if(i!==_t.Schematic&&i!==_t.Disabled&&i!==_t.Normal)return void r.code.add(E`void applyPBRFactors() {}`);if(i===_t.Disabled)return void r.code.add(E`void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`);if(i===_t.Schematic)return void r.code.add(E`vec3 mrr = vec3(0.0, 0.6, 0.2);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`);const{hasMetallicRoughnessTexture:s,hasMetallicRoughnessTextureTransform:n,hasOcclusionTexture:o,hasOcclusionTextureTransform:a,bindType:l}=e;(s||o)&&t.include(Vj,e),r.code.add(E`vec3 mrr;
float occlusion;`),s&&r.uniforms.add(l===Pt.Pass?new $t("texMetallicRoughness",c=>c.textureMetallicRoughness):new Km("texMetallicRoughness",c=>c.textureMetallicRoughness)),o&&r.uniforms.add(l===Pt.Pass?new $t("texOcclusion",c=>c.textureOcclusion):new Km("texOcclusion",c=>c.textureOcclusion)),r.uniforms.add(l===Pt.Pass?new Cr("mrrFactors",c=>c.mrrFactors):new Qc("mrrFactors",c=>c.mrrFactors)),r.code.add(E`
    ${Se(s,E`void applyMetallicRoughness(vec2 uv) {
            vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
            mrr[0] *= metallicRoughness.b;
            mrr[1] *= metallicRoughness.g;
          }`)}

    ${Se(o,"void applyOcclusion(vec2 uv) { occlusion *= textureLookup(texOcclusion, uv).r; }")}

    float getBakedOcclusion() {
      return ${o?"occlusion":"1.0"};
    }

    void applyPBRFactors() {
      mrr = mrrFactors;
      occlusion = 1.0;

      ${Se(s,`applyMetallicRoughness(${n?"metallicRoughnessUV":"vuv0"});`)}
      ${Se(o,`applyOcclusion(${a?"occlusionUV":"vuv0"});`)}
    }
  `)}const hg=new Map([[z.POSITION,0],[z.NORMAL,1],[z.NORMALCOMPRESSED,1],[z.UV0,2],[z.COLOR,3],[z.COLORFEATUREATTRIBUTE,3],[z.SIZE,4],[z.TANGENT,4],[z.CENTEROFFSETANDDISTANCE,5],[z.SYMBOLCOLOR,5],[z.FEATUREATTRIBUTE,6],[z.INSTANCEFEATUREATTRIBUTE,6],[z.INSTANCECOLOR,7],[z.OBJECTANDLAYERIDCOLOR,7],[z.INSTANCEOBJECTANDLAYERIDCOLOR,7],[z.ROTATION,8],[z.INSTANCEMODEL,8],[z.INSTANCEMODELNORMAL,12],[z.INSTANCEMODELORIGINHI,11],[z.INSTANCEMODELORIGINLO,15]]);function URe(t,e){return new jRe(t,HRe,e)}function tdt(t,e){const{curvatureDependent:i,scaleStart:r,scaleFallOffRange:s}=HRe;return new jRe(t,{curvatureDependent:{min:{curvature:i.min.curvature,tiltAngle:i.min.tiltAngle,scaleFallOffFactor:NH.curvatureDependent.min.scaleFallOffFactor},max:{curvature:i.max.curvature,tiltAngle:i.max.tiltAngle,scaleFallOffFactor:NH.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:s,minPixelSize:NH.minPixelSize},e)}function idt(t){return Math.abs(t*t*t)}function BRe(t,e,i){const r=i.parameters;return FH.scale=Math.min(r.divisor/(e-r.offset),1),FH.factor=idt(t),FH}function ose(t,e){return dt(t*Math.max(e.scale,e.minScaleFactor),t,e.factor)}function rdt(t,e,i){const r=BRe(t,e,i);return r.minScaleFactor=0,ose(1,r)}function Qde(t,e,i,r){r.scale=rdt(t,e,i),r.factor=0,r.minScaleFactor=i.minScaleFactor}function VRe(t,e,i=[0,0]){const r=Math.min(Math.max(e.scale,e.minScaleFactor),1);return i[0]=t[0]*r,i[1]=t[1]*r,i}function sdt(t,e,i,r){return ose(t,BRe(e,i,r))}let jRe=class GRe{get minScaleFactor(){return this._fontHeight!=null?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(e,i,r,s=ndt(),n){this._viewingMode=e,this._description=i,this._ellipsoidRadius=r,this.parameters=s,this._fontHeight=n,this._viewingMode===Be.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overrideFontHeight(e){return e!==this._fontHeight?new GRe(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,i,r){const{scaleStart:s,scaleFallOffRange:n}=this._description,{fovY:o,distance:a}=e,l=this._calculateCurvatureDependentParameters(e,i),c=this._coverageCompensation(e,i,l),{tiltAngle:h,scaleFallOffFactor:d}=l,f=Math.sin(h)*a,m=.5*Math.PI-h-o*(.5-s*c),y=f/Math.cos(m),v=m+o*n*c,_=(y-d*(f/Math.cos(v)))/(1-d);return r.camera.fovY=e.fovY,r.camera.distance=e.distance,r.offset=_,r.divisor=y-_,r}_calculateCurvatureDependentParametersLocal(e,i,r=epe){return r.tiltAngle=this._description.curvatureDependent.min.tiltAngle,r.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,r}_calculateCurvatureDependentParametersGlobal(e,i,r=epe){const s=this._description.curvatureDependent,n=1+e.distance/i,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=ce((o-a)/(l-a),0,1),[h,d]=[s.min,s.max];return r.tiltAngle=dt(h.tiltAngle,d.tiltAngle,c),r.scaleFallOffFactor=dt(h.scaleFallOffFactor,d.scaleFallOffFactor,c),r}_surfaceCoverageCompensationLocal(e,i,r){return VOe(r.tiltAngle,e.fovY)}_surfaceCoverageCompensationGlobal(e,i,r){return PA(tpe,i),yre(tpe,r.tiltAngle,e.distance,e.fovY)}};const HRe={curvatureDependent:{min:{curvature:wt(10),tiltAngle:wt(12),scaleFallOffFactor:.5},max:{curvature:wt(70),tiltAngle:wt(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},NH={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function ndt(){return{camera:{distance:0,fovY:0},divisor:0,offset:0}}const FH={scale:0,factor:0,minScaleFactor:0},epe={tiltAngle:0,scaleFallOffFactor:0},tpe=Rs();function qRe(t,e,i,r,s){let n=(i.screenLength||0)*t.pixelRatio;s!=null&&(n=sdt(n,r,e,s));const o=n*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return ce(o*e,i.minWorldLength||0,i.maxWorldLength!=null?i.maxWorldLength:1/0)}function ipe(t,e){let i=!1;for(const r in e){const s=e[r];s!==void 0&&(Array.isArray(s)?Array.isArray(t[r])&&Hm(s,t[r])||(t[r]=s.slice(),i=!0):t[r]!==s&&(i=!0,t[r]=s))}return i}const odt={multiply:1,ignore:2,replace:3,tint:4};let jj=class extends ID{constructor(e,i){super(),this.type=Nn.Material,this.supportsEdges=!1,this._renderPriority=0,this.vertexAttributeLocations=hg,this._pp0=Le(0,0,1),this._pp1=Le(0,0,0),this._parameters=new i,ipe(this._parameters,e),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e,i=!0){ipe(this._parameters,e)&&(this.validateParameters(this._parameters),i&&this._parametersChanged())}validateParameters(e){}shouldRender(e){return this.visible&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bind.decorations)&&!!(this.parameters.renderOccluded&e.renderOccludedMask)}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this._parametersChanged())}_parametersChanged(){this.repository?.materialChanged(this)}queryRenderOccludedState(e){return this.visible&&this.parameters.renderOccluded===e}get hasEmissions(){return!1}intersectDraped(e,i,r,s,n,o){return this._pp0[0]=this._pp1[0]=s[0],this._pp0[1]=this._pp1[1]=s[1],this.intersect(e,i,r,this._pp0,this._pp1,n)}};var Er;(function(t){t[t.None=0]="None",t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(Er||(Er={}));let adt=class extends ar{constructor(){super(...arguments),this.renderOccluded=Er.Occlude,this.isDecoration=!1}};var bi;(function(t){t[t.NONE=0]="NONE",t[t.ColorAlpha=1]="ColorAlpha",t[t.FrontFace=2]="FrontFace",t[t.COUNT=3]="COUNT"})(bi||(bi={}));function GS(t,e,i=uv.ADD,r=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function Yb(t,e,i,r,s=uv.ADD,n=uv.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:i,dstAlpha:r,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const ldt=GS(Ft.ZERO,Ft.ONE_MINUS_SRC_ALPHA),ase=GS(Ft.ONE,Ft.ZERO),cdt=GS(Ft.ONE,Ft.ONE),NA=GS(Ft.ONE,Ft.ONE_MINUS_SRC_ALPHA),Od=Yb(Ft.SRC_ALPHA,Ft.ONE,Ft.ONE_MINUS_SRC_ALPHA,Ft.ONE_MINUS_SRC_ALPHA),lse={face:Yu.BACK,mode:I$.CCW},udt={face:Yu.FRONT,mode:I$.CCW},WRe=t=>t===Tl.Back?lse:t===Tl.Front?udt:null,DD={zNear:0,zFar:1},Ai={r:!0,g:!0,b:!0,a:!0};function hdt(t){return bdt.intern(t)}function ddt(t){return wdt.intern(t)}function pdt(t){return xdt.intern(t)}function fdt(t){return Sdt.intern(t)}function mdt(t){return Tdt.intern(t)}function gdt(t){return Edt.intern(t)}function ydt(t){return Cdt.intern(t)}function vdt(t){return $dt.intern(t)}function _dt(t){return Adt.intern(t)}function _i(t){return Mdt.intern(t)}let dg=class{constructor(e,i){this._makeKey=e,this._makeRef=i,this._interns=new Map}intern(e){if(!e)return null;const i=this._makeKey(e),r=this._interns;return r.has(i)||r.set(i,this._makeRef(e)),r.get(i)??null}};function pg(t){return"["+t.join(",")+"]"}const bdt=new dg(ZRe,t=>({__tag:"Blending",...t}));function ZRe(t){return t?pg([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const wdt=new dg(YRe,t=>({__tag:"Culling",...t}));function YRe(t){return t?pg([t.face,t.mode]):null}const xdt=new dg(JRe,t=>({__tag:"PolygonOffset",...t}));function JRe(t){return t?pg([t.factor,t.units]):null}const Sdt=new dg(XRe,t=>({__tag:"DepthTest",...t}));function XRe(t){return t?pg([t.func]):null}const Tdt=new dg(KRe,t=>({__tag:"StencilTest",...t}));function KRe(t){return t?pg([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const Edt=new dg(QRe,t=>({__tag:"DepthWrite",...t}));function QRe(t){return t?pg([t.zNear,t.zFar]):null}const Cdt=new dg(ePe,t=>({__tag:"ColorWrite",...t}));function ePe(t){return t?pg([t.r,t.g,t.b,t.a]):null}const $dt=new dg(tPe,t=>({__tag:"StencilWrite",...t}));function tPe(t){return t?pg([t.mask]):null}const Adt=new dg(iPe,t=>({__tag:"DrawBuffers",...t}));function iPe(t){return t?pg(t.buffers):null}const Mdt=new dg(Odt,t=>({blending:hdt(t.blending),culling:ddt(t.culling),polygonOffset:pdt(t.polygonOffset),depthTest:fdt(t.depthTest),stencilTest:mdt(t.stencilTest),depthWrite:gdt(t.depthWrite),colorWrite:ydt(t.colorWrite),stencilWrite:vdt(t.stencilWrite),drawBuffers:_dt(t.drawBuffers)}));function Odt(t){return t?pg([ZRe(t.blending),YRe(t.culling),JRe(t.polygonOffset),XRe(t.depthTest),KRe(t.stencilTest),QRe(t.depthWrite),ePe(t.colorWrite),tPe(t.stencilWrite),iPe(t.drawBuffers)]):null}let Idt=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._setDrawBuffers(e.drawBuffers),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(e){this._drawBuffers=this._setSubState(e,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(e,i,r,s){return(r||e!==i)&&(s(e),this._pipelineInvalid=!0),e}};const rPe=Yb(Ft.ONE,Ft.ZERO,Ft.ONE,Ft.ONE_MINUS_SRC_ALPHA);function Rdt(t){return t===bi.FrontFace?null:rPe}function cse(t){switch(t){case bi.NONE:return Od;case bi.ColorAlpha:return rPe;case bi.FrontFace:case bi.COUNT:return null}}function sPe(t){if(t.draped)return null;switch(t.oitPass){case bi.NONE:case bi.FrontFace:return t.writeDepth?DD:null;case bi.ColorAlpha:case bi.COUNT:return null}}const Pdt=5e5,use={factor:-1,units:-2};function Ddt(t){return t?use:null}function hse(t,e=Ni.LESS){return t===bi.NONE||t===bi.FrontFace?e:Ni.LEQUAL}function Gj(t,e){const i=kre(e);return t===bi.ColorAlpha?i?{buffers:[rr.COLOR_ATTACHMENT0,rr.COLOR_ATTACHMENT1,rr.COLOR_ATTACHMENT2]}:{buffers:[rr.COLOR_ATTACHMENT0,rr.COLOR_ATTACHMENT1]}:i?{buffers:[rr.COLOR_ATTACHMENT0,rr.COLOR_ATTACHMENT1]}:null}let Hj=class{constructor(e=!1,i=!0){this.isVerticalRay=e,this.normalRequired=i}};const vN=ch();function Ldt(t,e,i,r,s,n){if(!t.visible)return;const o=Ri(cPe,r,i),a=(c,h,d)=>{n(c,d,h,!1)},l=new Hj(!1,e.options.normalRequired);if(t.boundingInfo){jt(t.type===Nn.Mesh);const c=e.tolerance;nPe(t.boundingInfo,i,o,c,s,l,a)}else{const c=t.attributes.get(z.POSITION),h=c.indices;aPe(i,o,0,h.length/3,h,c.data,c.stride,s,l,a)}}const Ndt=$();function nPe(t,e,i,r,s,n,o){if(t==null)return;const a=qdt(i,Ndt);if(zCe(vN,t.bbMin),UCe(vN,t.bbMax),s?.applyToAabb(vN),lPe(vN,e,a,r)){const{primitiveIndices:l,position:c}=t,h=l?l.length:c.indices.length/3;if(h>Wdt){const d=t.getChildren();if(d!==void 0){for(const f of d)nPe(f,e,i,r,s,n,o);return}}Udt(e,i,0,h,c.indices,c.data,c.stride,l,s,n,o)}}const W_=$();function Fdt(t,e,i,r,s,n,o,a,l){const{data:c,stride:h}=n;aPe(t,Ri(cPe,e,t),i,r,s,c,h,o,a,l)}function oPe(t,e,i,r,s,n,o,a,l,c=null,h=0){const d=t[0],f=t[1],m=t[2],y=e[0],v=e[1],_=e[2];for(let b=i;b<r;++b){const w=h+(c?c[b]:b),x=3*w,S=o*s[x],C=n[S],T=n[S+1],M=n[S+2],I=o*s[x+1],P=n[I],D=n[I+1],F=n[I+2],L=o*s[x+2],N=P-C,R=D-T,k=F-M,W=n[L]-C,G=n[L+1]-T,j=n[L+2]-M,re=v*j-G*_,ve=_*W-j*y,xe=y*G-W*v,De=N*re+R*ve+k*xe;if(Math.abs(De)<=Wj)continue;const Ke=d-C,je=f-T,ft=m-M,At=Ke*re+je*ve+ft*xe;if(De>0){if(At<0||At>De)continue}else if(At>0||At<De)continue;const ti=je*k-R*ft,Tt=ft*N-k*Ke,xt=Ke*R-N*je,kt=y*ti+v*Tt+_*xt;if(De>0){if(kt<0||At+kt>De)continue}else if(kt>0||At+kt<De)continue;const Et=(W*ti+G*Tt+j*xt)/De;Et>=0&&l(Et,w,a?qj(N,R,k,W,G,j,W_):null)}}function kdt(t,e,i,r,s,n,o,a){const l=t[0],c=t[1],h=t[2],d=e[0],f=e[1],m=e[2];for(let y=i;y<r;++y){const v=3*y,_=v+1,b=v+2,w=n*v,x=s[w],S=s[w+1],C=s[w+2],T=n*_,M=n*b,I=s[T]-x,P=s[T+1]-S,D=s[T+2]-C,F=s[M]-x,L=s[M+1]-S,N=s[M+2]-C,R=f*N-L*m,k=m*F-N*d,W=d*L-F*f,G=I*R+P*k+D*W;if(Math.abs(G)<=Wj)continue;const j=l-x,re=c-S,ve=h-C,xe=j*R+re*k+ve*W;if(G>0){if(xe<0||xe>G)continue}else if(xe>0||xe<G)continue;const De=re*D-P*ve,Ke=ve*I-D*j,je=j*P-I*re,ft=d*De+f*Ke+m*je;if(G>0){if(ft<0||xe+ft>G)continue}else if(ft>0||xe+ft<G)continue;const At=(F*De+L*Ke+N*je)/G;At>=0&&a(At,y,o?qj(I,P,D,F,L,N,W_):null)}}function zdt(t,e,i,r,s,n,o,a,l,c,h,d=null,f=0){const m=t[0],y=t[1],v=t[2],_=e[0],b=e[1],w=e[2];for(let x=i;x<r;++x){const S=f+(d?d[x]:x),C=3*S,T=o*s[C],M=n[T],I=n[T+1],P=n[T+2],D=o*s[C+1],F=n[D],L=n[D+1],N=n[D+2],R=o*s[C+2],k=n[R],W=n[R+1],G=n[R+2],j=P-l,re=a/Math.sqrt(M*M+I*I+j*j),ve=M+M*re,xe=I+I*re,De=P+j*re,Ke=N-l,je=a/Math.sqrt(F*F+L*L+Ke*Ke),ft=F+F*je,At=L+L*je,ti=N+Ke*je,Tt=G-l,xt=a/Math.sqrt(k*k+W*W+Tt*Tt),kt=ft-ve,Et=At-xe,Ht=ti-De,mt=k+k*xt-ve,_e=W+W*xt-xe,pe=G+Tt*xt-De,we=b*pe-_e*w,Re=w*mt-pe*_,tt=_*_e-mt*b,We=kt*we+Et*Re+Ht*tt;if(Math.abs(We)<=Wj)continue;const ii=m-ve,it=y-xe,Fe=v-De,Me=ii*we+it*Re+Fe*tt;if(We>0){if(Me<0||Me>We)continue}else if(Me>0||Me<We)continue;const Ct=it*Ht-Et*Fe,Xt=Fe*kt-Ht*ii,Ji=ii*Et-kt*it,Vi=_*Ct+b*Xt+w*Ji;if(We>0){if(Vi<0||Me+Vi>We)continue}else if(Vi>0||Me+Vi<We)continue;const Di=(mt*Ct+_e*Xt+pe*Ji)/We;Di>=0&&h(Di,S,c?qj(kt,Et,Ht,mt,_e,pe,W_):null)}}function Udt(t,e,i,r,s,n,o,a,l,c,h){const d=t[0],f=t[1],m=t[2],y=e[0],v=e[1],_=e[2],{normalRequired:b}=c;for(let w=i;w<r;++w){const x=a[w],S=3*x,C=o*s[S];let T=n[C],M=n[C+1],I=n[C+2];const P=o*s[S+1];let D=n[P],F=n[P+1],L=n[P+2];const N=o*s[S+2];let R=n[N],k=n[N+1],W=n[N+2];l!=null&&([T,M,I]=l.applyToVertex(T,M,I,w),[D,F,L]=l.applyToVertex(D,F,L,w),[R,k,W]=l.applyToVertex(R,k,W,w));const G=D-T,j=F-M,re=L-I,ve=R-T,xe=k-M,De=W-I,Ke=v*De-xe*_,je=_*ve-De*y,ft=y*xe-ve*v,At=G*Ke+j*je+re*ft;if(Math.abs(At)<=Wj)continue;const ti=d-T,Tt=f-M,xt=m-I,kt=ti*Ke+Tt*je+xt*ft;if(At>0){if(kt<0||kt>At)continue}else if(kt>0||kt<At)continue;const Et=Tt*re-j*xt,Ht=xt*G-re*ti,mt=ti*j-G*Tt,_e=y*Et+v*Ht+_*mt;if(At>0){if(_e<0||kt+_e>At)continue}else if(_e>0||kt+_e<At)continue;const pe=(ve*Et+xe*Ht+De*mt)/At;pe>=0&&h(pe,x,b?qj(G,j,re,ve,xe,De,W_):null)}}function aPe(t,e,i,r,s,n,o,a,l,c){const h=e,d=Zdt,f=Math.abs(h[0]),m=Math.abs(h[1]),y=Math.abs(h[2]),v=f>=m?f>=y?0:2:m>=y?1:2,_=v,b=h[_]<0?2:1,w=(v+b)%3,x=(v+(3-b))%3,S=h[w]/h[_],C=h[x]/h[_],T=1/h[_],M=Bdt,I=Vdt,P=jdt,{normalRequired:D}=l;for(let F=i;F<r;++F){const L=3*F,N=o*s[L];se(d[0],n[N+0],n[N+1],n[N+2]);const R=o*s[L+1];se(d[1],n[R+0],n[R+1],n[R+2]);const k=o*s[L+2];se(d[2],n[k+0],n[k+1],n[k+2]),a&&(ne(d[0],a.applyToVertex(d[0][0],d[0][1],d[0][2],F)),ne(d[1],a.applyToVertex(d[1][0],d[1][1],d[1][2],F)),ne(d[2],a.applyToVertex(d[2][0],d[2][1],d[2][2],F))),Ri(M,d[0],t),Ri(I,d[1],t),Ri(P,d[2],t);const W=M[w]-S*M[_],G=M[x]-C*M[_],j=I[w]-S*I[_],re=I[x]-C*I[_],ve=P[w]-S*P[_],xe=P[x]-C*P[_],De=ve*re-xe*j,Ke=W*xe-G*ve,je=j*G-re*W;if((De<0||Ke<0||je<0)&&(De>0||Ke>0||je>0))continue;const ft=De+Ke+je;if(ft===0)continue;const At=De*(T*M[_])+Ke*(T*I[_])+je*(T*P[_]);if(At*Math.sign(ft)<0)continue;const ti=At/ft;ti>=0&&c(ti,F,D?Gdt(d):null)}}const Bdt=$(),Vdt=$(),jdt=$();function qj(t,e,i,r,s,n,o){return se(kU,t,e,i),se(zU,r,s,n),lt(o,kU,zU),ae(o,o),o}function Gdt(t){return Ri(kU,t[1],t[0]),Ri(zU,t[2],t[0]),lt(W_,kU,zU),ae(W_,W_),W_}const kU=$(),zU=$();function Hdt(t,e,i){return se(i,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function qdt(t,e){return se(e,1/t[0],1/t[1],1/t[2])}function lPe(t,e,i,r){return dse(t,e,i,r,1/0)}function dse(t,e,i,r,s){const n=(t[0]-r-e[0])*i[0],o=(t[3]+r-e[0])*i[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(t[1]-r-e[1])*i[1],h=(t[4]+r-e[1])*i[1];if(l=Math.min(l,Math.max(c,h)),l<0||(a=Math.max(a,Math.min(c,h)),a>l))return!1;const d=(t[2]-r-e[2])*i[2],f=(t[5]+r-e[2])*i[2];return l=Math.min(l,Math.max(d,f)),!(l<0)&&(a=Math.max(a,Math.min(d,f)),!(a>l)&&a<s)}const Wdt=1e3,Wj=1e-7,cPe=$(),Zdt=[$(),$(),$()];var be;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.OPAQUE_MATERIAL_WITHOUT_NORMALS=3]="OPAQUE_MATERIAL_WITHOUT_NORMALS",t[t.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_MATERIAL_WITHOUT_NORMALS=5]="TRANSPARENT_MATERIAL_WITHOUT_NORMALS",t[t.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_MATERIAL_WITHOUT_DEPTH=7]="TRANSPARENT_MATERIAL_WITHOUT_DEPTH",t[t.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS",t[t.HUD_MATERIAL=12]="HUD_MATERIAL",t[t.LABEL_MATERIAL=13]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=14]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=15]="LINE_CALLOUTS_HUD_DEPTH",t[t.OVERLAY=16]="OVERLAY",t[t.DRAPED_MATERIAL=17]="DRAPED_MATERIAL",t[t.DRAPED_WATER=18]="DRAPED_WATER",t[t.VOXEL=19]="VOXEL",t[t.MAX_SLOTS=20]="MAX_SLOTS"})(be||(be={}));function Ydt(t,e,i,r=1){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(i*=a,r===1)for(let c=0;c<l;++c)o[i]=s[n[c]],i+=a;else for(let c=0;c<l;++c){const h=s[n[c]];for(let d=0;d<r;d++)o[i]=h,i+=a}}function rpe(t,e,i){const{data:r,indices:s}=t,n=e.typedBuffer,o=e.typedBufferStride,a=s.length;i*=o;for(let l=0;l<a;++l){const c=2*s[l];n[i]=r[c],n[i+1]=r[c+1],i+=o}}function uPe(t,e,i,r){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(i*=a,r==null||r===1)for(let c=0;c<l;++c){const h=3*n[c];o[i]=s[h],o[i+1]=s[h+1],o[i+2]=s[h+2],i+=a}else for(let c=0;c<l;++c){const h=3*n[c];for(let d=0;d<r;++d)o[i]=s[h],o[i+1]=s[h+1],o[i+2]=s[h+2],i+=a}}function s3(t,e,i,r=1){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(i*=a,r===1)for(let c=0;c<l;++c){const h=4*n[c];o[i]=s[h],o[i+1]=s[h+1],o[i+2]=s[h+2],o[i+3]=s[h+3],i+=a}else for(let c=0;c<l;++c){const h=4*n[c];for(let d=0;d<r;++d)o[i]=s[h],o[i+1]=s[h+1],o[i+2]=s[h+2],o[i+3]=s[h+3],i+=a}}function spe(t,e,i){const r=t.typedBuffer,s=t.typedBufferStride;e*=s;for(let n=0;n<i;++n)r[e]=0,r[e+1]=0,r[e+2]=0,r[e+3]=0,e+=s}function pse(t,e,i,r,s=1){if(!e)return void uPe(t,i,r,s);const{data:n,indices:o}=t,a=i.typedBuffer,l=i.typedBufferStride,c=o.length,h=e[0],d=e[1],f=e[2],m=e[4],y=e[5],v=e[6],_=e[8],b=e[9],w=e[10],x=e[12],S=e[13],C=e[14];r*=l;let T=0,M=0,I=0;const P=GV(e)?D=>{T=n[D]+x,M=n[D+1]+S,I=n[D+2]+C}:D=>{const F=n[D],L=n[D+1],N=n[D+2];T=h*F+m*L+_*N+x,M=d*F+y*L+b*N+S,I=f*F+v*L+w*N+C};if(s===1)for(let D=0;D<c;++D)P(3*o[D]),a[r]=T,a[r+1]=M,a[r+2]=I,r+=l;else for(let D=0;D<c;++D){P(3*o[D]);for(let F=0;F<s;++F)a[r]=T,a[r+1]=M,a[r+2]=I,r+=l}}function fse(t,e,i,r,s=1){if(!e)return void uPe(t,i,r,s);const{data:n,indices:o}=t,a=e,l=i.typedBuffer,c=i.typedBufferStride,h=o.length,d=a[0],f=a[1],m=a[2],y=a[4],v=a[5],_=a[6],b=a[8],w=a[9],x=a[10],S=!Jte(a),C=1e-6,T=1-C;r*=c;let M=0,I=0,P=0;const D=GV(a)?F=>{M=n[F],I=n[F+1],P=n[F+2]}:F=>{const L=n[F],N=n[F+1],R=n[F+2];M=d*L+y*N+b*R,I=f*L+v*N+w*R,P=m*L+_*N+x*R};if(s===1)if(S)for(let F=0;F<h;++F){D(3*o[F]);const L=M*M+I*I+P*P;if(L<T&&L>C){const N=1/Math.sqrt(L);l[r]=M*N,l[r+1]=I*N,l[r+2]=P*N}else l[r]=M,l[r+1]=I,l[r+2]=P;r+=c}else for(let F=0;F<h;++F)D(3*o[F]),l[r]=M,l[r+1]=I,l[r+2]=P,r+=c;else for(let F=0;F<h;++F){if(D(3*o[F]),S){const L=M*M+I*I+P*P;if(L<T&&L>C){const N=1/Math.sqrt(L);M*=N,I*=N,P*=N}}for(let L=0;L<s;++L)l[r]=M,l[r+1]=I,l[r+2]=P,r+=c}}function Jdt(t,e,i,r,s=1){if(!e)return void s3(t,i,r,s);const{data:n,indices:o}=t,a=e,l=i.typedBuffer,c=i.typedBufferStride,h=o.length,d=a[0],f=a[1],m=a[2],y=a[4],v=a[5],_=a[6],b=a[8],w=a[9],x=a[10],S=!Jte(a),C=1e-6,T=1-C;if(r*=c,s===1)for(let M=0;M<h;++M){const I=4*o[M],P=n[I],D=n[I+1],F=n[I+2],L=n[I+3];let N=d*P+y*D+b*F,R=f*P+v*D+w*F,k=m*P+_*D+x*F;if(S){const W=N*N+R*R+k*k;if(W<T&&W>C){const G=1/Math.sqrt(W);N*=G,R*=G,k*=G}}l[r]=N,l[r+1]=R,l[r+2]=k,l[r+3]=L,r+=c}else for(let M=0;M<h;++M){const I=4*o[M],P=n[I],D=n[I+1],F=n[I+2],L=n[I+3];let N=d*P+y*D+b*F,R=f*P+v*D+w*F,k=m*P+_*D+x*F;if(S){const W=N*N+R*R+k*k;if(W<T&&W>C){const G=1/Math.sqrt(W);N*=G,R*=G,k*=G}}for(let W=0;W<s;++W)l[r]=N,l[r+1]=R,l[r+2]=k,l[r+3]=L,r+=c}}function hPe(t,e,i,r,s=1){const{data:n,indices:o}=t,a=i.typedBuffer,l=i.typedBufferStride,c=o.length;if(r*=l,e!==n.length||e!==4)if(s!==1)if(e!==4)for(let h=0;h<c;++h){const d=3*o[h];for(let f=0;f<s;++f)a[r]=n[d],a[r+1]=n[d+1],a[r+2]=n[d+2],a[r+3]=255,r+=l}else for(let h=0;h<c;++h){const d=4*o[h];for(let f=0;f<s;++f)a[r]=n[d],a[r+1]=n[d+1],a[r+2]=n[d+2],a[r+3]=n[d+3],r+=l}else{if(e===4){for(let h=0;h<c;++h){const d=4*o[h];a[r]=n[d],a[r+1]=n[d+1],a[r+2]=n[d+2],a[r+3]=n[d+3],r+=l}return}for(let h=0;h<c;++h){const d=3*o[h];a[r]=n[d],a[r+1]=n[d+1],a[r+2]=n[d+2],a[r+3]=255,r+=l}}else{a[r]=n[0],a[r+1]=n[1],a[r+2]=n[2],a[r+3]=n[3];const h=new Uint32Array(i.typedBuffer.buffer,i.start),d=l/4,f=h[r/=4];r+=d;const m=c*s;for(let y=1;y<m;++y)h[r]=f,r+=d}}function Xdt(t,e,i){const{data:r,indices:s}=t,n=e.typedBuffer,o=e.typedBufferStride,a=s.length,l=r[0];i*=o;for(let c=0;c<a;++c)n[i]=l,i+=o}function dPe(t,e,i,r,s=1){const n=e.typedBuffer,o=e.typedBufferStride;if(r*=o,s===1)for(let a=0;a<i;++a)n[r]=t[0],n[r+1]=t[1],n[r+2]=t[2],n[r+3]=t[3],r+=o;else for(let a=0;a<i;++a)for(let l=0;l<s;++l)n[r]=t[0],n[r+1]=t[1],n[r+2]=t[2],n[r+3]=t[3],r+=o}function Kdt(t,e,i,r,s,n,o){for(const a of i.fields.keys()){const l=t.get(a),c=l?.indices;if(l&&c)Qdt(a,l,r,s,n,o);else if(a===z.OBJECTANDLAYERIDCOLOR&&e!=null){const h=t.get(z.POSITION)?.indices;if(h){const d=h.length;dPe(e,n.getField(a,Qm),d,o)}}}}function Qdt(t,e,i,r,s,n){switch(t){case z.POSITION:{jt(e.size===3);const o=s.getField(t,uS);jt(!!o,`No buffer view for ${t}`),o&&pse(e,i,o,n);break}case z.NORMAL:{jt(e.size===3);const o=s.getField(t,uS);jt(!!o,`No buffer view for ${t}`),o&&fse(e,r,o,n);break}case z.NORMALCOMPRESSED:{jt(e.size===2);const o=s.getField(t,Bj);jt(!!o,`No buffer view for ${t}`),o&&rpe(e,o,n);break}case z.UV0:{jt(e.size===2);const o=s.getField(t,Uj);jt(!!o,`No buffer view for ${t}`),o&&rpe(e,o,n);break}case z.COLOR:case z.SYMBOLCOLOR:{const o=s.getField(t,Qm);jt(!!o,`No buffer view for ${t}`),jt(e.size===3||e.size===4),!o||e.size!==3&&e.size!==4||hPe(e,e.size,o,n);break}case z.COLORFEATUREATTRIBUTE:{const o=s.getField(t,zj);jt(!!o,`No buffer view for ${t}`),jt(e.size===1),o&&e.size===1&&Xdt(e,o,n);break}case z.TANGENT:{jt(e.size===4);const o=s.getField(t,r3);jt(!!o,`No buffer view for ${t}`),o&&Jdt(e,i,o,n);break}case z.PROFILERIGHT:case z.PROFILEUP:case z.PROFILEVERTEXANDNORMAL:case z.FEATUREVALUE:{jt(e.size===4);const o=s.getField(t,r3);jt(!!o,`No buffer view for ${t}`),o&&s3(e,o,n)}}}let ept=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.get(z.POSITION).indices.length}write(e,i,r,s,n,o){Kdt(r,s,this.vertexBufferLayout,e,i,n,o)}intersect(e,i,r,s,n){const o=this.vertexBufferLayout.createView(e).getField(z.POSITION,uS);if(o==null)return;const a=Ri(tpt,s,r),l=0,c=o.elementCount/3,h=i.options.normalRequired,d=(f,m,y)=>{n(f,y,m,!1)};kdt(r,a,l,c,o.typedBuffer,o.typedBufferStride,h,d)}};const tpt=$();function Zj(t){t.attributes.add(z.POSITION,"vec3"),t.vertex.code.add(E`vec3 positionModel() { return position; }`)}let mse=class extends or{constructor(e,i){super(e,"mat4",Pt.Pass,(r,s,n)=>r.setUniformMatrix4fv(e,i(s,n)))}};function PR(t,e){t.include(Zj);const i=t.vertex;i.include(Ure,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),i.uniforms.add(new Cr("transformWorldFromViewTH",r=>r.transformWorldFromViewTH),new Cr("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new Ld("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new mse("transformProjFromView",r=>r.transformProjFromView),new FU("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new Qc("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new Qc("transformWorldFromModelTL",r=>r.transformWorldFromModelTL)),i.code.add(E`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),i.code.add(E`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?E`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:E`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new Cr("transformWorldFromViewTL",r=>r.transformWorldFromViewTL)),i.code.add(E`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(E`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let ipt=class extends ar{constructor(){super(...arguments),this.transformWorldFromViewTH=$(),this.transformWorldFromViewTL=$(),this.transformViewFromCameraRelativeRS=xs(),this.transformProjFromView=Ve()}},rpt=class extends ar{constructor(){super(...arguments),this.transformWorldFromModelRS=xs(),this.transformWorldFromModelTH=$(),this.transformWorldFromModelTL=$()}};function Yj(t,e){switch(e.normalType){case Fr.Attribute:case Fr.Compressed:t.include(LA,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add(new FU("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel),new Ld("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)),t.vertex.code.add(E`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case Fr.ScreenDerivative:t.vertex.code.add(E`void forwardNormal() {}`);break;default:e.normalType;case Fr.COUNT:}}let pPe=class extends ipt{constructor(){super(...arguments),this.transformNormalViewFromGlobal=xs()}},fPe=class extends rpt{constructor(){super(...arguments),this.transformNormalGlobalFromModel=xs(),this.toMapSpace=pi()}},Fi=class{constructor(e,i){this._module=e,this._load=i}get(){return this._module}async reload(){return this._module=await this._load(),this._module}},npe=class{constructor(e,i,r){this._context=e,this._locations=r,this._textures=new Map,this._freeTextureUnits=new Jt({deallocator:null}),this._glProgram=e.programCache.acquire(i.generate("vertex",!0),i.generate("fragment",!0),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bind=i.generateBind(this),this.bindPass=i.generateBindPass(this),this.bindDraw=i.generateBindDraw(this),this._fragmentUniforms=Op()?i.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(e,i){this._glProgram.setUniform1i(e,i?1:0)}setUniform1i(e,i){this._glProgram.setUniform1i(e,i)}setUniform1f(e,i){this._glProgram.setUniform1f(e,i)}setUniform2fv(e,i){this._glProgram.setUniform2fv(e,i)}setUniform3fv(e,i){this._glProgram.setUniform3fv(e,i)}setUniform4fv(e,i){this._glProgram.setUniform4fv(e,i)}setUniformMatrix3fv(e,i){this._glProgram.setUniformMatrix3fv(e,i)}setUniformMatrix4fv(e,i){this._glProgram.setUniformMatrix4fv(e,i)}setUniform1fv(e,i){this._glProgram.setUniform1fv(e,i)}setUniform1iv(e,i){this._glProgram.setUniform1iv(e,i)}setUniform2iv(e,i){this._glProgram.setUniform2iv(e,i)}setUniform3iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform4iv(e,i){this._glProgram.setUniform4iv(e,i)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,i){if(i?.glName==null){const s=this._textures.get(e);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(e)),null}let r=this._textures.get(e);return r==null?(r=this._allocTextureUnit(i),this._textures.set(e,r)):r.texture=i,this._context.useProgram(this),this.setUniform1i(e,r.unit),this._context.bindTexture(i,r.unit),r.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((e,i)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(i,e.unit)}),this._fragmentUniforms?.forEach(e=>{e.type!=="sampler2D"&&e.type!=="samplerCube"||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};const spt=()=>J.getLogger("esri.views.3d.webgl.ShaderTechnique");let Bi=class{constructor(e,i,r,s=hg){this.locations=s,this.primitiveType=Ui.TRIANGLES,this.key=i.key,this._program=new npe(e.rctx,r.get().build(i),s),this._pipeline=this.initializePipeline(i),this.reload=async n=>{n&&await r.reload(),this.key.equals(i.key)||spt().warn("Configuration was changed after construction, cannot reload shader.",r),Rt(this._program),this._program=new npe(e.rctx,r.get().build(i),s),this._pipeline=this.initializePipeline(i)}}destroy(){this._program=Rt(this._program),this._pipeline=null}get program(){return this._program}get compiled(){return this.program.compiled}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}getPipeline(e,i){return this._pipeline}initializePipeline(e){return _i({blending:NA,colorWrite:Ai})}};const npt={func:Ni.LESS},ope={func:Ni.ALWAYS},UU={mask:255},opt={mask:0},apt=t=>({function:{func:Ni.NOTEQUAL,ref:t,mask:t},operation:{fail:Yi.KEEP,zFail:Yi.KEEP,zPass:Yi.KEEP}}),lpt=t=>({function:{func:Ni.ALWAYS,ref:t,mask:t},operation:{fail:Yi.KEEP,zFail:Yi.KEEP,zPass:Yi.REPLACE}}),gse={function:{func:Ni.ALWAYS,ref:oh.OutlineVisualElementMask,mask:oh.OutlineVisualElementMask},operation:{fail:Yi.KEEP,zFail:Yi.KEEP,zPass:Yi.ZERO}},vJ={function:{func:Ni.ALWAYS,ref:oh.OutlineVisualElementMask,mask:oh.OutlineVisualElementMask},operation:{fail:Yi.KEEP,zFail:Yi.KEEP,zPass:Yi.REPLACE}},cpt={function:{func:Ni.EQUAL,ref:oh.OutlineVisualElementMask,mask:oh.OutlineVisualElementMask},operation:{fail:Yi.KEEP,zFail:Yi.KEEP,zPass:Yi.KEEP}},upt={function:{func:Ni.NOTEQUAL,ref:oh.OutlineVisualElementMask,mask:oh.OutlineVisualElementMask},operation:{fail:Yi.KEEP,zFail:Yi.KEEP,zPass:Yi.KEEP}};let fv=class extends or{constructor(e,i){super(e,"vec2",Pt.Bind,(r,s)=>r.setUniform2fv(e,i(s)))}};function _J(t){t.varyings.add("linearDepth","float")}function yse(t){t.vertex.uniforms.add(new fv("nearFar",e=>e.camera.nearFar))}function mPe(t){t.vertex.code.add(E`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function Jj(t,e){const{vertex:i}=t;switch(e.output){case Y.Color:case Y.ColorEmission:if(e.receiveShadows)return _J(t),void i.code.add(E`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case Y.Shadow:case Y.ShadowHighlight:case Y.ShadowExcludeHighlight:case Y.ViewshedShadow:return t.include(PR,e),_J(t),yse(t),mPe(t),void i.code.add(E`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}i.code.add(E`void forwardLinearDepth() {}`)}function gPe(t){t.vertex.code.add(E`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}let jXt=class extends ar{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function hpt(t,e){_Pe(t,e,new Cr("slicePlaneOrigin",(i,r)=>vse(e,i,r)),new Cr("slicePlaneBasis1",(i,r)=>B$(e,i,r,r.slicePlane?.basis1)),new Cr("slicePlaneBasis2",(i,r)=>B$(e,i,r,r.slicePlane?.basis2)))}function Z_(t,e){_Pe(t,e,new Qc("slicePlaneOrigin",(i,r)=>vse(e,i,r)),new Qc("slicePlaneBasis1",(i,r)=>B$(e,i,r,r.slicePlane?.basis1)),new Qc("slicePlaneBasis2",(i,r)=>B$(e,i,r,r.slicePlane?.basis2)))}function yPe(t,e){vPe(t,e,new Qc("slicePlaneOrigin",(i,r)=>vse(e,i,r)),new Qc("slicePlaneBasis1",(i,r)=>B$(e,i,r,r.slicePlane?.basis1)),new Qc("slicePlaneBasis2",(i,r)=>B$(e,i,r,r.slicePlane?.basis2)))}const dpt=E`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
bool rejectBySlice(vec3 pos) {
return sliceByPlane(pos);
}`;function vPe(t,e,...i){e.hasSlicePlane?(t.uniforms.add(...i),t.code.add(dpt)):t.code.add("bool rejectBySlice(vec3 pos) { return false; }")}function _Pe(t,e,...i){vPe(t,e,...i),e.hasSlicePlane?t.code.add(`
    void discardBySlice(vec3 pos) {
      if (sliceByPlane(pos)) {
        discard;
      }
    }

    vec4 applySliceOutline(vec4 color, vec3 pos) {
      SliceFactors factors = calculateSliceFactors(pos);

      factors.front /= 2.0 * fwidth(factors.front);
      factors.side0 /= 2.0 * fwidth(factors.side0);
      factors.side1 /= 2.0 * fwidth(factors.side1);
      factors.side2 /= 2.0 * fwidth(factors.side2);
      factors.side3 /= 2.0 * fwidth(factors.side3);

      // return after calling fwidth, to avoid aliasing caused by discontinuities in the input to fwidth
      if (sliceByFactors(factors)) {
        return color;
      }

      float outlineFactor = (1.0 - step(0.5, factors.front))
        * (1.0 - step(0.5, factors.side0))
        * (1.0 - step(0.5, factors.side1))
        * (1.0 - step(0.5, factors.side2))
        * (1.0 - step(0.5, factors.side3));

      return mix(color, vec4(vec3(0.0), color.a), outlineFactor * 0.3);
    }

    vec4 applySlice(vec4 color, vec3 pos) {
      return sliceEnabled() ? applySliceOutline(color, pos) : color;
    }
  `):t.code.add(E`void discardBySlice(vec3 pos) { }
vec4 applySlice(vec4 color, vec3 pos) { return color; }`)}function bPe(t,e,i){return t.instancedDoublePrecision?se(ppt,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function wPe(t,e){return t!=null?ye(BU,e.origin,t):e.origin}function xPe(t,e,i){return t.hasSliceTranslatedView?e!=null?nh(fpt,i.camera.viewMatrix,e):i.camera.viewMatrix:null}function vse(t,e,i){if(i.slicePlane==null)return on;const r=bPe(t,e,i),s=wPe(r,i.slicePlane),n=xPe(t,r,i);return n!=null?st(BU,s,n):s}function B$(t,e,i,r){if(r==null||i.slicePlane==null)return on;const s=bPe(t,e,i),n=wPe(s,i.slicePlane),o=xPe(t,s,i);return o!=null?(oe(EM,r,n),st(BU,n,o),st(EM,EM,o),ye(EM,EM,BU)):r}const ppt=$(),BU=$(),EM=$(),fpt=Ve();function Y_(t){mPe(t),t.vertex.code.add(E`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(E`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let Ja=class extends or{constructor(e,i){super(e,"vec3",Pt.Bind,(r,s)=>r.setUniform3fv(e,i(s)))}},Fn=class extends or{constructor(e,i){super(e,"float",Pt.Bind,(r,s)=>r.setUniform1f(e,i(s)))}},_se=class extends or{constructor(e,i){super(e,"mat4",Pt.Draw,(r,s,n)=>r.setUniformMatrix4fv(e,i(s,n)))}};function Ib(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",on):t.uniforms.add(new Qc("cameraPosition",(i,r)=>se(SPe,r.camera.viewInverseTransposeMatrix[3]-i.origin[0],r.camera.viewInverseTransposeMatrix[7]-i.origin[1],r.camera.viewInverseTransposeMatrix[11]-i.origin[2])))}function By(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add(new Co("proj",r=>r.camera.projectionMatrix),new _se("view",(r,s)=>nh(ape,s.camera.viewMatrix,r.origin)),new Qc("localOrigin",r=>r.origin));const i=({camera:r})=>se(SPe,r.viewInverseTransposeMatrix[3],r.viewInverseTransposeMatrix[7],r.viewInverseTransposeMatrix[11]);t.uniforms.add(new Co("proj",r=>r.camera.projectionMatrix),new Co("view",r=>nh(ape,r.camera.viewMatrix,i(r))),new Ja("localOrigin",r=>i(r)))}const ape=Ve(),SPe=$();function VU(t){t.uniforms.add(new Co("viewNormal",e=>e.camera.viewInverseTransposeMatrix))}function LD(t){t.uniforms.add(new Fn("pixelRatio",e=>e.camera.pixelRatio/e.overlayStretch))}function bJ(t,e,i){for(let r=0;r<i;++r)e[2*r]=t[r],e[2*r+1]=t[r]-e[2*r]}function mpt(t,e){const i=t.length;for(let r=0;r<i;++r)G2[0]=t[r],e[r]=G2[0];return e}function gpt(t,e){const i=t.length;for(let r=0;r<i;++r)G2[0]=t[r],G2[1]=t[r]-G2[0],e[r]=G2[1];return e}const G2=new Float32Array(2),lpe=xs();function TPe(t,e){const i=e.hasModelTransformation,r=e.instancedDoublePrecision;i&&(t.vertex.uniforms.add(new mse("model",n=>n.modelTransformation??Kn)),t.vertex.uniforms.add(new Ld("normalLocalOriginFromModel",n=>(Iie(lpe,n.modelTransformation??Kn),lpe)))),e.instanced&&r&&(t.attributes.add(z.INSTANCEMODELORIGINHI,"vec3"),t.attributes.add(z.INSTANCEMODELORIGINLO,"vec3"),t.attributes.add(z.INSTANCEMODEL,"mat3"),t.attributes.add(z.INSTANCEMODELNORMAL,"mat3"));const s=t.vertex;r&&(s.include(Ure,e),s.uniforms.add(new Ja("viewOriginHi",n=>mpt(se(_N,n.camera.viewInverseTransposeMatrix[3],n.camera.viewInverseTransposeMatrix[7],n.camera.viewInverseTransposeMatrix[11]),_N)),new Ja("viewOriginLo",n=>gpt(se(_N,n.camera.viewInverseTransposeMatrix[3],n.camera.viewInverseTransposeMatrix[7],n.camera.viewInverseTransposeMatrix[11]),_N)))),s.code.add(E`
    vec3 getVertexInLocalOriginSpace() {
      return ${i?r?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":r?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${r?E`
          // Negated inputs are intentionally the first two arguments. The other way around the obfuscation in dpAdd() stopped
          // working for macOS 14+ and iOS 17+.
          // Issue: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(-instanceModelOriginHi, -instanceModelOriginLo, viewOriginHi, viewOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),s.code.add(E`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${i?r?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":r?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `),e.output===Y.Normal&&(VU(s),s.code.add(E`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${i?r?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":r?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `)),e.hasVertexTangents&&s.code.add(E`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${i?r?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":r?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)}const _N=$();let Jb=class extends or{constructor(e,i){super(e,"int",Pt.Pass,(r,s,n)=>r.setUniform1i(e,i(s,n)))}};function EPe(t,e){e.hasSymbolColors?(t.include(gRe),t.attributes.add(z.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(E`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new Jb("colorMixMode",i=>odt[i.colorMixMode])),t.vertex.code.add(E`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function Xj(t,e){e.hasVertexColors?(t.attributes.add(z.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(E`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(E`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(E`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function bse(t){t.vertex.code.add(E`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(E`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),t.vertex.code.add(E`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(E`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(E`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(E`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function ypt(t){t.uniforms.add(new Cr("screenSizePerspective",e=>CPe(e.screenSizePerspective)))}function Kj(t){t.uniforms.add(new Cr("screenSizePerspectiveAlignment",e=>CPe(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function CPe(t){return se(vpt,t.parameters.divisor,t.parameters.offset,t.minScaleFactor)}const vpt=$();let uc=class extends or{constructor(e,i){super(e,"vec4",Pt.Pass,(r,s,n)=>r.setUniform4fv(e,i(s,n)))}};function $Pe(t,e){const i=t.vertex;e.hasVerticalOffset?(APe(i),e.hasScreenSizePerspective&&(t.include(bse),Kj(i),Ib(t.vertex,e)),i.code.add(E`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?E`vec3 worldNormal = normalize(worldPos + localOrigin);`:E`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?E`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:E`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(E`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const _pt=pi();function APe(t){t.uniforms.add(new uc("verticalOffset",(e,i)=>{const{minWorldLength:r,maxWorldLength:s,screenLength:n}=e.verticalOffset,o=Math.tan(.5*i.camera.fovY)/(.5*i.camera.fullViewport[3]),a=i.camera.pixelRatio||1;return es(_pt,n*a,o,r,s)}))}function wse(t,e){if(e.output!==Y.ObjectAndLayerIdColor)return t.vertex.code.add(E`void forwardObjectAndLayerIdColor() {}`),void t.fragment.code.add(E`void outputObjectAndLayerIdColor() {}`);const i=e.objectAndLayerIdColorInstanced;t.varyings.add("objectAndLayerIdColorVarying","vec4"),t.attributes.add(i?z.INSTANCEOBJECTANDLAYERIDCOLOR:z.OBJECTANDLAYERIDCOLOR,"vec4"),t.vertex.code.add(E`
    void forwardObjectAndLayerIdColor() {
      objectAndLayerIdColorVarying = ${i?"instanceObjectAndLayerIdColor":"objectAndLayerIdColor"} * 0.003921568627451;
    }`),t.fragment.code.add(E`void outputObjectAndLayerIdColor() {
fragColor = objectAndLayerIdColorVarying;
}`)}function MPe(t){t.code.add(E`const float MAX_RGBA4_FLOAT =
15.0 / 16.0 +
15.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 / 16.0;
const vec4 FIXED_POINT_FACTORS_RGBA4 = vec4(1.0, 16.0, 16.0 * 16.0, 16.0 * 16.0 * 16.0);
vec4 floatToRgba4(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA4_FLOAT);
vec4 fixedPointU4 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS_RGBA4) * 16.0);
const float toU4AsFloat = 1.0 / 15.0;
return fixedPointU4 * toU4AsFloat;
}
const vec4 RGBA4_2_FLOAT_FACTORS = vec4(
15.0 / (16.0),
15.0 / (16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0 * 16.0)
);
float rgba4ToFloat(vec4 rgba) {
return dot(rgba, RGBA4_2_FLOAT_FACTORS);
}`)}function xse(t,e){switch(e.output){case Y.Shadow:case Y.ShadowHighlight:case Y.ShadowExcludeHighlight:case Y.ViewshedShadow:t.fragment.include(MPe),t.fragment.code.add(E`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth) {
fragColor = floatToRgba4(_calculateFragDepth(_linearDepth));
}`)}}function Qj(t){const{fragment:e}=t;e.code.add(E`uint readChannelBits(uint channel, int highlightLevel) {
int llc = (highlightLevel & 3) << 1;
return (channel >> llc) & 3u;
}
uint readChannel(vec2 texel, int highlightLevel) {
int lic = (highlightLevel >> 2) & 1;
return uint(texel[lic] * 255.0);
}
uint readLevelBits(vec2 texel, int highlightLevel) {
return readChannelBits(readChannel(texel, highlightLevel), highlightLevel);
}`)}let bpt=class extends or{constructor(e,i){super(e,"ivec2",Pt.Bind,(r,s)=>r.setUniform2iv(e,i(s)))}},Sse=class extends or{constructor(e,i){super(e,"int",Pt.Bind,(r,s)=>r.setUniform1i(e,i(s)))}},so=class extends or{constructor(e,i){super(e,"sampler2D",Pt.Bind,(r,s)=>r.bindTexture(e,i(s)))}};function ND(t,e){const{fragment:i}=t;e.output===Y.Highlight?(i.uniforms.add(new so("depthTexture",r=>r.mainDepth),new so("highlightTexture",r=>r.highlightMixTexture),new Sse("highlightLevel",r=>r.highlightLevel??0),new bpt("highlightMixOrigin",r=>r.highlightMixOrigin)),t.outputs.add("fragHighlight","vec2",0),t.include(Qj),i.code.add(E`vec2 getAccumulatedHighlight() {
return texelFetch(highlightTexture, ivec2(gl_FragCoord.xy) - highlightMixOrigin, 0).rg;
}
void outputHighlight(bool occluded) {
if (highlightLevel == 0) {
uint bits = occluded ? 3u : 1u;
fragHighlight = vec2(float(bits) / 255.0, 0.0);
} else {
int ll = (highlightLevel & 3) << 1;
int li = (highlightLevel >> 2) & 3;
uint bits;
if (occluded) {
bits = 3u << ll;
} else {
bits = 1u << ll;
}
vec2 combinedHighlight = getAccumulatedHighlight();
uint accumulatedI = uint(combinedHighlight[li] * 255.0);
combinedHighlight[li] = float(bits | accumulatedI) / 255.0;
fragHighlight = combinedHighlight;
}
}
bool isHighlightOccluded() {
float sceneDepth = texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x;
return gl_FragCoord.z > sceneDepth + 5e-7;
}
void calculateOcclusionAndOutputHighlight() {
outputHighlight(isHighlightOccluded());
}`),e.canHaveOverlay&&i.code.add(E`void calculateOcclusionAndOutputHighlightOverlay(vec2 highlightToAdd) {
uint levelBits = readLevelBits(highlightToAdd, highlightLevel);
if ((levelBits & 1u) == 0u) { discard; }
outputHighlight(isHighlightOccluded());
}`)):i.code.add(E`void calculateOcclusionAndOutputHighlight() {}`)}let wpt=class extends or{constructor(e,i,r){super(e,"vec4",Pt.Pass,(s,n,o)=>s.setUniform4fv(e,i(n,o)),r)}},hd=class extends or{constructor(e,i,r){super(e,"float",Pt.Pass,(s,n,o)=>s.setUniform1fv(e,i(n,o)),r)}},Fs=class extends ue{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};u([p()],Fs.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),u([p()],Fs.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),u([p()],Fs.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),u([p()],Fs.prototype,"DECONFLICTOR_SHOW_GRID",void 0),u([p()],Fs.prototype,"LABELS_SHOW_BORDER",void 0),u([p()],Fs.prototype,"TEXT_SHOW_BASELINE",void 0),u([p()],Fs.prototype,"TEXT_SHOW_BORDER",void 0),u([p()],Fs.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),u([p()],Fs.prototype,"OVERLAY_SHOW_CENTER",void 0),u([p()],Fs.prototype,"SHOW_POI",void 0),u([p()],Fs.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),u([p()],Fs.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),u([p()],Fs.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),u([p()],Fs.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),u([p()],Fs.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),u([p()],Fs.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),u([p()],Fs.prototype,"I3S_TREE_SHOW_TILES",void 0),u([p()],Fs.prototype,"I3S_SHOW_MODIFICATIONS",void 0),u([p()],Fs.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),u([p()],Fs.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),u([p()],Fs.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),u([p()],Fs.prototype,"LINE_WIREFRAMES",void 0),Fs=u([A("esri.views.3d.support.debugFlags")],Fs);const bs=new Fs;var Ga,cpe;(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(Ga||(Ga={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(cpe||(cpe={}));let Tse=class{constructor(e){this.field=e}},xpt=class extends Tse{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[Ga.Undefined,Ga.Undefined,Ga.Undefined]}},Spt=class extends Tse{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}},Tpt=class extends Tse{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},Ept=class{};function CM(t){return t!=null}function Cpt(t,e,i,r=Ve()){const s=t||0,n=e||0,o=i||0;return s!==0&&w$(r,r,-s/180*Math.PI),n!==0&&b$(r,r,n/180*Math.PI),o!==0&&VV(r,r,o/180*Math.PI),r}function a0(t,e,i,r,s){const n=t.minSize,o=t.maxSize;if(t.useSymbolValue){const a=r.symbolSize[i];return e.minSize[i]=a,e.maxSize[i]=a,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=Ga.DefinedSize,!0}if(CM(t.field))return CM(t.stops)?t.stops.length===2&&v_(t.stops[0].size)&&v_(t.stops[1].size)?(upe(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,i),e.type[i]=Ga.DefinedSize,!0):!1:v_(n)&&v_(o)&&CM(t.minDataValue)&&CM(t.maxDataValue)?(upe(n,o,t.minDataValue,t.maxDataValue,e,i),e.type[i]=Ga.DefinedSize,!0):t.valueUnit==="unknown"?!1:N$[t.valueUnit]!=null?(e.minSize[i]=-1/0,e.maxSize[i]=1/0,e.offset[i]=0,e.factor[i]=1/N$[t.valueUnit],e.type[i]=Ga.DefinedSize,!0):!1;if(!CM(t.field)){if(t.stops?.[0]&&v_(t.stops[0].size))return e.minSize[i]=t.stops[0].size,e.maxSize[i]=t.stops[0].size,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=Ga.DefinedSize,!0;if(v_(n))return e.minSize[i]=n,e.maxSize[i]=n,e.offset[i]=n,e.factor[i]=0,e.type[i]=Ga.DefinedSize,!0}return!1}function upe(t,e,i,r,s,n){const o=Math.abs(r-i)>0?(e-t)/(r-i):0;s.minSize[n]=o>0?t:e,s.maxSize[n]=o>0?e:t,s.offset[n]=t-i*o,s.factor[n]=o}function $pt(t,e,i,r){if(t.normalizationField||t.valueRepresentation||!nCe(t.field))return null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return null}else e.size.field=t.field}else e.size=new xpt(t.field);let s;switch(t.axis){case"width":return s=a0(t,e.size,0,i),s?e:null;case"height":return s=a0(t,e.size,2,i),s?e:null;case"depth":return s=a0(t,e.size,1,i),s?e:null;case"width-and-depth":return s=a0(t,e.size,0,i),s&&a0(t,e.size,1,i),s?e:null;case null:case void 0:case"all":return s=a0(t,e.size,0,i),s=s&&a0(t,e.size,1,i),s=s&&a0(t,e.size,2,i),s?e:null;default:return`${t.axis}`,null}}function Apt(t,e,i){for(let s=0;s<3;++s){let n=e.unitInMeters;t.type[s]===Ga.DefinedSize&&(n*=e.modelSize[s],t.type[s]=Ga.DefinedScale),t.minSize[s]=t.minSize[s]/n,t.maxSize[s]=t.maxSize[s]/n,t.offset[s]=t.offset[s]/n,t.factor[s]=t.factor[s]/n}let r;if(t.type[0]!==Ga.Undefined)r=0;else if(t.type[1]!==Ga.Undefined)r=1;else{if(t.type[2]===Ga.Undefined)return!1;r=2}for(let s=0;s<3;++s)t.type[s]===Ga.Undefined&&(t.minSize[s]=t.minSize[r],t.maxSize[s]=t.maxSize[r],t.offset[s]=t.offset[r],t.factor[s]=t.factor[r],t.type[s]=t.type[r]);return!0}function hpe(t,e,i){t[4*e]=i.r/255,t[4*e+1]=i.g/255,t[4*e+2]=i.b/255,t[4*e+3]=i.a}function Mpt(t,e,i){if(t.normalizationField)return null;if(Vb(t.field)){if(!t.stops)return null;{if(t.stops.length>8)return null;e.color=new Spt(t.field);const r=t.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];e.color.values[s]=n.value,hpe(e.color.colors,s,n.color)}}}else{if(!(t.stops&&t.stops.length>=0))return null;{const r=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.color.values[s]=1/0,hpe(e.color.colors,s,r)}}return e}function Opt(t,e,i){if(t.normalizationField)return null;if(Vb(t.field)){if(!t.stops)return null;{if(t.stops.length>8)return null;e.opacity=new Tpt(t.field);const r=t.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];e.opacity.values[s]=n.value,e.opacity.opacityValues[s]=n.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return null;{const r=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.opacity.values[s]=1/0,e.opacity.opacityValues[s]=r}}return e}function kH(t,e,i){const r=i===2&&t.rotationType==="arithmetic";e.offset[i]=r?90:0,e.factor[i]=r?-1:1,e.type[i]=1}function Ipt(t,e,i){if(!Vb(t.field))return null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return kH(t,e.rotation,0),e;case"roll":return kH(t,e.rotation,1),e;case null:case void 0:case"heading":return kH(t,e.rotation,2),e;default:return`${t.axis}`,null}}let aKt=class{constructor(e,i=[1,1,1],r=[1,1,1],s=1,n=[0,0,0],o=[1,1,1],a=[0,0,0]){this.supports=e,this.modelSize=i,this.symbolSize=r,this.unitInMeters=s,this.anchor=n,this.scale=o,this.rotation=a}};function OPe(t,e,i){if(!t)return null;const r=t.reduce((s,n)=>{if(!s)return s;if(n.valueExpression)return null;switch(n.type){case"size":return e.supports.size?$pt(n,s,e,i):s;case"color":return e.supports.color?Mpt(n,s):s;case"opacity":return e.supports.opacity?Opt(n,s):null;case"rotation":return e.supports.rotation?Ipt(n,s,i):s;default:return null}},new Ept);return!(t.length>0&&r)||r.size||r.color||r.opacity||r.rotation?r?.size&&!Apt(r.size,e)?null:r:null}let Rpt=class{constructor(e,i,r){this.visualVariables=e,this.materialParameters=i,this.requiresShaderTransformation=r}};function uKt(t,e){if(!t||bs.TESTS_DISABLE_FAST_UPDATES)return null;const i=OPe(t.visualVariables,e);return i?new Rpt(i,RPe(i,e),!!i.size):null}function hKt(t,e,i){if(!e||!t)return!1;const r=t.visualVariables,s=OPe(e.visualVariables,i);return!!s&&!!(bN(r.size,s.size,"size")&&bN(r.color,s.color,"color")&&bN(r.rotation,s.rotation,"rotation")&&bN(r.opacity,s.opacity,"opacity"))&&(t.visualVariables=s,t.materialParameters=RPe(s,i),t.requiresShaderTransformation=!!s.size,!0)}function bN(t,e,i){if(!!t!=!!e||t&&t.field!==e?.field)return!1;if(t&&i==="rotation"){const r=t,s=e;for(let n=0;n<3;n++)if(r.type[n]!==s.type[n]||r.offset[n]!==s.offset[n]||r.factor[n]!==s.factor[n])return!1}return!0}let IPe=class extends ar{constructor(e){super(),this.vvSize=e?.size??null,this.vvColor=e?.color??null,this.vvOpacity=e?.opacity??null}};function RPe(t,e){const i=new IPe(t);return i.vvSize&&(i.vvSymbolAnchor=e.anchor,pf(DR),Cpt(e.rotation[2],e.rotation[0],e.rotation[1],DR),i.vvSymbolRotationMatrix=i.vvSymbolRotationMatrix||xs(),FS(i.vvSymbolRotationMatrix,DR)),i}function pKt(t,e,i){if(!t.vvSize)return i;mn(l0,i);const r=t.vvSymbolRotationMatrix;lg(DR,r[0],r[1],r[2],0,r[3],r[4],r[5],0,r[6],r[7],r[8],0,0,0,0,1),kn(l0,l0,DR);for(let s=0;s<3;++s){const n=t.vvSize.offset[s]+e[0]*t.vvSize.factor[s];dpe[s]=ce(n,t.vvSize.minSize[s],t.vvSize.maxSize[s])}return $2e(l0,l0,dpe),nh(l0,l0,t.vvSymbolAnchor),l0}function Ppt(t,e,i){if(!e.vvSize)return se(t,1,1,1),t;for(let r=0;r<3;++r){const s=e.vvSize.offset[r]+i[0]*e.vvSize.factor[r];t[r]=ce(s,e.vvSize.minSize[r],e.vvSize.maxSize[r])}return t}function zH(t,e){const i=t==null?0:e.attributes[t];return typeof i=="number"&&isFinite(i)?i:0}const l0=Ve(),dpe=$(),DR=Ve();let Dpt=class extends IPe{constructor(){super(...arguments),this.renderOccluded=Er.Occlude,this.isDecoration=!1}};const UH=8;function Lx(t,e){const{vertex:i,attributes:r}=t;e.hasVvInstancing&&(e.vvSize||e.vvColor)&&r.add(z.INSTANCEFEATUREATTRIBUTE,"vec4"),e.vvSize?(i.uniforms.add(new Cr("vvSizeMinSize",s=>s.vvSize.minSize)),i.uniforms.add(new Cr("vvSizeMaxSize",s=>s.vvSize.maxSize)),i.uniforms.add(new Cr("vvSizeOffset",s=>s.vvSize.offset)),i.uniforms.add(new Cr("vvSizeFactor",s=>s.vvSize.factor)),i.uniforms.add(new Ld("vvSymbolRotationMatrix",s=>s.vvSymbolRotationMatrix)),i.uniforms.add(new Cr("vvSymbolAnchor",s=>s.vvSymbolAnchor)),i.code.add(E`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(E`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?E`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(E`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(i.constants.add("vvColorNumber","int",UH),i.uniforms.add(new hd("vvColorValues",s=>s.vvColor.values,UH),new wpt("vvColorColors",s=>s.vvColor.colors,UH)),i.code.add(E`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVvInstancing?E`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):i.code.add(E`vec4 vvColor() { return vec4(1.0); }`)}let PPe=class extends or{constructor(e,i){super(e,"float",Pt.Draw,(r,s,n)=>r.setUniform1f(e,i(s,n)))}},pt=class extends or{constructor(e,i){super(e,"float",Pt.Pass,(r,s,n)=>r.setUniform1f(e,i(s,n)))}};const Yr=1/255.5;function H2(t,e){DPe(t,e,new pt("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function Lpt(t,e){DPe(t,e,new PPe("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function DPe(t,e,i){const r=t.fragment,s=e.alphaDiscardMode,n=s===Dn.Blend;s!==Dn.Mask&&s!==Dn.MaskBlend||r.uniforms.add(i),r.code.add(E`
    void discardOrAdjustAlpha(inout vec4 color) {
      ${s===Dn.Opaque?"color.a = 1.0;":`if (color.a < ${n?E.float(Yr):"textureAlphaCutoff"}) {
              discard;
             } ${Se(s===Dn.Mask,"else { color.a = 1.0; }")}`}
    }
  `)}function LPe(t,e){const{vertex:i,fragment:r}=t,s=e.hasColorTexture&&e.alphaDiscardMode!==Dn.Opaque,{output:n,normalType:o,hasColorTextureTransform:a}=e;switch(n){case Y.Depth:By(i,e),t.include(Y_,e),t.fragment.include(Z_,e),t.include(Uy,e),s&&r.uniforms.add(new $t("tex",l=>l.texture)),i.main.add(E`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();`),t.include(H2,e),r.main.add(E`
        discardBySlice(vpos);
        ${Se(s,E`vec4 texColor = texture(tex, ${a?"colorUV":"vuv0"});
                discardOrAdjustAlpha(texColor);`)}`);break;case Y.Shadow:case Y.ShadowHighlight:case Y.ShadowExcludeHighlight:case Y.ViewshedShadow:case Y.ObjectAndLayerIdColor:By(i,e),t.include(Y_,e),t.include(Uy,e),t.include(Lx,e),t.include(xse,e),t.fragment.include(Z_,e),t.include(wse,e),yse(t),t.varyings.add("depth","float"),s&&r.uniforms.add(new $t("tex",l=>l.texture)),i.main.add(E`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
forwardTextureCoordinates();
forwardObjectAndLayerIdColor();`),t.include(H2,e),r.main.add(E`
        discardBySlice(vpos);
        ${Se(s,E`vec4 texColor = texture(tex, ${a?"colorUV":"vuv0"});
                discardOrAdjustAlpha(texColor);`)}
        ${n===Y.ObjectAndLayerIdColor?E`outputObjectAndLayerIdColor();`:E`outputDepth(depth);`}`);break;case Y.Normal:{By(i,e),t.include(Y_,e),t.include(LA,e),t.include(Yj,e),t.include(Uy,e),t.include(Lx,e),s&&r.uniforms.add(new $t("tex",c=>c.texture)),o===Fr.ScreenDerivative&&t.varyings.add("vPositionView","vec3");const l=o===Fr.Attribute||o===Fr.Compressed;i.main.add(E`
        vpos = getVertexInLocalOriginSpace();
        ${l?E`vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:E`vPositionView = (view * vec4(vpos, 1.0)).xyz;`}
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, vpos);
        forwardTextureCoordinates();`),t.fragment.include(Z_,e),t.include(H2,e),r.main.add(E`
        discardBySlice(vpos);
        ${Se(s,E`vec4 texColor = texture(tex, ${a?"colorUV":"vuv0"});
                discardOrAdjustAlpha(texColor);`)}

        ${o===Fr.ScreenDerivative?E`vec3 normal = screenDerivativeNormal(vPositionView);`:E`vec3 normal = normalize(vNormalWorld);
                    if (gl_FrontFacing == false){
                      normal = -normal;
                    }`}
        fragColor = vec4(0.5 + 0.5 * normal, 1.0);`);break}case Y.Highlight:By(i,e),t.include(Y_,e),t.include(Uy,e),t.include(Lx,e),s&&r.uniforms.add(new $t("tex",l=>l.texture)),i.main.add(E`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();`),t.fragment.include(Z_,e),t.include(H2,e),t.include(ND,e),r.main.add(E`
        discardBySlice(vpos);
        ${Se(s,E`vec4 texColor = texture(tex, ${a?"colorUV":"vuv0"});
                discardOrAdjustAlpha(texColor);`)}
        calculateOcclusionAndOutputHighlight();`)}}let fc=class extends or{constructor(e,i){super(e,"vec2",Pt.Pass,(r,s,n)=>r.setUniform2fv(e,i(s,n)))}};function NPe(t,e){const i=t.fragment;e.hasVertexTangents?(t.attributes.add(z.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===eo.WindingOrder?i.code.add(E`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(E`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):i.code.add(E`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),e.textureCoordinateType!==Ws.None&&(t.include(Vj,e),i.uniforms.add(e.bindType===Pt.Pass?new $t("normalTexture",r=>r.textureNormal):new Km("normalTexture",r=>r.textureNormal)),e.hasNormalTextureTransform&&(i.uniforms.add(new fc("scale",r=>r.scale??W$e)),i.uniforms.add(new Ld("normalTextureTransformMatrix",r=>r.normalTextureTransformMatrix??US))),i.code.add(E`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;`),e.hasNormalTextureTransform&&i.code.add(E`mat3 normalTextureRotation = mat3(normalTextureTransformMatrix[0][0]/scale[0], normalTextureTransformMatrix[0][1]/scale[1], 0.0,
normalTextureTransformMatrix[1][0]/scale[0], normalTextureTransformMatrix[1][1]/scale[1], 0.0,
0.0, 0.0, 0.0 );
rawNormal.xy = (normalTextureRotation * vec3(rawNormal.x, rawNormal.y, 1.0)).xy;`),i.code.add(E`return tangentSpace * rawNormal;
}`))}var tr,ut;(function(t){t.OPAQUE="opaque-color",t.TRANSPARENT="transparent-color",t.COMPOSITE="composite-color",t.FINAL="final-color"})(tr||(tr={})),function(t){t.SSAO="ssao",t.LASERLINES="laserline-color",t.ANTIALIASING="aa-color",t.HIGHLIGHTS="highlight-color",t.MAGNIFIER="magnifier-color",t.OCCLUDED="occluded-color",t.VIEWSHED="viewshed-color",t.OPAQUE_ENVIRONMENT="opaque-environment-color",t.TRANSPARENT_ENVIRONMENT="transparent-environment-color",t.FOCUSAREA="focus-area"}(ut||(ut={}));var fr,jo;(function(t){t[t.RED=0]="RED",t[t.RG=1]="RG",t[t.RGBA4=2]="RGBA4",t[t.RGBA=3]="RGBA",t[t.RGBA_MIPMAP=4]="RGBA_MIPMAP",t[t.R16F=5]="R16F",t[t.RGBA16F=6]="RGBA16F"})(fr||(fr={})),function(t){t[t.DEPTH_STENCIL_TEXTURE=0]="DEPTH_STENCIL_TEXTURE",t[t.DEPTH16_BUFFER=1]="DEPTH16_BUFFER"}(jo||(jo={}));let _1=class extends ue{constructor(e){super(e),this.view=null,this.consumes={required:[]},this.produces=tr.COMPOSITE,this.requireGeometryDepth=!1,this._dirty=!0}initialize(){this.addHandles([H(()=>this.view.ready,e=>{e&&this.view._stage?.renderer.addRenderNode(this)},Nt)])}destroy(){this.view._stage?.renderer?.removeRenderNode(this)}precompile(){}render(){throw new U("RenderNode:render-function-not-implemented","render() is not implemented.")}get camera(){return this.view.state.camera.clone()}get sunLight(){return this.bindParameters.lighting.legacy}get gl(){return this.view._stage.renderView.renderingContext.gl}get techniques(){return this.view._stage.renderView.techniques}acquireOutputFramebuffer(){const e=this._frameBuffer?.getTexture()?.descriptor,i=this.view._stage.renderer.fboCache.acquire(e?.width??640,e?.height??480,this.produces);return i.fbo?.initializeAndBind(),i}bindRenderTarget(){return this._frameBuffer?.fbo?.initializeAndBind(),this._frameBuffer}requestRender(e){e===bt.UPDATE&&this.view._stage?.renderView.requestRender(e),this._dirty=!0}resetWebGLState(){this.renderingContext.resetState(),this.renderingContext.bindFramebuffer(this._frameBuffer?.fbo)}get fboCache(){return this.view._stage.renderer.fboCache}get bindParameters(){return this.renderContext.bind}get renderingContext(){return this.view._stage.renderView.renderingContext}get renderContext(){return this.view._stage?.renderer.renderContext}updateAnimation(e){return!!this._dirty&&(this._dirty=!1,!0)}doRender(e){this._frameBuffer=e.find(({name:i})=>i===this.produces);try{return this.render(e)}finally{this._frameBuffer=null}}};u([p({constructOnly:!0})],_1.prototype,"view",void 0),u([p({constructOnly:!0})],_1.prototype,"consumes",void 0),u([p()],_1.prototype,"produces",void 0),u([p({readOnly:!0})],_1.prototype,"techniques",null),_1=u([A("esri.views.3d.webgl.RenderNode")],_1);const xf=_1,FPe=3e5,jU=5e5;function ea(t,e=!0){t.attributes.add(z.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.main.add(E`
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?E`uv = position * 0.5 + vec2(0.5);`:""}
  `)}function fg(t){t.uniforms.add(new fv("zProjectionMap",e=>Npt(e.camera))),t.code.add(E`float linearizeDepth(float depth) {
float depthNdc = depth * 2.0 - 1.0;
float c1 = zProjectionMap[0];
float c2 = zProjectionMap[1];
return -(c1 / (depthNdc + c2 + 1e-7));
}`),t.code.add(E`float depthFromTexture(sampler2D depthTexture, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
float depth = texelFetch(depthTexture, iuv, 0).r;
return depth;
}`),t.code.add(E`float linearDepthFromTexture(sampler2D depthTexture, vec2 uv) {
return linearizeDepth(depthFromTexture(depthTexture, uv));
}`)}function Npt(t){const e=t.projectionMatrix;return li(Fpt,e[14],e[10])}const Fpt=He();let Ese=class extends or{constructor(e,i){super(e,"vec2",Pt.Draw,(r,s,n,o)=>r.setUniform2fv(e,i(s,n,o)))}};const Cse=()=>J.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let kPe=class{constructor(){this._includedModules=new Map}include(e,i){this._includedModules.has(e)?this._includedModules.get(e):(this._includedModules.set(e,i),e(this.builder,i))}},ki=class extends kPe{constructor(){super(...arguments),this.vertex=new ppe,this.fragment=new ppe,this.attributes=new Bpt,this.varyings=new Vpt,this.extensions=new wJ,this.outputs=new SJ}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e,i=!1){const r=this.extensions.generateSource(e),s=this.attributes.generateSource(e),n=this.varyings.generateSource(e),o=e==="vertex"?this.vertex:this.fragment,a=o.uniforms.generateSource(),l=o.code.generateSource(),c=o.main.generateSource(i),h=e==="vertex"?Hpt:Gpt,d=o.constants.generateSource(),f=this.outputs.generateSource(e);return`#version 300 es
${r.join(`
`)}
${h}
${d.join(`
`)}
${a.join(`
`)}
${s.join(`
`)}
${n.join(`
`)}
${f.join(`
`)}
${l.join(`
`)}
${c.join(`
`)}`}generateBind(e){const i=new Map;this.vertex.uniforms.entries.forEach(n=>{const o=n.bind[Pt.Bind];o&&i.set(n.name,o)}),this.fragment.uniforms.entries.forEach(n=>{const o=n.bind[Pt.Bind];o&&i.set(n.name,o)});const r=Array.from(i.values()),s=r.length;return n=>{for(let o=0;o<s;++o)r[o](e,n)}}generateBindPass(e){const i=new Map;this.vertex.uniforms.entries.forEach(n=>{const o=n.bind[Pt.Pass];o&&i.set(n.name,o)}),this.fragment.uniforms.entries.forEach(n=>{const o=n.bind[Pt.Pass];o&&i.set(n.name,o)});const r=Array.from(i.values()),s=r.length;return(n,o)=>{for(let a=0;a<s;++a)r[a](e,n,o)}}generateBindDraw(e){const i=new Map;this.vertex.uniforms.entries.forEach(n=>{const o=n.bind[Pt.Draw];o&&i.set(n.name,o)}),this.fragment.uniforms.entries.forEach(n=>{const o=n.bind[Pt.Draw];o&&i.set(n.name,o)});const r=Array.from(i.values()),s=r.length;return(n,o,a)=>{for(let l=0;l<s;++l)r[l](e,a,n,o)}}},kpt=class{constructor(e){this._stage=e,this._entries=new Map}add(...e){for(const i of e)this._add(i);return this._stage}get(e){return this._entries.get(e)}_add(e){if(e!=null){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new U(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else Cse().error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(e=>e.arraySize!=null?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},zpt=class{constructor(e){this._stage=e,this._bodies=new Array}add(e){return this._bodies.push(e),this._stage}generateSource(e){if(this._bodies.length>0)return[`void main() {
 ${this._bodies.join(`
`)||""} 
}`];if(e)throw new U("Shader does not contain main function body.");return[]}},Upt=class{constructor(e){this._stage=e,this._entries=new Array}add(e){return this._entries.push(e),this._stage}generateSource(){return this._entries}},ppe=class extends kPe{constructor(){super(...arguments),this.uniforms=new kpt(this),this.main=new zpt(this),this.code=new Upt(this),this.constants=new jpt(this)}get builder(){return this}},Bpt=class{constructor(){this._entries=new Array}add(e,i){this._entries.push([e,i])}generateSource(e){return e==="fragment"?[]:this._entries.map(i=>`in ${i[1]} ${i[0]};`)}},Vpt=class{constructor(){this._entries=new Map}add(e,i){this._entries.has(e)?Cse().warn(`Ignoring duplicate varying ${i} ${e}`):this._entries.set(e,i)}generateSource(e){const i=new Array;return this._entries.forEach((r,s)=>i.push(e==="vertex"?`out ${r} ${s};`:`in ${r} ${s};`)),i}},wJ=class xJ{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const i=e==="vertex"?xJ.ALLOWLIST_VERTEX:xJ.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(r=>i.includes(r)).map(r=>`#extension ${r} : enable`)}};wJ.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],wJ.ALLOWLIST_VERTEX=[];let SJ=class TJ{constructor(){this._entries=new Map}add(e,i,r=0){const s=this._entries.get(r);s?.name!==e||s?.type!==i?this._entries.set(r,{name:e,type:i}):Cse().warn(`Fragment shader output location ${r} occupied`)}generateSource(e){if(e==="vertex")return[];this._entries.size===0&&this._entries.set(0,{name:TJ.DEFAULT_NAME,type:TJ.DEFAULT_TYPE});const i=new Array;return this._entries.forEach((r,s)=>i.push(`layout(location = ${s}) out ${r.type} ${r.name};`)),i}};SJ.DEFAULT_TYPE="vec4",SJ.DEFAULT_NAME="fragColor";let jpt=class xn{constructor(e){this._stage=e,this._entries=new Set}add(e,i,r){let s="ERROR_CONSTRUCTOR_STRING";switch(i){case"float":s=xn._numberToFloatStr(r);break;case"int":s=xn._numberToIntStr(r);break;case"bool":s=r.toString();break;case"vec2":s=`vec2(${xn._numberToFloatStr(r[0])},                            ${xn._numberToFloatStr(r[1])})`;break;case"vec3":s=`vec3(${xn._numberToFloatStr(r[0])},                            ${xn._numberToFloatStr(r[1])},                            ${xn._numberToFloatStr(r[2])})`;break;case"vec4":s=`vec4(${xn._numberToFloatStr(r[0])},                            ${xn._numberToFloatStr(r[1])},                            ${xn._numberToFloatStr(r[2])},                            ${xn._numberToFloatStr(r[3])})`;break;case"ivec2":s=`ivec2(${xn._numberToIntStr(r[0])},                             ${xn._numberToIntStr(r[1])})`;break;case"ivec3":s=`ivec3(${xn._numberToIntStr(r[0])},                             ${xn._numberToIntStr(r[1])},                             ${xn._numberToIntStr(r[2])})`;break;case"ivec4":s=`ivec4(${xn._numberToIntStr(r[0])},                             ${xn._numberToIntStr(r[1])},                             ${xn._numberToIntStr(r[2])},                             ${xn._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${i}(${Array.prototype.map.call(r,n=>xn._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${i} ${e} = ${s};`),this._stage}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const Gpt=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp int;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump int;
  precision mediump sampler2D;
#endif`,Hpt=`precision highp float;
precision highp sampler2D;`,BH=4;function zPe(){const t=new ki,e=t.fragment;t.include(ea);const i=(BH+1)/2,r=1/(2*i*i);return e.include(fg),e.uniforms.add(new $t("depthMap",s=>s.depthTexture),new Km("tex",s=>s.colorTexture),new Ese("blurSize",s=>s.blurSize),new pt("projScale",(s,n)=>{const o=n.camera.distance;return o>5e4?Math.max(0,s.projScale-(o-5e4)):s.projScale})),e.code.add(E`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${E.float(r)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),t.outputs.add("fragBlur","float"),e.main.add(E`
    float b = 0.0;
    float w_total = 0.0;

    float center_d = linearDepthFromTexture(depthMap, uv);

    float sharpness = -0.05 * projScale / center_d;
    for (int r = -${E.int(BH)}; r <= ${E.int(BH)}; ++r) {
      float rf = float(r);
      vec2 uvOffset = uv + rf * blurSize;
      blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
    }
    fragBlur = b / w_total;`),t}const qpt=Object.freeze(Object.defineProperty({__proto__:null,build:zPe},Symbol.toStringTag,{value:"Module"}));let fpe=class extends Bi{constructor(e,i){super(e,i,new Fi(qpt,()=>V(()=>Promise.resolve().then(()=>_Gt),void 0)))}initializePipeline(){return _i({colorWrite:Ai})}};const Wpt="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";let Zpt=class extends ar{constructor(){super(...arguments),this.projScale=1}},Ypt=class extends Zpt{constructor(){super(...arguments),this.intensity=1}},Jpt=class extends ar{},Xpt=class extends Jpt{constructor(){super(...arguments),this.blurSize=He()}},Ua=class extends or{constructor(e,i){super(e,"vec4",Pt.Bind,(r,s)=>r.setUniform4fv(e,i(s)))}};function eG(t){t.fragment.uniforms.add(new Ua("projInfo",e=>Kpt(e.camera))),t.fragment.uniforms.add(new fv("zScale",e=>Qpt(e.camera))),t.fragment.code.add(E`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function Kpt(t){const e=t.projectionMatrix;return e[11]===0?es(mpe,2/(t.fullWidth*e[0]),2/(t.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):es(mpe,-2/(t.fullWidth*e[0]),-2/(t.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const mpe=pi();function Qpt(t){return t.projectionMatrix[11]===0?li(gpe,0,1):li(gpe,1,0)}const gpe=He(),ype=16;function UPe(){const t=new ki,e=t.fragment;return t.include(ea),t.include(eG),e.include(fg),e.uniforms.add(new Fn("radius",i=>tG(i.camera))).code.add(E`vec3 sphere[16] = vec3[16](
vec3(0.186937, 0.0, 0.0),
vec3(0.700542, 0.0, 0.0),
vec3(-0.864858, -0.481795, -0.111713),
vec3(-0.624773, 0.102853, -0.730153),
vec3(-0.387172, 0.260319, 0.007229),
vec3(-0.222367, -0.642631, -0.707697),
vec3(-0.01336, -0.014956, 0.169662),
vec3(0.122575, 0.1544, -0.456944),
vec3(-0.177141, 0.85997, -0.42346),
vec3(-0.131631, 0.814545, 0.524355),
vec3(-0.779469, 0.007991, 0.624833),
vec3(0.308092, 0.209288,0.35969),
vec3(0.359331, -0.184533, -0.377458),
vec3(0.192633, -0.482999, -0.065284),
vec3(0.233538, 0.293706, -0.055139),
vec3(0.417709, -0.386701, 0.442449)
);
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),e.code.add(E`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add(new $t("normalMap",i=>i.normalTexture),new $t("depthMap",i=>i.depthTexture),new pt("projScale",i=>i.projScale),new $t("rnm",i=>i.noiseTexture),new fc("rnmScale",(i,r)=>li(vpe,r.camera.fullWidth/i.noiseTexture.descriptor.width,r.camera.fullHeight/i.noiseTexture.descriptor.height)),new pt("intensity",i=>i.intensity),new fv("screenSize",i=>li(vpe,i.camera.fullWidth,i.camera.fullHeight))),t.outputs.add("fragOcclusion","float"),e.main.add(E`
      float depth = depthFromTexture(depthMap, uv);

      // Early out if depth is out of range, such as in the sky
      if (depth >= 1.0 || depth <= 0.0) {
        fragOcclusion = 1.0;
        return;
      }

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      if(norm4.a != 1.0) {
        fragOcclusion = 1.0;
        return;
      }
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;

      float currentPixelDepth = linearizeDepth(depth);
      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy, currentPixelDepth);

      float sum = 0.0;
      vec3 tapPixelPos;

      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${E.int(ype)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        // don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap);

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum += aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${E.int(ype)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A * A * A * A) / 2.2;

      fragOcclusion = A;`),t}function tG(t){return Math.max(10,20*t.computeScreenPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const vpe=He(),eft=Object.freeze(Object.defineProperty({__proto__:null,build:UPe,getRadius:tG},Symbol.toStringTag,{value:"Module"}));let _pe=class extends Bi{constructor(e,i){super(e,i,new Fi(eft,()=>V(()=>Promise.resolve().then(()=>bGt),void 0)))}initializePipeline(){return _i({colorWrite:Ai})}};const aI=2;let NE=class extends xf{constructor(e){super(e),this.consumes={required:["normals"]},this.produces=ut.SSAO,this.isEnabled=()=>!1,this._enableTime=0,this._passParameters=new Ypt,this._drawParameters=new Xpt}initialize(){const e=Uint8Array.from(atob(Wpt),r=>r.charCodeAt(0)),i=new $r;i.wrapMode=nr.CLAMP_TO_EDGE,i.pixelFormat=vt.RGB,i.wrapMode=nr.REPEAT,i.hasMipmap=!0,i.width=32,i.height=32,this._passParameters.noiseTexture=new yi(this.renderingContext,i,e),this.techniques.precompile(_pe),this.techniques.precompile(fpe),this.addHandles(H(()=>this.isEnabled(),()=>this._enableTime=0))}destroy(){this._passParameters.noiseTexture=Rt(this._passParameters.noiseTexture)}render(e){const i=this.bindParameters,r=e.find(({name:M})=>M==="normals"),s=r?.getTexture(),n=r?.getTexture(nS),o=this.fboCache,a=i.camera,l=a.fullViewport[2],c=a.fullViewport[3],h=Math.round(l/aI),d=Math.round(c/aI),f=this.techniques.get(_pe),m=this.techniques.get(fpe);if(!f.compiled||!m.compiled)return this._enableTime=performance.now(),this.requestRender(bt.UPDATE),o.acquire(h,d,ut.SSAO,fr.RED);this._enableTime===0&&(this._enableTime=performance.now());const y=this.renderingContext,v=this.view.qualitySettings.fadeDuration,_=a.relativeElevation,b=ce((jU-_)/(jU-FPe),0,1),w=v>0?Math.min(v,performance.now()-this._enableTime)/v:1,x=w*b;this._passParameters.normalTexture=s,this._passParameters.depthTexture=n,this._passParameters.projScale=1/a.computeScreenPixelSizeAtDist(1),this._passParameters.intensity=4*tft/tG(a)**6*x;const S=o.acquire(l,c,"ssao input",fr.RG);y.bindFramebuffer(S.fbo),y.setViewport(0,0,l,c),y.bindTechnique(f,i,this._passParameters,this._drawParameters),y.screen.draw();const C=o.acquire(h,d,"ssao blur",fr.RED);y.bindFramebuffer(C.fbo),this._drawParameters.colorTexture=S.getTexture(),li(this._drawParameters.blurSize,0,aI/c),y.bindTechnique(m,i,this._passParameters,this._drawParameters),y.setViewport(0,0,h,d),y.screen.draw(),S.release();const T=o.acquire(h,d,ut.SSAO,fr.RED);return y.bindFramebuffer(T.fbo),y.setViewport(0,0,l,c),y.setClearColor(1,1,1,0),y.clear(Si.COLOR),this._drawParameters.colorTexture=C.getTexture(),li(this._drawParameters.blurSize,aI/l,0),y.bindTechnique(m,i,this._passParameters,this._drawParameters),y.setViewport(0,0,h,d),y.screen.draw(),y.setViewport4fv(a.fullViewport),C.release(),w<1&&this.requestRender(bt.UPDATE),T}};u([p()],NE.prototype,"consumes",void 0),u([p()],NE.prototype,"produces",void 0),u([p({constructOnly:!0})],NE.prototype,"isEnabled",void 0),NE=u([A("esri.views.3d.webgl-engine.effects.ssao.SSAO")],NE);const tft=.5;function iG(t,e){const i=t.fragment;e.receiveAmbientOcclusion?(i.uniforms.add(new so("ssaoTex",r=>r.ssao?.getTexture())),i.constants.add("blurSizePixelsInverse","float",1/aI),i.code.add(E`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):i.code.add(E`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function BPe(t,e){const i=t.fragment,r=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;r===0?(i.uniforms.add(new Ja("lightingAmbientSH0",({lighting:s})=>se(bpe,s.sh.r[0],s.sh.g[0],s.sh.b[0]))),i.code.add(E`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===1?(i.uniforms.add(new Ua("lightingAmbientSH_R",({lighting:s})=>es(Mg,s.sh.r[0],s.sh.r[1],s.sh.r[2],s.sh.r[3])),new Ua("lightingAmbientSH_G",({lighting:s})=>es(Mg,s.sh.g[0],s.sh.g[1],s.sh.g[2],s.sh.g[3])),new Ua("lightingAmbientSH_B",({lighting:s})=>es(Mg,s.sh.b[0],s.sh.b[1],s.sh.b[2],s.sh.b[3]))),i.code.add(E`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===2&&(i.uniforms.add(new Ja("lightingAmbientSH0",({lighting:s})=>se(bpe,s.sh.r[0],s.sh.g[0],s.sh.b[0])),new Ua("lightingAmbientSH_R1",({lighting:s})=>es(Mg,s.sh.r[1],s.sh.r[2],s.sh.r[3],s.sh.r[4])),new Ua("lightingAmbientSH_G1",({lighting:s})=>es(Mg,s.sh.g[1],s.sh.g[2],s.sh.g[3],s.sh.g[4])),new Ua("lightingAmbientSH_B1",({lighting:s})=>es(Mg,s.sh.b[1],s.sh.b[2],s.sh.b[3],s.sh.b[4])),new Ua("lightingAmbientSH_R2",({lighting:s})=>es(Mg,s.sh.r[5],s.sh.r[6],s.sh.r[7],s.sh.r[8])),new Ua("lightingAmbientSH_G2",({lighting:s})=>es(Mg,s.sh.g[5],s.sh.g[6],s.sh.g[7],s.sh.g[8])),new Ua("lightingAmbientSH_B2",({lighting:s})=>es(Mg,s.sh.b[5],s.sh.b[6],s.sh.b[7],s.sh.b[8]))),i.code.add(E`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==_t.Normal&&e.pbrMode!==_t.Schematic||i.code.add(E`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const bpe=$(),Mg=pi();function eg(t){t.uniforms.add(new Ja("mainLightDirection",e=>e.lighting.mainLight.direction))}function mv(t){t.uniforms.add(new Ja("mainLightIntensity",e=>e.lighting.mainLight.intensity))}function ift(t){eg(t.fragment),mv(t.fragment),t.fragment.code.add(E`vec3 applyShading(vec3 shadingNormalWorld, float shadow) {
float dotVal = clamp(dot(shadingNormalWorld, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadow) * dotVal);
}`)}function rft(t){const e=t.fragment.code;e.add(E`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(E`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(E`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function FD(t){const e=3.141592653589793,i=.3183098861837907;t.vertex.constants.add("PI","float",e),t.fragment.constants.add("PI","float",e),t.fragment.constants.add("LIGHT_NORMALIZATION","float",i),t.fragment.constants.add("INV_PI","float",i),t.fragment.constants.add("HALF_PI","float",1.570796326794897),t.fragment.constants.add("TWO_PI","float",6.28318530717958)}function $se(t,e){const i=t.fragment.code;t.include(FD),e.pbrMode!==_t.Normal&&e.pbrMode!==_t.Schematic&&e.pbrMode!==_t.Simplified&&e.pbrMode!==_t.TerrainWithWater||(i.add(E`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(E`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==_t.Normal&&e.pbrMode!==_t.Schematic||(t.include(rft),i.add(E`struct PBRShadingInfo
{
float NdotV;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(E`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(E`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(E`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function sft(t,e){const i=t.fragment.code;t.include(FD),i.add(E`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),i.add(E`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(E`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(E`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(E`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze) * strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}`)}let GU=class extends or{constructor(e,i){super(e,"bool",Pt.Bind,(r,s)=>r.setUniform1b(e,i(s)))}},Ase=class{constructor(e=EA()){this.intensity=e}},VPe=class{constructor(e=EA(),i=Le(.57735,.57735,.57735)){this.intensity=e,this.direction=i}},HU=class{constructor(e=EA(),i=Le(.57735,.57735,.57735),r=!0,s=1,n=1){this.intensity=e,this.direction=i,this.castShadows=r,this.specularStrength=s,this.environmentStrength=n}},jPe=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function nft(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e[r];return i}function VH(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e;return i}function NC(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]+e[r];return i}function GPe(t){return(t+1)*(t+1)}function oft(t){return ce(Math.floor(Math.sqrt(t)-1),0,2)}function HPe(t,e,i){const r=t[0],s=t[1],n=t[2],o=i||[];return o.length=GPe(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*r,o[2]=.4886025119*n,o[3]=.4886025119*s),e>=2&&(o[4]=1.09254843059*r*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*r*n,o[8]=.54627421529*(r*r-s*s)),o}function aft(t,e){const i=GPe(t),r=e||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let s=0;s<i;s++)r.r[s]=r.g[s]=r.b[s]=0;return r}function lft(t,e){const i=oft(e.r.length);for(const r of t)wd(EJ,r.direction),HPe(EJ,i,ky),nft(ky,z4),VH(ky,r.intensity[0],AT),NC(e.r,AT),VH(ky,r.intensity[1],AT),NC(e.g,AT),VH(ky,r.intensity[2],AT),NC(e.b,AT);return e}function cft(t,e){HPe(EJ,0,ky);for(const i of t)e.r[0]+=ky[0]*z4[0]*i.intensity[0]*4*Math.PI,e.g[0]+=ky[0]*z4[0]*i.intensity[1]*4*Math.PI,e.b[0]+=ky[0]*z4[0]*i.intensity[2]*4*Math.PI;return e}function uft(t,e,i,r){aft(e,r),se(i.intensity,0,0,0);let s=!1;const n=hft,o=dft,a=pft;n.length=0,o.length=0,a.length=0;for(const l of t)l instanceof HU&&!s?(ne(i.direction,l.direction),ne(i.intensity,l.intensity),i.specularStrength=l.specularStrength,i.environmentStrength=l.environmentStrength,i.castShadows=l.castShadows,s=!0):l instanceof HU||l instanceof VPe?n.push(l):l instanceof Ase?o.push(l):l instanceof jPe&&a.push(l);lft(n,r),cft(o,r);for(const l of a)NC(r.r,l.r),NC(r.g,l.g),NC(r.b,l.b)}const hft=[],dft=[],pft=[],ky=[0],AT=[0],EJ=$(),z4=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let wpe=class{constructor(){this.color=$(),this.intensity=1}},fft=class{constructor(){this.direction=$(),this.ambient=new wpe,this.diffuse=new wpe}};const qPe=.4;let jH=class{constructor(){this._shOrder=2,this._legacy=new fft,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new jPe,this._mainLight=new HU($(),Le(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){uft(e,this._shOrder,this._mainLight,this._sphericalHarmonics),ne(this._legacy.direction,this._mainLight.direction);const i=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*i,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*i,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*i,ie(this._legacy.diffuse.color,this._mainLight.intensity,i),ne(wN,this._legacy.diffuse.color),ie(wN,wN,qPe*this.globalFactor),oe(this._legacy.ambient.color,this._legacy.ambient.color,wN)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),ne(this._mainLight.direction,e.mainLight.direction),ne(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,i,r){if(dr(this._mainLight.intensity,e.mainLight.intensity,i.mainLight.intensity,r),this._mainLight.environmentStrength=dt(e.mainLight.environmentStrength,i.mainLight.environmentStrength,r),this._mainLight.specularStrength=dt(e.mainLight.specularStrength,i.mainLight.specularStrength,r),ne(this._mainLight.direction,i.mainLight.direction),this._mainLight.castShadows=i.mainLight.castShadows,this.globalFactor=dt(e.globalFactor,i.globalFactor,r),this.noonFactor=dt(e.noonFactor,i.noonFactor,r),e.sh.r.length===i.sh.r.length)for(let s=0;s<i.sh.r.length;s++)this._sphericalHarmonics.r[s]=dt(e.sh.r[s],i.sh.r[s],r),this._sphericalHarmonics.g[s]=dt(e.sh.g[s],i.sh.g[s],r),this._sphericalHarmonics.b[s]=dt(e.sh.b[s],i.sh.b[s],r);else for(let s=0;s<i.sh.r.length;s++)this._sphericalHarmonics.r[s]=i.sh.r[s],this._sphericalHarmonics.g[s]=i.sh.g[s],this._sphericalHarmonics.b[s]=i.sh.b[s]}};const wN=$();function rG(t){t.constants.add("ambientBoostFactor","float",qPe)}function V$(t){t.uniforms.add(new Fn("lightingGlobalFactor",e=>e.lighting.globalFactor))}function j$(t,e){const i=t.fragment;switch(t.include(iG,e),e.pbrMode!==_t.Disabled&&t.include($se,e),t.include(BPe,e),t.include(FD),i.code.add(E`
    const float GAMMA_SRGB = ${E.float(iU)};
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===_t.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),rG(i),V$(i),eg(i),i.code.add(E`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?E`normalize(vPosWorld)`:E`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),mv(i),i.code.add(E`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case _t.Disabled:case _t.WaterOnIntegratedMesh:case _t.Water:t.include(ift),i.code.add(E`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {
vec3 mainLighting = applyShading(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case _t.Normal:case _t.Schematic:i.code.add(E`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec4 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(E`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?i.uniforms.add(new GU("hasFillLights",r=>r.enableFillLights)):i.constants.add("hasFillLights","bool",!1),i.code.add(E`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
float NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
vec3 mainLightIrradianceComponent = NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.uniforms.add(new Fn("lightingSpecularStrength",r=>r.lighting.mainLight.specularStrength),new Fn("lightingEnvironmentStrength",r=>r.lighting.mainLight.environmentStrength)).code.add(E`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
float NdotH = clamp(dot(normal, h), 0.0, 1.0);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
float normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));
inputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),i.code.add(E`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = _emission.rgb == vec3(0.0) ? _emission.rgb : pow(_emission.rgb, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode!==_t.Schematic||e.hasColorTexture?E`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`:E`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case _t.Simplified:case _t.TerrainWithWater:eg(i),mv(i),i.code.add(E`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluatePBRSimplifiedLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case _t.COUNT:}}let mft=class extends or{constructor(e,i,r){super(e,"mat4",Pt.Draw,(s,n,o,a)=>s.setUniformMatrix4fv(e,i(n,o,a)),r)}},gft=class extends or{constructor(e,i,r){super(e,"mat4",Pt.Pass,(s,n,o)=>s.setUniformMatrix4fv(e,i(n,o)),r)}},yft=class extends ar{constructor(){super(...arguments),this.modelTransformation=Kn}},Mse=class extends yft{constructor(){super(...arguments),this.origin=$()}};function kD(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new gft("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),WPe(t))}function Ose(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new mft("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),WPe(t))}function WPe(t){const e=t.fragment;e.include(MPe),e.uniforms.add(new so("shadowMap",i=>i.shadowMap.depthTexture),new Sse("numCascades",i=>i.shadowMap.numCascades),new Ua("cascadeDistances",i=>i.shadowMap.cascadeDistances)).code.add(E`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {
float xScale = float(textureSize.y) / float(textureSize.x);
return vec2((float(i) + lvpos.x) * xScale, lvpos.y);
}
float readShadowMapDepth(ivec2 uv, sampler2D _depthTex) {
return rgba4ToFloat(texelFetch(_depthTex, uv, 0));
}
float posIsInShadow(ivec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, ivec2 texSize, sampler2D _depthTex) {
vec2 st = fract(uv * vec2(texSize) + vec2(0.5));
ivec2 base = ivec2(uv * vec2(texSize) - vec2(0.5));
float s00 = posIsInShadow(ivec2(base.x, base.y), lvpos, _depthTex);
float s10 = posIsInShadow(ivec2(base.x + 1, base.y), lvpos, _depthTex);
float s11 = posIsInShadow(ivec2(base.x + 1, base.y + 1), lvpos, _depthTex);
float s01 = posIsInShadow(ivec2(base.x, base.y + 1), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
ivec2 size = textureSize(shadowMap, 0);
vec2 uv = cascadeCoordinates(i, size, lvpos);
return filterShadow(uv, lvpos, size, shadowMap);
}`)}function zD(t,{occlusionPass:e,terrainDepthTest:i,cullAboveTerrain:r}){const s=t.vertex,n=t.fragment;if(!i)return s.code.add("void forwardViewPosDepth(vec3 pos) {}"),void n.code.add(`${e?"bool":"void"} discardByTerrainDepth() { ${Se(e,"return false;")}}`);t.varyings.add("viewPosDepth","float"),s.code.add(`void forwardViewPosDepth(vec3 pos) {
    viewPosDepth = pos.z;
  }`),n.include(fg),n.uniforms.add(new so("terrainDepthTexture",o=>o.terrainDepth?.attachment)).code.add(E`
    ${e?"bool":"void"} discardByTerrainDepth() {
      float depth = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0).r;
      float linearDepth = linearizeDepth(depth);
      ${e?"return viewPosDepth < linearDepth && depth < 1.0;":`if(viewPosDepth ${r?">":"<="} linearDepth) discard;`}
    }`)}function vft(t,e){e.hasColorTextureTransform?(t.varyings.add("colorUV","vec2"),t.vertex.uniforms.add(new Ld("colorTextureTransformMatrix",i=>i.colorTextureTransformMatrix??US)).code.add(E`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(E`void forwardColorUV(){}`)}function _ft(t,e){e.hasNormalTextureTransform&&e.textureCoordinateType!==Ws.None?(t.varyings.add("normalUV","vec2"),t.vertex.uniforms.add(new Ld("normalTextureTransformMatrix",i=>i.normalTextureTransformMatrix??US)).code.add(E`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(E`void forwardNormalUV(){}`)}function bft(t,e){e.hasEmissionTextureTransform&&e.textureCoordinateType!==Ws.None?(t.varyings.add("emissiveUV","vec2"),t.vertex.uniforms.add(new Ld("emissiveTextureTransformMatrix",i=>i.emissiveTextureTransformMatrix??US)).code.add(E`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(E`void forwardEmissiveUV(){}`)}function wft(t,e){e.hasOcclusionTextureTransform&&e.textureCoordinateType!==Ws.None?(t.varyings.add("occlusionUV","vec2"),t.vertex.uniforms.add(new Ld("occlusionTextureTransformMatrix",i=>i.occlusionTextureTransformMatrix??US)).code.add(E`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(E`void forwardOcclusionUV(){}`)}function xft(t,e){e.hasMetallicRoughnessTextureTransform&&e.textureCoordinateType!==Ws.None?(t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.uniforms.add(new Ld("metallicRoughnessTextureTransformMatrix",i=>i.metallicRoughnessTextureTransformMatrix??US)).code.add(E`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(E`void forwardMetallicRoughnessUV(){}`)}function FA(t){t.code.add(E`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function Ise(t){t.include(FA),t.code.add(E`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in macOS using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${E.int(Ln.Multiply)}) {
        return allMixed;
      }
      if (mode == ${E.int(Ln.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${E.int(Ln.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in macOS using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${E.int(Ln.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${E.int(Ln.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function sG(t,e){t.include(ND,e),t.include(Qht,e),t.fragment.include(FA);const i=e.output===Y.ObjectAndLayerIdColor,r=kre(e.output),s=_s(e.output)&&e.oitPass===bi.ColorAlpha,n=_s(e.output)&&e.oitPass!==bi.ColorAlpha,o=e.discardInvisibleFragments;let a=0;(n||r||s)&&t.outputs.add("fragColor","vec4",a++),r&&t.outputs.add("fragEmission","vec4",a++),s&&t.outputs.add("fragAlpha","float",a++),t.fragment.code.add(E`
    void outputColorHighlightOID(vec4 finalColor, const in vec3 vWorldPosition) {
      ${Se(i,"finalColor.a = 1.0;")}

      ${Se(o,`if (finalColor.a < ${E.float(Yr)}) { discard; }`)}

      finalColor = applySlice(finalColor, vWorldPosition);
      ${Se(s,E`fragColor = premultiplyAlpha(finalColor);
             fragAlpha = finalColor.a;`)}
      ${Se(n,"fragColor = finalColor;")}
      ${Se(r,"fragEmission = finalColor.a * getEmissions();")}
      calculateOcclusionAndOutputHighlight();
      ${Se(i,"outputObjectAndLayerIdColor();")}
    }
  `)}function ZPe(t){const e=new ki,{vertex:i,fragment:r,varyings:s}=e,{output:n,normalType:o,offsetBackfaces:a,instancedColor:l,spherical:c,receiveShadows:h,snowCover:d,pbrMode:f,textureAlphaPremultiplied:m,instancedDoublePrecision:y,hasVertexColors:v,hasVertexTangents:_,hasColorTexture:b,hasNormalTexture:w,hasNormalTextureTransform:x,hasColorTextureTransform:S}=t;if(By(i,t),e.include(Zj),s.add("vpos","vec3"),e.include(Lx,t),e.include(TPe,t),e.include($Pe,t),e.include(vft,t),!_s(n))return e.include(LPe,t),e;e.include(_ft,t),e.include(bft,t),e.include(wft,t),e.include(xft,t),Ib(i,t),e.include(LA,t),e.include(Y_,t);const C=o===Fr.Attribute||o===Fr.Compressed;return C&&a&&e.include(gPe),e.include(NPe,t),e.include(Yj,t),l&&e.attributes.add(z.INSTANCECOLOR,"vec4"),s.add("vPositionLocal","vec3"),e.include(Uy,t),e.include(Jj,t),e.include(EPe,t),e.include(Xj,t),i.uniforms.add(new uc("externalColor",T=>T.externalColor)),s.add("vcolorExt","vec4"),e.include(zD,t),i.main.add(E`
    forwardNormalizedVertexColor();
    vcolorExt = externalColor;
    ${Se(l,"vcolorExt *= instanceColor * 0.003921568627451;")}
    vcolorExt *= vvColor();
    vcolorExt *= getSymbolColor();
    forwardColorMixMode();

    vpos = getVertexInLocalOriginSpace();
    vPositionLocal = vpos - view[3].xyz;
    vpos = subtractOrigin(vpos);
    ${Se(C,"vNormalWorld = dpNormal(vvLocalNormal(normalModel()));")}
    vpos = addVerticalOffset(vpos, localOrigin);
    ${Se(_,"vTangent = dpTransformVertexTangent(tangent);")}
    gl_Position = transformPosition(proj, view, vpos);
    ${Se(C&&a,"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);")}

    forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
    forwardLinearDepth();
    forwardTextureCoordinates();
    forwardColorUV();
    forwardNormalUV();
    forwardEmissiveUV();
    forwardOcclusionUV();
    forwardMetallicRoughnessUV();

    if (vcolorExt.a < ${E.float(Yr)}) {
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
    }
  `),e.include(j$,t),e.include(iG,t),e.include(H2,t),e.include(y?kD:Ose,t),e.fragment.include(Z_,t),e.include(sG,t),Ib(r,t),r.uniforms.add(i.uniforms.get("localOrigin"),new Cr("ambient",T=>T.ambient),new Cr("diffuse",T=>T.diffuse),new pt("opacity",T=>T.opacity),new pt("layerOpacity",T=>T.layerOpacity)),b&&r.uniforms.add(new $t("tex",T=>T.texture)),e.include(nse,t),e.include($se,t),r.include(Ise),e.include(edt,t),rG(r),V$(r),mv(r),r.main.add(E`
    discardBySlice(vpos);
    discardByTerrainDepth();
    ${b?E`
            vec4 texColor = texture(tex, ${S?"colorUV":"vuv0"});
            ${Se(m,"texColor.rgb /= texColor.a;")}
            discardOrAdjustAlpha(texColor);`:E`vec4 texColor = vec4(1.0);`}
    shadingParams.viewDirection = normalize(vpos - cameraPosition);
    ${o===Fr.ScreenDerivative?E`vec3 normal = screenDerivativeNormal(vPositionLocal);`:E`shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
    applyPBRFactors();
    float ssao = evaluateAmbientOcclusionInverse() * getBakedOcclusion();

    vec3 posWorld = vpos + localOrigin;

      float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
      float shadow = ${h?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), readShadowMap(vpos, linearDepth))":Se(c,"lightingGlobalFactor * (1.0 - additionalAmbientScale)","0.0")};

    vec3 matColor = max(ambient, diffuse);
    vec3 albedo = mixExternalColor(${Se(v,"vColor.rgb *")} matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
    float opacity_ = layerOpacity * mixExternalOpacity(${Se(v,"vColor.a * ")} opacity, texColor.a, vcolorExt.a, int(colorMixMode));
    ${w?`mat3 tangentSpace = computeTangentSpace(${_?"normal":"normal, vpos, vuv0"});
            vec3 shadingNormal = computeTextureNormal(tangentSpace, ${x?"normalUV":"vuv0"});`:"vec3 shadingNormal = normal;"}
    vec3 normalGround = ${c?"normalize(posWorld);":"vec3(0.0, 0.0, 1.0);"}

    ${Se(d,E`
          float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
          albedo = mix(albedo, vec3(1), snow);
          shadingNormal = mix(shadingNormal, normal, snow);
          ssao = mix(ssao, 1.0, snow);`)}

    vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

    ${f===_t.Normal||f===_t.Schematic?E`
            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
            ${Se(d,E`mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);`)}
            vec4 emission = ${d?"mix(getEmissions(), vec4(0.0), snow)":"getEmissions()"};
            vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:E`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
    vec4 finalColor = vec4(shadedColor, opacity_);
    outputColorHighlightOID(finalColor, vpos);
  `),e}const Sft=Object.freeze(Object.defineProperty({__proto__:null,build:ZPe},Symbol.toStringTag,{value:"Module"}));let Tft=class extends pPe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=zRe,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=Tl.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=on,this.instancedDoublePrecision=!1,this.normalType=Fr.Attribute,this.receiveShadows=!0,this.receiveAmbientOcclusion=!0,this.castShadows=!0,this.ambient=hf(.2,.2,.2),this.diffuse=hf(.8,.8,.8),this.externalColor=Gi(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=$(),this.hasSlicePlane=!1,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=F$.Less,this.textureAlphaMode=Dn.Blend,this.textureAlphaCutoff=Yr,this.textureAlphaPremultiplied=!1,this.renderOccluded=Er.Occlude,this.isDecoration=!1}},YKt=class extends fPe{constructor(){super(...arguments),this.origin=$(),this.slicePlaneLocalOrigin=this.origin}},YPe=class extends Bi{constructor(e,i,r=new Fi(Sft,()=>V(()=>Promise.resolve().then(()=>wGt),void 0))){super(e,i,r),this.type="DefaultMaterialTechnique"}_makePipeline(e,i){const{oitPass:r,output:s,transparent:n,cullFace:o,customDepthTest:a,hasOccludees:l,enableOffset:c}=e,h=r===bi.NONE,d=r===bi.FrontFace;return _i({blending:_s(s)&&n?cse(r):null,culling:Cft(e)?WRe(o):null,depthTest:{func:hse(r,Eft(a))},depthWrite:sPe(e),drawBuffers:s===Y.Depth?{buffers:[Va.NONE]}:Gj(r,s),colorWrite:Ai,stencilWrite:l?UU:null,stencilTest:l?i?vJ:gse:null,polygonOffset:h||d?null:Ddt(c)})}initializePipeline(e){return this._occludeePipelineState=this._makePipeline(e,!0),this._makePipeline(e,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};function Eft(t){return t===F$.Lequal?Ni.LEQUAL:Ni.LESS}function Cft(t){return t.cullFace!==Tl.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}let $ft=class{constructor(e){this._bits=[...e]}equals(e){return Hm(this._bits,e.bits)}get code(){return this._code??=String.fromCharCode(...this._bits),this._code}get bits(){return this._bits}},ou=class extends ar{constructor(){super(),this._parameterBits=this._parameterBits?.map(()=>0)??[],this._parameterNames??=[]}get key(){return this._key??=new $ft(this._parameterBits),this._key}decode(e=this.key){const i=this._parameterBits;this._parameterBits=[...e.bits];const r=this._parameterNames.map(s=>`    ${s}: ${this[s]}`).join(`
`);return this._parameterBits=i,r}};function te(t={}){return(e,i)=>{e.hasOwnProperty("_parameterNames")||Object.defineProperty(e,"_parameterNames",{value:e._parameterNames?.slice()??[],configurable:!0,writable:!0}),e.hasOwnProperty("_parameterBits")||Object.defineProperty(e,"_parameterBits",{value:e._parameterBits?.slice()??[0],configurable:!0,writable:!0}),e._parameterNames.push(i);const r=t.count||2,s=Math.ceil(Math.log2(r)),n=e._parameterBits;let o=0;for(;n[o]+s>16;)o++,o>=n.length&&n.push(0);const a=n[o],l=(1<<s)-1<<a;n[o]+=s,t.count?Object.defineProperty(e,i,{get(){return(this._parameterBits[o]&l)>>a},set(c){if(this[i]!==c){if(this._key=null,this._parameterBits[o]=this._parameterBits[o]&~l|+c<<a&l,typeof c!="number")throw new U(`Configuration value for ${i} must be a number, got ${typeof c}`);if(t.count==null)throw new U(`Configuration value for ${i} must provide a count option`)}}}):Object.defineProperty(e,i,{get(){return!!((this._parameterBits[o]&l)>>a)},set(c){if(this[i]!==c&&(this._key=null,this._parameterBits[o]=this._parameterBits[o]&~l|+c<<a&l,typeof c!="boolean"))throw new U(`Configuration value for ${i} must be boolean, got ${typeof c}`)}})}}let CJ=class extends ou{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}};u([te()],CJ.prototype,"instancedDoublePrecision",void 0),u([te()],CJ.prototype,"hasModelTransformation",void 0);let zm=class extends CJ{constructor(){super(...arguments),this.output=Y.Color,this.oitPass=bi.NONE,this.hasSlicePlane=!1,this.bindType=Pt.Pass,this.writeDepth=!0}};u([te({count:Y.COUNT})],zm.prototype,"output",void 0),u([te({count:bi.COUNT})],zm.prototype,"oitPass",void 0),u([te()],zm.prototype,"hasSlicePlane",void 0);let qi=class extends zm{constructor(e,i){super(),this.spherical=e,this.doublePrecisionRequiresObfuscation=i,this.alphaDiscardMode=Dn.Opaque,this.doubleSidedMode=eo.None,this.pbrMode=_t.Disabled,this.cullFace=Tl.None,this.normalType=Fr.Attribute,this.customDepthTest=F$.Less,this.emissionSource=Jo.None,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1,this.occlusionPass=!1,this.hasVvInstancing=!0,this.useCustomDTRExponentForWater=!1,this.useFillLights=!0}get textureCoordinateType(){return this.hasColorTexture||this.hasMetallicRoughnessTexture||this.emissionSource===Jo.Texture||this.hasOcclusionTexture||this.hasNormalTexture?Ws.Default:Ws.None}get objectAndLayerIdColorInstanced(){return this.instanced}get discardInvisibleFragments(){return this.transparent}};u([te({count:Dn.COUNT})],qi.prototype,"alphaDiscardMode",void 0),u([te({count:eo.COUNT})],qi.prototype,"doubleSidedMode",void 0),u([te({count:_t.COUNT})],qi.prototype,"pbrMode",void 0),u([te({count:Tl.COUNT})],qi.prototype,"cullFace",void 0),u([te({count:Fr.COUNT})],qi.prototype,"normalType",void 0),u([te({count:F$.COUNT})],qi.prototype,"customDepthTest",void 0),u([te({count:Jo.COUNT})],qi.prototype,"emissionSource",void 0),u([te()],qi.prototype,"hasVertexColors",void 0),u([te()],qi.prototype,"hasSymbolColors",void 0),u([te()],qi.prototype,"hasVerticalOffset",void 0),u([te()],qi.prototype,"hasColorTexture",void 0),u([te()],qi.prototype,"hasMetallicRoughnessTexture",void 0),u([te()],qi.prototype,"hasOcclusionTexture",void 0),u([te()],qi.prototype,"hasNormalTexture",void 0),u([te()],qi.prototype,"hasScreenSizePerspective",void 0),u([te()],qi.prototype,"hasVertexTangents",void 0),u([te()],qi.prototype,"hasOccludees",void 0),u([te()],qi.prototype,"hasModelTransformation",void 0),u([te()],qi.prototype,"offsetBackfaces",void 0),u([te()],qi.prototype,"vvSize",void 0),u([te()],qi.prototype,"vvColor",void 0),u([te()],qi.prototype,"receiveShadows",void 0),u([te()],qi.prototype,"receiveAmbientOcclusion",void 0),u([te()],qi.prototype,"textureAlphaPremultiplied",void 0),u([te()],qi.prototype,"instanced",void 0),u([te()],qi.prototype,"instancedColor",void 0),u([te()],qi.prototype,"writeDepth",void 0),u([te()],qi.prototype,"transparent",void 0),u([te()],qi.prototype,"enableOffset",void 0),u([te()],qi.prototype,"terrainDepthTest",void 0),u([te()],qi.prototype,"cullAboveTerrain",void 0),u([te()],qi.prototype,"snowCover",void 0),u([te()],qi.prototype,"hasColorTextureTransform",void 0),u([te()],qi.prototype,"hasEmissionTextureTransform",void 0),u([te()],qi.prototype,"hasNormalTextureTransform",void 0),u([te()],qi.prototype,"hasOcclusionTextureTransform",void 0),u([te()],qi.prototype,"hasMetallicRoughnessTextureTransform",void 0);function JPe(t){const e=new ki,{vertex:i,fragment:r,varyings:s}=e,{output:n,offsetBackfaces:o,instancedColor:a,pbrMode:l,snowCover:c,spherical:h}=t,d=l===_t.Normal||l===_t.Schematic;if(By(i,t),e.include(Zj),s.add("vpos","vec3"),e.include(Lx,t),e.include(TPe,t),e.include($Pe,t),e.include(zD,t),_s(n)&&(Ib(e.vertex,t),e.include(LA,t),e.include(Y_,t),o&&e.include(gPe),a&&e.attributes.add(z.INSTANCECOLOR,"vec4"),s.add("vNormalWorld","vec3"),s.add("localvpos","vec3"),e.include(Uy,t),e.include(Jj,t),e.include(EPe,t),e.include(Xj,t),i.uniforms.add(new uc("externalColor",f=>f.externalColor)),s.add("vcolorExt","vec4"),i.main.add(E`
      forwardNormalizedVertexColor();
      vcolorExt = externalColor;
      ${Se(a,"vcolorExt *= instanceColor * 0.003921568627451;")}
      vcolorExt *= vvColor();
      vcolorExt *= getSymbolColor();
      forwardColorMixMode();

      bool alphaCut = vcolorExt.a < ${E.float(Yr)};
      vpos = getVertexInLocalOriginSpace();
      localvpos = vpos - view[3].xyz;
      vpos = subtractOrigin(vpos);
      vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
      vpos = addVerticalOffset(vpos, localOrigin);
      vec4 basePosition = transformPosition(proj, view, vpos);

      forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
      forwardLinearDepth();
      forwardTextureCoordinates();

      gl_Position = alphaCut ? vec4(1e38, 1e38, 1e38, 1.0) :
      ${Se(o,"offsetBackfacingClipPosition(basePosition, vpos, vNormalWorld, cameraPosition);","basePosition;")}
    `)),_s(n)){const{hasColorTexture:f,hasColorTextureTransform:m,receiveShadows:y}=t;e.include(j$,t),e.include(iG,t),e.include(H2,t),e.include(t.instancedDoublePrecision?kD:Ose,t),e.fragment.include(Z_,t),e.include(sG,t),Ib(e.fragment,t),eg(r),rG(r),V$(r),r.uniforms.add(i.uniforms.get("localOrigin"),i.uniforms.get("view"),new Cr("ambient",v=>v.ambient),new Cr("diffuse",v=>v.diffuse),new pt("opacity",v=>v.opacity),new pt("layerOpacity",v=>v.layerOpacity)),f&&r.uniforms.add(new $t("tex",v=>v.texture)),e.include(nse,t),e.include($se,t),r.include(Ise),mv(r),r.main.add(E`
      discardBySlice(vpos);
      discardByTerrainDepth();
      vec4 texColor = ${f?`texture(tex, ${m?"colorUV":"vuv0"})`:" vec4(1.0)"};
      ${Se(f,`${Se(t.textureAlphaPremultiplied,"texColor.rgb /= texColor.a;")}
        discardOrAdjustAlpha(texColor);`)}
      vec3 viewDirection = normalize(vpos - cameraPosition);
      applyPBRFactors();
      float ssao = evaluateAmbientOcclusionInverse();
      ssao *= getBakedOcclusion();

      float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
      vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
      float shadow = ${y?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), readShadowMap(vpos, linearDepth))":h?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};
      vec3 matColor = max(ambient, diffuse);
      ${t.hasVertexColors?E`vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
             float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:E`vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
             float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
      ${Se(c,"albedo = mix(albedo, vec3(1), 0.9);")}
      ${E`vec3 shadingNormal = normalize(vNormalWorld);
             albedo *= 1.2;
             vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
             float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
             float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
             float treeRadialFalloff = vColor.r;
             float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
             additionalLight += backLightFactor * mainLightIntensity;`}
      ${Se(d,`vec3 normalGround = ${h?"normalize(vpos + localOrigin)":"vec3(0.0, 0.0, 1.0)"};`)}
      ${d?E`float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                 ${Se(c,E`mrr = vec3(0.0, 1.0, 0.04);`)}
            vec4 emission = ${c?"vec4(0.0)":"getEmissions()"};
            vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:E`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
      vec4 finalColor = vec4(shadedColor, opacity_);
      outputColorHighlightOID(finalColor, vpos);`)}return e.include(LPe,t),e}const Aft=Object.freeze(Object.defineProperty({__proto__:null,build:JPe},Symbol.toStringTag,{value:"Module"}));let Mft=class extends YPe{constructor(e,i){super(e,i,new Fi(Aft,()=>V(()=>Promise.resolve().then(()=>xGt),void 0))),this.type="RealisticTreeTechnique"}},qU=class extends jj{constructor(e,i){super(e,Ift),this.materialType="default",this.supportsEdges=!0,this.produces=new Map([[be.OPAQUE_MATERIAL,r=>(Yde(r)||LH(r))&&!this.parameters.transparent],[be.TRANSPARENT_MATERIAL,r=>(Yde(r)||LH(r))&&this.parameters.transparent&&this.parameters.writeDepth],[be.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,r=>(Aht(r)||LH(r))&&this.parameters.transparent&&!this.parameters.writeDepth]]),this._vertexBufferLayout=Pft(this.parameters),this._configuration=new qi(i.spherical,i.doublePrecisionRequiresObfuscation)}isVisibleForOutput(e){return e!==Y.Shadow&&e!==Y.ShadowExcludeHighlight&&e!==Y.ShadowHighlight||this.parameters.castShadows}get visible(){const e=this.parameters;if(e.layerOpacity<Yr)return!1;const{hasInstancedColor:i,hasVertexColors:r,hasSymbolColors:s,vvColor:n}=e,o=i||n||s,a=e.colorMixMode==="replace",l=e.opacity>=Yr;if(r&&o)return a||l;const c=e.externalColor&&e.externalColor[3]>=Yr;return r?a?c:l:o?a||l:a?c:l}get hasEmissions(){return!!this.parameters.emissiveTextureId||!Qn(this.parameters.emissiveFactor,on)}getConfiguration(e,i){const r=this.parameters,{treeRendering:s,doubleSided:n,doubleSidedType:o}=r;return this._configuration.output=e,this._configuration.hasNormalTexture=!s&&!!r.normalTextureId,this._configuration.hasColorTexture=!!r.textureId,this._configuration.hasVertexTangents=!s&&r.hasVertexTangents,this._configuration.instanced=r.isInstanced,this._configuration.instancedDoublePrecision=r.instancedDoublePrecision,this._configuration.vvSize=!!r.vvSize,this._configuration.hasVerticalOffset=r.verticalOffset!=null,this._configuration.hasScreenSizePerspective=r.screenSizePerspective!=null,this._configuration.hasSlicePlane=r.hasSlicePlane,this._configuration.alphaDiscardMode=r.textureAlphaMode,this._configuration.normalType=s?Fr.Attribute:r.normalType,this._configuration.transparent=r.transparent,this._configuration.writeDepth=r.writeDepth,r.customDepthTest!=null&&(this._configuration.customDepthTest=r.customDepthTest),this._configuration.hasOccludees=i.hasOccludees,this._configuration.cullFace=r.hasSlicePlane?Tl.None:r.cullFace,this._configuration.cullAboveTerrain=i.cullAboveTerrain,this._configuration.hasModelTransformation=!s&&r.modelTransformation!=null,this._configuration.hasVertexColors=r.hasVertexColors,this._configuration.hasSymbolColors=r.hasSymbolColors,this._configuration.doubleSidedMode=s?eo.WindingOrder:n&&o==="normal"?eo.View:n&&o==="winding-order"?eo.WindingOrder:eo.None,this._configuration.instancedColor=r.hasInstancedColor,_s(e)?(this._configuration.terrainDepthTest=i.terrainDepthTest,this._configuration.receiveShadows=r.receiveShadows,this._configuration.receiveAmbientOcclusion=r.receiveAmbientOcclusion&&i.ssao!=null):(this._configuration.terrainDepthTest=!1,this._configuration.receiveShadows=this._configuration.receiveAmbientOcclusion=!1),this._configuration.vvColor=!!r.vvColor,this._configuration.textureAlphaPremultiplied=!!r.textureAlphaPremultiplied,this._configuration.pbrMode=r.usePBR?r.isSchematic?_t.Schematic:_t.Normal:_t.Disabled,this._configuration.hasMetallicRoughnessTexture=!s&&!!r.metallicRoughnessTextureId,this._configuration.emissionSource=s?Jo.None:r.emissiveTextureId!=null?Jo.Texture:r.usePBR?Jo.Value:Jo.None,this._configuration.hasOcclusionTexture=!s&&!!r.occlusionTextureId,this._configuration.offsetBackfaces=!(!r.transparent||!r.offsetTransparentBackfaces),this._configuration.oitPass=i.oitPass,this._configuration.enableOffset=i.camera.relativeElevation<Pdt,this._configuration.snowCover=Rft(i),this._configuration.hasColorTextureTransform=!!r.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!r.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!r.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!r.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!r.metallicRoughnessTextureTransformMatrix,this._configuration}intersect(e,i,r,s,n,o){if(this.parameters.verticalOffset!=null){const a=r.camera;se(HH,i[12],i[13],i[14]);let l=null;switch(r.viewingMode){case Be.Global:l=ae(xpe,HH);break;case Be.Local:l=ne(xpe,Nft)}let c=0;const h=ye(Fft,HH,a.eye),d=Te(h),f=ie(h,h,1/d);let m=null;this.parameters.screenSizePerspective&&(m=de(l,f)),c+=qRe(a,d,this.parameters.verticalOffset,m??0,this.parameters.screenSizePerspective),ie(l,l,c),ac(GH,l,r.transform.inverseRotation),s=ye(Dft,s,GH),n=ye(Lft,n,GH)}Ldt(e,r,s,n,DY(r.verticalOffset),o)}createGLMaterial(e){return new Oft(e)}createBufferWriter(){return new ept(this._vertexBufferLayout)}},Oft=class extends FRe{constructor(e){super({...e,...e.material.parameters})}beginSlot(e){this._material.setParameters({receiveShadows:e.shadowMap.enabled});const i=this._material.parameters;this.updateTexture(i.textureId);const r=e.camera.viewInverseTransposeMatrix;return se(i.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.getTechnique(i.treeRendering?Mft:YPe,e)}},Ift=class extends Tft{constructor(){super(...arguments),this.treeRendering=!1,this.hasVertexTangents=!1}};function Rft(t){return t.weather!=null&&t.weatherVisible&&t.weather.type==="snowy"&&t.weather.snowCover==="enabled"}function Pft(t){const e=Nd().vec3f(z.POSITION);return t.normalType===Fr.Compressed?e.vec2i16(z.NORMALCOMPRESSED,{glNormalized:!0}):e.vec3f(z.NORMAL),t.hasVertexTangents&&e.vec4f(z.TANGENT),(t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId)&&e.vec2f(z.UV0),t.hasVertexColors&&e.vec4u8(z.COLOR),t.hasSymbolColors&&e.vec4u8(z.SYMBOLCOLOR),Md()&&e.vec4u8(z.OBJECTANDLAYERIDCOLOR),e}const Dft=$(),Lft=$(),Nft=Le(0,0,1),xpe=$(),GH=$(),HH=$(),Fft=$(),XPe=new Lre({});function aQt(t){return t.type==="web-style"?XPe:Rse(t.symbolLayers.toArray().map(e=>KPe(t,e)))}function Rse(t){let e=0,i=0,r=0,s=!1,n=0;const o=new mRe;for(const a of t)a!=null&&(e+=a.verticesPerFeature,i+=a.verticesPerCoordinate,r+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,s=s||a.estimated,++n);return s?new vht(n,{verticesPerFeature:e,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:o}):new yht(n,{verticesPerFeature:e,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:o})}function lQt(t){const e=Rse(t);return e.numComplexities>0&&(e.verticesPerFeature/=e.numComplexities,e.verticesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities),e}const qH={};function KPe(t,e){const i=kft(t,e),r=kht(e)?2:0;switch(e.type){case"extrude":return new Rp({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:r,memory:i});case"fill":if(t.type==="mesh-3d")return new Rp({drawCallsPerFeature:r,memory:i});if(e.outline!=null&&e.outline.size>0)return new Rp({verticesPerFeature:-12,verticesPerCoordinate:9,memory:i});case"water":return new Rp({verticesPerFeature:-6,verticesPerCoordinate:3,memory:i});case"line":return new Rp({verticesPerFeature:-6,verticesPerCoordinate:6,memory:i});case"object":return e.resource?.href?new Lre({verticesPerFeature:100,memory:i}):{...zft(e.resource?.primitive??TXe),memory:i};case"path":{let s=0,n=0;switch(e.profile){case"circle":s=_ct;break;case"quad":s=4;break;default:return void(e.profile,void 0)}switch(e.join){case"round":n=yct;break;case"miter":case"bevel":n=1;break;default:return}const o=2*s,a=s*n*2,l=a+o;let c=-2*a-o;switch(e.cap){case"none":break;case"butt":case"square":c+=2*(s-1);break;case"round":c+=2*(s*(vct-1)*2+s);break;default:return}return new Rp({verticesPerFeature:c,verticesPerCoordinate:l,memory:i})}case"text":case"icon":return new Rp({verticesPerFeature:6,memory:i});default:return}}function kft(t,e){const i=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?Il.EXTRUDE_EDGES:Il.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?Il.FILL_OUTLINE:Il.FILL;case"water":return Il.FILL;case"line":return e.join==="round"?Il.LINE_ROUND:Il.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return Il.PATH_ROUND_CIRCLE;case"quad":return Il.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return Il.PATH_MITER_CIRCLE;case"quad":return Il.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return i?Il.OBJECT_POINT:Il.OBJECT_POLYGON;case"icon":case"text":return i?Il.ICON_POINT:Il.ICON_POLYGON;default:return}}function zft(t){const e=qH[t];if(e)return e;const i=Uft(ght(t,new qU({},{spherical:!0,doublePrecisionRequiresObfuscation:!0})).levels);return qH[t]=new Rp({verticesPerFeature:i}),qH[t]}function Uft(t){return t.reduce((e,i,r)=>e+i.numVertices*(1/10**r),0)/t.reduce((e,i,r)=>e+1/10**r,0)}const Il={ICON_POINT:{bytesPerFeature:2346.460896195398,bytesPerFeatureLabel:3484.7516349999996,resourceBytes:0,draped:{bytesPerFeature:2007.3528529826217,bytesPerFeatureLabel:3522.702025}},ICON_POLYGON:{bytesPerFeature:3677.214053765355,bytesPerFeatureLabel:3502.5355950000003,resourceBytes:0,draped:{bytesPerFeature:3030.3700096053935,bytesPerFeatureLabel:3550.247175}},OBJECT_POINT:{bytesPerFeature:569.2092700798497,bytesPerFeatureLabel:3183.0256999999992,resourceBytes:0,draped:{bytesPerFeature:569.2092700798497,bytesPerFeatureLabel:3183.0256999999992}},OBJECT_POLYGON:{bytesPerFeature:1252.202280530861,bytesPerFeatureLabel:3125.853350000001,resourceBytes:0,draped:{bytesPerFeature:1252.202280530861,bytesPerFeatureLabel:3125.853350000001}},LINE_MITER:{bytesPerFeature:3252.89170349711,bytesPerFeatureLabel:3554.3931949999997,resourceBytes:0,draped:{bytesPerFeature:2843.5793737736867,bytesPerFeatureLabel:3538.2547083333334}},LINE_ROUND:{bytesPerFeature:3384.080501909172,bytesPerFeatureLabel:3522.6055950000004,resourceBytes:0,draped:{bytesPerFeature:2833.1897218657587,bytesPerFeatureLabel:3532.0680950000005}},PATH_MITER_CIRCLE:{bytesPerFeature:38490.63544346431,bytesPerFeatureLabel:3660.7835999999998,resourceBytes:0,draped:{bytesPerFeature:38490.63544346431,bytesPerFeatureLabel:3660.7835999999998}},PATH_ROUND_CIRCLE:{bytesPerFeature:42934.88589895749,bytesPerFeatureLabel:3729.49955,resourceBytes:0,draped:{bytesPerFeature:42934.88589895749,bytesPerFeatureLabel:3729.49955}},PATH_MITER_QUAD:{bytesPerFeature:25392.923576583788,bytesPerFeatureLabel:3647.05925,resourceBytes:0,draped:{bytesPerFeature:25392.923576583788,bytesPerFeatureLabel:3647.05925}},PATH_ROUND_QUAD:{bytesPerFeature:40448.297252606244,bytesPerFeatureLabel:3646.8303499999997,resourceBytes:0,draped:{bytesPerFeature:40448.297252606244,bytesPerFeatureLabel:3646.8303499999997}},FILL:{bytesPerFeature:3419.9079008788176,bytesPerFeatureLabel:3564.2132483333335,resourceBytes:0,draped:{bytesPerFeature:2910.096178654882,bytesPerFeatureLabel:3554.8655816666665}},FILL_OUTLINE:{bytesPerFeature:5018.088812445781,bytesPerFeatureLabel:3524.8219616666665,resourceBytes:0,draped:{bytesPerFeature:4278.49006198517,bytesPerFeatureLabel:3532.068368333334}},EXTRUDE:{bytesPerFeature:7963.8889768932695,bytesPerFeatureLabel:3628.5106350000005,resourceBytes:0,draped:{bytesPerFeature:7963.8889768932695,bytesPerFeatureLabel:3628.5106350000005}},EXTRUDE_EDGES:{bytesPerFeature:3111.7648563053044,bytesPerFeatureLabel:2658.4350683333337,resourceBytes:0,draped:{bytesPerFeature:3111.7648563053044,bytesPerFeatureLabel:2658.4350683333337}}};var Yy,O_;(function(t){t[t.RecreateSymbol=0]="RecreateSymbol",t[t.RecreateGraphics=1]="RecreateGraphics",t[t.FastUpdate=2]="FastUpdate"})(Yy||(Yy={})),function(t){t[t.Slow=0]="Slow",t[t.Fast=1]="Fast",t[t.Mixed=2]="Mixed",t[t.Loading=3]="Loading",t[t.Undefined=4]="Undefined"}(O_||(O_={}));let Pse=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=Wh.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,i){return this._loadStatus===Wh.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===Wh.FAILED?(i&&i(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=Wh.LOADED},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=Wh.FAILED,!Xr(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(e,i).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=hc(this._abortController):this._loadStatus===Wh.LOADING&&(this._loadStatus=Wh.FAILED),this._loader=null}};var Wh;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(Wh||(Wh={}));const c0=()=>J.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let QPe=class extends Pse{constructor(e,i,r,s){super(r.schedule),this.symbol=e,this.symbolLayer=i,this._context=r,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1,rotation:!1},this._materials=[],this.logger=c0(),this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new RU,this.complexity=this.computeComplexity(),this.ignoreDrivers=s.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=Spe(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}get usedMemory(){const e=this.complexity;return e==null?0:(this.draped?e.memory.draped:e.memory).bytesPerFeature}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const i=this._drivenProperties,r=Spe(e);return r.color!==i.color||r.opacity!==i.opacity||r.opacityAlwaysOpaque!==i.opacityAlwaysOpaque||r.size!==i.size||r.rotation!==i.rotation}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,i,r,s){const n=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=`${s} geometry failed to be created`;n?!this._logGeometryValidationWarnings(i,r,s)&&o&&o.length===0&&r==="rings"&&i.length>0&&i[0].length>2&&c0().warnOncePerTick(`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):c0().warnOncePerTick(`${a} (failed to project geometry to view spatial reference)`)}updateFocus(e,i){}_logGeometryValidationWarnings(e,i,r){const s=`${r} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(c0().warnOncePerTick(`${s} (no ${i} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(c0().warnOncePerTick(`${s} (${i} should be defined as a 2D array)`),!0)}_validateGeometry(e,i=null,r=null){if(i!=null&&!i.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${e.type}`),!1;switch(e.type){case"point":{const s=e;if(!isFinite(s.x)||!isFinite(s.y))return c0().warn("point coordinate is not a valid number, graphic skipped"),!1;break}case"polygon":OSe(e)&&c0().warnOnce("Fixed a non-closed polygon ring.")}return!0}_defaultElevationInfoNoZ(){return Bft}_defaultElevationInfoZ(){return Vft}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,i=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||i.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,i=new RU){const r=e.geometry,s=this.getDefaultElevationInfo(r);i.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,i.mode=this.getGeometryElevationMode(r,s),i.offsetMeters=this._elevationContext.meterUnitOffset??s.offset??0;const n=!this._elevationOptions.supportsOnTheGround&&i.mode==="on-the-ground";n&&(i.mode="relative-to-ground",i.offsetMeters=0);const o=n?Plt:this._elevationContext.featureExpressionInfoContext;return i.updateFeatureExpressionInfoContext(o,e,this._context.layer),i}prepareSymbolLayerPatch(e){}updateGeometry(e,i){return!1}updateTransform(e,i,r,s){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,i=Tpe){const r=this.draped?1:this._getLayerOpacity();return this._drivenProperties.opacity?r:e?r*e.a:i.hasIntrinsicColor?r:0}_getCombinedOpacityAndColor(e,i=Tpe){const r=this._getCombinedOpacity(e,i);if(this._drivenProperties.color)return AH(null,r);const s=e!=null?qe.toUnitRGB(e):Rte;return AH(s,r)}_getVertexOpacityAndColor(e,i=null){const r=this._drivenProperties.color?e.color:null,s=this._drivenProperties.opacity?e.opacity:null,n=AH(r,s);return i&&(n[0]*=i,n[1]*=i,n[2]*=i,n[3]*=i),n}isFastUpdatesEnabled(){return this._fastUpdates!=null}computeComplexity(){return KPe(this.symbol,this.symbolLayer)}globalPropertyChanged(e,i,r){switch(e){case"opacity":return this.layerOpacityChanged(i,r),!0;case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(i,r,s)!==Fm.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(i,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,i,r){let s=Fm.UPDATE;return e.forEach(n=>{const o=i(n);if(o!=null){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=r(o.elevationContext.mode)}else s=Fm.RECREATE}),s}applyRendererDiff(e,i){return Yy.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const i=this._fastUpdates.visualVariables,r=i.size?zH(i.size.field,e):0,s=i.color?zH(i.color.field,e):0,n=i.opacity?zH(i.opacity.field,e):0;return Gi(r,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&c0().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??null});return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function Spe(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1,rotation:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(i=>{switch(i.type){case"color":if(e.color=!0,i.stops)for(let r=0;r<i.stops.length;r++){const s=i.stops[r].color;s&&(e.opacity=!0,s.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0;break;case"rotation":e.rotation=!0}}),e}const Bft={mode:"on-the-ground",offset:0,unit:"meters"},Vft={mode:"absolute-height",offset:0,unit:"meters"},Tpe={hasIntrinsicColor:!1};function e3e(t,e,i){const r=jft(Epe,t,e,i)?Epe:[0,0,1];return Math.abs(r[2])>Math.cos(wt(80))?Qr.Z:Math.abs(r[1])>Math.abs(r[0])?Qr.Y:Qr.X}function jft(t,e,i,r){const s=(o=>!Array.isArray(o[0]))(e)?(o,a)=>e[3*o+a]:(o,a)=>e[o][a],n=r?Ao(r)/Yx(r):1;return lre(t,(o,a)=>se(o,s(a,0)*n,s(a,1)*n,s(a,2)),i)}const Epe=Br();function hQt(t,e,i){const r=(e.length>0?e[0]:t.length/3)-1,s=e3e(t,r,i);if(s!==Qr.Z){t=t.slice();for(let n=0;n<t.length;n+=3)t[n+s]=t[n+2]}return L$(t,e,3)}function dQt(t){const e=[[z.POSITION,new Wt(t.attributeData.position,t.indices,3,!0)]],i=OD(t.indices.length);return t.attributeData.colorFeature!=null?e.push([z.COLORFEATUREATTRIBUTE,new Wt([t.attributeData.colorFeature],i,1,!0)]):t.attributeData.color&&e.push([z.COLOR,new Wt(t.attributeData.color,i,4,!0)]),t.attributeData.uvMapSpace&&e.push([z.UVMAPSPACE,new Wt(t.attributeData.uvMapSpace,t.indices,4,!0)]),t.attributeData.boundingRect&&e.push([z.BOUNDINGRECT,new Wt(t.attributeData.boundingRect,t.indices,9,!0)]),new Ea(t.material,e,t.mapPositions,Nn.Mesh,t.attributeData.objectAndLayerIdColor)}function pQt(t,e=null){const i=[[z.POSITION,new Wt(t.attributeData.position,t.indices,3,!0)],[z.UV0,new Wt(t.attributeData.uv0,t.indices,2,!0)]];return new Ea(t.material,i,t.mapPositions,Nn.Mesh,e)}function Gft(t){switch(t.type){case"extent":if(t instanceof gi)return Sa.fromExtent(t);break;case"polygon":return t}return null}let fQt=class{constructor(e,i,r){this.renderData=e,this.layerUid=i,this.graphicUid=r,this.outGeometries=new Array}};function Cpe(t,e,i){const r=Array.isArray(t),s=r?t.length/e:t.byteLength/(4*e),n=r?t:new Uint32Array(t,0,s*e),o=i?.minReduction??0,a=i?.originalIndices||null,l=a?a.length:0,c=i?.componentOffsets||null;let h=0;if(c)for(let T=0;T<c.length-1;T++){const M=c[T+1]-c[T];M>h&&(h=M)}else h=s;const d=Math.floor(1.1*h)+1;(Mf==null||Mf.length<2*d)&&(Mf=new Uint32Array(yxe(2*d)));for(let T=0;T<2*d;T++)Mf[T]=0;let f=0;const m=!!c&&!!a,y=m?l:s;let v=e3(s);const _=new Uint32Array(l),b=1.96;let w=o!==0?Math.ceil(4*b*b/(o*o)*o*(1-o)):y,x=1,S=c?c[1]:y;for(let T=0;T<y;T++){if(T===w){const L=1-f/T;if(L+b*Math.sqrt(L*(1-L)/T)<o)return null;w*=2}if(T===S){for(let L=0;L<2*d;L++)Mf[L]=0;if(a)for(let L=c[x-1];L<c[x];L++)_[L]=v[a[L]];S=c[++x]}const M=m?a[T]:T,I=M*e,P=Wft(n,I,e);let D=P%d,F=f;for(;Mf[2*D+1]!==0;){if(Mf[2*D]===P){const L=Mf[2*D+1]-1;if(Hft(n,I,L*e,e)){F=v[L];break}}D++,D>=d&&(D-=d)}F===f&&(Mf[2*D]=P,Mf[2*D+1]=M+1,f++),v[M]=F}if(o!==0&&1-f/s<o)return null;if(m){for(let T=c[x-1];T<_.length;T++)_[T]=v[a[T]];v=lS(_)}const C=r?new Array(f):new Uint32Array(f*e);f=0;for(let T=0;T<y;T++)v[T]===f&&(qft(n,(m?a[T]:T)*e,C,f*e,e),f++);if(a&&!m){const T=new Uint32Array(l);for(let M=0;M<T.length;M++)T[M]=v[a[M]];v=lS(T)}return{buffer:Array.isArray(C)?C:C.buffer,indices:v,uniqueCount:f}}function Hft(t,e,i,r){for(let s=0;s<r;s++)if(t[e+s]!==t[i+s])return!1;return!0}function qft(t,e,i,r,s){for(let n=0;n<s;n++)i[r+n]=t[e+n]}function Wft(t,e,i){let r=0;for(let s=0;s<i;s++)r=t[e+s]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let Mf=null;function gQt(t){const e=Dse(t.rings,t.hasZ,G$.CCW_IS_HOLE,t.spatialReference),i=new Array;let r=0,s=0;for(const a of e.polygons){const l=a.count,c=a.index,h=Ix(e.position,3*c,3*l),d=a.holeIndices.map(m=>m-c),f=lS(L$(h,d,3));i.push({position:h,faces:f}),r+=h.length,s+=f.length}const n=Zft(i,r,s),o=Array.isArray(n.position)?Cpe(n.position,3,{originalIndices:n.faces}):Cpe(n.position.buffer,6,{originalIndices:n.faces});return n.position=iXe(new Float64Array(o.buffer)),n.faces=o.indices,n}function Zft(t,e,i){if(t.length===1)return t[0];const r=oc(e),s=new Array(i);let n=0,o=0,a=0;for(const l of t){for(let c=0;c<l.position.length;c++)r[n++]=l.position[c];for(const c of l.faces)s[o++]=c+a;a=n/3}return{position:r,faces:lS(s)}}function Dse(t,e,i,r){const s=t.length,n=new Array(s),o=new Array(s),a=new Array(s);let l=0;for(let y=0;y<s;++y)l+=t[y].length;let c=0,h=0,d=0;const f=oc(3*l);let m=0;for(let y=s-1;y>=0;y--){const v=t[y],_=i===G$.CCW_IS_HOLE&&Yft(v,e,r);if(_&&s!==1)n[c++]=v;else{let b=v.length;for(let x=0;x<c;++x)b+=n[x].length;const w={index:m,pathLengths:new Array(c+1),count:b,holeIndices:new Array(c)};w.pathLengths[0]=v.length,v.length>0&&(a[d++]={index:m,count:v.length}),m=_?xN(v,v.length-1,-1,f,m,v.length,e):xN(v,0,1,f,m,v.length,e);for(let x=0;x<c;++x){const S=n[x];w.holeIndices[x]=m,w.pathLengths[x+1]=S.length,S.length>0&&(a[d++]={index:m,count:S.length}),m=xN(S,0,1,f,m,S.length,e)}c=0,w.count>0&&(o[h++]=w)}}for(let y=0;y<c;++y){const v=n[y];v.length>0&&(a[d++]={index:m,count:v.length}),m=xN(v,0,1,f,m,v.length,e)}return o.length=h,a.length=d,{position:f,polygons:o,outlines:a}}function xN(t,e,i,r,s,n,o){s*=3;for(let a=0;a<n;++a){const l=t[e];r[s++]=l[0],r[s++]=l[1],r[s++]=o&&l[2]?l[2]:0,e+=i}return s/3}function Yft(t,e,i){if(!e)return!U_(t);const r=t.length-1;switch(e3e(t,r,i)){case Qr.X:return!U_(t,Qr.Y,Qr.Z);case Qr.Y:return!U_(t,Qr.X,Qr.Z);case Qr.Z:return!U_(t,Qr.X,Qr.Y)}}var G$;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(G$||(G$={}));var q2,WU,$J;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})(q2||(q2={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}(WU||(WU={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}($J||($J={}));var In,sd,Ms;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})(In||(In={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(sd||(sd={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(Ms||(Ms={}));let Jft=class{constructor(e,i){this.vec3=e,this.id=i}};function ZU(t,e,i,r){return new Jft(Le(t,e,i),r)}let $pe=class{constructor(){this._extent=Qt(),this.resolution=0,this.renderLocalOrigin=ZU(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new Xft}get extent(){return this._extent}setupGeometryViewsCyclical(e){this.setupGeometryView();const i=.001*e.range;if(this._extent[0]-i<=e.min){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Gz(this._extent,e.range,0,r)}if(this._extent[2]+i>=e.max){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Gz(this._extent,-e.range,0,r)}}setupGeometryView(){this.canvasGeometries.numViews=1,_b(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const i=this.canvasGeometries.extents[e];if(i[0]!==i[2]&&i[1]!==i[3])return!0}return!1}},Xft=class{constructor(){this.extents=[Qt(),Qt(),Qt()],this.numViews=0}};var ir;(function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.WaterNormal=3]="WaterNormal",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"})(ir||(ir={}));let Kft=class{constructor(e,i,r){this._fbos=e,this._format=i,this._name=r}get valid(){return this._handle?.getTexture()!=null}dispose(){this._handle=Dr(this._handle)}get texture(){return this._handle?.getTexture()}bind(e,i,r){this._handle&&this._handle.fbo?.width===i&&this._handle.fbo?.height===r||(this._handle?.release(),this._handle=this._fbos.acquire(i,r,this._name,this._format)),e.bindFramebuffer(this._handle?.fbo)}generateMipMap(){this._handle?.getTexture()?.descriptor?.hasMipmap&&this._handle?.getTexture()?.generateMipmap()}},MT=class{constructor(e,i,r,s,n=fr.RGBA_MIPMAP){this.output=r,this.content=s,this.fbo=new Kft(e,n,i)}get valid(){return this.fbo.valid}},Qft=class{constructor(e){this.targets=[new MT(e,"overlay color",Y.Color,ir.Color),new MT(e,"overlay IM color",Y.Color,ir.ColorNoRasterImage),new MT(e,"overlay highlight",Y.Highlight,ir.Highlight,fr.RG),new MT(e,"overlay water",Y.Normal,ir.WaterNormal),new MT(e,"overlay occluded",Y.Color,ir.Occluded)],Md()&&this.targets.push(new MT(e,"overlay olid",Y.ObjectAndLayerIdColor,ir.ObjectAndLayerIdColor,fr.RGBA))}getTexture(e){return this.targets[e]?.fbo.texture}dispose(){for(const e of this.targets)e.fbo.dispose()}computeValidity(){return this.targets.reduce((e,i,r)=>i.valid?e|=1<<r:e,0)}};function nG(t){return t?{ray:Pn(t.ray),c0:t.c0,c1:t.c1}:{ray:Pn(),c0:0,c1:Number.MAX_VALUE}}function emt(t,e=nG()){return MU(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function tmt(t,e,i=nG()){const r=Te(t.vector);return cre(t.origin,e,i.ray),i.c0=0,i.c1=r,i}function SQt(t,e){return t3e(t,t.c0,e)}function TQt(t,e){return t3e(t,t.c1,e)}function t3e(t,e,i){return oe(i,t.ray.origin,ie(i,t.ray.direction,e))}new Ov(()=>nG());function YU(t){return t?[Br(t[0]),Br(t[1]),Br(t[2]),Br(t[3]),Br(t[4]),Br(t[5])]:[Br(),Br(),Br(),Br(),Br(),Br()]}function i3e(){return[$(),$(),$(),$(),$(),$(),$(),$()]}function AJ(t,e){for(let i=0;i<kA;i++)are(t[i],e[i]);return t}function r3e(t,e,i,r=amt){const s=kn(rre.get(),e,t);Sl(s,s);for(let n=0;n<nmt;++n){const o=Yc(ire.get(),omt[n],s);se(r[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}s3e(i,r)}function s3e(t,e){kp(e[Vt.FAR_BOTTOM_LEFT],e[Vt.NEAR_BOTTOM_LEFT],e[Vt.NEAR_TOP_LEFT],t[_o.LEFT]),kp(e[Vt.NEAR_BOTTOM_RIGHT],e[Vt.FAR_BOTTOM_RIGHT],e[Vt.FAR_TOP_RIGHT],t[_o.RIGHT]),kp(e[Vt.FAR_BOTTOM_LEFT],e[Vt.FAR_BOTTOM_RIGHT],e[Vt.NEAR_BOTTOM_RIGHT],t[_o.BOTTOM]),kp(e[Vt.NEAR_TOP_LEFT],e[Vt.NEAR_TOP_RIGHT],e[Vt.FAR_TOP_RIGHT],t[_o.TOP]),kp(e[Vt.NEAR_BOTTOM_LEFT],e[Vt.NEAR_BOTTOM_RIGHT],e[Vt.NEAR_TOP_RIGHT],t[_o.NEAR]),kp(e[Vt.FAR_BOTTOM_RIGHT],e[Vt.FAR_BOTTOM_LEFT],e[Vt.FAR_TOP_LEFT],t[_o.FAR])}function J_(t,e){for(let i=0;i<kA;i++){const r=t[i];if(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=e[3])return!1}return!0}function imt(t,e){return n3e(t,emt(e,o3e.get()))}function EQt(t,e){for(let i=0;i<kA;i++){const r=t[i];if(!Got(r,e))return!1}return!0}function rmt(t,e,i){return n3e(t,tmt(e,i,o3e.get()))}function W2(t,e){for(let i=0;i<kA;i++)if(rn(t[i],e)>0)return!1;return!0}function n3e(t,e){for(let i=0;i<kA;i++)if(!jot(t[i],e))return!1;return!0}var _o,Vt;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(_o||(_o={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(Vt||(Vt={}));const smt={bottom:[Vt.FAR_BOTTOM_RIGHT,Vt.NEAR_BOTTOM_RIGHT,Vt.NEAR_BOTTOM_LEFT,Vt.FAR_BOTTOM_LEFT],near:[Vt.NEAR_BOTTOM_LEFT,Vt.NEAR_BOTTOM_RIGHT,Vt.NEAR_TOP_RIGHT,Vt.NEAR_TOP_LEFT],far:[Vt.FAR_BOTTOM_RIGHT,Vt.FAR_BOTTOM_LEFT,Vt.FAR_TOP_LEFT,Vt.FAR_TOP_RIGHT],right:[Vt.NEAR_BOTTOM_RIGHT,Vt.FAR_BOTTOM_RIGHT,Vt.FAR_TOP_RIGHT,Vt.NEAR_TOP_RIGHT],left:[Vt.FAR_BOTTOM_LEFT,Vt.NEAR_BOTTOM_LEFT,Vt.NEAR_TOP_LEFT,Vt.FAR_TOP_LEFT],top:[Vt.FAR_TOP_LEFT,Vt.NEAR_TOP_LEFT,Vt.NEAR_TOP_RIGHT,Vt.FAR_TOP_RIGHT]},kA=6,nmt=8,omt=[Gi(-1,-1,-1,1),Gi(1,-1,-1,1),Gi(1,1,-1,1),Gi(-1,1,-1,1),Gi(-1,-1,1,1),Gi(1,-1,1,1),Gi(1,1,1,1),Gi(-1,1,1,1)],o3e=new Ov(nG),amt=i3e();function lmt(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/e)}function cmt(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/i)}function umt(t,e,i){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}function hmt(t,e,i){return 2*Math.atan(i*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}let MJ=class{constructor(){this.adds=new Jt,this.removes=new Jt,this.updates=new Jt({allocator:e=>e||new dmt,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},dmt=class{},pmt=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var Pp,si;function a3e(t){const e=new Map,i=r=>{let s=e.get(r);return s||(s=new pmt,e.set(r,s)),s};return t.removes.forAll(r=>{WH(r)&&i(r.material).removes.push(r)}),t.adds.forAll(r=>{WH(r)&&i(r.material).adds.push(r)}),t.updates.forAll(r=>{WH(r.renderGeometry)&&i(r.renderGeometry.material).updates.push(r)}),e}function WH(t){return t.geometry.indexCount>=1}(function(t){t[t.Default=0]="Default",t[t.Screenshot=1]="Screenshot",t[t.ObjectAndLayerID=2]="ObjectAndLayerID"})(Pp||(Pp={})),function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"}(si||(si={}));var OJ;let ri=OJ=class extends ue{constructor(t){super(t),this._ray=Pn(),this._viewport=Gi(0,0,1,1),this._padding=Gi(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=un(1,1e3),this._viewDirty=!0,this._viewMatrix=Ve(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Ve(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Ve(),this._frustumDirty=!0,this._frustum=YU(),this._fullViewport=pi(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=$(),this._up=$(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get rows(){return this._rows}set rows(t){this._rows=Math.max(1,t)}get columns(){return this._columns}set columns(t){this._columns=Math.max(1,t)}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return ye(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){mn(this._viewMatrix,t),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),se($(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),se($(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),se($(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=P$(pi(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&oS(t,e)?e:t}get screenPadding(){if(this.pixelRatio===1)return this._padding;const t=P$(pi(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&oS(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[si.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[si.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[si.RIGHT]+this._padding[si.LEFT]}set fullWidth(t){this.width=t-(this._padding[si.RIGHT]+this._padding[si.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[si.TOP]+this._padding[si.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[si.TOP]+this._padding[si.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[si.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[si.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){Dx(this._padding,t)||(this._viewport[0]+=t[si.LEFT]-this._padding[si.LEFT],this._viewport[1]+=t[si.BOTTOM]-this._padding[si.BOTTOM],this._viewport[2]-=t[si.RIGHT]+t[si.LEFT]-(this._padding[si.RIGHT]+this._padding[si.LEFT]),this._viewport[3]-=t[si.TOP]+t[si.BOTTOM]-(this._padding[si.TOP]+this._padding[si.BOTTOM]),yd(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(kn(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return Sl(Ve(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||Ve()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return umt(this._fov,this.width,this.height)}set fovX(t){this._fov=lmt(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return hmt(this._fov,this.width,this.height)}set fovY(t){this._fov=cmt(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return xr(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Sl(this._viewInverseTransposeMatrix,this.viewMatrix),dc(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const{near:e,far:i}=this;return 2*e*i/(i+e-t*(i-e))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}get _projectionMatrixInternal(){const t=this.width,e=this.height,i=this.near*Math.tan(this.fovY/2)*2,r=i*this._aspect,s=i/this.rows,n=r/this.columns,o=-r/2+this.column*n,a=o+n,l=-i/2+this.row*s,c=l+s,h=R2e(Ve(),o*(1+2*this._padding[si.LEFT]/t),a*(1+2*this._padding[si.RIGHT]/t),l*(1+2*this._padding[si.BOTTOM]/e),c*(1+2*this._padding[si.TOP]/e),this.near,this.far),d=this._get("projectionMatrix");return d&&Yte(d,h)?d:h}copyFrom(t){ne(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,yd(this._viewport,t.viewport),this.notifyChange("_viewport"),yd(this._padding,t.padding),this.notifyChange("_padding"),zn(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.row=t.row,this.column=t.column,this.rows=t.rows,this.columns=t.columns,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(mn(this._viewMatrix,t.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(AJ(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(mn(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),yd(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up,this.fov=t.fov}clone(){return new OJ().copyFrom(this)}equals(t){return Qn(this.eye,t.eye)&&Qn(this.center,t.center)&&Qn(this.up,t.up)&&Dx(this._viewport,t.viewport)&&Dx(this._padding,t.padding)&&j$e(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation&&this.row===t.row&&this.column===t.column&&this.rows===t.rows&&this.columns===t.columns}almostEquals(t){const e=Math.max(1,1/this.pixelRatio,1/t.pixelRatio);if(Math.abs(t.fov-this._fov)>=.001||$U(t.screenPadding,this.screenPadding)>=e||$U(this.screenViewport,t.screenViewport)>=e||this.row!==t.row||this.column!==t.column||this.rows!==t.rows||this.columns!==t.columns)return!1;Ri(Aa,t.eye,t.center),Ri(ZH,this.eye,this.center);const i=de(Aa,ZH),r=pU(Aa),s=pU(ZH),n=5e-4;return i*i>=(1-1e-10)*r*s&&O$(t.eye,this.eye)<Math.max(r,s)*n*n}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(ab(this.viewForward,ye(Aa,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=nn()){return t[0]=(this.padding[si.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[si.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,i=.5){return t[0]=this.padding[si.LEFT]+this.width*e,t[1]=this.padding[si.BOTTOM]+this.height*i,t[2]=.5,t}setGLViewport(t){const e=this.viewport,i=this.padding;t.setViewport(e[0]-i[3],e[1]-i[2],e[2]+i[1]+i[3],e[3]+i[0]+i[2])}applyProjection(t,e){t!==Oi&&ne(Oi,t),Oi[3]=1,Yc(Oi,Oi,this.projectionMatrix);const i=Math.abs(Oi[3]);ie(Oi,Oi,1/i);const r=this.fullViewport;e[0]=dt(0,r[0]+r[2],.5+.5*Oi[0]),e[1]=dt(0,r[1]+r[3],.5+.5*Oi[1]),e[2]=.5*(Oi[2]+1),e[3]=i}unapplyProjection(t,e){const i=this.fullViewport;Oi[0]=(t[0]/(i[0]+i[2])*2-1)*t[3],Oi[1]=(t[1]/(i[1]+i[3])*2-1)*t[3],Oi[2]=(2*t[2]-1)*t[3],Oi[3]=t[3],this.inverseProjectionMatrix!=null&&(Yc(Oi,Oi,this.inverseProjectionMatrix),e[0]=Oi[0],e[1]=Oi[1],e[2]=Oi[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,YH),this.renderToScreen(YH,e),e}projectToRenderScreen(t,e){if(Oi[0]=t[0],Oi[1]=t[1],Oi[2]=t[2],Oi[3]=1,Yc(Oi,Oi,this.viewProjectionMatrix),Oi[3]===0)return null;const i=Oi;ie(i,i,1/Math.abs(Oi[3]));const r=this.fullViewport,s=dt(0,r[0]+r[2],.5+.5*i[0]),n=dt(0,r[1]+r[3],.5+.5*i[1]);return"x"in e?(e.x=s,e.y=n):(e[0]=s,e[1]=n,e.length>2&&(e[2]=.5*(i[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,YH),e)}unprojectFromRenderScreen(t,e){if(kn(SN,this.projectionMatrix,this.viewMatrix),!Sl(SN,SN))return null;const i=this.fullViewport;return Oi[0]=2*(t[0]-i[0])/i[2]-1,Oi[1]=2*(t[1]-i[1])/i[3]-1,Oi[2]=2*t[2]-1,Oi[3]=1,Yc(Oi,Oi,SN),Oi[3]===0?null:(e[0]=Oi[0]/Oi[3],e[1]=Oi[1]/Oi[3],e[2]=Oi[2]/Oi[3],e)}constrainWindowSize(t,e,i,r){const s=t*this.pixelRatio,n=e*this.pixelRatio,o=Math.max(s-i/2,0),a=Math.max(this.fullHeight-n-r/2,0),l=-Math.min(s-i/2,0),c=-Math.min(this.fullHeight-n-r/2,0),h=i-l- -Math.min(this.fullWidth-s-i/2,0),d=r-c- -Math.min(n-r/2,0);return[Math.round(o),Math.round(a),Math.round(h),Math.round(d)]}computeUp(t){t===Be.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const i=t[0]*this.pixelRatio,r=this.fullHeight-t[1]*this.pixelRatio;return e[0]=i,e[1]=r,e}renderToScreen(t,e){const i=t[0]/this.pixelRatio,r=(this.fullHeight-t[1])/this.pixelRatio;e[0]=i,e[1]=r}_computeUpGlobal(){ye(Aa,this.center,this.eye);const t=Te(this.center);t<1?(se(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(de(Aa,this.center))>.9999*Te(Aa)*t||(lt(this._up,Aa,this.center),lt(this._up,this._up,Aa),ae(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){kS(Aa,this.eye,this.center),Math.abs(Aa[2])<=.9999&&(ie(Aa,Aa,Aa[2]),se(this._up,-Aa[0],-Aa[1],1-Aa[2]),ae(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,i=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?Qn(t,e)||(ne(e,t),this._markViewDirty(),i.length&&this.notifyChange(i)):J.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(r3e(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(jV(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};u([p()],ri.prototype,"_viewport",void 0),u([p()],ri.prototype,"_padding",void 0),u([p()],ri.prototype,"_fov",void 0),u([p()],ri.prototype,"_nearFar",void 0),u([p()],ri.prototype,"_viewDirty",void 0),u([p()],ri.prototype,"_viewMatrix",void 0),u([p()],ri.prototype,"_pixelRatio",void 0),u([p()],ri.prototype,"pixelRatio",null),u([p()],ri.prototype,"row",void 0),u([p()],ri.prototype,"column",void 0),u([p()],ri.prototype,"_rows",void 0),u([p()],ri.prototype,"rows",null),u([p()],ri.prototype,"_columns",void 0),u([p()],ri.prototype,"columns",null),u([p()],ri.prototype,"eye",null),u([p()],ri.prototype,"center",null),u([p()],ri.prototype,"_center",void 0),u([p()],ri.prototype,"up",null),u([p()],ri.prototype,"_up",void 0),u([p()],ri.prototype,"viewMatrix",null),u([p({readOnly:!0})],ri.prototype,"viewForward",null),u([p({readOnly:!0})],ri.prototype,"viewUp",null),u([p({readOnly:!0})],ri.prototype,"viewRight",null),u([p({readOnly:!0})],ri.prototype,"nearFar",null),u([p()],ri.prototype,"near",null),u([p()],ri.prototype,"far",null),u([p()],ri.prototype,"viewport",null),u([p({readOnly:!0})],ri.prototype,"screenViewport",null),u([p({readOnly:!0})],ri.prototype,"screenPadding",null),u([p()],ri.prototype,"x",null),u([p()],ri.prototype,"y",null),u([p()],ri.prototype,"width",null),u([p()],ri.prototype,"height",null),u([p()],ri.prototype,"fullWidth",null),u([p()],ri.prototype,"fullHeight",null),u([p({readOnly:!0})],ri.prototype,"_aspect",null),u([p()],ri.prototype,"padding",null),u([p({readOnly:!0})],ri.prototype,"projectionMatrix",null),u([p({readOnly:!0})],ri.prototype,"inverseProjectionMatrix",null),u([p()],ri.prototype,"fov",null),u([p()],ri.prototype,"fovX",null),u([p()],ri.prototype,"fovY",null),u([p()],ri.prototype,"viewInverseTransposeMatrix",null),u([p({readOnly:!0})],ri.prototype,"_projectionMatrixInternal",null),u([p()],ri.prototype,"relativeElevation",void 0),ri=OJ=u([A("esri.views.3d.webgl.RenderCamera")],ri);const jr=ri,Oi=pi(),SN=Ve(),Aa=$(),ZH=$(),YH=Wp();var Ha;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight",t[t.ViewshedShadowMap=3]="ViewshedShadowMap"})(Ha||(Ha={}));function MQt(t){t.fragment.code.add(E`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function fmt(t){t.fragment.code.add(E`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function UD(t){t.fragment.code.add(E`
    const float GAMMA = ${E.float(iU)};
    const float INV_GAMMA = ${E.float(1/iU)};

    vec4 delinearizeGamma(vec4 color) {
      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.a);
    }

    vec3 linearizeGamma(vec3 color) {
      return pow(color, vec3(GAMMA));
    }
  `)}function mmt(t,e){if(!e.screenSpaceReflections)return;const i=t.fragment;i.include(fg),i.uniforms.add(new fv("nearFar",r=>r.camera.nearFar),new so("depthMap",r=>r.depth?.attachment),new Co("proj",r=>r.camera.projectionMatrix),new Fn("invResolutionHeight",r=>1/r.camera.height),new Co("reprojectionMatrix",r=>r.ssr.reprojectionMatrix)).code.add(E`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);
    float dDepthBefore = 0.0;

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        float weight = dDepth / (dDepth - dDepthBefore);
        vec2 Pf = mix(P - dP, P, 1.0 - weight);
        if (abs(Pf.y - projectedCoordStart.y) > invResolutionHeight) {
          return vec3(Pf, depth);
        }
        else {
          return vec3(P, depth);
        }
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
      dDepthBefore = dDepth;
    }
    return vec3(P, 0.0);
  }
  `)}var Gu,gv;function gmt(t){return t!=null&&!t.running}(function(t){t[t.Idle=0]="Idle",t[t.Rendering=1]="Rendering",t[t.Ready=2]="Ready",t[t.Fading=3]="Fading"})(Gu||(Gu={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA",t[t.COUNT=2]="COUNT"}(gv||(gv={}));function Nv(t=ymt){return[t[0],t[1],t[2],t[3]]}function JH(t,e,i=Nv()){return ne(i,t),i[3]=e,i}function Ape(t,e,i){return lt(i,t,e),ae(i,i),i[3]=-RAe(t,e),i}function OQt(t,e=Nv()){const i=I2e(lI,t);return l3e(e,$o(Ore(e,i))),e}function Mpe(t,e,i=Nv()){return LU(lI,t,Ope(t)),LU(Ipe,e,Ope(e)),Nj(lI,Ipe,lI),l3e(i,$o(Ore(i,lI)))}function IQt(t,e,i,r=Nv()){return JH(Pte,t,TN),JH(Dte,e,Rpe),JH(f$,i,Ppe),Mpe(TN,Rpe,TN),Mpe(TN,Ppe,r),r}function RQt(t){return t}function PQt(t){return t[3]}function Ope(t){return wt(t[3])}function l3e(t,e){return t[3]=e,t}const ymt=[0,0,1,0],lI=Dd(),Ipe=Dd();Nv();const TN=Nv(),Rpe=Nv(),Ppe=Nv();var IJ;let cI=IJ=class extends ee{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new IJ({cloudCover:this.cloudCover})}};u([Ue({cloudy:"cloudy"}),p({json:{write:{isRequired:!0}}})],cI.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],cI.prototype,"cloudCover",void 0),cI=IJ=u([A("esri.views.3d.environment.CloudyWeather")],cI);const vmt=cI;var RJ;let uI=RJ=class extends ee{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new RJ({fogStrength:this.fogStrength})}};u([Ue({foggy:"foggy"}),p({json:{write:{isRequired:!0}}})],uI.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],uI.prototype,"fogStrength",void 0),uI=RJ=u([A("esri.views.3d.environment.FoggyWeather")],uI);const _mt=uI;var PJ;let FE=PJ=class extends ee{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new PJ({cloudCover:this.cloudCover,precipitation:this.precipitation})}};u([Ue({rainy:"rainy"}),p({json:{write:{isRequired:!0}}})],FE.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],FE.prototype,"cloudCover",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],FE.prototype,"precipitation",void 0),FE=PJ=u([A("esri.views.3d.environment.RainyWeather")],FE);const bmt=FE;var DJ;let b1=DJ=class extends ee{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new DJ({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};u([Ue({snowy:"snowy"}),p({json:{write:{isRequired:!0}}})],b1.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b1.prototype,"cloudCover",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b1.prototype,"precipitation",void 0),u([p({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],b1.prototype,"snowCover",void 0),b1=DJ=u([A("esri.views.3d.environment.SnowyWeather")],b1);const wmt=b1;var LJ;let hI=LJ=class extends ee{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new LJ({cloudCover:this.cloudCover})}};u([Ue({sunny:"sunny"}),p({json:{write:{isRequired:!0}}})],hI.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],hI.prototype,"cloudCover",void 0),hI=LJ=u([A("esri.views.3d.environment.SunnyWeather")],hI);const JU=hI,Lse={key:"type",base:JU,typeMap:{sunny:JU,cloudy:vmt,rainy:bmt,snowy:wmt,foggy:_mt}},xmt=Object.keys(Lse.typeMap);function Smt(t,e){return!!xmt.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const FC=1e4,Tmt=1e5;let Emt=class{constructor(){this.startTime=0,this._data=xa(null),this._readChannels=gv.RG,this.parallax=new Dpe,this.parallaxNew=new Dpe,this._anchorPoint=$(),this._fadeState=xa(Rr.HIDE),this._fadeFactor=xa(1)}get data(){return this._data.value}set data(e){this._data.value=e}get readChannels(){return this._readChannels}get fadeState(){return this._fadeState.value}get fadeFactor(){return this._fadeFactor.value}get opacity(){switch(this.fadeState){case Rr.HIDE:return 0;case Rr.FADE_OUT:return 1-this.fadeFactor;case Rr.FADE_IN:return this.fadeFactor;case Rr.SHOW:case Rr.CROSS_FADE:return 1}}fade(e,i,r){this.isFading&&this.fadeFactor<1&&(this._fadeFactor.value=r?ce((i-this.startTime)/($mt*r),0,1):1,this.fadeFactor===1&&this._endFade()),this._evaluateState(e,i),this._updateParallax(e)}_evaluateState(e,i){const r=e.relativeElevation,s=this._updateAnchorPoint(e);(r>1.7*FC||r<-1e4||s>Npe)&&this.opacity>0?this._startFade(Rr.HIDE,i):this.isFading||(r>FC||r<-.35*FC||s>Amt*Npe?this.opacity>0&&this._startFade(Rr.FADE_OUT,i):gmt(this.data)&&(this.opacity===0?this._startFade(Rr.FADE_IN,i):this.data.state===Gu.Ready&&(this.fadeState===Rr.SHOW?this._startFade(Rr.CROSS_FADE,i):this._startFade(Rr.SHOW,i))))}_updateParallax(e){const i=Yo(e.eye);this.parallax.radiusCurvatureCorrection=.84*Math.sqrt(Math.max(i-xi.radius*xi.radius,0))/Math.sqrt(i),Ape(Lpe,this.parallax.anchorPoint,OT),Wu(this.parallax.transform,Kn,OT[3],OT),Ape(Lpe,this.parallaxNew.anchorPoint,OT),Wu(this.parallaxNew.transform,Kn,OT[3],OT)}_updateAnchorPoint(e){return ae(this._anchorPoint,e.eye),ie(this._anchorPoint,this._anchorPoint,xi.radius),this.fadeState===Rr.HIDE&&this.data?.state===Gu.Ready?(ne(this.parallax.anchorPoint,this._anchorPoint),0):Te(ye(Cmt,this.parallax.anchorPoint,this._anchorPoint))}requestFade(){this._fadeFactor.value=0}_startFade(e,i){switch(this._fadeState.value=e,this.startTime=i,e){case Rr.CROSS_FADE:this.requestFade(),this._switchReadChannels(),ne(this.parallaxNew.anchorPoint,this._anchorPoint);break;case Rr.FADE_IN:this.requestFade(),this._switchReadChannels(),ne(this.parallax.anchorPoint,this._anchorPoint),ne(this.parallaxNew.anchorPoint,this._anchorPoint);break;case Rr.FADE_OUT:this.requestFade();break;case Rr.SHOW:this._switchReadChannels(),ne(this.parallax.anchorPoint,this._anchorPoint),ne(this.parallaxNew.anchorPoint,this._anchorPoint),this._endFade();break;case Rr.HIDE:this._endFade()}}_endFade(){switch(this._fadeFactor.value=1,this.data&&this.data.state!==Gu.Ready&&(this.data.state=Gu.Idle),this.fadeState){case Rr.CROSS_FADE:ne(this.parallax.anchorPoint,this.parallaxNew.anchorPoint),this._fadeState.value=Rr.SHOW;break;case Rr.FADE_IN:this._fadeState.value=Rr.SHOW;break;case Rr.FADE_OUT:this._fadeState.value=Rr.HIDE;break;case Rr.SHOW:case Rr.HIDE:break;default:this.fadeState}}_switchReadChannels(){this.data?.state===Gu.Ready&&(this._readChannels=1-this._readChannels,this.data.state=Gu.Fading)}get isFading(){return this.fadeState===Rr.FADE_OUT||this.fadeState===Rr.FADE_IN||this.fadeState===Rr.CROSS_FADE}};var Rr;(function(t){t[t.HIDE=0]="HIDE",t[t.FADE_IN=1]="FADE_IN",t[t.SHOW=2]="SHOW",t[t.CROSS_FADE=3]="CROSS_FADE",t[t.FADE_OUT=4]="FADE_OUT"})(Rr||(Rr={}));let Dpe=class{constructor(){this.anchorPoint=$(),this.radiusCurvatureCorrection=0,this.transform=Ve()}};const Lpe=Le(0,0,1),OT=Nv(),Cmt=$(),$mt=1.25,Amt=.5,Npe=2e5;let Mmt=class extends or{constructor(e,i){super(e,"samplerCube",Pt.Bind,(r,s)=>r.bindTexture(e,i(s)))}};function c3e(t){const e=t.fragment;e.constants.add("radiusCloudsSquared","float",Omt).code.add(E`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos) {
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusCloudsSquared;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
return (cameraPosition + dir * pointIntDist) - spherePos;
}`),e.uniforms.add(new Fn("radiusCurvatureCorrection",({clouds:l})=>l.parallax.radiusCurvatureCorrection)).code.add(E`vec3 correctForPlanetCurvature(vec3 dir) {
dir.z = dir.z * (1.0 - radiusCurvatureCorrection) + radiusCurvatureCorrection;
return dir;
}`),e.code.add(E`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec) {
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),eg(e),mv(e);const i=Le(.28,.175,.035);e.constants.add("RIM_COLOR","vec3",i),e.code.add(E`
    vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds) {
      float upDotLight = dot(cameraPosition, mainLightDirection);
      float dirDotLight = max(dot(worldSpaceRay, mainLightDirection), 0.0);
      float sunsetTransition = clamp(pow(max(upDotLight, 0.0), ${E.float(.3)}), 0.0, 1.0);

      // Base color of the clouds that depends on lighting of the sun and sky
      vec3 ambientLight = calculateAmbientIrradiance(cameraPosition,  0.0);
      vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
      vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));

      // Rim light around the edge of the clouds simulating scattering of the direct lun light
      float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
      float rimLightIntensity = 0.5 + 0.5 * pow(max(upDotLight, 0.0), 0.35);
      vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, ${E.float(140)})) * scatteringMod;

      // Brighten the clouds around the sun at the sunsets
      float additionalLight = ${E.float(.2)} * pow(dirDotLight, ${E.float(10)}) * (1. - pow(sunsetTransition, ${E.float(.3)})) ;

      return vec3(baseCloudColor * (1.0 + additionalLight) + directSunScattering);
    }
  `),e.uniforms.add(new GU("readChannelsRG",l=>l.clouds.readChannels===gv.RG),new Mmt("cubeMap",l=>l.clouds.data?.cubeMap?.colorTexture??null)).code.add(E`vec4 sampleCloud(vec3 rayDir, bool readOtherChannel) {
vec4 s = texture(cubeMap, rayDir);
bool readRG = readChannelsRG ^^ readOtherChannel;
s = readRG ? vec4(vec3(s.r), s.g) : vec4(vec3(s.b), s.a);
return length(s) == 0.0 ? vec4(s.rgb, 1.0) : s;
}`),e.uniforms.add(new Ja("anchorPoint",l=>l.clouds.parallax.anchorPoint),new Ja("anchorPointNew",l=>l.clouds.parallaxNew.anchorPoint),new Co("rotationClouds",l=>l.clouds.parallax.transform),new Co("rotationCloudsNew",l=>l.clouds.parallaxNew.transform),new Fn("cloudsOpacity",l=>l.clouds.opacity),new Fn("fadeFactor",l=>l.clouds.fadeFactor),new GU("crossFade",l=>l.clouds.fadeState===Rr.CROSS_FADE)).code.add(E`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition) {
vec3 intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPoint);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = sampleCloud(worldRayRotatedCorrected, crossFade);
vec3 cameraPositionN = normalize(cameraPosition);
vec4 cloudColor = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
if(crossFade) {
intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPointNew);
worldRayRotated = rotateDirectionToAnchorPoint(rotationCloudsNew, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = sampleCloud(worldRayRotatedCorrected, false);
vec4 cloudColorNew = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorNew, fadeFactor);
}
float totalTransmittance = length(cloudColor.rgb) == 0.0 ?
1.0 :
clamp(cloudColor.a * cloudsOpacity + (1.0 - cloudsOpacity), 0.0 , 1.0);
return vec4(cloudColor.rgb, totalTransmittance);
}`)}const Omt=(xi.radius+Tmt)**2;function oG(t){t.code.add(E`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}`)}function Imt(t,e){t.include(sft,e),t.include(UD),t.include(fmt),e.cloudReflections&&t.include(c3e),t.include(mmt,e);const i=t.fragment;i.include(oG),i.constants.add("fresnelSky","vec3",[.02,1,15]),i.constants.add("fresnelMaterial","vec2",[.02,.1]),i.constants.add("roughness","float",.015),i.constants.add("foamIntensityExternal","float",1.7),i.constants.add("ssrIntensity","float",.65),i.constants.add("ssrHeightFadeStart","float",FPe),i.constants.add("ssrHeightFadeEnd","float",jU),i.constants.add("waterDiffusion","float",.92),i.constants.add("waterSeaColorMod","float",.8),i.constants.add("correctionViewingPowerFactor","float",.4),i.constants.add("skyZenitColor","vec3",[.52,.68,.9]),i.constants.add("skyColor","vec3",[.67,.79,.9]),i.constants.add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(E`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add(new Fn("lightingSpecularStrength",r=>r.lighting.mainLight.specularStrength),new Fn("lightingEnvironmentStrength",r=>r.lighting.mainLight.environmentStrength)),i.code.add(E`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
float NdotL = clamp(dot(n, l), 0.0, 1.0);
specular = lightingSpecularStrength * NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.cloudReflections&&i.uniforms.add(new Fn("cloudsOpacity",r=>r.clouds.opacity)).code.add(E`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * cloudsOpacity;`),e.screenSpaceReflections?i.uniforms.add(new Co("view",r=>r.camera.viewMatrix),new so("lastFrameColorTexture",r=>r.ssr.lastFrameColor?.getTexture()),new Fn("fadeFactorSSR",r=>r.ssr.fadeFactor)).code.add(E`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view * vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`):i.code.add(E`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.cloudReflections?e.screenSpaceReflections?i.code.add(E`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(E`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(E`return waterRenderedColor;
}`)}var Em;function Rmt(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new i3("overlayTexOffset",(s,n)=>Pmt(s,n)),new i3("overlayTexScale",(s,n)=>Dmt(s,n))),r.constants.add("overlayOpacity","float",1),r.uniforms.add(new $t("ovColorTex",(s,n)=>h3e(s,n))),u3e(t,e)}function $M(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new Fpe("overlayTexOffset"),new Fpe("overlayTexScale")),r.uniforms.add(new pt("overlayOpacity",s=>s.overlayOpacity),new $t("ovColorTex",(s,n)=>n.overlay?.getTexture(s.overlayContent))),u3e(t,e)}function u3e(t,e){const i=e.pbrMode===_t.Water||e.pbrMode===_t.WaterOnIntegratedMesh||e.pbrMode===_t.TerrainWithWater;i&&t.include(Imt,e);const{vertex:r,fragment:s}=t;t.varyings.add("vtcOverlay","vec4"),r.code.add(E`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),s.code.add(E`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),s.code.add(E`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),s.code.add(E`vec4 getOverlayColorTexel() {
vec4 texCoords = vtcOverlay;
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y) * texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w) * texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),s.code.add(E`vec2 getAllOverlayHighlightValuesEncoded() {
vec4 texCoords = vtcOverlay;
vec2 uvInner = texCoords.xy;
vec2 uvOuter = texCoords.zw;
bool isValidInner = isValid(uvInner, fwidth(uvInner));
bool isValidOuter = isValid(uvOuter, vec2(0.0, 0.0));
vec2 texelCoordInner = uvInner * vec2(0.5, 1.0);
vec2 texelCoordOuter = uvOuter * vec2(0.5, 1.0) + vec2(0.5,0.0);
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec2 texelValueInner = texelFetch(ovColorTex, ivec2(texelCoordInner * texDim), 0).rg;
vec2 texelValueOuter = texelFetch(ovColorTex, ivec2(texelCoordOuter * texDim), 0).rg;
return
isValidInner ? texelValueInner :
isValidOuter ? texelValueOuter :
vec2(0.0);
}`),i&&(eg(s),mv(s),s.code.add(E`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function h3e(t,e){return t.identifier===Ha.Material&&_s(t.output)?e.overlay?.getTexture(ir.ColorNoRasterImage):t.identifier===Ha.Material&&t.output===Y.ObjectAndLayerIdColor?e.overlay?.getTexture(ir.ObjectAndLayerIdColor):t.identifier===Ha.Highlight?e.overlay?.getTexture(ir.Highlight):null}function Pmt(t,e){const i=e.overlay?.overlays[In.INNER]?.extent;jz(i)&&(bm[0]=t.toMapSpace[0]/Zo(i)-i[0]/Zo(i),bm[1]=t.toMapSpace[1]/wl(i)-i[1]/wl(i));const r=e.overlay?.overlays[In.OUTER]?.extent;return jz(r)&&(bm[2]=t.toMapSpace[0]/Zo(r)-r[0]/Zo(r),bm[3]=t.toMapSpace[1]/wl(r)-r[1]/wl(r)),bm}function Dmt(t,e){const i=e.overlay?.overlays[In.INNER]?.extent;jz(i)&&(bm[0]=t.toMapSpace[2]/Zo(i),bm[1]=t.toMapSpace[3]/wl(i));const r=e.overlay?.overlays[In.OUTER]?.extent;return jz(r)&&(bm[2]=t.toMapSpace[2]/Zo(r),bm[3]=t.toMapSpace[3]/wl(r)),bm}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(Em||(Em={}));const bm=pi();let Fpe=class extends or{constructor(e){super(e,"vec4")}},Nse=class extends ar{constructor(){super(...arguments),this.color=Le(1,1,1)}};function d3e(){const t=new ki;return t.include(ea),t.fragment.uniforms.add(new $t("tex",e=>e.texture),new Cr("uColor",e=>e.color)),t.fragment.main.add(E`vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);`),t}const Lmt=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:Nse,build:d3e},Symbol.toStringTag,{value:"Module"})),p3e={required:[]},Nmt={required:[Y.Depth]};let f3e=class extends ue{precompile(e){return!!this.acquireTechniques(e)}consumes(){return p3e}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}modify(e){}get numGeometries(){return 0}get hasOccludees(){return!1}get hasEmissions(){return!1}forEachGeometry(e){}queryRenderOccludedState(e){return!1}},BD=class extends f3e{},BQt=class extends f3e{},kpe=class extends or{constructor(e,i){super(e,"ivec2",Pt.Pass,(r,s,n)=>r.setUniform2iv(e,i(s,n)))}},Fse=class extends ar{};function m3e(){const t=new ki,{outputs:e,fragment:i}=t;return t.include(ea),i.uniforms.add(new Km("textureInput",r=>r.input)),i.constants.add("outlineWidth","int",Math.ceil(n3)),i.constants.add("cellSize","int",X_),e.add("fragGrid","vec2"),i.main.add(E`ivec2 inputTextureSize = textureSize(textureInput, 0);
ivec2 cellBottomLeftCornerInput = ivec2(floor(gl_FragCoord.xy) * vec2(cellSize));
ivec2 coordMid =  cellBottomLeftCornerInput + ivec2(cellSize >> 1);
uvec2 centreTexel = uvec2( texelFetch(textureInput, coordMid, 0).rg * 255.0) & uvec2(0x55u);
float marginSquare = float(outlineWidth*outlineWidth);
uvec2 outputValue = centreTexel & uvec2(0x55u);
for(int y = -outlineWidth; y <= cellSize + outlineWidth; y+=2) {
int dy = y < 0 ? -y : y > cellSize ? y-cellSize : 0;
int xMargin = dy > 0 ? int(ceil(sqrt(marginSquare - float(dy*dy)))) : outlineWidth;
for(int x = -xMargin; x <= cellSize + xMargin; x+=2) {
ivec2 coord = cellBottomLeftCornerInput + ivec2(x, y);
uvec2[4] texels = uvec2[4] (
uvec2(texelFetch(textureInput,coord+ivec2(0,0),0).rg * 255.0) & uvec2(0x55u),
uvec2(texelFetch(textureInput,coord+ivec2(1,0),0).rg * 255.0) & uvec2(0x55u),
uvec2(texelFetch(textureInput,coord+ivec2(0,1),0).rg * 255.0) & uvec2(0x55u),
uvec2(texelFetch(textureInput,coord+ivec2(1,1),0).rg * 255.0) & uvec2(0x55u)
);
if (texels[0] == texels[1] && texels[1] == texels[2] && texels[2] == texels[3] && texels[3] ==  centreTexel) {
continue;
}
for (int i=0; i<4; ++i){
outputValue |= ((texels[i] ^ centreTexel) << 1);
outputValue |= texels[i];
}
}
}
fragGrid = vec2(outputValue) / 255.0;`),t}const X_=32,n3=9,kse=.4,Fmt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:Fse,blurSize:kse,build:m3e,gridCellPixelSize:X_,outlineSize:n3},Symbol.toStringTag,{value:"Module"}));function aG(t){const{vertex:e}=t;e.uniforms.add(new $t("coverageTexture",i=>i.coverageTexture),new kpe("highlightRenderCellCount",i=>li(zpe,i.horizontalCellCount,i.verticalCellCount)),new kpe("highlightTextureResolution",({highlightTexture:i})=>li(zpe,i.descriptor.width,i.descriptor.height)),new Jb("highlightLevel",i=>i.highlightLevel)).constants.add("cellSize","int",X_),t.varyings.add("sUV","vec2"),t.varyings.add("vOutlinePossible","float"),e.code.add(E`const ivec2 cellVertices[4] = ivec2[4](ivec2(0,0), ivec2(1,0), ivec2(0,1), ivec2(1,1));`).main.add(E`int cellIndex = gl_InstanceID;
int cellX = cellIndex % highlightRenderCellCount[0];
int cellY = (cellIndex - cellX) / highlightRenderCellCount[0];
ivec2 cellPos = ivec2(cellX, cellY);
uvec2 covTexel = uvec2(texelFetch(coverageTexture, cellPos, 0).rg * 255.0);
int channelIndex = (highlightLevel >> 2) & 3;
uint channelValue = covTexel[channelIndex];
int highlightIndex = (highlightLevel & 3) << 1;
bool covered = ((channelValue >> highlightIndex) & 1u) == 1u;
if (!covered) {
gl_Position = vec4(0.0);
return;
}
vOutlinePossible = (((channelValue >> highlightIndex) & 2u) == 2u) ? 1.0 : 0.0;
ivec2 iPosInCell = cellVertices[gl_VertexID];
vec2 sPos = vec2(cellPos * cellSize + iPosInCell * (cellSize));
vec2 vPos = sPos / vec2(highlightTextureResolution);
sUV = vPos;
gl_Position = vec4(2.0 * vPos - vec2(1.0), 0.0, 1.0);`)}const zpe=He();function g3e(){const t=new ki;t.include(aG);const{fragment:e}=t;return e.uniforms.add(new $t("highlightTexture",i=>i.highlightTexture),new $t("highlightOptionsTexture",i=>i.highlightOptionsTexture),new pt("pixelRatio",i=>i.pixelRatio),new pt("occludedIntensityFactor",i=>i.occludedFactor),new Sse("maxHighlightLevel",i=>i.highlights.length-1)),e.constants.add("pixelSampleScale","float",1),t.include(Qj),e.code.add(E`const float pascal17[9] = float[9](12870.0, 11440.0, 8008.0, 4368.0, 1820.0, 560.0, 120.0, 16.0, 1.0);
const float denom17 =  65536.0;
float colorWeight[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
float colorOcclusion[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
float weights[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
void applyTexel(vec2 texel, float weight) {
if (texel != vec2(0.0)){
int maxChannel = (maxHighlightLevel >> 2) & 1;
for (int channelIndex = 0; channelIndex <= maxChannel; ++channelIndex){
uint channel = readChannel(texel, channelIndex << 2);
int firstIndex = channelIndex << 2;
int maxIndex  = min(firstIndex + 3, maxHighlightLevel);
for (int highlightIndex = firstIndex; highlightIndex <= maxIndex; ++highlightIndex ) {
uint v = readChannelBits(channel, highlightIndex);
if ((v & 1u) == 1u){
colorWeight[highlightIndex] += weight;
if ((v & 2u) == 2u){
colorOcclusion[highlightIndex] += weight;
}
}
}
}
}
}
vec2 readTexel(ivec2 iuv, int du, int dv) {
return texelFetch(highlightTexture, iuv + ivec2(du, dv), 0).rg;
}
void readAndApplyTexel(ivec2 iuv, int du, int dv, float weight) {
vec2 texel = readTexel(iuv, du, dv);
applyTexel(texel, weight);
}
void readAndApply2TexelsU(ivec2 iuv, int du, int dv, float weight) {
readAndApplyTexel(iuv, -du, dv, weight);
readAndApplyTexel(iuv, +du, dv, weight);
}
float getWeight(int pixelDistance) {
float scaledDistance = float(pixelDistance) * pixelSampleScale / pixelRatio;
float d0f = floor(scaledDistance);
int d0 = int(d0f);
if (d0 >= 8){
return 0.0;
}
float w0 = pascal17[d0];
float w1 = pascal17[d0+1];
float f =  scaledDistance - d0f;
return mix(w0, w1, f);
}`),e.main.add(E`vec2 highlightTextureSize = vec2(textureSize(highlightTexture,0));
ivec2 iuv = ivec2(sUV * highlightTextureSize);
vec2 centerTexel = texelFetch(highlightTexture, iuv, 0).rg;
bool outlinePossible = false;
if (vOutlinePossible > 0.0){
for (int highlightLevel=0; highlightLevel<= maxHighlightLevel; ++highlightLevel) {
if ((readLevelBits(centerTexel,highlightLevel) & 1u) == 0u) {
outlinePossible = true;
break;
}
}
}
if (outlinePossible) {
int maxPixelDistance = clamp(int(8.0 * pixelRatio / pixelSampleScale), 2, 16);
float weightSum = 0.0;
for(int y = 0; y <= maxPixelDistance; ++y) {
float w = getWeight(y);
weights[y] = w;
weightSum += w * (y == 0 ? 1.0 : 2.0);
}
for(int y = 0; y <= maxPixelDistance; ++y) {
weights[y] = weights[y] / weightSum;
}
float weight0 = weights[0];
applyTexel(centerTexel, weight0 * weight0);
for(int y = 0; y <= maxPixelDistance; y += 1) {
float yFactor = weights[y];
if (y != 0) {
float xFactor = weight0;
float weight = xFactor * yFactor;
if (weight > 0.0) {
readAndApplyTexel(iuv, 0, +y, weight);
readAndApplyTexel(iuv, 0, -y, weight);
}
}
for(int x = 1; x <= maxPixelDistance; x += 1) {
float xFactor = weights[x];
float weight = xFactor * yFactor;
if (weight > 0.0) {
readAndApply2TexelsU(iuv, x, +y, weight);
if (y != 0){
readAndApply2TexelsU(iuv, x, -y, weight);
}
}
}
}
} else {
applyTexel(centerTexel, 1.0);
}
int frontColorIndex = 999;
int maxColorIndex = 0;
for (int i = 0; i <= maxHighlightLevel; ++i) {
if (colorWeight[i] > 0.0){
frontColorIndex = min(frontColorIndex, i);
maxColorIndex = max(maxColorIndex, i);
}
}
if (frontColorIndex == 999){
fragColor = vec4(0.0);
return;
}
vec4 accumulatedColor = vec4(0.0);
for (int curColorIndex = frontColorIndex; curColorIndex <= maxColorIndex; ++curColorIndex) {
float curColorWeight = colorWeight[curColorIndex];
if (curColorWeight <= 0.01){
continue;
}
uint vc = readLevelBits(centerTexel, curColorIndex);
bool centerFilled = (vc & 1u) == 1u;
bool centerOccluded = (vc & 3u) == 3u;
float curColorOcclusion = colorOcclusion[curColorIndex];
bool occluded = centerFilled ? centerOccluded : curColorOcclusion > 0.5 * curColorWeight;
int colorChannel = centerFilled ? 0 : 1;
vec4 colorBase = texelFetch(highlightOptionsTexture, ivec2(curColorIndex, colorChannel), 0);
float occlusionFactor = occluded ? occludedIntensityFactor : 1.0;
float outlineFactor = centerFilled ? 1.0 : smoothstep(0.0, 0.03, curColorWeight);
float intensity = colorBase.a * occlusionFactor * outlineFactor;
vec3 currentColor = colorBase.rgb;
float a0 = accumulatedColor.a;
float a1 = intensity;
float alpha = clamp(a0 + a1 - a0 * a1, 0.0, 1.0);
if (alpha > 0.001){
vec3 blendedColor = ((1.0 - a1) * a0 * accumulatedColor.rgb + a1 * currentColor) / alpha;
accumulatedColor = vec4(blendedColor, alpha);
}
}
fragColor = accumulatedColor;`),t}const kmt=Object.freeze(Object.defineProperty({__proto__:null,build:g3e},Symbol.toStringTag,{value:"Module"}));let Upe=class extends Bi{constructor(e,i){super(e,i,new Fi(kmt,()=>V(()=>Promise.resolve().then(()=>SGt),void 0)))}initializePipeline(){return _i({blending:Od,colorWrite:Ai})}},Bpe=class extends Bi{constructor(e,i){super(e,i,new Fi(Fmt,()=>V(()=>Promise.resolve().then(()=>TGt),void 0)))}initializePipeline(){return _i({colorWrite:Ai})}},zmt=class extends ar{constructor(){super(...arguments),this.occludedFactor=OKe,this.verticalCellCount=0,this.horizontalCellCount=0,this.highlightLevel=0,this.pixelRatio=1}};function y3e(){const t=new ki;t.include(aG),t.include(Qj);const{fragment:e}=t;return t.outputs.add("fragSingleHighlight","vec2",0),e.uniforms.add(new $t("highlightTexture",i=>i.highlightTexture),new Jb("highlightLevel",i=>i.highlightLevel)),e.main.add(E`ivec2 iuv = ivec2(gl_FragCoord.xy);
vec2 inputTexel = texelFetch(highlightTexture, iuv, 0).rg;
uint bits = readLevelBits(inputTexel, highlightLevel);
bool hasHighlight = (bits & 1u) == 1u;
bool hasOccluded  = (bits & 2u) == 2u;
fragSingleHighlight = vec2(hasHighlight ? 1.0 : 0.0, hasOccluded ? 1.0 : 0.0);`),t}const Umt=Object.freeze(Object.defineProperty({__proto__:null,build:y3e},Symbol.toStringTag,{value:"Module"}));let Vpe=class extends Bi{constructor(e,i){super(e,i,new Fi(Umt,()=>V(()=>Promise.resolve().then(()=>EGt),void 0)))}initializePipeline(){return _i({colorWrite:Ai})}};function v3e(){const t=new ki;t.include(aG);const{fragment:e}=t;return e.uniforms.add(new $t("blurInput",i=>i.singleHighlightBlurTexture),new Ese("blurSize",i=>i.blurSize),new $t("highlightTexture",i=>i.highlightTexture),new $t("highlightOptionsTexture",i=>i.highlightOptionsTexture),new Jb("highlightLevel",i=>i.highlightLevel),new pt("occludedIntensityFactor",i=>i.occludedFactor)),e.constants.add("inner","float",1-(n3-kse)/n3),t.include(Qj),e.main.add(E`vec2 highlightTextureSize = vec2(textureSize(highlightTexture,0));
vec2 uv = sUV;
vec2 center = texture(blurInput, uv).rg;
vec2 blurredHighlightValue = (vOutlinePossible == 0.0)
? center
: center * 0.204164
+ texture(blurInput, uv + blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv - blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv + blurSize * 3.294215).rg * 0.093913
+ texture(blurInput, uv - blurSize * 3.294215).rg * 0.093913;
float highlightIntensity = blurredHighlightValue.r;
float occlusionWeight = blurredHighlightValue.g;
if (highlightIntensity <= 0.01) {
discard;
}
vec4 fillColor    = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 0), 0);
vec4 outlineColor = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 1), 0);
vec2 centerTexel = texelFetch(highlightTexture, ivec2(uv * highlightTextureSize), 0).rg;
uint centerBits = readLevelBits(centerTexel, highlightLevel);
bool centerFilled = (centerBits & 1u) == 1u;
bool centerOccluded = (centerBits & 3u) == 3u;
bool occluded = centerOccluded || (0.5 * highlightIntensity < occlusionWeight);
float occlusionFactor = occluded ? occludedIntensityFactor : 1.0;
float outlineFactor = centerFilled ? 1.0 : smoothstep(0.0, inner, highlightIntensity);
float fillFactor = centerFilled ? 1.0 : 0.0;
vec4 baseColor = mix(outlineColor, fillColor, fillFactor);
float intensity = baseColor.a * occlusionFactor * outlineFactor;
fragColor = vec4(baseColor.rgb, intensity);`),t}const Bmt=Object.freeze(Object.defineProperty({__proto__:null,build:v3e},Symbol.toStringTag,{value:"Module"}));let jpe=class extends Bi{constructor(e,i){super(e,i,new Fi(Bmt,()=>V(()=>Promise.resolve().then(()=>CGt),void 0)))}initializePipeline(){return _i({blending:Od,colorWrite:Ai})}},zse=class extends ar{constructor(){super(...arguments),this.blurSize=He()}};function _3e(){const t=new ki;return t.include(aG),t.outputs.add("fragSingleHighlight","vec2",0),t.fragment.uniforms.add(new Ese("blurSize",e=>e.blurSize),new Km("blurInput",e=>e.blurInput)).main.add(E`vec2 highlightTextureSize = vec2(textureSize(blurInput,0));
vec2 center = texture(blurInput, sUV).rg;
if (vOutlinePossible == 0.0) {
fragSingleHighlight = center;
} else {
vec2 sum = center * 0.204164;
sum += texture(blurInput, sUV + blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, sUV - blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, sUV + blurSize * 3.294215).rg * 0.093913;
sum += texture(blurInput, sUV - blurSize * 3.294215).rg * 0.093913;
fragSingleHighlight = sum;
}`),t}const Vmt=Object.freeze(Object.defineProperty({__proto__:null,SingleHighlightBlurDrawParameters:zse,build:_3e},Symbol.toStringTag,{value:"Module"}));let Gpe=class extends Bi{constructor(e,i){super(e,i,new Fi(Vmt,()=>V(()=>Promise.resolve().then(()=>$Gt),void 0)))}initializePipeline(){return _i({colorWrite:Ai})}},gf=class{constructor(e,i,r,s,n,o=!1,a=0){this.name=e,this.count=i,this.type=r,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}};const jmt=[],Gmt=[new gf(z.POSITION,3,Pi.FLOAT,0,12)],b3e=[new gf(z.POSITION,2,Pi.FLOAT,0,8)],Hmt=[new gf(z.POSITION,2,Pi.FLOAT,0,16),new gf(z.UV0,2,Pi.FLOAT,8,16)],XH=()=>J.getLogger("esri.views.webgl.VertexArrayObject");let VD=class{constructor(e,i,r,s,n=null){this._context=e,this._locations=i,this._layout=r,this._buffers=s,this._indexBuffer=n,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Array.from(this._buffers.values()).reduce((e,i)=>e+i.usedMemory,this._indexBuffer!=null?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(this._buffers.size+(this._indexBuffer?1:0))*Mre}get cachedMemory(){return this.usedMemory}dispose(){this._context?(this._context.getBoundVAO()===this&&this._context.bindVAO(null),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this._indexBuffer=Rt(this._indexBuffer),this.disposeVAOOnly()):(this._glName||this._buffers.size>0)&&XH().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(Hs.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:e}=this._context,i=e.createVertexArray();e.bindVertexArray(i),this._bindLayout(),e.bindVertexArray(null),this._glName=i,this._context.instanceCounter.increment(Hs.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:e,_layout:i,_indexBuffer:r}=this;e||XH().error("Vertex buffer dictionary is empty!");const s=this._context.gl;this._buffers.forEach((n,o)=>{const a=i.get(o);a?tMe(this._context,this._locations,n,a):XH().error("Vertex element descriptor is empty!")}),r!=null&&s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}},mg=class extends VD{};const Hpe=()=>J.getLogger("esri.views.webgl.BufferObject");let Un=class w1{static createIndex(e,i,r){return new w1(e,ct.ELEMENT_ARRAY_BUFFER,i,r)}static createVertex(e,i,r){return new w1(e,ct.ARRAY_BUFFER,i,r)}static createUniform(e,i,r){return new w1(e,ct.UNIFORM_BUFFER,i,r)}static createPixelPack(e,i=Zs.STREAM_READ,r){const s=new w1(e,ct.PIXEL_PACK_BUFFER,i);return r&&s.setSize(r),s}static createPixelUnpack(e,i=Zs.STREAM_DRAW,r){return new w1(e,ct.PIXEL_UNPACK_BUFFER,i,r)}static createTransformFeedback(e,i=Zs.STATIC_DRAW,r){const s=new w1(e,ct.TRANSFORM_FEEDBACK_BUFFER,i);return s.setSize(r),s}constructor(e,i,r,s){this._context=e,this.bufferType=i,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(Hs.BufferObject,this),this._glName=this._context.gl.createBuffer(),ed(this._context.gl),s&&this.setData(s)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){if(this.bufferType===ct.ELEMENT_ARRAY_BUFFER){if(this._indexType===Pi.UNSIGNED_INT)return 4*this._size;if(this._indexType===Pi.UNSIGNED_SHORT)return 2*this._size}return this._size}get _isVAOAware(){return this.bufferType===ct.ELEMENT_ARRAY_BUFFER||this.bufferType===ct.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(Hs.BufferObject,this),this._context=null):this._glName&&Hpe().warn("Leaked WebGL buffer object")}setSize(e,i=null){if(this.bufferType===ct.ELEMENT_ARRAY_BUFFER&&i!=null)switch(this._indexType=i,i){case Pi.UNSIGNED_SHORT:e*=2;break;case Pi.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let i=e.byteLength;this.bufferType===ct.ELEMENT_ARRAY_BUFFER&&(k_(e)?this._indexType=Pi.UNSIGNED_BYTE:uV(e)?(i/=2,this._indexType=Pi.UNSIGNED_SHORT):Tee(e)&&(i/=4,this._indexType=Pi.UNSIGNED_INT)),this._setBufferData(i,e)}_setBufferData(e,i=null){this._size=e;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;i!=null?s.bufferData(this.bufferType,i,this.usage):s.bufferData(this.bufferType,e,this.usage),ed(s),this._isVAOAware&&this._context.bindVAO(r)}setSubData(e,i,r,s){if(!e)return;const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:o}=this._context;o.bufferSubData(this.bufferType,i*e.BYTES_PER_ELEMENT,e,r,s-r),ed(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(e,i=0,r,s){if(r<0||s<0)return;const n=qmt(e)?e.BYTES_PER_ELEMENT:1;if(n*((r??0)+(s??0))>e.byteLength)return;i+n*(s??0)>this.usedMemory&&Hpe().warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this.bufferType===ct.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,ct.TRANSFORM_FEEDBACK_BUFFER),o.getBufferSubData(ct.TRANSFORM_FEEDBACK_BUFFER,i,e,r,s),this._context.unbindBuffer(ct.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,ct.COPY_READ_BUFFER),o.getBufferSubData(ct.COPY_READ_BUFFER,i,e,r,s),this._context.unbindBuffer(ct.COPY_READ_BUFFER))}async getSubDataAsync(e,i=0,r,s){await this._context.clientWaitAsync(),this.getSubData(e,i,r,s)}};function qmt(t){return vBe(t)}let dI=class extends xf{constructor(){super(...arguments),this.produces=ut.HIGHLIGHTS,this.consumes={required:[ut.HIGHLIGHTS,"highlights"]},this._useMultipleHighlights=!1,this._downsampleDrawParameters=new Fse,this._passParameters=new zmt,this._singleHighlightBlurDrawParameters=new zse,this._grid=new Wmt}initialize(){this.addHandles([H(()=>this._updateOptionsTexture(),()=>{},Nt)])}destroy(){this._grid.coverage=Dr(this._grid.coverage),this._grid.vao=Rt(this._grid.vao),this._passParameters.highlightOptionsTexture=Dr(this._passParameters.highlightOptionsTexture)}_updateOptionsTexture(){if(this._passParameters.highlightOptionsTexture==null){const e=new $r(16,2);e.internalFormat=vt.RGBA,e.samplingMode=di.NEAREST,this._passParameters.highlightOptionsTexture=new yi(this.renderingContext,e,null)}this._passParameters.highlightOptionsTexture.setData(Zmt(this.view.state.highlights)),this.requestRender(bt.UPDATE)}precompile(){this.techniques.precompile(Bpe),this._useMultipleHighlights?this.techniques.precompile(Upe):(this.techniques.precompile(Vpe),this.techniques.precompile(Gpe),this.techniques.precompile(jpe))}render(e){const i=e.find(({name:m})=>m===ut.HIGHLIGHTS),{techniques:r,bindParameters:s,_passParameters:n,renderingContext:o}=this;if(!s.decorations)return i;const a=r.get(Bpe);if(!a.compiled)return this.requestRender(bt.UPDATE),i;const l=e.find(({name:m})=>m==="highlights").getTexture(),c=()=>{this._gridUpdateResources(l);const m=this._gridComputeCoverage(a,l,s),{horizontalCellCount:y,verticalCellCount:v}=m;return n.horizontalCellCount=y,n.verticalCellCount=v,n.coverageTexture=m.coverage?.getTexture(),m},h=m=>{const y=m.verticalCellCount*m.horizontalCellCount;o.bindVAO(m.vao),o.drawElementsInstanced(Ui.TRIANGLES,6,Pi.UNSIGNED_BYTE,0,y)},{camera:d}=s,f=()=>{o.bindFramebuffer(i.fbo),o.setViewport4fv(d.fullViewport)};return this._useMultipleHighlights?this._renderMultiple(l,c,h,f):this._renderSingle(l,c,h,f),n.highlightTexture=null,n.coverageTexture=null,i}_renderMultiple(e,i,r,s){const{techniques:n,bindParameters:o,_passParameters:a,renderingContext:l}=this,c=n.get(Upe);if(!c.compiled)return void this.requestRender(bt.UPDATE);const h=i();a.highlightTexture=e,a.pixelRatio=o.camera.pixelRatio,l.bindTechnique(c,o,a),s(),r(h)}_renderSingle(e,i,r,s){const{fboCache:n,techniques:o,bindParameters:a,_passParameters:l,renderingContext:c}=this,h=o.get(Vpe),d=o.get(Gpe),f=o.get(jpe);if(!f.compiled||!d.compiled||!h.compiled)return void this.requestRender(bt.UPDATE);const m=i(),{width:y,height:v}=e.descriptor;l.highlightTexture=e;const{camera:_}=a,{fullWidth:b,fullHeight:w,pixelRatio:x}=_,S=Math.ceil(b/x),C=Math.ceil(w/x),{_singleHighlightBlurDrawParameters:T}=this,M=this.view._stage.renderView.renderer,{highlights:I}=a;for(let P=0;P<I.length;++P){const{name:D}=I[P];if(!M.hasHighlightOptions(D))continue;l.highlightLevel=P,c.setClearColor(0,0,0,0);const F=n.acquire(y,v,"single highlight",fr.RG);c.bindFramebuffer(F.fbo),c.setViewport(0,0,y,v),c.clear(Si.COLOR),c.bindTechnique(h,a,l),r(m),T.blurInput=F.getTexture(),li(T.blurSize,1/S,0);const L=n.acquire(S,C,"single highlight blur h",fr.RG);c.unbindTexture(L.fbo?.colorTexture),c.bindFramebuffer(L.fbo),c.setViewport(0,0,S,C),c.clear(Si.COLOR),c.bindTechnique(d,a,l,T),r(m),F.release(),li(T.blurSize,0,1/C),l.singleHighlightBlurTexture=L.getTexture(),s(),c.bindTechnique(f,a,l,T),r(m),L.release()}}_gridUpdateResources(e){const i=this._grid,{width:r,height:s}=e.descriptor;if(i.horizontalCellCount=Math.ceil(r/X_),i.verticalCellCount=Math.ceil(s/X_),i.vao)return;const n=this.renderingContext,o=Un.createIndex(n,Zs.STATIC_DRAW,Xmt);i.vao=new mg(n,hg,new Map([["geometry",jmt]]),new Map([["geometry",Un.createVertex(n,Zs.STATIC_DRAW)]]),o)}_gridComputeCoverage(e,i,r){const s=this.renderingContext,n=this._grid,o=i.descriptor,a=Math.ceil(o.width/X_),l=Math.ceil(o.height/X_);this._downsampleDrawParameters.input=i,n.coverage?.release();const c=this.fboCache.acquire(a,l,"highlight coverage",fr.RG);return n.coverage=c,s.bindFramebuffer(c.fbo),s.bindTechnique(e,r,this._passParameters,this._downsampleDrawParameters),s.setViewport(0,0,a,l),s.screen.draw(),n}get test(){}};u([p()],dI.prototype,"produces",void 0),u([p()],dI.prototype,"consumes",void 0),dI=u([A("esri.views.3d.webgl-engine.effects.highlight.Highlight")],dI);let Wmt=class{constructor(){this.coverage=null,this.vao=null,this.verticalCellCount=0,this.horizontalCellCount=0,this.viewportWidth=0,this.viewportHeight=0}};function Zmt(t){const e=new Uint8Array(128);let i=0;for(const r of t){const s=4*i,n=4*i+64;++i;const{color:o}=r,a=r.haloColor??o;e[s+0]=o.r,e[s+1]=o.g,e[s+2]=o.b,e[s+3]=r.fillOpacity*o.a*255,e[n+0]=a.r,e[n+1]=a.g,e[n+2]=a.b,e[n+3]=r.haloOpacity*a.a*255}return e}let Ymt=0;function Jmt(t){let e=0;for(const r of t){const{name:s}=r;e+=s.length;const{color:n,fillOpacity:o,haloColor:a,haloOpacity:l}=r;e+=n.r+n.g+n.b+n.a+o,e+=a?a.r+a.g+a.b+a.a+l:0}const i=t.at(0);if(i){const{shadowOpacity:r,shadowDifference:s,shadowColor:n}=i;e+=r+s+n.r+n.g+n.b+n.a}return Ymt+++(e>=0?0:1)}const Xmt=new Uint8Array([0,1,2,2,1,3]);function w3e(t,e,i,r,s,n=0){const o=r.highlights,a=o.length>1?e.acquire(i.width,i.height,"highlight mix",fr.RG):null;if(a){const c=t.getBoundFramebufferObject();t.bindFramebuffer(a.fbo),t.clearFramebuffer(sn),t.bindFramebuffer(c)}const l=a?.getTexture();r.highlightMixTexture=l,li(r.highlightMixOrigin,n,0),o.forEach((c,h)=>{h>0&&(t.bindTexture(l,yi.TEXTURE_UNIT_FOR_UPDATES),t.gl.copyTexSubImage2D(ts.TEXTURE_2D,0,0,0,n,0,i.width,i.height),t.bindTexture(null,yi.TEXTURE_UNIT_FOR_UPDATES)),t.clear(Si.DEPTH),r.highlightLevel=h,s()}),r.highlightLevel=null,r.highlightMixTexture=null,a?.release()}let yv=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,i){return this._outer.get(e)?.get(i)}getInner(e){return this._outer.get(e)}set(e,i,r){const s=this._outer.get(e);s?s.set(i,r):this._outer.set(e,new Map([[i,r]]))}delete(e,i){const r=this._outer.get(e);r&&(r.delete(i),r.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((i,r)=>e(i,r))}forAll(e){for(const i of this._outer.values())for(const r of i.values())e(r)}},x3e=class{constructor(e,i,r,s){this._textures=e,this._techniques=i,this.materialChanged=r,this.requestRender=s,this._id2glMaterialRef=new yv}dispose(){this._textures.destroy()}acquire(e,i,r){if(this._ownMaterial(e),!e.produces.get(i)?.(r))return null;let n=this._id2glMaterialRef.get(r,e.id);if(n==null){const o=e.createGLMaterial({material:e,techniques:this._techniques,textures:this._textures,output:r});n=new Kmt(o),this._id2glMaterialRef.set(r,e.id,n)}return n.ref(),n.glMaterial}release(e,i){const r=this._id2glMaterialRef.get(i,e.id);r!=null&&(r.unref(),r.referenced||(Rt(r.glMaterial),this._id2glMaterialRef.delete(i,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&J.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},Kmt=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,jt(this._refCnt>=0)}get referenced(){return this._refCnt>0}};function Qmt(t,e){return t==null&&(t=[]),t.push(e),t}function egt(t,e){if(t==null)return null;const i=t.filter(r=>r!==e);return i.length===0?null:i}function oei(t,e,i,r,s){EN[0]=t.get(e,0),EN[1]=t.get(e,1),EN[2]=t.get(e,2),bJ(EN,vw,3),i.set(s,0,vw[0]),r.set(s,0,vw[1]),i.set(s,1,vw[2]),r.set(s,1,vw[3]),i.set(s,2,vw[4]),r.set(s,2,vw[5])}const EN=$(),vw=new Float32Array(6);let Use=class extends ID{get geometries(){return this._geometries}get transformation(){return this._transformation??Kn}set transformation(e){this._transformation=mn(this._transformation??Ve(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(e){this._shaderTransformation=e?mn(this._shaderTransformation??Ve(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}constructor(e={}){super(),this.type=Nn.Object,this._shaderTransformation=null,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new S3e),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){jt(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._emit("geometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const i=this._geometries.splice(e,1)[0];i&&(this._emit("geometryRemoved",{object:this,geometry:i}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(e,i,r=!1){this._emit("attributesChanged",{object:this,geometry:e,attribute:i,sync:r}),Ylt(i)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const i of this._geometries)i.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new Lct;for(const i of this._geometries)i.occludees=Qmt(i.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const i of this._geometries)i.occludees=egt(i.occludees,e);this._emit("occlusionChanged",this)}highlight(e){const i=new ZIe(e);for(const r of this._geometries)r.addHighlight(i);return this._emit("highlightChanged",this),i}removeHighlight(e){for(const i of this._geometries)i.removeHighlight(e);this._emit("highlightChanged",this)}removeStateID(e){e.channel===cS.Highlight?this.removeHighlight(e):this.removeOcclude(e)}getCombinedStaticTransformation(e,i){return kn(i,this.transformation,e.transformation)}getCombinedShaderTransformation(e,i=Ve()){return kn(i,this.effectiveTransformation,e.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new qpe,this._validateBoundingVolume(this._bvWorldSpace,LR.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new qpe,this._validateBoundingVolume(this._bvObjectSpace,LR.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,i){const r=i===LR.ObjectSpace;for(const s of this._geometries){const n=s.boundingInfo;n&&tgt(n,e,r?s.transformation:this.getCombinedShaderTransformation(s))}dr(e.bounds,e.min,e.max,.5);for(const s of this._geometries){const n=s.boundingInfo;if(n==null)continue;const o=r?s.transformation:this.getCombinedShaderTransformation(s),a=JP(o);st(Wpe,n.center,o);const l=xr(Wpe,e.bounds),c=n.radius*a;e.bounds[3]=Math.max(e.bounds[3],l+c)}}_invalidateBoundingVolume(){const e=this._bvWorldSpace?.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,i){this._parentLayer&&this._parentLayer.events.emit(e,i)}get test(){}},S3e=class{constructor(){this.min=Le(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Le(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},qpe=class extends S3e{constructor(){super(...arguments),this.bounds=Rs()}};function tgt(t,e,i){const r=t.bbMin,s=t.bbMax;if(GV(i)){const n=se(igt,i[12],i[13],i[14]);oe(du,r,n),oe(Yd,s,n);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],du[o]),e.max[o]=Math.max(e.max[o],Yd[o])}else if(st(du,r,i),Qn(r,s))for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],du[n]),e.max[n]=Math.max(e.max[n],du[n]);else{st(Yd,s,i);for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],du[n],Yd[n]),e.max[n]=Math.max(e.max[n],du[n],Yd[n]);for(let n=0;n<3;++n){ne(du,r),ne(Yd,s),du[n]=s[n],Yd[n]=r[n],st(du,du,i),st(Yd,Yd,i);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],du[o],Yd[o]),e.max[o]=Math.max(e.max[o],du[o],Yd[o])}}}const igt=$(),du=$(),Yd=$(),Wpe=$();var LR;(function(t){t[t.WorldSpace=0]="WorldSpace",t[t.ObjectSpace=1]="ObjectSpace"})(LR||(LR={}));const rgt=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];let Cm=class NJ{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,i){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new mo,this._objectCount=0,i&&(i.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),i.maximumDepth!==void 0&&(this._maximumDepth=i.maximumDepth))}destroy(){this._degenerateObjects.clear(),mo.clearPool(),FJ[0]=null,x1.prune(),S1.prune()}add(e,i=e.length){this._objectCount+=i,this._grow(e,i);const r=mo.acquire();for(let s=0;s<i;s++){const n=e[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(r.init(this._root),this._add(n,r))}mo.release(r)}remove(e,i=null){this._objectCount-=e.length;const r=mo.acquire();for(const s of e){const n=i??aS(this.objectToBoundingSphere(s),dgt);pI(n[3])?(r.init(this._root),sgt(s,n,r)):this._degenerateObjects.delete(s)}mo.release(r),this._shrink()}update(e,i){if(!pI(i[3])&&this._isDegenerate(e))return;const r=hgt(e);this.remove(r,i),this.add(r)}forEachAlongRay(e,i,r){const s=mf(e,i);_w(this._root,n=>{if(!ogt(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),!0})}forEachAlongRayWithVerticalOffset(e,i,r,s){const n=mf(e,i);_w(this._root,o=>{if(!agt(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),!0})}forEach(e){_w(this._root,i=>{const r=i.node;return r.terminals.forAll(e),r.residents!==null&&r.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,i,r,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=KH(e,i),h=d=>{if(--n,!s(d))return;const f=this.objectToBoundingSphere(d);if(!J_(r,f))return;const m=__(e,i,f),y=m-f[3],v=m+f[3];y<o&&(o=y,a=v,l=d)};return Zpe(this._root,d=>{if(n<=0||!J_(r,d.bounds)||(ie(bh,c,d.halfSize),oe(bh,bh,d.bounds),__(e,i,bh)>a))return!1;const f=d.node;return f.terminals.forAll(m=>h(m)),f.residents!==null&&f.residents.forAll(m=>h(m)),!0},e,i),l}forEachInDepthRange(e,i,r,s,n,o,a){let l=-1/0,c=1/0;const h={setRange:v=>{r===NJ.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,v.near),c=Math.min(c,v.far)):(l=Math.max(l,-v.far),c=Math.min(c,-v.near))}};h.setRange(s);const d=__(i,r,e),f=KH(i,r),m=KH(i,-r),y=v=>{if(!a(v))return;const _=this.objectToBoundingSphere(v),b=_,w=__(i,r,b)-d,x=w-_[3],S=w+_[3];x>c||S<l||!J_(o,_)||n(v,h)};Zpe(this._root,v=>{if(!J_(o,v.bounds)||(ie(bh,f,v.halfSize),oe(bh,bh,v.bounds),__(i,r,bh)-d>c)||(ie(bh,m,v.halfSize),oe(bh,bh,v.bounds),__(i,r,bh)-d<l))return!1;const _=v.node;return _.terminals.forAll(b=>y(b)),_.residents!==null&&_.residents.forAll(b=>y(b)),!0},i,r)}forEachNode(e){_w(this._root,i=>e(i.node,i.bounds,i.halfSize,i.depth))}forEachNeighbor(e,i){const r=Nm(i),s=i,n=l=>{const c=this.objectToBoundingSphere(l),h=Nm(c),d=r+h;return!(ro(c,s)-d*d<=0)||e(l)};let o=!0;const a=l=>{o&&(o=n(l))};_w(this._root,l=>{const c=Nm(l.bounds),h=r+c;if(ro(l.bounds,s)-h*h>0)return!1;const d=l.node;return d.terminals.forAll(a),o&&d.residents!==null&&d.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsObject(e,i){const r=this.objectToBoundingSphere(i);return!(r[3]>0)||xY(r,e)}_intersectsObjectWithOffset(e,i,r){const s=this.objectToBoundingSphere(i);return!(s[3]>0)||xY(r.applyToBoundingSphere(s),e)}_add(e,i){i.advanceTo(this.objectToBoundingSphere(e))?i.node.terminals.push(e):(i.node.residents.push(e),i.node.residents.length>this._maximumObjectsPerNode&&i.depth<this._maximumDepth&&this._split(i))}_split(e){const i=e.node.residents;e.node.residents=null;for(let r=0;r<i.length;r++){const s=mo.acquire().init(e);this._add(i.at(r),s),mo.release(s)}}_grow(e,i){if(i!==0&&(Ype(e,i,r=>this.objectToBoundingSphere(r),Og),pI(Og[3])&&!this._fitsInsideTree(Og)))if(T3e(this._root.node))aS(Og,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const r=this._rootBoundsForRootAsSubNode(Og);this._placingRootViolatesMaxDepth(r)?this._rebuildTree(Og,r):this._growRootAsSubNode(r),mo.release(r)}}_rebuildTree(e,i){ne(e8,i.bounds),e8[3]=i.halfSize,Ype([e,e8],2,s=>s,t8);const r=mo.acquire().init(this._root);this._root.initFrom(null,t8,t8[3]),this._root.increaseHalfSize(1.25),_w(r,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),mo.release(r)}_placingRootViolatesMaxDepth(e){const i=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return _w(this._root,s=>(r=Math.max(r,s.depth),r+i<=this._maximumDepth)),r+i>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const i=e[3],r=e;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=n[l]-o-(r[l]-i),h=r[l]+i-(n[l]+o),d=Math.max(0,Math.ceil(c/(2*o))),f=Math.max(0,Math.ceil(h/(2*o)))+1,m=2**Math.ceil(Math.log(d+f)*Math.LOG2E);s=Math.max(s,m),CN[l].min=d,CN[l].max=f}for(let l=0;l<3;l++){let c=CN[l].min,h=CN[l].max;const d=(s-(c+h))/2;c+=Math.ceil(d),h+=Math.floor(d);const f=n[l]-o-c*o*2;QH[l]=f+(h+c)*o}const a=s*o;return QH[3]=a*C3e,mo.acquire().initFrom(null,QH,a,0)}_growRootAsSubNode(e){const i=this._root.node;ne(Og,this._root.bounds),Og[3]=this._root.halfSize,this._root.init(e),e.advanceTo(Og,null,!0),e.node.children=i.children,e.node.residents=i.residents,e.node.terminals=i.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const i=this._root.node.children;let r=0,s=0;for(;s<i.length&&e==null;)r=s++,e=i[r];for(;s<i.length;)if(i[s++])return-1;return r}_isDegenerate(e){return!pI(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const i=this._root.bounds,r=this._root.halfSize;return e[3]<=r&&e[0]>=i[0]-r&&e[0]<=i[0]+r&&e[1]>=i[1]-r&&e[1]<=i[1]+r&&e[2]>=i[2]-r&&e[2]<=i[2]+r}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:i,_objectCount:r}=this,s=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:i,objectCount:r,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:s}}}_nodeToJSON(e){const i=e.children.map(n=>n?this._nodeToJSON(n):null),r=e.residents?.map(n=>this.objectToBoundingSphere(n)),s=e.terminals?.map(n=>this.objectToBoundingSphere(n));return{children:i,residents:r,terminals:s}}static fromJSON(e){const i=new NJ(r=>r,{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return i._objectCount=e.objectCount,i._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),i}},mo=class kE{constructor(){this.bounds=Rs(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,i,r,s=this.depth){return this.node=e??kE.createEmptyNode(),i&&aS(i,this.bounds),this.halfSize=r,this.depth=s,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*C3e}advance(e){let i=this.node.children[e];i||(i=kE.createEmptyNode(),this.node.children[e]=i),this.node=i,this.halfSize/=2,this.depth++;const r=E3e[e];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,i,r=!1){for(;;){if(this.isTerminalFor(e))return i&&i(this,-1),!0;if(this.isLeaf()){if(!r)return i&&i(this,-1),!1;this.node.residents=null}const s=this._childIndex(e);i&&i(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const i=this.bounds;return(i[0]<e[0]?1:0)+(i[1]<e[1]?2:0)+(i[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new Jt({shrink:!0}),residents:new Jt({shrink:!0})}}static acquire(){return kE._pool.acquire()}static release(e){kE._pool.release(e)}static clearPool(){kE._pool.prune()}};function _w(t,e){let i=mo.acquire().init(t);const r=[i];for(;r.length!==0;){if(i=r.pop(),e(i)&&!i.isLeaf())for(let s=0;s<i.node.children.length;s++)i.node.children[s]&&r.push(mo.acquire().init(i).advance(s));mo.release(i)}}function Zpe(t,e,i,r=Cm.DepthOrder.FRONT_TO_BACK){let s=mo.acquire().init(t);const n=[s];for(ugt(i,r,Xpe);n.length!==0;){if(s=n.pop(),e(s)&&!s.isLeaf())for(let o=7;o>=0;--o){const a=Xpe[o];s.node.children[a]&&n.push(mo.acquire().init(s).advance(a))}mo.release(s)}}function sgt(t,e,i){x1.clear();const r=i.advanceTo(e,(s,n)=>{x1.push(s.node),x1.push(n)})?i.node.terminals:i.node.residents;if(r.removeUnordered(t),r.length===0)for(let s=x1.length-2;s>=0&&ngt(x1.data[s],x1.data[s+1]);s-=2);}function ngt(t,e){return e>=0&&(t.children[e]=null),!!T3e(t)&&(t.residents===null&&(t.residents=new Jt({shrink:!0})),!0)}function ogt(t,e){return XU(e.bounds,2*-e.halfSize,zu),XU(e.bounds,2*e.halfSize,Uu),GIe(t.origin,t.direction,zu,Uu)}function agt(t,e,i){return XU(e.bounds,2*-e.halfSize,zu),XU(e.bounds,2*e.halfSize,Uu),i.applyToMinMax(zu,Uu),GIe(t.origin,t.direction,zu,Uu)}function T3e(t){if(t.terminals.length!==0)return!1;if(t.residents!==null)return t.residents.length===0;for(let e=0;e<t.children.length;e++)if(t.children[e])return!1;return!0}function lgt(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function cgt(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function XU(t,e,i){i[0]=t[0]+e,i[1]=t[1]+e,i[2]=t[2]+e}function Ype(t,e,i,r){if(e===1){const s=i(t[0]);aS(s,r)}else{zu[0]=1/0,zu[1]=1/0,zu[2]=1/0,Uu[0]=-1/0,Uu[1]=-1/0,Uu[2]=-1/0;for(let s=0;s<e;s++){const n=i(t[s]);pI(n[3])&&(lgt(zu,n),cgt(Uu,n))}dr(r,zu,Uu,.5),r[3]=Math.max(Uu[0]-zu[0],Uu[1]-zu[1],Uu[2]-zu[2])/2}}function ugt(t,e,i){if(!S1.length)for(let r=0;r<8;++r)S1.push({index:0,distance:0});for(let r=0;r<8;++r){const s=E3e[r];S1.data[r].index=r,S1.data[r].distance=__(t,e,s)}S1.sort((r,s)=>r.distance-s.distance);for(let r=0;r<8;++r)i[r]=S1.data[r].index}function KH(t,e){let i,r=1/0;for(let s=0;s<8;++s){const n=__(t,e,Jpe[s]);n<r&&(r=n,i=Jpe[s])}return i}function __(t,e,i){return e*(t[0]*i[0]+t[1]*i[1]+t[2]*i[2])}function pI(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}mo._pool=new Cl(mo),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(Cm);const E3e=[Le(-1,-1,-1),Le(1,-1,-1),Le(-1,1,-1),Le(1,1,-1),Le(-1,-1,1),Le(1,-1,1),Le(-1,1,1),Le(1,1,1)],Jpe=[Le(-1,-1,-1),Le(-1,-1,1),Le(-1,1,-1),Le(-1,1,1),Le(1,-1,-1),Le(1,-1,1),Le(1,1,-1),Le(1,1,1)],C3e=Math.sqrt(3),FJ=[null];function hgt(t){return FJ[0]=t,FJ}const QH=Rs(),bh=$(),zu=$(),Uu=$(),x1=new Jt,dgt=Rs(),Og=Rs(),e8=Rs(),t8=Rs(),CN=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],S1=new Jt,Xpe=[0,0,0,0,0,0,0,0];var cb;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(cb||(cb={}));let $3e=class extends ID{constructor(e,i,r=""){super(),this.stage=e,this.apiLayerUid=r,this.type=Nn.Layer,this.events=new ws,this.visible=!0,this.sliceable=!1,this._objectsAdded=new Jt,this._handles=new ng,this._objects=new Jt,this._pickable=!0,this.visible=i?.visible??!0,this._pickable=i?.pickable??!0,this.updatePolicy=i?.updatePolicy??cb.ASYNC,this._disableOctree=i?.disableOctree??!1,e.add(this);for(const s of rgt)this._handles.add(this.events.on(s,n=>e.handleEvent(s,n)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}get objects(){return this._objects}set pickable(e){this._pickable=e}get pickable(){return this._pickable&&this.visible}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),this._octree!=null&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),this._octree!=null&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const i of e)i.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),this._octree!=null&&this._objectsAdded.pushArray(e)}removeMany(e){const i=new Array;if(this._objects.removeUnorderedMany(e,e.length,i),i.length!==0){for(const r of i)r.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:i}),this._octree!=null){for(let r=0;r<i.length;)this._objectsAdded.removeUnordered(i[r])?(i[r]=i[i.length-1],i.length-=1):++r;this._octree.remove(i)}}}sync(){this.updatePolicy!==cb.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,i){this._octree==null||this._objectsAdded.includes(e)||this._octree.update(e,i)}getSpatialQueryAccelerator(){return this._octree==null&&this._objects.length>50&&!this._disableOctree?(this._octree=new Cm(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):this._octree!=null&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}invalidateSpatialQueryAccelerator(){this._octree=Ce(this._octree),this._objectsAdded.clear()}};function KU(t){return t!=null&&t.type===Nn.Layer}var hS,o3;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})(hS||(hS={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(o3||(o3={}));let pu=class extends zm{constructor(){super(...arguments),this.space=hS.Screen,this.anchor=o3.Center,this.occluder=!1,this.writeDepth=!1,this.hideOnShortSegments=!1,this.hasCap=!1,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.textureCoordinateType=Ws.None,this.emissionSource=Jo.None,this.discardInvisibleFragments=!0,this.occlusionPass=!1,this.hasVvInstancing=!0,this.hasSliceTranslatedView=!0,this.objectAndLayerIdColorInstanced=!1}get draped(){return this.space===hS.Draped}};u([te({count:hS.COUNT})],pu.prototype,"space",void 0),u([te({count:o3.COUNT})],pu.prototype,"anchor",void 0),u([te()],pu.prototype,"occluder",void 0),u([te()],pu.prototype,"writeDepth",void 0),u([te()],pu.prototype,"hideOnShortSegments",void 0),u([te()],pu.prototype,"hasCap",void 0),u([te()],pu.prototype,"hasTip",void 0),u([te()],pu.prototype,"vvSize",void 0),u([te()],pu.prototype,"vvColor",void 0),u([te()],pu.prototype,"vvOpacity",void 0),u([te()],pu.prototype,"hasOccludees",void 0),u([te()],pu.prototype,"terrainDepthTest",void 0),u([te()],pu.prototype,"cullAboveTerrain",void 0);const Kpe=8;function pgt(t,e){const i=t.vertex;i.uniforms.add(new pt("intrinsicWidth",r=>r.width)),e.vvSize?(t.attributes.add(z.SIZEFEATUREATTRIBUTE,"float"),i.uniforms.add(new Cr("vvSizeMinSize",r=>r.vvSize.minSize),new Cr("vvSizeMaxSize",r=>r.vvSize.maxSize),new Cr("vvSizeOffset",r=>r.vvSize.offset),new Cr("vvSizeFactor",r=>r.vvSize.factor)),i.code.add(E`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add(z.SIZE,"float"),i.code.add(E`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add(z.OPACITYFEATUREATTRIBUTE,"float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add(new hd("vvOpacityValues",r=>r.vvOpacity.values,Kpe),new hd("vvOpacityOpacities",r=>r.vvOpacity.opacityValues,Kpe)),i.code.add(E`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):i.code.add(E`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.include(Lx,e),t.attributes.add(z.COLORFEATUREATTRIBUTE,"float"),i.code.add(E`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(t.attributes.add(z.COLOR,"vec4"),i.code.add(E`vec4 getColor(){
return applyOpacity(color);
}`))}let A3e=class{constructor(e,i,r){this._createTexture=e,this._parametersKey=i,this._repository=new Map,this._orphanCache=r.newCache(`procedural-texture-repository:${_d()}`,s=>s.dispose())}destroy(){for(const{texture:e}of this._repository.values())e.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(e,i=null){const r=this._acquire(e);return this.release(i),r}release(e){if(e==null)return;const i=this._parametersKey(e),r=this._repository.get(i);if(r&&(r.refCount--,r.refCount===0)){this._repository.delete(i);const{texture:s}=r;this._orphanCache.put(i,s)}}_acquire(e){if(e==null)return null;const i=this._parametersKey(e),r=this._repository.get(i);if(r)return r.refCount++,r.texture;const s=this._orphanCache.pop(i)??this._createTexture(e),n=new fgt(s);return this._repository.set(i,n),s}},fgt=class{constructor(e){this.texture=e,this.refCount=1}};function mgt(t,e){return new A3e(i=>{const{encodedData:r,textureSize:s}=ggt(i),n=new $r;return n.internalFormat=vt.RGBA,n.width=s,n.height=1,n.wrapMode=nr.REPEAT,new yi(t,n,r)},i=>`${i.pattern.join(",")}-r${i.pixelRatio}`,e)}function ggt(t){const e=Bse(t),i=1/t.pixelRatio,r=M3e(t),s=O3e(t),n=(Math.floor(.5*(s-1))+.5)*i,o=[];let a=1;for(const f of e){for(let m=0;m<f;m++){const y=a*(Math.min(m,f-1-m)+.5)*i/n*.5+.5;o.push(y)}a=-a}const l=Math.round(e[0]/2),c=[...o.slice(l),...o.slice(0,l)],h=new Uint8Array(4*r);let d=0;for(const f of c)Nre(f,h,d),d+=4;return{encodedData:h,textureSize:r}}function Bse(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function M3e(t){if(t==null)return 1;const e=Bse(t);return Math.floor(e.reduce((i,r)=>i+r))}function O3e(t){return Bse(t).reduce((e,i)=>Math.max(e,i))}function ygt(t){return t==null?sn:t.length===4?t:es(vgt,t[0],t[1],t[2],1)}const vgt=pi();function _gt(t,e){if(!e.stippleEnabled)return void t.fragment.code.add(E`float getStippleAlpha() { return 1.0; }
void discardByStippleAlpha(float stippleAlpha, float threshold) {}
vec4 blendStipple(vec4 color, float stippleAlpha) { return color; }`);const i=!(e.draped&&e.stipplePreferContinuous),{vertex:r,fragment:s}=t;s.include(Zb),e.draped||(Ib(r,e),r.uniforms.add(new Fn("worldToScreenPerDistanceRatio",({camera:n})=>1/n.perScreenPixelRatio)).code.add(E`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),t.varyings.add("vStippleDistanceLimits","vec2"),t.varyings.add("vStipplePatternStretch","float"),r.code.add(E`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${E.float(wgt)};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),r.code.add(E`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),r.code.add(E`
    if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
  `),LD(r),r.code.add(E`float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
float segmentLengthScreenRounded = flooredRepetitions * patternLength;
float stretch = repetitions / flooredRepetitions;
vStipplePatternStretch = max(0.75, stretch);
return vec2(0.0, segmentLengthScreenRounded);
}
return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
}`),s.uniforms.add(new $t("stipplePatternTexture",n=>n.stippleTexture),new pt("stipplePatternSDFNormalizer",n=>bgt(n.stipplePattern)),new pt("stipplePatternPixelSizeInv",n=>1/I3e(n))),e.stippleOffColorEnabled&&s.uniforms.add(new uc("stippleOffColor",n=>ygt(n.stippleOffColor))),s.code.add(E`float getStippleSDF(out bool isClamped) {
float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;
float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;
u = fract(u);
float encodedSDF = rgbaTofloat(texture(stipplePatternTexture, vec2(u, 0.5)));
float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;
return (sdf - 0.5) * vStipplePatternStretch + 0.5;
}
float getStippleSDF() {
bool ignored;
return getStippleSDF(ignored);
}
float getStippleAlpha() {
bool isClamped;
float stippleSDF = getStippleSDF(isClamped);
float antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);
return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
}`),s.code.add(E`
    void discardByStippleAlpha(float stippleAlpha, float threshold) {
     ${Se(!e.stippleOffColorEnabled,"if (stippleAlpha < threshold) { discard; }")}
    }

    vec4 blendStipple(vec4 color, float stippleAlpha) {
      return ${e.stippleOffColorEnabled?"mix(color, stippleOffColor, stippleAlpha)":"vec4(color.rgb, color.a * stippleAlpha)"};
    }
  `)}function bgt(t){return t?(Math.floor(.5*(O3e(t)-1))+.5)/t.pixelRatio:1}function I3e(t){const e=t.stipplePattern;return e?M3e(t.stipplePattern)/e.pixelRatio:1}const wgt=.4;async function vv(t,e){const{data:i}=await Ci(t,{responseType:"image",...e});return i}function xgt(){return Qpe??=(async()=>{const t=await V(()=>import("./basis_transcoder-BWPvAYbC.js"),[]),e=await t.default({locateFile:i=>gs(`esri/libs/basisu/${i}`)});return e.initializeBasis(),e})(),Qpe}let Qpe;var Q1;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(Q1||(Q1={}));let rf=null,$N=null;async function R3e(){return $N==null&&($N=xgt(),rf=await $N),$N}function Sgt(t,e){if(rf==null)return t.byteLength;const i=new rf.BasisFile(new Uint8Array(t)),r=D3e(i)?P3e(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),e):0;return i.close(),i.delete(),r}function Tgt(t,e){if(rf==null)return t.byteLength;const i=new rf.KTX2File(new Uint8Array(t)),r=L3e(i)?P3e(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),e):0;return i.close(),i.delete(),r}function P3e(t,e,i,r,s){const n=Hie(e?vs.COMPRESSED_RGBA8_ETC2_EAC:vs.COMPRESSED_RGB8_ETC2),o=s&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(i*r*n*o)}function D3e(t){return t.getNumImages()>=1&&!t.isUASTC()}function L3e(t){return t.getFaces()>=1&&t.isETC1S()}async function Egt(t,e,i){rf==null&&(rf=await R3e());const r=new rf.BasisFile(new Uint8Array(i));if(!D3e(r))return null;r.startTranscoding();const s=N3e(t,e,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(n,o)=>r.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>r.transcodeImage(a,0,n,o,0,0));return r.close(),r.delete(),s}async function Cgt(t,e,i){rf==null&&(rf=await R3e());const r=new rf.KTX2File(new Uint8Array(i));if(!L3e(r))return null;r.startTranscoding();const s=N3e(t,e,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(n,o)=>r.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>r.transcodeImage(a,n,0,0,o,0,-1,-1));return r.close(),r.delete(),s}function N3e(t,e,i,r,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[h,d]=l?r?[Q1.ETC2_RGBA,vs.COMPRESSED_RGBA8_ETC2_EAC]:[Q1.ETC1_RGB,vs.COMPRESSED_RGB8_ETC2]:c?r?[Q1.BC3_RGBA,vs.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[Q1.BC1_RGB,vs.COMPRESSED_RGB_S3TC_DXT1_EXT]:[Q1.RGBA32,vt.RGBA],f=e.hasMipmap?i:Math.min(1,i),m=[];for(let y=0;y<f;y++)m.push(new Uint8Array(o(y,h))),a(y,h,m[y]);return e.internalFormat=d,e.hasMipmap=m.length>1,e.samplingMode=e.hasMipmap?di.LINEAR_MIPMAP_LINEAR:di.LINEAR,e.width=s,e.height=n,new yi(t,e,{type:"compressed",levels:m})}const AN=()=>J.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),$gt=542327876,Agt=131072,Mgt=4;function Vse(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function Ogt(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const Igt=Vse("DXT1"),Rgt=Vse("DXT3"),Pgt=Vse("DXT5"),Dgt=31,Lgt=0,Ngt=1,Fgt=2,kgt=3,zgt=4,Ugt=7,Bgt=20,Vgt=21;function jgt(t,e,i){const r=Ggt(i,e.hasMipmap??!1);if(r==null)throw new Error("DDS texture data is null");const{textureData:s,internalFormat:n,width:o,height:a}=r;return e.samplingMode=s.levels.length>1?di.LINEAR_MIPMAP_LINEAR:di.LINEAR,e.hasMipmap=s.levels.length>1,e.internalFormat=n,e.width=o,e.height=a,new yi(t,e,s)}function Ggt(t,e){const i=new Int32Array(t.buffer,t.byteOffset,Dgt);if(i[Lgt]!==$gt)return AN().error("Invalid magic number in DDS header"),null;if(!(i[Bgt]&Mgt))return AN().error("Unsupported format, must contain a FourCC code"),null;const r=i[Vgt];let s,n;switch(r){case Igt:s=8,n=vs.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case Rgt:s=16,n=vs.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case Pgt:s=16,n=vs.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return AN().error("Unsupported FourCC code:",Ogt(r)),null}let o=1,a=i[zgt],l=i[kgt];(3&a||3&l)&&(AN().warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,h=l;let d,f;i[Fgt]&Agt&&e!==!1&&(o=Math.max(1,i[Ugt]));let m=t.byteOffset+i[Ngt]+4;const y=[];for(let v=0;v<o;++v)f=(a+3>>2)*(l+3>>2)*s,d=new Uint8Array(t.buffer,m,f),y.push(d),m+=f,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:y},internalFormat:n,width:c,height:h}}const QU=16;function Jy(t){return Math.ceil(t/QU)*QU}function Hgt(t){return Math.floor(t/QU)*QU}function qgt(t,e){let n=t.width*t.height;if(n<4096)return t instanceof ImageData?F3e(t):t;let o=t.width,a=t.height;do o=Math.ceil(o/2),a=Math.ceil(a/2),n=o*a;while(n>1048576||e!=null&&(o>e||a>e));return jse(t,o,a)}function Wgt(t,e){const i=Math.max(t.width,t.height);if(i<=e)return t;const r=e/i;return jse(t,Math.round(t.width*r),Math.round(t.height*r))}function jse(t,e,i){if(t instanceof ImageData)return jse(F3e(t),e,i);const r=document.createElement("canvas");return r.width=e,r.height=i,r.getContext("2d").drawImage(t,0,0,r.width,r.height),r}function F3e(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");if(i==null)throw new U("Failed to create 2d context from HTMLCanvasElement");return i.putImageData(t,0,0),e}let Gse=class extends ID{constructor(e,i){super(),this._data=e,this.type=Nn.Texture,this.events=new ws,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this._parameters={...Ygt,...i},this._startPreload(e)}dispose(){this.unload(),this._data=this.frameUpdate=void 0}_startPreload(e){e!=null&&(e instanceof HTMLVideoElement?(this.frameUpdate=i=>this._frameUpdate(e,i),this._startPreloadVideoElement(e)):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(i$(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const i=!e.paused;if(e.src=e.src,i&&e.autoplay){const r=()=>{e.removeEventListener("canplay",r),e.play()};e.addEventListener("canplay",r)}}}_startPreloadImageElement(e){wf(e.src)||i$(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}_createDescriptor(e){const i=new $r;return i.wrapMode=this._parameters.wrap??nr.REPEAT,i.flipped=!this._parameters.noUnpackFlip,i.samplingMode=this._parameters.mipmap?di.LINEAR_MIPMAP_LINEAR:di.LINEAR,i.hasMipmap=!!this._parameters.mipmap,i.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,i.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?e.parameters.maxMaxAnisotropy:1),i}get glTexture(){return this._glTexture}get memoryEstimate(){return this._glTexture?.usedMemory||Zgt(this._data,this._parameters)}load(e){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const i=this._data;return i==null?(this._glTexture=new yi(e,this._createDescriptor(e),null),this._glTexture):(this._parameters.reloadable||(this._data=void 0),typeof i=="string"?this._loadFromURL(e,i):i instanceof Image?this._loadFromImageElement(e,i):i instanceof HTMLVideoElement?this._loadFromVideoElement(e,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this._loadFromImage(e,i):k_(i)&&this._parameters.encoding===q_.DDS_ENCODING?this._loadFromDDSData(e,i):lO(i)&&this._parameters.encoding===q_.DDS_ENCODING?this._loadFromDDSData(e,new Uint8Array(i)):(lO(i)||k_(i))&&this._parameters.encoding===q_.KTX2_ENCODING?this._loadFromKTX2(e,i):(lO(i)||k_(i))&&this._parameters.encoding===q_.BASIS_ENCODING?this._loadFromBasis(e,i):k_(i)?this._loadFromPixelData(e,i):lO(i)?this._loadFromPixelData(e,new Uint8Array(i)):null)}_frameUpdate(e,i){return this._glTexture==null||e.readyState<NR.HAVE_CURRENT_DATA||i===e.currentTime?i:(this._glTexture.setData(e),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),e.currentTime)}_loadFromDDSData(e,i){return this._glTexture=jgt(e,this._createDescriptor(e),i),this._glTexture}_loadFromKTX2(e,i){return this._loadAsync(()=>Cgt(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromBasis(e,i){return this._loadAsync(()=>Egt(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromPixelData(e,i){jt(this._parameters.width>0&&this._parameters.height>0);const r=this._createDescriptor(e);return r.pixelFormat=this._parameters.components===1?vt.LUMINANCE:this._parameters.components===3?vt.RGB:vt.RGBA,r.width=this._parameters.width??0,r.height=this._parameters.height??0,this._glTexture=new yi(e,r,i),this._glTexture}_loadFromURL(e,i){return this._loadAsync(async r=>{const s=await vv(i,{signal:r});return gt(r),this._loadFromImage(e,s)})}_loadFromImageElement(e,i){return i.complete?this._loadFromImage(e,i):this._loadAsync(async r=>{const s=await Xxe(i,i.src,!1,r);return gt(r),this._loadFromImage(e,s)})}_loadFromVideoElement(e,i){return i.readyState>=NR.HAVE_CURRENT_DATA?this._loadFromImage(e,i):this._loadFromVideoElementAsync(e,i)}_loadFromVideoElementAsync(e,i){return this._loadAsync(r=>new Promise((s,n)=>{const o=()=>{i.removeEventListener("loadeddata",a),i.removeEventListener("error",l),Hi(c)},a=()=>{i.readyState>=NR.HAVE_CURRENT_DATA&&(o(),s(this._loadFromImage(e,i)))},l=h=>{o(),n(h||new U("Failed to load video"))};i.addEventListener("loadeddata",a),i.addEventListener("error",l);const c=Xo(r,()=>l(vi()))}))}_loadFromImage(e,i){let r=i;if(!(r instanceof HTMLVideoElement)){const{maxTextureSize:o}=e.parameters;r=this._parameters.downsampleUncompressed?qgt(r,o):Wgt(r,o)}const s=k3e(r);this._parameters.width=s.width,this._parameters.height=s.height;const n=this._createDescriptor(e);return n.pixelFormat=this._parameters.components===3?vt.RGB:vt.RGBA,n.width=s.width,n.height=s.height,n.shouldCompress=this._parameters.shouldCompress,this._glTexture=new yi(e,n,r),this._glTexture}_loadAsync(e){const i=new AbortController;this._loadingController=i;const r=e(i.signal);this._loadingPromise=r;const s=()=>{this._loadingController===i&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(s,s),r}unload(){if(this._glTexture=Rt(this._glTexture),this._loadingController!=null){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}get parameters(){return this._parameters}};function Zgt(t,e){if(t==null)return 0;if(lO(t)||k_(t))return e.encoding===q_.KTX2_ENCODING?Tgt(t,!!e.mipmap):e.encoding===q_.BASIS_ENCODING?Sgt(t,!!e.mipmap):t.byteLength;const{width:i,height:r}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?k3e(t):e;return(e.mipmap?4/3:1)*i*r*(e.components||4)||0}function k3e(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}var NR;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(NR||(NR={}));const Ygt={wrap:{s:nr.REPEAT,t:nr.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1,shouldCompress:!1},z3e=128,Z2=.5,mei=YP(Z2/2,Z2/2,1-Z2/2,1-Z2/2);function gei(t){return t==="cross"||t==="x"}function yei(t,e=z3e,i=e*Z2,r=0){const s=U3e(t,e,i,r);return new Gse(s,{mipmap:!1,wrap:{s:nr.CLAMP_TO_EDGE,t:nr.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0,reloadable:!0})}function U3e(t,e=z3e,i=e*Z2,r=0){switch(t){case"circle":default:return Jgt(e,i);case"square":return Xgt(e,i);case"cross":return Qgt(e,i,r);case"x":return eyt(e,i,r);case"kite":return Kgt(e,i);case"triangle":return tyt(e,i);case"arrow":return iyt(e,i)}}function Jgt(t,e){const i=t/2-.5;return jD(t,j3e(i,i,e/2))}function Xgt(t,e){return B3e(t,e,!1)}function Kgt(t,e){return B3e(t,e,!0)}function Qgt(t,e,i=0){return V3e(t,e,!1,i)}function eyt(t,e,i=0){return V3e(t,e,!0,i)}function tyt(t,e){return jD(t,G3e(t/2,e,e/2))}function iyt(t,e){const i=e,r=e/2,s=t/2,n=.8*i,o=j3e(s,(t-e)/2-n,Math.sqrt(n*n+r*r)),a=G3e(s,i,r);return jD(t,(l,c)=>Math.max(a(l,c),-o(l,c)))}function B3e(t,e,i){return i&&(e/=Math.SQRT2),jD(t,(r,s)=>{let n=r-.5*t+.25,o=.5*t-s-.75;if(i){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*e})}function V3e(t,e,i,r=0){e-=r,i&&(e*=Math.SQRT2);const s=.5*e;return jD(t,(n,o)=>{let a,l=n-.5*t,c=.5*t-o-1;if(i){const h=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=h}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=r/2,a})}function j3e(t,e,i){return(r,s)=>{const n=r-t,o=s-e;return Math.sqrt(n*n+o*o)-i}}function G3e(t,e,i){const r=Math.sqrt(e*e+i*i);return(s,n)=>{const o=Math.abs(s-t)-i,a=n-t+e/2+.75,l=(e*o+i*a)/r,c=-a;return Math.max(l,c)}}function jD(t,e){const i=new Uint8Array(4*t*t);for(let r=0;r<t;r++)for(let s=0;s<t;s++){const n=s+t*r;let o=e(s,r);o=o/t+.5,Nre(o,i,4*n)}return i}const FR=64,H3e=FR/2,q3e=H3e/5,ryt=FR/q3e,vei=.25;function syt(t,e){const i=U3e(t,FR,H3e,q3e),r=new $r;return r.internalFormat=vt.RGBA,r.width=FR,r.height=FR,r.wrapMode=nr.CLAMP_TO_EDGE,new yi(e,r,i)}function nyt(t,e){const i=t.vertex;LD(i),i.uniforms.get("markerScale")==null&&i.constants.add("markerScale","float",1),i.constants.add("markerSizePerLineWidth","float",ryt).code.add(E`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===hS.World&&(i.constants.add("maxSegmentLengthFraction","float",.45),i.uniforms.add(new Fn("perRenderPixelRatio",r=>r.camera.perRenderPixelRatio)),i.code.add(E`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}var dS;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(dS||(dS={}));let Sn=class extends zm{constructor(){super(...arguments),this.capType=dS.BUTT,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.occluder=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.wireframe=!1,this.discardInvisibleFragments=!1,this.objectAndLayerIdColorInstanced=!1,this.textureCoordinateType=Ws.None,this.emissionSource=Jo.None,this.occlusionPass=!1,this.hasVvInstancing=!0,this.hasSliceTranslatedView=!0}};u([te({count:dS.COUNT})],Sn.prototype,"capType",void 0),u([te()],Sn.prototype,"hasPolygonOffset",void 0),u([te()],Sn.prototype,"writeDepth",void 0),u([te()],Sn.prototype,"draped",void 0),u([te()],Sn.prototype,"stippleEnabled",void 0),u([te()],Sn.prototype,"stippleOffColorEnabled",void 0),u([te()],Sn.prototype,"stipplePreferContinuous",void 0),u([te()],Sn.prototype,"roundJoins",void 0),u([te()],Sn.prototype,"applyMarkerOffset",void 0),u([te()],Sn.prototype,"vvSize",void 0),u([te()],Sn.prototype,"vvColor",void 0),u([te()],Sn.prototype,"vvOpacity",void 0),u([te()],Sn.prototype,"falloffEnabled",void 0),u([te()],Sn.prototype,"innerColorEnabled",void 0),u([te()],Sn.prototype,"hasOccludees",void 0),u([te()],Sn.prototype,"occluder",void 0),u([te()],Sn.prototype,"terrainDepthTest",void 0),u([te()],Sn.prototype,"cullAboveTerrain",void 0),u([te()],Sn.prototype,"wireframe",void 0),u([te()],Sn.prototype,"discardInvisibleFragments",void 0),u([te()],Sn.prototype,"objectAndLayerIdColorInstanced",void 0);const a3=1;function W3e(t){const e=new ki,{attributes:i,varyings:r,vertex:s,fragment:n}=e,{applyMarkerOffset:o,draped:a,output:l,capType:c,stippleEnabled:h,falloffEnabled:d,roundJoins:f,wireframe:m,innerColorEnabled:y}=t;e.include(FD),e.include(pgt,t),e.include(_gt,t),e.include(wse,t),e.include(zD,t);const v=o&&!a;v&&(s.uniforms.add(new pt("markerScale",C=>C.markerScale)),e.include(nyt,{space:hS.World})),By(s,t),s.uniforms.add(new Co("inverseProjectionMatrix",C=>C.camera.inverseProjectionMatrix),new fv("nearFar",C=>C.camera.nearFar),new pt("miterLimit",C=>C.join!=="miter"?0:C.miterLimit),new Ua("viewport",C=>C.camera.fullViewport)),s.constants.add("LARGE_HALF_FLOAT","float",65500),i.add(z.POSITION,"vec3"),i.add(z.PREVPOSITION,"vec3"),i.add(z.NEXTPOSITION,"vec3"),i.add(z.SUBDIVISIONFACTOR,"float"),i.add(z.UV0,"vec2"),r.add("vColor","vec4"),r.add("vpos","vec3"),r.add("vLineDistance","float"),r.add("vLineWidth","float");const _=h;_&&r.add("vLineSizeInv","float");const b=c===dS.ROUND,w=h&&b,x=d||w;x&&r.add("vLineDistanceNorm","float"),b&&(r.add("vSegmentSDF","float"),r.add("vReverseSegmentSDF","float")),s.code.add(E`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),s.code.add(E`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),s.code.add(E`void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
float vnp = nearFar[0] * 0.99;
if(pos.z > -nearFar[0]) {
if (!isStartVertex) {
if(prev.z < -nearFar[0]) {
pos = mix(prev, pos, interp(vnp, prev, pos));
next = pos;
} else {
pos = vec4(0.0, 0.0, 0.0, 1.0);
}
} else {
if(next.z < -nearFar[0]) {
pos = mix(pos, next, interp(vnp, pos, next));
prev = pos;
} else {
pos = vec4(0.0, 0.0, 0.0, 1.0);
}
}
} else {
if (prev.z > -nearFar[0]) {
prev = mix(pos, prev, interp(vnp, pos, prev));
}
if (next.z > -nearFar[0]) {
next = mix(next, pos, interp(vnp, next, pos));
}
}
forwardViewPosDepth(pos.xyz);
pos = projectAndScale(pos);
next = projectAndScale(next);
prev = projectAndScale(prev);
}`),LD(s),s.constants.add("aaWidth","float",h?0:1).main.add(E`
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;
      float lineSize = getSize();

      if (lineSize < 1.0) {
        coverage = lineSize; // convert sub-pixel coverage to alpha
        lineSize = 1.0;
      }
      lineSize += aaWidth;

      float lineWidth = lineSize * pixelRatio;
      vLineWidth = lineWidth;
      ${_?E`vLineSizeInv = 1.0 / lineSize;`:""}

      vec4 pos  = view * vec4(position, 1.0);
      vec4 prev = view * vec4(prevPosition, 1.0);
      vec4 next = view * vec4(nextPosition, 1.0);
  `),v&&s.main.add(E`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),s.main.add(E`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(h||b)&&s.main.add(E`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${b?E`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),s.main.add(E`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = perpendicular(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),f?s.main.add(E`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = perpendicular(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = perpendicular(endDir);

        float factor = ${h?E`min(1.0, subdivisionFactor * ${E.float((a3+2)/(a3+1))})`:E`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):s.main.add(E`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = perpendicular(joinDisplacementDir);`);const S=c!==dS.BUTT;return s.main.add(E`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = perpendicular(joinDisplacementDir);

      ${S?E`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),s.main.add(E`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;
    float lineDistNorm = sign(uv0.y) * pos.w;

    vLineDistance =  lineWidth * lineDistNorm;
    ${x?E`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),b&&s.main.add(E`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),h&&(a?s.uniforms.add(new Fn("worldToScreenRatio",C=>1/C.screenToPCSRatio)):s.main.add(E`vec3 segmentCenter = mix((nextPosition + position) * 0.5, (position + prevPosition) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),s.main.add(E`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(nextPosition - position, position - prevPosition, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),a?s.main.add(E`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):s.main.add(E`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),s.uniforms.add(new pt("stipplePatternPixelSize",C=>I3e(C))),s.main.add(E`float patternLength = lineSize * stipplePatternPixelSize;
vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);
if (segmentLengthScreenDouble >= 0.001) {
vec2 stippleDisplacement = pos.xy - segmentOrigin;
float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);
vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
}
vStippleDistanceLimits *= pos.w;
vStippleDistance *= pos.w;
vStippleDistanceLimits = isJoin ?
vStippleDistanceLimits :
isStartVertex ?
vec2(-1e34, vStippleDistanceLimits.y) :
vec2(vStippleDistanceLimits.x, 1e34);`)),s.main.add(E`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${m&&!a?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }`),e.fragment.include(Z_,t),e.include(sG,t),n.include(FA),n.main.add(E`discardBySlice(vpos);
discardByTerrainDepth();`),m?n.main.add(E`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(b&&n.main.add(E`
        float sdf = min(vSegmentSDF, vReverseSegmentSDF);
        vec2 fragmentPosition = vec2(
          min(sdf, 0.0),
          vLineDistance
        ) * gl_FragCoord.w;

        float fragmentRadius = length(fragmentPosition);
        float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
        float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

        if (capCoverage < ${E.float(Yr)}) {
          discard;
        }
      `),w?n.main.add(E`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${E.float(Yr)}, stippleCoverage);
      `):n.main.add(E`float stippleAlpha = getStippleAlpha();`),l!==Y.ObjectAndLayerIdColor&&n.main.add(E`discardByStippleAlpha(stippleAlpha, ${E.float(Yr)});`),n.uniforms.add(new uc("intrinsicColor",C=>C.color)),n.main.add(E`vec4 color = intrinsicColor * vColor;`),y&&(n.uniforms.add(new uc("innerColor",C=>C.innerColor??C.color),new pt("innerWidth",(C,T)=>C.innerWidth*T.camera.pixelRatio)),n.main.add(E`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),n.main.add(E`vec4 finalColor = blendStipple(color, stippleAlpha);`),d&&(n.uniforms.add(new pt("falloff",C=>C.falloff)),n.main.add(E`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)),h||n.main.add(E`float featherStartDistance = max(vLineWidth - 2.0, 0.0);
float value = abs(vLineDistance) * gl_FragCoord.w;
float feather = (value - featherStartDistance) / (vLineWidth - featherStartDistance);
finalColor.a *= 1.0 - clamp(feather, 0.0, 1.0);`)),n.main.add(E`outputColorHighlightOID(finalColor, vpos);`),e}const oyt=Object.freeze(Object.defineProperty({__proto__:null,build:W3e,ribbonlineNumRoundJoinSubdivisions:a3},Symbol.toStringTag,{value:"Module"}));let ayt=class extends Bi{constructor(e,i){super(e,i,new Fi(oyt,()=>V(()=>Promise.resolve().then(()=>AGt),void 0)),Z3e),this.primitiveType=i.wireframe?Ui.LINES:Ui.TRIANGLE_STRIP}_makePipelineState(e,i){const{oitPass:r,output:s,hasOccludees:n,hasPolygonOffset:o}=e,a=r===bi.NONE,l=r===bi.FrontFace;return _i({blending:_s(s)?cse(r):null,depthTest:{func:hse(r)},depthWrite:sPe(e),drawBuffers:s===Y.Depth?{buffers:[Va.NONE]}:Gj(r,s),colorWrite:Ai,stencilWrite:n?UU:null,stencilTest:n?i?vJ:gse:null,polygonOffset:a||l?o?efe:null:use})}initializePipeline(e){if(e.occluder){const i=e.hasPolygonOffset?efe:null;this._occluderPipelineTransparent=_i({blending:Od,polygonOffset:i,depthTest:ope,depthWrite:null,colorWrite:Ai,stencilWrite:null,stencilTest:upt,drawBuffers:e.output===Y.Depth?{buffers:[Va.NONE]}:null}),this._occluderPipelineOpaque=_i({blending:Od,polygonOffset:i,depthTest:ope,depthWrite:null,colorWrite:Ai,stencilWrite:opt,stencilTest:cpt,drawBuffers:e.output===Y.Depth?{buffers:[Va.NONE]}:null}),this._occluderPipelineMaskWrite=_i({blending:null,polygonOffset:i,depthTest:npt,depthWrite:null,colorWrite:null,stencilWrite:UU,stencilTest:vJ,drawBuffers:e.output===Y.Depth?{buffers:[Va.NONE]}:null})}return this._occludeePipeline=this._makePipelineState(e,!0),this._makePipelineState(e,!1)}getPipeline(e,i){if(e)return this._occludeePipeline;switch(i){case be.TRANSPARENT_OCCLUDER_MATERIAL:return this._occluderPipelineTransparent??super.getPipeline();case be.OCCLUDER_MATERIAL:return this._occluderPipelineOpaque??super.getPipeline();default:return this._occluderPipelineMaskWrite??super.getPipeline()}}};const efe={factor:0,units:-4},Z3e=new Map([[z.POSITION,0],[z.PREVPOSITION,1],[z.NEXTPOSITION,2],[z.SUBDIVISIONFACTOR,3],[z.UV0,4],[z.COLOR,5],[z.COLORFEATUREATTRIBUTE,5],[z.SIZE,6],[z.SIZEFEATUREATTRIBUTE,6],[z.OPACITYFEATUREATTRIBUTE,7],[z.OBJECTANDLAYERIDCOLOR,8]]);var Rc;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(Rc||(Rc={}));let lyt=class extends jj{constructor(e){super(e,uyt),this._configuration=new Sn,this.vertexAttributeLocations=Z3e,this.produces=new Map([[be.OPAQUE_MATERIAL,i=>Fj(i)||_s(i)&&this.parameters.renderOccluded===Er.OccludeAndTransparentStencil],[be.OPAQUE_MATERIAL_WITHOUT_NORMALS,i=>kj(i)],[be.OCCLUDER_MATERIAL,i=>NY(i)&&this.parameters.renderOccluded===Er.OccludeAndTransparentStencil],[be.TRANSPARENT_OCCLUDER_MATERIAL,i=>NY(i)&&this.parameters.renderOccluded===Er.OccludeAndTransparentStencil],[be.TRANSPARENT_MATERIAL,i=>_s(i)&&this.parameters.writeDepth&&this.parameters.renderOccluded!==Er.OccludeAndTransparentStencil],[be.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,i=>_s(i)&&!this.parameters.writeDepth&&this.parameters.renderOccluded!==Er.OccludeAndTransparentStencil],[be.DRAPED_MATERIAL,i=>Mht(i)]])}getConfiguration(e,i){this._configuration.output=e,this._configuration.oitPass=i.oitPass,this._configuration.draped=i.slot===be.DRAPED_MATERIAL;const r=this.parameters.stipplePattern!=null&&e!==Y.Highlight;return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&this.parameters.stippleOffColor!=null,this._configuration.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=this.parameters.markerParameters!=null&&dyt(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&this.parameters.innerColor!=null,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.hasOccludees=i.hasOccludees,this._configuration.occluder=this.parameters.renderOccluded===Er.OccludeAndTransparentStencil,this._configuration.terrainDepthTest=i.terrainDepthTest&&_s(e),this._configuration.cullAboveTerrain=i.cullAboveTerrain,this._configuration.wireframe=this.parameters.wireframe,this._configuration}get visible(){return this.parameters.color[3]>=Yr||this.parameters.stipplePattern!=null&&(this.parameters.stippleOffColor?.[3]??0)>Yr}intersectDraped({attributes:e,screenToWorldRatio:i},r,s,n,o,a){if(!s.options.selectionMode)return;const l=e.get(z.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const b=e.get(z.SIZEFEATUREATTRIBUTE).data[0];c*=ce(this.parameters.vvSize.offset[0]+b*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const h=n[0],d=n[1],f=(c/2+4)*i;let m=Number.MAX_VALUE,y=0;const v=e.get(z.POSITION).data,_=kJ(this.parameters,e)?v.length-2:v.length-5;for(let b=0;b<_;b+=3){const w=v[b],x=v[b+1],S=(b+3)%v.length,C=h-w,T=d-x,M=v[S]-w,I=v[S+1]-x,P=ce((M*C+I*T)/(M*M+I*I),0,1),D=M*P-C,F=I*P-T,L=D*D+F*F;L<m&&(m=L,y=b/3)}m<f*f&&o(a.dist,a.normal,y,!1)}intersect(e,i,r,s,n,o){if(!r.options.selectionMode||!e.visible)return;if(!Mct(i))return void J.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=e.attributes,l=a.get(z.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSize){const w=a.get(z.SIZEFEATUREATTRIBUTE).data[0];c*=ce(this.parameters.vvSize.offset[0]+w*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else a.has(z.SIZE)&&(c*=a.get(z.SIZE).data[0]);const h=r.camera,d=pyt;zn(d,r.point);const f=c*h.pixelRatio/2+4*h.pixelRatio;se(AM[0],d[0]-f,d[1]+f,0),se(AM[1],d[0]+f,d[1]+f,0),se(AM[2],d[0]+f,d[1]-f,0),se(AM[3],d[0]-f,d[1]-f,0);for(let w=0;w<4;w++)if(!h.unprojectFromRenderScreen(AM[w],Ig[w]))return;kp(h.eye,Ig[0],Ig[1],r8),kp(h.eye,Ig[1],Ig[2],s8),kp(h.eye,Ig[2],Ig[3],n8),kp(h.eye,Ig[3],Ig[0],o8);let m=Number.MAX_VALUE,y=0;const v=kJ(this.parameters,a)?l.length-2:l.length-5;for(let w=0;w<v;w+=3){Rl[0]=l[w]+i[12],Rl[1]=l[w+1]+i[13],Rl[2]=l[w+2]+i[14];const x=(w+3)%l.length;if(Pl[0]=l[x]+i[12],Pl[1]=l[x+1]+i[13],Pl[2]=l[x+2]+i[14],rn(r8,Rl)<0&&rn(r8,Pl)<0||rn(s8,Rl)<0&&rn(s8,Pl)<0||rn(n8,Rl)<0&&rn(n8,Pl)<0||rn(o8,Rl)<0&&rn(o8,Pl)<0)continue;if(h.projectToRenderScreen(Rl,ww),h.projectToRenderScreen(Pl,xw),ww[2]<0&&xw[2]>0){ye(Of,Rl,Pl);const C=h.frustum,T=-rn(C[_o.NEAR],Rl)/de(Of,C[_o.NEAR]);ie(Of,Of,T),oe(Rl,Rl,Of),h.projectToRenderScreen(Rl,ww)}else if(ww[2]>0&&xw[2]<0){ye(Of,Pl,Rl);const C=h.frustum,T=-rn(C[_o.NEAR],Pl)/de(Of,C[_o.NEAR]);ie(Of,Of,T),oe(Pl,Pl,Of),h.projectToRenderScreen(Pl,xw)}else if(ww[2]<0&&xw[2]<0)continue;ww[2]=0,xw[2]=0;const S=TOe(A4(ww,xw,rfe),d);S<m&&(m=S,ne(tfe,Rl),ne(ife,Pl),y=w/3)}const _=r.rayBegin,b=r.rayEnd;if(m<f*f){let w=Number.MAX_VALUE;if(got(A4(tfe,ife,rfe),A4(_,b,fyt),bw)){ye(bw,bw,_);const x=Te(bw);ie(bw,bw,1/x),w=x/xr(_,b)}o(w,bw,y,!1)}}get _layout(){const e=Nd().vec3f(z.POSITION).vec3f(z.PREVPOSITION).vec3f(z.NEXTPOSITION).f32(z.SUBDIVISIONFACTOR).vec2f(z.UV0);return this.parameters.vvSize?e.f32(z.SIZEFEATUREATTRIBUTE):e.f32(z.SIZE),this.parameters.vvColor?e.f32(z.COLORFEATUREATTRIBUTE):e.vec4f(z.COLOR),this.parameters.vvOpacity&&e.f32(z.OPACITYFEATUREATTRIBUTE),Md()&&e.vec4u8(z.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new hyt(this._layout,this.parameters)}createGLMaterial(e){return new cyt(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),e.markerParameters!=null&&(e.markerScale=e.markerParameters.width/e.width)}},cyt=class extends sse{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextures.release(this._stipplePattern),this._stipplePattern=null}beginSlot(e){const i=this._material.parameters.stipplePattern;return this._stipplePattern!==i&&(this._material.setParameters({stippleTexture:this._stippleTextures.swap(i,this._stipplePattern)}),this._stipplePattern=i),this.getTechnique(ayt,e)}},uyt=class extends Dpt{constructor(){super(...arguments),this.width=0,this.color=tre,this.join="miter",this.cap=dS.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.wireframe=!1}get transparent(){return this.color[3]<1||this.stipplePattern!=null&&(this.stippleOffColor?.[3]??0)<1}},hyt=class{constructor(e,i){this.vertexBufferLayout=e,this._parameters=i,this.numJoinSubdivisions=0;const r=i.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=a3+r}}_isClosed(e){return kJ(this._parameters,e)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const r=e.get(z.POSITION).indices.length/2+1,s=this._isClosed(e);let n=s?2:2*2;return n+=((s?r:r-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this._parameters.wireframe&&(n=2+4*(n-2)),n}write(e,i,r,s,n,o){const a=myt,l=gyt,c=yyt,h=r.get(z.POSITION),d=h.indices,f=h.data.length/3,m=r.get(z.DISTANCETOSTART)?.data;d&&d.length!==2*(f-1)&&console.warn("RibbonLineMaterial does not support indices");const y=r.get(z.SIZEFEATUREATTRIBUTE)?.data[0]??r.get(z.SIZE)?.data[0]??1;let v=[1,1,1,1],_=0;const b=this.vertexBufferLayout.fields.has(z.COLORFEATUREATTRIBUTE);b?_=r.get(z.COLORFEATUREATTRIBUTE).data[0]:r.has(z.COLOR)&&(v=r.get(z.COLOR).data);const w=this.vertexBufferLayout.fields.has(z.OPACITYFEATUREATTRIBUTE),x=w?r.get(z.OPACITYFEATUREATTRIBUTE).data[0]:0,S=new Float32Array(n.buffer),C=Md()?new Uint8Array(n.buffer):null,T=this.vertexBufferLayout.stride/4;let M=o*T;const I=M;let P=0;const D=m?(k,W,G)=>P=m[G]:(k,W,G)=>P+=xr(k,W),F=(k,W,G,j,re,ve,xe)=>{if(S[M++]=W[0],S[M++]=W[1],S[M++]=W[2],S[M++]=k[0],S[M++]=k[1],S[M++]=k[2],S[M++]=G[0],S[M++]=G[1],S[M++]=G[2],S[M++]=j,S[M++]=xe,S[M++]=re,S[M++]=y,b)S[M++]=_;else{const De=Math.min(4*ve,v.length-4);S[M++]=v[De],S[M++]=v[De+1],S[M++]=v[De+2],S[M++]=v[De+3]}w&&(S[M++]=x),Md()&&(s&&(C[4*M]=s[0],C[4*M+1]=s[1],C[4*M+2]=s[2],C[4*M+3]=s[3]),M++)};M+=T,se(l,h.data[0],h.data[1],h.data[2]),e&&st(l,l,e);const L=this._isClosed(r);if(L){const k=h.data.length-3;se(a,h.data[k],h.data[k+1],h.data[k+2]),e&&st(a,a,e)}else se(c,h.data[3],h.data[4],h.data[5]),e&&st(c,c,e),F(l,l,c,1,Rc.LEFT_CAP_START,0,0),F(l,l,c,1,Rc.RIGHT_CAP_START,0,0),ne(a,l),ne(l,c);const N=L?0:1,R=L?f:f-1;for(let k=N;k<R;k++){const W=(k+1)%f*3;se(c,h.data[W],h.data[W+1],h.data[W+2]),e&&st(c,c,e),D(a,l,k),F(a,l,c,0,Rc.LEFT_JOIN_END,k,P),F(a,l,c,0,Rc.RIGHT_JOIN_END,k,P);const G=this.numJoinSubdivisions;for(let j=0;j<G;++j){const re=(j+1)/(G+1);F(a,l,c,re,Rc.LEFT_JOIN_END,k,P),F(a,l,c,re,Rc.RIGHT_JOIN_END,k,P)}F(a,l,c,1,Rc.LEFT_JOIN_START,k,P),F(a,l,c,1,Rc.RIGHT_JOIN_START,k,P),ne(a,l),ne(l,c)}L?(se(c,h.data[3],h.data[4],h.data[5]),e&&st(c,c,e),P=D(a,l,R),F(a,l,c,0,Rc.LEFT_JOIN_END,N,P),F(a,l,c,0,Rc.RIGHT_JOIN_END,N,P)):(P=D(a,l,R),F(a,l,l,0,Rc.LEFT_CAP_END,R,P),F(a,l,l,0,Rc.RIGHT_CAP_END,R,P)),i8(S,I+T,S,I,T),M=i8(S,M-T,S,M,T),this._parameters.wireframe&&this._addWireframeVertices(n,I,M,T)}_addWireframeVertices(e,i,r,s){const n=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT,r-i);let a=0;const l=c=>a=i8(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}};function i8(t,e,i,r,s){for(let n=0;n<s;n++)i[r++]=t[e++];return r}function kJ(t,e){return t.isClosed?e.get(z.POSITION).indices.length>2:!1}function dyt(t){return t.anchor===o3.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const Rl=$(),Pl=$(),Of=$(),bw=$(),pyt=$(),ww=Wp(),xw=Wp(),tfe=$(),ife=$(),rfe=Iv(),fyt=Iv(),myt=$(),gyt=$(),yyt=$(),AM=[Wp(),Wp(),Wp(),Wp()],Ig=[$(),$(),$(),$()],r8=Br(),s8=Br(),n8=Br(),o8=Br();let Y3e=class{constructor(e){this._originSR=e,this._rootOriginId="root/"+_d(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const i=this._origins.get(this._rootOriginId);if(i==null){const h=ZU(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,h),h}const r=this._gridSize,s=Math.round(e[0]/r),n=Math.round(e[1]/r),o=Math.round(e[2]/r),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*r;if(ye(Po,e,i.vec3),Po[0]=Math.abs(Po[0]),Po[1]=Math.abs(Po[1]),Po[2]=Math.abs(Po[2]),Po[0]<c&&Po[1]<c&&Po[2]<c){if(l){const h=Math.max(...Po);if(ye(Po,e,l.vec3),Po[0]=Math.abs(Po[0]),Po[1]=Math.abs(Po[1]),Po[2]=Math.abs(Po[2]),Math.max(...Po)<h)return l}return i}return l||(l=ZU(s*r,n*r,o*r,a),this._origins.set(a,l)),l}_drawOriginBox(e,i=Gi(1,1,0,1)){const r=window.view,s=r._stage,n=i.toString();if(!this._objects.has(n)){this._material=new lyt({width:2,color:i}),s.add(this._material);const m=new $3e(s,{pickable:!1}),y=new Use({castShadow:!1});s.add(y),m.add(y),this._objects.set(n,y)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),h=new Array,d=.5*this._gridSize;for(let m=0;m<l;m++)c[3*m]=e[0]+(1&a[m]?d:-d),c[3*m+1]=e[1]+(2&a[m]?d:-d),c[3*m+2]=e[2]+(4&a[m]?d:-d),m>0&&h.push(m-1,m);Bn(c,this._originSR,0,c,r.renderSpatialReference,0,l);const f=new Ea(this._material,[[z.POSITION,new Wt(c,h,3,!0)]],null,Nn.Line);s.add(f),o.addGeometry(f)}get test(){}};const Po=$();var da;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})(da||(da={}));var Nx;(function(t){t[t.Immediate=0]="Immediate",t[t.FadeWithWeather=1]="FadeWithWeather"})(Nx||(Nx={}));let vyt=class{constructor(e,i){this.width=e,this.height=i}},Hse=class{constructor(e){this.shadowMap=e,this.slot=be.OPAQUE_MATERIAL,this.slicePlane=null,this.hasOccludees=!1,this.enableFillLights=!0,this.oitPass=bi.NONE,this.alignPixelEnabled=!1,this.decorations=!0,this.overlayStretch=1,this.viewshedEnabled=!1,this._camera=new jr,this._inverseViewport=He(),this._oldLighting=new jH,this._newLighting=new jH,this._fadedLighting=new jH,this._lighting=this._newLighting,this.ssr=new _yt,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.highlights=new Array,this.highlightOrderMap=new Map,this.highlightMixOrigin=He(),this.highlightMixTexture=null,this.hudRenderStyle=da.Occluded,this.hudOccludedFragmentOpacity=1,this.clouds=new Emt,this.shadowHighlightsVisible=!1}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}fadeLighting(){switch(this.clouds.fadeFactor){case 0:this._lighting=this._oldLighting;break;default:this._fadedLighting.lerpLighting(this._oldLighting,this._newLighting,this.clouds.fadeFactor),this._lighting=this._fadedLighting;break;case 1:this._lighting=this._newLighting,this._oldLighting.copyFrom(this._newLighting)}}updateLighting(e,i,r,s){this._oldLighting.copyFrom(this.lighting),this._newLighting.noonFactor=i,this._newLighting.globalFactor=r,this._newLighting.set(e),s===Nx.FadeWithWeather&&this.clouds.requestFade(),this.fadeLighting()}get highlight(){return this.highlightLevel==null?null:this.highlights[this.highlightLevel]}},_yt=class{constructor(){this.fadeFactor=1,this.reprojectionMatrix=Ve()}},J3e=class{constructor(e,i){this.rctx=e,this.lastFrameCamera=new jr,this.output=Y.Color,this.renderOccludedMask=kC,this.bind=new Hse(i),this.bind.alignPixelEnabled=!0}},byt=class extends J3e{constructor(e,i,r){super(e,i),this.techniques=r,this.time=0}};const kC=Er.Occlude|Er.OccludeAndTransparent|Er.OccludeAndTransparentStencil;let fI=class extends jr{constructor(){super(...arguments),this._projectionMatrix=Ve()}get projectionMatrix(){return this._projectionMatrix}};u([p()],fI.prototype,"_projectionMatrix",void 0),u([p({readOnly:!0})],fI.prototype,"projectionMatrix",null),fI=u([A("esri.views.3d.webgl-engine.lib.CascadeCamera")],fI);var pS;(function(t){t[t.Highlight=0]="Highlight",t[t.ExcludeHighlight=1]="ExcludeHighlight"})(pS||(pS={}));let MN=class{constructor(){this.camera=new fI,this.lightMat=Ve()}},wyt=class{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}},qse=class{constructor(e,i){this._fbos=e,this._viewingMode=i,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new wyt,this._projectionView=Ve(),this._projectionViewInverse=Ve(),this._modelViewLight=Ve(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=pi(),this._cascades=[new MN,new MN,new MN,new MN],this._lastOrigin=null,this._maxTextureWidth=Math.min(X("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){return this._handle?.getTexture()}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return es(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeOffscreenBuffers(){this._handle=Dr(this._handle),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=ce(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}get cascades(){for(let e=0;e<this._numCascades;++e)l8[e]=this._cascades[e];return l8.length=this._numCascades,l8}start(e,i,r,s,n){jt(this.enabled);const{near:o,far:a}=$yt(r);this._computeCascadeDistances(o,a,s),this._textureHeight=this._computeTextureHeight(e,n,s),this._setupMatrices(e,i);const{viewMatrix:l,projectionMatrix:c}=e;for(let h=0;h<this._numCascades;++h)this._constructCascade(h,c,l,i);this._lastOrigin=null,this.clear()}finish(){jt(this.enabled),this._handle?.detachDepth()}getShadowMapMatrices(e){if(!this._lastOrigin||!Qn(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||$(),ne(this._lastOrigin,e);for(let i=0;i<this._numCascades;++i){nh(cfe,this._cascades[i].lightMat,e);for(let r=0;r<16;++r)ufe[16*i+r]=cfe[r]}}return ufe}moveSnapshot(e){jt(this.enabled),this._handle?.detachDepth(),this._snapshots[e]?.release(),this._snapshots[e]=this._handle,this._handle=null,this.clear()}copySnapshot(e){const i=this._handle?.getTexture()?.descriptor;if(!this.enabled||!i)return;this._snapshots[e]?.release();const{width:r,height:s}=i,n=e===pS.Highlight?"shadow highlight snapshot":"shadow no highlight snapshot";this._snapshots[e]=this._fbos.acquire(r,s,n,fr.RGBA4);const o=this._fbos.rctx;this._bindFbo();const a=o.bindTexture(this._snapshots[e]?.getTexture(),yi.TEXTURE_UNIT_FOR_UPDATES);o.gl.copyTexSubImage2D(ts.TEXTURE_2D,0,0,0,0,0,r,s),o.bindTexture(a,yi.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(e){return this.enabled?this._snapshots[e]?.getTexture():null}clear(){const e=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),e.setClearColor(1,1,1,1),e.clear(Si.COLOR|Si.DEPTH)}_computeTextureHeight(e,i,r){const s=Math.min(window.devicePixelRatio,i)/e.pixelRatio,n=r?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,o=Jy(Math.floor(Math.max(e.fullWidth,e.fullHeight)*s*n)),a=Math.min(this._maxTextureWidth,this._numCascades*o);return Hgt(a/this._numCascades)}_ensureFbo(){this._handle?.fbo?.width===this._textureWidth&&this._handle?.fbo.height===this._textureHeight||(this._handle?.release(),this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",fr.RGBA4)),this._handle?.acquireDepth(jo.DEPTH16_BUFFER)}_discardSnapshot(e){this._snapshots[e]=Dr(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){this._fbos.rctx.bindFramebuffer(this._handle?.fbo)}_constructCascade(e,i,r,s){const n=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],l=(i[10]*o+i[14])/Math.abs(i[11]*o+i[15]),c=(i[10]*a+i[14])/Math.abs(i[11]*a+i[15]);jt(l<c);for(let m=0;m<8;++m){es(sfe,m%4==0||m%4==3?-1:1,m%4==0||m%4==1?-1:1,m<4?l:c,1);const y=Gh[m];Yc(y,sfe,this._projectionViewInverse),y[0]/=y[3],y[1]/=y[3],y[2]/=y[3]}wd(a8,Gh[0]),n.camera.viewMatrix=nh(xyt,this._modelViewLight,a8);for(let m=0;m<8;++m)st(Gh[m],Gh[m],n.camera.viewMatrix);let h=Gh[0][2],d=Gh[0][2];for(let m=1;m<8;++m)h=Math.min(h,Gh[m][2]),d=Math.max(d,Gh[m][2]);h-=200,d+=200,n.camera.near=-d,n.camera.far=-h,Cyt(r,s,h,d,n.camera),kn(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const f=this._textureHeight;n.camera.viewport=[e*f,0,f,f]}_setupMatrices(e,i){kn(this._projectionView,e.projectionMatrix,e.viewMatrix),Sl(this._projectionViewInverse,this._projectionView);const r=this._viewingMode===Be.Global?e.eye:se(a8,0,0,1);jV(this._modelViewLight,[0,0,0],[-i[0],-i[1],-i[2]],r)}_computeCascadeDistances(e,i,r){const s=r?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(Act(i/e,4)),s);const n=(i-e)/this._numCascades,o=(i/e)**(1/this._numCascades);let a=e,l=e;for(let c=0;c<this._numCascades+1;++c)this._cascadeDistances[c]=dt(a,l,this.settings.splitSchemeLambda),a*=o,l+=n}get test(){}};const xyt=Ve(),sfe=pi(),Gh=[];for(let t=0;t<8;++t)Gh.push(pi());const nfe=He(),ofe=He(),Syt=He(),afe=He(),lfe=He(),a8=$(),l8=[],cfe=Ve(),ufe=Kn.concat(Kn,Kn,Kn,Kn),fu=He(),IT=He(),Sw=[He(),He(),He(),He()],Gn=He(),c8=He(),u0=He(),MM=He(),RT=He(),PT=He(),ON=He();function Tyt(t,e,i,r,s,n,o,a){li(fu,0,0);for(let C=0;C<4;++C)wy(fu,fu,t[C]);ud(fu,fu,.25),li(IT,0,0);for(let C=4;C<8;++C)wy(IT,IT,t[C]);ud(IT,IT,.25),Kh(Sw[0],t[4],t[5],.5),Kh(Sw[1],t[5],t[6],.5),Kh(Sw[2],t[6],t[7],.5),Kh(Sw[3],t[7],t[4],.5);let l=0,c=C$(Sw[0],fu);for(let C=1;C<4;++C){const T=C$(Sw[C],fu);T<c&&(c=T,l=C)}cd(Gn,Sw[l],t[l+4]);const h=Gn[0];let d,f;Gn[0]=-Gn[1],Gn[1]=h,cd(c8,IT,fu),Bo(c8,Gn)<0&&bie(Gn,Gn),Kh(Gn,Gn,c8,i),jP(Gn,Gn),d=f=Bo(cd(u0,t[0],fu),Gn);for(let C=1;C<8;++C){const T=Bo(cd(u0,t[C],fu),Gn);T<d?d=T:T>f&&(f=T)}zn(r,fu),ud(u0,Gn,d-e),wy(r,r,u0);let m=-1,y=1,v=0,_=0;for(let C=0;C<8;++C){cd(MM,t[C],r),jP(MM,MM);const T=Gn[0]*MM[1]-Gn[1]*MM[0];T>0?T>m&&(m=T,v=C):T<y&&(y=T,_=C)}_T(m>0,"leftArea"),_T(y<0,"rightArea"),ud(RT,Gn,d),wy(RT,RT,fu),ud(PT,Gn,f),wy(PT,PT,fu),ON[0]=-Gn[1],ON[1]=Gn[0];const b=hN(r,t[_],PT,wy(u0,PT,ON),1,s),w=hN(r,t[v],PT,u0,1,n),x=hN(r,t[v],RT,wy(u0,RT,ON),1,o),S=hN(r,t[_],RT,u0,1,a);_T(b,"rayRay"),_T(w,"rayRay"),_T(x,"rayRay"),_T(S,"rayRay")}function Ii(t,e){return 3*e+t}const hfe=He();function vc(t,e){return li(hfe,t[e],t[e+3]),hfe}const Dl=He(),Je=xs();function Eyt(t,e,i,r,s){cd(Dl,i,r),ud(Dl,Dl,.5),Je[0]=Dl[0],Je[1]=Dl[1],Je[2]=0,Je[3]=Dl[1],Je[4]=-Dl[0],Je[5]=0,Je[6]=Dl[0]*Dl[0]+Dl[1]*Dl[1],Je[7]=Dl[0]*Dl[1]-Dl[1]*Dl[0],Je[8]=1,Je[Ii(0,2)]=-Bo(vc(Je,0),t),Je[Ii(1,2)]=-Bo(vc(Je,1),t);let n=Bo(vc(Je,0),i)+Je[Ii(0,2)],o=Bo(vc(Je,1),i)+Je[Ii(1,2)],a=Bo(vc(Je,0),r)+Je[Ii(0,2)],l=Bo(vc(Je,1),r)+Je[Ii(1,2)];n=-(n+a)/(o+l),Je[Ii(0,0)]+=Je[Ii(1,0)]*n,Je[Ii(0,1)]+=Je[Ii(1,1)]*n,Je[Ii(0,2)]+=Je[Ii(1,2)]*n,n=1/(Bo(vc(Je,0),i)+Je[Ii(0,2)]),o=1/(Bo(vc(Je,1),i)+Je[Ii(1,2)]),Je[Ii(0,0)]*=n,Je[Ii(0,1)]*=n,Je[Ii(0,2)]*=n,Je[Ii(1,0)]*=o,Je[Ii(1,1)]*=o,Je[Ii(1,2)]*=o,Je[Ii(2,0)]=Je[Ii(1,0)],Je[Ii(2,1)]=Je[Ii(1,1)],Je[Ii(2,2)]=Je[Ii(1,2)],Je[Ii(1,2)]+=1,n=Bo(vc(Je,1),e)+Je[Ii(1,2)],o=Bo(vc(Je,2),e)+Je[Ii(2,2)],a=Bo(vc(Je,1),i)+Je[Ii(1,2)],l=Bo(vc(Je,2),i)+Je[Ii(2,2)],n=-.5*(n/o+a/l),Je[Ii(1,0)]+=Je[Ii(2,0)]*n,Je[Ii(1,1)]+=Je[Ii(2,1)]*n,Je[Ii(1,2)]+=Je[Ii(2,2)]*n,n=Bo(vc(Je,1),e)+Je[Ii(1,2)],o=Bo(vc(Je,2),e)+Je[Ii(2,2)],a=-o/n,Je[Ii(1,0)]*=a,Je[Ii(1,1)]*=a,Je[Ii(1,2)]*=a,s[0]=Je[0],s[1]=Je[1],s[2]=0,s[3]=Je[2],s[4]=Je[3],s[5]=Je[4],s[6]=0,s[7]=Je[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=Je[6],s[13]=Je[7],s[14]=0,s[15]=Je[8]}function Cyt(t,e,i,r,s){const n=1/Gh[0][3],o=1/Gh[4][3];jt(n<o);let a=n+Math.sqrt(n*o);const l=Math.sin(Za(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,Tyt(Gh,a,l,nfe,ofe,Syt,afe,lfe),Eyt(nfe,ofe,afe,lfe,s.projectionMatrix),s.projectionMatrix[10]=2/(i-r),s.projectionMatrix[14]=-(i+r)/(i-r)}function $yt(t){let{near:e,far:i}=t;return e<2&&(e=2),i<2&&(i=2),e>=i&&(e=2,i=4),{near:e,far:i}}let dfe=class extends Bi{constructor(e,i){super(e,i,new Fi(Lmt,()=>V(()=>Promise.resolve().then(()=>MGt),void 0)))}initializePipeline(e){return e.hasAlpha?_i({blending:Od,colorWrite:Ai}):_i({colorWrite:Ai})}},X3e=class extends ou{constructor(){super(...arguments),this.hasAlpha=!1}};u([te()],X3e.prototype,"hasAlpha",void 0);let Wse=class extends ar{constructor(){super(...arguments),this.overlayIndex=In.INNER,this.opacity=1}};function K3e(){const t=new ki;return t.include(ea),t.fragment.uniforms.add(new $t("tex",e=>e.texture)),t.fragment.uniforms.add(new Jb("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new pt("opacity",e=>e.opacity)),t.fragment.main.add(E`vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;`),t}const Ayt=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:Wse,build:K3e},Symbol.toStringTag,{value:"Module"}));let pfe=class extends Bi{constructor(e,i){super(e,i,new Fi(Ayt,()=>V(()=>Promise.resolve().then(()=>OGt),void 0)))}},Qf=class extends BD{constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new Wse,this.hasHighlights=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new Jt,this._passParameters=new Nse,this._materials=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new jr,this.events=new ws,this.longitudeCyclical=null,this.produces=new Map([[be.DRAPED_MATERIAL,i=>i!==Y.Highlight||this.hasHighlights],[be.DRAPED_WATER,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const e=this._view,i=e._stage,r=i.renderer.fboCache,{waterTextures:s,textures:n}=i.renderView;this._renderContext=new J3e(this._rctx,new qse(r,e.state.viewingMode)),this.addHandles([H(()=>s.updating,()=>this.events.emit("content-changed"),St),H(()=>this.spatialReference,l=>this._localOriginFactory=new Y3e(l),St),io(()=>e.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0),H(()=>Jmt(e.state.highlights),()=>this._sortedDrapeSourceRenderersDirty=!0,Nt),H(()=>e.state.highlights,l=>{this._bindParameters.highlights=l,this._bindParameters.highlightOrderMap=e.state.highlightOrderMap,this._updateHighlights()},Nt),e.resourceController.scheduler.registerTask(at.STAGE,this)]),this._materials=new x3e(n,this._techniques,()=>{this.notifyChange("rendersOccludedDraped"),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed"));const{_bindParameters:o,_camera:a}=this;a.near=1,a.far=1e4,a.relativeElevation=null,o.slot=be.DRAPED_MATERIAL,o.mainDepth=null,o.camera=a,o.oitPass=bi.NONE,o.updateLighting([new Ase(Ote())],0,0,Nx.Immediate)}destroy(){this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._passParameters.texture=Rt(this._passParameters.texture),this.disposeOverlays()}get _bindParameters(){return this._renderContext.bind}get _rctx(){return this._stage.renderView.renderingContext}get _view(){return this.parent.view}get _stage(){return this.parent.view._stage}get spatialReference(){return this.parent.spatialReference}get _techniques(){return this._stage.renderView.techniques}get rctx(){return this._rctx}get materials(){return this._materials}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}get pluginContext(){return this._pluginContext}initializeRenderContext(e){this._pluginContext=e,this._techniques.precompile(pfe)}uninitializeRenderContext(){}acquireTechniques(){return[]}render(){}get updating(){return this._sortedDrapeSourceRenderersDirty||vm(this._renderers,e=>e.updating)}get hasOverlays(){return this._overlays!=null&&this._renderTargets!=null}getMaterialRenderer(e){for(const i of this._renderers.values()){const r=i.getMaterialRenderer(e);if(r)return r}return null}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map(e=>e.drapeSource.layer).filter(e=>!!e)}_updateHighlights(){const e=this._view.state;this._renderers.forEach(i=>i.updateHighlights(e.highlightOrderMap))}createDrapeSourceRenderer(e,i,r){const s=this._renderers.get(e);s?.destroy();const n=new i({...r,rendererContext:this,drapeSource:e});return this._renderers.set(e,n),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles(H(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),n}removeDrapeSourceRenderer(e){if(e==null)return;const i=this._renderers.get(e);i!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),i.destroy())}computeValidity(){return this._renderTargets?.computeValidity()??0}releaseRenderTargets(){this._renderTargets?.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&hR(e,i=>i.drapeTargetType===$J.WithoutRasterImage)}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=hR(e,i=>i.drapeSourceType===q2.Features),this._hasDrapedRasterSource=hR(e,i=>i.drapeSourceType===q2.RasterImage)):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,i,r=this._bindParameters.overlayStretch){this._overlays==null&&(this._renderTargets=new Qft(this._stage.renderer.fboCache),this._overlays=[new $pe,new $pe]),this.ensureDrapeTargets(e),this.ensureDrapeSources(i),this._bindParameters.overlayStretch=r}disposeOverlays(){this._overlays=null,this._renderTargets=Rt(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){if(e!=null)return e===ir.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?this._renderTargets?.getTexture(ir.Color):this._renderTargets?.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,i){let r=!1;for(const[s,n]of this._renderers){if(e.done)break;(s.destroyed||i(s))&&n.commitChanges(this._view.state.highlightOrderMap)&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=vm(this._renderers,s=>s.hasHighlights),this.notifyChange("rendersOccludedDraped"))}hasHighlightOptions(e){return vm(this._renderers,i=>i.hasHighlightOptions(e))}processSyncDrapeSources(){this._processDrapeSources(Wc,e=>e.updatePolicy===cb.SYNC)}get isEmpty(){return!bs.OVERLAY_DRAW_DEBUG_TEXTURE&&!vm(this._renderers,e=>!e.isEmpty)}get hasWater(){const e=vm(this._renderers,i=>i.hasWater);return e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water")),this._hasWater}get rendersOccludedDraped(){const e=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=kR,++this._techniques.precompiling;const i=this._sortedRenderers.some(({renderer:r})=>r.precompile(this._renderContext));return--this._techniques.precompiling,this._renderContext.renderOccludedMask=e,i}renders(e){if(bs.OVERLAY_DRAW_DEBUG_TEXTURE&&e!==ir.Occluded&&e!==ir.Highlight)return!0;++this._techniques.precompiling;const i=this._sortedRenderers.some(({renderer:r})=>r.precompile(this._renderContext));return--this._techniques.precompiling,i}get mode(){return this.isEmpty?Em.Disabled:this.hasWater&&this.renders(ir.WaterNormal)?Em.EnabledWithWater:this._renderTargets?.getTexture(ir.Color)?Em.Enabled:Em.Disabled}updateAnimation(e){let i=!1;return this._renderers.forEach(r=>i=r.updateAnimation(e)||i),i&&this.parent.requestRender(bt.BACKGROUND),i}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}precompileShaders(e){if(this._renderTargets){this._bindParameters.alignPixelEnabled=e.alignPixelEnabled,++this._techniques.precompiling;for(const i of this._renderTargets.targets){if(i.content===ir.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const r=i.output;this._renderContext.output=r,this._bindParameters.slot=r===Y.Normal?be.DRAPED_WATER:be.DRAPED_MATERIAL,i.content===ir.Occluded&&(this._renderContext.renderOccludedMask=kR),this._sortedRenderers.forAll(({drapeSource:s,renderer:n})=>{i.content===ir.ColorNoRasterImage&&s.drapeSourceType===q2.RasterImage||n.precompile(this._renderContext)}),this._renderContext.renderOccludedMask=kC}--this._techniques.precompiling}}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const i of this._overlays)this.longitudeCyclical?i.setupGeometryViewsCyclical(this.longitudeCyclical):i.setupGeometryView();this._bindParameters.alignPixelEnabled=e.alignPixelEnabled;for(const i of this._renderTargets.targets){if(i.content===ir.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const r=this._drawTarget(In.INNER,i),s=this._drawTarget(In.OUTER,i);(r||s)&&i.fbo.generateMipMap()}}}_drawTarget(e,i){const r=this._overlays[e],s=r.canvasGeometries;if(s.numViews===0)return!1;const n=this._view.state.contentPixelRatio;this._screenToWorldRatio=n*r.mapUnitsPerPixel/this._bindParameters.overlayStretch;const o=i.output;if(this.isEmpty||o===Y.Normal&&!this.hasWater||!r.hasSomeSizedView())return!1;const{_rctx:a,_camera:l,_renderContext:c,_bindParameters:h}=this;if(l.pixelRatio=r.pixelRatio*n,c.output=o,h.screenToWorldRatio=this._screenToWorldRatio,h.screenToPCSRatio=this._screenToWorldRatio*this.parent.worldToPCSRatio,h.slot=o===Y.Normal?be.DRAPED_WATER:be.DRAPED_MATERIAL,i.content===ir.Occluded&&(c.renderOccludedMask=kR),!this.renders(i.content))return c.renderOccludedMask=kC,!1;const{resolution:d}=r,f=e===In.INNER?0:d;if(a.setViewport(f,0,d,d),this._bindTargetFBO(i),e===In.INNER&&(a.setClearColor(0,0,0,0),a.clear(Si.COLOR)),bs.OVERLAY_DRAW_DEBUG_TEXTURE&&i.content!==ir.Occluded&&i.content!==ir.Highlight){this._techniques.precompile(dfe,zJ);const m=this._techniques.get(dfe,zJ);for(let y=0;y<s.numViews;y++)this._setViewParameters(s.extents[y],r),this._ensureDebugPatternResources(r.resolution,Oyt[e]),a.bindTechnique(m,h,this._passParameters),a.screen.draw()}if(i.output===Y.Highlight){const{fboCache:m}=this._stage.renderer,y=this._resolution;this._bindTargetFBO(i),w3e(a,m,{width:y,height:y},h,()=>this._renderAllGeometry(e,i),f)}else this._renderAllGeometry(e,i);return a.bindFramebuffer(null),c.renderOccludedMask=kC,!0}_renderAllGeometry(e,i){const r=this._overlays[e],s=r.canvasGeometries;this._sortedRenderers.forAll(({drapeSource:n,renderer:o})=>{if(i.content===ir.ColorNoRasterImage&&n.drapeSourceType===q2.RasterImage)return;const{fullOpacity:a}=n,l=a!=null&&a<1&&i.output===Y.Color&&this._bindTemporaryFBO();for(let c=0;c<s.numViews;c++)this._setViewParameters(s.extents[c],r),o.render(this._renderContext);if(l){this._bindTargetFBO(i),this._overlayParameters.texture=l.getTexture(),this._overlayParameters.opacity=a,this._overlayParameters.overlayIndex=e;const c=this._techniques.get(pfe);this._rctx.bindTechnique(c,this._bindParameters,this._overlayParameters),this._rctx.screen.draw(),l.release()}})}_bindTargetFBO(e){const i=this._resolution,r=2*i;e.fbo.bind(this._rctx,r,i)}_bindTemporaryFBO(){const e=this._resolution,i=2*e,r=this._stage.renderer.fboCache,s=r.acquire(i,e,"overlay tmp");return r.rctx.bindFramebuffer(s.fbo),r.rctx.clear(Si.COLOR),s}get _resolution(){return this._overlays?.[In.INNER].resolution??0}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,i,r,s){this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let n=0;for(const{renderer:o}of this._sortedRenderers)n=o.intersect?.(e,i,r,s,n)??n}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this._view.map.allLayers,i=e.length;this._renderers.forEach((r,s)=>{const n=e.indexOf(s.layer),o=n>=0,a=s.renderGroup??(o?WU.MapLayer:WU.ViewLayer),l=i*a+(o?n:0);this._sortedRenderers.push(new Myt(s,r,l))}),this._sortedRenderers.sort((r,s)=>r.index-s.index)}_setViewParameters(e,i){const r=this._camera;r.viewport=[0,0,i.resolution,i.resolution],P2e(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),Zte(r.viewMatrix,[-e[0],-e[1],0])}_ensureDebugPatternResources(e,i){if(se(this._passParameters.color,i[0],i[1],i[2]),this._passParameters.texture)return;const r=new Uint8Array(e*e*4);let s=0;for(let o=0;o<e;o++)for(let a=0;a<e;a++){const l=Math.floor(a/10),c=Math.floor(o/10);l<2||c<2||10*l>e-20||10*c>e-20?(r[s++]=255,r[s++]=255,r[s++]=255,r[s++]=255):(r[s++]=255,r[s++]=255,r[s++]=255,r[s++]=1&l&&1&c?1&a^1&o?0:255:1&l^1&c?0:128)}const n=new $r(e);n.samplingMode=di.NEAREST,this._passParameters.texture=new yi(this._rctx,n,r)}get test(){}};u([p()],Qf.prototype,"hasHighlights",void 0),u([p()],Qf.prototype,"_sortedDrapeSourceRenderersDirty",void 0),u([p({constructOnly:!0})],Qf.prototype,"parent",void 0),u([p({readOnly:!0})],Qf.prototype,"_techniques",null),u([p({type:Boolean,readOnly:!0})],Qf.prototype,"updating",null),u([p()],Qf.prototype,"isEmpty",null),u([p({readOnly:!0})],Qf.prototype,"rendersOccludedDraped",null),Qf=u([A("esri.views.3d.terrain.OverlayRenderer")],Qf);let Myt=class{constructor(e,i,r){this.drapeSource=e,this.renderer=i,this.index=r}};const Oyt=[[1,.5,.5],[.5,.5,1]],Iyt=-2,kR=Er.OccludeAndTransparent,zJ=new X3e;zJ.hasAlpha=!0;function Q3e(t,e,i,r){const s=Dse(t.rings,!!t.hasZ&&r.mode!=="on-the-ground",G$.CCW_IS_HOLE,t.spatialReference),n=oc(s.position.length),o=Jlt(s.position,t.spatialReference,0,n,0,s.position,0,s.position.length/3,e,i,r),a=o!=null;return new Dyt(s.position,n,tDe(s.polygons,s.position,n),eDe(s.outlines,s.position,n),a,o)}function Bei(t,e){const i=Dse(t.rings,!1,G$.CCW_IS_HOLE),r=Bn(i.position,t.spatialReference,0,i.position,e,0);for(let s=2;s<i.position.length;s+=3)i.position[s]=Iyt;return{position:i.position,polygons:tDe(i.polygons,i.position),outlines:eDe(i.outlines,i.position),projectionSuccess:r}}function eDe(t,e,i=null){return t.filter(({count:r})=>r>1).map(({index:r,count:s})=>{const n=3*r,o=3*s;return i!=null?new iDe(r,s,Ix(e,n,o),Ix(i,n,o)):new Zse(r,s,Ix(e,n,o))})}function tDe(t,e,i=null){const r=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of t){if(n<=1)continue;const l=3*s,c=3*n,h=o.map(f=>f-s),d=i!=null?new Ryt(s,n,Ix(e,3*s,3*n),Ix(i,l,c),h,a):new Pyt(s,n,Ix(e,3*s,3*n),h,a);r.push(d)}return r}let Zse=class{constructor(e,i,r){this.index=e,this.count=i,this.position=r}},iDe=class extends Zse{constructor(e,i,r,s){super(e,i,r),this.mapPositions=s}},Ryt=class extends iDe{constructor(e,i,r,s,n,o){super(e,i,r,s),this.holeIndices=n,this.pathLengths=o}},Pyt=class extends Zse{constructor(e,i,r,s,n){super(e,i,r),this.holeIndices=s,this.pathLengths=n}},Dyt=class{constructor(e,i,r,s,n,o){this.position=e,this.mapPositions=i,this.polygons=r,this.outlines=s,this.projectionSuccess=n,this.sampledElevation=o}};function Yse(t){return t.mapPositions!=null}function Rb(t,e,i,r,s,n=2){const o=1/(Math.abs(i)+Math.abs(r)+Math.abs(s)),a=i*o,l=r*o,c=s<=0?(a>=0?1:-1)*(1-Math.abs(l)):a,h=s<=0?(l>=0?1:-1)*(1-Math.abs(a)):l,d=e*n;t[d]=ffe(c),t[d+1]=ffe(h)}function Lyt(t){const e=t.length/3,i=new Int16Array(2*e);let r=0;for(let s=0;s<e;++s)Rb(i,s,t[r++],t[r++],t[r++]);return i}function Wei(t,e){const i=t.length/3,r=new Int16Array(2*i);let s=0;const n=$();for(let o=0;o<i;++o)n[0]=t[s++],n[1]=t[s++],n[2]=t[s++],ac(n,n,e),Rb(r,o,n[0],n[1],n[2]);return r}function Nyt(t,e,i,r=2){const s=i*r,n=mfe(e[s]),o=mfe(e[s+1]),a=1-Math.abs(n)-Math.abs(o);t[2]=a,a<0?(t[0]=(n>=0?1:-1)*(1-Math.abs(o)),t[1]=(o>=0?1:-1)*(1-Math.abs(n))):(t[0]=n,t[1]=o),ae(t,t)}function ffe(t){return ce(Math.round(32767*t),-32767,32767)}function mfe(t){return ce(t/32767,-1,1)}const Fyt=["polygon","extent"];let Zei=class extends QPe{constructor(e,i,r,s){super(e,i,r,s),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const c=dct(this._getSymbolSize());if(c)throw new U("graphics3dextrudesymbollayer:invalid-size",c)}const e=this.symbolLayer?.material?.color,i=this._getCombinedOpacityAndColor(e),r=p$(i),s=i[3],n=s<1||this.needsDrivenTransparentPass,o=this.symbolLayer?.material?.emissiveFactor,a=o?IAe(is(o)):on,l={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:r,ambient:r,opacity:s,transparent:n,cullFace:n?Tl.None:Tl.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,emissiveFactor:a,offsetTransparentBackfaces:!0,normalType:Fr.Compressed};this._materials[Lu.Main]=new qU(l,this._context),this._materials[Lu.Bottom]=new qU({...l,cullFace:Tl.Back},this._context),this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,Fyt,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(i);return this._createAs3DShape(i,e.renderingInfo,r,s,i.uid)}layerOpacityChanged(e,i){const r=this.symbolLayer?.material?.color,s=this._getCombinedOpacity(r),n=s<1||this.needsDrivenTransparentPass;this._materials[Lu.Main]?.setParameters({opacity:s,transparent:n}),this._materials[Lu.Bottom]?.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();e.forEach(a=>i(a)?.layerOpacityChanged(o,this._context.isAsync))}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,Ede)}slicePlaneEnabledChanged(e,i){return this._materials[Lu.Main]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[Lu.Bottom]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(r=>{const s=i(r);s?.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0};return this._materials[Lu.Main]?.setParameters(e),this._materials[Lu.Bottom]?.setParameters(e),!0}_getExtrusionSize(e){let i;return i=e.size&&this._drivenProperties.size?Zlt(e.size,2)??0:this._getSymbolSize(),i/=this._context.renderCoordsHelper.unitInMeters,i}applyRendererDiff(e,i){return this._drivenPropertiesChanged(i)?Yy.RecreateSymbol:Yy.RecreateGraphics}async queryForSnapping(e,i,r,s){const n=this._getExtrusionSize(r)*this._context.renderCoordsHelper.unitInMeters/Yx(i),{objectId:o,target:a}=e,l=q(a);switch(l.z=(l.z??0)+n,e.type){case"edge":{const{start:c,end:h}=e,d=q(c),f=q(h);return d.z=(d.z??0)+n,f.z=(f.z??0)+n,[xde(o,l,1/0,d,f)]}case"vertex":return[Dlt(o,l,1/0),xde(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,i,r,s,n){const o=Gft(e.geometry);if(o==null)return null;if(o.rings.length===0||!o.rings.some(D=>D.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=Q3e(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=Ij(o);if(l==null)return null;const c=new Array,h=new Array,d=ch(),f=Ve(),m=$(),y=this._context.renderCoordsHelper.viewingMode===Be.Global;y||this._context.renderCoordsHelper.worldUpAtPosition(null,m),VS(o.spatialReference,[l.x,l.y,0],f,this._context.renderCoordsHelper.spatialReference);const v=Ve();Sl(v,f);const _=xs();Iie(_,v);const{polygons:b,mapPositions:w,position:x}=a,S=new Map,C=this._materials[Lu.Main];for(const D of b){const F=D.count;if(this._context.clippingExtent&&(rXe(D.mapPositions,d),!uXe(d,this._context.clippingExtent)))continue;const L=L$(D.mapPositions,D.holeIndices,3);if(L.length===0)continue;const N=L.length,R=6*F,k=e3(R+N),W=e3(N),G=oc(3*R),j=oc(3*R),re=oc(3*R),ve=oc(R);rDe(x,w,L,D,G,re,j,ve,k,W,this._getExtrusionSize(i),m,y),$j(G,G,v);const xe=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),De=new qyt(G,re,Lyt(j),ve),Ke=gfe(C,k,k.length-W.length,De,r,xe),je=F,ft=F,At=2*D.count,ti=new Wyt(je,ft,At,N/3);sDe(Ke,ti,f),S.set(Ke,ti),c.push(Ke,gfe(this._materials[Lu.Bottom],W,0,De,r,xe)),h.push(De.heights)}if(c.length===0)return null;const T=new Use({geometries:c,layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0});T.transformation=f;const M=Uht(this.symbolLayer,{opacity:this._getLayerOpacity()}),I=M?new mct(this._materials[Lu.Main],M,this._context.slicePlaneEnabled):null,P=new Cre(this,T,c,null,null,(D,F,L,N,R)=>Uyt(D,F,L,N,R,h,S),s,I);return P.alignedSampledElevation=a.sampledElevation,P.needsElevationUpdates=Ede(s.mode),P}};function gfe(t,e,i,r,s,n){const o=OD(e.length),a=[[z.POSITION,new Wt(r.positions,e,3,!0)],[z.NORMALCOMPRESSED,new Wt(r.normals,e,2,!0)],[z.COLOR,new Wt(s,o,4,!0)]];return new Ea(t,a,r.elevation,Nn.Mesh,n,i)}function rDe(t,e,i,r,s,n,o,a,l,c,h,d,f){{const m=i.length/3,y=2*r.count;kyt(t,e,r.index,r.count,i,0,m,s,n,o,a,l,c,y,h,d,f)}{let m=0,y=2*r.count,v=0;const _=r.pathLengths[0];yfe(s,n,a,o,m,_,r.count,y,l,v,h),y+=4*_,v+=2*_,m+=_;for(let b=1;b<r.pathLengths.length;++b){const w=r.pathLengths[b];yfe(s,n,a,o,m,w,r.count,y,l,v,h),y+=4*w,v+=2*w,m+=w}}}function kyt(t,e,i,r,s,n,o,a,l,c,h,d,f,m,y,v,_){ne(Cu,v);{const b=y>0?1:-1;let w=3*i,x=0,S=3*x,C=r,T=3*C;for(let M=0;M<r;++M){const I=t[w],P=t[w+1],D=t[w+2];_&&(Cu[0]=I,Cu[1]=P,Cu[2]=D,ae(Cu,Cu)),a[S+0]=I,a[S+1]=P,a[S+2]=D;const F=e[w+0],L=e[w+1],N=e[w+2];l[S+0]=F,l[S+1]=L,l[S+2]=N,c[S+0]=-b*Cu[0],c[S+1]=-b*Cu[1],c[S+2]=-b*Cu[2],h[x]=0,a[T+0]=I+y*Cu[0],a[T+1]=P+y*Cu[1],a[T+2]=D+y*Cu[2],l[T+0]=F,l[T+1]=L,l[T+2]=N,h[C]=y,S+=3,T+=3,w+=3,x+=1,C+=1}}{let b=3*n,w=0,x=3*m;const S=y<0?Sfe:xfe,C=y<0?xfe:Sfe;for(let T=0;T<o;++T)f[w]=s[b+S[0]],f[w+1]=s[b+S[1]],f[w+2]=s[b+S[2]],d[x]=s[b+C[0]]+r,d[x+1]=s[b+C[1]]+r,d[x+2]=s[b+C[2]]+r,w+=3,x+=3,b+=3}}function IN(t,e,i,r,s,n,o){r[n]=r[o],o*=3,t[n*=3]=t[o],t[n+1]=t[o+1],t[n+2]=t[o+2],e[n]=e[o],e[n+1]=e[o+1],e[n+2]=e[o+2],i[n]=s[0],i[n+1]=s[1],i[n+2]=s[2]}const OM=$();function yfe(t,e,i,r,s,n,o,a,l,c,h){let d=s,f=s+1,m=s+o,y=s+o+1,v=a,_=a+1,b=a+2*n,w=a+2*n+1;h<0&&(d=s+o+1,y=s);let x=3*c;for(let S=0;S<n;++S)S===n-1&&(f=s,h>0?y=s+o:d=s+o),zyt(t,d,f,m,OM),IN(t,e,r,i,OM,v,d),IN(t,e,r,i,OM,_,f),IN(t,e,r,i,OM,b,m),IN(t,e,r,i,OM,w,y),l[x]=v,l[x+1]=b,l[x+2]=w,l[x+3]=v,l[x+4]=w,l[x+5]=_,x+=6,d++,f++,m++,y++,v+=2,_+=2,b+=2,w+=2}const u8=$(),vfe=$(),_fe=$(),bfe=$(),wfe=$();function zyt(t,e,i,r,s){e*=3,i*=3,r*=3,se(u8,t[e++],t[e++],t[e++]),se(vfe,t[i++],t[i++],t[i++]),se(_fe,t[r++],t[r++],t[r++]),ye(bfe,vfe,u8),ye(wfe,_fe,u8),lt(s,wfe,bfe),ae(s,s)}const DT=$();function Uyt(t,e,i,r,s,n,o){const a=t.stageObject,l=a.geometries,c=l.length,h=e.mode!=="absolute-height";let d=0;const f=a.transformation,m=Wte(Ve(),f);for(let y=0;y<c;y+=2){const v=l[y];if(!Yse(v))continue;const _=v.getMutableAttribute(z.POSITION).data,b=n[y/2],w=new DIe(v.mapPositions),x=_.length/3;let S=!1,C=0;{let T=0;for(let M=0;M<x;M++){DT[0]=_[T],DT[1]=_[T+1],DT[2]=_[T+2],r(w,RN),h&&(C+=RN.sampledElevation),bs.TESTS_DISABLE_OPTIMIZATIONS?(se(dl,w.array[w.offset],w.array[w.offset+1],RN.z+b[T/3]),i!=null&&s.toRenderCoords(dl,i,dl),st(dl,dl,m)):(se(dl,_[T],_[T+1],_[T+2]),st(dl,dl,f),s.setAltitude(dl,RN.z+b[T/3]),st(dl,dl,m)),_[T]=dl[0],_[T+1]=dl[1],_[T+2]=dl[2];const I=Byt/s.unitInMeters;(Math.abs(DT[0]-_[T])>=I||Math.abs(DT[1]-_[T+1])>=I||Math.abs(DT[2]-_[T+2])>=I)&&(S=!0),w.offset+=3,T+=3}}if(S){const T=o.get(v);T&&sDe(v,T,f),a.geometryVertexAttributeUpdated(l[y],z.NORMALCOMPRESSED),v.invalidateBoundingInfo(),a.geometryVertexAttributeUpdated(l[y],z.POSITION),l[y+1].invalidateBoundingInfo(),a.geometryVertexAttributeUpdated(l[y+1],z.POSITION)}d+=C/x}return d/c}function sDe(t,e,i){const r=t.getMutableAttribute(z.POSITION),s=t.getMutableAttribute(z.NORMALCOMPRESSED).data,{topVertexStart:n,topVertexCount:o,topFaceStart:a,topFaceCount:l}=e,c=r.data,h=o,d=t.attributes.get(z.POSITION).indices,f=a+l,m=n+o,y=oc(3*h);for(let S=0;S<h;++S){const C=3*S;y[C+0]=0,y[C+1]=0,y[C+2]=0}const v=Vyt,_=jyt,b=Gyt,w=Hyt,x=Cu;for(let S=a;S<f;++S){const C=3*S;for(let T=0;T<3;++T){const M=d[C+T];w[T]=M;const I=3*M;se(dl,c[I+0],c[I+1],c[I+2]),st(v[T],dl,i)}Ri(_,v[1],v[0]),Ri(b,v[2],v[0]),lt(x,_,b),ae(x,x);for(let T=0;T<3;++T){const M=3*(w[T]-n);y[M+0]+=x[0],y[M+1]+=x[1],y[M+2]+=x[2]}}for(let S=n;S<m;++S){const C=3*(S-n),T=y[C+0],M=y[C+1],I=y[C+2],P=Math.sqrt(T*T+M*M+I*I);Rb(s,S,T/P,M/P,I/P)}}const dl=$(),Cu=$(),RN=new Ere,xfe=[0,2,1],Sfe=[0,1,2],Byt=.01,Vyt=[$(),$(),$()],jyt=$(),Gyt=$(),Hyt=[0,0,0];var Lu;(function(t){t[t.Main=0]="Main",t[t.Bottom=1]="Bottom"})(Lu||(Lu={}));let qyt=class{constructor(e,i,r,s){this.positions=e,this.elevation=i,this.normals=r,this.heights=s}},Wyt=class{constructor(e,i,r,s){this.topVertexStart=e,this.topVertexCount=i,this.topFaceStart=r,this.topFaceCount=s}},Jse=class extends ar{};function nDe(){const t=new ki;return t.include(ea),t.outputs.add("fragColor","vec4",0),t.fragment.uniforms.add(new $t("colorTexture",e=>e.color),new $t("focusArea",e=>e.focusArea),new Jb("focusAreaEffectMode",e=>e.effect??1)).main.add(E`float mask = texture( focusArea, uv, 0.0 ).r;
vec4 color = texture( colorTexture, uv, 0.0 );
vec4 colorDeSaturate = vec4(color.r * 0.25 + color.g * 0.5 + color.b * 0.25);
if (focusAreaEffectMode == 1) {
fragColor = mask > 0.0 ? color : 0.55 * colorDeSaturate + 0.45;
} else {
fragColor = mask > 0.0 ? color : 0.33 * mix(color, colorDeSaturate, 0.);
}`),t}const Zyt=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaColorPassParameters:Jse,build:nDe},Symbol.toStringTag,{value:"Module"}));let Tfe=class extends Bi{constructor(e,i){super(e,i,new Fi(Zyt,()=>V(()=>Promise.resolve().then(()=>IGt),void 0)))}initializePipeline(){return _i({colorWrite:Ai})}},zE=class extends xf{constructor(e){super({...e,view:e.focusAreas.view}),this.consumes={required:[tr.COMPOSITE,ut.FOCUSAREA]},this.produces=tr.COMPOSITE,this._passParameters=new Jse}precompile(){this.techniques.precompile(Tfe)}render(e){const i=this.techniques.get(Tfe),r=e.find(({name:d})=>d===tr.COMPOSITE);if(!i.compiled)return this.requestRender(),r;const s=this.bindParameters,n=s.camera,o=n.fullViewport[2],a=n.fullViewport[3],l=e.find(({name:d})=>d===ut.FOCUSAREA),c=this.fboCache.acquire(o,a,this.produces),h=this.renderingContext;return h.gl.clear(h.gl.STENCIL_BUFFER_BIT),h.bindFramebuffer(c.fbo),this._passParameters.color=r.getTexture(),this._passParameters.focusArea=l.getTexture(),this._passParameters.effect=Yyt[this.focusAreas.style],h.bindTechnique(i,s,this._passParameters),h.screen.draw(),c.attachDepth(r.getAttachment(this.gl.DEPTH_STENCIL_ATTACHMENT)),c}};var zR;u([p()],zE.prototype,"consumes",void 0),u([p()],zE.prototype,"produces",void 0),u([p({constructOnly:!0})],zE.prototype,"focusAreas",void 0),zE=u([A("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaColorNode")],zE),function(t){t[t.NONE=0]="NONE",t[t.BRIGHT=1]="BRIGHT",t[t.DARK=2]="DARK"}(zR||(zR={}));const Yyt={none:zR.NONE,bright:zR.BRIGHT,dark:zR.DARK};let Xse=class extends ar{constructor(){super(...arguments),this.origin=on}};function oDe(){const t=new ki;return t.attributes.add(z.POSITION,"vec3"),t.outputs.add("fragColor","vec4",0),t.vertex.uniforms.add(new Co("proj",e=>e.camera.projectionMatrix),new _se("view",(e,i)=>nh(Jyt,i.camera.viewMatrix,e.origin))).main.add(E`gl_Position = proj * view * vec4(position, 1.0);`),t.fragment.main.add(E`fragColor = vec4(1., 0., 0., 1.);`),t}const Jyt=Ve(),Xyt=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaMaskDrawParameters:Xse,build:oDe},Symbol.toStringTag,{value:"Module"}));let Efe=class extends Bi{constructor(e,i){super(e,i,new Fi(Xyt,()=>V(()=>Promise.resolve().then(()=>RGt),void 0)))}initializePipeline(){return _i({colorWrite:Ai,depthTest:{func:Ni.LEQUAL}})}},UE=class extends xf{constructor(e){super({...e,view:e.focusAreas.view}),this.consumes={required:[ut.FOCUSAREA,tr.TRANSPARENT]},this.produces=ut.FOCUSAREA,this._vaos=new Array,this._counts=new Array,this._origins=new Array,this._maskParameters=new Xse}initialize(){this.updateGeometries()}destroy(){this._vaos.forEach(e=>e.dispose()),this._vaos.length=this._counts.length=this._origins.length=0}precompile(){this.techniques.precompile(Efe)}render(e){const i=this.techniques.get(Efe),r=this.bindParameters,s=r.camera,n=s.fullViewport[2],o=s.fullViewport[3],a=this.fboCache.acquire(n,o,ut.FOCUSAREA,fr.RGBA);if(!i.compiled||!this._vaos)return this.requestRender(),a;const l=e.find(({name:d})=>d===tr.TRANSPARENT),c=this.renderingContext;a.attachDepth(l.getAttachment(this.gl.DEPTH_STENCIL_ATTACHMENT)),c.bindFramebuffer(a.fbo),c.clear(Si.COLOR|Si.STENCIL),c.setViewport(0,0,n,o),c.gl.clearStencil(0),c.gl.clear(c.gl.STENCIL_BUFFER_BIT),c.setClearStencil(0);const h=c.bindTechnique(i,r);c.setFaceCullingEnabled(!1),c.setStencilTestEnabled(!0),c.setStencilOpSeparate(Yu.FRONT,Yi.KEEP,Yi.INCR_WRAP,Yi.KEEP),c.setStencilOpSeparate(Yu.BACK,Yi.KEEP,Yi.DECR_WRAP,Yi.KEEP),c.setDepthWriteEnabled(!1);for(let d=0;d<this._vaos.length;d++){const f=this._vaos[d],m=this._counts[d];this._maskParameters.origin=this._origins[d],h.bindDraw(r,Xht,this._maskParameters),c.bindVAO(f),c.setStencilWriteMask(255),c.setStencilFunction(Ni.ALWAYS,0,255),c.setColorMask(!1,!1,!1,!1),c.drawArrays(Ui.TRIANGLES,0,m),c.setStencilWriteMask(0),c.setStencilFunction(Ni.NOTEQUAL,0,255),c.setColorMask(!0,!0,!0,!0),c.drawArrays(Ui.TRIANGLES,0,m)}return a}updateGeometries(){if(!this.view._stage)return;this._vaos.forEach(i=>i.dispose()),this._vaos.length=this._counts.length=this._origins.length=0;const e=this.focusAreas.geometries;for(const i of e){const r=new Array,s=i.indicesBottom;for(let l=0;l<s.length;l++)r.push(i.positions[3*(s[l]-1)]),r.push(i.positions[3*(s[l]-1)+1]),r.push(i.positions[3*(s[l]-1)+2]);const n=i.indicesExtruded;for(let l=0;l<n.length;l++)r.push(i.positions[3*n[l]]),r.push(i.positions[3*n[l]+1]),r.push(i.positions[3*n[l]+2]);const o=new Float32Array(r),a=new mg(this.renderingContext,hg,new Map([["geometry",Gmt]]),new Map([["geometry",Un.createVertex(this.renderingContext,Zs.STATIC_DRAW,o)]]));this._vaos.push(a),this._counts.push(s.length+n.length),this._origins.push(i.origin)}this.requestRender()}};u([p()],UE.prototype,"consumes",void 0),u([p()],UE.prototype,"produces",void 0),u([p({constructOnly:!0})],UE.prototype,"focusAreas",void 0),UE=u([A("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaMaskNode")],UE);let Kyt=class{constructor(e,i,r,s,n,o){this.positions=e,this.indicesBottom=i,this.indicesExtruded=r,this.height=s,this.origin=n,this.color=o}};var Cfe;(function(t){t[t.NONE=0]="NONE",t[t.BRIGHT=1]="BRIGHT",t[t.DARK=2]="DARK"})(Cfe||(Cfe={}));const Tw=0,Qyt=5e6,PN=.42,Ew=.32;function nti(t,e){if(t){if(e==="bright"){const i=(t[0]+t[1]+t[2])/3;return[i*Ew+(1-Ew),i*Ew+(1-Ew),i*Ew+(1-Ew),t[3]*Ew]}return e==="dark"?[t[0]*PN,t[1]*PN,t[2]*PN,t[3]*PN]:t}}let j0=class extends ue{constructor(e){super(e),this.style="dark",this.geometries=new Array,this._areas=new Ee,this._elevationContext=new RU}initialize(){this.addHandles([H(()=>this.style,()=>this._updateRenderNodes(),St)]),this.addHandles([H(()=>this.activePolygons,()=>this._updateFocusAreaGeometries(),St)])}get activePolygons(){const e=new Ee;for(const i of this.areas)if(i.enabled)for(const r of i.geometries)e.push(r);return e}add(e){this.areas.add(e),this._updateFocusAreaGeometries()}addMany(e){this.areas.addMany(e),this._updateFocusAreaGeometries()}remove(e){this.areas.remove(e),this._updateFocusAreaGeometries()}removeMany(e){this.areas.removeMany(e),this._updateFocusAreaGeometries()}removeAll(){this.areas.removeAll(),this._updateFocusAreaGeometries()}containsGeometry(e){let i=!0;const r=new ke(e);return i=this.areas.some(s=>!!s.enabled&&!!s?.geometries.length&&s.geometries.some(n=>n.contains(r))),i}get areas(){return this._areas}_updateFocusAreaGeometries(){this._extrudePolygons(),this._updateRenderNodes()}_extrudePolygons(){if(!this.view.renderCoordsHelper)return;this.geometries.length=0;const e=Qyt-Tw,i=$(),r=this.view.renderCoordsHelper.viewingMode===Be.Global,s=Ve(),n=Ve();r||this.view.renderCoordsHelper.worldUpAtPosition([0,0,0],i);for(const o of this.areas)if(o.enabled)for(const a of o.geometries){const l=Ij(a);if(l==null)continue;VS(a.spatialReference,[l.x,l.y,0],s,this.view.renderCoordsHelper.spatialReference);const c=ae(evt,[s[12]-Tw*i[0],s[13]-Tw*i[1],s[14]-Tw*i[2]]);n[12]=-s[12],n[13]=-s[13],n[14]=-s[14];const h=Q3e(a,this.view.elevationProvider,this.view.renderCoordsHelper,this._elevationContext),{polygons:d,mapPositions:f,position:m}=h;for(const y of d){const v=y.count,_=L$(y.mapPositions,y.holeIndices,3);if(_.length===0)continue;const b=_.length,w=6*v,x=e3(w+b),S=e3(b),C=oc(3*w),T=oc(3*w),M=oc(3*w),I=oc(w);rDe(m,f,_,y,C,M,T,I,x,S,e,i,r),$j(C,C,n);const P=new Kyt(C,S,x,e,[s[12]+Tw*c[0],s[13]+Tw*c[1],s[14]+Tw*c[2]],o.outline?.color);this.geometries.push(P)}}this._maskRenderNode?.updateGeometries()}_updateRenderNodes(){this.view._stage&&(this.style==="none"||this.geometries.length===0?(this._maskRenderNode=Ce(this._maskRenderNode),this._colorRenderNode=Ce(this._colorRenderNode)):(this._maskRenderNode??=new UE({focusAreas:this}),this._colorRenderNode??=new zE({focusAreas:this})))}};u([p()],j0.prototype,"activePolygons",null),u([p()],j0.prototype,"style",void 0),u([p()],j0.prototype,"geometries",void 0),u([p({constructOnly:!0})],j0.prototype,"view",void 0),u([p()],j0.prototype,"_areas",void 0),j0=u([A("esri.views.FocusAreas")],j0);const evt=$();function mc(t,e,i,r,s){return!(e==null||r==null||t.length<2)&&(IM.x=t[0],IM.y=t[1],IM.z=t[2],IM.spatialReference=e,pc(IM,i,r,s))}const IM=jS(0,0,0,Ae.WGS84);function HS(t,e,i){return!!mc(t,e,DN,i.spatialReference)&&(i.x=DN[0],i.y=DN[1],i.z=DN[2],!0)}async function aDe(t,e,i,r){return await lD(e,i.spatialReference,null,r),HS(t,e,i)}const DN=$();function lDe(t,e,i,r){return t.renderCoordsHelper.fromRenderCoords(e.eye,eB,r)!=null&&rHe(i,eB)}function lG(t,e){return t.elevationProvider?t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground")??0:0}function qS(t,e,i,r){const s=t.state.camera.clone();e&&i&&r&&(s.eye=e,s.center=i,s.up=r),tvt(t,s.ray,h0)||ne(h0,s.center);const n=t.state.constraints,o=n.minimumPoiDistance;if(ro(s.eye,h0)<o){const a=n.collision.enabled;ne(Cw,s.viewForward),ie(Cw,Cw,o),a?s.eye=ye(eB,h0,Cw):oe(h0,s.eye,Cw);const l=t.renderCoordsHelper,c=l.getAltitude(s.eye),h=n.collision.elevationMargin;a&&c<h&&(ye(Cw,h0,s.eye),s.eye=l.setAltitude(eB,h,s.eye),oe(h0,s.eye,Cw))}return s.center=h0,s}function $fe(t,e,i){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const r=lG(t,e),s=t.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(e,i,t.renderDataExtent,r,rvt),o=n*n;return ro(e,i)>o}function tvt(t,e,i){let r=Afe[t.viewingMode];r||(r=lh(t.state.viewingMode),r.options.backfacesTerrain=!t.state.isGlobal,r.options.invisibleTerrain=!0,Afe[t.viewingMode]=r);const{isGlobal:s}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,r,i)||$fe(t,e.origin,i))||!(!t.renderCoordsHelper.intersectManifold(e,0,i)||$fe(t,e.origin,i))||!!s&&ivt(e,i,gr(t.spatialReference).radius)}function ivt(t,e,i){const r=de(t.origin,t.origin)-i*i,s=r>0?Math.sqrt(r)/3:1;return ie(e,t.direction,s/Te(t.direction)),oe(e,e,t.origin),!0}const Afe={},eB=$(),h0=$(),Cw=$(),rvt={near:0,far:0};function svt(t,e){const i=[],r=[];return LN(i,t,e,$m.LEFT),LN(r,i,e,$m.BOTTOM),LN(i,r,e,$m.RIGHT),LN(r,i,e,$m.TOP),r}function LN(t,e,i,r){const s=nvt(i,r);if(t.length=0,e.length){s(NN,e[0],e[0])===Hu.INSIDE&&RM(t,e[0]);for(let n=0;n<e.length;n++){const o=e[n===e.length-1?0:n+1];switch(s(NN,e[n],o)){case Hu.INSIDE:RM(t,o);break;case Hu.INSIDE_OUT:RM(t,hU(NN));break;case Hu.OUTSIDE_IN:RM(t,hU(NN)),RM(t,o);case Hu.OUTSIDE:}}}}function RM(t,e){t.length!==0&&oj(t.at(-1),e)||t.push(e)}function nvt(t,e){const i=e===$m.LEFT||e===$m.RIGHT?0:1,r=t[e],s=e===$m.LEFT||e===$m.BOTTOM?Y2.MIN:Y2.MAX,n=i===0?1:0;return(o,a,l)=>{if(a[i]<r&&l[i]<r)return s===Y2.MIN?Hu.OUTSIDE:Hu.INSIDE;if(a[i]>r&&l[i]>r)return s===Y2.MIN?Hu.INSIDE:Hu.OUTSIDE;const c=(l[n]-a[n])/(l[i]-a[i]),h=a[n]+c*(r-a[i]);return o[i]=r,o[n]=h,(a[i]<r?1:-1)*s>0?Hu.OUTSIDE_IN:Hu.INSIDE_OUT}}var Y2,Hu,$m;(function(t){t[t.MIN=1]="MIN",t[t.MAX=-1]="MAX"})(Y2||(Y2={})),function(t){t[t.OUTSIDE=0]="OUTSIDE",t[t.INSIDE=1]="INSIDE",t[t.OUTSIDE_IN=2]="OUTSIDE_IN",t[t.INSIDE_OUT=3]="INSIDE_OUT"}(Hu||(Hu={})),function(t){t[t.LEFT=0]="LEFT",t[t.BOTTOM=1]="BOTTOM",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP"}($m||($m={}));const NN=He();let tB=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}get origin(){return this._origin}constructor(e){this.renderCoordsHelper=e,this.frustum=YU(),this._points=i3e(),this.lines=new Array(12),this._origin=$(),this._direction=$(),this._altitude=null;for(let i=0;i<12;i++)this.lines[i]={origin:null,direction:$(),endpoint:null}}update(e){r3e(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),ne(this._origin,e.eye),ne(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let i=0;i<this._points.length;i++)ne(this._points[i],e[i]);s3e(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return J_(this.frustum,e)}intersectsRay(e){return imt(this.frustum,e)}intersectsLineSegment(e,i){return rmt(this.frustum,e,i)}intersectsPoint(e){return W2(this.frustum,e)}_updateLines(){const e=this._points;for(let i=0;i<4;i++){const r=i+4;h8(this.lines[i],e[i],e[r]),h8(this.lines[i+4],e[i],i===3?e[0]:e[i+1]),h8(this.lines[i+8],e[r],i===3?e[4]:e[r+1])}}};var Py;function h8(t,e,i){t.origin=e,t.endpoint=i,kS(t.direction,e,i)}tB.planePointIndices=smt,tB.nearFarLineIndices=[[Vt.NEAR_BOTTOM_LEFT,Vt.FAR_BOTTOM_LEFT],[Vt.NEAR_BOTTOM_RIGHT,Vt.FAR_BOTTOM_RIGHT],[Vt.NEAR_TOP_RIGHT,Vt.FAR_TOP_RIGHT],[Vt.NEAR_TOP_LEFT,Vt.FAR_TOP_LEFT]],function(t){t[t.NEAR_FAR_BOTTOM_LEFT=0]="NEAR_FAR_BOTTOM_LEFT",t[t.NEAR_FAR_BOTTOM_RIGHT=1]="NEAR_FAR_BOTTOM_RIGHT",t[t.NEAR_FAR_TOP_RIGHT=2]="NEAR_FAR_TOP_RIGHT",t[t.NEAR_FAR_TOP_LEFT=3]="NEAR_FAR_TOP_LEFT",t[t.NEAR_BOTTOM=4]="NEAR_BOTTOM",t[t.NEAR_RIGHT=5]="NEAR_RIGHT",t[t.NEAR_TOP=6]="NEAR_TOP",t[t.NEAR_LEFT=7]="NEAR_LEFT",t[t.FAR_BOTTOM=8]="FAR_BOTTOM",t[t.FAR_RIGHT=9]="FAR_RIGHT",t[t.FAR_TOP=10]="FAR_TOP",t[t.FAR_LEFT=11]="FAR_LEFT"}(Py||(Py={}));const ovt=$(),FN=$();function Kse(){return{direction:$(),up:$()}}function cDe(t,e,i,r,s){let n=ae(ovt,t),o=de(n,r);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(de(e,r)),o<.99?(ne(n,e),a&&ie(n,n,-1)):n=null);let l=0;if(n){ie(FN,r,de(r,n)),ye(n,n,FN);const h=de(n,s)/(Te(n)*Te(s));lt(FN,n,s),l=(de(FN,r)>0?1:-1)*$o(Za(h))}const c=$o(Za(-de(r,t)/Te(t)));return i?(i.heading=l,i.tilt=c,i):{heading:l,tilt:c}}function uDe(t,e,i,r){ye(Mfe,i,e),NOe(r,SOe(e,Mfe),t)||t===i||ne(t,i)}const Mfe=$(),hDe=Le(0,1,0),dDe=Le(0,0,1),PM=Ve(),Rg=$(),Pg=$();function pDe(t,e,i,r=Kse()){const{direction:s,up:n}=r;return A2e(PM,-wt(e)),b$(PM,PM,wt(i)),st(s,dDe,PM),ie(s,s,-1),st(n,hDe,PM),r}function avt(t,e,i,r){return cDe(e,i,r,dDe,hDe)}function lvt(t,e,i,r){const s=pDe(t,i,r),n=$();return ie(n,s.direction,-e),oe(n,n,t),{up:s.up,eye:n,heading:i,tilt:r}}function cvt(t){return $o(t)}function uvt(t){return wt(t)}function hvt(t,e,i,r,s){const n=t.renderSpatialReference,o=t.spatialReference??e.spatialReference;return pc(e,Rg,n),pc(e,Pg,n),Rg[0]-=i/2,Pg[0]+=i/2,Rg[1]-=r/2,Pg[1]+=r/2,mc(Rg,n,Rg,o),mc(Pg,n,Pg,o),s?(s.xmin=Rg[0],s.ymin=Rg[1],s.xmax=Pg[0],s.ymax=Pg[1],s.spatialReference=o):s=new gi(Rg[0],Rg[1],Pg[0],Pg[1],o),s}function dvt(t,e){const i=t.frustum,{renderCoordsHelper:r}=t,s=r.getAltitude(e),n=t.spatialReference,o=t.state.camera.eye,a=[],l=i.planes[_o.FAR];for(let c=0;c<4;c++){const h=i.lines[c];r.intersectInfiniteManifold(mf(h.origin,h.direction),s,zp)||pvt(zp,i,r,h.endpoint,s),uDe(zp,o,zp,l),a.push(un(zp[0],zp[1]))}return fvt(svt(a,r.extent),r,n)}function pvt(t,e,i,r,s){const n=e.lines[Py.FAR_LEFT].direction,o=(s-i.getAltitude(r))/n[2];Xn(t,r,n,o)}function fvt(t,e,i){const r=t.map(s=>(se(zp,s[0],s[1],0),e.fromRenderCoords(zp,zp,i),[zp[0],zp[1]]));return r.length<=2?new Sa({spatialReference:i}):(r.push(r[0].slice()),U_(r)||r.reverse(),new Sa({rings:[r],spatialReference:i}))}const zp=$(),mvt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:avt,eyeForCenterWithHeadingTilt:lvt,eyeTiltToLookAtTilt:uvt,headingTiltToDirectionUp:pDe,lookAtTiltToEyeTilt:cvt,toArea:dvt,toExtent:hvt},Symbol.toStringTag,{value:"Module"}));function _v(t,e,i){t.worldUpAtPosition(e,Ofe),ye(d8,i,e);const r=Te(d8);return r===0?0:Za(de(d8,Ofe)/r)}const Ofe=$(),d8=$();function Ife(t,e,i){if(e.longitude==null||e.latitude==null||i.longitude==null||i.latitude==null)throw new Error("Invalid points: no lon/lat");return gvt(t,e.longitude,e.latitude,i.longitude,i.latitude)}function gvt(t,e,i,r,s){const n=wt(i),o=wt(s),a=n-o,l=wt(e)-wt(r),c=Math.sin(a/2),h=Math.sin(l/2),d=2*Td(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*h*h))*t;return Math.round(1e4*d)/1e4}function yvt(t,e,i){const r=e.spatialReference,s=gr(r),n=new ke(e.x,t.y,r),o=new ke(i.x,t.y,r),a=new ke(t.x,e.y,r),l=new ke(t.x,i.y,r);return{lon:Ife(s.radius,n,o),lat:Ife(s.radius,a,l)}}function vvt(t,e,i){const r=e/i,s=wt(t),n=Math.sin(r/2),o=Math.cos(s),a=2*Td(Math.sqrt(n*n/(o*o)));return $o(a)}function _vt(t,e){return t/15}function Rfe(t,e){const i=t?.[0];if(i==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=_vt(i);const r=e.hours%1;e.hours-=r,e.minutes=60*r;const s=e.minutes%1;return e.minutes-=s,e.seconds=Math.round(60*s),e}const fDe=Le(0,0,1),mDe=ae($(),Le(1,1,1)),bvt=new fb(-180,180),DM=Ve(),b_=$(),LT=$();function gDe(t,e,i,r=Kse()){lt(b_,t,fDe),de(b_,b_)===0&&lt(b_,t,mDe),Ad(DM,-wt(e),t),Wu(DM,DM,-wt(i),b_);const{up:s,direction:n}=r;return lt(s,b_,t),ae(s,s),st(s,s,DM),ae(n,t),wd(n,n),st(n,n,DM),r}function wvt(t,e,i,r){const s=b_,n=LT;return ae(s,t),lt(LT,s,fDe),de(LT,LT)===0&&lt(LT,s,mDe),lt(n,LT,s),cDe(e,i,r,s,n)}function xvt(t,e,i,r){const s={eye:$(),up:null,tilt:r,heading:i},n=b_;n[0]=t[0],n[1]=t[2],n[2]=-t[1];const o=e,a=wt(i),l=wt(r),c=Math.sin(a),h=Math.cos(a),d=Math.sin(l),f=Math.cos(l),m=Te(n);let y;if(Math.abs(l)<1e-8)y=o+m;else{const W=m/d,G=Td(o/W),j=Math.PI-l-G;y=W*Math.sin(j)}const v=f*o,_=o*o*(d*d),b=h*h*_,w=y-v,x=w*w,S=b*(b+x-n[1]*n[1]);if(S<0)return ie(s.eye,n,y/m),s.tilt=0,kN(s,t);const C=Math.sqrt(S),T=n[1]*w,M=b+x;let I;if(I=h>0?-C+T:C+T,Math.abs(M)<1e-8)return m<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):ie(s.eye,n,y/m),s.tilt=0,p8(s.eye),kN(s,t);s.eye[1]=I/M;const P=c*c*_,D=d*o,F=h*D*s.eye[1],L=s.eye[1]*s.eye[1],N=1-L,R=Math.sqrt(N),k=b*L+P-2*F*R*w+N*x;return Math.abs(k)<1e-8?(ie(s.eye,n,y/m),s.tilt=0,p8(s.eye),kN(s,t)):(s.eye[0]=(N*(y*n[0]-v*n[0])-D*R*(n[0]*s.eye[1]*h+n[2]*c))/k,s.eye[2]=(N*(y*n[2]-v*n[2])-D*R*(n[2]*s.eye[1]*h-n[0]*c))/k,ie(s.eye,s.eye,y),p8(s.eye),kN(s,t))}function p8(t){const e=t[1];t[1]=-t[2],t[2]=e}function kN(t,e){const i=gDe(e,t.heading,t.tilt);return t.up=i.up,t}function Svt(t,e,i){const r=Te(e),s=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-t)),n=Td(i/(s/Math.sin(t)));return $o(t-n)}function Tvt(t,e,i){const r=wt(t),s=Te(e);return Td(i/(s/Math.sin(r)))+r}function Evt(t,e,i,r,s){let n,o,a,l;const c=e.latitude,h=gr(t.spatialReference).radius,d=e.longitude,f=vvt(c,i,h)/2;n=d-f,o=d+f;const m=wt(c),y=(1+Math.sin(m))/(1-Math.sin(m)),v=(y+1)*Math.tan(r/h/2),_=v*v;function b(x){const S=Math.PI/2;return(x=Mje.normalize(x,-S))>S&&(x=Math.PI-x),x}if(a=1.5*Math.PI-2*Math.atan(.5*(v+Math.sqrt(4*y+_))),l=a+r/h,a=b(a),l=b(l),l<a){const x=l;l=a,a=x}if(a=Math.max($o(a),-90),l=Math.min($o(l),90),o=bvt.monotonic(n,o),o-n>180){const x=(o-n-180)/2;n+=x,o-=x}const w=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:Ae.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=w):s=new gi(n,a,o,l,w),t.spatialReference&&t.spatialReference.isWebMercator&&Gy(s,!1,s),s}function Cvt(t,e){const i=t.frustum,{renderCoordsHelper:r}=t,s=r.getAltitude(e),n=t.spatialReference,o=r.referenceEllipsoid.radius,a=t.state.camera,l=a.eye,c=1+xr(l,e)/(o+s),h=Math.sqrt(c*c-1),{minCurvature:d,maxCurvature:f,minSamples:m,maxSamples:y}=Ovt,v=Mvt(t),_=ce((h-d)/(f-d),0,1),b=Math.round(dt(m,y,_)),w=a.aboveGround,x=i.planes[_o.FAR],S=[],C=D$(on,Ivt,Br()),T=D$(on,Rvt,Br());es(f8,0,0,0,0);const M=P=>{};for(let P=0;P<4;P++){const D=P===Py.NEAR_FAR_BOTTOM_RIGHT&&!w||P===Py.NEAR_FAR_TOP_LEFT&&w?1-v:0,F=P===Py.NEAR_FAR_BOTTOM_RIGHT&&w||P===Py.NEAR_FAR_TOP_LEFT&&!w?v:1,L=i.lines[P],N=i.lines[P===3?0:P+1];for(let R=0;R<b;R++){const k=R/b,W=P===Py.NEAR_FAR_BOTTOM_RIGHT?1-(1-k)**2:P===Py.NEAR_FAR_TOP_LEFT?k**2:k,G=R===0?0:dt(D,F,W),j=dr(Dvt,L.origin,N.origin,G),re=DOe(L.direction,N.direction,G,Pvt);r.intersectManifoldClosestSilhouette(mf(j,re),s,Jl),uDe(Jl,l,Jl,x),S.push(is(Jl)),S.length!==0&&M(O$(S.at(-1),Jl));const ve=(AU(C,Jl)?1:0)|(AU(T,Jl)?2:0);f8[ve]=1}}S.length>2&&M(O$(S[0],S.at(-1)));const I=$vt(_j(f8)>1?Avt(yDe(S,C),T):[S],r,n);return new Sa({rings:I,spatialReference:n})}function $vt(t,e,i){const r=2*So();return t.map(s=>{const n=[];let o=!1;for(const a of s)e.fromRenderCoords(a,Jl,i),Math.abs(a[0])<r&&Math.abs(a[1])<r?(n.push([null,Jl[1]]),n.push([null,Jl[1]]),o=!0):n.push([Jl[0],Jl[1]]);if(o)for(let a=0;a<n.length;a++){const l=n[a];if(l[0]!=null)continue;const c=n[a+1],h=n.at(a===0?-1:a-1);l[0]=h[0],a++;const d=n.at(a===n.length-1?0:a+1);c[0]=d[0]}return n.push(n[0]),U_(n)||n.reverse(),n})}function Avt(t,e){const i=[];for(const r of t)i.push(...yDe(r,e));return i}function yDe(t,e){const i=[],r=[],s=So();for(let o=0;o<t.length;o++){const a=t[o],l=o===t.length-1?t[0]:t[o+1],c=A4(a,l,Lvt),h=AD(e,c.origin,c.vector,tf.NONE,Jl);switch(h){case ic.INSIDE:i.push(a);break;case ic.OUTSIDE:r.push(a);break;case ic.INTERSECTS_INSIDE_OUT:case ic.INTERSECTS_OUTSIDE_IN:{const[d,f,m]=h===ic.INTERSECTS_INSIDE_OUT?[1,i,r]:[-1,r,i],y=e,v=Xn($(),Jl,y,d*s),_=Xn($(),Jl,y,d*-s);f.push(a),f.push(v),m.push(_)}}}const n=[];return i.length&&n.push(i),r.length&&n.push(r),n}function Mvt(t){const{renderCoordsHelper:e,state:{camera:i}}=t,{center:r,eye:s}=i,n=Math.abs(e.getAltitude(r)),o=Math.abs(Math.PI/2-_v(e,r,s));return PA(Pfe,e.referenceEllipsoid.radius+n),yre(Pfe,o,i.distance,i.fovY)}const Ovt={minCurvature:wt(5),maxCurvature:wt(50),minSamples:1,maxSamples:6},Ivt=Le(1,0,0),Rvt=Le(0,1,0),Pvt=$(),Dvt=$(),Jl=$(),Pfe=Rs(),Lvt=Iv(),f8=pi(),Nvt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:wvt,eyeForCenterWithHeadingTilt:xvt,eyeTiltToLookAtTilt:Tvt,headingTiltToDirectionUp:gDe,lookAtTiltToEyeTilt:Svt,toArea:Cvt,toExtent:Evt},Symbol.toStringTag,{value:"Module"}));function H$(t,e){return t!=null&&(e==null||(e===Be.Local?!t.isGeographic||t.isWGS84||t.wkid===qc.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===qc.CGCS2000||t.wkid===qc.GCSMARS2000||t.wkid===qc.GCSMARS2000_SPHERE||t.wkid===qc.GCSMOON2000))}const Qse=()=>J.getLogger("esri.views.3d.support.cameraUtils"),vDe=96*39.37,UJ=1,Fvt=8,kvt=5,_De=1,zvt={heading:0,tilt:0},UR=$(),Uvt=new fb(-20037508342788905e-9,20037508342788905e-9),Bvt=new fb(-180,180);var xo;function Xb(t){return t.spatialReference??Ae.WGS84}function Kb({state:t}){return t.isGlobal?Nvt:mvt}function Vvt(t,e,i,r,s){return Kb(t).headingTiltToDirectionUp(e,i,r,s)}function gm(t,e){if(e==null)return null;const i=t.renderSpatialReference,r=Kb(t).headingTiltToDirectionUp,s=$();if(!pc(e.position,s,i))return null;const n=r(s,e.heading,e.tilt);ie(n.direction,n.direction,t.state.camera.distance),oe(n.direction,n.direction,s);const o=qS(t,s,n.direction,n.up);return o.fov=wt(e.fov),o.row=e.layout.row,o.rows=e.layout.rows,o.column=e.layout.column,o.columns=e.layout.columns,o}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})(xo||(xo={}));const NT=$();function q$(t,e,i){const r=t.renderSpatialReference,s=GD(t,e.eye,e.viewForward,e.up,zvt);let n=Xb(t);return mc(e.eye,r,NT,n)||(n=Ae.WGS84,mc(e.eye,r,NT,n)),i==null?i=new tu(new ke(NT,n),s.heading,s.tilt,$o(e.fov)):(i.position.x=NT[0],i.position.y=NT[1],i.position.z=NT[2],i.position.spatialReference=n,i.heading=s.heading,i.tilt=s.tilt,i.fov=$o(e.fov)),i.layout.row=e.row,i.layout.rows=e.rows,i.layout.column=e.column,i.layout.columns=e.columns,i}function l3(t,e){const{camera:i}=t.state,{unitInMeters:r}=t.renderCoordsHelper;return e/=r,i.width/2/i.pixelRatio/(vDe/e)/Math.tan(i.fovX/2)}function fS(t,e){const{camera:i}=t.state,{unitInMeters:r}=t.renderCoordsHelper,s=e*Math.tan(i.fovX/2),n=i.width/2/i.pixelRatio;return vDe/(n/s)*r}function bDe(t,e,i,r){const s=r.levelAtScale(e),n=wDe(GD(t,i.eye,i.viewForward,i.up).tilt),o=Math.max(s-n,0);return r.scaleAtLevel(o)}function Dfe(t,e,i){const r=i.levelAtScale(t),s=wDe(e);return i.scaleAtLevel(r+s)}function wDe(t){return 2*((t>90?180-t:t)/90)**2}function jvt(t,e,i=0){const r=t.basemapTerrain?.tilingScheme;if(!r)return 0;const s=gr(t.spatialReference).radius,n=t.state.viewingMode===Be.Local?e.eye[2]:Te(e.eye)-s;return bDe(t,fS(t,Math.abs(n-i)),e,r)}function Gvt(t,e,i=0){const r=gm(t,e);return r?jvt(t,r,i):0}const Hvt=1,qvt=100;function Wvt(t,e,i,r,s){if(e===0)return 0;const n=xr(i.eye,r),o=t.basemapTerrain?.tilingScheme;if(!o)return Qse().error("#scaleToTargetDistance()","Cannot compute distance from scale without a tiling scheme"),n;let a=n;const l=GD(t,i.eye,i.viewForward,i.up),c=l.tilt>90;if(t.state.isLocal){const y=(l3(t,Dfe(e,l.tilt,o))-Math.abs(i.eye[2]-s[2]))/Math.cos(wt(l.tilt));return a=c?a-y:a+y,a}let h=1/0,d=0,f=c3(t,l.heading,l.tilt,r,n,xo.ADJUST);if(!f)return a;const m=Te(s);for(;h>Hvt&&d<qvt;){const y=Te(f.eye),v=c?180-f.tilt:f.tilt,_=wt(v),b=Math.sin(_)*y,w=Math.cos(_)*y,x=l3(t,Dfe(e,f.tilt,o)),S=c?m-x:m+x,C=Td(b/S),T=Math.cos(C)*S-w,M=xr(f.eye,r);a=c?M-T:M+T,f=c3(t,l.heading,l.tilt,r,a,xo.ADJUST);const I=tne(t,f,$o(i.fov));if(!f||!I)return a;const P=Gvt(t,I,m-gr(t.spatialReference).radius);h=Math.abs(e-P),++d}return a}async function Zvt(t,e,i,r,s,n){return cG(t,e,l3(t,i),r,s,n)}function Yvt(t,e,i,r,s,n){return tne(t,c3(t,r.heading,r.tilt,e,i,s),r.fov,n)}async function cG(t,e,i,r,s,n){const o=await SDe(t,r.heading,r.tilt,e,i,s,n);return gt(n),LDe(t,o,r.fov,n)}function GD(t,e,i,r,s){return Kb(t).directionToHeadingTilt(e,i,r,s)}function xDe(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,UR,t.spatialReference)&&t.elevationProvider&&(Tm(t.elevationProvider,UR)??0)>UR[2]-_De)}async function Jvt(t,e,i){if(xDe(t,e))return!0;const{elevationProvider:r,spatialReference:s,renderCoordsHelper:n}=t;if(r==null||!n.fromRenderCoords(e,UR,s))return!1;const[o,a,l]=UR,c=await r.queryElevation(o,a,l,s,"ground",i)??0;return gt(i),c>l-_De}async function Xvt(t,e,i){const r=$();if(e==null)return ne(r,t.state.camera.center);if(e instanceof ke){const{renderSpatialReference:s,basemapTerrain:n,elevationProvider:o}=t,a=e.spatialReference;if(await EU(e,r,s,0,{signal:i}),gt(i),e.z==null&&n!=null&&o!=null){const l=await o.queryElevation(e.x,e.y,e.z??0,a,"ground",i);gt(i),l!=null&&t.renderCoordsHelper.setAltitude(r,l)}return r}return ne(r,e)}function Kvt(t,e){const i=$();if(e==null)return ne(i,t.state.camera.center);if(e instanceof ke){if(!pc(e,i,t.renderSpatialReference))return null;const{basemapTerrain:r,elevationProvider:s}=t;if(e.z==null&&r!=null&&s!=null){const n=Tm(s,e);n!=null&&t.renderCoordsHelper.setAltitude(i,n)}return i}return ne(i,e)}function c3(t,e,i,r,s,n){return TDe(t,e,i,r instanceof ke?r:null,Kvt(t,r),s,n)}async function SDe(t,e,i,r,s,n,o){const a=r instanceof ke?r:null,l=await Xvt(t,r,o);return gt(o),EDe(t,e,i,a,l,s,n,o)}function TDe(t,e,i,r,s,n,o){if(s==null||!r&&(r=new ke({spatialReference:Xb(t)}),!HS(s,t.renderSpatialReference,r)))return null;const a=CDe(t,e,i,s,n,o);if($De(t,i,o)&&xDe(t,a.eye)){const{tilt:l,mode:c}=ADe(t,i,s,n);return TDe(t,e,l,r,s,n,c)}return MDe(a,s)}async function EDe(t,e,i,r,s,n,o,a){r||(r=new ke({spatialReference:Xb(t)}),await aDe(s,t.renderSpatialReference,r,{signal:a})||(r=null)),gt(a);const l=CDe(t,e,i,s,n,o);if($De(t,i,o)&&await Jvt(t,l.eye,a)){gt(a);const{tilt:c,mode:h}=ADe(t,i,s,n);return EDe(t,e,c,r,s,n,h,a)}return MDe(l,s)}function CDe(t,e,i,r,s,n){const o=t0t(t,e,i,r,s=Math.max(s,t.state.constraints.minimumPoiDistance),n);return(0,Kb(t).eyeForCenterWithHeadingTilt)(r,s,o.heading,o.tilt)}function $De(t,e,i){const r=t.map.ground.navigationConstraint;return i===xo.ADJUST&&t.state.isGlobal&&e>0&&(r==null||r.type==="stay-above")}function ADe(t,e,i,r){const s=DDe(t,i,r,r0t(t,r,e,i));return{tilt:s,mode:e-s<1?xo.LOCKED:xo.ADJUST}}function MDe(t,e){return{...t,center:is(e)}}function ODe(t,e){const{state:i,spatialReference:r}=t,s=e.spatialReference;return i.isGlobal&&H$(s,Be.Global)||i.isLocal&&r.equals(s)}function IDe(t,e){let i,r,s;if(t.state.isGlobal){const h=new ke(e.xmin,e.ymin,e.spatialReference),d=new ke(e.xmax,e.ymax,e.spatialReference),f=e.spatialReference.isGeographic?Bvt:Uvt;i=new ke({x:f.center(h.x,d.x),y:(d.y+h.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const m=gr(e.spatialReference),y=yvt(i,h,d);r=y.lon,s=y.lat,f.diff(h.x,d.x)>f.range/2&&(r+=m.halfCircumference),r=Math.min(r,m.halfCircumference),s=Math.min(s,m.halfCircumference)}else{const h=t.renderSpatialReference??e.spatialReference;h.equals(e.spatialReference)||(e=Id(e,h)),r=e.xmax-e.xmin,s=e.ymax-e.ymin;const d=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;i=new ke({x:e.xmin+.5*r,y:e.ymin+.5*s,z:d,spatialReference:h})}const n=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,o=t.state.camera,a=1/Math.tan(o.fovX/2),l=1/Math.tan(o.fovY/2),c=1/Math.tan(o.fov/2);return{center:i,distance:Math.max(.5*r*a,.5*s*l,.5*n*c)/UJ}}async function RDe(t,e,i,r,s,n){const o=ODe(t,e)?e:await Eb(e,t.spatialReference,{signal:n});gt(n);const{center:a,distance:l}=IDe(t,o),c=await SDe(t,i,r,a,l,s,n);return gt(n),LDe(t,c,t.camera.fov,n)}function U4(t,e,i,r,s,n){let o;try{o=ODe(t,e)?e:Id(e,t.spatialReference)}catch{return null}const{center:a,distance:l}=IDe(t,o),c=c3(t,i,r,a,l,s);return c==null?null:tne(t,c,t.camera.fov,n)}function PDe(t,e,i){const r=t.renderSpatialReference,s=new ke({spatialReference:Xb(t)});if(!HS(i,r,s))return null;const n=Math.tan(e.fovX/2),o=Math.tan(e.fovY/2),a=za(e.eye,i),l=2*a*n*UJ,c=2*a*o*UJ;return Kb(t).toExtent(t,s,l,c)}function Qvt(t,e){return Kb(t).toArea(t,e)}function e0t(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(i/r)/Math.LN2>Fvt)return!0;const s=e,n=t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;return xr(s,n)/(Math.tan(.5*t.state.camera.fov)*r)>kvt}function t0t(t,e,i,r,s,n){let o=0;return n===xo.ADJUST&&e0t(t,r,s)?(e=0,o=i0t(t,s,i,r)):o=ene(t,r,s,i),o=t.state.constraints.clampTilt(s,o),{heading:e,tilt:i=DDe(t,r,s,o)}}const iB=.7;function i0t(t,e,i,r){const s=ene(t,r,e,i);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);n.max=Math.min(n.max,.5*Math.PI);const o=n.min*(1-iB)+n.max*iB;return Math.min(s,o)}function r0t(t,e,i,r){let s=ene(t,r,e,i);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);return s=Math.min(s,.5*Math.PI),n.min*(1-iB)+s*iB}function DDe(t,e,i,r){return Kb(t).lookAtTiltToEyeTilt(r,e,i)}function ene(t,e,i,r){return Kb(t).eyeTiltToLookAtTilt(r,e,i)}function tne(t,e,i,r){if(e==null)return null;const s=t.renderSpatialReference,n=new ke({spatialReference:Xb(t)});return HS(e.eye,s,n)?(r??=new tu,r.position=n,r.heading=e.heading,r.tilt=e.tilt,r.fov=i,r):null}async function LDe(t,e,i,r){const s=t.renderSpatialReference,n=new ke({spatialReference:Xb(t)});return await aDe(e.eye,s,n,{signal:r}),gt(r),new tu(n,e.heading,e.tilt,i)}function s0t(t,e){const i=t.basemapTerrain?.tilingScheme;if(i)return i.levelAtScale(e);Qse().error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function NDe(t,e){const i=t.basemapTerrain?.tilingScheme;if(i)return i.scaleAtLevel(e);Qse().error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}const ine=()=>J.getLogger("esri.layers.support.ElevationSampler");let FDe=class{queryElevation(e){return kDe(e.clone(),this)}on(){return $i()}projectIfRequired(e,i){return zDe(e,i)}},n0t=class extends FDe{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){super(),this.tile=e,this.noDataValue=r;const s=e.tile.extent;this.extent=tD(s,i.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=s;const n=Ao(i.spatialReference),o=i.lodAt(e.tile.level).resolution*n;this.demResolution={min:o,max:o}}contains(e){const i=this.projectIfRequired(e,this.spatialReference);return i!=null&&this.containsAt(i.x,i.y)}containsAt(e,i){return $V(this._aaExtent,e,i)}elevationAt(e,i){if(!this.containsAt(e,i)){const r=this.extent,s=`${r.xmin}, ${r.ymin}, ${r.xmax}, ${r.ymax}`;return ine().warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${s})`),this.noDataValue}return this.tile.sample(e,i)??this.noDataValue}},uti=class extends FDe{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){let s;super(),typeof i=="number"?(this.noDataValue=i,s=null):(s=i,this.noDataValue=r),this.samplers=s?e.map(o=>new n0t(o,s,this.noDataValue)):e;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=tD(Qt(),s.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,i){let r,s=!1;for(const n of this.samplers)if(n.containsAt(e,i)&&(s=!0,r=n.elevationAt(e,i),r!==n.noDataValue))return r;return r??(s||ine().warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler`),this.noDataValue)}};function kDe(t,e){const i=zDe(t,e.spatialReference);if(!i)return null;switch(t.type){case"point":o0t(t,i,e);break;case"polyline":a0t(t,i,e);break;case"multipoint":l0t(t,i,e)}return t}function zDe(t,e){if(t==null)return null;const i=t.spatialReference;if(i.equals(e))return t;const r=Q3(t,e);return r||ine().error(`Cannot project geometry spatial reference (wkid:${i.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),r}function o0t(t,e,i){t.z=i.elevationAt(e.x,e.y)}function a0t(t,e,i){wm.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s],o=e.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];wm.x=c[0],wm.y=c[1],r&&(l[3]=l[2]),l[2]=i.elevationAt(wm.x,wm.y)}}t.hasZ=!0}function l0t(t,e,i){wm.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let s=0;s<t.points.length;s++){const n=t.points[s],o=e.points[s];wm.x=o[0],wm.y=o[1],r&&(n[3]=n[2]),n[2]=i.elevationAt(wm.x,wm.y)}t.hasZ=!0}const wm=new ke,c0t=12;let rc=class Ec{constructor(e){const i=Ec.checkUnsupported(e);if(i!=null)throw i;const r=e;this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=TS(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;const s=r.lods.reduce((c,h)=>(h.level<c.minLod.level&&(c.minLod=h),c.max=Math.max(c.max,h.level),c),{minLod:r.lods[0],max:-1/0}),n=s.minLod,o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*r.size[0],a*r.size[1]]},a/=2,l/=2}clone(){return new Ec(this.toTileInfo())}toTileInfo(){return new yR({dpi:this.dpi,origin:new ke({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,i)=>new Jh({level:i,scale:e.scale,resolution:e.resolution}))})}getExtent(e,i,r,s){const n=this.levels[e],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+r*o,s[2]=this.origin[0]+(r+1)*o,s[3]=this.origin[1]-i*a,s[1]=this.origin[1]-(i+1)*a}convertExtentToRadians(e,i){this._isWebMercator?(i[0]=Dle(e[0]),i[1]=P7(e[1]),i[2]=Dle(e[2]),i[3]=P7(e[3])):this._isGCS&&(i[0]=wt(e[0]),i[1]=wt(e[1]),i[2]=wt(e[2]),i[3]=wt(e[3]))}getExtentGeometry(e,i,r,s=new gi){return this.getExtent(e,i,r,If),s.spatialReference=this.spatialReference,s.xmin=If[0],s.ymin=If[1],s.xmax=If[2],s.ymax=If[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(e){if(e==null)return!1;let i=!1;for(;this.levels.length<=e;){const{resolution:r,scale:s}=this.levels[this.levels.length-1],n=r/2*this.pixelSize;this.levels.push({resolution:r/2,scale:s/2,tileSize:[n,n]}),i=!0}return i}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const i=this.levels[0].scale;return e>=i?0:Math.log(i/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e,i=1/0){if(Ec.checkUnsupported(e))return!1;const r=new Ec(e);if(!r.spatialReference.equals(this.spatialReference)||r.pixelSize!==this.pixelSize)return!1;const s=Math.min(this.levels.length-1,r.levels.length-1,i),n=this.levels[s].resolution;let o=.5*n;return!Jc(r.origin[0],this.origin[0],o)||!Jc(r.origin[1],this.origin[1],o)?!1:(o=.5*n/2**s/this.pixelSize*c0t,Jc(n,r.levels[s].resolution,o))}rootTilesInExtent(e,i=null,r=1/0){const s=new Array,n=this.levels[0].tileSize;if(e==null||n[0]===0||n[1]===0)return s;Ec.computeRowColExtent(e,n,this.origin,If);let o=If[1],a=If[3],l=If[0],c=If[2];const h=c-l,d=a-o;if(h*d>r){const f=Math.floor(Math.sqrt(r));d>f&&(o=o+Math.floor(.5*d)-Math.floor(.5*f),a=o+f),h>f&&(l=l+Math.floor(.5*h)-Math.floor(.5*f),c=l+f)}for(let f=o;f<a;f++)for(let m=l;m<c;m++)s.push([0,f,m]);return i!=null&&(i[0]=this.origin[0]+l*n[0],i[1]=this.origin[1]-a*n[1],i[2]=this.origin[0]+c*n[0],i[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(e,i,r,s){const n=.001*(e[2]-e[0]+(e[3]-e[1]));s[0]=Math.max(0,Math.floor((e[0]+n-r[0])/i[0])),s[2]=Math.max(0,Math.ceil((e[2]-n-r[0])/i[0])),s[1]=Math.max(0,Math.floor((r[1]-e[3]+n)/i[1])),s[3]=Math.max(0,Math.ceil((r[1]-e[1]-n)/i[1]))}static isPowerOfTwo(e){const i=e.lods,r=i[0].resolution*2**i[0].level;return!i.some(s=>!Cje(s.resolution,r/2**s.level))}static hasGapInLevels(e){const i=e.lods.map(r=>r.level);i.sort((r,s)=>r-s);for(let r=1;r<i.length;r++)if(i[r]!==i[0]+r)return!0;return!1}static tileSizeSupported(e){const i=e.size[1];return i===e.size[0]&&!(i&i-1)&&i>=128&&i<=512}static hasOriginPerLODs(e){const i=e.origin;return e.lods.some(r=>r.origin!=null&&(r.origin[0]!==i.x||r.origin[1]!==i.y))}static getMissingTileInfoError(){return new U("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return e==null?rne():e.lods.length<1?new U("tilingscheme:generic","Tiling scheme must have at least one level"):Ec.isPowerOfTwo(e)?Ec.hasGapInLevels(e)?new U("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):Ec.tileSizeSupported(e)?Ec.hasOriginPerLODs(e)?new U("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new U("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new U("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,i){const r=e[2]-e[0],s=e[3]-e[1],n=Ao(i),o=1.2*Math.max(r,s),a=256,l=o/a,c=l*n*(96/.0254),h=new Ec(new yR({size:[a,a],origin:new ke({x:e[0]-.5*(o-r),y:e[3]+.5*(o-s)}),lods:[new Jh({level:0,resolution:l,scale:c})],spatialReference:i}));return h.ensureMaxLod(20),h}static makeWebMercatorAuxiliarySphere(e){const i=new Ec(Ec.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(e),i}static makeGCSWithTileSize(e,i=256,r=16){const s=256/i,n=new Ec(new yR({size:[i,i],origin:new ke({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new Jh({level:0,resolution:.703125*s,scale:295497598570834e-6*s})]}));return n.ensureMaxLod(r),n}get test(){}};function rne(){return new U("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}rc.WebMercatorAuxiliarySphereTileInfo=new yR({size:[256,256],origin:new ke({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:Ae.WebMercator}),spatialReference:Ae.WebMercator,lods:[new Jh({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),rc.WebMercatorAuxiliarySphere=rc.makeWebMercatorAuxiliarySphere(19);const If=Qt(),J2=64,mI=512,u0t=2.5,sne=$je(f7/10),UDe=2,BDe=Qt();rc.WebMercatorAuxiliarySphere.getExtent(0,0,0,BDe);const h0t=Qt([-180,-90,180,90]),d0t="Cannot extend surface to encompass all layers because it would result in too many root tiles.",p0t="Surface extent is too large for tile resolution at level 0.",An=4;let G0=class extends ws.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=sne}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(e?.extent==null||e.spatialReference==null)return null;const i=tD(e.extent,e.spatialReference);return i.zmin=e.visibleElevationBounds.min,i.zmax=e.visibleElevationBounds.max,i}get spatialReference(){return this.view.basemapTerrain?.spatialReference??Ae.WGS84}elevationAt(e,i){if(this.extent==null||!fl(this.extent,e,i)){const r=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return J.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${r})`),this.noDataValue}return this.view.elevationProvider?.getElevation(e,i,0,this.spatialReference,"ground")??this.noDataValue}queryElevation(e){return kDe(e.clone(),this)}};u([p({readOnly:!0})],G0.prototype,"demResolution",void 0),u([p({readOnly:!0})],G0.prototype,"extent",null),u([p({readOnly:!0})],G0.prototype,"noDataValue",void 0),u([p()],G0.prototype,"spatialReference",null),u([p({constructOnly:!0})],G0.prototype,"view",void 0),G0=u([A("esri.views.support.GroundViewElevationSampler")],G0);const f0t=G0;let ty=class extends ue{constructor(e){super(e),this.view=null,this.layerViews=new Ee}initialize(){this.addHandles(gn(()=>this.view?.map?.ground,e=>e.load())),this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null);for(const e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new f0t({view:this.view}):null:null}get extent(){const e=this.view;return e&&e.type!=="2d"&&e.ready?PDe(e,e.state.camera,e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation):null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return this.view?.suspended??!0}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map(e=>H(()=>e.updating,()=>this._updateUpdating(),Gt)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};u([p({readOnly:!0})],ty.prototype,"elevationSampler",null),u([p({readOnly:!0})],ty.prototype,"extent",null),u([p({type:Boolean,readOnly:!0})],ty.prototype,"updating",null),u([p({constructOnly:!0})],ty.prototype,"view",void 0),u([p({type:Ee,readOnly:!0})],ty.prototype,"layerViews",void 0),u([p({readOnly:!0})],ty.prototype,"suspended",null),ty=u([A("esri.views.GroundView")],ty);const m0t=ty,LM=()=>V(()=>import("./TileLayerView3D-j-urUfxm.js"),__vite__mapDeps([231,232,233,234,164,165,166,167,168,169,170])),Lfe=()=>V(()=>import("./ElevationLayerView3D-vExFKrtw.js"),__vite__mapDeps([235,117,232,233,164])),Nfe={"base-dynamic":()=>V(()=>import("./BaseDynamicLayerView3D-Bfh6MbL-.js"),__vite__mapDeps([236,237,232,238,239,240,241,242,164,165])),"base-elevation":Lfe,"base-tile":LM,"bing-maps":LM,"building-scene":()=>V(()=>import("./BuildingSceneLayerView3D-DEmj86sv.js"),__vite__mapDeps([243,244,245,246,247,248,88,77,170,19,20,249,250,251,252,253,87,111,254,255,256,257,258,27,26,86,259,260,261,262,21,16,12,172,17,18,22,5,6,7,8,23,232,164])),catalog:()=>V(()=>import("./CatalogLayerView3D-CRHStucf.js"),__vite__mapDeps([263,232,182,164])),"catalog-dynamic-group":()=>V(()=>import("./CatalogDynamicGroupLayerView3D-BrFFLlLp.js"),__vite__mapDeps([264,232,184,164])),"catalog-footprint":()=>V(()=>import("./CatalogFootprintLayerView3D-CijQWiEm.js"),__vite__mapDeps([265,266,267,172,238,239,268,104,105,269,270,129,257,258,27,26,170,271,259,167,17,18,19,20,21,16,12,22,5,6,7,8,23,260,24,25,137,232,41,39,40,272,177,176,164,165,186])),csv:()=>V(()=>import("./CSVLayerView3D-gnPFuOIS.js"),__vite__mapDeps([273,266,267,172,238,239,268,104,105,269,270,129,257,258,27,26,170,271,259,167,17,18,19,20,21,16,12,22,5,6,7,8,23,260,24,25,137,232,41,39,40,272,177,176,164,165])),dimension:()=>V(()=>import("./DimensionLayerView3D-K5x9GVya.js"),__vite__mapDeps([274,232,164])),elevation:Lfe,feature:()=>V(()=>import("./FeatureLayerView3D-TV5okZA6.js"),__vite__mapDeps([275,266,267,172,238,239,268,104,105,269,270,129,257,258,27,26,170,271,259,167,17,18,19,20,21,16,12,22,5,6,7,8,23,260,24,25,137,232,41,39,40,272,177,176,164,165])),geojson:()=>V(()=>import("./GeoJSONLayerView3D-bRNsxry2.js"),__vite__mapDeps([276,266,267,172,238,239,268,104,105,269,270,129,257,258,27,26,170,271,259,167,17,18,19,20,21,16,12,22,5,6,7,8,23,260,24,25,137,232,41,39,40,272,177,176,164,165])),graphics:()=>V(()=>import("./GraphicsLayerView3D-DtFiw4Go.js"),__vite__mapDeps([277,232,269,278,257,258,27,26,170,271,260,238,239,164])),group:()=>V(()=>import("./GroupLayerView3D-Ck3Majke.js"),__vite__mapDeps([279,190,164])),imagery:()=>V(()=>import("./ImageryLayerView3D-DuTv2Ete.js"),__vite__mapDeps([280,237,232,238,239,240,241,242,164,165,193,172,83,170])),"integrated-mesh":()=>V(()=>import("./IntegratedMeshLayerView3D-BiebvmiW.js"),__vite__mapDeps([281,249,250,251,252,253,87,88,77,111,254,255,256,257,258,27,26,170,86,259,260,232,164])),"integrated-mesh-3dtiles":()=>V(()=>import("./IntegratedMesh3DTilesLayerView3D-BQPGjDlj.js"),__vite__mapDeps([282,250,251,96,232,164])),"line-of-sight":()=>V(()=>import("./LineOfSightLayerView3D-BpOaYfd_.js"),__vite__mapDeps([283,232,164])),"map-image":()=>V(()=>import("./MapImageLayerView3D-D7ASI1ZX.js"),__vite__mapDeps([284,237,232,238,239,240,241,242,164,165,204,205,167,169,172,166,168,170])),media:()=>V(()=>import("./MediaLayerView3D-Dfic_9Qh.js").then(t=>t.M),__vite__mapDeps([285,208,68,232,286,287,288,289,290,158,291,240,241,242,164,211])),"ogc-feature":()=>V(()=>import("./OGCFeatureLayerView3D-D53-E_xJ.js"),__vite__mapDeps([292,266,267,172,238,239,268,104,105,269,270,129,257,258,27,26,170,271,259,167,17,18,19,20,21,16,12,22,5,6,7,8,23,260,24,25,137,232,41,39,40,272,177,176,164,165,213])),"open-street-map":LM,"oriented-imagery":()=>V(()=>import("./FeatureLayerView3D-TV5okZA6.js"),__vite__mapDeps([275,266,267,172,238,239,268,104,105,269,270,129,257,258,27,26,170,271,259,167,17,18,19,20,21,16,12,22,5,6,7,8,23,260,24,25,137,232,41,39,40,272,177,176,164,165])),"point-cloud":()=>V(()=>import("./PointCloudLayerView3D-ChHyD36e.js"),__vite__mapDeps([293,232,88,77,75,76,260,294,170,164])),viewshed:()=>V(()=>import("./ViewshedLayerView3D-F2vkIDLc.js"),__vite__mapDeps([295,232,164])),voxel:()=>V(()=>import("./VoxelLayerView3D-D3yaIKgw.js"),__vite__mapDeps([296,232,297,294,170,164])),route:()=>V(()=>import("./RouteLayerView3D-BwZ9V9nh.js"),__vite__mapDeps([298,215,216,232,278,257,258,27,26,170,271,260,238,239,272,164])),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?V(()=>import("./SceneLayerView3D-Cbcb_3QL.js"),__vite__mapDeps([299,111,19,20,167,249,250,251,252,253,87,88,77,254,255,256,257,258,27,26,170,86,259,260,232,300,262,21,16,12,172,164,261,17,18,22,5,6,7,8,23,294])):V(()=>import("./SceneLayerGraphicsView3D-DlOilbJd.js"),__vite__mapDeps([301,252,251,253,87,88,77,111,232,270,129,257,258,27,26,170,271,259,167,17,18,19,20,21,16,12,22,5,6,7,8,23,260,300,262,172,164,294])),stream:()=>V(()=>import("./StreamLayerView3D-Cl2EVh42.js"),__vite__mapDeps([302,71,72,57,73,41,39,40,272,267,172,238,239,268,104,105,269,270,129,257,258,27,26,170,271,259,167,17,18,19,20,21,16,12,22,5,6,7,8,23,260,24,25,137,232,164,218])),tile:LM,"imagery-tile":()=>V(()=>import("./ImageryTileLayerView3D-CCNU-D-a.js"),__vite__mapDeps([303,83,232,233,196,198,199,172,170,164,165,168])),"vector-tile":()=>V(()=>import("./VectorTileLayerView3D-DDnDMzSL.js"),__vite__mapDeps([304,221,56,40,55,139,145,131,132,94,232,233,164])),wcs:()=>V(()=>import("./ImageryTileLayerView3D-CCNU-D-a.js"),__vite__mapDeps([303,83,232,233,196,198,199,172,170,164,165,168])),"web-tile":LM,wfs:()=>V(()=>import("./WFSLayerView3D-DzUMX-9y.js"),__vite__mapDeps([305,266,267,172,238,239,268,104,105,269,270,129,257,258,27,26,170,271,259,167,17,18,19,20,21,16,12,22,5,6,7,8,23,260,24,25,137,232,41,39,40,272,177,176,164,165])),wms:()=>V(()=>import("./WMSLayerView3D-DiNS5DpY.js"),__vite__mapDeps([306,237,232,238,239,240,241,242,164,165,226,227,172])),wmts:()=>V(()=>import("./WMTSLayerView3D-BEkZSYmk.js"),__vite__mapDeps([307,232,233,234,164,165])),parquet:null,"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};function g0t(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",i=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new U(`${i}:view-not-supported`,`${e} is not supported in 3D`)}const Ffe={hasLayerViewModule:t=>Nfe[t.type]!=null,importLayerView:t=>{const e=Nfe[t.type];if(e==null)throw g0t(t);return e(t)}},kfe="analyses-owner-handles";var X2,ex;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(X2||(X2={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(ex||(ex={}));let T1=class extends ue{constructor(e){super(e),this._allAnalysisViews=new Ee,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=zfe(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null},viewshed:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(vi("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(vi()),this._attachedToViewResolver=zfe()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const i=this._items.get(e);if(i==null||i.state.list===ex.REMOVED)throw new U("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return i.createAnalysisViewTask.promise}_connectOwners(){this.addHandles(this._connectAnalysesCollection(this.view.analyses),kfe)}_disconnectOwners(){this.removeHandles(kfe),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const s of e)this._addAnalysis(s);const i=e.on("after-add",s=>this._addAnalysis(s.item)),r=e.on("after-remove",s=>this._removeAnalysis(s.item));return $i(()=>{i.remove(),r.remove();for(const s of e)this._removeAnalysis(s)})}_addAnalysis(e){const i=this._items.get(e);if(i==null){const r={state:{view:X2.PENDING,list:ex.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,r),r.createAnalysisViewTask=ag(s=>this._createAnalysisViewPromise(r,s))}else i.state.list=ex.ADDED}_removeAnalysis(e){const i=this._items.get(e);i!=null?(i.state.list=ex.REMOVED,this._scheduleUpdate()):J.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=mA(()=>this._update()))}_update(){this._scheduledUpdateHandle=Hi(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===ex.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case X2.PENDING:e.createAnalysisViewTask=hc(e.createAnalysisViewTask);break;case X2.CREATED:e.view!=null&&(this._allAnalysisViews.remove(e.view),e.view=Ce(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,i){const r=e.analysis,s=r.type,n=this._analysisModules[s];if(this._creatingViewCount+=1,n.module==null)try{n.module=await this._loadAnalysisModule(s)}catch(l){throw this._creatingViewCount-=1,l}if(wa(i))throw this._creatingViewCount-=1,vi("AnalysisView creation aborted");const o=new n.module.default({analysis:r,view:this.view});let a=!0;Xo(i,()=>{a&&(this._creatingViewCount-=1,o.destroy())});try{await o.when()}catch(l){throw a=!1,o.destroyed||(this._creatingViewCount-=1,o.destroy()),l}if(wa(i))throw vi();return a=!1,e.view=o,e.state.view=X2.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return V(()=>import("./AreaMeasurementAnalysisView3D-BYAFXn-s.js"),__vite__mapDeps([308,309,310,311,312,313,314,11,3,315,158,316,317,318,286,287,319,291,320,241,242,321]));case"dimension":return V(()=>import("./DimensionAnalysisView3D-B2XeOAqT.js"),__vite__mapDeps([322,311,323,310,319,291,317,318,320,324,316,314,11,3,315,158,325,326,242,327,328,286,287,240,241,329,330,331,332,333,334,335,290,288,336,337,321,338,268,289,339,340,341]));case"direct-line-measurement":return V(()=>import("./DirectLineMeasurementAnalysisView3D-DNdcgvQ8.js"),__vite__mapDeps([342,309,310,311,312,317,318,316,314,11,3,315,158,291,319,320,335,333,326,242,321]));case"line-of-sight":return V(()=>import("./LineOfSightAnalysisView3D-CYfG6_Iy.js"),__vite__mapDeps([343,311,344,317,318,345,255,256,325,326,242,346,334,339,328,286,287]));case"slice":return V(()=>import("./SliceAnalysisView3D-B4IYMTCJ.js"),__vite__mapDeps([347,311,348,349,325,326,242,240,241,255,256,317,318,245,246,247,248,88,77,170,330,327,328,286,287,339,340,321]));case"viewshed":return V(()=>import("./ViewshedAnalysisView3D-32-txqMS.js"),__vite__mapDeps([350,344,311,317,318,351,325,326,242,327,328,286,287,352,332,333,334,321,349,339,288,340]))}}};function zfe(){const t=Qo();return t.promise.catch(()=>{}),t}u([p()],T1.prototype,"updating",null),u([p({constructOnly:!0})],T1.prototype,"view",void 0),u([p()],T1.prototype,"_allAnalysisViews",void 0),u([p()],T1.prototype,"_creatingViewCount",void 0),T1=u([A("esri.views.3d.analysis.AnalysisViewManager3D")],T1);const y0t=T1;let iy=class extends ue{constructor(e){super(e),this.collision=new gI,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===Be.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==Be.Local?this._set("altitude",e):J.getLogger(this).warn("Altitude constraint is ignored in local scenes")}get mode(){return this.state.viewingMode}clampAltitude(e){return this.altitude?ce(e,this.altitude.min,this.altitude.max):e}clampTilt(e,i){if(!this.tilt)return i;const r=this.tilt(e);return ce(i,r.min,r.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===Be.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(i,r=m8)=>(r.min=pa.min,r.max=e,r)}_createDefaultTiltLocal(){const e=this.collision.enabled?M4([[4e3,pa.max],[1e4,wt(88)],[6e6,wt(88)]]):()=>pa.max;return(i,r=m8)=>(r.min=pa.min,r.max=e(i),r)}_createDefaultTiltGlobal(){const e=this.collision.enabled?M4([[4e3,pa.max],[5e4,wt(88)],[6e6,wt(88)],[2e7,pa.min]]):M4([[3e5,pa.max],[3e6,wt(88)],[6e6,wt(88)],[2e7,pa.min]]);return(i,r=m8)=>(r.min=pa.min,r.max=e(i),r)}};function v0t(t){return{min:-2e5,max:4*t.radius}}u([p()],iy.prototype,"altitude",null),u([p({readOnly:!0})],iy.prototype,"collision",void 0),u([p()],iy.prototype,"distance",void 0),u([p({readOnly:!0})],iy.prototype,"minimumPoiDistance",void 0),u([p()],iy.prototype,"tilt",void 0),u([p({constructOnly:!0})],iy.prototype,"state",void 0),iy=u([A("esri.views.3d.state.Constraints")],iy);const Ufe=v0t(xi),pa={min:wt(.5),max:wt(179.5)},m8={min:0,max:0};let gI=class extends ue{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};u([p({type:Boolean})],gI.prototype,"enabled",void 0),u([p({type:Number})],gI.prototype,"elevationMargin",void 0),gI=u([A("esri.views.3d.state.Constraints.CollisionConstraint")],gI);let K2=class extends Dt{constructor(){super(...arguments),this.min=Ufe.min,this.max=Ufe.max}};u([p({type:Number})],K2.prototype,"min",void 0),u([p({type:Number})],K2.prototype,"max",void 0),K2=u([A("esri.views.3d.constraints.AltitudeConstraint")],K2);let xy=class extends Dt{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,i){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==i&&this._set("far",i))}};u([p({type:Number,value:1e-8})],xy.prototype,"near",null),u([Yt("near")],xy.prototype,"castNear",null),u([p({type:Number,value:1e-8})],xy.prototype,"far",null),u([Yt("far")],xy.prototype,"castFar",null),u([p({type:["auto","manual"]})],xy.prototype,"mode",void 0),xy=u([A("esri.views.3d.constraints.ClipDistanceConstraint")],xy);const BJ={min:$o(pa.min),max:$o(pa.max)};let tx=class extends Dt{constructor(e){super(e),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return ce(e,BJ.min,BJ.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};u([p({type:["auto","manual"]})],tx.prototype,"mode",void 0),u([p({type:Number,value:BJ.max})],tx.prototype,"max",null),u([Yt("max")],tx.prototype,"castMax",null),tx=u([A("esri.views.3d.constraints.TiltConstraint")],tx);let ix=class extends Dt{constructor(e){super(e),this.tilt=new tx,this.altitude=new K2,this.clipDistance=new xy}};u([p({type:tx})],ix.prototype,"tilt",void 0),u([p({type:K2})],ix.prototype,"altitude",void 0),u([p({type:xy})],ix.prototype,"clipDistance",void 0),ix=u([A("esri.views.3d.constraints.Constraints")],ix);function Bfe(t){return rs(t,z2)||vA(t)?{wkid:qc.GCSMARS2000}:rs(t,U2)||_A(t)?{wkid:qc.GCSMOON2000}:Ae.WGS84}var sc;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(sc||(sc={}));let VJ=class extends ou{constructor(){super(...arguments),this.steps=sc.SIXTEEN,this.writeTextureChannels=gv.RG}};u([te({count:sc.COUNT})],VJ.prototype,"steps",void 0),u([te({count:gv.COUNT})],VJ.prototype,"writeTextureChannels",void 0);let NM=class{constructor(e,i,r,s,n,o,a,l,c=.5){this.coverage=e,this.density=i,this.absorption=r,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}};const ua={sunny:new NM([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],sc.SIXTEEN),cloudy:new NM([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],sc.TWOHUNDRED,.6),rainy:new NM([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],sc.TWOHUNDRED,.4),snowy:new NM([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],sc.HUNDRED,.65),foggy:new NM([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],sc.SIXTEEN)};ua.default=ua.sunny;const Zh=X("esri-mobile")?64:128,_0t=Zh/128,Cp=Math.ceil(Math.sqrt(Zh)),Xy=(Zh+2)*Cp,b0t=1e5,zN=128,w0t=Xy/1560;function uG(t){t.code.add(E`vec2 sphereIntersect(vec3 start, vec3 dir, float distance) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * distance;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`)}let nne=class extends ar{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.viewMatrix=xs()}};const zC=X("esri-mobile")?1024:2048;function VDe(t){const e=new ki;e.include(ea,!1);const i=e.fragment;return i.include(uG),i.uniforms.add(new pt("cloudRadius",r=>r.cloudRadius),new pt("power",r=>dt(35,120,r.absorption)),new pt("sigmaE",r=>1+r.absorption),new pt("density",r=>dt(0,.3,r.density)),new pt("cloudSize",r=>dt(0,.02,Math.max(.01,1-r.cloudSize))),new pt("detailSize",r=>dt(0,.2,Math.max(.01,1-r.detailSize))),new pt("smoothness",r=>dt(0,.5,1-r.smoothness)),new pt("cloudHeight",r=>dt(0,1500,r.cloudHeight)),new pt("coverage",r=>r.coverage),new Ld("view",r=>r.viewMatrix),new $t("cloudShapeTexture",r=>r.noiseTexture!=null?r.noiseTexture.textureAtlas:null),new fc("cloudVariables",r=>li(x0t,r.coverage,r.absorption))),i.constants.add("halfCubeMapSize","float",.5*zC),i.code.add(E`
    const int STEPS = ${t.steps===sc.SIXTEEN?E`16`:t.steps===sc.HUNDRED?E`100`:E`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),i.code.add(E`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${E.float(Xy)};
      const float dataWidth = ${E.float(Xy)};
      const float tileRows = ${E.float(Cp)};
      const vec3 atlasDimensions = vec3(${E.float(Zh)}, ${E.float(Zh)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${E.float(_0t)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${E.float(w0t)} * p) / ${E.float(Xy)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),i.code.add(E`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),i.code.add(E`float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}
float multipleOctaves(float extinction, float mu, float stepL) {
float attenuation = 1.0;
float contribution = 1.0;
float phaseAttenuation = 1.0;
float luminance = 0.0;
for (int i = 0; i < 4; i++) {
float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
attenuation *= 0.2;
contribution *= 0.6;
phaseAttenuation *= 0.5;
}
return luminance;
}`),i.code.add(E`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),i.code.add(E`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),i.main.add(E`if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
float cloudDistance = cloudRadius + cloudStart;
float rayStartDistance = dot(viewPos, viewPos) - (cloudDistance * cloudDistance);
vec2 rayStartIntersect = sphereIntersect(viewPos, rayDir, rayStartDistance);
float rayEndDistance = dot(viewPos, viewPos) - ((cloudDistance + cloudHeight) * (cloudDistance + cloudHeight));
vec2 rayEndIntersect = sphereIntersect(viewPos, rayDir, rayEndDistance);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);`),e}const x0t=He(),S0t=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:nne,build:VDe,cubeMapSize:zC},Symbol.toStringTag,{value:"Module"}));let g8=class extends Bi{constructor(e,i){super(e,i,new Fi(S0t,()=>V(()=>Promise.resolve().then(()=>PGt),void 0)))}initializePipeline(e){return _i({blending:GS(Ft.CONSTANT_COLOR,Ft.ONE_MINUS_CONSTANT_COLOR,uv.ADD,e.writeTextureChannels===gv.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:Ni.LEQUAL},colorWrite:Ai})}};var Um;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})(Um||(Um={}));let B4=class extends ou{constructor(){super(...arguments),this.mode=Um.Full}};u([te({count:Um.COUNT})],B4.prototype,"mode",void 0);let one=class extends ar{constructor(){super(...arguments),this.weatherTile=un(0,0)}};function jDe(t){const e=new ki;return e.include(ea,!1),e.fragment.code.add(E`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===Um.Full&&(e.fragment.code.add(E`float saturate(float x) {
return clamp(x, 0.0, 1.0);
}`),e.fragment.code.add(E`vec3 modulo(vec3 m, float n) {
return mod(mod(m, n) + n, n);
}
vec3 hash(vec3 p3, float frequency) {
p3 = modulo(p3, frequency);
p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
p3 += dot(p3, p3.yxz + 33.33);
return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
}`),e.fragment.code.add(E`vec3 fade(vec3 t) {
return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
}`),e.fragment.code.add(E`
    float gradientNoise(vec3 p, float frequency) {
      vec3 i = floor(p);
      vec3 f = fract(p);
      vec3 u = fade(f);
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequency = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequency;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${E.float(Cp)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${E.float(8)});

      float worley0 = worley(p, ${E.float(2)} * 2.0);
      float worley1 = worley(p, ${E.float(2)} * 8.0);
      float worley2 = worley(p, ${E.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${E.float(2)});
      float worley1 = worley(p, ${E.float(2)} * 2.0);
      float worley2 = worley(p, ${E.float(2)} * 4.0);
      float worley3 = worley(p, ${E.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `)),e.fragment.uniforms.add(new fc("weatherTile",i=>i.weatherTile)).code.add(E`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${E.float(zN)});

      // Get global coordinates of p
      p += weatherTile * ${E.float(zN)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${E.float(b0t)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),t.mode===Um.Full?e.fragment.main.add(E`
      float padWidth = 1.0;
      float paddedSize = ${E.float(Zh)} + 2.0 * padWidth;
      float tileCount = ${E.float(Cp)} * ${E.float(Cp)};
      vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

      bool padCell = false;
      if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
        padCell = true;
      }

      if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
        padCell = true;
      }

      bool startPadX = false;
      bool startPadY = false;
      bool endPadX = false;
      bool endPadY = false;

      if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
        startPadX = true;
      }

      if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
        startPadY = true;
      }

      if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
        endPadX = true;
      }

      if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
        endPadY = true;
      }

      vec2 padding = vec2(2.0 * padWidth) * tile;
      vec2 uv;

      if (padCell) {
        vec2 pixel = gl_FragCoord.xy - padWidth - padding;

        if (startPadX) {
          pixel.x += ${E.float(Zh)};
        }

        if (startPadY) {
          pixel.y += ${E.float(Zh)};
        }

        if (endPadX) {
          pixel.x -= ${E.float(Zh)};
        }

        if (endPadY) {
          pixel.y -= ${E.float(Zh)};
        }

        uv = vec2(pixel.xy / ${E.float(Zh)});
      } else {
        vec2 pixel = gl_FragCoord.xy - padWidth - padding;
        uv = vec2(pixel.xy / ${E.float(Zh)});
      }

      vec3 p_ = get3Dfrom2D(uv);
      vec3 p = p_;
      p.z /= (${E.float(Cp)} * ${E.float(Cp)});

      float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
      float worleyNoise = getTextureForPointWorley(p);

      fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

      p_ = mod(p_ + 1.0, ${E.float(Cp)} * ${E.float(Cp)});
      p = p_;
      p.z /= (${E.float(Cp)} * ${E.float(Cp)});

      worleyPerlinNoise = getTextureForPointPerlinWorley(p);
      worleyNoise = getTextureForPointWorley(p);

      fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

      vec2 mapUV = ${E.float(zN)} * (gl_FragCoord.xy / ${E.float(Xy)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);
      fragColor.ba = vec2(0.0, map);
      `):e.fragment.main.add(E`
      vec2 mapUV = ${E.float(zN)} * (gl_FragCoord.xy / ${E.float(Xy)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);
      fragColor = vec4(map);
    `),e}const T0t=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:one,build:jDe},Symbol.toStringTag,{value:"Module"}));let y8=class extends Bi{constructor(e,i){super(e,i,new Fi(T0t,()=>V(()=>Promise.resolve().then(()=>DGt),void 0)))}initializePipeline(e){return _i({blending:e.mode===Um.Full?ase:Yb(Ft.ZERO,Ft.ONE,Ft.ONE,Ft.ZERO),depthTest:{func:Ni.ALWAYS},colorWrite:Ai})}},GDe=class{constructor(e,i,r=i){this.internalFormat=e,this.width=i,this.height=r,this.multisampled=!1,this.samples=1}};function E0t(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*Hie(t.internalFormat)}let HDe=class{constructor(e,i){this._context=e,this._descriptor=i,this.type=hv.RenderBuffer,this._context.instanceCounter.increment(Hs.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=i;a?r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,o,s,n):r.renderbufferStorage(r.RENDERBUFFER,o,s,n),this._context.bindRenderbuffer(null)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,i=this._context.parameters.maxSamples;return e?Math.min(e,i):i}get usedMemory(){return E0t(this._descriptor)}resize(e,i){const r=this._descriptor;if(r.width===e&&r.height===i)return;r.width=e,r.height=i;const s=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):s.renderbufferStorage(s.RENDERBUFFER,r.internalFormat,r.width,r.height),this._context.bindRenderbuffer(null)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(Hs.Renderbuffer,this),this._context=null)}};const C0t=()=>J.getLogger("esri.views.webgl.FramebufferObject");let gg=class yI{constructor(e,i,r=null){this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(Hs.FramebufferObject,this);const s=V4(i)?i:new yi(this._context,i);if(this._colorAttachments.set(rr.COLOR_ATTACHMENT0,s),this._validateTextureDescriptor(s.descriptor),this._validateColorAttachmentPoint(rr.COLOR_ATTACHMENT0),r!=null)if(A0t(r))this._depthStencilTexture=V4(r)?r:new yi(this._context,r),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const n=$0t(r)?r:new HDe(this._context,r);this._depthStencilBuffer=n,this._validateRenderBufferDescriptor(n.descriptor)}}dispose(){if(this._colorAttachments.size===0&&!this._glName)return;const e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((i,r)=>this.detachColorTexture(r)?.dispose()),this.detachDepthStencilBuffer()?.dispose(),this.detachDepthStencilTexture()?.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(Hs.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(rr.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._colorAttachments.get(rr.COLOR_ATTACHMENT0)?.descriptor?.width??0}get height(){return this._colorAttachments.get(rr.COLOR_ATTACHMENT0)?.descriptor?.height??0}get usedMemory(){return[...this._colorAttachments].reduce((e,[i,r])=>e+r.usedMemory,this.depthStencil?.usedMemory??0)}getColorTexture(e){const i=this._colorAttachments.get(e);return i&&V4(i)?i:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(e,i=rr.COLOR_ATTACHMENT0){if(!e)return;this._validateColorAttachmentPoint(i);const r=e.descriptor;this._validateTextureDescriptor(r),this.detachColorTexture(i)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,i)),this._colorAttachments.set(i,e)}detachColorTexture(e=rr.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(e);if(i){if(this._initialized){const r=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e),this._context.bindFramebuffer(r)}return this._colorAttachments.delete(e),i}}setColorTextureTarget(e,i=rr.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(i);r&&this._framebufferTexture2D(r.glName,i,e)}attachDepthStencil(e){if(e)switch(e.type){case hv.Texture:return this._attachDepthStencilTexture(e);case hv.RenderBuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){if(e==null)return;const i=e.descriptor;i.pixelFormat!==vt.DEPTH_STENCIL&&i.pixelFormat!==vt.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),i.dataType!==Ya.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._validateTextureDescriptor(i),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,nS)),this._depthStencilTexture?.dispose(),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;if(e&&this._initialized){const i=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,nS),this._context.bindFramebuffer(i)}return this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){if(e==null)return;const i=e.descriptor;if(this._validateRenderBufferDescriptor(i),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,s=this._getGLAttachmentPoint(i);r.framebufferRenderbuffer(Fa.FRAMEBUFFER,s,r.RENDERBUFFER,e.glName)}this._depthStencilBuffer=e}detachDepthStencilBuffer(){const e=this._depthStencilBuffer;if(e&&this._initialized){const i=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);const r=this._context.gl,s=this._getGLAttachmentPoint(e.descriptor);r.framebufferRenderbuffer(Fa.FRAMEBUFFER,s,r.RENDERBUFFER,null),this._context.bindFramebuffer(i)}return this._depthStencilBuffer=null,e}copyToTexture(e,i,r,s,n,o,a){(e<0||i<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=a.descriptor;a.descriptor.target!==ts.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(l?.width==null||l?.height==null||e+r>this.width||i+s>this.height||n+r>l.width||o+s>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,h=c.bindTexture(a,yi.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(yi.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(ts.TEXTURE_2D,0,n,o,e,i,r,s),c.bindTexture(h,yi.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,i,r,s,n,o,a){(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,i,r,s,n,o,a)}async readPixelsAsync(e,i,r,s,n,o,a){const{gl:l}=this._context,c=Un.createPixelPack(this._context,Zs.STREAM_READ,a.byteLength);this._context.bindBuffer(c);const h=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),l.readPixels(e,i,r,s,n,o,0),this._context.unbindBuffer(ct.PIXEL_PACK_BUFFER),this._context.bindFramebuffer(h),await c.getSubDataAsync(a),c.dispose()}resize(e,i){if(this.width===e&&this.height===i)return;const r={width:e,height:i};yx(r,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(s=>s.resize(r.width,r.height)),this._depthStencilTexture?.resize(r.width,r.height),this._initialized&&(yx(r,this._context.parameters.maxRenderbufferSize),this._depthStencilBuffer?.resize(r.width,r.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=Fa.FRAMEBUFFER){const i=this._context.gl;if(this._initialized)return void i.bindFramebuffer(e,this.glName);this._glName&&i.deleteFramebuffer(this._glName);const r=i.createFramebuffer();if(i.bindFramebuffer(e,r),this._colorAttachments.forEach((s,n)=>this._framebufferTexture2D(s.glName,n,Vfe(s),e)),this._depthStencilBuffer){const s=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);i.framebufferRenderbuffer(e,s,i.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,i.DEPTH_STENCIL_ATTACHMENT,Vfe(this._depthStencilTexture),e);Op()&&i.checkFramebufferStatus(e)!==i.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=r,this._initialized=!0}_framebufferTexture2D(e,i=rr.COLOR_ATTACHMENT0,r=ts.TEXTURE_2D,s=Fa.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,i,r,e,n)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const i=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(Fa.FRAMEBUFFER,i,e.RENDERBUFFER,null)}this._depthStencilBuffer=Rt(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=Rt(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==ts.TEXTURE_2D&&e.target!==ts.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),yx(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){yx(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case fa.DEPTH_COMPONENT16:case fa.DEPTH_COMPONENT24:case fa.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case fa.DEPTH24_STENCIL8:case fa.DEPTH32F_STENCIL8:case fa.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case fa.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(yI._MAX_COLOR_ATTACHMENTS===-1){const{gl:r}=this._context;yI._MAX_COLOR_ATTACHMENTS=r.getParameter(r.MAX_COLOR_ATTACHMENTS)}const i=e-rr.COLOR_ATTACHMENT0;i+1>yI._MAX_COLOR_ATTACHMENTS&&J.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${i+1}. Implementation supports up to ${yI._MAX_COLOR_ATTACHMENTS} color attachments`)}};function V4(t){return t!=null&&"type"in t&&t.type===hv.Texture}function $0t(t){return t!=null&&"type"in t&&t.type===hv.RenderBuffer}function A0t(t){return V4(t)||t!=null&&"pixelFormat"in t}function yx(t,e){const i=Math.max(t.width,t.height);if(i>e){C0t().warn(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const r=e/i;return t.width=Math.round(t.width*r),t.height=Math.round(t.height*r),!1}return!0}function Vfe(t){return t.descriptor.target===ts.TEXTURE_CUBE_MAP?ts.TEXTURE_CUBE_MAP_POSITIVE_X:ts.TEXTURE_2D}gg._MAX_COLOR_ATTACHMENTS=-1;let j4=class extends ue{constructor(e){super(e),this._needsRender=!0,this._passParameters=new one,this._configuration=new B4,this._fbo=new gg(e.context.renderContext.rctx,new $r(Xy)),e.context.techniques.precompile(y8,new B4);const i=new B4;i.mode=Um.WeatherMap,e.context.techniques.precompile(y8,i)}get textureAtlas(){if(this._texture&&!this._needsRender)return this._texture;this._configuration.mode=this._texture?Um.WeatherMap:Um.Full;const e=this.context.techniques.get(y8,this._configuration);return e.compiled&&(this._texture=this._render(e)),this._texture}updateWeatherMap(e){oj(this._passParameters.weatherTile,e)||(zn(this._passParameters.weatherTile,e),this._needsRender=!0)}destroy(){this._fbo=Rt(this._fbo)}_render(e){if(!this._fbo)return null;const i=this.context.renderContext.rctx,r=i.getViewport();return i.setViewport(0,0,Xy,Xy),i.bindFramebuffer(this._fbo),i.bindTechnique(e,this.context.renderContext.bind,this._passParameters),i.screen.draw(),i.setViewport(r.x,r.y,r.width,r.height),this._needsRender=!1,this._fbo.colorTexture}};u([p({constructOnly:!0})],j4.prototype,"context",void 0),j4=u([A("esri.views.3d.environment.NoiseTextureAtlas")],j4);let Bl=class extends ue{constructor(e){super(e),this._state=xa(Gu.Idle),this._passParameters=new nne,this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this._tilesPerFace=1,this.coverage=dt(ua.default.coverage[0],ua.default.coverage[1],.5),this.density=dt(ua.default.density[0],ua.default.density[1],.5),this.absorption=dt(ua.default.absorption[0],ua.default.absorption[1],.5),this.cloudSize=dt(ua.default.cloudSize[0],ua.default.cloudSize[1],.5),this.detailSize=dt(ua.default.detailSize[0],ua.default.detailSize[1],.5),this.smoothness=dt(ua.default.smoothness[0],ua.default.smoothness[1],.5),this.cloudHeight=dt(ua.default.cloudHeight[0],ua.default.cloudHeight[1],.5),this.raymarchingSteps=ua.default.raymarchingSteps,this._viewMatrix=Ve(),this._dirty=!0,this.running=!0,this._configuration=new VJ}initialize(){const e=gr(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius;const i=()=>this.setDirty();this.addHandles([this.view.resourceController.scheduler.registerTask(at.CLOUDS_GENERATOR,this),H(()=>this.coverage,i,Nt),H(()=>this.density,i,Nt),H(()=>this.absorption,i,Nt),H(()=>this.cloudSize,i,Nt),H(()=>this.detailSize,i,Nt),H(()=>this.smoothness,i,Nt),H(()=>this.cloudHeight,i,Nt),H(()=>this.raymarchingSteps,i,Nt)]);const r=hU(this._computeWeatherTile());let s=0;this.addHandles(H(()=>{const n=this._computeWeatherTile();return oj(r,n)||(++s,zn(r,n)),s},i))}destroy(){this.destroyCubeMap(),this._passParameters.noiseTexture=Ce(this._passParameters.noiseTexture)}_precompileTechniques(){this._configuration.steps=this.raymarchingSteps,this._configuration.writeTextureChannels=gv.RG,this.context.techniques.precompile(g8,this._configuration),this._configuration.writeTextureChannels=gv.BA,this.context.techniques.precompile(g8,this._configuration)}_acquireTechnique(){switch(this.raymarchingSteps){case sc.SIXTEEN:this._tilesPerFace=1;break;case sc.HUNDRED:this._tilesPerFace=4;break;case sc.COUNT:case sc.TWOHUNDRED:this._tilesPerFace=8;break;default:this.raymarchingSteps}return this._configuration.writeTextureChannels=1-this.parameters.readChannels,this._configuration.steps=this.raymarchingSteps,this.context.techniques.get(g8,this._configuration)}_computeWeatherTile(){const{camera:e,environment:i}=this.view,{latitude:r,longitude:s}=e.position;if(r==null||s==null)return rS;li(Jd,(r+90)/180,(s+180)/360);const n=Math.floor(this._weatherTileCount*Math.abs(2*Jd[0]-1));Jd[0]=Math.floor(2*this._weatherTileCount*Jd[0]),Jd[1]=Math.floor(4*(this._weatherTileCount-n)*Jd[1]);let o=0,a=0;if(i?.lighting?.type!=="virtual"&&i?.lighting?.date!=null){const l=new Date(i.lighting.date);l.setUTCHours(i.lighting.date.getUTCHours()+(i.lighting.displayUTCOffset??0)),o=31*l.getUTCMonth()+l.getUTCDate(),a=l.getUTCFullYear()}return Jd[0]=(Jd[0]+o)%(2*this._weatherTileCount),Jd[1]=(Jd[1]+a%100)%(4*this._weatherTileCount),Jd}get state(){return this._state.value}set state(e){this._state.value=e}get usedMemory(){return(this._fbo?.usedMemory??0)+(this._passParameters.noiseTexture?.textureAtlas?.usedMemory??0)}_ensureNoiseTexture(){return this._passParameters.noiseTexture??=new j4({context:this.context}),this._passParameters.noiseTexture}_ensureFrameBufferCube(e){const i=this.context.renderContext.rctx;if(this._fbo==null){const r=new $r(e);r.target=ts.TEXTURE_CUBE_MAP,r.wrapMode=nr.CLAMP_TO_EDGE,this._fbo=new gg(i,r),this.parameters.data=this}return i.unbindTexture(this._fbo.colorTexture),this._fbo}get cubeMap(){return this._fbo}get parameters(){return this.context.renderContext.bind.clouds}destroyCubeMap(){this._fbo=Rt(this._fbo),this.parameters.data=null}applyPreset(e,i){const r=e.median,s=n=>{const o=dt(n[0],n[1],r);return i<.5?dt(n[0],o,2*i):dt(o,n[1],2*(i-.5))};this.coverage=s(e.coverage),this.density=s(e.density),this.absorption=s(e.absorption),this.cloudSize=s(e.cloudSize),this.detailSize=s(e.detailSize),this.smoothness=s(e.smoothness),this.cloudHeight=s(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps,this._precompileTechniques()}setDirty(){this._dirty=this.running=!0}runTask(e){if(this.state===Gu.Fading)return Ko;this._dirty&&(this._faceIndex=this._tileIndex=0,this.state=Gu.Rendering,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._ensureNoiseTexture().updateWeatherMap(this._computeWeatherTile()),this._dirty=!1);const i=this._acquireTechnique();if(!this._ensureNoiseTexture().textureAtlas||!i.compiled)return Ko;const r=M0t[this._faceIndex],s=O0t[this._faceIndex];D2e(this._viewMatrix,I0t,r,s),FS(this._passParameters.viewMatrix,this._viewMatrix);const n=this.context.renderContext.rctx,o=n.getViewport(),a=zC/this._tilesPerFace,l=this._tileIndex*a;n.setViewport(0,l,zC,a);const c=this._ensureFrameBufferCube(zC);n.bindFramebuffer(c),n.bindTechnique(i,this.context.renderContext.bind,this._passParameters);const h=ts.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return c.setColorTextureTarget(h),n.screen.draw(),n.gl.flush(),n.setViewport(o.x,o.y,o.width,o.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this._faceIndex=this._tileIndex=0,this.state=Gu.Ready,this.running=!1):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),Ko}};u([p({constructOnly:!0})],Bl.prototype,"context",void 0),u([p({constructOnly:!0})],Bl.prototype,"view",void 0),u([p({constructOnly:!0})],Bl.prototype,"requestRender",void 0),u([p()],Bl.prototype,"coverage",void 0),u([p()],Bl.prototype,"density",void 0),u([p()],Bl.prototype,"absorption",void 0),u([p()],Bl.prototype,"cloudSize",void 0),u([p()],Bl.prototype,"detailSize",void 0),u([p()],Bl.prototype,"smoothness",void 0),u([p()],Bl.prototype,"cloudHeight",void 0),u([p()],Bl.prototype,"raymarchingSteps",void 0),u([p()],Bl.prototype,"running",void 0),Bl=u([A("esri.views.3d.environment.CloudsRenderer")],Bl);const M0t=[br(1,0,0),br(-1,0,0),br(0,1,0),br(0,-1,0),br(0,0,1)],O0t=[br(0,1,0),br(0,1,0),br(0,0,-1),br(0,0,1),br(0,1,0)],I0t=EA(),Jd=xie();var bv;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})(bv||(bv={}));let qDe=class extends ou{constructor(){super(...arguments),this.type=bv.Rain}};u([te({count:bv.COUNT})],qDe.prototype,"type",void 0);function WDe(t){const e=new ki;return e.attributes.add(z.POSITION,"vec3"),e.attributes.add(z.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new Ja("cameraPosition",i=>i.camera.eye),new Cr("offset",(i,r)=>R0t(i,r)),new pt("width",i=>i.width),new pt("time",i=>i.time),new Co("proj",i=>i.camera.projectionMatrix),new Co("view",i=>i.camera.viewMatrix)),e.varyings.add("vUv","vec2"),e.vertex.code.add(E`vec3 hash31(float p){
vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
p3 += dot(p3, p3.yzx + 33.33);
return fract((p3.xxy + p3.yzz) * p3.zyx);
}
float hash11(float p){
p = fract(p * 0.1031);
p *= p + 33.33;
p *= p + p;
return fract(p);
}
vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
}`),e.vertex.main.add(E`
      vUv = position.xz;
      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundredths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===bv.Rain?E`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:E`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
  `),e.fragment.uniforms.add(new pt("opacity",i=>i.opacity),new Ja("particleColor",i=>P0t(i,t))),e.fragment.main.add(E`
    float d = length(vUv - vec2(0.5));

    ${t.type===bv.Rain?E`d = 0.35 * smoothstep(0.5, 0.0, d);`:E`d = smoothstep(0.5, 0.1, d);`}
    fragColor = opacity * vec4(particleColor * d, d);
  `),e}function R0t(t,e){const i=e.camera.eye,r=.5*t.width,s=1/t.width,n=$Ae(jJ,se(jJ,(i[0]+r)*s,(i[1]+r)*s,(i[2]+r)*s));return Ri(n,i,ie(n,n,t.width))}function P0t(t,e){const i=e.type===bv.Rain?L0t:D0t,r=ie(jJ,i,N0t),s=t.camera.eye;ae(jfe,s);const n=Math.max(0,de(jfe,t.lighting.mainLight.direction));return dr(r,r,i,n)}const jJ=$(),jfe=$(),D0t=Le(1,1,1),L0t=Le(.85,.85,.85),N0t=.7,F0t=Object.freeze(Object.defineProperty({__proto__:null,build:WDe},Symbol.toStringTag,{value:"Module"}));let k0t=class extends ar{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=0}},Gfe=class extends Bi{constructor(e,i){super(e,i,new Fi(F0t,()=>V(()=>Promise.resolve().then(()=>LGt),void 0)),new Map([[z.POSITION,0],[z.INSTANCEFEATUREATTRIBUTE,1]]))}initializePipeline(){return _i({blending:NA,depthTest:{func:Ni.LEQUAL},colorWrite:Ai})}};function Fv(t,e=0){const i=t.stride;return Array.from(t.fields.keys()).map(r=>{const s=t.fields.get(r),n=s.constructor.ElementCount,o=z0t(s.constructor.ElementType),a=s.offset,l=s.optional?.glNormalized??!1;return new gf(r,n,o,a,i,l,e)})}function z0t(t){const e=U0t[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const U0t={u8:Pi.UNSIGNED_BYTE,u16:Pi.UNSIGNED_SHORT,u32:Pi.UNSIGNED_INT,i8:Pi.BYTE,i16:Pi.SHORT,i32:Pi.INT,f32:Pi.FLOAT};let BE=class extends xf{constructor(e){super(e),this.consumes={required:[ut.TRANSPARENT_ENVIRONMENT]},this.produces=ut.TRANSPARENT_ENVIRONMENT,this._rainSpeed=.1,this._snowSpeed=.01,this._numParticles=0,this._passParameters=new k0t,this._configuration=new qDe;const{view:i,type:r}=e;this._configuration.type=r==="rainy"?bv.Rain:bv.Snow,i._stage.renderView.techniques.precompile(Gfe,this._configuration),this._passParameters.time=0,this._passParameters.radius=gr(i.spatialReference).radius,this.addHandles(H(()=>i.environment.weather,s=>{s.type===r&&this.addHandles(H(()=>s.precipitation,n=>this._adjustParticles(n),St))},St)),this.addHandles(H(()=>i._stage?.renderer.renderContext.bind.clouds.fadeFactor??1,s=>{this._passParameters.opacity=s,s===1&&(this.removeHandles("opacity"),this.addHandles(H(()=>i._stage?.renderer.renderContext.bind.clouds.opacity??1,n=>this._passParameters.opacity=n,St),"opacity"))},Gt),"opacity")}_adjustParticles(e){const r=e<.5?dt(0,.35,2*e):dt(.35,1,2*(e-.5));this._numParticles=Hfe*r}destroy(){this._numParticles=0,this._vao=Rt(this._vao),this._instanceIdBuffer=Rt(this._instanceIdBuffer)}fadeOut(e){this.removeAllHandles(),this.addHandles(H(()=>this.renderContext?.bind.clouds.fadeFactor??1,i=>{this._passParameters.opacity=1-i,i===1&&(this.removeAllHandles(),e())}),"opacity")}updateAnimation(e){const i=(this.type==="rainy"?this._rainSpeed:this._snowSpeed)*rxe(e.time)%1e5;return this._passParameters.time!==i&&(this._passParameters.time=i,!0)}render(e){const i=this.renderingContext;this._instanceIdBuffer??=this._createInstanceIndices(i);const r=Math.round(this._numParticles*this._passParameters.opacity),s=e.find(({name:a})=>a===ut.TRANSPARENT_ENVIRONMENT);if(r<1)return s;const n=this.techniques.get(Gfe,this._configuration);if(!n.compiled)return this.requestRender(bt.UPDATE),s;const o=i.bindTechnique(n,this.bindParameters,this._passParameters);return this._vao??=B0t(i,n.locations),i.bindVAO(this._vao),o.assertCompatibleVertexAttributeLocations(this._vao),tMe(i,n.locations,this._instanceIdBuffer,qfe,0),i.drawArraysInstanced(Ui.TRIANGLES,0,3,r),frt(i,n.locations,this._instanceIdBuffer,qfe),s}_createInstanceIndices(e){const i=[];for(let r=0;r<Hfe;r++)i.push(r);return Un.createVertex(e,Zs.STATIC_DRAW,new Float32Array(i))}};function B0t(t,e){const i=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new mg(t,e,new Map([["geometry",Fv(V0t)]]),new Map([["geometry",Un.createVertex(t,Zs.STATIC_DRAW,i)]]))}u([p()],BE.prototype,"consumes",void 0),u([p()],BE.prototype,"produces",void 0),u([p({constructOnly:!0})],BE.prototype,"type",void 0),BE=u([A("esri.views.3d.environment.Precipitation")],BE);const Hfe=25e4,V0t=Nd().vec3f(z.POSITION),qfe=Fv(Nd().f32(z.INSTANCEFEATUREATTRIBUTE),1);let E1=class extends BD{constructor(e){super(e),this.produces=new Map([]),this._clouds=xa(null),this._incarnation=0,this._precipitation=null}initialize(){this.view._stage.addRenderPlugin(this)}destroy(){this.removeHandles(),this.uninitializeRenderContext(),this.view?._stage?.removeRenderPlugin(this),this._set("view",null)}get updating(){return!!this._clouds.value?.running}get weatherAvailable(){return Te(this.view.state.camera.eye)-gr(this.view.spatialReference).radius<=FC}get usedMemory(){return this._clouds.value?.usedMemory??0}_fadeOutPrecipitation(){this._precipitation&&(this._precipitationOutgoing?.destroy(),this._precipitationOutgoing=this._precipitation,this._precipitationOutgoing.fadeOut(()=>{this._precipitationOutgoing=Ce(this._precipitationOutgoing)}),this._precipitation=null,++this._incarnation)}get weather(){return this.view?.environmentManager?.weatherEnabled?this.view.environment.weather:null}initializeRenderContext(e){this._context=e;const i=this.view,r=()=>this._requestRender();this.addHandles([H(()=>this._precipitation,r,Gt),H(()=>this._clouds.value?.state,r,Gt),H(()=>i.state.mode,r,Gt),H(()=>this._updateClouds(),r,Gt),H(()=>this._updatePrecipitation(),r,Gt),H(()=>this.weather,s=>this._initWeather(s))])}uninitializeRenderContext(){this._context=null,this._clouds.value=Ce(this._clouds.value),this._precipitation=Ce(this._precipitation),this._precipitationOutgoing=Ce(this._precipitationOutgoing)}prepareRender(e){const{bind:i,time:r}=e;if(this.view.viewingMode!=="local"&&i.clouds.data){i.clouds.fade(i.camera,r,this.view.qualitySettings.fadeDuration);const s=this._clouds.value;s&&s.state===Gu.Idle&&s.coverage===0&&!s.running&&s.destroyCubeMap()}}acquireTechniques(){return[]}render(){}_requestRender(){this._context?.requestRender()}_initWeather(e){const i=this._context;if(!e||!i)return void(this._clouds.value=Ce(this._clouds.value));if(this._clouds.value)return;const r=this.view;this._clouds.value=new Bl({context:i,view:r,requestRender:()=>this._requestRender()})}_updateClouds(){const e=this.view.environment.weather;return e==null||this._clouds.value==null||this._clouds.value.applyPreset(ua[e.type],j0t(e)),++this._incarnation}_updatePrecipitation(){const e=this.view.environment.weather;if(e.type===this._precipitation?.type)return this._incarnation;this._fadeOutPrecipitation();const i=e.type==="rainy"||e.type==="snowy",r=this._context;return i&&r&&(this._precipitation=new BE({view:this.view,type:e.type}),++this._incarnation),this._incarnation}get test(){}hasHighlightOptions(e){return!1}};function j0t(t){switch(t.type){case"rainy":case"snowy":case"cloudy":case"sunny":return t.cloudCover;case"foggy":return t.fogStrength}}u([p({constructOnly:!0})],E1.prototype,"view",void 0),u([p({type:Boolean,readOnly:!0})],E1.prototype,"updating",null),u([p()],E1.prototype,"weatherAvailable",null),u([p()],E1.prototype,"_context",void 0),E1=u([A("esri.views.3d.environment.EnvironmentRenderer")],E1);var hG=Math.PI,qs=Math.sin,qo=Math.cos,ane=Math.tan,ZDe=Math.asin,lne=Math.atan2,YDe=Math.acos,Yn=hG/180,JDe=864e5,XDe=2440588,KDe=2451545,G0t={dec:0,ra:0};function H0t(t){return t.valueOf()/JDe-.5+XDe}function UN(t){return new Date((t+.5-XDe)*JDe)}function G4(t){return H0t(t)-KDe}var rB=23.4397*Yn;function QDe(t,e){return lne(qs(t)*qo(rB)-ane(e)*qs(rB),qo(t))}function cne(t,e){return ZDe(qs(e)*qo(rB)+qo(e)*qs(rB)*qs(t))}function eLe(t,e,i){return lne(qs(t),qo(t)*qs(e)-ane(i)*qo(e))}function tLe(t,e,i){return ZDe(qs(e)*qs(i)+qo(e)*qo(i)*qo(t))}function iLe(t,e){return Yn*(280.16+360.9856235*t)-e}function rLe(t){return Yn*(357.5291+.98560028*t)}function sLe(t){return Yn*(1.9148*qs(t)+.02*qs(2*t)+3e-4*qs(3*t))}function nLe(t,e){return t+e+102.9372*Yn+hG}function oLe(t,e){var i=rLe(t),r=nLe(i,sLe(i));return e||(e={dec:0,ra:0}),e.dec=cne(r,0),e.ra=QDe(r,0),e}var Xl={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(t,e,i,r){var s=Yn*-i,n=Yn*e,o=G4(t),a=oLe(o,G0t),l=iLe(o,s)-a.ra;return r||(r={azimuth:0,altitude:0}),r.azimuth=eLe(l,n,a.dec),r.altitude=tLe(l,n,a.dec),r}},H4=[[-.83,"sunrise","sunset"]];Xl.addTime=function(t,e,i){H4.push([t,e,i])};var aLe=9e-4;function q0t(t,e){return Math.round(t-aLe-e/(2*hG))}function Wfe(t,e,i){return aLe+(t+e)/(2*hG)+i}function Zfe(t,e,i){return KDe+t+.0053*qs(e)-.0069*qs(2*i)}function W0t(t,e,i){return YDe((qs(t)-qs(e)*qs(i))/(qo(e)*qo(i)))}function Yfe(t){var e=Yn*(134.963+13.064993*t),i=Yn*(93.272+13.22935*t),r=Yn*(218.316+13.176396*t)+6.289*Yn*qs(e),s=5.128*Yn*qs(i),n=385001-20905*qo(e);return{ra:QDe(r,s),dec:cne(r,s),dist:n}}Xl.getTimes=function(t,e,i){var r=Yn*-i,s=Yn*e,n=q0t(G4(t),r),o=Wfe(0,r,n),a=rLe(o),l=sLe(a),c=nLe(a,l),h=cne(c,0),d=Zfe(o,a,c);function f(S){return Zfe(Wfe(W0t(S,s,h),r,n),a,c)}function m(S){var C=(qs(S)-qs(s)*qs(h))/(qo(s)*qo(h));return C<-1?Xl.PolarException.MIDNIGHT_SUN:C>1?Xl.PolarException.POLAR_NIGHT:Xl.PolarException.NORMAL}var y,v,_,b,w,x={solarNoon:UN(d),nadir:UN(d-.5),polarException:Xl.PolarException.NORMAL};for(y=0,v=H4.length;y<v;y+=1)w=d-((b=f((_=H4[y])[0]*Yn))-d),x[_[1]]=UN(w),x[_[2]]=UN(b);return x.polarException=m(H4[0][0]*Yn),x},Xl.getMoonPosition=function(t,e,i){var r=Yn*-i,s=Yn*e,n=G4(t),o=Yfe(n),a=iLe(n,r)-o.ra,l=tLe(a,s,o.dec);return l+=.017*Yn/ane(l+10.26*Yn/(l+5.1*Yn)),{azimuth:eLe(a,s,o.dec),altitude:l,distance:o.dist}},Xl.getMoonFraction=function(t){var e=G4(t),i=oLe(e),r=Yfe(e),s=149598e3,n=YDe(qs(i.dec)*qs(r.dec)+qo(i.dec)*qo(r.dec)*qo(i.ra-r.ra)),o=lne(s*qs(n),r.dist-s*qo(n));return(1+qo(o))/2};const yl={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let BN=class{constructor(e,i){this.direct=e,this.ambient=i}};function Z0t(t,e,i,r,s,n){se(n.ambient.color,1,1,1),n.ambient.intensity=yl.global.ambient,se(n.direct.color,1,1,1),n.direct.intensity=yl.global.direct;const o=e[2],a=ce((Math.abs(o)-yl.local.altitude)/(yl.global.altitude-yl.local.altitude),0,1);let l;if(n.globalFactor=a,t!=null&&(l=Xl.getTimes(t,e[1],e[0])),a<1){let c;if(t!=null)c=t_t(t,l,r);else{const h=cLe(r);c={direct:{intensity:yl.local.directAtNoon*h.direct,color:Le(1,1,1)},ambient:{intensity:yl.local.ambientAtNoon*h.ambient,color:Le(1,1,1)},timeOfDay:"early afternoon"}}dr(n.ambient.color,c.ambient.color,n.ambient.color,a),n.ambient.intensity=dt(c.ambient.intensity,n.ambient.intensity,a),dr(n.direct.color,c.direct.color,n.direct.color,a),n.direct.intensity=dt(c.direct.intensity,n.direct.intensity,a),n.specularStrength=r==="rainy"||r==="snowy"||r==="foggy"?0:1,n.environmentStrength=r==="rainy"?.7:r==="snowy"||r==="foggy"?.75:1}n.noonFactor=t!=null?e_t(t,l):1,t!=null?Y0t(t,e,i,n.direct.directionToLightSource):lLe(s,i,n.direct.directionToLightSource)}function lLe(t,e,i){e===Be.Global?ae(w8,t.eye):se(w8,0,0,1),ie(x8,t.viewForward,-1);const r=wj(x8,w8),s=Math.max(r-2*S8,0),n=.85*s/(s+1),o=Math.max(S8,r-S8-n);Ad(ame,-o,t.viewRight),st(i,x8,ame),oe(i,i,ie(i_t,t.viewRight,r_t)),ae(i,i)}function Y0t(t,e,i,r){const s=Q0t,n=pf(K0t);if(i===Be.Global)Xl.getPosition(t,0,0,s),se(r,0,0,-1),b$(n,n,-s.azimuth),VV(n,n,-s.altitude),st(r,r,n);else{const o=yl.planarDirection,a=o.globalAngles,l=e[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=ce(c,0,1),c<1?(Xl.getPosition(t,e[1],e[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),se(r,0,-1,0),w$(n,n,-s.azimuth),b$(n,n,-s.altitude),st(r,r,n)}}function J0t(t,e){if(e===Be.Global)return!0;const i=yl.planarDirection;return Math.abs(t)<i.localAltitude}const X0t=Le(.5773502691896258,-.5773502691896258,.5773502691896258);let Jfe=class{constructor(){this.ambient={color:Le(1,1,1),intensity:.55},this.direct={color:Le(1,1,1),intensity:.55,directionToLightSource:is(X0t)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const K0t=Ve(),Q0t={azimuth:0,altitude:0};function e_t(t,e){const i=t.valueOf();let r,s;e.polarException===Xl.PolarException.MIDNIGHT_SUN?(r=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=r+432e6):e.polarException===Xl.PolarException.POLAR_NIGHT?(r=i-2,s=i-1):(r=e.sunrise.valueOf(),s=e.sunset.valueOf());const n=r+(s-r)/2;return 1-ce(Math.abs(i-n)/432e5,0,1)}function cLe(t){switch(t){case"disabled":case"sunny":case"cloudy":return new BN(1,1);case"rainy":return new BN(.4,1.2);case"snowy":return new BN(.5,1.3);case"foggy":return new BN(.2,1.6)}}function Xfe(t,e){const i=(t[0]+t[1]+t[2])/3;t[0]+=(i-t[0])*e,t[1]+=(i-t[1])*e,t[2]+=(i-t[2])*e}const v8=Le(.01,.01,.01),GJ=Le(1,.6,.5),HJ=Le(1,.98,.98),Kfe=Le(1,1,1),_8=Le(.8,.8,1),qJ=Le(.8,.8,1),WJ=Le(.98,.98,1),Qfe=Le(1,1,1),b8=un(.01,yl.local.ambientAtNight),ZJ=un(yl.local.directAtTwilight,yl.local.ambientAtTwilight),YJ=un(.9*yl.local.directAtNoon,yl.local.ambientAtNoon),eme=un(yl.local.directAtNoon,yl.local.ambientAtNoon),tme=YJ,ime=HJ,rme=WJ,sme=ZJ,nme=GJ,ome=qJ;function t_t(t,e,i){const r=t.valueOf();let s,n;e.polarException===Xl.PolarException.MIDNIGHT_SUN?(s=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=s+432e6):e.polarException===Xl.PolarException.POLAR_NIGHT?(s=r-2,n=r-1):(s=e.sunrise.valueOf(),n=e.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,h=a+l,d=.06*o,f=s-d/2,m=s+d/2,y=n-d/2,v=n+d/2,_=He(),b=$(),w=$();let x="";if(r<f||r>v)zn(_,b8),ne(b,v8),ne(w,_8),x="night";else if(r<m){const T=(r-f)/(m-f);Kh(_,b8,ZJ,T),dr(b,v8,GJ,T),dr(w,_8,qJ,T),x="sun rising"}else if(r<c){const T=(r-m)/(c-m);Kh(_,ZJ,YJ,T),dr(b,GJ,HJ,T),dr(w,qJ,WJ,T),x="early morning"}else if(r<a){const T=(r-c)/(a-c);Kh(_,YJ,eme,T),dr(b,HJ,Kfe,T),dr(w,WJ,Qfe,T),x="late morning"}else if(r<h){const T=(r-a)/(h-a);Kh(_,eme,tme,T),dr(b,Kfe,ime,T),dr(w,Qfe,rme,T),x="early afternoon"}else if(r<y){const T=(r-h)/(y-h);Kh(_,tme,sme,T),dr(b,ime,nme,T),dr(w,rme,ome,T),x="late afternoon"}else if(r<v){const T=(r-y)/(v-y);Kh(_,sme,b8,T),dr(b,nme,v8,T),dr(w,ome,_8,T),x="sun setting"}let S=0;switch(i){case"rainy":case"foggy":S=.8;break;case"snowy":S=.5}S>0&&(Xfe(b,S),Xfe(w,S));const C=cLe(i);return{direct:{intensity:_[0]*C.direct,color:b},ambient:{intensity:_[1]*C.ambient,color:w},timeOfDay:x}}const ame=Ve(),w8=$(),x8=$(),i_t=$(),S8=.25,r_t=.2;let Ah=class extends ws.EventedAccessor{constructor(){super(),this._tmpLightParameters=new Jfe,this._defaultLightParameters=new Jfe,this._tmpDate=new Date,this._tmpTz={hours:0,minutes:0,seconds:0},this._viewHandlesKey="viewHandles",this._trackingEnabled=!1,this._mainLight=new HU,this._ambientLight=new Ase,this._moonLight=new VPe,this._disableProjectionEngineAutoLoad=!1,this._disableWeather=!1,this._renderer=null,this._referencePositionGeographic=null,this._resetReferencePosition()}destroy(){this.disconnectView()}get _view(){return this._renderer?.view}get updating(){return!!this._renderer?.updating||!this._canProjectCameraPosition}get weatherEnabled(){return this._view?.environment.atmosphereEnabled&&!this._disableWeather&&this._view?.state?.viewingMode===Be.Global&&xV(this._view.spatialReference)}get _weatherAvailable(){return this.weatherEnabled&&this._renderer?.weatherAvailable}get referencePositionGeographic(){return this._referencePositionGeographic}get _canProjectCameraPosition(){const e=this._view?.stateManager?.camera?.position?.spatialReference??Ae.WGS84,i=Bfe(e);return this._disableProjectionEngineAutoLoad||M_(e,i)}connectView(e){if(this._renderer)return;this._renderer=new E1({view:e});const i=()=>this._updateRenderParameters(),r=()=>this._cameraHandler();this.addHandles([H(()=>e.environment.lighting,s=>this._updateLightingHandler(s),Gt),H(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,s=>this._lightingDateHandler(s),Gt),H(()=>e.environment.lighting.directShadowsEnabled,i,Gt),H(()=>e.qualitySettings.ambientOcclusion,i,Gt),H(()=>e.qualitySettings.reflections,i,Gt),H(()=>e.spatialReference,()=>this._resetReferencePosition(!0),Gt),H(()=>[e.environment.weather.type,this.weatherEnabled],()=>this._updateLighting(null,Nx.FadeWithWeather),Gt),H(()=>e.environment,s=>s.setComputeWeatherAvailable(()=>this._weatherAvailable),St),H(()=>e.viewingMode,()=>this._resetReferencePosition(!0),St),H(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),St),H(()=>e.state.camera,r,St),gn(()=>this._canProjectCameraPosition,r,Gt)],this._viewHandlesKey),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this.removeHandles(this._viewHandlesKey),this._resetReferencePosition(),this._renderer=Ce(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const i=this._view.environment.lighting;i?.type!=="virtual"&&(i.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const i=this._view.environment.lighting;if(i?.type!=="virtual"){if(e){if(!i.positionTimezoneInfo.autoUpdated&&(this._preupdateTracking(e),this._referencePositionGeographic!=null)){const r=Rfe(this._referencePositionGeographic,this._tmpTz);r!=null&&(i.autoUpdate(null,r),this._trackingEnabled&&(i.positionTimezoneInfo.autoUpdated=!0))}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const i=this._view;if(!i.ready)return;const r=i.stateManager.camera;if(!r)return;const{position:s}=r,n=s.spatialReference??Ae.WGS84,o=Bfe(n),a=this._referencePositionGeographic??$();if(!pc(s,a,o))return this._referencePositionGeographic=null,void this._updateLighting();this._referencePositionGeographic=a,this.notifyChange("referencePositionGeographic"),this._autoUpdateTimezone(a,e)||this._updateLighting(e)}_updateLighting(e,i=Nx.Immediate){const r=this._view,{lighting:s}=r.environment,n=s.type==="virtual",o=this._referencePositionGeographic,a=o!=null?this._tmpLightParameters:this._defaultLightParameters;if(o){e??=n?null:s.date;const m=this._weatherAvailable?r.environment.weather.type:"disabled";Z0t(e,o,r.state.viewingMode,m,r.state.camera,a)}else n&&lLe(r.state.camera,r.state.viewingMode,a.direct.directionToLightSource);const l=this._mainLight,c=a.direct;ie(l.intensity,c.color,c.intensity*Math.PI),ne(l.direction,c.directionToLightSource),l.specularStrength=a.specularStrength,l.environmentStrength=a.environmentStrength;const h=this._ambientLight;ie(h.intensity,a.ambient.color,a.ambient.intensity);const d=this._moonLight;dr(d.intensity,s_t,n_t,a.globalFactor);const f=(1-.5*a.globalFactor)*(1-.4*a.noonFactor*(1-a.globalFactor));ie(d.intensity,d.intensity,f),ne(d.direction,c.directionToLightSource),this._view._stage.renderer.updateLighting([l,h,d],a.noonFactor,a.globalFactor,this._weatherAvailable?i:Nx.Immediate),this._updateRenderParameters()}_autoUpdateTimezone(e,i=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;const r=this._tmpDate;r.setTime((i||this._view.environment.lighting.date).getTime());const s=Rfe(e,this._tmpTz);if(s==null)return!1;let n=this._view.environment.lighting.positionTimezoneInfo;if(n.autoUpdated){if(n.hours===s.hours&&n.minutes===s.minutes&&n.seconds===s.seconds)return!1}else n=s;const o=r.getUTCHours()-(s.hours-n.hours),a=r.getUTCMinutes()-(s.minutes-n.minutes),l=r.getUTCSeconds()-(s.seconds-n.seconds);return r.setUTCHours(o),r.setUTCMinutes(a),r.setUTCSeconds(l),!i&&this._view.environment.lighting.autoUpdate(r,s)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const i=this._referencePositionGeographic==null||J0t(this._referencePositionGeographic[2],this._view.state.viewingMode);e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&i,environment:this._view.environment,weatherVisible:this._weatherAvailable,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._referencePositionGeographic=null,e&&this._cameraHandler()}get test(){}};u([p({type:Boolean,readOnly:!0})],Ah.prototype,"updating",null),u([p()],Ah.prototype,"_disableProjectionEngineAutoLoad",void 0),u([p()],Ah.prototype,"_disableWeather",void 0),u([p()],Ah.prototype,"weatherEnabled",null),u([p()],Ah.prototype,"_weatherAvailable",null),u([p()],Ah.prototype,"referencePositionGeographic",null),u([p()],Ah.prototype,"_renderer",void 0),u([p()],Ah.prototype,"_referencePositionGeographic",void 0),u([p()],Ah.prototype,"_canProjectCameraPosition",null),Ah=u([A("esri.views.3d.environment.EnvironmentManager")],Ah);const s_t=Le(.22,.22,.33),n_t=Le(.22,.22,.22);var JJ;let Mh=JJ=class extends ee{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,i){e[i]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,i){t&&(e[i]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new JJ(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};u([p({readOnly:!0,type:["sun"],json:{write:!0}})],Mh.prototype,"type",void 0),u([p({type:Date,json:{type:Number,write:{target:"datetime"}}})],Mh.prototype,"date",void 0),u([me("date",["datetime"])],Mh.prototype,"readDate",null),u([ge("date")],Mh.prototype,"writeDate",null),u([p({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Mh.prototype,"directShadowsEnabled",void 0),u([me("directShadowsEnabled",["directShadows"])],Mh.prototype,"readDirectShadowsEnabled",null),u([ge("directShadowsEnabled")],Mh.prototype,"writedirectShadowsEnabled",null),u([p({type:Number,json:{write:!0}})],Mh.prototype,"displayUTCOffset",void 0),u([ge("displayUTCOffset")],Mh.prototype,"writeDisplayUTCOffset",null),Mh=JJ=u([A("esri.webscene.SunLighting")],Mh);const mS=Mh;var VE;let H0=VE=class extends ws.EventedMixin(mS){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),i=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new VE(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const i=VE.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let r=null;t!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(r=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(r=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const s=VE.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==s&&(VN.target=this,VN.timezoneOffset=s,this.emit("timezone-will-change",VN),VN.target=null),t!=null)return isNaN(t.getTime())||r!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new VE({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([p({type:Boolean})],H0.prototype,"cameraTrackingEnabled",void 0),u([p({type:Date})],H0.prototype,"defaultDate",null),u([p({type:Date})],H0.prototype,"date",null),H0=VE=u([A("esri.views.3d.environment.SunLighting")],H0),function(t){function e({hours:i,minutes:r,seconds:s}){return Math.round(i+r/60+s/3600)}t.calculateTimezoneOffset=e}(H0||(H0={}));const VN={target:null,timezoneOffset:0},C1=H0;var XJ;let vI=XJ=class extends ee{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new XJ(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};u([p({readOnly:!0,type:["virtual"],json:{write:{isRequired:!0}}})],vI.prototype,"type",void 0),u([p({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],vI.prototype,"directShadowsEnabled",void 0),vI=XJ=u([A("esri.webscene.VirtualLighting")],vI);const HD=vI;var q4;let W4=q4=class extends ws.EventedMixin(HD){constructor(t){super(t),this.cameraTrackingEnabled=!0}clone(){return new q4({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new q4(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([p({type:Boolean})],W4.prototype,"cameraTrackingEnabled",void 0),W4=q4=u([A("esri.views.3d.environment.VirtualLighting")],W4);const _I=W4,o_t={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:C1,virtual:_I}},uLe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:mS,virtual:HD}};let Z4=class extends ee{constructor(e){super(e)}clone(){throw new Error("Subclasses of Background should implement their own clone method.")}};u([p({readOnly:!0,json:{read:!1}})],Z4.prototype,"type",void 0),Z4=u([A("esri.webscene.background.Background")],Z4);const hLe=Z4;var KJ;let bI=KJ=class extends hLe{constructor(t){super(t),this.type="color",this.color=new qe([0,0,0,1])}clone(){return new KJ(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};u([Ue({color:"color"},{readOnly:!0})],bI.prototype,"type",void 0),u([p(Mv({nonNullable:!0}))],bI.prototype,"color",void 0),bI=KJ=u([A("esri.webscene.background.ColorBackground")],bI);const dLe=bI,lme={base:hLe,key:"type",typeMap:{color:dLe}};function a_t(t){return(e,i,r)=>{if(!e)return e;for(const s in t.typeMap)if(e.type===s){const n=new t.typeMap[s];return n.read(e,r),n}}}const l_t={types:lme,json:{read:a_t(lme),write:{overridePolicy:(t,e,i)=>({enabled:!i?.isPresentation})}}};var QJ;const cme=(t,e,i)=>({enabled:!i?.isPresentation});let q0=QJ=class extends ee{constructor(t){super(t),this.lighting=new mS,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){Smt(t?.type,J.getLogger(this))&&this._set("weather",t)}clone(){return new QJ(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?HD.prototype.clone.call(this.lighting):mS.prototype.clone.call(this.lighting),background:q(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};u([p({types:uLe,nonNullable:!0,json:{write:!0}})],q0.prototype,"lighting",void 0),u([p(l_t)],q0.prototype,"background",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:cme}}})],q0.prototype,"atmosphereEnabled",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:cme}}})],q0.prototype,"starsEnabled",void 0),u([p({types:Lse,nonNullable:!0,json:{write:!0},value:new JU})],q0.prototype,"weather",null),q0=QJ=u([A("esri.webscene.Environment")],q0);const W$=q0;var wI;let $1=wI=class extends W${constructor(t){super(t),this.lighting=this.castLighting(),this._computeWeatherAvailable=void 0,this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new wI({...e,lighting:e.lighting?e.lighting.type==="virtual"?_I.fromWebsceneLighting(e.lighting):C1.fromWebsceneLighting(e.lighting):void 0})}get weatherAvailable(){return this._computeWeatherAvailable?.()??!1}setComputeWeatherAvailable(t){this._computeWeatherAvailable=t}castLighting(t){return this._convertLightingWithDestroy(t)}applyLighting(t){this.lighting=this._convertLightingWithDestroy(t)}_convertLightingWithDestroy(t){const e=this._convertLighting(t);return e!==t&&this.addHandles(M1e(e)),e}_convertLighting(t){return t?t instanceof C1||t instanceof _I?t:t instanceof mS?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new C1({...t.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):t instanceof HD?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new _I({...t.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):Sd(o_t,t):new C1}clone(){return new wI({lighting:this.lighting.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:q(this.background)})}cloneWithWebsceneEnvironment(t){return new wI({weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:q(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):C1.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):_I.fromWebsceneLighting(t.lighting);default:return t.lighting,C1.fromWebsceneLighting(t.lighting)}}};u([p({nonNullable:!0})],$1.prototype,"lighting",void 0),u([p()],$1.prototype,"_computeWeatherAvailable",void 0),u([p({readOnly:!0})],$1.prototype,"weatherAvailable",null),u([Yt("lighting")],$1.prototype,"castLighting",null),$1=wI=u([A("esri.views.3d.environment.SceneViewEnvironment")],$1);const jE=$1;var Nr;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(Nr||(Nr={}));var Kt;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(Kt||(Kt={}));var tg;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})(tg||(tg={}));let hh=class{constructor(e=Nr.ALL,i=Kt.NONE,r=0,s=null,n=null,o=tg.TUMBLE){this.selection=e,this.interactionType=i,this.interactionFactor=r,this.interactionStartCamera=s,this.interactionDirection=n,this.tiltMode=o}};function u3(t,e){return!!(t&e)}function sB(t,e,i,r,s,n){t!==0&&(i?(n.min=Math.min(n.min,e),n.max=Math.max(n.max,e)):r!=null?(n.min-=Math.max(0,(e-n.min)*(1-r)),n.max+=Math.max(0,(e-n.max)*(1-r))):s&&(n.min-=Math.max(0,e-n.min-s),n.max+=Math.max(0,e-n.max-s)))}const WS=new hh(Nr.NONE);function pLe(t,e,i,r){return e=e||t.viewForward,ne(r,e),ie(r,r,Math.sign(de(e,i))),r}function Vti(t,e,i,r){return p_t(t,e,i,h_t(r,e,i,!0))}function c_t(t,e,i,r){const s=de(i,ye(t,r,e));return oe(t,e,ie(t,i,s))}const u_t={dir:$(),len:0,clip:He()};function h_t(t,e,i,r){const s=u_t;return t?(i&&r&&(s.len=xr(e,i)),ne(s.dir,t)):(s.len=xr(e,i),ye(s.dir,i,e),ie(s.dir,s.dir,1/s.len)),s}function d_t(t,e,i){const r=de(t,i.dir),s=-rn(t,e);if(s<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return s>0;if((s<0||r<0)&&!(s<0&&r<0))return!0;const n=s/r;return r>0?n<i.clip[1]&&(i.clip[1]=n):n>i.clip[0]&&(i.clip[0]=n),i.clip[0]<=i.clip[1]}function p_t(t,e,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let s=0;s<t.length;s++)if(!d_t(t[s],e,r))return!1;return!0}function f_t(t,e,i=WS){const r=une(t,e,i);if(r===0)return!1;const s=t.renderCoordsHelper,n=s.getAltitude(e.eye)+r,o=pLe(e,i.interactionDirection,y_t(t,e,Math.sign(r),w_t),b_t),a=ne(x_t,e.viewForward),l=s.intersectInfiniteManifold(mf(e.eye,o),n,T8);return e.eye=l??s.setAltitude(T8,n,e.eye),e.center=c_t(T8,e.eye,a,e.center),!0}function une(t,e,i=WS){if(!m_t(t,i)||!t.state.constraints.altitude)return 0;const r=v_t(t.state.constraints.altitude,__t);g_t(t,i,r);const s=t.renderCoordsHelper.getAltitude(e.eye),n=ce(s,r.min,r.max)-s;return Math.abs(n)<=1e-6?0:n}function m_t(t,e){const i=t.state.constraints.altitude;return!(!t.state.isGlobal||!i)&&(e.interactionType!==Kt.TUMBLE||!u3(e.selection,Nr.TILT))}function g_t(t,e,i){const r=e.interactionType;if(r===Kt.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=r===Kt.TUMBLE||r===Kt.ZOOM,c=une(t,o),h=c===0?0:t.renderCoordsHelper.getAltitude(o.eye);i.min=s,i.max=n,sB(c,h,l,a,.05*h,i)}function y_t(t,e,i,r){return t.renderCoordsHelper.worldUpAtPosition(e.eye,r),ie(r,r,i),r}function v_t(t,e){return e.min=t.min,e.max=t.max,e}const __t={min:0,max:0},b_t=$(),w_t=$(),x_t=$(),T8=$();function hne(t,e,i=WS){if(!t.state.isLocal)return 0;const r=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;jN.min=0,jN.max=r,T_t(t,i,jN);const s=dne(t,e),n=jN.max-s;return n>=-1e-6?0:n}function S_t(t,e,i=WS){const r=hne(t,e,i);if(r===0)return!1;const s=t.pointsOfInterest.surfaceOrigin;if(!s.renderLocation)return!1;const n=dne(t,e)+r,o=ne(C_t,e.eye),a=pLe(e,i.interactionDirection,E_t(e,s.renderLocation,M_t),A_t);if(!Wb(XOe(s.renderLocation,n),mf(e.eye,a),GN))return!1;e.eye=GN;const l=ye($_t,e.eye,o);e.center=oe(GN,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),h=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,GN);return h!=null&&(e.center=h),!0}function T_t(t,e,i){const r=e.interactionType;if(r===Kt.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=r===Kt.ZOOM||r===Kt.PAN,c=hne(t,o),h=c===0?0:dne(t,o);i.min=s,i.max=n,sB(c,h,l,a,.05*h,i)}function dne(t,e){const i=t.pointsOfInterest.surfaceOrigin;return i.renderLocation?xr(e.eye,i.renderLocation):0}function E_t(t,e,i){return kS(i,t.eye,e)}const jN={min:0,max:0},C_t=$(),$_t=$(),A_t=$(),M_t=$(),GN=$();function zA(t,e,i=vd.EYE){const r=t.state.constraints;if(!r.collision.enabled)return!1;const s=lG(t,e.eye),n=t.renderCoordsHelper.getAltitude(e.eye),o=s+r.collision.elevationMargin;if(n>=o)return!1;const a=Te(e.eye);if(ye(HN,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(O_t,o,e.eye),i===vd.EYE_AND_CENTER)e.center=oe(HN,e.eye,HN);else if(i===vd.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;e.center=ie(HN,e.center,l)}return!0}var vd;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(vd||(vd={}));const HN=$(),O_t=$();function fLe(t,e,i,r=!0){FM.eyeCenterDistance=0,FM.requiresTwoSteps=!1;const s=pne(t,e,i,WS,FM);if(s===0)return!1;switch(Ad(qN,-s,e.viewRight),i.tiltMode){case tg.LOOK_AROUND:st(d0,e.viewForward,qN),ie(d0,d0,FM.eyeCenterDistance),e.center=oe(I_,e.eye,d0);break;case tg.TUMBLE:ye(d0,e.center,e.eye),st(d0,d0,qN),e.eye=ye(I_,e.center,d0);break;default:i.tiltMode}return e.up=st(I_,e.up,qN),!FM.requiresTwoSteps||!r||fLe(t,e,i,!1)}function pne(t,e,i,r=WS,s){if(!t.state.constraints.tilt)return 0;const n=Math.min(e.relativeElevation*Y4,e.distance),o=t.state.constraints.tilt(n,U_t);return z_t(t,i,o),r.interactionType===Kt.TUMBLE&&u3(r.selection,Nr.ALTITUDE)&&mLe(t,r.interactionStartCamera,o),i.tiltMode===tg.LOOK_AROUND||r.tiltMode===tg.LOOK_AROUND?R_t(t,e,o,s):I_t(t,e,o)}function I_t(t,e,i){const r=_v(t.renderCoordsHelper,e.center,e.eye),s=r-ce(r,i.min,i.max);return h3(s)?s:0}function R_t(t,e,i,r){switch(r&&(r.requiresTwoSteps=!1),t.viewingMode){case"global":return D_t(t,e,i,r);case"local":return P_t(t,e,i,r)}}function P_t(t,e,i,r){const s=_v(t.renderCoordsHelper,e.center,e.eye),n=ce(s,i.min,i.max),o=s-n;if(!h3(o))return 0;if(r){const a=Math.abs(t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude),l=t.renderCoordsHelper.getAltitude(e.eye)-a,c=Math.max(Math.cos(n),1e-4);Math.abs(c)>1e-4?r.eyeCenterDistance=l/c:r.eyeCenterDistance=e.distance}return o}function D_t(t,e,i,r){const s=L_t(t,e,B_t),n=ce(s.tiltAtCenter,i.min,i.max);if(!h3(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=N_t(s),a=F_t(s,o)):(o=s.constraints.clampTilt(s.distance,s.tiltAtCenter),r&&o<Math.PI/2&&(r.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=k_t(s,o)),r&&(r.eyeCenterDistance=eX(s,o)),a}function L_t(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=r+gr(t.spatialReference).radius,n=t.renderCoordsHelper.intersectManifold(e.ray,r,I_);return i.distance=Math.min(e.relativeElevation*Y4,e.distance),i.centerIsOnSurface=!1,n!=null?(i.distance=Math.min(e.relativeElevation*Y4,xr(e.eye,n)),i.tiltAtCenter=_v(t.renderCoordsHelper,n,e.eye),i.centerIsOnSurface=!0):t.state.isLocal?i.tiltAtCenter=_v(t.renderCoordsHelper,e.center,e.eye):(DA(PA(Ej,s),e.ray,I_),i.distance=Math.min(e.relativeElevation*Y4,xr(e.eye,I_)),i.tiltAtCenter=Za(-de(e.viewForward,ae(I_,I_)))),i.radius=s,i.eyeRadius=Te(e.eye),i.constraints=t.state.constraints,i}function h3(t){return Math.abs(t)>1e-9}function N_t(t){const{constraints:e,distance:i,tiltAtCenter:r}=t;let s=r,n=e.clampTilt(i,r);const o=eX(t,n);if(e.clampTilt(o,r)===n)return n;let a=0;for(;a<10&&h3(n-s);){const l=(s+n)/2,c=eX(t,l);h3(e.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function eX(t,e){if(!t.centerIsOnSurface)return t.distance;const i=Math.PI-ce(e,0,Math.PI),r=Td(t.radius/t.eyeRadius*Math.sin(i)),s=Math.PI-i-r,n=Math.sin(s)/Math.sin(i);if(t.eyeRadius<t.radius&&n>1){const o=Math.PI-r,a=Math.PI-i-o;return Math.sin(a)/Math.sin(i)*t.eyeRadius}return n*t.eyeRadius}function F_t(t,e){const i=Td(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),r=Td(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?i-r:r-i}function k_t(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function z_t(t,e,i){if(e.interactionType===Kt.NONE)return;const{interactionStartCamera:r,interactionFactor:s}=e;if(!r)return;const{min:n,max:o}=i,a=pne(t,r,WS,e),l=a===0?0:_v(t.renderCoordsHelper,r.center,r.eye);i.min=n,i.max=o,e.interactionType===Kt.TUMBLE?(u3(e.selection,Nr.ALTITUDE)&&mLe(t,r,i),sB(a,l,!0,s,ume,i)):sB(a,l,!1,s,ume,i)}function mLe(t,e,i){const r=t.state.constraints;if(t.state.isLocal||!r.altitude||!e)return;const s=Yo(e.center),n=Math.sqrt(s),o=e.distance,a=gr(t.spatialReference).radius,l=r.altitude.min+a,c=r.altitude.max+a,h=(l*l-o*o-s)/(-2*n*o),d=(c*c-o*o-s)/(-2*n*o);i.min=Math.max(i.min,Math.min(Math.PI-Za(d),i.max)),i.max=Math.min(i.max,Math.PI-Za(h))}const d0=$(),qN=Ve(),I_=$(),ume=wt(5),Y4=30,U_t={min:0,max:0},B_t={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,distance:0,tiltAtCenter:0},FM={eyeCenterDistance:0,requiresTwoSteps:!1};function Os(t,e,i=H_t,r=e){r!==e&&r.copyFrom(e),r.computeUp(t.state.viewingMode);let s=!1;for(let a=0;a<q_t;a++){let l=0;for(const c of G_t)if(u3(i.selection,c.type)){const h=Math.abs(c.error(t,r,i));c.apply(t,r,i)&&(s=!0,l+=h)}if(l===0)break}const n=u3(i.selection,Nr.COLLISION),o=V_t(i.interactionType,t);return n&&zA(t,r,o)&&(s=!0),s&&r.computeUp(t.state.viewingMode),s}function V_t(t,e){switch(t){case Kt.PAN:return vd.EYE_AND_CENTER;case Kt.ASCEND:return e.state.isGlobal?vd.EYE_AND_CENTER_SCALE:vd.EYE_AND_CENTER;default:return vd.EYE}}function nd(t){const e=Math.min(1,t/150);return BAe(e)}function j_t(t,e,i){return pne(t,e,i)*e.distance}const G_t=[{type:Nr.TILT,error:j_t,apply:fLe},{type:Nr.ALTITUDE,error:une,apply:f_t},{type:Nr.DISTANCE,error:hne,apply:S_t}],H_t=new hh,q_t=5;let hme=class{get pitch(){return this._pitch}get yaw(){return this._yaw}get distance(){return this._distance}get fov(){return this._fov}get size(){return this._size}constructor(e){this.viewingMode=e,this.center=$(),this._pitch=0,this._yaw=0,this._distance=0,this.direction=is(dme),this._fov=55,this._size=1}pixelsPerPanAtZoom(e){return this._size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this._size/2/(this._zoomToPanScale*e)}pixelsPerRotate(){const e=Math.max(Math.cos(Math.abs(this._pitch)),.5);return this._size/2/e}compareTo(e,i){if(this.viewingMode===Be.Global){const n=(Te(this.center)+Te(e.center))/2;i.pan=wj(this.center,e.center)*n}else i.pan=xr(this.center,e.center);let r=Math.abs(e._yaw-this._yaw);r>=Math.PI&&(r=2*Math.PI-r);const s=Math.abs(e._pitch-this._pitch);i.rotate=Math.max(r,s),i.fov=e.fov-this.fov,i.sourceZoom=this._distance,i.targetZoom=e._distance}interpolate(e,i,r){this.viewingMode===Be.Global?DOe(e.center,i.center,r.pan,this.center):dr(this.center,e.center,i.center,r.pan),this._distance=isFinite(i.distance)?dt(e.distance,i.distance+r.zoomOffset,r.zoom):e.distance,this._pitch=dt(e.pitch,i.pitch,r.rotate);let s=e._yaw;const n=i._yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this._yaw=dt(s,n,r.rotate),this._fov=dt(e.fov,i.fov,r.fov)}copyFrom(e){ne(this.center,e.center),this._pitch=e.pitch,this._yaw=e.yaw,this._distance=e.distance,ne(this.direction,e.direction),this._size=e.size,this._fov=e.fov,this._zoomToPanScale=Math.atan(.5*this._fov),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const i=this._lookAtOrientation(e.center,pme);ne(this.center,e.center),ye(ra,e.center,e.eye),ac(ra,ra,i),ac(f0,e.up,i),this._distance=Te(ra),this._distance!==0&&(ra[0]/=this._distance,ra[1]/=this._distance,ra[2]/=this._distance),this._pitch=W_t(ra),this._yaw=Z_t(ra,f0),this._size=Math.sqrt(e.width*e.width+e.height*e.height),this._fov=e.fov,this._zoomToPanScale=Math.atan(.5*this._fov)}copyToRenderCamera(e){const i=this._lookAtOrientation(this.center,pme);OA(i,i),this._axisAngleVec3(J4,this._pitch-Math.PI/2,dme,ra),this._axisAngleVec3(vx,this._yaw,ra,ra),this._axisAngleVec3(J4,this._pitch-Math.PI/2,vx,f0),this._axisAngleVec3(vx,this._yaw,f0,f0),ie(ra,ra,this._distance),ac(ra,ra,i),ac(f0,f0,i),e.center=this.center,e.eye=ye(ra,this.center,ra),e.up=f0,e.fov=this._fov}_axisAngleVec3(e,i,r,s){const n=Math.cos(i),o=Math.sin(i);return ie(mu,r,n),lt(Lc,e,r),ie(Lc,Lc,o),ie(p0,e,(1-n)*de(e,r)),oe(s,oe(s,mu,Lc),p0)}_lookAtOrientation(e,i=xs()){return this._upAtLookAt(e,p0),lt(mu,this.direction,p0),ae(mu,mu),mu[0]===0&&mu[1]===0&&mu[2]===0&&ne(mu,J4),lt(Lc,p0,mu),ae(Lc,Lc),i[0]=mu[0],i[1]=Lc[0],i[2]=p0[0],i[3]=mu[1],i[4]=Lc[1],i[5]=p0[1],i[6]=mu[2],i[7]=Lc[2],i[8]=p0[2],i}_upAtLookAt(e,i){return this.viewingMode===Be.Local?ne(i,vx):ae(i,e)}};function W_t(t){return Math.PI-wj(vx,t)}function Z_t(t,e){const i=Y_t;return Math.abs(e[2])<.5?(ne(i,e),t[2]>0&&ie(i,i,-1)):ne(i,t),lt(Lc,i,vx),ae(Lc,Lc),wj(J4,Lc,vx)}const mu=$(),Lc=$(),p0=$(),ra=$(),f0=$(),Y_t=$(),vx=f$,dme=Dte,J4=Pte,pme=xs();let J_t=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new ZAe(()=>new hme(e)),this._current=new hme(e)}update(e,i,r){const{source:s,target:n}=this._animation.definition,o=ye(X_t,i.center,e.center),a=Te(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),ne(s.direction,o),ne(n.direction,o),s.copyFromRenderCamera(e),n.copyFromRenderCamera(i),this._current.copyFrom(s),this._animation.update(s,n,r),this.currentTime=0,e.almostEquals(i)&&(this.currentTime=this._animation.time)}cameraAt(e,i){this._animation.cameraAt(e,this._current),this._current.copyToRenderCamera(i)}step(e,i){this.finished||(this.currentTime=this.currentTime+ixe(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,i)}};const X_t=$();var Vr;(function(t){t[t.Ready=0]="Ready",t[t.Rejected=1]="Rejected",t[t.Running=2]="Running",t[t.Stopped=3]="Stopped",t[t.Finished=4]="Finished"})(Vr||(Vr={}));let Dy=class extends ue{constructor(e){super(e),this.state=Vr.Ready}get running(){return this.state===Vr.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=Vr.Stopped,!0)}finishController(){this.state=Vr.Finished}get steppingFinished(){return!1}};u([p({constructOnly:!0})],Dy.prototype,"view",void 0),u([p({readOnly:!0})],Dy.prototype,"running",null),u([p()],Dy.prototype,"state",void 0),u([p({readOnly:!0})],Dy.prototype,"isInteractive",null),Dy=u([A("esri.views.3d.state.controllers.CameraController")],Dy);let d3=class extends Dy{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(vi()),this._asyncResult=null),this.state===Vr.Finished||this.state===Vr.Stopped?(mV(e),this.state===Vr.Finished?e.resolve():e.reject(vi())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=Vr.Running,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!this.viewAnimation||this.state!==Vr.Ready&&this.state!==Vr.Running||(this.viewAnimation.state===cv.State.FINISHED?this.finish():this.viewAnimation.state===cv.State.STOPPED&&(this.state=Vr.Stopped))}onControllerEnd(e){this.viewAnimation==null||this.viewAnimation.done||(this.state===Vr.Finished?this.viewAnimation.finish():this.state===Vr.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===Vr.Finished?this._asyncResult.resolve():this._asyncResult.reject(vi()))}finish(){this.finishController()}};d3=u([A("esri.views.3d.state.controllers.AnimationController")],d3);let _x=class extends d3{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.type="point-to-point",this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new J_t(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new cv}get isInteractive(){return this.mode==="interaction"}begin(e,i){this._hasTarget=!0;const r=this.animationSettings(i);WN.copyFrom(this.view.state.camera);const s=lh(this.view.state.viewingMode);this._intersectionHelper.intersectRay(WN.ray,s,fme)&&(WN.center=fme),this.animation.update(WN,e,r),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,i){this._hasTarget&&this.animation.step(e,i)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?uY[e.easing]:e.easing}}};u([p({constructOnly:!0})],_x.prototype,"mode",void 0),u([p({readOnly:!0})],_x.prototype,"isInteractive",null),_x=u([A("esri.views.3d.state.controllers.PointToPointAnimationController")],_x);const WN=new jr,fme=$();function mme(t){return t!=null&&"type"in t&&t.type==="point-to-point"}function dG(t=Q_t){return[t[0],t[1],t[2],t[3]]}function p3(t,e){return K_t(t[0],t[1],t[2],e,ire.get())}function K_t(t,e,i,r,s=dG()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function fne(t,e,i){return lt(i,t,e),ae(i,i),i[3]=ore(t,e),i}const Q_t=[0,0,1,0];function Zti(t,e,i=Pn()){return mne(t,jp(e),i),ae(i.direction,i.direction),i}function mne(t,e,i){return ebt(t,t.screenToRender(e,Ne.get()),i)}function ebt(t,e,i){const r=zn(Ne.get(),e);if(r[2]=0,!t.unprojectFromRenderScreen(r,i.origin))return null;const s=zn(Ne.get(),e);s[2]=1;const n=t.unprojectFromRenderScreen(s,Ne.get());return n==null?null:(ye(i.direction,n,i.origin),i)}function UA(t,e,i){return gne(t,t.screenToRender(e,Ne.get()),i)}function gne(t,e,i){ne(i.origin,t.eye);const r=se(Ne.get(),e[0],e[1],1),s=t.unprojectFromRenderScreen(r,Ne.get());return s==null?null:(ye(i.direction,s,i.origin),i)}function yne(t,e,i,r){const s=UA(e,i,tbt);return Wb(t,s,r)}const tbt=Pn();var Z$;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})(Z$||(Z$={}));const gLe=30,nB=[1,3e8],qD=80,yLe=8,vLe=200,_Le=1508e5,bLe=5,wLe=50,ibt=5,rbt=10,E8=90,ZS={exclude:new Set([Ob])};function Fx(t,e,i){return i[0]=e[0]/(t.fullWidth/t.pixelRatio),i[1]=e[1]/(t.fullHeight/t.pixelRatio),i}function tX(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function Pb(t,e,i){const r=Ad(rre.get(),i[3],i);r==null||N2e(r,Kn)||(ye(hr,t.eye,e),st(hr,hr,r),t.eye=oe(hr,hr,e),ye(hr,t.center,e),st(hr,hr,r),t.center=oe(hr,hr,e),t.up=st(hr,t.up,r))}function sbt(t,e,i,r){return RA(t,mne(e,i,bne),r)}function iX(t,e,i,r){return RA(t,UA(e,i,bne),r)}function vne(t,e,i,r){const s=Ne.get();let n=1-i;ye(s,e,t.eye);const o=Te(s);let a=o*(1-n);n>=0&&a<r&&(a=r,n=-(a-o)/o),Math.abs(o-a)<1e-6||(ie(s,s,n),t.eye=oe(hr,t.eye,s),t.center=dr(hr,t.center,e,n))}function xLe(t,e,i){e.getScreenCenter(gme),yne(t,e,gme,hr)&&(e.center=hr);const r=e.distance,s=r*i;if(Math.abs(r-s)<1e-6)return;const n=ie(Ne.get(),e.viewForward,s);e.eye=ye(hr,e.center,n)}const gme=nn();function C8(t,e){se(e,0,0,0);for(const i of t)oe(e,e,i);ie(e,e,1/t.length)}function X4(t,e,i,r){return Math.sin(t/Te(e))*(i+r.radius)}function yme(t,e,i,r){return X4(Math.PI/2,e,i,r)+(t-Math.PI/2)}var va;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(va||(va={}));const vme={Elevation:3e4,Angle:wt(16)},SLe=wt(80);function TLe(t,e,i,r,s,n){const o=$(),a=Rs();let l=!0,c=!0;return t.intersectScreen(i,o,n)?a[3]=Te(o):(c=!1,e.aboveGround&&s!==Z$.Ellipsoid?a[3]=Math.max(Te(e.center),.9*r.radius):a[3]=Te(e.eye)-e.relativeElevation,s===Z$.Silhouette?f3(a,e,i,o):l=yne(a,e,i,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function WD(t,e,i,r){const s=t.relativeElevation;if(s>vme.Elevation&&r==="global")return va.Horizontal;UA(t,e,A8);const n=Math.sign(s),o=i.worldUpAtPosition(t.eye,hr);return-n*de(o,A8.direction)<Math.sin(vme.Angle)*Te(A8.direction)?va.Vertical:va.Horizontal}function ELe(t,e,i){ye($8,i,e),t.eye=ye(hr,t.eye,$8),t.center=ye(hr,t.center,$8)}const $8=$();function f3(t,e,i,r){const s=UA(e,i,bne);return s!=null&&(DA(t,s,ZN),Wb(t,s,r)?!(ro(ZN,s.origin)<ro(r,s.origin))||(ne(r,ZN),!1):(ye(FT,e.eye,e.center),ae(FT,FT),LOe(FT,-de(ae(FT,FT),ZN),_me),RA(_me,s,r),!1))}const ZN=$(),FT=$(),_me=Br();function CLe(t,e,i,r,s,n){let o=0;if(lt(lB,t,e),ye(KN,t,e),Te(t)<=s||!r.aboveGround){lt(i,KN,r.eye);const a=de(t,e)/(Te(t)*Te(e));if(a<.9999)o=Za(a);else{const c=Te(lt($(),t,e))/(Te(t)*Te(e));o=Td(c)}const l=Math.cos(ce(mb.normalize(wt(n)),0,SLe));o=-o-Math.max(0,Te(e)-s)/(l*s)}else ye(bme,r.eye,r.center),lt(i,KN,bme),o=-Te(KN)/s;return ae(i,i),ie(i,i,Te(lB)),o}const bme=$();function wme(t,e,i,r){let s,n;const o=Math.cos(ce(mb.normalize(wt(r)),0,SLe));return s=e>i?-(e-i)/(o*i):e<-i?Math.PI-(e+i)/(o*i):Za(e/i),n=t>i?-(t-i)/(o*i):t<-i?Math.PI-(t+i)/(o*i):Za(t/i),(n-s)*i}function nbt(t,e,i,r,s,n,o,a,l,c){const h=wme(t[2],e[2],n[3],a),d=l?wme(t[0],e[0],n[3],180):e[0]-t[0],f=Math.sin(o)*d-Math.cos(o)*h,m=Math.cos(o)*d+Math.sin(o)*h;ae(hr,s);const y=l?f/Math.sqrt(Math.abs(n[3]**2-de(i,hr)**2)):f/n[3],v=m/Math.sqrt(Math.abs(n[3]**2-de(i,r)**2));li(c,y,v)}function $Le(t,e,i,r,s,n,o,a,l,c){lt(lB,t,e),TY(n.up,n.eye,YN,JN,XN),TY([0,0,1],n.eye,Ky,ub,ILe),ne(i,ub),ne(r,Ky),ae(i,i),ie(i,i,Te(lB)),vde(t,ae(JN,JN),ae(XN,XN),ae(YN,YN),xme),vde(e,JN,XN,YN,Sme),nbt(xme,Sme,t,Ky,ub,o,a,l,c,s)}function obt(t,e,i,r,s,n,o){Ad(oB,s,r),Ad(aB,o,n),kn(Q2,oB,aB),ye(e,t,i),st(e,e,Q2),oe(e,e,i)}function ALe(t,e,i,r,s,n){Ad(oB,r,i),Ad(aB,n,s),kn(Q2,oB,aB),ye(hr,t.eye,e),st(hr,hr,Q2),t.eye=oe(hr,hr,e),ye(hr,t.center,e),st(hr,hr,Q2),t.center=oe(hr,hr,e),ye(hr,t.up,e),st(hr,hr,Q2),t.up=oe(hr,hr,e)}const $w={Pole:.95,Angle:wt(18),Tilt:45,TiltHysteresisMargin:1e-7};let kT=!1;function _ne(t,e,i,r,s,n){const o=Math.abs(r)>Math.PI-$w.Angle||Math.abs(r)<$w.Angle,a=(Math.abs(t[2])<i*$w.Pole||Math.abs(e)>i)&&n;return o&&a?!kT&&s<$w.Tilt-$w.TiltHysteresisMargin?kT=!0:kT&&s>$w.Tilt+$w.TiltHysteresisMargin&&(kT=!1):kT=!1,kT}function MLe(t,e,i,r,s,n){if(n)fne(i,r,Tme),Pb(e,t,Tme);else{const o=CLe(i,r,Eme,e,t[3],s);Pb(e,t,p3(Eme,o))}}function OLe(t,e,i,r,s,n,o){const a=o?20:1,l=1e-12;let c,h;ne(Aw,r),QN.copyFrom(e);for(let d=0;d<a&&ro(i,Aw)>l&&(c=ro(i,Aw),$Le(i,Aw,ub,Ky,kM,QN,t,s,n,o),ALe(QN,t,Ky,kM[1],ub,kM[0]),obt(Aw,Aw,t,Ky,kM[1],ub,kM[0]),h=ro(i,Aw),h<c||d===0);d++)e.copyFrom(QN)}function abt(t,e,i,r,s,n,o){_ne(i,de(e.up,i),t[3],-mb.normalize(wt(s)),n,e.aboveGround)?OLe(t,e,i,r,-mb.normalize(wt(s)),n,o):MLe(t,e,i,r,n,o)}function lbt(t,e,i,r,s,n){const{eye:o}=t;TY([0,0,1],o,Ky,ub,ILe);const a=e.translation[0]*i.pan,l=s.mode==="zoom"?0:e.translation[1]*i.pan,c=Math.max(Math.sqrt(Math.abs(1-de(t.center,Ky)**2/Te(t.center)**2)),.5),h=(Math.sin(n)*l+Math.cos(n)*a)/c,d=-Math.cos(n)*l+Math.sin(n)*a;switch(Wu(r.pan.matrix,r.pan.matrix,h,Ky),r.pan.enabled=!0,s.mode){case"pan":Wu(r.pan.matrix,r.pan.matrix,d,ub),r.pan.enabled=!0;break;case"zoom":r.zoom=-e.translation[1]*i.zoom}}function cbt(t,e,i,r,s){const{eye:n,viewRight:o}=t,a=lt(Ne.get(),o,n),l=e.translation[0]*i.pan;switch(l!==0&&(Wu(r.pan.matrix,r.pan.matrix,-l,a),r.pan.enabled=!0),s.mode){case"pan":{const c=e.translation[1]*i.pan;c!==0&&(Wu(r.pan.matrix,r.pan.matrix,c,o),r.pan.enabled=!0);break}case"zoom":r.zoom=-e.translation[1]*i.zoom}}function ubt(t,e,i,r,s,n,o,a,l){_ne(t.center,de(t.up,t.center),Te(t.center),-mb.normalize(wt(n)),o,e.aboveGround)?lbt(e,i,r,a,l,-mb.normalize(wt(s))):cbt(e,i,r,a,l)}const Ky=$(),ub=$(),ILe=$(),YN=$(),JN=$(),XN=$(),xme=$(),Sme=$(),kM=He(),Tme=dG(),oB=Ve(),aB=Ve(),Q2=Ve(),Aw=$(),hr=$(),KN=$(),QN=new jr,lB=$(),Eme=$(),bne={origin:$(),direction:$()},A8={origin:$(),direction:$()},Cme=.6,M8=4,hbt=60;let cB=class extends _x{constructor(){super(...arguments),this._zoomLocation=$(),this._tmpCamera=new jr,this._tmpViewDir=$(),this._tmpRayDir=Pn(),this._targetOnSphere=$(),this._tmpCenter=$(),this._beginCamera=new jr,this._constraintOptions=new hh(Nr.ALL_EXCEPT_COLLISION,Kt.ZOOM,null,this._beginCamera),this._sphere=Rs()}initialize(){this._intersector=lh(this.view.state.viewingMode)}step(e,i){if(!this.running)return;const r=this.view.state;this.animation.finished?this._beginCamera.copyFrom(r.camera):this.animation.cameraAt(1,this._beginCamera);let s=!1,n=!1;this._intersectionHelper.intersectScreen(i,this._zoomLocation,this.view.map.ground.opacity===0?ZS:{})&&(s=e>0,n=!0),this._tmpCamera.copyFrom(r.camera),s?this._intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this._intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ne(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,i,n),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:xD}}_updateCamera(e,i,r,s){const n=WD(e,r,this.view.renderCoordsHelper,this.view.viewingMode),o=Math.abs(this.view.camera.position.z),a=this._zoomLocation;ae(tF,e.eye),ie(tF,tF,-1),UA(e,r,this._tmpRayDir),ae(this._tmpRayDir.direction,this._tmpRayDir.direction);const l=ce(Math.min(yLe,1/Math.abs(de(tF,this._tmpRayDir.direction)))*o,vLe,_Le);if(n===va.Horizontal){let c=Cme**i;this._sphere[3]=Te(a),ye(this._tmpViewDir,e.center,e.eye);const h=Math.min(Te(this._tmpViewDir),l);let d=h*c;if(c<=1&&d<M8&&(d=M8,c=d/h),Math.abs(h-d)<1e-6)return;const f=Te(e.center);if(this._sphere[3]!==f){const m=this._sphere[3]+c*(f-this._sphere[3]);e.center=ie(eF,e.center,m/f)}ie(this._tmpViewDir,this._tmpViewDir,-c),e.eye=oe(eF,e.center,this._tmpViewDir),Os(this.view,e,this._constraintOptions),ro(a,e.center)>1e-12&&yne(this._sphere,e,r,this._targetOnSphere)&&abt(this._sphere,e,a,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let c=Cme**Math.abs(i);const h=i>0?1:-1;ye(this._tmpViewDir,a,e.eye);const d=Te(this._tmpViewDir),f=this.view._stage.renderView.getMinimalDepthForArea(null,r[0],r[1],this.view.state.camera,hbt);let m=f??l;m=s&&i>0?Math.min(m,d):m,ie(this._tmpRayDir.direction,this._tmpRayDir.direction,m),oe(a,this._tmpRayDir.origin,this._tmpRayDir.direction);let y=m*c;const v=Math.max(M8,1.01*e.nearFar[0]);if(i>0&&y<v&&(y=v,c=y/m),Math.abs(m-y)<1e-6)return;ie(this._tmpRayDir.direction,this._tmpRayDir.direction,h*(1-c)),e.eye=oe(eF,e.eye,this._tmpRayDir.direction),e.center=oe(eF,e.center,this._tmpRayDir.direction)}zA(this.view,e)}};cB=u([A("esri.views.3d.state.controllers.ZoomStepControllerGlobal")],cB);const eF=$(),tF=$();let K4,Q4=null;const UC=new Map;async function Jti(t){Q4==null&&(K4==null&&(K4=V(()=>import("./VoxelWasmPerSceneView-C4Vq2f2U.js"),__vite__mapDeps([353,297]))),Q4=await K4);const e=t.view;let i=UC.get(e);return i||(i=new Q4.default({view:e}),UC.set(e,i)),i.addVoxelLayer(t)}function m3(t){return UC.get(t)}function Xti(t){const e=t.view,i=UC.get(e);i&&i.removeVoxelLayer(t)<1&&(UC.delete(e),UC.size===0&&(K4=null,Q4=null))}const dbt=.6,pbt=4,fbt=60;let uB=class extends _x{constructor(){super(...arguments),this._zoomLocation=$(),this._tmpCamera=new jr,this._tmpRayDir=$(),this._tmpCenter=$(),this._beginCamera=new jr,this._constraintOptions=new hh(Nr.ALL,Kt.ZOOM,null,this._beginCamera)}step(e,i){if(!this.running)return;const r=this.view.state;this.animation.finished?this._beginCamera.copyFrom(r.camera):this.animation.cameraAt(1,this._beginCamera),this._tmpCamera.copyFrom(r.camera);const s=lh(this.view.state.viewingMode);let n=!1;e>0?(n=this._intersectionHelper.intersectScreenFreePointFallback(i,this._zoomLocation,this.view.map.ground.opacity===0?ZS:{}),this._intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this._intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ne(this._zoomLocation,this._tmpCamera.center);const o=dbt**e;let a=this.view._stage.renderView.getMinimalDepthForArea(m3(this.view),i[0],i[1],this.view.state.camera,fbt);ye(iF,this._tmpCamera.eye,this._zoomLocation),ae(iF,iF);const l=ce(Math.min(yLe,1/Math.abs(de(mbt,iF)))*Math.abs(this.view.camera.position.z),vLe,_Le);if(a=a??l,a){const c=$();ye(c,this._zoomLocation,this._tmpCamera.eye),(a<Te(c)||!n)&&(ae(c,c),oe(this._zoomLocation,this._tmpCamera.eye,ie(c,c,a)))}this._updateCamera(this._tmpCamera,o,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:xD}}_updateCamera(e,i,r){ye(this._tmpRayDir,r,e.eye);const s=Te(this._tmpRayDir);let n=s*i;const o=i<=1,a=Math.max(pbt,1.01*e.nearFar[0]);n!==0&&(o&&n<a&&(n=a,i=n/s),Math.abs(s-n)<1e-6||(ie(this._tmpRayDir,this._tmpRayDir,i),e.eye=ye($me,r,this._tmpRayDir),e.center=dr($me,e.center,r,1-i),Os(this.view,e,this._constraintOptions)))}};uB=u([A("esri.views.3d.state.controllers.ZoomStepControllerLocal")],uB);const $me=$(),mbt=Le(0,0,1),iF=$();let gbt=class extends ss{constructor(e,i){super(!0),this._view=e,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r))}_handleDoubleClick(e){const i=e.data;if(Pie(i,"primary")){const r=this._view.state.isGlobal?new cB({view:this._view,mode:"animation"}):new uB({view:this._view,mode:"animation"});this._view.state.switchCameraController(r),r.step(Math.log(.5)/Math.log(.6),nn(i.x,i.y)),e.stopPropagation()}}};function wne(t){return ce((t-1e5)/9e5,0,1)}const Ame=1e4,e5=Le(parseFloat(5802e-9.toFixed(6)),parseFloat(13558e-9.toFixed(6)),parseFloat(331e-7.toFixed(6))),O8=3,I8=Le(O8*parseFloat(65e-8.toFixed(6)),O8*parseFloat(1881e-9.toFixed(6)),O8*parseFloat(85e-9.toFixed(6))),ybt=3996e-9,vbt=Le(parseFloat(Number(e5[0]+I8[0]).toFixed(6)),parseFloat(Number(e5[1]+I8[1]).toFixed(6)),parseFloat(Number(e5[2]+I8[2]).toFixed(6)));function _bt(t,e,i){return t===Be.Global?new wbt(i):new bbt(e,i)}let bbt=class{constructor(e,i){this._elevationProvider=e,this._referenceEllipsoid=gr(i),this._unitInMeters=Ao(i,this._referenceEllipsoid.metersPerDegree)}compute(e,i,r,s,n){n||(n={near:0,far:0});let o=e[2]*this._unitInMeters;const a=o,l=o-s,c=this._elevationProvider?.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const h={x:(r=r??new gi({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},d=Math.max(h.x,h.y,h.z);ye(Mw,i,e),zT[0]=Mw[0]>0?r.xmax:r.xmin,zT[1]=Mw[1]>0?r.ymax:r.ymin,zT[2]=Mw[2]>0?d/2:-d/2,ye(zT,zT,e),ae(Mw,Mw);const f=1.1*de(zT,Mw)*this._unitInMeters,m=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),y=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),v=y*Tbt*this._unitInMeters,_=y*Ebt*this._unitInMeters,b=ce((o-_)/(v-_),0,1)**3,w=Math.min(dt(m,f,b),m)*Math.max(Math.log(Math.abs(l)),1);return RLe(Math.min(w,Math.max(34064e4,d))/this._unitInMeters,t5,this._unitInMeters,n)}},wbt=class{constructor(e){this._referenceEllipsoid=gr(e)}compute(e,i,r,s,n){n||(n={near:0,far:0});const o=Te(e),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,s),c=Math.abs(a-s),h=Math.max(c,Math.abs(a)),d=Math.sqrt(h*(h+2*l)),f=o+this._referenceEllipsoid.radius,m=1.2*dt(d,f,wne(h)),y=(Math.log(h)-Mme)/(xbt-Mme);return RLe(m,ce(t5-y*(t5-Ome),Ome,t5),1,n)}};function RLe(t,e,i,r){const s=Sbt/i,n=t/e;return n>s?(r.far=t,r.near=n):(r.near=s,r.far=r.near*e),r}const Mme=7.983,xbt=16.994,t5=2e4,Ome=100,Sbt=2,Tbt=.001,Ebt=1e-4,zT=$(),Mw=$();let i5=class extends ue{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const i=this.view.state.camera;e.spatialReference!=null&&lDe(this.view,i,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>zA(this.view,e,vd.EYE_AND_CENTER))}};u([p({constructOnly:!0})],i5.prototype,"view",void 0),i5=u([A("esri.views.3d.state.SurfaceCollisionConstraint")],i5);let xI=class extends ue{constructor(e){super(e),this.nearFarHeuristic=_bt(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([H(()=>[this.view.constraints?.clipDistance?.near,this.view.constraints?.clipDistance?.far],()=>this._clipDistanceNearFarChanged()),H(()=>this.view.constraints?.clipDistance?.mode,()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),H(()=>this.view.renderDataExtent,()=>this._updateNearFar(),Gt),H(()=>[this.view.constraints?.altitude?.min,this.view.constraints?.altitude?.max],()=>this._updateAltitude(),Gt),H(()=>this.view.constraints?.tilt?.max,()=>this._updateTiltMax(),Gt),H(()=>this.view.constraints?.tilt?.mode,()=>this._updateTilt(),Gt),H(()=>this.view.state?.camera,()=>this._updateTiltAutoMax(),Gt),H(()=>[this.view.map?.ground?.navigationConstraint?.type,this.view.state?.constraints?.collision?.enabled],()=>this._updateCollision(),Gt)]),this.view.state.isLocal&&this.addHandles(H(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),Nt)),this._updateNearFar(),this.view.state.viewingMode!==Be.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new i5({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){const e=this.view.constraints?.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(i=>Ime(i,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const i=this.view.constraints&&this.view.constraints.clipDistance;(i?i.mode:"auto")==="manual"?Ime(e,i):this._updateCameraNearFarAuto(e,i)}_updateCameraNearFarAuto(e,i){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,lG(this.view,e.eye),e),i&&i.autoUpdate(e.near,e.far)}_updateCollision(){const e=this.view.map?.ground?.navigationConstraint?.type,i=!e||e==="stay-above",r=this.view.state.constraints.collision;if(i!==r.enabled){r.enabled=i,i&&this._reapplyConstraints(Nr.COLLISION);const s=this.view.constraints&&this.view.constraints.tilt;s&&s.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==Be.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const i=this.view.state.constraints;i.tilt=i.createConstantMaxTilt(wt(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const i=this.view.state.constraints;if(i.tilt){const r=i.tilt(this.view.state.camera.distance).max;e.autoUpdate($o(r))}}_updateLocalSurfaceDistance(e){if(e==null)return;let i=Math.max(e.width,e.height);if(i<=0)return;e.zmax!=null&&e.zmin!=null&&(i=Math.max(i,e.zmax-e.zmin));const r=this.view.state,s=3*i/Math.atan(r.camera.fov/2);s!==r.constraints.distance&&(r.constraints.distance=s)}_reapplyConstraints(e=Nr.ALL){this.view.state.updateCamera(i=>Os(this.view,i,new hh(e,Kt.NONE,null)))}};function Ime(t,e){e&&(t.near=e.near,t.far=e.far)}u([p({constructOnly:!0})],xI.prototype,"view",void 0),u([p({readOnly:!0})],xI.prototype,"surfaceCollisionConstraint",void 0),xI=u([A("esri.views.3d.state.ConstraintsManager")],xI);let BR=class extends Dy{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=Vr.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(e.spatialReference==null||lDe(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),zA(this.view,e,vd.EYE_AND_CENTER)||this.constraintEnabled||(this.state=Vr.Stopped)})}};u([p({constructOnly:!0})],BR.prototype,"desiredCamera",null),BR=u([A("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],BR);const Cbt=.66;function PLe(t){return 360-_V.normalize(t)}function pG(t){return _V.normalize(360-t)}function DLe(t,e,i){const r=e.camera;if(r!=null)return $bt(r,Xb(t));const{targetGeometry:s}=e;if(s==null)return null;const{camera:n,mode:o}=NLe(t,e.rotation,i);if(s.type==="point")return Mbt(t,e,s,n,o);const a=s.extent;return a==null?null:U4(t,a,n.heading,n.tilt,o)}async function LLe(t,e,i,r){const s=e.camera;if(s!=null)return Abt(s,Xb(t),r);const{targetGeometry:n}=e;if(n==null)throw new Error("Viewpoint has no targetGeometry!");const{camera:o,mode:a}=NLe(t,e.rotation,i);if(n.type==="point")return Obt(t,e,n,o,a,r);const l=n.extent;if(l==null)throw new Error("Target geometry has no extent!");return RDe(t,l,o.heading,o.tilt,a,r)}function $bt(t,e){const i=t.position;let r;try{r=Tb(i,e)}catch{return null}if(!r)return null;const s=t.clone();return s.position=r.clone(),s}async function Abt(t,e,i){const r=t.position,s=await Eb(r,e,{signal:i});gt(i);const n=t.clone();return n.position=s.clone(),n}function NLe(t,e,i){const r=q$(t,t.state.camera);let s=xo.ADJUST;return e!=null&&(r.heading=PLe(e),s=xo.LOCKED),i!=null&&(r.tilt=i),{camera:r,mode:s}}function Mbt(t,e,i,r,s){const n=t.spatialReference;let o;try{o=Tb(i.clone(),n)}catch{return null}if(!o)return null;const a=e.scale!=null?l3(t,e.scale):t.state.camera.distance;return Yvt(t,o,a,r,s)}async function Obt(t,e,i,r,s,n){const o=t.spatialReference,a=await Eb(i.clone(),o,{signal:n});gt(n);const l=e.scale!=null?l3(t,e.scale):t.state.camera.distance;return cG(t,a,l,r,s,n)}function FLe(t,e,i=null){return i==null&&(i=new Jr),Sne(t,null,e.clone(),i)}async function kLe(t,e,i){const r=Ubt(t,e);if(!r)throw new U("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new tu({fov:t.camera.fov}),n=new Jr({camera:s});if(r.target instanceof Jr)return Ow(await Pbt(t,r.target,r,i,n));if(r.target instanceof tu)return Ow(await ULe(t,r.target,i,n));const o=r.scale!=null||r.zoom!=null;if(r.target instanceof gi){const c=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return Ow(o||c?await rX(t,r,r.target.center,s,i,n):await Fbt(t,r,r.target,s,i,n))}const a=new Vbt,l=o?Ibt(t,r):void 0;if(await zLe(t,r.target,l,a,i),isFinite(a.boundingBox[0])){let c;if(uie(a.boundingBox,As),Bu.x=As[0],Bu.y=As[1],Bu.z=As[2],Bu.spatialReference=t.spatialReference,isFinite(Bu.z)&&a.hasZ?c=VCe(a.boundingBox):(Bu.z=void 0,c=nHe(BCe(a.boundingBox,jbt))),o||c)return Ow(await rX(t,r,Bu,s,i,n));const h=Bbt(t,a.screenSpaceObjects);return Ow(await zbt(t,r,Bu,a.boundingBox,h,s,i,n))}return r.position?Ow(await Lbt(t,r,s,n,i)):Ow(await Nbt(t,r,s,i,n))}function xne(t,e){return e.scale==null&&e.zoom!=null?NDe(t,e.zoom):e.scale}function Ibt(t,e){const i=xne(t,e);return i?Zat(i):void 0}function fG(t,e){let i=!1;return e.heading!=null?(t.heading=e.heading,i=!0):e.rotation!=null&&(t.heading=PLe(e.rotation),i=!0),e.tilt!=null&&(t.tilt=e.tilt,i=!0),e.fov!=null&&(t.fov=e.fov),i}function Sne(t,e,i,r){const s=t.spatialReference||Ae.WGS84;if(e??=gm(t,i),e==null)return r;const n=new ke({spatialReference:s});return HS(e.center,t.renderSpatialReference,n)&&(r.targetGeometry=n,r.scale=fS(t,e.distance),r.rotation=pG(i.heading),r.camera=i),r}async function hB(t,e,i,r){const s=()=>new U("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw s();e.type==="mesh"&&(e=e.extent);const n=t.basemapTerrain.spatialReference;if(!e.hasZ&&t.basemapTerrain){let d;switch(e.type){case"point":d=e;break;case"multipoint":case"polyline":d=e.extent?.center;break;case"extent":d=e.center;break;case"polygon":d=e.centroid}d!=null&&n&&t.elevationProvider?(d=await Eb(d,n,{signal:r}),As[2]=Tm(t.elevationProvider,d)??0):As[2]=0}const o=Gbt[e.type],a=new Array;if(o(e,e.hasZ?d=>{a.push([d[0],d[1],d[2]])}:d=>{a.push([d[0],d[1]])},As),a.length===0)throw s();const l=e.spatialReference,c=t.spatialReference,h=await Eb(new CS({spatialReference:l,hasZ:e.hasZ,hasM:!1,points:a}),c,{signal:r});if(e.hasZ&&(i.hasZ=!0),e.hasZ)for(const[d,f,m]of h.points)As[0]=d,As[1]=f,As[2]=m,BP(i.boundingBox,As);else for(const[d,f]of h.points)As[0]=d,As[1]=f,BP(i.boundingBox,As)}async function Rbt(t,e,i,r,s){const n=await lf(t.whenViewForGraphic(e));if(n.ok===!1||n.value==null||!("whenGraphicBounds"in n.value))return void await hB(t,e.geometry,r,s);const o=n.value,a=await lf(o.whenGraphicBounds(e,{minDemResolution:i}));if(a.ok===!1||!a.value)return void await hB(t,e.geometry,r,s);const{screenSpaceObjects:l,boundingBox:c}=a.value;kCe(r.boundingBox,c),l&&l.forEach(h=>{r.screenSpaceObjects.push(h)}),isFinite(c[2])&&(r.hasZ=!0)}async function zLe(t,e,i,r,s){if(Array.isArray(e)&&e.length===2){const n=e[0],o=e[1];if(typeof n=="number"&&typeof o=="number")return Bu.x=n,Bu.y=o,Bu.z=void 0,Bu.spatialReference=t.spatialReference?.isGeographic?t.spatialReference:Ae.WGS84,void await hB(t,Bu,r,s)}e&&"map"in e&&typeof e.map=="function"?await Promise.allSettled(e.map(n=>zLe(t,n,i,r,s))):e instanceof og?await hB(t,e,r,s):e instanceof Ml&&await Rbt(t,e,i,r,s)}async function Pbt(t,e,i,r,s){if(e.camera)return ULe(t,e.camera,r,s);s.scale=e.scale,s.rotation=e.rotation,s.targetGeometry=e.targetGeometry!=null?e.targetGeometry.clone():null,s.camera=null,i.heading!=null?s.rotation=pG(i.heading):i.rotation!=null&&(s.rotation=i.rotation);const n=xne(t,i);return n!=null&&(s.scale=n),s.camera=await LLe(t,s,i.tilt,r),s}async function ULe(t,e,i,r){const s=t.spatialReference,n=await Eb(e.position,s,{signal:i}),o=e.clone();return o.position=n,Sne(t,null,o,r)}async function Dbt(t,e,i,r,s,n,o){const a=t.renderSpatialReference;return await EU(e,R8,a,0,{signal:o}),await EU(i,sF,a,0,{signal:o}),n.targetGeometry=new ke(e),s.position=new ke(i),ye(dB,R8,sF),GD(t,sF,dB,r.up,s),n.scale=fS(t,xr(sF,R8)),n.rotation=pG(s.heading),n.camera=s,n}async function rX(t,e,i,r,s,n){n.targetGeometry=i.clone();const o=qS(t);if(e.position)return Dbt(t,n.targetGeometry,e.position,o,r,n,s);if(e.zoomFactor){const l=o.distance/e.zoomFactor,c=ie(As,o.viewForward,-l);o.eye=oe(As,o.center,c),n.scale=fS(t,l)}q$(t,o,r);const a=fG(r,e)?xo.LOCKED:xo.ADJUST;if(!e.zoomFactor){const l=xne(t,e);if(l==null){await EU(n.targetGeometry,As,t.renderSpatialReference,0,{signal:s});const c=W2(o.frustum,As)?xr(o.eye,As):o.distance;n.camera=await cG(t,n.targetGeometry,c,r,a),n.scale=fS(t,c)}else n.scale=l,n.camera=await Zvt(t,n.targetGeometry,n.scale,r,a,s)}return n}async function Lbt(t,e,i,r,s){const n=qS(t);ne(dB,n.viewForward),GD(t,n.eye,dB,n.up,P8);const o=t.spatialReference,{position:a}=e;if(a){const l=await Eb(a,o,{signal:s});i.position=l}else i.position=new ke;return i.heading=e.heading!=null?e.heading:P8.heading,i.tilt=e.tilt!=null?e.tilt:P8.tilt,Sne(t,null,i,r)}async function Nbt(t,e,i,r,s){if(e.heading!=null||e.rotation!=null||e.scale!=null||e.tilt!=null||e.zoom!=null||e.zoomFactor!=null){const n=qS(t),{spatialReference:o,renderSpatialReference:a}=t,l=new ke({spatialReference:o});return HS(n.center,a,l)?rX(t,e,l,i,r,s):s}return s.scale=t.scale,s.camera=t.camera.clone(),fG(s.camera,e),s}async function Fbt(t,e,i,r,s,n){n.targetGeometry=i.clone();const o=qS(t);q$(t,o,r);const a=fG(r,e)?xo.LOCKED:xo.ADJUST;return n.camera=await RDe(t,i,r.heading,r.tilt,a,s),n}function kbt(t,e,i,r,s){let n=0;i.z!=null?n=i.z:t.basemapTerrain&&t.elevationProvider&&(n=Tm(t.elevationProvider,i)),se(As,i.x,i.y,n),VS(t.spatialReference,As,Rme,t.renderSpatialReference),FS(rF,Rme),OA(rF,rF),ff(zM);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let y=0;y<o.length;y++){const v=o[y];let _=r[v[2]];isFinite(_)||(_=n),se(As,r[v[0]],r[v[1]],_),mc(As,t.spatialReference,As,t.renderSpatialReference),BP(zM,ac(As,As,rF))}const a=IS(zM),l=Gb(zM),c=RS(zM),h=1/Math.tan(e.fovX/2),d=1/Math.tan(e.fovY/2),f=.5*Math.sqrt(a*a+c*c)*Math.max(d,h)+.5*l,m=.5*l*d+.5*Math.max(a,c);return Math.max(f,m)/s}async function zbt(t,e,i,r,s,n,o,a){a.targetGeometry=i.clone();const l=qS(t),c=kbt(t,l,i,r,s);q$(t,l,n);const h=fG(n,e)?xo.LOCKED:xo.ADJUST;return a.camera=await cG(t,a.targetGeometry,c,n,h,o),a.scale=fS(t,c),a}function Ubt(t,e){if(!e||!t.spatialReference)return null;const i={target:void 0};return"declaredClass"in e||Array.isArray(e)?i.target=e:(Object.assign(i,e),!i.target&&"center"in e&&e.center&&(i.target=e.center)),i}function Ow(t){return t?.camera!=null&&(t.rotation=pG(t.camera.heading)),t}function Bbt(t,e){const i=Cbt;if(!e.length)return i;let r=Number.NEGATIVE_INFINITY;for(let s=0;s<e.length;s++){const n=e[s].screenSpaceBoundingRect;r=Math.max(r,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return i-r/Math.min(t.width,t.height)*2}class Vbt{constructor(){this.hasZ=!1,this.boundingBox=ff(),this.screenSpaceObjects=new Array}}const As=$(),Rme=Ve(),rF=xs(),zM=ch(),jbt=Qt(),dB=$(),sF=$(),R8=$(),P8={heading:0,tilt:0},Bu=new ke,Gbt={point(t,e,i){i[0]=t.x,i[1]=t.y,t.z!=null&&(i[2]=t.z),e(i)},polygon(t,e,i){const r=t.hasZ;for(let s=0;s<t.rings.length;s++){const n=t.rings[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),e(i)}},polyline(t,e,i){const r=t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),e(i)}},multipoint(t,e,i){const r=t.points,s=t.hasZ;for(let n=0;n<r.length;n++)i[0]=r[n][0],i[1]=r[n][1],s&&(i[2]=r[n][2]),e(i)},extent(t,e,i){t.zmin!=null&&t.zmax!=null?(e(se(i,t.xmin,t.ymin,t.zmin)),e(se(i,t.xmax,t.ymin,t.zmin)),e(se(i,t.xmin,t.ymax,t.zmin)),e(se(i,t.xmax,t.ymax,t.zmin)),e(se(i,t.xmin,t.ymin,t.zmax)),e(se(i,t.xmax,t.ymin,t.zmax)),e(se(i,t.xmin,t.ymax,t.zmax)),e(se(i,t.xmax,t.ymax,t.zmax))):(e(se(i,t.xmin,t.ymin,i[2])),e(se(i,t.xmax,t.ymin,i[2])),e(se(i,t.xmin,t.ymax,i[2])),e(se(i,t.xmax,t.ymax,i[2])))}},Hbt=Object.freeze(Object.defineProperty({__proto__:null,create:kLe,fromCamera:FLe,toCameraAsync:LLe,toCameraSync:DLe},Symbol.toStringTag,{value:"Module"}));let qbt=class{constructor(e,i,r){this._target=e,this._options=i,this.view=r,this.state="pending",this._animationController=null,this.promise=new Promise((s,n)=>{this._resolveCallback=s,this._rejectCallback=n;const o=new AbortController;this._options.signal!=null&&Xo(this._options.signal,()=>this.abort()),this._abortController=o,this._waitForReady()})}_resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}_reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.running&&this._animationController.stopController(),this._reject(vi())}async _waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await Cd(()=>this.view.ready,this._abortController.signal)}catch(e){return this._reject(e)}this._createViewPoint()}async _createViewPoint(){if(this.state!=="finished"){this.state="wait-for-viewpoint",this._animationController=this._options.animate?this._getAnimationController():null;try{const e=await kLe(this.view,this._target,this._abortController.signal);if(this.state==="finished")return;const i=e?this._getCameraFromViewpoint(e):null;if(i==null)return;if(this._options.animate){if(this._animationController==null)return;this._startAnimation(i,this._animationController)}else this.view.stateManager.setStateCamera(i.camera,{applyConstraints:!i.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this._resolve()}catch(e){this._reject(e)}}}_getCameraFromViewpoint(e){const i=!!(this._target instanceof Jr&&this._target.camera||this._target instanceof tu),r=e.camera;if(r==null)return null;if(!this.view.stateManager.isCompatible(r)){const n=r.position,o=n&&n.spatialReference,a=o?o.wkid:"none",l=this.view.spatialReference?.wkid;return this._reject(new U("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${a}, view: ${l})`,{camera:r})),null}const s=gm(this.view,r);return s==null?(this._reject(new U("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:s,isFullySpecified:i}}_startAnimation(e,i){this.state="wait-for-animation-finish";const r=i.viewAnimation;if(r==null)return void this._reject(new U("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(e.viewpoint,"running"),!i.running||i.viewAnimation==null||i.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==i)return this.abort();let s;e.isFullySpecified?(s=new BR({view:this.view,desiredCamera:e.camera}),zA(this.view,e.camera,vd.EYE_AND_CENTER)):Os(this.view,e.camera),i.begin(e.camera,this._options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.running?mme(a)&&a.viewAnimation!=null&&a.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=s):i.viewAnimation!=null&&i.viewAnimation.target===e.viewpoint&&i.state===Vr.Finished&&(this.view.state.cameraController=s))},o=a=>{if(this.view.state!=null)switch(i.state){case Vr.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._resolve()}break;case Vr.Ready:case Vr.Rejected:case Vr.Running:case Vr.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._reject(a)}}};r.when(n,a=>o(a)),i.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let e=null,i=null;const r=this.view.state.cameraController;return mme(r)&&(r.updateStateFromViewAnimation(),r.running&&(e=r,i=e.viewAnimation)),e==null&&(e=new _x({view:this.view,mode:"animation"}),i=e.viewAnimation,this.view.state.switchCameraController(e),e.state===Vr.Rejected)?(i?.stop(),this._reject(new U("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null):e}};var js;function Pme(t=!X("disable-feature:high-quality-idle"),e=null){const i=new yv;return t?(i.set(ai.IDLE,js.Antialiasing,e!=="low"),i.set(ai.IDLE,js.HighResolutionAtmosphere,e!=="low"),i.set(ai.IDLE,js.HighQualityTransparency,!0),i.set(ai.IDLE,js.SSAO,!0),i.set(ai.IDLE,js.WaterReflection,!0),i.set(ai.IDLE,js.PhysicalPixelRendering,!0)):(i.set(ai.ANIMATING,js.HighResolutionShadows,!0),i.set(ai.ANIMATING,js.HighResolutionViewshed,!0),i.set(ai.INTERACTING,js.HighResolutionShadows,!0),i.set(ai.INTERACTING,js.HighResolutionViewshed,!0)),i.set(ai.IDLE,js.HighResolutionShadows,!0),i.set(ai.IDLE,js.HighResolutionViewshed,!0),i.set(ai.IDLE,js.HighResolutionVoxel,!0),i}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighResolutionVoxel=2]="HighResolutionVoxel",t[t.HighResolutionAtmosphere=3]="HighResolutionAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.HighResolutionShadows=6]="HighResolutionShadows",t[t.HighResolutionViewshed=7]="HighResolutionViewshed",t[t.PhysicalPixelRendering=8]="PhysicalPixelRendering"})(js||(js={}));let ks=class extends ue{constructor(e){super(e),this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._idleTimeout=Dme,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:i=>this._devicePixelRatioOverride=i,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},get updatingIgnoreRenderState(){return this.renderState!=null},get idleTimeoutEnabled(){return this.viewStateManager._idleTimeout>0},set idleTimeoutEnabled(i){this.viewStateManager._idleTimeout=i?Dme:0}},this._propertiesPool=new ov({frustum:tB},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new Wbt}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([io(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),H(()=>this.view.state?.camera,(e,i)=>this._cameraChangedHandler(e,i),Gt)]),gn(()=>this.view.state?.camera,e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([qm({prepare:()=>this._prepareFrame()}),H(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(oF)}),io(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=Ce(this._propertiesPool)}get camera(){const e=this._get("camera");if(!this.ready)return e;const i=q$(this.view,this.view.state.camera,D8);return i&&e&&i.equals(e)?e:i.clone()}set camera(e){this._updatePropertyBeforeReady("camera",e)||(this.view.elevationProvider?.enableCache(!0),this.setStateCamera(gm(this.view,e),{applyConstraints:!1})||J.getLogger(this).error("#camera=","Invalid camera",e),this.view.elevationProvider?.enableCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const i=q$(this.view,this.view.state.contentCamera,D8);return i&&e&&i.equals(e)?e:i.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const i=gm(this.view,e);i!=null?(this._updateElevation(i),this.view.state.contentCamera=i):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(L8),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const i=this.zoom,r=this.view.state.camera.distance**2,s=p$(this.view.state.camera.center),n=e.sticky?this.contentCamera.clone():null;return this.addHandles([H(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(L8),this.test.contentCameraResetState.clear())}),H(()=>this.zoom,o=>{o!==void 0&&i!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(o-i)/2),Math.abs(o-i)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n))}),H(()=>this.view.state.camera,o=>{const a=ro(s,o.center);this.test.contentCameraResetState.set("camera.center",a/r),a>r?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)})],L8),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():J.getLogger(this).error("#center=","Invalid center",e):J.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):J.getLogger(this).error("#center=","Center may not be null or undefined"))}get visibleArea(){if(!this.ready){const e=this._get("extent");return e?Sa.fromExtent(e):null}return Qvt(this.view,this.view.pointsOfInterest.focus.renderLocation)}get extent(){if(!this.ready)return this._get("extent");const e=this.view,i=PDe(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return i??this._get("extent")}set extent(e){this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||J.getLogger(this).error("#extent=","Invalid extent",e):J.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):J.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get constraintsManager(){return this._constraintsManager}get _initialViewpoint(){const e=this.view.map;return e&&"initialViewProperties"in e?e.initialViewProperties?.viewpoint:void 0}get hasInitialView(){return!!this._initialViewpoint}get scale(){if(!this.ready)return this._get("scale");const e=this.view.basemapTerrain.tilingScheme,i=this.view.pointsOfInterest.cameraOnSurface.scale;return e&&i?bDe(this.view,i,this.view.state.contentCamera,e):this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||J.getLogger(this).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,i=e.padding,r=e.pixelRatio,s=this._get("padding"),n=Math.round(i[si.TOP]/r),o=Math.round(i[si.RIGHT]/r),a=Math.round(i[si.BOTTOM]/r),l=Math.round(i[si.LEFT]/r);return s!=null&&s.top===n&&s.right===o&&s.bottom===a&&s.left===l?s:{top:n,right:o,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,nF),this.view.state.updateCamera(i=>i.padding=nF))}_paddingToArray(e,i,r){e?es(r,e.top||0,e.right||0,e.bottom||0,e.left||0):es(r,0,0,0,0);for(let s=0;s<4;s++)r[s]=Math.round(r[s]*i)}get screenCenter(){const e=this.padding;return wo((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?FLe(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||J.getLogger(this).error("#viewpoint=","Invalid viewpoint",e);else{const i=e.camera!=null?e.camera.position:e.targetGeometry,r=i!=null&&i.spatialReference;J.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(r?r.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e)}else J.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?s0t(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||J.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),i=(this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e)*this.view.resolutionScale;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*i),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*i);const r=this.view._stage.renderView.renderingContext?.parameters.maxTextureSize;return r&&yx(this._tmpCanvasSize,r),this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth*.5+this._tmpCanvasSize.height/this.view.surface.clientHeight*.5:i,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){return this.view?._stage?.renderer.isFeatureEnabled(js.PhysicalPixelRendering)??!1}get _usePhysicalPixelRenderingAny(){const e=this.view?._stage?.renderer;return e&&(e.isFeatureEnabled(js.PhysicalPixelRendering,ai.IDLE)||e.isFeatureEnabled(js.PhysicalPixelRendering,ai.INTERACTING)||e.isFeatureEnabled(js.PhysicalPixelRendering,ai.ANIMATING))}preinit(e){return!(this._isOverridden("center")&&!M_(this.center.spatialReference,e))&&!(this._isOverridden("camera")&&!M_(this.camera.position.spatialReference,e))&&!(this._isOverridden("extent")&&!M_(this.extent.spatialReference,e))&&!!(!this._isOverridden("viewpoint")||M_(this.viewpoint.targetGeometry?.spatialReference,e)&&M_(this.viewpoint.camera?.position?.spatialReference,e))}init(){this._constraintsManager=new xI({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const i of e)this.set(i.name,i.value);if(!this._cameraSetByUser){const i=this._initialViewpoint||this.view.initialExtent;i&&this.isCompatible(i)?this._setInitialView(i):this.view.state.viewingMode===Be.Local&&this.addHandles(gn(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(oF),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),oF)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(oF),this._constraintsManager=Ce(this._constraintsManager))}async goTo(e,i){return i={animate:!0,...i},this._gotoOperation!=null&&this._gotoOperation.abort(i.animate),this._gotoOperation=new qbt(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation.promise}debugSetCameraOnContent(){this.setStateCamera(qS(this.view),{applyConstraints:!1})}step(e){const i=this.view.state,r=i?.cameraController;r&&(i.updateCamera(s=>r.stepController(e,s)),r.steppingFinished&&r.finishController())}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,i=[];for(const{propertyName:r,overrides:s}of Ybt){const n=e.has(r),o=this._isOverridden(r);!n&&o&&i.push({name:r,value:this._get(r)}),this._clearOverride(r),(n||o)&&s.forEach(a=>e.add(a))}return i}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof tu)return void this.setStateCamera(gm(this.view,e),{applyConstraints:!1});if(e instanceof Jr){if(e.targetGeometry instanceof gi){const n=U4(this.view,e.targetGeometry,0,.5,xo.LOCKED);return void(n!=null&&this.setStateCamera(gm(this.view,n),{applyConstraints:!0}))}const r={applyConstraints:!e.camera},s=this._viewpointToCamera(e);return void this.setStateCamera(s,r)}const i=U4(this.view,e,0,.5,xo.LOCKED);i!=null&&this.setStateCamera(gm(this.view,i),{applyConstraints:!0})}_updatePropertyBeforeReady(e,i){return!this.ready&&(this._override(e,i),i&&Zbt.has(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof Jr?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof tu?this.isCompatible(e.position):e.spatialReference&&!REe(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=Jbt){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,i,r=m0){const{heading:s,tilt:n}=this._getPreservingHeadingTilt(),o=c3(this.view,s,n,e,i,xo.ADJUST);return o==null?null:(r.copyFrom(this.view.state.camera),r.eye=o.eye,r.center=o.center,r.up=o.up,r)}_centerToCamera(e){let i;if(e.hasZ)i=this.view.state.camera.distance;else{const{centerOnContent:r}=this.view.pointsOfInterest;r.runTask(),i=r.distance}return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:i,tilt:r}=this._getPreservingHeadingTilt(),s=U4(this.view,e,i,r,xo.ADJUST,D8);return s?gm(this.view,s):null}_scaleToCamera(e){if(e==null)return null;const i=this.view,r=i.pointsOfInterest.centerOnContent;r.runTask();const s=r.renderLocation,n=i.pointsOfInterest.cameraOnSurface.renderLocation,o=Wvt(i,e,i.state.contentCamera,s,n);return this._centerPointAtDistanceToCamera(s,o)}_zoomToCamera(e){return this._scaleToCamera(NDe(this.view,e))}_viewpointToCamera(e){return gm(this.view,DLe(this.view,e))}setStateCamera(e,i){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,i.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(r=>{i.positionAndOrientationOnly?(r.eye=e.eye,r.center=e.center,r.up=e.up,r.fov=e.fov):r.copyFrom(e),i.applyConstraints&&Os(this.view,r)}),i.applyConstraints||(this.view.state.cameraController=new BR({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:i}=this.view;if(!e||!i)return;this._windowDevicePixelRatio=window.devicePixelRatio;const r=this._computeCanvasSize();if(r.width!==0&&r.height!==0&&(i.width===r.width&&i.height===r.height||(i.width=r.width,i.height=r.height),this.view.state)){const s=this.view.state.camera;s.fullWidth===r.width&&s.fullHeight===r.height&&s.pixelRatio===r.pixelRatio||(m0.copyFrom(s),m0.pixelRatio!==r.pixelRatio&&(this._paddingToArray(this.padding,r.pixelRatio,nF),m0.padding=nF),m0.fullWidth=r.width,m0.fullHeight=r.height,m0.pixelRatio=r.pixelRatio,this.view.state.camera=m0),this._updateViewState()}}_updateElevation(e){const i=this.view.basemapTerrain?.spatialReference,r=this.view.renderCoordsHelper?.getAltitude(e.eye)??0,s=i?lG(this.view,e.eye):0;e.relativeElevation=r-s}_updateViewState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=ai.ANIMATING:this.view.interacting?this.view.state.mode=ai.INTERACTING:(this.view.state.mode===ai.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<this._idleTimeout?this.view.state.mode=ai.INTERACTING:this.view.state.mode=ai.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,i){e&&i&&e.almostEquals(i)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};u([p({type:tu,dependsOn:["view.state.camera","ready"]})],ks.prototype,"camera",null),u([p({type:tu,dependsOn:["view.state.contentCamera","ready"]})],ks.prototype,"contentCamera",null),u([p({type:ke})],ks.prototype,"center",null),u([p()],ks.prototype,"visibleArea",null),u([p({type:gi})],ks.prototype,"extent",null),u([p({readOnly:!0})],ks.prototype,"frustum",null),u([p()],ks.prototype,"_constraintsManager",void 0),u([p({readOnly:!0})],ks.prototype,"constraintsManager",null),u([p()],ks.prototype,"_initialViewpoint",null),u([p({readOnly:!0})],ks.prototype,"hasInitialView",null),u([p({readOnly:!0,type:Boolean})],ks.prototype,"ready",void 0),u([p({type:Number})],ks.prototype,"scale",null),u([p()],ks.prototype,"padding",null),u([p({readOnly:!0})],ks.prototype,"screenCenter",null),u([p({constructOnly:!0})],ks.prototype,"view",void 0),u([p({type:Jr})],ks.prototype,"viewpoint",null),u([p({type:Number})],ks.prototype,"zoom",null),u([p({readOnly:!0})],ks.prototype,"_rasterPixelRatio",null),u([p({readOnly:!0})],ks.prototype,"_usePhysicalPixelRendering",null),u([p({readOnly:!0})],ks.prototype,"_usePhysicalPixelRenderingAny",null),u([p()],ks.prototype,"_windowDevicePixelRatio",void 0),u([p()],ks.prototype,"_devicePixelRatioOverride",void 0),ks=u([A("esri.views.3d.state.ViewStateManager")],ks);let Wbt=class{constructor(){this.width=0,this.height=0,this.pixelRatio=1}};const Zbt=new Set(["camera","viewpoint","extent","scale","center","zoom"]),Ybt=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],Jbt={heading:0,tilt:0},D8=new tu,m0=new jr,nF=pi(),oF="pending-initial-view",L8="content-camera-reset",Dme=300,Lme=100;let Zp=class extends Dy{constructor(){super(...arguments),this.startCamera=new jr,this.currentCamera=new jr,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<Lme}stepController(e,i){i.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(i)}onControllerStart(e){this.state=Vr.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),Lme),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};u([p({readOnly:!0})],Zp.prototype,"isInteractive",null),u([p()],Zp.prototype,"_lastInteraction",void 0),Zp=u([A("esri.views.3d.state.controllers.InteractiveController")],Zp);var kc;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})(kc||(kc={}));let VR=class extends Zp{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=kc.CENTER,this._rotScale=0,this._lastPoint=He(),this._tmpWorldUp=$(),this._tmpViewDir=$(),this._tmpRotCurPoint=He(),this._tmpTransf=Ve(),this._tmpAxis=$(),this._tmpPivotPoint=$(),this._pivotPos=$(),this._constraintOptions=new hh(Nr.ALL,Kt.TUMBLE,0,this.startCamera)}initialize(){this._rotScale=this.pivot===kc.CENTER?3:1.5}begin(e){if(this.running){switch(this.pivot){case kc.EYE:ne(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=Kt.LOOK_AROUND,this._constraintOptions.tiltMode=tg.LOOK_AROUND,this._constraintOptions.selection=Nr.NONE;break;case kc.CENTER:{const i=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?ZS:{});i||ne(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,i),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=Kt.TUMBLE,this._constraintOptions.tiltMode=tg.TUMBLE,this._constraintOptions.selection=Nr.ALL&~Nr.DISTANCE;break}}Fx(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,i){const r=this.startCamera,s=$();ye(s,this._pivotPos,r.eye);const n=Te(s),o=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(r.eye,Nme);let a=Math.max(Math.min(ibt,1/Math.abs(de(Nme,r.viewForward)))*o,rbt);i&&(a=Math.min(n,a));const l=nn(r.width/r.pixelRatio*.5,r.height/r.pixelRatio*.5),c=WD(this.startCamera,l,this.view.renderCoordsHelper,this.view.viewingMode);let h=this.view._stage.renderView.getMinimalDepthForArea(m3(this.view),r.fullWidth/r.pixelRatio*.5,r.fullHeight/r.pixelRatio*.5,r,2.5*E8,E8),d=this.view._stage.renderView.getMinimalDepthForArea(m3(this.view),e[0],e[1],r,E8);h==null&&d==null||(h=h??d??0,d=d==null||c===va.Horizontal?h:d,a=h>d?d:h,a=i?Math.min(a,n):a),ae(s,s),ne(this._pivotPos,oe(this._tmpPivotPoint,r.eye,ie(this._tmpPivotPoint,s,a)))}update(e){if(this.running){switch(this.pivot){case kc.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case kc.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}Os(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.running&&this.finishController()}_applyRotation(e,i,r,s){this.view.renderCoordsHelper.worldUpAtPosition(s,this._tmpWorldUp),Fx(e,i,this._tmpRotCurPoint);let n=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,o=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;ye(this._tmpViewDir,r,s);const a=Te(this._tmpViewDir),l=Za(de(this._tmpViewDir,this._tmpWorldUp)/a);if(this.pivot===kc.EYE){n*=-.5;const c=.5*Math.PI-l,h=.5*Math.PI*.99;n=c-Math.max(-h,Math.min(h,c+n))}return n=ce(n+l,pa.min,pa.max)-l,lt(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===kc.CENTER&&(o=-o),Ad(this._tmpTransf,o,this._tmpWorldUp),Wu(this._tmpTransf,this._tmpTransf,n,this._tmpAxis),st(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=st(N8,e.up,this._tmpTransf),oe(N8,s,this._tmpViewDir),zn(this._lastPoint,this._tmpRotCurPoint),N8}};u([p()],VR.prototype,"pivot",void 0),VR=u([A("esri.views.3d.state.controllers.RotateController")],VR);const N8=$(),Nme=$();let F8=class extends ss{constructor(e,i,r,s){super(!0),this._view=e,this.pointerActions=i,this._pivot=r,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(e){const i=e.data;if(i.pointers.size>1||!Die(e.data,this.pointerActions))return;const r=nn(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new VR({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};var g3;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(g3||(g3={}));function Xbt(t,e){return{type:Zx(e),value:t,unit:e}}function hii(t){return{value:t}}function Kbt(t,e){return{type:Zx(e),value:t,unit:e}}function Qbt(t,e){return{type:Zx(e),value:t,unit:e}}function mG(t,e,i="arithmetic"){return{type:Zx(e),value:t,unit:e,rotationType:i}}function dii(t,e){const i=ewt(t,e);return t.type==="angle"?mG(i,e,t.rotationType):Xbt(i,e)}function ewt(t,e){return pr(t.value,t.unit,e)}function pii(t,e){return t==null?e:e==null||t.value>pr(e.value,e.unit,t.unit)?t:e}function fii(t,e){return t==null?null:{...t,value:t.value*e}}function twt(t,e,i){if(e===i)return t;switch(i){case"arithmetic":case"geographic":return 90-t}}const mii=Kbt(0,"meters"),gii=Qbt(0,"square-meters");mG(0,"radians");const yii=mG(0,"degrees"),vii=mG(0,"degrees","geographic");function BLe(t,e,i){return t.units[e][i]}function YS(t,e,i,r=2,s="abbr"){return`${aD(e,{minimumFractionDigits:r,maximumFractionDigits:r,signDisplay:e>0?"never":"exceptZero"})} ${BLe(t,i,s)}`}function gG(t,e,i,r=2,s="abbr"){return`${aD(e,{minimumFractionDigits:r,maximumFractionDigits:r,signDisplay:"exceptZero"})} ${BLe(t,i,s)}`}function _ii(t,e,i,r=2,s="abbr"){const n=tte(e,i);return YS(t,pr(e,i,n),n,r,s)}function bii(t,e,i,r=2,s="abbr"){const n=tte(e,i);return gG(t,pr(e,i,n),n,r,s)}function wii(t,e,i,r=2,s="abbr"){const n=ite(e,i);return YS(t,pr(e,i,n),n,r,s)}function xii(t,e,i,r=2,s="abbr"){const n=ite(e,i);return gG(t,pr(e,i,n),n,r,s)}function Sii(t,e,i,r=2,s="abbr"){const n=rte(e,i);return YS(t,pr(e,i,n),n,r,s)}function Tii(t,e,i,r=2,s="abbr"){const n=rte(e,i);return gG(t,pr(e,i,n),n,r,s)}function Eii(t,e,i,r=2,s="abbr"){const n=ste(e,i);return YS(t,pr(e,i,n),n,r,s)}function Cii(t,e,i,r=2,s="abbr"){const n=ste(e,i);return gG(t,pr(e,i,n),n,r,s)}function $ii(t,e,i,r=2,s="abbr"){const n=fSe(e,i);return YS(t,pr(e,i,n),n,r,s)}function Aii(t,e,i,r=2,s="abbr"){const n=mSe(e,i);return YS(t,pr(e,i,n),n,r,s)}const iwt=(t,e)=>({style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:e,minimumFractionDigits:e,signDisplay:t>0?"never":"exceptZero"});function rwt(t,e,i,r,s,n=_V,o=!0){let a=n.normalize(twt(pr(t,e,"degrees"),i,r),0,o);const l=iwt(a,s??2);return a=swt(a,l),aD(a,l)}const Fme=new Map;function swt(t,e){const i=JSON.stringify(e);let r=Fme.get(i);return r||(r=new Intl.NumberFormat("en-US",e),Fme.set(i,r)),/^[-+]?360\.?0*°?$/.test(r.format(t))?0:t}const kme=["B","kB","MB","GB","TB"];function Mii(t,e){let i=(e=Math.round(e))===0?0:Math.floor(Math.log(e)/Math.log(g3.KILOBYTES));i=ce(i,0,kme.length-1);const r=aD(e/g3.KILOBYTES**i,{maximumFractionDigits:2});return G3(t.units.bytes[kme[i]],{fileSize:r})}const aF="esri-fov-overlay",lF={base:aF,outer:`${aF}-outer`,reset:`${aF}-reset`,text:`${aF}-text`};let ry=class extends zS{constructor(e){super(e),this.onReset=()=>{},this._messagesCommon=null,this._messagesUnits=null,this.fov=null}render(){return Zt("div",{class:lF.outer},Zt("div",{class:lF.base},Zt("p",{class:lF.text},this._overlay),Zt("p",{class:lF.reset,onclick:this.onReset,title:this._messagesCommon.reset},this._reset)))}get _overlay(){const{fov:e,_messagesUnits:i}=this;if(!i||e==null)return"";const r=rwt($o(e),"degrees","arithmetic","arithmetic",0),s=nwt/(2*Math.tan(e/2));return`${r} | ${YS(i,s,"millimeters",0,"abbr")} |`}get _reset(){return this._messagesUnits&&this.fov!=null?"↺":""}};u([p()],ry.prototype,"onReset",void 0),u([p(),dv("esri/t9n/common")],ry.prototype,"_messagesCommon",void 0),u([p(),dv("esri/core/t9n/Units")],ry.prototype,"_messagesUnits",void 0),u([p()],ry.prototype,"fov",void 0),u([p()],ry.prototype,"_overlay",null),u([p()],ry.prototype,"_reset",null),ry=u([A("esri.widgets.FovOverlay")],ry);const nwt=Math.sqrt(1872);let BC=class extends Zp{constructor(e){super(e),this.onStop=null,this._timeOutId=void 0,this._onReset=()=>{this._startSize=this._lastDrag=null,this._setFov(owt),this.updateTimeout()},this._center=$(),this._viewForward=$(),this._constraints=new hh(Nr.ALL,Kt.ZOOM)}begin(e){cwt(e)?this._showOverlay().fov=e.fov:(this._lastDrag=e[1],this._startSize=null,this._ensureStartSize(this.view.state.camera))}updateTimeout(){clearTimeout(this._timeOutId),this._timeOutId=setTimeout(this.onStop,1500)}update(e){if(this._lastDrag==null)return this._lastDrag=e[1],this._startSize=null,void this._ensureStartSize(this.view.state.camera);const i=-(this._lastDrag-e[1])/2;this._lastDrag=e[1],this.step(i)}step(e){if(!this.running)return void(this._startSize=this._lastDrag=null);const i=this.view.state,r=this.currentCamera.copyFrom(i.camera),s=$o(r.fov)+e,n=wt(ce(s,awt,lwt));n!==r.fov?this._setFov(n):this._showOverlay().fov=r.fov}finish(){this.running&&(this._startSize=this._lastDrag=null,this.finishController())}destroy(){this.hideOverlay()}onControllerEnd(e){super.onControllerEnd(e),this._startSize=this._lastDrag=null,this.hideOverlay()}_showOverlay(){return this._overlay||(this._overlay=new OR({id:"esri.FovOverlay",node:new ry({onReset:this._onReset})}),this.view.ui.add(this._overlay)),this._overlay.widget}hideOverlay(){this._overlay&&(this.view.ui.remove(this._overlay),this._overlay=Ce(this._overlay))}_setFov(e){const i=this.view.state,r=this.currentCamera.copyFrom(i.camera),s=this._ensureStartSize(r)/Math.tan(e/2),n=oe(k8,this._center,ie(k8,this._viewForward,-s));r.eye=n,r.fov=e,this._constraints.interactionStartCamera=i.camera,this._constraints.interactionFactor=nd(this.currentCamera.height-i.camera.height),Os(this.view,this.currentCamera,this._constraints),this.begin(r),this.commitCamera()}_ensureStartSize(e){if(this._startSize==null){ne(this._viewForward,e.viewForward);const i=this.view._stage.renderView.getMinimalDepthForArea(null,e.fullWidth/e.pixelRatio*.5,e.fullHeight/e.pixelRatio*.5,e,qD),r=xr(e.eye,this.view.pointsOfInterest.centerOnContent.renderLocation),s=i??r;oe(this._center,e.eye,ie(k8,this._viewForward,s)),this._startSize=s*Math.tan(e.fov/2)}return this._startSize}};u([p()],BC.prototype,"onStop",void 0),BC=u([A("esri.views.3d.state.controllers.FovController")],BC);const owt=wt(new tu().fov),awt=10,lwt=150,k8=$();function cwt(t){return!Array.isArray(t)}let sX=class extends Zp{constructor(){super(...arguments),this._pickPoint=$(),this._tmpP0=He(),this._panAxisAngle=dG(),this._tmpRayDir=$(),this._tmpRayDirPick=$(),this._targetOnSphere=$(),this._navMode=va.Horizontal,this._tmpRay={origin:$(),direction:$()},this.dragBeginPoint=nn(),this._normalizedAnchorPoint=He(),this._constraintOptions=new hh(Nr.ALL_EXCEPT_COLLISION,Kt.ZOOM,0,this.startCamera),this._sphere=Rs(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.running)return;zn(this.dragBeginPoint,e),Fx(this.startCamera,e,this._normalizedAnchorPoint);const i=gr(this.view.spatialReference),r=TLe(this._intersectionHelper,this.startCamera,e,i,Z$.Ellipsoid,this.view.map.ground.opacity===0?ZS:{});if(this._navMode=WD(this.startCamera,e,this.view.renderCoordsHelper,this.view.viewingMode),this._navMode===va.Horizontal)this._hasPickPoint=!!r.scenePickPoint,this._pickPoint=r.scenePickPoint??this._pickPoint,this._sphere=r.sphere;else{let s;UA(this.startCamera,e,this._tmpRay),ae(this._tmpRay.direction,this._tmpRay.direction),r.scenePickPoint!=null&&(ye(this._tmpRayDirPick,this.startCamera.eye,r.scenePickPoint),s=Te(this._tmpRayDirPick));const n=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,zme);let o=ce(Math.min(gLe,1/Math.abs(de(zme,this._tmpRay.direction)))*n,nB[0],nB[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,qD);o=a??o,o=s!=null?Math.min(o,s):o,this._hasPickPoint=!0,ie(this._tmpRay.direction,this._tmpRay.direction,o),oe(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}}update(e){if(this.running){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===va.Horizontal){ye(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const i=Te(this._tmpRayDir);Fx(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=i*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&s<n&&(s=n),Math.abs(i-s)<1e-6)return;if(this._hasPickPoint&&s<i){const o=1-(1-s/i)*(1-this._sphere[3]/Te(this.currentCamera.center));this.currentCamera.center=ie(cF,this.currentCamera.center,o)}ie(this._tmpRayDir,this._tmpRayDir,-s/i),this.currentCamera.eye=oe(cF,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=nd(lv(this.dragBeginPoint,e)),Os(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(f3(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),fne(this._pickPoint,this._targetOnSphere,this._panAxisAngle),Pb(this.currentCamera,this._sphere,this._panAxisAngle))}else{const i=Te(this._tmpRay.direction);Fx(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=i*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&s<n&&(s=n),Math.abs(i-s)<1e-6)return;ie(this._tmpRayDir,this._tmpRay.direction,1-s/i),this.currentCamera.eye=oe(cF,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=oe(cF,this.currentCamera.center,this._tmpRayDir)}zA(this.view,this.currentCamera),this.commitCamera()}}finish(){this.running&&this.finishController()}};sX=u([A("esri.views.3d.state.controllers.ZoomControllerGlobal")],sX);const cF=$(),zme=$();let nX=class extends Zp{constructor(){super(...arguments),this._tmpP=$(),this._tmpDir=$(),this._tmpN=$(),this._tmpP0=He(),this._tmpPoi=$(),this._tmpRayDir=$(),this.dragBeginPoint=nn(),this._normalizedAnchorPoint=He(),this._constraintOptions=new hh(Nr.ALL,Kt.ZOOM,0,this.startCamera,$()),this._plane=Br()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.running)return;zn(this.dragBeginPoint,e),Fx(this.startCamera,e,this._normalizedAnchorPoint);const i=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?ZS:{});ye(this._tmpDir,this._tmpP,this.startCamera.eye);const r=Te(this._tmpDir);ae(this._tmpDir,this._tmpDir);const s=Math.abs(this.view.camera.position.z);let n=ce(Math.min(gLe,1/Math.abs(de(uwt,this._tmpDir)))*s,nB[0],nB[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(m3(this.view),e[0],e[1],this.view.state.camera,qD);n=o??n,n=i?Math.min(n,r):n,ie(this._tmpDir,this._tmpDir,n),oe(this._tmpP,this.startCamera.eye,this._tmpDir),ye(this._tmpN,this.startCamera.eye,this.startCamera.center),ae(this._tmpN,this._tmpN),this._tmpN[1]<0&&wd(this._tmpN,this._tmpN),D$(this._tmpP,this._tmpN,this._plane)}update(e){if(!this.running)return;sbt(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||ne(this._tmpPoi,this.currentCamera.center),Fx(this.currentCamera,e,this._tmpP0);let i=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);zn(this._normalizedAnchorPoint,this._tmpP0),ye(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const r=Te(this._tmpRayDir);let s=r*(1-i);this._constraintOptions.interactionDirection&&(ne(this._constraintOptions.interactionDirection,this._tmpRayDir),ie(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(i)/r));const n=this.view.state.constraints.minimumPoiDistance;i>=0&&s<n&&(s=n,i=-(s-r)/r),Math.abs(r-s)<1e-6||(ie(this._tmpRayDir,this._tmpRayDir,i),this.currentCamera.eye=oe(Iw,this.currentCamera.eye,this._tmpRayDir),dr(Iw,this.currentCamera.center,this._tmpPoi,i),this._tmpPoi[2]>this.startCamera.center[2]?Iw[2]=Math.max(this.startCamera.center[2],Iw[2]):Iw[2]=Math.min(this.startCamera.center[2],Iw[2]),this.currentCamera.center=Iw,this._constraintOptions.interactionFactor=nd(lv(this.dragBeginPoint,e)),Os(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}finish(){this.running&&this.finishController()}};nX=u([A("esri.views.3d.state.controllers.ZoomControllerLocal")],nX);const Iw=$(),uwt=Le(0,0,1);let hwt=class extends ss{constructor(e,i,r){super(!0),this._view=e,this.pointerActions=i,this._fovModifier=r,this.registerIncoming("drag",[r],s=>this._handleZoom(s)),this.registerIncoming("drag",s=>this._handleZoom(s))}_handleZoom(e){const i=e.data;if(i.pointers.size>1||!Die(e.data,this.pointerActions))return;const r=nn(i.center.x,i.center.y);switch(i.action){case"start":{this._cameraController?.finish();const s=this._view,n=e.modifiers.has(this._fovModifier);this._cameraController=n?new BC({view:s,onStop:()=>this._stopController()}):s.state.isGlobal?new sX({view:s}):new nX({view:s}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break}case"update":this._cameraController?.update(r);break;case"end":this._cameraController instanceof BC?this._cameraController.updateTimeout():this._stopController()}e.stopPropagation()}_stopController(){this._cameraController?.finish(),this._cameraController=null}},bx=class extends Zp{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new jr,this._headingStart=0,this._constraintOptions=new hh(Nr.ALL,Kt.NONE,0,new jr,null,tg.LOOK_AROUND)}handleEventGamepad(e){const i=lY(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||v4(i))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,lhe(this._keysButtonState,this._transformation)}directionActive(e){return this._keysButtonState[e]===1}countActiveDirections(){return this._keysButtonState.reduce((e,i)=>i>0?e+1:e,0)}deactivateDirection(e){this._keysButtonState[e]=0;const i=lhe(this._keysButtonState,this._transformation);v4(i)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const i=this.view.pointsOfInterest.cameraOnSurface.location.z,r=1;this._filteredSurfaceElevation+=r*(i-this._filteredSurfaceElevation)*e}stepController(e,i){this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(i),this._updateCameraCenter(),this._constraintOptions.interactionStartCamera?.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,Rw),this._applyDisabledMovementTypes(Rw),this._applyPan(Rw.pan),this._applyRotate(Rw.rotate),this._applyZoom(Rw.zoom),this._applyAscend(Rw.ascend),this._constraintOptions.interactionType=Kt.NONE,this._constraintOptions.selection=Nr.COLLISION,Os(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,i)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const i=this.currentCamera;ye(Ll,i.center,i.eye),st(Ll,Ll,e.matrix),i.center=oe(Ll,Ll,i.eye),i.up=st(Ll,i.up,e.matrix),this._constraintOptions.interactionType=Kt.LOOK_AROUND,this._constraintOptions.selection=Nr.ALL_EXCEPT_COLLISION,Os(this.view,i,this._constraintOptions)}_applyPan(e,i=this.currentCamera){e.enabled&&(i.eye=st(Ll,i.eye,e.matrix),i.center=st(Ll,i.center,e.matrix),this.view.state.isGlobal&&(i.up=st(Ll,i.up,e.matrix)),this._constraintOptions.interactionType=Kt.PAN,this._constraintOptions.selection=Nr.ALL,Os(this.view,i,this._constraintOptions))}_applyZoom(e){if(!e)return;const i=this.currentCamera.viewForward;this.currentCamera.eye=oe(Ll,this.currentCamera.eye,ie(Ne.get(),i,e)),ne(UM,i),wd(UM,UM),this._constraintOptions.interactionDirection=UM,this._constraintOptions.interactionType=Kt.ZOOM,this._constraintOptions.selection=Nr.ALL_EXCEPT_COLLISION,Os(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const i=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Ne.get());if(this._constraintOptions.interactionDirection=ne(UM,i),this.view.state.isGlobal){const r=Te(this.currentCamera.eye),s=(r+e)/r;this.currentCamera.eye=ie(Ll,this.currentCamera.eye,s),this.currentCamera.center=ie(Ll,this.currentCamera.center,s)}else{const r=ie(Ne.get(),i,e);this.currentCamera.eye=oe(Ll,this.currentCamera.eye,r),this.currentCamera.center=oe(Ll,this.currentCamera.center,r)}this._updateCameraCenter(),this._constraintOptions.interactionType=Kt.ASCEND,this._constraintOptions.selection=Nr.COLLISION,Os(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=Nr.ALL_EXCEPT_COLLISION,Os(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,i,r){vwt(r);const s=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(s,i,r):this._calculateControlTransformationGlobal(s,i,r)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,i=this.view.renderCoordsHelper,r=this.currentCamera.ray;this.currentCamera.center=i.intersectManifoldClosestSilhouette(r,e,Ll)}_calculateControlTransformationLocal(e,i,r){const{viewRight:s,viewForward:n}=i,o=this._transformation,a=this.view.navigation.gamepad,l=se(Ne.get(),n[0],n[1],0);ae(l,l);const c=o.translation[0]*e.pan;if(c!==0){const v=ie(Ne.get(),s,c);nh(r.pan.matrix,r.pan.matrix,v),r.pan.enabled=!0}switch(a.mode){case"pan":{const v=-o.translation[1]*e.pan;if(v!==0){const _=ie(Ne.get(),l,v);nh(r.pan.matrix,r.pan.matrix,_),r.pan.enabled=!0}r.zoom=o.zoom*e.zoom;break}case"zoom":r.zoom=(-o.translation[1]+o.zoom)*e.zoom;break;default:a.mode}const h=o.translation[2]*e.ascend;r.ascend=h;const d=-o.heading*e.rotate;d!==0&&(Wu(r.rotate.matrix,r.rotate.matrix,d,this.view.renderCoordsHelper.worldUpAtPosition(i.eye,Ne.get())),r.rotate.enabled=!0);const f=o.tilt*e.rotate,m=_v(this.view.renderCoordsHelper,i.center,i.eye),y=ce(m+f,pa.min,pa.max)-m;y&&(Wu(r.rotate.matrix,r.rotate.matrix,y,s),r.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,i,r){const{eye:s,viewRight:n}=i,o=this._transformation,a=this.view.navigation.gamepad,l=lt(Ne.get(),n,s);ae(l,l),wd(l,l),ubt(this.startCamera,i,o,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,r,a),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(Rw.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,h=o.translation[2]*e.ascend;r.ascend=h;const d=-o.heading*e.rotate;d!==0&&(Wu(r.rotate.matrix,r.rotate.matrix,d,this._tmpCamera.eye),r.rotate.enabled=!0);const f=o.tilt*e.rotate,m=this._clampTiltDeltaGlobalToValidRange(f,i.ray,c);m!==0&&(Wu(r.rotate.matrix,r.rotate.matrix,m,this._tmpCamera.viewRight),r.rotate.enabled=!0),r.zoom+=o.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,i,r){const s=gr(this.view.spatialReference),n=X4(pa.min,i.origin,r,s);let o=0,a=0;const l=Ne.get();if(this.view.renderCoordsHelper.intersectManifold(i,r,l)){const c=_v(this.view.renderCoordsHelper,l,i.origin);o=X4(c,i.origin,r,s),a=X4(pa.max,i.origin,r,s)}else{DA(PA(Ej,r+s.radius),i,l);const c=Math.PI+ore(i.direction,l);o=yme(c,i.origin,r,s),a=yme(pa.max,i.origin,r,s)}return ce(o+e,n,a)-o}_getPointAbsoluteSurfaceElevation(e,i,r){const{renderCoordsHelper:s}=this.view,n=s.getAltitude(e),o=i+Math.abs(n-i);return s.setAltitude(r,o,e),o}_clampedDistanceToSurface(e,i){const{renderCoordsHelper:r}=this.view,{camera:s}=this.view.state,{direction:n}=Vvt(this.view,i,0,VLe,ywt),o=r.intersectManifoldClosestSilhouette(mf(i,n),e,Ne.get()),a=xr(i,o),l=r.intersectManifoldClosestSilhouette(mf(i,kS(Ne.get(),i,s.center)),e,Ne.get()),c=xr(i,l);return Math.min(a,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:i,state:r}=this.view,{camera:s,isGlobal:n}=r,o=i.intersectManifoldClosestSilhouette(s.ray,this._filteredSurfaceElevation,Ne.get());if(n){const a=ye(Ne.get(),e,o),l=Te(a);ie(a,a,1/l);const c=ae(Ne.get(),e),h=Za(de(c,a));return l*Math.sin(Math.min(pwt,h))}{const a=ne(Ne.get(),e);return i.setAltitude(a,this._filteredSurfaceElevation),xr(o,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:fwt}_computeVelocities(e){const i=this._filteredSurfaceElevation,r=i+gr(this.view.spatialReference).radius,{camera:s,isGlobal:n}=this.view.state,o=Ne.get(),a=this._getPointAbsoluteSurfaceElevation(s.eye,i,o),l=this._clampedDistanceToSurface(i,o),c=s.width/2,h=Ume*s.width,d=Ume*s.width,f=l*Math.tan(.5*s.fovX)/c,m=f/r,y=f/this._computeHeadingRotateRadius(o),v=a-i;return{pan:(n?m:f)*h*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(h*e/c)*v-v),zoom:2**(h*e/c)*l-l,rotate:ce(y*d,mwt,gwt)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&pf(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&pf(e.rotate.matrix))}static activatesFor(e,i){const r=lY(i,e.navigation.gamepad,dwt);return!(i.action==="end"||v4(r))}};u([p({constructOnly:!0})],bx.prototype,"gamepadDevice",void 0),u([p({constructOnly:!0})],bx.prototype,"disableMovements",void 0),bx=u([A("esri.views.3d.state.controllers.GamepadKeyboardController")],bx);const dwt={translation:[0,0,0],heading:0,tilt:0,zoom:0},VLe=80,pwt=wt(VLe),Ume=.75,fwt=5,mwt=wt(30),gwt=wt(80),Rw={zoom:0,ascend:0,pan:{enabled:!1,matrix:Ve()},rotate:{enabled:!1,matrix:Ve()}},Ll=$(),UM=$(),ywt=Kse();function vwt(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,pf(t.pan.matrix),t.rotate.enabled=!1,pf(t.rotate.matrix)}let _wt=class extends ss{constructor(e){super(!0),this._view=e,this._watchHandles=new ng,this._handle=this.registerIncoming("gamepad",i=>this._handleEventGamepad(i)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([H(()=>this._view.navigation.gamepad.enabled,i=>{i?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},Nt),H(()=>this._view.navigation.gamepad.device,i=>{this._cameraControllerGamepad&&i&&this._cameraControllerGamepad.gamepadDevice!==i&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const i=this._view.navigation.gamepad.device;if(i&&e.data.device!==i)return;const r=this._cameraControllerGamepad?.running;if(r||bx.activatesFor(this._view,e.data)){if(!r){const s=new bx({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(s),s.state!==Vr.Rejected&&(this._cameraControllerGamepad=s)}this._cameraControllerGamepad&&this._cameraControllerGamepad.running&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};var Pc;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(Pc||(Pc={}));let bwt=class extends ss{constructor(e,i){super(!0),this._view=e,this._keyToDirection=new Map,this._keyToAction=new Map,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Be.Local},this._stickyKeyTimeoutHandle=void 0,this._stickyKeyDuration=200,this._addKeysMapping(i),this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleStop()),this._visibilityHandle=Nie(r=>r?null:this._handleStop())}onUninstall(){this._visibilityHandle?.remove(),this._handleStop()}setStickyKeyDuration(e){this._stickyKeyDuration=e}_addKeysMapping(e){this._addKeyMapping(e.pan.left,Pc.LEFT),this._addKeyMapping(e.pan.right,Pc.RIGHT),this._addKeyMapping(e.pan.forward,Pc.FORWARD),this._addKeyMapping(e.pan.backward,Pc.BACKWARD),this._addKeyMapping(e.pan.up,Pc.UP),this._addKeyMapping(e.pan.down,Pc.DOWN),this._addKeyMapping(e.lookAround.headingLeft,Pc.HEADINGLEFT),this._addKeyMapping(e.lookAround.headingRight,Pc.HEADINGRIGHT),this._addKeyMapping(e.lookAround.tiltUp,Pc.TILTUP),this._addKeyMapping(e.lookAround.tiltDown,Pc.TILTDOWN),this._addKeyMapping(e.zoom.zoomIn,Pc.ZOOMIN),this._addKeyMapping(e.zoom.zoomOut,Pc.ZOOMOUT),this._addKeyAction(e.reset.heading,()=>this._resetHeading()),this._addKeyAction(e.reset.tilt,()=>this._resetTilt())}_addKeyMapping(e,i){for(const r of this._eachKey(e))this._keyToDirection.set(r,i)}*_eachKey(e){typeof e=="string"?yield e:yield*e}_addKeyAction(e,i){for(const r of this._eachKey(e))this._keyToAction.set(r,i)}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToAction.get(e.data.key);if(i!=null)return e.stopPropagation(),void i();const r=this._keyToDirection.get(e.data.key);if(r!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.running||(this._cameraControllerKeyboard=new bx({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.running)){if(e.stopPropagation(),this._cameraControllerKeyboard.directionActive(r)||(this._cameraControllerKeyboard.activateDirection(r),this._cameraControllerKeyboard.countActiveDirections()>1||!this._isPanning(r)))return;this._stickyKeyDuration>0&&(this._stickyKeyTimeoutHandle=setTimeout(()=>{this._stickyKeyTimeoutHandle=void 0,this._stickyDirection!=null&&this._stickyDirection!==void 0&&(this._cameraControllerKeyboard?.deactivateDirection(this._stickyDirection),this._stickyDirection=void 0)},this._stickyKeyDuration))}}_handleStop(){this._cameraControllerKeyboard?.running&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey||!this._cameraControllerKeyboard?.running)return;const i=this._keyToDirection.get(e.data.key);if(i==null)return;e.stopPropagation();const r=this._stickyKeyTimeoutHandle===void 0;this._stickyKeyTimeoutHandle===void 0||this._cameraControllerKeyboard?.countActiveDirections()!==1?(this._cameraControllerKeyboard?.deactivateDirection(i),r&&(this._stickyDirection=void 0)):this._stickyDirection=i}_isPanning(e){return e<=3}_resetHeading(){this._view.goTo({heading:0}).catch(()=>{})}_resetTilt(){this._view.goTo({tilt:0}).catch(()=>{})}},wwt=class extends ss{constructor(e,i){super(!0),this._view=e,this.registerIncoming("mouse-wheel",[i],r=>this._handleFov(r)),this.registerIncoming("mouse-wheel",r=>this._handleZoom(r))}_handleZoom(e){if(!this._mouseWheelZoomEnabled)return;const i=e.data;this._zoomController?.running||(this._stopFovController(),this._zoomController=this._view.state.isGlobal?new cB({view:this._view,mode:"interaction"}):new uB({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._zoomController)),this._zoomController.step(-i.deltaY/60,nn(i.x,i.y)),e.preventDefault(),e.stopPropagation()}_handleFov(e){this._mouseWheelZoomEnabled&&(this._fovController?.running||(this._zoomController?.finish(),this._fovController?.hideOverlay(),this._fovController=new BC({view:this._view,onStop:()=>this._stopFovController()}),this._view.state.switchCameraController(this._fovController),this._fovController.state!==Vr.Rejected)?(this._fovController.updateTimeout(),this._fovController.step(e.data.deltaY/20),e.preventDefault(),e.stopPropagation()):this._stopFovController())}get _mouseWheelZoomEnabled(){return this._view.navigation.actionMap.mouseWheel==="zoom"}_stopFovController(){this._fovController?.finish(),this._fovController=null}},pB=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},gS=class extends d3{constructor(){super(...arguments),this._beginCamera=new jr,this._elapsedTimeSec=0,this.constraintOptions=new hh(Nr.ALL,Kt.PAN,0,this._beginCamera)}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new cv}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),super.onControllerStart(e)}stepController(e,i){i.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,i),Os(this.view,i,this.constraintOptions)}};gS=u([A("esri.views.3d.state.controllers.momentum.MomentumController")],gS);let jR=class extends gS{constructor(e){super(e),this.interactionType=Kt.PAN,this._tmpPan=$()}momentumStep(e,i){const r=this.momentum.value(e);ie(this._tmpPan,this.momentum.direction,r),i.eye=ye(Bme,i.eye,this._tmpPan),i.center=ye(Bme,i.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};u([p({constructOnly:!0})],jR.prototype,"momentum",void 0),jR=u([A("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],jR);const Bme=$(),xwt=$(),uF=$();let r5=class extends gS{constructor(e){super(e),this.interactionType=Kt.PAN}momentumStep(e,i){const r=this.momentum.value1(e),s=this.momentum.value2(e);ne(uF,i.eye),ae(uF,uF),lt(this.momentum.axis2,uF,this.momentum.axis1),ALe(i,xwt,this.momentum.axis1,r,this.momentum.axis2,s)}};u([p({constructOnly:!0})],r5.prototype,"momentum",void 0),r5=u([A("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],r5);let rx=class extends gS{set center(e){this._set("center",is(e))}set axis(e){this._set("axis",is(e))}constructor(e){super(e),this.interactionType=Kt.TUMBLE}momentumStep(e,i){const r=this.momentum.value(e);Pb(i,this.center,p3(this.axis,r))}};u([p({constructOnly:!0})],rx.prototype,"momentum",void 0),u([p({constructOnly:!0})],rx.prototype,"center",null),u([p({constructOnly:!0})],rx.prototype,"axis",null),rx=u([A("esri.views.3d.state.controllers.momentum.RotationMomentumController")],rx);let eC=class extends gS{set zoomCenter(e){this._set("zoomCenter",is(e))}constructor(e){super(e),this.interactionType=Kt.ZOOM,this.constraintOptions.interactionDirection=$()}momentumStep(e,i){const{interactionDirection:r}=this.constraintOptions;if(!r)return;ne(r,i.eye);const s=this.momentum.valueDelta(0,e);vne(i,this.zoomCenter,s,this.view.state.constraints.minimumPoiDistance),kS(r,i.eye,r)}};u([p({constructOnly:!0})],eC.prototype,"momentum",void 0),u([p({constructOnly:!0})],eC.prototype,"zoomCenter",null),eC=u([A("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],eC);let A1=class extends gS{set screenCenter(e){this._set("screenCenter",nn(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",is(e))}constructor(e){super(e),this.interactionType=Kt.ZOOM,this.radius=0,this._tmpSceneCenter=$(),this._tmpZoomAxisAngle=dG(),this._sphere=Rs()}initialize(){this._sphere[3]=this.radius}momentumStep(e,i){const r=this.momentum.valueDelta(0,e);xLe(this._sphere,i,r),this.constraintOptions.interactionType=Kt.ZOOM,Os(this.view,i,this.constraintOptions),f3(this._sphere,i,this.screenCenter,this._tmpSceneCenter),fne(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),Pb(i,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=Kt.PAN}};u([p({constructOnly:!0})],A1.prototype,"momentum",void 0),u([p({constructOnly:!0})],A1.prototype,"screenCenter",null),u([p({constructOnly:!0})],A1.prototype,"sceneCenter",null),u([p({constructOnly:!0})],A1.prototype,"radius",void 0),A1=u([A("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],A1);let Up=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const i=this.computeDelta(e);this._updateDelta(i)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},yG=class{constructor(e,i,r){this._initialVelocity=e,this._stopVelocity=i,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,i){const r=this.value(e);return this.value(e+i)-r}valueFromInitialVelocity(e,i){i=Math.min(i,this.duration);const r=1-this.friction;return e*(r**i-1)/Math.log(r)}},Swt=class extends yG{constructor(e,i,r,s,n){super(e,i,r),this._sceneVelocity=s,this.direction=n}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},jLe=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._time=new Up(.6),this._screen=[new Up(.4),new Up(.4)],this._scene=[new Up(.6),new Up(.6),new Up(.6)],this._tmpDirection=$()}add(e,i,r){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(r)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(i[0]),this._scene[1].update(i[1]),this._scene[2].update(i[2]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?0:Math.sqrt(e*e+i*i),s=this._time.filteredDelta,n=s==null||r==null?0:r/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,i,r){se(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const s=Te(this._tmpDirection);s>0&&ie(this._tmpDirection,this._tmpDirection,1/s);const n=this._time.filteredDelta;return new Swt(e,i,r,n==null?0:s/n,this._tmpDirection)}},Vme=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const jme=1e-5;let Twt=class extends yG{constructor(e,i,r,s,n,o=0,a){super(e,i,r),this._angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},Ewt=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._tmpAxis1=$(),this._tmpAxis2=$(),this._tmpAngles=He(),this._time=new Up(.3),this._screen=[new Up(.4),new Up(.4)],this._angle1=new Vme(.6),this._angle2=new Vme(.6),this._axis1=$(),this._axis2=$(),this._lastScene=$()}addMomentumDirectRotation(e,i,r,s,n,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;let a=CLe(this._lastScene,i,this._tmpAxis2,s,n,o);this._angle2.update(0),Yo(this._tmpAxis2)<jme?a=0:ae(this._axis1,this._tmpAxis2),this._angle1.update(a),ne(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}addMomentumPreserveHeading(e,i,r,s,n,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;$Le(this._lastScene,i,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,s,n,o,a,!1),Yo(this._tmpAxis2)<jme?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),ae(this._axis1,this._tmpAxis1),ae(this._axis2,this._tmpAxis2)),ne(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?null:Math.sqrt(e*e+i*i),s=this._time.filteredDelta,n=r==null||s==null?0:r/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,i,r){const s=this._time.filteredDelta,n=this._angle1.filteredValue,o=this._angle2.filteredValue,a=s==null||o==null?0:o/s;return new Twt(e,i,r,s==null||n==null?0:n/s,this._axis1,a,this._axis2)}},GLe=class{constructor(e=2.5,i=.01,r=.95,s=12){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this._maxVelocity=s,this.enabled=!0,this.value=new Up(.8),this.time=new Up(.3)}add(e,i){if(this.enabled&&i!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(i)<.01)return;if(this.value.hasFilteredDelta()){const r=this.value.computeDelta(e);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(i),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=ce(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,i,r){return new yG(e,i,r)}},HLe=class extends GLe{constructor(e=3,i=.01,r=.95,s=12){super(e,i,r,s)}add(e,i){const r=this.value.lastValue;if(r!=null){let s=e-r;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;e=r+s}super.add(e,i)}},Cwt=class extends yG{constructor(e,i,r){super(e,i,r)}value(e){const i=super.value(e);return Math.exp(i)}valueDelta(e,i){const r=super.value(e),s=super.value(e+i)-r;return Math.exp(s)}},qLe=class extends GLe{constructor(e=2.5,i=.01,r=.95,s=12){super(e,i,r,s)}add(e,i){super.add(Math.log(e),i)}createMomentum(e,i,r){return new Cwt(e,i,r)}},oX=class extends Zp{constructor(){super(...arguments),this._smoothRotation=new pB(.05),this._rotationAxis=$(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=Br(),this._beginRadius=0,this._smoothScaling=new pB(.05),this._zoomCenterScreen=nn(),this._zoomMomentumEstimator=new qLe,this._rotationMomentumEstimator=new HLe,this._panSphericalMomentumEstimator=new Ewt,this._panPlanarMomentumEstimator=new jLe,this._adjustedSphere=Rs(),this._tmp3d=$(),this._tmpScreenPointArray=nn(),this._beginScreenPoint=nn(),this._beginScenePoint=$(),this._screenPickPoint=nn(),this._scenePickPoint=$(),this._navMode=va.Horizontal,this._sphere=Rs(),this._pointerCount=0,this._tmpInteractionDirection=$(),this._beginCamera=new jr,this._constraintOptions=new hh(Nr.ALL,Kt.NONE,0,this._beginCamera)}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.running)return;this._zoomMomentumEstimator.enabled=this._rotationMomentumEstimator.enabled=this._panPlanarMomentumEstimator.enabled=this._panSphericalMomentumEstimator.enabled=this.view.navigation.momentumEnabled,this._beginHeading=-mb.normalize(wt(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),jp(e.center,this._screenPickPoint),zn(this._beginScreenPoint,this._screenPickPoint);const i=gr(this.view.spatialReference),r=TLe(this._intersectionHelper,this.startCamera,this._screenPickPoint,i,Z$.Silhouette,this.view.map.ground.opacity===0?ZS:{});r.scenePickPoint!=null&&(this._scenePickPoint=r.scenePickPoint,this._sphere=r.sphere,ne(this._beginScenePoint,this._scenePickPoint),this._navMode=WD(this.startCamera,this._screenPickPoint,this.view.renderCoordsHelper,this.view.viewingMode),this._navMode===va.Vertical&&this._preparePlanarPanMode(e,r.hasGeometryIntersection),this._beginCamera.copyFrom(this.startCamera))}update(e){if(!this.running)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1;this._navMode===va.Horizontal?(i&&this._zoomSpherical(e),this._panningSpherical(e),i&&this._rotateSpherical(e)):(i&&this._zoomPlanar(e),this._panningPlanar(e),i&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return this._navMode===va.Horizontal?new A1({view:this.view,momentum:i,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new eC({view:this.view,momentum:i,zoomCenter:this._beginScenePoint});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new rx({view:this.view,momentum:r,center:this._sphere,axis:this._rotationAxis});if(this._navMode===va.Horizontal){const s=this._panSphericalMomentumEstimator.evaluateMomentum();if(s)return new r5({view:this.view,momentum:s})}else{const s=this._panPlanarMomentumEstimator.evaluateMomentum();if(s)return new jR({view:this.view,momentum:s})}return null}_preparePlanarPanMode(e,i){const r=wd(this._tmp3d,this.startCamera.viewForward);D$(this._scenePickPoint,r,this._panningPlane);const s=nn(this._screenPickPoint[0],0),n=$(),o=Te(this.startCamera.eye);this._adjustedSphere[3]=o<this._sphere[3]?o-100:this._sphere[3],f3(this._adjustedSphere,this.startCamera,s,n);const a=Wp();this.startCamera.projectToRenderScreen(n,a);const l=$(),c=$(),h=$();ye(l,this._scenePickPoint,this.currentCamera.eye);const d=Te(l);ae(l,l);const f=bLe*Math.max(Math.abs(this.view.camera.position.z),wLe),m=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,qD);let y=m??f;y=i?Math.min(y,d):y,ne(h,oe(c,this.currentCamera.eye,ie(c,l,y))),this._panningPlane[3]=-de(this._panningPlane,h),this.startCamera.center=oe(c,this.startCamera.eye,ie(c,this.startCamera.viewForward,y));const v=jp(e.center,this._tmpScreenPointArray);iX(this._panningPlane,this.startCamera,v,this._beginScenePoint)}_zoomSpherical(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),xLe(this._sphere,this.currentCamera,this._smoothScaling.value),jp(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=Kt.ZOOM,this._constraintOptions.interactionFactor=nd(e.radius-this._beginRadius),Os(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const i=jp(e.center,this._tmpScreenPointArray);f3(this._sphere,this.currentCamera,i,this._tmp3d),_ne(this._beginScenePoint,de(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera.aboveGround)?(OLe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(MLe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=Kt.PAN,this._constraintOptions.interactionFactor=nd(lv(this._screenPickPoint,i)),Os(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){ae(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||wd(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value,r=i+tX(e.angle-i),s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(r);const n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),Pb(this.currentCamera,this._sphere,p3(this._rotationAxis,n)),this._constraintOptions.interactionType=Kt.TUMBLE,this._constraintOptions.interactionFactor=nd(e.radius*r),Os(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const i=jp(e.center,this._tmpScreenPointArray);iX(this._panningPlane,this.currentCamera,i,this._tmp3d)&&(ELe(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(i,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=Kt.PAN,this._constraintOptions.interactionFactor=nd(lv(this._beginScreenPoint,i)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),Os(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),vne(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=Kt.ZOOM,this._constraintOptions.interactionFactor=nd(e.radius-this._beginRadius),Os(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){ne(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||wd(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value;let r=e.angle-i;r=tX(r);const s=i+r,n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(s);const o=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp),Pb(this.currentCamera,this._sphere,p3(this._rotationAxis,o)),this._constraintOptions.interactionType=Kt.TUMBLE,this._constraintOptions.interactionFactor=nd(e.radius*o),Os(this.view,this.currentCamera,this._constraintOptions)}};oX=u([A("esri.views.3d.state.controllers.PinchAndPanControllerGlobal")],oX);const Gme=Le(0,0,1);let aX=class extends Zp{constructor(){super(...arguments),this._rotationValueSmooth=new pB(.05),this._scalingValueSmooth=new pB(.05),this._planeHorizontal=Br(),this._planeVertical=Br(),this._rotationMomentumEstimator=new HLe,this._panMomentumEstimator=new jLe(300,12,.9),this._zoomMomentumEstimator=new qLe,this._beginRadius=0,this._beginCenter=$(),this._beginAngle=0,this._tmpPoints=[],this._navMode=va.Horizontal,this._beginCenterScreen=nn(),this._tmpCentroid3d=$(),this._tmpCentroid2d=nn(),this._tmp2d=nn(),this._pointerCount=0,this._beginCamera=new jr,this._constraintOptions=new hh(Nr.ALL,Kt.NONE,0,this._beginCamera)}begin(e){if(!this.running)return;const i=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=i,this._rotationMomentumEstimator.enabled=i,this._panMomentumEstimator.enabled=i,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),jp(e.center,this._beginCenterScreen),LOe(Gme,0,this._planeHorizontal);const r=$(),s=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,r,this.view.map.ground.opacity===0?ZS:{}),n=$();wd(n,this.startCamera.viewForward);const o=$();ne(o,Gme);const a=de(n,o);this._navMode=WD(this.startCamera,this._beginCenterScreen,this.view.renderCoordsHelper,this.view.viewingMode);const l=Math.min(bLe,1/Math.abs(de(o,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),wLe);bY(this._planeHorizontal,this._planeHorizontal,r),this.startCamera.aboveGround||Bot(this._planeHorizontal,this._planeHorizontal);const c=$(),h=$(),d=$();ye(c,r,this.currentCamera.eye);const f=Te(c);if(ae(c,c),this._navMode===va.Vertical){ie(o,o,a),ye(this._planeVertical,n,o),ae(this._planeVertical,this._planeVertical),bY(this._planeVertical,this._planeVertical,r);const m=this.view._stage.renderView.getMinimalDepthForArea(m3(this.view),this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,qD);let y=m??l;y=s?Math.min(y,f):y,ne(d,oe(h,this.currentCamera.eye,ie(h,c,y))),this._planeVertical[3]=-de(this._planeVertical,d),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),C8(this._tmpPoints,this._beginCenter)}else{const m=s?f:l;ne(d,oe(h,this.currentCamera.eye,ie(h,c,m))),this._planeHorizontal[3]=-de(this._planeHorizontal,d),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),C8(this._tmpPoints,this._beginCenter)}this._beginCamera.copyFrom(this.startCamera)}update(e){if(!this.running)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1,r=this._navMode===va.Horizontal?this._planeHorizontal:this._planeVertical,s=this._beginCenter;if(i){const n=this._beginRadius/e.radius,o=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=o,this._scalingValueSmooth.update(n),vne(this.currentCamera,s,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=Kt.ZOOM,this._constraintOptions.interactionFactor=nd(Math.abs(e.radius-this._beginRadius)),Os(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,r,this.currentCamera,this._tmpPoints),C8(this._tmpPoints,this._tmpCentroid3d),jp(e.center,this._tmpCentroid2d),ELe(this.currentCamera,s,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=Kt.PAN,this._constraintOptions.interactionFactor=nd(lv(this._beginCenterScreen,this._tmpCentroid2d)),Os(this.view,this.currentCamera,this._constraintOptions),i){const n=s,o=this._rotationValueSmooth.value,a=o+tX(e.angle-o),l=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=l,this._rotationValueSmooth.update(a);const c=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(c,.001*e.timestamp);const h=this._planeHorizontal;Pb(this.currentCamera,n,p3(h,c)),this._constraintOptions.interactionType=Kt.TUMBLE,this._constraintOptions.interactionFactor=nd(Math.abs(e.radius*c)),Os(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return new eC({view:this.view,momentum:i,zoomCenter:this._beginCenter});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new rx({view:this.view,momentum:r,center:this._beginCenter,axis:this._planeHorizontal});const s=this._panMomentumEstimator.evaluateMomentum();return s?new jR({view:this.view,momentum:s}):null}_computePlanePoints(e,i,r,s){s.length=e.size;const n=this._tmp2d;let o=0;return e.forEach(a=>{n[0]=a.x,n[1]=a.y,s[o]===void 0&&(s[o]=$()),iX(i,r,n,s[o]),o+=1}),s}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};aX=u([A("esri.views.3d.state.controllers.PinchAndPanControllerLocal")],aX);let Hme=class extends ss{constructor(e,i,r){super(!0),this._view=e,this.pointerActions=i,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!Die(e.data,this.pointerActions))return;const i=e.timestamp-this._lastEndTimestamp,r=40,s=this._momentum&&this._momentum.running&&i<r;switch(e.data.action){case"start":case"update":if(s)break;this._controller&&this._controller.running?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,i){if(this._controller?.running){this._lastEndTimestamp=e.timestamp;const r=this._controller.end(e.data);i&&r&&(this._momentum=r,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new oX({view:this._view}):new aX({view:this._view})}},$wt=class extends ss{constructor(e,i){super(!0),this.view=e,this.registerIncoming("pointer-down",i,()=>this.view.state.stopActiveCameraController())}},Awt=class extends ss{constructor(e,i=!1){super(!0),this._view=e,this._invert=i,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(e){const i=this._invert?-1:1,r=nn(0,e.data.delta*i);switch(e.data.action){case"begin":this._cameraController?.end(),this._cameraController=new VR({view:this._view,pivot:kc.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController?.update(r);break;case"end":this._cameraController?.end(),this._cameraController=null}}},Mwt=class extends ss{constructor(e=20,i=40){super(!1),this._threshold=e,this._maxDelta=i,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new wD({start:(r,s)=>this._observeStart(r,s),update:(r,s,n)=>this._observeUpdate(r,s,n),end:(r,s)=>this._observeEnd(s)}),this.registerIncoming("drag",r=>this._dragEventSeparator.handle(r))}get failed(){return this._state==="failed"}_observeStart(e,i){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),i.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,i,r){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void i.stopPropagation()):void(this._checkMovementWithinLimits(i.data,r.data)?this._checkVerticalThresholdReached(i.data,r.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=i.data.center,this._artificalDrag.emit({action:"end",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),i.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,i){let r=-1/0,s=1/0,n=-1/0,o=1/0;for(const{x:v,y:_}of i.pointers.values())r=Math.max(r,v),s=Math.min(s,v),n=Math.max(n,_),o=Math.min(o,_);let a=-1/0,l=1/0,c=-1/0,h=1/0;for(const{x:v,y:_}of e.pointers.values())a=Math.max(a,v),l=Math.min(l,v),c=Math.max(c,_),h=Math.min(h,_);const d=r-s,f=n-o,m=a-l,y=c-h;return Math.abs(e.center.x-i.center.x)<this._threshold&&Math.abs(m-d)<=this._maxDelta&&Math.abs(y-f)<=this._maxDelta}_checkVerticalThresholdReached(e,i){let r=Math.abs(e.center.y-i.center.y);return e.pointers.forEach((s,n)=>{const o=i.pointers.get(n);r=Math.min(r,Math.abs(s.y-o.y))}),r>=this._threshold}},em=class extends ue{constructor(){super(...arguments),this.mode="default",this._updateMode=({mode:e,dragPrimary:i,dragSecondary:r,dragTertiary:s})=>{e==="pro"&&(r="zoom",s=i==="pan"?"rotate":"pan");const n={dragPrimary:i,dragSecondary:r,dragTertiary:s};this._modeDragPan&&(this._modeDragPan.pointerActions=MR("pan",n)),this._modeDragRotate&&(this._modeDragRotate.pointerActions=MR("rotate",n)),this._modeDragZoom&&(this._modeDragZoom.pointerActions=MR("zoom",n))}}destroy(){this.disconnect()}get primaryDragAction(){return this.view.navigation.actionMap.dragPrimary}set primaryDragAction(e){const{actionMap:i}=this.view.navigation;i.dragPrimary=e,i.dragSecondary=e==="pan"?"rotate":"pan"}get updating(){return!!this._inputManager?.updating}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}get multiTouchActive(){return this._inputManager?.multiTouchActive??!1}disconnect(){this.removeAllHandles(),this.view.viewEvents.disconnect(),this._modeDragPan=null,this._modeDragRotate=null,this._modeDragZoom=null,this._modeKeyboardNavigation=null,this._inputManager=Ce(this._inputManager),this._source=Ce(this._source)}connect(){const e=this.view;this._source=new Fie(this.view.surface,e.input);const i=[new FAe,new kAe,new zAe,new LAe(this.view.navigation),new Mwt],r=new Du({eventSource:this._source,recognizers:i});this._inputManager=r,r.installHandlers("prevent-context-menu",[new DAe],Pm.INTERNAL);const s={fov:"Shift",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:["u","U"],down:["j","J"]},lookAround:{headingLeft:["a","A"],headingRight:["d","D"],tiltUp:["w","W"],tiltDown:["s","S"],modifier:"b"},zoom:{zoomIn:["+","="],zoomOut:["-","_"]},reset:{heading:["n","N"],tilt:["p","P"]}};this._modeDragPan=new Hme(e,["primary"]),this._modeDragRotate=new F8(e,["secondary"],kc.CENTER),this._modeDragZoom=new hwt(e,["tertiary"],s.fov),this._modeKeyboardNavigation=new bwt(e,s),r.installHandlers("navigation",[new $wt(e),new gbt(e),new _wt(e),new wwt(e,s.fov),new F8(e,["primary"],kc.EYE,[s.lookAround.modifier]),new F8(e,["secondary"],kc.CENTER,[s.lookAround.modifier]),new Hme(e,["tertiary"],[s.lookAround.modifier]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,this._modeKeyboardNavigation,new Awt(e)],Pm.INTERNAL),this.view.viewEvents.connect(r),this.addHandles([H(()=>this.view.navigation?.browserTouchPanEnabled,n=>{this._source.browserTouchPanningEnabled=!n},Nt),H(()=>{const{actionMap:n}=this.view.navigation,{dragPrimary:o,dragSecondary:a,dragTertiary:l}=n;return{mode:this.mode,dragPrimary:o,dragSecondary:a,dragTertiary:l}},this._updateMode,St)])}isModifierKeyDown(e){return this._inputManager?.isModifierKeyDown(e)??!1}get test(){}};u([p()],em.prototype,"view",void 0),u([p({type:["default","pro"]})],em.prototype,"mode",void 0),u([p({readOnly:!0})],em.prototype,"updating",null),u([p()],em.prototype,"latestPointerType",null),u([p()],em.prototype,"latestPointerLocation",null),u([p()],em.prototype,"multiTouchActive",null),u([p()],em.prototype,"_inputManager",void 0),em=u([A("esri.views.3d.input.SceneInputManager")],em);const Owt=em;let Vu,VC,lX=!1,cX=!1,uX=!1,hX=!1,GR=null;function Iwt(t,e){if(!cX||!VC)return;WLe();const i=VC;let r=0;for(let s=0;s<t.accBinsNumX;s++)for(let n=0;n<t.accBinsNumY;n++){const o=t.accBins[s][t.accBinsNumY-1-n];r+=o.length;const a=s*t.accBinsSizeX,l=(s+1)*t.accBinsSizeX,c=n*t.accBinsSizeY,h=(n+1)*t.accBinsSizeY;i.fillText(o.length.toFixed(),a+5,c+15),ZLe(a,l,c,h,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+e.size,70,50),i.fillText("total numTests: "+t.accNumTests,70,30)}function Rwt(t){uX=bs.DECONFLICTOR_SHOW_VISIBLE,hX=bs.DECONFLICTOR_SHOW_INVISIBLE,lX=uX||hX,cX=bs.DECONFLICTOR_SHOW_GRID,GR=null,lX||cX?GR=()=>Pwt(t):Vu&&(Vu.parentElement.removeChild(Vu),Vu=null)}function WLe(){GR&&(GR(),GR=null)}function Pwt(t){Vu==null&&(Vu=document.createElement("canvas"),Vu.setAttribute("id","debugCanvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(Vu));const{state:e}=t,{camera:i,pixelRatio:r}=e,{width:s,height:n}=i,o=s*r,a=n*r;Vu.setAttribute("width",`${o}px`),Vu.setAttribute("height",`${a}px`),Vu.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),VC=Vu.getContext("2d"),VC.clearRect(0,0,s,n),VC.font="12px Arial"}function ZLe(t,e,i,r,s){WLe();const n=Vu.height,o=VC;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(t,n-i),o.lineTo(e,n-i),o.stroke(),o.lineTo(e,n-r),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.closePath()}function Dwt(t,e){lX&&(e&&uX||!e&&hX)&&ZLe(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var _a,bo;(function(t){t[t.USER=1]="USER",t[t.SCALE_RANGE=2]="SCALE_RANGE",t[t.FILTER=4]="FILTER",t[t.DECONFLICTION=8]="DECONFLICTION",t[t.ALL_GRAPHIC=15]="ALL_GRAPHIC",t[t.ALL_LABEL=255]="ALL_LABEL"})(_a||(_a={})),function(t){t[t.GRAPHIC=1]="GRAPHIC",t[t.LABEL=16]="LABEL"}(bo||(bo={}));function Lwt(t){return t instanceof Float32Array&&t.length>=16}function Nwt(t){return Array.isArray(t)&&t.length>=16}function Fwt(t){return Lwt(t)||Nwt(t)}const YLe=.5;function JLe(t,e){t.include(bse),t.attributes.add(z.POSITION,"vec3"),t.attributes.add(z.NORMAL,"vec3"),t.attributes.add(z.CENTEROFFSETANDDISTANCE,"vec4");const i=t.vertex;By(i,e),Ib(i,e),i.uniforms.add(new Ua("viewport",r=>r.camera.fullViewport),new pt("polygonOffset",r=>r.shaderPolygonOffset),new Fn("cameraGroundRelative",r=>r.camera.aboveGround?1:-1)),e.hasVerticalOffset&&APe(i),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add(E`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(E`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${e.terrainDepthTest?E.float(0):E`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),e.draped&&!e.hasVerticalOffset||VU(i),e.draped||(i.uniforms.add(new Fn("perDistancePixelRatio",r=>Math.tan(r.camera.fovY/2)/(r.camera.fullViewport[2]/2))),i.code.add(E`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${E.float(YLe)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),e.screenCenterOffsetUnitsEnabled&&LD(i),e.hasScreenSizePerspective&&Kj(i),i.code.add(E`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?E`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled?"":E`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}let XLe=class{constructor(){this.factor=new qme,this.factorAlignment=new qme}},qme=class{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}};function vG(t){t.uniforms.add(new GU("alignPixelEnabled",e=>e.alignPixelEnabled)),t.code.add(E`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),t.code.add(E`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}function kwt(t,e){const{vertex:i,fragment:r}=t;t.include(zD,e),i.include(vG),i.main.add(E`vec4 posProjCenter;
if (dot(position, position) > 0.0) {
ProjectHUDAux projectAux;
vec4 posProj = projectPositionHUD(projectAux);
posProjCenter = alignToPixelCenter(posProj, viewport.zw);
forwardViewPosDepth(projectAux.posView);
vec3 vpos = projectAux.posModel;
if (rejectBySlice(vpos)) {
posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
}
} else {
posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
}
gl_Position = posProjCenter;
gl_PointSize = 1.0;`),r.main.add(E`fragColor = vec4(1);
if(discardByTerrainDepth()) {
fragColor.g = 0.5;
}`)}function KLe(t){t.vertex.uniforms.add(new Fn("renderTransparentlyOccludedHUD",e=>e.hudRenderStyle===da.Occluded?1:e.hudRenderStyle===da.NotOccluded?0:.75),new Ua("viewport",e=>e.camera.fullViewport),new so("hudVisibilityTexture",e=>e.hudVisibility?.getTexture())),t.vertex.include(vG),t.vertex.code.add(E`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}function QLe(t){const e=new ki,i=t.signedDistanceFieldEnabled;e.include(JLe,t),e.vertex.include(yPe,t);const{occlusionPass:r,output:s,oitPass:n}=t;if(r)return e.include(kwt,t),e;const{vertex:o,fragment:a}=e;e.include(bse),e.include(Lx,t),e.include(wse,t),e.include(KLe),a.include(Zb),a.include(FA),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2");const l=s===Y.Highlight,c=l&&t.occlusionTestEnabled;c&&e.varyings.add("voccluded","float"),o.uniforms.add(new Ua("viewport",y=>y.camera.fullViewport),new fc("screenOffset",(y,v)=>li(s5,2*y.screenOffset[0]*v.camera.pixelRatio,2*y.screenOffset[1]*v.camera.pixelRatio)),new fc("anchorPosition",y=>y3(y)),new uc("materialColor",y=>y.color),new pt("materialRotation",y=>y.rotation)),LD(o),i&&(o.uniforms.add(new uc("outlineColor",y=>y.outlineColor)),a.uniforms.add(new uc("outlineColor",y=>Wme(y)?y.outlineColor:sn),new pt("outlineSize",y=>Wme(y)?y.outlineSize:0))),t.horizonCullingEnabled&&o.uniforms.add(new i3("pointDistanceSphere",(y,v)=>{const _=v.camera.eye,b=y.origin;return Gi(b[0]-_[0],b[1]-_[1],b[2]-_[2],xi.radius)})),t.pixelSnappingEnabled&&o.include(vG),t.hasScreenSizePerspective&&(ypt(o),Kj(o)),t.debugDrawLabelBorder&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(z.UV0,"vec2"),e.attributes.add(z.COLOR,"vec4"),e.attributes.add(z.SIZE,"vec2"),e.attributes.add(z.ROTATION,"float"),e.attributes.add(z.FEATUREATTRIBUTE,"vec4"),o.code.add(t.horizonCullingEnabled?E`bool behindHorizon(vec3 posModel) {
vec3 camToEarthCenter = pointDistanceSphere.xyz - localOrigin;
vec3 camToPos = pointDistanceSphere.xyz + posModel;
float earthRadius = pointDistanceSphere.w;
float a = dot(camToPos, camToPos);
float b = dot(camToPos, camToEarthCenter);
float c = dot(camToEarthCenter, camToEarthCenter) - earthRadius * earthRadius;
return  b > 0.0 && b < a && b * b  > a * c;
}`:E`bool behindHorizon(vec3 posModel) { return false; }`),o.main.add(E`
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }

      if (behindHorizon(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }

      vec2 inputSize;
      ${Se(t.hasScreenSizePerspective,E`
          inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
          vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);`,E`
          inputSize = size;
          vec2 screenOffsetScaled = screenOffset;`)}
      ${Se(t.vvSize,E`inputSize *= vvScale(featureAttribute).xx;`)}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${Se(t.occlusionTestEnabled,E`
      bool visible = testHUDVisibility(posProj);
      if (!visible) {
        vtc = vec2(0.0);
        ${Se(t.debugDrawLabelBorder,"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);")}
        return;
      }`)}
      ${Se(c,E`voccluded = visible ? 0.0 : 1.0;`)}
    `);const h=E`
      vec2 uv01 = floor(uv0);
      vec2 uv = uv0 - uv01;
      quadOffset.xy = (uv01 - anchorPosition) * 2.0 * combinedSize;

      ${Se(t.hasRotation,E`
          float angle = radians(materialRotation + rotation);
          float cosAngle = cos(angle);
          float sinAngle = sin(angle);
          mat2 rotate = mat2(cosAngle, -sinAngle, sinAngle,  cosAngle);

          quadOffset.xy = rotate * quadOffset.xy;
        `)}

      quadOffset.xy = (quadOffset.xy + screenOffsetScaled) / viewport.zw * posProj.w;
  `,d=t.pixelSnappingEnabled?i?E`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:E`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:E`posProj += quadOffset;`;o.main.add(E`
    ${h}
    ${t.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${Se(s===Y.ObjectAndLayerIdColor,E`vcolor.a = 1.0;`)}

    bool alphaDiscard = vcolor.a < ${E.float(Yr)};
    ${Se(i,`alphaDiscard = alphaDiscard && outlineColor.a < ${E.float(Yr)};`)}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${d}
      gl_Position = posProj;
    }

    vtc = uv;

    ${Se(t.debugDrawLabelBorder,E`debugBorderCoords = vec4(uv01, 1.5 / combinedSize);`)}
    vsize = inputSize;
  `),a.uniforms.add(new $t("tex",y=>y.texture)),t.occludedFragmentFade&&(a.uniforms.add(new so("depthMap",y=>y.mainDepth)),a.uniforms.add(new Fn("occludedOpacity",y=>y.hudOccludedFragmentOpacity)));const f=t.debugDrawLabelBorder?E`(isBorder > 0.0 ? 0.0 : ${E.float(Yr)})`:E.float(Yr),m=E`
    ${Se(t.debugDrawLabelBorder,E`float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`)}

    ${Se(t.sampleSignedDistanceFieldTexelCenter,E`
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;`,E`vec2 samplePos = vtc;`)}

    ${i?E`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgbaTofloat(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${f} ||
          fillPixelColor.a + outlinePixelColor.a < ${E.float(Yr)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        ${Se(!l,E`fragColor = vec4(compositeColor, compositeAlpha);`)}
      } else {
        if (fillAlphaFactor < ${f}) {
          discard;
        }

        ${Se(!l,E`fragColor = premultiplyAlpha(fillPixelColor);`)}
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:E`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${f}) {
            discard;
          }
          ${Se(!l,E`fragColor = texColor * premultiplyAlpha(vcolor);`)}
          `}

    ${Se(t.occludedFragmentFade&&!l,E`
        float zSample = texelFetch(depthMap, ivec2(gl_FragCoord.xy), 0).x;
        if (zSample < gl_FragCoord.z) {
          fragColor *= occludedOpacity;
        }
        `)}

    ${Se(!l&&t.debugDrawLabelBorder,E`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`)}
  `;switch(s){case Y.Color:case Y.ColorEmission:e.outputs.add("fragColor","vec4",0),s===Y.ColorEmission&&e.outputs.add("fragEmission","vec4",1),n===bi.ColorAlpha&&e.outputs.add("fragAlpha","float",s===Y.ColorEmission?2:1),a.main.add(E`
        ${m}
        ${Se(n===bi.FrontFace,E`fragColor.rgb /= fragColor.a;`)}
        ${Se(s===Y.ColorEmission,E`fragEmission = vec4(0.0);`)}
        ${Se(n===bi.ColorAlpha,E`fragAlpha = fragColor.a;`)}`);break;case Y.ObjectAndLayerIdColor:a.main.add(E`
        ${m}
        outputObjectAndLayerIdColor();`);break;case Y.Highlight:e.include(ND,t),a.main.add(E`
        ${m}
        outputHighlight(${Se(c,E`voccluded == 1.0`,E`false`)});`)}return e}function Wme(t){return t.outlineColor[3]>0&&t.outlineSize>0}function y3(t){return t.textureIsSignedDistanceField?zwt(t.anchorPosition,t.distanceFieldBoundingBox,s5):zn(s5,t.anchorPosition),s5}function zwt(t,e,i){li(i,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1])}const s5=He(),Uwt=Object.freeze(Object.defineProperty({__proto__:null,build:QLe,calculateAnchorPosition:y3},Symbol.toStringTag,{value:"Module"}));let Bwt=class extends Bi{constructor(e,i){super(e,i,new Fi(Uwt,()=>V(()=>Promise.resolve().then(()=>NGt),void 0))),this.primitiveType=i.occlusionPass?Ui.POINTS:Ui.TRIANGLES}initializePipeline(e){const{oitPass:i,hasPolygonOffset:r,draped:s,output:n,depthTestEnabled:o,occlusionPass:a}=e,l=i===bi.NONE,c=i===bi.ColorAlpha,h=n===Y.Highlight,d=o&&!s&&!c&&!a&&!h;return _i({blending:_s(n)?l?NA:Rdt(i):null,depthTest:o&&!s?{func:Ni.LEQUAL}:null,depthWrite:d?DD:null,drawBuffers:Gj(i,n),colorWrite:Ai,polygonOffset:r?Vwt:null})}};const Vwt={factor:0,units:-4};let Tn=class extends zm{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hasRotation=!1,this.debugDrawLabelBorder=!1,this.hasPolygonOffset=!1,this.depthTestEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.occlusionPass=!1,this.occludedFragmentFade=!1,this.objectAndLayerIdColorInstanced=!1,this.horizonCullingEnabled=!0,this.isFocused=!0,this.textureCoordinateType=Ws.None,this.emissionSource=Jo.None,this.discardInvisibleFragments=!0,this.hasVvInstancing=!1}};u([te()],Tn.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([te()],Tn.prototype,"occlusionTestEnabled",void 0),u([te()],Tn.prototype,"signedDistanceFieldEnabled",void 0),u([te()],Tn.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),u([te()],Tn.prototype,"vvSize",void 0),u([te()],Tn.prototype,"vvColor",void 0),u([te()],Tn.prototype,"hasVerticalOffset",void 0),u([te()],Tn.prototype,"hasScreenSizePerspective",void 0),u([te()],Tn.prototype,"hasRotation",void 0),u([te()],Tn.prototype,"debugDrawLabelBorder",void 0),u([te()],Tn.prototype,"hasPolygonOffset",void 0),u([te()],Tn.prototype,"depthTestEnabled",void 0),u([te()],Tn.prototype,"pixelSnappingEnabled",void 0),u([te()],Tn.prototype,"draped",void 0),u([te()],Tn.prototype,"terrainDepthTest",void 0),u([te()],Tn.prototype,"cullAboveTerrain",void 0),u([te()],Tn.prototype,"occlusionPass",void 0),u([te()],Tn.prototype,"occludedFragmentFade",void 0),u([te()],Tn.prototype,"objectAndLayerIdColorInstanced",void 0),u([te()],Tn.prototype,"horizonCullingEnabled",void 0),u([te()],Tn.prototype,"isFocused",void 0);let Tne=class extends jj{constructor(e,i){super(e,Kwt),this.produces=new Map([[be.HUD_MATERIAL,r=>k4(r)&&!this.parameters.drawAsLabel],[be.LABEL_MATERIAL,r=>k4(r)&&this.parameters.drawAsLabel],[be.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[be.DRAPED_MATERIAL,r=>this.parameters.draped&&k4(r)]]),this._visible=!0,this._configuration=new Tn(i)}getConfiguration(e,i){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.draped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.hasRotation=this.parameters.hasRotation,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=i.slot===be.OCCLUSION_PIXELS,this._configuration.occludedFragmentFade=this.parameters.occludedFragmentFade,this._configuration.horizonCullingEnabled=this.parameters.horizonCullingEnabled,this._configuration.isFocused=this.parameters.isFocused,this._configuration.depthTestEnabled=this.parameters.depthEnabled||i.slot===be.OCCLUSION_PIXELS,_s(e)&&(this._configuration.debugDrawLabelBorder=!!bs.LABELS_SHOW_BORDER),this._configuration.oitPass=i.oitPass,this._configuration.terrainDepthTest=i.terrainDepthTest,this._configuration.cullAboveTerrain=i.cullAboveTerrain,this._configuration}intersect(e,i,r,s,n,o){const{options:{selectionMode:a,hud:l,excludeLabels:c},point:h,camera:d}=r,{parameters:f}=this;if(!a||!l||c&&f.isLabel||!e.visible||!h)return;const{scaleX:m,scaleY:y}=this._getScreenScale(e,d.pixelRatio);FS(U8,i),e.attributes.has(z.FEATUREATTRIBUTE)&&Hwt(U8);const v=e.attributes.get(z.POSITION),_=e.attributes.get(z.SIZE),b=e.attributes.get(z.NORMAL),w=e.attributes.get(z.ROTATION),x=e.attributes.get(z.CENTEROFFSETANDDISTANCE);jt(v.size>=3);const S=y3(f),C=this.parameters.centerOffsetUnits==="screen";for(let T=0;T<v.data.length/v.size;T++){const M=T*v.size;se(Ma,v.data[M],v.data[M+1],v.data[M+2]),st(Ma,Ma,i),st(Ma,Ma,d.viewMatrix);const I=T*x.size;if(se(gu,x.data[I],x.data[I+1],x.data[I+2]),!C&&(Ma[0]+=gu[0],Ma[1]+=gu[1],gu[2]!==0)){const D=gu[2];ae(gu,Ma),ye(Ma,Ma,ie(gu,gu,D))}const P=T*b.size;if(se(BM,b.data[P],b.data[P+1],b.data[P+2]),Zme(BM,U8,d,V8),this._applyVerticalOffsetTransformationView(Ma,V8,d,z8),d.applyProjection(Ma,Qa),Qa[0]>-1){C&&(gu[0]||gu[1])&&(Qa[0]+=gu[0]*d.pixelRatio,gu[1]!==0&&(Qa[1]+=ose(gu[1],z8.factorAlignment)*d.pixelRatio),d.unapplyProjection(Qa,Ma)),Qa[0]+=this.parameters.screenOffset[0]*d.pixelRatio,Qa[1]+=this.parameters.screenOffset[1]*d.pixelRatio,Qa[0]=Math.floor(Qa[0]),Qa[1]=Math.floor(Qa[1]);const D=T*_.size;_c[0]=_.data[D],_c[1]=_.data[D+1],VRe(_c,z8.factor,_c);const F=Ywt*d.pixelRatio;let L=0;f.textureIsSignedDistanceField&&(L=Math.min(f.outlineSize,.5*_c[0])*d.pixelRatio/2),_c[0]*=m,_c[1]*=y;const N=T*w.size,R=f.rotation+w.data[N];if(Yme(h,Qa[0],Qa[1],_c,F,L,R,f,S)){const k=r.ray;if(st(Jme,Ma,Sl(Wwt,d.viewMatrix)),Qa[0]=h[0],Qa[1]=h[1],d.unprojectFromRenderScreen(Qa,Ma)){const W=$();ne(W,k.direction);const G=1/Te(W);ie(W,W,G),o(xr(k.origin,Ma)*G,W,-1,!0,1,Jme)}}}}}intersectDraped(e,i,r,s,n,o){const a=e.attributes.get(z.POSITION),l=e.attributes.get(z.SIZE),c=e.attributes.get(z.ROTATION),h=this.parameters,d=y3(h),{scaleX:f,scaleY:m}=this._getScreenScale(e,e.screenToWorldRatio),y=Jwt*e.screenToWorldRatio;for(let v=0;v<a.data.length/a.size;v++){const _=v*a.size,b=a.data[_],w=a.data[_+1],x=v*l.size;_c[0]=l.data[x],_c[1]=l.data[x+1];let S=0;h.textureIsSignedDistanceField&&(S=Math.min(h.outlineSize,.5*_c[0])*e.screenToWorldRatio/2),_c[0]*=f,_c[1]*=m;const C=v*c.size,T=h.rotation+c.data[C];Yme(s,b,w,_c,y,S,T,h,d)&&n(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new e1t}_updateScaleInfo(e,i,r){const s=this.parameters;s.screenSizePerspective!=null?Qde(r,i,s.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),s.screenSizePerspectiveAlignment!=null?Qde(r,i,s.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,i,r,s,n,o,a){const l=Zme(i,r,n,V8);return this._applyVerticalGroundOffsetView(e,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(e,i,r,s,n){return this._applyCenterOffsetNDC(e,i,r,s),n!=null&&ne(n,s),this._applyPolygonOffsetNDC(s,i,r,s),s}_applyPolygonOffsetView(e,i,r,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(r);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return ne(n,e);const c=ce(Math.abs(i.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/s.viewport[2];return ie(n,e,l>0?h:1/h),n}_applyVerticalGroundOffsetView(e,i,r,s){const n=Te(e),o=r.aboveGround?1:-1,a=r.computeRenderPixelSizeAtDist(n)*YLe,l=ie(Ma,i.normal,o*a);return oe(s,e,l),s}_applyVerticalOffsetTransformationView(e,i,r,s){const n=this.parameters;if(!n.verticalOffset?.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const c=Te(e);this._updateScaleInfo(s,c,i.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return e}const o=Te(e),a=n.screenSizePerspectiveAlignment??n.screenSizePerspective,l=qRe(r,o,n.verticalOffset,i.cosAngle,a);return this._updateScaleInfo(s,o,i.cosAngle),ie(i.normal,i.normal,l),oe(e,e,i.normal)}_applyCenterOffsetView(e,i,r){const s=this.parameters.centerOffsetUnits!=="screen";return r!==e&&ne(r,e),s&&(r[0]+=i[0],r[1]+=i[1],i[2]&&(ae(BM,r),oe(r,r,ie(BM,BM,i[2])))),r}_applyCenterOffsetNDC(e,i,r,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==e&&ne(s,e),n||(s[0]+=i[0]/r.fullWidth*2,s[1]+=i[1]/r.fullHeight*2),s}_applyPolygonOffsetNDC(e,i,r,s){const n=this.parameters.shaderPolygonOffset;if(e!==s&&ne(s,e),n){const o=r.aboveGround?1:-1,a=o*Math.sign(i[3]);s[2]-=(a||o)*n}return s}set visible(e){this._visible=e}get visible(){const{color:e,outlineSize:i,outlineColor:r}=this.parameters,s=e[3]>=Yr||i>=Yr&&r[3]>=Yr;return this._visible&&s}createGLMaterial(e){return new jwt(e)}calculateRelativeScreenBounds(e,i,r=Qt()){return Gwt(this.parameters,e,i,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}_getScreenScale(e,i){const r=e.attributes.get(z.FEATUREATTRIBUTE);if(r==null)return{scaleX:i,scaleY:i};const s=ere(r.data,Zwt);return Ppt(B8,this.parameters,s),{scaleX:B8[0]*i,scaleY:B8[1]*i}}},jwt=class extends FRe{constructor(e){super({...e,...e.material.parameters})}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.getTechnique(Bwt,e)}};function Gwt(t,e,i,r){r[0]=t.anchorPosition[0]*-e[0]+t.screenOffset[0]*i,r[1]=t.anchorPosition[1]*-e[1]+t.screenOffset[1]*i}function Zme(t,e,i,r){return Fwt(e)&&(e=FS(qwt,e)),ac(r.normal,t,e),st(r.normal,r.normal,i.viewInverseTransposeMatrix),r.cosAngle=de(eNe,Xwt),r}function Hwt(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=1/Math.sqrt(e*e+i*i+r*r),d=1/Math.sqrt(s*s+n*n+o*o),f=1/Math.sqrt(a*a+l*l+c*c);return t[0]=e*h,t[1]=i*h,t[2]=r*h,t[3]=s*d,t[4]=n*d,t[5]=o*d,t[6]=a*f,t[7]=l*f,t[8]=c*f,t}function Yme(t,e,i,r,s,n,o,a,l){let c=e-s-r[0]*l[0],h=c+r[0]+2*s,d=i-s-r[1]*l[1],f=d+r[1]+2*s;const m=a.distanceFieldBoundingBox;return a.textureIsSignedDistanceField&&m!=null&&(c+=r[0]*m[0],d+=r[1]*m[1],h-=r[0]*(1-m[2]),f-=r[1]*(1-m[3]),c-=n,h+=n,d-=n,f+=n),li(Xme,e,i),V$e(VM,t,Xme,wt(o)),VM[0]>c&&VM[0]<h&&VM[1]>d&&VM[1]<f}const z8=new XLe,Ma=$(),BM=$(),Qa=pi(),eNe=$(),Jme=$(),VM=He(),Xme=He(),U8=xs(),qwt=xs(),Wwt=Ve(),gu=$(),B8=$(),Zwt=pi(),V8={normal:eNe,cosAngle:0},Ywt=1,Jwt=2,_c=[0,0],Xwt=Le(0,0,1);let Kwt=class extends kRe{constructor(){super(...arguments),this.renderOccluded=Er.Occlude,this.isDecoration=!1,this.color=YP(1,1,1,1),this.polygonOffset=!1,this.anchorPosition=un(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=YP(1,1,1,1),this.outlineSize=0,this.distanceFieldBoundingBox=pi(),this.rotation=0,this.hasRotation=!1,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.occludedFragmentFade=!1,this.horizonCullingEnabled=!1,this.centerOffsetUnits="world",this.drawAsLabel=!1,this.depthEnabled=!0,this.isFocused=!0,this.focusEffect="none",this.draped=!1,this.isLabel=!1}};const tNe=Nd().vec3f(z.POSITION).vec3f(z.NORMAL).vec2f(z.UV0).vec4u8(z.COLOR).vec2f(z.SIZE).f32(z.ROTATION).vec4f(z.CENTEROFFSETANDDISTANCE).vec4f(z.FEATUREATTRIBUTE),Qwt=tNe.clone().vec4u8(z.OBJECTANDLAYERIDCOLOR);class e1t{constructor(){this.vertexBufferLayout=Md()?Qwt:tNe}elementCount(e){return 6*e.get(z.POSITION).indices.length}write(e,i,r,s,n,o){pse(r.get(z.POSITION),e,n.position,o,6),fse(r.get(z.NORMAL),i,n.normal,o,6);const a=r.get(z.UV0)?.data;let l=0,c=0,h=1,d=1;a&&a.length>=4&&(l=a[0],c=a[1],h=a[2],d=a[3]),h=Math.min(1.99999,h+1),d=Math.min(1.99999,d+1);let f=r.get(z.POSITION).indices.length,m=o;const y=n.uv0;for(let w=0;w<f;++w)y.set(m,0,l),y.set(m,1,c),m++,y.set(m,0,h),y.set(m,1,c),m++,y.set(m,0,h),y.set(m,1,d),m++,y.set(m,0,h),y.set(m,1,d),m++,y.set(m,0,l),y.set(m,1,d),m++,y.set(m,0,l),y.set(m,1,c),m++;hPe(r.get(z.COLOR),4,n.color,o,6);const{data:v,indices:_}=r.get(z.SIZE);f=_.length;const b=n.size;m=o;for(let w=0;w<f;++w){const x=v[2*_[w]],S=v[2*_[w]+1];for(let C=0;C<6;++C)b.set(m,0,x),b.set(m,1,S),m++}if(Ydt(r.get(z.ROTATION),n.rotation,o,6),r.get(z.CENTEROFFSETANDDISTANCE)?s3(r.get(z.CENTEROFFSETANDDISTANCE),n.centerOffsetAndDistance,o,6):spe(n.centerOffsetAndDistance,o,6*f),r.get(z.FEATUREATTRIBUTE)?s3(r.get(z.FEATUREATTRIBUTE),n.featureAttribute,o,6):spe(n.featureAttribute,o,6*f),s!=null){const w=r.get(z.POSITION)?.indices;if(w){const x=w.length,S=n.getField(z.OBJECTANDLAYERIDCOLOR,Qm);dPe(s,S,x,o,6)}}}}const Rf=$(),hF=$(),UT=pi(),jM=pi(),j8=$(),Kme=Ve(),t1t=Rs(),G8=Pn(),i1t=$(),r1t=Qt();class s1t{constructor(){this.aabr=Qt(),this.distance=0,this.distanceToTerrain=0,this.culled=!1,this.visible=!1}}class n1t{constructor(e,i){this.graphics3DGraphic=e,this.slicePlaneEnabled=i,this.info={}}}var Dc;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(Dc||(Dc={}));class o1t{constructor(){this.camera=new jr,this.slicePlane=qb(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),BS(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let sx=class extends ue{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._viewState=new o1t,this._state=Dc.Idle,this._active=new Map,this._visible=new Map,this._iterators=new u1t,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0,this._updatingHandles=new Hy}destroy(){this._updatingHandles.destroy(),this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==Dc.Idle||this._dirty||this._updatingHandles.updating}get updatingProgress(){if(!this.updating)return 1;const t=this._state/Dc.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case Dc.Idle:this._startUpdate(),t.madeProgress();case Dc.Process:if(this._state=Dc.Process,!this._processActiveGraphics(t))return;case Dc.Sort:if(this._state=Dc.Sort,!this._sortVisibleGraphics(t))return;case Dc.Deconflict:if(this._state=Dc.Deconflict,!this._deconflictVisibleGraphics(t))return;default:Iwt(this,this._visible),this._state=Dc.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(i=>this.addToActiveGraphics(i)):t.forEach(i=>this.removeFromActiveGraphics(i)),this.setDirty()}layerSupportsDeconfliction(t){if(t==null||t.type!=="object3d")return!1;const e=t.stageObject;return(e?.geometries.length??0)!==1?!1:e?.geometries[0]?.material instanceof Tne}_startUpdate(){Rwt(this.view),this._dirty=!1,this._viewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._viewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new s1t,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),a1t(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_createTerrainIntersector(){const t=lh(this.view.state.viewingMode);t.options.store=Eo.MIN;const e=this.view.basemapTerrain,i=this.view.state.camera;return dc(Kme,this._viewState.camera.viewInverseTransposeMatrix),r=>{st(hF,r,Kme),t.reset(i.eye,hF,i),e.intersect(t,null,i.eye,hF);const s=t.results.ground.dist;return s!=null?s*xr(hF,i.eye):0}}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),i=this._viewState.camera.inverseProjectionMatrix,r=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._viewState.camera.relativeElevation>0,s=X("enable-feature:non-occluded-hud")&&this.view.map.ground.opacity>0?this._createTerrainIntersector():null,n=r?t1t:null;let o=0;for(n!=null&&(st(n,on,this._viewState.camera.viewMatrix),n[3]=gr(this.view.spatialReference).radius,o=eIe(n,on));!t.done;){t.madeProgress();const a=e.next();if(a.done===!0)return this._resetActiveGraphicsIterator(),!0;const l=a.value,c=l?.info[this.visibilityGroup];c&&(this._collectGraphics3DGraphics(l,i,n,o,s),c.culled?(this._setGraphicVisibility(l,!1),this._visible.delete(l.graphics3DGraphic.graphic.uid)):this._visible.set(l.graphics3DGraphic.graphic.uid,l))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const i=e.next();if(t.madeProgress(),i.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),i=this.visibilityGroup===bo.LABEL;for(;!t.done;){t.madeProgress();const r=e.next();if(r.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=r.value,n=s.info[this.visibilityGroup];if(!n||n.culled){this._setGraphicVisibility(s,!1);continue}const o=s.graphics3DGraphic,a=!i||o.isVisible();n.visible=a&&!this._isConflicted(s),n.visible&&this._addToBins(s),this._setGraphicVisibility(s,n.visible),Dwt(n,n.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=Qme(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=Qme(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=l1t(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,i,r,s){const n=t.graphics3DGraphic;if(n.destroyed)return;const o=t.info[this.visibilityGroup];if(!n.isVisible(bo.GRAPHIC,_a.DECONFLICTION))return void(o.culled=!0);const a=this.getGraphicsLayers(n);sv(o.aabr);let l=null;for(const c of a){if(!this.layerSupportsDeconfliction(c))continue;const h=c.stageObject.geometries[0].material;if(l==null){if(l=f1t,this._getProjectionInfo(c,e,l),l.isOutsideScreen||this._isCulledBySlice(t,Rf)||i!=null&&p1t(l,i,r))return void(o.culled=!0);l.distanceToTerrain=s?.(l.positionView)??0}this._expandBoundingRect(o,c,h,l)}l==null?o.culled=!0:(o.distance=l.distance,o.distanceToTerrain=l.distanceToTerrain,o.culled=!1)}_getProjectionInfo(t,e,i){const r=this._viewState.camera,s=t.stageObject,n=s.geometries[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;st(Rf,a,r.viewMatrix);const l=n.attributes,c=l.get(z.NORMAL).data,h=l.get(z.CENTEROFFSETANDDISTANCE).data;o.applyShaderOffsetsView(Rf,c,s.transformation,h,r,i.scaleInfo,Rf),es(UT,Rf[0],Rf[1],Rf[2],1),Yc(jM,UT,r.projectionMatrix),ie(i.positionNDC,jM,1/jM[3]),o.applyShaderOffsetsNDC(i.positionNDC,h,r,i.positionNDC,j8),i.distanceWithoutPolygonOffset=r.depthNDCToWorld(j8[2]),i.distance=j8[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:r.depthNDCToWorld(i.positionNDC[2]),es(jM,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),Yc(UT,jM,e),P$(UT,UT,1/UT[3]),se(i.positionView,Rf[0],Rf[1],Rf[2])}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._viewState.slicePlaneEnabled&&pre(this._viewState.slicePlane,e)}_expandBoundingRect(t,e,i,{positionNDC:r,scaleInfo:s}){const{fullWidth:n,fullHeight:o,pixelRatio:a}=this._viewState.camera,l=e.getScreenSize(h1t);VRe(l,s.factor,l),l[0]*=a,l[1]*=a;const c=Gz(i.calculateRelativeScreenBounds(l,s.factorAlignment.scale*a,r1t),dt(0,n,.5+.5*r[0]),dt(0,o,.5+.5*r[1])),h=this.marginFactor;if(h!==0){const d=h*Math.min(Zo(c),wl(c));c[0]-=d,c[1]-=d,c[2]+=d,c[3]+=d}vC(t.aabr,c,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,i=t.info[this.visibilityGroup];let r=!0;for(let s=Math.floor(i.aabr[0]/this._accBinsSizeX);s<=Math.floor(i.aabr[2]/this._accBinsSizeX);s++)if(!(s<0||s>=this._accBinsNumX))for(let n=Math.floor(i.aabr[1]/this._accBinsSizeY);n<=Math.floor(i.aabr[3]/this._accBinsSizeY);n++){if(n<0||n>=this._accBinsNumY)continue;r=!1;const o=this._accBins[s][n];for(let a=0;a<o.length;a++){const l=o.data[a],c=l.info[this.visibilityGroup];if(c&&c.visible&&l.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,RP(c.aabr,i.aabr)))return!0}}return r}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let i=0;i<this._accBinsNumX;i++){this._accBins.push([]);const r=this._accBins[this._accBins.length-1];for(let s=0;s<this._accBinsNumY;s++)r.push(new Jt)}}else for(let i=0;i<this._accBinsNumX;i++)for(let r=0;r<this._accBinsNumY;r++)this._accBins[i][r].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],i=Math.floor(e.aabr[0]/this._accBinsSizeX),r=Math.floor(e.aabr[2]/this._accBinsSizeX),s=Math.floor(e.aabr[1]/this._accBinsSizeY),n=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let o=i;o<=r;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(t)}_setGraphicVisibility(t,e){const i=t.graphics3DGraphic;i.destroyed||(i.setVisibilityFlag(this.visibilityGroup,_a.DECONFLICTION,e),this.visibilityGroup===bo.LABEL&&this.view.labeler.setLabelGraphicVisibility(i,e))}};function a1t(t,e){const i=t.graphics3DGraphic;i.destroyed||i.setVisibilityFlag(e,_a.DECONFLICTION,!0)}function*Qme(t){if(Map.prototype.entries){const e=t.entries();for(let i=e.next();!i.done;i=e.next())yield i.value[1]}else yield*t.values()}function*l1t(t,e,i){e.clear(),t.forEach((s,n)=>{const o=e.pushNew();o.id=n,o.visible=s.graphics3DGraphic.getVisibilityFlag(i,_a.DECONFLICTION);const a=s.info?.[i];o.prio=s.graphics3DGraphic.deconflictionPriority,o.distance=a?a.distance:Number.MAX_VALUE,o.behindTerrain=!!a&&a.distanceToTerrain!==0&&a.distance>a.distanceToTerrain}),yield;const r=e.iterableSort((s,n)=>s.behindTerrain!==n.behindTerrain?+s.behindTerrain-+n.behindTerrain:s.prio!==n.prio?n.prio-s.prio:s.distance!==n.distance?s.distance-n.distance:s.visible!==n.visible?+n.visible-+s.visible:s.id-n.id);for(let s=r.next();!s.done;s=r.next())yield;e.forAll(s=>{const n=t.get(s.id);n&&(t.delete(s.id),t.set(s.id,n))}),e.clear()}u([p({constructOnly:!0})],sx.prototype,"view",void 0),u([p({type:Boolean,readOnly:!0})],sx.prototype,"updating",null),u([p({readOnly:!0})],sx.prototype,"_updatingHandles",void 0),sx=u([A("esri.views.3d.layers.graphics.Deconflictor")],sx);class c1t{constructor(){this.id=0,this.visible=!1,this.behindTerrain=!1,this.prio=0,this.distance=0}}class u1t{constructor(e=null,i=null,r=null){this.active=e,this.visible=i,this.sort=r,this.sortArray=new Jt({allocator:s=>s||new c1t})}}const h1t=He();class d1t{constructor(){this.positionView=$(),this.positionNDC=$(),this.distance=0,this.distanceToTerrain=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new XLe}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1||e[2]>=1}}function p1t(t,e,i){return ne(G8.direction,t.positionView),se(G8.origin,0,0,0),!!Wb(e,G8,i1t)&&t.distanceWithoutPolygonOffset>i}const f1t=new d1t,m1t=2e3;let n5=class extends sx{constructor(e){super(e),this.visibilityGroup=bo.LABEL,this.marginFactor=.05,this._lastDeconfliction=0}initialize(){this._updatingHandles.add(()=>(this.view?.map?.ground?.opacity??0)===0,()=>this.setDirty())}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return Ko;const i=performance.now();if(e.state!==ai.IDLE&&i-this._lastDeconfliction<m1t)return Ko;super.runTask(e),this.state===Dc.Idle&&(this._lastDeconfliction=i)}enabledChanged(e,i){this.modifyGraphics(i,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};u([p({constructOnly:!0})],n5.prototype,"parent",void 0),n5=u([A("esri.views.3d.layers.graphics.LabelDeconflictor")],n5);let dX=class extends sx{constructor(){super(...arguments),this._contexts=new Map,this.visibilityGroup=bo.GRAPHIC,this._marginFactor=-.1,this.test={overrideMarginFactor:e=>{this._marginFactor=e,this.setDirty()}}}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._updatingHandles.add(()=>this.view?.state?.camera,()=>{this._updateViewState(),this.setDirty()}),this._updatingHandles.add(()=>this.view?.map?.ground?.opacity===1,()=>this.setDirty()),this._updatingHandles.add(()=>this.view?.slicePlane,()=>{this._updateSlicePlane(),this._slicePlaneChanged()},Nt),this._frameTask=this.view.resourceController.scheduler.registerTask(at.GRAPHICS_DECONFLICTOR,this),this._labels=new n5({view:this.view,parent:this})}destroy(){this._labels=Ce(this._labels),this._frameTask=Hi(this._frameTask)}get marginFactor(){return this._marginFactor}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}_updateViewState(){this.view?.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;e!=null&&qOe(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){for(const e of this._contexts.keys())if(e.symbolCreationContext.slicePlaneEnabled)return void this.setDirty()}addGraphicsOwner(e){const i=this._getGraphicsContext(e);return{addGraphic:r=>this._addGraphic(e,i,r),removeGraphic:r=>this._removeGraphic(i,r),labelingInfoChange:()=>this._labels.enabledChanged(e,i),featureReductionChange:()=>this.enabledChanged(e,i),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,i),clear:()=>i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic)),remove:()=>this._removeGraphicsOwner(e),setDirty:()=>this.setDirty()}}_removeGraphicsOwner(e){const i=this._contexts.get(e);i&&(i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,i,r){const s=r.graphic.uid,n=new n1t(r,e.symbolCreationContext.slicePlaneEnabled);i.set(s,n),H8(e)&&this.addToActiveGraphics(n),e.labelsEnabled&&this._labels.addToActiveGraphics(n);const o=!this._graphicSupportsDeconfliction(r)||!H8(e);r.setVisibilityFlag(bo.GRAPHIC,_a.DECONFLICTION,o)}_removeGraphic(e,i){const r=i.graphic.uid,s=e.get(r);s&&(this.removeFromActiveGraphics(s),this._labels.removeFromActiveGraphics(s),e.delete(r),this.setDirty())}enabledChanged(e,i){const r=H8(e);r||g1t(e),this.modifyGraphics(i,r)}_slicePlaneEnabledChanged(e,i){const r=e.symbolCreationContext.slicePlaneEnabled;i.forEach(s=>s.slicePlaneEnabled=r),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const i=e.layers;if(!i?.length)return!1;for(const r of i)if(this.layerSupportsDeconfliction(r))return!0;return!1}_getGraphicsContext(e){const i=this._contexts.get(e);if(i)return i;const r=new Map;return this._contexts.set(e,r),this.setDirty(),r}};function H8(t){const e=t.layer;return!(!e?.featureReduction||e.featureReduction.type!=="selection")}function g1t(t){const e=t.graphics3DGraphics;e&&e.forEach(i=>i.setVisibilityFlag(bo.GRAPHIC,_a.DECONFLICTION,!0))}dX=u([A("esri.views.3d.layers.graphics.GraphicsDeconflictor")],dX);const Ene="__begin__",Cne="__end__",y1t=new RegExp(Ene,"ig"),v1t=new RegExp(Cne,"ig"),ege=new RegExp("^"+Ene,"i"),tge=new RegExp(Cne+"$","i"),fB='"',_1t=fB+" + ",b1t=" + "+fB;function w1t(t){return t.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function x1t(t){return t.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function _G(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=w1t(t.labelExpression),e.type="conventional"),e}function S1t(t){const e=_G(t);switch(e.type){case"conventional":return pX(e.expression);case"arcade":return e.expression}return null}function T1t(t){const e=_G(t);switch(e.type){case"conventional":return C1t(e.expression);case"arcade":return $ne(e.expression)}return null}function pX(t){let e;return t?(e=G3(t,i=>Ene+'$feature["'+i+'"]'+Cne),e=ege.test(e)?e.replace(ege,""):fB+e,e=tge.test(e)?e.replace(tge,""):e+fB,e=e.replaceAll(y1t,_1t).replaceAll(v1t,b1t)):e='""',e}const E1t=/^\s*\{([^}]+)\}\s*$/i;function C1t(t){return t?.match(E1t)?.[1].trim()||null}const $1t=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*$/i,A1t=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,M1t=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(.+)(\1)\s*\));?\s*$/i;function $ne(t){if(!t)return null;let e=$1t.exec(t)||A1t.exec(t);return e?e[1]||e[3]:(e=M1t.exec(t),e?e[2]:null)}const q8=()=>J.getLogger("esri.layers.support.labelFormatUtils"),W8={type:"simple",evaluate:()=>null},O1t={getAttribute:(t,e)=>t.field(e)};async function I1t(t,e,i){if(!t||!t.symbol||!e)return W8;const r=t.where,s=_G(t);let n;if(s.type==="arcade"){const o=uCe(s.expression),a=e.get(o);if(a&&(wCe(a)||ZV(a)||tie(a)))n={type:"simple",evaluate(l){const c="attributes"in l?l.attributes?.[a.name]:l.field(a.name);return c==null?"":c.toString()}};else{const l=await qYe(s.expression,i,e);if(l==null)return W8;n={type:"arcade",evaluate(c,h){try{const d="attributes"in c?l.repurposeFeature(c):c;d.contextTimeZone=h??null;const f=l.evaluate({$view:{timeZone:h},$feature:d},l.services);if(f!=null)return f.toString()}catch(d){q8().error(new U("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:d,feature:c,expression:s}))}return null},needsHydrationToEvaluate:()=>$ne(s.expression)==null}}}else n={type:"simple",evaluate:o=>s.expression.replaceAll(/{[^}]*}/g,a=>{const l=a.slice(1,-1),c=e.get(l);if(!c)return a;let h=null;return h="attributes"in o?o?.attributes?.[c.name]:o.field(c.name),h==null?"":R1t(h,c)})};if(r){let o;try{o=await Kte(r,e)}catch(l){return q8().error(new U("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:r,error:l})),W8}const a=n.evaluate;n.evaluate=(l,c)=>{const h="attributes"in l?void 0:O1t;try{if(o.testFeature(l,h))return a(l,c)}catch(d){q8().error(new U("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:r,feature:l,error:d}))}return null}}return n}function R1t(t,e){if(t==null)return"";const i=e.domain;if(i){if(i.type==="codedValue"||i.type==="coded-value"){const s=t;for(const n of i.codedValues)if(n.code===s)return n.name}else if(i.type==="range"){const{max:s,min:n}=NYe(e),o=+t;if(n!=null&&s!=null&&n<=o&&o<=s)return i.name}}let r=t;return xCe(e)?r=LV(r,o9e("short-date")):ZV(e)&&(r=aD(+r)),r||""}function _ri(t,e,i,r,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!Yse(l))continue;const{update:c,averageGeometrySampledElevation:h}=rNe(l,e,i,r,s);a+=h,c&&n.geometryVertexAttributeUpdated(l,z.POSITION)}return a/o.length}function P1t(t,e,i,r,s,n){const o=t.stageObject,a=e.centerPointInElevationSR;let l=0;o.usesVerticalDistanceToGround?(r(a,Ql),FIe(o,Ql.verticalDistanceToGround),l=Ql.sampledElevation):(r(a,Ql),e.mode!=="absolute-height"&&(l=Ql.sampledElevation));const c=mn(D1t,n??o.transformation),h=se(iNe,c[12],c[13],c[14]);bs.TESTS_DISABLE_OPTIMIZATIONS?(Kl[0]=a.x,Kl[1]=a.y,Kl[2]=Ql.z,VS(a.spatialReference,Kl,c,s.spatialReference)&&(n?mn(n,c):o.transformation=c)):s.setAltitudeOfTransformation(Ql.z,c);const d=Ane/s.unitInMeters;return(Math.abs(c[12]-h[0])>=d||Math.abs(c[13]-h[1])>=d||Math.abs(c[14]-h[2])>=d)&&(n?mn(n,c):o.transformation=c),l}const D1t=Ve();function bri(t,e,i,r,s){const n=t.graphics3DSymbolLayer.lodRenderer;if(n==null)return 0;const o=e.centerPointInElevationSR;r(o,Ql);const a=e.mode!=="absolute-height"?Ql.sampledElevation:0,l=n.instanceData,c=t.instanceIndex,h=L1t;l.getGlobalTransform(c,h);const d=se(iNe,h[12],h[13],h[14]);bs.TESTS_DISABLE_OPTIMIZATIONS?(Kl[0]=o.x,Kl[1]=o.y,Kl[2]=Ql.z,VS(o.spatialReference,Kl,h,s.spatialReference)&&l.setGlobalTransform(c,h)):s.setAltitudeOfTransformation(Ql.z,h);const f=Ane/s.unitInMeters;return(bs.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(h[12]-d[0])>=f||Math.abs(h[13]-d[1])>=f||Math.abs(h[14]-d[2])>=f)&&l.setGlobalTransform(c,h),a}function wri(t,e,i,r,s){const n=t.stageObject,o=n.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,h=!1;for(const d of o){if(!Yse(d))continue;const f=d.attributes.get(z.POSITION);if(f!==l){const{update:m,averageGeometrySampledElevation:y}=rNe(d,e,i,r,s);c=y,l=f,h=m}h&&n.geometryVertexAttributeUpdated(d,z.POSITION),a+=c}return a/o.length}const Ane=.01,Kl=$(),wh=$(),BT=$(),L1t=Ve(),iNe=$(),Ql=new Ere;function rNe(t,e,i,r,s){let n=!1;const o=t.transformation,a=e.requiresSampledElevationInfo;wh[0]=o[12],wh[1]=o[13],wh[2]=o[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute(z.POSITION),c=l.data,h=l.size,d=c.length/h,f=new DIe(t.mapPositions,i);let m=0,y=0;for(let v=0;v<d;v++){if(BT[0]=c[m],BT[1]=c[m+1],BT[2]=c[m+2],r(f,Ql),a&&(y+=Ql.sampledElevation),bs.TESTS_DISABLE_OPTIMIZATIONS)c[m]=f.array[f.offset],c[m+1]=f.array[f.offset+1],c[m+2]=Ql.z,Bn(c,i,m,c,s.spatialReference,m,1),c[m]-=wh[0],c[m+1]-=wh[1],c[m+2]-=wh[2],n=!0;else{Kl[0]=c[m]+wh[0],Kl[1]=c[m+1]+wh[1],Kl[2]=c[m+2]+wh[2],s.setAltitude(Kl,Ql.z),c[m]=Kl[0]-wh[0],c[m+1]=Kl[1]-wh[1],c[m+2]=Kl[2]-wh[2];const _=Ane/s.unitInMeters;(Math.abs(BT[0]-c[m])>=_||Math.abs(BT[1]-c[m+1])>=_||Math.abs(BT[2]-c[m+2])>=_)&&(n=!0)}m+=h,f.offset+=3}return y/=d,{update:n,averageGeometrySampledElevation:y}}let N1t=class{constructor(e,i,r){this.graphic=e,this.renderingInfo=i,this.layer=r}},F1t=class{constructor(e,i=null){this.labelText=i,this.elevationOffset=e??0}};function k1t(t,e,i,r,s){if(sNe(t,e))return null;i.localOrigin=U1t(t,e);const n=new Use({geometries:[i],castShadow:!1,layerUid:t.layer.uid,graphicUid:s,usesVerticalDistanceToGround:!0});return{object:n,sampledElevation:NIe(n,e,t.elevationProvider,t.renderCoordsHelper,r)}}function Tri(t,e,i,r){return sNe(e,i)?null:NIe(t,i,e.elevationProvider,e.renderCoordsHelper,r)}function sNe(t,e){const i=t.clippingExtent;return!!i&&(pc(e,K_,t.elevationProvider.spatialReference),!lXe(i,K_))}function z1t(t,e,i){const r=t.elevationContext,s=i.spatialReference;pc(e,K_,s),r.centerPointInElevationSR=jS(K_[0],K_[1],e.hasZ?K_[2]:0,s??null)}function Eri(t){switch(t.type){case"point":return t;case"polygon":case"extent":return Ij(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const i=ASe(e,$Se(e)/2);return jS(i[0],i[1],i[2],t.spatialReference)}case"mesh":return t.extent.center}return null}function U1t(t,e){return pc(e,K_,t.renderCoordsHelper.spatialReference),t.localOriginFactory.getOrigin(K_)}const K_=$();function B1t(t){t.include(fg),t.uniforms.add(new so("geometryDepthTexture",e=>e.geometryDepth?.attachment)),t.code.add(E`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos);
return (elementDepth < (geometryDepth - 1.0));
}`)}function nNe(t){const e=new ki,{vertex:i,fragment:r}=e,{terrainDepthTest:s}=t;return i.include(vG),e.include(JLe,t),e.vertex.include(yPe,t),e.attributes.add(z.UV0,"vec2"),i.uniforms.add(new Ua("viewport",n=>n.camera.fullViewport),new pt("lineSize",(n,o)=>n.size>0?Math.max(1,n.size)*o.camera.pixelRatio:0),new fv("pixelToNDC",n=>li(ige,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new pt("borderSize",(n,o)=>n.borderColor?o.camera.pixelRatio:0),new fc("screenOffset",(n,o)=>li(ige,n.horizontalScreenOffset*o.camera.pixelRatio,0))),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),s&&e.varyings.add("depth","float"),t.occlusionTestEnabled&&e.include(KLe),t.hasScreenSizePerspective&&Kj(i),i.main.add(E`
    ProjectHUDAux projectAux;
    vec4 endPoint = projectPositionHUD(projectAux);

    vec3 vpos = projectAux.posModel;
    if (rejectBySlice(vpos)) {
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    }
    ${Se(t.occlusionTestEnabled,E`if (!testHUDVisibility(endPoint)) {
             gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
             return;
           }`)}

    ${t.hasScreenSizePerspective?E`vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
               vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);`:"vec2 screenOffsetScaled = screenOffset;"}
    // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
    // correct depth value
    vec3 posView = (view * vec4(position, 1.0)).xyz;
    ${Se(s,"depth = posView.z;")}

    applyHUDViewDependentPolygonOffset(centerOffsetAndDistance.w, projectAux.absCosAngle, posView);
    vec4 startPoint = proj * vec4(posView, 1.0);

    // Apply screen offset to both start and end point
    vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
    startPoint.xy += screenOffsetNorm * startPoint.w;
    endPoint.xy += screenOffsetNorm * endPoint.w;

    // Align start and end to pixel origin
    vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
    vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${Se(t.hudDepth,t.hudDepthAlignStart?"endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);":"startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);")}
    vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);

    // The direction of the line in screen space
    vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
    vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?E`float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
               float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);`:E`float lineSizeScaled = lineSize;
               float borderSizeScaled = borderSize;`}
    float halfPixelSize = lineSizeScaled * 0.5;

    // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
    float padding = 1.0 + borderSizeScaled;
    vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

    // Offset x/y from the center of the line in screen space
    projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

    // Compute a coverage varying which we can use in the fragment shader to determine
    // how much a pixel is actually covered by the line (i.e. to anti alias the line).
    // This works by computing two coordinates that can be linearly interpolated and then
    // subtracted to find out how far away from the line edge we are.
    float edgeDirection = (uv0.x * 2.0 - 1.0);

    float halfBorderSize = 0.5 * borderSizeScaled;
    float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
    float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

    float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

    coverageSampling = vec4(
      // Edge coordinate
      outerEdgeCoverageSampler,

      // Border edge coordinate
      outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

      // Line offset
      halfPixelSize - 0.5,

      // Border offset
      halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
    );

    lineSizes = vec2(lineSizeScaled, borderSizeScaled);
    gl_Position = projectedPosition;`),r.uniforms.add(new uc("uColor",n=>n.color??sn),new uc("borderColor",n=>n.borderColor??sn)),s&&(r.include(B1t,t),r.uniforms.add(new fv("inverseViewport",n=>n.inverseViewport))),r.main.add(E`
    ${Se(s,"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }")}

    vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

    float borderAlpha = uColor.a * borderColor.a * coverage.y;
    float colorAlpha = uColor.a * coverage.x;

    float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);
    ${Se(!t.hudDepth,E`vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
           fragColor = vec4(finalRgb, finalAlpha);`)}`),e}const ige=He(),V1t=Object.freeze(Object.defineProperty({__proto__:null,build:nNe},Symbol.toStringTag,{value:"Module"}));let j1t=class extends Bi{constructor(e,i){super(e,i,new Fi(V1t,()=>V(()=>Promise.resolve().then(()=>FGt),void 0)))}initializePipeline(e){const{hudDepth:i,terrainDepthTest:r}=e,s={func:r?Ni.ALWAYS:Ni.LESS};return _i(i?{depthTest:s,depthWrite:DD}:{blending:Yb(Ft.ONE,Ft.SRC_ALPHA,Ft.ONE_MINUS_SRC_ALPHA,Ft.ONE_MINUS_SRC_ALPHA),depthTest:s,colorWrite:Ai})}},W0=class extends zm{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hudDepth=!1,this.hudDepthAlignStart=!1,this.terrainDepthTest=!1,this.draped=!1}};u([te()],W0.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([te()],W0.prototype,"occlusionTestEnabled",void 0),u([te()],W0.prototype,"hasVerticalOffset",void 0),u([te()],W0.prototype,"hasScreenSizePerspective",void 0),u([te()],W0.prototype,"hudDepth",void 0),u([te()],W0.prototype,"hudDepthAlignStart",void 0),u([te()],W0.prototype,"terrainDepthTest",void 0);let Z8=class extends jj{constructor(e,i){super(e,oNe),this.produces=new Map([[be.LINE_CALLOUTS,r=>_s(r)],[be.LINE_CALLOUTS_HUD_DEPTH,r=>_s(r)]]),this._configuration=new W0(i),this._uniqueMaterialIdentifier=fX(this.parameters)}passParameters(){return this.parameters}getConfiguration(e,i){const r=i.slot===be.LINE_CALLOUTS_HUD_DEPTH;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hudDepth=r,this._configuration.hudDepthAlignStart=!!this.parameters.hudDepthAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.terrainDepthTest=i.terrainDepthTest,this._configuration}get visible(){return this.parameters.color[3]>=Yr||(this.parameters.borderColor?.[3]??0)>=Yr}intersect(){}createGLMaterial(e){return new G1t(e)}createBufferWriter(){return new q1t}validateParameters(e){this._uniqueMaterialIdentifier=fX(e)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}};function fX({renderOccluded:t,isDecoration:e,horizontalScreenOffset:i,color:r,size:s,occlusionTest:n,shaderPolygonOffset:o,hudDepthAlignStart:a,centerOffsetUnits:l,hasSlicePlane:c,screenSizePerspective:h,verticalOffset:d,borderColor:f}){return $Be`${t}:${e}:${i}:[${r}]:${s}:${n}:${o}:${a}:${l}:${c}:${h!=null}:{${d.screenLength}:${d.minWorldLength}:${d.maxWorldLength}}:[${f}]`}let G1t=class extends sse{beginSlot(e){return this.getTechnique(j1t,e)}},oNe=class extends adt{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=Gi(0,0,0,1),this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.hudDepthAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const H1t=Nd().vec3f(z.POSITION).vec3f(z.NORMAL).vec2f(z.UV0).vec4f(z.CENTEROFFSETANDDISTANCE),rge=[Qh(0,0),Qh(1,0),Qh(0,1),Qh(1,0),Qh(1,1),Qh(0,1)];let q1t=class{constructor(){this.vertexBufferLayout=H1t}elementCount(e){return 6*e.get(z.POSITION).indices.length}write(e,i,r,s,n,o){pse(r.get(z.POSITION),e,n.position,o,6),fse(r.get(z.NORMAL),i,n.normal,o,6),s3(r.get(z.CENTEROFFSETANDDISTANCE),n.centerOffsetAndDistance,o,6);for(let a=0;a<rge.length;++a)n.uv0.setVec(o+a,rge[a])}},aNe=class lNe extends QPe{constructor(e,i){super(e,null,i,Y1t),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new Z8(this._materialParameters,this._context.spherical),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}_perInstanceMaterialParameters(e){const i=this._materialParameters;return i.horizontalScreenOffset=e.horizontalScreenOffset??0,i.centerOffsetUnits=e.centerOffsetUnits||"world",i}get _materialParameters(){const e=new oNe,i=this.symbol,r=i.callout;if(r.color){const o=qe.toUnitRGBA(r.color);o[3]*=this._getLayerOpacity(),e.color=o}else e.color=sn;if(e.size=tS(r.size||0),i.verticalOffset){const{screenLength:o,minWorldLength:a,maxWorldLength:l}=i.verticalOffset;e.verticalOffset={screenLength:tS(o),minWorldLength:a||0,maxWorldLength:l??1/0}}e.borderColor=r.border?.color!=null?qe.toUnitRGBA(r.border.color):null;const s=i.symbolLayers.at(0).type==="object",n=i.type==="label-3d";return e.occlusionTest=!s&&!X("enable-feature:non-occluded-hud"),s&&(e.shaderPolygonOffset=0),e.hudDepthAlignStart=n,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return Z1t}createGraphics3DGraphic(e){const i=e.renderingInfo,r=e.graphic,s=this.setGraphicElevationContext(r,new RU,i.elevationOffset||0),n=i.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!PXe(l)))return null;const a=Ij(r.geometry);return a==null?null:this._createAs3DShape(a,s,i,r.uid)}layerOpacityChanged(){this._materials[0]?.setParameters(this._materialParameters)}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=Xlt(lNe.elevationModeChangeTypes,r,s);return n!==Fm.UPDATE||e.forEach(o=>{const a=i(o);a!=null&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,i,r=0){return super.setGraphicElevationContext(e,i),i.addOffsetRenderUnits(r),i}updateGraphicElevationContext(e,i){const{elevationContext:r,metadata:s}=i;this.setGraphicElevationContext(e,r,s?.elevationOffset??0),i.needsElevationUpdates=Tde(r.mode)}computeComplexity(){return new Rp({verticesPerFeature:6})}_getOrCreateMaterial(e){const i=this._perInstanceMaterialParameters(e),r=fX(i);if(r===this._materials[0]?.uniqueMaterialIdentifier)return{material:this._materials[0],isUnique:!1};if(e.materialCollection!=null){let s=e.materialCollection.get(r);return s==null&&(s=new Z8(i,this._context.spherical),e.materialCollection.add(r,s)),{material:s,isUnique:!1}}return{material:new Z8(i,this._context.spherical),isUnique:!0}}_createAs3DShape(e,i,r,s){const n=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:n}),a=this._getOrCreateMaterial(r),l=new Ea(a.material,W1t(r),null,Nn.Point,o),c=k1t(this._context,e,l,i,s);if(c==null)return null;const h=new Cre(this,c.object,[l],a.isUnique?[a.material]:null,null,P1t,i);return h.metadata=new F1t(r.elevationOffset),h.alignedSampledElevation=c.sampledElevation,h.needsElevationUpdates=Tde(i.mode),z1t(h,e,this._context.elevationProvider),h}};function W1t(t){const{translation:e,centerOffset:i}=t,r=new Wt(e?[e[0],e[1],e[2]]:[0,0,0],Y8,3,!0),s=new Wt(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],Y8,4,!0);return[[z.POSITION,r],[z.NORMAL,new Wt([0,0,1],Y8,3,!0)],[z.CENTEROFFSETANDDISTANCE,s]]}aNe.elevationModeChangeTypes={definedChanged:Fm.UPDATE,staysOnTheGround:Fm.UPDATE,onTheGroundChanged:Fm.RECREATE};const Y8=[0],Z1t={mode:"relative-to-ground",offset:0},Y1t={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let J1t=class extends wre{constructor(e,i,r=$(),s=pi(),n=0,o="world",a=0,l=null){super(e,i),this.translation=r,this.centerOffset=s,this.horizontalScreenOffset=n,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}},X1t=class extends N1t{};const sge=()=>J.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function K1t(t,e){if(!t$e(t))return sge().error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const i=Q1t[t.callout.type];return i?new i(t,e):(sge().error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const Q1t={line:aNe};function Dri(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance,1,1]:[1,1,1,1],translate:t.extent!=null?[t.extent.xmin,t.extent.ymax,t.extent.zmin??0,t.extent.mmin??0]:[0,0,0,0]}:null}function ext(t){return t.originPosition==="lowerLeft"&&t.scale.length===4&&t.translate.length===4}function JS(t){if(ext(t))return t;const{originPosition:e,scale:i,translate:r}=t,s=i[0]??1,n=i[1]??1;return{originPosition:"lowerLeft",scale:[s,e==="lowerLeft"?n:-n,i[2]??1,i[3]??1],translate:[r[0]??0,r[1]??0,r[2]??0,r[3]??0]}}function wv({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function xv({scale:t,translate:e},i){return Math.round((i-e[1])/t[1])}function v3({scale:t,translate:e},i){return Math.round(((i??0)-e[2])/t[2])}function _3({scale:t,translate:e},i){return i?Math.round((i-e[3])/t[3]):0}function cNe(t,e){return t&&e?sxt:t&&!e?ixt:!t&&e?rxt:txt}const txt=(t,e)=>{const i=[];if(!e.length)return null;const r=e[0];let s=wv(t,r[0]),n=xv(t,r[1]);i.push([s,n]);for(let o=1;o<e.length;o++){const[a,l]=e[o],c=wv(t,a),h=xv(t,l);c===s&&h===n||i.push([c-s,h-n]),s=c,n=h}return i},ixt=(t,e)=>{const i=[];if(!e.length)return null;const r=e[0];let s=wv(t,r[0]),n=xv(t,r[1]),o=v3(t,r[2]);i.push([s,n,o]);for(let a=1;a<e.length;a++){const[l,c,h]=e[a],d=wv(t,l),f=xv(t,c),m=v3(t,h);d===s&&f===n&&m===o||i.push([d-s,f-n,m]),s=d,n=f,o=m}return i},rxt=(t,e)=>{const i=[];if(!e.length)return null;const r=e[0];let s=wv(t,r[0]),n=xv(t,r[1]),o=_3(t,r[2]);i.push([s,n,o]);for(let a=1;a<e.length;a++){const[l,c,h]=e[a],d=wv(t,l),f=xv(t,c),m=_3(t,h);d===s&&f===n&&m===o||i.push([d-s,f-n,m]),s=d,n=f,o=m}return i},sxt=(t,e)=>{const i=[];if(!e.length)return null;const r=e[0];let s=wv(t,r[0]),n=xv(t,r[1]),o=v3(t,r[2]),a=_3(t,r[3]);i.push([s,n,o,a]);for(let l=1;l<e.length;l++){const[c,h,d,f]=e[l],m=wv(t,c),y=xv(t,h),v=v3(t,d),_=_3(t,f);m===s&&y===n&&v===o&&_===a||i.push([m-s,y-n,v,_]),s=m,n=y,o=v,a=_}return i};function nxt(t,e,i,r){const s=[],n=cNe(i,r);for(let o=0;o<e.length;o++){const a=n(t,e[o]);a&&a.length>=3&&s.push(a)}return s.length?s:null}function oxt(t,e,i,r){const s=[],n=cNe(i,r);for(let o=0;o<e.length;o++){const a=n(t,e[o]);a&&a.length>=2&&s.push(a)}return s.length?s:null}function ZD({scale:t,translate:e},i){return i*t[0]+e[0]}function YD({scale:t,translate:e},i){return i*t[1]+e[1]}function b3({scale:t,translate:e},i){return(i??0)*t[2]+e[2]}function w3({scale:t,translate:e},i){return i?i*t[3]+e[3]:0}function Mne(t,e){return t&&e?uxt:t&&!e?lxt:!t&&e?cxt:axt}const axt=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=ZD(t,r[0]),n=YD(t,r[1]);i[0]=[s,n];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let h=1;h<e.length;h++){const[d,f]=e[h];s+=l*d,n+=c*f,i[h]=[s,n]}return i},lxt=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=ZD(t,r[0]),n=YD(t,r[1]);i[0]=[s,n,b3(t,r[2])];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let h=1;h<e.length;h++){const[d,f,m]=e[h];s+=l*d,n+=c*f,i[h]=[s,n,b3(t,m)]}return i},cxt=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=ZD(t,r[0]),n=YD(t,r[1]);i[0]=[s,n,w3(t,r[2])];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let h=1;h<e.length;h++){const[d,f,m]=e[h];s+=l*d,n+=c*f,i[h]=[s,n,w3(t,m)]}return i},uxt=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=ZD(t,r[0]),n=YD(t,r[1]);i[0]=[s,n,b3(t,r[2]),w3(t,r[3])];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let h=1;h<e.length;h++){const[d,f,m,y]=e[h];s+=l*d,n+=c*f,i[h]=[s,n,b3(t,m),w3(t,y)]}return i};function uNe(t,e,i){const r=new Array(i.length);for(let s=0;s<i.length;s++)r[s]=e(t,i[s]);return r}function Lri(t,e,i){const r=JS(t);return e.x=wv(r,i.x),e.y=xv(r,i.y),i.z!=null&&(e.z=v3(r,i.z)),i.m!=null&&(e.m=_3(r,i.m)),e}function Nri(t,e,i){const r=nxt(JS(t),i.rings,i.hasZ,i.hasM);return r?(e.rings=r,e.hasZ=i.hasZ??!1,e.hasM=i.hasM??!1,e):null}function Fri(t,e,i){const r=oxt(JS(t),i.paths,i.hasZ,i.hasM);return r?(e.paths=r,e.hasZ=i.hasZ??!1,e.hasM=i.hasM??!1,e):null}function hxt(t,e,i,r=i?.hasZ??!1,s=i?.hasM??!1){if(i!=null){const n=JS(t);e.points=Mne(r,s)(n,i.points),e.hasZ=r,e.hasM=s}return e}function dxt(t,e,i,r=i?.z!=null,s=i?.m!=null){if(i==null)return e;const n=JS(t);return e.x=ZD(n,i.x),e.y=YD(n,i.y),r&&(e.z=b3(n,i.z)),s&&(e.m=w3(n,i.m)),e}function pxt(t,e,i,r=i?.hasZ??!1,s=i?.hasM??!1){if(i!=null){const n=JS(t);e.rings=uNe(n,Mne(r,s),i.rings),e.hasZ=r,e.hasM=s}return e}function fxt(t,e,i,r=i?.hasZ??!1,s=i?.hasM??!1){if(i!=null){const n=JS(t);e.paths=uNe(n,Mne(r,s),i.paths),e.hasZ=r,e.hasM=s}return e}function kri(){return X("curve-densification-coarse-segments")}function mxt(){return X("curve-densification-max-segments")}function zri(){return X("curve-densification-min-segments")}function Uri(){return X("curve-densification-pixels-per-segment")}let Bri=class{constructor(e,i,r){this.uid=e,this.geometry=i,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}};function jri(t){return t.geometry!=null}let Gri=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function qri(t,e){const i=YSe.fromJSON(t.geometryType),r=Ae.fromJSON(t.spatialReference),s=t.transform,n=t.objectIdFieldName,o=e?.maxStringAttributeLength,a=e?.maxStringAttributeFields;let l;const c=t.features.map(h=>{const d=gxt(h,i,r,t.objectIdFieldName),f=d.geometry;if(wxt(d.attributes,a,o,m=>{l??=[];const y=bxt(d,n);y!=null&&l.push({objectId:y,attribute:m})}),f!=null&&s)switch(f.type){case"point":d.geometry=dxt(s,f,f);break;case"multipoint":d.geometry=hxt(s,f,f);break;case"polygon":d.geometry=pxt(s,f,f);break;case"polyline":d.geometry=fxt(s,f,f);break;case"extent":case"mesh":d.geometry=f}return d});return{geometryType:i,features:c,spatialReference:r,fields:t.fields?.map(h=>sj.fromJSON(h))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null,missingAttributes:l}}function gxt(t,e,i,r){return{uid:_d(),objectId:r&&t.attributes?t.attributes[r]:null,attributes:t.attributes,geometry:yxt(t.geometry,e,i),visible:!0}}function yxt(t,e,i){if(t==null)return null;switch(e){case"point":{const r=t;return{x:r.x,y:r.y,z:r.z,m:r.m,hasZ:r.z!=null,hasM:r.m!=null,type:"point",spatialReference:i}}case"polyline":{const r=t;return{paths:r.paths,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polyline",spatialReference:i}}case"polygon":{const r=t;return{rings:r.rings,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const r=t;return{points:r.points,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"multipoint",spatialReference:i}}}}function vxt(t){if(t==null)return 0;switch(t.type){case"point":return Ry+10+8+24;case"polyline":case"polygon":{let e=0;const i=2+(t.hasZ?1:0)+(t.hasM?1:0),r=t.type==="polyline"?t.paths:t.rings;if((t.type==="polyline"?t.curvePaths:t.curveRings)?.length){const n=3*mxt()*128;e=8*n*i+128*n+32*(r.length+1)}else e=DU(r);return Ry+64+e+34}case"multipoint":{const e=DU(t.points);return Ry+e+64+34+32}case"extent":return Ry+10+64+34;case"mesh":{const e=t.vertexAttributes;return Ry+Pj(e.position,e.normal,e.uv,e.tangent)}default:return Ry}}function Wri(t){let e=32;return e+=$re(t.attributes),e+=3,e+=8+vxt(t.geometry),e}function Zri(t){if(t==null)return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const i of t.paths)e+=i.length;return e}case"polygon":{let e=0;for(const i of t.rings)e+=i.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function Yri(t){if(t==null)return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function Jri(t,e){switch(ff(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let i=0;i<t.paths.length;i++)V6(e,t.paths[i],!!t.hasZ);break;case"polygon":for(let i=0;i<t.rings.length;i++)V6(e,t.rings[i],!!t.hasZ);break;case"multipoint":V6(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function _xt(t,e){switch(sv(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let i=0;i<t.paths.length;i++)f6(e,t.paths[i]);break;case"polygon":for(let i=0;i<t.rings.length;i++)f6(e,t.rings[i]);break;case"multipoint":f6(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function bxt(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}function wxt(t,e,i,r){if(e?.size&&i!=null&&t)for(const s in t){if(!e.has(s))continue;const n=t[s];typeof n=="string"&&n.length>i&&(r(s),t[s]="")}}function One(t,e){return t?e?4:3:e?3:2}function xxt(t,e,i,r){if(!e?.lengths.length)return null;t.lengths.length&&(t.lengths.length=0),t.coords.length&&(t.coords.length=0);const s=t.coords,n=[],o=i?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:a,coords:l}=e,c=One(i,r);let h=0;for(const d of a){const f=Sxt(o,l,h,d,i,r);f&&n.push(f),h+=d*c}if(n.sort((d,f)=>{let m=d[2]-f[2];return m===0&&i&&(m=d[4]-f[4]),m}),n.length){let d=6*n[0][2];s[0]=n[0][0]/d,s[1]=n[0][1]/d,i&&(d=6*n[0][4],s[2]=d!==0?n[0][3]/d:0),(s[0]<o[0]||s[0]>o[1]||s[1]<o[2]||s[1]>o[3]||i&&(s[2]<o[4]||s[2]>o[5]))&&(s.length=0)}if(!s.length){const d=e.lengths[0]?Txt(l,0,a[0],i,r):null;if(!d)return null;s[0]=d[0],s[1]=d[1],i&&d.length>2&&(s[2]=d[2])}return t}function Sxt(t,e,i,r,s,n){const o=One(s,n);let a=i,l=i+o,c=0,h=0,d=0,f=0,m=0;for(let v=0,_=r-1;v<_;v++,a+=o,l+=o){const b=e[a],w=e[a+1],x=e[a+2],S=e[l],C=e[l+1],T=e[l+2];let M=b*C-S*w;f+=M,c+=(b+S)*M,h+=(w+C)*M,s&&(M=b*T-S*x,d+=(x+T)*M,m+=M),b<t[0]&&(t[0]=b),b>t[1]&&(t[1]=b),w<t[2]&&(t[2]=w),w>t[3]&&(t[3]=w),s&&(x<t[4]&&(t[4]=x),x>t[5]&&(t[5]=x))}if(f>0&&(f*=-1),m>0&&(m*=-1),!f)return null;const y=[c,h,.5*f];return s&&(y[3]=d,y[4]=.5*m),y}function Txt(t,e,i,r,s){const n=One(r,s);let o=e,a=e+n,l=0,c=0,h=0,d=0;for(let f=0,m=i-1;f<m;f++,o+=n,a+=n){const y=t[o],v=t[o+1],_=t[o+2],b=t[a],w=t[a+1],x=t[a+2],S=r?Cxt(y,v,_,b,w,x):Ext(y,v,b,w);if(S)if(l+=S,r){const C=Axt(y,v,_,b,w,x);c+=S*C[0],h+=S*C[1],d+=S*C[2]}else{const C=$xt(y,v,b,w);c+=S*C[0],h+=S*C[1]}}return l>0?r?[c/l,h/l,d/l]:[c/l,h/l]:i>0?r?[t[e],t[e+1],t[e+2]]:[t[e],t[e+1]]:null}function Ext(t,e,i,r){const s=i-t,n=r-e;return Math.sqrt(s*s+n*n)}function Cxt(t,e,i,r,s,n){const o=r-t,a=s-e,l=n-i;return Math.sqrt(o*o+a*a+l*l)}function $xt(t,e,i,r){return[t+.5*(i-t),e+.5*(r-e)]}function Axt(t,e,i,r,s,n){return[t+.5*(r-t),e+.5*(s-e),i+.5*(n-i)]}const Pw=2;let eu=class GE{constructor(e=[],i=[]){this.lengths=e??[],this.coords=i??[]}static fromJSON(e){return new GE(e.lengths,e.coords)}static fromRect(e){const[i,r,s,n]=e,o=s-i,a=n-r;return new GE([5],[i,r,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0&&this.coords.length>=2}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,i)=>e+i)}get usedMemory(){return 64+Pj(this.lengths,this.coords)}area(){let e=0,i=0;if(!this.lengths.length)return 0;for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];if(s<3)continue;let n=this.coords[Pw*i],o=this.coords[Pw*i+1];for(let a=1;a<s;a+=1){const l=this.coords[Pw*(a+i)],c=this.coords[Pw*(a+i)+1];e+=-.5*(l-n)*(c+o),n=l,o=c}i+=s}return e}forEachVertex(e){let i=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];for(let n=0;n<s;n++)e(this.coords[Pw*(n+i)],this.coords[Pw*(n+i)+1]);i+=s}}deltaDecode(){const e=this.clone(),{coords:i,lengths:r}=e;let s=0;for(const n of r){for(let o=1;o<n;o++)i[2*(s+o)]+=i[2*(s+o)-2],i[2*(s+o)+1]+=i[2*(s+o)-1];s+=n}return e}clone(e){if(this.lengths.length===0)return new GE([],[this.coords[0],this.coords[1]]);const i=(this.lengths.length===0?1:this.lengths.reduce((s,n)=>s+n))*Pw,r=this.coords.slice(0,i);return e?(e.set(r),new GE(this.lengths,e)):new GE(Array.from(this.lengths),Array.from(r))}},Y$=class o5{constructor(e=null,i={},r,s,n=0){this.geometry=e,this.attributes=i,this.centroid=r,this.objectId=s,this.displayId=n}static fromJSON(e){const i=e.geometry?eu.fromJSON(e.geometry):null,r=e.centroid?eu.fromJSON(e.centroid):null,s=e.objectId;return new o5(i,e.attributes,r,s)}weakClone(){const e=new o5(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e}clone(){const e=this.geometry?.clone(),i=new o5(e,{...this.attributes},this.centroid?.clone(),this.objectId);return i.displayId=this.displayId,i}ensureCentroid(e){return this.centroid??=xxt(new eu,this.geometry,e.hasZ,e.hasM),this.centroid}get usedMemory(){return 128+$re(this.attributes)+(this.geometry?.usedMemory??0)}};function Xri(t){return!!t.geometry?.coords?.length}let Mxt=class hNe{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new hNe;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}};function Ta(t,e){return t?e?4:3:e?3:2}const JD=()=>J.getLogger("esri.layers.graphics.featureConversionUtils"),Ine={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryMultiPatch:3,esriGeometryEnvelope:0},Oxt=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n},nge=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+2]},Ixt=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+3]},Rxt=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+2],t[i+3]=e[r+3]};function Rne(t,e,i,r){if(t){if(i)return e&&r?Rxt:nge;if(e&&r)return Ixt}else if(e&&r)return nge;return Oxt}function J8({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function X8({scale:t,translate:e},i){return Math.round((e[1]-i)/t[1])}function K8({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function Q8({scale:t,translate:e},i){return Math.round((i-e[1])/t[1])}function eq({scale:t,translate:e},i,r){return i*t[r]+e[r]}function Kri(t,e,i){return t?e?i?Lne(t):Pne(t):i?Dne(t):bG(t):null}function bG(t){const e=t.coords;return{x:e[0],y:e[1]}}function dNe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function Pne(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function Pxt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function Dne(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function Dxt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function Lne(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function Lxt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function Nxt(t,e,i,r){let s=bG;i&&r?s=Lne:i?s=Pne:r&&(s=Dne);for(const n of e){const{geometry:o,attributes:a}=n,l=o!=null?s(o):null;t.push({attributes:a,geometry:l})}return t}function Nne(t,e){return t&&e?Lxt:t?Pxt:e?Dxt:dNe}function Fxt(t,e,i,r,s){const n=Nne(i,r);for(const{geometry:o,attributes:a}of e){const l=o!=null?n(new eu,o):null;t.push(new Y$(l,a,null,s?a[s]:void 0))}return t}function kxt(t,e,i=Nne(e.z!=null,e.m!=null)){return i(t,e)}function zxt(t,e,i,r){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?pNe(s,i,r):null});return t}function pNe(t,e,i){if(t==null)return null;const r=Ta(e,i),s=[];for(let n=0;n<t.coords.length;n+=r){const o=[];for(let a=0;a<r;a++)o.push(t.coords[n+a]);s.push(o)}return e?i?{points:s,hasZ:e,hasM:i}:{points:s,hasZ:e}:i?{points:s,hasM:i}:{points:s}}function Uxt(t,e,i,r,s){const n=Ta(i,r);for(const{geometry:o,attributes:a}of e){const l=o!=null?fNe(new eu,o,n):null;t.push(new Y$(l,a,null,s?a[s]:void 0))}return t}function fNe(t,e,i=Ta(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const r=t.coords;let s=0;for(const n of e.points)for(let o=0;o<i;o++)r[s++]=n[o];return t}function Bxt(t,e,i,r){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?mNe(s,i,r):null});return t}function mNe(t,e,i){if(!t)return null;const r=Ta(e,i),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const d=[];for(let f=0;f<r;f++)d.push(s[a++]);c.push(d)}o.push(c)}return e?i?{paths:o,hasZ:e,hasM:i}:{paths:o,hasZ:e}:i?{paths:o,hasM:i}:{paths:o}}function Vxt(t,e,i,r,s){const n=Ta(i,r);for(const{geometry:o,attributes:a,centroid:l}of e){const c=o!=null?gNe(new eu,o,n):null,h=l!=null?kxt(new eu,l):null;t.push(new Y$(c,a,h,s?a[s]:void 0))}return t}function gNe(t,e,i=Ta(e.hasZ,e.hasM)){const{lengths:r,coords:s}=t;let n=0;for(const o of e.paths){for(const a of o)for(let l=0;l<i;l++)s[n++]=a[l];r.push(o.length)}return t}function jxt(t,e,i,r){for(const{geometry:s,attributes:n,centroid:o}of e){const a=s!=null?yNe(s,i,r):null;if(o!=null){const l=bG(o);t.push({attributes:n,centroid:l,geometry:a})}else t.push({attributes:n,geometry:a})}return t}function yNe(t,e,i){if(!t)return null;const r=Ta(e,i),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const d=[];for(let f=0;f<r;f++)d.push(s[a++]);c.push(d)}o.push(c)}return e?i?{rings:o,hasZ:e,hasM:i}:{rings:o,hasZ:e}:i?{rings:o,hasM:i}:{rings:o}}function Gxt(t,e,i,r,s){for(const{geometry:n,centroid:o,attributes:a}of e){const l=n!=null?vNe(new eu,n,i,r):null,c=s?a[s]:void 0;o!=null?t.push(new Y$(l,a,dNe(new eu,o),c)):t.push(new Y$(l,a,null,c))}return t}function vNe(t,e,i=e.hasZ,r=e.hasM){return Hxt(t,e.rings,i,r)}function Hxt(t,e,i,r){const s=Ta(i,r),{lengths:n,coords:o}=t;let a=0;Qy(t);for(const l of e){for(const c of l)for(let h=0;h<s;h++)o[a++]=c[h];n.push(l.length)}return t}const jC=[],HR=[];function Qri(t,e,i,r,s){jC[0]=t;const[n]=_Ne(HR,jC,e,i,r,s);return yf(jC),yf(HR),n}function _Ne(t,e,i,r,s,n){if(yf(t),!i){for(const o of e){const a=n?o.attributes[n]:void 0;t.push(new Y$(null,o.attributes,null,a))}return t}switch(i){case"esriGeometryPoint":return Fxt(t,e,r,s,n);case"esriGeometryMultipoint":return Uxt(t,e,r,s,n);case"esriGeometryPolyline":return Vxt(t,e,r,s,n);case"esriGeometryPolygon":case"esriGeometryMultiPatch":return Gxt(t,e,r,s,n);default:JD().error("convertToFeatureSet:unknown-geometry",new U(`Unable to parse unknown geometry type '${i}'`)),yf(t)}return t}function esi(t,e,i,r){HR[0]=t,bNe(jC,HR,e,i,r);const s=jC[0];return yf(jC),yf(HR),s}function qxt(t,e,i){if(t==null)return null;const r=new eu;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&i==null&&(i=t.hasM),pte(t)?Nne(e??t.z!=null,i??t.m!=null)(r,t):nb(t)?vNe(r,t,e,i):AV(t)?gNe(r,t,Ta(e,i)):dte(t)?fNe(r,t,Ta(e,i)):void JD().error("convertFromGeometry:unknown-geometry",new U(`Unable to parse unknown geometry type '${t}'`))}function Wxt(t,e,i,r){const s=t&&("coords"in t?t:t.geometry);if(s==null)return null;switch(e){case"esriGeometryPoint":{let n=bG;return i&&r?n=Lne:i?n=Pne:r&&(n=Dne),n(s)}case"esriGeometryMultipoint":return pNe(s,i,r);case"esriGeometryPolyline":return mNe(s,i,r);case"esriGeometryPolygon":return yNe(s,i,r);default:return JD().error("convertToGeometry:unknown-geometry",new U(`Unable to parse unknown geometry type '${e}'`)),null}}function Zxt(t,e){for(const i of e)t.push({attributes:i.attributes});return t}function bNe(t,e,i,r,s){if(yf(t),i==null)return Zxt(t,e);switch(i){case"esriGeometryPoint":return Nxt(t,e,r,s);case"esriGeometryMultipoint":return zxt(t,e,r,s);case"esriGeometryPolyline":return Bxt(t,e,r,s);case"esriGeometryPolygon":return jxt(t,e,r,s);default:JD().error("convertToFeatureSet:unknown-geometry",new U(`Unable to parse unknown geometry type '${i}'`))}return t}function tsi(t){const{objectIdFieldName:e,spatialReference:i,transform:r,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:h,queryGeometry:d,queryGeometryType:f}=t,m={features:bNe([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:e,spatialReference:i,uniqueIdField:h,queryGeometry:Wxt(d,f,!1,!1)};return r&&(m.transform=r),c&&(m.exceededTransferLimit=c),n&&(m.hasM=n),o&&(m.hasZ=o),m}function isi(t,e){const i=new Mxt,{hasM:r,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:h,fields:d}=t;return d&&(i.fields=d),i.geometryType=l??null,i.objectIdFieldName=o??e??null,i.spatialReference=a??null,i.objectIdFieldName?(n&&_Ne(i.features,n,l,s,r,i.objectIdFieldName),c&&(i.exceededTransferLimit=c),r&&(i.hasM=r),s&&(i.hasZ=s),h&&(i.transform=h),i):(JD().error(new U("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function rsi(t){const{transform:e,features:i,hasM:r,hasZ:s}=t;if(!e)return t;for(const n of i)n.geometry!=null&&age(n.geometry,n.geometry,r,s,e),n.centroid!=null&&age(n.centroid,n.centroid,r,s,e);return t.transform=null,t}function ssi(t,e){const{geometryType:i,features:r,hasM:s,hasZ:n}=e;if(!t)return e;for(let o=0;o<r.length;o++){const a=r[o],l=a.weakClone();l.geometry=new eu,oge(l.geometry,a.geometry,s,n,i,t),a.centroid&&(l.centroid=new eu,oge(l.centroid,a.centroid,s,n,"esriGeometryPoint",t)),r[o]=l}return e.transform=t,e}function oge(t,e,i,r,s,n,o=i,a=r){if(Qy(t),!e?.coords.length)return null;const l=Ine[s],{coords:c,lengths:h}=e,d=Ta(i,r),f=Ta(i&&o,r&&a),m=Rne(i,r,o,a);if(!h.length)return m(t.coords,c,0,0,J8(n,c[0]),X8(n,c[1])),Qy(t,d,0),t;let y,v,_,b,w=0,x=0,S=x;for(const C of h){if(C<l)continue;let T=0;x=S,_=y=J8(n,c[w]),b=v=X8(n,c[w+1]),m(t.coords,c,x,w,_,b),T++,w+=d,x+=f;for(let M=1;M<C;M++,w+=d)_=J8(n,c[w]),b=X8(n,c[w+1]),_===y&&b===v||(m(t.coords,c,x,w,_-y,b-v),x+=f,T++,y=_,v=b);T>=l&&(t.lengths.push(T),S=x)}return yf(t.coords,S),t.coords.length?t:null}function nsi(t,e,i,r,s,n,o=i,a=r){if(Qy(t),!e?.coords.length)return null;const l=Ine[s],{coords:c,lengths:h}=e,d=Ta(i,r),f=Ta(i&&o,r&&a),m=Rne(i,r,o,a);if(!h.length)return m(t.coords,c,0,0,c[0],c[1]),Qy(t,d,0),t;let y=0;const v=n*n;for(const _ of h){if(_<l){y+=_*d;continue}const b=t.coords.length/f,w=y,x=y+(_-1)*d;m(t.coords,c,t.coords.length,w,c[w],c[w+1]),mX(t.coords,c,d,v,m,w,x),m(t.coords,c,t.coords.length,x,c[x],c[x+1]);const S=t.coords.length/f-b;S>=l?t.lengths.push(S):yf(t.coords,b*f),y+=_*d}return t.coords.length?t:null}function Yxt(t,e,i,r){const s=t[e],n=t[e+1],o=t[i],a=t[i+1],l=t[r],c=t[r+1];let h=o,d=a,f=l-h,m=c-d;if(f!==0||m!==0){const y=((s-h)*f+(n-d)*m)/(f*f+m*m);y>1?(h=l,d=c):y>0&&(h+=f*y,d+=m*y)}return f=s-h,m=n-d,f*f+m*m}function mX(t,e,i,r,s,n,o){let a,l=r,c=0;for(let h=n+i;h<o;h+=i)a=Yxt(e,h,n,o),a>l&&(c=h,l=a);l>r&&(c-n>i&&mX(t,e,i,r,s,n,c),s(t,e,t.length,c,e[c],e[c+1]),o-c>i&&mX(t,e,i,r,s,c,o))}function osi(t,e,i,r){if(!e?.coords?.length)return null;const s=Ta(i,r);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const c=e.coords;for(let h=0;h<c.length;h+=s){const d=c[h],f=c[h+1];n=Math.min(n,d),a=Math.max(a,d),o=Math.min(o,f),l=Math.max(l,f)}}return nZ(t)?dXe(t,n,o,a,l):lte(n,o,a,l,t),t}function age(t,e,i,r,s){const{coords:n,lengths:o}=e,a=Ta(i,r);if(!n.length)return t!==e&&Qy(t),t;mV(s);const{originPosition:l,scale:c,translate:h}=s,d=Kxt;d.originPosition=l;const f=d.scale;f[0]=c[0]??1,f[1]=-(c[1]??1),f[2]=c[2]??1,f[3]=c[3]??1;const m=d.translate;if(m[0]=h[0]??0,m[1]=h[1]??0,m[2]=h[2]??0,m[3]=h[3]??0,!o.length){for(let v=0;v<a;++v)t.coords[v]=eq(d,n[v],v);return t!==e&&Qy(t,a,0),t}let y=0;for(let v=0;v<o.length;v++){const _=o[v];t.lengths[v]=_;for(let x=0;x<a;++x)t.coords[y+x]=eq(d,n[y+x],x);let b=t.coords[y],w=t.coords[y+1];y+=a;for(let x=1;x<_;x++,y+=a){b+=n[y]*f[0],w+=n[y+1]*f[1],t.coords[y]=b,t.coords[y+1]=w;for(let S=2;S<a;++S)t.coords[y+S]=eq(d,n[y+S],S)}}return t!==e&&Qy(t,n.length,o.length),t}function asi(t,e,i,r,s,n){if(Qy(t),t.lengths.push(...e.lengths),i===s&&r===n)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=Ta(i,r),a=Rne(i,r,s,n),l=e.coords;for(let c=0;c<l.length;c+=o)a(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function Jxt(t,e,i,r){let s=0,n=t[r*e],o=t[r*(e+1)];for(let a=1;a<i;a++){const l=n+t[r*(e+a)],c=o+t[r*(e+a)+1],h=(l-n)*(c+o);n=l,o=c,s+=h}return .5*s}function lsi(t,e){const{coords:i,lengths:r}=t;let s=0,n=0;for(let o=0;o<r.length;o++){const a=r[o];n+=Jxt(i,s,a,e),s+=a}return Math.abs(n)}function Xxt(t,e,i,r){return t*r-i*e===0&&t*i+e*r>0}function csi(t,e,i,r,s){const n=Ta(r,s);if(!t.lengths.length){if(t.coords.length<2)return null;const[d,f]=t.coords,m=K8(e,d),y=Q8(e,f);return new eu([],[m,y])}const o=new eu([],[0,0]),a=Ine[i],l=i==="esriGeometryPolygon"||i==="esriGeometryPolyline";let c=0,h=0;for(let d=0;d<t.lengths.length;d++){const f=t.lengths[d],m=h;let y=K8(e,t.coords[n*c]),v=Q8(e,t.coords[n*c+1]);o.coords[h++]=y,o.coords[h++]=v;let _=0,b=0,w=1;for(let x=1;x<f;x++){const S=K8(e,t.coords[n*(x+c)]),C=Q8(e,t.coords[n*(x+c)+1]);if(S!==y||C!==v){const T=S-y,M=C-v;l&&Xxt(_,b,T,M)?(o.coords[h-2]+=T,o.coords[h-1]+=M,y+=T,v+=M):(o.coords[h++]=S,o.coords[h++]=C,y=S,v=C,_=T,b=M,w+=1)}}w<a?h=m:o.lengths.push(w),c+=f}return o.lengths.length===0?null:o}function Qy(t,e=0,i=0){yf(t.lengths,i),yf(t.coords,e)}function yf(t,e=0){t.length!==e&&(t.length=e)}const Kxt={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},lge=new Cl(Array,t=>KV(t,jCe),null,10,5),Qxt=Qt();let eSt=class{get labelLayers(){return this._labelLayers||wBe}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e?.isElevationSource)}constructor(e,i,r,s,n){this.graphic=e,this.graphics3DSymbol=i,this.layers=r,this._visibleFlags=_a.ALL_LABEL,this.deconflictionPriority=0,++i.referenced,this._featureExpressionFeature=n?wIe(n,e,s):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(i=>{i.initialize(e),i.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,i){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(i),e.setVisibility(this.isVisible(bo.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(i=>{i.type==="draped"&&(e=!0)}),e}isVisible(e=bo.GRAPHIC,i){const r=i?this._visibleFlags|i|bo.LABEL*i:this._visibleFlags;return e===bo.GRAPHIC?(r&_a.ALL_GRAPHIC)===_a.ALL_GRAPHIC:(r&_a.ALL_LABEL)===_a.ALL_LABEL}setVisibilityFlag(e,i,r){const s=this.isVisible(e);r?this._visibleFlags|=e*i:this._visibleFlags&=~(e*i);const n=this.isVisible(e);if(s===n)return!1;if(e===bo.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible(bo.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}getVisibilityFlag(e,i){return!!(this._visibleFlags&e*i)}computeExtent(e){if(!this._extent){const i=this.graphic.geometry;if(i==null)return!1;this._extent=Qt(),_xt(i,this._extent);const r=i.spatialReference;if(!rs(r,e)&&!Xie(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,i){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,i)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,i,r){let s=e.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=Sa.fromExtent(s.type==="mesh"?s.extent:s)),qxt(s,i,r)}get usedMemory(){let e=$re(this.graphic.attributes);return this._forEachSymbolLayerGraphic(i=>e+=i.graphics3DSymbolLayer.usedMemory),e}computeAttachmentOrigin(){const e={render:{origin:$(),num:0},draped:{origin:He(),num:0}};for(const i of this.layers)i?.computeAttachmentOrigin(e);return e.render.num>1&&ie(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&ud(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,i,r,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?ff(n.boundingBox):n.boundingBox=ff(),n.requiresDrapedElevation=!1,await mte(this.layers,async o=>{if(o==null)return;const a=o.type==="draped"?i:e,l=lge.acquire(),c=await o.getProjectedBoundingBox(a,r,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&kCe(n.boundingBox,l),lge.release(l)}),oXe(n.boundingBox)||F7(BCe(n.boundingBox,Qxt))?n:null}needsElevationUpdates(){for(const e of this.layers)if(e!=null&&(e.type==="object3d"||e.type==="lod-instance")&&e.needsElevationUpdates)return!0;return this._labelLayers?.some(e=>e?.needsElevationUpdates??!1)??!1}alignWithElevation(e,i,r){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(e,i,this._featureExpressionFeature,r)})}alignWithAbsoluteElevation(e,i,r){this._forEachRenderedGraphic(s=>{s.type==="object3d"&&s.alignWithAbsoluteElevation(e,i,r)})}addObjectStateSet(e){this._forEachSymbolLayerGraphic(i=>i.addObjectState(e))}removeObjectState(e){this._forEachSymbolLayerGraphic(i=>i.removeObjectState(e))}updateHighlights(e){this._forEachSymbolLayerGraphic(i=>i.updateHighlights(e))}_forEachGraphicList(e,i){e?.forEach(r=>r&&i(r))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this.labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){}},hsi=class{constructor(e,i){this.scheduler=e,this.schedule=i,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}get spherical(){return this.stage.view.state.viewingMode===Be.Global}get doublePrecisionRequiresObfuscation(){return this.stage.renderView.renderingContext.driverTest.doublePrecisionRequiresObfuscation.result}},tSt=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};const iSt=2216,rSt=4096;function wNe(t){return iSt+rSt*t.symbolLayers.length+t.complexity.memory.resourceBytes}let sSt=class extends Pse{set symbol(e){this._symbol=e,e.symbolLayers.forEach((i,r)=>{const s=this.symbolLayers[r];s!=null&&(s.symbol=e,s.symbolLayer=i)})}get symbol(){return this._symbol}constructor(e,i,r){super(i.schedule),this._symbol=e,this._context=i,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let i=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(i=this._backgroundLayers.concat(i));const r=i.length;for(;this.symbolLayers.length<i.length;)this.symbolLayers.push(null);this.symbolLayers.length=i.length;const s=[],{make:n}=await V(async()=>{const{make:o}=await import("./Graphics3DSymbolLayerFactory-C5gPt9PW.js");return{make:o}},__vite__mapDeps([354,53,54,55,56,51,105,104,318,355,341,321,356,357,35,36,358,253,359,108,360,241,107,100,326,242]));for(let o=0;o<r;o++){const a=i.at(o);if(a.enabled===!1)continue;dF.renderPriority=1-(1+o)/r,dF.renderPriorityStep=1/r,dF.ignoreDrivers=a.ignoreDrivers;const l=n(this.symbol,a,this._context,dF),c=J3(e,()=>{this.symbolLayers[o]=null,l.destroy()});c&&s.push(c),this.symbolLayers[o]=l}if(await mte(this.symbolLayers,async(o,a)=>{if(o!=null)try{await o.load(),this._extentPadding+=Math.max(this._extentPadding,o.extentPadding)}catch{this.symbolLayers[a]=null}}),s.forEach(o=>o.remove()),gt(e),this.symbolLayers.length&&!this.symbolLayers.some(o=>!!o))throw new Error}getSymbolLayerSize(e){const i=this.symbolLayers[e];return i!=null?i.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e?.queryForSnapping)}updateFocus(e,i){this.symbolLayers.forEach(r=>r?.updateFocus(e,i))}createGraphics3DGraphic(e,i){const r=e.graphic,s=this.symbolLayers.map(o=>o?.createGraphics3DGraphic(e)??null),n=this._context.arcade||this._context.featureExpressionInfoContext?.arcade?.modules||null;return new eSt(r,i||this,s,e.layer,n)}get complexity(){return Rse(this.symbolLayers.map(e=>e!=null?e.complexity:null))}globalPropertyChanged(e,i){const r=this.symbolLayers.length;for(let s=0;s<r;s++){const n=this.symbolLayers[s],o=a=>{const l=a.layers[s];return l instanceof Cre?l:null};if(n!=null&&!n.globalPropertyChanged(e,i,o))return!1}return!0}applyRendererDiff(e,i){return this.loadStatus!==Wh.LOADED?Yy.RecreateSymbol:this.symbolLayers.reduce((r,s)=>r!==Yy.RecreateSymbol&&s!=null?Math.min(r,s.applyRendererDiff(e,i)):r,Yy.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===Wh.FAILED||e.diff.type!=="partial")return;const i=e.diff.diff;if(!i.symbolLayers||i.symbolLayers.type!=="partial")return;const r=i.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(s==null)return;const o=r[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),e.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const h=l.layers[n];h!=null&&a.graphics3DGraphicPatches.forEach(d=>d(h,c))})}})}updateGeometry(e,i){return this._updateGeometryOrTransform(e,(r,s)=>r.updateGeometry(s,i))}updateTransform(e,i,r,s){return this._updateGeometryOrTransform(e,(n,o)=>n.updateTransform(o,i,r,s))}_updateGeometryOrTransform(e,i){for(let r=0;r<this.symbolLayers.length;r++){const s=this.symbolLayers[r];if(s==null)continue;const n=e.layers[r];if(!n||!i(s,n))return!1}return!0}onRemoveGraphic(e){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(r==null)continue;const s=e.layers[i];s!=null&&r.onRemoveGraphic(s)}}getFastUpdateStatus(){let e=!1,i=!1;for(const r of this.symbolLayers)if(r!=null){if(r.loadStatus===Wh.LOADING)return O_.Loading;r.isFastUpdatesEnabled()?i=!0:e=!0}return i?e?O_.Mixed:O_.Fast:e?O_.Slow:O_.Undefined}async queryForSnapping(e,i,r,s){const n=this.symbolLayers.filter(of).filter(a=>a.queryForSnapping!=null).map(a=>a.queryForSnapping(e,i,r,s)),o=await Promise.all(n);return gt(s),o.flat()}destroy(){if(!this.destroyed){super.destroy();for(const e of this.symbolLayers)e?.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}get cachedMemory(){return wNe(this)}};const dF=new tSt,nSt=["web-gltf","web","cim"];let oSt=class extends Pse{constructor(e,i,r){super(i),this.symbol=e,this._convert=r,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const i=await this.symbol.fetchSymbol({signal:e,acceptedFormats:nSt});i.id=this.symbol.id,this.graphics3DSymbol=this._convert(i),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:XPe}globalPropertyChanged(e,i){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,i)}applyRendererDiff(e,i){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,i):Yy.RecreateSymbol}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,i){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e,i)}updateTransform(e,i,r,s){return this.graphics3DSymbol?.updateTransform(e,i,r,s)??!1}onRemoveGraphic(){}updateFocus(e,i){}getFastUpdateStatus(){return this.graphics3DSymbol?.getFastUpdateStatus()??O_.Loading}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}get cachedMemory(){return wNe(this)}};function gX(t){return t instanceof oSt?t.graphics3DSymbol:t instanceof sSt?t:null}const gsi=1.2,ysi=sn,aSt=4;let lSt=class{constructor(e,i="center",r=!1,s=He(),n=Gi(0,0,0,-1),o="world",a=$(),l=0){this.verticalOffset=e,this.anchor=i,this.hasLabelVerticalOffset=r,this.screenOffset=s,this.centerOffset=n,this.centerOffsetUnits=o,this.translation=a,this.elevationOffset=l}},cSt=class{constructor(e,i="center",r="center",s=null,n=He(),o=!0){this.placement=e,this.horizontalPlacement=i,this.verticalPlacement=r,this.text=s,this.displaySize=n,this.isFocused=o}};function yX(t,e,i){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=i,t.canvas}function uSt(t){const{size:e}=t.definition,i=t.fontString(e);let r=cge.get(i);if(!r){const s=yX(dSt,0,0).getContext("2d");t.setFontProperties(s,e);const n=s.measureText(pSt);r=new hSt(n.actualBoundingBoxAscent,n.actualBoundingBoxDescent),cge.set(i,r)}return r}const cge=new Map;let hSt=class{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(e,i){this.maxAscent=e,this.maxDescent=i}};const dSt={canvas:null},pSt=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})(),Fne=1;let fSt=class{constructor(e,i,r,s){this.text=e,this._alignment=i,this._parameters=r,this._maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`${e}--${this._parameters.key}-${this._alignment}`,this._lines=e.replaceAll(" "," ").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let e=this._metrics.firstLineAscent;for(let i=0;i<this._lines.length-1;i++)e+=this._lineSpacing;return e+=this._metrics.lastLineDescent,Math.ceil(e+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(this._metricsCached==null){const e=yX(uge,pF,pF).getContext("2d"),i=this._parameters.definition.pixelRatio,r=this._fontSize*i;this._parameters.setFontProperties(e,r);let s=2*this._haloSize;const n=this._parameters.definition.font;n.style!=="italic"&&n.style!=="oblique"&&n.weight!=="bold"&&n.weight!=="bolder"||(s+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let o=0,a=0,l=0,c=0,h=0;this._lines.forEach((b,w)=>{const x=e.measureText(b),S=x.width/i,C=S+s;this._textWidths.push(S),this._lineWidths.push(C),o=Math.max(o,C),c=Math.max(c,x.actualBoundingBoxAscent/i),h=Math.max(h,x.actualBoundingBoxDescent/i),w===0&&(a=x.actualBoundingBoxAscent/i),w===this._lines.length-1&&(l=x.actualBoundingBoxDescent/i)});const d=uSt(this._parameters),f=Math.max(c,d.maxAscent),m=Math.max(h,d.maxDescent),y=a,v=this._parameters.definition.font.decoration==="underline"?m:l,_=o;this._metricsCached=new gSt(y,v,f,m,_)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return this._midLineHeight*mSt}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,Fne)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(this._renderPixelRatio==null){const e=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(e,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case hb.Left:return this._horizontalPadding;case hb.Center:return(this.displayWidth-this._lineWidths[e])/2;case hb.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[e]}}render(e,i,r){e.save();const s=i/=this.renderPixelRatio,n=r/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset+this._metrics.firstLineAscent;i+=o,r+=a;const l=this._haloSize>0;l&&this._renderHalo(e,s,n,o,a),this._parameters.setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const h=this._lines[c],d=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,h,i+d,r),this._renderLineDecoration(e,i+d,r,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,h,i+this._getLineXOffset(c),r),this._renderLineDecoration(e,i+d,r,this._textWidths[c]),r+=this._lineSpacing}if(bs.TEXT_SHOW_BASELINE){e.strokeStyle=hge,e.setLineDash([2,2]),e.lineWidth=1;let c=n+a;for(let h=0;h<this._lines.length;++h)this._drawLine(e,[s,c],[s+this.displayWidth,c]),c+=this._lineSpacing}if(bs.TEXT_SHOW_BORDER&&(e.strokeStyle=hge,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[s,n],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,s,n,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,i,r,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":r+=2*a;break;case"line-through":r-=.33*this._midLineAscent}const l=n?this._haloSize:0;e.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(a+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(i-l),this._toRenderUnit(r)),e.lineTo(this._toRenderUnit(i+s+l),this._toRenderUnit(r)),e.stroke()}_roundedRect(e,i,r,s){i=this._toRenderUnit(i),r=this._toRenderUnit(r);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=ce(s,0,Math.floor(o/2)),e.beginPath(),e.moveTo(i,r+s),e.arcTo(i,r,i+s,r,s),e.lineTo(i+n-s,r),e.arcTo(i+n,r,i+n,r+s,s),e.lineTo(i+n,r+o-s),e.arcTo(i+n,r+o,i+n-s,r+o,s),e.lineTo(i+s,r+o),e.arcTo(i,r+o,i,r+o-s,s),e.closePath()):e.rect(i,r,n,o)}_renderHalo(e,i,r,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=yX(uge,Math.max(o,pF),Math.max(a,pF)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._parameters.setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const h=this._renderedHaloSize<3;c.lineJoin=h?"miter":"round",h?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let d=n;for(let f=0;f<this._lines.length;++f){const m=this._getLineXOffset(f);this._renderLineDecoration(c,s+m,d,this._textWidths[f],!0),d+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,o,a,this._toRenderUnit(i),this._toRenderUnit(r),o,a),e.globalAlpha=1}_renderHaloEmulated(e,i,r){for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of xNe)this._fillText(e,n,i+o+this._haloSize*a,r+this._haloSize*l);r+=this._lineSpacing}}_renderHaloNative(e,i,r){const s=2*this._haloSize;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let h=0;h<l;h++){const d=1-(l-1)*c+h*c;e.lineWidth=this._toRenderUnit(d*s),this._strokeText(e,o,i+a,r)}r+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,i,r,s){e.fillText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_strokeText(e,i,r,s){e.strokeText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_drawLine(e,i,r){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.stroke()}_drawBox(e,i,r){const s=this._toRenderUnit(i[0]),n=this._toRenderUnit(i[1]),o=this._toRenderUnit(r[0]),a=this._toRenderUnit(r[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,h=Math.floor(n)+.5,d=Math.ceil(n+a)-.5;e.beginPath(),e.moveTo(l,h),e.lineTo(c,h),e.lineTo(c,d),e.lineTo(l,d),e.lineTo(l,h),e.stroke()}};const xNe=[];for(let e=0;e<360;e+=360/16)xNe.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var hb;(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(hb||(hb={}));const uge={canvas:null},mSt=.2,pF=512,hge="rgb(255, 0, 255, 0.5)";let gSt=class{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(e,i,r,s,n){this.firstLineAscent=e,this.lastLineDescent=i,this.maxLineAscent=r,this.maxLineDescent=s,this.displayWidth=n}};const GM=()=>J.getLogger("esri.views.3d.layers.graphics.labelPlacement");let dge=class{constructor(e,i,r,s=null){this._graphic=e,this._symbol=i,this._class=r,this._disablePlacement=s}get placement(){const e=this._verticalOffsetPlacement;if(e==null)return null;const i=this._getPlacementInfo(e);if(i==null)return null;const r=i.anchor,s=!!e.hasLabelVerticalOffset,n=e.verticalOffset,o=new lSt(n,r,s);return this._calculatePlacementOffsets(o,i)}get _verticalOffsetPlacement(){const e=this._class.labelPlacement,{_symbol:i,_graphic:r}=this,s=gX(r.graphics3DSymbol),n=s?.symbol.type==="point-3d"?s.symbol:null,o=Hp[e]||this._defaultPlacementInfo;return n?.supportsCallout()&&n.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:n.verticalOffset.clone(),anchor:null,normalizedOffset:null}:!i?.hasVisibleVerticalOffset()||n!=null&&n.supportsCallout()&&n.verticalOffset&&!r.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:o&&ySt(o.placement)?{placement:"above-center",verticalOffset:i.verticalOffset.clone(),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(GM().errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null)}_getPlacementInfo(e){if(e.anchor)return e;const i=this._class.labelPlacement,r=Hp[i],s=r||this._defaultPlacementInfo;return i&&!r&&GM().warnOncePerTick(`the requested label placement '${i}' is currently unsupported in SceneView.`),this._validatePlacementInfo(s)}_calculatePlacementOffsets(e,i){const r=this._graphic.graphic.geometry;if(r==null)return null;switch(r.type){case"point":this._setPointSpecificPlacement(e,i);break;case"mesh":this._setMeshSpecificPlacement(e,i);break;case"polygon":this._setPolygonSpecificPlacement(e,i)}const s=aSt-Fne;return e.screenOffset[0]+=s*i.normalizedOffset[0],e.screenOffset[1]+=s*i.normalizedOffset[1],e}get _defaultPlacementInfo(){const e=this._graphic.graphic.geometry;if(e==null)return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:on,anchor:"center"};case"polygon":return this._firstSymbolLayer?.type==="extrude"?Hp["above-center"]:{placement:"center-center",normalizedOffset:on,anchor:"center"};case"point":case"mesh":return Hp["above-center"];default:return}}_validatePlacementInfo(e){const i=this._graphic.graphic.geometry;if(i==null)return null;if(this._disablePlacement!=null)return this._class.labelPlacement?(GM().warnOncePerTick(pge(e?.placement,this._disablePlacement.logEntityDescription)),this._defaultPlacementInfo):e;const r=i.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":if(this._class.labelPlacement)return GM().warnOncePerTick(pge(e?.placement,`'${r}' geometries`)),this._defaultPlacementInfo;break;case"point":case"mesh":return e}return e}_setPointSpecificPlacement(e,i){const r=this._firstSymbolLayer;if(r==null)return;const s=this._graphic.layers[0];switch(s!=null?s.getCenterObjectSpace(e.translation):se(e.translation,0,0,0),r.type){case"icon":case"text":this._setHUDSpecificPlacement(e,i,s);break;case"object":tq(e,i,s)}}_setMeshSpecificPlacement(e,i){const r=this._firstSymbolLayer;r!=null&&r.type==="fill"&&tq(e,i,this._graphic.layers[0])}_setPolygonSpecificPlacement(e,i){const r=this._firstSymbolLayer;if(r!=null)switch(r.type){case"extrude":{const s=this._graphic.layers[0];s!=null?(s.getBoundingBoxObjectSpace(qR),uie(qR,e.translation),e.translation[2]=Gb(qR)/2):se(e.translation,0,0,0),tq(e,i,s);break}}}_setHUDSpecificPlacement(e,i,r){const{_graphic:s}=this,n=r!=null?r.getScreenSize():null;if(s.isDraped||n==null)e.hasLabelVerticalOffset||e.anchor==="center"||(Hp[this._class.labelPlacement]&&GM().warnOncePerTick(`the requested placement '${i.placement}' is currently unsupported for draped graphics`),e.anchor="center");else{const o=this._normalizedSymbolAnchorPos;e.screenOffset[0]=n[0]/2*(i.normalizedOffset[0]-o[0]);const a=n[1]/2*(i.normalizedOffset[1]-o[1]);e.hasLabelVerticalOffset?(e.centerOffset[1]=a,e.centerOffsetUnits="screen"):e.screenOffset[1]=a}}get _firstSymbolLayer(){const e=this._graphic.graphics3DSymbol,i=gX(e);return i!=null?i.symbol.symbolLayers.at(0):null}get _normalizedSymbolAnchorPos(){const e=this._graphic.layers[0],i=e?.stageObject.geometries[0].material??null;if(i&&i instanceof Tne){const r=i.parameters.anchorPosition;HM[0]=2*(r[0]-.5),HM[1]=2*(r[1]-.5)}else HM[0]=0,HM[1]=0;return HM}};function pge(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function tq(t,e,i){const r=i!=null?i.getBoundingBoxObjectSpace(qR):qR,s=Le(r[3]-r[0],r[4]-r[1],r[5]-r[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);t.centerOffset[0]=n/2*e.normalizedOffset[0];const o=t.translation[2],a=s[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=o+a;const l=Te(s);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function ySt(t){return t==="above-center"}const Hp={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},fge={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in fge){const e=fge[t],i=Hp[t];e.forEach(r=>{Hp[r]=i})}Object.freeze&&(Object.freeze(Hp),Object.keys(Hp).forEach(t=>{Object.freeze(Hp[t]),Object.freeze(Hp[t]?.normalizedOffset)}));const HM=[0,0],qR=ch(),Tsi=Object.freeze({left:0,center:.5,right:1}),Esi=Object.freeze({"bottom-left":un(0,0),bottom:un(.5,0),"bottom-right":un(1,0),left:un(0,.5),center:un(.5,.5),right:un(1,.5),"top-left":un(0,1),top:un(.5,1),"top-right":un(1,1)});function vSt(t){switch(t){case"left":return hb.Left;case"right":return hb.Right;default:return hb.Center}}function mge(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function _St(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function Csi(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function $si(t){return t==="middle"?"center":t}function Asi(t,e){switch(t){case"top":return li(e,0,Fne);case"bottom":return li(e,0,-1);default:return zn(e,rS)}}let gge=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,i){this._materials.set(e,i),this._stage.add(i)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}};const SNe="arial-unicode-ms",yge="woff2",vge=new Map,TNe=new Set;let bSt=class{constructor(e,i){this.fontFace=e,this.promise=i}};async function wSt(t){const e=ESt(t),i=TSt(t),r=vge.get(e);if(r)return r.promise;const s=new FontFace(t.family,`url('${Ir.fontsUrl}/woff2/${i}.${yge}') format('${yge}')`,{style:t.style,weight:t.weight}),n=document.fonts;if(n.has(s)&&s.status==="loading")return s.loaded;const o=s.load().then(()=>(n.add(s),s));return vge.set(e,new bSt(s,o)),TNe.add(s),o}function xSt(t){return TNe.has(t)}function SSt(t){if(!t)return SNe;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function TSt(t){const e=ENe(t)+CNe(t);return SSt(t.family)+(e.length>0?e:"-regular")}function ESt(t){const e=ENe(t)+CNe(t);return(t.family||SNe)+(e.length>0?e:"-regular")}function ENe(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function CNe(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}let CSt=class $Ne{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=_ge(e.color),this.haloStyle=$St(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?_ge(e.background.color):null}fontString(e){const i=this.definition.font;return`${i.style} ${i.weight} ${e}px ${i.family}, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji`}setFontProperties(e,i){e.font=this.fontString(i),e.textAlign="left",e.textBaseline="alphabetic"}static async fromSymbol(e,i){const r=e?.material?.color,s=qe.toUnitRGBA(r)??sn,n=e.size!=null?tS(e.size):12,o=e.lineHeight,a=e.background!=null?qe.toUnitRGBA(e.background.color):sn,l={family:e.font?.family??"sans-serif",decoration:e.font?.decoration??"none",weight:e.font?.weight??"normal",style:e.font?.style??"normal"},c=e.halo,h=c?.color!=null&&c.size>0?{size:tS(c.size),color:qe.toUnitRGBA(c.color)}:{size:0,color:sn},d=new $Ne({color:s,size:n,background:{color:a,padding:e.background!=null?[.65*n,.5*n]:[0,0],borderRadius:e.background!=null?n*(6/16):0},lineSpacingFactor:o,font:l,halo:h,pixelRatio:i});if(e.font){let f=!1;const m=d.fontString(n);try{f=(await document.fonts.load(m)).some(y=>!xSt(y))}catch{J.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${m}'. Some text symbology may be rendered using the default browser font.`)}if(!f&&!ASt.has(e.font.family))try{await wSt(e.font)}catch{}}return d}};function $St(t){return`rgb(${t.slice(0,3).map(e=>Math.floor(255*e)).toString()})`}function _ge(t){return`rgba(${t.slice(0,3).map(e=>Math.floor(255*e)).toString()},${t[3]})`}const ASt=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),g0=4096;let tC=class extends ue{constructor(e){super(e),this.type=Nn.Texture,this.id=_d(),this.events=new ws,this._glTexture=null,this._atlas=new OSt(256,256),this._needsRepack=!1,this._canRepack=!0,this._elementsToRender=new Map,this._elements=new Map,this._uvCallbacks=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._updateCanvasElementSize(this._atlas),this._reset()}unload(){this._glTexture=Rt(this._glTexture),this._frameWorker=Hi(this._frameWorker),this.updating=!1,this.events.emit("unloaded")}get glTexture(){return this._glTexture}static get maxSize(){return WR=0,[g0-y0-WR,g0-y0-WR-bge]}load(e){if(this._glTexture)return this._glTexture;const i=new $r;return i.wrapMode=nr.CLAMP_TO_EDGE,i.samplingMode=di.LINEAR_MIPMAP_LINEAR,i.hasMipmap=!0,i.preMultiplyAlpha=!0,i.maxAnisotropy=e.parameters.maxMaxAnisotropy,this._glTexture=new yi(e,i,this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(at.TEXT_TEXTURE_ATLAS,this),this.setDirty(),this._glTexture}dispose(){this._elements.clear(),this._elementsToRender.clear(),this._frameWorker=Hi(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=Rt(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.width=e.width,this._canvas.height=e.height}_resizeAtlas(e,i){const{width:r,height:s}=this._atlas;r===e&&s===i||(this._atlas.width=e,this._atlas.height=i,this._glTexture?.resize(e,i),this._glTexture?.updateData(0,0,0,r,s,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach(n=>this._uvCallbacks.get(n.textRenderer.key)?.forEach(o=>o(n.uv))),this._reset())}_reset(){this._elementsToRender.clear(),this._atlas.reset(),this._needsRepack=!0,this.setDirty()}_addAtlasElement(e,i,r,s){const n=this._atlas;if(n.width<r||n.height<s)return!1;let o=n.cursors.get(s);if(!o){if(n.height<n.nextY+s)return!1;o=[new wge(n.nextY)],n.cursors.set(s,o),n.nextY+=s}let a=o.find(l=>n.width>=l.x+r);if(a==null){if(n.height<n.nextY+s)return!1;a=new wge(n.nextY),n.nextY+=s,o.push(a)}return e.setNewPosition(a),this._elements.set(i,e),this._elementsToRender.set(i,e),a.x+=r,!0}_ensureCallbacks(e){const i=this._uvCallbacks.get(e);if(i)return i;const r=new Set;return this._uvCallbacks.set(e,r),r}_addCallback(e,i){this._ensureCallbacks(e).add(i)}_removeCallback(e,i){const r=this._uvCallbacks.get(e);return!(!r?.delete(i)||r.size!==0)&&(this._uvCallbacks.delete(e),!0)}_processAddition(e){const i=e.textRenderer.key;if(this._needsRepack)return void this._elements.set(i,e);const r=this._atlas,s=e.textRenderer.renderedWidth,n=e.textRenderer.renderedHeight,o=s+y0,a=n+y0+bge;if(!this._addAtlasElement(e,i,o,a)){if(this._canRepack)this._reset();else if(r.width<o){const l=Math.min(Jy(Math.max(o,1.5*r.width)),g0);this._resizeAtlas(l,r.height)}else{const l=r.nextY+a,c=Math.min(Jy(Math.max(l,1.5*r.height)),g0);if(c>r.height)this._resizeAtlas(r.width,c);else if(r.width<g0){const h=Math.min(Jy(1.5*r.width),g0);this._resizeAtlas(h,r.height)}}this._elements.set(i,e)}}_renderElement(e){const i=e.commitNewPosition(),r=e.textRenderer;this._ctx.clearRect(i[0]-y0,i[1]-y0,r.renderedWidth+2*y0,r.renderedHeight+2*y0),r.render(this._ctx,i[0],i[1]),this._uvCallbacks.get(r.key)?.forEach(s=>s(e.uv))}get running(){return this.updating}runTask(e){if(this._glTexture==null)return Ko;for(;this._needsRepack&&(this._canRepack||this._atlas.height<g0&&this._atlas.height<g0);){this._canRepack=this._needsRepack=!1;const i=this._elements;this._elements=new Map,i.forEach(r=>this._processAddition(r)),e.madeProgress()}if(this._elementsToRender.size>0){for(const[i,r]of this._elementsToRender){if(e.done)break;this._renderElement(r),this._elementsToRender.delete(i),e.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=this._elementsToRender.size>0}addText(e,i){const r=e.key;this._addCallback(r,i);let s=this._elements.get(r);return s?Dx(s.uv,sn)||i(s.uv):(s=new MSt(this._atlas,e),this._processAddition(s),this.setDirty()),{remove:()=>this._removeText(e,i)}}_removeText(e,i){const r=e.key;this._elements.get(r)&&this._removeCallback(r,i)&&(this._elements.delete(r),this._elementsToRender.delete(r),this._canRepack=!0)}setDirty(){this._glTexture&&(this.updating=!0)}get test(){}};u([p({constructOnly:!0})],tC.prototype,"view",void 0),u([p({type:Boolean})],tC.prototype,"updating",void 0),tC=u([A("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],tC);const y0=2,bge=2;let MSt=class{constructor(e,i){this._atlas=e,this.textRenderer=i,this._uv=pi(),this._newPosition=[0,0]}get uv(){if(this._xOffset==null||this._yOffset==null)return sn;const{renderedWidth:e,renderedHeight:i}=this.textRenderer;return es(this._uv,this._xOffset/this._atlas.width,(this._yOffset+i)/this._atlas.height,(this._xOffset+e)/this._atlas.width,this._yOffset/this._atlas.height)}setNewPosition(e){this._newPosition[0]=e.x,this._newPosition[1]=e.y}commitNewPosition(){return this._xOffset=this._newPosition[0],this._yOffset=this._newPosition[1],this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}},OSt=class{constructor(e,i){this.width=e,this.height=i,this.cursors=new Map,this.nextY=0}reset(){this.cursors.clear(),this.nextY=WR}},wge=class{constructor(e){this.y=e,this.x=WR}},WR=0,xge=class{constructor(e,i){this.labelingContext=e,this.graphics3DGraphic=i,this.hasGraphics3DResources=!1,this.visible=!1,this.textureAtlasHandles=[],this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},ISt=class{constructor(e,i,r,s,n){this.labelClass=e,this.graphics3DSymbol=i,this.graphics3DCalloutSymbolLayer=r,this.textRenderParameters=s,this.labelFunction=n,this.calloutSymbolLayerIndex=0}},RSt=class{constructor(e,i,r,s,n,o,a,l){this.layer=i,this.graphics3DCore=r,this.scaleVisibility=s,this.emptySymbolLabelSupported=n,this.elevationInfoOverride=o,this.disablePlacement=a,this.active=l,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new $3e(e,{pickable:!0,disableOctree:!0},i.uid)}destroy(){this.stageLayer.destroy()}},M1=class extends ue{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this.addHandles([H(()=>this.view.state?.camera,()=>this.setDirty()),H(()=>this.view.state?.rasterPixelRatio,()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(at.LABELER,this)]),this._textTextureAtlas=new tC({view:this.view}),this._hudMaterialCollection=new gge(this.view._stage),this._calloutMaterialCollection=new gge(this.view._stage)}dispose(){this.removeAllHandles(),this._textTextureAtlas=Rt(this._textTextureAtlas),this._hudMaterialCollection=Rt(this._hudMaterialCollection),this._calloutMaterialCollection=Rt(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear()}destroy(){this.dispose(),Xd.graphic=null,Xd.renderingInfo=null,Xd.layer=null}_activateLabelingContext(e){e.graphics.forEach((i,r)=>{const s=new xge(e,i);this._labels.set(r,s),e.labelsToInitialize.set(r,s),i.setVisibilityFlag(bo.LABEL,_a.USER,!0)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((i,r)=>{i.setVisibilityFlag(bo.LABEL,_a.USER,!1),this.setLabelGraphicVisibility(i,!1),i.clearLabelGraphics(),this._labels.delete(r)}),e.active=!1}_addLabelTextureToAtlas(e){for(const i of e.graphics3DGraphic.labelLayers){if(!i._labelClass)continue;const r=e.textRenderers[i._labelIndex];r&&(e.textureAtlasHandles.push(this._textTextureAtlas.addText(r,s=>DSt(i.stageObject,s))),PSt(i.stageObject,r))}}_removeLabelTextureFromAtlas(e){e.textureAtlasHandles.forEach(i=>i.remove()),e.textureAtlasHandles.length=0}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),Ko}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const i of this._labelingContexts)if(i.active){if(iq(i))this._dirty=!0;else if(rq(i.labelClassContexts)){if(i.labelClassContexts===null){this._deactivateLabelingContext(i);continue}this._createLabelClassContext(i),this._dirty=!0}else for(const[r,s]of i.labelsToInitialize)if(this._ensureGraphics3DResources(s)&&(this._labels.set(r,s),this.deconflictor.setDirty(),e.madeProgress()),(s.visible&&s.textInitialized||!s.visible&&s.hasGraphics3DResources)&&(i.labelsToInitialize.delete(r),e.madeProgress()),e.done){this._dirty=!0;break}}this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){const i=e.labelClassAbortController?.signal;e.layer.when&&await e.layer.when(),gt(i),e.scaleVisibility?.updateScaleRangeActive();const r=e.graphics3DCore,s=r.layer,n=s.labelingInfo?.filter(o=>!!o.symbol);!n||n.length===0||(await mte(n,async(o,a)=>{const l=o.symbol,c=gX(r.getOrCreateGraphics3DSymbol(l));if(c==null)return void J.getLogger(this).error("Failed to create Graphics3DSymbol for label");await c.load(),gt(i);let h=null;t$e(l)&&l.hasVisibleCallout()&&(h=K1t(l,r.symbolCreationContext),await h.load(),gt(i));const d=await lf(I1t(o,e.layer.fieldsIndex,this.view.spatialReference));if(gt(i),d.ok===!0){const f=await this._createTextRenderParameters(c.symbol);gt(i),e.labelClassContexts[a]=new ISt(o,c,h,f,d.value)}else J.getLogger(this).error(`Label expression failed to evaluate: ${d.error}`)}),gt(i))}async _createLabelClassContext(e){return e.labelClassPromise==null&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(i=>{if(Xr(i))throw i;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const i=e.symbolLayers.at(0);return i?.type!=="text"?null:CSt.fromSymbol(i,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(e){for(const r of e.labelClassContexts)--r.graphics3DSymbol.referenced;const i=e.labelClassAbortController;e.labelClassAbortController=new AbortController,hc(i),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,i,r,s,n,o){const a=new cSt(r,mge(r.anchor),_St(r.anchor),e.text,un(e.displayWidth,e.displayHeight));return Xd.graphic=i,Xd.layer=s,Xd.renderingInfo=null,n.createLabel(Xd,a,this._hudMaterialCollection,this._textTextureAtlas,()=>o.placement?.elevationOffset??null)}_createLineCalloutGraphic(e,i,r,s,n){Xd.graphic=e,Xd.layer=n;const o=s.screenOffset[0];return Xd.renderingInfo=new J1t(null,i,s.translation,s.centerOffset,o,s.centerOffsetUnits,s.elevationOffset,this._calloutMaterialCollection),r.createGraphics3DGraphic(Xd)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const i=e.graphics3DGraphic;if(i.destroyed)return!1;this._ensureTextTextureResources(e);const r=e.labelingContext,s=r.labelClassContexts;if(rq(s)||!r.emptySymbolLabelSupported&&i.layers.length===0)return!1;let n=!1;const o=i.graphic,a=r.layer,l=fF(r.layer);for(let c=0;c<s.length;c++){const h=e.textRenderers[c],d=e.textLabelPlacements[c];if(h==null||d==null)continue;const f=s[c],m=f.graphics3DSymbol,y=LSt(m),v=m.symbolLayers[0];if(!v)continue;v.setElevationInfoOverride(r.elevationInfoOverride);const _=new dge(i,y,f.labelClass),b=this._createTextSymbolGraphic(h,o,d,a,v,_);if(b==null)return!1;b._labelClass=f.labelClass,b._labelIndex=c,i.addLabelGraphic(b,r.stageLayer),i.deconflictionPriority=f.textRenderParameters?.definition.size??0,i.setVisibilityFlag(bo.LABEL,_a.USER,l),i.setVisibilityFlag(bo.LABEL,_a.SCALE_RANGE,!0),i.setVisibilityFlag(bo.LABEL,_a.DECONFLICTION,!1),n=!0;const w=f.graphics3DCalloutSymbolLayer;if(w&&d.hasLabelVerticalOffset){w.setElevationInfoOverride(r.elevationInfoOverride);const x=this._createLineCalloutGraphic(o,y,w,d,a);x!=null&&(f.calloutSymbolLayerIndex=i.labelLayers.length,i.addLabelGraphic(x,r.stageLayer))}break}return n&&r.scaleVisibility?.updateGraphicLabelScaleVisibility(i),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const i=e.labelingContext.labelClassContexts;for(const r of e.graphics3DGraphic.labelLayers){if(r._labelClass==null)continue;i[r._labelIndex].graphics3DSymbol.symbolLayers[0]?.onRemoveGraphic(r)}e.graphics3DGraphic.deconflictionPriority=0,e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){if(e.textInitialized)return;const i=e.labelingContext,r=i.labelClassContexts;if(rq(r))return;const s=e.graphics3DGraphic.graphic;for(let n=0;n<r.length;n++){const o=r[n];if(e.textRenderers[n]=null,e.textLabelPlacements[n]=null,o?.textRenderParameters==null)continue;const a=o.labelFunction;let l;if(a.type==="arcade")try{const b=a.needsHydrationToEvaluate()?Clt(s,i.layer):s;l=a.evaluate(b)}catch{l=null}else l=a.evaluate(s);if(l==null||l===""||/^\s+$/.test(l))continue;const c=o.graphics3DSymbol;if(!c.symbolLayers[0])continue;const h=e.graphics3DGraphic,d=c.symbol?.type==="label-3d"?c.symbol:null,f=o.labelClass,m=i.disablePlacement,y=new dge(h,d,f,m).placement;if(y==null)continue;const v=mge(y.anchor),_=vSt(v);e.textRenderers[n]=new fSt(l,_,o.textRenderParameters,tC.maxSize),e.textLabelPlacements[n]=y}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,i){const r=i.graphic.uid;if(e.graphics.set(r,i),e.active){const s=new xge(e,i);this._labels.set(r,s),e.labelsToInitialize.set(r,s)}this.setDirty(),this.deconflictor.setDirty()}_updateGraphicGeometry(e,i){const r=i.graphic.uid,s=this._labels.get(r);if(!s)return!0;for(const n of s.graphics3DGraphic.labelLayers)if(n._labelClass!=null&&!e.labelClassContexts[n._labelIndex].graphics3DSymbol.symbolLayers[0].updateGeometry(n,i.graphic.geometry))return!1;return this.setDirty(),this.deconflictor.setDirty(),!0}_removeGraphic(e,i){const r=i.graphic.uid,s=this._labels.get(r);e.graphics.delete(r),s&&(this._destroyGraphic(s,r),e.labelsToInitialize.delete(r),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,i){this._labels.delete(i),e.textureAtlasHandles.length&&this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,i){if(!i)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const r of i){const s=e.graphics.get(r);s&&(this._removeGraphic(e,s),this._addGraphic(e,s))}}_globalPropertyChanged(e,i){for(const r of i.labelClassContexts){const s=new Map;i.graphics.forEach(o=>s.set(o.graphic.uid,o));const n=o=>o.labelLayers[0];if(r.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,s,n),r.graphics3DCalloutSymbolLayer){const o=a=>a.labelLayers[r.calloutSymbolLayerIndex];r.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,s,o)}}}_visibilityInfoChange(e){const i=fF(e.layer);i&&!e.active&&this._activateLabelingContext(e),!i&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((i,r)=>{const s=this._labels.get(r);s&&(this._destroyGraphic(s,r),s.visible=!1,e.labelsToInitialize.set(r,s))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const i of this._labelingContexts)if(i.graphics3DCore===e)return i;return null}addGraphicsOwner(e,i,r){const s=r?.emptySymbolLabelSupported||!1,n=r?.elevationInfoOverride||null,o=r?.disablePlacement||null;if(this._findLabelingContext(e))return;const a=e.layer,l=new RSt(this.view._stage,a,e,i,s,n,o,fF(a));return this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),updateGraphicGeometry:c=>this._updateGraphicGeometry(l,c),layerLabelsEnabled:()=>fF(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),remove:()=>this._removeGraphicsOwner(e),setDirty:()=>this.setDirty()}}_removeGraphicsOwner(e){const i=this._findLabelingContext(e);if(!i)return;const r=this._labelingContexts.indexOf(i);this._labelingContexts.splice(r,1),i.graphics.forEach(s=>this._removeGraphic(i,s)),i.destroy(),this.setDirty()}setLabelGraphicVisibility(e,i){const r=e.graphic.uid,s=this._labels.get(r);s&&s.visible!==i&&(i&&!s.textureAtlasHandles.length?(this._addLabelTextureToAtlas(s),s.textInitialized||s.labelingContext.labelsToInitialize.set(r,s)):!i&&s.textureAtlasHandles.length&&this._removeLabelTextureFromAtlas(s),s.visible=i,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._dirty||this._textTextureAtlas?.updating||this.deconflictor.updating||this._labelingContexts.some(e=>iq(e))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((i,r)=>i+(iq(r)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){}};function PSt(t,e){t.geometries[0].setAttributeData(z.SIZE,[e.displayWidth,e.displayHeight]),t.geometryVertexAttributeUpdated(t.geometries[0],z.SIZE)}function DSt(t,e){t.geometries[0].setAttributeData(z.UV0,e),t.geometryVertexAttributeUpdated(t.geometries[0],z.UV0,!0)}function iq(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function rq(t){return!t||t.length===0}function LSt(t){return t.symbol?.type==="label-3d"?t.symbol:null}function fF(t){return t.labelsVisible===!0&&!!t.labelingInfo?.some(e=>!!e.symbol)}u([p({constructOnly:!0})],M1.prototype,"view",void 0),u([p({constructOnly:!0})],M1.prototype,"deconflictor",void 0),u([p()],M1.prototype,"_textTextureAtlas",void 0),u([p({type:Boolean,readOnly:!0})],M1.prototype,"updating",null),M1=u([A("esri.views.3d.layers.graphics.Labeler")],M1);const Xd=new X1t(null,null,null);let Sge=class SI{constructor(e,i,r,s,n=a5(e,i,r)){this._tilingScheme=s,this.id=n,this.lij=[0,0,0],this.extent=Qt(),this.measures=new NSt,this.loadPriority=0,this.used=!1,this.lij[0]=this.measures.lodLevel=e,this.lij[1]=i,this.lij[2]=r,s.getExtent(e,i,r,this.extent)}get planetRadius(){return gr(this.spatialReference).radius}get spatialReference(){return this._tilingScheme.spatialReference}get resolution(){return this._tilingScheme.resolutionAtLevel(this.measures.lodLevel)}get level(){return this.lij[0]}get lodLevelDelta(){return this.measures.lodLevel-this.level}createChildren(){const e=this.lij[0]+1,i=2*this.lij[1],r=2*this.lij[2];return[new SI(e,i,r,this._tilingScheme),new SI(e,i+1,r,this._tilingScheme),new SI(e,i,r+1,this._tilingScheme),new SI(e,i+1,r+1,this._tilingScheme)]}},NSt=class{constructor(){this.visible=!0,this.distance=0,this.lodLevel=0,this.splitPriority=0,this.mergeable=!0}};function a5(t,e,i){return`${t}/${e}/${i}`}function FSt(t,e,i,r,s,n,o=1){const a=xb(e,s);if(a==null)return!1;if(a===ms){if(t===r&&i===n)return!0;const c=i+o;for(let h=i,d=n;h<c;++h,++d)ne(r[d],t[h]);return!0}const l=i+o;for(let c=i,h=n;c<l;++c,++h)a(t[c],0,r[h],0);return!0}let kSt=class{constructor(e,i){this._renderCoordsHelper=e,this.opaqueGround=i,this._cache=new Map,this._cameraForward=$(),this._cameraEye=$(),this._cameraFovY=55*Math.PI/180,this._frustumBoundingSphereCenter=$(),this._frustumBoundingSphereRadius=0,this._frustum=new tB(e),this._renderSR=e.spatialReference;const r=$b(this._renderSR);this._renderSREllipsoidRadius=gr(r).radius}setup(e){this._aboveGround=e.aboveGround,this._frustum.update(e),ae(this._cameraForward,e.viewForward),ne(this._cameraEye,e.eye),this._cameraFovY=e.fovY,this._updateFrustumBoundingSphere()}done(){this._cache.clear()}compute(e){if(this._cache.has(e.id))return this._cache.get(e.id);const i=this._isVisibleInFrustum(e);return this._cache.set(e.id,i),i}_isVisibleInFrustum(e){return this._renderCoordsHelper.viewingMode===Be.Local?this._isTileVisibleInFrustumLocal(e):this._isTileVisibleInFrustumGlobal(e)}_updateFrustumBoundingSphere(){const e=this._frustum,i=e.origin,r=WSt;ae(r,e.direction);const s=e.points,n=ZSt;Ri(n,s[4],i);const o=.5*de(n,n)/de(r,n),a=this._frustumBoundingSphereCenter;Xn(a,i,r,o);const l=1+o;this._frustumBoundingSphereRadius=l}_isTileVisibleInFrustumLocal(e){const i=e.spatialReference,r=e.extent,s=this._renderSR;if(_n[0]=r[0],_n[1]=r[1],_n[2]=0,_n[3]=r[2],_n[4]=r[3],_n[5]=0,!Bn(_n,i,0,_n,s,0))return!1;se(el[0],_n[0],_n[1],0),se(el[1],_n[3],_n[1],0),se(el[2],_n[3],_n[4],0),se(el[3],_n[0],_n[4],0),se(mF,.5*(_n[0]+_n[3]),.5*(_n[1]+_n[4]),.5*(_n[2]+_n[5]));const n=Mge,o=.5*za(el[0],el[2]),a=this._frustum,l=this._frustumBoundingSphereRadius,c=this._frustumBoundingSphereCenter,h=JSt;Ri(h,c,mF);const d=de(n,h),f=YSt;if(Xn(f,mF,n,d),za(f,c)>o+l)return!1;const m=this._cameraForward,y=de(m,Mge),v=this._cameraFovY,_=this._cameraEye;if(Math.abs(y)<Math.abs(Math.cos(.5*v))){let T=!0;const M=se(xTt,m[0],m[1],0),I=de(_,M);for(let P=0;P<4;++P){const D=el[P];if(de(D,M)-I>0){T=!1;break}}if(T)return!1}{const T=el[0],M=el[2];if(T[0]<=_[0]&&_[0]<=M[0]&&T[1]<=_[1]&&_[1]<=M[1])return!0}const b=VSt,w=this.opaqueGround&&this._aboveGround,x=this.opaqueGround&&!this._aboveGround,S=Math.min(x?gF:1/0,d+l),C=Math.max(w?-430:-1/0,d-l);for(let T=0;T<4;++T)Xn(b[T],el[T],n,S),Xn(b[T+4],el[T],n,C);if(Ege(a.planes,b,8))return!1;if(sq(a.planes,b,8))return!0;for(let T=0;T<4;++T){const M=b[T],I=b[T+4];if(aq(a.planes,M,I))return!0;const P=b[(T+1)%4];if(aq(a.planes,M,P))return!0;const D=b[4+(T+1)%4];if(aq(a.planes,I,D))return!0}if(Pf[0][3]=+el[0][0],Pf[1][3]=-el[2][0],Pf[2][3]=+el[0][1],Pf[3][3]=-el[2][1],Pf[4][3]=+C,Pf[5][3]=-S,sq(Pf,a.points)||sq(Pf,a.points))return!0;for(let T=0;T<4;++T){const M=_,I=a.points[T+4];if(Oge(Pf,M,I))return!0;const P=a.points[4+(T+1)%4];if(Oge(Pf,I,P))return!0}return!1}_isTileVisibleInFrustumGlobal(e){if(e.level<l5)return!0;const i=e.spatialReference,r=e.extent,s=this.opaqueGround&&this._aboveGround,n=this.opaqueGround&&!this._aboveGround,o=el,a=.5*(r[0]+r[2]);if(se(o[0],r[0],r[1],0),se(o[1],r[2],r[1],0),se(o[2],r[2],r[3],0),se(o[3],r[0],r[3],0),se(o[4],a,r[1],0),se(o[5],a,r[3],0),!FSt(o,i,0,o,this._renderSR,0,6))return!1;const l=o[0][2]>0,c=o[3][2]<0,h=l||c,d=this._renderSREllipsoidRadius;if(h){const mt=jSt;Z0(mt,yF,o[0]);const _e=GSt;if(Z0(_e,yF,o[1]),l){const pe=Cge,we=o[4],Re=$ge;Z0(Re,we,yF),Z0(pe,Re,we);const tt=o[0];lt(tt,mt,pe),qM(tt,d);const We=o[1];lt(We,_e,pe),qM(We,d)}else if(c){const pe=Cge,we=o[5],Re=$ge;Z0(Re,we,yF),Z0(pe,we,Re);const tt=o[3];lt(tt,pe,mt),qM(tt,d);const We=o[2];lt(We,pe,_e),qM(We,d)}}const f=mF,m=Ri(eTt,o[3],o[0]);ae(m,m);const y=oe(tTt,o[0],o[3]);ie(y,y,.5);const v=-de(y,m),_=oe(iTt,o[0],o[1]);ie(_,_,.5);const b=oe(rTt,o[2],o[3]);ie(b,b,.5);const w=Ri(sTt,b,_);ae(w,w);const x=-(v+de(m,_))/de(m,w);Xn(f,_,w,x),qM(f,d);const S=this._frustumBoundingSphereRadius,C=this._frustumBoundingSphereCenter,T=this._frustum,M=T.planes,I=HSt;ae(I,f);const P=de(o[0],I)/Ba(o[0]),D=T.origin,F=T.points;let L=!1;if(s){{L=!0;const _e=ae(Age,D);for(let pe=0;pe<4;++pe){const we=F[4+pe],Re=Ri($(),we,D);ae(Re,Re);const tt=lt($(),_e,Re);ae(tt,tt);const We=lt($(),Re,tt);if(ae(We,We),de(D,We)>d){L=!1;break}}}if(L&&de(D,I)<d*P-gF)return!1;const mt=ae(Age,T.origin);if(de(mt,I)<0)return!1;{const _e=ae(bTt,T.direction);if(de(_e,I)>wTt)return!1}}const N=Math.sqrt(1-P*P);if(N>.9)return!0;let R=!1;const k=de(I,C),W=Ba(C);if(W<=S&&!M.some(mt=>rn(mt,nq)>0)){if(!s)return!0;R=!0}const G=k/W;if(!R&&k<=0&&-k>S)return!1;const j=S/W;if(Math.sqrt(1-G*G)*Math.sqrt(1-j*j)-j*G>N)return!1;if(!L&&(o.some(mt=>T.intersectsPoint(mt))||T.intersectsPoint(f)))return!0;const re=XSt;Ri(re,C,nq);const ve=de(re,I),xe=qSt;ie(xe,I,ve);const De=za(xe,C),Ke=i.isWGS84,je=e.lij,ft=Ke&&je[2]===2**je[0]-1,At=Ke&&je[2]===0,ti=At?fTt:ft?dTt:uTt,Tt=At?mTt:ft?pTt:hTt;if(!R){const mt=o,_e=gTt,pe=nTt,we=oTt,Re=nq;for(const tt of ti){const We=mt[tt];if(Tge(pe,mt[(tt+1)%4],We),Tge(we,Re,We),Z0(_e,we,pe),BSt(_e,F,1))return!1}}let xt=null;if(!s&&ve<1.01*S){const mt=2.5*S;if(De>P*mt+S)return!1;const _e=QSt,pe=mt/P;for(let we=0;we<4;++we)ie(_e[we],o[we],pe/d);se(_e[4],0,0,0),xt=_e}else{const mt=(n?d+gF:ve+S)/P,_e=s?d-gF:(ve-S)/P,pe=KSt;for(let we=0;we<4;++we){const Re=o[we];ie(pe[we],Re,_e/d),ie(pe[we+4],Re,mt/d)}xt=pe}if(Ege(M,xt,xt.length))return!1;const kt=T.lines,Et=aTt,Ht=lTt;for(const mt of kt){ae(Ht,mt.direction);for(const _e of Tt){const pe=xt[_e];if(ae(Et,pe),oq(Ht,Et,xt,F))return!1;const we=(_e+1)%4;if(s){const Re=xt[we];if(Ri(Et,Re,pe),ae(Et,Et),oq(Ht,Et,xt,F))return!1}if(n){const Re=xt[4+_e],tt=xt[4+we];if(Ri(Et,tt,Re),ae(Et,Et),oq(Ht,Et,xt,F))return!1}}}return!0}};function Z0(t,e,i){return lt(t,e,i),ae(t,t),t}function Tge(t,e,i){return Ri(t,e,i),ae(t,t),t}function qM(t,e){return ie(t,t,e/Ba(t)),t}const ANe=[_o.LEFT,_o.RIGHT,_o.BOTTOM,_o.TOP,_o.FAR];function zSt(t,e,i){for(let r=0;r<i;++r)if(rn(t,e[r])<=0)return!1;return!0}function Ege(t,e,i){for(const r of ANe)if(zSt(t[r],e,i))return!0;return!1}function sq(t,e,i=e.length){for(let r=0;r<i;++r){const s=e[r];let n=!0;for(const o of t)if(rn(o,s)>0){n=!1;break}if(n)return!0}return!1}const l5=2,USt=4;function BSt(t,e,i){for(const r of e)if(de(r,t)<i)return!1;return!0}const VSt=[$(),$(),$(),$(),$(),$(),$(),$()],_n=[0,0,0,0,0,0],el=[$(),$(),$(),$(),$(),$()],mF=$(),Cge=$(),jSt=$(),GSt=$(),$ge=$(),HSt=$(),qSt=$(),WSt=$(),ZSt=$(),YSt=$(),JSt=$(),nq=hf(0,0,0),XSt=$(),KSt=[$(),$(),$(),$(),$(),$(),$(),$()],QSt=[$(),$(),$(),$(),$()],eTt=$(),tTt=$(),iTt=$(),rTt=$(),sTt=$(),nTt=$(),oTt=$(),aTt=$(),lTt=$(),cTt=$(),uTt=[0,1,2,3],hTt=[0,1,2,3],dTt=[0,1,3],pTt=[0,1,3],fTt=[1,2,3],mTt=[1,2,3],gTt=$();function yTt(t,e,i){let r=1/0,s=-1/0;for(const n of i){const o=de(e,n);r=Math.min(r,o),s=Math.max(s,o)}t[0]=r,t[1]=s}function vTt(t,e,i,r){let s=1/0,n=-1/0;for(const o of r){const a=de(i,o);if(s=Math.min(s,a),n=Math.max(n,a),s<=e&&n>=t)return!1}return!0}const _Tt=[0,0];function oq(t,e,i,r){if(i.length===0||r.length===0)return!0;const s=cTt;Z0(s,t,e);const n=r[0]<i[0],o=n?i:r,a=_Tt;return yTt(a,s,n?r:i),vTt(a[0],a[1],s,o)}const gF=430,Age=$(),bTt=$(),wTt=Math.cos(.25*Math.PI),Mge=Le(0,0,1),xTt=$();function aq(t,e,i){const r={t0:0,t1:1};for(const s of ANe)if(!MNe(t[s],e,i,r))return!1;return r.t0<r.t1}function Oge(t,e,i){const r={t0:0,t1:1};for(const s of t)if(!MNe(s,e,i,r))return!1;return r.t0<r.t1}function MNe(t,e,i,r){let{t0:s,t1:n}=r;const o=rn(t,e),a=rn(t,i);if(o>=0&&a>=0)return!1;if(o<0&&a>=0){const l=-o/(a-o);if(l<s)return!1;l<n&&(n=l)}else if(o>=0&&a<0){const l=o/(o-a);if(l>n)return!1;l>s&&(s=l)}return r.t0=s,r.t1=n,!0}const Pf=[Iy(-1,0,0,1),Iy(1,0,0,-1),Iy(0,-1,0,1),Iy(0,1,0,-1),Iy(0,0,-1,1),Iy(0,0,1,-1)],yF=hf(0,0,1);let Ige=class{constructor(e,i,r){this._renderCoordsHelper=e,this._tilingScheme=i,this._camera=new jr,this._surfaceElevation=0,this._focusOnMap=[0,0],this._visibility=new kSt(e,r)}set opaqueGround(e){this._visibility.opaqueGround=e}setup(e,i,r){this._camera.copyFrom(e),this._surfaceElevation=r,this._focusOnMap[0]=i.x,this._focusOnMap[1]=i.y,this._visibility.setup(this._camera)}done(){this._visibility.done()}update(e){const{measures:i,extent:r,level:s}=e;i.visible=this._visibility.compute(e),i.distance=sHe(r,this._focusOnMap),i.mergeable=!0,i.lodLevel=l5,i.splitPriority=Math.max(0,l5-s),i.visible&&(this._isGlobal?this._updateSplitAndLodGlobal(e):this._updateSplitAndLodLocal(e))}_updateSplitAndLodGlobal(e){const i=e.level,r=this._renderCoordsHelper,{eye:s,fov:n}=this._camera,o=r.referenceEllipsoid.radius,a=Ba(s)-o;if(2*Math.atan(o/a)<n&&a>0)return void(e.measures.lodLevel=Math.max(i,l5));const l=Rge,{extent:c}=e,{_surfaceElevation:h}=this;se(l[0],c[0],c[1],h),se(l[1],c[2],c[1],h),se(l[2],c[2],c[3],h),se(l[3],c[0],c[3],h);const d=se(Pge,.5*(c[0]+c[2]),.5*(c[1]+c[3]),h),f=this._tilingScheme.spatialReference;for(let _=0;_<4;++_)r.toRenderCoords(l[_],f,l[_]);r.toRenderCoords(d,f,d);const m=ae(lq.direction,d),y=de(s,m),v=ie(Dge,m,y);this._updateSplitAndLod(e,l,d,v)}_updateSplitAndLodLocal(e){const i=Rge,{extent:r}=e,{_surfaceElevation:s}=this;se(i[0],r[0],r[1],s),se(i[1],r[2],r[1],s),se(i[2],r[2],r[3],s),se(i[3],r[0],r[3],s);const n=this._tilingScheme.spatialReference;for(let d=0;d<4;++d)this._renderCoordsHelper.toRenderCoords(i[d],n,i[d]);const o=se(Pge,.5*(i[0][0]+i[2][0]),.5*(i[0][1]+i[2][1]),.25*(i[0][2]+i[1][2]+i[2][2]+i[3][2])),a=se(STt,o[0],o[1],0),{eye:l,far:c}=this._camera,h=se(Dge,a[0],a[1],l[2]);se(lq.origin,a[0],a[1],l[2]-2*c),ne(lq.direction,ONe),this._updateSplitAndLod(e,i,o,h)}_updateSplitAndLod(e,i,r,s){const n=Math.max(za(i[0],i[2]),za(i[1],i[3]),za(i[0],r)+za(r,i[2]),za(i[1],r)+za(r,i[3])),{eye:o,near:a,fov:l,viewForward:c,width:h,height:d,pixelRatio:f,frustum:m}=this._camera,y=de(o,c),v=de(r,c)-y,_=za(r,o);let b=v,w=v,x=_,S=_;const C=(G,j)=>j<a?1:Math.sqrt(G*G-j*j)/j;let T=C(_,v);for(const G of i){const j=de(G,c)-y;b=Math.min(b,j),w=Math.max(w,j);const re=za(G,o);S=Math.max(S,re),x=Math.min(x,re);const ve=C(re,j);T=Math.min(T,ve)}if(w<a)return void(e.measures.lodLevel=0);const M=Math.cos(.5*l),I=za(o,s);T>M&&I>ETt*n&&(w=Lge*S,b=Lge*x);const P=.5*Math.sqrt(h*h+d*d)/f,D=2*Math.tan(.5*l),F=G=>Math.max(a,G)*TTt/P*D,L=e.level,N=n*2**L*Math.max(1,D),R=F(b),k=Math.ceil(Math.log2(Math.max(1,N/R)));if(e.measures.lodLevel=Math.max(k,e.measures.lodLevel),e.measures.splitPriority+=e.measures.lodLevel-L,L<k){const G=+W2(m,i[0])+ +W2(m,i[1])+ +W2(m,i[2])+ +W2(m,i[3]);e.measures.splitPriority+=G}const W=F(w)/R;W>2.5&&(e.measures.splitPriority+=W)}get _isGlobal(){return this._renderCoordsHelper.viewingMode===Be.Global}};const Rge=[$(),$(),$(),$()],Pge=$(),STt=$(),Dge=$(),ONe=hf(0,0,1),lq=cre(on,ONe),TTt=312,ETt=.5,Lge=2;function Vsi(t,e,i){if(t==null||i==null)return!1;let r=!0;return Mn[0]=t.xmin!=null?t.xmin:0,Mn[1]=t.ymin!=null?t.ymin:0,Mn[2]=t.zmin!=null?t.zmin:0,r=r&&Bn(Mn,t.spatialReference,0,e,i,0),Mn[0]=t.xmax!=null?t.xmax:0,Mn[1]=t.ymax!=null?t.ymax:0,Mn[2]=t.zmax!=null?t.zmax:0,r=r&&Bn(Mn,t.spatialReference,0,e,i,3),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),r}function INe(t,e,i){if(t==null||i==null)return!1;let r=!0;return Mn[0]=t.xmin!=null?t.xmin:0,Mn[1]=t.ymin!=null?t.ymin:0,Mn[2]=t.zmin!=null?t.zmin:0,r=r&&Bn(Mn,t.spatialReference,0,Mn,i,0),e[0]=Mn[0],e[1]=Mn[1],Mn[0]=t.xmax!=null?t.xmax:0,Mn[1]=t.ymax!=null?t.ymax:0,Mn[2]=t.zmax!=null?t.zmax:0,r=r&&Bn(Mn,t.spatialReference,0,Mn,i,0),e[2]=Mn[0],e[3]=Mn[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),r}const Mn=$(),CTt=60;let zo=class extends ue{constructor(e){super(e),this.tiles=new Ee,this.tileSize=512,this._idToTile=new Map,this._clients=new Set,this._dirty=xa(!1),this._pendingTiles=xa(null),this._newTiles=new Jt,this._tests=!1,this._measurements=new Ige(e.renderCoordsHelper,e.tilingSchemeOwner.tilingScheme,this._opaqueGround)}initialize(){const e=()=>this._setDirty(),i=()=>this._reset();this.addHandles([H(()=>this.tileSize,i,St),H(()=>this.cameraOnSurface?.location,e,St),H(()=>this.viewState?.contentCamera,e,St),H(()=>this.focus?.location,e,St),H(()=>this.terrain?.baseOpacity??1,e),H(()=>this.tilingScheme,r=>{this._reset(),this._measurements=new Ige(this.renderCoordsHelper,r,this._opaqueGround)},Gt),H(()=>this._opaqueGround,r=>this._measurements.opaqueGround=r,Gt)]),this._frameWorker=this.scheduler?.registerTask(at.FEATURE_TILE_TREE,this)}destroy(){this._frameWorker=Hi(this._frameWorker)}get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(e!=null&&!e.spatialReference.equals(this.viewState.spatialReference))return void J.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const i=this._get("filterExtent");if(i===e||i!=null&&e&&i.equals(e))return;const r=e!=null?e.clone():null;this._set("filterExtent",r),this._setDirty()}get _filterExtentRect(){if(this.filterExtent==null)return null;const e=Qt();return INe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty.value||!!this._pendingTiles.value}addClient(){const e=_d();return this._clients.add(e),this._clients.size===1&&this._setDirty(),$i(()=>this._removeClient(e))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}get _opaqueGround(){return(this.terrain?.baseOpacity??1)===1}_setDirty(){this._hasClients&&!this.suspended&&(this._frameWorker?this._dirty.value=!0:this.runTask(Wc))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty.value=!1}get running(){return this.updating}_reset(){this._newTiles.clear(),this._pendingTiles.value=null,this._setDirty()}_getRootTiles(){const e=this.tilingScheme;return this._rootTileIds.map(i=>new Sge(i[0],i[1],i[2],e))}runTask(e){e=this._tests?Wc:e,this._dirty.value=!1,this._pendingTiles.value||(this._startUpdate(e),this._frameWorker!=null&&(this._frameWorker.priority=at.FEATURE_TILE_TREE_ACTIVE)),this._splitPendingTiles(e),this._pendingTiles.value||this._frameWorker==null||(this._frameWorker.priority=at.FEATURE_TILE_TREE)}_startUpdate(e){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();const{_measurements:i,_filterExtentRect:r,_newTiles:s}=this;i.setup(this.viewState.contentCamera,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles.value=this._getRootTiles().filter(n=>{if(i.update(n),n.measures.visible&&(!r||RP(n.extent,r))){if(n.measures.splitPriority>0)return!0;s.push(n)}return!1}).sort(Nge),this._newTiles.clear(),e.madeProgress()}_splitPendingTiles(e){const i=this._pendingTiles.value;if(!i)return;const{tilingScheme:r,_filterExtentRect:s,_newTiles:n,_measurements:o}=this;for(;i.length>0&&this._tileBudgetExceeded<1;){const a=i.pop();if(e.madeProgress(),a.measures.splitPriority>0){r.ensureMaxLod(a.level+1);const l=a.createChildren();for(const c of l)o.update(c),!c.measures.visible||s&&!RP(c.extent,s)||(c.measures.splitPriority>0?i.push(c):n.push(c));i.sort(Nge),this._tileBudgetExceeded>=1&&(this._mergeNewTiles(),this._tileBudgetExceeded>=1&&this._mergeNewTiles(!0))}else n.push(a);if(e.done)return}n.pushArray(i),this._pendingTiles.value=null,this._updateTiles(),n.clear(),o.done()}get _tileBudgetExceeded(){return Math.max(0,(this._newTiles.length+(this._pendingTiles.value?.length??0))/CTt-1)}_mergeNewTiles(e=!1){const{_newTiles:i,_measurements:r}=this,s=new Map(i.map(o=>[o.id,o]));let n=!1;return s.forEach(o=>{const{lij:a,measures:l}=o;if(!l.mergeable||a[1]%2!=0||a[2]%2!=0||a[0]<=1||o.lodLevelDelta>=USt)return;const c=l.lodLevel;let h=c,d=!0;const f=s.get(a5(a[0],a[1]+1,a[2]));let m=Math.abs((f?.measures.lodLevel??0)-c),y=m===0||e&&f?.measures.mergeable&&m<=1;if(!f||!y)return;h+=f.measures.lodLevel,d&&=m===0;const v=s.get(a5(a[0],a[1],a[2]+1));if(m=Math.abs((v?.measures.lodLevel??0)-c),y=m===0||e&&v?.measures.mergeable&&m<=1,!v||!y)return;h+=v.measures.lodLevel,d&&=m===0;const _=s.get(a5(a[0],a[1]+1,a[2]+1));if(m=Math.abs((_?.measures.lodLevel??0)-c),y=m===0||e&&_?.measures.mergeable&&m<=1,!_||!y)return;h+=_.measures.lodLevel,d&&=m===0,i.removeUnordered(o),i.removeUnordered(f),i.removeUnordered(v),i.removeUnordered(_);const b=new Sge(a[0]-1,a[1]/2,a[2]/2,this.tilingScheme);r.update(b),b.measures.visible=!0,b.measures.lodLevel=h/4,b.measures.mergeable=d,i.push(b),n=!0}),n}_updateTiles(){for(;this._mergeNewTiles(););for(;this._tileBudgetExceeded&&this._mergeNewTiles(!0););for(const s of this.tiles.items)s.used=!1;let e=!1;const i=this._newTiles.filter(s=>{const n=this._idToTile.get(s.id);return n?(e||=n.measures.lodLevel!==s.measures.lodLevel,n.measures={...s.measures},n.used=!0):this._idToTile.set(s.id,s),!n}),r=this.tiles.items.filter(s=>!s.used&&(this._idToTile.delete(s.id),!0));this.tiles.removeMany(r),this.tiles.addMany(i),this._sortTiles(),!e||r.length||i.length||this.tiles.emit("change")}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,i)=>e.measures.distance-i.measures.distance),this.tiles.forEach((e,i)=>e.loadPriority=i)}};function Nge(t,e){return t.lodLevelDelta-e.lodLevelDelta||t.measures.splitPriority-e.measures.splitPriority||e.measures.distance-t.measures.distance}u([p({constructOnly:!0})],zo.prototype,"scheduler",void 0),u([p({constructOnly:!0})],zo.prototype,"renderCoordsHelper",void 0),u([p({constructOnly:!0})],zo.prototype,"tilingSchemeOwner",void 0),u([p({constructOnly:!0})],zo.prototype,"cameraOnSurface",void 0),u([p({constructOnly:!0})],zo.prototype,"focus",void 0),u([p({constructOnly:!0})],zo.prototype,"viewState",void 0),u([p({constructOnly:!0})],zo.prototype,"terrain",void 0),u([p()],zo.prototype,"tiles",void 0),u([p()],zo.prototype,"tileSize",void 0),u([p({readOnly:!0})],zo.prototype,"tilingScheme",null),u([p()],zo.prototype,"filterExtent",null),u([p({readOnly:!0})],zo.prototype,"_filterExtentRect",null),u([p({readOnly:!0})],zo.prototype,"_rootTileIds",null),u([p({value:!1})],zo.prototype,"suspended",null),u([p({readOnly:!0})],zo.prototype,"updating",null),zo=u([A("esri.views.3d.layers.support.FeatureTileTree3D")],zo);let ls=class extends ue{constructor(e){super(e),this._propertiesPool=new ov({camera:jr},this),this._lastSeenCameraProjectionValues=new jr,this.mode=ai.ANIMATING,this._cssCamera=new jr,this._camera=new jr,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.constraints=new iy({state:this}),this.events=new ws,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}reset(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new ov({camera:jr},this)}destroy(){this.cameraController=null,this._propertiesPool?.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===Be.Global){const e=gr(this.spatialReference).radius;this.camera=new jr({eye:Le(4*e,0,0),center:Le(e,0,0),up:Le(0,0,1)})}else this.camera=new jr({eye:Le(0,0,100),center:Le(0,0,0),up:Le(0,1,0)})}get animation(){return this.cameraController instanceof d3&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:i,width:r,pixelRatio:s}=this.camera;return e.pixelRatio=1,e.height=Math.round(i/s),e.width=Math.round(r/s),e}get camera(){return this._camera}set camera(e){e!==xh&&xh.copyFrom(e),xh.computeUp(this.viewingMode),this.events.emit("before-camera-change",xh);const i=this._camera;if(ATt(this._lastSeenCameraProjectionValues,xh)&&(this._lastSeenCameraProjectionValues.copyFrom(xh),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!i.equals(xh)&&(this._camera=this._propertiesPool.get("camera").copyFrom(xh),this._cameraChanged=!i.almostEquals(xh),this._cameraChanged)){const r=dxe(()=>{this._cameraChanged=!1,r.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===ai.IDLE}get updating(){return this.mode!==ai.IDLE}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=e!=null?e.clone():null}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===Be.Global}get isLocal(){return this.viewingMode===Be.Local}get viewingMode(){return QZ(this.view.viewingMode)}get spatialReference(){return this.view.spatialReference}get highlights(){const e=this.view.highlights.items.slice(0,PKe);for(let i=0;i<e.length;){const r=e[i],s=e.findIndex(n=>n.name===r.name);s>=0&&i>s?e.splice(i,1):++i}return e}get highlightOrderMap(){const e=new Map;return this.highlights.forEach((i,r)=>e.set(i.name,r)),e}get navigating(){return!!this.cameraController?.isInteractive}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(this.cameraController?.destroy(),e&&(this.removeHandles(Fge),this.addHandles(gn(()=>e.state===Vr.Finished||e.state===Vr.Stopped,()=>{this._set("cameraController",null),this.updateCamera(i=>e.onControllerEnd(i))},{sync:!0,once:!0}),Fge),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=Vr.Rejected)}switchCameraController(e){this.cameraController=e}stopActiveCameraController(){return!this.cameraController||this.cameraController.stopController()}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();xh.copyFrom(this._get("camera")),e(xh),this.camera=xh,this._processingUpdates=!1,this._processUpdateQueue()}};u([p({constructOnly:!0})],ls.prototype,"view",void 0),u([p()],ls.prototype,"mode",void 0),u([p({readOnly:!0,type:cv})],ls.prototype,"animation",null),u([p({type:jr})],ls.prototype,"cssCamera",null),u([p()],ls.prototype,"_cssCamera",void 0),u([p({type:jr})],ls.prototype,"camera",null),u([p()],ls.prototype,"_camera",void 0),u([p({readOnly:!0})],ls.prototype,"pixelRatio",null),u([p()],ls.prototype,"rasterPixelRatio",void 0),u([p()],ls.prototype,"contentPixelRatio",void 0),u([p({readOnly:!0})],ls.prototype,"alignPixelEnabled",null),u([p({readOnly:!0})],ls.prototype,"updating",null),u([p({})],ls.prototype,"_contentCamera",void 0),u([p({type:jr})],ls.prototype,"contentCamera",null),u([p({readOnly:!0})],ls.prototype,"fixedContentCamera",null),u([p({readOnly:!0})],ls.prototype,"events",void 0),u([p({readOnly:!0})],ls.prototype,"isGlobal",null),u([p({readOnly:!0})],ls.prototype,"isLocal",null),u([p({readOnly:!0})],ls.prototype,"viewingMode",null),u([p({readOnly:!0})],ls.prototype,"highlights",null),u([p({readOnly:!0})],ls.prototype,"highlightOrderMap",null),u([p({readOnly:!0})],ls.prototype,"navigating",null),u([p({readOnly:!0})],ls.prototype,"stationary",null),u([p()],ls.prototype,"_cameraChanged",void 0),u([p()],ls.prototype,"cameraController",null),ls=u([A("esri.views.3d.state.ViewState")],ls);const $Tt=ls;function ATt(t,e){return t.fov!==e.fov||t.fullViewport[0]!==e.fullViewport[0]||t.fullViewport[1]!==e.fullViewport[1]||t.fullViewport[2]!==e.fullViewport[2]||t.fullViewport[3]!==e.fullViewport[3]||t.padding[si.TOP]!==e.padding[si.TOP]||t.padding[si.RIGHT]!==e.padding[si.RIGHT]||t.padding[si.BOTTOM]!==e.padding[si.BOTTOM]||t.padding[si.LEFT]!==e.padding[si.LEFT]}const xh=new jr,Fge="ViewStateHandles";function RNe(t){return t?LTt:NTt}function MTt(t,e){return e?.mode?e.mode:RNe(t).mode}function OTt(t,e){return e??RNe(t)}function PNe(t,e){return MTt(t==null||(t.hasZ??!1),e)}function Hsi(t,e){return OTt(t==null||(t.hasZ??!1),e)}function qsi(t){const e=LNe(t);return PNe(t.geometry,e)}function ITt(t){const e=LNe(t),i=PNe(t.geometry,e),r=e!=null&&i!=="on-the-ground"?FNe(e):0,s=e?.featureExpressionInfo;return{mode:i,offset:r,featureExpressionInfo:s}}function Wsi(t){return DNe(ITt(t))}function Zsi(t){return DNe(t)||RTt(t)}function RTt(t){return t?.featureExpressionInfo?.expression==="0"}function DNe(t){if(!t||t.mode==="on-the-ground")return!1;const e=t?.featureExpressionInfo?t.featureExpressionInfo.expression:null;return!(!e||e==="0")}function LNe(t){return t.layer&&"elevationInfo"in t.layer?t.layer.elevationInfo:null}function kne(t,e){if(!t?.offset)return 0;const{offset:i,unit:r}=t;if(r==="decimal-degrees")return 0;const s=r!=="unknown"&&r?r:"meters",n=p6e(e);return n?pr(i,s,n):0}function Ysi(t,e,i){if(!i?.mode)return;const r=t.hasZ?t.z:0,s=kne(i,t.spatialReference);switch(i.mode){case"absolute-height":return r-s;case"on-the-ground":return 0;case"relative-to-ground":return r-((e.elevationProvider.getElevation(t.x,t.y,r,t.spatialReference,"ground")??0)+s);case"relative-to-scene":return r-((e.elevationProvider.getElevation(t.x,t.y,r,t.spatialReference,"scene")??0)+s)}}function Jsi(t,e,i,r=null){return NNe(t,e.x,e.y,e.hasZ?e.z:0,e.spatialReference,i,r)}function Xsi(t,e,i,r,s=null){return NNe(t,e[0],e[1],e.length>2?e[2]:0,i,r,s)}function NNe(t,e,i,r,s,n,o=null){if(n==null)return;const a=o!=null?o.mode:"absolute-height";if(a==="on-the-ground")return 0;const{absoluteZ:l}=PTt(e,i,r,s,t,n);return DTt(l,e,i,r,s,t,o,a)}function PTt(t,e,i,r,s,n){const o=kne(n,r);switch(n.mode){case"absolute-height":return{absoluteZ:i+o,elevation:0};case"on-the-ground":{const a=s.elevationProvider.getElevation(t,e,0,r,"ground")??0;return{absoluteZ:a,elevation:a}}case"relative-to-ground":{const a=s.elevationProvider.getElevation(t,e,i,r,"ground")??0;return{absoluteZ:i+a+o,elevation:a}}case"relative-to-scene":{const a=s.elevationProvider.getElevation(t,e,i,r,"scene")??0;return{absoluteZ:i+a+o,elevation:a}}}}function DTt(t,e,i,r,s,n,o,a){const l=kne(o,s);switch(a){case"absolute-height":return t-l;case"relative-to-ground":return t-((n.elevationProvider.getElevation(e,i,r,s,"ground")??0)+l);case"relative-to-scene":return t-((n.elevationProvider.getElevation(e,i,r,s,"scene")??0)+l)}}function Ksi(t,e){if(e==null)return!1;const{mode:i}=e;return i!=null&&(t==="scene"&&i==="relative-to-scene"||t==="ground"&&i!=="absolute-height")}function Qsi(t,e,i){return i&&i.mode!==e?`${t} only support ${e} elevation mode`:null}function eni(t,e,i){return i?.mode===e?`${t} do not support ${e} elevation mode`:null}function tni(t,e){return e?.featureExpressionInfo!=null&&e.featureExpressionInfo.expression!=="0"?`${t} do not support featureExpressionInfo`:null}function ini(t,e){e&&t.warn(".elevationInfo=",e)}function FNe(t){return(t?.offset??0)*gIe(t?.unit)}const LTt={mode:"absolute-height",offset:0},NTt={mode:"on-the-ground",offset:null},FTt="OBJECTID";let rni=class extends RD{constructor(e,i,r,s){super(i,r),this.point=e,this.createGraphic=s}};function kNe(t){return ah(t)&&t.intersector===Zr.PCL&&!!t.target}let nni=class extends tRe{constructor(e,i,r,s,n){super(e),this.layerUid=e,this.sublayerUid=i,this.nodeIndex=r,this.componentIndex=s,this.triangleNr=n}},ani=class extends RD{constructor(e,i,r){super(i,null),this.point=e,this.createVoxelGraphic=r}},cni=class extends RD{constructor(e,i){super(e,null),this.createTiles3DGraphic=i}};function wG(t){return ah(t)&&t.intersector===Zr.I3S&&!!t.target}function zNe(t){return ah(t)&&t.intersector===Zr.VOXEL&&!!t.target}function kTt(t){return ah(t)&&t.intersector===Zr.TILES3D&&!!t.target}function zTt(t){return ah(t)&&t.intersector===Zr.TERRAIN&&!!t.target}let UTt=class extends RD{constructor(e,i,r){super(e,i),this.triangleNr=r}};function UNe(t){return ah(t)&&t.intersector===Zr.OVERLAY&&!!t.target}function BNe(t,e){return Dj(t)||Lj(t)?x3(t.target?.object,e):zTt(t)?e.map?.ground:kNe(t)||wG(t)||UNe(t)||zNe(t)?x3(t.target,e):null}function dni(t,e){const i=zne(t,e);return i!=null&&i.type==="graphic"?i.graphic:null}function zne(t,e){if(t==null)return null;if(Dj(t)||Lj(t))return kge(t.target?.object,e);if(kNe(t)){const i=t.target.createGraphic();return{type:"graphic",graphic:i,layer:i.layer}}if(zNe(t)){const i=t.target.createVoxelGraphic();return{type:"graphic",graphic:i,layer:i.layer}}if(kTt(t)){const i=t.target.createTiles3DGraphic();return{type:"graphic",graphic:i,layer:i.layer}}return UNe(t)||Dre(t)?kge(t.target,e):wG(t)?BTt(t.target,e):null}function kge(t,e){if(t?.graphicUid==null)return null;const i=x3(t,e);if(i==null)return null;if(i===e.graphics)return e.graphicsView==null||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const r=e.allLayerViews.find(s=>s.layer===i);return!r||r.suspended||t.graphicUid==null?null:"getHit"in r?r.getHit(t.graphicUid):null}function BTt(t,e){const i=x3(t,e);if(i==null)return null;const r=e.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getGraphicFromIntersectorTarget"in r?jTt(r.getGraphicFromIntersectorTarget(t)):null}function VTt(t,e){const i=x3(t,e);if(i==null)return null;const r=e.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getAABBFromIntersectorTarget"in r?r.getAABBFromIntersectorTarget(t):null}function jTt(t){return t!=null?{type:"graphic",graphic:t,layer:t.layer}:null}function x3(t,e){return t?.layerUid==null?null:e.graphicsView!=null&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.allLayers.find(i=>i.uid===t.layerUid)}function pni(t,e){if(Dj(t)||Lj(t))return Nm(t.target.object.boundingVolumeWorldSpace.bounds);if(Dre(t)){O2e(vF,t.transformation);const i=Math.max(vF[0],vF[1],vF[2]);return t.target.baseBoundingSphere.radius*i}if(wG(t)){const i=VTt(t.target,e);return i?.5*aXe(i):null}return null}function fni(t){return!Dj(t)&&!Lj(t)&&(Dre(t)?t.target.numLodLevels>1:!!wG(t))}const vF=$();async function GTt(t,e,i,r){const s=i?GNe(t,i):r,n=nn(e.x,e.y);s.requiresGroundFeedback=!0,s.enableDraped=!0;const o=lh(t.state.viewingMode);o.options.selectionMode=!0,o.options.store=Eo.ALL,t.sceneIntersectionHelper.intersectIntersectorScreen(n,o,s);const a=qTt(t,o.results.all,s.graphics),l=o.results.ground,c=BNe(l,t),h=c!=null&&"type"in c&&NP(c.type)?c:null,d={screenPoint:e,results:a,ground:{mapPoint:iC(t,l),distance:ah(l)?l.distanceInRenderSpace:0,layer:h}};return bs.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(d.intersector=o),d}function HTt(t,e,i,r){const s=i?GNe(t,i):r,n=!(!s.graphics?.include&&!s.graphics?.exclude),o=!(!s.mediaElements?.include&&!s.mediaElements?.exclude),a=jp(e);s.enableDraped=s.include&&!s.include.has(Ob)||s.exclude?.has(Ob);const l=t.sceneIntersectionHelper,c=lh(t.state.viewingMode);if(c.options.selectionMode=!0,c.options.store=n||o?Eo.ALL:Eo.MIN,c.options.excludeLabels=i?.excludeLabels??!1,l.intersectIntersectorScreen(a,c,s),n||o){for(const h of c.results.all){const d=zne(h,t);if(d==null||n&&(d.type!=="graphic"||VNe(s.graphics,d.graphic))||o&&(d.type!=="media"||jNe(s.mediaElements,d.element)))return iC(t,h)}return null}return iC(t,c.results.min)}function qTt(t,e,i){const r=new Array;let s=null;for(let n=0;n<e.length;n++){const o=e[n],a=BNe(o,t);if(a!=null&&(a===t.map.ground||"type"in a&&NP(a.type)))break;const l=zne(o,t);if(l==null)continue;if(l.type==="graphic"){if(s==null&&n!==e.length-1&&(s=new Set),s!=null){const d=Une(l.graphic);if(s.has(d))continue;s.add(d)}if(!VNe(i,l.graphic))continue}const c=iC(t,o),h=o.distanceInRenderSpace;if(l.type==="media"){const d=l.element.toSource(c);r.push({...l,mapPoint:c,distance:h,sourcePoint:d})}else r.push({...l,mapPoint:c,distance:h})}return r}function iC(t,e,i){return e.getIntersectionPoint(rC)?(i=vX(t,rC,i),e.intersector===Zr.TERRAIN&&t.basemapTerrain&&(i.z=Tm(t.basemapTerrain,i)??0),i):null}function Une(t){const e=t.sourceLayer,i=t.layer,r=e&&"objectIdField"in e?e:i&&"objectIdField"in i?i:e;if(r){const s=r.objectIdField??FTt,n=t.attributes?.[s];if(n)return`o-${r.id}-${n}`}return`u-${t.uid}`}function VNe(t,e){return jNe(t,Une(e))}function jNe(t,e){return t==null||(t.include==null||t.include.has(e))&&(t.exclude==null||!t.exclude.has(e))}function vX(t,e,i){let r=t.spatialReference||Ae.WGS84;return mc(e,t.renderSpatialReference,rC,r)?e=rC:(r=Ae.WGS84,mc(e,t.renderSpatialReference,rC,r)&&(e=rC)),i?(i.x=e[0],i.y=e[1],i.z=e[2],i.spatialReference=r):i=new ke(e,r),i}function GNe(t,e){const i=_X(t,e.include,J$.INCLUDE),r=_X(t,e.exclude,J$.EXCLUDE);return{include:i.layerUids,exclude:r.layerUids,graphics:{include:i.graphicUids,exclude:r.graphicUids},mediaElements:{include:i.mediaElements,exclude:r.mediaElements}}}function _X(t,e,i,r={layerUids:void 0,graphicUids:void 0,mediaElements:void 0}){if(!e)return r;if(e instanceof Ml)WTt(r,Une(e)),i===J$.INCLUDE&&(t.graphicsView!=null&&e.layer===t?VT(r,t.graphicsView.processor.layer.id):e.layer&&VT(r,e.layer.uid));else if("layer"in e&&"element"in e)ZTt(r,e.element),i===J$.INCLUDE&&VT(r,e.layer.uid);else if(wP(e))for(const s of e)s===t.graphics&&t.graphicsView!=null?VT(r,t.graphicsView.processor.layer.id):s===t.map.ground?VT(r,Ob):_X(t,s,i,r);else"uid"in e&&VT(r,e.uid);return r}function VT(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function WTt(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}function ZTt(t,e){t.mediaElements||(t.mediaElements=new Set),t.mediaElements.add(e)}const rC=$();var J$;(function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"})(J$||(J$={}));let YTt=class{constructor(e,i,r){this.viewingMode=e,this._forEachLayer=i,this._view=r,this._externalIntersectionHandlers=new Jt,this._tolerance=z$,this._tmpRay=Pn(),this._tmpRegion=Qt(),this._validateHUDIntersector=lh(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,i,r){return this.intersectRay(this._getPickRay(e,this._tmpRay),zge(this.viewingMode),i,r)}intersectScreenFreePointFallback(e,i,r){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),i,r)}intersectRayFreePointFallback(e,i,r){return this.intersectRay(e,zge(this.viewingMode),i,r)||this._intersectRayFreePointLocal(e,i)}intersectRay(e,i,r,s){return i.options.selectionMode=!1,i.options.store=Eo.MIN,this.computeIntersection(e,i,s),!!i.results.min&&i.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(e,i,r=.5,s=.5){return e.getRenderCenter(bF,r,s),bF[0]+=.0466,bF[1]-=.0123,gne(e,bF,i)}intersectIntersectorScreen(e,i,r){this.computeIntersection(this._getPickRay(e,this._tmpRay),i,r)}intersectToolIntersectorScreen(e,i,r){const s=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(s,i,r)}intersectToolIntersectorRay(e,i,r){i.options.selectionMode=!0,this.computeIntersection(e,i,r);const s=i.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||ah(s)&&s.intersector!==Zr.TERRAIN||(i.options.selectionMode=!1,this.computeIntersection(e,i,r))}setTolerance(e=z$){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((i,r)=>i.type===Zr.TERRAIN?1:r.type===Zr.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((i,r)=>i.type===Zr.TERRAIN?1:r.type===Zr.TERRAIN?-1:0)}_getPickRay(e,i){const r=this._view.state.camera;return mne(r,e,i)}_intersectRayFreePointLocal(e,i){return this.viewingMode!==Be.Local||e==null||oe(i,e.origin,ae(Ne.get(),e.direction)),!1}intersectElevationFromScreen(e,i,r=0,s=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),i,r,s)}_intersectElevation(e,i,r=0,s=null){if(e==null)return null;const n=this._view,{renderCoordsHelper:o}=n,a=Yx(n.spatialReference),l=i!=null?i.mode:"absolute-height",c=FNe(i)/a,h=(l!=="on-the-ground"?c+r:0)*a/o.unitInMeters,{camera:d}=n.state;if(l==="absolute-height"){const S=o?.getAltitude(d.eye),C=de(ae(WM,e.direction),o.worldUpAtPosition(d.eye,KTt));if(S<h&&C<0||S>=h&&C>0)return null;if(o.intersectInfiniteManifold(e,h,WM)){const T=vX(n,WM);return T.z??=0,T.z-=c,T}return null}const f=Ne.get();d.projectToRenderScreen(e.origin,f);const m=new Uge(null,this._forEachLayer),{slicePlane:y}=n,v=y!=null?Dde(y):null,_=lh(this.viewingMode);_.options.store=Eo.MIN,_.options.verticalOffset=h,_.options.normalRequired=!1;const b=e.origin,w=oe(Ne.get(),b,e.direction);_.reset(b,w,d),_.point=f;const x=s?"type"in s&&s.type==="graphics"?S=>S.layerUid!==s.uid:S=>S.graphicUid!==s.uid:null;switch(l){case"relative-to-scene":{const S=C=>(!x||x(C))&&!!C.lastValidElevationBB;_.intersect(m.layers,f,this._tolerance,null,S),this._externalIntersectionHandlers.forAll(C=>{if(C.type===Zr.I3S||C.type===Zr.TERRAIN||C.type===Zr.TILES3D){const T=C.slicePlaneEnabled?v:null;C.intersect(_,T,_.rayBegin,_.rayEnd,f)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(S=>{if(S.isGround){const C=S.slicePlaneEnabled?v:null;S.intersect(_,C,_.rayBegin,_.rayEnd,f)}})}if(_.results.min.getIntersectionPoint(WM)){const S=vX(n,WM);return S.z=r,S}return null}computeIntersection(e,i,r,s){if(e==null)return;const n=this._view.state.camera,o=Ne.get();n.projectToRenderScreen(e.origin,o);const a=new Uge(r,this._forEachLayer);i.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);const l=e.origin,c=oe(Ne.get(),e.origin,e.direction);i.reset(l,c,n),i.intersect(a.layers,o,this._tolerance);const h=this._view.slicePlane,d=h!=null?Dde(h):null;i.intersect(a.sliceableLayers,o,this._tolerance,d);const f=r&&(r.requiresGroundFeedback||r.enableDraped);this._externalIntersectionHandlers.forAll(v=>{const _=v.layerUid,b=Array.isArray(_),w=b?_:[_];b&&(i.options.filteredLayerUids=[]);let x=!1;for(const S of w)a.filterLayerUid(S)?x=!0:b&&i.options.filteredLayerUids.push(S);if(i.options.isFiltered=!x,v.isGround&&f||!i.options.isFiltered){const S=v.slicePlaneEnabled?d:null;v.intersect(i,S,l,c,o,s)}});const m=Ne.get(),y=this._view.basemapTerrain;if(r&&r.enableDraped&&y.spatialReference!=null&&i.results.ground.getIntersectionPoint(m)){const v=y.overlayManager.renderer,_=this._view.renderCoordsHelper.spatialReference,b=Ne.get();this._view.renderCoordsHelper.fromRenderCoords(m,b,y.spatialReference),b[2]=this._view.elevationProvider?.getElevation(m[0],m[1],m[2],_,"ground")??0,v.intersect(i,b,i.results.ground,w=>a.filterRenderGeometry(w))}i.sortResults(),this._processHUDResults(i)}_processHUDResults(e){const i=e.results.hud;_b(this._tmpRegion,B7);const r=this._view.state.camera,s=[],n=this._tmpRegion,o=b=>{const w=new XTt(b),x=w.result.target.object.geometries.every(S=>S.material instanceof Tne&&S.material.parameters.occlusionTest);s.push({item:w,occlusionTest:x}),x&&(r.projectToRenderScreen(b.target.center,w.screenPoint),w.screenPoint[0]=Math.floor(w.screenPoint[0]),w.screenPoint[1]=Math.floor(w.screenPoint[1]),iHe(n,w.screenPoint))};e.sortResults(i.all),i.min.dist!=null&&o(i.min);for(const b of i.all)i.min.target.object!==b.target.object&&i.max.target.object!==b.target.object&&o(b);if(i.max.dist!=null&&i.max.target.object!==i.min.target.object&&o(i.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=r.fullWidth,l=r.fullHeight,c=Math.max(0,n[0]-TI),h=Math.max(0,n[1]-TI),d=Math.min(Zo(n)+2*TI,a-c),f=Math.min(wl(n)+2*TI,l-h),m=d>0&&f>0?new Uint8Array(d*f*4):null;m&&this._view._stage.renderer.readHUDVisibility(c,h,d,f,m);let y=!0;const v=e.results.max.dist==null;let _=0;for(const{item:b,occlusionTest:w}of s){let x=!w;if(w&&m)for(const S of JTt){const C=4*(Math.min(b.screenPoint[0]+S[0],a)-n[0]+(Math.min(b.screenPoint[1]+S[1],l)-n[1])*d);if(C>=0&&C<m.length&&m[C]){x=!0;break}}x&&(y&&(e.results.min.copy(b.result),y=!1),v&&e.results.max.copy(b.result),e.options.store===Eo.ALL&&e.results.all.splice(_++,0,b.result))}}};const TI=1,JTt=(()=>{const t=[],e=TI;for(let i=-1;i<=e;i++)for(let r=-1;r<=e;r++)t.push([r+e,i+e]);return t})();let XTt=class{constructor(e){this.result=e,this.screenPoint=Wp()}},_F;function zge(t){return _F&&_F.viewingMode===t||(_F=lh(t)),_F}let Uge=class{constructor(e,i){this.layers=new Array,this.sliceableLayers=new Array,this.include=e?.include,this.exclude=e?.exclude,i(r=>{r.pickable&&this.filterLayerUid(r.apiLayerUid)&&(r.sliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerUid(e){const{include:i,exclude:r}=this;return e==null?i==null&&r==null:(i==null||i.has(e))&&(r==null||!r.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function Bge(t){return typeof t=="object"&&"intersect"in t}const WM=$(),KTt=$(),bF=Wp();let vni=class{constructor(e,i){this.spatialReference=e,this._view=i}getElevation(e,i,r){return this._view.elevationProvider.getElevation(e,i,0,this.spatialReference,r)}async queryElevation(e,i,r,s,n){return this._view.elevationProvider.queryElevation(e,i,0,this.spatialReference,n,r,s)}},QTt=class{constructor(e,i,r,s){this.spatialReference=i,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...s,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(at.ELEVATION_QUERY,this)}destroy({completeTasks:e}={completeTasks:!1}){if(this._frameTask.remove(),this.running)if(e)this.runTask(Wc);else for(const i of this._queries)i.result.reject(vi())}queryElevation(e,i,r,s=0){const n=Qo(),o={x:e,y:i,minDemResolution:s,result:n,signal:r};return this._queries.push(o),Xo(r,()=>{U3(this._queries,o),n.reject(vi())}),n.promise}get running(){return this._queries.length>0}runTask(e){const i=this._queries;this._queries=[];const r=this._getElevationQueryProvider();if(!r)return i.forEach(h=>h.result.reject()),void e.madeProgress();const s=i.map(h=>[h.x,h.y]),n=i.reduce((h,d)=>Math.min(h,d.minDemResolution),1/0),o=new CS({points:s,spatialReference:this.spatialReference}),a=i.length>1&&i.some(h=>!!h.signal)?new AbortController:null,l=a!=null?a.signal:i[0].signal;if(a!=null){let h=0;i.forEach(d=>Xo(d.signal,()=>{h++,d.result.reject(vi()),h===i.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:n,signal:l};r.queryElevation(o,c).then(h=>{i.forEach((d,f)=>{d.signal!=null&&d.signal.aborted?d.result.reject(vi()):d.result.resolve(h.geometry.points[f][2])})}).catch(h=>{i.forEach(d=>d.result.reject(h))}),e.madeProgress()}get test(){}},mB=class{constructor(e=1/0,i=-1/0){this.elevationRangeMin=e,this.elevationRangeMax=i}get elevationRangeValid(){return!Number.isNaN(this.elevationRangeMin)}invalidateElevationRange(){this.elevationRangeMin=NaN}expandElevationRangeValues(e,i){this.elevationRangeMin=Math.min(this.elevationRangeMin,e),this.elevationRangeMax=Math.max(this.elevationRangeMax,i)}expandElevationRange(e){this.elevationRangeMin=Math.min(this.elevationRangeMin,e.elevationRangeMin),this.elevationRangeMax=Math.max(this.elevationRangeMax,e.elevationRangeMax)}setElevationRange(e){this.elevationRangeMin=e.elevationRangeMin,this.elevationRangeMax=e.elevationRangeMax}},EI=class extends ws.EventedMixin(ue){get spatialReference(){return this.view?.basemapTerrain?.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this.lastElevationQuery=null,this._cacheEnabled=!1}destroy(){this._cachedQuery=Ce(this._cachedQuery)}enableCache(e){e||(this.lastElevationQuery=null),this._cacheEnabled=e}getElevation(e,i,r,s,n){if(this._cacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&i===a.y&&r===a.z&&rs(s,a.spatialReference)&&n===a.queryContext)return a.result}let o=null;return o=wF(o,this._im,e,i,r,s,n),o==null&&(o=wF(o,this._ground,e,i,r,s,n)),n==="scene"&&(o=wF(o,this._scene,e,i,r,s,n)),this._cacheEnabled&&(this.lastElevationQuery={x:e,y:i,z:r,spatialReference:s,queryContext:n,result:o}),o}getSphereElevationBounds(e,i,r){const s=new mB;function n(o){for(const a of o)if(a.getSphereElevationBounds){const l=a.getSphereElevationBounds(e,i,r);l!=null&&s.expandElevationRangeValues(l.elevationRangeMin,l.elevationRangeMax)}}return n(this._ground),n(this._im),r==="scene"&&n(this._scene),s}getRootElevationBounds(){const e=new mB;for(const i of[this._im,this._ground,this._scene])i.forEach(r=>{if(r.getRootElevationBounds){const s=r.getRootElevationBounds();s!=null&&e.expandElevationRangeValues(s.elevationRangeMin,s.elevationRangeMax)}});return e}async queryElevation(e,i,r,s,n,o=null,a=0){const l=this._getElevationQuery(s);try{const c=await l.queryElevation(e,i,o,a);return n==="scene"?wF(c,this._scene,e,i,r,s,n):c}catch(c){return Vc(c),this.getElevation(e,i,r,s,n)}}register(e,i){this.addHandles(i.on("elevation-change",r=>this.emit("elevation-change",r)),i),this._providersFromContext(e).push(i)}unregister(e){this.removeHandles(e);for(const i of[this._im,this._ground,this._scene]){const r=i.indexOf(e);r>-1&&i.splice(r,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}_getElevationQuery(e=this.view.spatialReference){const i=this._cachedQuery;if(i!=null&&rs(e,i.spatialReference))return i;i?.destroy({completeTasks:!0});const{wkid:r,wkt:s,wkt2:n,latestWkid:o}=e,a=new QTt(this.view.resourceController.scheduler,new Ae({wkid:r,wkt:s,wkt2:n,latestWkid:o}),()=>this.view.map?.ground,{maximumAutoTileRequests:4});return this._cachedQuery=a,a}};function wF(t,e,i,r,s,n,o){for(const a of e){const l=a.getElevation(i,r,s,n,o);l!=null&&(t=t!=null?Math.max(l,t):l)}return t}u([p({constructOnly:!0})],EI.prototype,"view",void 0),u([p()],EI.prototype,"spatialReference",null),EI=u([A("esri.views.3d.support.CombinedElevationProvider")],EI);let kx=class bX{static isValidProfile(e){return e in bX.profiles}static getDefaultProfile(){return X("esri-iPhone")?"low":"medium"}static apply(e,i){const r=bX.profiles[e];i.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,i.graphics3D.maxNumberOfDrawCalls=r.graphics3D.maxNumberOfDrawCalls,i.graphics3D.maxTotalNumberOfVertices=r.graphics3D.maxTotalNumberOfVertices,i.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,i.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor,i.graphics3D.snapshotAvailable=r.graphics3D.snapshotAvailable,i.graphics3D.skipHighSymbolLods=r.graphics3D.skipHighSymbolLods,i.graphics3D.uncompressedTextureDownsamplingEnabled=r.graphics3D.uncompressedTextureDownsamplingEnabled;const s=i.sceneService.object,n=r.sceneService.object;s.lodFactor=n.lodFactor,i.sceneService.point.lodFactor=r.sceneService.point.lodFactor,i.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,i.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,i.sceneService.uncompressedTextureDownsamplingEnabled=r.sceneService.uncompressedTextureDownsamplingEnabled,i.tiledSurface.lodBias=r.tiledSurface.lodBias,i.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,i.tiledSurface.vtlContentZoom=r.tiledSurface.vtlContentZoom,i.tiledSurface.elevationLevelDelta=r.tiledSurface.elevationLevelDelta,i.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,i.heatmap.pixelRatio=r.heatmap.pixelRatio,i.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures,i.fadeDuration=r.fadeDuration,i.antialiasingEnabled=r.antialiasingEnabled,i.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,i.highQualityTransparency=r.highQualityTransparency,i.highResolutionAtmosphere=r.highResolutionAtmosphere,i.reflections=r.reflections,i.ambientOcclusion=r.ambientOcclusion,i.memoryLimit=r.memoryLimit,i.additionalCacheMemory=r.additionalCacheMemory,i.frameRate=r.frameRate,i.maximumPixelRatio=r.maximumPixelRatio}};kx.test={reset(){const t=HNe();for(const e of Object.keys(t))kx.profiles[e]=t[e]}};const ZM={IPhone12Pro:120,GalaxyS20:200,FullHD:240,SurfacePro7:300,FullHDRetina:430};function HNe(){const t=!!X("esri-mobile"),e=!!X("ios"),i=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxNumberOfDrawCalls:8e3,maxTotalNumberOfVertices:255e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0,uncompressedTextureDownsamplingEnabled:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,vtlContentZoom:.75,elevationLevelDelta:3,reduceTileLevelDifferences:!0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200+ZM.IPhone12Pro,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:625e4,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:t},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:13e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:3,reduceTileLevelDifferences:!X("disable-feature:reduce-map-tile-levels")},fadeDuration:i,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:t?600+ZM.GalaxyS20:750+ZM.FullHD,additionalCacheMemory:t?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:125e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:23e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:2,reduceTileLevelDifferences:!X("disable-feature:reduce-map-tile-levels")},fadeDuration:i,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:t?900+ZM.SurfacePro7:1500+ZM.FullHDRetina,additionalCacheMemory:t?-150:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}(function(t){t.profiles=HNe()})(kx);var Lt;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})(Lt||(Lt={}));const HE=[Lt.ELEVATION,Lt.MAP];async function eEt(t,e){if(t.type==="2d")return t.hitTest(e);const i=await t.hitTest(e);if(i.results.length===0)return i;const r=i.results[0],s=(r.distance??0)*(1+tEt),n=i.results.findIndex(o=>(o.distance??0)>s);return n!==-1&&(i.results=i.results.slice(0,n)),r&&i.ground.distance>s&&(i.ground.mapPoint=null),i}const tEt=.05;function iEt(t){return t?.type==="graphic"}function Sni(t){return t.find(iEt)??null}async function rEt(t,e){const{results:i,ground:r}=await eEt(t,e),s=(!r.layer||!NP(r.layer.type))&&r.mapPoint,n=[],o=oEt(t),a=s?sEt(t,o):nEt;let l=0,c=0;const h=()=>{const f=a.layerViews[c];s&&f&&"fetchPopupFeaturesAtLocation"in f&&n.push({mapPoint:r.mapPoint,layerView:f}),++c};let d=null;for(;l<i.length||c<a.layerViews.length;){const f=i[l];if(f&&f.type!=="graphic")++l;else if(f?.layer?.type!=="scene"||f?.layer?.parent!==t?.map?.basemap)if(f){const m=f.layer?.uid,y=a.layerUids.has(m)&&f.distance===r.distance,v=o.get(f.layer?.uid);if(d??=f.mapPoint,c<a.layerViews.length&&(y||(f.distance??0)>r.distance)&&a.layerViews[c]!==v){h();continue}n.push({graphic:f.graphic,layerView:v}),++l}else h();else++l}return d??=r.mapPoint,{hits:n,location:d}}function sEt(t,e){const i=new Set,r=[];for(let n=t.basemapTerrain.numLayers(Lt.MAP)-1;n>=0;n--){const o=t.basemapTerrain.layerViewByIndex(n,Lt.MAP);i.add(o.layer.uid),r.push(o)}const s=t.basemapTerrain.overlayManager.renderer.layers;for(const{uid:n}of s){const o=e.get(n);o&&(i.add(n),r.push(o))}return r.reverse(),{layerUids:i,layerViews:r}}const nEt={layerUids:new Set,layerViews:[]};function oEt(t){const e=new Map;for(const i of t.allLayerViews){const r=i.layer.uid;e.set(r,i)}return e}let Nu=class extends ue{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxNumberOfDrawCalls=17e3,this.maxTotalNumberOfVertices=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1,this.uncompressedTextureDownsamplingEnabled=!1}};u([p()],Nu.prototype,"minTotalNumberOfFeatures",void 0),u([p()],Nu.prototype,"maxTotalNumberOfFeatures",void 0),u([p()],Nu.prototype,"maxNumberOfDrawCalls",void 0),u([p()],Nu.prototype,"maxTotalNumberOfVertices",void 0),u([p()],Nu.prototype,"snapshotAvailable",void 0),u([p()],Nu.prototype,"polygonLodFactor",void 0),u([p()],Nu.prototype,"polylineLodFactor",void 0),u([p()],Nu.prototype,"skipHighSymbolLods",void 0),u([p()],Nu.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Nu=u([A("esri.views.3d.support.QualitySettings.Graphics3DSettings")],Nu);let Yp=class extends ue{constructor(){super(...arguments),this.lodFactor=1}};u([p()],Yp.prototype,"lodFactor",void 0),Yp=u([A("esri.views.3d.support.QualitySettings.LoDFactorSettings")],Yp);let Sy=class extends ue{constructor(){super(...arguments),this.object=new Yp,this.point=new Yp,this.integratedMesh=new Yp,this.pointCloud=new Yp,this.uncompressedTextureDownsamplingEnabled=!1}};u([p({type:Yp})],Sy.prototype,"object",void 0),u([p({type:Yp})],Sy.prototype,"point",void 0),u([p({type:Yp})],Sy.prototype,"integratedMesh",void 0),u([p({type:Yp})],Sy.prototype,"pointCloud",void 0),u([p()],Sy.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Sy=u([A("esri.views.3d.support.QualitySettings.SceneServiceSettings")],Sy);let Ty=class extends ue{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.vtlContentZoom=1,this.elevationLevelDelta=3,this.reduceTileLevelDifferences=!0}};u([p()],Ty.prototype,"lodBias",void 0),u([p()],Ty.prototype,"angledSplitBias",void 0),u([p()],Ty.prototype,"vtlContentZoom",void 0),u([p()],Ty.prototype,"elevationLevelDelta",void 0),u([p()],Ty.prototype,"reduceTileLevelDifferences",void 0),Ty=u([A("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],Ty);let sC=class extends ue{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};u([p()],sC.prototype,"pixelRatio",void 0),u([p()],sC.prototype,"maxTotalNumberOfFeatures",void 0),sC=u([A("esri.views.3d.support.QualitySettings.HeatmapSettings")],sC);let sa=class extends ue{constructor(){super(...arguments),this.graphics3D=new Nu,this.sceneService=new Sy,this.tiledSurface=new Ty,this.heatmap=new sC,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};u([p({type:Nu})],sa.prototype,"graphics3D",void 0),u([p({type:Sy})],sa.prototype,"sceneService",void 0),u([p({type:Ty})],sa.prototype,"tiledSurface",void 0),u([p({type:sC})],sa.prototype,"heatmap",void 0),u([p()],sa.prototype,"fadeDuration",void 0),u([p()],sa.prototype,"antialiasingEnabled",void 0),u([p()],sa.prototype,"physicallyBasedRenderingEnabled",void 0),u([p()],sa.prototype,"highQualityTransparency",void 0),u([p()],sa.prototype,"highResolutionAtmosphere",void 0),u([p()],sa.prototype,"reflections",void 0),u([p()],sa.prototype,"ambientOcclusion",void 0),u([p()],sa.prototype,"memoryLimit",void 0),u([p()],sa.prototype,"additionalCacheMemory",void 0),u([p()],sa.prototype,"frameRate",void 0),u([p()],sa.prototype,"maximumPixelRatio",void 0),sa=u([A("esri.views.3d.support.QualitySettings")],sa);const Vge=sa;let aEt=class wX{constructor(e,i,r,s){this.viewingMode=e,this.spatialReference=i,this.unitInMeters=r,this._coordinateSystem=s,this._tmpCoordinateSystem=Dat(s),this.referenceEllipsoid=gr(i),this.sphericalPCPF=$b(i)}set extent(e){e&&Lat(this._coordinateSystem,e,this._coordinateSystem)}get extent(){return Nat(this._coordinateSystem,Qt())}getAltitude(e){return Gat(this._coordinateSystem,e)}setAltitude(e,i,r=e){return nIe(this._coordinateSystem,r,i,e)}setAltitudeOfTransformation(e,i){Hat(this._coordinateSystem,i,e,i)}worldUpAtPosition(e,i){return Uat(this._coordinateSystem,e,i)}worldBasisAtPosition(e,i,r){return Bat(this._coordinateSystem,e,i,r)}basisMatrixAtPosition(e,i){const r=this.worldBasisAtPosition(e,Qr.X,Ne.get()),s=this.worldBasisAtPosition(e,Qr.Y,Ne.get()),n=this.worldBasisAtPosition(e,Qr.Z,Ne.get());return lg(i,r[0],r[1],r[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),i}headingAtPosition(e,i){const r=this.worldUpAtPosition(e,Ne.get()),s=this.worldBasisAtPosition(e,Qr.Y,Ne.get()),n=POe(i,s,r);return $o(n)}intersectManifoldClosestSilhouette(e,i,r){return TH(this._coordinateSystem,i,this._tmpCoordinateSystem),jat(this._tmpCoordinateSystem,e,r),r}intersectManifold(e,i,r){TH(this._coordinateSystem,i,this._tmpCoordinateSystem);const s=Ne.get();return Vat(this._tmpCoordinateSystem,e,s)?ne(r,s):null}intersectInfiniteManifold(e,i,r){if(this.viewingMode===Be.Global)return this.intersectManifold(e,i,r);TH(this._coordinateSystem,i,this._tmpCoordinateSystem);const s=this._tmpCoordinateSystem.value,n=Ne.get();return RA(s.plane,e,n)?ne(r,n):null}toRenderCoords(e,i,r){return PU(e)?pc(e,i,this.spatialReference):mc(e,i,r,this.spatialReference)}fromRenderCoords(e,i,r=null){return PU(i)?(r!=null&&(i.spatialReference=r),HS(e,this.spatialReference,i)?i:null):mc(e,this.spatialReference,i,r)?i:null}static create(e,i){switch(e){case Be.Local:return new wX(Be.Local,i,Ao(i),zat());case Be.Global:return new wX(Be.Global,i,1,kat(i))}}static renderUnitScaleFactor(e,i){return Ole(e)/Ole(i)}};var xm;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})(xm||(xm={}));const lEt=(()=>{const t=new Array;return t[xm.ELEVATION]=10,t[xm.BASEMAP]=10,t[xm.I3S_INDEX]=10,t[xm.I3S_DATA]=10,t[xm.SYMBOLOGY]=5,t})(),cEt=30,xX=-3,qNe=xX-1;var Dp;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})(Dp||(Dp={}));let uEt=class{constructor(e,i,r,s=0){this.name=e,this._storage=i,this._defaultPriority=s,this.id=hEt+++":",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),r&&(this._storage.registerRemoveFunc(this.id,r),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(e){return this._storage.getSize(this,e)}resetHitRate(){this._hit=this._miss=0}put(e,i,r=this._defaultPriority){this._storage.put(this,e,i,i.cachedMemory,r)}pop(e){const i=this._storage.pop(this,e);return i===void 0?++this._miss:++this._hit,i}get(e){const i=this._storage.get(this,e);return i===void 0?++this._miss:++this._hit,i}peek(e){return this._storage.peek(this,e)}updateSize(e,i){this._storage.updateSize(this,e,i,i.cachedMemory)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}},WNe=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new Jt,this._users=new Jt}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear()}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,i){this._removeFuncs.push([e,i])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(i=>i[0]!==e)}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,i){return this._db.get(e.id+i)?.size??0}put(e,i,r,s,n){i=e.id+i;const o=this._db.get(i);if(o&&(this._size-=o.size,e.size-=o.size,this._db.delete(i),o.entry!==r&&this._notifyRemove(i,o.entry,o.size,Dp.ALL)),s>this._maxSize)return void this._notifyRemove(i,r,s,Dp.ALL);if(r===void 0)return void console.warn("Refusing to cache undefined entry ");if(!s||s<0)return console.warn(`Refusing to cache entry with size ${s} for key ${i}`),void this._notifyRemove(i,r,0,Dp.ALL);const a=1+Math.max(n,qNe)-xX;this._db.set(i,new dEt(r,s,a)),this._size+=s,e.size+=s,this._checkSize()}updateSize(e,i,r,s){i=e.id+i;const n=this._db.get(i);if(n&&n.entry===r){for(this._size-=n.size,e.size-=n.size;s>this._maxSize;){const o=this._notifyRemove(i,r,s,Dp.SOME);if(!(o!=null&&o>0))return void this._db.delete(i);s=o}n.size=s,this._size+=s,e.size+=s,this._checkSize()}}pop(e,i){i=e.id+i;const r=this._db.get(i);if(r)return this._size-=r.size,e.size-=r.size,this._db.delete(i),++this._hit,r.entry;++this._miss}get(e,i){i=e.id+i;const r=this._db.get(i);if(r!==void 0)return this._db.delete(i),r.lives=r.lifetime,this._db.set(i,r),++this._hit,r.entry;++this._miss}peek(e,i){const r=this._db.get(e.id+i);return r?++this._hit:++this._miss,r?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},r=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;r[l]=(r[l]||0)+o.size,this._users.forAll(c=>{const{id:h,name:d}=c;if(a.startsWith(h)){const f=i[d]||0;i[d]=f+o.size}})});const s={};this._users.forAll(o=>{const a=o.name;if("hitRate"in o&&typeof o.hitRate=="number"&&!isNaN(o.hitRate)&&o.hitRate>0){const l=i[a]||0;i[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(i);n.sort((o,a)=>i[a]-i[o]),n.forEach(o=>e[o]=Math.round(i[o]/2**20)+"MB / "+s[o]);for(let o=r.length-1;o>=0;--o){const a=r[o];a&&(e["Priority "+(o+xX-1)]=Math.round(a/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){const i=e.id;this._db.forEach((r,s)=>{s.startsWith(i)&&(this._size-=r.size,this._db.delete(s),this._notifyRemove(s,r.entry,r.size,Dp.ALL))}),e.size=0}clearAll(){this._db.forEach((e,i)=>this._notifyRemove(i,e.entry,e.size,Dp.ALL)),this._users.forAll(e=>e.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,i,r,s){let n;return this._removeFuncs.some(o=>{if(e.startsWith(o[0])){const a=o[1](i,s,r);return typeof a=="number"&&(n=a),!0}return!1}),n}_checkSize(){this._users.forAll(e=>this._checkSizeLimits(e)),this._checkSizeLimits()}_checkSizeLimits(e){const i=e??this;if(i.maxSize<0||i.size<=i.maxSize)return;const r=e?.id;let s=!0;for(;s;){s=!1;for(const[n,o]of this._db)if(o.lifetime===0&&(!r||n.startsWith(r))){if(this._purgeItem(n,o,e),i.size<=.9*i.maxSize)return;s||=this._db.has(n)}}for(const[n,o]of this._db)if((!r||n.startsWith(r))&&(this._purgeItem(n,o,e),i.size<=.9*i.maxSize))return}_purgeItem(e,i,r=this._users.find(s=>e.startsWith(s.id))){if(this._db.delete(e),i.lives<=1){this._size-=i.size,r&&(r.size-=i.size);const s=this._notifyRemove(e,i.entry,i.size,Dp.SOME);s!=null&&s>0&&(this._size+=s,r&&(r.size+=s),i.lives=i.lifetime,i.size=s,this._db.set(e,i))}else--i.lives,this._db.set(e,i)}},hEt=0,dEt=class{constructor(e,i,r){this.entry=e,this.size=i,this.lifetime=r,this.lives=r}};function pEt(t){return"usedMemory"in t&&"unloadedMemory"in t&&"ignoresMemoryFactor"in t}function fEt(t){return new cl({view:t})}const jge=.1,xF=1,cq=1,mEt=.75,gEt=.6,Gge=1.3;let cl=class extends ue{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new WNe,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=750,this._additionalCacheMemory=0,this.addHandles(qm({prepare:()=>this._updateMemory()}))}destroy(){this._cacheStorage.destroy()}get maxMemory(){return this._maxMemory}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(xF),this._maxMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}set additionalCacheMemory(e){e!=null&&(this._additionalCacheMemory=e)}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}get usedCacheMemory(){return this._cacheStorage.size}newCache(e,i,r){return new uEt(e,this._cacheStorage,i,r)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();this._memoryPredicted<gEt&&this._canFastRecover?(this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(xF)):e?(this._memoryPredicted>1.1*cq||this._usedMemory>cq)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>jge&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/Gge),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1)):(this._downscaleMemoryUsed=0,this._usedMemory>cq?(this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/Gge),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(this._usedMemory<mEt&&this._quality<xF?(this._stableQuality=this._quality,e=this._updateQuality(this._quality+.05)):this._quality<1&&(this._canFastRecover=!0))),this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,jge),xF))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){if(!this.view)return;this.view._stage?.renderer?.tick();const e=this.view._stage?.renderer?.usedMemory;let i=(this.view.basemapTerrain?.usedMemory??0)+(e?e.fbos+e.edges+e.plugins:0),r=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(a=>{if(pEt(a)){const l=a.ignoresMemoryFactor?this._quality:1;i+=a.usedMemory*l,r+=a.unloadedMemory*l}});const s=this._warnMemoryUsage==null||Math.round(10*i)!==Math.round(10*this._warnMemoryUsage),n=1048576*this.maxMemory;if(i>n&&s){this._warnMemoryUsage=i;const a=c=>(c/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",l=Math.round(100*this._quality);J.getLogger(this).warn(`Memory Limit exceeded! Limit: ${a(n)} Current: ${a(i)} Projected: ${a(i+r)} Quality: ${l}%`)}this._usedMemory=i/n,this._memoryPredicted=(i+r)/n;const o=n-i;this._cacheStorage.maxSize=Math.max(0,o+1048576*this.additionalCacheMemory)}get test(){}};u([p({constructOnly:!0})],cl.prototype,"view",void 0),u([p()],cl.prototype,"maxMemory",null),u([p()],cl.prototype,"additionalCacheMemory",null),u([p({readOnly:!0})],cl.prototype,"memoryFactor",null),u([p({readOnly:!0})],cl.prototype,"updating",null),u([p({readOnly:!0})],cl.prototype,"usedMemory",null),u([p({readOnly:!0})],cl.prototype,"usedCacheMemory",null),u([p()],cl.prototype,"_quality",void 0),u([p()],cl.prototype,"_usedMemory",void 0),u([p()],cl.prototype,"_updating",void 0),u([p()],cl.prototype,"_stableQuality",void 0),u([p()],cl.prototype,"_maxMemory",void 0),u([p()],cl.prototype,"_additionalCacheMemory",void 0),cl=u([A("esri.views.3d.support.MemoryController")],cl);let yEt=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},vEt=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new _Et}},_Et=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},bEt=class{constructor(e,i,r,s){this._workerFunc=e,this._callbackFunc=i,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=s.map(n=>new vEt(n))}destroy(){this._clients.length=0}hasQuota(e){const i=this._clients[e];return!!i&&(this._totalNumWorkers<this._maxTotalNumWorkers||i.numWorkers+i.tasks.length<i.typeWorkerQuota)}push(e){const i=this._clients[e.client];i&&(this._totalNumWorkers<this._maxTotalNumWorkers?(i.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(r,s)=>this._taskCallback(r,s))):i.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const i=this._clients[e.client];this._totalNumWorkers--,i&&(i.numWorkers--,i.statistics.requests++,i.statistics.size+=e.size||0,i.statistics.duration+=e.duration||0,i.statistics.speed=i.statistics.duration>0?i.statistics.size/i.statistics.duration:0,jt(i.numWorkers>=0)),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(i,r)=>this._taskCallback(i,r)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,i){e._cancelled||(this._callbackFunc(e,i),this._taskFinished(e))}getStatsForType(e){const i=this._clients[e];return i?{quota:i.typeWorkerQuota,workers:i.numWorkers,queueSize:i.tasks.length,requestStats:i.statistics}:null}get test(){}},wEt=class{constructor(e,i){this.element=e,this.type="image+type",this.isOpaque=i==="image/jpeg"}};function qE(t){return t!=null&&"type"in t&&t.type==="vector-tile"}function ZNe(t){return t!=null&&"type"in t&&t.type==="raster-tile"}function YNe(t){return t!=null&&"type"in t&&t.type==="tile-texture"}function xG(t){return t!=null&&"type"in t&&t.type==="image+type"}let c5=class extends ue{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,i,r){this._loadQueue=new bEt((s,n)=>this._startLoading(s,n),(s,n)=>this._doneLoadingCB(s,n),e,i),r&&(this._frameTask=r.registerTask(at.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=Hi(this._frameTask),this._tasks.forEach(e=>hc(e.abortController)),this._loadQueue=Ce(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,i,r,s={}){const n=Qo();n.__signal=s!=null?s.signal:null;const o=this._createOrUpdateTask(e,i,r,s,n);return Xo(s,()=>this._cancelRequest(o,n)),n.promise}_createTask(e,i,r,s,n,o){const a=new TEt(e,i,r,s,n);return this._updateTask(a,o),this._tasks.set(n,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,i){vP(e.resolvers,i),i.reject(vi()),e.resolvers.length===0&&(e.status===zh.DOWNLOADING&&(e.status=zh.CANCELLED,this._loadQueue.cancel(e),e.abortController?.abort(),e.request=null,e.abortController=null),e.status=zh.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,i){e.resolvers.push(i)}_createOrUpdateTask(e,i,r,s,n){const o=EEt(s?.uid||e,i,r),a=this._tasks.get(o);return a?(this._updateTask(a,n),a):this._createTask(e,s,i,r,o,n)}_doneLoadingCB(e,i){this._loadQueue&&(jt(e.status===zh.DOWNLOADING),e.status=zh.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:i}):this._doneLoading(e,i))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const i=this._onLoadQueue.shift();gt(i.task.abortController),i.task.abortController=null,i.callback(i.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const i=this._doneQueue.shift();i.task.status!==zh.DOWNLOADED&&(i.err=i.err||vi()),this._doneLoading(i.task,i.err),e.madeProgress()}}_doneLoading(e,i){if(i&&!Xr(i)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let r=xG(e.result)||e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const s of e.resolvers)if(i)Xr(i)?s.reject(i):s.reject(new U("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${i}`,{url:e.url,error:i}));else{--r;const n=r>0?q(e.result):e.result;s.resolve(n)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,i){if(e.status===zh.CANCELLED)return!1;let r,s;switch(e.startTime=performance.now(),e.status=zh.DOWNLOADING,e.docType){case"binary":s="array-buffer",r=0;break;case"image":s="image";break;case"image+type":s="array-buffer";break;default:s="json"}e.abortController=new AbortController;const n=e.abortController.signal;e.request=Ci(e.url,{...e.options,responseType:s,timeout:r,signal:n});const o=l=>{e.duration=performance.now()-e.startTime,e.size=l instanceof ArrayBuffer?l.byteLength:e.size||0,e.result=l,this._frameTask?this._onLoadQueue.push({callback:i,task:e}):(e.abortController=null,i(e))},a=l=>{e.status===zh.DOWNLOADING&&i(e,l)};return e.docType!=="image+type"?(e.request.then(l=>o(l.data),a),!0):(e.request.then(l=>{const c=l.data,h=SEt(c);if(s="image",e.size=c.byteLength,h==="unknown")return e.request=Ci(e.url,{responseType:s,timeout:r,signal:n}),void e.request.then(m=>o(m.data),a);const d=new Blob([c],{type:h}),f=window.URL.createObjectURL(d);e.request=Ci(f,{responseType:s,timeout:r,signal:n}),e.request.then(m=>o(new wEt(m.data,h)),a).finally(()=>window.URL.revokeObjectURL(f))},a),!0)}get test(){}};u([p({readOnly:!0})],c5.prototype,"updating",void 0),c5=u([A("esri.views.3d.support.StreamDataLoader")],c5);const xEt={numRetries:0};function SEt(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let TEt=class extends yEt{constructor(e,i,r,s,n){super(s),this.url=e,this.options=i,this.docType=r,this.key=n,this.result=null,this.status=zh.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=xEt.numRetries}};function EEt(t,e,i){return`${t}:${e}:${i}`}var zh;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(zh||(zh={}));let u5=class extends ue{constructor(){super(...arguments),this.updating=!1}};function CEt(t){return new tm({view:t})}u([p({readOnly:!0})],u5.prototype,"updating",void 0),u5=u([A("esri.views.3d.support.ResourceController.ResourceControllerMain")],u5);let tm=class extends u5{constructor(){super(...arguments),this._immediateTask=$$,this._normalTask=$$,this._updatingObjects=xa([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=xAe(),this._memoryController=fEt(this.view),this._streamDataLoader=new c5,this._streamDataLoader.setup(cEt,lEt,this._scheduler),this.addHandles([H(()=>this.view.state?.mode,e=>{e!=null&&(this._scheduler.state=e)},Gt),H(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=qm({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(at.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(at.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=Hi(this._frameTask),this._streamDataLoader=Ce(this._streamDataLoader),this._memoryController=Ce(this._memoryController),this._scheduler=Ce(this._scheduler),this.view=null}get updating(){return!!(this._memoryController?.updating||this._streamDataLoader?.updating||this._immediateTask?.updating)||this._updatingObjects?.value.some(e=>e.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const i=this._streamDataLoader;return{request:(r,s,n)=>i.request(r,s,e,n),get busy(){return!i.hasDownloadSlots(e)}}}addUpdatingObject(e){const i=this._updatingObjects;return i.value=[...i.value,e],$i(()=>{i.value=i.value.filter(r=>r!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(rxe(e.deltaTime)),!this._scheduler)||(this._memoryController.update(),this._scheduler.frame(e))}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){}};u([p()],tm.prototype,"view",void 0),u([p()],tm.prototype,"_scheduler",void 0),u([p()],tm.prototype,"_memoryController",void 0),u([p()],tm.prototype,"_streamDataLoader",void 0),u([p()],tm.prototype,"_immediateTask",void 0),u([p()],tm.prototype,"_normalTask",void 0),u([p({readOnly:!0})],tm.prototype,"updating",null),tm=u([A("esri.views.3d.support.ResourceController")],tm);let jni=class{constructor(e,i=0,r=0,s=0,n=0,o=null){this.usedMemory=e,this.displayedFeatures=i,this.totalFeatures=r,this.maximumFeatures=s,this.nodes=n,this.core=o}};function $Et(t){return"performanceInfo"in t}let AEt=class{constructor(e){this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer;const i=e.performanceInfo;this.memory=i.usedMemory,this.displayedNumberOfFeatures=i.displayedFeatures,this.maximumNumberOfFeatures=i.maximumFeatures,this.totalNumberOfFeatures=i.totalFeatures}},MEt=class{constructor(e){if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,this.cachedMemory=0,this.fboMemory=0,e.resourceController!=null){const i=e.resourceController.memoryController;this.totalMemory=(i.maxMemory??0)*g3.MEGABYTES,this.usedMemory=Math.round(i.usedMemory*this.totalMemory),this.quality=e.quality,this.load=e.resourceController.scheduler.load,this.cachedMemory=i.usedCacheMemory}this.terrainMemory=e.basemapTerrain?.usedMemory??0,this.edgesMemory=e._stage?.renderer.usedMemory.edges??0,this.fboMemory=e._stage?.renderer.usedMemory.fbos??0,e.allLayerViews?.items.forEach(i=>{$Et(i)&&this.layerPerformanceInfos.push(new AEt(i))}),this.layerPerformanceInfos.sort((i,r)=>r.memory-i.memory)}},OEt=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,i){return this._load("json",e,i)}async loadBinary(e,i){return wf(e)?(gt(i),Nxe(e)):this._load("binary",e,i)}async loadImage(e,i){return this._load("image",e,i)}async _load(e,i,r){if(this._streamDataRequester==null)return(await Ci(i,{responseType:IEt[e]})).data;const s=await lf(this._streamDataRequester.request(i,e,r));if(s.ok===!0)return s.value;throw Vc(s.error),new U("glt-loader-request-error",`Request for resource failed: ${s.error}`)}};const IEt={image:"image",binary:"array-buffer",json:"json","image+type":void 0},sy=()=>J.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");let REt=class{constructor(e,i,r){this.resource=e,this.textures=i,this.cachedMemory=r}};async function PEt(t,e){const i=await DEt(t,e),r=await kEt(i.textureDefinitions??{},e);let s=0;for(const n in r)if(r.hasOwnProperty(n)){const o=r[n];s+=o?.image?o.image.width*o.image.height*4:0}return new REt(i,r,s+DU(i))}async function DEt(t,e){const i=e?.streamDataRequester;if(i)return LEt(t,i,e);const r=await lf(Ci(t,e));if(r.ok===!0)return r.value.data;Vc(r.error),JNe(r.error)}async function LEt(t,e,i){const r=await lf(e.request(t,"json",i));if(r.ok===!0)return r.value;Vc(r.error),JNe(r.error.details.url)}function JNe(t){throw new U("",`Request for object resource failed: ${t}`)}function NEt(t){const e=t.params,i=e.topology;let r=!0;switch(e.vertexAttributes||(sy().warn("Geometry must specify vertex attributes"),r=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=e.faces;if(n){if(e.vertexAttributes)for(const o in e.vertexAttributes){const a=n[o];a?.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(sy().warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),r=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(sy().warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),r=!1)):(sy().warn(`Indexed geometry does not specify face indices for '${o}' attribute`),r=!1)}}else sy().warn("Indexed geometries must specify faces"),r=!1;break}default:sy().warn(`Unsupported topology '${i}'`),r=!1}t.params.material||(sy().warn("Geometry requires material"),r=!1);const s=t.params.vertexAttributes;for(const n in s)s[n].values||(sy().warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function Yni(t,e){const i=new Array,r=new Array,s=new Array,n=new yv,o=t.resource,a=$D.parse(o.version||"1.0","wosr");UEt.validate(a);const l=o.model.name,c=o.model.geometries,h=o.materialDefinitions??{},d=t.textures;let f=0;const m=new Map;for(let y=0;y<c.length;y++){const v=c[y];if(!NEt(v))continue;const _=zEt(v),b=v.params.vertexAttributes,w=[],x=N=>{if(v.params.topology==="PerAttributeArray")return null;const R=v.params.faces;for(const k in R)if(k===N)return R[k].values;return null},S=b[z.POSITION],C=S.values.length/S.valuesPerElement;for(const N in b){const R=b[N],k=R.values,W=x(N)??MD(C);w.push([N,new Wt(k,W,R.valuesPerElement,!0)])}const T=_.texture,M=d&&d[T];if(M&&!m.has(T)){const{image:N,parameters:R}=M,k=new Gse(N,R);r.push(k),m.set(T,k)}const I=m.get(T),P=I?I.id:void 0,D=_.material;let F=n.get(D,T);if(F==null){const N=h[D.slice(D.lastIndexOf("/")+1)].params;N.transparency===1&&(N.transparency=0);const R=M&&M.alphaChannelUsage,k=N.transparency>0||R==="transparency"||R==="maskAndTransparency",W=M?XNe(M.alphaChannelUsage):void 0,G={ambient:p$(N.diffuse),diffuse:p$(N.diffuse),opacity:1-(N.transparency||0),transparent:k,textureAlphaMode:W,textureAlphaCutoff:.33,textureId:P,doubleSided:!0,cullFace:Tl.None,colorMixMode:N.externalColorMixMode||"tint",textureAlphaPremultiplied:M?.parameters.preMultiplyAlpha??!1};e?.materialParameters&&Object.assign(G,e.materialParameters),F=new qU(G,e),n.set(D,T,F)}s.push(F);const L=new Ea(F,w);f+=w.find(N=>N[0]===z.POSITION)?.[1]?.indices.length??0,i.push(L)}return{engineResources:[{name:l,stageResources:{textures:r,materials:s,geometries:i},pivotOffset:o.model.pivotOffset,numberOfVertices:f,lodThreshold:null}],referenceBoundingBox:FEt(i)}}function FEt(t){const e=ff();return t.forEach(i=>{const r=i.boundingInfo;r!=null&&(BP(e,r.bbMin),BP(e,r.bbMax))}),e}async function kEt(t,e){const i=new Array;for(const n in t){const o=t[n],a=o.images[0].data;if(!a){sy().warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,h=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",d={noUnpackFlip:!0,wrap:{s:nr.REPEAT,t:nr.REPEAT},preMultiplyAlpha:XNe(h)!==Dn.Opaque},f=e?.disableTextures?Promise.resolve(null):vv(l,e);i.push(f.then(m=>({refId:c,image:m,parameters:d,alphaChannelUsage:h})))}const r=await Promise.all(i),s={};for(const n of r)s[n.refId]=n;return s}function XNe(t){switch(t){case"mask":return Dn.Mask;case"maskAndTransparency":return Dn.MaskBlend;case"none":return Dn.Opaque;default:return Dn.Blend}}function zEt(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const UEt=new $D(1,2,"wosr");let BEt=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,i,r){const s=r?`gltfPBR:${e}`:`gltf:${e}`,n=this._gltfMemCache.get(s);return n!=null?Promise.resolve(n):Hge(this._gltfLoading,this._gltfMemCache,s,async o=>{const{loadGLTF:a}=await V(()=>import("./loader-BKMYljBs.js"),__vite__mapDeps([361,253]));return a(new OEt(o.streamDataRequester),e,o,r)},i)}loadWOSR(e,i){const r=`wosr:${e}:${i.disableTextures}`,s=this._wosrMemCache.get(r);return s!=null?Promise.resolve(s):Hge(this._wosrLoading,this._wosrMemCache,r,n=>PEt(e,n),i)}};async function Hge(t,e,i,r,s){gt(s);const n=Xo(s,()=>VEt(t,i));let o=t.get(i);if(o)o.refCount++;else{const a=new AbortController;o={refCount:1,abortController:a,promise:r({...s,signal:a.signal})},t.set(i,o)}try{const a=await o.promise;return e.put(i,a),t.delete(i),gt(s),a}finally{Hi(n)}}function VEt(t,e){const i=t.get(e);i!=null&&--i.refCount>0||(t.delete(e),i?.abortController.abort())}let nC=class extends ue{constructor(e,i){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=i?.registerTask(at.TEXTURE_UNLOAD)??$$}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask?.remove(),this._textureRequests?.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests?.clear()}get updating(){return this._frameTask.updating}fromData(e,i){const r=this.makeUid(e);let s=this._textureRequests.get(r);if(!s){const n=new QNe;n.texture=i(),this._stage&&(n.texture.load(this._stage.renderView.renderingContext),this._stage.add(n.texture)),this._textureRequests.set(r,n),s=n}return s.referenceCount++,new KNe(r,s.texture,()=>this._release(r))}_release(e){const i=this._textureRequests.get(e);i?(i.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),i.referenceCount--,i.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){}_releaseNow(e){if(!this._textureRequests)return;const i=this._textureRequests.get(e);!i||i.referenceCount>0||(i.texture?.unload(),this._releaseTextureRequest(i),this._textureRequests.delete(e))}_releaseTextureRequest(e){e.texture?this._stage?.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,i=null){return i!=null?`${e}.${i}px`:e}};u([p()],nC.prototype,"_frameTask",void 0),u([p()],nC.prototype,"updating",null),nC=u([A("esri.views.3d.support.TextureCollection")],nC);let KNe=class{constructor(e,i,r){this.uid=e,this.texture=i,this.release=r}},QNe=class{constructor(){this.referenceCount=0}},jEt=class extends nC{constructor(e,i,r){super(i,r),this._streamDataRequester=e}async fromUrl(e,i,r){gt(r);const s=r?.signal,n=this.makeUid(e,i);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:n,signal:a.signal});o=new QNe,o.abortController=a;const c=o;this._textureRequests.set(n,o),o.textureAsync=l.then(async h=>{const d=this._createTexture(e,h,i);return c.texture=d,c.abortController=null,await d.load(this._stage.renderView.renderingContext),this._stage.add(d),new KNe(n,d,()=>this._release(n))},h=>{throw c.abortController=null,h})}o.referenceCount++;try{return await Ree(o.textureAsync,s)}catch(a){throw this._release(n),a}}_createTexture(e,i,r){const s={width:i.width,height:i.height,wrap:{s:nr.CLAMP_TO_EDGE,t:nr.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if(Uxe(e)){if(r||i.width===0&&i.height===0){const n=i.width?i.height/i.width:1;r=r||64,n>1?(i.width=Math.round(r/n),i.height=r):(i.width=r,i.height=Math.round(r*n))}this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result&&(s.preMultiplyAlpha=!1)}return new Gse(i,s)}},GEt=class{constructor(e){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(xm.SYMBOLOGY),this.objectResourceCache=new BEt((r,s)=>e.resourceController.memoryController.newCache(r,s)),this.textures=new jEt(this.streamDataRequester,e.view._stage,e.resourceController.scheduler);const i=gr(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=URe(e.viewingMode,i),this.screenSizePerspectiveSettingsLabels=tdt(e.viewingMode,i)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return $i();this._graphicsOwners.push(e);const i=H(()=>e.layer?.screenSizePerspectiveEnabled,()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),$i(()=>{i.remove(),vP(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(i=>i.layer?.screenSizePerspectiveEnabled===!0);if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new ng;const i=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([H(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,i,Gt),this._viewState.events.on("camera-projection-changed",i)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=Ce(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;SF.distance=e.centerOnSurfaceInfrequent.distance,SF.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(SF),this.screenSizePerspectiveSettingsLabels.update(SF),this._view._stage.renderView.requestRender()}get test(){}};const SF={distance:0,fovY:0};let HEt=class{constructor(e){this.destination=e}hide(){this.graphic!=null&&(this.destination.remove(this.graphic),this.graphic=null)}},WE=class extends HEt{constructor(e,i,r=""){super(e),this._symbol=new Sm({symbolLayers:new Ee([new G_({material:{color:i},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new DS({text:r,halo:{color:"white",size:1/.75},material:{color:i},size:12})])})}show(e,i){if(!i)return;this.hide();const r=new ke({x:e[0],y:e[1],z:e[2],spatialReference:i});this.graphic=new Ml({geometry:r,symbol:this._symbol}),this.destination.add(this.graphic)}},R_=class extends ue{constructor(e){super(e)}};u([p({constructOnly:!0})],R_.prototype,"renderCoordsHelper",void 0),u([p({constructOnly:!0})],R_.prototype,"surface",void 0),u([p({constructOnly:!0})],R_.prototype,"state",void 0),R_=u([A("esri.views.3d.support.pointsOfInterest.PointOfInterest")],R_);const qEt=Array;let mp=class extends R_{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new ov({location:ke,renderLocation:qEt},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=$(),this._tmpPoint=new ke}initialize(){if(this.scheduler&&this.addHandles(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.addHandles(io(()=>this.map?.ground?.layers,"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=Ce(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get scale(){const e=this._camera,i=xr(e.eye,this.renderLocation),r={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return fS(r,i)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map?.ground)return this._updateSurfaceAltitude(0),Ko;const e=this.state.spatialReference;this._tmpPoint.spatialReference=e,this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint);const i=(this._tmpPoint.z??0)>WEt&&this.renderCoordsHelper.viewingMode===Be.Global&&(e.isWGS84||e.isWebMercator);let r=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:r.signal,cache:this.cache,minDemResolution:i?ZEt:0}).then(s=>this._updateSurfaceAltitude(s.geometry.z??0)).catch(s=>{Xr(s)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===r&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),r=null}),this._pendingElevationQueryController=r,Ko}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(uq,this._estimatedSurfaceAltitude,this._camera.eye),Qn(this._get("renderLocation"),uq)||(this._set("renderLocation",ne(this._propertiesPool.get("renderLocation"),uq)),this.notifyChange("renderLocation"))}};u([p({constructOnly:!0})],mp.prototype,"scheduler",void 0),u([p({constructOnly:!0})],mp.prototype,"cache",void 0),u([p({constructOnly:!0})],mp.prototype,"task",void 0),u([p()],mp.prototype,"location",null),u([p({constructOnly:!0})],mp.prototype,"map",void 0),u([p()],mp.prototype,"renderLocation",void 0),u([p()],mp.prototype,"scale",null),u([p()],mp.prototype,"updating",null),mp=u([A("esri.views.3d.support.pointsOfInterest.CameraOnSurface")],mp);const uq=$(),WEt=1e5,ZEt=1e6,YEt=Array;let Uh=class extends R_{constructor(e){super(e),this._propertiesPool=new ov({location:ke,renderLocation:YEt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=$(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=Hi(this._frameWorker),this._propertiesPool=Ce(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,Ko}_updateRenderLocation(){const e=XEt;let i=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const r=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!i&&r&&(i=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),i&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const s=KEt;i&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,s)&&(ne(e,s),this._currentSurfaceAltitude=this._latestSurfaceAltitude),i?this.distance=xr(this._camera.eye,e):(ie(e,this._camera.viewForward,this._get("distance")),oe(e,e,this._camera.eye)),Qn(this._get("renderLocation"),e)||this._set("renderLocation",ne(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,i){const r=this._camera;if(!this.renderCoordsHelper.intersectInfiniteManifold(r.ray,e,i))return!1;if(this.state.isGlobal){const s=gr(this.renderCoordsHelper.spatialReference).radius,n=s+e,o=Yo(r.eye),a=o<n*n,l=xr(r.eye,i);if(a&&l>s/4){const c=n-Math.sqrt(o);return ie(i,r.viewForward,c),oe(i,i,r.eye),!0}}else{const s=this.surface?.ready?this.surface.extent:null;s!=null&&Xie(s,this.surface?.spatialReference,YM,this.renderCoordsHelper.spatialReference)&&(i[0]=ce(i[0],YM[0],YM[2]),i[1]=ce(i[1],YM[1],YM[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,i){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,i)){if(bs.TESTS_DISABLE_OPTIMIZATIONS)return!0;const r=this._camera.eye,s=xr(r,e),n=xr(r,i);if(Math.abs(n-s)/s>JEt)return!0}return!1}};u([p({constructOnly:!0})],Uh.prototype,"scheduler",void 0),u([p({constructOnly:!0})],Uh.prototype,"task",void 0),u([p()],Uh.prototype,"distance",void 0),u([p({constructOnly:!0})],Uh.prototype,"estimateSurfaceAltitudeAtCenter",void 0),u([p({readOnly:!0})],Uh.prototype,"location",null),u([p({readOnly:!0})],Uh.prototype,"renderLocation",void 0),u([p()],Uh.prototype,"updating",void 0),Uh=u([A("esri.views.3d.support.pointsOfInterest.CenterOnSurface")],Uh);const JEt=.05,XEt=$(),KEt=$(),YM=Qt();let QEt=class{constructor(e){this._handles=new ng,this.events=new ws,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",i=>this._layerViewsChanged(i))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=Ce(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(e){e.added.forEach(i=>{i.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(i.on("visible-geometry-changed",()=>this._contentChanged()),i.uid)}),e.removed.forEach(i=>this._handles.remove(i.uid))}_contentChanged(){this.events.emit("request-update",e2t)}};const e2t={},t2t=Array;let gp=class extends R_{constructor(e){super(e),this._propertiesPool=new ov({location:ke,renderLocation:t2t},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([H(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),H(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.addHandles(this.scheduler.registerTask(at.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=Ce(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get worldUnitsPerContentPixel(){const{camera:e,contentPixelRatio:i}=this.state;return e.computeRenderPixelSizeAt(this.renderLocation)*(e.pixelRatio/i)}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),i=this.centerOnSurface.renderLocation,r=this.renderCoordsHelper,s=this.state.contentCamera;this._dirty=!1,r.worldUpAtPosition(i,qge);const n=Math.max(0,(Math.acos(de(qge,s.viewForward))-.5*Math.PI)*(s.aboveGround?1:-1));if(Number.isNaN(n)){if(!e||!M$(e,i)){const c=this._propertiesPool.get("renderLocation");ne(c,i),this._set("renderLocation",c)}return Ko}const o=1-ce(n/(.5*Math.PI),0,1),a=o*o*o;this._calculateScreenHorizontalEdgeOnSurface(Wge);const l=this._propertiesPool.get("renderLocation");return dr(l,i,Wge,a),e&&M$(e,l)||this._set("renderLocation",l),Ko}_calculateScreenHorizontalEdgeOnSurface(e){const i=this.state.contentCamera,r=i.getRenderCenter(Wp());if(r[1]=i.aboveGround?i.padding[si.BOTTOM]:i.fullHeight-i.padding[si.TOP],this.estimateSurfaceIntersectionAtRenderPoint(r,e))return e;const s=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(i.unprojectFromRenderScreen(r,JM)){ye(JM,JM,i.eye);const n=ae(JM,JM);if(this.renderCoordsHelper.intersectInfiniteManifold(mf(i.eye,n),s,e))return e}return this.renderCoordsHelper.setAltitude(e,s,i.eye)}updateRenderLocation(){this._dirty=!0}};u([p()],gp.prototype,"_dirty",void 0),u([p({constructOnly:!0})],gp.prototype,"scheduler",void 0),u([p({constructOnly:!0})],gp.prototype,"centerOnSurface",void 0),u([p({constructOnly:!0})],gp.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),u([p()],gp.prototype,"updating",null),u([p()],gp.prototype,"location",null),u([p()],gp.prototype,"renderLocation",void 0),u([p()],gp.prototype,"worldUnitsPerContentPixel",null),gp=u([A("esri.views.3d.support.pointsOfInterest.Focus")],gp);const qge=$(),JM=$(),Wge=$();let ny=class extends ue{get surface(){return this.view.map?.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=$();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null}initialize(){this.view.state.isLocal&&(this.addHandles([H(()=>[this.surfaceView?.spatialReference,this.surfaceView?.extent],()=>this._update()),io(()=>this.surface?.layers,"change",()=>this._update())]),this._update())}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),this.surfaceView?.extent==null||this.surfaceView.spatialReference==null)return void this._set("location",null);const e=DSe(this.surfaceView.extent),i=new ke({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(i,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(r=>{this._updateController=null,this._set("location",r.geometry)}).catch(r=>{})):this._set("location",i)}};u([p({constructOnly:!0})],ny.prototype,"view",void 0),u([p({constructOnly:!0})],ny.prototype,"cache",void 0),u([p()],ny.prototype,"surface",null),u([p()],ny.prototype,"surfaceView",null),u([p({readOnly:!0})],ny.prototype,"location",void 0),u([p({readOnly:!0})],ny.prototype,"renderLocation",null),ny=u([A("esri.views.3d.support.pointsOfInterest.StableSurfaceCenter")],ny);let oy=class extends ue{constructor(e){super(e),this._tileGeometryUpdateExtent=sv(),this._tileGeometryUpdateSpatialReference=null,this.events=new ws,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(at.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",i2t),sv(this._tileGeometryUpdateExtent),this._set("updating",!1)),Ko}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,vC(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let i=1;i<this.centerOnSurfaces.length;i++){const r=this.centerOnSurfaces[i];r.distance>e.distance&&(e=r)}return e}_centerIntersectsExtent(e,i){const r=this.state.contentCamera.eye,s=r2t,n=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,Dw,i),this.renderCoordsHelper.fromRenderCoords(n.renderLocation,Lw,i),Dw[0]<Lw[0]?(s[0]=Dw[0],s[2]=Lw[0]):(s[0]=Lw[0],s[2]=Dw[0]),Dw[1]<Lw[1]?(s[1]=Dw[1],s[3]=Lw[1]):(s[1]=Lw[1],s[3]=Dw[1]),RP(s,e)}};u([p({constructOnly:!0})],oy.prototype,"state",void 0),u([p({constructOnly:!0})],oy.prototype,"centerOnSurfaces",void 0),u([p({constructOnly:!0})],oy.prototype,"renderCoordsHelper",void 0),u([p({constructOnly:!0})],oy.prototype,"scheduler",void 0),u([p({constructOnly:!0})],oy.prototype,"surface",void 0),u([p({readOnly:!0})],oy.prototype,"updating",void 0),oy=u([A("esri.views.3d.support.pointsOfInterest.SurfaceGeometryUpdates")],oy);const i2t={},Dw=$(),Lw=$(),r2t=sv();let ql=class extends ue{constructor(e){super(e),this.renderPointOfView=$(),this._pois=new Array,this._debugCenters=null,this._tmpRay=Pn(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new ov({renderPointOfView:s2t},this)}initialize(){const{state:e,basemapTerrain:i,renderCoordsHelper:r,map:s}=this.view;this._surfaceIntersector=lh(e.viewingMode),this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=Eo.MIN,this._contentIntersector=lh(e.viewingMode);const n=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=this.view.basemapTerrain?.elevationQueryCache,l={state:e,scheduler:o,surface:i,renderCoordsHelper:r};this._set("centerOnSurfaceInfrequent",new Uh({...l,task:at.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnSurfaceFrequent",new Uh({...l,task:at.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnContent",new Uh({...l,task:at.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new mp({...l,cache:a,task:at.POINT_OF_INTEREST_INFREQUENT,map:s})),this._set("surfaceGeometryUpdates",new oy({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new QEt({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:r})),this._set("surfaceOrigin",new ny({cache:a,view:this.view})),this._set("focus",new gp({state:e,scheduler:o,surface:i,renderCoordsHelper:r,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(c,h)=>this._estimateSurfaceIntersectionAtRenderPoint(c,this.view.state.contentCamera,h)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus),this.addHandles([H(()=>e.contentCamera,c=>this._cameraChanged(c),Gt),H(()=>i.extent,()=>this._updateCenterPointsOfInterest()),H(()=>this.view.map?.ground?.navigationConstraint?.type,c=>{this._surfaceIntersector.options.backfacesTerrain=c==="none"},Nt),gn(()=>!i.updating,()=>this._updateCenterPointsOfInterest(),Gt),io(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),io(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),H(()=>bs.SHOW_POI,c=>this._setDebug(c),Nt)]),this._cameraChanged(this.view.state.contentCamera);for(const c of this._pois)c.runTask()}destroy(){this._setDebug(!1),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){return!(!this.surfaceGeometryUpdates?.updating&&!this._pois.some(e=>e.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,jT,o2t)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(jT):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(e==null)return this._surfaceAltitudeAtCenter;const i=e.origin,r=oe(jT,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,i,r),this._surfaceIntersector.results.min.getIntersectionPoint(jT)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(jT)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,i,r){const s=gne(i,e,n2t);if(s==null)return null;const n=s.origin,o=oe(jT,s.origin,s.direction);return this._surfaceIntersector.resetWithRay(s,i),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,n,o),this._surfaceIntersector.results.min.getIntersectionPoint(r)?r:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const i=e.eye;Qn(this.renderPointOfView,i)||this._set("renderPointOfView",ne(this._propertiesPool.get("renderPointOfView"),i))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters?.forEach(i=>i.hide()),void this.removeHandles("debug");if(!this._debugCenters){this._debugCenters=new Map;const i=this.view.graphics;this._debugCenters.set(this.centerOnContent,new WE(i,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new WE(i,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new WE(i,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new WE(i,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new WE(i,"green","Focus"))}for(const i of this._pois)this.addHandles(H(()=>i.renderLocation,r=>this._debugCenters?.get(i)?.show(r,i.renderCoordsHelper.spatialReference),Nt),"debug")}get test(){}};u([p()],ql.prototype,"centerOnContent",void 0),u([p()],ql.prototype,"centerOnSurfaceFrequent",void 0),u([p()],ql.prototype,"centerOnSurfaceInfrequent",void 0),u([p()],ql.prototype,"cameraOnSurface",void 0),u([p()],ql.prototype,"focus",void 0),u([p()],ql.prototype,"renderPointOfView",void 0),u([p()],ql.prototype,"surfaceOrigin",void 0),u([p()],ql.prototype,"contentGeometryUpdates",void 0),u([p()],ql.prototype,"surfaceGeometryUpdates",void 0),u([p({constructOnly:!0})],ql.prototype,"view",void 0),u([p()],ql.prototype,"updating",null),ql=u([A("esri.views.3d.support.pointsOfInterest.PointsOfInterest")],ql);const s2t=Array,jT=$(),n2t=Pn(),o2t={exclude:new Set([Ob])},a2t=()=>J.getLogger("esri/core/MemCachePool");let XD=class{constructor(e,i){this._cache=e(i,(r,s,n)=>{switch(s){case Dp.ALL:return r.forEach(o=>o.dispose()),0;case Dp.SOME:{const o=r.shift();return o?(n-=Math.round(o.cachedMemory),o.dispose()):n>0&&(a2t().warn("Encountered empty MemCachePool with non-zero memory."),n=0),n}}})}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}getSize(e){return this._cache.getSize(e)}pop(e){const i=this._cache.peek(e);if(!i)return;const r=i.pop();return i.length>0?r&&(i.cachedMemory=this._cache.getSize(e)-Math.round(r.cachedMemory),this._cache.updateSize(e,i)):this._cache.pop(e),r}put(e,i,r=qNe){const s=this._cache.peek(e);if(s)s.push(i),s.cachedMemory=this._cache.getSize(e)+Math.round(i.cachedMemory),this._cache.updateSize(e,s);else{const n=new l2t(i);this._cache.put(e,n,r)}}},l2t=class extends Array{constructor(e){super(),this.item=e,this.cachedMemory=e.cachedMemory,this.push(e)}},c2t=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,i){this._store.put(e,i)}},u2t=class{constructor(e="scene"){this.context=e,this.extent=sv()}};const goi={value:.5,readOnly:!0},h2t={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let oC=class{constructor(e=0,i=0){this.min=e,this.max=i,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},d2t=class{constructor(e,i){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(i[2]-i[0]),this.dy=(e.width-1)/(i[3]-i[1]),this.x0=i[0],this.y1=i[3]}},p2t=class{constructor(e,i,r){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=i,this.samplerData=new d2t(r,i)}computeMinMaxValue(e,i,r,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=e-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(i/o)===this.i&&Math.floor(r/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.data.width,h=this.samplerData.data.values,d=.5*sne;let f=(c-1)/o,m=(r-this.j*o)*f,y=(i-this.i*o)*f;if(f<1){const v=Math.floor(m),_=Math.floor(y),b=v+_*c,w=h[b],x=h[b+1],S=h[b+c],C=h[b+c+1];if(w+x+S+C<d){const T=m-v,M=y-_,I=rN(w,x,S,C,T,M),P=rN(w,x,S,C,T+f,M),D=rN(w,x,S,C,T,M+f),F=rN(w,x,S,C,T+f,M+f);return s.min=Math.min(I,P,D,F),s.max=Math.max(I,P,D,F),s}m=v,y=_,f=1}else m=Math.floor(m),y=Math.floor(y),f=Math.ceil(f);for(let v=m;v<=m+f;v++)for(let _=y;_<=y+f;_++){const b=h[v+_*c];b<d?(a=Math.min(a,b),l=Math.max(l,b)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}};const f2t=.5*sne;function cs(t,e,i){if(i==null)return null;for(const r of i){if(!r)continue;const s=r.safeWidth;let n=ce(r.dy*(r.y1-e),0,s),o=ce(r.dx*(t-r.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=r.data.width,h=a*c+l,d=r.data.values,f=d[h],m=d[h+1],y=h+c,v=d[y],_=d[y+1];if(f+v+m+_<f2t){n-=a,o-=l;const b=f+(m-f)*o;return b+(v+(_-v)*o-b)*n}}return null}var rt;(function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"})(rt||(rt={}));function eFe(t){return Bne(t)||vA(t)||_A(t)}function Bne(t){return yb(t)||Uz(t)}function m2t(t,e,i,r){if(t==null)return rne();const s=t.spatialReference;if(s.isGeographic&&!Bne(s))return new U("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const n=rc.checkUnsupported(t);return n??(i==null?new U("tilingscheme:extent-not-exist","The layer does not provide a layer extent."):g2t(t,i)||(e==null||s.equals(e)||e.isWGS84&&s.isWebMercator?null:new U("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")))}function g2t(t,e){const i=t.lods,r=i[0].resolution*2**i[0].level,s=[r*t.size[0],r*t.size[1]],n=[t.origin.x,t.origin.y],o=PSe(e),a=Qt();rc.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>J2){const c=i[0].scale*2**i[0].level;let h=Math.max((o[3]-o[1])/t.size[1],(o[2]-o[0])/t.size[0])*c/r;const d=Math.floor(Math.log(h)/Math.log(10));return h=Math.ceil(h/10**d)*10**d,new U("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:h,requiredNumRootTiles:l,allowedNumRootTiles:J2})}return null}const y2t=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:m2t},Symbol.toStringTag,{value:"Module"}));function v2t(t,e,i,r){if(t==null)return rne();const s=t?.lods.length-1,n=t.spatialReference;if(n.isWebMercator){if(!rc.makeWebMercatorAuxiliarySphere(s).compatibleWith(t,r))return new U("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!eFe(n))return new U("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!rc.makeGCSWithTileSize(t.spatialReference,t.size[0],s).compatibleWith(t,r))return t.spatialReference.isWGS84?new U("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new U("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return e==null||t.spatialReference.equals(e)?null:new U("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const _2t=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:v2t},Symbol.toStringTag,{value:"Module"})),b2t={[Be.Global]:_2t,[Be.Local]:y2t};function po(t,e){t||console.warn("Terrain: "+e)}let Jn=!1,gB=!1;function w2t(t){gB=t,Jn=Jn||t}function x2t(t){Jn=t}function Oe(t,e){if(Jn&&!t){const i=new Error().stack?.slice(5);throw console.warn("Terrain internal: "+(e??"")+" at "+i),new Error("Assertion failed"+(e?": "+e:""))}}function yB(t){return t?.type==="imagery-tile"||t?.type==="wcs"}function SG(t){return t?.type==="imagery-tile-3d"}function tFe(t){return t?.type==="tile-3d"}function X$(t){return t?.type==="vector-tile-3d"}function iFe(t){return t?.type==="wmts-3d"}function SX(t){return t?.type==="elevation-3d"}function XM(t){return t?.type==="group"}function S3(t){return t&&(tFe(t)||iFe(t)||SG(t)||X$(t))}function TX(t){return t&&(tFe(t)||SG(t)||X$(t)||iFe(t))}function EX(t){return TX(t)||SX(t)}function S2t(t){return ZNe(t?.sourceLayerInfo?.data)}function T2t(t){return rFe(t?.sourceLayerInfo)||!!t?.isVTLBackground}function E2t(t){return YNe(t?.sourceLayerInfo?.data)}function C2t(t){const e=t?.sourceLayerInfo?.data;return xG(e)||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData}function rFe(t){return qE(t?.data)}function GC(t){return t!=null&&"release"in t&&t.release(),null}function boi(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function T3(t,e,i,r,s){return b2t[r].checkIfTileInfoSupportedForViewSR(t,i,e,s)}function TG(t,e,i){let r=null,s=null;if(t?.type==="wmts"){const o=sFe(t,e,i);r=o.tileInfo,s=o.fullExtent}else{s=yB(t)?t.getCompatibleFullExtent(e):t.fullExtent;const o=i===Be.Local;yB(t)?r=t.getCompatibleTileInfo(e,s,o):t?.type==="vector-tile"?r=o&&!$2t(e)||A2t.force512VTL?t.tileInfo:t.tileInfo.getCompatibleForVTL(256):r=t.tileInfo}const n="tilemapCache"in t?t.tilemapCache?.effectiveMaxLOD:void 0;return r!=null&&s!=null&&T3(r,s,e,i,n)==null?{tileInfo:r,fullExtent:s}:null}function sFe(t,e,i){const r=WWe(t);if(r!=null){if(!Ee.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{const s=r.find(n=>T3(n.tileInfo,n.fullExtent,e,i)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function $2t(t){return t.isWGS84||t.isWebMercator||Uz(t)||!xV(t)}const A2t={force512VTL:!1};function Zge(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function Dg(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function od(t,e,i=I2t){return Math.abs(t-e)<i}function vB(t){return t===rt.NORTH_EAST?rt.SOUTH_WEST:t===rt.NORTH_WEST?rt.SOUTH_EAST:t===rt.SOUTH_WEST?rt.NORTH_EAST:rt.NORTH_WEST}function Vne(t){return t===rt.NORTH?rt.SOUTH:t===rt.EAST?rt.WEST:t===rt.SOUTH?rt.NORTH:rt.EAST}function M2t(t){return t===rt.NORTH_WEST||t===rt.SOUTH_WEST}function O2t(t){return t===rt.NORTH_WEST||t===rt.NORTH_EAST}function Yge(t){return t===rt.NORTH_WEST||t===rt.WEST||t===rt.SOUTH_WEST}function Jge(t){return t===rt.NORTH_EAST||t===rt.EAST||t===rt.SOUTH_EAST}function Xge(t){return t===rt.SOUTH_EAST||t===rt.SOUTH||t===rt.SOUTH_WEST}function Kge(t){return t===rt.NORTH_EAST||t===rt.NORTH||t===rt.NORTH_WEST}const Jp=[rt.NORTH,rt.EAST,rt.SOUTH,rt.WEST],_B=[rt.NORTH_EAST,rt.SOUTH_EAST,rt.SOUTH_WEST,rt.NORTH_WEST],I2t=1e-5;let Nh=class extends ue{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(i=>{const r=i.layer;if("operationalLayerType"in r&&qWe(r.operationalLayerType)&&this.viewSpatialReference!=null){const s=nFe(r.fullExtent,this.viewSpatialReference);s!=null&&e.push(PSe(s))}}),e}};function R2t(t,e){return t===Be.Global?new CX(e):new $X(e)}u([p({readOnly:!0})],Nh.prototype,"layerViewsExtent",null),u([p({readOnly:!0})],Nh.prototype,"tiledLayersExtent",null),u([p({readOnly:!0})],Nh.prototype,"stencilEnabledExtents",null),u([p()],Nh.prototype,"viewSpatialReference",void 0),u([p()],Nh.prototype,"tilingScheme",void 0),u([p()],Nh.prototype,"defaultTiledLayersExtent",void 0),u([p({constructOnly:!0})],Nh.prototype,"layers",void 0),u([p({constructOnly:!0})],Nh.prototype,"layerViews",void 0),Nh=u([A("esri.views.3d.terrain.ExtentHelper")],Nh);let CX=class extends Nh{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?BDe:h0t}};CX=u([A("esri.views.3d.terrain.ExtentHelper.ExtentHelperGlobal")],CX);let $X=class extends Nh{_computeLayerViewsExtent(){const e=sv(),i=this.viewSpatialReference;this.layerViews.forEach(n=>{const o=n.layer;if(n.isResolved()&&(o.type!=="graphics"||!o.internal)){const a=nFe("fullExtentInLocalViewSpatialReference"in n&&n.fullExtentInLocalViewSpatialReference||n.layer.fullExtent,i);vC(e,a,e)}});const r=F7(e)?e:null,s=this._get("layerViewsExtent");return Tx(r,s)?s:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const i=this.viewSpatialReference,r=sv();this.layers.forEach(o=>{if(o.loaded&&EC(o)){const a=TG(o,i,Be.Local);if(a==null)return;const{tileInfo:l,fullExtent:c}=a,h="tilemapCache"in o?o.tilemapCache?.effectiveMaxLOD:void 0;l!=null&&c!=null&&(yB(o)||e.compatibleWith(l,h)&&c.spatialReference.equals(e.spatialReference))&&vC(r,c,r)}}),vC(r,this.defaultTiledLayersExtent,r);const s=F7(r)?r:null,n=this._get("tiledLayersExtent");return Tx(s,n)?n:s}};function nFe(t,e){return t==null||t.spatialReference.equals(e)?t:gR(t,t.spatialReference,e)}$X=u([A("esri.views.3d.terrain.ExtentHelper.ExtentHelperLocal")],$X);var fs,Go;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(fs||(fs={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(Go||(Go={}));let P2t=class{constructor(e,i){this._material=e,this._repository=i,this._map=new Map}dispose(){this._map.forEach((e,i)=>{e!=null&&this._repository.release(this._material,i)})}load(e,i,r){if(!this._material.produces.get(i)?.(r))return null;this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,i,r));const n=this._map.get(r);if(n!=null){if(n.ensureResources(e)===Mb.LOADED)return n;this._repository.requestRender()}return null}},oFe=class extends fPe{constructor(e=$()){super(),this.origin=e}get slicePlaneLocalOrigin(){return this.origin}},jne=class{constructor(e=0,i=0){this.from=e,this.to=i}get numElements(){return this.to-this.from}};function Qge(t){if(t.length<2)return;const e=new Map;t.forAll(r=>e.set(r.from,r));let i=!0;for(;i;){i=!1;for(let r=0;r<t.length;++r){const s=t.data[r],n=e.get(s.to);n&&(s.to=n.to,e.delete(n.from),t.removeUnordered(n),i=!0)}}}let eye=class extends jne{constructor(e,i,r,s){super(i,r),this.geometry=e,this._highlightName=null,this.updateHighlightOptions(s)}updateHighlightOptions(e){const{geometry:i}=this;if(!i.hasHighlights)return void(this._highlightName=null);let r=-1,s=null;i.foreachHighlightOptions(n=>{const o=e.get(n)??-1;o>r&&(r=o,s=n)}),this._highlightName=s}get highlightName(){return this._highlightName}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.isVisible&&this.geometry.hasHighlights}get hasOccludees(){return this.geometry.occludees!=null}},D2t=class{constructor(){this.first=0,this.count=0}},L2t=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new Jt({allocator:e=>e||new jne,deallocator:null}),this.hasHiddenInstances=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.highlightNames=new Set,this.drawCommandsDefault=TF(),this.drawCommandsHighlights=new Map,this.drawCommandsOccludees=TF(),this.drawCommandsShadowHighlightRest=TF()}get numElements(){return this._numElements}get instances(){return this._instances}get hasHighlights(){return this.highlightNames.size>0}resetInstanceSummary(){this.hasHiddenInstances=!1,this.hasOccludees=!1,this.highlightNames.clear()}updateIfDrawCommandsDirty(e,i){if(this.drawCommandsDirty){this.resetInstanceSummary();for(const r of this.instances.values())this.updateDrawState(r);this.updateDrawCommands(e,i)}}addInstance(e,i){this.deleteInstance(e),this._instances.set(e,i),this._numElements+=i.numElements}deleteInstance(e){const i=this._instances.get(e);i&&(this._numElements-=i.numElements,this._instances.delete(e))}updateInstance(e,i,r){const s=this._instances.get(e);s&&(this._numElements-=s.numElements,s.from=i,s.to=r,this._numElements+=s.numElements)}updateDrawState(e){if(e.isVisible){const{highlightName:i}=e;i&&this.highlightNames.add(i),e.hasOccludees&&(this.hasOccludees=!0)}else this.hasHiddenInstances=!0}updateDrawCommands(e,i){if(this.drawCommandsDefault.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;const{sortedInstances:r}=this;if(this._updateHighlightDrawCommands(e,r),!this.needsMultipleCommands()){const s=this.drawCommandsDefault.pushNew(),n=this.holes.front();return this.vao!=null&&this.holes.length===1&&n.to===Math.floor(this.vao.byteSize/i)?(s.first=0,void(s.count=n.from)):(s.first=1/0,s.count=0,this._instances.forEach(o=>{s.first=Math.min(s.first,o.from),s.count=Math.max(s.count,o.to)}),void(s.count-=s.first))}for(const s of r)s.isVisible&&hq(s.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,s)}get sortedInstances(){return Array.from(this._instances.values()).sort((e,i)=>e.from===i.from?e.to-i.to:e.from-i.from)}updateHighlights(e){this.highlightNames.clear();const i=this.sortedInstances;for(const r of i)r.updateHighlightOptions(e),r.isVisible&&r.highlightName&&this.highlightNames.add(r.highlightName);this._updateHighlightDrawCommands(e)}_updateHighlightDrawCommands(e,i=this.sortedInstances){const{drawCommandsHighlights:r,drawCommandsShadowHighlightRest:s}=this;r.clear(),s.clear();for(const n of i){if(n.updateHighlightOptions(e),!n.isVisible)continue;const{highlightName:o}=n;o&&(this.highlightNames.add(o),hq(zb(r,o,TF),n)),o&&o===Dm||hq(s,n)}}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function N2t(t){return t.vao!=null}function TF(){return new Jt({allocator:t=>t||new D2t,deallocator:t=>t})}function hq(t,e){const i=t.back();if(i==null){const r=t.pushNew();return r.first=e.from,void(r.count=e.numElements)}if(F2t(i,e)){const r=e.from-i.first+e.numElements;i.count=r}else{const r=t.pushNew();r.first=e.from,r.count=e.numElements}}function F2t(t,e){return t.first+t.count>=e.from}let k2t=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(i=>i.instances.has(e))}},wx=class extends BD{get _hasHighlights(){return this._highlightNames.size>0}hasHighlightOptions(e){return this._highlightNames.has(e)}constructor(e){super(e),this._dataByOrigin=new Map,this._drawParameters=new oFe,this._highlightNames=new Set,this.drapedPriority=0,this._produces=new Map,this._hasOccludees=!1}destroy(){this._glMaterials=Rt(this._glMaterials),this._dataByOrigin.forEach(e=>e.dispose()),this._dataByOrigin.clear(),this._vaoCache=null}initialize(){this._updateProduces()}_updateProduces(){this.material.produces.forEach((e,i)=>{this._produces.set(i,r=>!(this._dataByOrigin.size===0||!(r!==Y.Highlight&&r!==Y.ShadowHighlight||this._hasHighlights))&&e(r))})}initializeRenderContext(e,i){this._glMaterials=new P2t(this.material,i??e.materials),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=e.renderContext.rctx.getVaoCache(this.material.vertexAttributeLocations,Fv(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get produces(){return this._produces}get hasOccludees(){return this._hasOccludees}get hasEmissions(){return this.material.hasEmissions}get isDecoration(){return this.material.parameters.isDecoration}queryRenderOccludedState(e){return this.material.queryRenderOccludedState(e)}get numGeometries(){let e=0;return this._dataByOrigin.forEach(i=>e+=i.buffers.reduce((r,s)=>r+s.instances.size,0)),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach(i=>e+=i.buffers.reduce((r,s)=>r+s.vao.cachedMemory,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(i=>i.buffers.forEach(r=>r.instances.forEach(({geometry:s})=>e(s))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}updateHighlights(e){this.highlightOrderMap=e,this._highlightNames.clear(),this._dataByOrigin.forEach(i=>{i.buffers.forEach(r=>{r.updateHighlights(e),r.highlightNames.forEach(s=>this._highlightNames.add(s))})}),this._updateProduces()}_updateGeometries(e){const i=this._bufferWriter;if(i==null)return;const r=i.vertexBufferLayout.stride/4;for(const s of e){const n=s.renderGeometry,o=this._dataByOrigin.get(n.localOrigin.id),a=o?.findBuffer(n.id);if(a==null)return;const l=a.instances.get(n.id);if(s.updateType&(Go.GEOMETRY|Go.TRANSFORMATION)){const c=$F(i.elementCount(l.geometry.geometry.attributes)*r),h=i.vertexBufferLayout.createView(c.buffer);this._writeGeometry(n,h,0),a.vao.vertexBuffers.get("geometry").setSubData(c,l.from*r,0,l.numElements*r)}s.updateType&(Go.HIGHLIGHT|Go.OCCLUDEE|Go.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(e,i){const r=new yv;for(const s of e){const n=s.localOrigin;if(n==null)continue;let o=r.get(n.id,null);o==null&&(o=new tye(n.vec3),r.set(n.id,null,o)),o.changes.push(s)}for(const s of i){const n=s.localOrigin;if(n==null)continue;const o=this._dataByOrigin.get(n.id),a=o?.findBuffer(s.id);if(a==null)continue;let l=r.get(n.id,a);l==null&&(l=new tye(n.vec3),r.set(n.id,a,l)),l.changes.push(s)}return r}_addAndRemoveGeometries(e,i){if(this._bufferWriter==null||this._vaoCache==null)return;const{_bufferWriter:r,_dataByOrigin:s}=this,n=r.vertexBufferLayout.stride/4,o=this._computeDeltas(e,i);o.forEach((a,l)=>{const c=a.get(null),h=c?.changes??[];o.delete(l,null);let d=s.get(l);if(a.forEach((f,m)=>{if(o.delete(l,m),m==null)return void jt(!1,"No VAO for removed geometries");if(m.instances.size===f.changes.length)return this._vaoCache.deleteVao(m.vao),vP(d.buffers,m),void(d.buffers.length===0&&h.length===0&&s.delete(l));const y=m.numElements,v=m.vao.byteSize/4,_=h.reduce((S,C)=>S+r.elementCount(C.geometry.attributes),0),b=f.changes.reduce((S,C)=>S+r.elementCount(C.geometry.attributes),0),w=Math.min((y+_-b)*n,CF),x=w>v;w>ZR&&w<v/2?(f.changes.forEach(({id:S})=>m.deleteInstance(S)),m.instances.forEach(({geometry:S})=>h.push(S)),this._vaoCache.deleteVao(m.vao),vP(d.buffers,m)):x?this._applyAndRebuild(m,h,f):this._applyRemoves(m,f)}),h.length>0)for(d==null&&(d=new k2t(c.origin),s.set(l,d)),d.buffers.forEach(f=>this._applyAdds(f,h));h.length>0;)d.buffers.push(this._applyAndRebuild(new L2t,h,null))})}_updateDrawCommands(){this._highlightNames.clear(),this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(i=>{i.updateIfDrawCommandsDirty(this.highlightOrderMap,this._bufferWriter.vertexBufferLayout.stride),i.hasHighlights&&SP(this._highlightNames,i.highlightNames),this._hasOccludees=this._hasOccludees||i.hasOccludees})})}_applyAndRebuild(e,i,r){if(r)for(const y of r.changes)e.deleteInstance(y.id);const s=this._bufferWriter,n=s.vertexBufferLayout.stride,o=n/4,a=Math.floor(CF/o);let l=e.numElements;for(;i.length>0;){const y=i.pop(),v=s.elementCount(y.geometry.attributes);if(l+v>a&&l>0){i.push(y);break}l+=v;const _=new eye(y,0,0,this.highlightOrderMap);jt(e.instances.get(y.id)==null),e.addInstance(y.id,_)}const c=l*o,h=$F(c),d=s.vertexBufferLayout.createView(h.buffer);let f=0;e.resetInstanceSummary(),e.instances.forEach((y,v)=>{this._writeGeometry(y.geometry,d,f);const _=f;f+=s.elementCount(y.geometry.geometry.attributes),e.updateInstance(v,_,f),e.updateDrawState(y)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(rye(c)),e.vao.vertexBuffers.get("geometry").setSubData(h,0,0,f*o),e.holes.clear();const m=e.holes.pushNew();return m.from=f,m.to=Math.floor(e.vao.byteSize/n),e.updateDrawCommands(this.highlightOrderMap,n),e}_applyRemoves(e,i){if(i.changes.length===0||this._bufferWriter==null)return;for(const a of i.changes){const l=a.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const h=Df.back();if(h){if(h.to===c.from){h.to=c.to;continue}if(h.from===c.to){h.from=c.from;continue}}const d=Df.pushNew();d.from=c.from,d.to=c.to}Qge(Df);const r=this._bufferWriter.vertexBufferLayout.stride/4,s=Df.reduce((a,l)=>Math.max(a,l.numElements),0)*r,n=$F(s);n.fill(0,0,s);const o=e.vao.vertexBuffers.get("geometry");Df.forAll(a=>o.setSubData(n,a.from*r,0,a.numElements*r)),e.holes.pushArray(Df.data,Df.length),Df.forAll((a,l)=>Df.data[l]=null),Df.clear(),e.drawCommandsDirty=!0}_applyAdds(e,i){if(i.length===0||this._bufferWriter==null)return;if(!N2t(e))return void this._applyAndRebuild(e,i,null);const r=this._bufferWriter,s=r.vertexBufferLayout.stride/4,n=e.numElements,o=i.reduce((b,w)=>b+r.elementCount(w.geometry.attributes),0),a=Math.min((n+o)*s,CF),l=4*a;if(e.vao.byteSize<rye(CF-ZR)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,i,null);Qge(e.holes);const c=new Array;for(const b of i){const w=r.elementCount(b.geometry.attributes),x=z2t(e.holes,w);c.push(x)}const h=e.vao.vertexBuffers.get("geometry");let d=0,f=0,m=0;const y=$F(a),v=r.vertexBufferLayout.createView(y.buffer);i.forEach((b,w)=>{const x=c[w];if(x==null)return;if(m!==x){const T=m-f;T>0&&h.setSubData(y,f*s,0,T*s),f=x,d=0}const S=r.elementCount(b.geometry.attributes);this._writeGeometry(b,v,d),d+=S,m=x+S;const C=new eye(b,x,x+S,this.highlightOrderMap);jt(e.instances.get(b.id)==null),e.addInstance(b.id,C),e.drawCommandsDirty=!0});const _=m-f;_>0&&h.setSubData(y,f*s,0,_*s),bBe(i,(b,w)=>c[w]==null)}_writeGeometry(e,i,r){this._bufferWriter!=null&&(mn(GT,e.transformation),GT[12]-=e.localOrigin.vec3[0],GT[13]-=e.localOrigin.vec3[1],GT[14]-=e.localOrigin.vec3[2],Sl(EF,GT),dc(EF,EF),this._bufferWriter.write(GT,EF,e.geometry.attributes,e.geometry.objectAndLayerIdColor,i,r))}updateAnimation(e){return this.material.update(e)}acquireTechniques(e){if(!this.material.shouldRender(e))return null;const{output:i,bind:r}=e;if(!this.material.produces.get(r.slot)?.(i))return null;const{highlight:n,slot:o}=r,a=i===Y.ShadowHighlight,l=i===Y.Highlight,c=l||a,h=n?.name;if(c&&(this._highlightNames.size===0||l&&h&&!this._highlightNames.has(h)))return null;const d=y=>l&&!!h&&!y.has(h),f=i===Y.ShadowExcludeHighlight,m=!(c||f);for(const{buffers:y}of this._dataByOrigin.values())for(const v of y){if(d(v.highlightNames))continue;const _=a?v.drawCommandsHighlights.get(Dm):c?h?v.drawCommandsHighlights.get(h):v.drawCommandsHighlights.size>0:((f&&v.needsMultipleCommands()?v.drawCommandsShadowHighlightRest:v.drawCommandsDefault)||null)?.length??!1,b=m&&v.drawCommandsOccludees||null;if(_||b?.length){const w=this._glMaterials.load(e.rctx,o,i),x=w?.beginSlot(r);if(x)return x}}return null}render(e,i){const{output:r,bind:s}=e,{slot:n,highlight:o}=s,a=r===Y.Highlight,l=o?.name??"";if(a&&!o)return;const c=r===Y.ShadowHighlight,h=a||c,d=r===Y.ShadowExcludeHighlight,f=!(h||d),m=n===be.OCCLUDER_MATERIAL||n===be.TRANSPARENT_OCCLUDER_MATERIAL?n:null,{rctx:y}=e;y.runAppleAmdDriverHelper();const v=y.bindTechnique(i,s,this.material.parameters);for(const _ of this._dataByOrigin.values())for(const b of _.buffers){if(a&&(!b.hasHighlights||!b.drawCommandsHighlights.has(l))||c&&(!b.hasHighlights||!b.drawCommandsHighlights.has(Dm)))continue;const w=()=>{const M=[],I=b.drawCommandsHighlights.get(Dm)??new Jt;return I&&M.push(I),M},x=h&&!c?b.drawCommandsHighlights.get(l)??null:null,S=c?w():h?x?[x]:U2t:d&&b.needsMultipleCommands()?[b.drawCommandsShadowHighlightRest]:[b.drawCommandsDefault],C=S.some(M=>M.length>0),T=f&&b.drawCommandsOccludees||null;if(C||T?.length){if(this._drawParameters.origin=_.origin,v.bindDraw(s,this.material.parameters,this._drawParameters),i.ensureAttributeLocations(b.vao),y.bindVAO(b.vao),C)for(const M of S)y.setPipelineState(i.getPipeline(!1,m)),M.forAll(I=>y.drawArrays(i.primitiveType,I.first,I.count));T?.length&&(y.setPipelineState(i.getPipeline(!0,m)),T.forAll(M=>y.drawArrays(i.primitiveType,M.first,M.count)))}}}static prune(){h5=new Float32Array(ZR)}get test(){}};u([p({constructOnly:!0})],wx.prototype,"material",void 0),u([p({})],wx.prototype,"highlightOrderMap",void 0),wx=u([A("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],wx);let tye=class{constructor(e){this.origin=e,this.changes=new Array}};function z2t(t,e){const i=t.find(s=>s.numElements>=e);if(i==null)return null;const r=i.from;return i.from+=e,i.from>=i.to&&t.removeUnordered(i),r}const GT=Ve(),EF=Ve(),Df=new Jt({allocator:t=>t||new jne,deallocator:null}),ZR=65536,dq=4*ZR,iye=1024,aFe=16777216,CF=aFe/4;let h5=new Float32Array(ZR);function $F(t){return h5.length<t&&(h5=new Float32Array(t)),h5}function rye(t){const e=4*t;return e<=iye?iye:e<dq?yxe(e):Math.max(Math.min(Math.ceil(1.5*e/dq)*dq,aFe),e)}const U2t=[];let Oh=class extends ue{constructor(e){super(e),this._pending=new B2t,this._changes=new MJ,this._renderers=new Map,this._sortedRenderers=new Jt,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._sortedRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materials(){return this.rendererContext.materials}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}hasHighlightOptions(e){return vm(this._renderers,i=>i.hasHighlightOptions(e))}get hasWater(){return this._hasWater}get rendersOccludedDraped(){for(const e of this._renderers.values())if(e.numGeometries!==0&&!e.queryRenderOccludedState(Er.Occlude))return!0;return!1}get isEmpty(){return!this.updating&&this._renderers.size===0&&this._geometries.size===0}getMaterialRenderer(e){return this._renderers.get(e)}get sortedRenderers(){return this._sortedRenderers}commitChanges(e){if(!this.updating)return!1;this._processAddsRemoves();const i=a3e(this._changes);let r=!1;return i.forEach((s,n)=>{let o=this._renderers.get(n);!o&&s.adds.length>0&&(o=new wx({material:n,highlightOrderMap:e}),o.initializeRenderContext(this.rendererContext.pluginContext,this._materials),this._renderers.set(n,o),r=!0),o&&(o.modify(s),o.updateHighlights(e),o.numGeometries===0&&(this._renderers.delete(n),o.destroy(),r=!0))}),this._changes.clear(),r&&this._updateSortedMaterialRenderers(),this._hasHighlights=vm(this._renderers,s=>{const n=s.produces.get(be.DRAPED_MATERIAL);return!!n&&n(Y.Highlight)}),this._hasWater=vm(this._renderers,s=>{const n=s.produces.get(be.DRAPED_WATER);return!!n&&n(Y.Normal)}),this.notifyChange("updating"),!0}updateHighlights(e){this._renderers.forEach(i=>i.updateHighlights(e))}addGeometries(e,i){if(e.length===0)return;const r=this._validateRenderGeometries(e);for(const n of r)this._geometries.set(n.id,n);const s=this._pending.empty;for(const n of r)this._pending.adds.add(n);s&&this.notifyChange("updating"),i===fs.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,i){const r=this._pending.empty,s=this._pending.adds;for(const n of e)s.has(n)?(this._pending.removed.add(n),s.delete(n)):this._pending.removed.has(n)||this._pending.removes.add(n),this._geometries.delete(n.id);r&&!this._pending.empty&&this.notifyChange("updating"),i===fs.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,i){const r=this._changes.updates.length===0;for(const s of e){const n=this._changes.updates.pushNew();n.renderGeometry=this._validateRenderGeometry(s),n.updateType=i}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),i){case Go.TRANSFORMATION:case Go.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case Go.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let i=!1;return this._sortedRenderers.forAll(r=>i=!!r.updateAnimation&&r.updateAnimation(e)||i),i}precompile(e){return this._sortedRenderers.reduce((i,r)=>r.precompile(e)||i,!1)}render(e){this._sortedRenderers.forAll(i=>{const r=i.acquireTechniques(e);r&&i.render(e,r)})}intersect(e,i,r,s,n){for(const o of this._geometries.values()){if(!s(o))continue;this._intersectRenderGeometry(o,r,i,0,e,n);const a=this.rendererContext.longitudeCyclical;a&&(o.boundingSphere[0]-o.boundingSphere[3]<a.min&&this._intersectRenderGeometry(o,r,i,a.range,e,n),o.boundingSphere[0]+o.boundingSphere[3]>a.max&&this._intersectRenderGeometry(o,r,i,-a.range,e,n)),n++}return n}_updateSortedMaterialRenderers(){this._sortedRenderers.clear();let e=0;for(const i of this._renderers.values())i.drapedPriority=e++,this._sortedRenderers.push(i);this._sortedRenderers.sort((i,r)=>r.material?.renderPriority===i.material?.renderPriority?i.drapedPriority-r.drapedPriority:(r.material?.renderPriority||0)-(i.material?.renderPriority||0))}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes)),this._changes.updates.filterInPlace(({renderGeometry:e})=>!this._pending.has(e)),this._pending.clear()}_intersectRenderGeometry(e,i,r,s,n,o){if(!e.visible||!e.material.visible)return;let a=0;s+=e.transformation[12],a=e.transformation[13],pq[0]=r[0]-s,pq[1]=r[1]-a,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,n,pq,(l,c,h)=>{V2t(i,h,o,e.material.renderPriority,n,e.layerUid,e.graphicUid)},i)}_notifyGraphicGeometryChanged(e){if(this.drapeSource.notifyGraphicGeometryChanged==null)return;let i;for(const{graphicUid:r}of e)r!=null&&r!==i&&(this.drapeSource.notifyGraphicGeometryChanged(r),i=r)}_notifyGraphicVisibilityChanged(e){if(this.drapeSource.notifyGraphicVisibilityChanged==null)return;let i;for(const{graphicUid:r}of e)r!=null&&r!==i&&(this.drapeSource.notifyGraphicVisibilityChanged(r),i=r)}_validateRenderGeometries(e){for(const i of e)this._validateRenderGeometry(i);return e}_validateRenderGeometry(e){return e.localOrigin==null&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){}};u([p()],Oh.prototype,"drapeSource",void 0),u([p()],Oh.prototype,"updating",null),u([p()],Oh.prototype,"rctx",null),u([p({constructOnly:!0})],Oh.prototype,"rendererContext",void 0),u([p()],Oh.prototype,"_materials",null),u([p()],Oh.prototype,"_localOriginFactory",null),u([p({readOnly:!0})],Oh.prototype,"isEmpty",null),u([p()],Oh.prototype,"_renderers",void 0),u([p()],Oh.prototype,"_geometries",void 0),Oh=u([A("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Oh);let B2t=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function V2t(t,e,i,r,s,n,o){const a=new UTt(n,o,e),l=c=>{c.set(Zr.OVERLAY,a,t.dist,t.normal,t.transformation,i,r)};if((s.results.min.drapedLayerOrder==null||i>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==Eo.MIN&&(s.results.max.drapedLayerOrder==null||i<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===Eo.ALL){const c=Pre(s.ray);l(c),s.results.all.push(c)}}const pq=He();function lFe(){const t=globalThis.require?.modules;if(t){const e=Object.keys(t);for(const i of e)i.includes(".glsl")&&delete t[i]}}let sye=class{constructor(e,i){this.screen=e,this.olid=i}};const cFe=1.3,j2t=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let v0,Vl=class extends ue{constructor(e){super(e),this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._latestOriginId=0,this._maxResolution=X("esri-mobile")?2048:4096}initialize(){const e=this.view;this.renderer=new Qf({parent:this}),e._stage.renderer.plugins.add(this.renderer);const i=()=>this.requestRender();this._groundIntersector=lh(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this.addHandles([H(()=>this.renderer.hasHighlights,i),this.renderer.events.on("has-water",()=>e._stage?.renderer.updateHasFlags()),this.renderer.events.on("content-changed",i),H(()=>e.state.camera.pixelRatio,i),H(()=>e.state.alignPixelEnabled,i),this.renderer.events.on("textures-disposed",()=>this.surface.requestRender()),H(()=>[e.pointsOfInterest?.renderPointOfView,e.pointsOfInterest?.centerOnSurfaceFrequent?.location],()=>this.setPlacementDirty()),H(()=>[e.state?.pixelRatio,e.state?.contentPixelRatio],()=>this.setPlacementDirty(),Gt),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(at.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",r=>{this._updateOverlays(Wc,r.camera,bt.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlays(bt.BACKGROUND,r)})]),e._stage.renderer.overlay=this}destroy(){this.view?._stage&&(this.view._stage.renderer.plugins.remove(this.renderer),this.view._stage.renderer.overlay=null),v0&&(v0.hide(),v0=null),this.renderer=Ce(this.renderer)}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.renderer.longitudeCyclical=null;const i=this.view.renderSpatialReference;e!=null&&i!=null?(this._renderSR=i,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this.renderer.longitudeCyclical=e.isWebMercator?new fb(-20037508342787e-6,20037508342787e-6):new fb(-180,180))):this.renderer.disposeOverlays()}get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||bs.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?gr(this._spatialReference).metersPerDegree:1}get _overlayStretch(){return cFe/this.view.resolutionScale}get _longitudeCyclical(){return this.renderer.longitudeCyclical}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get rendersOccludedDraped(){return this.renderer.rendersOccludedDraped}render(){if(this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays)return this._precompileShaders()?this._drawOverlays(bt.UPDATE):null}get hasOverlays(){return this.renderer.hasOverlays}registerDrapeSource(e,i,r){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this.renderer.createDrapeSourceRenderer(e,i,r);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),s}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,Oh)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.requestRender()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,bt.UPDATE)}_updateOverlays(e,i,r){if(!this._spatialReference)return Ko;const s=this._computeOverlayResolution(i);this._computeOverlayExtents(i,s,Lf),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources,Lf.stretch);const n=this._updateOverlay(In.INNER,Lf.inner,s,1*Lf.pixelRatioAdjustment,Lf.mapUnitsPerPixel),o=Zo(Lf.inner)/Zo(Lf.outer),a=this._updateOverlay(In.OUTER,Lf.outer,s,o*Lf.pixelRatioAdjustment,Lf.mapUnitsPerPixel);n!==dm.EXTENT&&a!==dm.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.updateOverlayParameters(r)),n===dm.NONE&&a===dm.NONE||this.requestRender(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const i=this.view.state.contentPixelRatio*this.view.resolutionScale,r=e.fullWidth/e.pixelRatio*i,s=e.fullHeight/e.pixelRatio*i,n=Math.ceil(1.5*Math.max(r,s));return Math.min(Jy(n),this._maxResolution)}_updateOverlay(e,i,r,s,n){if(this.renderer.overlays.length===0)return dm.NONE;const o=this.renderer.overlays[e],a=o.mapUnitsPerPixel;if(o.mapUnitsPerPixel=n,o.pixelRatio=s,G2t(i,o.extent)&&r===o.resolution)return a===n?dm.NONE:dm.RERENDER_ONLY;_b(o.extent,i),o.resolution=r;const l=DSe(o.extent);return o.renderLocalOrigin=ZU(l[0],l[1],0,"OV_"+this._latestOriginId++),dm.EXTENT}updateOverlayParameters(e){this.surface.allTiles.forAll(i=>this.updateTileOverlayParameters(i)),this.surface.requestRender(e)}updateTileOverlayParameters(e){if(!e.renderData)return;const i=e.renderData.overlay;if(this.renderer.overlays.length===0)this._clearTileOverlayData(In.INNER,i),this._clearTileOverlayData(In.OUTER,i);else{const[r,s]=this.renderer.overlays,n=e.extent;this._rectInsideRect(r.extent,n)||this._rectanglesOverlap(n,r.extent)||this._rectanglesOverlap(n,s.extent)?(this._setTileOverlayData(n,In.INNER,i),this._setTileOverlayData(n,In.OUTER,i)):(this._clearTileOverlayData(In.INNER,i),this._clearTileOverlayData(In.OUTER,i))}}overlayPixelSizeInMapUnits(e,i){if(this.renderer.overlays.length===0)return i();const r=this.renderer.overlays[In.INNER],s=this.renderer.overlays[In.OUTER],n=this._pointIsInExtent(e,r.extent)?r:s;return(n.extent[2]-n.extent[0])/n.resolution}_setTileOverlayData(e,i,r){if(this.renderer.overlays.length===0)return;const s=this.renderer.overlays[i].extent,n=Zo(s),o=wl(s);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(s[0],a);const l=this._longitudeCyclical.minimalMonotonic(s[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}r.setScale(i,Zo(e)/n,wl(e)/o),r.setOffset(i,(a-s[0])/n,(e[1]-s[1])/o)}_clearTileOverlayData(e,i){i.setScale(e,-1,-1),i.setOffset(e,-1,-1)}reloadShaders(){lFe(),this.requestRender(),this.runTask(Wc)}requestRender(e=bt.UPDATE){this.renderer.hasOverlays?(e===bt.UPDATE?(this._contentUpdated=!0,this._drawTexturesDirty=!0):this._drawTexturesAnimateDirty=!0,this.view._stage.renderView.requestRender(e)):this.setPlacementDirty()}_intersectGroundFromView(e,i,r,s,n){const o=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,Z2t,i,r);if(o==null)return!1;const a=o.origin,l=oe(AF,o.origin,o.direction);this._groundIntersector.reset(a,l,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,a,l);const c=this._groundIntersector.results.min;return c.getIntersectionPoint(n)&&c.withinDistance(s)}_findHorizonBasedPointOfInterest(e,i){let r=.5;const s=.55,n=this.view.renderCoordsHelper.getAltitude(e.eye),o=this.view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=ce(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:n+a,e.aboveGround?n-a:1/0),c=e.aboveGround;if(this.view.viewingMode==="global"){const h=AF;DA(PA(Ej,gr(this.view.spatialReference).radius+l),mf(e.eye,e.viewForward),h),ye(h,h,e.eye);const d=mb.normalize(POe(e.viewForward,h,e.viewRight))/e.fovY+.5,f=d<=0||d>=1?.5:s;r=c?f*d:d+f*(1-d)}else{const h=.5*Math.PI-Math.acos(-e.viewForward[2]),d=Math.tan(h),f=Gi(0,d,1,0),m=Yc(f,f,e.projectionMatrix)[1],y=ce(.5+.5*m,0,1);r=y===1||y===0?.5:c?y*s:1-(1-y)*s}return this._intersectGroundFromView(e,.5,r,o.distance,i)}_computeOverlayExtents(e,i,r){const s=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n=$();this._findHorizonBasedPointOfInterest(e,n)||ne(n,s),bs.OVERLAY_SHOW_CENTER?(v0==null&&(v0=new WE(this.view.graphics,"red")),v0.show(n,this._renderSR)):v0?.hide();const o=Math.max(.1,xr(e.eye,n)),a=_v(this.view.renderCoordsHelper,s,e.eye);this._overlaySREqualsRenderSR||mc(n,this._renderSR,n,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&this._spatialReference?.isGeographic,h=c&&this._spatialReference?1/gr(this._spatialReference).metersPerDegree:1,d=this.view.state.contentPixelRatio,f=e.perScreenPixelRatio/d*o*h;r.mapUnitsPerPixel=f/this.worldToPCSRatio,r.stretch=this._overlayStretch;let m=i*f/2*r.stretch,y=!1,v=c?90:1/0;this._isSpherical&&l&&this._spatialReference&&(this._spatialReference.isWebMercator?(m/=Math.cos(P7(n[1])),v=l[3]):(y=!0,m/=gr(this._spatialReference).metersPerDegree,v=90),m>=v&&(m=v,n[1]=0,this._spatialReference.isWebMercator&&(n[0]=0)));let _=1;y&&(_=1/Math.max(.2,Math.cos(Math.abs(wt(n[1])))),m*_>180&&(_=180/m),r.mapUnitsPerPixel*=_);const b=Math.log(2)/12;m=Math.exp(Math.round(Math.log(m)/b)*b);const w=m*_,x=32,S=.5*i/(x*w),C=.5*i/(x*m);n[0]=Math.round(n[0]*S)/S,n[1]=Math.round(n[1]*C)/C;const T=r.inner;T[0]=n[0]-w,T[1]=n[1]-m,T[2]=n[0]+w,T[3]=n[1]+m,this._isSpherical&&this._shiftExtentToFitBounds(T,1/0,v);const M=r.outer;if(6*w>Zo(l))_b(M,l);else if(Math.PI/2-Math.abs(a-Math.PI/2)<=.25*Math.PI)M[0]=T[0]-w,M[1]=T[1]-m,M[2]=T[2]+w,M[3]=T[3]+m;else{mc(e.eye,this._renderSR,AF,this._spatialReference),cd(Nw,n,AF);let P=-Math.atan2(Nw[1],Nw[0])+.125*Math.PI;P<0&&(P+=2*Math.PI);const D=Math.floor(P/(.25*Math.PI));P$(Nw,j2t[D],2*m),Nw[0]*=_,Nw[2]*=_,sre(M,T,Nw)}if(this._isSpherical)M[0]=this._longitudeCyclical.clamp(M[0]),M[2]=this._longitudeCyclical.clamp(M[2]),M[1]=Math.max(M[1],-v),M[3]=Math.min(M[3],v);else{const P=z7(T,l,q2t),D=z7(M,l,W2t);k7(P,D)&&(M[2]=M[0],M[3]=M[1])}const I=Math.abs(T[2]-T[0])/i;r.mapUnitsPerPixel=Math.max(r.mapUnitsPerPixel,I),r.pixelRatioAdjustment=r.mapUnitsPerPixel/I}_precompileShaders(){return!!this.renderer.hasOverlays&&(this.renderer.precompileShaders(this.view.state),!0)}_drawOverlays(e,i=this.view.state){if(!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return this.renderer;const r=this._drawTexturesDirty;this._drawTexturesDirty=this._drawTexturesAnimateDirty=!1;const s=this.renderer.computeValidity();return this.renderer.releaseRenderTargets(),this.renderer.drawOverlays(i),s!==this.renderer.computeValidity()&&this.updateOverlayParameters(bt.UPDATE),r?(this.surface.requestRender(e),e===bt.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(bt.BACKGROUND),this.renderer}_rectanglesOverlap(e,i){return e!=null&&(this._longitudeCyclical?(this._longitudeCyclical.contains(i[0],i[2],e[0])||this._longitudeCyclical.contains(i[0],i[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],i[0]))&&!(e[1]>i[3]||e[3]<i[1]):RP(e,i))}_rectInsideRect(e,i){return i!=null&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],i[0])&&this._longitudeCyclical.contains(e[0],e[2],i[2])&&i[1]>e[1]&&i[3]<e[3]:k7(e,i))}_pointIsInExtent(e,i){if(this._longitudeCyclical)return this._longitudeCyclical.contains(i[0],i[2],e.x)&&e.y>=i[1]&&e.y<=i[3];const r=e.x,s=e.y;return r>i[0]&&r<i[2]&&s>i[1]&&s<i[3]}_shiftExtentToFitBounds(e,i,r){let s=0,n=0;e[0]<-i?s=e[0]+i:e[2]>i&&(s=i-e[2]),e[1]<-r?n=e[1]+r:e[3]>r&&(n=r-e[3]),Gz(e,s,n)}get test(){}};function G2t(t,e){const r=bs.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r&&Math.abs(e[3]-t[3])<=r}u([p()],Vl.prototype,"_spatialReference",void 0),u([p({readOnly:!0})],Vl.prototype,"running",null),u([p()],Vl.prototype,"_placementDirty",void 0),u([p()],Vl.prototype,"_contentUpdated",void 0),u([p()],Vl.prototype,"_isSpherical",null),u([p()],Vl.prototype,"worldToPCSRatio",null),u([p()],Vl.prototype,"renderer",void 0),u([p({constructOnly:!0})],Vl.prototype,"view",void 0),u([p({constructOnly:!0})],Vl.prototype,"surface",void 0),u([p()],Vl.prototype,"suspended",null),u([p()],Vl.prototype,"updating",null),u([p({type:Boolean})],Vl.prototype,"rendersOccludedDraped",null),Vl=u([A("esri.views.3d.terrain.OverlayManager")],Vl);let H2t=class{constructor(){this.inner=Qt(),this.outer=Qt(),this.mapUnitsPerPixel=0,this.pixelRatioAdjustment=1,this.stretch=cFe}};const Nw=pi(),AF=$(),Lf=new H2t,q2t=Qt(),W2t=Qt(),Z2t=Pn();var dm;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(dm||(dm={}));let Y2t=class{constructor(){this.indices=null,this.indexCount=0,this.edgeIndicesStartIndex=0,this.poleIndicesStartIndex=0,this.vertexAttributes=null,this.edgeVerticesStartIndex=0,this.poleVerticesStartIndex=0,this.maxEdgeVertexCount=0,this.boundingBox=ff(),this.numVerticesPerSide=0,this.minu=0,this.minv=0,this.maxu=1,this.maxv=1,this.outerEdgesOffsetAndLength=[0,0,0,0,0,0,0,0]}release(){this.vertexAttributes=Dr(this.vertexAttributes),this.indices=null}reset(){this.indices=null,this.vertexAttributes=null,ff(this.boundingBox),this.numVerticesPerSide=0}getEdgeFirstVertexIndex(e){return this.outerEdgesOffsetAndLength[2*e]}getEdgeCount(e){return this.outerEdgesOffsetAndLength[2*e+1]}getEdgeVertexIndex(e,i){return this.getEdgeAttributeIndex(e,i)}getEdgeVertexPosition(e,i,r,s){this._getEdgeVertexRaw(this.getEdgeAttributeIndex(e,s),i),oe(i,i,r)}getEdgeNormal(e,i,r){const{typedBuffer:s,typedBufferStride:n}=this.vertexAttributes.normalCompressed;Nyt(i,s,this.getEdgeAttributeIndex(e,r),n)}setEdgeNormalFromValues(e,i,r,s,n){this._setNormal(this.getEdgeAttributeIndex(e,i),r,s,n)}setEdgeVertexFromValuesRawPositionUV(e,i,r,s,n,o,a){const l=this.getEdgeAttributeIndex(e,i);this.vertexAttributes.position.setValues(l,r,s,n),this._setUV(l,o,a)}setEdgeVertexFromValuesRawPositionUVNormal(e,i,r,s,n,o,a,l,c,h){const d=this.getEdgeAttributeIndex(e,i);this.vertexAttributes.position.setValues(d,r,s,n),this._setUV(d,o,a),this._setNormal(d,l,c,h)}_getEdgeVertexRaw(e,i){this.vertexAttributes.position.getVec(e,i)}_setNormal(e,i,r,s){const{typedBuffer:n,typedBufferStride:o}=this.vertexAttributes.normalCompressed;Rb(n,e,i,r,s,o)}_setUV(e,i,r){sf(this.vertexAttributes.uv0,e,i,r)}getEdgeAttributeIndex(e,i){return Oe(0<=i&&i<this.getEdgeCount(e)),this.getEdgeFirstVertexIndex(e)+i}};const nye=16384;function sf(t,e,i,r){t.setValues(e,i*nye,r*nye)}let J2t=class{constructor(){this.sinLonLUT=new Array(mI+1),this.cosLonLUT=new Array(mI+1),this.sinLatLUT=new Array(mI+1),this.cosLatLUT=new Array(mI+1)}update(e,i,r){const s=i[0],n=i[2];for(let o=0;o<=e;o++){const a=o/e,l=s*(1-a)+n*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=r(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}},X2t=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.samplerDataVersion=0,this.clippingArea=null,this.wireframe=!1,this.cornerPeerNeighbors=[null,null,null,null],this.cornerNeighborCornerTiles=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.cornerNeighborCornerTileSamplerVersions=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1]}},uFe=class d5{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=Ce(this._current),this._next=Ce(this._next),this._waiting=Ce(this._waiting),this._delayed=Ce(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){const i=this._delayed||this._waiting||this._next||this._current;i!==this._current&&(this._current=null,this.clear(),this._current=i)}let e=d5.test.fadeMoment;if(this._delayed!=null&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,db.Immediate),this._delayed=null)),this._next!=null){e=e||performance.now();const i=this._fadeDuration,r=this._current!=null&&this._next.texture===this._current.texture,s=this._next.type!==Ms.FADING,n=e-this._fadeStart>=i;(r||s||n)&&(Ce(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;const e=d5.test.fadeMoment||performance.now(),i=Math.max(0,e-this._fadeStart),r=this._fadeDuration;return i>r?0:1-i/r}get isFading(){return this._next!=null||this._delayed!=null}push(e,i=db.Immediate){this._delayed=Ce(this._delayed),this._push(e,i)}_push(e,i){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=e);const r=d5.test.fadeMoment||performance.now();return i!==db.Immediate?(this._delayed=e,void(this._delayedTime=r+i)):this._next==null?(this._next=e,void(this._fadeStart=this._alignFadeStart(r))):void(e!=null&&(Ce(this._waiting),this._waiting=e))}get _fadeDuration(){const e=this._getFadeDuration();return this._waiting?.5*e:e}_alignFadeStart(e){const i=this._getFadeDuration();return e+i-e%i}get _isFadingEnabled(){return this._getFadeDuration()>0}};var db;uFe.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(db||(db={}));let bB=class{constructor(e,i,r,s,n,o){this.texture=e,this.type=i,this.offsetAndScale=r,e.retain(),this.opacities=Le(s,n,o)}destroy(){this.texture.release()}},K2t=class{constructor(){this._scales=Gi(-1,-1,-1,-1),this._offsets=Gi(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,i,r){this._scales[2*e]=i,this._scales[2*e+1]=r}setOffset(e,i,r){this._offsets[2*e]=i,this._offsets[2*e+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}};var K$;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(K$||(K$={}));let hFe=class{constructor(){this._queue=new Jt,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.leaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),e!=null&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){const e=this._last?.children;return e?.[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},Q2t=class{constructor(){this._q=new Jt}get done(){return this._q.length===0}reset(e){if(this._q.clear(),e!=null){this._q.pushArray(e);for(let i=0;i<this._q.length;++i){const r=this._q.data[i];r.leaf||this._q.pushArray(r.children)}}}next(){return this._q.pop()}};function zx(t,e){if(e==null)return!1;const i=eCt(e);if(i?.fullExtent==null)return!1;const r=i.fullExtent,s=t.extent;if(r.xmin>s[2]||r.ymin>s[3]||r.xmax<s[0]||r.ymax<s[1])return!1;const n=t.surface.tilingScheme.levels[t.level].scale,o=i.minScale;if(o>0&&n>1.00000001*o)return!1;const a=i.maxScale;return!(a>0&&n<.99999999*a)}function eCt(t){return SG(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale}:t.layer}function tCt(t){return!SG(t)&&t.layer&&"tilemapCache"in t.layer?t.layer.tilemapCache:null}function Am(t,e){const i=t.lij,r=e.lij;return i[0]-r[0]||i[1]-r[1]||i[2]-r[2]}function iCt(t,e,i=null){i==null||i.length===0?t===K$.BACK_TO_FRONT?e.sort(rCt):e.sort(sCt):e.sort((r,s)=>nCt(r,s,t,i))}function rCt(t,e){const i=e.screenDepth-t.screenDepth;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function sCt(t,e){const i=t.screenDepth-e.screenDepth;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function dFe(t,e,i){const r=t.screenDepth,s=e.screenDepth;return r<s?-i:r>s?i:Am(t,e)}function nCt(t,e,i,r){return oye(t,r)===oye(e,r)?dFe(t,e,i):t?i:-i}function oye(t,e){for(const i of e)if(t.intersectsExtent(i))return!0;return!1}function oCt(t,e){const i=t.distanceToPOI-e.distanceToPOI;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function aCt(t,e){const i=t.length;for(let r=0;r<i;++r)t.at(r).updateDistanceToPOI(e);t.sort(oCt)}function lCt(t,e,i){let r=1,s=0,n=0;for(;t!==e;)if(r*=.5,s*=.5,n*=.5,1&t.lij[2]&&(s+=.5),1&t.lij[1]||(n+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");i.init(e,s,n,r)}function cCt(t){for(let e=0;e<t.length;e++){const i=t[e],r=i.parent;if(r)for(let s=0;s<4;s++){const n=r.children[s];if(n&&n!==i)return!0}}return!1}function Hoi(t,e){if(!t||!e||t[0]===e[0])return!1;const i=t[0]<e[0],r=i?t:e,s=i?e:t,n=1<<s[0]-r[0];return Math.floor(s[1]/n)===r[1]&&Math.floor(s[2]/n)===r[2]}var ga;(function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.InvisibleWithDraped=2]="InvisibleWithDraped",t[t.Invisible=3]="Invisible",t[t.COUNT=4]="COUNT"})(ga||(ga={}));function uCt(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(E`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(E`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(E`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}function hCt(t,e){e.spherical?t.vertex.code.add(E`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(E`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(E`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(E`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}function Gne(t){t.code.add(E`
    float lineFactorAtPosition(float value) {
      float pos = value * ${E.float(257)};
      if(pos < 0.5 || pos > ${E.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}var Mm;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(Mm||(Mm={}));let dCt=class extends Mse{constructor(){super(...arguments),this.overlayOpacity=1}};function pCt(t,e){const{vertex:i,fragment:r,varyings:s}=t;s.add("vtc","vec2"),i.uniforms.add(new aye("texOffsetAndScale")),r.uniforms.add(new lye("tex")),r.uniforms.add(new fq("textureOpacities"));const n=e.textureFadingEnabled&&!e.renderOccluded;n&&(i.uniforms.add(new aye("nextTexOffsetAndScale")),s.add("nvtc","vec2"),r.uniforms.add(new lye("texNext")),r.uniforms.add(new fq("nextTexOpacities")),r.uniforms.add(new fCt("fadeFactor")));const o=e.tileBlendInput===Mm.ColorComposite,a=e.tileBlendInput===Mm.GridComposite;a&&r.include(Gne),o&&r.uniforms.add(new fq("backgroundColor")),i.code.add(E`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = texOffsetAndScale.xy + uv * texOffsetAndScale.zw;
    ${Se(n,"nvtc = nextTexOffsetAndScale.xy + uv * nextTexOffsetAndScale.zw;")}
  }`),r.code.add(E`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${Se(a||o,E`if (opacities.y <= 0.0) {
           return color * opacities.z * opacities.x;
         }
         vec4 bg = vec4(${o?E`backgroundColor`:E`gridColor(uv)`} * opacities.y, opacities.y);
         vec4 layer = color * opacities.z;
         return (bg * (1.0 - layer.a) + layer) * opacities.x;`,"return color;")}
    }`),n?r.code.add(E`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):r.code.add(E`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}let fCt=class extends or{constructor(e){super(e,"float")}},fq=class extends or{constructor(e){super(e,"vec3")}},aye=class extends or{constructor(e){super(e,"vec4")}},lye=class extends or{constructor(e){super(e,"sampler2D")}},Hne=class extends dCt{};function pFe(t){const e=new ki,{vertex:i,fragment:r,varyings:s}=e,{output:n,pbrMode:o,overlayMode:a,tileBorders:l,spherical:c,transparencyMode:h,screenSizePerspective:d}=t;e.include(Zj),e.include(LA,t),e.include(Uy,t);const f=()=>{e.include(hCt,t),i.code.add(E`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};By(i,t),e.include(Y_,t);const m=h===ga.InvisibleWithDraped||h===ga.Invisible,y=a!==Em.Disabled,v=y&&m;switch(n){case Y.ColorEmission:case Y.Color:{e.include(pCt,t),e.include(j$,t),y&&(t.pbrMode=o===_t.Simplified?_t.TerrainWithWater:_t.Water,e.include($M,t),t.pbrMode=o);const _=a===Em.EnabledWithWater;_&&e.include(uCt,t),s.add("vnormal","vec3"),s.add("vpos","vec3"),s.add("vup","vec3"),f(),d&&VU(i);const b=t.receiveShadows&&!t.renderOccluded;b&&e.include(Jj,t),d&&(s.add("screenSizeDistanceToCamera","float"),s.add("screenSizeCosAngle","float")),i.main.add(E`
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);
          vnormal = getNormal();
          vup = getLocalUp(position, localOrigin);
          ${Se(_,E`forwardVertexTangent(vnormal);`)}

          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${Se(y,"setOverlayVTC(uv);")}
          ${Se(l,"forwardTextureCoordinates();")}
          ${Se(d,E`vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
                 screenSizeDistanceToCamera = length(viewPos);
                 vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
                 screenSizeCosAngle = abs(viewSpaceNormal.z);`)}
          ${Se(b,"forwardLinearDepth();")}`),e.fragment.include(Z_,t),e.include(j$,t),e.include(iG,t),e.include(Ose,t),Ib(r,t),rG(r),V$(r),r.uniforms.add(i.uniforms.get("localOrigin"),new Ja("viewDirection",({camera:x})=>ae(cye,se(cye,x.viewMatrix[12],x.viewMatrix[13],x.viewMatrix[14])))),_&&r.uniforms.add(new $t("ovWaterTex",(x,S)=>S.overlay?.getTexture(ir.WaterNormal)),new _se("view",({origin:x},{camera:S})=>nh(mCt,S.viewMatrix,x)));const w=.2;r.code.add(E`float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),eg(r),mv(r),r.main.add(E`
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${b?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), readShadowMap(vpos, linearDepth))":c?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${Se(y,E`vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
                   vec4 overlayColor = overlayOpacity * overlayColorOpaque;
                   ${Se(m,`if (overlayColor.a < ${E.float(Yr)}) { discard; }`)}
                   vec4 groundColor = tileColor;
                   tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`)}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a < ${E.float(Yr)}) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= ${E.float(w)};
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${o===_t.Simplified||o===_t.TerrainWithWater?E`fragColor = vec4(evaluatePBRSimplifiedLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:E`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${Se(_,E`vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
                   float waterNormalLength = length(overlayWaterMask);
                   if (waterNormalLength > 0.95) {
                     mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                     vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                     vec4 viewPosition = view*vec4(vpos, 1.0);
                     vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                     vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                     float opacity = sliced ? ${E.float(w)} : 1.0;
                     // un-gamma the ground color to mix in linear space
                     fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
                   }`)}
          ${Se(d,E`float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0));
                   if (perspectiveScale <= 0.25) {
                     fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
                   } else if (perspectiveScale <= 0.5) {
                     fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
                   } else if (perspectiveScale >= 0.99) {
                     fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
                   } else {
                     fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
                   }`)}
          ${Se(t.visualizeNormals,c?E`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);`:E`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);`)}
          ${Se(l,E`vec2 dVuv = fwidth(vuv0);
                 vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
                 float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
                 fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`)}
          fragColor = applySlice(fragColor, vpos);`)}break;case Y.Depth:v&&e.include($M,t),i.main.add(E`
        ${Se(v,"setOverlayVTC(getUV0());")}
        gl_Position = transformPosition(proj, view, position);`),r.main.add(`${Se(v,`if (getCombinedOverlayColor().a < ${E.float(Yr)}) discard;`)}`);break;case Y.Shadow:case Y.ShadowHighlight:case Y.ShadowExcludeHighlight:case Y.ViewshedShadow:e.include(xse,t),_J(e),yse(e),i.main.add(E`gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);`),r.main.add(E`outputDepth(linearDepth);`);break;case Y.Normal:v&&e.include($M,t),s.add("vnormal","vec3"),VU(i),f(),i.main.add(E`
        ${Se(v,"setOverlayVTC(getUV0());")}
        gl_Position = transformPosition(proj, view, position);
        vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);`),r.main.add(E`
        ${Se(v,`if (getCombinedOverlayColor().a < ${E.float(Yr)}) discard;`)}
        vec3 normal = normalize(vnormal);
        if (gl_FrontFacing == false) {
          normal = -normal;
        }
        fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);`);break;case Y.Highlight:y&&e.include($M,t),i.main.add(E`
        ${Se(y,"setOverlayVTC(getUV0());")}
        gl_Position = transformPosition(proj, view, position);`),e.include(ND,t),r.main.add(E`
        ${Se(y,E`
           vec2 overlayHighlightTexel = getAllOverlayHighlightValuesEncoded();
           calculateOcclusionAndOutputHighlightOverlay(overlayHighlightTexel);`,"calculateOcclusionAndOutputHighlight();")}
      `)}if(n===Y.ObjectAndLayerIdColor)if(y)t.pbrMode=_t.Disabled,e.include($M,t),t.pbrMode=o,i.main.add(E`gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());`),r.main.add(E`fragColor = getOverlayColorTexel();`);else{const _=h===ga.Opaque;i.main.add(E`${Se(_,"gl_Position = transformPosition(proj, view, position);")}`),r.main.add(E`fragColor = vec4(0.0);`)}return e}const mCt=Ve(),cye=$(),gCt=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:Hne,build:pFe},Symbol.toStringTag,{value:"Module"}));let yCt=class extends Bi{constructor(e,i){super(e,i,new Fi(gCt,()=>V(()=>Promise.resolve().then(()=>kGt),void 0)),fFe),this.type="TerrainTechnique",this.useStencil=!1}initializePipeline(e){return this._stencilPipelineState=this._createPipeline(e,!0),this._createPipeline(e,!1)}_createPipeline(e,i){const{renderOccluded:r,output:s}=e,n=e.backfaceCullingEnabled&&!r;return _i({blending:r?NA:null,culling:n?lse:null,depthTest:r?null:{func:Ni.LESS},depthWrite:r?null:DD,colorWrite:Ai,stencilTest:i?apt(oh.IntegratedMeshMaskExcluded):null,drawBuffers:s===Y.Depth?{buffers:[Va.NONE]}:null})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}};const fFe=new Map([[z.POSITION,0],[z.UV0,1],[z.NORMALCOMPRESSED,2]]);let vCt=class{constructor(){this.geometry=new Y2t,this.intersectionData=null,this.geometryState=null,this._vao=null,this._texture=null,this._textureOpacity=1,this._textureRef=new uFe(()=>this._tile.surface.fadeDuration),this.overlay=new K2t,this._localOrigin=null,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._modifiedFlags=0}get tile(){return this._tile}get localOrigin(){return this._localOrigin}init(e,i){this.clear(),this._tile=e,this.geometry.reset(),this.intersectionData=null,this.geometryState=new X2t,this._localOrigin=i,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this.wireframeChanged||this.clippingAreaChanged||this.samplerDataChanged||this.numVerticesPerSideChanged||this.dirtyCorners||this.dirtyEdgeResolutions||this.dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),Jn&&this.tile.intersectsClippingArea)for(let i=0;i<4;++i)Oe(this.geometry.getEdgeCount(i)===this.geometryState.edgeResolutions[i]+1)}_calculateEdgeResolution(e,i){const r=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){const l=r.surface.extent;if(l!=null&&(e===0&&r.extent[3]>l[3]||e===1&&r.extent[2]>l[2]||e===2&&r.extent[1]<l[1]||e===3&&r.extent[0]<l[0]))return s}const n=r.level,o=Jp[e];if(!i)return Oe(r.surface?.rootTiles==null||r.surface.updatingRootTiles||!r.shouldHaveNeighbor(o)),s;if(i.loaded){const l=i,c=l.renderData.geometryState,h=n-l.level;if(Oe(h>=0),h===0){const m=c.numVerticesPerSide-1;return Math.max(m,s)}const d=2**h,f=c.edgeResolutions[(e+2)%4]/d;return Math.max(1,f)}Oe(!i.leaf);let a=s;return i.forAllSubtreeOnSide(Vne(o),l=>l===r||(l.loaded?(a=Math.max(a,2**(l.level-n)),!0):(Oe(!l.leaf),!1))),a}updateNeighborData(){const e=this.tile;if(!e.intersectsClippingArea)return;const i=e.renderData.geometryState,r=o=>(o.loaded||o.level===e.level)&&o?.intersectsClippingArea,s=i.edgePeerNeighbors,n=i.edgePeerNeighborSamplerVersions;for(let o=0;o<4;++o){const a=e.findNeighborTile(Jp[o],r),l=nx(e,a),c=l?.renderData?.geometryState.samplerDataVersion??-1,h=s[o],d=l!==nx(e,h),f=n[o]!==c;Jn&&a&&(Oe(e.level>=a.level),Oe(e.level-a.level<=An)),s[o]=a,(d||f)&&(n[o]=c,this._markEdgeDirty(o));const m=i.edgeResolutions[o],y=this._calculateEdgeResolution(o,a);Oe(EP(y)),Oe(y>=1),i.edgeResolutions[o]=y,m!==y&&this._markEdgeResolutionDirty(o)}for(let o=0;o<4;++o){const a=e.findNeighborTile(_B[o],r);i.cornerPeerNeighbors[o]=a;const l=nx(e,s[o]),c=nx(e,s[(o+1)%4]),h=nx(e,a);Kd[o]=h,Kd[(o+1)%4]=c,Kd[(o+2)%4]=e,Kd[(o+3)%4]=l,Oe(Kd.some(y=>y?.loaded||y===e));const d=Kd.reduce((y,v)=>Math.min(y,v?.level??1/0),1/0);Kd.forEach((y,v)=>{y&&y?.level>d&&(Kd[v]=null)}),Oe(Kd.some(y=>y?.loaded||y===e));const f=i.cornerNeighborCornerTiles,m=i.cornerNeighborCornerTileSamplerVersions;for(let y=0;y<4;++y){const v=Kd[y],_=v?.renderData.geometryState.samplerDataVersion??-1,b=4*o+y,w=f[b]!==v,x=!w&&m[b]!==_;(w||x)&&(f[b]=v,m[b]=_,this._markCornerDirty(o))}Jn&&Oe(qne.some(y=>f[4*o+y]?.loaded||f[4*o+y]===e))}Jn&&Oe(this.geometryState.edgeResolutions.every(o=>o>0));for(let o=0;o<4;++o)Kd[o]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;Jn&&Oe(!this.tile.intersectsClippingArea||this.geometryState.edgeResolutions.every(m=>m>0)),this.intersectionData=null;const{tile:i,_vao:r,geometry:s,geometryState:n}=this,o=!r||this.wireframeChanged||this.samplerDataChanged||this.clippingAreaChanged||this.numVerticesPerSideChanged,a=this.dirtyEdgeResolutions!==0,l=n.edgeResolutions.reduce((m,y)=>m+y+1,0),c=o||a&&l>(s?.maxEdgeVertexCount??0),h=!c&&a,d=!h&&(this.dirtyEdges!==0||a),f=!d&&this.dirtyCorners!==0;c?(this.releaseGeometry(),this._createGeometry(e)):h?i.updateEdgeElevationsAndResolutions():d||f?i.updateEdgeElevations():f?i.updateCornerElevations():console.warn("Update for no reason?"),this._modifiedFlags=0}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao=Rt(this._vao),this.geometry.release(),!0)}ensureTexture(e,i,r,s){const n=i?vt.RGBA:vt.RGB;return this._texture!=null&&(r===Ms.FADING&&this._tile.surface.fadeDuration>0&&this._isTextureVisible(this._texture)||this._texture.descriptor.width!==e||this._texture.descriptor.pixelFormat!==n)&&this.releaseTexture(),this._texture==null&&(this._texture=s(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture!=null&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}reuseTexture(e,i){return!(!e||!this._texture)&&(e.setTextureReference(new bB(this._texture,Ms.FADING,i,this._textureOpacity,0,1)),!0)}get numVerticesPerSideChanged(){return!!(this._modifiedFlags&bCt)}get samplerDataChanged(){return!!(this._modifiedFlags&wCt)}get clippingAreaChanged(){return!!(this._modifiedFlags&xCt)}get wireframeChanged(){return!!(this._modifiedFlags&SCt)}get dirtyEdges(){return this._modifiedFlags>>mq&15}get dirtyCorners(){return this._modifiedFlags>>gq&15}get dirtyEdgeResolutions(){return this._modifiedFlags>>yq&15}_markCornerDirty(e){const i=1<<e<<gq;this._modifiedFlags|=i}_markEdgeDirty(e){const i=1<<e<<mq;this._modifiedFlags|=i,this._markCornerDirty((e+0)%4),this._markCornerDirty((e+3)%4)}_markEdgeResolutionDirty(e){const i=1<<e<<yq;this._modifiedFlags|=i,this._markEdgeDirty(e)}_markAllEdgesAndCornersDirty(){this._modifiedFlags|=15<<gq|15<<mq|15<<yq}updateGeometryState(){const e=this._elevationInfo,i=this.tile,r=e.samplerData?i.getElevationVerticesPerSide(e.maxTileLevel):i.minimumVerticesPerSide,s=Math.max(r,5);let n=i.clippingArea;i.intersectsClippingArea&&!i.withinClippingArea||(n=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==s&&(this._modifiedFlags|=1,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),e.changed&&(this._modifiedFlags|=2,o.samplerData=e.samplerData,o.samplerDataVersion++,a=!0),Hm(o.clippingArea,n)||(this._modifiedFlags=4,o.clippingArea=n,a=!0);const l=i.surface.wireframe;return o.wireframe!==l&&(this._modifiedFlags=8,o.wireframe=l,a=!0),this._geometryStateChangedSinceLastUpdate||=a,a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const i=this.geometry.vertexAttributes,r=this.geometry.indices,s=e.gl;this._vao=new mg(e,fFe,new Map([["geometry",Fv(i.layout)]]),new Map([["geometry",Un.createVertex(e,s.STATIC_DRAW,i.buffer)]]),Un.createIndex(e,s.STATIC_DRAW,r)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,i=db.Immediate){e?.texture===this._texture?this._textureOpacity=e.opacities[0]:this.releaseTexture(),this._textureRef.push(e,i)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_isTextureVisible(e){return this._textureRef.current?.texture===e||this._textureRef.next?.texture===e&&this._textureRef.fadeFactor<1}get _elevationInfo(){const e=this.geometryState.samplerData,i=this.tile.layerInfo[Lt.ELEVATION],r=i.length,s=new Array(r);let n=0,o=0,a=!1;for(let h=0;h<r;h++){const d=i[h],f=d.upsampleInfo?.tile;if(f){const m=f.layerInfo[Lt.ELEVATION][h].data,y=m&&m.samplerData;e&&e[n]===y||(a=!0),s[n++]=y,o=Math.max(o,f.lij[0])}else if(d.data){const m=this.tile.surface.layerViewByIndex(h,Lt.ELEVATION);if(zx(this.tile,m)){const y=d.data;e&&e[n]===y.samplerData||(a=!0),s[n++]=y.samplerData,o=this.tile.level}}}e!=null&&e.length!==n&&(a=!0);const l=n>0,c=l?s:null;return l&&(s.length=n),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){const e=this.intersectionData?.estimatedMemoryUsage??0;return(this.geometry.indices?.byteLength??0)+(this.geometry.vertexAttributes?.byteLength??0)+e}get texture(){return this._texture}get test(){}checkGeometryWaterproofness(){if(!Jn)return;const e=this.tile;if(!e.loaded||!e.intersectsClippingArea||e.level===0)return void Oe(e?.loaded);const i=e.surface.extent;if(i!=null&&!e.intersectsExtent(i))return;const r=Jp.map((a,l)=>i!=null&&(l<2?-1:1)*(e.extent[3-l]-i[3-l])<0),s=e.level;Oe(this.dirtyCorners===0),Oe(this.dirtyEdges===0),Oe(this.dirtyEdgeResolutions===0),Oe(!this.numVerticesPerSideChanged),Oe(!this.samplerDataChanged),Oe(!this.clippingAreaChanged),Oe(!this.wireframeChanged);const n=_B.map(a=>e.findNeighborCornerTileExact(a,l=>!l.intersectsClippingArea||l.loaded||l.level===e.level)??null).map(a=>a?.intersectsClippingArea?a:null),o=this.geometryState;for(let a=0;a<4;++a){const l=o.cornerPeerNeighbors[a],c=n[a];Oe(c===l,`Tile[${e.lij}].corner[${a}] out of date: cur=[${l?.lij}] exp=[${c?.lij}]`)}Jp.forEach((a,l)=>{if(r[l])return;const c=e.findNeighborTile(a,xe=>(xe.level===s||xe?.loaded)&&xe?.intersectsClippingArea);if(!c){const xe=!e.surface.updatingRootTiles&&e.surface.rootTiles!=null&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(a);return void Oe(!xe)}Oe(c.loaded||c.level===e.level),Oe(c===this.geometryState.edgePeerNeighbors[l]);const h=s-c.level;if(!c.loaded)return Oe(!c.leaf),void Oe(h===0);const d=c.renderData;Oe(e.isEdgeNeighbor(c,a)),Oe(h>=0);const f=2**h;if(h<0)return void Oe(!1);const m=e.renderData,y=m.geometry,v=m.localOrigin,_=y.getEdgeCount(l),b=y.numVerticesPerSide-1,w=d.geometry;if(!w)return void Oe(!1);const x=d.localOrigin,S=this.geometryState.edgePeerNeighbors[l];if(S?.loaded){const xe=S.renderData;Oe(m.geometryState.edgePeerNeighborSamplerVersions[l]===xe.geometryState.samplerDataVersion),Oe(this.geometryState.edgePeerNeighborSamplerVersions[l]===xe.geometryState.samplerDataVersion)}const C=(l+2)%4,T=w.getEdgeCount(C),M=_-1,I=T-1;Oe(M*f===I,`Tile[${e.lij}]:e${l},res=${M} edgeRes mismatch with Neighbor[${c.lij}]:e${C},res=${I} (expected:${M*f})`);const P=e.extent,D=a===rt.NORTH||a===rt.SOUTH,F=T-1,L=F>>h,N=_-1;if(L<1)return void Oe(N===1);Oe(L===N),Oe(EP(L));const R=w.numVerticesPerSide-1;Oe(h>0||L===Math.max(R,b));const k=e.getNeighborEdgeStartVertexIndex(l,c);Oe(0<=k&&k<f);const W=k*L;Oe(0<=W&&W<=F-L);let G=0,j=W;y.getEdgeVertexPosition(l,Nf,v,0),y.getEdgeVertexPosition(l,Ff,v,_-1);const re=xr(Nf,Ff),ve=Math.max(_Ct,1e-4*re);for(let xe=0;xe<=L;++xe){y.getEdgeVertexPosition(l,Nf,v,G),w.getEdgeVertexPosition(C,Ff,x,j);const De=xe/L,Ke=D?P[0]+De*(P[2]-P[0]):a===rt.WEST?P[0]:P[2],je=D?a===rt.SOUTH?P[1]:P[3]:P[1]+De*(P[3]-P[1]),ft=e.surface.extent;if(ft==null||$V(ft,Ke,je)){const At=za(Nf,Ff),ti=Ba(Nf)-xi.radius,Tt=Ba(Ff)-xi.radius,xt=At<ve;if(!xt){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${l}[${G}/${_}] and [${c.lij}].edge${C}[${j}/${T}]`),ft!=null&&console.warn("  surface extent= ",ft," x,y=",Ke,",",je);const Ht=$();ye(Ht,m.localOrigin,d.localOrigin),Ba(Ht)>0&&console.warn(`   localOrigins: ${m.localOrigin} vs ${d.localOrigin} d=${Ba(Ht)} [${Ht}]`),(()=>{const pe=is(Nf),we=is(Ff);e.updateEdgeElevations(),c.updateEdgeElevations(),y.getEdgeVertexPosition(l,Nf,v,G),w.getEdgeVertexPosition(C,Ff,x,j);const Re=$();Ri(Re,Nf,pe),Ba(Re)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${pe} vs ${Nf} d=${Ba(Re)} [${Re}]`),Ri(Re,Ff,we),Ba(Re)>0&&console.warn(`  XXX Neighbor[${c.lij}] edge out of date: ${we} vs ${Ff} d=${Ba(Re)} [${Re}]`)})();const mt=y.getEdgeCount(l),_e=w.getEdgeCount(T);Oe(xt,`Mismatch in tile [${e.lij}].edge[${l}][${G}/${mt}] vs neighbor [${c.lij}].edge[${C}][${j}/${_e}] ${Dg(Nf)} vs ${Dg(Ff)}  dist=${At} h(t|n|d)=${ti}|${Tt}|${Tt-ti}`)}y.getEdgeNormal(l,HT,G),w.getEdgeNormal(C,qT,j),ae(uye,HT),ae(hye,qT);const kt=de(uye,hye),Et=1-kt<.01||!1||e===c;if(!Et){const Ht=$();Ri(Ht,HT,qT);const mt=()=>`Mismatch in tile edge normal ${Zge(e.lij)} (${G}/${_-1}) edge ${l} vs neighbor ${Zge(c.lij)}  (${j}/${T-1}) nedge ${C} :${Dg(HT)} vs ${Dg(qT)}  dot = ${kt} : ${Dg(Ht)}`;console.warn("Mismatch in tile edge normal: ",mt());{e.updateEdgeElevations(),c.updateEdgeElevations();const _e=$(),pe=$();y.getEdgeNormal(l,_e,G),w.getEdgeNormal(C,pe,j),M$(HT,_e)||console.warn("Missing update in tile normal: ",Dg(HT)," => ",Dg(_e)),M$(qT,pe)||console.warn("Missing update in neighbor normal: ",Dg(qT)," => ",Dg(pe))}Oe(Et,mt())}}G+=1,j+=1}})}};const Nf=$(),Ff=$(),HT=$(),qT=$(),uye=$(),hye=$(),_Ct=1,Kd=[null,null,null,null];function nx(t,e){return e?.loaded||e===t?e:null}const bCt=1,wCt=2,xCt=4,SCt=8,mq=4,gq=8,yq=12,qne=[0,1,2,3];let Wne=class{get updating(){return!!this._tileRequested}init(e,i,r,s){this.tile=e,this._layerIdx=i,this._layerClass=r,this._suspended=s,this._tileLayerInfo=e.getLayerInfo(i,r),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e,i){this._setUpsampleTile(e,i),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,Ms.FADING,i):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return e!=null?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,i=this._layerClass,r=this.tile.surface.layerViewByIndex(e,i),{minLevel:s,maxLevel:n}=r.dataLevelRange,o=this._desiredMinLevelDelta,a=this._progressiveLevelModulo+o,l=this._scaleRangeEnabled?zx:()=>!0;let c=this.tile;const h=c.level;let d;const f=this._tileLayerInfo.upsampleInfo,m=f?.tile?.level??-1,y=f!=null&&m-h>=o,v=tCt(r),_=r.type==="vector-tile-3d"?r.schemaHelper:null;for(;c&&l(c,r)&&c.level>=s;){const b=c.level,w=h-b,x=c.layerInfo[i][e];if(x.data&&w>=o){(!y||b>m)&&this._setUpsampleTile(c),x.dataInvalidated&&(d=c);break}const S=_?.getLevelRowColumn(c.lij)??c.lij;if(v?.getAvailability(S[0],S[1],S[2])!=="unavailable"&&b<=n&&!x.data&&!x.dataMissing&&((!d||c.level===s||b%UDe==0||h-d.level<o)&&(d=c),w>=a))break;c=c.parent}if(d!=null&&h-d.level<o)if(f)d=null;else{const b=this._findAncestorWithData();b!=null&&(this._setUpsampleTile(b),d=b.layerInfo[i][e].dataInvalidated?b:null)}return d}_findAncestorWithData(){const e=this.tile.elevationLevel,i=this._desiredMinLevelDelta;let r;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(e-s.level>=i)return s;r=s}return r}_setUpsampleTile(e,i){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,Ms.FADING,i)}get test(){}},TCt=class extends Wne{constructor(){super(...arguments),this.type="none"}get _desiredMinLevelDelta(){throw dye}get _progressiveLevelModulo(){throw dye}dispose(){}};const dye=new Error("Abstract method called on TileAgent"),bc=new TCt;let ECt=class extends Wne{constructor(){super(...arguments),this.type="elevation",this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return this.tile.elevationLevelDelta-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}};function CCt(t){return t.type==="elevation"}let $Ct=class extends Wne{constructor(){super(),this.type="map",this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return UDe}};function ACt(t){return t.type==="map"}var ja;(function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"})(ja||(ja={}));let p5=class{constructor(){this.waitingAgents=new Jt,this.pendingUpdates=0}static acquire(e){const i=vq.acquire();return i._init(e),i}release(){this.dispose(),f5.delete(this),vq.release(this)}dispose(){this.loadingAgent=Rt(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=GC(this._data)}static prune(){vq.prune(0)}_init(e){this.waitingAgents.clear(),this._data=GC(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=hc(this.requestAbort),this.requestPromise=null}_unsetUpsampleInfo(){this.upsampleInfo&&(this.upsampleInfo.tile?.unrefMapData(),this._pool.release(this.upsampleInfo),this.upsampleInfo=null)}setUpsampleInfo(e,i){if(e!==i&&i!=null){if(this.upsampleInfo==null)this.upsampleInfo=this._pool.acquire();else{if(this.upsampleInfo.tile===i)return;this.upsampleInfo.tile?.unrefMapData()}i.refMapData(),lCt(e,i,this.upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){GC(this._data),this._data=e}};const vq=new Cl(p5,null,()=>{}),f5=new Map;function MCt(){f5.size>0&&(console.log(`${f5.size} live TilePerLayerInfo allocations:`),f5.forEach(t=>console.log(t,`
`)))}var et;(function(t){t[t.NONE=0]="NONE",t[t.SPLIT=1]="SPLIT",t[t.ELEVATION=2]="ELEVATION",t[t.MERGE=4]="MERGE",t[t.GEOMETRY=8]="GEOMETRY",t[t.TEXTURE_NOFADING=16]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=32]="TEXTURE_FADING"})(et||(et={}));const OCt=.1;let Zne=class{constructor(){this._lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=Qt(),this._elevationBoundsMin=NaN,this._elevationBoundsMax=0,this.layerInfo=[[],[]],this.extentInRadians=Qt(),this.centerAtSeaLevel=$(),this._center=[$(),Rs(),$()],this.up=Ite(),this._withinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=0,this._rasterTileMemory=0,this._vectorTileMemory=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=$(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0}get lij(){return this._lij}get elevationLevelDelta(){return this._surface.getElevationLevelDelta(this.level)}static prune(){Yne.prune(0),Jne.prune(0),p5.prune()}get _cached(){return!this.leaf&&this._mapDataRefCount<=0}get withinClippingArea(){return this._withinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBoundsMin(){return this._elevationBoundsMin}get elevationBoundsMax(){return this._elevationBoundsMax}get level(){return this._lij[0]}get key(){return`${this._lij[0]}/${this._lij[1]}/${this._lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[tn.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const e=this.parent,i=e?.frustumVisibility??ja.INTERSECTS;this._frustumVisibility=i===ja.INSIDE?ja.INSIDE:i===ja.OUTSIDE?ja.OUTSIDE:this._calculateFrustumVisibility(this.surface.frustum);const r=this._frustumVisibility!==ja.OUTSIDE&&this._intersectsClippingArea;r!==this._visible&&(this._visible=r,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get _loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}init(e,i,r,s,n){this._lij[0]=e,this._lij[1]=i,this._lij[2]=r,this.ellipsoid=gr(n.tilingScheme.spatialReference),n.tilingScheme.getExtent(e,i,r,this.extent),n.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._withinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,n.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[tn.MIDDLE][3]=0,this.elevationLevel=e,s&&!Number.isNaN(s.elevationBoundsMin)?(this._elevationBoundsMin=s.elevationBoundsMin,this._elevationBoundsMax=s.elevationBoundsMax):(this._elevationBoundsMin=0,this._elevationBoundsMax=0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=s,this.clearChildren(),this._surface=n,this.updateVisibility(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0;for(const o of HE){const a=n.numLayers(o),l=this.layerInfo[o];for(const c of l)c.release();l.length=a;for(let c=0;c<a;c++)l[c]=p5.acquire(this._surface.upsampleInfoPool),o===Lt.ELEVATION&&this.findElevationBoundsForLayer(c,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(n.tilingScheme.pixelSize,mI)}dispose(){this._surface!=null&&(po(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key),this.layerInfo.forEach(e=>{e.forEach(i=>i.release()),e.length=0}),this._surface=this._parent=null,this.clearChildren(),this.setMemoryDirty())}refMapData(){++this._mapDataRefCount,this._cached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){--this._mapDataRefCount,this._cached&&this.cachedMemory>0&&this._surface.upsampleMapCache.put(this.key,this)}setMemoryDirty(){this._usedMemory=0}get usedMemory(){return this._ensureUsedMemory()+(this._cached?0:this._mapTileMemory)}get cachedMemory(){return this._ensureUsedMemory(),this._surface==null?this.usedMemory:this._cached?this._mapTileMemory:0}get _mapTileMemory(){return this._rasterTileMemory+this._vectorTileMemory}get _cpuImageMemorySize(){const i=this._surface.tilingScheme.pixelSize;return i*i*4}_ensureUsedMemory(){if(this._usedMemory>0)return this._vectorTileMemory=this.layerInfo[Lt.MAP].reduce((e,{data:i})=>e+(qE(i)?i.usedMemoryPerReference:0),0),this._usedMemory;this._usedMemory=this._baseUsedMemory,this._rasterTileMemory=0,this._vectorTileMemory=0;for(const{data:e}of this.layerInfo[Lt.MAP])qE(e)?this._vectorTileMemory+=e.usedMemoryPerReference:this._rasterTileMemory+=this.getTerrainDataMemory(e);for(const e of this.layerInfo[Lt.ELEVATION])this._usedMemory+=e.data?this._cpuImageMemorySize:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._rasterTileMemory+=this.renderData.texture?.cachedMemory??0),this._cached&&this._surface.upsampleMapCache.updateSize(this.key,this),this._usedMemory}getUsedMemoryForLayer(e,i){const r=this.layerInfo[e][i];return r?.data?e===Lt.MAP?this._cached?0:this.getTerrainDataMemory(r.data):e===Lt.ELEVATION?this._cpuImageMemorySize:0:0}getTerrainDataMemory(e){return YNe(e)?e.texture.usedMemory:ZNe(e)?e.memoryUsage:qE(e)?e.usedMemoryPerReference:xG(e)||e instanceof HTMLImageElement?this._cpuImageMemorySize:0}updateScreenDepth(e){const i=this._center[tn.MIDDLE],r=e,s=i[0],n=i[1],o=i[2],a=r[2]*s+r[6]*n+r[10]*o+r[14];this.screenDepth=a<0?0:a/(r[3]*s+r[7]*n+r[11]*o+r[15])}shouldSplit(e,i,r){if(!this.visible||e.frustum&&(!this._intersectsClippingArea||this._calculateFrustumVisibility(e.frustum)===ja.OUTSIDE))return et.NONE;const s=this.level;ye(OF,this._center[tn.MIDDLE],i);let n=Yo(OF),o=OF,a=this._center[tn.MIDDLE];ye(_q,this._center[tn.TOP],i);const l=Yo(_q);l<n&&(n=l,o=_q,a=this._center[tn.TOP]),ye(bq,this._center[tn.BOTTOM],i);const c=Yo(bq);if(c<n&&(n=c,o=bq,a=this._center[tn.BOTTOM]),this._edgeLen2>n&&s<e.maxLod)return et.SPLIT;const h=Math.sqrt(n),d=e.fovX*h*2,f=this._edgeLen/d,m=()=>{if(s<e.maxLod)return this.elevationLevel=s,et.NONE;const M=s+Math.ceil(-Math.log2(e.relativeWidthLimit/f));return M!==this.elevationLevel?(this.elevationLevel=M,et.ELEVATION):et.NONE},y=r!=null?r-s:1/0;if(y<=.5)return m();const v=de(this.up,OF),_=this._elevationBoundsMax-this._elevationBoundsMin,b=_/this.edgeLen;if(e.aboveGround&&v>0&&b<.001&&v/h-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-b>0)return et.NONE;const w=r!=null?3-Math.min(y,2):1;if(f*w<e.relativeWidthLimit||s>=e.maxLod)return m();if(s<7)return et.SPLIT;ie(Do,this.up,v),ye(Do,Do,o);const x=Yo(Do);if(x<=this.radius*this.radius)return et.SPLIT;ie(Do,Do,this.radius/Math.sqrt(x)),oe(Do,Do,a),ye(Do,i,Do);const S=Math.min(1,(Math.abs(de(Do,this.up))+.5*_+this._curvatureHeight)/Te(Do)),C=OCt/e.angledSplitBias,T=e.fovY*h*2;return S*(this._edgeLen/T*w)<C*e.relativeHeightLimit?et.NONE:et.SPLIT}createChildren(){const e=this._children,i=this.lij[0]+1,r=2*this.lij[1],s=2*this.lij[2];return e[0]=this.surface.createTile(i,r,s,this),e[1]=this.surface.createTile(i,r,s+1,this),e[2]=this.surface.createTile(i,r+1,s,this),e[3]=this.surface.createTile(i,r+1,s+1,this),e}clearChildren(){this._children[0]=this._children[1]=this._children[2]=this._children[3]=null}get loaded(){return this.renderData?.hasGeometry??!1}load(){this.refMapData();for(const e of HE)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(){this.renderData&&this.unrefMapData(),this.surface.renderer.unloadTile(this);for(const e of HE){const i=this.layerInfo[e];for(const r of i)r.loadingAgent&&r.loadingAgent!==bc&&(MF(r.loadingAgent),r.loadingAgent=null),r.pendingUpdates=0}this.resetPendingUpdate(et.GEOMETRY),this.resetPendingUpdate(et.TEXTURE_NOFADING),this.resetPendingUpdate(et.TEXTURE_FADING)}unloadMapData(){const e=this.layerInfo[Lt.MAP];for(const i of e)i.loadingAgent&&i.loadingAgent!==bc&&(MF(i.loadingAgent),i.loadingAgent=null),i.pendingUpdates=0,i.invalidateSourceData();this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(Tx(e,this._clippingArea))return!1;const i=this._intersectsClippingArea,r=this._withinClippingArea;e!=null?(this._intersectsClippingArea=this.intersectsExtent(e),this._withinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._withinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const s=r&&this._withinClippingArea,n=!(r||i||this._withinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(et.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,i){return this.layerInfo[i][e]}hasLayerData(e,i){const r=this.layerInfo[i][e];return!(!r?.data||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of HE){const i=this.layerInfo[e];for(const r of i)if(r.loadingAgent&&r.loadingAgent!==bc&&r.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(et.SPLIT)||e!==Lt.ELEVATION&&!this._loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){const i=this._pendingUpdates;return this._pendingUpdates|=e,e===et.SPLIT||e===et.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate(),i!==this._pendingUpdates}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,i,r){const s=this.layerInfo[i][e];if(s.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),r.tile.lij.toString(),i,e),!0;if(s.waitingAgents.push(r),s.data&&!s.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),r.tile.lij.toString(),i,e);const a=qE(s.data);return r.dataArrived(this,a),!0}if(s.requestPromise)return!0;hc(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,e,i,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get leaf(){return this._children[0]==null}hasLij(e){return this._lij[0]===e[0]&&this._lij[1]===e[1]&&this._lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const i=this._children;return i[0]?i[0].findByLij(e)||i[1].findByLij(e)||i[2].findByLij(e)||i[3].findByLij(e):null}distanceToSquared(e){return Yo(ye(Do,this._center[tn.MIDDLE],e))}containsPoint(e){const i=this.extent;return e[0]>=i[0]&&e[1]>=i[1]&&e[0]<=i[2]&&e[1]<=i[3]}containsPointXY(e,i){const r=this.extent;return e>=r[0]&&i>=r[1]&&e<=r[2]&&i<=r[3]}unrequestLayerData(e,i,r){const s=this.layerInfo[i][e],n=s.waitingAgents,o=n.removeUnordered(r)!=null;po(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(e,i,r){const s=qE(r),n=this.layerInfo[i][e];n.data=r,n.dataInvalidated=!1,n.waitingAgents.forAll(o=>o.dataArrived(this,s)),n.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,i){const r=this.layerInfo[i][e];r.dataMissing=!0,r.waitingAgents.forAll(s=>s.dataMissing()),r.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,i,r){switch(r&&this.forEachLoadedNeighbor(s=>s.updateRenderData(e,i)),e){case Lt.MAP:return this._updateTexture(i);case Lt.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===Ms.FADING?et.TEXTURE_NOFADING:et.TEXTURE_FADING),this.setPendingUpdate(e===Ms.FADING?et.TEXTURE_FADING:et.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(et.GEOMETRY);for(const e of this.layerInfo[Lt.ELEVATION])e.pendingUpdates|=et.GEOMETRY}invalidateLayerData(e,i){this.layerInfo[i][e].invalidateSourceData(),this.restartAgents(i)}computeElevationBounds(){const e=this._elevationBoundsMin,i=this._elevationBoundsMax;let r=1/0,s=-1/0;const n=this.layerInfo[Lt.ELEVATION];let o=!0;for(const a of n)a.elevationBounds!=null&&(r=Math.min(r,a.elevationBounds.min),s=Math.max(s,a.elevationBounds.max),a.elevationBounds.hasNoDataValues||(o=!1));o&&(r=Math.min(r,0),s=Math.max(s,0)),e===r&&i===s||(this._elevationBoundsMin=r,this._elevationBoundsMax=s,this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBoundsMin,i=this._elevationBoundsMax,r=.5*(e+i),s=this._center;ie(Do,this.up,r),oe(s[tn.MIDDLE],this.centerAtSeaLevel,Do),ie(Do,this.up,e),oe(s[tn.TOP],this.centerAtSeaLevel,Do),ie(Do,this.up,i),oe(s[tn.BOTTOM],this.centerAtSeaLevel,Do)}findElevationBoundsForLayer(e,i){const r=this.layerInfo[Lt.ELEVATION][e],s=this.elevationLevelDelta,n=Math.max(this.elevationLevel-s,0),o=r.elevationBounds;if(o!=null&&o.level>=i&&o.level<=n)return;const a=this._surface.layerViewByIndex(e,Lt.ELEVATION);if(!zx(this,a))return;const l=RCt;let c=!1;const h=r.data;if(h&&h.level<=n){const d=r.data;l.min=d.samplerData.data.minValue,l.max=d.samplerData.data.maxValue,l.hasNoDataValues=d.samplerData.data.hasNoDataValues,l.level=this.level,c=!0}else{let d,f,m=0;for(let y=this._parent;y&&(!f||m<s)&&(m=this.elevationLevel-y.level,d=f||d,f=y.layerInfo[Lt.ELEVATION][e].data,!(!f&&d&&y.level<=n));y=y.parent);f=f||d,f&&(f.computeMinMaxValue(this._lij[0],this._lij[1],this._lij[2],l),l.min!==1/0&&(l.level=f.level,c=!0))}c&&(r.elevationBounds==null&&(r.elevationBounds=new oC),r.elevationBounds.copyFrom(l))}modifyLayers(e,i,r){const s=this.layerInfo[r];for(const a of s)a.loadingAgent&&a.loadingAgent!==bc&&(MF(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)e[a]===void 0&&s[a].release();const n=new Array(...s),o=i.length;s.length=o;for(let a=0;a<o;a++){const l=i[a];s[a]=l>-1?n[l]:p5.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,Ms.FADING))}updateAgents(e){if(this.renderData){const i=this.layerInfo[e];for(const r of i)r.loadingAgent===bc&&(r.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of HE){const i=this._isSuspended(e);for(const r of this.layerInfo[e])r.loadingAgent&&r.loadingAgent!==bc&&(r.loadingAgent.setSuspension(i),r.loadingAgent===bc&&this.updateRenderData(e,Ms.FADING))}}removeLayerAgent(e,i){const r=this.layerInfo[i][e];r.loadingAgent&&r.loadingAgent!==bc&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(e,i){const r=this.layerInfo[i][e];r.loadingAgent=bc,r.data||r.upsampleInfo!=null||this._createOrUpdateAgents(e+1,i)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||v$(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,i,r){for(let s=e;s<i;++s){const n=this._surface.layerViewByIndex(s,r);if(S3(n)&&n?.layer?.blendMode!=="normal"||v$(n?.layer?.parent)&&this._hasBlendableAncestor(n?.layer?.parent))return!0}return!1}_createOrUpdateAgents(e,i){const r=this.layerInfo[i];if(r.length===0)return;const s=this._isSuspended(i);for(let n=e;n<r.length;++n){const o=r[n],a=this._surface.layerViewByIndex(n,i);let l=!1;if(o.loadingAgent?zx(this,a)?(o.loadingAgent!==bc&&o.loadingAgent.setSuspension(s),o.loadingAgent!==bc&&(l=o.loadingAgent.update())):o.dispose():zx(this,a)&&(o.loadingAgent=ICt(this,n,i,s),l=o.loadingAgent.startLoading(),l?o.loadingAgent===bc&&this.setPendingUpdate(et.GEOMETRY):(MF(o.loadingAgent),o.loadingAgent=bc)),o.loadingAgent===bc&&this.updateRenderData(i,Ms.FADING),!this._hasBlendModes(e,r.length,i)&&l&&a.isOpaque)return}}_isWithinExtent(e){const i=this.extent;return i[0]>=e[0]&&e[2]>=i[2]&&i[1]>=e[1]&&e[3]>=i[3]}intersectsExtent(e){const i=this.extent;return i[2]>=e[0]&&e[2]>=i[0]&&i[3]>=e[1]&&e[3]>=i[1]}getElevationVerticesPerSide(e){const i=this.elevationLevel-this.level,r=Math.max(this.level-e,this.elevationLevelDelta-i),s=ce(1+(this._maxTesselation>>r),2,this._maxTesselation+1),n=this.minimumVerticesPerSide;return Math.max(s,n)}_findLIJ(e,i){if(!e)return null;const r=this.surface.rootTiles;if(r!=null){for(const s of r)if(PCt(s,e)){let n=s,o=e[0]-n.level-1;for(;o>=0&&!n.leaf&&!i(n);){const a=e[1]>>o&1,l=e[2]>>o&1;n=n.children[2*a+l],o--}return i(n)?n:null}}return null}findNeighborTile(e,i){const r=this._lij,s=this._getNeighborLIJ(r,e);return s?m5(r,s)?i(this)?this:null:this._findLIJ(s,i):null}findCorner(e,i){const r=e===rt.NORTH_EAST?1:e===rt.NORTH_WEST?0:e===rt.SOUTH_WEST?2:3;let s=this;for(;s.children[0]&&(!i||!i(s));)s=s.children[r];return s}findNeighborCornerTileExact(e,i){return this.findNeighborTile(e,r=>i(r)||r.level===this.level)?.findCorner(vB(e),i)||null}forAllSubtreeOnSide(e,i){const r=e===rt.NORTH?[0,1]:e===rt.NORTH_EAST?[1]:e===rt.EAST?[1,3]:e===rt.SOUTH_EAST?[3]:e===rt.SOUTH?[2,3]:e===rt.SOUTH_WEST?[2]:e===rt.WEST?[0,2]:[0],s=n=>{const o=n.children;!i(n)&&o[0]&&r.forEach(a=>s(o[a]))};s(this)}getNeighborEdgeStartVertexIndex(e,i){if(!i)return 0;const r=this.level-i.level;if(Oe(!Jn||r>=0),r===0)return 0;const s=2**r,n=!(1&~e),o=n?0:1,a=i.lij[o+1]*s,l=this._lij[o+1],c=l-a,h=n?s-1-c:c;return Jn&&(Oe(a<=l&&l<a+s),Oe(0<=h&&h<s)),h}forEachLoadedNeighbor(e){const i=this.level,r=s=>s.level===i||s.loaded;Jp.forEach(s=>{const n=this.findNeighborTile(s,r);n!=null&&n!==this&&n.forAllSubtreeOnSide(Vne(s),o=>!!o.loaded&&(e(o,s),!0))}),_B.forEach(s=>{const n=this.findNeighborTile(s,r)?.findCorner(vB(s),o=>o.loaded);Oe(!n||AX(this,n,s)),n?.loaded&&e(n,s)})}_getNeighborLIJ(e,i){const r=Kge(i)?-1:Xge(i)?1:0,s=Yge(i)?-1:Jge(i)?1:0,n=[e[0],e[1]+r,e[2]+s];return n[1]<0?null:this.surface.isGlobal?this._wrapLIJ(n):n[2]<0?null:n}_wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}isEdgeNeighbor(e,i){if(e==null)return!1;if(this.level===0&&e.level===0&&(this._eastEnd&&e._westEnd&&i===rt.EAST||this._westEnd&&e._eastEnd&&i===rt.WEST))return!0;const r=Math.max(1e-6*(this.extent[2]-this.extent[0]),1);switch(i){case rt.NORTH:return od(this.extent[3],e.extent[1],r);case rt.SOUTH:return od(this.extent[1],e.extent[3],r);case rt.EAST:return od(this.extent[2],e.extent[0],r)||od(this.extent[2],-e.extent[0],r);case rt.WEST:return od(this.extent[0],e.extent[2],r)||od(this.extent[0],-e.extent[2],r)}}get _eastEnd(){return this._lij[2]===this.surface.lijEastEnd(this.level)-1}get _westEnd(){return this._lij[2]===0}checkGeometryWaterproofness(){gB&&(Oe(this.loaded),this.renderData?.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const i=this.extent,r=this.surface.rootTilesExtent,s=.25*(i[2]-i[0]);if(Kge(e)&&i[3]+s>=r[3]||Xge(e)&&i[1]-s<=r[1])return!1;const n=this.surface.isGlobal;return!(!n&&Yge(e)&&i[0]-s<=r[0])&&!(!n&&Jge(e)&&i[2]+s>=r[2])}updateDistanceToPOI(e){const i=this._lastPOI;if(this.distanceToPOI>=0&&i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2])return;ne(this._lastPOI,e);const r=this._center[tn.MIDDLE],s=e[0]-r[0],n=e[1]-r[1],o=e[2]-r[2];this.distanceToPOI=s*s+n*n+o*o}};function ICt(t,e,i,r){const s=i===Lt.ELEVATION?Jne.acquire():Yne.acquire();return s.init(t,e,i,r),s}function MF(t){t.dispose(),CCt(t)?Jne.release(t):ACt(t)&&Yne.release(t)}const Yne=new Cl($Ct),Jne=new Cl(ECt),RCt=new oC;var tn;function PCt(t,e){const i=t.lij,r=e[0]-i[0];return!(r<0)&&e[1]>>r===i[1]&&e[2]>>r===i[2]}function m5(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function AX(t,e,i){return t!=null&&e!=null&&e!==t&&(t.level>=e.level?pye(t,e,i):pye(e,t,vB(i)))}function pye(t,e,i){Oe(t.level>=e.level);const r=M2t(i),s=O2t(i),n=t.extent,o=e.extent,a=[r?n[0]:n[2],s?n[3]:n[1]],l=[r?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),h=od(a[0],l[0],c)||t.surface.isGlobal&&od(a[0],-l[0],c),d=od(a[1],l[1],c);if(h&&d)return!0;if(t.level===e.level||!h&&!d)return Oe(!1),!1;const f=h?fye(o[1],o[3],n[1],n[3],c):fye(o[0],o[2],n[0],n[2],c);return Oe(f),f}function fye(t,e,i,r,s){return t-s<=i&&i<=r&&r<=e+s}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(tn||(tn={}));const OF=$(),_q=$(),bq=$(),Do=$(),DCt=65536;function LCt(t,e){const{tile:i,geometry:r,geometryState:s}=t,{extentInRadians:n,surface:o}=i,{isWebMercator:a,renderer:l}=o,{numVerticesPerSide:c,wireframe:h}=s,d=c-1,f=(c-2)**2,m=a&&(e===sd.HAS_SOUTH_POLE||e===sd.HAS_BOTH_POLES),y=a&&(e===sd.HAS_NORTH_POLE||e===sd.HAS_BOTH_POLES),v=((m?1:0)+(y?1:0))*g5*c,_=MFe(s),b=f+v+4*_,w=l.tileGeometryCache.acquire(b);r.numVerticesPerSide=c,r.vertexAttributes=w,r.maxEdgeVertexCount=_;const{boundingBox:x}=r;ff(x);const S=Kne(t);Uo.update(d,n,S),FCt(t),r.poleVerticesStartIndex=f;const C=NCt(t,m,y);r.edgeVerticesStartIndex=f+v,eoe(t),Xne(t),wFe(r,C,h),t.intersectionData=null}function NCt(t,e,i){const{tile:r,localOrigin:s,geometry:n}=t,{extent:o,ellipsoid:a}=r,{boundingBox:l,numVerticesPerSide:c,vertexAttributes:h,poleVerticesStartIndex:d}=n,f=c-1,m=s[0],y=s[1],v=s[2],_=a.radius,b=o[1],w=o[3],x=[];let S=d;const C=(T,M)=>{const I=M*c;xd(-m,-y,T*_-v,l),x.push(new t$t(T===1,I,T===1?0:2,S,g5));const P=yFe(T===-1?b:w,_),D=T*Math.PI/2-P,F=.99*(T===1?1:-1),L=_+0,{position:N,uv0:R}=h,{typedBuffer:k,typedBufferStride:W}=h.normalCompressed;for(let G=1;G<=g5;++G){const j=P+D*(G/g5),re=Math.cos(j),ve=Math.sin(j);for(let xe=0;xe<=f;xe++){const De=xe/f,Ke=Uo.sinLonLUT[xe],je=Uo.cosLonLUT[xe]*re,ft=Ke*re,At=ve,ti=je*L-m,Tt=ft*L-y,xt=At*L-v;xd(ti,Tt,xt,l),N.setValues(S,ti,Tt,xt),sf(R,S,De,F),Rb(k,S,je,ft,At,W),++S}}};return e&&C(-1,0),i&&C(1,f),x}function FCt(t){const{tile:e}=t;if(!e.intersectsClippingArea)return;const{geometry:i,geometryState:r,localOrigin:s}=t,{numVerticesPerSide:n,samplerData:o}=r,a=n-2,l=n-1,{vertexAttributes:c,boundingBox:h}=i,d=c.position,f=c.uv0,{typedBuffer:m,typedBufferStride:y}=c.normalCompressed,{extent:v}=e,_=v[0],b=v[2],w=v[1],x=v[3],S=e.ellipsoid.radius,C=s[0],T=s[1],M=s[2],I=d.typedBuffer,P=d.typedBufferStride,D=1/l;let F=0;if(1<=a){const L=D,N=w*(1-L)+x*L,R=Uo.sinLatLUT[1],k=Uo.cosLatLUT[1];for(let W=1;W<=a;W++){const G=W*D,j=_*(1-G)+b*G,re=Uo.sinLonLUT[W],ve=Uo.cosLonLUT[W],xe=S+cs(j,N,o),De=xe*ve*k-C,Ke=xe*re*k-T,je=xe*R-M;xd(De,Ke,je,h);const ft=(W-1)*P;I[ft]=De,I[ft+1]=Ke,I[ft+2]=je,sf(f,W-1,G,L)}}for(let L=1;L<=a;L++){const N=L*D,R=w*(1-N)+x*N,k=Uo.sinLatLUT[L],W=Uo.cosLatLUT[L],G=L+1,j=G*D,re=w*(1-j)+x*j,ve=Uo.sinLatLUT[G],xe=Uo.cosLatLUT[G],De=Uo.sinLonLUT[0],Ke=Uo.cosLonLUT[0],je=S+cs(_,R,o);let ft=Ke*W*je-C,At=De*W*je-T,ti=k*je-M;const Tt=F*P;let xt=I[Tt],kt=I[Tt+1],Et=I[Tt+2];for(let Ht=1;Ht<=a;Ht++){const mt=Ht*D,_e=_*(1-mt)+b*mt,pe=Uo.sinLonLUT[Ht],we=Uo.cosLonLUT[Ht];let Re=0,tt=0,We=0;if(Ht<a){const lr=(F+1)*P;Re=I[lr],tt=I[lr+1],We=I[lr+2]}else{const lr=Uo.sinLonLUT[l],us=Uo.cosLonLUT[l],Ps=S+cs(b,R,o);Re=us*W*Ps-C,tt=lr*W*Ps-T,We=k*Ps-M}const ii=ft,it=At,Fe=ti;ft=xt,At=kt,ti=Et,xt=Re,kt=tt,Et=We;const Me=Re-ii,Ct=tt-it,Xt=We-Fe;let Ji=0,Vi=0,Di=0;if(L>1){const lr=(F-a)*P;Ji=I[lr],Vi=I[lr+1],Di=I[lr+2]}else{const lr=Uo.sinLatLUT[0],us=Uo.cosLatLUT[0],Ps=S+cs(_e,w,o);Ji=we*us*Ps-C,Vi=pe*us*Ps-T,Di=lr*Ps-M}const Xi=S+cs(_e,re,o),yr=we*xe*Xi-C,Mi=pe*xe*Xi-T,Li=ve*Xi-M;if(L<a){const lr=F+a,us=lr*P;I[us]=yr,I[us+1]=Mi,I[us+2]=Li,xd(yr,Mi,Li,h),sf(f,lr,mt,j)}const Mt=Ji-yr,zi=Vi-Mi,fi=Di-Li;let Ki=we*W,Qi=pe*W,Gr=k;Gr*Gr<.999&&(Ki=Xt*zi-Ct*fi,Qi=Me*fi-Xt*Mt,Gr=Ct*Mt-Me*zi);const er=1/Math.sqrt(Ki*Ki+Qi*Qi+Gr*Gr);Rb(m,F,Ki*er,Qi*er,Gr*er,y),++F}}}function kCt(t){t.tile.intersectsClippingArea&&(Xne(t),BA(t),t.intersectionData=null)}function zCt(t){t.tile.intersectsClippingArea&&(TFe(t),Xne(t),BA(t),$Fe(t),t.intersectionData=null)}function UCt(t){t.tile.intersectsClippingArea&&(gFe(t),mFe(t,!0),BA(t),t.intersectionData=null)}function Xne(t){t.tile.intersectsClippingArea&&(gFe(t),mFe(t))}function mFe(t,e=!1){const{geometry:i,geometryState:r,tile:s,localOrigin:n}=t,{level:o,extent:a,extentInRadians:l,ellipsoid:c}=s,h=c.radius,d=l[0],f=l[2],m=l[1],y=l[3],{samplerData:v}=r,_=a[0],b=a[2],w=a[1],x=a[3],S=Kne(t),{boundingBox:C,vertexAttributes:T}=i,M=n[0],I=n[1],P=n[2],D=T.position,F=D.typedBuffer,L=D.typedBufferStride,N=T.uv0;for(let R=0;R<4;++R){const k=R===1||R===3,W=r.edgeResolutions[R];Oe(EP(W));const G=W+1,j=nx(s,r.edgePeerNeighbors[R]);if(AFe(s,j,R)){EFe(t,R,j);continue}const re=j!=null;Oe(!re||j.level===s.level),Oe(!re||Am(s,j)<=0);const ve=j?.renderData,xe=ve?.geometryState;if(Jn){const Me=s.surface;if(!j&&Me&&!Me.updatingRootTiles){const Ct=Jp[R],Xt=s.findNeighborTile(Ct,Ji=>Ji.loaded||Ji.leaf||Ji.level===s.level);Xt?Xt.intersectsClippingArea&&(Oe(!Xt.loaded),Oe(!Xt.leaf),Oe(Xt.level===o)):Oe(Me?.rootTiles==null||!s.shouldHaveNeighbor(Ct))}}const De=R===1?a[2]:a[0],Ke=j?.extent,je=Ke&&k?R===1?Ke[0]:Ke[2]:De,ft=R===0?a[3]:a[1],At=R===1?1:0,ti=R===0?1:0,Tt=R===1?f:d,xt=R===0?y:m,kt=Math.sin(Tt),Et=Math.cos(Tt),Ht=Math.sin(xt),mt=Math.cos(xt),_e=xe?.samplerData,pe=re?(Me,Ct,Xt)=>.5*(cs(Me,Ct,v)+cs(Xt,Ct,_e)):(Me,Ct,Xt)=>cs(Me,Ct,v),we=i.outerEdgesOffsetAndLength[2*R+0],Re=e&&G>3?G-3:1,tt=v!=null&&v.some(Me=>Me!=null),We=_e!=null&&_e.some(Me=>Me!=null),ii=tt||We,it=1/W,Fe=we;Oe(!Ke||od(Ke[2]-Ke[0],a[2]-a[0])),(()=>{const Me=R===1?-1:R===3?1:0,Ct=R===0?-1:R===2?1:0,Xt=(a[2]-a[0])*it,Ji=Me*Xt,Vi=Ct*Xt,Di=k?Me*((f-d)*it):0,Xi=k?0:Ct*it,yr=ti,Mi=k?Tt+Di:Tt,Li=k?Math.sin(Mi):kt,Mt=k?Math.cos(Mi):Et,zi=k?Tt-Di:Tt,fi=k?Math.sin(zi):kt,Ki=k?Math.cos(zi):Et,Qi=k?xt:S(yr+Xi),Gr=k?Ht:Math.sin(Qi),er=k?mt:Math.cos(Qi),lr=k?xt:S(yr-Xi),us=k?Ht:Math.sin(lr),Ps=k?mt:Math.cos(lr);let Io=0,Ol=0,jn=0;{const Q=0*it,ci=k?De:_*(1-Q)+b*Q,ds=k?je:ci,Ar=k?w*(1-Q)+x*Q:ft,ns=k?Tt:d*(1-Q)+f*Q,nt=k?kt:Math.sin(ns),kd=k?Et:Math.cos(ns),os=k?S(Q):xt,au=k?Math.sin(os):Ht,zd=k?Math.cos(os):mt,Ro=h+pe(ci,Ar,ds);Io=kd*zd*Ro,Ol=nt*zd*Ro,jn=au*Ro}let no=0,vn=0,hs=0;{const Q=1*it,ci=k?De:_*(1-Q)+b*Q,ds=k?je:ci,Ar=k?w*(1-Q)+x*Q:ft,ns=k?Tt:d*(1-Q)+f*Q,nt=k?kt:Math.sin(ns),kd=k?Et:Math.cos(ns),os=k?S(Q):xt,au=k?Math.sin(os):Ht,zd=k?Math.cos(os):mt,Ro=h+pe(ci,Ar,ds);no=kd*zd*Ro,vn=nt*zd*Ro,hs=au*Ro}for(let Q=1;Q<G-1;Q+=Re){let ci=0,ds=0,Ar=0;{const Mr=(Q+1)*it,ph=k?De:_*(1-Mr)+b*Mr,Ud=k?je:ph,ta=k?w*(1-Mr)+x*Mr:ft,Ef=k?Tt:d*(1-Mr)+f*Mr,Vv=k?kt:Math.sin(Ef),tT=k?Et:Math.cos(Ef),rw=k?S(Mr):xt,Ca=k?Math.sin(rw):Ht,sw=k?Math.cos(rw):mt,jv=h+pe(ph,ta,Ud);ci=tT*sw*jv,ds=Vv*sw*jv,Ar=Ca*jv}const ns=ci,nt=ds,kd=Ar,os=no,au=vn,zd=hs;no=ns,vn=nt,hs=kd;{const Mr=Fe+Q,ph=Mr*L,Ud=os-M,ta=au-I,Ef=zd-P;F[ph]=Ud,F[ph+1]=ta,F[ph+2]=Ef,xd(Ud,ta,Ef,C);const Vv=Q*it;sf(N,Mr,k?At:Vv,k?Vv:ti)}const Ro=Io,uL=Ol,hL=jn;Io=os,Ol=au,jn=zd;const qt=os,iw=au,bg=zd,eT=1/Math.sqrt(qt*qt+iw*iw+bg*bg),dL=bg*eT;let Sf=0,Bv=0,Tf=0;if(ii&&dL*dL<.999){let Mr=0,ph=0,Ud=0;{const ta=R===0?-1:1;Mr=ta*(ns-Ro),ph=ta*(nt-uL),Ud=ta*(kd-hL)}{const ta=Q*it,Ef=k?De:_*(1-ta)+b*ta,Vv=k?je:Ef,tT=k?w*(1-ta)+x*ta:ft,rw=k?Tt:d*(1-ta)+f*ta,Ca=k?kt:Math.sin(rw),sw=k?Et:Math.cos(rw),jv=k?S(ta):xt,B=k?Math.sin(jv):Ht,he=k?Math.cos(jv):mt;let $e=qt,zt=iw,kr=bg;if(re){const Hr=h+cs(Vv-Ji,tT-Vi,_e),Ds=k?he:Ps;$e=(k?Ki:sw)*Ds*Hr,zt=(k?fi:Ca)*Ds*Hr,kr=(k?B:us)*Hr}{const Hr=h+cs(Ef+Ji,tT+Vi,v),Ds=k?he:er,$a=(k?Mt:sw)*Ds*Hr,Tae=(k?Li:Ca)*Ds*Hr,Eae=(k?B:Gr)*Hr;re||($e=2*qt-$a,zt=2*iw-Tae,kr=2*bg-Eae);const e6=R===3?-1:1,Cae=e6*($e-$a),$ae=e6*(zt-Tae),Aae=e6*(kr-Eae);Sf=Ud*$ae-ph*Aae,Bv=Mr*Aae-Ud*Cae,Tf=ph*Cae-Mr*$ae;const t6=1/Math.sqrt(Sf*Sf+Bv*Bv+Tf*Tf);Sf*=t6,Bv*=t6,Tf*=t6}}}else Sf=qt*eT,Bv=iw*eT,Tf=bg*eT;i.setEdgeNormalFromValues(R,Q,Sf,Bv,Tf)}})()}}function gFe(t){CFe(t)}function yFe(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function BCt(t,e,i,r){return yFe(t*(1-r)+e*r,i)}function VCt(t,e,i){return t*(1-i)+e*i}function Kne(t){const{tile:e}=t;if(e.surface.isWebMercator){const r=e.extent,s=e.ellipsoid.radius;return n=>BCt(r[1],r[3],s,n)}const i=e.extentInRadians;return r=>VCt(i[1],i[3],r)}function jCt(t,e){const{tile:i,geometryState:r,geometry:s}=t,{extent:n,surface:o}=i,{wireframe:a}=r,l=n[0],c=n[1],h=n[2]-l,d=n[3]-c,{numVerticesPerSide:f,clippingArea:m}=r,y=m!=null?Math.max(0,(m[0]-l)/h):0,v=m!=null?Math.max(0,(m[1]-c)/d):0,_=m!=null?Math.min(1,(m[2]-l)/h):1,b=m!=null?Math.min(1,(m[3]-c)/d):1,w=(f-2)**2,x=MFe(r),S=w+4*x,C=o.renderer.tileGeometryCache.acquire(S),{boundingBox:T}=s;ff(T),s.numVerticesPerSide=f,s.vertexAttributes=C,s.maxEdgeVertexCount=x,s.minu=y,s.minv=v,s.maxu=_,s.maxv=b,GCt(t),s.edgeVerticesStartIndex=w,eoe(t),Qne(t),wFe(s,[],a),t.intersectionData=null}function GCt(t){const e=t.tile;if(!e.intersectsClippingArea)return;const{geometry:i,geometryState:r,localOrigin:s}=t,{samplerData:n,clippingArea:o,numVerticesPerSide:a}=r,{surface:l,extent:c,ellipsoid:h}=e,{isWebMercatorOnPlateCarree:d}=l,f=o??toe,m=c[0],y=c[1],v=c[2],_=c[3],b=Math.max(m,f[0]),w=Math.min(v,f[2]),x=Math.max(y,f[1]),S=Math.min(_,f[3]),C=h.radius,T=e.horizontalScale,M=a-1,I=a-2,{minu:P,minv:D,maxu:F,maxv:L,boundingBox:N,vertexAttributes:R}=i,k=R.position,W=R.uv0,{typedBuffer:G,typedBufferStride:j}=R.normalCompressed,re=s[0],ve=s[1],xe=s[2],De=k.typedBuffer,Ke=k.typedBufferStride;let je=0;const ft=ce(y,x,S),At=d?(Math.PI/2-2*Math.atan(Math.exp(-ft/C)))*C:ft*T,ti=1/M,Tt=ce(y*(1-ti)+_*ti,x,S);let xt=At,kt=d?(Math.PI/2-2*Math.atan(Math.exp(-Tt/C)))*C:Tt*T;for(let Et=1;Et<=I;Et++){const Ht=Et/M,mt=ce(y*(1-Ht)+_*Ht,x,S),_e=ce(Ht,D,L),pe=kt,we=(Et-1)/M,Re=ce(y*(1-we)+_*we,x,S),tt=xt,We=(Et+1)/M,ii=ce(y*(1-We)+_*We,x,S),it=d?(Math.PI/2-2*Math.atan(Math.exp(-ii/C)))*C:ii*T,Fe=ce(We,D,L);xt=kt,kt=it;const Me=ce(m,b,w);let Ct=Me*T,Xt=cs(Me,mt,n);const Ji=1/M,Vi=ce(Ji,P,F),Di=ce(m*(1-Vi)+v*Vi,b,w);let Xi=Vi,yr=Di,Mi=Di*T,Li=cs(Di,mt,n);if(Et===1){const Mt=Mi-re,zi=xt-ve,fi=Li-xe,Ki=0*Ke;De[Ki]=Mt,De[Ki+1]=zi,De[Ki+2]=fi,xd(Mt,zi,fi,N);const Qi=ce(Ji,P,F);sf(W,je,Qi,_e)}for(let Mt=1;Mt<=I;Mt++){const zi=Mi,fi=Li,Ki=(Mt+1)/M,Qi=ce(Ki,P,F),Gr=ce(m*(1-Ki)+v*Ki,b,w),er=yr;yr=Gr;{const vn=je+1,hs=vn*Ke;if(Et===1||Mt===I){const Q=Gr*T,ci=cs(Gr,mt,n);if(Et===1&&Mt<I){const ds=Q-re,Ar=pe-ve,ns=ci-xe;De[hs]=ds,De[hs+1]=Ar,De[hs+2]=ns,xd(ds,Ar,ns,N),sf(W,vn,Qi,_e)}Mi=Q,Li=ci}else Mi=De[hs]+re,Li=De[hs+2]+xe}const lr=Mi,us=Li,Ps=Ct,Io=Xt;Ct=zi,Xt=fi;const Ol=(je-I)*Ke,jn=Et===1?cs(er,Re,n):De[Ol+2]+xe,no=cs(er,ii,n);if(Et<I){const vn=je+I,hs=vn*Ke,Q=zi-re,ci=it-ve,ds=no-xe;De[hs]=Q,De[hs+1]=ci,De[hs+2]=ds,xd(Q,ci,ds,N);const Ar=Xi;Xi=Qi,sf(W,vn,Ar,Fe)}{const vn=lr-Ps,hs=tt-it,Q=hs*(us-Io),ci=vn*(jn-no),ds=-hs*vn,Ar=Q*Q+ci*ci+ds*ds;if(Ar===0)Rb(G,je,0,0,1,j);else{const ns=1/Math.sqrt(Ar);Rb(G,je,Q*ns,ci*ns,ds*ns,j)}}++je}}}function HCt(t,e){t.tile.intersectsClippingArea&&(_Fe(t),vFe(t,!0),BA(t),t.intersectionData=null)}function qCt(t,e){t.tile.intersectsClippingArea&&(TFe(t),Qne(t),BA(t),$Fe(t),t.intersectionData=null)}function WCt(t,e){t.tile.intersectsClippingArea&&(Qne(t),BA(t),t.intersectionData=null)}function Qne(t,e){t.tile.intersectsClippingArea&&(_Fe(t),vFe(t,!1))}function vFe(t,e){const{geometry:i,geometryState:r,localOrigin:s}=t,n=t.tile,{surface:o,extent:a}=n,{clippingArea:l,samplerData:c}=r,h=l??toe,d=a[0],f=a[2],m=a[1],y=a[3],v=[y>h[3],f>h[2],m<h[1],d<h[0]],_=n.horizontalScale,b=bFe(o.isWebMercatorOnPlateCarree,n.ellipsoid.radius,_),{minu:w,minv:x,maxu:S,maxv:C,boundingBox:T}=i,M=Math.max(d,h[0]),I=Math.min(f,h[2]),P=Math.max(m,h[1]),D=Math.min(y,h[3]),F=s[0],L=s[1],N=s[2];for(let R=0;R<4;++R){const k=R===1||R===3,W=r.edgeResolutions[R];Oe(EP(W));const G=W+1,j=v[R],re=nx(n,r.edgePeerNeighbors[R]);if(!j&&AFe(n,re,R)){EFe(t,R,re);continue}const ve=re!=null&&!j,xe=re?.renderData,De=xe?.geometryState;if(Jn&&(Oe(!ve||re.level===n.level),Oe(!ve||Am(n,re)<=0),n&&!re&&!o.updatingRootTiles)){const it=Jp[R],Fe=n.findNeighborTile(it,Me=>Me.loaded||Me.leaf||Me.level===n.level);o.updatingRootTiles||(Fe?Fe.intersectsClippingArea&&(Oe(!Fe.loaded),Oe(!Fe.leaf),Oe(Fe.level===n.level)):Oe(o?.rootTiles==null||!n.shouldHaveNeighbor(it)))}const Ke=ce(R===1?f:d,M,I),je=ce(R===0?y:m,P,D),ft=De?.samplerData,At=e&&G>3?G-3:1,ti=ce(R===1?1:0,w,S),Tt=ce(R===0?1:0,x,C),xt=ve?(it,Fe)=>.5*(cs(it,Fe,ft)+cs(it,Fe,c)):(it,Fe)=>cs(it,Fe,c),kt=(f-d)/W,Et=k?R===1?kt:-kt:0,Ht=k?0:R===0?kt:-kt,mt=-Et,_e=-Ht;let pe=0,we=0,Re=0;{const it=0/W,Fe=k?Ke:ce(d*(1-it)+f*it,M,I),Me=k?ce(m*(1-it)+y*it,P,D):je,Ct=xt(Fe,Me);pe=Fe*_,we=b(Me),Re=Ct}let tt=0,We=0,ii=0;{const it=1/W,Fe=k?Ke:ce(d*(1-it)+f*it,M,I),Me=k?ce(m*(1-it)+y*it,P,D):je,Ct=xt(Fe,Me);tt=Fe*_,We=b(Me),ii=Ct}for(let it=1;it<G-1;it+=At){const Fe=it/W,Me=tt,Ct=We,Xt=ii;{const fi=k?ti:ce(Fe,w,S),Ki=k?ce(Fe,x,C):Tt,Qi=Me-F,Gr=Ct-L,er=Xt-N;xd(Me,Gr,er,T),i.setEdgeVertexFromValuesRawPositionUV(R,it,Qi,Gr,er,fi,Ki)}{const fi=(it+1)/W,Ki=k?Ke:ce(d*(1-fi)+f*fi,M,I),Qi=k?ce(m*(1-fi)+y*fi,P,D):je,Gr=xt(Ki,Qi);tt=Ki*_,We=b(Qi),ii=Gr}const Ji=tt,Vi=ii,Di=pe,Xi=we,yr=Re;pe=Me,we=Ct,Re=Xt;let Mi=0,Li=0,Mt=0;if(k){const fi=We-Ct,Ki=Vi-Xt,Qi=Xi-Ct,Gr=yr-Xt,er=ce(m*(1-Fe)+y*Fe,P,D),lr=Ke+mt,us=lr*_-Me,Ps=cs(lr,er,c)-Xt,Io=R===3?-1:1;if(Mi=Io*(-Qi+fi)*Ps,Li=Io*us*(-Gr+Ki),Mt=-Io*us*(-Qi+fi),ve){const Ol=Ke+Et,jn=Ol*_-Me;Mi=(-Qi+fi)*(Ps-(cs(Ol,er,ft)-Xt)),Li=(us-jn)*(-Gr+Ki),Mt=-(us-jn)*(-Qi+fi)}}else{const fi=Ji-Me,Ki=Vi-Xt,Qi=Di-Me,Gr=yr-Xt,er=ce(d*(1-Fe)+f*Fe,M,I),lr=je+_e,us=cs(er,lr,c)-Xt,Ps=b(lr)-Ct,Io=R===2?-1:1;if(Mi=Io*Ps*(-Gr+Ki),Li=Io*(-Qi+fi)*us,Mt=-Io*Ps*(-Qi+fi),ve){const Ol=er,jn=je+Ht,no=b(jn)-Ct;Mi=(-Ps+no)*(-Gr+Ki),Li=(-Qi+fi)*(-us+(cs(Ol,jn,ft)-Xt)),Mt=-(-Ps+no)*(-Qi+fi)}}const zi=1/Math.sqrt(Mi*Mi+Li*Li+Mt*Mt);i.setEdgeNormalFromValues(R,it,Mi*zi,Li*zi,Mt*zi)}}}function _Fe(t,e){CFe(t)}function ZCt(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function YCt(t,e){return t*e}function bFe(t,e,i){return t?r=>ZCt(r,e):r=>YCt(r,i)}function wFe(t,e,i){const{numVerticesPerSide:r,vertexAttributes:s,maxEdgeVertexCount:n}=t,o=r-1,a=s.count,l=2*(r-3)*(r-3),c=4*(o+n-3),h=qne.reduce((v,_)=>v+(o+t.getEdgeCount(_)-3),0),d=e.reduce((v,_)=>v+o*(2*(_.latitudeResolution-1)+1),0),f=3*(i?2:1),m=(l+c+d)*f,y=a>=DCt?new Uint32Array(m):new Uint16Array(m);for(let v=0;v<m;++v)y[v]=0;t.indices=y,t.indexCount=(l+h+d)*f,t.poleIndicesStartIndex=l*f,t.edgeIndicesStartIndex=(l+d)*f,i?(KCt(t),QCt(t,e),SFe(t)):(JCt(t),XCt(t,e),xFe(t))}function JCt(t){const{numVerticesPerSide:e,indices:i,vertexAttributes:r}=t,{position:s}=r,{typedBuffer:n,typedBufferStride:o}=s,a=e-2,l=e-3,c=0,h=e-3;let d=0;for(let f=0;f<l;++f){const m=f*a;for(let y=c;y<h;++y){const v=m+y,_=v+1,b=_+a,w=b-1;OFe(v,_,b,w,o,n)?(i[d]=v,i[d+1]=_,i[d+2]=b,i[d+3]=b,i[d+4]=w,i[d+5]=v):(i[d]=v,i[d+1]=_,i[d+2]=w,i[d+3]=w,i[d+4]=_,i[d+5]=b),d+=6}}}function XCt(t,e){const{numVerticesPerSide:i,indices:r,poleIndicesStartIndex:s}=t,n=i-1;let o=s;for(const a of e){const l=a.isNorth?1:2,c=a.isNorth?2:1,h=a.isNorth?3:4,d=a.isNorth?4:3;let f=t.getEdgeVertexIndex(a.connectedOuterEdgeOffset,0),m=1;for(let y=0;y<a.latitudeResolution;++y){const v=y===0?a.rowOffset:f+i;for(let _=0;_<n;_++){const b=v+_;r[o]=f,r[o+l]=f+1,r[o+c]=b,y<a.latitudeResolution-1?(r[o+h]=f+1,r[o+d]=b+1,r[o+5]=b,o+=6):o+=3,f+=m}f=v,m=1}}}function xFe(t){const{indices:e,numVerticesPerSide:i,edgeIndicesStartIndex:r}=t,s=i-1,n=s-2;let o=r;for(let a=0;a<4;++a){const l=ioe[a];let c=0,h=0;const d=t.getEdgeCount(a),f=l.count;Oe(f===s-1);const m=a===1||a===2,y=m?1:2,v=m?2:1,_=t.getEdgeFirstVertexIndex(a),b=1,w=l.vertex0Index,x=l.stride;for(;c<d-1||h<f-1;){const S=w+h*x,C=_+c*b,T=c<d-1,M=h<f-1,I=T&&(!M||(T?0+s*(c+.5)/(d-1):0)<=(M?1+n*(h+.5)/(f-1):0));I?++c:++h;const P=I?C+b:S+x;e[o]=S,e[o+y]=C,e[o+v]=P,o+=3}}t.indexCount=o}function KCt(t){const{indices:e,numVerticesPerSide:i,vertexAttributes:r}=t,{position:s}=r,{typedBuffer:n,typedBufferStride:o}=s,a=i-2;let l=0;for(let c=0;c<i-3;++c){const h=c*a;for(let d=0;d<i-3;++d){const f=c*a+d,m=f+1,y=m+a,v=y-1,_=h+d,b=_+1,w=b+a;OFe(_,b,w,w-1,o,n)?(aC(e,l,f,m,y),l+=6,aC(e,l,y,v,f)):(aC(e,l,f,m,v),l+=6,aC(e,l,v,y,m)),l+=6}}}function QCt(t,e){const{indices:i,numVerticesPerSide:r,poleIndicesStartIndex:s}=t,n=r-1;let o=s;for(const a of e){const l=a.connectedOuterEdgeOffset;let c=t.getEdgeVertexIndex(l,0),h=1;for(let d=0;d<a.latitudeResolution;++d){const f=d===0?a.rowOffset:c+r;for(let m=0;m<n;m++)aC(i,o,c,c+1,f+m),o+=6,d<a.latitudeResolution-1&&(aC(i,o,c+1,f+m+1,f+m),o+=6),c+=h;c=f,h=1}}}function SFe(t){const{indices:e,numVerticesPerSide:i,edgeIndicesStartIndex:r}=t,s=i-1,n=s-2;let o=r;for(let a=0;a<4;++a){const l=ioe[a];let c=0,h=0;const d=t.getEdgeCount(a),f=l.count;Oe(f===s-1);const m=a===1||a===2,y=m?1:3,v=m?3:1,_=t.getEdgeFirstVertexIndex(a),b=1,w=l.vertex0Index,x=l.stride;for(;c<d-1||h<f-1;){const S=w+h*x,C=_+c*b,T=c<d-1,M=h<f-1,I=T&&(!M||(T?0+s*(c+.5)/(d-1):0)<=(M?1+n*(h+.5)/(f-1):0));I?++c:++h;const P=I?C+b:S+x;e[o]=S,e[o+y]=C,e[o+y+1]=C,e[o+v]=P,e[o+v+1]=P,e[o+5]=S,o+=6}}t.indexCount=o}function eoe(t){const{geometry:e,geometryState:i}=t,{edgeResolutions:r}=i,{numVerticesPerSide:s,edgeVerticesStartIndex:n}=e,o=s-2;let a=n;for(let l=0;l<4;++l){{const c=l===0||l===2,h=(l===0?o-1:0)*o+(l===1?o-1:0),d=(c?0:1)*o+(c?1:0),f=ioe[l];f.vertex0Index=h,f.stride=d,f.count=o}{const c=r[l]+1;e.outerEdgesOffsetAndLength[2*l+0]=a,e.outerEdgesOffsetAndLength[2*l+1]=c,a+=c}}}function TFe(t){eoe(t),t.geometryState.wireframe?SFe(t.geometry):xFe(t.geometry)}function EFe(t,e,i){const{geometryState:r,geometry:s,tile:n,localOrigin:o}=t,a=e===1||e===3,l=r.edgeResolutions[e];Oe(EP(l));const c=l+1,{boundingBox:h,minu:d,minv:f,maxu:m,maxv:y,vertexAttributes:v}=s,_=ce(e===1?1:0,d,m),b=ce(e===0?1:0,f,y),w=i.renderData,x=w.geometryState,S=w.geometry,C=(e+2)%4,T=S.getEdgeCount(C),M=n.getNeighborEdgeStartVertexIndex(e,i)*l,I=l*2**(n.level-i.level);Oe(x.edgeResolutions[C]===I),Oe(T-1===I);const P=w.localOrigin[0]-o[0],D=w.localOrigin[1]-o[1],F=w.localOrigin[2]-o[2],L=s.getEdgeFirstVertexIndex(e),N=v.position,R=N.typedBuffer,k=N.typedBufferStride,W=v.normalCompressed,G=W.typedBuffer,j=W.typedBufferStride,re=v.uv0,ve=S.vertexAttributes,xe=S.getEdgeFirstVertexIndex(C),De=ve.position.typedBuffer,Ke=ve.position.typedBufferStride,je=ve.normalCompressed.typedBuffer,ft=ve.normalCompressed.typedBufferStride;for(let At=1;At<c-1;++At){const ti=L+At,Tt=xe+(M+At),xt=ti*k,kt=Tt*Ke,Et=De[kt]+P,Ht=De[kt+1]+D,mt=De[kt+2]+F;R[xt]=Et,R[xt+1]=Ht,R[xt+2]=mt,xd(Et,Ht,mt,h);const _e=ti*j,pe=Tt*ft;G[_e]=je[pe],G[_e+1]=je[pe+1];const we=At/l,Re=a?_:ce(we,d,m),tt=a?ce(we,f,y):b;sf(re,ti,Re,tt)}}function CFe(t){const{geometry:e,geometryState:i,localOrigin:r}=t,{clippingArea:s,samplerData:n}=i,{minu:o,minv:a,maxu:l,maxv:c,boundingBox:h,vertexAttributes:d}=e,f=t.tile,{surface:m,ellipsoid:y,extent:v,extentInRadians:_,horizontalScale:b}=f,w=m.view?.viewingMode==="local",x=y.radius;let S=0,C=0,T=0;const M=(_e,pe,we)=>{const Re=_[pe===0?1:3],tt=_[_e===0?0:2],We=Math.cos(Re),ii=Math.sin(Re),it=Math.sin(tt),Fe=Math.cos(tt),Me=x+we;S=Fe*We*Me,C=it*We*Me,T=ii*Me},I=w?(()=>{const _e=s,pe=_e!=null&&(v[3]>_e[3]||v[2]>_e[2]||v[1]<_e[1]||v[0]<_e[0]),we=bFe(m.isWebMercatorOnPlateCarree,x,b);return(Re,tt,We)=>{const ii=Re===0?v[0]:v[2],it=tt===0?v[1]:v[3],Fe=pe?ce(ii,_e[0],_e[2]):ii,Me=pe?ce(it,_e[1],_e[3]):it,Ct=We;S=Fe*b,C=we(Me),T=Ct}})():M;let P=0,D=0,F=0,L=0,N=0,R=0,k=0,W=0,G=0;const j=w&&m.isWebMercatorOnPlateCarree,re=(_e,pe,we,Re,tt)=>{let We=0,ii=0,it=0;if(w){const Fe=pe*b,Me=j?(Math.PI/2-2*Math.atan(Math.exp(-we/x)))*x:we*b;We=Fe-S,ii=Me-C,it=Re-T}else{const Fe=Kne(_e),Me=_e.tile,Ct=Me.extent,Xt=Me.extentInRadians,Ji=(pe-Ct[0])/(Ct[2]-Ct[0]),Vi=(we-Ct[1])/(Ct[3]-Ct[1]),Di=Xt[0]*(1-Ji)+Xt[2]*Ji,Xi=Fe(Vi),yr=Math.cos(Xi),Mi=Math.sin(Xi),Li=Math.sin(Di),Mt=Math.cos(Di),zi=x+Re;We=Mt*yr*zi-S,ii=Li*yr*zi-C,it=Mi*zi-T}switch(tt){case 0:k+=We,W+=ii,G+=it;break;case 1:L-=We,N-=ii,R-=it;break;case 2:k-=We,W-=ii,G-=it;break;case 3:L+=We,N+=ii,R+=it}},ve=s??toe,xe=v[0],De=v[2],Ke=v[1],je=v[3],ft=[je>ve[3],De>ve[2],Ke<ve[1],xe<ve[0]],At=Math.max(xe,ve[0]),ti=Math.min(De,ve[2]),Tt=Math.max(Ke,ve[1]),xt=Math.min(je,ve[3]),kt=_e=>Math.max(ve[0],Math.min(ve[2],_e)),Et=_e=>Math.max(ve[1],Math.min(ve[3],_e)),Ht=_e=>{const pe=i.cornerNeighborCornerTiles;P=0,D=0,F=1,L=0,N=0,R=0,k=0,W=0,G=0;let we=1/0;for(let Fe=0;Fe<4;++Fe){const Me=pe[4*_e+Fe];we=Math.min(we,Me?.level??1/0)}for(let Fe=0;Fe<4;++Fe){const Me=pe[4*_e+Fe];KM[Fe]=Me?.level===we?Me:null}let Re=1,tt=0;for(let Fe=0;Fe<4;++Fe){const Me=KM[Fe];Me&&(Re=Math.max(Re,Me?.renderData.geometryState.numVerticesPerSide),tt=Me.extent[2]-Me.extent[0])}const We=tt,ii=Re;Oe(ii>1);const it=We/ii;for(let Fe=0;Fe<4;++Fe){const Me=KM[(Fe+3)%4],Ct=KM[Fe%4];if(!Me&&!Ct)continue;const Xt=Fe===0?1:Fe===1?2:Fe===2?3:0,Ji=Fe===0?2:Fe===1?3:Fe===2?0:1;if(Me&&Ct){const Vi=wq[Fe][0]*it,Di=wq[Fe][1]*it,Xi=Me.extent,yr=kt(Xi[Xt===0||Xt===1?2:0]+Vi),Mi=Et(Xi[Xt===0||Xt===3?3:1]+Di),Li=Ct.extent,Mt=kt(Li[Ji===0||Ji===1?2:0]+Vi),zi=Et(Li[Ji===0||Ji===3?3:1]+Di),fi=Me.renderData,Ki=Ct.renderData,Qi=cs(yr,Mi,fi.geometryState.samplerData),Gr=cs(Mt,zi,Ki.geometryState.samplerData);re(fi,yr,Mi,.5*(Qi+Gr),Fe)}else{const Vi=Me??Ct,Di=Me?Xt:Ji,Xi=Vi.extent,yr=wq[Fe],Mi=kt(Xi[Di===0||Di===1?2:0]+yr[0]*it),Li=Et(Xi[Di===0||Di===3?3:1]+yr[1]*it),Mt=Vi.renderData,zi=cs(Mi,Li,Mt.geometryState.samplerData);re(Mt,Mi,Li,zi,Fe)}}if(!w){const Fe=Math.sqrt(S*S+C*C+T*T);P=S/Fe,D=C/Fe,F=T/Fe}if(w||F*F<.999){const Fe=Math.sqrt(L*L+N*N+R*R);L/=Fe,N/=Fe,R/=Fe;const Me=Math.sqrt(k*k+W*W+G*G);k/=Me,W/=Me,G/=Me,P=R*W-N*G,D=L*G-R*k,F=N*k-L*W;const Ct=1/Math.sqrt(P*P+D*D+F*F);P*=Ct,D*=Ct,F*=Ct}},mt=i.cornerNeighborCornerTiles;for(let _e=0;_e<4;++_e){const pe=_e,we=(_e+1)%4,Re=_e===0||_e===1?1:0,tt=_e===0||_e===3?1:0,We=ce(Re,o,l),ii=ce(tt,a,c),it=e.getEdgeFirstVertexIndex(pe),Fe=e.getEdgeCount(pe),Me=_e===0||_e===3?Fe-1:0,Ct=e.getEdgeFirstVertexIndex(we),Xt=e.getEdgeCount(we),Ji=_e===0||_e===1?Xt-1:0;let Vi=-1;for(let yr=0;yr<4;++yr){const Mi=mt[4*_e+yr],Li=mt[4*_e+Vi];Mi&&(Vi===-1||Am(Li,Mi)>0)&&(Vi=yr)}const Di=Vi,Xi=mt[4*_e+Di];if(Xi!==f){const yr=f.level-Xi.level,Mi=2**yr,Li=[Xi.lij[0]+yr,Xi.lij[1]*Mi,Xi.lij[2]*Mi],Mt=[Li[1]+Mi===f.lij[1],_e===0&&(Di===1||Di===0&&Xi!==mt[4*_e+3])||_e===1&&(Di===0||Di===1&&Xi!==mt[4*_e+2]),Li[1]===f.lij[1]+1,_e===2&&(Di===3||Di===2&&Xi!==mt[4*_e+1])||_e===3&&(Di===2||Di===3&&Xi!==mt[4*_e+0])],zi=Mt.reduce((er,lr)=>er+(lr?1:0),0);Oe(zi===1||zi===2);let fi=-1,Ki=-1;const Qi=Xi.renderData;if(zi===1){const er=Mt.findIndex(us=>us);Oe(0<=er&&er<=3),fi=(er+2)%4;const lr=i.edgeResolutions[er];Ki=f.getNeighborEdgeStartVertexIndex(er,Xi)*lr+lr*(er===0&&_e===0||er===1&&_e===0||er===2&&_e===1||er===3&&_e===3?1:0)}else{Oe(Mt[1]||Mt[3]),fi=Mt[1]?3:1;const er=Qi.geometryState.edgeResolutions[fi];Ki=_e===0||_e===3?0:er}const Gr=Qi.geometry;{const er=it+Me,lr=Ct+Ji,us=Gr.getEdgeFirstVertexIndex(fi)+Ki,Ps=Gr.vertexAttributes,Io=Qi.localOrigin;{const jn=Ps.position,no=jn.typedBuffer,vn=us*jn.typedBufferStride,hs=no[vn]+Io[0]-r[0],Q=no[vn+1]+Io[1]-r[1],ci=no[vn+2]+Io[2]-r[2];xd(hs,Q,ci,h);const ds=d.position,Ar=ds.typedBuffer;{const ns=er*ds.typedBufferStride;Ar[ns]=hs,Ar[ns+1]=Q,Ar[ns+2]=ci}{const ns=lr*ds.typedBufferStride;Ar[ns]=hs,Ar[ns+1]=Q,Ar[ns+2]=ci}}const Ol=d.uv0;sf(Ol,er,We,ii),sf(Ol,lr,We,ii);{const jn=Ps.normalCompressed.typedBuffer,no=us*Ps.normalCompressed.typedBufferStride,vn=d.normalCompressed,hs=vn.typedBuffer;{const Q=er*vn.typedBufferStride;hs[Q]=jn[no],hs[Q+1]=jn[no+1]}{const Q=lr*vn.typedBufferStride;hs[Q]=jn[no],hs[Q+1]=jn[no+1]}}}}else{const yr=ft[pe],Mi=ft[we];let Li;if(yr||Mi){const Ki=ce(xe*(1-Re)+De*Re,At,ti),Qi=ce(Ke*(1-tt)+je*tt,Tt,xt);Li=cs(Ki,Qi,n)}else Li=e$t(mt,_e);I(Re,tt,Li),Ht(_e);const Mt=S-r[0],zi=C-r[1],fi=T-r[2];xd(Mt,zi,fi,h),e.setEdgeVertexFromValuesRawPositionUVNormal(pe,Me,Mt,zi,fi,We,ii,P,D,F),e.setEdgeVertexFromValuesRawPositionUVNormal(we,Ji,Mt,zi,fi,We,ii,P,D,F)}}for(let _e=0;_e<4;++_e)KM[_e]=null}function e$t(t,e){const i=4*e,r=qne.reduce((a,l)=>Math.min(a,t[i+l]?.level??1/0),1/0);Jn&&(Oe(!t[i+0]||!t[i+2]||AX(t[i+0],t[i+2],rt.SOUTH_WEST)),Oe(!t[i+1]||!t[i+3]||AX(t[i+1],t[i+3],rt.NORTH_WEST)));let s=0,n=0;for(let a=0;a<4;++a){const l=t[i+a];if(l&&l.level===r){const c=a===0||a===1,h=a===0||a===3,d=l.extent,f=d[c?0:2],m=d[h?1:3],y=l.renderData?.geometryState?.samplerData;n+=cs(f,m,y),s++}}const o=s?n/s:0;return Oe(o!=null),o}function BA(t){const{vao:e,geometry:i}=t,{vertexAttributes:r,edgeVerticesStartIndex:s}=i,n=r.position.typedBuffer;e.vertexBuffers.get("geometry").setSubData(n,s,s,n.length)}function $Fe(t){const{vao:e,geometry:i}=t,{indices:r,indexCount:s,edgeIndicesStartIndex:n}=i;e.indexBuffer.setSubData(r,n,n,s)}let t$t=class{constructor(e,i,r,s,n){this.isNorth=e,this.connectedRowOffset=i,this.connectedOuterEdgeOffset=r,this.rowOffset=s,this.latitudeResolution=n}};const wq=[[0,1],[1,0],[0,-1],[-1,0]],Uo=new J2t,toe=lte(-1/0,-1/0,1/0,1/0),KM=[null,null,null,null];function AFe(t,e,i){if(!e)return!1;const r=Am(t,e);return r>0||r===0&&i>=2}let IF=class{constructor(){this.vertex0Index=0,this.stride=1,this.count=0}getVertexIndex(e){return Oe(0<=e&&e<this.count),this.vertex0Index+this.stride*e}};const ioe=[new IF,new IF,new IF,new IF];function xd(t,e,i,r){t<r[0]?r[0]=t:t>r[3]&&(r[3]=t),e<r[1]?r[1]=e:e>r[4]&&(r[4]=e),i<r[2]?r[2]=i:i>r[5]&&(r[5]=i)}function MFe(t){const{edgeResolutions:e,numVerticesPerSide:i}=t,r=1+Math.max(...e);return Math.max(i,r)}function OFe(t,e,i,r,s,n){const o=t*s,a=n[o],l=n[o+1],c=n[o+2],h=e*s,d=n[h],f=n[h+1],m=n[h+2],y=i*s,v=n[y],_=n[y+1],b=n[y+2],w=r*s,x=n[w],S=n[w+1],C=n[w+2];return(d-x)*(d-x)+(f-S)*(f-S)+(m-C)*(m-C)>(a-v)*(a-v)+(l-_)*(l-_)+(c-b)*(c-b)}function aC(t,e,i,r,s){t[e]=i,t[e+1]=r,t[e+2]=r,t[e+3]=s,t[e+4]=s,t[e+5]=i}const g5=6;let i$t=class extends Zne{constructor(e,i,r,s,n){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=Qt(),this._baseUsedMemory=900,this._subtreeGeometryElevationBoundMin=0,this._subtreeGeometryElevationBoundMax=0,this.init(e,i,r,s,n)}init(e,i,r,s,n){super.init(e,i,r,s,n);const o=n.view.renderSpatialReference,a=n.spatialReference,l=o!=null&&OP(o)&&a!=null&&a.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=l;const{isWebMercatorOnPlateCarree:c}=n,h=this._extentInRenderSR,d=this.extent;if(c){const f=Le(d[0],d[1],0);mc(f,Ae.WebMercator,f,Ae.PlateCarree);const m=Le(d[2],d[3],0);mc(m,Ae.WebMercator,m,Ae.PlateCarree),h[0]=f[0],h[1]=f[1],h[2]=m[0],h[3]=m[1]}else for(let f=0;f<4;++f)h[f]=d[f]*l;this.centerAtSeaLevel[0]=.5*(h[0]+h[2]),this.centerAtSeaLevel[1]=.5*(h[1]+h[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(h[2]-h[0],h[3]-h[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,i=.5*(e[2]-e[0]),r=.5*(e[3]-e[1]),s=Math.sqrt(i*i+r*r),n=.5*(this.elevationBoundsMax-this.elevationBoundsMin),o=Math.max(s,n);this._center[tn.MIDDLE][3]=o}_calculateFrustumVisibility(e){const i=this._aabb(),r=i[0],s=i[1],n=i[2],o=i[3],a=i[4],l=i[5];let c=!0;for(let h=0;h<6;h++){const d=e[h],f=d[0],m=d[1],y=d[2],v=d[3];if(f*(f>0?r:o)+m*(m>0?s:a)+y*(y>0?n:l)+v>=0)return ja.OUTSIDE;c=c&&f*(f<0?r:o)+m*(m<0?s:a)+y*(y<0?n:l)+v<=0}return c?ja.INSIDE:ja.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return pXe(e[0],e[1],Math.min(this.elevationBoundsMin,this._subtreeGeometryElevationBoundMin),e[2],e[3],Math.max(this.elevationBoundsMax,this._subtreeGeometryElevationBoundMax))}intersectsRay(e,i,r,s){return RF[0]=1/i[0],RF[1]=1/i[1],RF[2]=1/i[2],dse(this._aabb(),e,RF,r,s)}createGeometry(){jCt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds(),this.setMemoryDirty()}_updateSubtreeGeometryElevationsBounds(){const e=this._subtreeGeometryElevationBoundMin,i=this._subtreeGeometryElevationBoundMax,r=this.renderData;let s=e,n=i;if(r){const o=r.geometry.boundingBox;s=o[2],n=o[5]}else if(!this.leaf){s=1/0,n=-1/0;for(const o of this.children){const a=o;s=Math.min(s,a._subtreeGeometryElevationBoundMin),n=Math.max(n,a._subtreeGeometryElevationBoundMax)}}(s!==this._subtreeGeometryElevationBoundMin||n!==this._subtreeGeometryElevationBoundMax)&&(this._subtreeGeometryElevationBoundMin=s,this._subtreeGeometryElevationBoundMax=n,this.parent?._updateSubtreeGeometryElevationsBounds())}get minimumVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){HCt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevations(){WCt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevationsAndResolutions(){qCt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}get horizontalScale(){return this._horizontalScaleFactor}};const RF=$();let r$t=class{constructor(){this.extent=pi(),this.minLevel=0,this.maxLevel=0,this.callback=null}},y5=class extends ue{constructor(){super(...arguments),this._queries=new Jt({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Jt({initialSize:30}),this._queryPool=new Cl(r$t)}queryVisibleLevelRange(e,i,r,s){const n=this._queryPool.acquire();yd(n.extent,e),n.minLevel=i??-Number.MAX_VALUE,n.maxLevel=r??Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const i=this._queries.data[e];this._queryPool.release(i),i.callback(e>=this._queriesInvPtr),i.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const i=e.level;let r=0;for(;r<this._queriesInvPtr;){const s=this._queries.data[r],n=s.extent;i>=s.minLevel&&i<=s.maxLevel&&n[0]<=e.extent[2]&&n[2]>=e.extent[0]&&n[1]<=e.extent[3]&&n[3]>=e.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}};u([p()],y5.prototype,"updating",null),y5=u([A("esri.views.3d.terrain.ScaleRangeQueries")],y5);function s$t(t,e,i,r){const s=Math.cos(i);t[0]=Math.cos(e)*s*r,t[1]=Math.sin(e)*s*r,t[2]=Math.sin(i)*r}let n$t=class extends Zne{constructor(e,i,r,s,n){super(),this._convexHull=new Array(24),this._boundingSphere=Rs(),this._baseUsedMemory=1816,this.init(e,i,r,s,n)}init(e,i,r,s,n){super.init(e,i,r,s,n);const o=this.ellipsoid.radius,a=this.extentInRadians[0],l=this.extentInRadians[1],c=this.extentInRadians[2],h=this.extentInRadians[3],d=dt(l,h,.5),f=dt(a,c,.5),m=e===0?0:Math.min(Math.abs(l),Math.abs(h));this._edgeLen=(c-a)*Math.cos(m)*o,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=o-Math.sqrt(o*o-this._edgeLen2/4),s$t(this.centerAtSeaLevel,f,d,this.ellipsoid.radius),ae(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)se(e[tn.MIDDLE],0,0,0),se(e[tn.TOP],0,0,0),se(e[tn.BOTTOM],0,0,0),e[tn.MIDDLE][3]=this.ellipsoid.radius+this.elevationBoundsMax;else{this._updateCenter();const i=e[tn.MIDDLE],r=this.convexHull;let s=0;for(let n=0;n<8;++n)s=Math.max(s,o$t(i,r,3*n));e[tn.MIDDLE][3]=Math.sqrt(s)}}_calculateFrustumVisibility(e){if(!J_(e,this._boundingSphere))return ja.OUTSIDE;if(this.lij[0]<10)return ja.INTERSECTS;const i=this.convexHull,r=this.surface.view.state.camera.near;let s=!0;for(let n=0;n<kA;n++){const o=n===_o.NEAR,a=e[n],l=a[0],c=a[1],h=a[2],d=a[3]-(o?r:0);let f=!1;for(let m=0;m<8;++m){const y=3*m;if(l*i[y]+c*i[y+1]+h*i[y+2]+d<0){if(f=!0,!s)break}else s=!1}if(!f)return ja.OUTSIDE}return s?ja.INSIDE:ja.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){LCt(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),Jn&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,i=e,r=this.elevationBoundsMin,s=this.elevationBoundsMax,n=this.ellipsoid.radius,o=s;if(this.level===0)se(i,0,0,0),e[3]=n+o;else{const a=this.extentInRadians,l=.5*(a[0]+a[2]),c=a[1],h=a[3];Fw(yye,l,c,n),Fw(vye,l,h,n),oe(i,yye,vye),ie(i,i,(n+.5*(r+s))/Ba(i));const d=this.convexHull;let f=0;const m=(v,_)=>{const b=v[0]-d[3*_],w=v[1]-d[3*_+1],x=v[2]-d[3*_+2];return Math.sqrt(b*b+w*w+x*x)};for(let v=0;v<8;++v){const _=m(i,v);f=Math.max(f,_)}const y=f;e[3]=y+2}}_updateConvexHull(){const e=this.extentInRadians,i=this.ellipsoid.radius;if(this.level===0)return;const r=this.elevationBoundsMin,s=this.elevationBoundsMax,n=this._getPatchType(),o=this.surface.isWebMercator,a=o&&n===sd.HAS_NORTH_POLE,l=o&&n===sd.HAS_SOUTH_POLE,c=l||a,h=Math.PI/2,d=e[0],f=e[2],m=l?-h:e[1],y=a?h:e[3],v=.5*(d+f),_=r,b=i+(c?Math.min(0,_-1):_),w=(G,j,re)=>Fw(G,j,re,b),x=$(),S=$(),C=$(),T=$();w(x,d,m),w(S,d,y),w(C,f,y),w(T,f,m);const M=(G,j)=>{for(let re=0;re<3;++re)this._convexHull[3*j+re]=G[re]};M(x,0),M(S,1),M(C,2),M(T,3);const I=s,P=i+(c?Math.max(0,I+1):I),D=$(),F=$(),L=$();Fw(F,v,y,b),Fw(L,v,m,b),oe(D,F,L),ae(D,D);const N=$(),R=$(),k=(G,j)=>{Ri(R,G,j),ae(R,R);const re=-de(G,N)/de(R,N);Oe(re>=0),ie(R,R,re),oe(G,G,R)};if(2**this.lij[0]>2*this.lij[1]){const G=L,j=$();lt(j,gye,G),ae(j,j),lt(N,G,j),ae(N,N),Oe(od(de(N,G)/Ba(G),0)),k(x,S),k(T,C),M(x,0),M(T,3)}else if(2**this.lij[0]!==2*this.lij[1]){const G=F,j=$();lt(j,gye,G),ae(j,j),lt(N,j,G),ae(N,N),k(S,x),k(C,T),M(S,1),M(C,2)}const W=(G,j)=>{const re=P/de(j,D);for(let ve=0;ve<3;++ve)this._convexHull[3*G+ve]=j[ve]*re};W(4,x),W(5,S),W(6,C),W(7,T)}_getPatchType(){const e=this.lij[1],i=e===0,r=e===(1<<this.level)-1;return i?r?sd.HAS_BOTH_POLES:sd.HAS_NORTH_POLE:r?sd.HAS_SOUTH_POLE:sd.REGULAR}intersectsRay(e,i,r,s){const n=this._boundingSphere,o=n[3]+r,a=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=n[0]-e[0],c=n[1]-e[1],h=n[2]-e[2],d=(l*i[0]+c*i[1]+h*i[2])/a,f=i[0]*d-l,m=i[1]*d-c,y=i[2]*d-h;return f*f+m*m+y*y<o*o}get minimumVerticesPerSide(){return this.level<mye.length?mye[this.level]+1:2}updateCornerElevations(){UCt(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){kCt(this.renderData),this._updateBoundingVolumes()}updateEdgeElevationsAndResolutions(){zCt(this.renderData),this._updateBoundingVolumes()}_checkBVs(){if(!Jn||this.level<=2)return;const e=this._boundingSphere,i=e[3],r=e,s=$(),n=this.ellipsoid.radius,o=this.elevationBoundsMin,a=this.elevationBoundsMax,l=n+o,c=1,h=0,d=this._center[tn.MIDDLE][3],f=this.convexHull,m=(pe,we)=>{for(let Re=0;Re<3;++Re)pe[Re]=f[3*we+Re]};{const pe=$(),we=$(),Re=$(),tt=$(),We=$(),ii=(it,Fe,Me,Ct)=>{m(we,it),m(Re,Fe),m(tt,Me),Ri(we,we,Re),Ri(tt,tt,Re),lt(pe,we,tt),ae(pe,pe);const Xt=de(pe,Re);m(We,Ct);const Ji=de(pe,We),Vi=Math.abs(Ji-Xt);Oe(od(Vi,0),`Non coplanar ${it},${Fe},${Me},${Ct} diff = ${Vi}`)};ii(0,1,2,3),ii(4,5,6,7),ii(0,1,4,5),ii(1,2,5,6),ii(2,3,6,7),ii(3,0,7,4)}const y=oc(24),v=(pe,we,Re)=>{const tt=4*pe;for(let We=0;We<3;++We)y[tt+We]=we[We];y[tt+3]=Re},_=$(),b=$(),w=$(),x=$(),S=(pe,we,Re,tt)=>{m(_,we),m(b,Re),m(w,tt),Ri(_,_,b),ae(_,_),Ri(w,w,b),ae(w,w),lt(x,_,w),ae(x,x);const We=de(x,b);v(pe,x,We)};S(0,0,1,2),S(1,1,0,4),S(2,1,5,2),S(3,3,2,6),S(4,4,0,3),S(5,4,6,5);const C=(pe,we,Re,tt)=>{const We=4*pe;return y[We]*we+y[We+1]*Re+y[We+2]*tt-y[We+3]},T=(pe,we,Re,tt)=>C(pe,we,Re,tt)>=-1,M=(pe,we)=>T(pe,we[0],we[1],we[2]),I=2**this.lij[0]>2*this.lij[1],P=(pe,we,Re)=>Math.sqrt(IFe(pe,we,Re,r[0],r[1],r[2]))<i,D=pe=>P(pe[0],pe[1],pe[2]),F=(pe,we)=>P(pe[we],pe[we+1],pe[we+2]),L=this.extentInRadians,N=.5*(L[0]+L[2]),R=L[1],k=L[3],W=$(),G=$();Fw(W,N,k,l),Fw(G,N,R,l);const j=I?"Upper":"Lower";let re=!0;for(let pe=0;pe<6;++pe){for(let we=0;we<8;++we){const Re=3*we,tt=T(pe,f[Re],f[Re+1],f[Re+2]);re&&=tt,Oe(tt,`Tile[${this.lij}] Convex hull point ${we} outside of plane ${pe}`)}Oe(M(pe,G),`Tile[${this.lij}] (${j}) bottom mid outside of plane ${pe}`),Oe(M(pe,W),`Tile[${this.lij}] (${j}) top mid outside of plane ${pe}`)}Oe(re,"Not all convex hull points are inside  convex hull polyhedron"),Oe(D(G),`Tile[${this.lij}] (${j}) bottom mid outside of bounding sphere`),Oe(D(W),`Tile[${this.lij}] (${j}) top mid outside of bounding sphere`);for(let pe=0;pe<8;++pe){const we=F(f,3*pe);Oe(we,`Tile[${this.lij}] Convex hull point ${pe} outside of bounding sphere`)}for(let pe=0;pe<6;++pe)for(let we=0;we<8;++we){const Re=3*we;T(pe,f[Re],f[Re+1],f[Re+2])||console.error(`Tile[${this.lij}] Convex hull point ${we} outside of plane ${pe}`)}const{extentInRadians:ve}=this,xe=Math.max(ve[2]-ve[0],ve[3]-ve[1]),De=Math.round(xe*n),{renderData:Ke}=this;if(!Ke)return;const{geometry:je,geometryState:ft,localOrigin:At}=Ke,ti=je.vertexAttributes?.position;if(!ti)return;const Tt=$(),xt=je.numVerticesPerSide-2,{indices:kt,indexCount:Et,edgeVerticesStartIndex:Ht,poleVerticesStartIndex:mt}=je;if(!kt)return;const _e=new Set;for(let pe=0;pe<Et;++pe){const we=kt[pe];if(_e.has(we))continue;_e.add(we);const Re=we<mt,tt=we>=Ht;let We=!1,ii=-1;if(tt){let Mt=Ht;for(let zi=0;zi<4;++zi){const fi=ft.edgeResolutions[zi];if(we===Mt||we===Mt+fi-1){We=!0;break}if(Mt+=fi,we<Mt){ii=zi;break}}}const it=tt?ft.edgePeerNeighbors[ii]:null,Fe=tt&&it&&Am(this,it)>0;ti.getVec(we,s),oe(Tt,s,At);const Me=Ba(Tt)-n;let Ct=0,Xt=!1;const Ji=o-Me,Vi=Me-a,Di=Ji>c,Xi=Vi>c,yr=Di||Xi,Mi=()=>{const Mt=Re?"internal":tt&&!We?"edge":We?"corner":"pole";return`Tile[${this.lij}].vertex[${we}]:${Mt}`+(Di?"(below)":Xi?"(above)":"")+(Fe?"(Neighbor)":"")},Li=za(Tt,r);if(Li>=i+h){const Mt=Li-i;yr||(console.error(`${Mi()} is out of the bounding sphere by ${Mt.toFixed(0)} / ${i.toFixed(0)}[tol=${h}] h=${Me.toFixed(0)} / [${o.toFixed(0)}..${a.toFixed(0)}] (${(Mt/i).toFixed(0)})`),Xt=!0)}for(let Mt=0;Mt<6;++Mt)if(!T(Mt,Tt[0],Tt[1],Tt[2])){const zi=C(Mt,Tt[0],Tt[1],Tt[2]),fi=we%xt,Ki=(we-fi)/xt;Mt===0&&Ji||Mt===5&&Vi||(console.error(`${Mi()} (${fi},${Ki})|${xt}] is out of the bounding trapezoid plane ${Mt} h=${Math.round(Me)} / [${Math.round(o)}..${Math.round(a)}] dist=${Math.round(zi)} radii = ${Math.round(i)}/${Math.round(d)}} : maxL = ${De}`),++Ct)}if(Xt||Ct>0)break}}get convexHull(){return this._convexHull}};const mye=[128,64,64,32,16,8,8,4];function o$t(t,e,i){return IFe(t[0],t[1],t[2],e[i],e[i+1],e[i+2])}function IFe(t,e,i,r,s,n){const o=r-t,a=s-e,l=n-i;return o*o+a*a+l*l}const Fw=(t,e,i,r)=>{const s=Math.cos(e),n=Math.sin(e),o=Math.cos(i),a=Math.sin(i);t[0]=r*o*s,t[1]=r*o*n,t[2]=r*a},gye=[0,0,1],yye=$(),vye=$();let yp=class extends ue{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};u([p()],yp.prototype,"fovX",void 0),u([p()],yp.prototype,"fovY",void 0),u([p()],yp.prototype,"relativeWidthLimit",void 0),u([p()],yp.prototype,"relativeHeightLimit",void 0),u([p()],yp.prototype,"maxLod",void 0),u([p()],yp.prototype,"angledSplitBias",void 0),u([p()],yp.prototype,"aboveGround",void 0),u([p()],yp.prototype,"frustum",void 0),yp=u([A("esri.views.3d.terrain.SplitLimits")],yp);const a$t=Nd().vec3f(z.POSITION).vec2i16(z.UV0).vec2i16(z.NORMALCOMPRESSED,{glNormalized:!0});let l$t=class{constructor(e){this._storage=new XD((i,r)=>e.newCache(i,r),"TileGeometry")}acquire(e){const r=Math.ceil(e/4)*4,s=this._storage,n=c$t(r),o=s.pop(n);if(o)return o;const a=a$t.createBuffer(r);return a.release=()=>s.put(n,a),a}clear(){this._storage.clear()}destroy(){this._storage.destroy()}};function c$t(t){return t.toString()}let RFe=class extends ar{constructor(){super(...arguments),this.scale=1,this.offset=rS}};function PFe(t){t.attributes.add(z.POSITION,"vec2"),t.attributes.add(z.UV0,"vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.uniforms.add(new pt("scale",e=>e.scale),new fc("offset",e=>e.offset)),t.vertex.main.add(E`gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;`)}var hn;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(hn||(hn={}));var Pe;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(Pe||(Pe={}));const MX={normal:Pe.Normal,average:Pe.Average,lighten:Pe.Lighten,lighter:Pe.Lighter,screen:Pe.Screen,plus:Pe.Plus,"color-dodge":Pe.ColorDodge,darken:Pe.Darken,multiply:Pe.Multiply,"color-burn":Pe.ColorBurn,overlay:Pe.Overlay,"soft-light":Pe.SoftLight,"hard-light":Pe.HardLight,"vivid-light":Pe.VividLight,hue:Pe.Hue,saturation:Pe.Saturation,luminosity:Pe.Luminosity,color:Pe.Color,difference:Pe.Difference,exclusion:Pe.Exclusion,minus:Pe.Minus,invert:Pe.Invert,reflect:Pe.Reflect,"destination-over":Pe.DestinationOver,"destination-atop":Pe.DestinationAtop,"destination-in":Pe.DestinationIn,"destination-out":Pe.DestinationOut,"source-atop":Pe.SourceAtop,"source-in":Pe.SourceIn,"source-out":Pe.SourceOut,xor:Pe.Xor};function u$t(t){return t===Pe.DestinationOver||t===Pe.DestinationAtop||t===Pe.DestinationIn||t===Pe.DestinationOut||t===Pe.SourceAtop||t===Pe.SourceIn||t===Pe.SourceOut||t===Pe.Xor}var Na;(function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"})(Na||(Na={}));var Yh;(function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"})(Yh||(Yh={}));function h$t(t,e){const i=e.blendMode;i!==Pe.Normal&&(i===Pe.Reflect&&t.code.add(E`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),i!==Pe.ColorDodge&&i!==Pe.VividLight||t.code.add(E`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),i!==Pe.ColorBurn&&i!==Pe.VividLight||t.code.add(E`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),i===Pe.Overlay&&t.code.add(E`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),i===Pe.HardLight&&t.code.add(E`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),i===Pe.SoftLight&&t.code.add(E`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),i===Pe.VividLight&&t.code.add(E`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),i!==Pe.Hue&&i!==Pe.Saturation&&i!==Pe.Color&&i!==Pe.Luminosity||(t.code.add(E`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),i!==Pe.Hue&&i!==Pe.Saturation||t.code.add(E`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(E`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${i===Pe.Multiply?E`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.Average?E`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.Lighten?E`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.Darken?E`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.Lighter?E`return vec4(cl * ol + cb * ob, ol + ob);`:i===Pe.Plus?E`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:i===Pe.Minus?E`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:i===Pe.Screen?E`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.Difference?E`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.Invert?E`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Pe.DestinationOver?E`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:i===Pe.DestinationAtop?E`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:i===Pe.DestinationOut?E`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:i===Pe.SourceAtop?E`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Pe.SourceOut?E`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:i===Pe.Xor?E`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:i===Pe.DestinationIn?E`return vec4(cb * ob * ol, ol * ob);`:i===Pe.SourceIn?E`return vec4(cl * ol * ob, ol * ob);`:i===Pe.Hue?E`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.Saturation?E`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.Color?E`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.Luminosity?E`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.Exclusion?E`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.Reflect?E`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.ColorDodge?E`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.ColorBurn?E`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.Overlay?E`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.SoftLight?E`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.HardLight?E`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Pe.VividLight?E`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:E``}
    }
  `))}function DFe(t,e){const i=e.output===hn.GridComposite,r=e.output===hn.ColorComposite,s=e.output===hn.GroupBackgroundComposite,n=e.output===hn.Composite,o=e.baseOpacityMode===Na.Required,a=t.fragment;o&&a.uniforms.add(new pt("baseOpacity",d=>d.baseOpacity)),i?a.include(Gne):r?a.uniforms.add(new Cr("backgroundColor",d=>d.backgroundColor)):n&&a.uniforms.add(new $t("fboColor",d=>d.fboTexture));const l=e.blendMode!==Pe.Normal,c=e.premultipliedSource===Yh.On,h=!l&&!c&&(n&&!o||s);a.include(h$t,e),a.code.add(E`
    vec4 getBackground(vec2 uv) {
      return ${o?E`baseOpacity *`:""} ${s?E`vec4(0.0, 0.0, 0.0, 0.0)`:r?E`vec4(backgroundColor, 1.0)`:i?E`vec4(gridColor(uv), 1.0)`:E`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec2 bgUV, vec4 colorLayer, float opacity) {
      ${l?E`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec4 bgColor = getBackground(bgUV);
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:E`
          float composeAlpha = colorLayer.a * opacity;
          ${h?E`return colorLayer * opacity;`:E`
            vec4 bgColor = getBackground(bgUV);
            return bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}var Sv;function LFe(t){const e=new ki,i=e.fragment;if(e.include(PFe),t.background===Sv.Only){const r=t.output===hn.ColorComposite;return r?i.uniforms.add(new Cr("backgroundColor",s=>s.backgroundColor)):i.include(Gne),i.main.add(E`fragColor = vec4(${r?E`backgroundColor`:E`gridColor(uv)`}, 1.0);`),e}return e.include(DFe,t),i.uniforms.add(new $t("tex",r=>r.texture),new pt("opacity",r=>r.opacity)),i.main.add(E`fragColor = blendLayers(uv, texture(tex, uv), opacity);`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(Sv||(Sv={}));const d$t=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return Sv},build:LFe},Symbol.toStringTag,{value:"Module"}));let p$t=class extends RFe{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=on}},_ye=class extends Bi{constructor(e,i){super(e,i,new Fi(d$t,()=>V(()=>Promise.resolve().then(()=>zGt),void 0)))}};var Ux,yS;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(Ux||(Ux={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}(yS||(yS={}));let f$t=class{constructor(e,i){this.sourceTile=i,this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.featureIndex=0,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},m$t=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};const _ai=!0,g$t=32,bai=1.5,y$t=200;var OX,bye,wye;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(OX||(OX={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(bye||(bye={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(wye||(wye={}));const v$t=512;var Ey,ca;(function(t){t[t.Unknown=0]="Unknown",t[t.Point=1]="Point",t[t.LineString=2]="LineString",t[t.Polygon=3]="Polygon"})(Ey||(Ey={}));let ka=class v5{constructor(e,i){this.x=e,this.y=i}clone(){return new v5(this.x,this.y)}equals(e,i){return e===this.x&&i===this.y}isEqual(e){return e.x===this.x&&e.y===this.y}setCoords(e,i){return this.x=e,this.y=i,this}normalize(){const e=this.x,i=this.y,r=Math.sqrt(e*e+i*i);return this.x/=r,this.y/=r,this}rightPerpendicular(){const e=this.x;return this.x=this.y,this.y=-e,this}leftPerpendicular(){const e=this.x;return this.x=-this.y,this.y=e,this}move(e,i){return this.x+=e,this.y+=i,this}assign(e){return this.x=e.x,this.y=e.y,this}assignAdd(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}assignSub(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}rotate(e,i){const r=this.x,s=this.y;return this.x=r*e-s*i,this.y=r*i+s*e,this}scale(e){return this.x*=e,this.y*=e,this}length(){const e=this.x,i=this.y;return Math.sqrt(e*e+i*i)}sub(e){return this.x-=e.x,this.y-=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}static distance(e,i){const r=i.x-e.x,s=i.y-e.y;return Math.sqrt(r*r+s*s)}static add(e,i){return new v5(e.x+i.x,e.y+i.y)}static sub(e,i){return new v5(e.x-i.x,e.y-i.y)}},PF=class{constructor(e,i,r){this.ratio=e,this.x=i,this.y=r}},xai=class{constructor(e,i,r,s=8,n=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=s,this._pixelMargin=n,this._tileSize=v$t*s,this._dz=e,this._yPos=i,this._xPos=r}setPixelMargin(e){e!==this._pixelMargin&&(this._pixelMargin=e,this.setExtent(this._extent))}setExtent(e){this._extent=e,this._finalRatio=this._tileSize/e*(1<<this._dz);let i=this._pixelRatio*this._pixelMargin;i/=this._finalRatio;const r=e>>this._dz;i>r&&(i=r),this._margin=i,this._xmin=r*this._xPos-i,this._ymin=r*this._yPos-i,this._xmax=this._xmin+r+2*i,this._ymax=this._ymin+r+2*i}reset(e){this._type=e,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(e,i){this._pushLine(),this._prevIsIn=this._isIn(e,i),this._moveTo(e,i,this._prevIsIn),this._prevPt=new ka(e,i),this._firstPt=new ka(e,i),this._dist=0}lineTo(e,i){const r=this._isIn(e,i),s=new ka(e,i),n=ka.distance(this._prevPt,s);let o,a,l,c,h,d,f,m;if(r)this._prevIsIn?this._lineTo(e,i,!0):(o=this._prevPt,a=s,l=this._intersect(a,o),this._start=this._dist+n*(1-this._r),this._lineTo(l.x,l.y,!0),this._lineTo(a.x,a.y,!0));else if(this._prevIsIn)a=this._prevPt,o=s,l=this._intersect(a,o),this._lineTo(l.x,l.y,!0),this._lineTo(o.x,o.y,!1);else{const y=this._prevPt,v=s;if(y.x<=this._xmin&&v.x<=this._xmin||y.x>=this._xmax&&v.x>=this._xmax||y.y<=this._ymin&&v.y<=this._ymin||y.y>=this._ymax&&v.y>=this._ymax)this._lineTo(v.x,v.y,!1);else{const _=[];if((y.x<this._xmin&&v.x>this._xmin||y.x>this._xmin&&v.x<this._xmin)&&(c=(this._xmin-y.x)/(v.x-y.x),m=y.y+c*(v.y-y.y),m<=this._ymin?d=!1:m>=this._ymax?d=!0:_.push(new PF(c,this._xmin,m))),(y.x<this._xmax&&v.x>this._xmax||y.x>this._xmax&&v.x<this._xmax)&&(c=(this._xmax-y.x)/(v.x-y.x),m=y.y+c*(v.y-y.y),m<=this._ymin?d=!1:m>=this._ymax?d=!0:_.push(new PF(c,this._xmax,m))),(y.y<this._ymin&&v.y>this._ymin||y.y>this._ymin&&v.y<this._ymin)&&(c=(this._ymin-y.y)/(v.y-y.y),f=y.x+c*(v.x-y.x),f<=this._xmin?h=!1:f>=this._xmax?h=!0:_.push(new PF(c,f,this._ymin))),(y.y<this._ymax&&v.y>this._ymax||y.y>this._ymax&&v.y<this._ymax)&&(c=(this._ymax-y.y)/(v.y-y.y),f=y.x+c*(v.x-y.x),f<=this._xmin?h=!1:f>=this._xmax?h=!0:_.push(new PF(c,f,this._ymax))),_.length===0)h?d?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):d?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(_.length>1&&_[0].ratio>_[1].ratio)this._start=this._dist+n*_[1].ratio,this._lineTo(_[1].x,_[1].y,!0),this._lineTo(_[0].x,_[0].y,!0);else{this._start=this._dist+n*_[0].ratio;for(let b=0;b<_.length;b++)this._lineTo(_[b].x,_[b].y,!0)}this._lineTo(v.x,v.y,!1)}}this._dist+=n,this._prevIsIn=r,this._prevPt=s}close(){if(this._line.length>2){const e=this._firstPt,i=this._prevPt;e.x===i.x&&e.y===i.y||this.lineTo(e.x,e.y);const r=this._line;let s=r.length;for(;s>=4&&(r[0].x===r[1].x&&r[0].x===r[s-2].x||r[0].y===r[1].y&&r[0].y===r[s-2].y);)r.pop(),r[0].x=r[s-2].x,r[0].y=r[s-2].y,--s}}result(e=!0){return this._pushLine(),this._lines.length===0?null:(this._type===Ey.Polygon&&e&&_$t.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(this._type!==Ey.LineString)throw new Error("Only valid for lines");this._pushLine();const e=this._lines,i=e.length;if(i===0)return null;const r=[];for(let s=0;s<i;s++)r.push({line:e[s],start:this._starts[s]||0});return r}_isIn(e,i){return e>=this._xmin&&e<=this._xmax&&i>=this._ymin&&i<=this._ymax}_intersect(e,i){let r,s,n;if(i.x>=this._xmin&&i.x<=this._xmax)s=i.y<=this._ymin?this._ymin:this._ymax,n=(s-e.y)/(i.y-e.y),r=e.x+n*(i.x-e.x);else if(i.y>=this._ymin&&i.y<=this._ymax)r=i.x<=this._xmin?this._xmin:this._xmax,n=(r-e.x)/(i.x-e.x),s=e.y+n*(i.y-e.y);else{s=i.y<=this._ymin?this._ymin:this._ymax,r=i.x<=this._xmin?this._xmin:this._xmax;const o=(r-e.x)/(i.x-e.x),a=(s-e.y)/(i.y-e.y);o<a?(n=o,s=e.y+o*(i.y-e.y)):(n=a,r=e.x+a*(i.x-e.x))}return this._r=n,new ka(r,s)}_pushLine(){this._line&&(this._type===Ey.Point?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===Ey.LineString?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===Ey.Polygon&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(e,i,r){this._type!==Ey.Polygon?r&&(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.push(new ka(e,i))):(r||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),i<this._ymin&&(i=this._ymin),i>this._ymax&&(i=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.push(new ka(e,i)),this._isH=!1,this._isV=!1)}_lineTo(e,i,r){let s,n;if(this._type!==Ey.Polygon)if(r){if(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(s=this._line[this._line.length-1],s.equals(e,i)))return;this._line.push(new ka(e,i))}else this._line&&this._line.length>0&&this._pushLine();else if(r||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),i<this._ymin&&(i=this._ymin),i>this._ymax&&(i=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){s=this._line[this._line.length-1];const o=s.x===e,a=s.y===i;if(o&&a)return;this._isH&&o||this._isV&&a?(s.x=e,s.y=i,n=this._line[this._line.length-2],n.x===e&&n.y===i?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(n=this._line[this._line.length-2],this._isH=n.x===e,this._isV=n.y===i)):(this._isH=n.x===e,this._isV=n.y===i)):(this._line.push(new ka(e,i)),this._isH=o,this._isV=a)}else this._line.push(new ka(e,i))}},Tai=class{setExtent(e){this._ratio=e===4096?1:4096/e}get validateTessellation(){return this._ratio<1}reset(e){this._lines=[],this._line=null}moveTo(e,i){this._line&&this._lines.push(this._line),this._line=[];const r=this._ratio;this._line.push(new ka(e*r,i*r))}lineTo(e,i){const r=this._ratio;this._line.push(new ka(e*r,i*r))}close(){const e=this._line;e&&!e[0].isEqual(e[e.length-1])&&e.push(e[0])}result(){return this._line&&this._lines.push(this._line),this._lines.length===0?null:this._lines}};(function(t){t[t.sideLeft=0]="sideLeft",t[t.sideRight=1]="sideRight",t[t.sideTop=2]="sideTop",t[t.sideBottom=3]="sideBottom"})(ca||(ca={}));let _$t=class Y0{static simplify(e,i,r){if(!r)return;const s=-i,n=e+i,o=-i,a=e+i,l=[],c=[],h=r.length;for(let f=0;f<h;++f){const m=r[f];if(!m||m.length<2)continue;let y,v=m[0];const _=m.length;for(let b=1;b<_;++b)y=m[b],v.x===y.x&&(v.x<=s&&(v.y>y.y?(l.push(f),l.push(b),l.push(ca.sideLeft),l.push(-1)):(c.push(f),c.push(b),c.push(ca.sideLeft),c.push(-1))),v.x>=n&&(v.y<y.y?(l.push(f),l.push(b),l.push(ca.sideRight),l.push(-1)):(c.push(f),c.push(b),c.push(ca.sideRight),c.push(-1)))),v.y===y.y&&(v.y<=o&&(v.x<y.x?(l.push(f),l.push(b),l.push(ca.sideTop),l.push(-1)):(c.push(f),c.push(b),c.push(ca.sideTop),c.push(-1))),v.y>=a&&(v.x>y.x?(l.push(f),l.push(b),l.push(ca.sideBottom),l.push(-1)):(c.push(f),c.push(b),c.push(ca.sideBottom),c.push(-1)))),v=y}if(l.length===0||c.length===0)return;Y0.fillParent(r,c,l),Y0.fillParent(r,l,c);const d=[];Y0.calcDeltas(d,c,l),Y0.calcDeltas(d,l,c),Y0.addDeltas(d,r)}static fillParent(e,i,r){const s=r.length,n=i.length;for(let o=0;o<n;o+=4){const a=i[o],l=i[o+1],c=i[o+2],h=e[a][l-1],d=e[a][l];let f=8092,m=-1;for(let y=0;y<s;y+=4){if(r[y+2]!==c)continue;const v=r[y],_=r[y+1],b=e[v][_-1],w=e[v][_];switch(c){case ca.sideLeft:case ca.sideRight:if(DF(h.y,b.y,w.y)&&DF(d.y,b.y,w.y)){const x=Math.abs(w.y-b.y);x<f&&(f=x,m=y)}break;case ca.sideTop:case ca.sideBottom:if(DF(h.x,b.x,w.x)&&DF(d.x,b.x,w.x)){const x=Math.abs(w.x-b.x);x<f&&(f=x,m=y)}}}i[o+3]=m}}static calcDeltas(e,i,r){const s=i.length;for(let n=0;n<s;n+=4){const o=[],a=Y0.calcDelta(n,i,r,o);e.push(i[n]),e.push(i[n+1]),e.push(i[n+2]),e.push(a)}}static calcDelta(e,i,r,s){const n=i[e+3];if(n===-1)return 0;const o=s.length;return o>1&&s[o-2]===n?0:(s.push(n),Y0.calcDelta(n,r,i,s)+1)}static addDeltas(e,i){const r=e.length;let s=0;for(let n=0;n<r;n+=4){const o=e[n+3];o>s&&(s=o)}for(let n=0;n<r;n+=4){const o=i[e[n]],a=e[n+1],l=s-e[n+3];switch(e[n+2]){case ca.sideLeft:o[a-1].x-=l,o[a].x-=l,a===1&&(o[o.length-1].x-=l),a===o.length-1&&(o[0].x-=l);break;case ca.sideRight:o[a-1].x+=l,o[a].x+=l,a===1&&(o[o.length-1].x+=l),a===o.length-1&&(o[0].x+=l);break;case ca.sideTop:o[a-1].y-=l,o[a].y-=l,a===1&&(o[o.length-1].y-=l),a===o.length-1&&(o[0].y-=l);break;case ca.sideBottom:o[a-1].y+=l,o[a].y+=l,a===1&&(o[o.length-1].y+=l),a===o.length-1&&(o[0].y+=l)}}}};const DF=(t,e,i)=>t>=e&&t<=i||t>=i&&t<=e,Cai=Number.POSITIVE_INFINITY,roe=Math.PI,$ai=2*roe,b$t=128/roe,w$t=256/360,Aai=roe/180,x$t=1/Math.LN2;function NFe(t,e){return(t%=e)>=0?t:t+e}function Mai(t){return NFe(t*b$t,256)}function Oai(t){return NFe(t*w$t,256)}function Iai(t){return Math.log(t)*x$t}function Rai(t,e,i){return t*(1-i)+e*i}const S$t=8,T$t=14,E$t=16;function Pai(t){return S$t+Math.max((t-T$t)*E$t,0)}function Dai(t,e,i){let r,s,n,o=0;for(const a of i){r=a.length;for(let l=1;l<r;++l)s=a[l-1],n=a[l],s.y>e!=n.y>e&&((n.x-s.x)*(e-s.y)-(n.y-s.y)*(t-s.x)>0?o++:o--)}return o!==0}function Lai(t,e,i,r){let s,n,o,a;const l=r*r;for(const c of i){const h=c.length;if(!(h<2)){s=c[0].x,n=c[0].y;for(let d=1;d<h;++d){if(o=c[d].x,a=c[d].y,H6e(t,e,s,n,o,a)<l)return!0;s=o,n=a}}}return!1}function C$t(t,e,i,r,s,n,o){const a=Math.max(r,Math.min(e,n))-e,l=Math.max(s,Math.min(i,o))-i;return a*a+l*l<=t*t}function Nai(t,e){if(e===0||Number.isNaN(e))return t;const i=[],r=new ka(0,0),s=new ka(0,0),n=new ka(0,0);for(let o=0;o<t.length;o++){const a=t[o],l=[];for(let c=0;c<a.length;c++){const h=a[c-1],d=a[c],f=a[c+1];c===0?r.setCoords(0,0):r.assignSub(d,h).normalize().rightPerpendicular(),c===a.length-1?s.setCoords(0,0):s.assignSub(f,d).normalize().rightPerpendicular(),n.assignAdd(r,s).normalize();const m=n.x*s.x+n.y*s.y;m!==0&&n.scale(1/m),l.push(ka.add(d,n.scale(e)))}i.push(l)}return i}function Fai(t,e,i,r){const s=new ka(t[0],t[1]);if(s.scale(r),e==="viewport"){const n=-i*(Math.PI/180),o=Math.cos(n),a=Math.sin(n);s.rotate(o,a)}return s}function xye(t,e,i,r,s,n){const o=i-s;if(o>=0)return(e>>o)+(r-(n<<o))*(t>>o);const a=-o;return e-(n-(r<<a))*(t>>a)<<a}let FFe=class{constructor(e,i,r){this._rows=Math.ceil(i/r),this._columns=Math.ceil(e/r),this._cellSize=r,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(e,i){const r=Math.min(Math.max(Math.floor(i/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][s]||null}getCellSpan(e,i,r,s){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function zai(t,e,i,r,s,n,o){const a=e[r++];for(let l=0;l<a;l++){const c=new f$t(n,o);c.xTile=e[r++],c.yTile=e[r++],c.hash=e[r++],c.priority=e[r++],c.featureIndex=e[r++];const h=e[r++];for(let m=0;m<h;m++){const y=e[r++],v=e[r++],_=e[r++],b=e[r++],w=!!e[r++],x=e[r++],S=i[r++],C=i[r++],T=e[r++],M=e[r++];c.colliders.push({xTile:y,yTile:v,dxPixels:_,dyPixels:b,hard:w,partIndex:x,width:T,height:M,minLod:S,maxLod:C})}const d=t[r++];for(let m=0;m<d;m++)c.textVertexRanges.push([t[r++],t[r++]]);const f=t[r++];for(let m=0;m<f;m++)c.iconVertexRanges.push([t[r++],t[r++]]);s.push(c)}return r}function $$t(t,e,i){for(const[r,s]of t.symbols)A$t(t,e,i,s,r)}function A$t(t,e,i,r,s){const n=t.layerData.get(s);if(n.type===OX.SYMBOL){for(const o of r){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],h=c.startOpacity,d=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&d===0;const f=i?Math.floor(127*h)|d<<7:d?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.iconVertexRanges)for(let d=c;d<c+h;d+=4)n.iconOpacity[d/4]=l;if(o.selectedForRendering){const c=a.parts[1],h=c.startOpacity,d=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&d===0;const f=i?Math.floor(127*h)|d<<7:d?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.textVertexRanges)for(let d=c;d<c+h;d+=4)n.textOpacity[d/4]=l}n.lastOpacityUpdate=e,n.opacityChanged=!0}}function M$t(t,e,i,r){const s=t.colliders;let n,o,a,l;for(const c of s)if(t.unique.show&&t.unique.parts[c.partIndex].show&&(n=c.xScreen-r[0]+c.dxScreen,o=c.yScreen-r[1]+c.dyScreen,a=n+c.width,l=o+c.height,C$t(i,e.x,e.y,n,o,a,l)))return!0;return!1}var IX,RX,Sye,Tye,Eye,Cye,$ye,Aye,Mye,Oye,PX,DX,Iye,Rye,Pye,Dye,Lye,Nye,Fye,kye,zye,Uye,Bye,Vye,jye,Gye,Hye,qye,Wye,Zye,Yye,Jye,Xye,Kye,Qye,eve,tve,ive,rve,sve,nve,ove,ave,lve,cve,uve,hve,dve,pve,fve,mve,gve,yve,vve,_ve,wB,bve,wve,xve,Sve,Tve,Eve,Cve;(function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE",t[t.UNKNOWN=4]="UNKNOWN"})(IX||(IX={})),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER",t[t.UNKNOWN=4]="UNKNOWN"}(RX||(RX={})),function(t){t[t.SCREEN=0]="SCREEN",t[t.MAP=1]="MAP"}(Sye||(Sye={})),function(t){t[t.Tint=0]="Tint",t[t.Ignore=1]="Ignore",t[t.Multiply=99]="Multiply"}(Tye||(Tye={})),function(t){t.Both="Both",t.JustBegin="JustBegin",t.JustEnd="JustEnd",t.None="None"}(Eye||(Eye={})),function(t){t[t.Mosaic=0]="Mosaic",t[t.Centered=1]="Centered"}(Cye||(Cye={})),function(t){t[t.Normal=0]="Normal",t[t.Superscript=1]="Superscript",t[t.Subscript=2]="Subscript"}($ye||($ye={})),function(t){t[t.MSSymbol=0]="MSSymbol",t[t.Unicode=1]="Unicode"}(Aye||(Aye={})),function(t){t[t.Unspecified=0]="Unspecified",t[t.TrueType=1]="TrueType",t[t.PSOpenType=2]="PSOpenType",t[t.TTOpenType=3]="TTOpenType",t[t.Type1=4]="Type1"}(Mye||(Mye={})),function(t){t[t.Display=0]="Display",t[t.Map=1]="Map"}(Oye||(Oye={})),function(t){t.None="None",t.Loop="Loop",t.Oscillate="Oscillate"}(PX||(PX={})),function(t){t.Linear="Linear",t.EaseIn="EaseIn",t.EaseOut="EaseOut",t.EaseInOut="EaseInOut"}(DX||(DX={})),function(t){t[t.Z=0]="Z",t[t.X=1]="X",t[t.Y=2]="Y"}(Iye||(Iye={})),function(t){t[t.XYZ=0]="XYZ",t[t.ZXY=1]="ZXY",t[t.YXZ=2]="YXZ"}(Rye||(Rye={})),function(t){t[t.Rectangle=0]="Rectangle",t[t.RoundedRectangle=1]="RoundedRectangle",t[t.Oval=2]="Oval"}(Pye||(Pye={})),function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.Screen=2]="Screen",t[t.Multiply=3]="Multiply",t[t.Add=4]="Add"}(Dye||(Dye={})),function(t){t[t.TTB=0]="TTB",t[t.RTL=1]="RTL",t[t.BTT=2]="BTT"}(Lye||(Lye={})),function(t){t[t.None=0]="None",t[t.SignPost=1]="SignPost",t[t.FaceNearPlane=2]="FaceNearPlane"}(Nye||(Nye={})),function(t){t[t.Float=0]="Float",t[t.String=1]="String",t[t.Boolean=2]="Boolean"}(Fye||(Fye={})),function(t){t[t.Intersect=0]="Intersect",t[t.Subtract=1]="Subtract"}(kye||(kye={})),function(t){t.OpenEnded="OpenEnded",t.Block="Block",t.Crossed="Crossed"}(zye||(zye={})),function(t){t.FullGeometry="FullGeometry",t.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",t.ReversedFirstSegment="ReversedFirstSegment",t.PerpendicularToSecondSegment="PerpendicularToSecondSegment",t.SecondSegmentWithTicks="SecondSegmentWithTicks",t.DoublePerpendicular="DoublePerpendicular",t.OppositeToFirstSegment="OppositeToFirstSegment",t.TriplePerpendicular="TriplePerpendicular",t.HalfCircleFirstSegment="HalfCircleFirstSegment",t.HalfCircleSecondSegment="HalfCircleSecondSegment",t.HalfCircleExtended="HalfCircleExtended",t.OpenCircle="OpenCircle",t.CoverageEdgesWithTicks="CoverageEdgesWithTicks",t.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",t.GapExtentMidline="GapExtentMidline",t.Chevron="Chevron",t.PerpendicularWithArc="PerpendicularWithArc",t.ClosedHalfCircle="ClosedHalfCircle",t.TripleParallelExtended="TripleParallelExtended",t.ParallelWithTicks="ParallelWithTicks",t.Parallel="Parallel",t.PerpendicularToFirstSegment="PerpendicularToFirstSegment",t.ParallelOffset="ParallelOffset",t.OffsetOpposite="OffsetOpposite",t.OffsetSame="OffsetSame",t.CircleWithArc="CircleWithArc",t.DoubleJog="DoubleJog",t.PerpendicularOffset="PerpendicularOffset",t.LineExcludingLastSegment="LineExcludingLastSegment",t.MultivertexArrow="MultivertexArrow",t.CrossedArrow="CrossedArrow",t.ChevronArrow="ChevronArrow",t.ChevronArrowOffset="ChevronArrowOffset",t.PartialFirstSegment="PartialFirstSegment",t.Arch="Arch",t.CurvedParallelTicks="CurvedParallelTicks",t.Arc90Degrees="Arc90Degrees",t.TipWithPerpendicularAndTicks="TipWithPerpendicularAndTicks",t.ConcentricCircles="ConcentricCircles",t.DoubleJogArrow="DoubleJogArrow",t.LinkedChevrons="LinkedChevrons",t.SegmentThenHalfCircle="SegmentThenHalfCircle",t.LineWithStraightTicks="LineWithStraightTicks",t.DoubleCurve="DoubleCurve",t.ParallelWithTicksByWidth="ParallelWithTicksByWidth",t.EnclosingRoundedRectangle="EnclosingRoundedRectangle"}(Uye||(Uye={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square",t.TrueBuffer="TrueBuffer"}(Bye||(Bye={})),function(t){t.ClosePath="ClosePath",t.ConvexHull="ConvexHull",t.RectangularBox="RectangularBox"}(Vye||(Vye={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(jye||(jye={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square"}(Gye||(Gye={})),function(t){t.Fast="Fast",t.Accurate="Accurate"}(Hye||(Hye={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(qye||(qye={})),function(t){t.Sinus="Sinus",t.Square="Square",t.Triangle="Triangle",t.Random="Random"}(Wye||(Wye={})),function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Force=2]="Force"}(Zye||(Zye={})),function(t){t[t.Buffered=0]="Buffered",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.AlongLine=3]="AlongLine"}(Yye||(Yye={})),function(t){t[t.Linear=0]="Linear",t[t.Rectangular=1]="Rectangular",t[t.Circular=2]="Circular",t[t.Buffered=3]="Buffered"}(Jye||(Jye={})),function(t){t[t.Discrete=0]="Discrete",t[t.Continuous=1]="Continuous"}(Xye||(Xye={})),function(t){t[t.AcrossLine=0]="AcrossLine",t[t.AlongLine=1]="AlongLine"}(Kye||(Kye={})),function(t){t[t.Auto=0]="Auto",t[t.Clockwise=1]="Clockwise",t[t.Counterclockwise=2]="Counterclockwise"}(Qye||(Qye={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Justify=3]="Justify"}(eve||(eve={})),function(t){t[t.Base=0]="Base",t[t.MidPoint=1]="MidPoint",t[t.ThreePoint=2]="ThreePoint",t[t.FourPoint=3]="FourPoint",t[t.Underline=4]="Underline",t[t.CircularCW=5]="CircularCW",t[t.CircularCCW=6]="CircularCCW"}(tve||(tve={})),function(t){t.Butt="Butt",t.Round="Round",t.Square="Square"}(ive||(ive={})),function(t){t.NoConstraint="NoConstraint",t.HalfPattern="HalfPattern",t.HalfGap="HalfGap",t.FullPattern="FullPattern",t.FullGap="FullGap",t.Custom="Custom"}(rve||(rve={})),function(t){t[t.None=-1]="None",t[t.Custom=0]="Custom",t[t.Circle=1]="Circle",t[t.OpenArrow=2]="OpenArrow",t[t.ClosedArrow=3]="ClosedArrow",t[t.Diamond=4]="Diamond"}(sve||(sve={})),function(t){t[t.ExtraLeading=0]="ExtraLeading",t[t.Multiple=1]="Multiple",t[t.Exact=2]="Exact"}(nve||(nve={})),function(t){t.Bevel="Bevel",t.Round="Round",t.Miter="Miter"}(ove||(ove={})),function(t){t[t.Default=0]="Default",t[t.String=1]="String",t[t.Numeric=2]="Numeric"}(ave||(ave={})),function(t){t[t.InsidePolygon=0]="InsidePolygon",t[t.PolygonCenter=1]="PolygonCenter",t[t.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(lve||(lve={})),function(t){t[t.Tint=0]="Tint",t[t.Replace=1]="Replace",t[t.Multiply=2]="Multiply"}(cve||(cve={})),function(t){t[t.ClipAtBoundary=0]="ClipAtBoundary",t[t.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",t[t.DoNotTouchBoundary=2]="DoNotTouchBoundary",t[t.DoNotClip=3]="DoNotClip"}(uve||(uve={})),function(t){t.NoConstraint="NoConstraint",t.WithMarkers="WithMarkers",t.WithFullGap="WithFullGap",t.WithHalfGap="WithHalfGap",t.Custom="Custom"}(hve||(hve={})),function(t){t.Fixed="Fixed",t.Random="Random",t.RandomFixedQuantity="RandomFixedQuantity"}(dve||(dve={})),function(t){t.LineMiddle="LineMiddle",t.LineBeginning="LineBeginning",t.LineEnd="LineEnd",t.SegmentMidpoint="SegmentMidpoint"}(pve||(pve={})),function(t){t.OnPolygon="OnPolygon",t.CenterOfMass="CenterOfMass",t.BoundingBoxCenter="BoundingBoxCenter"}(fve||(fve={})),function(t){t[t.Low=0]="Low",t[t.Medium=1]="Medium",t[t.High=2]="High"}(mve||(mve={})),function(t){t[t.MarkerCenter=0]="MarkerCenter",t[t.MarkerBounds=1]="MarkerBounds"}(gve||(gve={})),function(t){t[t.None=0]="None",t[t.PropUniform=1]="PropUniform",t[t.PropNonuniform=2]="PropNonuniform",t[t.DifUniform=3]="DifUniform",t[t.DifNonuniform=4]="DifNonuniform"}(yve||(yve={})),function(t){t.Tube="Tube",t.Strip="Strip",t.Wall="Wall"}(vve||(vve={})),function(t){t[t.Random=0]="Random",t[t.Increasing=1]="Increasing",t[t.Decreasing=2]="Decreasing",t[t.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(_ve||(_ve={})),function(t){t[t.Relative=0]="Relative",t[t.Absolute=1]="Absolute"}(wB||(wB={})),function(t){t[t.Normal=0]="Normal",t[t.LowerCase=1]="LowerCase",t[t.Allcaps=2]="Allcaps"}(bve||(bve={})),function(t){t[t.LTR=0]="LTR",t[t.RTL=1]="RTL"}(wve||(wve={})),function(t){t.Draft="Draft",t.Picture="Picture",t.Text="Text"}(xve||(xve={})),function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Baseline=2]="Baseline",t[t.Bottom=3]="Bottom"}(Sve||(Sve={})),function(t){t[t.Right=0]="Right",t[t.Upright=1]="Upright"}(Tve||(Tve={})),function(t){t[t.Small=0]="Small",t[t.Medium=1]="Medium",t[t.Large=2]="Large"}(Eve||(Eve={})),function(t){t[t.Calm=0]="Calm",t[t.Rippled=1]="Rippled",t[t.Slight=2]="Slight",t[t.Moderate=3]="Moderate"}(Cve||(Cve={}));var LX,P_,xB,Bp,NX,SB,FX,D_,kX;(function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(LX||(LX={})),function(t){t[t.VISIBLE=0]="VISIBLE",t[t.NONE=1]="NONE"}(P_||(P_={})),function(t){t[t.POINT=0]="POINT",t[t.LINE=1]="LINE",t[t.LINE_CENTER=2]="LINE_CENTER"}(xB||(xB={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT",t[t.AUTO=2]="AUTO"}(Bp||(Bp={})),function(t){t[t.AUTO=0]="AUTO",t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT"}(NX||(NX={})),function(t){t[t.CENTER=0]="CENTER",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.TOP_LEFT=5]="TOP_LEFT",t[t.TOP_RIGHT=6]="TOP_RIGHT",t[t.BOTTOM_LEFT=7]="BOTTOM_LEFT",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(SB||(SB={})),function(t){t[t.NONE=0]="NONE",t[t.UPPERCASE=1]="UPPERCASE",t[t.LOWERCASE=2]="LOWERCASE"}(FX||(FX={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT"}(D_||(D_={})),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(kX||(kX={}));let Qd=class{};Qd.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:P_.VISIBLE}},Qd.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:P_.VISIBLE}},Qd.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:P_.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:IX.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:RX.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},Qd.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:P_.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:xB.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:SB.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:Bp.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:SB.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:NX.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:Bp.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:FX.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[kX.HORIZONTAL]}},Qd.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:P_.VISIBLE}},Qd.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},Qd.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:D_.MAP}},Qd.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:D_.MAP},"line-width":{type:"number",minimum:0,default:1}},Qd.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:D_.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:D_.MAP}},Qd.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},Qd.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:D_.MAP}};function O$t(t,e,i,r,s,n){const{iconRotationAlignment:o,textRotationAlignment:a,iconTranslate:l,iconTranslateAnchor:c,textTranslate:h,textTranslateAnchor:d}=r;let f=0;for(const m of t.colliders){const[y,v]=m.partIndex===0?l:h,_=m.partIndex===0?c:d,b=m.minLod<=n&&n<=m.maxLod;f+=b?0:1,m.enabled=b,m.xScreen=m.xTile*s[0]+m.yTile*s[3]+s[6],m.yScreen=m.xTile*s[1]+m.yTile*s[4]+s[7],_===D_.MAP?(m.xScreen+=i*y-e*v,m.yScreen+=e*y+i*v):(m.xScreen+=y,m.yScreen+=v),Bp.VIEWPORT===(m.partIndex===0?o:a)?(m.dxScreen=m.dxPixels,m.dyScreen=m.dyPixels):(m.dxScreen=i*(m.dxPixels+m.width/2)-e*(m.dyPixels+m.height/2)-m.width/2,m.dyScreen=e*(m.dxPixels+m.width/2)+i*(m.dyPixels+m.height/2)-m.height/2)}t.colliders.length>0&&f===t.colliders.length&&(t.unique.show=!1)}let I$t=class{constructor(e,i,r,s,n,o){this._symbols=e,this._styleRepository=s,this._zoom=n,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new FFe(i,r,g$t),this._si=Math.sin(Math.PI*o/180),this._co=Math.cos(Math.PI*o/180);for(const a of e)for(const l of a.symbols)this._allNeededMatrices.has(l.tile)||this._allNeededMatrices.set(l.tile,gAe(l.tile.transforms.tileUnitsToPixels))}work(e){const i=this._gridIndex;function r(n){const o=n.xScreen+n.dxScreen,a=n.yScreen+n.dyScreen,l=o+n.width,c=a+n.height,[h,d,f,m]=i.getCellSpan(o,a,l,c);for(let y=d;y<=m;y++)for(let v=h;v<=f;v++){const _=i.cells[y][v];for(const b of _){const w=b.xScreen+b.dxScreen,x=b.yScreen+b.dyScreen,S=w+b.width,C=x+b.height;if(!(l<w||o>S||c<x||a>C))return!0}}return!1}const s=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const n=this._symbols[this._currentLayerCursor],o=this._getProperties(n.styleLayerUID);for(;this._currentSymbolCursor<n.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-s>e)return!1;const a=n.symbols[this._currentSymbolCursor];if(!a.unique.show)continue;O$t(a,this._si,this._co,o,this._allNeededMatrices.get(a.tile),this._zoom);const l=a.unique;if(!l.show)continue;const{iconAllowOverlap:c,iconIgnorePlacement:h,textAllowOverlap:d,textIgnorePlacement:f}=o;for(const m of a.colliders){if(!m.enabled)continue;const y=l.parts[m.partIndex];y.show&&!(m.partIndex?d:c)&&r(m)&&(m.hard?l.show=!1:y.show=!1)}if(l.show)for(const m of a.colliders){if(!m.enabled||(m.partIndex?f:h)||!l.parts[m.partIndex].show)continue;const y=m.xScreen+m.dxScreen,v=m.yScreen+m.dyScreen,_=y+m.width,b=v+m.height,[w,x,S,C]=this._gridIndex.getCellSpan(y,v,_,b);for(let T=x;T<=C;T++)for(let M=w;M<=S;M++)this._gridIndex.cells[T][M].push(m)}}}return!0}_getProperties(e){const i=this._styleProps.get(e);if(i)return i;const r=this._zoom,s=this._styleRepository.getStyleLayerByUID(e),n=s.getLayoutValue("symbol-placement",r)!==xB.POINT;let o=s.getLayoutValue("icon-rotation-alignment",r);o===Bp.AUTO&&(o=n?Bp.MAP:Bp.VIEWPORT);let a=s.getLayoutValue("text-rotation-alignment",r);a===Bp.AUTO&&(a=n?Bp.MAP:Bp.VIEWPORT);const l=s.getPaintValue("icon-translate",r),c=s.getPaintValue("icon-translate-anchor",r),h=s.getPaintValue("text-translate",r),d=s.getPaintValue("text-translate-anchor",r),f={iconAllowOverlap:s.getLayoutValue("icon-allow-overlap",r),iconIgnorePlacement:s.getLayoutValue("icon-ignore-placement",r),textAllowOverlap:s.getLayoutValue("text-allow-overlap",r),textIgnorePlacement:s.getLayoutValue("text-ignore-placement",r),iconRotationAlignment:o,textRotationAlignment:a,iconTranslateAnchor:c,iconTranslate:l,textTranslateAnchor:d,textTranslate:h};return this._styleProps.set(e,f),f}};function R$t(t,e){if(t.priority-e.priority)return t.priority-e.priority;const i=t.tile.key,r=e.tile.key;return i.world-r.world?i.world-r.world:i.level-r.level?i.level-r.level:i.row-r.row?i.row-r.row:i.col-r.col?i.col-r.col:t.xTile-e.xTile?t.xTile-e.xTile:t.yTile-e.yTile}let P$t=class{get running(){return this._running}constructor(e,i,r,s,n,o){this._visibleTiles=e,this._symbolRepository=i,this._createCollisionJob=r,this._assignTileSymbolsOpacity=s,this._symbolLayerSorter=n,this._isLayerVisible=o,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}setScreenSize(e,i){this._screenWidth===e&&this._screenHeight===i||this.restart(),this._screenWidth=e,this._screenHeight=i}restart(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}continue(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){const i=performance.now();if(!this._selectionJob.work(e)||(this._selectionJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){const i=performance.now();if(!this._collisionJob.work(e)||(this._collisionJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){const i=performance.now();if(!this._opacityJob.work(e)||(this._opacityJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}return this._running=!1,!0}_createSelectionJob(){const e=this._symbolRepository.uniqueSymbols;for(let l=0;l<e.length;l++){const c=e[l];for(let h=0;h<c.uniqueSymbols.length;h++){const d=c.uniqueSymbols[h];for(const f of d.tileSymbols)f.selectedForRendering=!1}}const i=[];let r=0,s=0;const n=this._isLayerVisible;function o(l){let c;const h=performance.now();for(;s<e.length;s++,r=0){const d=e[s],f=d.styleLayerUID;if(!n(f)){i[s]||(i[s]={styleLayerUID:f,symbols:[]});continue}i[s]=i[s]||{styleLayerUID:f,symbols:[]};const m=i[s];for(;r<d.uniqueSymbols.length;r++){if(c=d.uniqueSymbols[r],r%100==99&&performance.now()-h>l)return!1;let y=null,v=!1,_=!1;for(const b of c.tileSymbols)if(!_||!v){const w=b.tile;(!y||w.isCoverage||w.neededForCoverage&&!v)&&(y=b,(w.neededForCoverage||w.isCoverage)&&(_=!0),w.isCoverage&&(v=!0))}if(y.selectedForRendering=!0,_){m.symbols.push(y),c.show=!0;for(const b of c.parts)b.show=!0}else c.show=!1}}for(const d of i)d.symbols.sort(R$t);return!0}const a=this._symbolLayerSorter;return{work:o,get sortedSymbols(){return i.sort(a)}}}_createOpacityJob(){const e=this._assignTileSymbolsOpacity,i=this._visibleTiles;let r=0;function s(n,o){for(const a of n.symbols.values())D$t(a,o);e(n,o);for(const a of n.childrenTiles)s(a,o)}return{work(n){const o=performance.now();for(;r<i.length;r++){if(performance.now()-o>n)return!1;const a=i[r];a.parentTile==null&&s(a,performance.now())}return!0}}}};function D$t(t,e){for(const i of t){const r=i.unique;for(const s of r.parts){const n=s.targetOpacity>.5?1:-1;s.startOpacity+=n*((e-s.startTime)/y$t),s.startOpacity=Math.min(Math.max(s.startOpacity,0),1),s.startTime=e,s.targetOpacity=r.show&&s.show?1:0}}}const L$t=32,N$t=8,F$t=64,k$t=20;let z$t=class{constructor(e,i,r){this.tileCoordRange=e,this._visibleTiles=i,this._createUnique=r,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}get uniqueSymbols(){return this._uniqueSymbolLayerArray==null&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}get uniqueSymbolsReferences(){return this._uniqueSymbolsReferences}add(e,i){this._uniqueSymbolLayerArray=null;let r=this._tiles.get(e.id);r||(r={symbols:new Map},this._tiles.set(e.id,r));const s=new Map;if(i)for(const a of i)r.symbols.has(a)&&(s.set(a,r.symbols.get(a)),r.symbols.delete(a));else for(const[a,l]of e.layerData)r.symbols.has(a)&&(s.set(a,r.symbols.get(a)),r.symbols.delete(a));this._removeSymbols(s);const n=e.symbols,o=new Map;for(const[a,l]of n){let c=l.length;if(c>=L$t){let h=this.tileCoordRange;do h/=2,c/=4;while(c>N$t&&h>F$t);const d=new FFe(this.tileCoordRange,this.tileCoordRange,h);o.set(a,{flat:l,index:d}),r.symbols.set(a,{flat:l,index:d});for(const f of l)d.getCell(f.xTile,f.yTile).push(f)}else o.set(a,{flat:l}),r.symbols.set(a,{flat:l})}this._addSymbols(e.key,n)}deleteStyleLayers(e){this._uniqueSymbolLayerArray=null;for(const[i,r]of this._tiles){const s=new Map;for(const n of e)r.symbols.has(n)&&(s.set(n,r.symbols.get(n)),r.symbols.delete(n));this._removeSymbols(s),r.symbols.size===0&&this._tiles.delete(i)}}removeTile(e){this._uniqueSymbolLayerArray=null;const i=this._tiles.get(e.id);if(!i)return;const r=new Map;for(const[s,n]of e.symbols)i.symbols.has(s)&&(r.set(s,i.symbols.get(s)),i.symbols.delete(s));this._removeSymbols(r),i.symbols.size===0&&this._tiles.delete(e.id)}querySymbols(e,i,r,s){const n=[],o=this.uniqueSymbols;for(const a of o){const l=a.styleLayerUID,c=a.uniqueSymbols;for(const h of c){const d=h.tileSymbols.find(f=>f.selectedForRendering);d&&M$t(d,e,i*(window.devicePixelRatio||1),r)&&n.push({vtlSymbol:d,styleLayerUID:l,tileKey:d.tile.key})}}return n}_removeSymbols(e){for(const[i,{flat:r}]of e)for(const s of r){const n=s.unique,o=n.tileSymbols,a=o.length-1;for(let l=0;l<a;l++)if(o[l]===s){o[l]=o[a];break}if(o.length=a,a===0){const l=this._uniqueSymbolsReferences.get(i);l.delete(n),l.size===0&&this._uniqueSymbolsReferences.delete(i)}s.unique=null}}_addSymbols(e,i){if(i.size===0)return;const r=this._visibleTiles;for(const s of r)s.parentTile||s.key.world!==e.world||s.key.level===e.level&&!s.key.equals(e)||this._matchSymbols(s,e,i);for(const[s,n]of i)for(const o of n)if(o.unique==null){const a=this._createUnique();o.unique=a,a.tileSymbols.push(o);let l=this._uniqueSymbolsReferences.get(s);l||(l=new Set,this._uniqueSymbolsReferences.set(s,l)),l.add(a)}}_matchSymbols(e,i,r){if(e.key.level>i.level){const n=e.key.level-i.level;if(e.key.row>>n!==i.row||e.key.col>>n!==i.col)return}if(i.level>e.key.level){const n=i.level-e.key.level;if(i.row>>n!==e.key.row||i.col>>n!==e.key.col)return}if(i.equals(e.key)){for(const n of e.childrenTiles)this._matchSymbols(n,i,r);return}const s=new Map;for(const[n,o]of r){const a=[];for(const d of o){const f=xye(this.tileCoordRange,d.xTile,i.level,i.col,e.key.level,e.key.col),m=xye(this.tileCoordRange,d.yTile,i.level,i.row,e.key.level,e.key.row);f>=0&&f<this.tileCoordRange&&m>=0&&m<this.tileCoordRange&&a.push({symbol:d,xTransformed:f,yTransformed:m})}const l=[],c=(e.key.level<i.level?1:1<<e.key.level-i.level)+k$t,h=this._tiles.get(e.id).symbols.get(n);if(h){const d=h.flat;for(const f of a){let m,y=!1;const v=f.xTransformed,_=f.yTransformed;m=h.index!=null?h.index.getCell(v,_):d;const b=f.symbol,w=b.hash;for(const x of m)if(w===x.hash&&Math.abs(v-x.xTile)<=c&&Math.abs(_-x.yTile)<=c){const S=x.unique;b.unique=S,S.tileSymbols.push(b),y=!0;break}y||l.push(b)}}l.length>0&&s.set(n,l)}for(const n of e.childrenTiles)this._matchSymbols(n,i,s)}_createUniqueSymbolLayerArray(){const e=this._uniqueSymbolsReferences,i=new Array(e.size);let r,s=0;for(const[n,o]of e){const a=new Array(o.size);r=0;for(const l of o)a[r++]=l;i[s]={styleLayerUID:n,uniqueSymbols:a},s++}return i}};function U$t(t,e){const i=t.transforms.tileUnitsToPixels,r=pD(e),s=Math.cos(r),n=Math.sin(r),o=Math.ceil(512*(Math.abs(n)+Math.abs(s)));uj(kf),sS(kf,kf,[o/2,o/2]),hj(kf,kf,r),sS(kf,kf,[-256,-256]),dj(kf,kf,[1/8,1/8,1]),t.transforms.tileUnitsToPixels=kf;const a=[],l=new z$t(4096,a,()=>new m$t),c=new P$t(a,l,(h,d,f)=>new I$t(h,d,f,t.styleRepository,t.key.level,e),(h,d)=>{$$t(h,d,!1)},()=>0,h=>{const d=t.styleRepository.getStyleLayerByUID(h).getLayoutProperty("visibility");return!d||d.getValue()!==P_.NONE});a.push(t),l.add(t),c.setScreenSize(o,o),c.continue(1/0),l.removeTile(t),t.transforms.tileUnitsToPixels=i}const kf=Rx();let im=class extends ue{constructor(e){super(e),this.computedOpacity=1,this.computedVisible=!0,this.opacity=1,this.visible=!0,this._fadeOutResolver=null,this._fadeInResolver=null}get transitioning(){return(this._fadeOutResolver||!this.visible?0:this.opacity)!==this.computedOpacity}endTransition(){this._fadeInResolver?.(),this._fadeOutResolver?.(),this._fadeInResolver=this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0}fadeIn(){return this._fadeInResolver||(this.opacity=1,this.computedOpacity=0,this._fadeOutResolver?.(),this._fadeOutResolver=null,this._fadeInResolver=Qo()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver?.(),this._fadeInResolver=null,this._fadeOutResolver=Qo()),this._fadeOutResolver.promise}transitionStep(e,i){const r=X("mapview-transitions-duration"),s=r?1/r:0;if(s===0)this.computedOpacity=this.opacity,this.computedVisible=this.visible;else{const n=this._fadeOutResolver||!this.visible?0:this.opacity,o=this.computedOpacity;if(o===n)this.computedVisible=this.visible;else{const a=e*s;this.computedOpacity=o>n?Math.max(n,o-a):Math.min(n,o+a),this.computedVisible=this.computedOpacity>0}}this.transitioning||(this._fadeInResolver?.(),this._fadeOutResolver?.(),this._fadeOutResolver=this._fadeInResolver=null)}};u([p()],im.prototype,"computedOpacity",void 0),u([p()],im.prototype,"computedVisible",void 0),u([p()],im.prototype,"opacity",void 0),u([p()],im.prototype,"visible",void 0),u([p()],im.prototype,"transitioning",null),u([p()],im.prototype,"_fadeOutResolver",void 0),u([p()],im.prototype,"_fadeInResolver",void 0),im=u([A("esri.views.2d.engine.transitions.FadeTransition")],im);let B$t=class extends ws{constructor(){super(...arguments),this._transitionables=null,this._clips=null,this._fadeTransition=null,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get computedOpacity(){return this._fadeTransition?.computedOpacity??this.opacity}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get fadeTransitionEnabled(){return this._fadeTransition!==null}set fadeTransitionEnabled(e){!this._fadeTransition&&e?(this._fadeTransition=new im({opacity:this.opacity,visible:this.visible}),this.addTransitionable(this._fadeTransition)):this._fadeTransition&&!e&&(this.removeTransitionable(this._fadeTransition),this._fadeTransition=null)}get inFadeTransition(){return this._fadeTransition?.transitioning??!1}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this._fadeTransition&&(this._fadeTransition.opacity=this._opacity),this.requestRender())}get stage(){return this._stage}set stage(e){if(this._stage===e)return;const i=this._stage;this._stage=e,e?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):i?.trashDisplayObject(this)}get transforms(){return this._transforms==null&&(this._transforms=this._createTransforms()),this._transforms}get transitioning(){return this.isTransitioning()}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this._fadeTransition&&(this._fadeTransition.visible=this._visible),this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}addTransitionable(e){this._transitionables??=[],this._transitionables.push(e),this.requestRender()}removeTransitionable(e){e.endTransition(),this._transitionables&&U3(this._transitionables,e),this.requestRender()}fadeIn(){this.fadeTransitionEnabled=!0;const e=this._fadeTransition.fadeIn();return this.opacity=1,this.requestRender(),e}fadeOut(){this.fadeTransitionEnabled=!0;const e=this._fadeTransition.fadeOut();return this.opacity=0,this.requestRender(),e}endTransitions(){if(this._transitionables){for(const e of this._transitionables)e.endTransition();this.requestRender()}}beforeRender(e){this.transitionStep(e.deltaTime,e.state.scale),this.setTransform(e.state)}afterRender(e){this.transitioning&&this.requestRender()}remove(){this.parent?.removeChild(this)}setTransform(e){}processRender(e){this.stage&&(this._fadeTransition?.computedVisible??this.visible)&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this.endTransitions(),this.onDetach(),this.emit("detach")}isTransitioning(){return this._transitionables?.some(e=>e.transitioning)??!1}transitionStep(e,i){if(this._transitionables)for(const r of this._transitionables)r.transitionStep(e,i)}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},V$t=class extends B$t{constructor(e,i,r,s,n,o,a=n,l=o){super(),this.tileDebugInfoTexture=null,this.debugInfo={display:{length:0,minOrderedLength:0,minUnorderedLength:0,triangleCount:0},memory:{bytesUsed:0,bytesReserved:0}},this._destroyed=!1,this.key=new Xm(e),this.resolution=i,this.x=r,this.y=s,this.width=n,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.tileDebugInfoTexture&&(this.tileDebugInfoTexture.dispose(),this.tileDebugInfoTexture=null),this._destroyed=!0}get debugSlot(){let e=this;for(;e.parent!==this._stage;){if(!e.parent)return 0;e=e.parent}return this._stage.children.indexOf(e)}setTransform(e){const i=this.resolution/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,[s,n]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*i,a=this.height/this.rangeY*i;vD(r,o,0,0,0,a,0,s,n,1),bD(this.transforms.displayViewScreenMat3,e.displayViewMat3,r)}get destroyed(){return this._destroyed}},j$t=class extends V$t{_createTransforms(){return{displayViewScreenMat3:Rx(),tileMat3:Rx()}}},G$t=class{constructor(){this._candidateTiles=[]}schedule(e){this._candidateTiles.includes(e)||this._candidateTiles.push(e)}reshuffle(e){const i=[];for(const r of this._candidateTiles)e>0?(r.reshuffle(),e--):i.push(r);this._candidateTiles=i}};const H$t=.125;let q$t=class{constructor(){this._renderParams={reshuffleManager:new G$t,context:null,drawPhase:1,state:new W$t,stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null,stencilSymbols:!0,is3D:!0,backgroundColor:null},this._backgroundTile=new j$t(new Xm(0,0,0,0),0,0,0,512,512,4096,4096),this._heading=0,this._declutteredForHeading=new WeakMap}dispose(){this._renderParams=null}renderBackground(e,i,r,s,n,o,a,l,c,h){const d=this._backgroundTile;this._updateRenderParameters(e,i,d,r,n,o,a,l,c,h),this._renderParams.stencilSymbols=!1,r.drawBackground(this._renderParams,d,s)}renderContent(e,i,r,s,n,o,a,l,c,h,d,f){this._declutter(r),s.forAll(({sourceLayerInfo:{data:v}})=>this._declutter(v));const m=s.length>0;m&&this._stencilSymbols(e,i,r,s,n,o,a,l,c,h,d,f);let y=1;r.stencilRef=m?y:0,e.setStencilFunction(Ni.EQUAL,r.stencilRef,255),this._render(e,i,r,n,o,a,l,c,h,d,f),s.forAll(({sourceLod:v,offset:_,sourceLayerInfo:{data:b}})=>{b.stencilRef=++y,this._renderSymbols(e,v,b,n,o,a,l,_,h,d,f)})}_stencilSymbols(e,i,r,s,n,o,a,l,c,h,d,f){let m=1;r.stencilRef=m,e.setDepthTestEnabled(!1),e.setDepthWriteEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(Yi.KEEP,Yi.KEEP,Yi.REPLACE),e.setStencilWriteMask(255),e.setStencilFunction(Ni.ALWAYS,r.stencilRef,255),this._stencilTileSymbols(e,i,r,n,o,a,l,c,h,d,f),s.forAll(({sourceLod:y,offset:v,sourceLayerInfo:{data:_}})=>{_.stencilRef=++m,e.setStencilFunction(Ni.ALWAYS,_.stencilRef,255),this._stencilTileSymbols(e,y,_,n,o,a,l,v,h,d,f)}),e.setStencilWriteMask(0),e.setBlendingEnabled(!0),e.setDepthTestEnabled(!0),e.setColorMask(!0,!0,!0,!0)}_renderSymbols(e,i,r,s,n,o,a,l,c,h,d){e.setStencilFunction(Ni.EQUAL,r.stencilRef,255),this._render(e,i,r,s,n,o,a,l,c,h,d,LX.SYMBOL)}_render(e,i,r,s,n,o,a,l,c,h,d,f){this._updateRenderParameters(e,i,r,s,o,a,l,c,h,d),this._renderParams.stencilSymbols=!1,s.drawTile(this._renderParams,r,n,f)}_stencilTileSymbols(e,i,r,s,n,o,a,l,c,h,d){this._updateRenderParameters(e,i,r,s,o,a,l,c,h,d),this._renderParams.stencilSymbols=!0,r.triangleCount=0,s.drawSymbols(this._renderParams,r,n)}_updateRenderParameters(e,i,r,s,n,o,a,l,c,h){"type"in r&&r.type==="vector-tile"&&!r.stage&&r.attachWithContext(e);const d=i[0]-n.getLevelShift(i[0]),f=this._renderParams;f.context=e,f.painter=s,f.glyphMosaic=s.glyphMosaic,f.spriteMosaic=s.spriteMosaic,f.pixelRatio=c*h,f.displayLevel=d,f.requiredLevel=d;const m=n.getScale(i[0]),[y,v]=n.getOffset(i,o*m),_=H$t*o*m/l,b=r.transforms.displayViewScreenMat3;b[0]=_,b[4]=-_,b[6]=-1-y-a[0]*o*2,b[7]=1+v+(1-a[1])*o*2-2;const w=f.state,x=l/h;w.size[0]=x,w.size[1]=x,w.pixelRatio=h,w.rotation=(360-this._heading)%360;const S=2/x;vD(w.displayViewMat3,S,0,0,0,-S,0,-1,1,1);const C=uj(w.displayMat3),T=pD(this._heading);sS(C,C,[x/2,x/2]),hj(C,C,T),sS(C,C,[-x/2,-x/2]),bD(C,w.displayViewMat3,C)}updateHeading(e){this._heading=e}_declutter(e){this._declutteredForHeading.get(e)!==this._heading&&(U$t(e,(360-this._heading)%360),this._declutteredForHeading.set(e,this._heading))}},W$t=class{constructor(){this.size=[0,0],this.pixelRatio=1,this.rotation=0,this.displayMat3=xs(),this.displayViewMat3=xs(),this.transform=null,this.inverseTransform=null,this.viewMat2d=null,this.viewMat3=null,this.id=0,this.extent=null,this.center=null,this.scale=1,this.resolution=0,this.worldScreenWidth=0,this.spatialReference=null,this.viewpoint=null,this.getScreenTransform=null,this.toMap=null,this.toScreen=null,this.clone=null,this.copy=null,this.toJSON=null}},kFe=class extends ou{constructor(){super(...arguments),this.blendMode=Pe.Normal}};u([te({count:Pe.COUNT})],kFe.prototype,"blendMode",void 0);let YR=class extends kFe{constructor(){super(...arguments),this.output=hn.Composite,this.baseOpacityMode=Na.NotRequired,this.premultipliedSource=Yh.Off}};u([te({count:hn.COUNT})],YR.prototype,"output",void 0),u([te({count:Na.COUNT})],YR.prototype,"baseOpacityMode",void 0),u([te({count:Yh.COUNT})],YR.prototype,"premultipliedSource",void 0);let zFe=class extends YR{constructor(){super(...arguments),this.background=Sv.BelowLayer}};u([te({count:Sv.COUNT})],zFe.prototype,"background",void 0);function Z$t(t){t.fragment.uniforms.add(new $t("u_colormap",e=>e.u_colormap),new pt("u_colormapOffset",e=>e.colormap.u_colormapOffset),new pt("u_colormapMaxIndex",e=>e.colormap.u_colormapMaxIndex),new pt("u_opacity",e=>e.common.u_opacity)),t.fragment.code.add(E`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}function Y$t(t){t.fragment.uniforms.add(new $t("u_transformGrid",e=>e.u_transformGrid),new fc("u_transformSpacing",e=>e.common.u_transformSpacing),new fc("u_targetImageSize",e=>e.common.u_targetImageSize)),t.fragment.code.add(E`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}let E3=class extends or{constructor(e,i){super(e,"bool",Pt.Pass,(r,s,n)=>r.setUniform1b(e,i(s,n)))}},J$t=class extends RFe{constructor(e,i,r){super(),this.common=e,this.u_image=i,this.u_transformGrid=r}};function X$t(t,e){t.include(Y$t),t.fragment.uniforms.add(new $t("u_image",r=>r.u_image),new E3("u_flipY",r=>r.common.u_flipY),new E3("u_applyTransform",r=>r.common.u_applyTransform));const{requireBilinearWithNN:i}=e;i&&t.fragment.uniforms.add(new fc("u_srcImageSize",r=>r.common.u_srcImageSize)),t.fragment.code.add(E`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),i?t.fragment.code.add(E`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):t.fragment.code.add(E`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}let EG=class extends J$t{constructor(e,i,r,s,n,o){super(e,s,n),this.colormap=i,this.symbolizer=r,this.u_colormap=o,this.backgroundColor=on,this.fboTexture=null,this.baseOpacity=1}},UFe=class extends EG{},BFe=class extends EG{};function VFe(t){const e=new ki;return e.include(PFe),e.include(X$t,t),e.include(Z$t,t),e.include(DFe,t),e.fragment.code.add(E`vec4 applyBackgroundBlend(vec4 layerColor) {
return blendLayers(vuv, layerColor, u_opacity);
}`),t.colorizerType===Ux.Stretch?Q$t(e,t):t.colorizerType===Ux.Lut?K$t(e):t.colorizerType===Ux.Hillshade&&eAt(e,t),e}function K$t(t){t.fragment.main.add(E`vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));`)}function Q$t(t,e){t.fragment.uniforms.add(new Jb("u_bandCount",r=>r.symbolizer.u_bandCount),new hd("u_minCutOff",r=>r.symbolizer.u_minCutOff,3),new hd("u_maxCutOff",r=>r.symbolizer.u_maxCutOff,3),new hd("u_factor",r=>r.symbolizer.u_factor,3),new pt("u_minOutput",r=>r.symbolizer.u_minOutput),new pt("u_maxOutput",r=>r.symbolizer.u_maxOutput),new E3("u_useGamma",r=>r.symbolizer.u_useGamma),new hd("u_gamma",r=>r.symbolizer.u_gamma,3),new hd("u_gammaCorrection",r=>r.symbolizer.u_gammaCorrection,3),new pt("u_opacity",r=>r.common.u_opacity)),t.fragment.code.add(E`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const i=e.applyColormap?E`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:E`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.main.add(E`
    vec2 pixelLocation = getPixelLocation(uv);
    if (isOutside(pixelLocation)) {
      fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
      return;
    }

    vec4 currentPixel = getPixel(pixelLocation);
    ${e.stretchType===yS.Noop?E`fragColor = applyBackgroundBlend(currentPixel);`:E`
    if (currentPixel.a == 0.0) {
      fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
      return;
    }
    if (u_bandCount == 1) {
      float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
      ${i}
    } else {
      float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
      float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
      float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
      fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
    }`}`)}function eAt(t,e){const i=t.fragment;i.uniforms.add(new $t("u_image",s=>s.u_image),new Jb("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new hd("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new hd("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new hd("u_cosZs",s=>s.symbolizer.u_cosZs,6),new hd("u_weights",s=>s.symbolizer.u_weights,6),new fc("u_factor",s=>s.symbolizer.u_factor),new pt("u_minValue",s=>s.symbolizer.u_minValue),new pt("u_maxValue",s=>s.symbolizer.u_maxValue),new fc("u_srcImageSize",s=>s.common.u_srcImageSize)),i.include(FA),i.code.add(E`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),i.code.add(E`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=e.applyColormap?E`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:E`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;i.main.add(E`
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}`)}const tAt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:BFe,ColorizerStretchUniforms:UFe,ColorizerUniforms:EG,build:VFe},Symbol.toStringTag,{value:"Module"}));let $ve=class extends Bi{constructor(e,i){super(e,i,new Fi(tAt,()=>V(()=>Promise.resolve().then(()=>UGt),void 0)))}},CI=class extends YR{constructor(){super(...arguments),this.colorizerType=Ux.Stretch,this.stretchType=yS.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}};u([te({count:Ux.COUNT})],CI.prototype,"colorizerType",void 0),u([te({count:yS.COUNT})],CI.prototype,"stretchType",void 0),u([te()],CI.prototype,"applyColormap",void 0),u([te()],CI.prototype,"requireBilinearWithNN",void 0);let Ave=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const i=this._fbos.get(e);if(i)return i;const r=new gg(this._rctx,new $r(e),new GDe(fa.DEPTH24_STENCIL8,e));return this._fbos.set(e,r),r}};function Qb(t,e=ig.Pos2,i=hg,r=-1,s=1){const n=e===ig.Pos2?new Float32Array([r,r,s,r,r,s,s,s]):new Float32Array([r,r,0,0,s,r,1,0,r,s,0,1,s,s,1,1]);return new mg(t,i,new Map([["geometry",rAt.get(e)]]),new Map([["geometry",Un.createVertex(t,Zs.STATIC_DRAW,n)]]))}const iAt=4;function jFe(t){const e=new $r(iAt);return e.samplingMode=di.NEAREST,new yi(t,e)}var ig;(function(t){t[t.Pos2=0]="Pos2",t[t.Pos2Tex=1]="Pos2Tex"})(ig||(ig={}));const rAt=new Map([[ig.Pos2,b3e],[ig.Pos2Tex,Hmt]]),sAt=()=>J.getLogger("esri.views.3d.terrain");let nAt=class{constructor(e,i){this._rctx=e,this._techniques=i,this._fbos=[],this._vectorTileHelper=new q$t,this._bindParameters=new Hse(null),this._blendLayersTechniqueConfig=new zFe,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=Qb(this._rctx,ig.Pos2Tex)}dispose(){this._fbos.forEach(Rt),this._fbos=null,this._vtFBO=Rt(this._vtFBO),this._vaoQuad=Rt(this._vaoQuad),this._vectorTileHelper=Rt(this._vectorTileHelper)}updateHeading(e){this._vectorTileHelper?.updateHeading(e)}_acquireBlendLayersTechnique(e,i,r,s=Yh.Off,n=Sv.BelowLayer){return this._blendLayersTechniqueConfig.output=i,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=r,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechniqueConfig.background=n,this._techniques.precompile(_ye,this._blendLayersTechniqueConfig),this._techniques.get(_ye,this._blendLayersTechniqueConfig)}drawBackground(e,i){const r=this._acquireBlendLayersTechnique(Pe.Normal,i?hn.ColorComposite:hn.GridComposite,Na.NotRequired,Yh.Off,Sv.Only),s=this._rctx.bindTechnique(r,this._bindParameters,e);this._render(s)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Ui.TRIANGLE_STRIP,0,R$(this._vaoQuad,"geometry"))}drawGroup(e,i,r,s,n=Yh.On){i===hn.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(r).colorTexture),e.texture=this.currentFBO(r).colorTexture,this.closeGroup(r);const o=e.baseOpacity<1?Na.Required:Na.NotRequired,a=this._acquireBlendLayersTechnique(s,i,o,n),l=this._rctx.bindTechnique(a,this._bindParameters,e);this._render(l)}drawImageData(e,i,r,s,n=Yh.Off){if(e.texture==null)return;const o=e.baseOpacity<1?Na.Required:Na.NotRequired;e.fboTexture=i===hn.GroupBackgroundComposite||s===Pe.Normal&&o===Na.NotRequired&&n===Yh.Off?null:this.switch(r).colorTexture;const a=this._acquireBlendLayersTechnique(s,i,o,n),l=this._rctx.bindTechnique(a,this._bindParameters,e);this._render(l)}drawRasterData(e,i,r,s,n){const o=n.sourceLayerInfo.data;if(!o.source||(n.tile.surface.layerViewByIndex(n.layerIndex,Lt.MAP).ensureSymbolizerParameters(o),!o.bind(this._rctx)))return;const a=e.baseOpacity<1?Na.Required:Na.NotRequired;e.fboTexture=s===Pe.Normal&&a===Na.NotRequired?null:this.switch(r).colorTexture;const l=this._acquireRasterColorizerTechnique(o,i,s,a);o.opacity=e.opacity;const c=o.getUniforms();c.scale=n.scale,c.offset=n.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const h=this._rctx.bindTechnique(l,this._bindParameters,c);this._render(h)}_acquireRasterColorizerTechnique(e,i,r,s){const n=e.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return this._rasterColorizerConfig==null&&(this._rasterColorizerConfig=new CI,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=i,this._rasterColorizerConfig.blendMode=r,this._rasterColorizerConfig.baseOpacityMode=s,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.requireBilinearWithNN=e.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?yS.Noop:yS.PerBand,this._techniques.precompile($ve,this._rasterColorizerConfig),this._techniques.get($ve,this._rasterColorizerConfig)}drawVectorData(e,i,r,s,n,o,a,l){const c=this._rctx,h=n.sourceLayerInfo.data,d=n.tile.surface.layerViewByIndex(n.layerIndex,Lt.MAP),f=e.baseOpacity<1?Na.Required:Na.NotRequired,m=f===Na.Required||e.opacity<1||s!==Pe.Normal||i!==hn.Composite,y=m?Yh.On:Yh.Off,v=this._acquireBlendLayersTechnique(s,i,f,y);c.setPipelineState(v.getPipeline());let _=null,b=null;m?(b=this.currentFBO(r),this._vtFBO==null&&(this._vtFBO=new Ave(this._rctx)),_=this._vtFBO.get(r),c.bindFramebuffer(_),this._clearCurrentFBO()):l&&c.clear(Si.DEPTH);try{this._vectorTileHelper.renderBackground(c,n.sourceLod,d.painter,d.layer.styleRepository,d.schemaHelper,Math.round(1/n.scale),n.offset,a,o,d.contentZoom),h&&this._vectorTileHelper.renderContent(c,n.sourceLod,h,n.vtlNeighborInfos,d.painter,d.layer.styleRepository,d.schemaHelper,Math.round(1/n.scale),n.offset,a,o,d.contentZoom)}catch(w){sAt().warnOnce("A render call containing vector tiles did not resolve correctly.",w)}return!_||(c.bindFramebuffer(b),e.texture=_.colorTexture,e.offset=rS,e.scale=1,this.drawImageData(e,i,r,s,y),l)}copyFBOToTexture(e){const i=this._rctx,r=i.bindTexture(e.texture,yi.TEXTURE_UNIT_FOR_UPDATES),s=e.descriptor;i.gl.copyTexImage2D(ts.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),e.generateMipmap(),i.bindTexture(r,yi.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setStencilWriteMask(255),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.setClearStencil(0),this._rctx.clear(Si.COLOR|Si.DEPTH|Si.STENCIL)}_initFBO(e,i,r){this._rctx.bindFramebuffer(e),r&&(this._rctx.setViewport(0,0,i,i),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,i=0,r=!0){if(this._current=i,i>=this._fbos.length)for(let s=this._fbos.length;s<=i;s++)this._fbos.push(new Ave(this._rctx));this._initFBO(this._fbos[i].get(e),e,r)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const i=this.currentFBO(e),r=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),i}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const i=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},oAt=class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.isVTLBackground=!1,this.vtlNeighborInfos=new Jt({allocator:e=>e||new aAt})}},aAt=class{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}},Mve=class{constructor(e,i){this._texture=e,this._cache=i,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&(this._cache?(this._texture.isCompressing&&this._texture.abortCompression(),this._cache.put(this._generateCacheKey(),this)):this.dispose())}dispose(){this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}_generateCacheKey(){return`${this._texture.descriptor.width} ${this._texture.descriptor.pixelFormat}`+(vrt(this._texture)?"compressed":"")}get descriptor(){return this._texture.descriptor}get cachedMemory(){return this._texture.usedMemory}},lAt=class{constructor(e,i,r,s,n={}){this._mainMethod=i,this._transferLists=r,this._listeners=[],this._promise=yEe(e,{...n,schedule:s}).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,n.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>J.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${o}`))}on(e,i){const r={removed:!1,eventName:e,callback:i,threadHandle:null};return this._listeners.push(r),this._connectListener(r),$i(()=>{r.removed=!0,U3(this._listeners,r),this._thread&&r.threadHandle!=null&&r.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,i){return this.invokeMethod(this._mainMethod,e,i)}invokeMethod(e,i,r){if(this._thread){const s=this._transferLists[e],n=s?s(i):[];return this._thread.invoke(e,i,{transferList:n,signal:r})}return this._promise?this._promise.then(()=>(gt(r),this.invokeMethod(e,i,r))):Promise.reject(null)}broadcast(e,i){return this._thread?Promise.all(this._thread.broadcast(i,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,i)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(i=>{e.removed||(e.threadHandle=i)})}};function GFe(t){return t instanceof HTMLImageElement||t instanceof HTMLCanvasElement}let cAt=class extends lAt{constructor(e){super("TextureCompressionWorker","compress",{compress:i=>[i.data]},e)}isCompressible(e){return GFe(e)}},uAt=class{constructor(e,i,r,s,n,o){this.start=e,this.end=i,this.blendMode=r,this.opacity=s,this.output=n,this.baseOpacity=o}},J0=class extends ue{constructor(e){super(e),this._passParameters=new p$t,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1}initialize(){this._maxAnisotropy=this.rctx.parameters.maxMaxAnisotropy,this._compositor=new nAt(this.rctx,this.techniques),this._ensureBackgroundTexture(this.tileSize),this.texturesBeingCompressed=0}dispose(){this._compositor=Rt(this._compositor),this._backgroundTexture=Dr(this._backgroundTexture)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateHeading(e){this._compositor?.updateHeading(e)}updateTileTexture(e,i){if(!e.renderData)return;const r=e.surface,s=r.baseOpacity;let n=0,o=0,a=this.tileSize,l=!1,c=!1;const h=r.view.state.contentPixelRatio;let d=!1;TB.clear(),WT.length=0;const f=e.layerInfo[Lt.MAP];let m=0,y=null;for(;m<f.length;m++){const b=r.layerViewByIndex(m,Lt.MAP),w=b.layer,x=!zx(e,b),S=w.opacity,C=b.fullOpacity;if(c=c||Wk(w),S3(b)){let I=b.layer.blendMode!=="normal";if(v$(w.parent)){const P=w.parent.uid;P!=null&&P!==""&&(I=HFe(w.parent)||I)}I&&(d=I,l=!1)}if((x||S===0)&&!d){f[m].pendingUpdates&=~(et.TEXTURE_NOFADING&et.TEXTURE_FADING);continue}++o;const T=X$(b),M=xq(e,m,T);if(M){if(f[m].pendingUpdates&=~(et.TEXTURE_NOFADING&et.TEXTURE_FADING),v$(w.parent)){const I=w.parent.uid;I!=null&&I!==""&&qFe(w.parent,m)}T?a=Math.max(a,this.tileSize*h):s===1&&C===1&&(b.isOpaque||this._dataToTexture(M)&&M.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++n,y===null&&(y=m)}}const v=a/this.tileSize,_=this._ensureBackgroundTexture(this.tileSize);n!==0&&y!==null?n===1&&!d&&this._useLayerTexture(e,y)||this._composeLayers(e,i,m-1,c,a,v,!l||d,TB,d):dAt(e,o,_,i!==Ms.FADING)}_ensureBackgroundTexture(e){return this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(e,!1),this._backgroundDirty=!0),this._backgroundDirty&&(this._compositor.bind(e),this._passParameters.offset=rS,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor&&(this._passParameters.backgroundColor=this.backgroundColor),this._compositor.drawBackground(this._passParameters,this.backgroundColor!=null),this._compositor.copyFBOToTexture(this._backgroundTexture),this._compositor.unbind(),this._backgroundDirty=!1),this._backgroundTexture}_useLayerTexture(e,i){const r=e.surface.layerViewByIndex(i,Lt.MAP),s=Wk(r.layer),n=s?e.surface.baseOpacity:1,o=s?1:e.surface.baseOpacity,a=r.fullOpacity,l=xq(e,i,!1);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new bB(l.sourceLayerInfo.data,Ms.FADING,Gi(l.offset[0],l.offset[1],l.scale,l.scale),n,o,a)),!0)}_composeLayers(e,i,r,s,n,o,a,l,c){this._compositor.ensureBuffer(n);const h=e.surface.baseOpacity;let d=!1,f=di.LINEAR_MIPMAP_LINEAR,m=!1,y=0;for(let w=r;w>=0;w--){const x=e.surface.layerViewByIndex(w,Lt.MAP),S=x.layer,C=X$(x),T=xq(e,w,C),M=S.opacity,I=!zx(e,x);if(!T||(M===0||I)&&!c)continue;const P=!Wk(S)&&!d;P&&(d=!0);let D=!1;l.forEach(R=>{R.start===w&&(R.output=s?hn.Composite:a&&P?this.backgroundIsGrid?hn.GridComposite:hn.ColorComposite:hn.Composite,R.baseOpacity=P?h:1,WT.push(R),this._compositor.openGroup(n),D=!0)});const F=y===0,L=D?hn.GroupBackgroundComposite:a&&F?this.backgroundIsGrid?hn.GridComposite:hn.ColorComposite:hn.Composite,N=MX[S3(x)?x.layer.blendMode:"normal"];for(this._passParameters.baseOpacity=P&&!D&&h<1?h:1,this._passParameters.opacity=M,T2t(T)?m=this._compositor.drawVectorData(this._passParameters,L,n,N,T,o,this.tileSize,m):S2t(T)?(this._compositor.drawRasterData(this._passParameters,L,n,N,T),hAt(T)&&(f=di.NEAREST)):this._dataToTexture(T)&&(this._passParameters.texture=T.sourceLayerInfo.data.texture,this._passParameters.offset=T.offset,this._passParameters.scale=T.scale,this._compositor.drawImageData(this._passParameters,L,n,N));WT.length>0&&WT[WT.length-1].end===w;){const R=WT.pop();this._passParameters.baseOpacity=R.baseOpacity,this._passParameters.opacity=R.opacity,this._passParameters.offset=rS,this._passParameters.scale=1,this._compositor.drawGroup(this._passParameters,R.output,n,MX[R.blendMode])}y++}const v=e.renderData,_=c||d&&h<1,b=v.ensureTexture(n,_,i,()=>this._buildTexture(n,_,f));this._compositor.copyFBOToTexture(b),this._compositor.unbind(),v.setTextureReference(new bB(b,i,WFe,d?1:h,0,1))}_dataToTexture(e){if(C2t(e)){const i=e.sourceLayerInfo,r=e.scale===1;i.data=this._buildTexture(i.data,!0,r),e.tile.setMemoryDirty()}return E2t(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,i,r=di.LINEAR_MIPMAP_LINEAR){if(e==null)return null;const s=new $r;s.wrapMode=nr.CLAMP_TO_EDGE,s.samplingMode=typeof r=="boolean"?di.LINEAR_MIPMAP_LINEAR:r,s.maxAnisotropy=this._maxAnisotropy,s.preMultiplyAlpha=!0,s.flipped=!0,s.hasMipmap=!0,i||(s.pixelFormat=vt.RGB);const n=this.rctx,o=typeof r=="boolean"&&r;let a;if(typeof e=="number")s.width=s.height=e,a=this._buildTileTexture(s,e);else if(xG(e))s.isOpaque=e.isOpaque,s.isOpaque&&(s.pixelFormat=vt.RGB),a=this._buildTileTexture(s,e.element.width,o,e.element);else try{s.width=e.width,s.height=e.height,a=this._buildTileTexture(s,e.width,o,e)}catch{a=new Mve(jFe(n)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const l=n.bindTexture(a.texture,yi.TEXTURE_UNIT_FOR_UPDATES);return a.generateMipmap(),n.bindTexture(l,yi.TEXTURE_UNIT_FOR_UPDATES),a}_buildTileTexture(e,i,r=!1,s){const n=`${i} ${e.pixelFormat}`,o=this.cache.pop(n)??this.cache.pop(n+"compressed");if(r&&=GFe(s),o)return o.retain(),r&&o.texture.enableCompression(!0),o.texture.setData(s),o;e.shouldCompress=r;const a=new yi(this.rctx,e,s);return a.isCompressing&&(this.texturesBeingCompressed++,this.addHandles([H(()=>a.isCompressing,l=>{l?this.texturesBeingCompressed++:this.texturesBeingCompressed--},Gt)])),new Mve(a,this.cache)}get test(){}};function xq(t,e,i){Oa.layerIndex=e,Oa.vtlNeighborInfos.clear();const r=t.layerInfo[Lt.MAP][e];if(li(Oa.offset,0,0),Oa.tile=t,Oa.scale=1,Oa.sourceLod=t.lij,Oa.sourceLayerInfo=r,Oa.isVTLBackground=i,r.data)return i&&t.forEachLoadedNeighbor((o,a)=>{if(o.level!==t.level)return;const l=o.layerInfo[Lt.MAP][e];if(!rFe(l)||r.data===l.data)return;const c=Oa.vtlNeighborInfos.pushNew();c.offset=ay[a],c.sourceLod=o.lij,c.sourceLayerInfo=l}),Oa;const s=r.upsampleInfo,n=s?.tile?.layerInfo[Lt.MAP][e];return n&&s.tile?(Oa.tile=s.tile,zn(Oa.offset,s.offset),Oa.scale=s.scale,Oa.sourceLod=s.tile.lij,Oa.sourceLayerInfo=n,Oa):i?Oa:null}function hAt(t){const e=t.sourceLayerInfo.data;return!!e.source&&e.interpolation==="nearest"}function HFe(t){let e=t.blendMode!=="normal";return v$(t.parent)&&(e=HFe(t.parent)||e),e}function qFe(t,e){v$(t.parent)&&qFe(t.parent,e);const i=t.uid;if(i!=null&&i!==""){const r=TB.get(i);r?r.start=e:TB.set(i,new uAt(e,e,t.blendMode,t.opacity,hn.Composite,1))}}function dAt(t,e,i,r){const s=t.renderData,n=!r&&s.textureReference!=null&&(t.surface.view.layerViewManager.updating||e>0)?db.Delayed:db.Immediate;s.setTextureReference(new bB(i,Ms.FADING,WFe,t.surface.baseOpacity,0,1),n)}u([p({constructOnly:!0})],J0.prototype,"rctx",void 0),u([p({constructOnly:!0})],J0.prototype,"techniques",void 0),u([p({constructOnly:!0})],J0.prototype,"cache",void 0),u([p()],J0.prototype,"tileSize",void 0),u([p()],J0.prototype,"texturesBeingCompressed",void 0),J0=u([A("esri.views.3d.terrain.TileRenderer")],J0);const TB=new Map,WT=new Array,Oa=new oAt,WFe=Gi(0,0,1,1),ay=new Array;ay[rt.NORTH]=[0,-1],ay[rt.NORTH_EAST]=[-1,-1],ay[rt.EAST]=[-1,0],ay[rt.SOUTH_EAST]=[-1,1],ay[rt.SOUTH]=[0,1],ay[rt.SOUTH_WEST]=[1,1],ay[rt.WEST]=[1,0],ay[rt.NORTH_WEST]=[1,-1];const pAt=200,Sq=40,fAt=.8,mAt=10,zX=1e-6;function gAt(t,e,i){const r=e,s=i;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=t[a];if(r[a]<l){if(s[a]<=zX)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-1e-6){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=t[a+3];if(r[a]>l){if(s[a]>=-1e-6)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]>=zX){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}let Ove=class{constructor(e,i,r,s,n){this.aabb=e,this.axis=i,this.d=r,this.midStartIndex=s,this.rightStartIndex=n}},ZFe=class UX{constructor(e,i,r,s){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=i,this.positions=s,this._rayDirection=$(),this._callback=Rve,this._intersectionOptions=Ive,this.bspNodeTree=new Array;const n=r-i,o=new(n<wAt?Uint8Array:n<xAt?Uint16Array:Uint32Array)(n);this.triangleIndexMap=o;for(let a=0;a<n;++a)o[a]=a;{const a=bAt(e,i,r,s.data,s.stride),l=ce(Math.log2(n/Sq),2,mAt),c=(h,d,f)=>{const m=vAt(o,a,h,d),y=d-h;if(y<=Sq){const S=new Ove(m,void 0,0,h,d);return this.bspNodeTree.push(S),S}const{axis:v,midValue:_}=_At(m),b=yAt(o,a,h,d,v,_),w=(S,C)=>{if(f>l)return;const T=C-S;return T<Sq||T>=fAt*y?void 0:c(S,C,f+1)},x=new Ove(m,v,_,b.next,b.mid);return this.bspNodeTree.push(x),x.leftNode=w(h,b.next),x.rightNode=w(b.mid,d),x};c(0,n,0)}}intersectRayTriangleRange(e,i){if(e>=i)return;const r=this.positions;oPe(this._rayFrom,this._rayDirection,e,i,this.globalTriangleVertexIndices,r.data,r.stride,this._intersectionOptions.normalRequired,this._callback,this.triangleIndexMap,this.firstTriangleIndex),UX.numFacesTested+=i-e}intersectRay(e,i,r,s){UX.numFacesTested=0;const n=e,o=i,a=o[0]-n[0],l=o[1]-n[1],c=o[2]-n[2];if(a*a+l*l+c*c<zX)return;this._rayFrom=n;const h=this._rayDirection;h[0]=a,h[1]=l,h[2]=c;const d=this.triangleIndexMap.length;this._callback=s,this._intersectionOptions=r,this.intersectRayBSP(this.bspNodeTree[0],0,d),this._callback=Rve,this._intersectionOptions=Ive}intersectRayBSP(e,i,r){const s=this._rayFrom,n=this._rayDirection;if(!gAt(e.aabb,s,n))return;const o=e.axis,a=e.d;if(s[o]<a||n[o]<0){const l=i,c=e.midStartIndex;if(l<c){const h=e.leftNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),s[o]>a||n[o]>0){const l=e.rightStartIndex,c=r;if(l<c){const h=e.rightNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleIndexMap.byteLength}};ZFe.numFacesTested=0;const ZT=[1/0,1/0,1/0],YT=[-1/0,-1/0,-1/0];function yAt(t,e,i,r,s,n){let o=i,a=r;for(;o<a;){const c=t[o];e[6*c+s+3]<=n?++o:(--a,t[o]=t[a],t[a]=c)}let l=o;for(a=r;l<a;){const c=t[a-1];e[6*c+s]>=n?--a:(t[a-1]=t[l],t[l]=c,++l)}return{next:o,mid:l}}function vAt(t,e,i,r){if(r<=i)return E$(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*t[i];for(let n=0;n<3;++n)ZT[n]=e[s+0+n],YT[n]=e[s+3+n]}for(let s=i+1;s<r;++s){const n=6*t[s];for(let o=0;o<3;++o)ZT[o]=Math.min(ZT[o],e[n+0+o]),YT[o]=Math.max(YT[o],e[n+3+o])}return E$(ZT[0],ZT[1],ZT[2],YT[0],YT[1],YT[2])}function _At(t){const e=t[3]-t[0],i=t[4]-t[1],r=t[5]-t[2],s=e>i?e>r?0:i>r?1:2:i>r?1:r>e?2:0;return{axis:s,midValue:(t[s]+t[s+3])/2}}function bAt(t,e,i,r,s){const n=i-e,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+e),c=t[l]*s,h=t[l+1]*s,d=t[l+2]*s;for(let f=0;f<3;++f){const m=r[c+f],y=r[h+f],v=r[d+f];o[6*a+f]=Math.min(m,y,v),o[6*a+3+f]=Math.max(m,y,v)}}return o}const wAt=255,xAt=65535,Ive=new Hj,Rve=()=>{};let ul=class extends zm{constructor(e){super(),this.spherical=e,this.overlayMode=Em.Disabled,this.tileBlendInput=Mm.LayerOnly,this.transparencyMode=ga.Opaque,this.pbrMode=_t.Simplified,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.screenSpaceReflections=!1,this.cloudReflections=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.normalType=Fr.Compressed,this.textureCoordinateType=Ws.Compressed,this.highStepCount=!1,this.useCustomDTRExponentForWater=!1,this.useFillLights=!1,this.hasColorTexture=!0,this.canHaveOverlay=!0}};u([te({count:Em.COUNT})],ul.prototype,"overlayMode",void 0),u([te({count:Mm.COUNT})],ul.prototype,"tileBlendInput",void 0),u([te({count:ga.COUNT})],ul.prototype,"transparencyMode",void 0),u([te({count:_t.COUNT})],ul.prototype,"pbrMode",void 0),u([te()],ul.prototype,"doublePrecisionRequiresObfuscation",void 0),u([te()],ul.prototype,"receiveShadows",void 0),u([te()],ul.prototype,"backfaceCullingEnabled",void 0),u([te()],ul.prototype,"textureFadingEnabled",void 0),u([te()],ul.prototype,"renderOccluded",void 0),u([te()],ul.prototype,"screenSpaceReflections",void 0),u([te()],ul.prototype,"cloudReflections",void 0),u([te()],ul.prototype,"tileBorders",void 0),u([te()],ul.prototype,"visualizeNormals",void 0),u([te()],ul.prototype,"screenSizePerspective",void 0),u([te()],ul.prototype,"receiveAmbientOcclusion",void 0);const Tq=7,SAt=10,Eq=ch();let $u=class extends BD{get _isGlobal(){return this._stage.viewingMode===Be.Global}get _techniques(){return this._context.techniques}get _rctx(){return this._context.renderContext.rctx}constructor(e,i,r,s,n){super({}),this._overlayRenderer=e,this._stage=i,this._allTiles=r,this._ellipsoidRadius=s,this.type=Zr.TERRAIN,this.isGround=!0,this._passParameters=new Hne,this._drawParameters=new oFe,this._renderDataPool=new Cl(vCt),this._visiblePatchesByOrigin=new Map,this._allPatchesByOrigin=new Map,this._patchesByOriginDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new hFe,this._castShadows=!1,this._inViewshed=!1,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.renderOccludedFlags=Er.Occlude,this.produces=new Map([[be.OPAQUE_TERRAIN,()=>this._produces()&&this.transparency===ga.Opaque],[be.TRANSPARENT_TERRAIN,()=>this._produces()&&(this.transparency===ga.Transparent||this.transparency===ga.InvisibleWithDraped)],[be.OCCLUDED_TERRAIN,()=>this._produces()]]),this._tileSize=256,this._configuration=new ul(i.viewingMode===Be.Global),this._tileTextureCache=new XD((o,a)=>n.newCache(o,a),"TileTexture"),this.tileGeometryCache=new l$t(n)}normalizeCtorArgs(){return{}}initialize(){this._stage.addRenderPlugin(this),this.addHandles(H(()=>this._overlayRenderer.rendersOccludedDraped,e=>{this.renderOccludedFlags=e?kR:Er.Occlude,this.setNeedsRender()},Gt))}destroy(){this._stage.removeRenderPlugin(this),this._tileTextureCache.destroy(),this.tileGeometryCache.destroy()}_produces(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}consumes(){return this._overlayRenderer.hasWater?Nmt:p3e}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set visible(e){this._set("visible",!!e),this.setDirty()}updateHeading(e){this._tileRenderer?.updateHeading(e)}set transparency(e){this._configuration.transparencyMode!==e&&(this._configuration.transparencyMode=e,this.setNeedsRender())}get transparency(){return this._configuration.transparencyMode}get tileRenderer(){return this._tileRenderer}get texturesBeingCompressed(){return this._tileRenderer?this._tileRenderer?.texturesBeingCompressed:null}get renderPatchBorders(){return this._configuration.tileBorders}set renderPatchBorders(e){this._configuration.tileBorders!==e&&(this._configuration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return this._configuration.visualizeNormals}set visualizeNormals(e){this._configuration.visualizeNormals!==e&&(this._configuration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._configuration.backfaceCullingEnabled}set cullBackFaces(e){this._configuration.backfaceCullingEnabled!==e&&(this._configuration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}get layerUid(){return Ob}get slicePlaneEnabled(){return this._configuration.hasSlicePlane}set slicePlaneEnabled(e){this._configuration.hasSlicePlane!==e&&(this._configuration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._configuration.textureFadingEnabled!==e&&(this._configuration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._configuration.pbrMode!==e&&(this._configuration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._configuration.screenSizePerspective!==e&&(this._configuration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}set tileSize(e){this._tileSize=e,this._tileRenderer!=null&&(this._tileRenderer.tileSize=e),this.setDirty()}get tileSize(){return this._tileSize}_ensureRenderData(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e,this._getLocalOriginOfTile(e)))}loadTile(e){this._ensureRenderData(e),this.updateTileGeometryState(e),this.reuseTextureFromParent(e)||this.updateTileTexture(e,et.TEXTURE_FADING)}reuseTextureFromParent(e){const i=e.parent;if(!i)return!1;const r=Gi(1&e.lij[2]?.5:0,1&e.lij[1]?0:.5,.5,.5);return i.renderData?.reuseTexture(e.renderData,r)??!1}updateTileTexture(e,i){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(e,i===et.TEXTURE_FADING?Ms.FADING:Ms.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(i))}updateTileGeometryState(e){for(const r of e.layerInfo[Lt.ELEVATION])r.pendingUpdates&=~et.GEOMETRY;e.resetPendingUpdate(et.GEOMETRY);const i=e.renderData.updateGeometryState();return i&&this.setDirty(),i}updateGeometryIfNeeded(e){e.loaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const i=e.renderData;i&&(i.releaseGeometry(),this._renderDataPool.release(i),i.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const i=SAt-Tq,r=Math.max(0,Math.floor((e.level-i)/Tq)*Tq);if(this._isGlobal&&r===0)return on;for(;e.parent&&e.level>r;)e=e.parent;return e.centerAtSeaLevel}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=bt.UPDATE){this._patchesByOriginDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=bt.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=bt.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._tileRenderer=new J0({rctx:this._rctx,tileSize:this._tileSize,techniques:this._techniques,cache:this._tileTextureCache}),this.updateTileBackground(),this._emptyTex=jFe(this._rctx)}uninitializeRenderContext(){this._emptyTex=Rt(this._emptyTex),this._tileRenderer=Rt(this._tileRenderer)}intersect(e,i,r,s){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==ga.Opaque)return;const n=TAt,o=EAt;ye(n,s,r),se(o,1/n[0],1/n[1],1/n[2]);const a=e.results.min,l=e.results.max,c=e.results.ground,h=e.options.store===Eo.MIN,d=!!e.results.ground.target,f=sht(e.verticalOffset),m=e.tolerance;let y,v=h&&a.dist!=null?a.dist:1/0;const _=e.options,b=_.normalRequired||!_.backfacesTerrain,w=new Hj(!1,b),x=C=>{const T=C.renderData;if(!T?.vao)return;const M=T.geometry;KV(Eq,M.boundingBox);const I=T.localOrigin;f!=null&&(f.localOrigin=I,f.applyToAabb(Eq));const P=Eq;if(JT[0]=r[0]-I[0],JT[1]=r[1]-I[1],JT[2]=r[2]-I[2],!dse(P,JT,o,m,v))return;const D=(re,ve,xe)=>{re.set(this.type,C,ve,xe,Kn),v=h&&a.dist!=null?a.dist:1/0},F=(re,ve,xe)=>{if((!b||xe!=null)&&re>=0&&(_.backfacesTerrain||de(xe,n)<0)&&(_.invisibleTerrain||!_.selectionMode||i==null||i(r,s,re))){if((c.dist==null||re<c.dist)&&D(c,re,xe),_.isFiltered)return;_.store===Eo.ALL&&(y==null?(y=Pre(e.ray),D(y,re,xe),e.results.all.push(y)):re<y.dist&&D(y,re,xe)),(a.dist==null||re<a.dist)&&D(a,re,xe),_.store!==Eo.MIN&&(l.dist==null||re>l.dist)&&D(l,re,xe)}},L=CAt;ye(L,s,I);const{indices:N,indexCount:R}=M,k=M.vertexAttributes,W=k.getField(z.POSITION,uS),G=new Rj(W.typedBuffer,3,k.stride/4),j=R/3;if(!f&&j>pAt){const re=C.renderData;re.intersectionData==null&&(re.intersectionData=new ZFe(N,0,j,G)),re.intersectionData.intersectRay(JT,L,w,F)}else Fdt(JT,L,0,j,N,G,f,w,F)},S=this._rootTiles;S!=null&&(()=>{const C=this._tileIterator;C.reset(S);const T=e.options.invisibleTerrain;for(let M=C.next();M;M=C.next())!(M.visible||T&&M.intersectsClippingArea)||f==null&&!M.intersectsRay(r,n,m,v)||d&&this._useStencilForTile(M)?C.skipSubtree():x(M)})()}processScaleRangeQueries(e,i){if(!i.done)for(this._updatePatchGroups();e.updating&&!i.done;){e.prepare();for(const r of this._visiblePatchesByOrigin.values())for(const s of r)s.renderData?.textureReference!=null&&e.queriesForTile(s);e.process(),i.madeProgress()}}acquireTechniques(e){const i=!!X("enable-feature:terrain-shadows")&&e.bind.shadowMap.enabled;i!==this._castShadows&&(this._castShadows=i,this._patchesByOriginDirty=!0);const r=e.bind.viewshedEnabled;if(this._inViewshed!==r&&(this._inViewshed=r,this._patchesByOriginDirty=!0),e.bind.slot===be.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&kR))return null}else{const s=this.transparency===ga.Opaque?be.OPAQUE_TERRAIN:be.TRANSPARENT_TERRAIN;if(e.bind.slot!==s)return null}if(this.transparency===ga.Invisible)return null;switch(this._configuration.screenSpaceReflections=this._configuration.cloudReflections=this._configuration.receiveShadows=this._configuration.receiveAmbientOcclusion=!1,this._configuration.overlayMode=this._overlayRenderer.mode,e.output){case Y.Color:case Y.ColorEmission:return this._configuration.screenSpaceReflections=e.bind.ssr.lastFrameColor!=null,this._configuration.cloudReflections=e.bind.clouds.data!=null,this._configuration.receiveShadows=e.bind.shadowMap.ready,this._configuration.receiveAmbientOcclusion=e.bind.ssao!=null,this._acquireTechnique(e.output,e.bind.slot===be.OCCLUDED_TERRAIN);case Y.Shadow:case Y.ShadowExcludeHighlight:return this._castShadows?this._acquireTechnique(Y.Shadow,!1):null;case Y.ViewshedShadow:return this._inViewshed?this._acquireTechnique(Y.ViewshedShadow,!1):null;case Y.Depth:case Y.Normal:return this._acquireTechnique(e.output,!1);case Y.ObjectAndLayerIdColor:return this._acquireTechnique(Y.ObjectAndLayerIdColor,!1);case Y.Highlight:return this._overlayRenderer.hasHighlights?this._acquireTechnique(Y.Highlight,!1):null}return null}render(e,i){switch(this._updatePatchGroups(),i.useStencil=!1,e.output){case Y.Color:case Y.ColorEmission:{const r=e.bind.slot===be.OCCLUDED_TERRAIN?ir.Occluded:ir.Color;this._renderMaterialPass(e,i,r);break}case Y.Depth:case Y.Normal:this._renderAuxiliaryPass(e,i,ir.Color,this._visiblePatchesByOrigin);break;case Y.Highlight:{const r=e.bind.highlight?.name;r&&this._overlayRenderer.hasHighlights&&this._overlayRenderer.renders(ir.Highlight)&&this._overlayRenderer.hasHighlightOptions(r)&&this._renderAuxiliaryPass(e,i,ir.Highlight,this._visiblePatchesByOrigin);break}case Y.Shadow:case Y.ShadowExcludeHighlight:case Y.ViewshedShadow:this._renderAuxiliaryPass(e,i,null,this._allPatchesByOrigin);break;case Y.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,i,ir.ObjectAndLayerIdColor,this._visiblePatchesByOrigin)}}updateTileBackground(e){if(this._tileRenderer==null)return;const i=this._tileRenderer;let r;if(e!=null){const s=qe.toUnitRGBA(e);r=Le(s[0]||0,s[1]||0,s[2]||0)}i.setBackground(r),this._allTiles.forAll(s=>i.updateTileTexture(s,Ms.FADING)),this._configuration.tileBlendInput=i.backgroundIsGrid?Mm.GridComposite:i.backgroundColor!=null?Mm.ColorComposite:Mm.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchesByOriginDirty&&(this._rebuildPatchGroups(),this._patchesByOriginDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==K$.NONE){const e=Array.from(this._visiblePatchesByOrigin.values()),i=this._stencilEnabledLayerExtents;for(const r of e)iCt(this.renderOrder,r,i);e.sort((r,s)=>dFe(r[0],s[0],this.renderOrder)),this._visiblePatchesByOrigin=new Map(e.map(r=>[r[0].renderData.localOrigin,r])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){const e=this._rootTiles;if(e!=null){e[0]?.surface.checkAllTilesWaterproofness(),this._visiblePatchesByOrigin.clear(),this._allPatchesByOrigin.clear();for(const i of e)this._rebuildPatchGroupsForRootTile(i)}}_rebuildPatchGroupsForRootTile(e){const i=this._tileIterator;for(i.resetOne(e);!i.done;){const r=i.next(),s=r.renderData;if(!s){this._numTilesCulled++;continue}const n=s.localOrigin;if(this._castShadows||this._inViewshed){let a=this._allPatchesByOrigin.get(n);a||(a=[],this._allPatchesByOrigin.set(n,a)),a.push(r)}if(!r.visible){this._numTilesCulled++,i.skipSubtree();continue}let o=this._visiblePatchesByOrigin.get(n);o||(o=[],this._visiblePatchesByOrigin.set(n,o)),o.push(r),i.skipSubtree()}}_useStencilForTile(e){for(const i of this._stencilEnabledLayerExtents)if(e.intersectsExtent(i))return!0;return!1}_renderAuxiliaryPass(e,i,r,s){const n=e.rctx;this._passParameters.overlayContent=r,n.bindTechnique(i,e.bind,this._passParameters);const o=this._stencilEnabledLayerExtents.length>0;s.forEach(a=>{this._drawParameters.origin=a[0].renderData.localOrigin,i.program.bindDraw(e.bind,this._passParameters,this._drawParameters);for(let l=0;l<a.length;l++)this._renderPatch(e,i,a[l],Ui.TRIANGLES,o,r)}),e.rctx.bindVAO(null)}_renderMaterialPass(e,i,r){const{rctx:s}=e;this._passParameters.overlayContent=r,s.bindTechnique(i,e.bind,this._passParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0;const n=e.bind.camera,o=i.program;if(this._configuration.screenSizePerspective&&this.pointsOfInterest){const f=URe(this._stage.viewingMode,this._ellipsoidRadius),m=this.pointsOfInterest.centerOnSurfaceFrequent.distance;f.update({distance:m,fovY:n.fovY})}const a=this._stencilEnabledLayerExtents.length>0,l=r===ir.Occluded;l&&(o.bindTexture("tex",this._emptyTex),o.setUniform3fv("textureOpacities",on),o.setUniform4fv("texOffsetAndScale",sn));const c=this._tileRenderer?.backgroundColor!=null?this._tileRenderer.backgroundColor:on;this._configuration.tileBlendInput===Mm.ColorComposite&&o.setUniform3fv("backgroundColor",c);const h=this.wireframe?Ui.LINES:Ui.TRIANGLES;this._configuration.textureFadingEnabled&&o.bindTexture("texNext",this._emptyTex);const d=this._visiblePatchesByOrigin;for(const f of d.values()){const m=f[0].renderData.localOrigin;this._drawParameters.origin=m,i.program.bindDraw(e.bind,this._passParameters,this._drawParameters),this._numOriginsRendered++;for(const y of f){const v=y.renderData,_=v.textureReference;if(_!=null){if(!l){o.setUniform4fv("texOffsetAndScale",_.offsetAndScale),o.bindTexture("tex",_.texture.texture);const b=v.textureFadeFactor,w=b<1?v.nextTextureReference:null;this._configuration.textureFadingEnabled&&w!=null&&b<1?(o.setUniform1f("fadeFactor",b),o.setUniform4fv("nextTexOffsetAndScale",w.offsetAndScale),o.setUniform3fv("nextTexOpacities",w.opacities),o.bindTexture("texNext",w.texture.texture)):o.setUniform1f("fadeFactor",1),v.textureIsFading&&this.setNeedsRender(),o.setUniform3fv("textureOpacities",_.opacities)}this._renderPatch(e,i,y,h,a,r),y.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,i,r,s,n,o){const a=r.renderData,l=a.vao,c=l?.indexBuffer;if(!l||c==null)return void(Jn&&console.error("Rendered tile with no indices: ",r.lij," : ",a));const h=i.program;o==null||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(h,a.overlay),n&&(i.useStencil=this._useStencilForTile(r),e.rctx.setPipelineState(i.getPipeline()));const d=a.geometry.indexCount;e.rctx.bindVAO(l),h.assertCompatibleVertexAttributeLocations(l),e.rctx.drawElements(s,d,c.indexType,0)}_bindOverlayPatchData(e,i){e.setUniform4fv("overlayTexOffset",i.offsets),e.setUniform4fv("overlayTexScale",i.scales)}_acquireTechnique(e,i){return this._configuration.output=e,this._configuration.renderOccluded=i,this._techniques.get(yCt,this._configuration)}get test(){}hasHighlightOptions(e){return this._overlayRenderer.hasHighlightOptions(e)}};u([p({readOnly:!0})],$u.prototype,"_isGlobal",null),u([p()],$u.prototype,"renderOccludedFlags",void 0),u([p({value:!1})],$u.prototype,"renderingDisabled",null),u([p({value:!0})],$u.prototype,"visible",null),u([p()],$u.prototype,"texturesBeingCompressed",null),u([p()],$u.prototype,"renderPatchBorders",null),u([p()],$u.prototype,"visualizeNormals",null),u([p()],$u.prototype,"cullBackFaces",null),u([p({value:K$.FRONT_TO_BACK})],$u.prototype,"renderOrder",null),u([p()],$u.prototype,"wireframe",null),$u=u([A("esri.views.3d.terrain.TerrainRenderer")],$u);const TAt=$(),EAt=$(),JT=$(),CAt=$();let $At=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},rm=class extends ue{constructor(e){super(e)}initialize(){this.addHandles([this.layers.on("change",()=>this._update()),H(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())]),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(i=>!(!EC(i)||i.isRejected())&&!(i.isFulfilled()&&!AAt(i,this.viewSpatialReference,this.viewingMode))&&(e=i,!(i?.type==="vector-tile"||yB(i)))),e)if(e.isResolved()){const i=TG(e,this.viewSpatialReference,this.viewingMode);if(i!=null){const r=new rc(i.tileInfo);this._lockTilingScheme(r)}}else this._updateWhen(e)}_updateWhen(e){const i=e.when().catch(()=>{}).then(()=>{i!==this._waitTask||this.destroyed||this._update()});this._waitTask=i}_lockTilingScheme(e){if(this.viewingMode===Be.Global){const i=e.levels.length-1,r=e.spatialReference;r.isWebMercator?e=rc.makeWebMercatorAuxiliarySphere(i):Bne(r)&&(e=rc.makeGCSWithTileSize(e.spatialReference,e.pixelSize,i))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this.removeAllHandles(),this.addHandles(H(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Be.Global){const e=this.extentHelper.viewSpatialReference;e.isWebMercator?this.tilingScheme=rc.WebMercatorAuxiliarySphere:eFe(e)&&(this.tilingScheme=rc.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;e==null||Tx(e,this.extent)||(this.tilingScheme=rc.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){}};function AAt(t,e,i){return TG(t,e,i)!=null}u([p()],rm.prototype,"tilingScheme",void 0),u([p({readOnly:!0})],rm.prototype,"extent",void 0),u([p({value:!1})],rm.prototype,"tilingSchemeLocked",void 0),u([p({constructOnly:!0})],rm.prototype,"viewSpatialReference",void 0),u([p({constructOnly:!0})],rm.prototype,"layers",void 0),u([p({constructOnly:!0})],rm.prototype,"extentHelper",void 0),u([p({constructOnly:!0})],rm.prototype,"viewingMode",void 0),rm=u([A("esri.views.3d.terrain.TilingSchemeLogic")],rm);let MAt=class{constructor(){this._offset=He(),this.scale=0}get offset(){return this._offset}init(e,i,r,s){this.tile=e,this._offset[0]=i,this._offset[1]=r,this.scale=s}dispose(){this.tile=null,this._offset[0]=0,this._offset[1]=0,this.scale=0}};var _5;let Bt=_5=class extends ws.EventedMixin(ue){get allTiles(){return this._allTiles}constructor(t){super(t),this._scaleRangeQueries=new y5,this._iteratorPool=new Cl(hFe,e=>e.remove=()=>this._iteratorPool.release(e)),this._postorderIterator=new Q2t,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._usedMemory=null,this._performanceInfo=new $At,this._viewChanged=!1,this.heading=0,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=$(),this._eyePosSurfaceSR=$(),this._splitLimits=new yp,this._frustum=YU(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._watchUpdatingTracking=new Hy,this._frameTask=$$,this._allTiles=new Jt,this._upsampleInfoPool=new Cl(MAt),this._shouldEmitChangeEvent=!1,this._destroying=!1,this._rootTilesExtent=Qt(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=Ae.WebMercator,this._elevationProjectorCache=new Map,this.visibleElevationBounds=new oC(1/0,-1/0),this.rootTileElevationBounds=new oC(1/0,-1/0),this._projectorCache=new Map,this._radiusModifier=Math.cos(Math.PI/16/16),this._tilingSchemeSpatialReference=null,this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateCarree=!1,this.overlayManager=new Vl({...t,surface:this}),this._isGlobal=!t.view?.state?.isLocal,this._isGeographic=this._spatialReference?.isGeographic??!1,this._tileConstructor=this._isGlobal?n$t:i$t,this._ellipsoid=gr(t.view.spatialReference)}initialize(){const t=this.view,e=t.resourceController,i=e.memoryController;this._tileCache=new XD((l,c)=>i.newCache(l,c),"terrain-tile"),this._upsampleMapCache=i.newCache("terrain-upsample",l=>l.unloadMapData()),this._elevationQueryCache=new c2t(i.newCache("elevation-query"));const r=this.overlayManager;this._renderer=new $u(r.renderer,t._stage,this._allTiles,this._ellipsoid.radius,i),this.addHandles([H(()=>r.renderer.isEmpty,()=>this._evaluateTransparency()),H(()=>this.renderer.visible,l=>this.suspended=!l),H(()=>this.heading,l=>{this._renderer.updateHeading(l),this._updateTileTextures(Ms.FADING)}),H(()=>({heading:t.camera?.heading,state:t.state?.mode}),({heading:l,state:c})=>{if(l==null)return;if(this.isGlobal&&this.isGeographic||this.isWebMercatorOnPlateCarree)return void(this.heading=90*Math.round(l/90)%360);const h=Math.round(l)%360,d=Math.abs(h-this.heading);(c===ai.IDLE||Math.min(d,360-d)>=30)&&(this.heading=h)})],"overlayManager"),this.addHandles([H(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?Ms.UNFADED:Ms.IMMEDIATE)},St),H(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?Ms.UNFADED:Ms.IMMEDIATE),St),H(()=>this.backgroundColor,(l,c)=>{l?.equals(c)||(this._handleLayerViewChanges(),this._renderer.updateTileBackground(l))},Gt),H(()=>this.snapLevel,()=>this._viewChanged=!0,Gt),H(()=>this.view.pointsOfInterest,l=>{this._renderer.pointsOfInterest=l,this._watchUpdatingTracking.removeAll(),l&&this._watchUpdatingTracking.add(()=>l.focus.renderLocation,()=>this._allTilesSorted=!1)}),H(()=>bs.TERRAIN_TILE_TREE_SHOW_TILES,l=>{l&&!this._treeDebugger?V(()=>import("./TerrainTileTree3DDebugger-CxSg5O0K.js"),__vite__mapDeps([362,363])).then(({TerrainTileTree3DDebugger:c})=>{!this._treeDebugger&&bs.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new c({view:t}))}):l||(this._treeDebugger=Ce(this._treeDebugger))},Nt)]),this.addHandles([H(()=>this._renderer.tileRenderer?.texturesBeingCompressed,(l,c)=>{c&&l<c&&(this.setMemoryDirty(),this._allTiles.forAll(h=>h.setMemoryDirty()))})]),this.addHandles([H(()=>this._renderer.texturesBeingCompressed,(l,c)=>{l===0&&l!==c&&this.requestRender()})]);const{spatialReference:s}=t;this._extentHelper=R2t(this.viewingMode,{layers:t.map.allLayers,layerViews:t.allLayerViews,viewSpatialReference:s});const n=new h$({getCollections:()=>t.defaultsFromMap?.mapCollections?.map(({layers:l})=>l),getChildrenFunction:l=>l&&"layers"in l?l.layers:null}),o=new rm({layers:n,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:s});this._set("tilingSchemeLogic",o),this._updateTilingScheme(),this._elevationDataRequester=e.createStreamDataRequester(xm.ELEVATION),this._mapDataRequester=e.createStreamDataRequester(xm.BASEMAP);const a=e.scheduler;this._frameTask=a.registerTask(at.TERRAIN_SURFACE,this),this.addHandles([H(()=>this._extentHelper.stencilEnabledExtents,l=>this._renderer.setStencilEnabledLayerExtents(l),Nt),H(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),Gt),H(()=>this.extent,()=>this._updateRootTiles(),Nt),t.on("resize",()=>this._viewChangeUpdate()),H(()=>{const l=t.state;return[this._lodBias,this.lodSnappingEnabled,t.quality,l.camera,l.contentCamera,l.fixedContentCamera]},()=>this._viewChangeUpdate(),St),H(()=>t.qualitySettings?.fadeDuration,l=>this._renderer.textureFadingEnabled=l>0,Nt),H(()=>t.qualitySettings?.physicallyBasedRenderingEnabled,l=>this._renderer.pbrMode=l?_t.Simplified:_t.Disabled,Nt),H(()=>t.qualitySettings?.tiledSurface.elevationLevelDelta,()=>this._updateAllTileGeometries()),H(()=>this._userClippingExtent,()=>this._updateClippingExtent(),Gt)]),this.addHandles(t.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges(),this._renderer.updateTileBackground(this.backgroundColor)}destroy(){this._destroying=!0,this._frameTask.remove(),this._watchUpdatingTracking.destroy(),this._removeAllTiles(),this._set("tilingSchemeLogic",Ce(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((t,e)=>this._unregisterTiledLayerView(e)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",Ce(this.overlayManager)),this._tileCache=Ce(this._tileCache),Zne.prune(),this._treeDebugger=Ce(this._treeDebugger),this._renderer=Ce(this._renderer),this._iteratorPool=Ce(this._iteratorPool),this._upsampleMapCache=Ce(this._upsampleMapCache),this._elevationQueryCache=Ce(this._elevationQueryCache),this._set("view",null),this._extentHelper=Ce(this._extentHelper),this._upsampleInfoPool=Ce(this._upsampleInfoPool),MCt()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){if(this.lodSnappingEnabled){const{view:t,tilingScheme:e}=this,i=t.scale;if(e&&i){const r=e.levelAtScale(i)+t.qualitySettings.tiledSurface.lodBias,s=e.getMaxLod();return r<=0?null:Math.min(r,s||1/0)}}return null}get lodSnappingEnabled(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get hasStencilEnabledExtents(){return this._extentHelper.stencilEnabledExtents.length>0}get _userClippingExtent(){const{spatialReference:t}=this,{clippingArea:e}=this.view;if(e==null||t==null)return null;const i=Qt(),r=INe(e,i,t)?i:null,s=this._get("extent");return Tx(r,s)?s:r}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const t=z7(this.groundExtent,this._userClippingExtent,Qt()),e=this._get("extent");return Tx(t,e)?e:t}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){return this.tilingSchemeLogic?.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||this._watchUpdatingTracking?.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||this.overlayManager?.updating||this.renderer.texturesBeingCompressed)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view?.map?.ground?.opacity??1}set baseOpacity(t){this.view.map.ground.opacity=t}get viewingMode(){return this.view.state.viewingMode}get ready(){return this._rootTiles!=null}set renderOrder(t){this._renderer.renderOrder=t,this._set("renderOrder",t)}get rootTiles(){return this._rootTiles}get spatialReference(){return this.tilingScheme?.spatialReference??null}get backgroundColor(){return this.view?.map?.ground?.surfaceColor}set backgroundColor(t){this.view.map.ground.surfaceColor=t}set slicePlaneEnabled(t){this._renderer.slicePlaneEnabled=t,this._set("slicePlaneEnabled",t),this._evaluateTransparency()}get tilingSchemeLocked(){return this.tilingSchemeLogic?.tilingSchemeLocked??!1}get wireframe(){return this._renderer?.wireframe}set wireframe(t){t!==this._renderer.wireframe&&(this._renderer.wireframe=t,this._updateAllTileGeometries())}get opaque(){return this._renderer.transparency===ga.Opaque}set suspended(t){this._set("suspended",t),this._viewChangeUpdate()}get fadeDuration(){return this.view.qualitySettings.fadeDuration??0}intersect(t,e,i,r){this._renderer.intersect(t,e,i,r)}getElevationLevelDelta(t){return t<4?3:this.view.qualitySettings.tiledSurface.elevationLevelDelta}getElevation(t,e,i,r){const s=this._rootTiles;if(!s?.length||s[0].layerInfo[Lt.ELEVATION].length===0)return null;let n=this._elevationProjectorCache.get(r);if(n===void 0&&(n=xb(r,this._spatialReference)??null,this._elevationProjectorCache.set(r,n)),n==null)return J.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;const o=se(QM,t,e,i);return n(o,0,o,0),Pve(s,o[0],o[1])}getElevations(t,e,i){const r=this._rootTiles,s=r?r[0].layerInfo[Lt.ELEVATION].length:0;if(r?.length&&s!==0)for(let n=0;n<e;++n){const o=3*n;i(n,Pve(r,t[o],t[o+1]))}else for(let n=0;n<e;++n)i(n,null)}getScale(t){if(!this.tilingScheme)return null;if(!pc(t,QM,this.spatialReference))return J.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const e=this._rootTiles;if(e!=null){for(const i of e)if(i?.containsPoint(QM)){let r=i;for(;r.children[0]&&!r.rendered;){const s=r.children[0].extent;let n=0;QM[0]>s[2]&&(n+=1),QM[1]<s[1]&&(n+=2),r=r.children[n]}return this._getLodBiasCorrectedScale(r.level)}}return 1/0}_ensureProjector(t){const e=this._projectorCache.get(t);if(e)return e;const i=xb(t,this._tilingSchemeSpatialReference)??null;return this._projectorCache.set(t,i),i}getSphereElevationBounds(t,e){const i=this._ensureProjector(e);if(i==null)return J.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;aS(t,XT);const r=XT;i(r,0,r,0);const s=new mB,n=this._rootTiles;if(n!=null){const o=[];for(const l of n)o.push(l);let a=0;for(;a<o.length;){const l=o[a];if(++a,!kle(l.extent,XT))continue;const c=l.children;if(c[0]==null||l.rendered)s.expandElevationRangeValues(l.elevationBoundsMin,l.elevationBoundsMax);else for(const h of c)o.push(h)}}return s}getRootElevationBounds(){return new mB(this.rootTileElevationBounds.min,this.rootTileElevationBounds.max)}getLowerBoundRadius(){const t=(this._ellipsoid.radius+this.visibleElevationBounds.min)*this._radiusModifier;return Math.min(t,this._ellipsoid.radius)}getSphereScale(t,e){if(!this.tilingScheme)return null;if(!pc(t,XT,this.spatialReference))return J.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;XT[3]=e;let i=null;const r=n=>{if(n&&kle(n.extent,XT)){const o=n.children;if(o[0]&&!n.rendered)for(const a of o)r(a);else{const a=this._getLodBiasCorrectedScale(n.level);i=i==null?a:Math.min(i,a)}}},s=this._rootTiles;if(s!=null)for(const n of s)r(n);return i}queryVisibleScaleRange(t,e,i,r){const s=e?this.tilingScheme.levelAtScale(e):0,n=i?this.tilingScheme.levelAtScale(i):1/0,o=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(t,s+o,n+o,r)}_evaluateTransparency(){const t=this.baseOpacity,e=this.overlayManager.renderer.isEmpty,i=this._renderer.transparency,r=this._allSurfaceLayersTransparent()?e?ga.Invisible:ga.InvisibleWithDraped:t>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?ga.Opaque:ga.Transparent;return this._renderer.transparency=r,i!==r}_updateTilingScheme(){const t=this.tilingSchemeLogic.tilingScheme;if(t===this.tilingScheme)return;po(!!t,"tiling scheme cannot be reset to undefined"),this._isGlobal=!this.view?.state?.isLocal,this.tilingScheme&&this._removeAllTiles();const e=t?.spatialReference??Ae.WebMercator;this._spatialReference=e,this._isWebMercator=!!e?.isWebMercator,this._isWebMercatorOnPlateCarree=this._isWebMercator&&OP(this.view?.renderSpatialReference),this._isGeographic=e?.isGeographic??!1,this._set("tilingScheme",t),this._tilingSchemeSpatialReference=this.tilingScheme?.spatialReference,this._projectorCache.clear(),this._updateClippingExtent(),t&&(this._updateTiledLayers(),this._renderer.tileSize=t.pixelSize,this.overlayManager.spatialReference=t.spatialReference,this._updateRootTiles())}_acquireTile(t,e,i,r){const s=this._tileCache.pop(_5._tileMemcacheKey);return s?(s.init(t,e,i,r,this),s):new this._tileConstructor(t,e,i,r,this)}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:t,tilingScheme:e}=this;if(!e)return;const i=IAt;let r=e.rootTilesInExtent(t,i,5*J2);if(this._rootTiles!=null){if(r.length>J2)return void J.getLogger(this).warn(d0t);const s=this._rootTiles.map(o=>o.lij),n=q9(s,r,m5);if(this._updatingRootTiles=!0,n.removed.length>0||n.added.length>0){const o=this._rootTiles.filter(a=>!(n.removed.findIndex(l=>m5(l,a.lij))>-1)||(this._purgeTile(a),!1));n.added.forEach(a=>o.push(this._newRootTile(a))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,r.length>J2&&(J.getLogger(this).warn(p0t),r=e.rootTilesInExtent(t,i,J2)),this._setRootTiles(r.map(s=>this._newRootTile(s)));Tx(i,this._rootTilesExtent)||(this._rootTilesExtent=Qt(i)),this.renderer.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const t=this._allTiles.filter(e=>e.loaded&&e.intersectsClippingArea);t.sort(Am),t.forEach(e=>this._renderer.updateTileGeometryState(e)),t.forEach(e=>e.renderData.updateNeighborData()),this._updateTilesGeometries(t),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(t){if(t.length===0)return;t.sort(Am);const e=this.renderer;t.forEach(i=>e.updateGeometryIfNeeded(i)),t.forEach(i=>this._pendingTilesForElevationUpdateEvent.add(i))}_shouldSplit(t){return t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===et.SPLIT}_newRootTile(t){const e=this._acquireTile(0,t[1],t[2],null);return this._shouldSplit(e)&&e.setPendingUpdate(et.SPLIT),this._loadTile(e),this._markTileToUpdate(e),this._updateRootTileElevationBounds(),e}_setRootTiles(t){if(this._rootTiles=t,this._allTiles.clear(),t!=null){const e=this._iteratorPool.acquire();for(e.reset(t);!e.done;)this._allTiles.push(e.next());e.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(t)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this.renderer.visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(t){t.updateClippingStatus(this.extent)&&t.resetPendingUpdate(et.GEOMETRY)&&this._updateTileGeometryState(t)}_updateTilesVisibility(t){if(t==null)return;const e=cCt(t),i=this.visibleElevationBounds;let r=e?i.min:1/0,s=e?i.max:-1/0;const n=this.extent,o=this.view.state.contentCamera.viewProjectionMatrix;this.setTileTreeDirty();const a=this._iteratorPool.acquire();for(a.reset(t);!a.done;){const l=a.next();l.updateClippingStatus(n)&&l.resetPendingUpdate(et.GEOMETRY)&&this._updateTileGeometryState(l),l.computeVisibility(),l.updateScreenDepth(o),l.renderData&&(r=Math.min(l.elevationBoundsMin,r),s=Math.max(l.elevationBoundsMax,s))}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._updatePendingTileGeometries(),isFinite(r)&&isFinite(s)&&(i.min!==r||i.max!==s)&&(this.visibleElevationBounds=new oC(r,s))}_updateRootTileElevationBounds(){let t=1/0,e=-1/0;const i=this._rootTiles;i?.forEach(({elevationBoundsMin:s,elevationBoundsMax:n})=>{t=Math.min(t,s),e=Math.max(e,n)});const r=this.rootTileElevationBounds;r.min===t&&r.max===e||(this.rootTileElevationBounds=new oC(t,e))}_updateViewDependentParameters(){const{camera:t,contentCamera:e}=this.view.state,i=Math.tan(.5*e.fovX),r=Math.tan(.5*e.fovY),s=this.tilingScheme.pixelSize,n=2**-this._lodBias*t.pixelRatio;this._splitLimits.aboveGround=t.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=s/t.width*this.maxTextureScale*n,this._splitLimits.relativeHeightLimit=s/t.height*this.maxTextureScale*n,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?this._splitLimits.frustum=AJ(this._splitLimits.frustum??YU(),e.frustum):this._splitLimits.frustum=null,AJ(this._frustum,t.frustum),ne(this._eyePosRenderSR,e.eye),mc(t.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateTileGeometryState(t){t.updateVisibility(),this._renderer.updateTileGeometryState(t)&&this._markTileToUpdate(t),this.setMemoryDirty()}_markAllTileNeighborsForUpdate(t){t.forEachLoadedNeighbor(e=>{this._layerViews[Lt.MAP].some(X$)&&e.setPendingUpdate(et.TEXTURE_FADING),this._pendingTilesToUpdate.add(e)})}_updateTileTexture(t,e){const i=t.resetPendingUpdate(et.TEXTURE_FADING)?et.TEXTURE_FADING:!!t.resetPendingUpdate(et.TEXTURE_NOFADING)&&et.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(t,i),this._usedMemory=null,e.madeProgress())}_emitElevationUpdateEventForTiles(){if(!this._shouldEmitChangeEvent)return;const t=Cq.extent;sv(t),this._pendingTilesForElevationUpdateEvent.forEach(e=>vC(t,e.extent,t)),this._pendingTilesForElevationUpdateEvent.clear(),Cq.spatialReference=this.spatialReference,this.emit("elevation-change",Cq),this._shouldEmitChangeEvent=!1}runTask(t){this._handleLayerViewChanges(t),this._frameTask.processQueue(t),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,t),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(t),this._sortTiles(t);const e=!this.view.state.fixedContentCamera;if(this._mergeAndSplit(t,e),this._updateElevation(t),this._updateTextures(t),e||this._mergeAndSplit(t,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._updatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),t.done&&t.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue"),Jn&&this._checkTileInvariant(),!t.hasProgressed)return Ko}_checkTileInvariant(){const t=new Map;this._allTiles.forAll(e=>t.set(e,new Set)),this._allTiles.forAll(e=>{if(po(e.rendered===e.leaf,` rendered ${e.rendered} != ${e.leaf} leaf`),!e.leaf){const i=s=>s.unmergableChildCount===0&&s.maxLevelDeltaNeighborCount===0,r=e.children.reduce((s,n)=>s+(i(n)?0:1),0);if(po(e.unmergableChildCount===r,` Tile[${e.lij.toString()}] unmergeable child count mismatch: actual ${e.unmergableChildCount} vs ${r}`),e.hasPendingUpdate(et.MERGE)){po(!e.hasPendingUpdate(et.SPLIT),"Tile can be both split and merge at the same time");for(const s of e.children)po(s.leaf||s.hasPendingUpdate(et.MERGE),"Child of tile to merge must also merge")}}for(let i=0;i<4;++i){if(e.rendered){const o=e.renderData?.geometryState.edgePeerNeighbors[i];if(o!=null){{const a=e.level-o.level<=An;a||(console.log(`tile level delta [${e.lij.toString()}] vs [${o.lij.toString()}] > ${An}  (edge[${i}])`),po(a,`tile level delta [${e.level}] vs [${o.level}] > ${An}`))}po(e.level-o.level<=An,`Max tile lod delta exceeded: [${e.lij.toString()}] vs [${o.lij.toString()}]`)}}const r=e.level-An,s=o=>o.leaf||o.level===e.level,n=e.findNeighborTile(Jp[i],s);if(n!=null){if(e.leaf&&e.level>=An){let o=n;for(;e.level-o.level<An;)o=o.parent;const a=[r,e.lij[1]>>An,e.lij[2]>>An];if(!m5(a,o.lij)){const l=t.get(o);po(!l.has(e),"Cannot already have neighbor"),l.add(e)}}po(n.rendered||n.level===e.level,"Non-same-level-neighbor of rendered must be rendered"),po(e.level-n.level<=An,`Tile level delta [${e.level}] vs [${n.level}] > ${An}`)}}}),this._allTiles.forAll(e=>{const i=e.maxLevelDeltaNeighborCount,r=t.get(e);po(i===r.size,`Tile[${e.lij.toString()}] merge-blocker mismatch: actual ${i} vs ${r.size}`)})}_updateAllTilesStatus(t){if(!this._viewChanged||!this._rootTiles||t.done)return;this._viewChanged=!1;const e=new RAt(this._allTiles.length);e.pushAll(this._rootTiles);const i=this.snapLevel,r=this._splitLimits,s=this._eyePosRenderSR;this._allTiles.forAll(o=>{o.maxLevelDeltaNeighborCount=0,o.unmergableChildCount=0});const n=this.view.state.contentCamera.viewProjectionMatrix;for(;!e.empty;){const o=e.pop(),a=o.parent,l=a!=null&&a.hasPendingUpdate(et.MERGE),c=l?et.MERGE:o.shouldSplit(r,s,i),h=c===et.SPLIT;o.leaf?$q(o,h):e.pushAll(o.children),l?(o.resetPendingUpdate(et.SPLIT),o.leaf||o.setPendingUpdate(et.MERGE),this._updateClippingStatus(o),o.updateVisibility(),o.updateScreenDepth(n)):h?(o.resetPendingUpdate(et.MERGE),o.leaf&&o.setPendingUpdate(et.SPLIT)):(o.resetPendingUpdate(et.SPLIT)&&o.updateAgentSuspension(),c===et.ELEVATION&&o.updateAgents(Lt.ELEVATION),o.leaf||(o.setPendingUpdate(et.MERGE),o.resetPendingUpdate(et.SPLIT)))}this.requestUpdate(),(this._shortBatches||!this._oneBatchPerFrameTask)&&this._updatePendingTileGeometries(),t.madeProgress()}_sortTiles(t){t.done||this._allTilesSorted||(aCt(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),t.madeProgress())}_markTileToUpdate(t){Oe(t.loaded),t.intersectsClippingArea&&(this._pendingTilesToUpdate.add(t),this._markAllTileNeighborsForUpdate(t))}_updatePendingTileGeometries(){const t=this._pendingTilesToUpdate,e=Array.from(t.keys()).filter(s=>s.loaded&&s.intersectsClippingArea);if(e.length===0)return void t.clear();const i=(s,n)=>{!n?.loaded||!n.intersectsClippingArea||n.level<s.level||t.has(n)||(t.add(n),e.push(n),n.renderData.updateNeighborData())};e.sort(Am);const r=e.length;for(let s=0;s<r;++s){const n=e[s];Oe(n.loaded),Oe(n.intersectsClippingArea);const o=n.renderData;o.updateNeighborData();const a=o.dirtyEdgeResolutions,l=o.geometryState,c=h=>{const d=_B[h];i(n,l.cornerPeerNeighbors[h]?.findCorner(vB(d),f=>f.loaded))};for(let h=0;h<4;++h)if(a&1<<h){const d=o.geometryState.edgePeerNeighbors[h];d&&d?.level>=n.level&&d.forAllSubtreeOnSide(Vne(Jp[h]),f=>!(!f.loaded||!f.intersectsClippingArea)&&(Oe(t.has(f)||Am(n,f)<0),i(n,f),!0)),c((h+1)%4),c(h)}}t.clear(),this._updateTilesGeometries(e),this._shouldEmitChangeEvent=!0,Jn&&gB&&this.checkAllTilesWaterproofness()}_mergeAndSplit(t,e){if(this.suspended||t.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let i=!1;const r=this.view.state.fixedContentCamera;let s=!1;for(;!t.done;){s=!0;let n=!1;const o=!this._allTiles.some(a=>{if(!i&&!r&&!a.visible)return t.done;let l=a;if(a.hasPendingUpdate(et.MERGE)){if(!e||a.unmergableChildCount>0)return t.done;for(a.resetPendingUpdate(et.MERGE);l.parent!=null&&l.parent.unmergableChildCount===0&&l.parent.resetPendingUpdate(et.MERGE);)l=l.parent;this._mergeTile(l),n=!0,t.madeProgress()}else if(a.resetPendingUpdate(et.SPLIT)){let c=!0;const h=a.level;if(h>=An){const d=f=>f.leaf||h-f.level<An;for(let f=0;f<4;++f){const m=a.findNeighborTile(Jp[f],d);m!=null&&h-m.level===An&&(c=!1,Jn&&(Oe(m.leaf),Oe(m.hasPendingUpdate(et.SPLIT))))}}c?(this._splitTile(a),t.madeProgress(),n=!0):a.setPendingUpdate(et.SPLIT)}return t.done});if(n&&(this._allTilesSorted=!1,this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries()),o){if(!i){i=!0;continue}if(!n)break}else this._allTilesDirty=!0}s?t.madeProgress():this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries(),this._sortTiles(t)}_updateElevation(t){t.done||(this._allTiles.some(e=>(e.resetPendingUpdate(et.GEOMETRY)&&(this._updateTileGeometryState(e),this._shortBatches&&this._updatePendingTileGeometries(),t.madeProgress()),t.done)),!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries())}_updateTextures(t){t.done||this._allTiles.some(e=>(this._updateTileTexture(e,t),t.done))}_updateClippingExtent(){this.spatialReference&&(this.overlayManager?.updateOverlayParameters(bt.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const t=this.view.quality;return this.view.qualitySettings.tiledSurface.lodBias-(1-t)*u0t}_getLodBiasCorrectedScale(t){const e=this.tilingScheme.levels,i=ce(t-this._lodBias,0,e.length-1),r=i-Math.floor(i);return e[Math.floor(i)].scale*(1-r)+e[Math.ceil(i)].scale*r}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(t=>this._purgeTile(t)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.renderer.visible=!1}_purgeSubtree(t){const e=t.children;e[0]&&(this._purgeTile(e[0]),this._purgeTile(e[1]),this._purgeTile(e[2]),this._purgeTile(e[3]),t.clearChildren())}_purgeTile(t){t.leaf?Dve(t):this._purgeSubtree(t),this._allTiles.removeUnordered(t),this._unloadTile(t),t.dispose(),this._tileCache.put(_5._tileMemcacheKey,t)}_unloadTile(t){this._pendingTilesToUpdate.delete(t),this._pendingTilesForElevationUpdateEvent.delete(t),t.unload()}_splitTile(t){po(t.leaf,"Tile that is already split should not be split again!"),po(t.rendered,"Tile marked to split is not rendered"),Dve(t);const e=t.createChildren();this._allTiles.pushArray(e),t.updateAgentSuspension(),po(t.rendered,"parent should be rendered"),e.forEach(i=>this._loadTile(i)),e.forEach(i=>this._pendingTilesToUpdate.add(i)),this._unloadTile(t),this._markAllTileNeighborsForUpdate(t),this._emitTileScaleChange(t,t.level+1),this._allTilesDirty=!0,this._shortBatches&&this._updatePendingTileGeometries(),e.forEach(i=>$q(i,i.hasPendingUpdate(et.SPLIT))),++this._performanceInfo.numSplit}_emitTileScaleChange(t,e=t.level){LF.spatialReference=this.spatialReference,LF.extent=t.extent,LF.scale=this._getLodBiasCorrectedScale(e),this.emit("scale-change",LF)}createTile(t,e,i,r){po(!!r,"createTile sanity check");const s=this._acquireTile(t,e,i,r);return s.updateClippingStatus(this.extent),s.updateScreenDepth(this.view.state.contentCamera.viewProjectionMatrix),this._shouldSplit(s)&&s.setPendingUpdate(et.SPLIT),s}get _shortBatches(){return this.view.state.mode!==ai.IDLE}_mergeTile(t){po(!t.hasPendingUpdate(et.SPLIT),"_mergeTile sanity check"),po(!t.leaf,"Cannot merge a leaf"),t.leaf||(this._purgeSubtree(t),po(!t.renderData,"Merging tile with existing render data?"),this._loadTile(t),this._markTileToUpdate(t),this._emitTileScaleChange(t),this._shortBatches&&this._updatePendingTileGeometries(),$q(t,!1),this._allTilesDirty=!0,++this._performanceInfo.numMerged)}_loadTile(t){t.load(),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager?.hasOverlays&&this.overlayManager.updateTileOverlayParameters(t)}_handleLayerViewChanges(t=Wc){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let e=!1;const i=new Set;let r=-1;for(let s=this.view.allLayerViews.length-1;s>=0;s--){const n=this.view.allLayerViews.items[s];if(i.add(n.uid),EX(n)||XM(n))if(this._basemapLayerViewHandles.has(n.uid)&&!XM(n)){const o=this._layerClassFromLayerView(n),a=this._getLayerIdxByUID(o,n.uid);a!=null&&((a<r||r==null)&&(e=!0),r=a)}else this._registerTiledLayerView(n),n.layer.loaded&&(e=!0)}this._basemapLayerViewHandles.forEach((s,n)=>{i.has(n)||(this._unregisterTiledLayerView(n),e=!0)}),e&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),t.madeProgress()}_allSurfaceLayersTransparent(){let t=this.view.map?.ground?.opacity===0;for(const e of this.view.allLayerViews.items)if(TX(e)&&!Wk(e.layer)&&e.fullOpacity!==0)return t=!1,t;return t}_hasCompositeBlendMode(){for(const t of this.view.allLayerViews.items)if((S3(t)||XM(t))&&u$t(MX[t.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(t){return SX(t)?Lt.ELEVATION:Lt.MAP}_registerTiledLayerView(t){const e=[];if((S3(t)||XM(t))&&e.push(H(()=>t.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(Ms.UNFADED)})),!XM(t)){const i=this._layerClassFromLayerView(t);e.push(H(()=>t.suspended,()=>this._updateTiledLayers())),e.push(H(()=>t.fullOpacity,()=>this._updateTileTextures(Ms.UNFADED))),e.push(H(()=>"effectiveScaleRange"in t.layer?t.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),e.push(t.on("data-changed",()=>{const r=this._getLayerIdxByUID(i,t.uid);r!=null&&this._invalidateLayerData(r,i)}))}this._unregisterTiledLayerView(t.uid),this._basemapLayerViewHandles.set(t.uid,e)}_unregisterTiledLayerView(t){const e=this._basemapLayerViewHandles.get(t);if(e){for(const i of e)i.remove();this._basemapLayerViewHandles.delete(t)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const t=this.view.allLayerViews,e=[[],[]];let i=null;t.forEach(r=>{if(!r.layer||r.suspended||!EX(r)||!r.fullExtent)return;const s=this._layerClassFromLayerView(r);if(s===Lt.MAP){const n=r.displayLevelRange.maxLevel;n!==1/0&&(i===null||n>i)&&(i=n)}e[s].push(r)});for(const r of HE){const s=this._layerViews[r],n=e[r];n.reverse();const o=n.length;let a=s.length!==o;const l=new Array(o),c=new Array(s.length);this._layerIndexByUid[r].clear();for(let h=0;h<o;h++){const d=n[h].uid;this._layerIndexByUid[r].set(d,h);const f=s.indexOf(n[h]);l[h]=f,h!==f&&(a=!0),f>-1&&(c[f]=h)}if(a){const h=this._postorderIterator;for(h.reset(this._rootTiles);!h.done;)h.next().modifyLayers(c,l,r);this._layerViews[r]=n,this._restartAllAgents(r),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&(this._viewChangeUpdate(),this.notifyChange("tilingScheme"))}_restartAllAgents(t){const e=this._postorderIterator;for(e.reset(this._rootTiles);!e.done;){const i=e.next();i.restartAgents(t),t===Lt.ELEVATION&&i.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(t,e){return this._layerViews[e][t]}numLayers(t){return this._layerViews[t].length}_updateTileTextures(t){this._allTiles.forAll(e=>{e.updateAgents(Lt.MAP),t===Ms.IMMEDIATE?this.renderer.updateTileTexture(e,et.TEXTURE_NOFADING):e.updateRenderData(Lt.MAP,t)}),this._evaluateTransparency()}_invalidateLayerData(t,e){this._allTiles.forAll(i=>i.removeLayerAgent(t,e)),this._allTiles.forAll(i=>i.invalidateLayerData(t,e))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(t=bt.UPDATE){this.renderer.setNeedsRender(t)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(t,e,i,r){const s=this.layerViewByIndex(e,i),n=s.layer;return!n.tilemapCache||X$(s)?this._requestTileData(t,i,s,r):(++this._asyncWorkItems,n.tilemapCache.fetchAvailability(t.level,t.lij[1],t.lij[2],{...r,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,gt(r),Xr(o)||this._dataMissing(t,i,s),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(t,i,s,r),r.signal)))}_requestTileData(t,e,i,r){if(this._destroying)return Promise.resolve();const s=e===Lt.ELEVATION;return r.requester??=s?this._elevationDataRequester:this._mapDataRequester,s?SX(i)?this._requestElevationTileData(t,i,r):Promise.reject():TX(i)?this._requestMapTileData(t,i,r):Promise.reject()}_requestElevationTileData(t,e,i){++this._asyncWorkItems;const r=n=>{!wa(i)&&n&&(this.setMemoryDirty(),this.requestUpdate(),this._elevationDataArrived(t,e,n))},s=n=>{Xr(n)||(J.getLogger(this).error(`Tile ${t.lij.toString()} layer ${Lt.ELEVATION}/${e.uid} error ${n}`),this._dataMissing(t,Lt.ELEVATION,e),this.requestUpdate())};return e.fetchTile(t.lij,i).then(n=>this._frameTask.schedule(()=>r(n)),s).finally(()=>--this._asyncWorkItems)}_elevationDataArrived(t,e,i){const r=this._layerIndexByUid[Lt.ELEVATION].get(e.uid);if(r==null)return void J.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",Lt.ELEVATION,t.lij.toString());const s=new p2t(t.lij,t.extent,i);t.dataArrived(r,Lt.ELEVATION,s);const n=[t],o=t.level,a=this._iteratorPool.acquire();for(a.reset(n);!a.done;){const l=a.next();l.findElevationBoundsForLayer(r,o),l.computeElevationBounds()}o===0&&this._updateRootTileElevationBounds(),a.remove(),this._updateTilesVisibility(n)}_requestMapTileData(t,e,i){++this._asyncWorkItems;const r=(a,l)=>{GC(l),wa(i)||(console.error(`Tile ${t.lij.toString()} layer ${Lt.MAP}/${e.uid} error ${a}`),this._dataMissing(t,Lt.MAP,e),this.requestUpdate())},s=a=>l=>r(l,a),n=a=>this._frameTask.schedule(()=>{this.requestUpdate(),wa(i)?GC(a):this._mapTileDataArrived(t,e,a)},i.signal,s(a)).catch(s(a)),o=(a,l=null)=>this._frameTask.schedule(()=>r(a,l));return e.fetchTile(t.lij,i).then(n,o).finally(()=>--this._asyncWorkItems)}_mapTileDataArrived(t,e,i){const r=this._getLayerIdxByUID(Lt.MAP,e.uid);if(r==null)return GC(i),void J.getLogger(this).warn("TerrainSurface: received data from unknown layer");t.dataArrived(r,Lt.MAP,i)}_getLayerIdxByUID(t,e){return this._layerIndexByUid[t].get(e)}_dataMissing(t,e,i){const r=this._getLayerIdxByUID(e,i.uid);r!=null?t.dataMissing(r,e):J.getLogger(this).warn("TerrainSurface: received data from unknown layer")}get performanceInfo(){const t=this._performanceInfo;return t.numNodes=this._allTiles.length,t.numLeaves=t.numVisible=t.numRendered=t.numLoadedPerLevel.length=t.numRenderedPerLevel.length=0,this._allTiles.forAll(e=>{e.leaf&&t.numLeaves++;const i=e.level;e.renderData&&(t.numLoadedPerLevel[i]=(t.numLoadedPerLevel[i]||0)+1),e.visible&&(t.numVisible++,e.rendered&&(t.numRenderedPerLevel[i]=(t.numRenderedPerLevel[i]||0)+1,t.numRendered++))}),t}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory??0):0}_recalculateUsedMemory(){return this.tilingScheme?Math.round(this._allTiles.reduce((t,e)=>t+e.usedMemory,0)):null}getUsedMemoryForLayerView(t){let e=0;const i=this._layerClassFromLayerView(t),r=this._getLayerIdxByUID(i,t.uid);return r!=null&&this._allTiles.forAll(s=>e+=s.getUsedMemoryForLayer(i,r)),e}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(t){this._renderer.renderPatchBorders=t}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(t){this._renderer.visualizeNormals=t}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(t){this._renderer.renderingDisabled=t}get test(){}checkAllTilesWaterproofness(){if(!gB)return;const t=this._rootTiles;if(t==null)return;const e=n=>n?.renderData?.geometry?.indices?.length>0,i=(n,o)=>{e(n)&&console.error("Tile[",n.lij,"] has geometry although parent[",o.lij,"] has geom")},r=n=>{if(n.intersectsClippingArea)if(n.renderData&&!n.renderData.geometryState&&console.error("Tile[",n.lij,"] has renderData but not geometryState"),n.renderData&&!n.renderData.geometry&&console.error("Tile[",n.lij,"] has renderData but not geometryInfo"),!n.renderData?.geometry||(n.renderData.geometry.indices?.length??0)>0||console.error("Tile[",n.lij,"] has renderData but no indices - geometryInfo: ",n.renderData.geometry),e(n)){n.checkGeometryWaterproofness();for(const o of n.children)i(o,n)}else if(n.leaf)console.error("Tile[",n.lij,"] has no geometry and no children, from root to leaf");else for(const o of n.children)r(o)},s=n=>{const o=n.parent?.visible??!0,a=n.visible;n.computeVisibility();const l=n.visible;if(a!==l&&o&&console.error(" Tile[",n.lij,"] has out of date visibility: ",a," instead of ",l),!n.leaf)for(const c of n.children)s(c)};for(const n of t)r(n),s(n)}get isGlobal(){return this._isGlobal}get isGeographic(){return this._isGeographic}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateCarree(){return this._isWebMercatorOnPlateCarree}isEastEndWrap(t){return this._isGlobal&&t[2]===this.lijEastEnd(t[0])-1}isWestEndWrap(t){return this._isGlobal&&t[2]===0}lijEastEnd(t){return 1<<t+(this._isGeographic?1:0)}wrapEastWest(t){const e=this.lijEastEnd(t[0]),i=t[2];if(0<=i&&i<e)return t;if(!this._isGlobal)return null;const r=(i+(i<0?e:0))%e;return[t[0],t[1],r]}enableInternalChecks(t){x2t(t)}enableWaterproofnessChecks(t){w2t(t)}};Bt._tileMemcacheKey="TerrainTileMemcache",u([p()],Bt.prototype,"_renderer",void 0),u([p({constructOnly:!0})],Bt.prototype,"_scaleRangeQueries",void 0),u([p({constructOnly:!0})],Bt.prototype,"view",void 0),u([p({constructOnly:!0})],Bt.prototype,"overlayManager",void 0),u([p()],Bt.prototype,"_hasPendingUpdates",void 0),u([p()],Bt.prototype,"_asyncWorkItems",void 0),u([p()],Bt.prototype,"_allTilesDirty",void 0),u([p()],Bt.prototype,"_allTilesSorted",void 0),u([p()],Bt.prototype,"_viewChanged",void 0),u([p({type:Number})],Bt.prototype,"heading",void 0),u([p()],Bt.prototype,"_splitLimits",void 0),u([p({readOnly:!0})],Bt.prototype,"_watchUpdatingTracking",void 0),u([p()],Bt.prototype,"_frameTask",void 0),u([p({readOnly:!0})],Bt.prototype,"snapLevel",null),u([p({readOnly:!0})],Bt.prototype,"lodSnappingEnabled",null),u([p()],Bt.prototype,"_userClippingExtent",null),u([p()],Bt.prototype,"_rootTilesExtent",void 0),u([p({readOnly:!0})],Bt.prototype,"extent",null),u([p({readOnly:!0})],Bt.prototype,"groundExtent",null),u([p({readOnly:!0})],Bt.prototype,"_tilingSchemeExtent",null),u([p({readOnly:!0})],Bt.prototype,"updating",null),u([p({readOnly:!0})],Bt.prototype,"running",null),u([p(h2t)],Bt.prototype,"updatingProgress",void 0),u([p({readOnly:!0})],Bt.prototype,"updatingProgressValue",null),u([p()],Bt.prototype,"_maxNumUpdating",void 0),u([p()],Bt.prototype,"baseOpacity",null),u([p()],Bt.prototype,"hasCompositeBlendMode",void 0),u([p({readOnly:!0})],Bt.prototype,"viewingMode",null),u([p()],Bt.prototype,"maxTextureScale",void 0),u([p({readOnly:!0})],Bt.prototype,"ready",null),u([p({value:K$.FRONT_TO_BACK})],Bt.prototype,"renderOrder",null),u([p({readOnly:!0})],Bt.prototype,"rootTiles",null),u([p()],Bt.prototype,"_rootTiles",void 0),u([p({readOnly:!0})],Bt.prototype,"spatialReference",null),u([p({type:qe})],Bt.prototype,"backgroundColor",null),u([p({value:!1})],Bt.prototype,"slicePlaneEnabled",null),u([p({readOnly:!0})],Bt.prototype,"tilingScheme",void 0),u([p({readOnly:!0})],Bt.prototype,"tilingSchemeLocked",null),u([p({readOnly:!0})],Bt.prototype,"tilingSchemeLogic",void 0),u([p()],Bt.prototype,"wireframe",null),u([p({value:!1})],Bt.prototype,"suspended",null),u([p()],Bt.prototype,"fadeDuration",null),u([p()],Bt.prototype,"visibleElevationBounds",void 0),u([p()],Bt.prototype,"rootTileElevationBounds",void 0),u([p()],Bt.prototype,"_layerViewsDirty",void 0),u([p()],Bt.prototype,"renderPatchBorders",null),u([p()],Bt.prototype,"visualizeNormals",null),u([p()],Bt.prototype,"renderingDisabled",null),Bt=_5=u([A("esri.views.3d.terrain.TerrainSurface")],Bt);const OAt=Bt,QM=$(),XT=Rs(),IAt=Qt();new Jt;const Cq=new u2t("ground"),LF={spatialReference:null,extent:null,scale:0};function Pve(t,e,i){for(const r of t){if(!r.containsPointXY(e,i))continue;let s=r;for(;s&&!s.renderData;){const o=(e>s.extentMidX?1:0)+(i<s.extentMidY?2:0);s=s.children[o]}const n=s?.renderData?.geometryState.samplerData??null;return cs(e,i,n)}return null}class RAt{constructor(e){this.capacity=e,this._head=0,this._tail=0,this._data=new Array(e)}push(e){const i=this._tail;if(!(i<this.capacity))throw new Error("Queue full");this._data[i]=e,this._tail=i+1}pushAll(e){const i=e.length;if(i===0)return;const r=this._tail;if(!(r+i<=this.capacity))throw new Error("Queue full");for(let s=0;s<i;++s)this._data[r+s]=e[s];this._tail=r+i}pop(){const e=this._head;if(e<this._tail){const i=this._data[e];return this._head=e+1,i}}get empty(){return this._head>=this._tail}get full(){return this._tail>=this._data.length}}function $q(t,e){!t.leaf||t.level<An||soe(t,i=>{e&&YFe(i);const r=BX(i);if(i.maxLevelDeltaNeighborCount++,r){let s=i.parent;for(;s;){const n=BX(s);if(s.unmergableChildCount++,!n)break;s=s.parent}}})}function YFe(t){if(t.hasPendingUpdate(et.SPLIT))return;let e=t.parent;for(;e?.resetPendingUpdate(et.MERGE);)e=e.parent;t.resetPendingUpdate(et.MERGE),t.leaf&&t.setPendingUpdate(et.SPLIT),t.level<An||soe(t,i=>{YFe(i)})}function Dve(t){t.level<An||soe(t,e=>{if(e.maxLevelDeltaNeighborCount--,e.maxLevelDeltaNeighborCount===0&&e.unmergableChildCount===0){let i=e.parent;for(;i&&(i.unmergableChildCount--,BX(i));)i=i.parent}})}function BX(t){return t.maxLevelDeltaNeighborCount===0&&t.unmergableChildCount===0}function soe(t,e){if(t.level<An)return;const i=t.level-An,r=t.lij[1]>>An,s=t.lij[2]>>An,n=o=>o.leaf||o.level===i;for(let o=0;o<4;++o){const a=t.findNeighborTile(Jp[o],n);if(!a||a.level!==i)continue;const l=a.lij;l[1]===r&&l[2]===s||e(a)}}let PAt=class{constructor(e,i,r,s){this.operation=e,this.geometry=i,this.states=r,this.sync=s}},$I=class extends ue{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this._dirtyRecordCount=0}get dirty(){return this._dirtyRecordCount>0}commitLayer(e,i){const r=this._dirtyGeomRecords.get(e);if(!r)return;let s=0;r.forEach((n,o)=>{const a=this._ensureGeomRecord(e,o);s+=n.size,n.forEach(({geometry:l,operation:c,states:h},d)=>{let f=!1;if(c===fs.UPDATE){const m=a.get(d);if(m){if(h&Go.TRANSFORMATION){const y=this.model.getObject(o);this.model.updateRenderGeometryTransformation(y,l,m)&&(f=!0)}f||i.updates.push({renderGeometry:m,updateType:h})}else jt(!1,"ModelDirtySet.commitLayer: invalid update")}if(c===fs.REMOVE||f){const m=a.get(d);m?(i.removes.push(m),a.delete(d)):c===fs.REMOVE&&jt(!1,"ModelDirtySet.commitLayer: invalid remove")}if(c===fs.ADD||f){const m=this.model.getObject(o);if(m!=null){const y=this.model.getRenderGeometry(m,l);i.adds.push(y),a.set(d,y)}}}),a.size===0&&this._residentGeomRecords.get(e).delete(o)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this._dirtyRecordCount-=s}commitSyncUpdates(e,i){const r=this._dirtyGeomRecords.get(e);r&&r.forEach((s,n)=>{const o=this._ensureGeomRecord(e,n);s.forEach(({geometry:a,operation:l,states:c,sync:h},d)=>{let f=!1;if(l===fs.UPDATE&&h){const m=o.get(d);if(m){if(c&Go.TRANSFORMATION){const y=this.model.getObject(n);this.model.updateRenderGeometryTransformation(y,a,m)&&(f=!0)}f||i.updates.push({renderGeometry:m,updateType:c})}else jt(!1,"ModelDirtySet.commitSyncUpdates: invalid update")}})})}getResidentRenderGeometries(e,i){const r=this._residentGeomRecords.get(e);r&&r.forEach(s=>s.forEach(n=>i.push(n)))}_objectStateChanged(e,i){for(const r of i.geometries)this._updateOrCreateDirtyRecord(i,r,null,fs.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(Go.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(Go.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(Go.OCCLUDEE,e)}attributesChanged({object:e,geometry:i,sync:r}){this._updateOrCreateDirtyRecord(e,i,null,fs.UPDATE,Go.GEOMETRY,r)}layerAdded(e){e.objects.forAll(i=>this._layerObjectAdded(e,i))}layerRemoved(e){e.objects.forAll(i=>this._layerObjectRemoved(e,i))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,i){const r=e.id;for(const s of i.geometries)this._geometryAdded(i,s,r)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const i of e.objects)this._layerObjectAdded(e.layer,i)}layerObjectsRemoved(e){for(const i of e.objects)this._layerObjectRemoved(e.layer,i)}_layerObjectRemoved(e,i){const r=e.id;for(const s of i.geometries)this._geometryRemoved(i,s,r)}transformationChanged(e){const i=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(s=>{this._updateOrCreateDirtyRecord(e,s.geometry,i,fs.UPDATE,Go.TRANSFORMATION)})}shaderTransformationChanged(e){const i=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(s=>{s.objectShaderTransformationChanged(e.shaderTransformation)})}geometryAdded(e){this._geometryAdded(e.object,e.geometry)}_geometryAdded(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,fs.ADD)}geometryRemoved(e){this._geometryRemoved(e.object,e.geometry)}_geometryRemoved(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,fs.REMOVE)}_updateOrCreateDirtyRecord(e,i,r,s,n=Go.NONE,o=!1){r=r??this._getParentLayerId(e);const a=e.id,l=i.id,c=this._ensureDirtyRecord(r,a),h=c.get(l);if(h){const d=h.operation;d===fs.REMOVE&&s===fs.ADD&&h.states!==Go.NONE?h.operation=fs.UPDATE:d===fs.REMOVE&&s===fs.ADD||d===fs.ADD&&s===fs.REMOVE?(c.delete(l),this._dirtyRecordCount--):d!==fs.UPDATE||s!==fs.REMOVE&&s!==fs.UPDATE?(jt((d===fs.REMOVE||d===fs.ADD)&&s===fs.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),h.states|=n):(h.operation=s,h.states|=n),h.sync=h.sync||o}else c.set(l,new PAt(s,i,n,o)),this._dirtyRecordCount++}_ensureGeomRecord(e,i){let r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));let s=r.get(i);return s||(s=new Map,r.set(i,s)),s}_ensureDirtyRecord(e,i){let r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));let s=r.get(i);return s||(s=new Map,r.set(i,s)),s}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:cje}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let i="";return this._dirtyGeomRecords.forEach((r,s)=>{r.forEach((n,o)=>{i.length>0&&(i+=`
`),i+=s+"."+o;const a=[];n.forEach(l=>{const c=l.operation;a[c]||(a[c]=[]),a[c].push(l.geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){i+=" "+e[l-1]+": ";for(let c=0;c<a[l].length;c++)i+=a[l][c]+", "}})}),i}get test(){}};u([p()],$I.prototype,"_dirtyRecordCount",void 0),u([p({constructOnly:!0})],$I.prototype,"model",void 0),$I=u([A("esri.views.3d.webgl-engine.lib.ModelDirtySet")],$I);const DAt=$I;let LAt=class{constructor(e,i={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=Ve(),this._shaderTransformation=null,this._boundingSphere=null,this.id=_d(),this.layerUid=i.layerUid,this.graphicUid=i.graphicUid,this.castShadow=i.castShadow??!1,i.objectShaderTransformation&&this.objectShaderTransformationChanged(i.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){mn(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){e==null?this._shaderTransformation=null:(this._shaderTransformation??=Ve(),kn(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(this._boundingSphere==null&&(this._boundingSphere??=Rs(),st(this._boundingSphere,this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*JP(this.shaderTransformation)),this._boundingSphere):JOe}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??this.transformation}get attributes(){return this.geometry.attributes}get highlight(){return this.geometry.highlights}foreachHighlightOptions(e){this.geometry.foreachHighlightOptions(e)}get hasHighlights(){return this.geometry.hasHighlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}},b5=class extends ue{constructor(){super(...arguments),this.dirtySet=new DAt({model:this}),this._content=new Map,this._originFactory=new Y3e(null)}getObject(e){return this._content.get(e)}add(e){const i=e.id;jt(!this._content.has(i),"Model/Stage already contains object to be added"),this._content.set(i,e),KU(e)&&this.dirtySet.layerAdded(e)}remove(e){return!!this._content.has(e.id)&&(this._content.delete(e.id),KU(e)&&this.dirtySet.layerRemoved(e),!0)}addMany(e){for(const i of e)i&&(jt(!this._content.has(i.id),"Model/Stage already contains object to be added"),this._content.set(i.id,i))}removeMany(e){for(const i of e)i&&(jt(this._content.has(i.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(i.id))}has(e){return this._content.has(e.id)}forEachOfType(e,i){this._content.forEach(r=>{r.type===e&&i(r)})}getRenderGeometry(e,i){const r=new LAt(i,{castShadow:e.castShadow,objectShaderTransformation:e.shaderTransformation});r.transformation=e.getCombinedStaticTransformation(i,Lve);const{localOrigin:s}=i;return r.localOrigin=s??this._originFactory.getOrigin(r.boundingSphere),r}updateRenderGeometryTransformation(e,i,r){if(e==null)return!1;r.transformation=e.getCombinedStaticTransformation(i,Lve);const s=this._originFactory.getOrigin(r.boundingSphere);return r.localOrigin!==s}getStats(){const e={},i=Array.from(this._content.values());for(let r=0;r<Nn.COUNT;++r)e[r]=i.filter(s=>s.type===r).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){}};u([p({constructOnly:!0})],b5.prototype,"dirtySet",void 0),b5=u([A("esri.views.3d.webgl-engine.parts.Model")],b5);const Lve=Ve();function NAt(t){return"r"in t&&"g"in t&&"b"in t}function JFe(t){return"h"in t&&"s"in t&&"v"in t}function XFe(t){return"l"in t&&"a"in t&&"b"in t}function KFe(t){return"l"in t&&"c"in t&&"h"in t}function FAt(t){return"x"in t&&"y"in t&&"z"in t}const kAt=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],zAt=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function QFe(t,e){const i=[];let r,s;if(t[0].length!==e.length)throw new Error("dimensions do not match");const n=t.length,o=t[0].length;let a=0;for(r=0;r<n;r++){for(a=0,s=0;s<o;s++)a+=t[r][s]*e[s];i.push(a)}return i}function eke(t){const e=[t.r/255,t.g/255,t.b/255].map(r=>r<=.04045?r/12.92:((r+.055)/1.055)**2.4),i=QFe(kAt,e);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function noe(t){const e=QFe(zAt,[t.x/100,t.y/100,t.z/100]).map(i=>{const r=i<=.0031308?12.92*i:1.055*i**.4166666666666667-.055;return Math.min(1,Math.max(r,0))});return{r:Math.round(255*e[0]),g:Math.round(255*e[1]),b:Math.round(255*e[2])}}function tke(t){const e=[t.x/95.047,t.y/100,t.z/108.883].map(i=>i>.008856451679035631?i**.3333333333333333:7.787037037037035*i+.13793103448275862);return{l:116*e[1]-16,a:500*(e[0]-e[1]),b:200*(e[1]-e[2])}}function ike(t){const e=t.l,i=[(e+16)/116+t.a/500,(e+16)/116,(e+16)/116-t.b/200].map(r=>r>6/29?r**3:3*(6/29)**2*(r-4/29));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function UAt(t){const e=t.l,i=t.a,r=t.b,s=Math.sqrt(i*i+r*r);let n=Math.atan2(r,i);return n=n>0?n:n+2*Math.PI,{l:e,c:s,h:n}}function BAt(t){const e=t.l,i=t.c,r=t.h;return{l:e,a:i*Math.cos(r),b:i*Math.sin(r)}}function VAt(t){return tke(eke(t))}function jAt(t){return noe(ike(t))}function GAt(t){return UAt(tke(eke(t)))}function HAt(t){return noe(ike(BAt(t)))}function qAt(t){const e=t.r,i=t.g,r=t.b,s=Math.max(e,i,r),n=s-Math.min(e,i,r);let o=s,a=n===0?0:s===e?(i-r)/n%6:s===i?(r-e)/n+2:(e-i)/n+4,l=n===0?0:n/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}function WAt(t){const e=(t.h+360)%360/60,i=t.s/100,r=t.v/100*255,s=r*i,n=s*(1-Math.abs(e%2-1));let o;switch(Math.floor(e)){case 0:o={r:s,g:n,b:0};break;case 1:o={r:n,g:s,b:0};break;case 2:o={r:0,g:s,b:n};break;case 3:o={r:0,g:n,b:s};break;case 4:o={r:n,g:0,b:s};break;case 5:case 6:o={r:s,g:0,b:n};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+r-s),o.g=Math.round(o.g+r-s),o.b=Math.round(o.b+r-s),o}function KD(t){return NAt(t)?t:KFe(t)?HAt(t):XFe(t)?jAt(t):FAt(t)?noe(t):JFe(t)?WAt(t):t}function ZAt(t){return JFe(t)?t:qAt(KD(t))}function YAt(t){return XFe(t)?t:VAt(KD(t))}function Cli(t){return KFe(t)?t:GAt(KD(t))}function JAt(t){let{r:e,g:i,b:r,a:s}=t;return s<1&&(e=Math.round(s*e+255*(1-s)),i=Math.round(s*i+255*(1-s)),r=Math.round(s*r+255*(1-s))),new qe({r:e,g:i,b:r})}function XAt(t,e){const{r:i,g:r,b:s}=e?.ignoreAlpha?t:JAt(t);return .2126*i+.7152*r+.0722*s}var VX;function $li(t,e=VX.High){return XAt(t,{ignoreAlpha:!0})>e?new qe([0,0,0,t.a]):new qe([255,255,255,t.a])}function Ali(t,e){const i=YAt(t);i.l*=1-e;const r=KD(i),s=t.clone();return s.setColor(r),s.a=t.a,s}function Mli(t,e){const i=t.clone();return i.a*=e,i}function Oli(t,e){const i=ZAt(t);i.s*=e;const r=KD(i),s=t.clone();return s.setColor(r),s.a=t.a,s}function ooe(t){return qe.toUnitRGBA(t)}function Ili(t,e){return t===e||t!=null&&e!=null&&oS(t,e)}function Rli(t){return Gi(t[0],t[1],t[2],t.length>3?t[3]:1)}function KAt(t){return t[0]??=0,t[1]??=0,t[2]??=0,t}function Pli(t){return t.length=4,KAt(t),t[3]??=1,ce(t[3],0,1),t}function Dli(t,e){const i=qe.toUnitRGBA(t);return i[3]*=e,i}function Lli(t,e,i={}){if(t.length===0||e<=0)return[];if((t=t.map(r=>typeof r=="string"?new qe(r):r)).length===1||e===1){const r=[],s=t[0];for(let n=0;n<e;n++)r.push(s.clone());return r}if(i.shuffle&&(t=f1e(q(t),i.seed)),t.length>=e){const r=[],s=(t.length-1)/(e-1);for(let n=0;n<e;n++){const o=Math.round(n*s);r.push(t[o].clone())}return r}return QAt(t,e,i)}function QAt(t,e,i={}){const r=[],s=t.length-1,n=Math.ceil((e-t.length)/s);e:for(let o=0;o<s;o++){const a=t[o],l=t[o+1];for(let c=1;c<=n;c++){const h=c/(n+1);if(r.push(eMt(a,l,h,i)),r.length+t.length===e)break e}}return[...t.map(o=>o.clone()),...f1e(r,i.seed??1)]}(function(t){t[t.Low=160]="Low",t[t.High=225]="High"})(VX||(VX={}));const Aq=(t,e)=>{const i=Math.floor(10*e())-5;return Math.min(255,Math.max(0,t+i))};function eMt(t,e,i,r={}){const s=t.r,n=t.g,o=t.b,a=e.r,l=e.g,c=e.b,h=Math.round(s+(a-s)*i),d=Math.round(n+(l-n)*i),f=Math.round(o+(c-o)*i);if(!r.offset)return new qe([h,d,f]);const m=bee(r.seed);return new qe([Aq(h,m),Aq(d,m),Aq(f,m)])}let rke=class extends ar{constructor(){super(...arguments),this.radii=He(),this.heightParameters=pi()}};function tMt(t){t.uniforms.add(new fc("radii",e=>e.radii),new uc("heightParameters",e=>e.heightParameters)),t.constants.add("scaleHeight","float",xi.scaleHeight*xi.atmosphereHeight),t.code.add(E`float chapmanApproximation(float thickness, float height, float cosZenith) {
float c = sqrt(thickness + height);
float cExpH = c * exp(-height);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (thickness + height);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(thickness - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),t.code.add(E`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),t.code.add(E`vec4 planetIntersect(vec3 cameraPos, vec3 rayDir) {
float reducedPlanetRadius = radii[0] - 20000.0;
float rayPlanetDistance = heightParameters[1] - reducedPlanetRadius * reducedPlanetRadius;
vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, rayPlanetDistance);
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, heightParameters[2]);
bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
bool insideAtmosphere = heightParameters[0] < radii[1];
if (!(hitsAtmosphere || insideAtmosphere)) {
return vec4(1.0, 0.0, 0.0, 0.0);
}
bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;
float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;
if (heightParameters[0] < reducedPlanetRadius) {
if (dot(rayDir, normalize(cameraPos)) < -0.025) {
return vec4(1.0, 0.0, 0.0, 0.0);
}
start = rayPlanetIntersect.y;
}
float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
return vec4(0.0, hitsPlanet ? 1.0 : 0.0, start, end);
}`)}function ske(t,e){t.include(tMt);const i=6;t.uniforms.add(new Ja("cameraPosition",r=>r.camera.eye)),t.constants.add("betaRayleigh","vec3",e5),t.constants.add("betaCombined","vec3",vbt),t.constants.add("betaMie","float",ybt),t.code.add(E`
    vec3 raymarchAtmosphere(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      vec4 ray = planetIntersect(cameraPos, rayDir);
      if(ray.x == 1.0) {
        return vec3(0);
      }
      ${Se(e,"if (terrainDepth != -1.0) { ray.w = terrainDepth; }")}

      vec3 samplePoint = cameraPos + rayDir * ray.w;
      float multiplier = ray.y == 1.0 ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (ray.w - ray.z) / ${E.float(i)};

      for (int i = 0; i < ${E.int(i)}; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
          ${Se(!e,"scattering *= mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0))")};
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {
          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);
          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${Se(!e,"scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);")}
        }
        lastOpticalDepth = opticalDepth;
      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;
      ${e?"return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;":E`const float g = 0.8;
             const float gg = g * g;
             float phaseMie = 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg));
             phaseMie = clamp(phaseMie, 0.0, 128.0);
             return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }`)}function CG(t,e={needUVs:!0,needEyeDirection:!0}){t.attributes.add(z.POSITION,"vec2"),t.varyings.add("worldRay","vec3");const{needUVs:i,needEyeDirection:r}=e;i&&t.varyings.add("uv","vec2"),r&&t.varyings.add("eyeDir","vec3"),t.vertex.uniforms.add(new Co("inverseProjectionMatrix",s=>s.camera.inverseProjectionMatrix),new Co("inverseViewMatrix",s=>Wte(iMt,s.camera.viewMatrix))),t.vertex.main.add(E`
    vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
    ${Se(r,"eyeDir = posViewNear;")}
    worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
    ${Se(i,"uv = position * 0.5 + vec2(0.5);")}
    gl_Position = vec4(position, 1, 1);
  `)}const iMt=Ve();function nke(t){const e=new ki;e.include(CG);const{reduced:i}=t,{fragment:r}=e;return eg(r),e.include(UD),r.include(uG),r.include(oG),r.include(ske,!1),r.uniforms.add(new Cr("backgroundColor",s=>s.backgroundColor),new pt("innerFadeDistance",s=>s.innerFadeDistance),new pt("altitudeFade",s=>s.altitudeFade),new so("depthTexture",s=>s.mainDepth)).code.add(E`vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
float rayPlanetDistance = heightParameters[1] - radii[0] * radii[0];
vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, rayPlanetDistance);
if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
return fragColor;
}
float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
if (relDist > 1.0) {
return surfaceColor;
}
return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
}
float getGlow(float dist, float radius, float intensity) {
return pow(radius / max(dist, 1e-6), intensity);
}
vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){
float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));
vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));
float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));
return normalize(sunTransmittance) * sunDisc;
}`).main.add(E`
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${Se(!i,E`float depthSample = texture(depthTexture, uv).r;
             if (depthSample != 1.0) {
                fragColor = vec4(0);
                return;
             }`)}

      vec3 col = linearizeGamma(backgroundColor);
      col += raymarchAtmosphere(cameraPosition, rayDir, mainLightDirection, terrainDepth);
      col += getSun(cameraPosition, rayDir, mainLightDirection);
      float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);
  `),e}const rMt=Object.freeze(Object.defineProperty({__proto__:null,build:nke},Symbol.toStringTag,{value:"Module"}));let sMt=class extends rke{constructor(){super(...arguments),this.innerFadeDistance=0,this.altitudeFade=0,this.backgroundColor=$()}},Mq=class extends Bi{constructor(e,i){super(e,i,new Fi(rMt,()=>V(()=>Promise.resolve().then(()=>BGt),void 0)))}initializePipeline(e){return _i({blending:e.reduced?ase:GS(Ft.SRC_ALPHA,Ft.ONE_MINUS_SRC_ALPHA),depthTest:{func:e.reduced?Ni.ALWAYS:Ni.LEQUAL},colorWrite:Ai})}},oke=class extends ou{constructor(){super(...arguments),this.reduced=!1}};u([te()],oke.prototype,"reduced",void 0);let Om=class extends xf{constructor(){super(...arguments),this.produces="disabled",this.consumes={required:[ut.OPAQUE_ENVIRONMENT]}}_enable(){this.produces=ut.OPAQUE_ENVIRONMENT,this.requestRender(bt.UPDATE)}_disable(){this.produces="disabled",this.requestRender(bt.UPDATE)}};u([p()],Om.prototype,"produces",void 0),u([p()],Om.prototype,"consumes",void 0),Om=u([A("esri.views.3d.webgl-engine.effects.OpaqueEnvironment")],Om);let aoe=class extends ar{};function ake(){const t=new ki;return t.include(ea),t.fragment.uniforms.add(new $t("colorTexture",e=>e.color),new so("depthTexture",e=>e.mainDepth)),t.fragment.main.add(E`float depthSample = texture(depthTexture, uv).r;
if (depthSample != 1.0 ) {
fragColor = vec4(0);
return;
}
fragColor = texture(colorTexture, uv);`),t}const nMt=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:aoe,build:ake},Symbol.toStringTag,{value:"Module"}));let Nve=class extends Bi{constructor(e,i){super(e,i,new Fi(nMt,()=>V(()=>Promise.resolve().then(()=>VGt),void 0)))}initializePipeline(){return _i({blending:GS(Ft.SRC_ALPHA,Ft.ONE_MINUS_SRC_ALPHA),depthTest:{func:Ni.ALWAYS},colorWrite:Ai})}},jX=class extends Om{constructor(){super(...arguments),this.requireGeometryDepth=!0,this._compositingPassParameters=new aoe,this._vao=null,this._passParameters=new sMt,this._configuration=new oke}initialize(){this.techniques.precompile(Mq,this._configuration),this.techniques.precompile(Nve),this._configuration.reduced=!0,this.techniques.precompile(Mq,this._configuration),this._configuration.reduced=!1,this.addHandles([H(()=>this.view.environment.background,e=>{const i=e instanceof dLe?ooe(e.color):sn;se(this._passParameters.backgroundColor,i[0]*i[3],i[1]*i[3],i[2]*i[3])},St),H(()=>this.view._stage?.renderer?.fullResolutionAtmosphere,e=>this._configuration.reduced=!e,St),H(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),St)])}destroy(){this._vao=Rt(this._vao)}render(e){const i=e.find(({name:v})=>v===ut.OPAQUE_ENVIRONMENT);if(!this.bindParameters.mainDepth)return i;const r=this.renderingContext;this._vao??=Qb(r,ig.Pos2Tex);const s=i.getAttachment(r.gl.DEPTH_STENCIL_ATTACHMENT);this._update();const n=this.techniques.get(Mq,this._configuration);if(!n.compiled)return this.requestRender(bt.UPDATE),i;if(!this._configuration.reduced)return i.detachDepth(),r.bindFramebuffer(i.fbo),r.bindTechnique(n,this.bindParameters,this._passParameters),r.bindVAO(this._vao),r.drawArrays(Ui.TRIANGLE_STRIP,0,4),i.attachDepth(s),i;const o=this.techniques.get(Nve);if(!o.compiled)return this.requestRender(bt.UPDATE),i;const a=r.getViewport(),l=this.bindParameters.camera,c=Te(l.eye)-xi.radius;let h;const d=xi.atmosphereHeight;if(c<d){const v=Math.min(1,Math.max(0,c/d));h=dt(.2,.3,v)}else{const v=Math.min(1,Math.max(0,(c-d)/(15*d)));h=dt(.3,.6,v)}const f=Jy(Math.round(h*l.fullViewport[2])),m=Jy(Math.round(h*l.fullViewport[3]));r.setViewport(0,0,f,m);const y=this.fboCache.acquire(f,m,"chapman",fr.RGBA);return r.bindFramebuffer(y.fbo),r.clearFramebuffer([0,0,0,1],!0,!0),r.bindTechnique(n,this.bindParameters,this._passParameters),r.bindVAO(this._vao),r.drawArrays(Ui.TRIANGLE_STRIP,0,4),r.setViewport(a.x,a.y,a.width,a.height),this._compositingPassParameters.color=y.getTexture(),i.detachDepth(),r.bindFramebuffer(i.fbo),r.bindTechnique(o,this.bindParameters,this._compositingPassParameters),r.screen.draw(),i.attachDepth(s),y.release(),i}_update(){const e=this.bindParameters.camera,i=Yo(e.eye),r=Math.sqrt(i),s=i-this._passParameters.radii[1]**2,n=ce((r-this._passParameters.radii[0])/xi.atmosphereHeight,0,1);es(this._passParameters.heightParameters,r,i,s,n);const o=this.view.basemapTerrain?.getLowerBoundRadius()??0;li(this._passParameters.radii,o,o+xi.atmosphereHeight),this._passParameters.innerFadeDistance=2*Math.sqrt((2*o-Ame)*Ame),this._passParameters.altitudeFade=wne(r-o)}};jX=u([A("esri.views.3d.environment.ChapmanAtmosphere")],jX);function lke(){const t=new ki,{fragment:e}=t;return t.include(CG,{needUVs:!1,needEyeDirection:!1}),e.include(FA),e.include(Zb),t.include(BPe,{pbrMode:_t.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(FD),t.include(UD),t.include(c3e),e.uniforms.add(new Ja("cameraPosition",i=>i.camera.eye),new Fn("cloudsOpacity",i=>i.clouds.opacity)).main.add(E`vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4(cloudsOpacity * cloudsColor.rgb, cloudsColor.a);`),t}const oMt=Object.freeze(Object.defineProperty({__proto__:null,build:lke},Symbol.toStringTag,{value:"Module"}));let Fve=class extends Bi{constructor(e,i){super(e,i,new Fi(oMt,()=>V(()=>Promise.resolve().then(()=>jGt),void 0)))}initializePipeline(){return _i({blending:Yb(Ft.ONE,Ft.ZERO,Ft.SRC_ALPHA,Ft.ONE),depthTest:{func:Ni.LEQUAL},colorWrite:Ai})}},GX=class extends Om{constructor(e){super(e),this._planetRadius=gr(e.view.spatialReference).radius}initialize(){this.techniques.precompile(Fve),this.addHandles([H(()=>this.view.environment.weather!=null&&this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),Nt)])}destroy(){this._vao=Rt(this._vao)}render(e){const i=e.find(({name:a})=>a===ut.OPAQUE_ENVIRONMENT),r=this.bindParameters.clouds;if(!r.data)return i;const s=this.techniques.get(Fve);if(!s.compiled)return this.requestRender(bt.UPDATE),i;const n=this.renderingContext;this._vao??=Qb(n);const o=n.bindTechnique(s,this.bindParameters);return n.bindVAO(this._vao),o.assertCompatibleVertexAttributeLocations(this._vao),n.drawArrays(Ui.TRIANGLE_STRIP,0,4),r.isFading&&this.requestRender(bt.UPDATE),i}};GX=u([A("esri.views.3d.environment.CloudsComposition")],GX);let loe=class extends ar{constructor(){super(...arguments),this.color=$(),this.strength=4e-6,this.atmosphereC=1,this.amount=0}};function cke(){const t=new ki;t.include(CG,{needUVs:!0,needEyeDirection:!0});const e=t.fragment;return e.uniforms.add(new pt("atmosphereC",i=>i.atmosphereC),new Ja("cameraPosition",i=>i.camera.eye),new so("depthTexture",i=>i.mainDepth),new pt("fogStrength",i=>i.strength),new pt("fogAmount",i=>i.amount),new Cr("fogColor",i=>i.color)),t.include(UD),e.include(uG),e.include(oG),e.include(fg),e.code.add(E`float getFogAmount(float dist, vec3 rayDir) {
if(dist == -1.0){
dist = 0.055 * sphereIntersect(cameraPosition, rayDir, atmosphereC).y;
}
return fogAmount * (1.0 - exp(-dist * fogStrength));
}`),e.main.add(E`vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = depthFromTexture(depthTexture, uv);
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linearizeDepth(depthSample);;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
float fogAmount = getFogAmount(terrainDepth, rayDir);
vec4 fog = vec4(fogColor, 1.0) * fogAmount;
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));`),t}const aMt=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:loe,build:cke},Symbol.toStringTag,{value:"Module"}));let kve=class extends Bi{constructor(e,i){super(e,i,new Fi(aMt,()=>V(()=>Promise.resolve().then(()=>GGt),void 0)))}initializePipeline(){return _i({blending:Yb(Ft.SRC_ALPHA,Ft.ZERO,Ft.ONE_MINUS_SRC_ALPHA,Ft.ONE),colorWrite:Ai})}},JR=class extends Om{constructor(){super(...arguments),this.consumes={required:[ut.TRANSPARENT_ENVIRONMENT]}}_enable(){this.produces=ut.TRANSPARENT_ENVIRONMENT,this.requestRender(bt.UPDATE)}};u([p()],JR.prototype,"consumes",void 0),JR=u([A("esri.views.3d.webgl-engine.effects.TransparentEnvironment")],JR);const lMt=.95,cMt=1;let HX=class extends JR{constructor(e){super(e),this.requireGeometryDepth=!0,this._newParameters=new Oq,this._oldParameters=new Oq,this._fadedParameters=new Oq,this._parameters=this._newParameters,this._passParameters=new loe;const i=gr(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+i.atmosphereHeight,e.view._stage.renderView.techniques.precompile(kve)}toogle(){this.view.environment.atmosphereEnabled&&this.view.environment.weather?this._enable():this._disable()}initialize(){this.addHandles([H(()=>this.view.environment.atmosphereEnabled,()=>this.toogle(),St),H(()=>this.view.environment.weather,()=>this.toogle(),St),H(()=>this._updateFogParameters(),()=>{},St)]),this.addHandles(H(()=>this._fadeFactor,e=>this._fade(e),St))}get _fadeFactor(){return this.view._stage?.renderer.renderContext.bind.clouds.fadeFactor??1}_fade(e){const{_newParameters:i,_oldParameters:r}=this;e>=1?(this._parameters=i,this._oldParameters.copyFrom(this._newParameters)):e<=0?this._parameters=r:(this._fadedParameters.lerp(r,i,e),this._parameters=this._fadedParameters)}_updateFogParameters(){const e=this.view.environment.weather,i=e.type==="foggy"||e.type==="snowy"||e.type==="rainy";this._newParameters.strength=e.type==="foggy"?dt(3e-5,.005,e.fogStrength**3):e.type==="snowy"||e.type==="rainy"?dt(4e-6,2e-4,(e.precipitation??0)**3):0,this._newParameters.amount=i?1:0,e.type!=="foggy"&&e.type!=="snowy"||ne(this._newParameters.color,hMt),e.type==="rainy"&&ne(this._newParameters.color,uMt),this._fadeFactor>=1&&this._oldParameters.copyFrom(this._newParameters),this.requestRender(bt.UPDATE)}render(e){const i=e.find(({name:o})=>o===ut.TRANSPARENT_ENVIRONMENT);if(this._parameters.amount===0||(this._update(),this._passParameters.amount<=0))return i;const r=this.techniques.get(kve);if(!r.compiled)return this.requestRender(bt.UPDATE),i;const s=this.renderingContext,n=i.getAttachment(s.gl.DEPTH_STENCIL_ATTACHMENT);return i.attachDepth(null),s.bindFramebuffer(i.fbo),s.bindTechnique(r,this.bindParameters,this._passParameters),s.screen.draw(),i.attachDepth(n),i}_update(){const e=this.bindParameters.camera;ae(zve,e.eye);const i=Math.max(0,de(zve,this.bindParameters.lighting.mainLight.direction)),r=this._parameters.color;ie(Uve,r,.1),dr(this._passParameters.color,Uve,r,i);const s=Te(e.eye);this._passParameters.atmosphereC=s**2-this._atmosphereRadius**2,this._passParameters.amount=(1-CP(lMt*FC,cMt*FC,Math.abs(s-this._planetRadius)))*this._parameters.amount,this._passParameters.strength=this._parameters.strength}};HX=u([A("esri.views.3d.environment.Fog")],HX);let Oq=class{constructor(){this.color=$(),this.strength=0,this.amount=0}copyFrom(e){this.amount=e.amount,this.strength=e.strength,ne(this.color,e.color)}lerp(e,i,r){this.amount=dt(e.amount,i.amount,r),this.strength=dt(e.strength,i.strength,r),dr(this.color,e.color,i.color,r)}};const zve=$(),Uve=$(),uMt=Le(.5,.5,.5),hMt=Le(1.5,1.5,1.5);var nf;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(nf||(nf={}));let coe=class extends zm{constructor(){super(...arguments),this.geometry=nf.Cone}};u([te({count:nf.COUNT})],coe.prototype,"geometry",void 0);let $G=class extends ar{constructor(){super(...arguments),this.texV=He(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new uoe}},uoe=class{constructor(){this.center=$(),this.v1=$(),this.v2=$()}};function uke(t){const e=new ki,{vertex:i,fragment:r}=e;if(eg(i),t.geometry===nf.Underground)e.attributes.add(z.POSITION,"vec2"),e.varyings.add("color","vec4"),i.uniforms.add(new Ja("cameraPosition",s=>s.camera.eye),new pt("undergroundFadeAlpha",s=>s.undergroundFadeAlpha)),i.main.add(E`float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);`),r.main.add(E`fragColor = color;`);else{e.include(Y_,t),e.attributes.add(z.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const s=t.geometry===nf.Cylinder;i.uniforms.add(new Co("proj",a=>a.camera.projectionMatrix),new Co("view",a=>a.camera.viewMatrix)),s||(e.varyings.add("innerFactor","float"),i.uniforms.add(new Cr("silCircleCenter",a=>a.silhouette.center)),i.uniforms.add(new Cr("silCircleV1",a=>a.silhouette.v1)),i.uniforms.add(new Cr("silCircleV2",a=>a.silhouette.v2)),i.uniforms.add(new fc("texV",a=>a.texV)),i.uniforms.add(new pt("innerScale",a=>a.innerScale)));const n=6.2831853,o=1/128;i.main.add(E`
      ${s?E`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:E`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${E.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${E.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
	  `),r.uniforms.add(new $t("tex",a=>a.texture)),s||r.uniforms.add(new pt("altitudeFade",a=>a.altitudeFade)),r.main.add(E`
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${s?E`fragColor = atmosphereColor;`:E`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));`}`)}return e}const dMt=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:uoe,SimpleAtmospherePassParameters:$G,build:uke},Symbol.toStringTag,{value:"Module"}));let lC=class extends Bi{constructor(e,i){super(e,i,new Fi(dMt,()=>V(()=>Promise.resolve().then(()=>HGt),void 0)))}initializePipeline(e){const i=e.geometry===nf.Cylinder;return _i({blending:Od,culling:i?lse:void 0,depthTest:{func:Ni.LEQUAL},colorWrite:Ai})}};const pMt=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);let qX=class extends Om{constructor(){super(...arguments),this._configuration=new coe,this._passParameters=new $G,this._vao=null,this._vaoCount=0}initialize(){this._configuration.geometry=nf.Cylinder,this.addHandles([H(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),Nt)])}destroy(){this._passParameters.texture=Rt(this._passParameters.texture),this._vao=Rt(this._vao)}precompile(){this.techniques.precompile(lC,this._configuration)}render(e){const i=e.find(({name:o})=>o===ut.OPAQUE_ENVIRONMENT),r=this.techniques.get(lC,this._configuration);if(!r.compiled)return this.requestRender(bt.UPDATE),i;const s=this.renderingContext;if(this._vao||(this._vao=fMt(s),this._vaoCount=R$(this._vao,"geometry")),!this._passParameters.texture){const o=new $r;o.wrapMode=nr.CLAMP_TO_EDGE,o.flipped=!0,o.width=1,o.height=512,this._passParameters.texture=new yi(s,o,pMt)}const n=s.bindTechnique(r,this.bindParameters,this._passParameters);return mMt(Bve,this.bindParameters.camera.viewMatrix),n.setUniformMatrix4fv("view",Bve),s.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),s.drawArrays(Ui.TRIANGLES,0,this._vaoCount),i}};function fMt(t){const e=XIe(1,2,!1),{data:i,indices:r}=e[0][1],s=Vve.createBuffer(r.length),n=s.position;for(let o=0;o<r.length;++o){const a=3*r[o%3==0?o+2:o%3==2?o-2:o];n.set(o,0,i[a]),n.set(o,1,i[a+1]),n.set(o,2,i[a+2])}return new mg(t,hg,new Map([["geometry",Fv(Vve)]]),new Map([["geometry",Un.createVertex(t,Zs.STATIC_DRAW,s.buffer)]]))}function mMt(t,e){mn(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}qX=u([A("esri.views.3d.environment.LocalAtmosphere")],qX);const Bve=Ve(),Vve=Nd().vec3f(z.POSITION),gMt=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),NF=128,jve=-1e4,Gve=0,Iq=50,yMt=()=>1-511/512,vMt=M4([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let WX=class extends Om{constructor(e){super(e),this._passParameters=new $G,this._configuration=new coe,this._vao=null,this._vaoCount=0,this._fadeVao=null,this._fadeVaoCount=0,this._texV1=1;const i=e.view,r=gr(i.spatialReference),{outerAtmosphereRimWidth:s,radius:n}=r;this._planetRadius=n,this._innerRimFactor=1+jve/n,this._middleRimFactor=1+Gve/n,this._outerRimFactor=1+s/n,this._texV0=Gve/s,this._texVScale=this._texV1-this._texV0;const o=i._stage.renderView.techniques;o.precompile(lC,this._configuration),this._configuration.geometry=nf.Underground,o.precompile(lC,this._configuration)}initialize(){this.addHandles(H(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),Nt))}destroy(){this._passParameters.texture=Rt(this._passParameters.texture),this._fadeVao=Rt(this._fadeVao),this._vao=Rt(this._vao)}render(e){const i=e.find(({name:s})=>s===ut.OPAQUE_ENVIRONMENT);this._update();const r=this.renderingContext;if(!this._passParameters.texture){const s=new $r;s.wrapMode=nr.CLAMP_TO_EDGE,s.flipped=!0,s.width=1,s.height=512,this._passParameters.texture=new yi(r,s,gMt)}if(this._passParameters.undergroundFadeAlpha<1){this._vao||(this._vao=this._createRibbon(r),this._vaoCount=R$(this._vao,"geometry")),this._configuration.geometry=nf.Cone;const s=this.techniques.get(lC,this._configuration);if(!s.compiled)return this.requestRender(bt.UPDATE),i;r.bindTechnique(s,this.bindParameters,this._passParameters),r.bindVAO(this._vao),r.drawArrays(Ui.TRIANGLES,0,this._vaoCount)}if(this._passParameters.undergroundFadeAlpha>0){this._fadeVao||(this._fadeVao=Qb(r),this._fadeVaoCount=R$(this._fadeVao,"geometry")),this._configuration.geometry=nf.Underground;const s=this.techniques.get(lC,this._configuration);if(!s.compiled)return this.requestRender(bt.UPDATE),i;r.bindTechnique(s,this.bindParameters,this._passParameters),r.bindVAO(this._fadeVao),r.drawArrays(Ui.TRIANGLE_STRIP,0,this._fadeVaoCount)}return i}_update(){const e=this.bindParameters.camera,i=$(),r=this._planetRadius,s=Te(e.eye),n=s-r;if(n<0){const m=Math.min(-n/5e3,1);this._passParameters.undergroundFadeAlpha=m}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(Iq,n),a=r+jve;this._passParameters.innerScale=_Mt(r+o,r,a)-1,this._passParameters.altitudeFade=wne(n),ie(i,e.eye,(r+Iq)/s),Hve(i,e.center,e.up,r,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,i,e.up,this._passParameters.silhouette),c=yMt(),h=vMt(n);let d=this._texV0+c*this._texVScale,f=this._texV0+l*h*this._texVScale;if(n>Iq){Hve(e.eye,e.center,e.up,r,this._passParameters.silhouette);const m=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),y=ce((m-1.5)/(l-1.5),0,1);d=this._texV0+y*c*this._texVScale,f=this._texV0+dt(this._texV1,l*h,y)*this._texVScale}li(this._passParameters.texV,d,f)}_createRibbon(e){const i=th(3+3*NF*3),r=new Uint32Array(3*NF*5);i[0]=0,i[1]=0,i[2]=-1;for(let o=0;o<NF;o++){const a=9*o+3;i[a]=o,i[a+1]=this._innerRimFactor,i[a+2]=-1,i[a+3]=o,i[a+4]=this._middleRimFactor,i[a+5]=0,i[a+6]=o,i[a+7]=this._outerRimFactor,i[a+8]=1;const l=3*o+1,c=o===NF-1?1:l+3,h=15*o;r[h]=l,r[h+1]=l+1,r[h+2]=c+1,r[h+3]=c+1,r[h+4]=c,r[h+5]=l,r[h+6]=l+1,r[h+7]=l+2,r[h+8]=c+2,r[h+9]=c+2,r[h+10]=c+1,r[h+11]=l+1,r[h+12]=l,r[h+13]=c,r[h+14]=0}const s=qve.createBuffer(r.length),n=s.position;for(let o=0;o<r.length;++o){const a=3*r[o];n.set(o,0,i[a]),n.set(o,1,i[a+1]),n.set(o,2,i[a+2])}return new mg(e,hg,new Map([["geometry",Fv(qve)]]),new Map([["geometry",Un.createVertex(e,Zs.STATIC_DRAW,s.buffer)]]))}_computeScreenRimWidth(e,i,r,s){return oe(KT,s.center,s.v2),ie(FF,KT,this._outerRimFactor),jV(Rq,i,KT,r),Mde(KT,Rq,e.projectionMatrix,e.viewport,KT),Mde(FF,Rq,e.projectionMatrix,e.viewport,FF),xr(KT,FF)/e.height}};function Hve(t,e,i,r,s){const n=Te(t),o=r*Math.sqrt(n*n-r*r)/n,a=Math.sqrt(r*r-o*o),l=s.v1,c=s.v2;return ie(s.center,t,a/n),lt(l,t,e),Yo(l)<1&&lt(l,t,i),ie(l,l,o/Te(l)),lt(c,l,t),ie(c,c,o/Te(c)),o}WX=u([A("esri.views.3d.environment.MarsAtmosphere")],WX);const Rq=Ve(),KT=$(),FF=$();function _Mt(t,e,i){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-i*i)+e*i)}const qve=Nd().vec3f(z.POSITION),bMt=WX;function wMt(t,e){hoe(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function hoe(t,e,i=3,r=i){const s=e.length/r;let n=0,o=0;for(let a=0;a<s;++a)t[n]=e[o],t[n+1]=e[o+1],t[n+2]=e[o+2],n+=i,o+=r}function xMt(t,e,i,r,s){const n=t.typedBuffer,o=t.typedBufferStride,a=s?.count??t.count;let l=(s?.dstIndex??0)*o;for(let c=0;c<a;++c)n[l]=e,n[l+1]=i,n[l+2]=r,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:hoe,copyView:wMt,fill:xMt},Symbol.toStringTag,{value:"Module"}));let SMt=class{constructor(e){this._totalCount=e,this._componentCountCache=-1,this._indexRanges=[0,e]}allVisible(){return this.componentCount===this._totalCount}allInvisible(){return this._indexRanges.length===0}isVisible(e){if(e<0||e>=this._totalCount)return!1;if(this.allVisible())return!0;{const i=this._indexRanges;let r=0,s=i.length/2;if(e<i[2*r]||e>i[2*s]+i[2*s+1])return!1;for(;s-r>0;){const n=Math.floor(.5*(r+s)),o=i[2*n];if(e<o){if(s-r==1)return!1;s=n;continue}if(e<o+i[2*n+1])return!0;if(s-r==1)return!1;r=n+1}return!1}}get componentCount(){if(this._componentCountCache===-1){const e=this._indexRanges;let i=0;for(let r=0;r<e.length;r+=2)i+=e[r+1];this._componentCountCache=i}return this._componentCountCache}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=TMt(e),this._componentCountCache=-1}forEachComponent(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r],n=s+i[r+1];for(let o=s;o<n;o++)if(!e(o))return!1}return!0}forEachComponentRange(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r];if(!e(s,s+i[r+1]))return!1}return!0}computeOffsetRanges(e){const i=new Array(this._indexRanges.length),r=this._indexRanges;for(let s=0;s<r.length;s+=2){const n=r[s],o=n+r[s+1],a=e[n],l=e[o];i[s]=a,i[s+1]=l-a}return i}};function TMt(t){const e=new Array;if(t.length===0)return e;let i=t[0],r=1;for(let s=1;s<t.length;s++){const n=t[s];i+r===n?r+=1:(e.push(i),e.push(r),i=n,r=1)}return e.push(i),e.push(r),e}let EMt=class{constructor(e,i){this.offsets=i,this._highlightsInOrder=[],this.pickability=null,this.componentHighlights=new Map,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRangesMap=null,this.cachedShadowmapRanges=null;const r=this.count;this.visibility=new SMt(r),this.materialDataBuffer=e.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let s=0;s<r;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return this.cachedGeometryRanges==null&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRangesMap(){return this.componentHighlights.size===0?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRangesMap)}get shadowmapRanges(){return this.componentHighlights.size===0?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedShadowmapRanges)}markHighlightsDirty(){this.cachedHighlightRangesMap=null,this.cachedShadowmapRanges=null}markVisibilityDirty(){this.cachedGeometryRanges=null,this.markHighlightsDirty()}updateHighlights(e){this._updateHighlightOrder(e)&&(this.markHighlightsDirty(),this._updateCachedHighlightRanges())}_updateHighlightOrder(e){const{_highlightsInOrder:i}=this;let r=i.length!==e.length;i.length=Math.min(e.length,8);for(let s=0;s<e.length;++s){const n=e.at(s).name;i.length<s?(r=!0,i.push(n)):i[s]!==n&&(i[s]=n,r=!0)}return r}_updateCachedHighlightRanges(){if(this.cachedHighlightRangesMap==null||this.cachedShadowmapRanges==null){const{highlightRangesMap:e,shadowmapRangesMap:i}=CMt(this.componentHighlights,this.visibility,this.offsets,this._highlightsInOrder);this.cachedHighlightRangesMap=e,this.cachedShadowmapRanges=i}}};function CMt(t,e,i,r){const s=new Map,n=[];if(t.size>0){let o=i.length;e.forEachComponent(a=>{let l=!1;for(let c=r.length-1;c>=0;--c){const h=r[c];if((t.get(h)?.[a]??0)>0){const f=zb(s,h,()=>[]),m=i[a],y=i[a+1];f.push(m),f.push(y-m),l||=h===Dm;break}}return l||(o!==a-1&&(n.length>0&&n.push(i[o+1]-n[n.length-1]),n.push(i[a])),o=a),!0}),n.length>0&&n.push(i[o+1]-n[n.length-1])}return{highlightRangesMap:s,shadowmapRangesMap:n}}let $Mt=class{constructor(e,i,r,s,n,o){this.transform=e,this.toMapSpace=i,this.obb=r,this.componentData=s,this.renderable=n,this.intersectionGeometry=o,this.visible=!1,this.offsetObb=null}destroy(){this.intersectionGeometry=Ce(this.intersectionGeometry),this.renderable=Ce(this.renderable),this.componentData=Ce(this.componentData)}};function AMt(t,e,i,r,s,n,o){const a=n-o,l=e-t,c=new Float64Array(4*l);for(let h=0;h<l;++h){const d=3*(h+t),f=s*i[d+0],m=r[f+0],y=r[f+1],v=a/(r[f+2]-o),_=m*v,b=y*v,w=s*i[d+1],x=r[w+0],S=r[w+1],C=a/(r[w+2]-o),T=x*C,M=S*C,I=s*i[d+2],P=r[I+0],D=r[I+1],F=a/(r[I+2]-o),L=P*F,N=D*F,R=4*h;c[R+0]=Math.min(_,T,L),c[R+1]=Math.min(b,M,N),c[R+2]=Math.max(_,T,L),c[R+3]=Math.max(b,M,N)}return c}function MMt(t,e,i,r,s){const n=e-t,o=new Float64Array(4*n);for(let a=0;a<n;++a){const l=3*(a+t),c=s*i[l+0],h=r[c+0],d=r[c+1],f=s*i[l+1],m=r[f+0],y=r[f+1],v=s*i[l+2],_=r[v+0],b=r[v+1],w=4*a;o[w+0]=Math.min(h,m,_),o[w+1]=Math.min(d,y,b),o[w+2]=Math.max(h,m,_),o[w+3]=Math.max(d,y,b)}return o}function OMt(t,e){return new(IMt(t))(e)}function IMt(t){return t<128?Uint8Array:t<32768?Uint16Array:t<1<<31?Uint32Array:Array}let hke=class{constructor(e,i){this.elementCount=e,this.model=i,this._elementIndexMap=null,this._bspNodes=[],this._generatedBVH=!1,this.localMode=i.localMode,this.planetCenterZ=i.planetCenterZ,this.geometryMinZ=i.geometryMinZ,this.planetCenter=Le(0,0,this.planetCenterZ),this.maxBspNodeDepth=i.maxBspNodeDepth??8,this.minElementCountForBVH=i.minElementCountForBVH??15,this.minBspNodeElementCount=i.minBspNodeElementCount??5}get elementIndexMap(){return this._ensureBVH(),this._elementIndexMap}get _skipBVH(){return this.elementCount<this.minElementCountForBVH||this.geometryMinZ<.5*this.planetCenterZ}_ensureBVH(){this._generatedBVH||this._skipBVH||this._bspNodes.length===0&&this._generateBsp()}intersectRay(e,i,r){this.elementCount<1||(this._skipBVH?this._intersectRayWithoutBVH(r):this._intersectRayWithBVH(e,i,r))}_intersectRayWithoutBVH(e){this._intersectRange(0,this.elementCount)}_intersectRange(e,i){this.model.intersectRange(e,i)}_intersectRayWithBVH(e,i,r){this._ensureBVH(),r?this._intersectGeometryWithBVHVerticalRay(e):this._intersectGeometryWithBVHGeneralRay(e,i)}_intersectGeometryWithBVHVerticalRay(e){let i=e[0],r=e[1];if(!this.localMode){const{geometryMinZ:o,planetCenterZ:a}=this,l=(o-a)/(e[2]-a);i=e[0]*l,r=e[1]*l}const{_bspNodes:s}=this;let n=0;for(;n>=0;){const o=s[n],{d:a,dim:l,minIndexIndex:c,minMidIndexIndex:h,maxMidIndexIndex:d,maxIndexIndex:f,aabb2D:m}=o;if(i<m[0]||i>m[2]||r<m[1]||r>m[3])break;if(l===-1||o.child0===-1&&o.child1===-1){this._intersectRange(c,f);break}{this._intersectRange(h,d);const y=(l===0?i:r)-a;if(y<0){if(o.child0===-1){this._intersectRange(c,h);break}n=o.child0}else{if(!(y>0))break;if(o.child1===-1){this._intersectRange(d,f);break}n=o.child1}}}}_intersectGeometryWithBVHGeneralRay(e,i){let r=e[0],s=e[1],n=i[0],o=i[1];const{geometryMinZ:a}=this;if(!this.localMode){let y=0,v=1;const _=Math.min(.5*this.planetCenterZ,a),b=e[2],w=i[2];if(b<_&&w<_||(b<_&&(y=(_-b)/(w-b)),w<_&&(v=(_-b)/(w-b)),y>v))return;const x=(1-y)*e[0]+y*i[0],S=(1-y)*e[1]+y*i[1],C=(1-y)*e[2]+y*i[2],T=(1-v)*e[0]+v*i[0],M=(1-v)*e[1]+v*i[1],I=(1-v)*e[2]+v*i[2],{planetCenterZ:P}=this,D=a-P,F=D/(C-P);r=x*F,s=S*F;const L=D/(I-P);n=T*L,o=M*L}const l=n-r,c=o-s,h=this._bspNodes;let d=1;{const{aabb2D:y}=h[0],v=(w,x,S,C)=>{if(Math.abs(x)<1e-5*Math.max(C-S,1))return!1;const T=x>0,M=T?C:S,I=w+d*x;return(T?I<M:I>M)&&(d=Math.max((M-w)/x,d),!0)},_=()=>v(r,l,y[0],y[2]),b=()=>v(s,c,y[1],y[3]);Math.abs(l)>=Math.abs(c)?_()||b():b()||_()}const f=[0,0,d];let m=0;for(;m<f.length;){const y=f[m];let v=f[m+1],_=f[m+2];if(m+=3,v>_)continue;const b=h[y],{minIndexIndex:w,maxIndexIndex:x}=b,{child0:S,child1:C,minMidIndexIndex:T,maxMidIndexIndex:M,aabb2D:I,d:P,dim:D}=b;{const F=r+v*l,L=r+_*l,N=Math.min(F,L),R=Math.max(F,L),k=I[0],W=I[2];if(R<k||W<N)continue;if(N<k){const G=(k-r)/l;l>0?v=Math.max(v,G):_=Math.min(_,G)}if(W<R){const G=(W-r)/l;l>0?_=Math.min(_,G):v=Math.max(v,G)}}{const F=s+v*c,L=s+_*c,N=Math.min(F,L),R=Math.max(F,L),k=I[1],W=I[3];if(R<k||W<N)continue;if(N<k){const G=(k-s)/c;c>0?v=Math.max(v,G):_=Math.min(_,G)}if(W<R){const G=(W-s)/c;c>0?_=Math.min(_,G):v=Math.max(v,G)}}if(S===-1&&C===-1)this._intersectRange(w,x);else{const F=D===0?r:s,L=D===0?l:c,N=F+v*L,R=F+_*L,k=Math.min(N,R),W=Math.max(N,R),G=ce((P-F)/L,0,d);w<T&&k<=P&&(S!==-1?(f.push(S),f.push(L>=0?v:Math.max(v,G)),f.push(L>=0?Math.min(_,G):_)):this._intersectRange(w,T)),this._intersectRange(T,M),M<x&&P<=W&&(C!==-1?(f.push(C),f.push(L>=0?Math.max(v,G):v),f.push(L>=0?_:Math.min(_,G))):this._intersectRange(M,x))}}}_generateBsp(){const{elementCount:e}=this;if(e<1)return;const i=OMt(e,e);this._elementIndexMap=i;for(let m=0;m<e;++m)i[m]=m;const r=this.model.getAabbs2D();let s=0;const n=this._bspNodes;n.length=0;const{localMode:o}=this;let a=!1;if(!o){const{planetCenterZ:m,geometryMinZ:y}=this;a=m>=0||y<.5*m}const l=[],c=(m,y,v,_,b)=>{l.push(m),l.push(y),l.push(v),l.push(_<0?-1:(b?0:1)+2*_)},{maxBspNodeDepth:h,minBspNodeElementCount:d}=this,f=(m,y,v,_,b)=>{const w=n.length;if(w>0&&(a||v>=h||y-m<d))return;const x=[0,0,0,0];LMt(x,m,y,i,r);const{d:S,dim:C}=o?RMt(x):PMt(x),{rangeMidStart:T,rangeMidEnd:M}=DMt(m,y,C,S,i,r),I=v===h-1,P=!I&&T>=m+d,D=!I&&y>=M+d;if(P||D||w===0){const F=new NMt(m,T,M,y,C,S,x);if(P&&c(m,T,v+1,w,!0),D&&c(M,y,v+1,w,!1),n.push(F),_!==-1){const L=n[_];b?L.child0=w:L.child1=w}}};for(c(0,e,0,-1,!1);s<l.length;){const m=l[s],y=l[s+1],v=l[s+2],_=l[s+3];s+=4;const b=_>>1;f(m,y,v,b,_-(b<<1)==0)}this._generatedBVH=!0}};function RMt(t){const e=t[0],i=t[1],r=t[2],s=t[3];let n,o;return r-e>=s-i?(o=.5*(e+r),n=0):(o=.5*(i+s),n=1),{d:o,dim:n}}function PMt(t){const e=t[0],i=t[1],r=t[2],s=t[3];let n,o;return r-e>=s-i?(n=0,o=.5*(e+r)):(n=1,o=.5*(i+s)),{dim:n,d:o}}function DMt(t,e,i,r,s,n){let o=t;{let h=e;for(;o<h;){const d=s[o];Wve(d,i,r,n)<0?++o:(--h,s[o]=s[h],s[h]=d)}}const a=o;let l=o,c=e;for(;l<c;){const h=s[c-1];Wve(h,i,r,n)>0?--c:(s[c-1]=s[l],s[l]=h,++l)}return{rangeMidStart:a,rangeMidEnd:c}}function Wve(t,e,i,r){const s=4*t,n=r[s+0+e];return r[s+2+e]<i?-1:n>i?1:0}function LMt(t,e,i,r,s){let n=1/0,o=1/0,a=-1/0,l=-1/0;for(let c=e;c<i;++c){const h=4*r[c];n=Math.min(n,s[h+0]),o=Math.min(o,s[h+1]),a=Math.max(a,s[h+2]),l=Math.max(l,s[h+3])}t[0]=n,t[1]=o,t[2]=a,t[3]=l}let NMt=class{constructor(e,i,r,s,n,o,a){this.minIndexIndex=e,this.minMidIndexIndex=i,this.maxMidIndexIndex=r,this.maxIndexIndex=s,this.dim=n,this.d=o,this.aabb2D=a,this.child0=-1,this.child1=-1}},FMt=class{constructor(e,i,r,s,n,o,a,l,c){this.componentIndex=e,this.vertexData=i,this.vertexStride=r,this.indexData=s,this.startTriangleNumber=n,this.endTriangleNumber=o,this.geometryMinZ=a,this.planetCenterZ=l,this.localMode=c,this.maxBspNodeDepth=8,this.minElementCountForBVH=20,this.minBspNodeElementCount=10,this.rayDirection=$(),this.ray0=$(),this.isVerticalRay=!1,this._triangleHitCallback=Zve,this.totalElevationOffset=0,this.normalRequired=!1,this._bvh=new hke(o-n,this)}getAabbs2D(){return this.localMode?MMt(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride):AMt(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride,this.geometryMinZ,this.planetCenterZ)}get numTriangles(){return this.endTriangleNumber-this.startTriangleNumber}intersectRay(e,i,r,s,n,o){ne(this.ray0,e),Ri(this.rayDirection,i,e),this.isVerticalRay=r,this.totalElevationOffset=s,this.normalRequired=o,this._triangleHitCallback=n,this._bvh.intersectRay(e,i,r),this._triangleHitCallback=Zve}intersectRange(e,i){const r=this._bvh.elementIndexMap;dke(this.ray0,this.rayDirection,e,i,this.indexData,this.vertexData,this.vertexStride,this.totalElevationOffset,this.planetCenterZ,this.normalRequired,this._triangleHitCallback,r,this.startTriangleNumber)}getTriangleElevationOffset(e){return this.totalElevationOffset}};function dke(t,e,i,r,s,n,o,a,l,c,h,d=null,f=0){a!==0?zdt(t,e,i,r,s,n,o,a,l,c,h,d,f):oPe(t,e,i,r,s,n,o,c,h,d,f)}function Zve(){}function kMt(t,e,i,r){if(i>=e)return t;t==null&&(t=zMt());const s=t.isVisibleBit;let n=t.data;const o=pke(n),a=i/o|0,l=i-o*a,c=(e-1)/o|0,h=n,d=r===s;if(!(i<h.length*o)&&d){const f=a+1,m=Math.ceil(h.length*h1e),y=c+1;let v=Math.max(f,m);v=Math.min(v,y),n=new Uint32Array(v),n.set(h)}return a<n.length&&(n[a]=BMt(n[a],l,d)),t.data=n,t}function ZX(t,e){if(t==null)return!0;const{isVisibleBit:i,data:r}=t,s=pke(r);return e<r.length*s?UMt(i,r,e,s):!t.isVisibleBit}function zMt(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function UMt(t,e,i,r){const s=i/r|0,n=i-s*r;return VMt(e[s],n)===t}function pke(t){return t.BYTES_PER_ELEMENT*8}function BMt(t,e,i){return t&~(1<<e)|(i?1:0)<<e}function VMt(t,e){return!!(t&1<<e)}let jMt=class{constructor(e,i,r,s,n,o,a,l){this.vertexData=e,this.vertexStride=i,this.indexData=r,this._components=s,this._componentAabbs3D=n,this.geometryMinZ=o,this.planetCenterZ=a,this.localMode=l,this.maxBspNodeDepth=6,this.minElementCountForBVH=10,this.minBspNodeElementCount=3,this._ray0=WMt,this._ray1=ZMt,this._invDir=$(),this._componentVerticalOffsets=null,this._verticalOffset=null,this._tolerance=0,this._intersectionOptions=YMt,this._callback=Yve,this.rayDirectionC=$(),this._componentIndexMap=null,this._bvh=new hke(s.count,this),this.componentIntersectionData=new Array(s.count)}get numComponents(){return this._components.count}get minZGlobal(){return this.geometryMinZ-this.planetCenterZ}getAabbs2D(){return this.localMode?this.getAabbs2DLocal():this.getAabbs2DGlobal()}getAabbs2DGlobal(){const{numComponents:e,planetCenterZ:i,minZGlobal:r}=this,s=new Float64Array(4*e),n=this._componentAabbs3D;for(let o=0;o<e;++o){const a=6*o,l=n[a+0],c=n[a+1],h=n[a+2],d=n[a+3],f=n[a+4],m=r/(h-i),y=r/(n[a+5]-i),v=Math.min(l*m,l*y),_=Math.min(c*m,c*y),b=Math.max(d*m,d*y),w=Math.max(f*m,f*y),x=4*o;s[x+0]=v,s[x+1]=_,s[x+2]=b,s[x+3]=w}return s}getAabbs2DLocal(){const{numComponents:e}=this,i=new Float64Array(4*e),r=this._componentAabbs3D;for(let s=0;s<e;++s){const n=6*s,o=r[n+0],a=r[n+1],l=r[n+3],c=r[n+4],h=4*s;i[h+0]=o,i[h+1]=a,i[h+2]=l,i[h+3]=c}return i}intersectRay(e,i,r,s,n,o,a){const{isVerticalRay:l}=a;this._ray0=e,this._ray1=i,this._componentVerticalOffsets=r,this._verticalOffset=s,this._tolerance=o,this._intersectionOptions=a,this._componentIndexMap=this._bvh.elementIndexMap,Hdt(e,i,this._invDir),this._callback=n,this._bvh.intersectRay(e,i,l),this._callback=Yve}intersectRange(e,i){const r=this._componentIndexMap,s=this._components,n=s.pickability,o=s.visibility;for(let a=e;a<i;++a){const l=r?r[a]:a;ZX(n,l)&&o.isVisible(l)&&this._intersectComponent(l)}}getComponentTriangleCount(e){const i=this._components.offsets,r=i[e]/3;return i[e+1]/3-r}getComponentAabb3D(e,i){const r=this._componentAabbs3D,s=6*e;return i[0]=r[s],i[1]=r[s+1],i[2]=r[s+2],i[3]=r[s+3],i[4]=r[s+4],i[5]=r[s+5],i}_intersectComponent(e){if(!ZX(this._components.pickability,e))return;const i=this.getComponentAabb3D(e,GMt);let r=!1;const{localMode:s,_componentVerticalOffsets:n,_verticalOffset:o,_ray0:a,_ray1:l,_invDir:c,planetCenterZ:h,_tolerance:d,rayDirectionC:f,componentIntersectionData:m}=this,{isVerticalRay:y}=this._intersectionOptions,v=this._components.offsets,_=ne(HMt,a),b=ne(qMt,l),w=n?.[e]??0,x=w+(o?.offset??0);if(x!==0&&(s?(_[2]=a[2]-x,b[2]=l[2]-x,r=!0):o!=null&&(o.componentOffset=w)),o==null||r||x===0||o.applyToAabb(i),!lPe(i,_,c,d))return;Ri(f,b,_);const S=v[e]/3,C=v[e+1]/3,T=C-S,M=(N,R,k)=>{this._callback(N,R,e,k)},{vertexData:I,vertexStride:P,indexData:D,_intersectionOptions:F}=this,{normalRequired:L}=F;if(T>JMt){let N=m[e];N==null&&(N=new FMt(e,I,P,D,S,C,this.geometryMinZ,h,s),m[e]=N),N.intersectRay(_,b,y,r?0:x,M,L)}else dke(_,f,S,C,D,I,P,r?0:x,h,L,M)}};const GMt=ch(),HMt=$(),qMt=$(),WMt=$(),ZMt=$(),Yve=()=>{},YMt=new Hj,JMt=40;let XMt=class{constructor(e,i,r){this.viewingMode=e,this.positionData=i,this._components=r,this.verticalOffset=null,this.componentVerticalOffsets=null,this._planetCenter=$(),this._componentBvh=null,this._aabb=[0,0,0,0,0,0],this._indices=i.indices?lS(i.indices):MD(i.positions.length/3),this._positions=i.positions}destroy(){this._positions=null,this._indices=null,this._perComponentAabbs=null,this._componentBvh=null}getComponentAabb(e,i){const r=this._ensureComponentAabbs(),s=6*e;return i[0]=r[s],i[1]=r[s+1],i[2]=r[s+2],i[3]=r[s+3],i[4]=r[s+4],i[5]=r[s+5],i}getComponentAabbs(){return this._ensureComponentAabbs()}_ensureComponentAabbs(){return this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs()),this._perComponentAabbs}getComponentPositions(e,i){i.indices=this._indices,i.data=this._positions,i.stride=3,i.startIndex=this._components.offsets[e],i.endIndex=this._components.offsets[e+1]}intersect(e,i,r,s,n,o,a,l){this.verticalOffset=s,this.componentVerticalOffsets=n;const{position:c}=o,h=Ri(KMt,e,c),d=Ri(QMt,i,c),f=_D(eOt,o.rotationScale);ac(h,h,f),ac(d,d,f);const m=OA(iOt,f);if(this.viewingMode===Be.Global){const v=this._planetCenter;wd(v,c),ac(v,v,f)}const y=(v,_,b,w)=>{l(b,v,w?ac(tOt,w,m):null,_)};this._intersectComponents(h,d,n,s,y,r,a)}_computePerComponentAabbs(){const e=this._aabb,i=.5*(e[0]+e[3]),r=.5*(e[1]+e[4]),s=.5*(e[2]+e[5]),n=this._components.count,o=th(6*n),a=this._indices,l=this._positions,c=this._components.offsets;let h=0,d=1/0,f=1/0,m=1/0,y=-1/0,v=-1/0,_=-1/0;for(let b=0;b<n;b++){const w=c[b],x=c[b+1];let S=1/0,C=1/0,T=1/0,M=-1/0,I=-1/0,P=-1/0;if(w<x)for(let D=w;D<x;D++){const F=3*a[D],L=l[F],N=l[F+1],R=l[F+2];S=Math.min(S,L),C=Math.min(C,N),T=Math.min(T,R),M=Math.max(M,L),I=Math.max(I,N),P=Math.max(P,R)}else S=i,C=r,T=s,M=i,I=r,P=s;o[h++]=S,o[h++]=C,o[h++]=T,o[h++]=M,o[h++]=I,o[h++]=P,d=Math.min(d,S),f=Math.min(f,C),m=Math.min(m,T),y=Math.max(y,M),v=Math.max(v,I),_=Math.max(_,P)}return this._aabb[0]=d,this._aabb[1]=f,this._aabb[2]=m,this._aabb[3]=y,this._aabb[4]=v,this._aabb[5]=_,o}_intersectComponents(e,i,r,s,n,o,a){let l=this._componentBvh;l==null&&(l=new jMt(this._positions,3,this._indices,this._components,this._ensureComponentAabbs(),this.geometryMinZ,this.planetCenterZ,this.localMode),this._componentBvh=l),l.intersectRay(e,i,r,s,n,o,a)}get geometryMinZ(){return this._aabb[2]}get planetCenterZ(){return this._planetCenter[2]}get numTriangles(){return this._indices.length/3}get localMode(){return this.viewingMode===Be.Local}get positions(){return this._positions}get indices(){return this._indices}get aabb(){return this._ensureComponentAabbs(),this._aabb}};const KMt=$(),QMt=$(),eOt=xs(),tOt=$(),iOt=xs();let rOt=class{constructor(e,i,r){this.material=e,this.geometry=i,this.meta=r}destroy(){this.material.dispose(),this.geometry.dispose()}},sOt=class{constructor(e,i,r,s){this.vao=e,this.primitiveType=i,this.parameters=r,this.indexed=s}dispose(){this.vao.dispose()}},su=class{constructor(e=1/0,i=-1/0){this.near=e,this.far=i}set(e,i){this.near=e,this.far=i}union(e){e!=null&&(this.near=Math.min(this.near,e.near),this.far=Math.max(this.far,e.far))}within(e){return this.near<=e&&e<=this.far}};su.zero=new su(0,0);function nOt(t,e){const i=new su,{eye:r,frustum:s,viewForward:n}=t;e.forAll(o=>{const a=o.offsetObb!=null?o.offsetObb:o.obb,l=de(Ri(Au,a.center,r),n),c=a.projectedRadius(n);if(i.within(l-c)&&i.within(l+c))return;const h=uOt(a,s);if(h===-1)return;if(h===0)return Lg.far=l+c,Lg.near=l-c,void i.union(Lg);const d=kF.pushNew();d.near=l-c,d.far=l+c,d.mask=h,d.object=o});for(let o=0;o<kF.length;o++){const a=kF.data[o];if(i.within(a.near)&&i.within(a.far))continue;Lg.far=a.far,Lg.near=1/0,cOt(a.object.offsetObb!=null?a.object.offsetObb:a.object.obb,r,oOt,c=>{let h=aOt;for(let d=0;d<fke&&c.length>0;d++){if(!(a.mask&1<<d))continue;lOt(s[d],c,h);const f=c;c=h,h=f}for(let d=0;d<c.length;d+=3){se(Wl,c.data[d],c.data[d+1],c.data[d+2]);const f=de(Ri(Wl,Wl,r),n);Lg.near=Math.min(Lg.near,f)}})===0&&(Lg.near=0),i.union(Lg)}return kF.length=0,i}const kF=new Jt({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=null,t)}),Lg=new su,Wl=$(),kw=$(),oOt=new Jt({deallocator:null}),aOt=new Jt({deallocator:null});function lOt(t,e,i){i.length=0;const r=e.length-3;Pq(Wl,e,r);const s=rn(t,Wl);s<=0&&(i.push(Wl[0]),i.push(Wl[1]),i.push(Wl[2]));let n=0,o=s;for(;n<r;n+=3){Pq(kw,e,n);const a=rn(t,kw);o*a<0&&(dr(Wl,kw,Wl,a/(a-o)),Zl(i,Wl)),a<=0&&Zl(i,kw),o=a,ne(Wl,kw)}o*s<0&&(Pq(kw,e,r),dr(Wl,kw,Wl,s/(s-o)),Zl(i,Wl))}function Pq(t,e,i){return se(t,e.data[i],e.data[i+1],e.data[i+2])}function Zl(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function cOt(t,e,i,r){lb(Xve,t.quaternion),Ri(Au,e,t.center),Uc(Au,Au,Xve);const s=t.halfSize,n=8*((Au[0]<-s[0]?-1:Au[0]>s[0]?1:0)+3*(Au[1]<-s[1]?-1:Au[1]>s[1]?1:0)+9*(Au[2]<-s[2]?-1:Au[2]>s[2]?1:0)+13),o=Jve[n];if(o===0)return o;HP(zF,t.quaternion),dj(zF,zF,t.halfSize);const a=(l,c)=>{const h=Jve[n+c+1];return se(l,((1&h)<<1)-1,(2&h)-1,((4&h)>>1)-1),ac(l,l,zF),oe(l,t.center,l)};return i.length=0,Zl(i,a(Dq,0)),Zl(i,a(Kve,1)),Zl(i,a(Au,2)),Zl(i,a(Qve,3)),r(i),o===1||(i.length=0,Zl(i,Dq),Zl(i,Qve),Zl(i,a(Au,4)),Zl(i,a(e0e,5)),r(i),o===2||(i.length=0,Zl(i,Dq),Zl(i,e0e),Zl(i,a(Au,6)),Zl(i,Kve),r(i))),o}const Jve=(()=>{const t=new Array(216);let e=0;const i=r=>{for(let s=0;s<r.length;s++)t[e+s]=r[s];e+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),t})(),fke=4;function uOt(t,e){let i=0;for(let r=0;r<fke;r++){const s=t.intersectPlane(e[r]);if(s>0)return-1;s===0&&(i|=1<<r)}return i}const zF=xs(),Xve=Dd(),Au=$(),Dq=$(),Kve=$(),Qve=$(),e0e=$();let hOt=class{constructor(e){this._objects=e}submit(e,i){this._objects.preSubmit(i),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(e,i,r))}queryDepthRange(e){return this._objects.visibleObjects.length?nOt(e,this._objects.visibleObjects):null}get hasEmissions(){return this._objects.visibleObjects.some(e=>e.renderable.material.hasEmissions)}hasHighlightOptions(e){return this._objects.hasHighlightOptions(e)}},mci=class extends ar{constructor(e,i,r,s,n){super(),this.colors=e,this.textureCoordinates=i,this.hasNormals=r,this.shadeNormals=s,this.applySSAO=n}};function dOt({hasNormals:t,textureCoordinates:e,colors:i}){const r=Nd().vec3f(z.POSITION);return t&&r.vec2i16(z.NORMALCOMPRESSED,{glNormalized:!0}),e===Ws.Default?r.vec2f(z.UV0):e===Ws.Atlas&&(r.vec2f(z.UV0),r.vec4u16(z.UVREGION,{glNormalized:!0})),i&&r.vec4u8(z.COLOR,{glNormalized:!0}),r}let pOt=class{constructor(){this.externalColor=pi(),this.externalColorMixMode=Ln.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}};var ad;(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(ad||(ad={}));var Bm;function vci(t){return t&&vA(t)?Bm.Mars:t&&_A(t)?Bm.Moon:Bm.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(Bm||(Bm={}));var dd;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(dd||(dd={}));let Sr=class extends ou{constructor(e,i){super(),this.spherical=e,this.doublePrecisionRequiresObfuscation=i,this.output=Y.Color,this.textureCoordinateType=Ws.None,this.componentData=km.Uniform,this.cullFace=Tl.Back,this.vertexDiscardMode=ad.None,this.doubleSidedMode=eo.WindingOrder,this.alphaDiscardMode=Dn.Opaque,this.integratedMeshMode=dd.None,this.oitPass=bi.NONE,this.ellipsoidMode=Bm.Earth,this.pbrMode=_t.Disabled,this.normalType=Fr.Attribute,this.emissionSource=Jo.None,this.hasVertexColors=!1,this.hasNormals=!1,this.shadeNormals=!0,this.hasSlicePlane=!1,this.hasColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.screenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.hasNormalTextureTransform=!1,this.cloudReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1,this.discardInvisibleFragments=!1,this.occlusionPass=!1,this.bindType=Pt.Draw,this.useCustomDTRExponentForWater=!1,this.hasVertexTangents=!1,this.highStepCount=!1,this.instancedDoublePrecision=!1,this.hasModelTransformation=!1,this.useFillLights=!0,this.objectAndLayerIdColorInstanced=!1,this.canHaveOverlay=!0}};u([te({count:Y.COUNT})],Sr.prototype,"output",void 0),u([te({count:Ws.COUNT})],Sr.prototype,"textureCoordinateType",void 0),u([te({count:km.COUNT})],Sr.prototype,"componentData",void 0),u([te({count:Tl.COUNT})],Sr.prototype,"cullFace",void 0),u([te({count:ad.COUNT})],Sr.prototype,"vertexDiscardMode",void 0),u([te({count:eo.COUNT})],Sr.prototype,"doubleSidedMode",void 0),u([te({count:Dn.COUNT})],Sr.prototype,"alphaDiscardMode",void 0),u([te({count:dd.COUNT})],Sr.prototype,"integratedMeshMode",void 0),u([te({count:bi.COUNT})],Sr.prototype,"oitPass",void 0),u([te({count:Bm.COUNT})],Sr.prototype,"ellipsoidMode",void 0),u([te({count:_t.COUNT})],Sr.prototype,"pbrMode",void 0),u([te({count:Fr.COUNT})],Sr.prototype,"normalType",void 0),u([te({count:Jo.COUNT})],Sr.prototype,"emissionSource",void 0),u([te()],Sr.prototype,"hasVertexColors",void 0),u([te()],Sr.prototype,"hasNormals",void 0),u([te()],Sr.prototype,"shadeNormals",void 0),u([te()],Sr.prototype,"hasSlicePlane",void 0),u([te()],Sr.prototype,"hasColorTexture",void 0),u([te()],Sr.prototype,"receiveAmbientOcclusion",void 0),u([te()],Sr.prototype,"receiveShadows",void 0),u([te()],Sr.prototype,"blendingEnabled",void 0),u([te()],Sr.prototype,"screenSpaceReflections",void 0),u([te()],Sr.prototype,"hasPolygonOffset",void 0),u([te()],Sr.prototype,"hasMetallicRoughnessTexture",void 0),u([te()],Sr.prototype,"hasOcclusionTexture",void 0),u([te()],Sr.prototype,"hasNormalTexture",void 0),u([te()],Sr.prototype,"hasOccludees",void 0),u([te()],Sr.prototype,"terrainDepthTest",void 0),u([te()],Sr.prototype,"cullAboveTerrain",void 0),u([te()],Sr.prototype,"hasNormalTextureTransform",void 0),u([te()],Sr.prototype,"cloudReflections",void 0),u([te()],Sr.prototype,"snowCover",void 0),u([te()],Sr.prototype,"objectAndLayerIdColor",void 0);function t0e(t,e){const i=t.fragment;switch(e.doubleSidedMode){case eo.None:i.code.add(E`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case eo.View:t.include(PR,e),i.code.add(E`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case eo.WindingOrder:i.code.add(E`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case eo.COUNT:}switch(e.normalType){case Fr.Attribute:case Fr.Compressed:t.include(Yj,e),i.main.add(E`vec3 fragmentFaceNormal = _adjustDoublesided(normalize(vNormalWorld));
vec3 fragmentFaceNormalView = gl_FrontFacing ? normalize(vNormalView) : -normalize(vNormalView);`);break;case Fr.ScreenDerivative:t.include(PR,e),i.main.add(E`vec3 fragmentFaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
vec3 fragmentFaceNormalView = normalize(cross(dFdx(vPosition_view), dFdy(vPosition_view)));`);default:case Fr.COUNT:}e.shadeNormals?i.main.add(E`vec3 fragmentShadingNormal = fragmentFaceNormal;`):e.spherical?(t.include(PR,e),i.main.add(E`vec3 fragmentShadingNormal = normalize(positionWorld());`)):i.main.add(E`vec3 fragmentShadingNormal = vec3(0.0, 0.0, 1.0);`)}function fOt(t,e){t.include(Xj,e),t.fragment.include(Ise);const i=t.fragment;i.uniforms.add(new i3("baseColor",r=>r.baseColor)),i.uniforms.add(new PPe("objectOpacity",r=>r.objectOpacity)),e.hasVertexColors?i.code.add(E`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):i.code.add(E`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),i.code.add(E`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function mOt(t,e){const i=e.hasColorTexture&&(_s(e.output)||e.alphaDiscardMode!==Dn.Opaque);i&&(t.include(Vj,e),t.fragment.uniforms.add(new Km("baseColorTexture",r=>r.texture))),t.fragment.code.add(E`
    vec4 readBaseColorTexture() {
      return ${i?"textureLookup(baseColorTexture, vuv0)":"vec4(1.0)"};
    }
  `)}function mke(t){const e=new ki,{vertex:i,fragment:r}=e;e.include(PR,t),e.include(Yj,t),e.include(Xj,t),e.include(Uy,t),e.include(Jj,t),e.include(Lht,t),e.include(Lpt,t),r.include(hpt,t),e.include(mOt,t),e.include(zD,t);const{output:s,pbrMode:n,hasNormalTexture:o,snowCover:a,receiveShadows:l,spherical:c,ellipsoidMode:h}=t,d=n===_t.Normal||n===_t.Schematic;d&&(e.include(nse,t),o&&e.include(NPe,t));const f=s===Y.Shadow||s===Y.ShadowHighlight||s===Y.ShadowExcludeHighlight,m=f&&t.componentData===km.Varying,y=t.integratedMeshMode===dd.ColorOverlay||t.integratedMeshMode===dd.ColorOverlayWithWater;if(y){e.include(j$,t),e.include(Rmt,t);const M=h===Bm.Earth,I=h===Bm.Earth,P=M?xi.radius:I?Kp.radius:rv.radius;i.code.add(`
      ${Se(c,`const float invRadius = ${E.float(1/P)};`)}
      vec2 projectOverlay(vec3 pos) { return pos.xy ${Se(c,"/ (1.0 + invRadius * pos.z);")}; }`)}const v=y&&_s(s)&&n===_t.WaterOnIntegratedMesh;v&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3"));const _=t.vertexDiscardMode===ad.None,b=t.vertexDiscardMode===ad.Opaque,w=1-1/255;if(i.main.add(E`
    bool castShadows;
    vec4 externalColor = forwardExternalColor(castShadows);
    ${Se(m,"if(!castShadows) { gl_Position = vec4(vec3(1e38), 1.0); return; }")}

    ${Se(!_,`{ if (externalColor.a ${b?">":"<="} ${E.float(w)}) { gl_Position = vec4(vec3(1e38), 1.0); return; } }`)}

    ${Se(s===Y.ObjectAndLayerIdColor,"externalColor.a = 1.0;")}

    forwardPosition(readElevationOffset());
    forwardViewPosDepth(vPosition_view);
    forwardNormal();
    forwardTextureCoordinates();
    forwardVertexColor();
    forwardLinearDepth();
    forwardObjectAndLayerIdColor();
    ${Se(v,c?E`
              groundNormal = normalize(positionWorld());
              tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
              tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:E`
              groundNormal = vec3(0.0, 0.0, 1.0);
              tbnTangent = vec3(1.0, 0.0, 0.0);
              tbnBiTangent = vec3(0.0, 1.0, 0.0);`)}
    ${Se(y,"setOverlayVTC(projectOverlay(position));")}

    if (externalColor.a < ${E.float(Yr)}) {
      // Discard this vertex
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    }
  `),_s(s))return e.include(fOt,t),e.include(t0e,t),e.include(j$,t),e.include(sG,t),l&&e.include(kD,t),r.code.add(E`
      float evaluateShadow() {
        return ${l?"readShadowMap(vPositionWorldCameraRelative, linearDepth)":"0.0"};
      }`),y&&r.uniforms.add(new $t("ovColorTex",(M,I)=>h3e(M,I))),r.main.add(E`
      discardBySlice(vPositionWorldCameraRelative);
      discardByTerrainDepth();

      vec4 textureColor = readBaseColorTexture();
      discardOrAdjustAlpha(textureColor);

      vec4 externalColor;
      int externalColorMixMode;
      readExternalColor(externalColor, externalColorMixMode);

      vec4 materialColor = computeMaterialColor(textureColor, externalColor, externalColorMixMode);
      ${Se(y,E`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`)}
    `),d?(mv(r),c&&V$(r),r.main.add(E`
        applyPBRFactors();
        ${Se(n===_t.Normal,E`if (externalColorMixMode == 3) {
              mrr = vec3(0.0, 0.6, 0.2);
            }`)}
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
        ${Se(o,"mat3 tangentSpace = computeTangentSpace(fragmentShadingNormal, vPositionWorldCameraRelative, vuv0);")}
        vec3 shadingNormal = ${o?"computeTextureNormal(tangentSpace, vuv0)":"fragmentShadingNormal"};
        vec3 normalGround = ${c?E`normalize(positionWorld())`:E`vec3(0.0, 0.0, 1.0)`};

        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * evaluateAmbientOcclusionInverse();
        ${Se(a,E`float snow = smoothstep(0.5, 0.55, dot(fragmentFaceNormal, normalize(positionWorld())));
                 materialColor.rgb = mix(materialColor.rgb, vec3(1.1), snow);
                 ssao = mix(ssao, 0.5 * ssao, snow);
                 shadingNormal = mix(shadingNormal, fragmentFaceNormal, snow);`)}
        ${Se(y,"materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;")}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 emission = getEmissions();
        ${Se(c,"float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());")}
        ${c?E`float shadow = max(lightingGlobalFactor * (1.0 - additionalAmbientScale), evaluateShadow());`:"float shadow = evaluateShadow();"}
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, shadow, ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(c&&V$(r),v&&r.uniforms.add(new so("ovNormalTex",M=>M.overlay?.getTexture(ir.WaterNormal))),r.main.add(E`
        ${Se(c,"float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());")}
        float shadow = ${l?c?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), evaluateShadow())":"evaluateShadow()":c?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        ${Se(a,E`float snow = smoothstep(0.5, 0.55, dot(fragmentFaceNormal, normalize(positionWorld())));
               materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)}

        // At global scale we create some additional ambient light based on the main light to simulate global illumination
        float ssao = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());

        ${Se(y,"materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;")}

        vec4 shadedColor = vec4(evaluateSceneLighting(fragmentShadingNormal, materialColor.rgb, shadow, ssao, additionalLight), materialColor.a);
        ${Se(v,E`vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
                 float waterNormalLength = length(overlayWaterMask);
                 if (waterNormalLength > 0.95) {
                   mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                   vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                   vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                   // un-gamma the ground color to mix in linear space
                   shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
                 }`)}
      `)),r.main.add("outputColorHighlightOID(shadedColor, vPositionWorldCameraRelative);"),e;const x=s===Y.Normal,S=s===Y.ObjectAndLayerIdColor,C=s===Y.Highlight,T=f||s===Y.ViewshedShadow;return T&&e.include(xse,t),x&&e.include(t0e,t),e.include(ND,t),r.main.add(E`
    discardBySlice(vPositionWorldCameraRelative);

    vec4 textureColor = readBaseColorTexture();
    discardOrAdjustAlpha(textureColor);

    ${Se(T,"outputDepth(linearDepth);")}
    ${Se(x,E`fragColor = vec4(vec3(0.5) + 0.5 * fragmentFaceNormalView, 1.0);`)}
    ${Se(S,y?"fragColor = getOverlayColorTexel();":"outputObjectAndLayerIdColor();")}
    ${Se(C,E`${Se(y,E`
           vec2 overlayHighlightTexel = getAllOverlayHighlightValuesEncoded();
           calculateOcclusionAndOutputHighlightOverlay(overlayHighlightTexel);`,E`calculateOcclusionAndOutputHighlight();`)}`)}`),e}const gOt=Object.freeze(Object.defineProperty({__proto__:null,build:mke},Symbol.toStringTag,{value:"Module"}));let yOt=class extends Bi{constructor(e,i){super(e,i,new Fi(gOt,()=>V(()=>Promise.resolve().then(()=>qGt),void 0)),gke)}initializePipeline(e){const{integratedMeshMode:i,output:r,blendingEnabled:s,cullFace:n,hasOccludees:o,hasPolygonOffset:a,oitPass:l}=e,c=i!==dd.None,h=l===bi.NONE,d=l===bi.FrontFace;return _i({blending:_s(r)&&s?cse(l):null,culling:WRe(n),depthTest:{func:hse(l)},depthWrite:h||d?DD:null,drawBuffers:r===Y.Depth?{buffers:[Va.NONE]}:Gj(l,r),colorWrite:Ai,stencilWrite:c||o?UU:null,stencilTest:c?lpt(oh.IntegratedMeshMaskExcluded):o?gse:null,polygonOffset:h||d?a?{factor:2,units:2}:null:use})}};const gke=new Map([[z.POSITION,0],[z.NORMAL,1],[z.NORMALCOMPRESSED,1],[z.COLOR,2],[z.UV0,3],[z.UVREGION,4],[z.COMPONENTINDEX,5]]);let vOt=class extends ar{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},doe=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function ys(t={}){return(e,i)=>{const r=e._parameterCount??0;if(e._parameterCount=r+1,t.vectorOps){const s=t.vectorOps;Object.defineProperty(e,i,{get(){return this[r]},set(n){const o=this[r];if(o==null)this[r]=[...n];else{if(s.equals(o,n))return;s.copy(o,n)}this._setDirty()}})}else Object.defineProperty(e,i,{get(){return this[r]},set(s){this[r]!==s&&(t.dispose&&this[r]&&this[r].dispose(),this[r]=s,this._setDirty())}})}}function i0e(){return(t,e)=>{const i=t._parameterCount??0;t._parameterCount=i+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(i),Object.defineProperty(t,e,{get(){return this[i]},set(r){this[i]!==r&&(this[i]=r,this._setDirty())}})}}let yke=class{constructor(e){this._low=$(),this._high=$(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){ne(this._low,ne(r0e,e));const i=Ri(r0e,e,this._low);ne(this._high,i)}get(e){return oe(e,this._low,this._high)}getLowScaled(e){return ie(e,this._low,1)}};const r0e=jc();let co=class extends vOt{constructor(e,i){super(),this.toMapSpace=i,this.baseColor=YP(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=zRe,this.emissiveFactor=hf(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.commonMaterialParameters=new w5,this.componentParameters=new XR,this.objectOpacity=1,this.textureAlphaCutoff=Yr,this.alphaDiscardMode=Dn.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=Bm.Earth,this.hasOccludees=!1;const r=new yke(e.position),s=mOe(e.rotationScale);_D(s,s),OA(s,s),this.transformNormalGlobalFromModel=s,this.transformWorldFromModelTL=r.low,this.transformWorldFromModelTH=r.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return this.baseColorTexture?.glTexture}get textureMetallicRoughness(){return this.metallicRoughnessTexture?.glTexture}get textureEmissive(){return this.emissionTexture?.glTexture}get hasEmissions(){return this.emissionTexture!=null||!Qn(this.emissiveFactor,on)}get textureOcclusion(){return this.occlusionTexture?.glTexture}get textureNormal(){return this.normalTexture?.glTexture}acquireTechnique(e,i,r,s){const n=new Sr(e.context.spherical,e.context.doublePrecisionRequiresObfuscation);n.hasVertexColors=s.colors,n.hasNormals=s.hasNormals,n.textureCoordinateType=s.textureCoordinates,n.hasMetallicRoughnessTexture=this.metallicRoughnessTexture!=null,n.hasOcclusionTexture=this.occlusionTexture!=null,n.hasNormalTexture=this.normalTexture!=null,n.oitPass=i.identifier===Ha.Material&&r.oitPass!=null?r.oitPass:bi.NONE,n.terrainDepthTest=i.identifier===Ha.Material&&r.terrainDepthTest,n.cullAboveTerrain=i.identifier===Ha.Material&&r.cullAboveTerrain,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?eo.View:eo.None,n.hasColorTexture=this.baseColorTexture!=null;const o=this._computeWhichMaterialPass();if(n.blendingEnabled=o===pl.Transparent||o===pl.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?wOt(r)?bOt(r)?dd.ColorOverlayWithWater:dd.ColorOverlay:dd.NoOverlay:dd.None,n.hasPolygonOffset=this.polygonOffsetEnabled,n.pbrMode=n.integratedMeshMode===dd.ColorOverlayWithWater?_t.WaterOnIntegratedMesh:this.usePBR?this.hasParametersFromSource?s.shadeNormals&&this.isIntegratedMesh?_t.Disabled:_t.Schematic:_t.Normal:_t.Disabled,n.emissionSource=this.emissionTexture!=null?Jo.Texture:n.pbrMode===_t.Normal?Jo.Value:Jo.None,n.shadeNormals=s.shadeNormals,n.normalType=n.hasNormals?Fr.Compressed:Fr.ScreenDerivative,n.hasSlicePlane=r.slicePlane!=null&&this.commonMaterialParameters.hasSlicePlane,i.identifier===Ha.ShadowMap)n.output=Y.Shadow,n.vertexDiscardMode=ad.None;else if(i.identifier===Ha.ViewshedShadowMap)n.output=Y.ViewshedShadow,n.vertexDiscardMode=ad.None;else if(i.identifier===Ha.Highlight)n.output=Y.Highlight,n.vertexDiscardMode=ad.None;else{switch(o===pl.OpaqueAndTransparent?n.vertexDiscardMode=i.transparent?ad.Opaque:ad.Transparent:n.vertexDiscardMode=ad.None,n.output=i.output,n.receiveAmbientOcclusion=n.receiveShadows=!1,i.output){case Y.Color:case Y.ColorEmission:n.receiveAmbientOcclusion=s.applySSAO&&r.ssao!=null,n.hasOccludees=r.hasOccludees,n.receiveShadows=r.shadowMap.ready,n.screenSpaceReflections=r.ssr.lastFrameColor!=null,n.cloudReflections=r.clouds.data!=null;break;case Y.ObjectAndLayerIdColor:n.objectAndLayerIdColor=!0}n.snowCover=this.hasSnowCover(r)}const a=e.get(yOt,n);return this._setClean(),a}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,i,r){if(this.objectOpacity<=0)return;const{componentData:s,renderable:n}=r,{geometry:o}=n,a=n.meta.cameraDepthSquared;s.updateHighlights(i.highlights);const{geometryRanges:l,highlightRangesMap:c,shadowmapRanges:h}=s;switch(this._computeWhichMaterialPass()){case pl.Opaque:e.opaque.submitDraw(this,o,l,a);break;case pl.Transparent:e.transparent.submitDraw(this,o,l,a);break;case pl.OpaqueAndTransparent:e.opaque.submitDraw(this,o,l,a),e.transparent.submitDraw(this,o,l,a);break;case pl.IntegratedMesh:e.integratedMesh.submitDraw(this,o,l,a),_Ot(i)&&e.highlightIntegratedMesh.submitDraw(this,o,l,a)}if(this.componentParameters.castShadows!==Rn.None){if(c!=null)for(const d of c)d[0]===Dm&&e.highlightShadowMap.submitDraw(this,o,d[1],a,d[0]);h!=null&&e.nonHighlightShadowMap.submitDraw(this,o,h,a),e.shadowMap.submitDraw(this,o,l,a)}if(c!=null)for(const d of c)e.highlight.submitDraw(this,o,d[1],a,d[0]);i.viewshedEnabled&&e.viewshedShadowMap.submitDraw(this,o,l,a)}_computeWhichMaterialPass(){if(this.isIntegratedMesh)return pl.IntegratedMesh;if(this.objectOpacity<1)return pl.Transparent;if(this.componentParameters.opaqueOverride===Rn.All)return pl.Opaque;if(this.baseColor[3]<1||this.alphaDiscardMode===Dn.Blend||this.alphaDiscardMode===Dn.MaskBlend)return pl.Transparent;switch(this.componentParameters.transparent){case Rn.None:return pl.Opaque;case Rn.All:return pl.Transparent;case Rn.Some:return pl.OpaqueAndTransparent}}};var pl,Rn;u([ys({vectorOps:ROe})],co.prototype,"baseColor",void 0),u([ys()],co.prototype,"usePBR",void 0),u([ys()],co.prototype,"hasParametersFromSource",void 0),u([ys({vectorOps:ahe})],co.prototype,"mrrFactors",void 0),u([ys({vectorOps:ahe})],co.prototype,"emissiveFactor",void 0),u([ys({dispose:!0})],co.prototype,"baseColorTexture",void 0),u([ys({dispose:!0})],co.prototype,"metallicRoughnessTexture",void 0),u([ys({dispose:!0})],co.prototype,"emissionTexture",void 0),u([ys({dispose:!0})],co.prototype,"occlusionTexture",void 0),u([ys({dispose:!0})],co.prototype,"normalTexture",void 0),u([i0e()],co.prototype,"commonMaterialParameters",void 0),u([i0e()],co.prototype,"componentParameters",void 0),u([ys()],co.prototype,"objectOpacity",void 0),u([ys()],co.prototype,"textureAlphaCutoff",void 0),u([ys()],co.prototype,"alphaDiscardMode",void 0),u([ys()],co.prototype,"isIntegratedMesh",void 0),u([ys()],co.prototype,"polygonOffsetEnabled",void 0),u([ys()],co.prototype,"ellipsoidMode",void 0),u([ys()],co.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(pl||(pl={}));let w5=class extends doe{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=Tl.Back,this.hasSlicePlane=!0}};u([ys()],w5.prototype,"doubleSided",void 0),u([ys()],w5.prototype,"cullFace",void 0),u([ys()],w5.prototype,"hasSlicePlane",void 0);let XR=class extends doe{constructor(){super(...arguments),this.externalColor=Gi(1,1,1,1),this.externalColorMixMode=Ln.Multiply,this.castShadows=Rn.All}get transparent(){return this.externalColor[3]<1?Rn.All:Rn.None}get opaqueOverride(){return this.externalColorMixMode===Ln.Replace&&this.externalColor[3]===1?Rn.All:Rn.None}get visible(){return this.externalColor[3]>0?Rn.All:Rn.None}get type(){return km.Uniform}};u([ys({vectorOps:ROe})],XR.prototype,"externalColor",void 0),u([ys()],XR.prototype,"externalColorMixMode",void 0),u([ys()],XR.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(Rn||(Rn={}));let AI=class extends doe{constructor(){super(...arguments),this.texture=null,this.transparent=Rn.None,this.opaqueOverride=Rn.None,this.castShadows=Rn.None}get type(){return km.Varying}};function _Ot(t){return t.overlay?.getTexture(ir.Highlight)!=null}function bOt(t){return t.overlay?.getTexture(ir.WaterNormal)!=null}function wOt(t){return t.overlay?.getTexture(ir.ColorNoRasterImage)!=null}u([ys()],AI.prototype,"texture",void 0),u([ys()],AI.prototype,"transparent",void 0),u([ys()],AI.prototype,"opaqueOverride",void 0),u([ys()],AI.prototype,"castShadows",void 0);let xOt=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},SOt=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this.textureWidth=4096,this._dirty=!0;const r=new $r(this.textureWidth,1);r.samplingMode=di.NEAREST,r.wrapMode=nr.CLAMP_TO_EDGE,this._texture=new yi(this._rctx,r),this._data=new Qm(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,i,r,s,n,o){const a=e*this._fieldCount+i;this._dirty=!0,this._data.set(a,0,r),this._data.set(a,1,s),this._data.set(a,2,n),this._data.set(a,3,o)}setDataElement(e,i,r,s){const n=e*this._fieldCount+i;this._dirty=!0,this._data.set(n,r,s)}getDataElement(e,i,r){const s=e*this._fieldCount+i;return this._dirty=!0,this._data.get(s,r)}resizeToFit(e){const i=(e+1)*this._fieldCount;if(i>this._data.count){const r=Math.ceil(i/this.textureWidth)*this.textureWidth,s=new Qm(new ArrayBuffer(4*r));s.typedBuffer.set(this._data.typedBuffer),this._data=s}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,i=this._texture.descriptor.height;this._data.count>e*i&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const vke=65536;let TOt=class{constructor(e,i=1){this.textureBuffer=new SOt(e,i),this._indexManager=new xOt(vke)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},EOt=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const r of this._buffers)if(r.availableCount>=e)return r;if(e>vke)return null;const i=new TOt(this._rctx,this._fieldCount);return this._buffers.push(i),i}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const UF=()=>J.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");let COt=class{constructor(e,i){this._renderManager=e,this._viewingMode=i,this._elevationRangeCacheVerticalOffset=NaN,this._elevationRangeCacheMin=NaN,this._elevationRangeCacheMax=NaN,this._activeHighlightOptions=new Map,this._visible=new Jt,this._hidden=new Jt,this._renderSubmit=new hOt(this),this._renderManager.register(this._renderSubmit),this._componentBufferManager=new EOt(e.rctx,2+(Md()?1:0))}destroy(){jt(this._hidden.length===0&&this._visible.length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy(),this._visible.forAll(e=>e.destroy()),this._hidden.forAll(e=>e.destroy()),this._visible.clear(),this._hidden.clear()}createObject(e){const i=e.geometry,r=new EMt(this._componentBufferManager,lS(i.componentOffsets)),s=this._createRenderable(e,r),n=new XMt(this._viewingMode,i.positionData,r),o=new $Mt(e.transform,e.toMapSpace,e.obb.clone(),r,s,n);return(o.visible?this._visible:this._hidden).push(o),o}destroyObject(e){const i=e;(i.visible?this._visible:this._hidden).removeUnordered(i),i.destroy(),this._notifyDirty()}setObjectVisibility(e,i){const r=e;i!==r.visible&&(i?(this._hidden.removeUnordered(r),this._visible.push(r)):(this._visible.removeUnordered(r),this._hidden.push(r)),r.visible=i,this._notifyDirty())}preSubmit(e){const i=e.camera.eye;this.visibleObjects.forAll(r=>r.renderable.meta.cameraDepthSquared=ro(i,r.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,i){const r=e.renderable.material;i(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,i){const r=e;r.componentData.visibility.reset(i),r.componentData.markVisibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,i){return e.componentData.visibility.forEachComponent(i)}getComponentCount(e){const i=e,r=i.componentData.visibility.componentCount;return{visible:r,invisible:i.componentData.count-r}}setComponentData(e,i){const r=e,{renderable:s,componentData:n}=r,o=s.material,a=n.materialDataBuffer,l=n.materialDataIndices,c=new pOt,h=a.textureBuffer,d=new Uint8Array(4),f=new Uint32Array(d.buffer);let m=0,y=0,v=0,_=n.verticalOffsets,b=1/0,w=-1/0,x=!1,S=!1,C=0;for(let T=0;T<n.count;T++){i(T,c),m+=+(c.externalColor[3]<1),y+=+(c.externalColorMixMode===Ln.Replace&&c.externalColor[3]===1),v+=+c.castShadows,Eht(c.externalColor,c.externalColorMixMode,d),d[2]=254&d[2]|+c.castShadows,h.setData(l[T],0,d[0],d[1],d[2],d[3]),x||=T>0&&C!==f[0],C=f[0],S||=c.elevationOffset!==0,S&&_==null&&(_=new Array(T).fill(0)),_!=null&&(_[T]=c.elevationOffset),b=Math.min(b,c.elevationOffset),w=Math.max(w,c.elevationOffset),Dht(c.elevationOffset,d),h.setData(l[T],1,d[0],d[1],d[2],d[3]);const M=c.objectAndLayerIdColor;M!=null&&h.setData(l[T],2,M[0],M[1],M[2],M[3]),c.pickable!==ZX(n.pickability,T)&&(n.pickability=kMt(n.pickability,n.count,T,c.pickable))}n.verticalOffsets=S?_:null,r.offsetObb=S?hRe(r.obb,b,w,this._viewingMode,r.offsetObb??r.obb.clone()):null,x||S||Md()?(o.componentParameters=new AI,o.componentParameters.castShadows=Lq(v,n.count),o.componentParameters.transparent=Lq(m,n.count),o.componentParameters.opaqueOverride=Lq(y,n.count),o.componentParameters.texture=h,h.updateTexture()):(o.componentParameters=new XR,o.componentParameters.castShadows=c.castShadows?Rn.All:Rn.None,o.componentParameters.externalColor=c.externalColor,o.componentParameters.externalColorMixMode=c.externalColorMixMode),this._elevationRangeCacheVerticalOffset=NaN,this._notifyDirty()}getComponentAabb(e,i,r,s=!1){e.intersectionGeometry.getComponentAabb(i,r);const n=e,o=n.componentData.verticalOffsets;if(s||o==null)return r;const a=o[i];if(this._viewingMode===Be.Local||a===0)return r[2]+=a,r[5]+=a,r;const l=qde(a);return l.localOrigin=n.transform.position,l.applyToAabb(r)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,i,r){return e.intersectionGeometry.getComponentPositions(i,r)}expandRangeWithComponentObjectElevationRange(e,i,r,s){Number.isNaN(this._elevationRangeCacheVerticalOffset)||this._elevationRangeCacheVerticalOffset!==i||s.expandElevationRangeValues(this._elevationRangeCacheMin,this._elevationRangeCacheMax);const n=e,o=n.componentData,a=o.count,l=o.verticalOffsets,c=n.intersectionGeometry,h=this._viewingMode===Be.Local,d=c.getComponentAabbs(),f=AOt;let m=1/0,y=-1/0;for(let v=0;v<a;v++){const _=6*v,b=l?.[v]??0;let w=1/0,x=-1/0;if(h)w=d[_+2]+b+i,x=d[_+5]+b+i;else{if(f[0]=d[_],f[1]=d[_+1],f[2]=d[_+2],f[3]=d[_+3],f[4]=d[_+4],f[5]=d[_+5],b!==0){const M=qde(b);M.localOrigin=n.transform.position,M.applyToAabb(f)}const S=Math.max(Math.abs(f[3]),Math.abs(f[0])),C=Math.max(Math.abs(f[4]),Math.abs(f[1])),T=i+f[5]+r;s.expandElevationRangeValues(i+f[2],Math.sqrt(S*S+C*C+T*T)-r)}s.expandElevationRangeValues(w,x),m=Math.min(m,w),y=Math.max(y,x)}this._elevationRangeCacheVerticalOffset=i,this._elevationRangeCacheMin=m,this._elevationRangeCacheMax=y}intersect(e,i,r,s,n,o,a){const l=e,{transform:c}=l,{position:h}=c;return n!=null&&(n.localOrigin=h),l.intersectionGeometry.intersect(i,r,s,n,l.componentData.verticalOffsets,c,o,a)}addEdges(e,i,r,s,n){const o=e,{indices:a,positions:l}=o.intersectionGeometry,c=o.componentData.offsets;return i.addComponentObject(o,l,a,c,r,s,n)}async extractEdgeInformation(e,i,r){const s=e,n=s.componentData.visibility;if(n.allInvisible()){const{extractComponentsEdgeLocationsLayout:m}=await V(()=>import("./edgeProcessing-4i7zt-YS.js").then(y=>y.e),__vite__mapDeps([33,32]));return{buffer:m.createBuffer(0),origin:[0,0,0]}}const{indices:o,positions:a}=s.intersectionGeometry,l=s.componentData.offsets,{EdgeInputBufferLayout:c}=await V(async()=>{const{EdgeInputBufferLayout:m}=await import("./bufferLayouts-DagIujEF.js");return{EdgeInputBufferLayout:m}},[]),h=c.createBuffer(a.length/3);hoe(h.position.typedBuffer,a,h.position.typedBufferStride,3),hIe(h.position,h.position,s.transform.rotationScale),this._setComponentIndices(h.componentIndex,o,l);const d=h.count,f=this._computeVisibilityIndices(o,n,l,d);return{origin:is(s.transform.position),buffer:await i.extractComponentsEdgeLocations({indices:f,indicesLength:f.length,skipDeduplicate:!0,data:h,writerSettings:{reducedPrecision:!1,variants:0}},r)}}_setComponentIndices(e,i,r){let s=0;for(let n=0;n<r.length-1;n++){const o=r[n],a=r[n+1];for(let l=o;l<a;l++){const c=i?i[l]:l;e.set(c,s)}s++}}_computeVisibilityIndices(e,i,r,s){if(e&&i.allVisible())return e;let n=0;i.forEachComponentRange((l,c)=>(n+=r[c]-r[l],!0));const o=j3(e)?e?.BYTES_PER_ELEMENT===2||s<=65536?new Uint16Array(n):new Uint32Array(n):new Array(n);let a=0;return i.forEachComponentRange((l,c)=>{const h=r[l],d=r[c];for(let f=h;f<d;f++)o[a++]=e?e[f]:f;return!0}),o}addComponentHighlight(e,i,r){const s=e.componentData,n=zb(s.componentHighlights,r,()=>new Uint32Array(s.count+1));{const o=this._activeHighlightOptions.get(r)??0;this._activeHighlightOptions.set(r,o+1)}n[i]++===0&&(s.markHighlightsDirty(),this._notifyDirty()),n[s.count]++}removeComponentHighlight(e,i,r){const{componentData:s}=e,n=s.componentHighlights.get(r);if(n===void 0)return void UF().warn("Removing non-existing highlight.");const o=n[i];if(o===0)return void UF().warn("Removing non-existing highlight.");this._removeActiveHighlight(r);const a=n[s.count];if(o>1)return n[i]=o-1,void(n[s.count]=a-1);n[i]=0,a===1?s.componentHighlights.delete(r):n[s.count]=a-1,s.markHighlightsDirty(),this._notifyDirty()}_removeActiveHighlight(e,i=1){const r=this._activeHighlightOptions.get(e);if(r===void 0)UF().warn("Removing non-existing highlight.");else{const s=r-i;s<0&&UF().warn("Removing non-existing highlight."),s<=0?this._activeHighlightOptions.delete(e):this._activeHighlightOptions.set(e,s)}}clearHighlights(e){const{componentData:i}=e,{componentHighlights:r}=i;if(r.size>0){for(const s of r)this._removeActiveHighlight(s[0],s[1][i.count]);r.clear(),i.markHighlightsDirty(),this._notifyDirty()}}hasHighlightOptions(e){return this._activeHighlightOptions.has(e)}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._visible}_createRenderable(e,i){const r=this._renderManager.rctx,s=e.geometry,n=s.vertices.layoutParameters,o=Un.createVertex(r,Zs.STATIC_DRAW,s.vertices.data),a=s.indices?Un.createIndex(r,Zs.STATIC_DRAW,s.indices):null,l=Fv(dOt(n)),c=new Uint16Array(s.vertices.count);for(let v=0;v<i.count;v++){const _=i.offsets[v],b=i.offsets[v+1],w=i.materialDataIndices[v];if(s.indices!=null)for(let x=_;x<b;x++)c[s.indices[x]]=w;else for(let x=_;x<b;x++)c[x]=w}const h=Un.createVertex(r,Zs.STATIC_DRAW,c.buffer),d=new co(e.transform,e.toMapSpace),f=new VD(r,gke,new Map([["data",l],["componentIndices",$Ot]]),new Map([["data",o],["componentIndices",h]]),a),m=new sOt(f,Ui.TRIANGLES,n,a!=null),y={cameraDepthSquared:.5,gpuMemoryEstimate:o.usedMemory+h.usedMemory+(a!=null?a.usedMemory:0)};return new rOt(d,m,y)}_notifyDirty(){this._renderManager.notifyDirty()}};const $Ot=Fv(Nd().u16(z.COMPONENTINDEX));function Lq(t,e){return t===e?Rn.All:t===0?Rn.None:Rn.Some}const AOt=ch();let MOt=class{constructor(e,i,r,s,n){this.rctx=e,this.viewingMode=i,this.stippleTextures=r,this.waterTextures=s,this.markerTextures=n}get spherical(){return this.viewingMode===Be.Global}get doublePrecisionRequiresObfuscation(){return this.rctx.driverTest.doublePrecisionRequiresObfuscation.result}},OOt=class{constructor(e){this.context=e,this._debug=!1,this._precompiling=this._debug?0:1,this._cache=new yv}get precompiling(){return this._precompiling}set precompiling(e){this._precompiling=e,e===0&&this.context.rctx.gl.flush()}get viewingMode(){return this.context.viewingMode}destroy(){this._cache.forAll(e=>e.destroy()),this._cache.clear()}precompile(e,i=s0e){++this.precompiling,this.get(e,i),--this.precompiling}get(e,i=s0e){const r=i.key.code;let s=this._cache.get(e,r);if(s==null){if(this._precompiling===0){let n=`Uncached shader compile in ${new Error().stack}
  for configuration
${i.decode()}`;const o=this._cache.getInner(e);throw o?.size&&(n+=`

  cached configurations:
`,n+=Array.from(o.values()).map(a=>i.decode(a.key)).sort().join(`

`)),console.log(n),new U(n)}s=new e(this.context,i),this._cache.set(e,r,s)}return s}async reloadAll(){const e=new Array;this._cache.forEach(i=>e.push(IOt(i))),await Promise.all(e)}};async function IOt(t){let e=!0;t.forEach(async i=>{await i.reload(e),e=!1})}const s0e=new ou;let MI=class extends xf{constructor(e){super(e),this.consumes={required:["olid"]},this.produces="olid"}destroy(){}render(e){const i=e.find(({name:s})=>s==="olid"),r=this.renderingContext;return r.bindFramebuffer(i.fbo),r.clearFramebuffer(sn,!0,!0),this.view._stage.renderer.renderAllGeometry(Y.ObjectAndLayerIdColor),r.clear(Si.DEPTH|Si.STENCIL),this.view._stage.renderer.renderHUD(da.NotOccluded),i}};u([p()],MI.prototype,"consumes",void 0),u([p()],MI.prototype,"produces",void 0),MI=u([A("esri.views.3d.webgl-engine.effects.geometry.ObjectAndLayerIDRenderNode")],MI);var ya;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.Depth=3]="Depth",t[t.COUNT=4]="COUNT"})(ya||(ya={}));let EB=class extends ou{constructor(){super(...arguments),this.blitMode=ya.None,this.hasOpacityFactor=!1}};u([te({count:ya.COUNT})],EB.prototype,"blitMode",void 0),u([te()],EB.prototype,"hasOpacityFactor",void 0);let AG=class extends ar{constructor(){super(...arguments),this.opacity=1}};function _ke(t){const e=new ki;e.include(ea),e.fragment.uniforms.add(new $t("tex",r=>r.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new pt("opacity",r=>r.opacity));const i=t.blitMode===ya.Depth;return i&&(e.fragment.uniforms.add(new fv("nearFar",r=>r.camera.nearFar)),e.fragment.include(fg),e.fragment.include(Zb)),e.fragment.main.add(E`
    ${i?E`
          float normalizedLinearDepth = (-linearDepthFromTexture(tex, uv) - nearFar[0]) / (nearFar[1] - nearFar[0]);
          fragColor = float2rgba(normalizedLinearDepth);`:E`
          fragColor = texture(tex, uv) ${t.hasOpacityFactor?"* opacity":""};`}`),e}const ROt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:AG,build:_ke},Symbol.toStringTag,{value:"Module"}));let L_=class extends Bi{constructor(e,i){super(e,i,new Fi(ROt,()=>V(()=>Promise.resolve().then(()=>WGt),void 0)))}initializePipeline(e){switch(e.blitMode){case ya.None:case ya.Depth:return _i({colorWrite:Ai});case ya.Alpha:return _i({blending:Od,colorWrite:Ai});default:e.blitMode;case ya.PremultipliedAlpha:case ya.COUNT:return _i({blending:NA,colorWrite:Ai})}}},bke=class{constructor(e,i=ya.None){this._techniques=e,this._parameters=new AG,this._configuration=new EB,this._configuration.blitMode=i,e.precompile(L_,this._configuration)}blit(e,i,r,s){e.bindFramebuffer(r.fbo),e.setClearColor(0,0,0,1),e.clear(Si.COLOR),this._parameters.texture=i.getTexture();const n=this._techniques.get(L_,this._configuration);e.bindTechnique(n,s,this._parameters),e.screen.draw()}blend(e,i,r,s,n=1){this._configuration.hasOpacityFactor=n<1;const o=this._techniques.get(L_,this._configuration);return!!o.compiled&&(e.bindFramebuffer(r.fbo),this._parameters.texture=i.getTexture(),this._parameters.opacity=n,e.bindTechnique(o,s,this._parameters),e.screen.draw(),!0)}},OI=class extends xf{constructor(e){super(e),this.consumes={required:[ut.OCCLUDED]},this.produces=ut.OCCLUDED,this._blit=new bke(e.view._stage.renderView.techniques,ya.PremultipliedAlpha)}precompile(){const e=this.view._stage.renderer;e.plugins.plugins.forAll(i=>{e.precompileSlots(i,be.OCCLUDED_TERRAIN,be.TRANSPARENT_OCCLUDER_MATERIAL),i.material&&e.precompileOccludedSlots(i,n0e)})}render(e){const i=e.find(({name:n})=>n===this.produces),r=this.view._stage.renderer;let s=0;if(Ng.clear(),r.plugins.plugins.forAll(n=>{n.material&&n.queryRenderOccludedState(Er.OccludeAndTransparentStencil)&&(s|=Er.OccludeAndTransparentStencil,Ng.push(n))}),Ng.length>0&&(r.renderSlots(Ng,be.OCCLUDER_MATERIAL),s&Er.OccludeAndTransparentStencil&&this._renderAndComposite(i,.5,()=>r.renderSlots(Ng,be.TRANSPARENT_OCCLUDER_MATERIAL),!1,!1)),Ng.clear(),r.plugins.plugins.forAll(n=>{if(!n.material)return;const o=n.queryRenderOccludedState(Er.OccludeAndTransparent),a=n.queryRenderOccludedState(Er.Transparent),l=n.queryRenderOccludedState(Er.Opaque);(o||a||l)&&(s|=o?Er.OccludeAndTransparent:a?Er.Transparent:Er.Opaque,Ng.push(n))}),s|=r.plugins.renderOccludedFlags,!s)return i;for(const n of n0e)s&n&&this._renderAndComposite(i,n===Er.Opaque?1:.5,()=>r.renderOccludedSlots(Ng,n),!0,oh.OutlineVisualElementMask);return Ng.clear(),i}_renderAndComposite(e,i,r,s,n){const o=this.renderingContext,{width:a,height:l}=e.fbo,c=this.fboCache.acquire(a,l,"tmp color"),h=s?this.fboCache.acquireDepth(jo.DEPTH_STENCIL_TEXTURE,a,l,"tmp depth"):e.getAttachment(nS);c.attachDepth(h),o.bindFramebuffer(c.fbo),o.clearFramebuffer(sn,s,n),r(),c.detachDepth(),this._blit.blend(o,c,e,this.bindParameters,i),s&&h.release(),c.release()}};u([p()],OI.prototype,"consumes",void 0),u([p()],OI.prototype,"produces",void 0),OI=u([A("esri.views.3d.webgl-engine.effects.geometry.RenderOccludedRenderNode")],OI);const Ng=new Jt,n0e=[Er.OccludeAndTransparent,Er.Transparent,Er.Opaque];let poe=class extends ar{};function wke(){const t=new ki;return t.include(ea),t.fragment.uniforms.add(new $t("colorTexture",e=>e.color),new so("depthTexture",e=>e.mainDepth)),t.fragment.main.add(E`float depthSample = texture(depthTexture, uv).r;
if (depthSample == 1.0 ) {
fragColor = vec4(0);
return;
}
fragColor = texture(colorTexture, uv);`),t}const POt=Object.freeze(Object.defineProperty({__proto__:null,HazeCompositingPassParameters:poe,build:wke},Symbol.toStringTag,{value:"Module"}));let o0e=class extends Bi{constructor(e,i){super(e,i,new Fi(POt,()=>V(()=>Promise.resolve().then(()=>ZGt),void 0)))}initializePipeline(){return _i({blending:Yb(Ft.ONE,Ft.ZERO,Ft.ONE_MINUS_SRC_COLOR,Ft.ONE),depthTest:{func:Ni.ALWAYS},colorWrite:Ai})}};function xke(t){const e=new ki,{fragment:i}=e;e.include(CG),eg(i),e.include(UD),i.include(fg),i.include(uG),i.include(oG),i.include(ske,!0),i.uniforms.add(new so("depthTexture",s=>s.mainDepth),new pt("hazeStrength",s=>s.hazeStrength));const{reduced:r}=t;return r&&i.code.add(E`float getDepth(vec2 uv){
return linearDepthFromTexture(depthTexture, uv);
}
float textureBilinear(vec2 uv) {
vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
vec2 texelSize = 1.0 / depthTextureSize;
vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);
vec2 f = fract(depthUV);
vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;
float d0 = getDepth(snapUV);
float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
float d3 = getDepth(snapUV + texelSize);
return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
}`),i.main.add(E`
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture(depthTexture, uv).r;
      if (depthSample != 1.0) {
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;

        cameraSpaceRay *= ${Se(r,"-textureBilinear(uv)","-linearDepthFromTexture(depthTexture, uv)")};
        terrainDepth = max(0.0, length(cameraSpaceRay));
      } else {
        discard;
      }

      // Alpha is ignored for haze blending
      vec3 col = vec3(0);
      float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
      if(depthSample != 1.0){
        col = (1.0 - fadeOut) * hazeStrength * raymarchAtmosphere(cameraPosition, rayDir, mainLightDirection, terrainDepth);
      }
      float alpha = 1.0;

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
  `),e}const DOt=Object.freeze(Object.defineProperty({__proto__:null,build:xke},Symbol.toStringTag,{value:"Module"}));let LOt=class extends rke{constructor(){super(...arguments),this.hazeStrength=1}},Nq=class extends Bi{constructor(e,i){super(e,i,new Fi(DOt,()=>V(()=>Promise.resolve().then(()=>YGt),void 0)))}initializePipeline(e){return e.reduced?_i({blending:ase,depthTest:{func:Ni.ALWAYS},colorWrite:Ai}):_i({blending:Yb(Ft.ONE,Ft.ZERO,Ft.ONE_MINUS_SRC_COLOR,Ft.ONE),colorWrite:Ai})}},x5=class extends ou{constructor(){super(...arguments),this.reduced=!1}};u([te()],x5.prototype,"reduced",void 0);let YX=class extends JR{constructor(e){super(e),this._compositingPassParameters=new poe,this._passParameters=new LOt,this._hazeConfiguration=new x5,this._vao=null,this.requireGeometryDepth=!0,this._oldAmount=1,this._newAmount=1,this._amount=this._newAmount;const i=e.view._stage.renderView.techniques;i.precompile(Nq,new x5);const r=new x5;r.reduced=!0,i.precompile(Nq,r),i.precompile(o0e)}initialize(){this.addHandles([H(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),St),H(()=>this.view._stage?.renderer.renderContext.bind.clouds.fadeFactor??1,e=>this._fade(e),St),H(()=>this.view.environment.weather.type,e=>this._newAmount=e==="rainy"?0:1,St),H(()=>this.view._stage.renderer?.fullResolutionAtmosphere,e=>this._hazeConfiguration.reduced=!e,St)])}_fade(e){e>=1?(this._amount=this._newAmount,this._oldAmount=this._newAmount):this._amount=e<=0?this._oldAmount:dt(this._oldAmount,this._newAmount,e)}destroy(){this._vao=Rt(this._vao)}render(e){const i=e.find(({name:v})=>v===ut.TRANSPARENT_ENVIRONMENT);if(!this.bindParameters.mainDepth)return i;const r=this.renderingContext;this._vao??=Qb(r,ig.Pos2Tex);const s=this.techniques.get(Nq,this._hazeConfiguration);if(!s.compiled)return i;const n=i.getAttachment(r.gl.DEPTH_STENCIL_ATTACHMENT);if(this._update(),!this._hazeConfiguration.reduced)return i.detachDepth(),r.bindFramebuffer(i.fbo),r.bindTechnique(s,this.bindParameters,this._passParameters),this._renderCommon(r),i.attachDepth(n),i;const o=this.techniques.get(o0e);if(!o.compiled)return i;const a=r.getViewport(),l=this.camera,c=Te(l.eye)-xi.radius;let h;const d=xi.atmosphereHeight;if(c<d){const v=Math.min(1,Math.max(0,c/d));h=dt(.4,.5,v)}else{const v=Math.min(1,Math.max(0,(c-d)/(15*d)));h=dt(.5,1,v)}const f=Jy(Math.round(h*l.fullViewport[2])),m=Jy(Math.round(h*l.fullViewport[3]));r.setViewport(0,0,f,m);const y=this.fboCache.acquire(f,m,"haze",fr.RGBA);return r.bindFramebuffer(y.fbo),r.clearFramebuffer([0,0,0,1],!0,!0),r.bindTechnique(s,this.bindParameters,this._passParameters),this._renderCommon(r),r.setViewport(a.x,a.y,a.width,a.height),this._compositingPassParameters.color=y.getTexture(),i.detachDepth(),r.bindFramebuffer(i.fbo),r.bindTechnique(o,this.bindParameters,this._compositingPassParameters),r.screen.draw(),i.attachDepth(n),y.release(),i}_renderCommon(e){this._vao!=null&&(e.bindVAO(this._vao),e.drawArrays(Ui.TRIANGLE_STRIP,0,4))}_update(){const e=this.bindParameters.camera,i=Yo(e.eye),r=Math.sqrt(i),s=i-this._passParameters.radii[1]*this._passParameters.radii[1],n=ce((r-this._passParameters.radii[0])/xi.atmosphereHeight,0,1);es(this._passParameters.heightParameters,r,i,s,n);const o=this.view.basemapTerrain?.getLowerBoundRadius()??0;li(this._passParameters.radii,o,o+xi.atmosphereHeight),this._passParameters.hazeStrength=dt(dt(.6,1,CP(9500,10500,r-xi.radius)),1,this._amount)}};YX=u([A("esri.views.3d.webgl-engine.effects.haze.Haze")],YX);function NOt(t){const e=t.fragment;t.include(eG),e.include(fg),e.code.add(E`vec3 normalFromDepth(sampler2D depthMap, vec3 pixelPos, vec2 fragCoord, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthMap, 0)));
float leftPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(-1, 0), 0).r);
float rightPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(1, 0), 0).r);
float bottomPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(0, -1), 0).r);
float topPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(0, 1), 0).r);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`)}let foe=class extends ou{constructor(){super(...arguments),this.receiveShadows=!0}};u([te()],foe.prototype,"receiveShadows",void 0);const FOt=.025;function Ske(){const t=new ki;t.include(kD,kOt),t.include(ea),t.include(NOt);const e=t.fragment;return e.include(Zb),e.uniforms.add(new so("defaultDepthTex",i=>i.shadowMap.getSnapshot(pS.ExcludeHighlight)),new so("highlightDepthTex",i=>i.shadowMap.getSnapshot(pS.Highlight)),new so("depthMap",i=>i.depth?.attachment),new $t("highlightTexture",i=>i.highlight),new uc("uColor",i=>i.shadowColor),new pt("opacity",i=>i.shadowOpacity),new pt("occludedOpacity",i=>i.occludedShadowOpacity),new pt("terminationFactor",i=>i.opacityElevation*i.dayNightTerminator),new Ja("lightingMainDirectionView",({lighting:i,camera:r})=>ae(l0e,st(l0e,i.mainLight.direction,r.viewInverseTransposeMatrix))),new Co("inverseViewMatrix",({camera:i})=>Sl(a0e,nh(a0e,i.viewMatrix,i.center)))).main.add(E`
    ivec2 highlightTextureSize = textureSize(highlightTexture, 0);
    ivec2 highlightIUV = ivec2(uv * vec2(highlightTextureSize));
    vec4 highlightInfo = texelFetch(highlightTexture, highlightIUV, 0);

    fragColor = vec4(0.0);

    // Calculate bit mask to check if pixel is highlit unoccluded at any level
    int ored =
         (int(highlightInfo.r*255.0) << 0)
       | (int(highlightInfo.g*255.0) << 8);
    bool visiblyHighlighted = ((ored & ~(ored >> 1)) & (1+4+16+64)) != 0;
    if (visiblyHighlighted) {
      return;
    }

    // 1.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
    float depth = depthFromTexture(depthMap, uv);
    if (depth >= 1.0 || depth <= 0.0) {
      return;
    }

    float currentPixelDepth = linearizeDepth(depth);
    vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
    vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;

    mat4 shadowMatrix;
    float linearDepth = -currentPixelDepth;
    int i = chooseCascade(linearDepth, shadowMatrix);
    if (i >= numCascades) {
      return;
    }

    // vertex completely outside? -> no shadow
    vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
    if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
      return;
    }

    ivec2 texSize = textureSize(highlightDepthTex, 0);
    ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));

    float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
    bool shadowHighlight = depthHighlight < lvpos.z;
    if (!shadowHighlight) {
      return;
    }

    float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
    bool shadowDefault = depthDefault < lvpos.z;

    vec3 normal = normalFromDepth(depthMap, currentPixelPos.xyz, gl_FragCoord.xy, uv);
    bool shaded = dot(normal, lightingMainDirectionView) < ${E.float(FOt)};

    float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
    fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
  `),t}const a0e=Ve(),l0e=$(),kOt=new foe,zOt=Object.freeze(Object.defineProperty({__proto__:null,build:Ske},Symbol.toStringTag,{value:"Module"}));let UOt=class extends Mse{constructor(){super(...arguments),this.shadowColor=Gi(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},c0e=class extends Bi{constructor(e,i){super(e,i,new Fi(zOt,()=>V(()=>Promise.resolve().then(()=>JGt),void 0))),this.primitiveType=Ui.TRIANGLE_STRIP}initializePipeline(){return _i({blending:Od,colorWrite:Ai,depthTest:null,depthWrite:null})}};const BOt=1/512,VOt=4e4,jOt=5e4;let ZE=class extends xf{constructor(e){super(e),this.produces=tr.COMPOSITE,this.consumes={required:[tr.COMPOSITE,"highlights"]},this._passParameters=new UOt,this._maxOpacity=1,this._shadowDifference=.2}initialize(){this.addHandles([H(()=>this.view.highlightOptions.shadowOpacity,e=>{this._passParameters.shadowOpacity=e??$$e,this._updateOccludedShadowOpacity(),this._ensureMaxOpacity()},St),H(()=>this.view.highlightOptions.shadowDifference,e=>{this._shadowDifference=e??A$e,this._updateOccludedShadowOpacity(),this._ensureMaxOpacity()},St),H(()=>this.view.highlightOptions.shadowColor,e=>{this._passParameters.shadowColor=ooe(e??C$e),this._ensureMaxOpacity()},St)])}_updateOccludedShadowOpacity(){this._passParameters.occludedShadowOpacity=this._passParameters.shadowOpacity*(1-this._shadowDifference)}_ensureMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3],this.requestRender(bt.UPDATE)}precompile(){this.techniques.precompile(c0e)}render(e){const i=e.find(({name:n})=>n===tr.COMPOSITE),r=this.bindParameters;if(!r.shadowHighlightsVisible||!r.depth||!this._ensureIfVisible(r.camera,r.lighting.mainLight.direction))return i;const s=this.techniques.get(c0e);if(s.compiled){this._passParameters.highlight=e.find(({name:o})=>o==="highlights")?.getTexture(),this._passParameters.origin=r.camera.center;const n=this.renderingContext;n.bindFramebuffer(i.fbo),n.bindTechnique(s,r,this._passParameters),n.screen.draw()}else this.requestRender(bt.UPDATE);return i}_ensureIfVisible(e,i){this._passParameters.opacityElevation=1-CP(VOt,jOt,e.relativeElevation);const r=this.viewingMode===Be.Global?ae(u0e,e.center):se(u0e,0,0,1),s=de(r,i);return this._passParameters.dayNightTerminator=CP(0,1,ce(30*s,0,1)),this._maxOpacity*this._passParameters.opacityElevation*this._passParameters.dayNightTerminator>=BOt}};u([p()],ZE.prototype,"produces",void 0),u([p()],ZE.prototype,"consumes",void 0),u([p({constructOnly:!0})],ZE.prototype,"viewingMode",void 0),ZE=u([A("esri.views.3d.webgl-engine.effects.highlight.ShadowHighlight")],ZE);const u0e=$();let moe=class extends ar{constructor(){super(...arguments),this.mask=null,this.overlay=null,this.input=null,this.size=0}};function Tke(){const t=new ki;return t.attributes.add(z.POSITION,"vec2"),t.vertex.uniforms.add(new uc("drawPosition",(e,i)=>GOt(e,i))),t.varyings.add("vUV","vec2"),t.vertex.main.add(E`vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);`),t.fragment.uniforms.add(new $t("textureInput",e=>e.input)),t.fragment.uniforms.add(new $t("textureMask",e=>e.mask)),t.fragment.uniforms.add(new $t("textureOverlay",e=>e.overlay)),t.fragment.uniforms.add(new E3("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new E3("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(E`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}`),t.fragment.main.add(E`float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;`),t}function GOt(t,e){const i=e.camera.pixelRatio,r=t.magnifier.offset.x*i,s=t.magnifier.offset.y*i;jp(t.magnifier.position,h0e);const n=e.camera.screenToRender(h0e,HOt),o=Math.ceil(i*t.magnifier.size),{fullWidth:a,fullHeight:l}=e.camera;return es(qOt,(n[0]+r)/a*2-1,(n[1]-s)/l*2-1,o/a*2,o/l*2)}const h0e=nn(),HOt=C2e(),qOt=pi(),WOt=Object.freeze(Object.defineProperty({__proto__:null,MagnifierPassParameters:moe,build:Tke},Symbol.toStringTag,{value:"Module"}));let d0e=class extends Bi{constructor(e,i){super(e,i,new Fi(WOt,()=>V(()=>Promise.resolve().then(()=>XGt),void 0)))}initializePipeline(){return _i({blending:NA,depthTest:null,depthWrite:null,colorWrite:Ai})}};async function ZOt(t){const e=V(()=>import("./mask-svg-cNit2NTT.js"),[]),i=V(()=>import("./overlay-svg-DioSRl-7.js"),[]),r=vv((await e).default,{signal:t}),s=vv((await i).default,{signal:t}),n={mask:await r,overlay:await s};return gt(t),n}let O1=class extends xf{constructor(){super(...arguments),this.produces=ut.MAGNIFIER,this.consumes={required:[ut.MAGNIFIER]},this._imageSources=null,this._imageLoadTask=null,this._passParameters=new moe,this._vao=null,this._magnifier=null,this._tmpScreenPoint=nn(),this._tmpRenderPoint=C2e()}initialize(){this.addHandles([H(()=>this.view.magnifier,e=>this._update(e),St)])}_update(e){if(e===this._magnifier)return;this.removeAllHandles(),this._magnifier=e;const i=()=>{const r=this._validMagnifier;r?(this._loadResources(r),this.produces=ut.MAGNIFIER):this.produces="disabled",this.requestRender()};this._magnifier&&this.addHandles(H(()=>this._magnifier?.version,i)),i()}get _validMagnifier(){return this._magnifier?.visible&&this._magnifier?.position&&this._magnifier?.size>0?this._magnifier:null}get _factor(){return this._magnifier?.factor||1}destroy(){this._magnifier=null,this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeTextures(),this._vao=Rt(this._vao)}_disposeTextures(){this._passParameters.mask=Rt(this._passParameters.mask),this._passParameters.overlay=Rt(this._passParameters.overlay),this._passParameters.input=Rt(this._passParameters.input)}precompile(){this._imageSources&&this.techniques.precompile(d0e)}render(e){const i=this._validMagnifier,r=e.find(({name:b})=>b===ut.MAGNIFIER);if(i==null)return r;if(this._imageSources==null)return this.requestRender(bt.UPDATE),r;const s=this.renderingContext,n=this.camera.pixelRatio,o=Math.ceil(n*i.size);this._vao??=Qb(s,ig.Pos2,hg,0,1);const a=this.techniques.get(d0e);if(this._ensureTextureResources(s,o),!a.compiled||!this._passParameters.input)return this.requestRender(bt.UPDATE),r;const l=Math.ceil(1/this._factor*o),c=this._passParameters.input;c.resize(l,l),jp(i.position,this._tmpScreenPoint);const h=this.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),d=this.camera.fullWidth,f=this.camera.fullHeight,m=.5*l,y=.5*l;h[0]=ce(h[0],m,d-m-1),h[1]=ce(h[1],y,f-y-1);const v=Math.floor(h[0]-m),_=Math.floor(h[1]-y);return s.bindFramebuffer(r.fbo),a.program.bindTexture("textureInput",c),s.gl.copyTexImage2D(c.descriptor.target,0,c.descriptor.pixelFormat,v,_,l,l,0),this._passParameters.magnifier=i,s.bindTechnique(a,this.bindParameters,this._passParameters),s.bindVAO(this._vao),s.drawArrays(Ui.TRIANGLE_STRIP,0,4),r}_loadResources(e){const{maskUrl:i,overlayUrl:r}=e;this._imageLoadTask?.maskUrl===i&&this._imageLoadTask?.overlayUrl===r||(this._imageLoadTask?.task.abort(),this._imageLoadTask=this._imageSources=null),this._imageSources||this._imageLoadTask||(this._imageLoadTask={maskUrl:i,overlayUrl:r,task:ag(async s=>{const n=i==null||r==null?ZOt(s):null,o=i!=null?vv(i,{signal:s}):n.then(l=>l.mask),a=r!=null?vv(r,{signal:s}):n.then(l=>l.overlay);this._imageSources={mask:await o,overlay:await a}})})}_ensureTextureResources(e,i){if(this._imageSources==null||this._passParameters.size===i&&this._passParameters.input&&this._passParameters.mask&&this._passParameters.overlay)return;this._disposeTextures(),this._imageSources.overlay.width=this._imageSources.mask.width=i,this._imageSources.overlay.height=this._imageSources.mask.height=i;const r=new $r;r.internalFormat=vt.RGBA,r.wrapMode=nr.CLAMP_TO_EDGE,r.flipped=!0,r.preMultiplyAlpha=!Uxe(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result,this._passParameters.overlay=new yi(e,r,this._imageSources.overlay),r.pixelFormat=r.internalFormat=vt.ALPHA,r.preMultiplyAlpha=!1,this._passParameters.mask=new yi(e,r,this._imageSources.mask),r.pixelFormat=r.internalFormat=vt.RGBA,r.flipped=!1,this._passParameters.input=new yi(e,r)}};u([p()],O1.prototype,"produces",void 0),u([p()],O1.prototype,"consumes",void 0),u([p()],O1.prototype,"_imageSources",void 0),u([p()],O1.prototype,"_imageLoadTask",void 0),O1=u([A("esri.views.3d.webgl-engine.effects.magnifier.Magnifier")],O1);const eO=8,YOt=16;function Eke(){const t=new ki;t.include(ea),t.fragment.uniforms.add(new $t("edgesTexture",i=>i.inputTexture),new $t("areaTexture",i=>i.areaTexture),new $t("searchTexture",i=>i.searchTexture)),t.fragment.constants.add("smaaAreaTexPixelSize","vec2",[1/160,1/560]);const e=1/7;return t.fragment.code.add(E`
    vec4 sampleLevelZeroOffset(vec2 coord, vec2 offset, vec2 resolution) {
      return texture(edgesTexture, coord + offset.x * resolution);
    }

    float searchLength(vec2 e, float bias, float scale) {
      e.r = bias + e.r * scale;
      return 255.0 * texture(searchTexture, e).r;
    }

    float searchLeft(vec2 texcoord, float end, vec2 resolution) {
      vec2 e = vec2(0.0, 1.0);
      for (int i = 0; i < ${E.int(eO)}; ++i) {
        e = texture(edgesTexture, texcoord).rg;
        texcoord -= vec2(2.0, 0.0) * resolution;
        if (! (texcoord.x > end && e.g > 0.8281 && e.r == 0.0)) break;
      }
      texcoord.x += 0.25 * resolution.x;
      texcoord.x += resolution.x;
      texcoord.x += 2.0 * resolution.x;
      texcoord.x -= resolution.x * searchLength(e, 0.0, 0.5);
      return texcoord.x;
    }

    float searchRight(vec2 texcoord, float end, vec2 resolution) {
      vec2 e = vec2(0.0, 1.0);
      for (int i = 0; i < ${E.int(eO)}; ++i) {
        e = texture(edgesTexture, texcoord).rg;
        texcoord += vec2(2.0, 0.0) * resolution;
        if (! (texcoord.x < end && e.g > 0.8281 && e.r == 0.0)) break;
      }
      texcoord.x -= 0.25 * resolution.x;
      texcoord.x -= resolution.x;
      texcoord.x -= 2.0 * resolution.x;
      texcoord.x += resolution.x * searchLength(e, 0.5, 0.5);
      return texcoord.x;
    }

    float searchUp(vec2 texcoord, float end, vec2 resolution) {
      vec2 e = vec2(1.0, 0.0);
      for (int i = 0; i < ${E.int(eO)}; ++i) {
        e = texture(edgesTexture, texcoord).rg;
        texcoord += vec2(0.0, 2.0) * resolution;
        if (! (texcoord.y > end && e.r > 0.8281 && e.g == 0.0)) break;
      }
      texcoord.y -= 0.25 * resolution.y;
      texcoord.y -= resolution.y;
      texcoord.y -= 2.0 * resolution.y;
      texcoord.y += resolution.y * searchLength(e.gr, 0.0, 0.5);
      return texcoord.y;
    }

    float searchDown(vec2 texcoord, float end, vec2 resolution) {
      vec2 e = vec2(1.0, 0.0);
      for (int i = 0; i < ${E.int(eO)}; ++i) {
        e = texture(edgesTexture, texcoord).rg;
        texcoord -= vec2(0.0, 2.0) * resolution;
        if (! (texcoord.y < end && e.r > 0.8281 && e.g == 0.0)) break;
      }
      texcoord.y += 0.25 * resolution.y;
      texcoord.y += resolution.y;
      texcoord.y += 2.0 * resolution.y;
      texcoord.y -= resolution.y * searchLength(e.gr, 0.5, 0.5);
      return texcoord.y;
    }

    vec2 getArea(sampler2D areaTex, vec2 dist, float e1, float e2, float offset) {
      vec2 texcoord = float(${E.int(YOt)}) * round(4.0 * vec2(e1, e2)) + dist;
      texcoord = smaaAreaTexPixelSize * texcoord + (0.5 * smaaAreaTexPixelSize);
      texcoord.y += ${E.float(e)} * offset;
      return texture(areaTex, texcoord).rg;
    }`),t.fragment.main.add(E`
    vec2 size = vec2(textureSize(edgesTexture, 0));
    vec2 resolution = 1.0 / size;
    vec2 pixelCoord = uv * size;
    vec4 offsets[2];
    offsets[0] = uv.xyxy + resolution.xyxy * vec4(-0.25, 0.125, 1.25, 0.125);
    offsets[1] = uv.xyxy + resolution.xyxy * vec4(-0.125, 0.25, -0.125, -1.25);
    vec4 maxOffset = vec4(offsets[0].xz, offsets[1].yw) + vec4(-2.0, 2.0, -2.0, 2.0) * resolution.xxyy * float(${E.int(eO)});
    ivec4 subsampleIndices = ivec4(0.0);
    vec4 weights = vec4(0.0);
    vec2 e = texture(edgesTexture, uv).rg;
    if (e.r > 0.0) {
      vec2 d;
      vec2 coords;
      coords.y = searchUp(offsets[1].xy, maxOffset.z, resolution);
      coords.x = offsets[0].x;
      d.x = coords.y;
      float e1 = texture(edgesTexture, coords).g;
      coords.y = searchDown(offsets[1].zw, maxOffset.w, resolution);
      d.y = coords.y;
      d = d * size.y - pixelCoord.y;
      vec2 sqrt_d = sqrt(abs(d));
      coords.y -= 1.0 * resolution.y;
      float e2 = sampleLevelZeroOffset(coords, vec2(0.0, 1.0), resolution).g;
      weights.ba = getArea(areaTexture, sqrt_d, e1, e2, float(subsampleIndices.x));
      // for some reason the following lines are necessary to prevent
      // texture lookup precision issues on some Intel integrated graphics chips
      vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
      weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
    }
    if (e.g > 0.0) {
      vec2 d;
      vec2 coords;
      coords.x = searchLeft(offsets[0].xy, maxOffset.x, resolution);
      coords.y = offsets[1].y;
      d.x = coords.x;
      float e1 = texture(edgesTexture, coords).r;
      coords.x = searchRight(offsets[0].zw, maxOffset.y, resolution);
      d.y = coords.x;
      d = d * size.x - pixelCoord.x;
      vec2 sqrt_d = sqrt(abs(d));
      coords.y -= 1.0 * resolution.y;
      float e2 = sampleLevelZeroOffset(coords, vec2(1.0, 0.0), resolution).r;
      weights.rg = getArea(areaTexture, sqrt_d, e1, e2, float(subsampleIndices.y));
    }
    fragColor = weights;
  `),t}const JOt=Object.freeze(Object.defineProperty({__proto__:null,build:Eke},Symbol.toStringTag,{value:"Module"}));let p0e=class extends Bi{constructor(e,i){super(e,i,new Fi(JOt,()=>V(()=>Promise.resolve().then(()=>KGt),void 0)))}initializePipeline(){return _i({colorWrite:Ai})}};function Cke(){const t=new ki;return t.include(ea),t.fragment.uniforms.add(new $t("blendWeightsTexture",e=>e.inputTexture),new $t("colorTexture",e=>e.color)),t.fragment.main.add(E`vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
vec4 offsets = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets.zw).g;
a.a = texture(blendWeightsTexture, offsets.xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}`),t}const XOt=Object.freeze(Object.defineProperty({__proto__:null,build:Cke},Symbol.toStringTag,{value:"Module"}));let f0e=class extends Bi{constructor(e,i){super(e,i,new Fi(XOt,()=>V(()=>Promise.resolve().then(()=>QGt),void 0)))}initializePipeline(){return _i({colorWrite:Ai})}};const KOt=.05,QOt=2;function $ke(){const t=new ki;return t.include(ea),t.outputs.add("fragEdges","vec2"),t.fragment.code.add(E`float absMax3(vec3 v) {
vec3 t = abs(v);
return max(max(t.r, t.g), t.b);
}`),t.fragment.uniforms.add(new $t("colorTexture",e=>e.color)).main.add(E`
    vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
    vec4 offsets[3];
    offsets[0] = vec4(uv.x - resolution.x, uv.y, uv.x, uv.y + resolution.y);
    offsets[1] = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
    offsets[2] = vec4(uv.x - 2.0 * resolution.x, uv.y, uv.x, uv.y + 2.0 * resolution.y);

    // Calculate color deltas:
    vec3 C = texture(colorTexture, uv).rgb;
    vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
    vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
    vec2 delta = vec2(absMax3(C - Cleft), absMax3(C - Ctop));
    vec2 edges = step(vec2(${E.float(KOt)}), delta);

    // discard if there is no edge:
    if (dot(edges, vec2(1.0)) == 0.0) {
      fragEdges = vec2(0.0);
    }
    else {
      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      float horizontal = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      float vertical = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), horizontal), vertical);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      horizontal = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      vertical = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, horizontal), vertical);

      // Local contrast adaptation in action:
      fragEdges = edges * step(maxDelta, float(${E.float(QOt)}) * delta);
    }
  `),t}const eIt=Object.freeze(Object.defineProperty({__proto__:null,build:$ke},Symbol.toStringTag,{value:"Module"}));let m0e=class extends Bi{constructor(e,i){super(e,i,new Fi(eIt,()=>V(()=>Promise.resolve().then(()=>e6t),void 0)))}initializePipeline(){return _i({colorWrite:Ai})}},tIt=class extends ar{},I1=class extends xf{constructor(e){super(e),this.produces="disabled",this.consumes={required:[ut.ANTIALIASING],optional:[tr.COMPOSITE]},this._areaTexture=null,this._searchTexture=null,this._smaaParameters=new tIt}initialize(){this.addHandles([H(()=>this.isEnabled(),e=>e?this.enable():this.disable(),St)])}async enable(){if(this.produces=ut.ANTIALIASING,this._abortController||this._areaTexture&&this._searchTexture)return;this._abortController=new AbortController;const e=this._abortController.signal;try{const i=await V(()=>import("./SMAAData-DCEZ61Cs.js"),[]);await this._loadTextures(i,e),this.requestRender(bt.UPDATE)}catch{}this._abortController=null}async _loadTextures(e,i){gt(i);const[r,s]=await Promise.allSettled([vv(e.areaTexture,{signal:i}),vv(e.searchTexure,{signal:i})]);if(gt(i),r.status!=="fulfilled"||s.status!=="fulfilled")return;const n=this.renderingContext;this._areaTexture=g0e(n,di.LINEAR,vt.RGB,r.value),this._searchTexture=g0e(n,di.NEAREST,vt.LUMINANCE,s.value)}disable(){this.produces="disabled"}destroy(){this._searchTexture=Rt(this._searchTexture),this._areaTexture=Rt(this._areaTexture)}precompile(){this.techniques.precompile(m0e),this.techniques.precompile(p0e),this.techniques.precompile(f0e)}render(e){const i=e.find(({name:m})=>m===ut.ANTIALIASING);if(!this._areaTexture||!this._searchTexture)return this.requestRender(bt.UPDATE),i;const r=this.techniques.get(m0e),s=this.techniques.get(p0e),n=this.techniques.get(f0e);if(!r.compiled||!s.compiled||!n.compiled)return this.requestRender(bt.UPDATE),i;const o=e.find(({name:m})=>m===tr.COMPOSITE);if(!o)return i;const a=o.fbo.width,l=o.fbo.height,c=this.renderingContext;c.setViewport(0,0,a,l);const h=this.fboCache.acquire(a,l,"smaa edges",fr.RG);c.bindFramebuffer(h.fbo),c.setClearColor(0,0,0,1),c.clear(Si.COLOR),this._smaaParameters.color=o.getTexture();const d=this.bindParameters;c.bindTechnique(r,d,this._smaaParameters),c.screen.draw();const f=this.fboCache.acquire(a,l,"smaa blend");return c.bindFramebuffer(f.fbo),c.setClearColor(0,0,1,1),c.clear(Si.COLOR),this._smaaParameters.inputTexture=h.getTexture(),this._smaaParameters.areaTexture=this._areaTexture,this._smaaParameters.searchTexture=this._searchTexture,c.bindTechnique(s,d,this._smaaParameters),c.screen.draw(),h.release(),c.bindFramebuffer(i.fbo),c.setClearColor(0,1,0,1),c.clear(Si.COLOR),this._smaaParameters.inputTexture=f.getTexture(),c.bindTechnique(n,d,this._smaaParameters),c.screen.draw(),f.release(),i}};function g0e(t,e,i,r){const s=new $r;return s.pixelFormat=i,s.wrapMode=nr.CLAMP_TO_EDGE,s.width=r.width,s.height=r.height,s.samplingMode=e,new yi(t,s,r)}u([p()],I1.prototype,"produces",void 0),u([p()],I1.prototype,"consumes",void 0),u([p({constructOnly:!0})],I1.prototype,"isEnabled",void 0),u([p()],I1.prototype,"_abortController",void 0),I1=u([A("esri.views.3d.webgl-engine.effects.smaa.SMAA")],I1);function Ake(){const t=new ki;return t.attributes.add(z.POSITION,"vec3"),t.attributes.add(z.COLOR,"vec4"),t.attributes.add(z.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add(new mse("transform",(e,i)=>iIt(e,i)),new Ua("viewport",e=>e.camera.fullViewport),new Fn("pixelRatio",e=>e.camera.pixelRatio)),t.vertex.main.add(E`gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;`),t.fragment.main.add(E`float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);`),t}function iIt(t,e){return mn(_0,e.camera.projectionMatrix),_0[10]=24e-8-1,_0[11]=-1,_0[14]=(24e-8-2)*e.camera.near,kn(_0,_0,e.camera.viewMatrix),kn(_0,_0,t.modelMatrix)}const _0=Ve(),rIt=Object.freeze(Object.defineProperty({__proto__:null,build:Ake},Symbol.toStringTag,{value:"Module"}));let sIt=class extends ar{constructor(){super(...arguments),this.modelMatrix=Ve()}},y0e=class extends Bi{constructor(e,i){super(e,i,new Fi(rIt,()=>V(()=>Promise.resolve().then(()=>t6t),void 0)))}initializePipeline(){return _i({blending:Od,depthTest:{func:Ni.LEQUAL},colorWrite:Ai})}},JX=class extends Om{constructor(){super(...arguments),this._starData=null,this._loadDataTask=null,this._numPoints=0,this._passParameters=new sIt}initialize(){this.addHandles([H(()=>this.view.environment.starsEnabled,e=>e?this._enable():this._disable(),Nt),H(()=>this.view.environment.lighting.type==="virtual"?null:this.view.environment.lighting.date,e=>this._update(e),St)])}_enable(){super._enable(),this._loadDataTask=this._createLoadDataTask()}get loading(){return!!this._loadDataTask&&!this._loadDataTask.finished}destroy(){this._loadDataTask=hc(this._loadDataTask),this._numPoints=0,this._vao=Rt(this._vao),this._starData=null}precompile(){this.techniques.precompile(y0e)}render(e){const i=e.find(({name:n})=>n===ut.OPAQUE_ENVIRONMENT),r=this.renderingContext;if(this.loading)return this.requestRender(bt.UPDATE),i;if(!this._starData)return i;this._vao??=this._ensureResources(this._starData,r);const s=this.techniques.get(y0e);return s.compiled?(r.bindTechnique(s,this.bindParameters,this._passParameters),r.bindVAO(this._vao),r.drawArrays(Ui.POINTS,0,this._numPoints),i):(this.requestRender(bt.UPDATE),i)}_ensureResources(e,i){return this._numPoints=e.byteLength/Mke,nIt(i,new Float32Array(e,0,2*this._numPoints),new Uint8Array(e,2*this._numPoints*4,this._numPoints),this._numPoints)}_update(e){if(!e)return;const i=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,r=2*oIt(e),s=mn(this._passParameters.modelMatrix,dIt);w$(s,s,-r*Math.PI),kn(s,hIt,s),w$(s,s,-i*Math.PI),this.requestRender(bt.UPDATE)}_createLoadDataTask(){if(this._starData)return null;const e=ag(async i=>{const{data:r}=await ZGe("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:i});aIt(r),this._starData=r});return e.promise.catch(i=>{Xr(i)||J.getLogger(this).error(i)}).then(()=>{this.destroyed||this.requestRender(bt.UPDATE)}),e}};function nIt(t,e,i,r){const s=v0e.createBuffer(r),n=s.position,o=s.color,a=s.size;for(let l=0;l<r;l++){const c=e[2*l],h=e[2*l+1];n.set(l,0,-Math.cos(c)*Math.sin(h)),n.set(l,1,-Math.sin(c)*Math.sin(h)),n.set(l,2,-Math.cos(h));const d=cIt(i[l]),f=lIt(uIt[d[1]]);o.set(l,0,255*f[0]),o.set(l,1,255*f[1]),o.set(l,2,255*f[2]),o.set(l,3,255),a.set(l,d[0])}return new mg(t,hg,new Map([["geometry",Fv(v0e)]]),new Map([["geometry",Un.createVertex(t,Zs.STATIC_DRAW,s.buffer)]]))}function oIt(t){const e=t,i=new Date(t.getFullYear(),0,1,11,58,56);return(+e-+i)/(+new Date(t.getFullYear()+1,0,1,11,58,55)-+i)}function aIt(t){if(!t)throw new U("stars:no-data-received","Failed to create stars because star catalogue is missing");const e=t.byteLength/Mke;if(e%1!=0||e>5e4||e<5e3)throw new U("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}function lIt(t){return[parseInt(t.slice(0,2),16),parseInt(t.slice(2,4),16),parseInt(t.slice(4,6),16)]}function cIt(t){return t>=192?[2.9,t-192]:t>=160?[2.5,t-160]:t>=128?[2,t-128]:t>=96?[1.5,t-96]:t>=64?[1,t-64]:t>=32?[.7,t-32]:[.4,t]}JX=u([A("esri.views.3d.webgl-engine.effects.stars.Stars")],JX);const uIt=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],hIt=Kie(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),dIt=Kie(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),Mke=9,v0e=Nd().vec3f(z.POSITION).vec4u8(z.COLOR).f32(z.SIZE);let goe=class extends ar{};function Oke(){const t=new ki;return t.include(ea),t.fragment.uniforms.add(new $t("tex",e=>e.texture)),t.fragment.main.add(E`fragColor = vec4(1.0 - texture(tex, uv).a);`),t}const pIt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:goe,build:Oke},Symbol.toStringTag,{value:"Module"}));let _0e=class extends Bi{constructor(e,i){super(e,i,new Fi(pIt,()=>V(()=>Promise.resolve().then(()=>i6t),void 0)))}initializePipeline(){return _i({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}},fIt=class{constructor(e,i){this._rctx=e,this._techniques=i,this._configuration=new EB,this._passParameters=new AG,this._hudParameters=new goe,this._configuration.blitMode=ya.PremultipliedAlpha,this._techniques.precompile(L_,this._configuration),this._configuration.hasOpacityFactor=!0,this._techniques.precompile(L_,this._configuration),this._configuration.hasOpacityFactor=!1,this._configuration.blitMode=ya.Alpha,this._techniques.precompile(L_,this._configuration),this._configuration.blitMode=ya.Depth,this._techniques.precompile(L_,this._configuration),this._techniques.precompile(_0e)}compositeHUD(e,i){this._hudParameters.texture=i;const r=this._techniques.get(_0e);this._rctx.bindTechnique(r,e,this._hudParameters),this._rctx.screen.draw()}compositePreMultipliedAlpha(e,i,r=1){this._composite(e,i,ya.PremultipliedAlpha,r)}composite(e,i){this._composite(e,i,ya.Alpha,1)}blitDepthToLinearDepth(e,i){this._composite(e,i,ya.Depth,1)}_composite(e,i,r,s){this._configuration.blitMode=r,this._configuration.hasOpacityFactor=s!==1,this._passParameters.texture=i,this._passParameters.opacity=s;const n=this._techniques.get(L_,this._configuration);this._rctx.bindTechnique(n,e,this._passParameters),this._rctx.screen.draw()}},mIt=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new Qm(new ArrayBuffer(4)),this._layerToOidToColor=new yv,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new yv,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,i,r,s,n,o=null,a=null,l=null){e&&i&&r&&s&&(this._layerUidToId.set(s,r),this._layerUidToPopupEnabled.set(s,n),n&&this._layerUidToGraphicsUidToObjectId.set(s,i,{objectId:e,attributeNodeId:o,attributeIndex:a,subLayerId:l}))}getObjectAndLayerIdColor(e){const i=this.getObjectAndLayerIdColorArray(e);return Gi(i.get(0,1),i.get(0,2),i.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerUid||!e.graphicUid)return this.colorZero;const i=this._layerUidToPopupEnabled.get(e.layerUid);if(i===void 0)return this.colorZero;if(i===!1)return this.colorZero;const r=this._layerUidToGraphicsUidToObjectId.get(e.layerUid,e.graphicUid)?.objectId;if(!r)return this.colorZero;let s=this._layerToOidToColor.get(e.layerUid,r);if(!s){if(X("enable-feature:objectAndLayerId-screenshot-testing"))s=r;else for(;!s;){const o=Math.floor(16777214*Math.random())+1;this._colorToUID.has(o)||(s=o)}if(s>16777215)throw new Error("Object ID Overflow");this._layerToOidToColor.set(e.layerUid,r,s),this._colorToUID.set(s,e)}const n=new ArrayBuffer(4);return new DataView(n).setUint32(0,s,!1),new Qm(n)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[i,r]of this._colorToUID.entries()){const s=this._layerUidToGraphicsUidToObjectId.get(r.layerUid,r.graphicUid),n=this._layerUidToId.get(r.layerUid);s&&n&&e.set(i,s.attributeNodeId?{type:"object-and-layer-and-i3s-id",olid:s.objectId,lid:n,attrId:s.attributeNodeId,attrIdx:s.attributeIndex,subLayerId:s.subLayerId}:{type:"object-and-layer-id",olid:s.objectId,lid:n})}return e}};function Ike(){return new Float32Array(4)}function gIt(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function VA(t,e,i,r){const s=new Float32Array(4);return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function yIt(t,e){return new Float32Array(t,e,4)}function Rke(){return Ike()}function Pke(){return VA(1,1,1,1)}function Dke(){return VA(1,0,0,0)}function Lke(){return VA(0,1,0,0)}function Nke(){return VA(0,0,1,0)}function Fke(){return VA(0,0,0,1)}const yoe=Rke(),vIt=Pke(),_It=Dke(),bIt=Lke(),wIt=Nke(),xIt=Fke();Object.freeze(Object.defineProperty({__proto__:null,ONES:vIt,UNIT_W:xIt,UNIT_X:_It,UNIT_Y:bIt,UNIT_Z:wIt,ZEROS:yoe,clone:gIt,create:Ike,createView:yIt,fromValues:VA,ones:Pke,unitW:Fke,unitX:Dke,unitY:Lke,unitZ:Nke,zeros:Rke},Symbol.toStringTag,{value:"Module"}));let kke=class{constructor(e,i){this.key=e,this.free=i,this.incarnation=0,this._refCount=1}retain(e=1){this._refCount+=e}release(){return this._refCount===0?(console.log(`Releasing already released FBO attachment "${this.name}" in ${new Error().stack}`),!0):(--this._refCount,this._refCount===0&&(this.free(),!0))}};var Q$;(function(t){t[t.FBO=0]="FBO",t[t.DEPTH=1]="DEPTH",t[t.COLOR=2]="COLOR"})(Q$||(Q$={}));let zke=class extends kke{constructor(e,i,r){super(e,r),this.attachment=i,this.name=""}dispose(){this.attachment.dispose()}get cachedMemory(){return this.attachment.usedMemory}},SIt=class extends zke{constructor(e,i,r){super(e,i,r),this.attachment=i,this.type=Q$.COLOR}},b0e=class extends zke{constructor(){super(...arguments),this.type=Q$.DEPTH}};function TIt(t){return t?.attachment.type===hv.Texture}let Uke=class extends kke{constructor(e,i,r,s,n,o){super(e,o),this.type=Q$.FBO,this._colors=new Map,this._name=tr.COMPOSITE,this.acquireDepth=null,this.acquireColor=null,this._name=i,this.fbo=r,this.acquireDepth=s,this.acquireColor=n}dispose(){this.fbo?.dispose()}get cachedMemory(){return this.fbo?.usedMemory||0}get numberOfColorAttachments(){return this._colors.size}get name(){return this._name}setName(e){this._name=e}getTexture(e=rr.COLOR_ATTACHMENT0){return e===nS?this.fbo?.depthStencilTexture:this.fbo?.getColorTexture(e)}getAttachment(e=rr.COLOR_ATTACHMENT0){return e===nS?this._depth:this._colors.get(e)}hasAttachment(e){return vm(this._colors,i=>i.name===e)}attachDepth(e){return e?.retain(),this.detachDepth(),e&&this.fbo?.attachDepthStencil(e.attachment),this._depth=e,this}detachDepth(){this.fbo?.detachDepthStencilTexture(),this.fbo?.detachDepthStencilBuffer(),this._depth=Dr(this._depth)}obtainDepthTexture(){const e=this._depth;return TIt(e)?(this.fbo?.detachDepthStencilTexture(),this._depth=null,e):null}attachColor(e,i){return e.retain(),this.detachColor(i),this.fbo?.attachColorTexture(e.attachment,i),this._colors.set(i,e),this}detachColor(e){this.fbo?.detachColorTexture(e);const i=this._colors.get(e);this._colors.delete(e),i?.release()}detachAll(){this._colors.forEach((e,i)=>this.detachColor(i)),this.detachDepth()}},Fq=class{constructor(e,i){this._last=new Jt,this._incarnation=0,this._cache=new XD(e,i)}destroy(){this._last?.forAll(e=>e.dispose()),this._last=null,this._cache.destroy()}set interactive(e){e&&!this._last?this._last=new Jt:e||(this._last?.forAll(i=>i.dispose()),this._last=null)}clean(){this._last?.filterInPlace(e=>!(e.incarnation<this._incarnation)||(this._cache.put(e.key,e),!1))}frame(){++this._incarnation}pop(e){if(this._last){const i=this._last.find(r=>r.key===e);if(i)return this._last.removeUnordered(i),i}return this._cache.pop(e)}put(e){e.incarnation=this._incarnation,this._last?this._last.push(e):this._cache.put(e.key,e)}get usedMemory(){return this._last?.reduce((e,i)=>e+i.cachedMemory,0)??0}},EIt=class{constructor(e){this.rctx=e,this._acquired=new Set,this._cache=new Fq(e.newCache,"FBOCache"),this._depthCache=new Fq(e.newCache,"DepthAttachmentCache"),this._colorCache=new Fq(e.newCache,"ColorAttachmentCache")}destroy(){this._cache.destroy(),this._depthCache.destroy(),this._colorCache.destroy()}clean(){this._cache.clean(),this._colorCache.clean(),this._depthCache.clean()}frameStart(){this._cache.frame(),this._colorCache.frame(),this._depthCache.frame(),this.debugCallback?.()}frameEnd(){const e=this.debugCallback;e&&this._acquired.forEach(i=>i.type===Q$.FBO&&e(i.name,i.fbo,i.numberOfColorAttachments))}get usedMemory(){return Array.from(this._acquired.values()).reduce((e,i)=>e+("getTexture"in i?i.getTexture()?.usedMemory??0:i.cachedMemory),this._cache.usedMemory+this._colorCache.usedMemory+this._depthCache.usedMemory)}set interactive(e){this._cache.interactive=this._colorCache.interactive=this._depthCache.interactive=e}acquire(e,i,r,s=fr.RGBA){const n=kq(s,e,i);let o=this._cache.pop(n);if(o){o.retain(),o.setName(r);const a=this.rctx.getBoundFramebufferObject();if(this.rctx.bindFramebuffer(o.fbo),this.rctx.setDrawBuffers([rr.COLOR_ATTACHMENT0]),!o.fbo)throw new U("attempt to use a not existing framebuffer");this.rctx.unbindTexture(o.fbo.colorTexture),this.rctx.bindFramebuffer(a)}else o=new Uke(n,r,new gg(this.rctx,{...w0e[s],width:e,height:i}),a=>{a??=jo.DEPTH_STENCIL_TEXTURE;const l=this._acquireDepth(a,o.fbo.width,o.fbo.height,`${o.name} depth`);return o.attachDepth(l),l.release(),o},(a,l,c)=>{l??=fr.RGBA;const h=this._acquireColor(l,e,i,c??`${o.name} color ${a}`);return this.rctx.unbindTexture(h.attachment),o.attachColor(h,a),h.release(),o},()=>{this.debugCallback?.(o.name,o.fbo,o.numberOfColorAttachments),this._acquired.delete(o),o.detachAll(),this._cache.put(o)});return this._trackHandle(o)}acquireDepth(e,i,r,s){return this._acquireDepth(e,i,r,s)}_acquireDepth(e,i,r,s){const n=kq(e,i,r),o=this._depthCache.pop(n);if(o)return o.retain(),o.name=s,this._trackHandle(o);const a=e===jo.DEPTH_STENCIL_TEXTURE?new b0e(n,new yi(this.rctx,{...x0e[e],width:i,height:r}),()=>{this._acquired.delete(a),this._depthCache.put(a)}):new b0e(n,new HDe(this.rctx,{...x0e[e],width:i,height:r}),()=>{this._acquired.delete(a),this._depthCache.put(a)});return a.name=s,this._trackHandle(a)}_acquireColor(e,i,r,s){const n=kq(e,i,r),o=this._colorCache.pop(n);if(o)return o.retain(),o.name=s,this._trackHandle(o);const a=new SIt(n,new yi(this.rctx,{...w0e[e],width:i,height:r}),()=>{this._acquired.delete(a),this._colorCache.put(a)});return a.name=s,this._trackHandle(a)}_trackHandle(e){return this._acquired.add(e),e}};const Q_=new Uke("default","default",null,()=>Q_,()=>Q_,()=>{});function kq(t,e,i){return`${t}x${e}x${i}`}Q_.release=()=>!1;const S5=new $r;S5.pixelFormat=vt.RED,S5.internalFormat=Qe.R8,S5.wrapMode=nr.CLAMP_TO_EDGE;const T5=new $r;T5.pixelFormat=vt.RG,T5.internalFormat=Qe.RG8,T5.wrapMode=nr.CLAMP_TO_EDGE;const E5=new $r;E5.internalFormat=Qe.RGBA4,E5.dataType=Ya.UNSIGNED_SHORT_4_4_4_4,E5.wrapMode=nr.CLAMP_TO_EDGE;const Bke=new $r;Bke.wrapMode=nr.CLAMP_TO_EDGE;const II=new $r;II.wrapMode=nr.CLAMP_TO_EDGE,II.samplingMode=di.LINEAR_MIPMAP_LINEAR,II.hasMipmap=!0,II.maxAnisotropy=8;const RI=new $r;RI.pixelFormat=vt.RED,RI.dataType=Ya.HALF_FLOAT,RI.internalFormat=Qe.R16F,RI.samplingMode=di.NEAREST;const C5=new $r;C5.dataType=Ya.HALF_FLOAT,C5.internalFormat=Qe.RGBA16F,C5.samplingMode=di.NEAREST;const w0e={[fr.RED]:S5,[fr.RG]:T5,[fr.RGBA4]:E5,[fr.RGBA]:Bke,[fr.RGBA_MIPMAP]:II,[fr.R16F]:RI,[fr.RGBA16F]:C5},YE=new $r;YE.pixelFormat=vt.DEPTH_STENCIL,YE.dataType=Ya.UNSIGNED_INT_24_8,YE.samplingMode=di.NEAREST,YE.wrapMode=nr.CLAMP_TO_EDGE,YE.internalFormat=vt.DEPTH24_STENCIL8;const x0e={[jo.DEPTH_STENCIL_TEXTURE]:YE,[jo.DEPTH16_BUFFER]:new GDe(fa.DEPTH_COMPONENT16,4)};var C3;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(C3||(C3={}));let Fg=class{constructor(e,i,r=C3.FrontToBack){this._rctx=e,this._techniques=i,this._sorting=r,this._draws=new Jt({allocator:s=>s??{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,i,r,s,n){const o=this._draws.pushNew();o.geometry=i,o.geometryRanges=r,o.material=e,o.depthSquaredHint=s,o.indexType=(i.indexed?i.vao.indexBuffer.indexType:null)??0,o.highlightName=n}acquire(e,i){return this._draws.map(r=>r.material.acquireTechnique(this._techniques,e,i,r.geometry.parameters))}dispatch(e,i,r){const s=this._rctx;this._previouslyBoundDraw.clear();let n=null;const o=this._draws.length,a=i.highlight?.name;for(let l=0;l<o;l++){const c=this._draws.data[l];if(e.identifier===Ha.Highlight){const b=c.highlightName;if(b){if(b!==a)continue}else if(!a||!i.overlay?.hasHighlightOptions(a))continue}const h=r[l];h===n&&i.oitPass===bi.NONE||(s.bindTechnique(h,i,e),n=h);const{geometryRanges:d,indexType:f,geometry:m,material:y}=c;s.bindVAO(m.vao),this._previouslyBoundDraw.get(h)!==y&&(h.program.bindDraw(i,e,y),this._previouslyBoundDraw.set(h,y));const v=d.length,{primitiveType:_}=m;for(let b=0;b<v;b+=2){const w=d[b],x=d[b+1];if(f!==0){const S=$5.get(f);s.drawElements(_,x,f,w*S)}else s.drawArrays(_,w,x)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===C3.FrontToBack?1:-1;this._draws.sort((i,r)=>{const s=e*(i.depthSquaredHint-r.depthSquaredHint);return s!==0?s:i.geometry.vao.byteSize-r.geometry.vao.byteSize})}get count(){return this._draws.length}};const $5=new Map;$5.set(Pi.UNSIGNED_BYTE,1),$5.set(Pi.UNSIGNED_SHORT,2),$5.set(Pi.UNSIGNED_INT,4);let CIt=class{constructor(e){const i=e.renderContext.rctx,r=e.techniques;this.opaque=new Fg(i,r),this.transparent=new Fg(i,r,C3.BackToFront),this.integratedMesh=new Fg(i,r),this.shadowMap=new Fg(i,r),this.highlight=new Fg(i,r),this.highlightIntegratedMesh=new Fg(i,r),this.highlightShadowMap=new Fg(i,r),this.viewshedShadowMap=new Fg(i,r),this.nonHighlightShadowMap=new Fg(i,r)}},MG=class extends pPe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=$(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}},$It=class extends MG{constructor(){super(...arguments),this.identifier=Ha.Material,this.output=Y.Color,this.transparent=!1}},AIt=class extends MG{constructor(){super(...arguments),this.identifier=Ha.ShadowMap}},MIt=class extends MG{constructor(){super(...arguments),this.identifier=Ha.Highlight}},OIt=class extends MG{constructor(){super(...arguments),this.identifier=Ha.ViewshedShadowMap}},XX=class extends BD{constructor(){super({}),this.produces=new Map([[be.OPAQUE_MATERIAL,e=>this._produces(e,be.OPAQUE_MATERIAL)],[be.TRANSPARENT_MATERIAL,e=>this._produces(e,be.TRANSPARENT_MATERIAL)],[be.INTEGRATED_MESH,e=>this._produces(e,be.INTEGRATED_MESH)]]),this._materialPassParameters=new $It,this._shadowPassParameters=new AIt,this._highlightPassParameters=new MIt,this._viewshedPassParameters=new OIt,this._systems=new Set}initializeRenderContext(e){this._context=e,this._passes=new CIt(e)}get rctx(){return this._context.renderContext.rctx}uninitializeRenderContext(){}dispose(){this._context=null,this._systems.clear()}register(e){this._systems.add(e)}_produces(e,i){return!!this._invoke(e,i,r=>r.count>0)}prepareRender(e){if(this._systems.size!==0&&this._passes!=null){for(const i of Object.values(this._passes))i.prepareSubmit();this._systems.forEach(i=>i.submit(this._passes,e.bind));for(const i of Object.values(this._passes))i.finishSubmit()}}acquireTechniques(e){if(this._systems.size===0)return null;const i=e.output===Y.Shadow||e.output===Y.ShadowHighlight||e.output===Y.ShadowExcludeHighlight?this._shadowPassParameters:e.output===Y.ViewshedShadow?this._viewshedPassParameters:e.output===Y.Highlight?this._highlightPassParameters:this._materialPassParameters,r=e.bind;return this._updateParameters(r.camera,i,r.slot===be.TRANSPARENT_MATERIAL),this._materialPassParameters.output=e.output,this._invoke(e.output,e.bind.slot,(s,n)=>s.acquire(n,e.bind))}render(e,i){this._invoke(e.output,e.bind.slot,(r,s)=>r.dispatch(s,e.bind,i))}_invoke(e,i,r){if(this._passes==null)return null;switch(i){case be.OPAQUE_MATERIAL:switch(e){case Y.Color:case Y.ColorEmission:case Y.Depth:case Y.Normal:case Y.ObjectAndLayerIdColor:return r(this._passes.opaque,this._materialPassParameters);case Y.Highlight:return r(this._passes.highlight,this._highlightPassParameters);case Y.Shadow:return r(this._passes.shadowMap,this._shadowPassParameters);case Y.ShadowHighlight:return r(this._passes.highlightShadowMap,this._shadowPassParameters);case Y.ShadowExcludeHighlight:return r(this._passes.nonHighlightShadowMap,this._shadowPassParameters);case Y.ViewshedShadow:return r(this._passes.viewshedShadowMap,this._viewshedPassParameters)}break;case be.TRANSPARENT_MATERIAL:switch(e){case Y.Color:case Y.ColorEmission:case Y.Depth:case Y.Normal:case Y.ObjectAndLayerIdColor:return r(this._passes.transparent,this._materialPassParameters)}break;case be.INTEGRATED_MESH:switch(e){case Y.Color:case Y.ColorEmission:case Y.Depth:case Y.Normal:case Y.ObjectAndLayerIdColor:return r(this._passes.integratedMesh,this._materialPassParameters);case Y.Highlight:return r(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}queryDepthRange(e){const i=new su;return this._systems.forEach(r=>i.union(r.queryDepthRange(e))),i}get hasEmissions(){let e=!1;return this._systems.forEach(i=>e=i.hasEmissions||e),e}_updateParameters(e,i,r){const s=e.viewInverseTransposeMatrix;se(zq,s[3],s[7],s[11]),Uq.set(zq),ne(i.transformWorldFromViewTH,Uq.high),ne(i.transformWorldFromViewTL,Uq.low),ne(i.slicePlaneLocalOrigin,zq),FS(i.transformViewFromCameraRelativeRS,e.viewMatrix),mn(i.transformProjFromView,e.projectionMatrix),i.identifier===Ha.Material&&(this._materialPassParameters.transparent=r,OA(S0e,i.transformViewFromCameraRelativeRS),_D(i.transformNormalViewFromGlobal,S0e))}hasHighlightOptions(e){for(const i of this._systems)if(i.hasHighlightOptions(e))return!0;return!1}};XX=u([A("esri.views.3d.webgl-engine.core.renderPasses.RenderPassManager")],XX);const zq=$(),S0e=xs(),Uq=new yke;function IIt(t){return t.name}let RIt=class{constructor(e){this._context=e,this._nodes=new Jt}destroy(){this._nodes.forEach(e=>e.destroy()),this._nodes.clear()}add(e){this._nodes.push(e),vU&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:i})=>i).join(", ")}`)}remove(e){this._nodes.remove(e),vU&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:i})=>i).join(", ")}`)}produces(e){return this._nodes.some(({produces:i})=>i===e)}require(e,...i){const r=this._nodes,s=n=>r.reduce((o,{consumes:a,produces:l})=>o+(!a.required.includes(e)||n!=null&&l!==n?0:1),0);return i.length===0?s():i.reduce((n,o)=>n+s(o),0)}optional(e,...i){const r=this._nodes,s=n=>r.reduce((o,{consumes:a,produces:l})=>o+(!a.optional?.includes(e)||n!=null&&l!==n?0:1),0);return i.length===0?s():i.reduce((n,o)=>n+s(o),0)}updateAnimation(e){return this._nodes.reduce((i,r)=>r.updateAnimation(e)||i,!1)}precompile(...e){++this._context.techniques.precompiling;for(const i of e)this._nodes.forEach(r=>{r.produces===i&&r.precompile()});--this._context.techniques.precompiling}render(e,i,r=()=>{}){const s=e.name,n=this._nodes.filter(({produces:o})=>o===s);return n.length===0?IIt(e)?e:Q_:(n.forEach(o=>{const a=[e];for(const l of o.consumes.required){if(l===s)continue;const c=i.get(l);if(c)a.push(c);else if(l!=="emissive"||!i.get(s)?.hasAttachment(l))return void(r&&r(a))}if(o.consumes.optional)for(const l of o.consumes.optional){if(l===s)continue;const c=i.get(l);c&&a.push(c)}try{const l=o.doRender(a);l&&l!==e&&(s!==l.name&&(J.getLogger(o).errorOnce(`RenderNode produced ${l.name}, expected ${s}`),l.setName(s)),e.release(),e=l,i.set(s,e))}catch(l){J.getLogger(o).errorOnce(l)}r&&r(a)}),this._context.rctx.enforceState(),e)}requireGeometryDepth(){return this._nodes.some(e=>e.produces!=="disabled"&&e.requireGeometryDepth)}get test(){return{nodes:this._nodes}}},PIt=class{constructor(e){this.context=e,this._renderPlugins=new Jt,this._slots=new Array,this._version=xa(0);for(let i=0;i<be.MAX_SLOTS;++i)this._slots[i]=[]}destroy(){this._renderPlugins.forEach(e=>e.destroy()),this._renderPlugins.clear()}get plugins(){return this._renderPlugins}add(e,i){const r=()=>{if(i?.aborted)throw e.uninitializeRenderContext(),vi();this._renderPlugins.push(e),e.produces.forEach((n,o)=>this._slots[o].push(e)),this.context.requestRender(),this._version.value++},s=e.initializeRenderContext(this.context,i);if(nu(s))return s.then(r);r()}remove(e){this._renderPlugins.removeUnordered(e),e.uninitializeRenderContext();for(let i=0;i<this._slots.length;++i)this._slots[i]=this._slots[i].filter(r=>r!==e);this.context.requestRender(),this._version.value++}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this.context.renderContext)})}updateAnimation(e){let i=!1;return this._renderPlugins.forAll(r=>i=r.updateAnimation?.(e)||i),i}precompile(...e){++this.context.techniques.precompiling;const i=this.context.renderContext.bind.slot;for(const r of e)this.context.renderContext.bind.slot=r,this._forEachRender(()=>{});this.context.renderContext.bind.slot=i,--this.context.techniques.precompiling}render(e,...i){for(const r of i)this.context.renderContext.bind.slot=r,this._forEachRender((s,n)=>s.render(this.context.renderContext,n,e))}_forEachRender(e){const i=this.context.renderContext.bind.slot,r=this.context.renderContext.output;this._slots[i].forEach(s=>{if(!s.produces.get(i)?.(r)||s.isDecoration&&!this.context.renderContext.bind.decorations)return;const o=s.acquireTechniques(this.context.renderContext);o&&e(s,o)})}queryDepthRange(e){const i=new su;return this._renderPlugins.forAll(r=>{const s=r.queryDepthRange?.(e);i.union(s)}),i}get updating(){return this._version.value>=0&&this._renderPlugins.some(e=>e.running)}produces(e,...i){return i.some(r=>this._slots[r].some(s=>{const n=s.produces.get(r);return!!n&&n(e)}))}consumes(e){return this._renderPlugins.some(i=>i.consumes().required.includes(e))}hasHighlightOptions(e){return DIt.some(i=>this._slots[i].some(r=>r.hasHighlightOptions(e)))}get hasDecorations(){return this._renderPlugins.some(e=>e.isDecoration)}get hasOccludees(){return this._renderPlugins.some(e=>e.hasOccludees)}get hasEmissions(){return this._renderPlugins.some(e=>e.hasEmissions)}get renderOccludedFlags(){return this._renderPlugins.reduce((e,i)=>e|i.renderOccludedFlags,Er.None)}get usedMemory(){return this._renderPlugins.reduce((e,i)=>i.material?e:e+(i.usedMemory??0),0)}get test(){}};const DIt=[be.OPAQUE_MATERIAL,be.TRANSPARENT_MATERIAL,be.DRAPED_MATERIAL,be.HUD_MATERIAL,be.LABEL_MATERIAL];let voe=class extends ar{};function Vke(t){const e=new ki;e.include(ea);const i=t.hasEmission,r=e.fragment;return r.uniforms.add(new $t("colorTexture",s=>s.colorTexture),new $t("alphaTexture",s=>s.alphaTexture),new $t("frontFaceTexture",s=>s.frontFaceTexture)),e.outputs.add("fragColor","vec4",0),i&&(e.outputs.add("fragEmission","vec4",1),r.uniforms.add(new $t("emissionTexture",s=>s.emissionTexture)),r.uniforms.add(new $t("emissionFrontFaceTexture",s=>s.emissionFrontFaceTexture))),r.main.add(E`
      float srcAlpha = texture(alphaTexture, uv).r;
      if(srcAlpha == 0.0){
        fragColor = vec4(0.0);
        return;
      }

      vec4 srcColor = texture(colorTexture, uv);
      vec4 frontFace = texture(frontFaceTexture, uv);

      vec4 transparentColor = vec4(mix(srcColor.rgb / srcAlpha, frontFace.rgb, frontFace.a), 1.0 - srcColor.a);
      fragColor = transparentColor;

      ${Se(i,`vec4 emission = texture(emissionTexture, uv);
         vec4 emissionFrontFace = texture(emissionFrontFaceTexture, uv);
        fragEmission = vec4(mix(emission.rgb / srcAlpha, emissionFrontFace.rgb, emissionFrontFace.a), emissionFrontFace.a);`)}
    `),e}const LIt=Object.freeze(Object.defineProperty({__proto__:null,OITBlendPassParameters:voe,build:Vke},Symbol.toStringTag,{value:"Module"}));let Bq=class extends Bi{constructor(e,i){super(e,i,new Fi(LIt,()=>V(()=>Promise.resolve().then(()=>r6t),void 0)))}initializePipeline(e){return _i({blending:Od,colorWrite:Ai,drawBuffers:e.hasEmission?{buffers:[rr.COLOR_ATTACHMENT0,rr.COLOR_ATTACHMENT1]}:{buffers:[rr.COLOR_ATTACHMENT0]}})}},jke=class extends ou{constructor(){super(...arguments),this.hasEmission=!1}};u([te()],jke.prototype,"hasEmission",void 0);let NIt=class{constructor(e){this._techniques=e,this._parameters=new voe,this._configuration=new jke,e.precompile(Bq,this._configuration),this._configuration.hasEmission=!0,e.precompile(Bq,this._configuration)}blend(e,i,r,s,n){this._parameters.colorTexture=i.getTexture(),n&&(this._parameters.emissionTexture=i.getTexture(rr.COLOR_ATTACHMENT1),this._parameters.emissionFrontFaceTexture=r.getTexture(rr.COLOR_ATTACHMENT1)),this._parameters.alphaTexture=i.getTexture(n?rr.COLOR_ATTACHMENT2:rr.COLOR_ATTACHMENT1),this._parameters.frontFaceTexture=r.getTexture(),this._configuration.hasEmission=n;const o=this._techniques.get(Bq,this._configuration);e.bindTechnique(o,s,this._parameters),e.screen.draw()}},FIt=class{constructor(e,i){this._camera=e,this._dt=0,this._time=0,this._lastUpdate=0,this._lastUpdate=i,this._time=i}advance(e,i,r){const s=i-this._lastUpdate;this._dt=s/r,this._time=this._time+s,this._lastUpdate=i,this._camera=e}forceTime(e){this._lastUpdate=this._time=e,this._dt=0}get camera(){return this._camera}get dt(){return this._dt}get time(){return this._time}},kIt=class{constructor(){this._step=C0e,this._dilation=1,this._firstIdleTime=0}frame(e,i){if(i?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,X("disable-feature:high-quality-idle"))this._dilation=1;else{const s=i?performance.now()-this._firstIdleTime:0;if(s>=T0e+UIt)return this._step=1/0,void(this._dilation=1);this._dilation=s>=T0e?BIt:1}const r=ce(e/zIt,C0e,jIt);this._step===1/0?this._step=r:this._step=this._step*E0e+r*(1-E0e)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const zIt=.5,T0e=12e4,UIt=1e4,BIt=10,E0e=.9,VIt=30,C0e=1e3/1,jIt=1e3/VIt;var CB;(function(t){t[t.SHADOW_CASTERS=0]="SHADOW_CASTERS",t[t.FULL_SCENE=1]="FULL_SCENE"})(CB||(CB={}));const GIt=1e4,KX=100,HIt=500,qIt=500,WIt=.1;function ZIt(t,e,i,r=CB.SHADOW_CASTERS){let s=0;if(!e.some(o=>!!o.material&&(s+=o.numGeometries,s>=GIt)))return rRt.compute(t,e,r);const n=new su;return i.forAll(o=>n.union(YIt(t,o))),n}function YIt(t,e){if(!e.visible)return;const i=new su,r=e.getSpatialQueryAccelerator();return r?JIt(i,t,r):XIt(i,t,e.objects),i}function JIt(t,e,i){const{eye:r,viewForward:s,frustum:n}=e,o=l=>l.visible,a=i.objectCount;if(a<HIt)Hh.set(e.near,Math.min(t.near,e.far)),i.forEachInDepthRange(r,s,Cm.DepthOrder.FRONT_TO_BACK,Hh,(l,c)=>{QX(t,e,l),Hh.far=t.near,c.setRange(Hh)},n,o),Hh.set(Math.max(t.far,e.near),e.far),i.forEachInDepthRange(r,s,Cm.DepthOrder.BACK_TO_FRONT,Hh,(l,c)=>{QX(t,e,l),Hh.near=t.far,c.setRange(Hh)},n,o);else{const l=Math.max(Math.min(a,qIt),Math.ceil(a*WIt)),c=i.findClosest(s,Cm.DepthOrder.FRONT_TO_BACK,n,o,l),h=i.findClosest(s,Cm.DepthOrder.BACK_TO_FRONT,n,o,l);c&&h&&($0e(t,e,c.boundingVolumeWorldSpace.bounds),$0e(t,e,h.boundingVolumeWorldSpace.bounds))}}function XIt(t,e,i){QT.clear(),i.forAll(r=>{r.visible&&r.geometries.length!==0&&QT.add(r)}),QT.empty||(QT.sort(e),Hh.set(e.near,Math.min(t.near,e.far)),QT.forEachInDepthRange(Hh,Cm.DepthOrder.FRONT_TO_BACK,(r,s)=>{s<t.near&&QX(t,e,r)}),Hh.set(Math.max(t.far,e.near),e.far),QT.forEachInDepthRange(Hh,Cm.DepthOrder.BACK_TO_FRONT,(r,s,n)=>{t.far=Math.max(t.far,n)}))}function QX(t,e,i){if(!i.visible||!J_(e.frustum,i.boundingVolumeWorldSpace.bounds))return;const r=i.transformation,s=iRt;i.geometries.forEach(n=>{kn(s,r,n.transformation);const o=JP(s);Gke(t,e,n.boundingInfo,s,o)})}function Gke(t,e,i,r,s){if(i==null)return;st(Vo,i.center,r);const{eye:n,viewForward:o}=e,a=o[0]*(Vo[0]-n[0])+o[1]*(Vo[1]-n[1])+o[2]*(Vo[2]-n[2]);if(Vo[3]=i.radius*s,!(a-Vo[3]>t.near&&a+Vo[3]<t.far)&&J_(e.frustum,Vo))if(i.radius>KX&&i.getChildren())for(const l of i.getChildren())Gke(t,e,l,r,s);else eK.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function $0e(t,e,i){const r=e.eye,s=e.viewForward,n=(i[0]-r[0])*s[0]+(i[1]-r[1])*s[1]+(i[2]-r[2])*s[2];t.near=Math.min(t.near,n-i[3]),t.far=Math.max(t.far,n+i[3])}let KIt=class{constructor(){this._items=new Jt({allocator:e=>e||{object:null,distance:0,near:0,far:0},deallocator:e=>(e.object=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().object=e}sort(e){const i=e.eye,r=e.viewForward;this._items.forAll(s=>{const n=s.object.boundingVolumeWorldSpace.bounds,o=(n[0]-i[0])*r[0]+(n[1]-i[1])*r[1]+(n[2]-i[2])*r[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(e,i,r){if(i===Cm.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<e.near||n.near>e.far||r(n.object,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<e.near||n.near>e.far||r(n.object,n.near,n.far)}}},QIt=class{constructor(){this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange=new su(0,0)}compute(e,i,r){this._reset();const{viewMatrix:s}=e;i.forAll(c=>{c.forEachGeometry(h=>{if(!h.visible||r===CB.SHADOW_CASTERS&&!h.castShadow)return;const d=h.boundingSphere,f=s[2]*d[0]+s[6]*d[1]+s[10]*d[2]+s[14],m=f-d[3],y=f+d[3];this._geometries.push(h),this._near.push(-y),this._far.push(-m)})});const n=new su;if(this._geometries.length===0)return n;for(let c=0;c<this._geometries.length;++c)this._near[c]>n.far&&(n.far=this._near[c]),this._near[c]>2&&this._far[c]<n.near&&(n.near=this._far[c]);const o=this._looseRange;o.near=Math.max(.5*n.near,2),o.far=2*n.far;let a=0,l=0;for(let c=0;c<this._geometries.length;++c)this._near[c]<n.near&&(this._near[c]>=o.near?n.near=this._near[c]:this._nearCandidates[a++]=c),this._far[c]>n.far&&(this._far[c]<=o.far?n.far=this._far[c]:this._farCandidates[l++]=c);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return n;this._nearCandidates.sort((c,h)=>this._near[c]<this._near[h]?-1:this._near[c]>this._near[h]?1:0),this._farCandidates.sort((c,h)=>this._far[c]<this._far[h]?1:this._far[c]>this._far[h]?-1:0);for(let c=0;c<this._nearCandidates.length;++c){const h=this._nearCandidates[c];if(this._near[h]<n.near){const d=this._geometries[h],{boundingInfo:f,shaderTransformation:m}=d;this._includeNearBoundingInfoRec(e,f,m,n)}}for(let c=0;c<this._farCandidates.length;++c){const h=this._farCandidates[c];if(this._far[h]>n.far){const d=this._geometries[h],{boundingInfo:f,shaderTransformation:m}=d;this._includeFarBoundingInfoRec(e,f,m,n)}}return this._reset(),n}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_isOutsideSidePlanes(e,i){const r=e,s=Nm(e);return i[0][0]*r[0]+i[0][1]*r[1]+i[0][2]*r[2]+i[0][3]>s||i[1][0]*r[0]+i[1][1]*r[1]+i[1][2]*r[2]+i[1][3]>s||i[2][0]*r[0]+i[2][1]*r[1]+i[2][2]*r[2]+i[2][3]>s||i[3][0]*r[0]+i[3][1]*r[1]+i[3][2]*r[2]+i[3][3]>s}_includeNearBoundingInfoRec(e,i,r,s){if(i==null)return;const n=i.center;st(Vo,n,r),Vo[3]=i.radius*JP(r);const{frustum:o}=e;if(this._isOutsideSidePlanes(Vo,o))return;const a=Vo[0],l=Vo[1],c=Vo[2],h=Vo[3],{viewMatrix:d}=e,f=d[2]*a+d[6]*l+d[10]*c+d[14],m=f+h;if(!(-(f-h)<2||-m>=s.near))if(-m>this._looseRange.near)s.near=-m;else{if(h>KX){const y=i.getChildren();if(y!==void 0){for(const v of y)this._includeNearBoundingInfoRec(e,v,r,s);return}}eK.unionDepthRangeWithAABB(s,e.viewProjectionMatrix,r,i.bbMin,i.bbMax)}}_includeFarBoundingInfoRec(e,i,r,s){if(i==null)return;const n=i.center;st(Vo,n,r),Vo[3]=i.radius*JP(r);const{frustum:o}=e;if(this._isOutsideSidePlanes(Vo,o))return;const[a,l,c,h]=Vo,{viewMatrix:d}=e,f=d[2]*a+d[6]*l+d[10]*c+d[14]-h;if(!(-f<=s.far))if(-f<this._looseRange.far)s.far=-f;else{if(h>KX){const m=i.getChildren();if(m!==void 0){for(const y of m)this._includeFarBoundingInfoRec(e,y,r,s);return}}eK.unionDepthRangeWithAABB(s,e.viewProjectionMatrix,r,i.bbMin,i.bbMax)}}},eRt=class{constructor(){this._modelViewProj=Ve(),this._clipPosition=[pi(),pi(),pi(),pi(),pi(),pi(),pi(),pi()]}unionDepthRangeWithAABB(e,i,r,s,n){const o=this._modelViewProj;kn(o,i,r);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],h=l===0||l===3||l===4||l===7?s[0]:n[0],d=l===0||l===1||l===4||l===5?s[1]:n[1],f=l<4?s[2]:n[2];c[0]=o[0]*h+o[4]*d+o[8]*f+o[12],c[1]=o[1]*h+o[5]*d+o[9]*f+o[13],c[2]=o[2]*h+o[6]*d+o[10]*f+o[14],c[3]=o[3]*h+o[7]*d+o[11]*f+o[15]}for(let l=0;l<12;++l){const c=tRt(this._clipPosition[jq[l][0]],this._clipPosition[jq[l][1]],this._clipPosition[jq[l][2]]);let h=!0;for(let d=0;d<c.length;++d)if(c[d][3]>=2){h=!1;break}if(!h){a=!0;for(let d=0;d<c.length;++d){const f=c[d][3];Number.isFinite(f)&&(e.near=Math.min(f,e.near),e.far=Math.max(f,e.far))}}}return a}};function tRt(t,e,i){let r=[t,e,i];for(let s=0;s<4;++s){const n=r;r=[];for(let o=0;o<n.length;++o){const a=n[o],l=n[(o+1)%n.length];Vq(l,s)?(Vq(a,s)||r.push(A0e(a,l,s)),r.push(l)):Vq(a,s)&&r.push(A0e(a,l,s))}}return r}function Vq(t,e){return e===0?t[0]>=-t[3]:e===1?t[1]>=-t[3]:e===2?t[0]<=t[3]:e===3?t[1]<=t[3]:void jt(!1)}function A0e(t,e,i){let r=0;return i===0?r=(-t[3]-t[0])/(e[0]-t[0]+e[3]-t[3]):i===1?r=(-t[3]-t[1])/(e[1]-t[1]+e[3]-t[3]):i===2?r=(t[3]-t[0])/(e[0]-t[0]-e[3]+t[3]):i===3&&(r=(t[3]-t[1])/(e[1]-t[1]-e[3]+t[3])),bj(pi(),t,e,r)}const jq=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],Vo=Rs(),iRt=Ve(),Hh=new su,QT=new KIt,rRt=new QIt,eK=new eRt,sRt={idleOpacity:.8,navigatingOpacity:.4,maxDelta:.1,tiltFadeStart:20,tiltFadeEnd:30,altitudeStart:1e4,altitudeEnd:2e4};let nRt=class{constructor(e){this._fbos=e,this._requiresEmission=!1,this._size=new vyt(0,0),this._clearColor=pi()}dispose(){this._color=Dr(this._color),this.releaseDepth()}initialize(e,i,r,s){this._size.width=e,this._size.height=i,yx(this._size,this._fbos.rctx.parameters.maxTextureSize);const n=this._color;return this._color=null,this.releaseDepth(),this._requiresEmission=s,yd(this._clearColor,r),n}releaseDepth(){this._color?.detachDepth(),this._depth=Dr(this._depth)}update(e){const i=this._ensureColor();i.attachDepth(this.depth),this._color=e(i)}bind(){const e=this._color==null;if(this.color.attachDepth(this.depth),this._fbos.rctx.bindFramebuffer(this.color.fbo),e){const i=this._fbos.rctx;i.setClearStencil(0),i.setClearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3]),i.clear(Si.COLOR|Si.DEPTH|Si.STENCIL),this._requiresEmission&&i.gl.clearBufferfv(i.gl.COLOR,1,yoe)}}_acquireColor(){return this._requiresEmission?this._fbos.acquire(this._size.width,this._size.height,"acquired-color").acquireColor(rr.COLOR_ATTACHMENT1,fr.RGBA,"emissive"):this._fbos.acquire(this._size.width,this._size.height,"acquired-color")}_acquireDepth(){return this._fbos.acquireDepth(jo.DEPTH_STENCIL_TEXTURE,this._size.width,this._size.height,"depth")}get size(){return this._size}get color(){return this._ensureColor()}get depth(){return this._depth??=this._acquireDepth(),this._depth}_ensureColor(){return this._color??=this._acquireColor(),this._color}},oRt=class{constructor(){this._inputs=new Map}set(e,i){this._inputs.set(e,i)}get(e){return this._inputs.get(e)}has(e){return this._inputs.has(e)}release(e){this._inputs.get(e)?.release()&&this._inputs.delete(e)}};const QD=255,aRt=1/QD;function Hke(){const t=new ki,e=t.fragment;return e.include(Zb),e.include(fg),t.include(eG),t.include(ea),t.include(kD,lRt),e.uniforms.add(new so("shadowMap",i=>i.shadowMap.depthTexture),new so("depthMap",i=>i.depth?.attachment),new Co("inverseViewMatrix",i=>Sl(M0e,nh(M0e,i.camera.viewMatrix,i.camera.center)))),e.constants.add("sampleValue","float",aRt),t.outputs.add("sampleCount","float"),e.main.add(E`sampleCount = 0.0;
float depth = depthFromTexture(depthMap, uv);
if (depth >= 1.0 || depth <= 0.0) {
return;
}
float currentPixelDepth = linearizeDepth(depth);
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
return;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
return;
}
ivec2 texSize = textureSize(shadowMap, 0);
ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));
float depthShadow = readShadowMapDepth(uvShadow, shadowMap);
bool shadow = depthShadow < lvpos.z;
if (shadow) {
sampleCount = sampleValue;
}`),t}const M0e=Ve(),lRt=new foe,cRt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:QD,build:Hke},Symbol.toStringTag,{value:"Module"}));var eA;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(eA||(eA={}));let tK=class extends ou{constructor(){super(...arguments),this.visualization=eA.Gradient,this.bandsEnabled=!1}};u([te({count:eA.COUNT})],tK.prototype,"visualization",void 0),u([te()],tK.prototype,"bandsEnabled",void 0);let _oe=class extends ar{constructor(e){super(),this._data=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=vj(uRt),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}};const uRt=Gi(.01,0,.25,1);function qke(t){const e=new ki,i=e.fragment;e.include(eG),e.include(ea);const{visualization:r,bandsEnabled:s}=t;i.constants.add("inverseSampleValue","float",QD),i.uniforms.add(new $t("shadowCastMap",a=>a.shadowCastMap),new pt("sampleScale",a=>a.sampleScale),new pt("opacityFromElevation",a=>a.opacityFromElevation),new uc("uColor",a=>a.color));const n=r===eA.Gradient,o=r===eA.Threshold;return n&&s?i.uniforms.add(new pt("bandSize",a=>a.bandSize)):o&&i.uniforms.add(new pt("threshold",a=>a.threshold)),i.main.add(E`
    float record = texture(shadowCastMap, uv).r;
    float pixelSamples = record * inverseSampleValue;

    fragColor = vec4(0.0);
    if (pixelSamples < 1.0) {
      return;
    }

    float strength = pixelSamples * sampleScale;
    ${o?E`if (strength <= threshold) return;`:""}
    ${n&&s?E`strength = ceil(strength / bandSize) * bandSize;`:""}
    fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?"* strength":""});
  `),e}const hRt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:_oe,build:qke},Symbol.toStringTag,{value:"Module"}));let O0e=class extends Bi{constructor(e,i){super(e,i,new Fi(hRt,()=>V(()=>Promise.resolve().then(()=>s6t),void 0))),this.primitiveType=Ui.TRIANGLE_STRIP}initializePipeline(){return _i({blending:Od,colorWrite:Ai,depthTest:null,depthWrite:null})}};const dRt=4e4,pRt=5e4,Wke=1/512;let A5=class extends ue{constructor(e,i,r,s){super({}),this._techniques=e,this._rctx=i,this._data=r,this._requestRender=s,this._passParameters=new _oe(this._data),this._configuration=new tK,this._enabled=!1,this._vao=Qb(i)}dispose(){this._stop(),this._vao=Rt(this._vao)}precompile(){this._showVisualization&&this._techniques.precompile(O0e,this._configuration)}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const i=this._techniques.get(O0e,this._configuration);this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(i,e,this._passParameters),this._rctx.drawArrays(i.primitiveType,0,R$(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>Wke}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfEnabled())}get _visualization(){return this._configuration.visualization}set _visualization(e){e!==this._visualization&&(this._configuration.visualization=e,this._requestRenderIfEnabled())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfEnabled())}get _bandsEnabled(){return this._configuration.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._configuration.bandsEnabled=e,this._requestRenderIfEnabled())}_setColor(e){const i=this._passParameters.color;Dx(e,i)||(yd(this._passParameters.color,e),this._requestRenderIfEnabled())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};u([p()],A5.prototype,"opacityFromElevation",null),A5=u([A("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],A5);let I0e=class extends Bi{constructor(e,i){super(e,i,new Fi(cRt,()=>V(()=>Promise.resolve().then(()=>n6t),void 0))),this.primitiveType=Ui.TRIANGLE_STRIP}initializePipeline(){return _i({blending:cdt,colorWrite:Ai,depthTest:null,depthWrite:null})}},jl=class extends ue{constructor(e,i,r,s,n,o){super({}),this.fbos=e,this._techniques=i,this._stage=r,this._prepareForShadowMapPass=s,this._renderToShadowMap=n,this._requestRender=o,this._progress=0,this._sampleCount=0,this._passParameters=new Mse,this._cachedLightDirections=[],this._depthRange=su.zero,this._previewing=!1,this._cameraForcedForScreenshot=!1,this._shadowAccumulatorKey="shadowAccumulator",this._rctx=e.rctx,this._bindParameters=new Hse(new qse(e,r.viewingMode)),this._bindParameters.shadowMap.enabled=!0,this._vao=Qb(this._rctx),this._accumulationRenderer=new A5(i,this._rctx,this,o);const a=this._stage.view.resourceController.scheduler;this.addHandles([a.registerTask(at.SHADOW_ACCUMULATOR,this),H(()=>r.renderView,l=>{this.removeHandles(R0e),l!=null&&this.addHandles(l.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),R0e)},St),H(()=>this._previewing,()=>this._requestRenderIfEnabled(),Gt)],this._shadowAccumulatorKey),i.precompile(I0e)}normalizeCtorArgs(){return{}}dispose(){this._disable(),this.removeHandles(this._shadowAccumulatorKey),this._accumulationRenderer=Rt(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=Rt(this._fbo),this._vao=Rt(this._vao),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo?.colorTexture}get accumulating(){return this._active&&this._previewing||this._refining}get _refining(){return this._active&&!this._doneAccumulating&&!this._previewing}get _active(){return this._fbo!=null&&this._sampleCount>0}get canAccumulate(){return this._bindParameters.depth!=null&&this._depthRange!==su.zero&&this._opacityFromElevation>Wke}get _doneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const i=this._cachedLightDirections;if(Hm(i,e,M$))return;const r=Math.min(QD,e.length);i.length=r,this._sampleCount=r;for(let s=0;s<r;++s)i[s]=ne(i[s]??$(),e[s]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._refining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._doneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,i,r,s){if(this._depthRange=i,this._updateCamera(r),this._bindParameters.contentCamera=s,this._bindParameters.depth=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.accumulating||!this.canAccumulate)return!1;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();let n=this._cameraForcedForScreenshot?this._sampleCount:Math.min(fRt,this._sampleCount);n-=this._progress;for(let o=0;o<n;++o)this._accumulateShadow(),this._requestRender();return this._cameraForcedForScreenshot=!1,n>0}precompile(){this._accumulationRenderer.precompile()}render(e){this._accumulationRenderer.render(e)}setOptions(e){if(e.enabled!==void 0){const i=this._fbo!=null;e.enabled!==i&&(e.enabled?this._enable():this._disable())}e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,i){return!this._active||!this._fbo||this._progress<1||e<0||e>=this._fbo.width||i<0||i>=this._fbo.height?0:(this._fbo.readPixels(e,i,1,1,vt.RGBA,Ya.UNSIGNED_BYTE,P0e),P0e[0]/this._progress)}_enable(){this._progress=0;const e=new $r;e.pixelFormat=vt.RED,e.internalFormat=Qe.R8,e.wrapMode=nr.CLAMP_TO_EDGE,this._fbo=new gg(this._rctx,e),this._requestRender()}_disable(){this._fbo=Rt(this._fbo),this._requestRender()}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clear(Si.COLOR),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._lightDirections[this._progress++],this._depthRange);const e=this._techniques.get(I0e);this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._bindParameters,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,R$(this._vao,"geometry"))}_updateCamera(e){const i=this._fbo;if(i==null)return;const r=this._bindParameters.camera;e.equals(r)||r.copyFrom(e),i.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-CP(dRt,pRt,e.relativeElevation)}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){}};u([p()],jl.prototype,"_progress",void 0),u([p()],jl.prototype,"_sampleCount",void 0),u([p()],jl.prototype,"_fbo",void 0),u([p()],jl.prototype,"_depthRange",void 0),u([p()],jl.prototype,"_previewing",void 0),u([p()],jl.prototype,"_accumulationRenderer",void 0),u([p()],jl.prototype,"_refining",null),u([p()],jl.prototype,"_active",null),u([p()],jl.prototype,"canAccumulate",null),u([p()],jl.prototype,"_doneAccumulating",null),u([p()],jl.prototype,"_opacityFromElevation",null),u([p()],jl.prototype,"running",null),jl=u([A("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],jl);const fRt=6,R0e="renderView",P0e=new Uint8Array(4),mRt=qb();let gRt=class{constructor(){this._plane=qb()}get plane(){return this._plane}set plane(e){BS(e||mRt,this._plane)}},D0e=class{constructor(e,i,r,s,n,o,a,l,c){this.createQuery=e,this.deleteQuery=i,this.resultAvailable=r,this.getResult=s,this.disjoint=n,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}},ly=!1;function yRt(t,e){if(e.disjointTimerQuery)return null;let i=t.getExtension("EXT_disjoint_timer_query_webgl2");return i?new D0e(()=>t.createQuery(),r=>{t.deleteQuery(r),ly=!1},r=>t.getQueryParameter(r,t.QUERY_RESULT_AVAILABLE),r=>t.getQueryParameter(r,t.QUERY_RESULT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{ly||(ly=!0,t.beginQuery(i.TIME_ELAPSED_EXT,r))},()=>{t.endQuery(i.TIME_ELAPSED_EXT),ly=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>t.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):(i=t.getExtension("EXT_disjoint_timer_query"),i?new D0e(()=>i.createQueryEXT(),r=>{i.deleteQueryEXT(r),ly=!1},r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_AVAILABLE_EXT),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_EXT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{ly||(ly=!0,i.beginQueryEXT(i.TIME_ELAPSED_EXT,r))},()=>{i.endQueryEXT(i.TIME_ELAPSED_EXT),ly=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):null)}function vRt(t,e){const i=t.capabilities.disjointTimerQuery;return i==null?null:new _Rt(i,e)}let _Rt=class{constructor(e,i){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,i.forEach(r=>{const s=this._timer.createQuery(),n=this._timer.createQuery();this._queryPool.push(s,n),this._queryResults.set(r,null)})}start(){ly||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const i=this._queryResults.get(e);if(i==null)return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(i))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const r=this._timer.getResult(i)/1e6;return this._queryPool.unshift(i),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,r}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{e!=null&&this._timer.deleteQuery(e)})}};var Es;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.DEPTH="depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.APPLY_ACCUMULATED_SHADOWS="apply accumulated shadows",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.NORMALS="normals",t.SSAO="SSAO",t.HIGHLIGHTS="highlights",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.TRANSPARENT_MATERIAL_WITHOUT_DEPTH="transparent material without depth",t.OPAQUE_ENVIRONMENT="opaque environment",t.TRANSPARENT_ENVIRONMENT="transparent environment",t.OCCLUDED="occluded",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish",t.FOCUS_AREA_MASK="focus area mask"})(Es||(Es={}));const Gq=Object.values(tr).concat(Object.values(ut)).concat(Object.values(Es)),L0e="Total";let bRt=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new zy(L0e),this._cpuTimeSamplers=new Map(Gq.map(i=>[i,new zy(i)])),this._enableGPUTimer=0,this._totalGPUTime=new zy("GPU"),this._gpuTimeSamplers=new Map(Gq.map(i=>[i,new zy(i)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){const i=[...Gq,L0e];this._gpuTimerPool=vRt(this._rctx,i)}if(this._gpuTimerPool==null)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;let e=!1;return{hasGPUTimerSupport:!0,remove:()=>{e||(e=!0,--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=Rt(this._gpuTimerPool)))}}}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool&&(this._gpuTimeSamplers.forEach(e=>e.push(0)),this._gpuTimerPool.start())}advance(e){const i=performance.now();if(this._cpuTimeSamplers.get(e).push(i-this._lastTimeStampCPU),this._lastTimeStampCPU=i,this._gpuTimerPool){const r=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).set(r),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool){const i=this._gpuTimerPool.stop(Es.FINISH);this._gpuTimeSamplers.get(Es.FINISH).set(i),this._rctx.gl.flush()}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.push(e),this._gpuTimerPool&&this._totalGPUTime.push(this.gpuTimeSamplers.reduce((i,r)=>i+(r.last||0),0)),++this._totalFrameCount}};class M5{constructor(e,i,r,s,n,o){this._stage=e,this._techniques=r,this._rctx=s,this._compositingHelper=n,this._requestRender=o,this._pluginsHas={hudElements:!1,water:!1},this._renderers=new Map,this.renderPassManager=new XX,this._isRendering=!1,this._inGlobeView=!1,this._backgroundColor=Gi(0,0,0,1),this._sliceHelper=new gRt,this._blit=null,this._oitblend=null,this._state=xa(ai.IDLE),this._highQualityTransparencyEnabled=!0,this._ssrEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new kIt,this._loadEdgeViewTask=null,this._edgeViewCallbacks=[],this._reprojectionMatrixVersion=xa(0),this._lastFrameTime=0,this._renderHiddenTransparentEdges=()=>{},this._pluginInput=new oRt,this._releaseNormals=a=>{a.some(({name:l})=>l==="normals")&&this._pluginInput.release("normals")},this._debugNeedsDepth=!1,this.fboCache=new EIt(s),this._renderStateFeatures=xa(Pme(!X("disable-feature:high-quality-idle"),e.view.qualityProfile)),this._framebuffer=new nRt(this.fboCache),this.performanceInfo=new bRt(this._rctx),this._shadowMap=new qse(this.fboCache,e.viewingMode),this._shadowAccumulator=new jl(this.fboCache,r,e,a=>{const l=this.shadowsEnabled;this._shadowMap.enabled=!0,this._ensureBindParametersCamera(a.camera,a.contentCamera),this._plugins.prepareRender(),this._shadowMap.enabled=l},(a,l,c)=>{const h=this._stage.view.qualitySettings.maximumPixelRatio;a.shadowMap.start(a.camera,l,c,!0,h),this._renderShadowCascades(Y.Shadow,a.shadowMap),a.shadowMap.finish(),a.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(a.camera,a.contentCamera)},o),this._renderContext=new byt(this._rctx,this._shadowMap,r),this._nodes=new RIt(this._renderContext),this._plugins=new PIt({renderContext:this._renderContext,techniques:r,materials:i,requestRender:o,controller:e,fbos:this.fboCache,isFeatureEnabled:a=>this.isFeatureEnabled(a)}),this._plugins.add(this.renderPassManager),this._handles=[H(()=>this._stage.view.state.camera,()=>o(),St),H(()=>bs.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,a=>{this._renderHiddenTransparentEdges=a?()=>this._renderEdges(td.TRANSPARENT):()=>{},o()},Nt),H(()=>this._stage.view.environment.background?.color,a=>{const l=a?ooe(a):sn;es(this._backgroundColor,l[0]*l[3],l[1]*l[3],l[2]*l[3],l[3]),o()},St),H(()=>this._stage.view.state.camera.relativeElevation,a=>this._inGlobeView=(a??1/0)>=jU,St),H(()=>this._bindParameters.clouds.fadeFactor,()=>this._bindParameters.fadeLighting(),Gt),H(()=>this._bindParameters.clouds.data?.state,()=>o(),Gt),H(()=>this._stage.view.state.highlights,a=>{this._bindParameters.highlights=a,this._updateHighlights(),o()},Nt)]}destroy(){this._handles.forEach(e=>e.remove()),this._gpuTimerHandle=Hi(this._gpuTimerHandle),this._nodes.destroy(),this._framebuffer.dispose(),this._shadowMap.dispose(),this._shadowAccumulator.dispose(),this._loadEdgeViewTask=hc(this._loadEdgeViewTask),this._edgeView=Ce(this._edgeView),this.renderPassManager.dispose(),this._releaseFBOs(),this._disposeOffscreenBuffers(),this.fboCache.destroy(),this._plugins.destroy(),this._renderers.clear(),this._blit=null,this._oitblend=null,HIe.prune(),wx.prune(),mlt()}get renderContext(){return this._renderContext}get _bindParameters(){return this._renderContext.bind}get _framebufferSize(){return this._framebuffer.size}updateRenderFeatures(e=null,i=!X("disable-feature:high-quality-idle")){this._renderStateFeatures.value=Pme(i,e),this._requestRender()}isFeatureEnabled(e,i=this._state.value){return this._renderStateFeatures.value.get(i,e)??!1}setFeatureEnabled(e,i,r){this._renderStateFeatures.mutate(s=>s.set(i,e,r)),this._requestRender()}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(js.HighQualityTransparency)}get hasReflections(){return this._pluginsHas.water&&(this._ssrEnabled||this.isFeatureEnabled(js.WaterReflection))}get _hasHighlights(){return this._plugins.produces(Y.Highlight,be.OPAQUE_MATERIAL,be.TRANSPARENT_MATERIAL,be.DRAPED_MATERIAL,be.HUD_MATERIAL,be.LABEL_MATERIAL)}hasHighlightOptions(e){return this._plugins.hasHighlightOptions(e)}get _hasHUDHighlights(){return this._plugins.produces(Y.Highlight,be.HUD_MATERIAL,be.LABEL_MATERIAL)}get hasSSAO(){return(this._stage.view.qualitySettings.ambientOcclusion||this.isFeatureEnabled(js.SSAO))&&!this._inGlobeView}get hasSMAA(){return this._stage.view.qualitySettings.antialiasingEnabled||this.isFeatureEnabled(js.Antialiasing)}get fullResolutionAtmosphere(){return this._stage.view.qualitySettings.highResolutionAtmosphere||this.isFeatureEnabled(js.HighResolutionAtmosphere)}_releaseFBOs(){this._bindParameters.ssr.lastFrameColor=Dr(this._bindParameters.ssr.lastFrameColor),this._bindParameters.terrainDepth=Dr(this._bindParameters.terrainDepth),this._bindParameters.geometryDepth=Dr(this._bindParameters.geometryDepth)}_disposeOffscreenBuffers(){this._framebuffer.dispose(),this._disposeBindBuffers()}_disposeBindBuffers(){this._shadowMap.disposeOffscreenBuffers(),this._bindParameters.depth=Dr(this._bindParameters.depth),this._bindParameters.hudVisibility=Dr(this._bindParameters.hudVisibility)}get updating(){return this._edgeView!=null&&this._edgeView.updating||this._shadowAccumulator.running||this._plugins.updating||!this.isCameraFinal}loadEdgeView(){return this._loadEdgeViewTask||(this._loadEdgeViewTask=ag(async e=>{const{EdgeView:i}=await V(()=>import("./EdgeView-CE9ssDPM.js"),__vite__mapDeps([364,32,33,365,31]));gt(e);const r=this._edgeView=new i({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniques:this._techniques,setNeedsRender:()=>this._requestRender(),schedule:TRt(this._stage.view.resourceController)});return this._handles.push(H(()=>r.updating,()=>this._requestRender(),Gt)),this._requestRender(),this._edgeViewCallbacks.forEach(s=>s(r)),this._edgeViewCallbacks.length=0,r})),this._loadEdgeViewTask.promise}withEdgeView(e){this.loadEdgeView(),this._edgeView==null?this._edgeViewCallbacks.push(e):e(this._edgeView)}get edgeView(){return this._edgeView}get isCameraFinal(){return this._reprojectionMatrixVersion.value>=0&&Yte(this._bindParameters.ssr.reprojectionMatrix,Kn)}set _reprojectionMatrix(e){yBe(this._bindParameters.ssr.reprojectionMatrix,e)&&this._reprojectionMatrixVersion.value++}get shadowsEnabled(){return!!this._shadowMap?.enabled}setParameters(e){const{_shadowMap:i,_bindParameters:r}=this;if(e.qualitySettings?.reflections!==void 0&&this._ssrEnabled!==e.qualitySettings.reflections&&(this._ssrEnabled=e.qualitySettings.reflections,this._requestRender()),e.shadowMap!==void 0&&this._shadowMap.enabled!==e.shadowMap&&(this._shadowMap.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&i.maxCascades!==e.shadowMapMaxCascades&&(i.maxCascades=e.shadowMapMaxCascades,this._requestRender()),e.environment!=null){e.environment.weather!=null&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=!!e.weatherVisible);const s=e.environment.lighting.type!=="virtual";r.enableFillLights!==s&&(r.enableFillLights=s,this._requestRender())}e.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==e.highQualityTransparency&&(this._highQualityTransparencyEnabled=e.highQualityTransparency,this._requestRender()),e.shadowCast!==void 0&&this._shadowAccumulator.setOptions(e.shadowCast)}set slicePlane(e){this._sliceHelper.plane!==e&&(this._sliceHelper.plane=e,this._requestRender())}get plugins(){return this._plugins}getMaterialRenderer(e){return this._renderers.get(e)}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(e,i){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:r,removes:s,updates:n}=e;r.length===0&&s.length===0&&n.length===0||(a3e(e).forEach((o,a)=>{if(i.done)return;let l=this._renderers.get(a);l==null&&o.adds.length>0&&(l=new wx({material:a,highlightOrderMap:this._stage.view.state.highlightOrderMap}),l.initializeRenderContext(this._plugins.context),this._plugins.add(l),this._renderers.set(a,l)),l&&(l.modify(o),l.updateHighlights(this._stage.view.state.highlightOrderMap),l.numGeometries===0&&(this._renderers.delete(l.material),this._plugins.remove(l),l.destroy())),o.removes.forEach(c=>e.removes.removeUnordered(c)),o.adds.forEach(c=>e.adds.removeUnordered(c)),o.updates.forEach(c=>e.updates.removeUnordered(c)),i.madeProgress()}),this.updateHasFlags())}updateHasFlags(){const e=this._pluginsHas;e.hudElements=this._plugins.produces(Y.Color,...iO),e.water=this._plugins.produces(Y.Normal,be.DRAPED_WATER),this._bindParameters.hasOccludees=this._plugins.hasOccludees,this._requestRender()}updateAnimation(e,i){this._animationTimer??=new FIt(e.camera,i),this._animationTimer.advance(e.camera,i,this._animationTimeDilation),e.forcedAnimationTime!=null&&this._animationTimer.forceTime(e.forcedAnimationTime);const r=this._hasAnimations;return this._hasAnimations=this._plugins.updateAnimation(this._animationTimer),this._hasAnimations=this._nodes.updateAnimation(this._animationTimer)||this._hasAnimations,this._hasAnimations!==r&&(this._gpuTimerHandle=r?Hi(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get _animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}tick(){this.fboCache.clean()}render(e,i,r=Pp.Default,s=!1){try{return this._isRendering=!0,this._render(e,i,r,s)}catch(n){console.error(`Exception during rendering: ${n}`)}finally{this._isRendering=!1}return new sye(this._pluginInput.get(tr.FINAL),null)}_updateHUDOccludedFragmentOpacity(e,i){const{idleOpacity:r,navigatingOpacity:s,maxDelta:n,tiltFadeStart:o,tiltFadeEnd:a,altitudeStart:l,altitudeEnd:c}=sRt,h=this._stage.view,d=h.stateManager.camera,f=h.qualitySettings.fadeDuration,m=e===ai.IDLE?r:s,y=ce((d.tilt-o)/(a-o),0,1),v=ce((d.position.z??0-l)/(c-l),0,1),_=dt(dt(1,m,y),1,v),b=this._bindParameters.hudOccludedFragmentOpacity;if(f<=0||b===_||this._lastFrameTime===0||this._lastFrameTime>i)return this._bindParameters.hudOccludedFragmentOpacity=_,void(this._lastFrameTime=i);const w=i-this._lastFrameTime;this._lastFrameTime=i;const x=Math.min(Math.abs(r-s)*w/f,n);x>=Math.abs(_-b)?this._bindParameters.hudOccludedFragmentOpacity=_:(this._bindParameters.hudOccludedFragmentOpacity=b+Math.sign(_-b)*x,this._requestRender())}_render(e,i,r=Pp.Default,s){this.performanceInfo.startFrame(),this.fboCache.frameStart(),this.fboCache.interactive=r===Pp.Default,this._disposeBindBuffers();const{camera:n,contentCamera:o,mode:a,alignPixelEnabled:l}=e;this._state.value=a;const c=this._nodes.produces("magnifier-color"),h=this._nodes.produces(tr.FINAL),d=this._nodes.require("emissive",tr.FINAL,tr.COMPOSITE)>0&&this._plugins.hasEmissions,f=d?Y.ColorEmission:Y.Color;this._renderContext.time=i,this._renderContext.output=f,this._bindParameters.oitPass=bi.NONE,this._bindParameters.alignPixelEnabled=l,this._bindParameters.decorations=!s,this._bindParameters.mainDepth=null,this._bindParameters.slicePlane=this._sliceHelper.plane,this._bindParameters.viewshedEnabled=this._nodes.produces(ut.VIEWSHED),this._renderOverlay(i),n.setGLViewport(this._rctx);const m=this._framebuffer,y=m.initialize(n.fullWidth,n.fullHeight,this._backgroundColor,d);this.hasReflections?(y?.setName("last frame color"),this._bindParameters.ssr.lastFrameColor=y):y?.release(),this._ensureBindParametersCamera(n,o),this._updateHUDOccludedFragmentOpacity(a,i),this._plugins.prepareRender(),this._bindParameters.shadowHighlightsVisible=this._needsShadowHighlight&&!s;const v=this._highQualityTransparency&&this._hasTransparentTerrain,_=this._plugins.produces(Y.Color,...tO);this._precompilePrepasses(),this.performanceInfo.advance(Es.PREPARE);const b=this._computeDepthRange(n);this._renderShadowMap(n,this._bindParameters.lighting.mainLight.direction,b),this._ensureBindParametersCamera(n,o),this._pluginInput.set("normals",this._renderNormals()),this._renderRemainingGeometryDepth(),this._renderShadowAccumulation(b,n,o),this._ensureBindParametersSSR(i),this._precompileShaders(v,_,f),this._renderContext.output=f,m.bind(),this._bindParameters.mainDepth=m.depth.attachment;const w=this.plugins.produces(Y.Color,...Hq);w&&this._renderOpaqueGeometry(),m.update(F=>this._renderNodes(tr.OPAQUE,F,w)),this.fboCache.debugCallback?.(tr.OPAQUE,m.color.fbo),m.update(F=>this._renderNodes(ut.OPAQUE_ENVIRONMENT,F)),this.fboCache.debugCallback?.(ut.OPAQUE_ENVIRONMENT,m.color.fbo),this._renderTerrainDepth(v),this._renderEdges(td.OPAQUE),m.bind(),this._renderPlugins(be.VOXEL,Es.VOXEL),this._renderHiddenTransparentEdges(),_&&(this._oitEnabled?this._renderOIT(cC.Geometry,f):this._renderTransparentGeometry()),m.update(F=>this._renderNodes(tr.TRANSPARENT,F,_)),this.fboCache.debugCallback?.(tr.TRANSPARENT,m.color.fbo),this._renderGeometryDepth(v),this._renderHUDVisibility(),v||this._plugins.render(this._pluginInput,be.LINE_CALLOUTS),this._renderEdges(td.TRANSPARENT);const x=this._hasTransparentTerrain?this._renderTransparentTerrain():null;x&&(this.performanceInfo.advance(Es.TRANSPARENT_TERRAIN),this._bindParameters.hudVisibility&&(v?this._renderLineCallouts(da.Occluded):(this._rctx.bindFramebuffer(this._bindParameters.hudVisibility?.fbo),this._compositingHelper.compositeHUD(this._bindParameters,x.getTexture())),this._renderHUD(da.Occluded,m.color,f))),this._bindParameters.cullAboveTerrain=!1,x&&(m.bind(),this._compositingHelper.compositePreMultipliedAlpha(this._bindParameters,x.getTexture()),x.release(),v&&(this._renderEdges(td.OPAQUE),_&&(this._oitEnabled?this._renderOIT(cC.Geometry,f):this._renderTransparentGeometry(),this.performanceInfo.advance(Es.TRANSPARENT)),this._renderEdges(td.TRANSPARENT))),this._bindParameters.ssao=Dr(this._bindParameters.ssao),v&&this._renderLineCallouts(da.NotOccluded),this._bindParameters.terrainDepthTest=!1,this._renderTransparentEnvironment(),this._pluginInput.set(ut.FOCUSAREA,this._renderFocusAreaGeometry()),m.update(F=>this._renderNodes(ut.TRANSPARENT_ENVIRONMENT,F)),m.update(F=>this._renderNodes(ut.VIEWSHED,F)),m.update(F=>this._renderNodes(ut.LASERLINES,F)),m.update(F=>this._renderNodes(ut.OCCLUDED,F)),this._pluginInput.set("highlights",this._renderHighlightPrepass());const S=r===Pp.ObjectAndLayerID?this._renderObjectAndLayerIdColor():null;m.update(F=>this._renderNodes(tr.COMPOSITE,F)),this._pluginInput.release(ut.FOCUSAREA);const C=!(r!==Pp.Default||h||c&&!s),T=this._pluginInput.get(tr.COMPOSITE),M=C?Q_:this.fboCache.acquire(T.fbo.width,T.fbo.height,ut.ANTIALIASING),I=this._nodes.produces(ut.ANTIALIASING)?this._renderNodes(ut.ANTIALIASING,M):this._blitFBO(T,M,!1);let P;this._pluginInput.set(ut.ANTIALIASING,I),this._hasHUDHighlights?(this._renderHUD(da.NotOccluded,I,f),P=this._renderNodes(ut.HIGHLIGHTS,I)):(P=this._renderNodes(ut.HIGHLIGHTS,I),this._renderHUD(da.NotOccluded,P,f));const D=this._renderNodes(ut.MAGNIFIER,P);return c&&!s&&r===Pp.Default&&!h&&this._blitFBO(D),h?(D.attachDepth(m.depth),this._blitFBO(this._renderNodes(tr.FINAL,D)),D.detachDepth()):this._pluginInput.set(tr.FINAL,D),this._pluginInput.release("highlights"),this.onPostRender&&this.onPostRender(),this._releaseFBOs(),m.releaseDepth(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this.fboCache.frameEnd(),this.performanceInfo.finishFrame(),r!==Pp.Default&&(this._releaseFBOs(),this._disposeOffscreenBuffers()),new sye(this._pluginInput.get(tr.FINAL),S)}_precompileShaders(e,i,r){if(++this._plugins.context.techniques.precompiling,this._renderContext.output=r,this._precompileOpaqueGeometry(),this._nodes.precompile(ut.OPAQUE_ENVIRONMENT),this._bindParameters.terrainDepthTest=e,this._bindParameters.cullAboveTerrain=e,this._renderContext.output=Y.Depth,this._plugins.precompile(be.TRANSPARENT_TERRAIN),e&&(this._precompileOpaqueGeometry(),this._precompileTransparentGeometry()),this._renderContext.output=r,this._plugins.precompile(be.TRANSPARENT_TERRAIN),i&&(this._precompileTransparentGeometry(),this._hasTransparentTerrain&&(this._bindParameters.cullAboveTerrain=!1,this._precompileTransparentGeometry(),this._bindParameters.cullAboveTerrain=e)),this._nodes.precompile(ut.FOCUSAREA),this._needsHUDVisibility&&this._plugins.precompile(be.OCCLUSION_PIXELS),this._plugins.precompile(be.LINE_CALLOUTS),this._precompileHUD(da.Occluded),this._bindParameters.terrainDepthTest=!1,this._bindParameters.cullAboveTerrain=!1,this._nodes.precompile(ut.VIEWSHED,ut.LASERLINES,ut.OCCLUDED,ut.ANTIALIASING,ut.HIGHLIGHTS),this._precompileHUD(da.NotOccluded),this._hasHighlights){const s=this._bindParameters;s.highlights.forEach((n,o)=>{s.highlightLevel=o,this._precompileAllGeometry(Y.Highlight)}),s.highlightLevel=null}this._nodes.precompile(tr.COMPOSITE,ut.MAGNIFIER),this._shadowAccumulator.precompile(),this._plugins.precompile(be.TRANSPARENT_MATERIAL_WITHOUT_DEPTH),--this._plugins.context.techniques.precompiling}_updateHighlights(){const e=this._stage.view.state;this._renderers.forEach(i=>i.updateHighlights(e.highlightOrderMap))}_renderFocusAreaGeometry(){if(!this._nodes.produces(ut.FOCUSAREA))return null;const{width:e,height:i}=this._framebufferSize;let r=this.fboCache.acquire(e,i,ut.FOCUSAREA);return r=this._nodes.render(r,this._pluginInput),this.performanceInfo.advance(Es.FOCUS_AREA_MASK),r}_renderObjectAndLayerIdColor(){if(!this._nodes.produces("olid"))return null;const e=this._renderContext.output;++this._techniques.precompiling;const i=this._framebufferSize;let r=this.fboCache.acquire(i.width,i.height,"olid");return r.acquireDepth(jo.DEPTH_STENCIL_TEXTURE),r=this._nodes.render(r,this._pluginInput),--this._techniques.precompiling,this.performanceInfo.advance(Es.OBJECT_AND_LAYER_ID_COLOR),this._renderContext.output=e,r}finish(e){this._hasAnimations||this._animationTimestep.clear();const i=this.performanceInfo.gpuSamplingEnabled,r=e===bt.BACKGROUND;if(r||i){const s=r?this.performanceInfo.elapsedTime:0;let n=0;i?n=this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.finish();const o=Math.max(s,n);this._animationTimestep.frame(o,r)}}readMainDepth(e,i){const{mainDepth:r,camera:s}=this._bindParameters;if(!r)return;const n=this.fboCache.acquire(this._framebufferSize.width,this._framebufferSize.height,"linear-depth");this._rctx.bindFramebuffer(n.fbo),s.setGLViewport(this._rctx),this._rctx.setScissorRect(e[0],e[1],e[2],e[3]),this._rctx.setScissorTestEnabled(!0),this._rctx.clearFramebuffer(sn),this._compositingHelper.blitDepthToLinearDepth(this._bindParameters,r),this._rctx.setScissorTestEnabled(!1),this._rctx.setScissorRect(0,0,this._rctx.gl.canvas.width,this._rctx.gl.canvas.width),n.fbo?.readPixels(e[0],e[1],e[2],e[3],vt.RGBA,Ya.UNSIGNED_BYTE,i),n.release()}readHUDVisibility(e,i,r,s,n){this._bindParameters.hudVisibility?.fbo?.readPixels(e,i,r,s,vt.RGBA,Ya.UNSIGNED_BYTE,n)}readAccumulatedShadow(e){return this._shadowAccumulator.readAccumulatedShadow(e[0],e[1])}_renderEdges(e){const i=this._edgeView;if(!i?.shouldRender())return;const r=this._framebufferSize,s=this.fboCache.acquire(r.width,r.height,"edges"),n=()=>i.render(this._bindParameters,e),o=this._bindParameters.geometryDepth;this.renderToTargets(n,s,o??this._framebuffer.depth,sn),this._framebuffer.bind(),this._compositingHelper.composite(this._bindParameters,s.getTexture()),s.release(),this.performanceInfo.advance(e===td.OPAQUE?Es.OPAQUE_EDGES:Es.TRANSPARENT_EDGES)}_renderOverlay(e){this._bindParameters.overlay=this.overlay?.render(e),this._bindParameters.overlay&&this.performanceInfo.advance(Es.OVERLAY)}_renderShadowMap(e,i,r){if(!this.shadowsEnabled)return;const s=this._shadowMap;s.start(e,i,r,this.isFeatureEnabled(js.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._needsShadowHighlight?(this._renderShadowCascades(Y.ShadowHighlight,this._shadowMap),s.moveSnapshot(pS.Highlight),this._renderShadowCascades(Y.ShadowExcludeHighlight,this._shadowMap),s.copySnapshot(pS.ExcludeHighlight),this._renderShadowCascades(Y.ShadowHighlight,this._shadowMap)):this._renderShadowCascades(Y.Shadow),s.finish(),e.setGLViewport(this._rctx),this.performanceInfo.advance(Es.SHADOW_MAP)}_precompileShadowCascades(e){for(const i of this._shadowMap.cascades)i.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(i.camera,i.camera),this._precompileAllGeometry(e)}_renderShadowCascades(e,i=this._shadowMap){for(const r of i.cascades)r.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(r.camera,r.camera),this.renderAllGeometry(e)}get _needsDepth(){return this._plugins.consumes(Y.Depth)||this._nodes.requireGeometryDepth()||this.hasReflections||this._needsShadowHighlight||this._needsShadowAccumulation||this._debugNeedsDepth}_renderRemainingGeometryDepth(){const e=this._pluginInput.get("normals");if(e){const i=this._needsDepth?e.getAttachment(nS):null;i?.retain(),this._pluginInput.set(ut.SSAO,this._renderSSAO()),this._renderGeometryWithoutNormalsDepth(i)}else this._renderAllGeometryDepth()}_renderGeometryWithoutNormalsDepth(e){if(!this._needsDepth||!e)return void(this._bindParameters.depth=Dr(this._bindParameters.depth));const i=this._framebufferSize,r=this.fboCache.acquire(i.width,i.height,"depth");r.attachDepth(e),e.release(),this._rctx.bindFramebuffer(r.fbo),this._rctx.clear(Si.STENCIL),this._renderGeometryWithoutNormals(Y.Depth),Dr(this._bindParameters.depth),this._bindParameters.depth=r.obtainDepthTexture(),r.release(),this.performanceInfo.advance(Es.DEPTH)}_renderAllGeometryDepth(){if(!this._needsDepth)return void(this._bindParameters.depth=Dr(this._bindParameters.depth));const e=this._framebufferSize,i=this.fboCache.acquire(e.width,e.height,"depth").acquireDepth(jo.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(i.fbo),this._rctx.clear(Si.DEPTH|Si.STENCIL),this.renderAllGeometry(Y.Depth),Dr(this._bindParameters.depth),this._bindParameters.depth=i.obtainDepthTexture(),i.release(),this.performanceInfo.advance(Es.DEPTH)}_renderTerrainDepth(e){if(this._bindParameters.terrainDepthTest=e,this._bindParameters.cullAboveTerrain=e,!e)return void(this._bindParameters.terrainDepth=Dr(this._bindParameters.terrainDepth));const i=this._renderContext.output;this._renderContext.output=Y.Depth;const r=this._framebufferSize,s=this.fboCache.acquire(r.width,r.height,"terrain depth").acquireDepth(jo.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(s.fbo),this._rctx.clear(Si.DEPTH|Si.STENCIL),this._renderTransparentTerrain(),Dr(this._bindParameters.terrainDepth),this._bindParameters.terrainDepth=s.obtainDepthTexture(),this._renderContext.output=i,s.release()}_renderGeometryDepth(e){if(!e)return void(this._bindParameters.geometryDepth=Dr(this._bindParameters.geometryDepth));const i=this._renderContext.output,{width:r,height:s}=this._framebufferSize,n=this.fboCache.acquire(r,s,"geometry depth").acquireDepth(jo.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(n.fbo),this._rctx.clear(Si.DEPTH|Si.STENCIL),this._renderOpaqueAndTransparentGeometry(Y.Depth),this._renderContext.output=i,Dr(this._bindParameters.geometryDepth),this._bindParameters.geometryDepth=n.obtainDepthTexture(),n.release()}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowAccumulation}_computeDepthRange(e){if(!this._needsDepthRange)return su.zero;const i=ZIt(e,this._plugins.plugins,this._stage.layers);return i.union(this._plugins.queryDepthRange(e)),i.near=Math.max(e.near,i.near),i.far=Math.min(e.far,i.far),i}get _normalsRequired(){const e=this._nodes.require("normals",tr.FINAL,tr.COMPOSITE,tr.OPAQUE,tr.TRANSPARENT,ut.VIEWSHED,ut.LASERLINES);return(this.hasSSAO?1:0)+e}_precompilePrepasses(){this._normalsRequired&&this._precompileAllGeometry(Y.Normal),this._needsDepth&&this._precompileAllGeometry(Y.Depth),this.shadowsEnabled&&(this._needsShadowHighlight?(this._precompileShadowCascades(Y.ShadowHighlight),this._precompileShadowCascades(Y.ShadowExcludeHighlight),this._precompileShadowCascades(Y.ShadowHighlight)):this._precompileShadowCascades(Y.Shadow)),this._needsShadowAccumulation&&this._precompileAllGeometry(Y.Shadow)}_renderNormals(){const e=this._normalsRequired;if(e===0)return;const i=this._framebufferSize,r=this.fboCache.acquire(i.width,i.height,"normals",fr.RGBA);r.acquireDepth(jo.DEPTH_STENCIL_TEXTURE),this._rctx.bindFramebuffer(r.fbo),this._rctx.clearFramebuffer(sn,!0,!0),this._renderGeometryWithNormals(Y.Normal);const s=this._nodes.optional("normals",tr.FINAL,tr.COMPOSITE,tr.OPAQUE,tr.TRANSPARENT,ut.VIEWSHED);return r.retain(e+s-1),this.performanceInfo.advance(Es.NORMALS),r}_renderSSAO(){const e=this._pluginInput.get("normals");if(!this.hasSSAO||!e)return void e?.detachDepth();Q_.setName(ut.SSAO);const i=this._nodes.render(Q_,this._pluginInput);return this._bindParameters.ssao=i,e.detachDepth(),this._pluginInput.release("normals"),this.performanceInfo.advance(Es.SSAO),i}_precompileAllGeometry(e){const i=this._renderContext.output;this._renderContext.output=e,this._precompileOpaqueGeometry(),this._precompileTransparentGeometry(),this._plugins.precompile(be.TRANSPARENT_TERRAIN),this._renderContext.output=i}renderAllGeometry(e){this._renderContext.output=e,this._renderOpaqueAndTransparentGeometry(e),this._renderTransparentTerrain()}precompileSlots(e,...i){for(const r of i)this._bindParameters.slot=r,e.precompile(this._renderContext)}precompileOccludedSlots(e,i){for(const r of i)this._renderContext.renderOccludedMask=r,this.precompileSlots(e,...N0e);this._renderContext.renderOccludedMask=kC}renderSlots(e,...i){for(const r of i)this._bindParameters.slot=r,e.forAll(s=>{const n=s.acquireTechniques(this._renderContext);n&&s.render(this._renderContext,n,this._pluginInput)})}renderOccludedSlots(e,i){this._renderContext.renderOccludedMask=i,this.plugins.renderOccludedFlags>Er.Occlude&&this._plugins.render(this._pluginInput,be.OCCLUDED_TERRAIN),this.renderSlots(e,...N0e),this._renderContext.renderOccludedMask=kC}renderHUD(e){this._bindParameters.hudRenderStyle=e,this._plugins.render(this._pluginInput,be.HUD_MATERIAL)}precompileViewshedShadowMap(){this._precompileAllGeometry(Y.ViewshedShadow)}renderViewshedShadowMap(e){const{camera:i,contentCamera:r}=this._bindParameters,s=this._renderContext.output;e.setGLViewport(this._rctx),this._ensureBindParametersCamera(e,e),this.renderAllGeometry(Y.ViewshedShadow),this._ensureBindParametersCamera(i,r),this._bindParameters.camera.setGLViewport(this._rctx),this._renderContext.output=s}_renderOpaqueAndTransparentGeometry(e){this._renderContext.output=e,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderGeometryWithNormals(e){this._renderContext.output=e,this._plugins.render(this._pluginInput,...wRt),this._renderTransparentTerrain()}_renderGeometryWithoutNormals(e){this._renderContext.output=e,this._plugins.render(this._pluginInput,...xRt)}_precompileOpaqueGeometry(){this._plugins.precompile(...Hq)}_renderOpaqueGeometry(){this._plugins.render(this._pluginInput,...Hq)}_renderTransparentGeometry(){this._plugins.render(this._pluginInput,...tO)}get _hasTransparentTerrain(){return this._plugins.produces(Y.Color,be.TRANSPARENT_TERRAIN)}_renderTransparentTerrain(){const e=()=>this._plugins.render(this._pluginInput,be.TRANSPARENT_TERRAIN);if(!_s(this._renderContext.output))return void e();const i=this._framebufferSize,r=this.fboCache.acquire(i.width,i.height,"transparent terrain");return this.renderToTargets(e,r,this._framebuffer.depth,sn),r}get _needsHUDVisibility(){return this._plugins.produces(this._renderContext.output,be.OCCLUSION_PIXELS)}_renderHUDVisibility(){if(!this._needsHUDVisibility)return void(this._bindParameters.hudVisibility=Dr(this._bindParameters.hudVisibility));const{width:e,height:i}=this._framebufferSize;let r=this._bindParameters.hudVisibility;r?.fbo?.width===e&&r?.fbo?.height===i||(r?.release(),r=this.fboCache.acquire(e,i,"hud visibility",fr.RGBA4),this._bindParameters.hudVisibility=r);const s=this._bindParameters.geometryDepth;r.attachDepth(s||this._framebuffer.depth),this._rctx.bindFramebuffer(r.fbo),this._rctx.clearFramebuffer([0,1,0,1]),this._plugins.render(this._pluginInput,be.OCCLUSION_PIXELS),r.detachDepth(),this._framebuffer.bind(),this.performanceInfo.advance(Es.HUD_VISIBILITY)}_renderLineCallouts(e){if(this._bindParameters.hudRenderStyle=e,e===da.Occluded){const i=()=>this._plugins.render(this._pluginInput,be.LINE_CALLOUTS),r=this._framebufferSize,s=this.fboCache.acquireDepth(jo.DEPTH16_BUFFER,r.width,r.height,"line callouts");this.renderToTargets(i,this._framebuffer.color,s,void 0,!0,!0),s.release()}else this._plugins.render(this._pluginInput,be.LINE_CALLOUTS)}_precompileHUD(e){if(this._precompileHUDOutput(e),this._hasHighlights){const i=this._renderContext.output;this._renderContext.output=Y.Highlight,this._precompileHUDOutput(e),this._renderContext.output=i}}_precompileHUDOutput(e){const i=this._bindParameters.hudRenderStyle;this._bindParameters.hudRenderStyle=e,this._oitEnabled&&_s(this._renderContext.output)?(this._bindParameters.oitPass=bi.ColorAlpha,this._plugins.precompile(...iO),this._bindParameters.oitPass=bi.FrontFace,this._plugins.precompile(...iO),this._bindParameters.oitPass=bi.NONE):this._plugins.precompile(...iO),this._bindParameters.hudRenderStyle=i}_renderHUD(e,i,r){if(this._pluginsHas.hudElements){if(this._oitEnabled){const s=this._renderOIT(cC.HUD,r,e);this._rctx.bindFramebuffer(i.fbo),this._compositingHelper.compositePreMultipliedAlpha(this._bindParameters,s.getTexture()),s.release()}else if(this._renderContext.output=r,e===da.Occluded){const s=()=>this._renderHUDElements(e),n=this._framebufferSize,o=this.fboCache.acquireDepth(jo.DEPTH16_BUFFER,n.width,n.height,"hud");this.renderToTargets(s,this._framebuffer.color,o,void 0,!0,!0),o.release()}else i.acquireDepth(jo.DEPTH16_BUFFER),this._rctx.bindFramebuffer(i.fbo),this._renderHUDElements(e),i.detachDepth();this.performanceInfo.advance(e===da.Occluded?Es.HUD_OCCLUDED:Es.HUD)}}_renderHUDElements(e){this._bindParameters.hudRenderStyle=e,this._plugins.render(this._pluginInput,...iO)}get _needsShadowHighlight(){return this.shadowsEnabled&&this._plugins.produces(Y.ShadowHighlight,be.OPAQUE_MATERIAL)}_renderHighlightPrepass(){if(!this._hasHighlights)return;const{fboCache:e,_rctx:i,_bindParameters:r}=this,s=this._framebufferSize,n=e.acquire(s.width,s.height,"highlights",fr.RG);return n.acquireDepth(jo.DEPTH_STENCIL_TEXTURE),i.bindFramebuffer(n.fbo),i.clearFramebuffer(sn,!0),this._renderContext.output=Y.Highlight,i.bindFramebuffer(n.fbo),w3e(i,e,s,r,()=>this._renderHighlightGeometries()),this.performanceInfo.advance(Es.HIGHLIGHTS),n}_renderHighlightGeometries(){this._plugins.render(this._pluginInput,...SRt),this._rctx.clear(Si.DEPTH),this._renderHUDElements(da.Both)}get _needsShadowAccumulation(){return this._shadowAccumulator.accumulating}_renderShadowAccumulation(e,i,r){this._needsShadowAccumulation&&this._bindParameters.depth&&this._shadowAccumulator.renderAccumulation(this._bindParameters.depth,e,i,r)&&this.performanceInfo.advance(Es.ACCUMULATED_SHADOWS)}_precompileTransparentGeometry(){this._oitEnabled&&_s(this._renderContext.output)?(this._bindParameters.oitPass=bi.ColorAlpha,this._plugins.precompile(...tO),this._bindParameters.oitPass=bi.FrontFace,this._plugins.precompile(...tO),this._bindParameters.oitPass=bi.NONE):this._plugins.precompile(...tO)}_renderOIT(e,i,r=da.Both){const s=e===cC.HUD,n=this._framebufferSize,o=s?this.fboCache.acquire(n.width,n.height,"oit hud composite"):null,a=s?()=>this._renderHUDElements(r):()=>this._renderTransparentGeometry(),l=this._bindParameters,c=this._renderContext.output;this._renderContext.output=i,l.oitPass=bi.ColorAlpha;const h=o?"oit hud color+alpha":"oit color+alpha",d=this.fboCache.acquire(n.width,n.height,h,fr.RGBA16F),f=i===Y.ColorEmission;f&&d.acquireColor(rr.COLOR_ATTACHMENT1,fr.RGBA16F,"emissive"),d.acquireColor(f?rr.COLOR_ATTACHMENT2:rr.COLOR_ATTACHMENT1,fr.R16F),o||d.attachDepth(this._framebuffer.depth),this._rctx.bindFramebuffer(d.fbo),this._rctx.clearFramebuffer([0,0,0,1]),f&&this._rctx.gl.clearBufferfv(this._rctx.gl.COLOR,1,yoe),a(),d.detachDepth(),l.oitPass=bi.FrontFace;const m=this.fboCache.acquire(n.width,n.height,o?"oit hud front":"oit front");return f&&m.acquireColor(rr.COLOR_ATTACHMENT1,fr.RGBA,"emissive"),o?m.acquireDepth(jo.DEPTH16_BUFFER):m.attachDepth(this._framebuffer.depth),this._rctx.bindFramebuffer(m.fbo),this._rctx.clearFramebuffer(sn,!!o),a(),m.detachDepth(),l.oitPass=bi.NONE,o?(this._rctx.bindFramebuffer(o.fbo),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clear(Si.COLOR)):this._framebuffer.bind(),this._oitblend??=new NIt(this._techniques),this._oitblend.blend(this._rctx,d,m,l,f),o?.detachDepth(),m.release(),d.release(),this._renderContext.output=c,o}_renderTransparentEnvironment(){this._shadowAccumulator.render(this._bindParameters),this.performanceInfo.advance(Es.APPLY_ACCUMULATED_SHADOWS),this._framebuffer.bind(),this._plugins.render(this._pluginInput,be.TRANSPARENT_MATERIAL_WITHOUT_DEPTH),this.performanceInfo.advance(Es.TRANSPARENT_MATERIAL_WITHOUT_DEPTH)}_renderPlugins(e,i){this._plugins.produces(this._renderContext.output,e)&&(this._plugins.render(this._pluginInput,e),this.performanceInfo.advance(i))}_renderNodes(e,i,r=!1){if(i.setName(e),this._pluginInput.set(e,i),!this._nodes.produces(e))return r&&this.performanceInfo.advance(e),i;const s=this._nodes.render(i,this._pluginInput,this._releaseNormals);return this.performanceInfo.advance(e),s}_blitFBO(e,i=Q_,r=!0){return this._blit??=new bke(this._techniques),this._blit.blit(this._rctx,e,i,this._bindParameters),this._pluginInput.set(e.name,i),r&&e.release(),i}_ensureBindParametersCamera(e,i){this._bindParameters.camera=e,this._bindParameters.contentCamera=i}_ensureBindParametersSSR(e){if(this._bindParameters.ssr.lastFrameColor){this._ssrEnableTime==null&&(this._ssrEnableTime=e),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=Kn:(Sl(k0e,this._bindParameters.camera.viewMatrix),Sl(F0e,this._bindParameters.camera.projectionMatrix),kn(eE,k0e,F0e),kn(eE,this._renderContext.lastFrameCamera.viewMatrix,eE),kn(eE,this._renderContext.lastFrameCamera.projectionMatrix,eE),this._reprojectionMatrix=eE);const i=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=i>0?Math.min(i,e-this._ssrEnableTime)/i:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=Kn,this._ssrEnableTime=null}addRenderNode(e){this._nodes.add(e),this._requestRender()}removeRenderNode(e){this._nodes.remove(e),this._requestRender()}updateLighting(e,i,r,s){this._bindParameters.updateLighting(e,i,r,s),this._requestRender(bt.UPDATE)}get usedMemory(){return{fbos:this.fboCache.usedMemory,plugins:this._plugins.usedMemory,edges:this.edgeView?.usedMemory??0}}renderToTargets(e,i,r,s,n=!1,o=!1){i.attachDepth(r),this._rctx.bindFramebuffer(i.fbo),this._rctx.clearFramebuffer(s,n,o),e(),i.detachDepth()}get test(){}}var cC;u([p({readOnly:!0})],M5.prototype,"fullResolutionAtmosphere",null),u([p()],M5.prototype,"_edgeView",void 0),u([p()],M5.prototype,"updating",null),function(t){t[t.Geometry=0]="Geometry",t[t.HUD=1]="HUD"}(cC||(cC={}));const wRt=[be.INTEGRATED_MESH,be.OPAQUE_TERRAIN,be.OPAQUE_MATERIAL,be.TRANSPARENT_MATERIAL],xRt=[be.OPAQUE_MATERIAL_WITHOUT_NORMALS,be.TRANSPARENT_MATERIAL_WITHOUT_NORMALS],Hq=[be.INTEGRATED_MESH,be.OPAQUE_TERRAIN,be.OPAQUE_MATERIAL,be.OPAQUE_MATERIAL_WITHOUT_NORMALS],tO=[be.TRANSPARENT_MATERIAL,be.TRANSPARENT_MATERIAL_WITHOUT_NORMALS],N0e=[be.OPAQUE_MATERIAL,be.TRANSPARENT_MATERIAL,be.TRANSPARENT_MATERIAL_WITHOUT_DEPTH],iO=[be.LINE_CALLOUTS_HUD_DEPTH,be.HUD_MATERIAL,be.LABEL_MATERIAL],SRt=[be.TRANSPARENT_MATERIAL,be.TRANSPARENT_MATERIAL_WITHOUT_NORMALS,be.OPAQUE_MATERIAL,be.OPAQUE_MATERIAL_WITHOUT_NORMALS,be.TRANSPARENT_TERRAIN,be.INTEGRATED_MESH,be.OPAQUE_TERRAIN],F0e=Ve(),k0e=Ve(),eE=Ve();function TRt(t){return e=>t.immediate.schedule(e)}let ERt=class{constructor(e){this._rctx=e,this._vao=CRt(e)}destroy(){this._vao=Rt(this._vao)}draw(){this._vao!=null&&(this._rctx.bindVAO(this._vao),this._rctx.drawArrays(Ui.TRIANGLES,0,3))}get test(){}};function CRt(t,e=b3e,i=hg){const r=new Float32Array([-1,-1,3,-1,-1,3]);return new mg(t,i,new Map([["geometry",e]]),new Map([["geometry",Un.createVertex(t,Zs.STATIC_DRAW,r)]]))}let $Rt=class{constructor(e,i,r){this._rctx=e,this._locations=i,this._layout=r,this._cache=new XD(e.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(e){const i=e.toString();let r=this._cache.pop(i);return r||(r=new mg(this._rctx,this._locations,new Map([["geometry",this._layout]]),new Map([["geometry",Un.createVertex(this._rctx,Zs.STATIC_DRAW)]])),r.vertexBuffers.get("geometry")?.setSize(e),r)}deleteVao(e){if(e==null)return;const i=e.byteSize.toString();this._cache.put(i,e)}},Zke=class Yke{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:`#version 300 es
    precision highp float;

    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,fragment:`#version 300 es
    precision highp float;

    out vec4 fragColor;

    void main(void) {
      fragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`}}_createHelperProgram(){const e=Yke.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}_createIndexbuffer(){return Un.createIndex(this._rctx,Zs.STATIC_DRAW,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,ct.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(Ui.POINTS,1,Pi.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}get test(){}},z0e=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Ft.ONE,dstRGB:Ft.ZERO,srcAlpha:Ft.ONE,dstAlpha:Ft.ZERO},this.blendEquation={mode:uv.ADD,modeAlpha:uv.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=Yu.BACK,this.frontFace=I$.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=Ni.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:Yu.FRONT_AND_BACK,func:Ni.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:Yu.FRONT_AND_BACK,fail:Yi.KEEP,zFail:Yi.KEEP,zPass:Yi.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.transformFeedbackBuffer=null,this.uniformBufferBindingPoints=new Array,this.transformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.drawBuffers={defaultFramebuffer:[Va.BACK],fbos:new WeakMap},this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},ARt=class{constructor(){for(this._current=new Array,this._allocations=null;this._current.length<Hs.COUNT;)this._current.push(0)}increment(e,i,r=1){this._current[e]+=r,this._allocations?.add(i)}decrement(e,i,r=1){this._current[e]-=r,this._allocations?.remove(i)}get current(){return this._current}get total(){return this.current.reduce((e,i,r)=>e+(r<Hs.UNCOUNTED?i:0),0)}get resourceInformation(){let e="";if(this.total>0){e+=`Live objects:
`;for(let i=0;i<Hs.COUNT;++i){const r=this._current[i];r>0&&(e+=`${Hs[i]}: ${r}
`)}}return e+=this._allocations?.resetLog(),e}},MRt=class{constructor(e,i,r){const s=i.textureFilterAnisotropic,n=r.maxAnisotropy??1/0;this.versionString=e.getParameter(e.VERSION),this.maxVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=s?Math.min(e.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY),n):1,this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=e.getParameter(e.MAX_VIEWPORT_DIMS),this.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=e.getParameter(e.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=e.getParameter(e.MAX_SAMPLES),this.maxDrawBuffers=e.getParameter(e.MAX_DRAW_BUFFERS)}};const ORt=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"],IRt=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"],U0e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"],RRt=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"];var ep=999,B0e=9999,qq=0,Wq=1,V0e=2,j0e=3,G0e=4,BF=5,PRt=6,DRt=7,LRt=8,H0e=9,NRt=10,q0e=11,FRt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function kRt(){var t,e,i,r=0,s=0,n=ep,o=[],a=[],l=1,c=0,h=0,d=!1,f=!1,m="";return function(L){return a=[],L!==null?v(L.replace?L.replace(/\r\n/g,`
`):L):_()};function y(L){L.length&&a.push({type:FRt[n],data:L,position:h,line:l,column:c})}function v(L){var N;for(r=0,i=(m+=L).length;t=m[r],r<i;){switch(N=r,n){case qq:r=C();break;case Wq:r=S();break;case V0e:r=x();break;case j0e:r=T();break;case G0e:r=P();break;case q0e:r=I();break;case BF:r=D();break;case B0e:r=F();break;case H0e:r=w();break;case ep:r=b()}N!==r&&(m[N]===`
`?(c=0,++l):++c)}return s+=r,m=m.slice(r),a}function _(L){return o.length&&y(o.join("")),n=NRt,y("(eof)"),a}function b(){return o=o.length?[]:o,e==="/"&&t==="*"?(h=s+r-1,n=qq,e=t,r+1):e==="/"&&t==="/"?(h=s+r-1,n=Wq,e=t,r+1):t==="#"?(n=V0e,h=s+r,r):/\s/.test(t)?(n=H0e,h=s+r,r):(d=/\d/.test(t),f=/[^\w_]/.test(t),h=s+r,n=d?G0e:f?j0e:B0e,r)}function w(){return/[^\s]/g.test(t)?(y(o.join("")),n=ep,r):(o.push(t),e=t,r+1)}function x(){return t!=="\r"&&t!==`
`||e==="\\"?(o.push(t),e=t,r+1):(y(o.join("")),n=ep,r)}function S(){return x()}function C(){return t==="/"&&e==="*"?(o.push(t),y(o.join("")),n=ep,r+1):(o.push(t),e=t,r+1)}function T(){if(e==="."&&/\d/.test(t))return n=BF,r;if(e==="/"&&t==="*")return n=qq,r;if(e==="/"&&t==="/")return n=Wq,r;if(t==="."&&o.length){for(;M(o););return n=BF,r}if(t===";"||t===")"||t==="("){if(o.length)for(;M(o););return y(t),n=ep,r+1}var L=o.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||L){for(;M(o););return n=ep,r}return o.push(t),e=t,r+1}function M(L){for(var N,R,k=0;;){if(N=U0e.indexOf(L.slice(0,L.length+k).join("")),R=U0e[N],N===-1){if(k--+L.length>0)continue;R=L.slice(0,1).join("")}return y(R),h+=R.length,(o=o.slice(R.length)).length}}function I(){return/[^a-fA-F0-9]/.test(t)?(y(o.join("")),n=ep,r):(o.push(t),e=t,r+1)}function P(){return t==="."||/[eE]/.test(t)?(o.push(t),n=BF,e=t,r+1):t==="x"&&o.length===1&&o[0]==="0"?(n=q0e,o.push(t),e=t,r+1):/[^\d]/.test(t)?(y(o.join("")),n=ep,r):(o.push(t),e=t,r+1)}function D(){return t==="f"&&(o.push(t),e=t,r+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(o.push(t),e=t,r+1):/[^\d]/.test(t)?(y(o.join("")),n=ep,r):(o.push(t),e=t,r+1)}function F(){if(/[^\d\w_]/.test(t)){var L=o.join("");return n=IRt.indexOf(L)>-1?LRt:RRt.indexOf(L)>-1?DRt:PRt,y(o.join("")),n=ep,r}return o.push(t),e=t,r+1}}function zRt(t){var e=kRt(),i=[];return i=(i=i.concat(e(t))).concat(e(null))}function URt(t){return zRt(t)}function BRt(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const Zq=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]);function VRt(t,e="100",i="300 es"){const r=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of t)if(s.type==="preprocessor"){const n=r.exec(s.data);if(n){const o=n[1].replaceAll(/\s{2,}/g," ");if(o===i)return o;if(o===e)return s.data="#version "+i,e;throw new Error("unknown glsl version: "+o)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:`
`}),null}function jRt(t,e){for(let i=e-1;i>=0;i--){const r=t[i];if(r.type!=="whitespace"&&r.type!=="block-comment"){if(r.type!=="keyword")break;if(r.data==="attribute"||r.data==="in")return!0}}return!1}function PI(t,e,i,r){r=r||i;for(const s of t)if(s.type==="ident"&&s.data===i)return r in e?e[r]++:e[r]=0,PI(t,e,r+"_"+e[r],r);return i}function Jke(t,e,i="afterVersion"){function r(l,c){for(let h=c;h<l.length;h++){const d=l[h];if(d.type==="operator"&&d.data===";")return h}return null}function s(l){let c=-1,h=0,d=-1;for(let f=0;f<l.length;f++){const m=l[f];if(m.type==="preprocessor"&&(/#(if|ifdef|ifndef)\s+.+/.test(m.data)?++h:/#endif\s*.*/.test(m.data)&&--h),i!=="afterVersion"&&i!=="afterPrecision"||m.type==="preprocessor"&&m.data.startsWith("#version")&&(d=Math.max(d,f)),i==="afterPrecision"&&m.type==="keyword"&&m.data==="precision"){const y=r(l,f);if(y===null)throw new Error("precision statement not followed by any semicolons!");d=Math.max(d,y)}c<d&&h===0&&(c=f)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let a=s(t);o(a-1)&&t.splice(a++,0,n);for(const l of e)t.splice(a++,0,l);o(a-1)&&o(a)&&t.splice(a,0,n)}function GRt(t,e,i,r="lowp"){Jke(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function HRt(t,e,i,r,s="lowp"){Jke(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function qRt(t,e){let i,r,s=-1;for(let n=e;n<t.length;n++){const o=t[n];if(o.type==="operator"&&(o.data==="["&&(i=n),o.data==="]")){r=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return i&&r&&t.splice(i,r-i+1),s}function W0e(t,e){if(t.startsWith("#version 300"))return t;const i=URt(t);if(VRt(i,"100","300 es")==="300 es")return t;let r=null,s=null;const n={},o={};for(let a=0;a<i.length;++a){const l=i[a];switch(l.type){case"keyword":e===ju.VERTEX_SHADER&&l.data==="attribute"?l.data="in":l.data==="varying"&&(l.data=e===ju.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===ju.FRAGMENT_SHADER&&l.data==="gl_FragColor"&&(r||(r=PI(i,n,"fragColor"),GRt(i,r,"vec4")),l.data=r),e===ju.FRAGMENT_SHADER&&l.data==="gl_FragData"){const c=qRt(i,a+1),h=PI(i,n,"fragData");HRt(i,h,"vec4",c,"mediump"),l.data=h}else e===ju.FRAGMENT_SHADER&&l.data==="gl_FragDepthEXT"&&(s||(s=PI(i,n,"gl_FragDepth")),l.data=s);break;case"ident":if(ORt.includes(l.data)){if(e===ju.VERTEX_SHADER&&jRt(i,a))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in o||(o[l.data]=PI(i,n,l.data)),l.data=o[l.data]}}}for(let a=i.length-1;a>=0;--a){const l=i[a];if(l.type==="preprocessor"){const c=l.data.match(/#extension\s+(.*):/);if(c?.[1]&&Zq.has(c[1].trim())){const f=i[a+1];i.splice(a,f&&f.type==="whitespace"?2:1)}const h=l.data.match(/#ifdef\s+(.*)/);h?.[1]&&Zq.has(h[1].trim())&&(l.data="#if 1");const d=l.data.match(/#ifndef\s+(.*)/);d?.[1]&&Zq.has(d[1].trim())&&(l.data="#if 0")}}return WRt(t,BRt(i))}function WRt(t,e){return e}const ZRt=4294967295;let YRt=class{constructor(e,i,r,s,n=new Map,o=[]){this._context=e,this._locations=s,this._uniformBlockBindings=n,this._transformFeedbackVaryings=o,this._refCount=1,this._compiled=!1,this._linesOfCode=0,this._nameToUniformLocation=new Map,this._nameToUniform1=new Map,this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),i.length===0&&console.error("Shaders source should not be empty!"),i=W0e(i,ju.VERTEX_SHADER),r=W0e(r,ju.FRAGMENT_SHADER),this._vShader=Z0e(this._context,ju.VERTEX_SHADER,i),this._fShader=Z0e(this._context,ju.FRAGMENT_SHADER,r),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(Hs.Shader,this),dY()&&(this.vertexShader=i,this.fragmentShader=r),this.usedMemory=i.length+r.length;const a=this._context.gl,l=a.createProgram();a.attachShader(l,this._vShader),a.attachShader(l,this._fShader),this._locations.forEach((c,h)=>a.bindAttribLocation(l,c,h)),this._transformFeedbackVaryings?.length&&a.transformFeedbackVaryings(l,this._transformFeedbackVaryings,a.SEPARATE_ATTRIBS),a.linkProgram(l),dY()&&!a.getProgramParameter(l,a.LINK_STATUS)&&console.error(`Could not link shader
validated: ${a.getProgramParameter(l,a.VALIDATE_STATUS)}, gl error ${a.getError()}, vertex: ${a.getShaderParameter(this._vShader,a.COMPILE_STATUS)}, fragment: ${a.getShaderParameter(this._fShader,a.COMPILE_STATUS)}, info log: ${a.getProgramInfoLog(l)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`);for(const[c,h]of this._uniformBlockBindings){const d=a.getUniformBlockIndex(l,c);d<ZRt&&a.uniformBlockBinding(l,d,h)}this._glName=l,this._context.instanceCounter.increment(Hs.Program,this)}get glName(){return this._glName}get hasGLName(){return this._glName!=null}get hasTransformFeedbackVaryings(){return!!this._transformFeedbackVaryings?.length}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||this.glName==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl,i=this._context.instanceCounter;this._nameToUniformLocation.forEach(r=>r&&i.decrement(Hs.Uniform,r)),this._nameToUniformLocation.clear(),this._vShader&&(this._linesOfCode>0&&(i.decrement(Hs.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),e.deleteShader(this._vShader),this._vShader=null,i.decrement(Hs.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,i.decrement(Hs.Program,this))}ref(){++this._refCount}_getUniformLocation(e){const i=this._nameToUniformLocation.get(e);if(i!==void 0)return i;if(this.glName){const r=this._context.gl.getUniformLocation(this.glName,e);return this._nameToUniformLocation.set(e,r),r&&this._context.instanceCounter.increment(Hs.Uniform,r),r}return null}hasUniform(e){return this._getUniformLocation(e)!=null}setUniform1i(e,i){const r=this._nameToUniform1.get(e);r!==void 0&&i===r||(this._context.gl.uniform1i(this._getUniformLocation(e),i),this._nameToUniform1.set(e,i))}setUniform1iv(e,i){zf(this._nameToUniform1v,e,i)&&this._context.gl.uniform1iv(this._getUniformLocation(e),i)}setUniform2iv(e,i){zf(this._nameToUniform2,e,i)&&this._context.gl.uniform2iv(this._getUniformLocation(e),i)}setUniform3iv(e,i){zf(this._nameToUniform3,e,i)&&this._context.gl.uniform3iv(this._getUniformLocation(e),i)}setUniform4iv(e,i){zf(this._nameToUniform4,e,i)&&this._context.gl.uniform4iv(this._getUniformLocation(e),i)}setUniform1f(e,i){const r=this._nameToUniform1.get(e);r!==void 0&&i===r||(this._context.gl.uniform1f(this._getUniformLocation(e),i),this._nameToUniform1.set(e,i))}setUniform1fv(e,i){zf(this._nameToUniform1v,e,i)&&this._context.gl.uniform1fv(this._getUniformLocation(e),i)}setUniform2f(e,i,r){const s=this._nameToUniform2.get(e);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),this._nameToUniform2.set(e,[i,r])):i===s[0]&&r===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),s[0]=i,s[1]=r)}setUniform2fv(e,i){zf(this._nameToUniform2,e,i)&&this._context.gl.uniform2fv(this._getUniformLocation(e),i)}setUniform3f(e,i,r,s){const n=this._nameToUniform3.get(e);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,s),this._nameToUniform3.set(e,[i,r,s])):i===n[0]&&r===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,s),n[0]=i,n[1]=r,n[2]=s)}setUniform3fv(e,i){const r=this._getUniformLocation(e);r!=null&&zf(this._nameToUniform3,e,i)&&this._context.gl.uniform3fv(r,i)}setUniform4f(e,i,r,s,n){const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,s,n),this._nameToUniform4.set(e,[i,r,s,n])):o!==void 0&&i===o[0]&&r===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,s,n),o[0]=i,o[1]=r,o[2]=s,o[3]=n)}setUniform4fv(e,i){const r=this._getUniformLocation(e);r!=null&&zf(this._nameToUniform4,e,i)&&this._context.gl.uniform4fv(r,i)}setUniformMatrix3fv(e,i,r=!1){const s=this._getUniformLocation(e);s!=null&&zf(this._nameToUniformMatrix3,e,i)&&this._context.gl.uniformMatrix3fv(s,r,i)}setUniformMatrix4fv(e,i,r=!1){const s=this._getUniformLocation(e);s!=null&&zf(this._nameToUniformMatrix4,e,i)&&this._context.gl.uniformMatrix4fv(s,r,i)}stop(){}};function Z0e(t,e,i){const r=t.gl,s=r.createShader(e);return r.shaderSource(s,i),r.compileShader(s),dY()&&!r.getShaderParameter(s,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===ju.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(s)),console.error(JRt(i))),s}function JRt(t){let e=2;return t.replaceAll(`
`,()=>`
`+XRt(e++)+":")}function XRt(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function zf(t,e,i){const r=t.get(e);if(!r)return t.set(e,Array.from(i)),!0;const s=i.length;if(r.length!==s)return t.set(e,Array.from(i)),!0;for(let n=0;n<s;++n){const o=i[n];if(r[n]!==o){for(r[n]=o;n<s;++n)r[n]=i[n];return!0}}return!1}let KRt=class{constructor(e){this._rctx=e,this._store=new yv}dispose(){this._store.forAll(e=>e.dispose()),this._store.clear()}acquire(e,i,r,s){const n=this._store.get(e,i);if(n!=null)return n.ref(),n;const o=new YRt(this._rctx,e,i,r,s);return o.ref(),this._store.set(e,i,o),o}get test(){}},OG=class{constructor(){this._result=!1}dispose(){this._program=Rt(this._program)}get result(){return this._program!=null&&(this._result=this._test(this._program),this.dispose()),this._result}},QRt=class extends OG{constructor(e){super(),this._rctx=e,this._helperProgram=null,X("mac")&&X("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){super.dispose(),this._helperProgram?.dispose(),this._helperProgram=null}_test(e){const i=this._rctx,r=i.getBoundFramebufferObject(),{x:s,y:n,width:o,height:a}=i.getViewport();i.resetState();const l=new $r(1);l.wrapMode=nr.CLAMP_TO_EDGE,l.samplingMode=di.NEAREST;const c=new gg(i,l),h=Un.createIndex(this._rctx,Zs.STATIC_DRAW,new Uint8Array([0]));i.bindFramebuffer(c),i.setViewport(0,0,1,1),i.useProgram(this._helperProgram),i.bindBuffer(h,ct.ELEMENT_ARRAY_BUFFER),i.drawElements(Ui.POINTS,1,Pi.UNSIGNED_BYTE,0),i.useProgram(e),i.bindVAO(null),i.drawArrays(Ui.TRIANGLES,0,258);const d=new Uint8Array(4);return c.readPixels(0,0,1,1,vt.RGBA,Ya.UNSIGNED_BYTE,d),i.setViewport(s,n,o,a),i.bindFramebuffer(r),c.dispose(),h.dispose(),d[0]===255}_prepareProgram(){const i=`#version 300 es
    precision highp float;

    out float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${E.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,r=`#version 300 es
    precision highp float;

    in float triangleId;

    out vec4 fragColor;

    void main(void) {
      fragColor = triangleId == ${E.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(i,r,new Map([]))}_prepareHelperProgram(){const e=Zke.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}},ePt=class extends OG{constructor(e){super(),this._rctx=e,this._program=Y0e(this._rctx,!1),this._obfuscated=Y0e(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=Rt(this._obfuscated)}_test(e){if(X("force-double-precision-obfuscation"))return!0;if(this._obfuscated==null)return!1;const i=this._rctx,r=i.getBoundFramebufferObject(),{x:s,y:n,width:o,height:a}=i.getViewport(),l=this._runProgram(e),c=this._runProgram(this._obfuscated);return i.setViewport(s,n,o,a),i.bindFramebuffer(r),l!==0&&(c===0||l/c>5)}_runProgram(e){const i=this._rctx;i.resetState();const r=new $r(1);r.wrapMode=nr.CLAMP_TO_EDGE,r.samplingMode=di.NEAREST;const s=new gg(i,r),n=Un.createVertex(i,Zs.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new VD(i,new Map([["position",0]]),new Map([["geometry",[new gf("position",2,Pi.UNSIGNED_SHORT,0,4)]]]),new Map([["geometry",n]])),a=Le(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),l=Le(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),c=new Float32Array(6);bJ(a,c,3);const h=new Float32Array(6);bJ(l,h,3),i.useProgram(e),e.setUniform3f("u_highA",c[0],c[2],c[4]),e.setUniform3f("u_lowA",c[1],c[3],c[5]),e.setUniform3f("u_highB",h[0],h[2],h[4]),e.setUniform3f("u_lowB",h[1],h[3],h[5]),i.bindFramebuffer(s),i.setViewport(0,0,1,1),i.bindVAO(o),i.drawArrays(Ui.TRIANGLE_STRIP,0,4);const d=new Uint8Array(4);s.readPixels(0,0,1,1,vt.RGBA,Ya.UNSIGNED_BYTE,d),o.dispose(),s.dispose();const f=(a[2]-l[2])/25,m=Fre(d);return Math.abs(f-m)}};function Y0e(t,e){const i=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `;return t.programCache.acquire(i,`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `,new Map([["position",0]]))}let tPt=class extends OG{constructor(e){if(super(),this._rctx=e,!e.gl||!(e.capabilities.colorBufferFloat?.textureFloat&&e.capabilities.colorBufferFloat?.floatBlend))return;const i=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}_test(e){const i=this._rctx,r=new $r(1);r.wrapMode=nr.CLAMP_TO_EDGE,r.dataType=Ya.FLOAT,r.internalFormat=Qe.RGBA32F,r.samplingMode=di.NEAREST;const s=new gg(i,r),n=Un.createVertex(i,Zs.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new VD(i,new Map([["a_pos",0]]),new Map([["geometry",[new gf("a_pos",2,Pi.UNSIGNED_SHORT,0,4)]]]),new Map([["geometry",n]]));i.gl.getError(),i.useProgram(e);const a=i.getBoundFramebufferObject(),{x:l,y:c,width:h,height:d}=i.getViewport();i.bindFramebuffer(s),i.setViewport(0,0,1,1),i.bindVAO(o),i.drawArrays(Ui.TRIANGLE_STRIP,0,4);const f=_i({blending:ldt});i.setPipelineState(f),i.drawArrays(Ui.TRIANGLE_STRIP,0,4);const m=i.gl.getError();return i.setViewport(l,c,h,d),i.bindFramebuffer(a),o.dispose(),s.dispose(),m!==i.gl.INVALID_OPERATION||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}};const ahi=new Map([["geometry",[new gf("a_pos",2,Pi.BYTE,0,2)]]]),lhi=new Map([["geometry",[new gf("a_pos",2,Pi.BYTE,0,4),new gf("a_tex",2,Pi.BYTE,2,4)]]]),iPt=new Map([["geometry",[new gf("a_pos",2,Pi.UNSIGNED_SHORT,0,4)]]]);let rPt=class extends OG{constructor(e){super(),this._rctx=e;const i=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
    precision highp float;

    varying vec2 v_uv;

    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(e){const i=this._rctx;if(!i.gl)return e.dispose(),!0;const r=new $r(1);r.wrapMode=nr.CLAMP_TO_EDGE,r.samplingMode=di.NEAREST;const s=new gg(i,r),n=Un.createVertex(i,Zs.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new VD(i,new Map([["a_pos",0]]),iPt,new Map([["geometry",n]])),a=new $r;a.samplingMode=di.LINEAR,a.wrapMode=nr.CLAMP_TO_EDGE;const l=new yi(i,a,DI);i.useProgram(e),i.bindTexture(l,0),e.setUniform1i("u_texture",0);const c=i.getBoundFramebufferObject(),{x:h,y:d,width:f,height:m}=i.getViewport();i.bindFramebuffer(s),i.setViewport(0,0,1,1),i.setClearColor(0,0,0,0),i.setBlendingEnabled(!1),i.clear(Si.COLOR),i.bindVAO(o),i.drawArrays(Ui.TRIANGLE_STRIP,0,4);const y=new Uint8Array(4);return s.readPixels(0,0,1,1,vt.RGBA,Ya.UNSIGNED_BYTE,y),o.dispose(),s.dispose(),l.dispose(),i.setViewport(h,d,f,m),i.bindFramebuffer(c),y[0]!==255}};const DI=new Image;DI.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",DI.width=5,DI.height=5,DI.decode();let sPt=class{constructor(e){this.rctx=e,this.floatBufferBlend=new tPt(e),this.svgPremultipliesAlpha=new rPt(e),this.doublePrecisionRequiresObfuscation=new ePt(e),this.drawArraysRequiresIndicesTypeReset=new QRt(e)}dispose(){this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function nPt(t,e){if(e.compressedTextureETC)return null;const i=t.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function oPt(t,e){if(e.compressedTextureS3TC)return null;const i=t.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function aPt(t,e){if(e.textureFilterAnisotropic)return null;const i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}function lPt(t,e){const i=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),r=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}function cPt(t,e,i,r,s){if(e[i])return!1;for(const n of s)if(t.getExtension(n))return!0;return!1}function uPt(t,e){if(e.textureNorm16)return null;const i=t.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}function hPt(t,e){const i=e.loseContext&&t.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}let dPt=class{constructor(e,i){this._gl=e,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._colorBufferFloat=null,this._loseContext=null,this._textureNorm16=null,this._textureFloatLinear=null,this._debugRendererInfo=null,this._disabledExtensions=i.disabledExtensions||{},this._debugWebGLExtensions=i.debugWebGLExtensions||{}}get compressedTextureETC(){return this._compressedTextureETC??=nPt(this._gl,this._disabledExtensions),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC??=oPt(this._gl,this._disabledExtensions),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic??=aPt(this._gl,this._disabledExtensions),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery??=yRt(this._gl,this._disabledExtensions),this._disjointTimerQuery}get colorBufferFloat(){return this._colorBufferFloat??=lPt(this._gl,this._disabledExtensions),this._colorBufferFloat}get textureNorm16(){return this._textureNorm16??=uPt(this._gl,this._disabledExtensions),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear??=cPt(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"]),this._textureFloatLinear}get loseContext(){return this._loseContext??=hPt(this._gl,this._debugWebGLExtensions),this._loseContext}get debugRendererInfo(){return this._debugRendererInfo??=TMe(this._gl,this._debugWebGLExtensions),this._debugRendererInfo}enable(e){return this[e]}},pPt=class{constructor(e,i){this.gl=e,this.instanceCounter=new ARt,this.programCache=new KRt(this),this._transformFeedbackRequestInfo=null,this._state=new z0e,this._numOfDrawCalls=0,this._numOfTriangles=0,this._loadExtensions(),this.configure(i)}configure(e){this._capabilities=new dPt(this.gl,e),this._parameters=new MRt(this.gl,this._capabilities,e),yi.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const i=this.gl.getParameter(this.gl.VIEWPORT);this._state=new z0e,this._state.viewport={x:i[0],y:i[1],width:i[2],height:i[3]},this._stateTracker=new Idt({setBlending:r=>{if(r){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(r.opRgb,r.opAlpha),this.setBlendFunctionSeparate(r.srcRgb,r.dstRgb,r.srcAlpha,r.dstAlpha);const s=r.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:r=>{r?(this.setFaceCullingEnabled(!0),this.setCullFace(r.face),this.setFrontFace(r.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:r=>{r?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(r.factor,r.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:r=>{r?(this.setDepthTestEnabled(!0),this.setDepthFunction(r.func)):this.setDepthTestEnabled(!1)},setStencilTest:r=>{if(r){this.setStencilTestEnabled(!0);const s=r.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=r.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:r=>{r?(this.setDepthWriteEnabled(!0),this.setDepthRange(r.zNear,r.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:r=>{r?this.setColorMask(r.r,r.g,r.b,r.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:r=>{r?this.setStencilWriteMask(r.mask):this.setStencilWriteMask(0)},setDrawBuffers:r=>{if(r)this.setDrawBuffers(r.buffers);else{const{drawFramebuffer:s}=this._state;s===null?this.setDrawBuffers([Va.BACK]):s.colorAttachments.length===0?this.setDrawBuffers([Va.NONE]):this.setDrawBuffers([rr.COLOR_ATTACHMENT0])}}}),this.enforceState(),Rt(this._driverTest),this._driverTest=new sPt(this)}dispose(){Rt(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(ct.ARRAY_BUFFER),this.unbindBuffer(ct.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(ct.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(ct.PIXEL_PACK_BUFFER),this.unbindBuffer(ct.PIXEL_UNPACK_BUFFER),this.unbindBuffer(ct.COPY_READ_BUFFER),this.unbindBuffer(ct.COPY_WRITE_BUFFER),this._state.textureUnitMap.length=0,Op()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){this._state.program?.stop(),this._state.program=null}externalTextureUnitUpdate(e,i){for(let r=0;r<e.length;++r)this._state.textureUnitMap[e[r]]=null;i>=0&&(this._state.activeTexture=i)}externalVertexArrayObjectUpdate(){this.gl.bindVertexArray(null),this._state.vertexArrayObject=null,this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,i,r,s){e===this._state.blendColor.r&&i===this._state.blendColor.g&&r===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(e,i,r,s),this._state.blendColor.r=e,this._state.blendColor.g=i,this._state.blendColor.b=r,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(e,i){e===this._state.blendFunction.srcRGB&&i===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,i),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,i,r,s){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===r&&this._state.blendFunction.dstRGB===i&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(e,i,r,s),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,i){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===i||(this.gl.blendEquationSeparate(e,i),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=i,this._stateTracker.invalidateBlending())}setColorMask(e,i,r,s){this._state.colorMask.r===e&&this._state.colorMask.g===i&&this._state.colorMask.b===r&&this._state.colorMask.a===s||(this.gl.colorMask(e,i,r,s),this._state.colorMask.r=e,this._state.colorMask.g=i,this._state.colorMask.b=r,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(e,i,r,s){this._state.clearColor.r===e&&this._state.clearColor.g===i&&this._state.clearColor.b===r&&this._state.clearColor.a===s||(this.gl.clearColor(e,i,r,s),this._state.clearColor.r=e,this._state.clearColor.g=i,this._state.clearColor.b=r,this._state.clearColor.a=s)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,i){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===i||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=i,this.gl.polygonOffset(e,i),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,i,r,s){this._state.scissorRect.x===e&&this._state.scissorRect.y===i&&this._state.scissorRect.width===r&&this._state.scissorRect.height===s||(this.gl.scissor(e,i,r,s),this._state.scissorRect.x=e,this._state.scissorRect.y=i,this._state.scissorRect.width=r,this._state.scissorRect.height=s)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,i){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===i||(this.gl.depthRange(e,i),this._state.depthRange.zNear=e,this._state.depthRange.zFar=i,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,i,r){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===r||(this.gl.stencilFunc(e,i,r),this._state.stencilFunction.face=Yu.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,i,r,s){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===i&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(e,i,r,s),this._state.stencilFunction.face=e,this._state.stencilFunction.func=i,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,i,r){this._state.stencilOperation.face===Yu.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===r||(this.gl.stencilOp(e,i,r),this._state.stencilOperation.face=Yu.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,i,r,s){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===i&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(e,i,r,s),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=i,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,i=!1){const r=this._state.activeTexture;return e>=0&&(i||e!==this._state.activeTexture)&&(this.gl.activeTexture(lH+e),this._state.activeTexture=e),r}setDrawBuffers(e){const{drawFramebuffer:i}=this._state,r=i===null,s=r?this._state.drawBuffers.defaultFramebuffer:this._state.drawBuffers.fbos.get(i);if(s?.length!==e.length||!s.every((n,o)=>n===e[o]))if(e.length>this.parameters.maxDrawBuffers)console.error("Setting more active draw buffers than GL.MAX_DRAW_BUFFERS allows.");else{if(r){if(e.length>1)return void console.error("The default framebuffer can only have one active draw buffer.");if(e[0]!==Va.BACK&&e[0]!==Va.NONE)return void console.error("The default framebuffer can only use the constants GL.BACK or GL.NONE as draw buffers.")}r||!e.includes(Va.BACK)?(this.gl.drawBuffers(e),r?this._state.drawBuffers.defaultFramebuffer=e:this._state.drawBuffers.fbos.set(i,e),this._stateTracker.invalidateDrawBuffers()):console.error("A framebuffer object can only use the constants GL.COLOR_ATTACHMENTi or GL.NONE as draw buffers.")}}clear(e,i=255){if(e){if(e&Si.COLOR){const r=this._state.drawFramebuffer?.colorAttachments;r&&this.setDrawBuffers(r),this.setColorMask(!0,!0,!0,!0)}e&Si.DEPTH&&this.setDepthWriteEnabled(!0),e&Si.STENCIL&&this.setStencilWriteMask(i),this.gl.clear(e)}}clearFramebuffer(e,i=!1,r=!1){let s=0;if(e){const o=Math.max(1e-13,e[3]);this.setClearColor(e[0],e[1],e[2],o),s|=Si.COLOR}i&&(s|=Si.DEPTH),r===!1?r=0:(r===!0&&(r=255),s|=Si.STENCIL),s&&this.clear(s,r)}drawArrays(e,i,r){if(this._transformFeedbackRequestInfo){if(e!==this._transformFeedbackRequestInfo.primitiveType)throw new Error("DrawArrays called during transform feedback, but primitiveType does not match that of the current transform feedback request");if(this._state.program?.hasTransformFeedbackVaryings==null)throw new Error("DrawArrays called during transform feedback, but the shader program was not linked with a transform feedback varying")}if(Op()){this._numOfDrawCalls++,this._numOfTriangles+=J0e(e,r);const s=this._state.textureUnitMap;for(let n=0;n<s.length;n++){const o=s[n];if(o!=null&&o===this._state.drawFramebuffer?.colorTexture)throw new Error(`Detected readWrite. Texture already bound at index ${n}`)}}this.gl.drawArrays(e,i,r),ed(this.gl)}drawArraysInstanced(e,i,r,s){this.gl.drawArraysInstanced(e,i,r,s),ed(this.gl)}drawElements(e,i,r,s){if(this._transformFeedbackRequestInfo)throw new Error("Cannot called drawElements during a transform feedback request");if(Op()&&(this._numOfDrawCalls++,this._numOfTriangles+=J0e(e,i)),this.gl.drawElements(e,i,r,s),Op()){const n=eMe(this);if(n){const o=this.getBoundVAO(),a=o?.indexBuffer,l=o?.vertexBuffers,c={indexBuffer:a,vertexBuffers:l},h={mode:e,count:i,type:r,offset:s},d=a?.size??0,f=s+i,m=d<f?`. Buffer is too small. Attempted to draw index ${f} of ${d}`:"";console.error(`drawElements: ${n}${m}`,{args:h,vao:c})}}}drawElementsInstanced(e,i,r,s,n){this.gl.drawElementsInstanced(e,i,r,s,n),ed(this.gl)}logInfo(){Op()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){Op()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,i,r,s){r=Math.max(Math.round(r),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===e&&n.y===i&&n.width===r&&n.height===s||(n.x=e,n.y=i,n.width=r,n.height=s,this.gl.viewport(e,i,r,s))}setViewport4fv(e){this.setViewport(e[0],e[1],e[2],e[3])}restoreViewport({x:e,y:i,width:r,height:s}){this.setViewport(e,i,r,s)}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){this._state.program!==e&&(this._state.program?.stop(),this._state.program=e,this.gl.useProgram(e?.glName??null))}bindTexture(e,i,r=!1){(i>=this.parameters.maxTextureImageUnits||i<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[i];return e?.glName==null?(s!=null&&(this.setActiveTexture(i,r),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[i]=null,s):r||s!==e?(this.setActiveTexture(i,r),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[i]=e,s):(e.isDirty&&(this.setActiveTexture(i,r),e.applyChanges()),s)}unbindTexture(e){if(e!=null)for(let i=0;i<this.parameters.maxTextureImageUnits;i++)this._state.textureUnitMap[i]===e&&(this.bindTexture(null,i),this._state.textureUnitMap[i]=null)}bindFramebuffer(e,i=!1){if(i||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(this._stateTracker.invalidateDrawBuffers(),e==null)return this.gl.bindFramebuffer(Fa.FRAMEBUFFER,null),void(this._state.readFramebuffer=this._state.drawFramebuffer=null);e.initializeAndBind(Fa.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,i,r=!1){const s=i===Fa.READ_FRAMEBUFFER,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(r||n!==e)&&(e==null?this.gl.bindFramebuffer(i,null):e.initializeAndBind(i),s?this._state.readFramebuffer=e??null:(this._stateTracker.invalidateDrawBuffers(),this._state.drawFramebuffer=e??null))}blitFramebuffer(e,i,r=0,s=0,n=e.width,o=e.height,a=0,l=0,c=i.width,h=i.height,d=Si.COLOR,f=di.NEAREST){this.bindFramebufferSeparate(e,Fa.READ_FRAMEBUFFER),this.bindFramebufferSeparate(i,Fa.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(r,s,n,o,a,l,c,h,d,f)}bindBuffer(e,i){if(e)switch(i??=e.bufferType,i){case ct.ARRAY_BUFFER:this._state.vertexBuffer=Nl(this.gl,e,i,this._state.vertexBuffer);break;case ct.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Nl(this.gl,e,i,this._state.indexBuffer);break;case ct.UNIFORM_BUFFER:this._state.uniformBuffer=Nl(this.gl,e,i,this._state.uniformBuffer);break;case ct.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Nl(this.gl,e,i,this._state.pixelPackBuffer);break;case ct.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Nl(this.gl,e,i,this._state.pixelUnpackBuffer);break;case ct.COPY_READ_BUFFER:this._state.copyReadBuffer=Nl(this.gl,e,i,this._state.copyReadBuffer);break;case ct.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Nl(this.gl,e,i,this._state.copyWriteBuffer);break;case ct.TRANSFORM_FEEDBACK_BUFFER:this._state.transformFeedbackBuffer=Nl(this.gl,e,i,this._state.transformFeedbackBuffer)}}bindRenderbuffer(e){const i=this.gl;e||(i.bindRenderbuffer(i.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(i.bindRenderbuffer(i.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,i){if(i>=this.parameters.maxUniformBufferBindings||i<0)return console.error("Uniform buffer binding point is out of range!"),null;const r=e===ct.UNIFORM_BUFFER?this._state.uniformBufferBindingPoints:this._state.transformBufferBindingPoints;let s=r[i];return s==null&&(s={buffer:null,offset:0,size:0},r[i]=s),s}bindBufferBase(e,i,r){const s=this._getBufferBinding(e,i);s!=null&&(s.buffer===r&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(e,i,r?r.glName:null),s.buffer=r,s.offset=0,s.size=0))}bindBufferRange(e,i,r,s,n){const o=this._getBufferBinding(e,i);o!=null&&(o.buffer===r&&o.offset===s&&o.size===n||(s%this._parameters.uniformBufferOffsetAlignment==0?(this.gl.bindBufferRange(e,i,r.glName,s,n),o.buffer=r,o.offset=s,o.size=n):console.error("Uniform buffer binding offset is not a multiple of the context offset alignment")))}bindUBO(e,i,r,s){i!=null?(Op()&&(s??i.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),i.initialize(),r!==void 0&&s!==void 0?this.bindBufferRange(ct.UNIFORM_BUFFER,e,i.buffer,r,s):this.bindBufferBase(ct.UNIFORM_BUFFER,e,i.buffer)):this.bindBufferBase(ct.UNIFORM_BUFFER,e,null)}unbindUBO(e){for(let i=0,r=this._state.uniformBufferBindingPoints.length;i<r;i++){const s=this._state.uniformBufferBindingPoints[i];s!=null&&s.buffer===e.buffer&&this.bindBufferBase(ct.UNIFORM_BUFFER,i,null)}}unbindBuffer(e){switch(e){case ct.ARRAY_BUFFER:this._state.vertexBuffer=Nl(this.gl,null,e,this._state.vertexBuffer);break;case ct.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Nl(this.gl,null,e,this._state.indexBuffer);break;case ct.UNIFORM_BUFFER:this._state.uniformBuffer=Nl(this.gl,null,e,this._state.uniformBuffer);break;case ct.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Nl(this.gl,null,e,this._state.pixelPackBuffer);break;case ct.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Nl(this.gl,null,e,this._state.pixelUnpackBuffer);break;case ct.COPY_READ_BUFFER:this._state.copyReadBuffer=Nl(this.gl,null,e,this._state.copyReadBuffer);break;case ct.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Nl(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){e!=null?this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}bindTransformFeedback(e){const{gl:i}=this;i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,e.glName)}beginTransformFeedback(e,i){if(this._transformFeedbackRequestInfo)throw new Error("Already in a transform feedback request");const{gl:r}=this;r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,e.glName),r.beginTransformFeedback(i),this._transformFeedbackRequestInfo={primitiveType:i}}endTransformFeedback(){if(!this._transformFeedbackRequestInfo)throw new Error("Not in a transform feedback request");const{gl:e}=this;e.endTransformFeedback(),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),this._transformFeedbackRequestInfo=null}async clientWaitAsync(e=10){const{gl:i}=this,r=i.fenceSync(hY.SYNC_GPU_COMMANDS_COMPLETE,0);if(!r)throw new Error("Client wait failed, could not create sync object");let s;this.instanceCounter.increment(Hs.Sync,r),i.flush();do await Pee(e),s=i.clientWaitSync(r,0,0);while(s===yU.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(Hs.Sync,r),i.deleteSync(r),s===yU.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=Fa.FRAMEBUFFER){return e===Fa.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(ct.ARRAY_BUFFER),this.unbindBuffer(ct.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(ct.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(ct.PIXEL_PACK_BUFFER),this.unbindBuffer(ct.PIXEL_UNPACK_BUFFER),this.unbindBuffer(ct.COPY_READ_BUFFER),this.unbindBuffer(ct.COPY_WRITE_BUFFER);for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(Ft.ONE,Ft.ZERO),this.setBlendEquation(uv.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(Yu.BACK),this.setFrontFace(I$.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(Ni.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(Ni.ALWAYS,0,0),this.setStencilOp(Yi.KEEP,Yi.KEEP,Yi.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setDrawBuffers([Va.BACK]),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){const{gl:e}=this;e.bindVertexArray(null);for(let r=0;r<this.parameters.maxVertexAttributes;r++)e.disableVertexAttribArray(r);this._state.vertexBuffer?e.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):e.bindBuffer(ct.ARRAY_BUFFER,null),this._state.indexBuffer?e.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):e.bindBuffer(ct.ELEMENT_ARRAY_BUFFER,null),this._state.uniformBuffer?e.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):e.bindBuffer(ct.UNIFORM_BUFFER,null);for(let r=0;r<this._parameters.maxUniformBufferBindings;r++){const s=this._state.uniformBufferBindingPoints[r];if(s!=null){const{buffer:n,offset:o,size:a}=s;n!==null?o===0&&a===0?e.bindBufferBase(ct.UNIFORM_BUFFER,r,n.glName):e.bindBufferRange(ct.UNIFORM_BUFFER,r,n.glName,o,a):e.bindBufferBase(ct.UNIFORM_BUFFER,r,null)}}if(this._state.pixelPackBuffer?e.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):e.bindBuffer(ct.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?e.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):e.bindBuffer(ct.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?e.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):e.bindBuffer(ct.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?e.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):e.bindBuffer(ct.COPY_WRITE_BUFFER,null),e.bindFramebuffer(Fa.READ_FRAMEBUFFER,null),e.readBuffer(e.BACK),this._state.readFramebuffer&&(e.bindFramebuffer(Fa.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),e.readBuffer(rr.COLOR_ATTACHMENT0)),e.bindFramebuffer(Fa.DRAW_FRAMEBUFFER,this._state.drawFramebuffer?.glName??null),this._state.drawFramebuffer===null){const r=this._state.drawBuffers.defaultFramebuffer;e.drawBuffers(r??[Va.BACK])}else{const r=this._state.drawBuffers.fbos.get(this._state.drawFramebuffer);e.drawBuffers(r??[rr.COLOR_ATTACHMENT0])}if(this._state.vertexArrayObject){const r=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(r)}e.useProgram(this._state.program?.glName??null),e.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),e.bindRenderbuffer(e.RENDERBUFFER,this._state.renderbuffer?.glName??null),this._state.blend===!0?e.enable(this.gl.BLEND):e.disable(this.gl.BLEND),e.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),e.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),e.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),e.clearDepth(this._state.clearDepth),e.clearStencil(this._state.clearStencil),e.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),e.cullFace(this._state.cullFace),e.depthFunc(this._state.depthFunction),e.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(this._state.depthWrite),e.frontFace(this._state.frontFace),e.lineWidth(1),this._state.faceCulling===!0?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),e.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._state.stencilWriteMask);for(let r=0;r<this.parameters.maxTextureImageUnits;r++){e.activeTexture(lH+r),e.bindTexture(ts.TEXTURE_2D,null),e.bindTexture(ts.TEXTURE_CUBE_MAP,null),e.bindTexture(ts.TEXTURE_3D,null),e.bindTexture(ts.TEXTURE_2D_ARRAY,null);const s=this._state.textureUnitMap[r];s!=null&&e.bindTexture(s.descriptor.target,s.glName)}e.activeTexture(lH+this._state.activeTexture);const i=this._state.viewport;e.viewport(i.x,i.y,i.width,i.height),this.resetInfo()}_loadExtensions(){this.gl.getExtension("KHR_parallel_shader_compile")}};function Nl(t,e,i,r){return e?r!==e&&t.bindBuffer(i,e.glName):t.bindBuffer(i,null),e}function J0e(t,e){switch(t){case Ui.POINTS:return 2*e;case Ui.TRIANGLES:return e/3;case Ui.TRIANGLE_STRIP:case Ui.TRIANGLE_FAN:return e-2;default:return 0}}let fPt=class extends pPt{constructor(e,i){super(e,i),this._vaoCaches=new yv,this._appleAmdDriverHelper=null,this._refCount=1,this._newCache=i.newCache,this.screen=new ERt(this)}configure(e){super.configure(e),this._newCache=e.newCache}destroy(){this._vaoCaches?.forAll(e=>e.dispose()),this._vaoCaches?.clear(),--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){super.dispose(),this._appleAmdDriverHelper?.dispose(),this.screen.destroy(),this._vaoCaches.forAll(e=>e.dispose()),this._vaoCaches.clear()}get newCache(){return this._newCache}getVaoCache(e,i){const r=Array.from(e).join("."),s=JSON.stringify(i),n=this._vaoCaches.get(r,s);if(n)return n;const o=new $Rt(this,e,i);return this._vaoCaches.set(r,s,o),o}bindTechnique(e,i,r,s){return this.useProgram(e.program),this.setPipelineState(e.getPipeline()),e.program.bind(i),r&&(e.program.bindPass(r,i),s&&e.program.bindDraw(i,r,s)),e.program}runAppleAmdDriverHelper(){this.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper??=new Zke(this),this._appleAmdDriverHelper.run())}get test(){}};function X0e(t){return!!t.frameUpdate}let JE=class extends ue{constructor(e){super({}),this._stage=e,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new ws,this._frameTask=e.view.resourceController.scheduler.registerTask(at.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(Nn.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}acquire(e){const i=this._textures.get(e);return i?(i.ref(),i.loadingPromise??i):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(i=>{const r=i.texture.frameUpdate(i.previousToken);r>=0&&r!==i.previousToken&&(i.previousToken=r,e=!0)}),e&&this.events.emit("changed",bt.BACKGROUND)}_createNewRef(e){const i=this._stage.getObject(e);if(i==null)return null;const r=i.events.on("unloaded",()=>{r.remove(),this._onTextureUnloaded(e)}),s=new mPt(e,()=>{this._frameTask.schedule(()=>{s.isUnreferenced&&i.unload()})});return this._textures.set(e,s),s.ref(),i.glTexture?(this._updateGLTexture(s,i.glTexture),X0e(i)&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),s):(this._loadingCount++,s.loadingPromise=this._stage.schedule(()=>{const n=i.load(this._stage.renderView.renderingContext),o=l=>(this._loadingCount--,s.loadingPromise=null,this._updateGLTexture(s,l),X0e(i)&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),s),a=l=>(this._loadingCount--,s.loadingPromise=null,Xr(l)||J.getLogger(this).error(l),null);return nu(n)?n.then(o,a):o(n)}),s.loadingPromise)}_updateGLTexture(e,i){e.glTexture=i,this.events.emit("changed",bt.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};u([p()],JE.prototype,"_loadingCount",void 0),u([p()],JE.prototype,"_frameTask",void 0),u([p()],JE.prototype,"updating",null),JE=u([A("esri.views.3d.webgl-engine.lib.TextureRepository")],JE);let mPt=class{constructor(e,i){this.id=e,this._release=i,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(J.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}};function gPt(t,e){return new A3e(i=>syt(i,t),i=>i,e)}let LI=class extends ue{constructor(){super(...arguments),this._passParameters=new yPt,this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=hc(this._resourcesTask),this._passParameters.waveNormal=Rt(this._passParameters.waveNormal),this._passParameters.wavePerturbation=Rt(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&!this._resourcesTask.finished}ensureResources(e){return this._resourcesTask||(this._resourcesTask=ag(async i=>{await Promise.allSettled([this._loadImageResource(e,gs("esri/images/materials/water/normals.jpg"),r=>this._passParameters.waveNormal=r,i),this._loadImageResource(e,gs("esri/images/materials/water/perturbation.jpg"),r=>this._passParameters.wavePerturbation=r,i)])})),this._resourcesTask.finished?Mb.LOADED:Mb.LOADING}async _loadImageResource(e,i,r,s){try{const n=await vv(i,{signal:s});gt(s);const o=new $r(n.width,n.height);o.pixelFormat=vt.RGB,o.samplingMode=di.LINEAR_MIPMAP_LINEAR,o.hasMipmap=!0,o.maxAnisotropy=8,r(new yi(e,o,n))}catch(n){J.getLogger(this).error("Failed to load water material normal texture.",n)}}};u([p()],LI.prototype,"_resourcesTask",void 0),u([p({type:Boolean,readOnly:!0})],LI.prototype,"updating",null),LI=u([A("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],LI);let yPt=class extends ar{},vPt=class{constructor(e,i){this.parameters=e,this.fbos=i}},_Pt=class{constructor(e,i,r){this._rctx=e,this._renderFunctions=i,this._forceCameraHook=r,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(bt.BACKGROUND);const i=Qo();return this._screenshotQueue.push({settings:e,resolver:i}),i.promise}update(e,i){for(const r of this._screenshotQueue){if(this._rctx==null){r.resolver.reject();continue}const s={...r.settings,pixelRatio:r.settings.pixelRatio*e.parameters.camera.pixelRatio},n=this._renderScreenshot(e,s,i);r.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,i,r){e.width=i.width,e.height=i.height;const s=e.getContext("2d"),n=r.pixelRatio;return s.save(),s.translate(0,i.height),s.scale(1,-1),r.region&&s.translate(-r.region.x,-r.region.y),s.scale(n,n),i=this._renderFunctions.renderOverlay(e,r.disableDecorations,i),s.restore(),i}_readbackScreenshot(e,i){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},i):this._readbackScreenshotImmediate(e,i)}_readbackScreenshotResampled(e,i){const{framebufferWidth:r,framebufferHeight:s,region:n,resample:o}=e,a=this._ensureScreenshotEncodeCanvas();let l=b4(r,s,a);this._rctx.gl.readPixels(0,0,r,s,vt.RGBA,Pi.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),i(),l=this._renderScreenshotOverlay(a,l,{...e,region:void 0});const c=b4(n.width,n.height,a);return vMe(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,i){const{framebufferHeight:r,region:s}=e,n=this._ensureScreenshotEncodeCanvas(),o=b4(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,r-(s.y+s.height),s.width,s.height,vt.RGBA,Pi.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),i(),this._renderScreenshotOverlay(n,o,e)}_renderScreenshot(e,i,r){const s=e.parameters.camera,n={width:i.framebufferWidth,height:i.framebufferHeight};yx(n,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let o=!1;const a=n.width!==s.fullWidth||n.height!==s.fullHeight,l=i.ignorePadding&&s.pixelRatio!==i.pixelRatio,c=a||i.disableDecorations||l||i.objectAndLayerIdColor;let h=null,d=null;if(c){const v=s.clone();if(i.ignorePadding){const S=vj(v.padding);for(let C=0;C<4;C++)S[C]=Math.round(S[C]/v.pixelRatio*i.pixelRatio);v.padding=S}v.fullWidth=n.width,v.fullHeight=n.height,v.pixelRatio=i.pixelRatio;const _=s.fovX-v.fovX,b=s.fovY-v.fovY;_<0&&_<b?v.fovX=s.fovX:b<0&&b<_&&(v.fovY=s.fovY);const w={camera:v,contentCamera:v,mode:ai.IDLE,alignPixelEnabled:!0,contentPixelRatio:v.pixelRatio,forcedAnimationTime:e.parameters.forcedAnimationTime};this._forceCameraHook(w),o=!0;const x=this._renderFunctions.renderScene(w,r,i.objectAndLayerIdColor?Pp.ObjectAndLayerID:Pp.Screenshot,i.disableDecorations);d=x.screen,h=x.olid}const f=()=>{this._rctx.bindFramebuffer(null),d?.release()};this._rctx.bindFramebuffer(d?.fbo);const m=this._readbackScreenshot(i,f);let y=null;if(i.objectAndLayerIdColor){const v=()=>{this._rctx.bindFramebuffer(null),h?.release()};this._rctx.bindFramebuffer(h?.fbo),y=this._readbackScreenshot(i,v),this._rctx.bindFramebuffer(null)}if(c&&!this._rctx.contextAttributes.alpha)for(let v=3;v<m.data.length;v+=4)m.data[v]=255;if(y&&!this._rctx.contextAttributes.alpha)for(let v=3;v<y.data.length;v+=4)y.data[v]=255;return o&&this._forceCameraHook(e.parameters),[m,y]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas??=document.createElement("canvas"),this._screenshotEncodeCanvas}},na=class extends ue{constructor(e){super(e),this.events=new ws,this.waterTextures=new LI,this.olidRenderHelper=Md()?new mIt:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._savedFadeDuration=0;const i=e.stage;try{this._initializeContext(i)}catch(n){return void console.error("Failed to initialize context",n)}const{memoryController:r}=i.view.resourceController;this.stippleTextures=mgt(this._rctx,r),this.markerTextures=gPt(this._rctx,r),this._techniques=new OOt(new MOt(this._rctx,i.viewingMode,this.stippleTextures,this.waterTextures,this.markerTextures)),this._textures=new JE(i),this.addHandles(this._textures.events.on("changed",n=>this.requestRender(n))),this._materials=new x3e(this._textures,this._techniques,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new fIt(this._rctx,this._techniques),this.renderer=new M5(i,this._materials,this._techniques,this._rctx,this._compositingHelper,n=>this.requestRender(n)),this.addHandles([H(()=>i.view.ready,n=>{n&&this._createRenderNodes()},Nt),H(()=>this.waterTextures?.updating,()=>this.requestRender(),Nt),H(()=>i.view.qualityProfile,n=>this.renderer?.updateRenderFeatures(n),St)]);const s={renderScene:(n,o,a,l)=>this.renderer.render(n,o,a,l),requestRenderScene:n=>this.requestRender(n),prepareOverlay:()=>i.options.screenshot.prepareOverlay(),renderOverlay:(n,o,a)=>i.options.screenshot.renderOverlay(n,o,a)};this._screenshotManager=new _Pt(this._rctx,s,n=>this.events.emit("force-camera-for-screenshot",n)),this._registerFrameTask(i)}destroy(){const e=this.stage?.container;e?.contains(this._canvas)&&e.removeChild(this._canvas),this._frameTask=Hi(this._frameTask),this._techniques=Ce(this._techniques),this._componentObjects=Ce(this._componentObjects),this._screenshotManager=Ce(this._screenshotManager),Ce(this.renderer),this._textures=Ce(this._textures),Ce(this.waterTextures),Ce(this.markerTextures),Ce(this.stippleTextures),this._canvas=null,this._rctx=Ce(this._rctx)}_createRenderNodes(){const{view:e,viewingMode:i}=this.stage;new JX({view:e}),_A(e.spatialReference)||(i===Be.Local?new qX({view:e}):vA(e.spatialReference)?new bMt({view:e}):(new jX({view:e}),new GX({view:e}),new YX({view:e}),new HX({view:e}))),new NE({view:e,isEnabled:()=>this.renderer.hasSSAO}),new I1({view:e,isEnabled:()=>this.renderer.hasSMAA}),new O1({view:e}),new dI({view:e}),new ZE({view:e,viewingMode:i}),new OI({view:e}),Md()&&new MI({view:e})}requestRender(e=bt.UPDATE){this._needsRender=!0,e===bt.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textures.updating||this.waterTextures.updating}get textures(){return this._textures}get techniques(){return this._techniques}get compositingHelper(){return this._compositingHelper}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(i=>i[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,i,r,s,n,o=n){const a=s.constrainWindowSize(i,r,n*s.pixelRatio,o*s.pixelRatio),l=this._ensureLinearDepthArrayBuffer(a);this.renderer.readMainDepth(a,l);const c=(d,f,m)=>Fre(f,d)*(m[1]-m[0])+m[0];let h=Number.MAX_VALUE;for(let d=0;d<a[2]*a[3];d++){const f=c(4*d,l,s.nearFar);h>f&&f!==s.nearFar[0]&&f!==s.nearFar[1]&&(h=f)}if(e){const d=e.pickDepth(i*s.pixelRatio,r*s.pixelRatio,s);d!=null&&h>d&&d!==s.nearFar[0]&&d!==s.nearFar[1]&&(h=d)}return h===Number.MAX_VALUE?void 0:h}_ensureLinearDepthArrayBuffer(e){const i=4*e[2]*e[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<i)&&(this._tmpDepthBuffer=new Uint8Array(i)),this._tmpDepthBuffer}async reloadShaders(){lFe(),await this._techniques.reloadAll(),this.renderer.overlay?.reloadShaders(),this.requestRender()}_registerFrameTask(e){const i=e.view.state;let r=!1,s=bt.BACKGROUND,n=!1;const o={preRender:({time:a})=>{r=this.updating,s=this._needsUpdate?bt.UPDATE:bt.BACKGROUND,e.commitSyncLayers(),a=this._testTime??a,(a-this._lastAnimationUpdate>this.renderer.animationTimestep||i.forcedAnimationTime!=null||r||this._needsRender)&&(this.renderer.updateAnimation(i,a)&&this.requestRender(bt.BACKGROUND),this._lastAnimationUpdate=a)},render:({time:a})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&i.camera.fullWidth>0&&i.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,a=this._testTime??a,this.renderer.render(i,a),n=!0,l&&this.renderer.hasReflections&&(this.requestRender(bt.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:a})=>{this._textures.update();const l=new vPt(i,this.renderer.fboCache);a=this._testTime??a,this._screenshotManager.update(l,a)},finish:()=>{n&&(this.renderer.finish(i.mode===ai.IDLE?s:bt.UPDATE),n=!1)}};this._frameTask=qm(o)}_initializeContext(e){const{options:i}=e,r=i.canvas??document.createElement("canvas");r.setAttribute("style","width: 100%; height:100%; display:block;"),this._canvas=r;const s={alpha:i.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:i.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:i.preserveDrawingBuffer??!1},n=r.getContext("webgl2",s);if(n==null)return void J.getLogger(this).error("A WebGL2 context could not be created.");this._rctx=bPt(n,e),this._loadShaderOnlyExtensions(),!i.alpha&&this._rctx.contextAttributes.alpha&&J.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested");const{container:o}=e;!this._rctx.contextAttributes.alpha&&X("safari")>=11&&(o.style.backgroundColor="black"),o.contains(r)||o.appendChild(r)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloatLinear")}get _viewingMode(){return this.stage.viewingMode}getObjectAndLayerIdColor(e){return this.olidRenderHelper?.getObjectAndLayerIdColor(e)}get componentObjectCollection(){return this._componentObjects==null&&(this._componentObjects=new COt(this.renderer.renderPassManager,this._viewingMode)),this._componentObjects}set componentObjectCollection(e){this._componentObjects=e}updateQualitySettings(e){this._testTime!=null&&(this._savedFadeDuration=e.fadeDuration,e.fadeDuration=0)}set testTime(e){this._testTime=e,e==null?this.stage.view.qualitySettings.fadeDuration=this._savedFadeDuration:this.updateQualitySettings(this.stage.view.qualitySettings)}get testTime(){return this._testTime}};function bPt(t,e){const i=(s,n)=>e.view.resourceController.memoryController.newCache(s,n),r={disabledExtensions:e.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:e.options.debugWebGLExtensions||{},maxAnisotropy:8,newCache:i};return new fPt(t,r)}u([p({type:Boolean,readOnly:!0})],na.prototype,"updating",null),u([p({constructOnly:!0})],na.prototype,"stage",void 0),u([p()],na.prototype,"_rctx",void 0),u([p()],na.prototype,"_canvas",void 0),u([p()],na.prototype,"stippleTextures",void 0),u([p()],na.prototype,"markerTextures",void 0),u([p()],na.prototype,"waterTextures",void 0),u([p({readOnly:!0})],na.prototype,"olidRenderHelper",void 0),u([p()],na.prototype,"_textures",void 0),u([p({readOnly:!0})],na.prototype,"renderer",void 0),u([p()],na.prototype,"_screenshotManager",void 0),u([p()],na.prototype,"componentObjectCollection",null),u([p()],na.prototype,"_componentObjects",void 0),u([p()],na.prototype,"_needsUpdate",void 0),u([p()],na.prototype,"_needsWaterReflectionUpdate",void 0),na=u([A("esri.views.3d.webgl-engine.parts.RenderView")],na);let Ih=class extends ue{constructor(e){super(e),this._model=new b5,this._layers=new Jt,this._asyncChangeSet=new MJ,this._syncChangeSet=new MJ,this._layerSyncSet=new Set}initialize(){this._set("renderView",new na({stage:this})),this._frameTask=this.view.resourceController.scheduler.registerTask(at.STAGE,this),this.addHandles(this._frameTask)}destroy(){this.renderView.destroy()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){return this.renderView?.renderer}add(e){this._model.add(e),KU(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){e!=null&&!this.destroyed&&this._model.remove(e)&&(KU(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){e!=null&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){e!=null&&(this._model?.removeMany(e),this.renderView?.requestRender())}forEachOfType(e,i){this._model.forEachOfType(e,i)}handleEvent(e,i){this.destroyed||(this._model.dirtySet[e](i),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){if(this._frameTask.processQueue(e),this._commit(e),!e.hasProgressed)return Ko}_commit(e){const i=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{if(e.done)return;const s=this._layerSyncSet.has(r.id)||r.updatePolicy===cb.SYNC,n=s?this._syncChangeSet:this._asyncChangeSet;i.commitLayer(r.id,n),this._layerSyncSet.delete(r.id),n.empty||(this.renderer.modify(n,s?Wc:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Wc),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{e.done||this._layerSyncSet.has(r.id)||r.updatePolicy!==cb.ASYNC||(i.commitLayer(r.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(i=>{this._layerSyncSet.has(i.id)||i.updatePolicy===cb.SYNC?(e.commitLayer(i.id,this._syncChangeSet),this._layerSyncSet.delete(i.id)):e.commitSyncUpdates(i.id,this._syncChangeSet)});for(const i of this._layerSyncSet)e.commitLayer(i,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Wc),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Wc),this.renderView.requestRender())}schedule(e,i){return this._frameTask.schedule(e,i)}reschedule(e,i){return this._frameTask.reschedule(e,i)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,Wc))}addRenderPlugin(e,i){const r=this.renderer.plugins.add(e,i),s=()=>{Bge(e)&&this.view.sceneIntersectionHelper.addIntersectionHandler(e)};if(nu(r))return r.then(s);s()}removeRenderPlugin(e){this.destroyed||(Bge(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.plugins.remove(e))}get performanceInfo(){return this._model.getStats()}get test(){}};u([p({constructOnly:!0})],Ih.prototype,"view",void 0),u([p({constructOnly:!0})],Ih.prototype,"options",void 0),u([p({readOnly:!0})],Ih.prototype,"viewingMode",null),u([p({constructOnly:!0})],Ih.prototype,"container",void 0),u([p({readOnly:!0})],Ih.prototype,"updating",null),u([p({constructOnly:!0})],Ih.prototype,"_model",void 0),u([p()],Ih.prototype,"renderView",void 0),u([p({readOnly:!0})],Ih.prototype,"renderer",null),u([p({readOnly:!0})],Ih.prototype,"running",null),Ih=u([A("esri.views.3d.webgl-engine.Stage")],Ih);function xhi(t){return t&&typeof t.highlight=="function"}function wPt(t){return t&&typeof t.maskOccludee=="function"}function xPt(t,e,i){return t==null||t>=i&&(e===0||t<=e)}function Shi(t,e){if(e&&t){const{minScale:i,maxScale:r}=t;if(SPt(i,r))return xPt(e,i,r)}return!0}function SPt(t,e){return t!=null&&t>0||e!=null&&e>0}function Thi(t){return!t?.minScale||!t.maxScale||t.minScale>=t.maxScale}function Ehi(t){return t!=null&&typeof t=="object"&&"createQuery"in t&&"queryFeatures"in t&&"layer"in t&&"view"in t}function Chi(t,e,i){return new U("layerview:spatial-reference-incompatible",`The spatial reference of this ${t}${e?`(wkid:${e})`:""} is incompatible with the spatial reference of the view${i?`(wkid:${i})`:""}.`,{})}function TPt(t){return e=>{if(t.immediate)return t.immediate.schedule(e);const i="No immediate scheduler";throw console.error(i),new Error(i)}}const $B=new Set,Xke=()=>J.getLogger("esri/views/support/TextureCompressionHelper");function EPt(t,e){return yi.compressionWorkerHandle??=new cAt(TPt(e)),$B.has(t)?Xke().warn("Repeated texture compression worker initialization by the same view."):$B.add(t),yi.compressionWorkerHandle}function CPt(t){yi.compressionWorkerHandle&&($B.delete(t)||Xke().warn("Unknown view attempted to destroy the texture compression worker."),$B.size||(Ce(yi.compressionWorkerHandle),yi.compressionWorkerHandle=null))}let O5=class extends gj{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};u([p()],O5.prototype,"components",void 0),O5=u([A("esri.views.ui.3d.DefaultUI3D")],O5);const Kke=O5;let Ge=class extends VEe(p2e(d2e(F$e))){constructor(t){super(t),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._overrideDefaultEnvironmentOnly=!0,this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new ov({slicePlane:kOe},this),this._resourceController=CEt(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new dX({view:this}),this.labeler=new M1({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new x$,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new ix,this.environment=new jE,this.environmentManager=new Ah,this.floors=new Ee,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new y0t({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new $Tt({view:this}),this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new Kke,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.focusAreas=new j0({view:this}),gEe();const e=(i=null)=>{i!=null&&i.type===Tr.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async r=>{try{await r.when()}catch{}this._updatingChanged()}))};this.addHandles([io(()=>this.map?.allLayers,"after-changes",i=>e(i),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",i=>this._updateUpdatingMonitors(i)),H(()=>this.map,i=>{i&&"load"in i&&i.load&&i.load().catch(()=>{})})]),this.inputManager=new Owt({view:this}),this.stateManager=new ks({view:this})}initialize(){if(X("enable-feature:esri-compress-textures")){const e=EPt(this,this.resourceController);this.addResolvingPromise(e.promise)}this.groundView=new m0t({view:this}),this._updateUpdatingMonitors();const t=()=>this._updateDefaultToMapOptions();this.addHandles(io(()=>this.map?.allLayers,"after-changes",t,{onListenerAdd:t,onListenerRemove:t})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},Nt),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},Nt),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>KVe(e>0?1e3/Math.ceil(e):0),Nt),this.updatingHandles.add(()=>this.map?.ground,t,St),this.updatingHandles.add(()=>this.map?.ground?.opacity,()=>this._updateDefaultHitTestOptions(),St),this.addHandles(H(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),Gt))}destroy(){this.destroyed||(CPt(this),this.updatingHandles.removeAll(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._set("analysisViewManager",Ce(this.analysisViewManager)),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=Ce(this.sharedSymbolResources),this._set("labeler",Ce(this.labeler)),this._set("deconflictor",Ce(this.deconflictor)),this._resourceController=Ce(this._resourceController),this._set("stateManager",Ce(this.stateManager)),this._set("inputManager",Ce(this.inputManager)),this.state.destroy(),this.highlights.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",Ce(this.environmentManager)),this._set("environment",Ce(this.environment)),this.groundView=Ce(this.groundView),this._exitBasemapTerrain(),this._stage?.destroy())}get renderSpatialReference(){return this.renderCoordsHelper?.spatialReference}get basemapSpatialReference(){return this.basemapTerrain?.spatialReference}get animation(){return this.state?.animation}get camera(){return this.stateManager?.camera}set camera(t){this.stateManager&&(this.stateManager.camera=t)}get contentCamera(){return this.stateManager?.contentCamera}set contentCamera(t){this.stateManager&&(this.stateManager.contentCamera=t)}installContentCameraReset(t={sticky:!1}){return this.stateManager.installContentCameraReset(t)}get center(){return this.stateManager?.center}set center(t){this.stateManager&&(this.stateManager.center=t)}get clippingArea(){if(this.viewingMode==="global")return null;const t=this.map;let e=this._userClippingArea||ale(t,"clippingArea");return!this._userClippingArea&&!ale(t,"clippingEnabled")||e==null?(this._clippingArea=null,null):e instanceof gi?this.spatialReference&&(e=VF(e,this.spatialReference),e==null)?(J.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),e.intersection(this._groundAndLayersExtent)==null&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(J.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(t){this.ready&&this.viewingMode==="global"&&t!=null?J.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=t}get renderDataExtent(){if(this.state.viewingMode===Be.Global)return null;const t=this.renderSpatialReference,e=this.dataExtent;return e==null||t==null||e.spatialReference.equals(t)?e:VF(e,t)}get tileInfo(){return this.basemapTerrain?.tilingScheme?.toTileInfo()}get dataExtent(){let t=this._groundAndLayersExtent;const e=this.spatialReference||Ae.WGS84,i=VF(this.clippingArea,e);i!=null&&(t=t!=null?t.intersection(i):i);const r=this._get("dataExtent");return t!=null&&t.equals(r)?r:t}get _groundAndLayersExtent(){const t=this.spatialReference||Ae.WGS84;let e;const i=n=>{const o=VF(n,t);o!=null&&(e!=null?e.union(o):e=o.clone())},r=this.basemapTerrain;if(r?.spatialReference){const n=r.groundExtent;i(new gi({xmin:n[0],ymin:n[1],zmin:0,xmax:n[2],ymax:n[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){const n=o=>{o.fullExtent==null||o.type==="graphics"&&o.internal||i(o.fullExtent)};this.map.allLayers.forEach(o=>n(o))}if(e==null)return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const s=this._get("_groundAndLayersExtent");return e.equals(s)?s:e}castEnvironment(t){return t?t instanceof jE?t:t instanceof W$?this.environment?.cloneWithWebsceneEnvironment(t)??jE.fromWebsceneEnvironment(t):Is(jE,t):new jE}get extent(){return this.stateManager?.extent}set extent(t){this.stateManager&&(this.stateManager.extent=t)}get screenCenter(){return this.stateManager?.screenCenter}get frustum(){return this.stateManager?.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||(this.toolViewManager?.interacting??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state?.stationary??!0)}get navigating(){return this.state?.navigating??!1}get padding(){return this.stateManager?.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}set qualityProfile(t){kx.isValidProfile(t)&&(kx.apply(t,this.qualitySettings),this._stage?.renderView.updateQualitySettings(this.qualitySettings),this._set("qualityProfile",t))}get qualityProfile(){return this._get("qualityProfile")||kx.getDefaultProfile()}set slicePlane(t){if(this._stage!=null&&(this._stage.renderer.slicePlane=t),t==null)return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");BS(t,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){return!!this.viewingMode&&!!this.stateManager?.preinit(this.spatialReference)}get resolution(){return this.spatialReference!=null?Wat(this.scale,this.spatialReference):0}get scale(){return this.stateManager?.scale}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get heightModelInfo(){const t=this.getDefaultHeightModelInfo();return t!=null?Bb.deriveUnitFromSR(t,this.spatialReference):null}get updating(){if(this.destroyed)return!1;let t=0,e=this.layerViewManager.updating,i=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(s=>{if(s.isFulfilled()){if(s.updating){if(e=!0,s.suspended||EX(s))return;++i,t+=s.updatingProgress}}else++i});for(const s of this._updatingObjects)s!=null&&s.updating&&(i+=.1,t+=.5*.1);for(const s of this._updatingObjectsWithProgress)s!=null&&s.updating&&(++i,t+=s.updatingProgress);const r=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(e=!!(e||i>0||this.updatingHandles.updating||!this.ready||!this.stationary||r||this._createGraphicsViewController||this.inputManager?.updating||this.map?.allLayers?.some(s=>!s.isFulfilled())||this.textures?.updating),e?(this._numUpdating=Math.max(i,this._numUpdating),t+=this._numUpdating-i):this._numUpdating=0,this._numUpdating>0?t/=this._numUpdating:t=e?0:1,this._get("updatingProgress")!==t){const s=performance.now();if(t<1){const n=Math.min((s-this._lastUpdateTime)/2e3,1);t=this.updatingProgress*(1-n)+t*n}this._set("updatingProgress",t),this._lastUpdateTime=e&&t<1?s:0}return e}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){const t=this._predeterminedViewingMode;if(t!=null)return $R(t);const e=this.spatialReference;return e?this.defaultsFromMap?.viewingMode!=null&&e.equals(this.defaultsFromMap.spatialReference)?$R(this.defaultsFromMap.viewingMode):H$(e,Be.Global)?"global":"local":"global"}set viewingMode(t){this.ready?J.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",t)}get viewpoint(){return this.stateManager?.viewpoint}set viewpoint(t){this.stateManager&&(this.stateManager.viewpoint=t)}get visibleArea(){return this.stateManager?.visibleArea}get zoom(){return this.stateManager.zoom}set zoom(t){this.stateManager&&(this.stateManager.zoom=t)}get highlightOptions(){return this.highlights.find(({name:t})=>t===Dm)??new Lm}set highlightOptions(t){for(let e=0;e<this.highlights.length;++e)if(this.highlights.at(e).name===Dm)return void this.highlights.items[e].assignFrom(t)}get resourceController(){return this._resourceController}get quality(){return this._resourceController?.memoryController?.memoryFactor??1}get resolutionScale(){return Math.sqrt(Math.min(1,this.quality/.75))}get performanceInfo(){return new MEt(this)}on(t,e,i,r){return this.viewEvents.on(t,e,i,r)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}toMap(t,e){if(!this.ready)return J.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;const i=cU(t)?lU(this,t):t;return HTt(this,i,e,this._defaultToMapOptions)}toScreen(t){if(!this.ready)return J.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=(t.z==null?Tm(this.elevationProvider,t):null)??0;return pc(t,jF,this.renderSpatialReference,e),this.state.camera.projectToScreen(jF,Yq),wo(Yq[0],Yq[1])}pixelSizeAt(t,e){if(!this.ready)return J.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if(!t)return 0;const i=this.renderSpatialReference;pc(t,jF,i);const r=this.state.camera.computeScreenPixelSizeAt(jF);return e&&i!==e?r*Ao(i)/Ao(e):r}overlayPixelSizeInMapUnits(t){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(t,()=>this.pixelSizeAt(t)):1}hitTest(t,e){if(!this.ready)return J.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;const i=cU(t)?lU(this,t):t;return GTt(this,i,e,this._defaultHitTestOptions)}async popupHitTest(t){return rEt(this,t)}goTo(t,e){return this.updatingHandles.addPromise(this.stateManager.goTo(t,e))}async whenAnalysisView(t){if(t.parent==null)throw new U("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});switch(t.parent.type){case"line-of-sight":case"dimension":case"viewshed":return(await this.whenLayerView(t.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(t)}}whenLayerView(t){return super.whenLayerView(t)}async takeScreenshot(t){const e=await this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(e);return(await V(async()=>{const{encode:r}=await Promise.resolve().then(()=>gM);return{encode:r}},void 0)).encode(i,e,this._pixelFormat())}async _takeScreenshot(t){const e=await this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(e);return(await V(async()=>{const{encodeData:r}=await Promise.resolve().then(()=>gM);return{encodeData:r}},void 0)).encodeData(i,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(t){const e=await this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(e),{encodeData:r}=await V(async()=>{const{encodeData:s}=await Promise.resolve().then(()=>gM);return{encodeData:s}},void 0);return[r(i[0],this._pixelFormat()),r(i[1],this._pixelFormat())]}async _completeSettings(t){const{toRenderSettings:e,screenshotSuperSampleSettings:i}=await V(()=>Promise.resolve().then(()=>gM),void 0),r=e(t,this);return r.pixelRatio/=this.state.pixelRatio,i(r,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){}async takeScreenshotWithObjectAndLayerId(t){if(!Md())throw new U("360vr:objectAndLayerId-rendering-disabled","has enable-feature:objectAndLayerId-rendering must be true");const{encode:e}=await V(()=>Promise.resolve().then(()=>gM),void 0),i=await this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(i),s=e(r[0],i,this._pixelFormat()),n=await this._completeSettings(t);return n.format="png",[s,e(r[1],n,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){const t=this._stage.renderView.olidRenderHelper;if(t)return t.getColorToObjectAndLayerIdMapping();throw new U("360vr:objectAndLayerId-rendering-disabled","has enable-feature:objectAndLayerId-rendering must be true")}addUpdatingPromise(t){return this.updatingHandles.addPromise(t)}importLayerView(t){return Ffe.importLayerView(t)}hasLayerViewModule(t){return Ffe.hasLayerViewModule(t)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties?.spatialReference||this.defaultsFromMap?.spatialReference||this.defaultsFromMap?.ready&&this._initialDefaultSpatialReference||null}async validate(){let t=EMe(this.type);const e=X("safari");if(e&&e<9&&(t=new U("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),t!=null)throw J.getLogger(this).warn("#validate()",t.message),t}get _predeterminedViewingMode(){const t=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties?.viewingMode:null)??null;return t!=null?QZ(t):null}getSpatialReferenceSupport(t,e){const i=this._predeterminedViewingMode;if(i!=null)return this._validateSpatialReferenceForViewingMode(t,e,i)?{constraints:this._makeSpatialReferenceConstraints(t,e,i)}:null;const r=this._validateSpatialReferenceForViewingMode(t,e,Be.Local),s=this._validateSpatialReferenceForViewingMode(t,e,Be.Global);return r||s?r&&s?{constraints:this._makeSpatialReferenceConstraints(t,e,null)}:r?{constraints:this._makeSpatialReferenceConstraints(t,e,Be.Local)}:{constraints:this._makeSpatialReferenceConstraints(t,e,Be.Global)}:null}_validateSpatialReferenceForViewingMode(t,e,i){return!!H$(t,i)&&(e==null||!!nue(e)||(!EC(e)||TG(e,t,i)!=null)&&(!sue(e)||i!==Be.Global))}_makeSpatialReferenceConstraints(t,e,i){if(e==null)return[{spatialReference:t,viewingMode:i}];const{isWebMercator:r,isWGS84:s}=t;return nue(e)&&(r||s)?!s||i===Be.Local||T3(e.tileInfo,e.fullExtent,t,Be.Global)===null?[{spatialReference:t,viewingMode:i},{spatialReference:Ae.WebMercator,viewingMode:i}]:[{spatialReference:r?Ae.WGS84:Ae.WebMercator,viewingMode:i}]:EC(e)||sue(e)||!r&&!s?EC(e)&&r&&i!==Be.Global?[{spatialReference:t,viewingMode:i},{spatialReference:Ae.WGS84,viewingMode:Be.Local}]:[{spatialReference:t,viewingMode:i}]:[{spatialReference:t,viewingMode:i},{spatialReference:r?Ae.WGS84:Ae.WebMercator,viewingMode:i}]}_validateSpatialReference(t){const e=this.getSpatialReferenceSupport(t)!=null,i=this._predeterminedViewingMode;return e||(i!=null?J.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${$R(i)} viewing mode.`):t.isGeographic&&J.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}trackGraphicState(t){if(!t.graphic)return J.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(t.graphic);let i=null,r=!1;const s=n=>{!r&&n!=null&&"processor"in n&&n.processor?.type==="graphics-3d"&&n.processor.graphicsCore&&(i=n.processor.graphicsCore.trackGraphicState(t))};return e!=null?s(e):this.whenViewForGraphic(t.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),$i(()=>{r=!0,i!=null&&(i.remove(),i=null)})}maskOccludee(t){if(!t)return J.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(t);let i=null,r=!1;const s=n=>{!r&&n!=null&&wPt(n)&&(i=n.maskOccludee(t))};return e!=null?s(e):this.whenViewForGraphic(t,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),$i(()=>{r=!0,i!=null&&(i.remove(),i=null)})}getViewForGraphic(t){return t.layer===this.graphics?this.graphicsView:t.layer?this.allLayerViews.filter(e=>e.type!=="media-3d").find(e=>e.layer===t.layer):null}graphicChanged(t){this.graphicsView!=null&&this.graphicsView.graphicChanged(t)}async whenViewForGraphic(t,e){if(t.layer===this)return await Cd(()=>this.graphicsView),this.graphicsView;if(!t.layer||!this.map)throw new U("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(t.layer)?new Promise((i,r)=>{const s=this.map.allLayers.on("change",n=>{n.added.includes(t.layer)&&(s.remove(),this.whenLayerView(t.layer).then(i,r))})}):this.whenLayerView(t.layer)}_initBasemapTerrain(){this._set("basemapTerrain",new OAt({view:this})),this._set("elevationProvider",new EI({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new ql({view:this})),this._set("featureTiles",new zo({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const t=()=>{const e=this.basemapTerrain?.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const i=this.basemapTerrain.extent!=null&&this.basemapTerrain.spatialReference!=null?Id(tD(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.clippingArea?this.featureTiles.filterExtent=this.clippingArea.intersection(i):this.featureTiles.filterExtent=i}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>bs.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(V(()=>import("./FeatureTileTree3DDebugger-DBVZWuoc.js"),__vite__mapDeps([366,363]))).then(({FeatureTileTree3DDebugger:i})=>{!this._featureTreeDebugger&&bs.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new i({view:this}))}):e||!this._featureTreeDebugger||bs.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},St),this.updatingHandles.add(()=>this.clippingArea,t,St),this.updatingHandles.add(()=>this.basemapTerrain.extent,t,St)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.featureTiles&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this._set("featureTiles",Ce(this.featureTiles)),this._set("pointsOfInterest",Ce(this.pointsOfInterest)),this._exitBasemapTerrain(),this.state.reset(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const t=this.spatialReference,e=this.state.isGlobal,i=qat(e,t);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",aEt.create(this.state.viewingMode,i)),e||this.addHandles(H(()=>this.basemapTerrain?.extent,r=>{const s=this.renderCoordsHelper.spatialReference;r==null||r[0]===0&&r[1]===0&&r[2]===0&&r[3]===0||!Xie(r,this.basemapTerrain.spatialReference,K0e,s)||(this.renderCoordsHelper.extent=K0e)},Gt),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(z$/this.renderCoordsHelper.unitInMeters))}else this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null)}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(t=null){t!=null&&t.type===Tr.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.addHandles(H(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),Gt),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(t,e,i){if(!this.overlay||!this.overlay.hasVisibleItems)return i;const r=t.getContext("2d");return r.putImageData(i,0,0),this.overlay.renderCanvas(t,{disableDecorations:e}),r.getImageData(0,0,i.width,i.height)}_initStage(){const t={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(r,s,n)=>this._renderScreenshotOverlay(r,s,n)}},e=new YTt(this.state.viewingMode,r=>this._stage.layers.forAll(r),this);this._set("sceneIntersectionHelper",e);const i=FV(this.surface);this._stage=new Ih({view:this,options:t,container:i}),this._stage.renderer.slicePlane=this.slicePlane,this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,r=>this._stage.renderer.setParameters({highQualityTransparency:r}),Nt),this.on("pointer-move",()=>this._stage?.renderer.resetAnimation()),fA(this._stage.renderView.canvas,"webglcontextlost",r=>{this.fatalError=new U("webgl-context-lost",r.statusMessage)})],"stage"),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(z$/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=Ce(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(t){this._exitSurface(),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new GEt({view:this,viewingMode:t,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;const t=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(t,t),this._updatingChanged()}async _createGraphicsViewAsync(t){const e=(await V(async()=>{const{default:i}=await import("./GraphicsView3D-i9mFEAy7.js");return{default:i}},__vite__mapDeps([367,278,257,258,27,26,170,271,260]))).default;gt(t),await Cd(()=>this.basemapTerrain?.ready,t),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),this.graphicsView!=null&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const t=QZ(this.viewingMode);t===Be.Global&&(this._clippingArea=null),this._initSurface(t),this._set("ready",!0),this.addHandles(io(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded();const e=this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties:null,i=e?.environment;i&&(this._overrideDefaultEnvironmentOnly?pOe(this.environment,i):this.environment=this.environment.cloneWithWebsceneEnvironment(i)),this.timeExtent=e?.timeExtent,this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect(),this._set("textures",new nC(this._stage,this.resourceController.scheduler));const r=this._resolveWhenReady;this._resolveWhenReady=[],r.forEach(s=>s(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this._overrideDefaultEnvironmentOnly=!1,this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._set("textures",Ce(this.textures)),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(Ob);for(const t of this.map.allLayers.items)NP(t.type)&&this._defaultToMapOptions.include.add(t.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(Ob);for(const t of this.map.allLayers.items)NP(t.type)&&t.opacity<1&&this._defaultHitTestOptions.exclude.add(t.uid)}}};function VF(t,e){return t!=null&&ru(t.spatialReference,e)?Id(t,e):null}Ge.type="3d",u([p()],Ge.prototype,"_userClippingArea",void 0),u([p()],Ge.prototype,"_resourceController",void 0),u([p()],Ge.prototype,"_stage",void 0),u([p({readOnly:!0})],Ge.prototype,"deconflictor",void 0),u([p({readOnly:!0})],Ge.prototype,"labeler",void 0),u([p($W(x$,"analyses"))],Ge.prototype,"analyses",void 0),u([p({type:cv,readOnly:!0})],Ge.prototype,"animation",null),u([p({readOnly:!0})],Ge.prototype,"basemapTerrain",void 0),u([p({readOnly:!0})],Ge.prototype,"elevationProvider",void 0),u([p()],Ge.prototype,"camera",null),u([p({type:tu})],Ge.prototype,"contentCamera",null),u([p({readOnly:!0})],Ge.prototype,"canvas",void 0),u([p({type:ke})],Ge.prototype,"center",null),u([p({type:gi})],Ge.prototype,"clippingArea",null),u([p({type:ix})],Ge.prototype,"constraints",void 0),u([p({type:gi,readOnly:!0})],Ge.prototype,"renderDataExtent",null),u([p({readOnly:!0})],Ge.prototype,"tileInfo",null),u([p({type:gi,readOnly:!0})],Ge.prototype,"dataExtent",null),u([p({type:gi,readOnly:!0})],Ge.prototype,"_groundAndLayersExtent",null),u([p({type:jE})],Ge.prototype,"environment",void 0),u([Yt("environment")],Ge.prototype,"castEnvironment",null),u([p({readOnly:!0})],Ge.prototype,"environmentManager",void 0),u([p({type:gi})],Ge.prototype,"extent",null),u([p({type:Ee})],Ge.prototype,"floors",void 0),u([p()],Ge.prototype,"screenCenter",null),u([p()],Ge.prototype,"frustum",null),u([p({type:Number,readOnly:!0})],Ge.prototype,"fullOpacity",void 0),u([p({readOnly:!0})],Ge.prototype,"graphicsView",void 0),u([p({readOnly:!0})],Ge.prototype,"analysisViewManager",void 0),u([p()],Ge.prototype,"groundView",void 0),u([p({type:Boolean})],Ge.prototype,"initialExtentRequired",null),u([p()],Ge.prototype,"defaultsFromMapSettings",null),u([p()],Ge.prototype,"interacting",null),u([p()],Ge.prototype,"stationary",null),u([p()],Ge.prototype,"navigating",null),u([p()],Ge.prototype,"map",void 0),u([p()],Ge.prototype,"padding",null),u([p({type:ql,readOnly:!0})],Ge.prototype,"pointsOfInterest",void 0),u([p({type:zo,readOnly:!0})],Ge.prototype,"featureTiles",void 0),u([p()],Ge.prototype,"_featureTreeDebugger",void 0),u([p({type:Boolean})],Ge.prototype,"screenSizePerspectiveEnabled",void 0),u([p({constructOnly:!0})],Ge.prototype,"deactivatedWebGLExtensions",void 0),u([p({constructOnly:!0})],Ge.prototype,"debugWebGLExtensions",void 0),u([p({constructOnly:!0})],Ge.prototype,"renderCanvas",void 0),u([p({constructOnly:!0})],Ge.prototype,"state",void 0),u([p({readOnly:!0})],Ge.prototype,"inputManager",void 0),u([p({readOnly:!0})],Ge.prototype,"stateManager",void 0),u([p({type:["low","medium","high"]})],Ge.prototype,"qualityProfile",null),u([p({type:Vge,get(){let t=this._get("qualitySettings");return t||(t=new Vge,kx.apply(this.qualityProfile,t)),t}})],Ge.prototype,"qualitySettings",void 0),u([p()],Ge.prototype,"slicePlane",null),u([p({readOnly:!0})],Ge.prototype,"typeSpecificPreconditionsReady",null),u([p({readOnly:!0})],Ge.prototype,"renderCoordsHelper",void 0),u([p({readOnly:!0})],Ge.prototype,"sceneIntersectionHelper",void 0),u([p({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],Ge.prototype,"resolution",null),u([p({type:Number})],Ge.prototype,"scale",null),u([p()],Ge.prototype,"heightModelInfo",null),u([p()],Ge.prototype,"spatialReference",void 0),u([p({type:Boolean,constructOnly:!0})],Ge.prototype,"alphaCompositingEnabled",void 0),u([p({constructOnly:!0})],Ge.prototype,"preserveDrawingBufferEnabled",void 0),u([p({type:Boolean})],Ge.prototype,"supersampleScreenshotsEnabled",void 0),u([p({readOnly:!0})],Ge.prototype,"type",void 0),u([p(),Yt(t=>t instanceof gj?t:uA(Kke,t))],Ge.prototype,"ui",void 0),u([p({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating","textures.updating"]})],Ge.prototype,"updating",null),u([p()],Ge.prototype,"_updatingObjects",null),u([p()],Ge.prototype,"_updatingObjectsWithProgress",null),u([p({type:Number,readOnly:!0,dependsOn:["updating"]})],Ge.prototype,"updatingProgress",void 0),u([p({type:["global","local"]})],Ge.prototype,"viewingMode",null),u([p({type:Jr})],Ge.prototype,"viewpoint",null),u([p({readOnly:!0})],Ge.prototype,"visibleArea",null),u([p({type:Number})],Ge.prototype,"zoom",null),u([p({type:Lm})],Ge.prototype,"highlightOptions",null),u([p({readOnly:!0})],Ge.prototype,"quality",null),u([p({readOnly:!0})],Ge.prototype,"resolutionScale",null),u([p()],Ge.prototype,"textures",void 0),Ge=u([A("esri.views.SceneView")],Ge);const jF=$(),Yq=nn(),K0e=Qt(),$Pt=Ge;let APt=class Qke{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(r7),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const i=new Qke,r=this._originStores[Ti.DEFAULTS];r&&r.forEach((s,n)=>{i.set(n,q(s),Ti.DEFAULTS)});for(let s=Ti.SERVICE;s<r7;s++){const n=this._originStores[s];n&&n.forEach((o,a)=>{e&&e.has(a)||i.set(a,q(o),s)})}return i}get(e,i){const r=i===void 0?this._values:this._originStores[i];return r?r.get(e):void 0}keys(e){const i=e==null?this._values:this._originStores[e];return i?[...i.keys()]:[]}set(e,i,r=Ti.USER){let s=this._originStores[r];if(s||(s=new Map,this._originStores[r]=s),s.set(e,i),!this._values.has(e)||this._propertyOriginMap.get(e)<=r){const n=this._values.get(e);return this._values.set(e,i),this._propertyOriginMap.set(e,r),n!==i}return!1}delete(e,i=Ti.USER){const r=this._originStores[i];if(!r)return;const s=r.get(e);if(r.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===i){this._values.delete(e);for(let n=i-1;n>=0;n--){const o=this._originStores[n];if(o&&o.has(e)){this._values.set(e,o.get(e)),this._propertyOriginMap.set(e,n);break}}}return s}has(e,i){const r=i===void 0?this._values:this._originStores[i];return!!r&&r.has(e)}revert(e,i){for(;i>0&&!this.has(e,i);)--i;const r=this._originStores[i],s=r?.get(e),n=this._values.get(e);return this._values.set(e,s),this._propertyOriginMap.set(e,i),n!==s}originOf(e){return this._propertyOriginMap.get(e)||Ti.DEFAULTS}forEach(e){this._values.forEach(e)}};const e4e=t=>{let e=class extends t{constructor(...i){super(...i);const r=El(this),s=r.store,n=new APt;r.store=n,xxe(r,s,n)}read(i,r){Txe(this,i,r)}getAtOrigin(i,r){const s=Jq(this),n=z_(r);if(typeof i=="string")return s.get(i,n);const o={};return i.forEach(a=>{o[a]=s.get(a,n)}),o}originOf(i){return Tz(this.originIdOf(i))}originIdOf(i){return Jq(this).originOf(i)}revert(i,r){const s=Jq(this),n=z_(r),o=El(this);let a;a=typeof i=="string"?i==="*"?s.keys(n):[i]:i,a.forEach(l=>{o.invalidate(l),s.revert(l,n),o.commit(l)})}};return e=u([A("esri.core.ReadOnlyMultiOriginJSONSupport")],e),e};function Jq(t){return El(t).store}let Q0e=class extends e4e(ue){};Q0e=u([A("esri.core.ReadOnlyMultiOriginJSONSupport")],Q0e);const MPt=t=>{let e=class extends t{constructor(...i){super(...i)}clear(i,r="user"){return Xq(this).delete(i,z_(r))}write(i,r){return Cxe(this,i=i||{},r),i}setAtOrigin(i,r,s){El(this).setAtOrigin(i,r,z_(s))}removeOrigin(i){const r=Xq(this),s=z_(i),n=r.keys(s);for(const o of n)r.originOf(o)===s&&r.set(o,r.get(o,s),Ti.USER)}updateOrigin(i,r){const s=Xq(this),n=z_(r),o=Rm(this,i);for(let a=n+1;a<r7;++a)s.delete(i,a);s.set(i,o,n)}toJSON(i){return this.write({},i)}};return e=u([A("esri.core.MultiOriginJSONSupport.WriteableMultiOriginJSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function Xq(t){return El(t).store}const eL=t=>{let e=class extends MPt(e4e(t)){constructor(...i){super(...i)}};return e=u([A("esri.core.MultiOriginJSONSupport")],e),e};let $3=class extends eL(ue){};$3=u([A("esri.core.MultiOriginJSONSupport")],$3);async function OPt(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return ux(t);const i=Ae.WGS84;return await lD(e,i),Id(t,i)}function ew(t,e){if(!xx(t,e)){const i=t.typeKeywords;i?i.push(e):t.typeKeywords=[e]}}function xx(t,e){return!!t.typeKeywords?.includes(e)}function Ohi(t){return xx(t,vS.HOSTED_SERVICE)}function Yl(t,e){const i=t.typeKeywords;if(i){const r=i.indexOf(e);r>-1&&i.splice(r,1)}}function e_e(t,e,i){i?ew(t,e):Yl(t,e)}async function Ihi(t){const e=t.clone().normalize();let i;if(e.length>1)for(const r of e)i?r.width>i.width&&(i=r):i=r;else i=e[0];return OPt(i)}const vS={DEVELOPER_BASEMAP:"DeveloperBasemap",GROUP_LAYER_MAP:"Map",HOSTED_SERVICE:"Hosted Service",JSAPI:"ArcGIS API for JavaScript",LOCAL_SCENE:"ViewingMode-Local",METADATA:"Metadata",MULTI_LAYER:"Multilayer",ORIENTED_IMAGERY_LAYER:"OrientedImageryLayer",SINGLE_LAYER:"Singlelayer",SUBTYPE_GROUP_LAYER:"SubtypeGroupLayer",SUBTYPE_GROUP_TABLE:"SubtypeGroupTable",TABLE:"Table",TILED_IMAGERY:"Tiled Imagery"};function IPt(t){const{portal:e,isOrgItem:i,itemControl:r}=t,s=e.user?.privileges;let n=!s||s.includes("features:user:edit"),o=!!i&&!!s?.includes("features:user:fullEdit");const a=r==="update"||r==="admin";return a?o=n=!0:o&&(n=!0),{features:{edit:n,fullEdit:o},content:{updateItem:a}}}let X0=class extends ee{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};u([p({type:String,json:{write:{isRequired:!0}}})],X0.prototype,"facilityIdField",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],X0.prototype,"layerId",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],X0.prototype,"nameField",void 0),u([p({type:String,json:{write:!0}})],X0.prototype,"siteIdField",void 0),u([p({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],X0.prototype,"sublayerId",void 0),X0=u([A("esri.layers.support.FacilityLayerInfo")],X0);const RPt=X0;let vp=class extends ee{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.levelIdField=null,this.levelNumberField=null,this.longNameField=null,this.shortNameField=null,this.sublayerId=null,this.verticalOrderField=null}};u([p({type:String,json:{write:{isRequired:!0}}})],vp.prototype,"facilityIdField",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],vp.prototype,"layerId",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],vp.prototype,"levelIdField",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],vp.prototype,"levelNumberField",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],vp.prototype,"longNameField",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],vp.prototype,"shortNameField",void 0),u([p({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],vp.prototype,"sublayerId",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],vp.prototype,"verticalOrderField",void 0),vp=u([A("esri.layers.support.LevelLayerInfo")],vp);const PPt=vp;let R1=class extends ee{constructor(e){super(e),this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};u([p({type:String,json:{write:{isRequired:!0}}})],R1.prototype,"layerId",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],R1.prototype,"nameField",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],R1.prototype,"siteIdField",void 0),u([p({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],R1.prototype,"sublayerId",void 0),R1=u([A("esri.layers.support.SiteLayerInfo")],R1);const DPt=R1;let XE=class extends ee{constructor(e){super(e),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null}};u([p({type:PPt,json:{write:{isRequired:!0}}})],XE.prototype,"levelLayer",void 0),u([p({type:RPt,json:{write:{isRequired:!0}}})],XE.prototype,"facilityLayer",void 0),u([p({type:DPt,json:{write:!0}})],XE.prototype,"siteLayer",void 0),XE=u([A("esri.support.MapFloorInfo")],XE);const t4e=XE;var vl;(function(t){t[t.SAVE=0]="SAVE",t[t.SAVE_AS=1]="SAVE_AS"})(vl||(vl={}));var iK;let KE=iK=class extends ee{constructor(t){super(t),this.activeRange=null,this.currentRangeExtent=null,this.fullRangeExtent=null}clone(){return new iK(q({activeRange:this.activeRange,currentRangeExtent:this.currentRangeExtent,fullRangeExtent:this.fullRangeExtent}))}};u([p({type:String,nonNullable:!0,json:{read:{source:"activeRangeName"},write:{target:"activeRangeName",isRequired:!0}}})],KE.prototype,"activeRange",void 0),u([p({type:[Number],json:{write:!0}})],KE.prototype,"currentRangeExtent",void 0),u([p({type:[Number],json:{write:!0}})],KE.prototype,"fullRangeExtent",void 0),KE=iK=u([A("esri.webdoc.RangeInfo")],KE);const boe=KE;var rK;let sm=rK=class extends ee{constructor(t){super(t),this.enabled=!1,this.longNames=!1,this.minimized=!1,this.pinnedLevels=!1,this.site=null,this.facility=null,this.level=null}clone(){return new rK(q({enabled:this.enabled,longNames:this.longNames,minimized:this.minimized,pinnedLevels:this.pinnedLevels,site:this.site,facility:this.facility,level:this.level}))}};u([p({type:Boolean,json:{read:{source:"enabled"},write:{target:"enabled"}}})],sm.prototype,"enabled",void 0),u([p({type:Boolean,json:{read:{source:"longNames"},write:{target:"longNames"}}})],sm.prototype,"longNames",void 0),u([p({type:Boolean,json:{read:{source:"minimized"},write:{target:"minimized"}}})],sm.prototype,"minimized",void 0),u([p({type:Boolean,json:{read:{source:"pinnedLevels"},write:{target:"pinnedLevels"}}})],sm.prototype,"pinnedLevels",void 0),u([p({type:String,json:{read:{source:"site"},write:{target:"site"}}})],sm.prototype,"site",void 0),u([p({type:String,json:{read:{source:"facility"},write:{target:"facility"}}})],sm.prototype,"facility",void 0),u([p({type:String,json:{read:{source:"level"},write:{target:"level"}}})],sm.prototype,"level",void 0),sm=rK=u([A("esri.webdoc.widgets.FloorFilter")],sm);const LPt=sm;var sK;const GF=new ei({slider:"slider",picker:"picker"});let QE=sK=class extends ee{constructor(t){super(t),this.interactionMode=null,this.numStops=null,this.stopInterval=null}clone(){return new sK({interactionMode:this.interactionMode,numStops:this.numStops,stopInterval:this.stopInterval})}};u([p({type:GF.apiValues,nonNullable:!0,json:{type:GF.jsonValues,default:null,read:{reader:GF.read},write:{isRequired:!0,writer:GF.write}}})],QE.prototype,"interactionMode",void 0),u([p({type:Ei,json:{read:{source:"numberOfStops"},write:{target:"numberOfStops",overridePolicy(){const t=this.stopInterval!=null;return{enabled:!t,isRequired:!t}}}}})],QE.prototype,"numStops",void 0),u([p({type:Number,json:{write:{overridePolicy(){return{isRequired:this.numStops==null}}}}})],QE.prototype,"stopInterval",void 0),QE=sK=u([A("esri.webdoc.widgets.Range")],QE);const NPt=QE,woe=Mo()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});let NI=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return iCe(this.value,this.unit,"milliseconds")}};u([Ue(woe,{nonNullable:!0})],NI.prototype,"unit",void 0),u([p({type:Number,json:{write:!0},nonNullable:!0})],NI.prototype,"value",void 0),NI=u([A("esri.time.TimeInterval")],NI);const _S=NI;var nK;let Fo=nK=class extends ee{constructor(t){super(t),this.currentTimeExtent=null,this.fullTimeExtent=null,this.loop=!1,this.numStops=null,this.numThumbs=null,this.stopDelay=null,this.stopInterval=null,this.stops=null}readCurrentTimeExtent(t){return t?To.fromArray(t):void 0}writeCurrentTimeExtent(t,e,i){t&&to(i,t.toArray(),e)}readFullTimeExtent(t,e){const i=e.properties;if(!i)return;const r=i.endTime!=null?new Date(i.endTime):null,s=i.startTime!=null?new Date(i.startTime):null;return new To({start:s,end:r})}writeFullTimeExtent(t,e){if(!t)return;const i=e.properties=e.properties||{},r=t.end,s=t.start;r&&(i.endTime=r!=null?r.getTime():null),s&&(i.startTime=s!=null?s.getTime():null)}readStopInterval(t,e,i){return t?_S.fromJSON({value:t.interval,unit:t.units},i):null}writeStopInterval(t,e,i,r){if(!t)return;const s=t.toJSON(r);to("properties.timeStopInterval",{interval:s.value,units:s.unit},e)}readStops(t){return t?.length?t.map(e=>new Date(e)):null}writeStops(t,e,i){t?.length&&to(i,t.map(r=>r.getTime()),e)}clone(){return new nK(q({currentTimeExtent:this.currentTimeExtent,fullTimeExtent:this.fullTimeExtent,loop:this.loop,numStops:this.numStops,numThumbs:this.numThumbs,stopDelay:this.stopDelay,stopInterval:this.stopInterval,stops:this.stops}))}};u([p({type:To,json:{type:[[Ei,hA]],read:{source:"properties.currentTimeExtent"},write:{target:"properties.currentTimeExtent"}}})],Fo.prototype,"currentTimeExtent",void 0),u([me("currentTimeExtent")],Fo.prototype,"readCurrentTimeExtent",null),u([ge("currentTimeExtent")],Fo.prototype,"writeCurrentTimeExtent",null),u([p({type:To,json:{read:{source:["properties.endTime","properties.startTime"]},write:{target:{"properties.endTime":{type:Number},"properties.startTime":{type:Number}}}}})],Fo.prototype,"fullTimeExtent",void 0),u([me("fullTimeExtent")],Fo.prototype,"readFullTimeExtent",null),u([ge("fullTimeExtent")],Fo.prototype,"writeFullTimeExtent",null),u([p({type:Boolean,nonNullable:!0,json:{default:!1,read:{source:"properties.loop"},write:{target:"properties.loop"}}})],Fo.prototype,"loop",void 0),u([p({type:Ei,json:{read:{source:"properties.numberOfStops"},write:{target:"properties.numberOfStops",overridePolicy(){const t=!!this.stopInterval,e=!!this.stops?.length,i=!(t||e);return{enabled:i,isRequired:i}}}}})],Fo.prototype,"numStops",void 0),u([p({type:[1,2],nonNullable:!0,json:{type:Ei,read:{source:"properties.thumbCount"},write:{target:"properties.thumbCount",isRequired:!0}}})],Fo.prototype,"numThumbs",void 0),u([p({type:Number,nonNullable:!0,json:{read:{source:"properties.thumbMovingRate"},write:{target:"properties.thumbMovingRate",isRequired:!0}}})],Fo.prototype,"stopDelay",void 0),u([p({type:_S,json:{read:{source:"properties.timeStopInterval"},write:{target:{"properties.timeStopInterval.interval":{type:Number},"properties.timeStopInterval.units":{type:woe.jsonValues.filter(t=>t!=="esriTimeUnitsUnknown")}},overridePolicy(){const t=this.numStops!=null,e=!!this.stops?.length;return{enabled:!e,isRequired:!(t||e)}}}}})],Fo.prototype,"stopInterval",void 0),u([me("stopInterval")],Fo.prototype,"readStopInterval",null),u([ge("stopInterval")],Fo.prototype,"writeStopInterval",null),u([p({type:[Date],json:{type:[Ei],read:{source:"properties.stops"},write:{target:"properties.stops",overridePolicy(){return{isRequired:this.numStops==null&&!this.stopInterval}}}}})],Fo.prototype,"stops",void 0),u([me("stops")],Fo.prototype,"readStops",null),u([ge("stops")],Fo.prototype,"writeStops",null),Fo=nK=u([A("esri.webdoc.widgets.TimeSlider")],Fo);const FPt=Fo;var oK;let e2=oK=class extends ee{constructor(t){super(t),this.range=null,this.timeSlider=null,this.floorFilter=null}clone(){return new oK(q({range:this.range,timeSlider:this.timeSlider,floorFilter:this.floorFilter}))}};u([p({type:NPt,json:{write:!0}})],e2.prototype,"range",void 0),u([p({type:FPt,json:{write:!0}})],e2.prototype,"timeSlider",void 0),u([p({type:LPt,json:{write:!0}})],e2.prototype,"floorFilter",void 0),e2=oK=u([A("esri.webdoc.Widgets")],e2);const i4e=e2,kPt={width:600,height:400},HF=1.5;function r4e(t,e){e=e||kPt;let{width:i,height:r}=e;const s=i/r;return s<HF?r=i/HF:s>HF&&(i=r*HF),i>t.width&&(r*=t.width/i,i=t.width),r>t.height&&(i*=t.height/r,r=t.height),{width:Math.round(i),height:Math.round(r)}}function zPt(t,e){return{...s4e(t,e),readResourcePaths:[]}}function aK(t,e,i){const r=pn(t.itemUrl);return{...s4e(t,e),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:r?{rootPath:r.path,writtenUrls:[]}:null,resources:i?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function s4e(t,e){return{origin:e,url:pn(t.itemUrl),portal:t.portal||fn.getDefault(),portalItem:t}}let P1=class extends ee{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(s=>s.toJSON()),i=this.geometries[0],r={};return r.outSR=zz(this.outSpatialReference),r.inSR=zz(i.spatialReference),r.geometries=JSON.stringify({geometryType:iD(i),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(r.transformForward=this.transformForward),r}};u([p()],P1.prototype,"geometries",void 0),u([p({type:Ae,json:{read:{source:"outSR"}}})],P1.prototype,"outSpatialReference",void 0),u([p()],P1.prototype,"transformation",void 0),u([p()],P1.prototype,"transformForward",void 0),P1=u([A("esri.rest.support.ProjectParameters")],P1);const xoe=P1,UPt=Is(xoe);async function n4e(t,e,i){e=UPt(e);const r=Q$e(t),s={...r.query,f:"json",...e.toJSON()},n=e.outSpatialReference,o=iD(e.geometries[0]),a=FQe(s,i);return Ci(r.path+"/project",a).then(({data:{geometries:l}})=>eAe(l,o,n))}function BPt(t,e){return e.resourceInfo?o4e(e,e.resourceInfo,{origin:t.origin}):e.portalItem?.id?VPt(t,e,e.portalItem):Promise.resolve()}function o4e(t,e,i){const r={context:{...i,layerContainerType:"operational-layers"}};return t.portalItem&&(r.context.portal=t.portalItem.portal||fn.getDefault()),V(()=>import("./layersCreator-oRwakYTV.js"),__vite__mapDeps([118,119,120,121,122,123])).then(({populateOperationalLayers:s})=>{const n=[],o=e.operationalLayers;o?.length&&n.push(s(t.layers,o,r));const a={...r,context:{...r.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"},l=e.tables;return l?.length&&n.push(s(t.tables,l,a)),Promise.allSettled(n).then(()=>{})})}async function VPt(t,e,i){if(await i.load().catch(o=>{throw new U(`${t.name}:load-portal-item`,"Failed to load portal item",{error:o})}),i.type!==t.itemType)throw new U(`${t.name}:invalid-portal-item`,`Invalid portal item type '${i.type}', expected '${t.itemType}'`,{type:i.type});const r=await i.fetchData();e.resourceInfo=r;const s=zPt(i,t.origin);await jPt(t,e,r,s),e.resourceReferences={portalItem:i,paths:s.readResourcePaths};const n=await HPt(e.initialViewProperties,i,J.getLogger(e));if(n){const o=e.initialViewProperties?.clone()??t.createInitialViewProperties();o.viewpoint=n,e.initialViewProperties=o}}function jPt(t,e,i,r){const s=GPt(t,i);return e.read(s,r),o4e(e,s,r)}function GPt(t,e){const i=t.parseVersion(e.version||"",t.name);return t.currentVersion.validate(i),e.version=`${i.major}.${i.minor}`,e}async function HPt(t,e,i){if(t?.viewpoint?.targetGeometry)return null;const s=await qPt(t,e,i);return s?new Jr({targetGeometry:s}):null}async function qPt(t,e,i){const r=t?.spatialReference,s=e?.extent;if(!r||!s)return null;if(r.isWGS84)return s.clone();if(r.isWebMercator)return Gy(s);const{getGeometryServiceURL:n}=await V(()=>import("./geometryServiceUtils-DDNHyfMa.js"),[]);try{const o=await n(e),a=new xoe({geometries:[s],outSpatialReference:r});return(await n4e(o,a))[0]}catch(o){i.error("Error projecting item's extent:",o)}return null}function t_e(t){return{enabled:!!t?.length}}var lK;let t2=lK=class extends ee{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new lK({exactMatch:this.exactMatch,type:this.type,name:this.name})}};u([p({type:Boolean,json:{write:!0}})],t2.prototype,"exactMatch",void 0),u([p({type:String,json:{write:!0}})],t2.prototype,"name",void 0),u([Ue(yie)],t2.prototype,"type",void 0),t2=lK=u([A("esri.webdoc.applicationProperties.SearchLayerField")],t2);const WPt=t2;var cK;let i2=cK=class extends ee{constructor(t){super(t),this.field=null,this.id=null,this.subLayer=null}clone(){return new cK(q({field:this.field,id:this.id,subLayer:this.subLayer}))}};u([p({type:WPt,json:{write:{isRequired:!0}}})],i2.prototype,"field",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],i2.prototype,"id",void 0),u([p({type:Ei,json:{write:!0}})],i2.prototype,"subLayer",void 0),i2=cK=u([A("esri.webdoc.applicationProperties.SearchLayer")],i2);const ZPt=i2;var uK;let r2=uK=class extends ee{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new uK({exactMatch:this.exactMatch,type:this.type,name:this.name})}};u([p({type:Boolean,json:{write:!0}})],r2.prototype,"exactMatch",void 0),u([p({type:String,json:{write:!0}})],r2.prototype,"name",void 0),u([Ue(yie)],r2.prototype,"type",void 0),r2=uK=u([A("esri.webdoc.applicationProperties.SearchTableField")],r2);const YPt=r2;var hK;let FI=hK=class extends ee{constructor(t){super(t),this.field=null,this.id=null}clone(){return new hK(q({field:this.field,id:this.id}))}};u([p({type:YPt,json:{write:{isRequired:!0}}})],FI.prototype,"field",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],FI.prototype,"id",void 0),FI=hK=u([A("esri.webdoc.applicationProperties.SearchTable")],FI);const JPt=FI;var dK;const a4e=Ee.ofType(ZPt),l4e=Ee.ofType(JPt);let nm=dK=class extends ee{constructor(t){super(t),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new a4e,this.tables=new l4e}readAddressSearchEnabled(t){return!t}writeAddressSearchEnabled(t,e,i){e[i]=!t}clone(){return new dK(q({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};u([p({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],nm.prototype,"addressSearchEnabled",void 0),u([me("addressSearchEnabled")],nm.prototype,"readAddressSearchEnabled",null),u([ge("addressSearchEnabled")],nm.prototype,"writeAddressSearchEnabled",null),u([p({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],nm.prototype,"enabled",void 0),u([p({type:String,json:{write:!0}})],nm.prototype,"hintText",void 0),u([p({type:a4e,json:{write:{overridePolicy:t_e},origins:{"web-scene":{write:{isRequired:!0}}}}})],nm.prototype,"layers",void 0),u([p({type:l4e,json:{read:!0,write:{overridePolicy:t_e}}})],nm.prototype,"tables",void 0),nm=dK=u([A("esri.webdoc.applicationProperties.Search")],nm);const XPt=nm;var pK;let I5=pK=class extends ee{constructor(t){super(t),this.search=null}clone(){return new pK(q({search:this.search}))}};u([p({type:XPt,json:{write:!0}})],I5.prototype,"search",void 0),I5=pK=u([A("esri.webdoc.applicationProperties.Viewing")],I5);const c4e=I5;var fK;let s2=fK=class extends ee{constructor(t){super(t),this.editing=null,this.offline=null,this.viewing=null}clone(){return new fK(q({editing:this.editing,offline:this.offline,viewing:this.viewing}))}};u([p({json:{write:!0}})],s2.prototype,"editing",void 0),u([p({json:{write:!0}})],s2.prototype,"offline",void 0),u([p({type:c4e,json:{write:!0}})],s2.prototype,"viewing",void 0),s2=fK=u([A("esri.webmap.ApplicationProperties")],s2);const KPt=s2;var mK;let nc=mK=class extends ee{constructor(){super(...arguments),this.url=""}destroy(){this.url=""}get isSecureUrl(){return kxe(this.url)}get isDataURI(){return wf(this.url)}clone(){return new mK({url:this.url})}};u([p({type:String,json:{write:{isRequired:!0}}})],nc.prototype,"url",void 0),u([p()],nc.prototype,"isSecureUrl",null),u([p()],nc.prototype,"isDataURI",null),nc=mK=u([A("esri.webdoc.support.SlideThumbnail")],nc);const Soe={type:To,json:{read:{source:"timeExtent",reader:t=>t?Array.isArray(t)?To.fromArray(t):To.fromJSON(t):null},write:{writer:(t,e,i,r)=>{t&&(t.isEmpty?r?.messages&&r.messages.push(new U("invalid-timeExtent","TimeExtent cannot be empty")):e[i]=t.toArray())},target:{timeExtent:{type:[[Ei,hA]]}}}}};var gK;let om=gK=class extends OS.IdentifiableMixin(ee){constructor(t){super(t),this.name=null,this.thumbnail=new nc,this.timeExtent=null}castThumbnail(t){return typeof t=="string"?new nc({url:t}):Is(nc,t)}set viewpoint(t){const{targetGeometry:e,scale:i}=t;e!=null&&e.type==="point"&&i==null&&J.getLogger(this).warn("Bookmark.viewpoint should include 'scale' when its targetGeometry is a point.",t),this._set("viewpoint",t)}readViewpoint(t,e){const{extent:i,viewpoint:r}=e;return Jr.fromJSON(r||{targetGeometry:i})}writeViewpoint(t,e,i,r){if(!t)return;const{targetGeometry:s}=t;if(s==null||s.type==="extent")s!=null&&(e.extent=s.toJSON()),e[i]=t.toJSON();else{const n="Bookmark.viewpoint cannot be written to JSON when the viewpoint's targetGeometry is not an extent.";r?.messages?r.messages.push(new U("property:unsupported",n)):J.getLogger(this).error(n)}}clone(){return new gK(q({name:this.name,thumbnail:this.thumbnail,timeExtent:this.timeExtent,viewpoint:this.viewpoint}))}};u([p({type:String,nonNullable:!0,json:{write:{isRequired:!0}}})],om.prototype,"name",void 0),u([p({type:nc,json:{write:{overridePolicy:t=>({enabled:!(!t||!t.url)})}}})],om.prototype,"thumbnail",void 0),u([Yt("thumbnail")],om.prototype,"castThumbnail",null),u([p(Soe)],om.prototype,"timeExtent",void 0),u([p({type:Jr,nonNullable:!0,json:{write:!0}})],om.prototype,"viewpoint",null),u([me("viewpoint",["extent","viewpoint"])],om.prototype,"readViewpoint",null),u([ge("viewpoint")],om.prototype,"writeViewpoint",null),om=gK=u([A("esri.webmap.Bookmark")],om);const QPt=om;let cy=class extends Dt.ClonableMixin(ue){constructor(e){super(e),this.background=null,this.rangeInfo=null,this.spatialReference=null,this.timeExtent=null,this.timeZone=cf,this.viewpoint=null}};u([p({type:yj})],cy.prototype,"background",void 0),u([p({type:boe})],cy.prototype,"rangeInfo",void 0),u([p({type:Ae})],cy.prototype,"spatialReference",void 0),u([p({type:To})],cy.prototype,"timeExtent",void 0),u([p({nonNullable:!0})],cy.prototype,"timeZone",void 0),u([p({type:Jr})],cy.prototype,"viewpoint",void 0),cy=u([A("esri.webmap.InitialViewProperties")],cy);const AB=cy,u4e=Ee.ofType(QPt),e3t=new Map([["image/jpeg","jpeg"],["image/jpg","jpg"],["image/png","png"],["image/gif","gif"]]),t3t="ArcGIS Pro",i3t=vS.JSAPI;let Ss=class extends eL($l.LoadableMixin(Ub.EsriPromiseMixin(Xte))){constructor(e){super(e),this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1,this._thumbnailFilename=null,this._updateFromPromise=null,this.resourceReferences={portalItem:null,paths:[]},this.applicationProperties=null,this.bookmarks=new u4e,this.floorInfo=null,this.initialViewProperties=new AB,this.portalItem=null,this.sourceVersion=null,this.widgets=null,this._debouncedSaveOperations=X3(async(i,r,s)=>{const{save:n,saveAs:o}=await V(()=>Promise.resolve().then(()=>T4t),void 0);switch(i){case vl.SAVE:return n(this.context,this,r);case vl.SAVE_AS:return o(this.context,this,s,r)}}),this.authoringApp=this.authoringAppVersion=null,this._isAuthoringAppSetByUser=this._isAuthoringAppVersionSetByUser=!1}destroy(){this.portalItem=Ce(this.portalItem)}initialize(){if(this.when().catch(e=>{J.getLogger(this).error("#load()","Failed to load web map",e)}),this.resourceInfo){let e;try{e=this._validateJSON(this.resourceInfo)}catch(i){return void this.addResolvingPromise(Promise.reject(i))}this.read(e)}}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,i){e&&this._isAuthoringAppSetByUser?i.authoringApp=e:i.authoringApp=i3t}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,i){e&&this._isAuthoringAppVersionSetByUser?i.authoringAppVersion=e:i.authoringAppVersion=Wee}readInitialViewProperties(e,i){const r=new AB;i.background&&(r.background=yj.fromJSON(i.background));const s=i.initialState?.timeExtent;s&&(r.timeExtent=To.fromArray(s));const n=i.initialState?.viewpoint;return n&&(n.rotation&&$C.parse(i.version||"","webmap").lessThan(2,20)&&i.authoringApp===t3t&&(n.rotation*=-1),r.viewpoint=Jr.fromJSON(n)),i.mapRangeInfo&&(r.rangeInfo=boe.fromJSON(i.mapRangeInfo)),i.spatialReference&&(r.spatialReference=Ae.fromJSON(i.spatialReference)),i.timeZone&&(r.timeZone=i.timeZone),r}writeInitialViewProperties(e,i,r,s){if(!e)return;e.background?.color&&(i.background=e.background.write({},s));const{timeExtent:n,viewpoint:o}=e;if(o||n){const a={};o&&(a.viewpoint=o.write({},s)),n&&(a.timeExtent=n.toArray()),i.initialState=a}e.rangeInfo&&(i.mapRangeInfo=e.rangeInfo.toJSON(s)),e.spatialReference&&(i.spatialReference=e.spatialReference.write({},s)),i.timeZone=e.timeZone}writeLayers(e,i,r,s){i[r]=this._writeLayers(e,s,"operational-layers")}readSourceVersion(e,i){const[r,s]=i.version.split(".");return new $C(parseInt(r,10),parseInt(s,10))}writeSourceVersion(e,i,r){i[r]=`${this.context.currentVersion.major}.${this.context.currentVersion.minor}`}writeTables(e,i,r,s){const n=this._writeLayers(e,s,"tables");n.length&&(i[r]=n)}get thumbnailUrl(){return this.portalItem?.thumbnailUrl||null}set thumbnailUrl(e){e?(this._override("thumbnailUrl",e),this._thumbnailFilename=this._generateCustomThumbnailFilename(e)):this._clearThumbnailOverride()}get updatingFromView(){return!!this._updateFromPromise}load(e){return this.addResolvingPromise(BPt(this.context,this)),Promise.resolve(this)}loadAll(){return cD(this,e=>{e(this.ground,this.basemap,this.layers,this.tables)})}read(e,i){i={...i,origin:this.context.origin};const r=this._getAuthoringPropsState();Nee(this,e,s=>super.read(e,s),i),this._restoreAuthoringPropsFromState(r)}write(e,i){if(this.loadStatus!=="loaded"){const r=new U("webmap:not-loaded","Web map must be loaded before it can be serialized");throw J.getLogger(this).error("#toJSON()","Web map must be loaded before it can be serialized",this.loadError||this.loadStatus),r}return this._removeDanglingLayerRefs(),i={...i,origin:this.context.origin,restrictedWebMapWriting:!0,webmap:this},super.write(e,i)}async save(e){return this._debouncedSaveOperations(vl.SAVE,e)}async saveAs(e,i){return this._debouncedSaveOperations(vl.SAVE_AS,i,e)}async updateFrom(e,i){const r=this._updateFromInternal(e,i);this._updateFromPromise=r,await r,r===this._updateFromPromise&&(this._updateFromPromise=null)}getLayerJSONFromResourceInfo(e){const i=this.resourceInfo;return this._collectAllLayersJSON([...i?.baseMap?.baseMapLayers||[],...i?.operationalLayers||[],...this.basemap?.resourceInfo?.data?.baseMapLayers||[]]).find(r=>r.id===e.id)}async updateItemThumbnail(){this.thumbnailUrl&&this._isOverridden("thumbnailUrl")&&(await this.portalItem?.updateThumbnail({thumbnail:this.thumbnailUrl,filename:this._thumbnailFilename}),this._clearThumbnailOverride())}getThumbnailState(){let e=this.thumbnailUrl;return e&&(e=this._isOverridden("thumbnailUrl")?e:qee(e,"w","8192")),{thumbnailUrl:e,filename:this._thumbnailFilename}}restoreThumbnailFromState(e){this.thumbnailUrl=e.thumbnailUrl,this._thumbnailFilename=e.filename}_collectAllLayersJSON(e){return e.reduce((i,r)=>(i.push(r),r.layerType==="GroupLayer"&&(i=i.concat(this._collectAllLayersJSON(r.layers||[]))),i),[])}_writeLayers(e,i,r){return i={...i,layerContainerType:r},e.map(s=>vW(s,r==="tables"?null:this.getLayerJSONFromResourceInfo(s),i)).filter(of).toArray()}_validateJSON(e){const i=$C.parse(e.version||"","webmap");return this.context.currentVersion.validate(i),e.version=`${i.major}.${i.minor}`,e}_removeDanglingLayerRefs(){const e=this.applicationProperties,i=e?.viewing?.search,r=o=>this.allLayers.some(a=>a.id===o);if(i?.layers&&(i.layers=i.layers.filter(o=>r(o.id))),i?.tables&&(i.tables=i.tables.filter(o=>this.tables.some(a=>a.id===o.id))),e){const o=e.editing?.locationTracking;o?.info&&!r(o.info.layerId)&&(e.editing=null)}const s="presentation"in this?this.presentation:null,n=s?.slides;n&&n.forEach(o=>{o.visibleLayers&&(o.visibleLayers=o.visibleLayers.filter(a=>r(a.id)))})}async _updateFromInternal(e,i){if(i??={},await Cd(()=>e.ready),this._updateInitialViewProperties(e,i),e.map===this)for(const r of e.allLayerViews)"visible"in r&&"visible"in r.layer&&r._isOverridden("visible")&&(r.layer.visible=r.visible),"featureEffect"in r&&"featureEffect"in r.layer&&r._isOverridden("featureEffect")&&(r.layer.featureEffect=r.featureEffect);await this._updateThumbnailUrl(e,i)}_updateInitialViewProperties(e,i){if(i.backgroundExcluded||(this.initialViewProperties.background=e.background?.clone()),this.initialViewProperties.spatialReference=e.spatialReference?.clone(),this.initialViewProperties.timeZone=e.timeZone,i.viewpointExcluded||(this.initialViewProperties.viewpoint=new Jr({rotation:e.rotation,scale:i.scalePreserved?e.scale:null,targetGeometry:this._getViewExtent(e)})),!i.widgetsExcluded)for(const r of e.persistableViewModels)r.updateWebDocument(this)}_getViewExtent(e){const i=e.center.clone().normalize(),r=e.extent.clone(),s=r.width/2;return r.xmin=i.x-s,r.xmax=i.x+s,r}async _updateThumbnailUrl(e,i){if(i.thumbnailExcluded)return;const r=r4e(e,i.thumbnailSize),s=await e.takeScreenshot({format:"png",width:r.width,height:r.height});this._setAutoGeneratedThumbnail(s.dataUrl)}_setAutoGeneratedThumbnail(e){this.thumbnailUrl=e,this._thumbnailFilename=null}_clearThumbnailOverride(){this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"),this._thumbnailFilename=null}_generateCustomThumbnailFilename(e){if(wf(e)){const i=qx(e),r=i?.mediaType,s=r&&e3t.get(r.toLowerCase())||null,n=`thumbnail${Date.now()}`;return s?`${n}.${s}`:n}return null}_getAuthoringPropsState(){return{authoringApp:this.authoringApp,authoringAppVersion:this.authoringAppVersion,isAuthoringAppSetByUser:this._isAuthoringAppSetByUser,isAuthoringAppVersionSetByUser:this._isAuthoringAppVersionSetByUser}}_restoreAuthoringPropsFromState(e){e.isAuthoringAppSetByUser?this.authoringApp=e.authoringApp:this._isAuthoringAppSetByUser=!1,e.isAuthoringAppVersionSetByUser?this.authoringAppVersion=e.authoringAppVersion:this._isAuthoringAppVersionSetByUser=!1}};u([p()],Ss.prototype,"_updateFromPromise",void 0),u([p({type:KPt,json:{write:!0}})],Ss.prototype,"applicationProperties",void 0),u([p({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],Ss.prototype,"authoringApp",null),u([ge("authoringApp")],Ss.prototype,"writeAuthoringApp",null),u([p({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],Ss.prototype,"authoringAppVersion",null),u([ge("authoringAppVersion")],Ss.prototype,"writeAuthoringAppVersion",null),u([p({type:u4e,json:{write:{overridePolicy:t=>({enabled:!!(t&&t.length>0),ignoreOrigin:!0})}}})],Ss.prototype,"bookmarks",void 0),u([p({type:t4e,json:{name:"mapFloorInfo",write:!0}})],Ss.prototype,"floorInfo",void 0),u([p({type:AB,nonNullable:!0,json:{read:{source:["background","initialState.timeExtent","initialState.viewpoint","mapRangeInfo","spatialReference","timeZone"]},write:{ignoreOrigin:!0,target:{background:{type:yj},"initialState.timeExtent":{type:To},"initialState.viewpoint":{type:Jr},mapRangeInfo:{type:boe},spatialReference:{type:Ae},"timeZone:":{type:String}}}}})],Ss.prototype,"initialViewProperties",void 0),u([me("initialViewProperties")],Ss.prototype,"readInitialViewProperties",null),u([ge("initialViewProperties")],Ss.prototype,"writeInitialViewProperties",null),u([p({json:{read:!1,write:{target:"operationalLayers",ignoreOrigin:!0}}})],Ss.prototype,"layers",void 0),u([ge("layers")],Ss.prototype,"writeLayers",null),u([p({type:eh})],Ss.prototype,"portalItem",void 0),u([p()],Ss.prototype,"resourceInfo",void 0),u([p({readOnly:!0,type:$C,json:{read:{source:"version"},write:{allowNull:!0,ignoreOrigin:!0,target:"version",isRequired:!0}}})],Ss.prototype,"sourceVersion",void 0),u([me("sourceVersion")],Ss.prototype,"readSourceVersion",null),u([ge("sourceVersion")],Ss.prototype,"writeSourceVersion",null),u([p({json:{read:!1,write:{ignoreOrigin:!0}}})],Ss.prototype,"tables",void 0),u([ge("tables")],Ss.prototype,"writeTables",null),u([p()],Ss.prototype,"thumbnailUrl",null),u([p()],Ss.prototype,"updatingFromView",null),u([p({type:i4e,json:{write:!0}})],Ss.prototype,"widgets",void 0),Ss=u([A("esri.WebDocument2D")],Ss);const r3t=Ss,Ys=(t=>t)(["operational-layers","basemap","ground"]);var yK;let D1=yK=class extends ee{constructor(t){super(t),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new yK({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([p({type:String,json:{write:!0}})],D1.prototype,"expression",void 0),u([p({type:String,json:{write:!0}})],D1.prototype,"name",void 0),u([p({type:["boolean","date","number","string"],json:{write:!0}})],D1.prototype,"returnType",void 0),u([p({type:String,json:{write:!0}})],D1.prototype,"title",void 0),D1=yK=u([A("esri.form.ExpressionInfo")],D1);const s3t=D1;let L1=class extends ee{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};u([p({type:String,json:{write:!0}})],L1.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],L1.prototype,"label",void 0),u([p()],L1.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],L1.prototype,"visibilityExpression",void 0),L1=u([A("esri.form.elements.Element")],L1);const Db=L1;let R5=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.type=null}};u([p()],R5.prototype,"type",void 0),R5=u([A("esri.form.elements.inputs.attachments.Input")],R5);const Lb=R5,IG=["any","capture","upload"];let n2=class extends Lb{constructor(e){super(e),this.type="audio",this.inputMethod="any",this.maxDuration=null}};u([p({type:["audio"],readOnly:!0,json:{write:!0}})],n2.prototype,"type",void 0),u([p({type:IG,json:{write:!0}})],n2.prototype,"inputMethod",void 0),u([p({type:Number,json:{write:!0}})],n2.prototype,"maxDuration",void 0),n2=u([A("esri.form.elements.inputs.attachments.AudioInput")],n2);const i_e=n2;let kI=class extends Lb{constructor(e){super(e),this.type="document",this.maxFileSize=null}};u([p({type:["document"],readOnly:!0,json:{write:!0}})],kI.prototype,"type",void 0),u([p({type:Number,json:{write:!0}})],kI.prototype,"maxFileSize",void 0),kI=u([A("esri.form.elements.inputs.attachments.DocumentInput")],kI);const r_e=kI;let o2=class extends Lb{constructor(e){super(e),this.type="image",this.inputMethod="any",this.maxImageSize=null}};u([p({type:["image"],readOnly:!0,json:{write:!0}})],o2.prototype,"type",void 0),u([p({type:IG,json:{write:!0}})],o2.prototype,"inputMethod",void 0),u([p({type:Number,json:{write:!0}})],o2.prototype,"maxImageSize",void 0),o2=u([A("esri.form.elements.inputs.attachments.ImageInput")],o2);const s_e=o2;let zI=class extends Lb{constructor(e){super(e),this.type="signature",this.inputMethod="any"}};u([p({type:["signature"],readOnly:!0,json:{write:!0}})],zI.prototype,"type",void 0),u([p({type:IG,json:{write:!0}})],zI.prototype,"inputMethod",void 0),zI=u([A("esri.form.elements.inputs.attachments.SignatureInput")],zI);const n_e=zI;let a2=class extends Lb{constructor(e){super(e),this.type="video",this.inputMethod="any",this.maxDuration=null}};u([p({type:["video"],readOnly:!0,json:{write:!0}})],a2.prototype,"type",void 0),u([p({type:IG,json:{write:!0}})],a2.prototype,"inputMethod",void 0),u([p({type:Number,json:{write:!0}})],a2.prototype,"maxDuration",void 0),a2=u([A("esri.form.elements.inputs.attachments.VideoInput")],a2);const o_e=a2;function h4e(t){return{nestableTypes:{base:Lb,key:"type",typeMap:{audio:i_e,document:r_e,image:s_e,signature:n_e,video:o_e}},allTypes:{base:Lb,key:"type",typeMap:{attachment:t,audio:i_e,document:r_e,image:s_e,signature:n_e,video:o_e}}}}function n3t(t,e,i){return t?t.map(r=>Sd(e.nestableTypes,r)):null}function o3t(t,e,i){if(!t)return null;const r=e.nestableTypes.typeMap;return t.filter(s=>r[s.type]).map(s=>r[s.type].fromJSON(s))}function a3t(t,e,i){if(!t)return null;const r=e.nestableTypes.typeMap;return t.filter(s=>r[s.type]).map(s=>s.toJSON())}let pm=class extends Lb{constructor(e){super(e),this.type="attachment",this.attachmentAssociationType="exact",this.inputTypes=null}castInputs(e){return n3t(e,Kq)}readInputs(e,i){return o3t(i.inputTypes,Kq)}writeInputs(e,i){i.inputTypes=a3t(e,Kq)}};u([p({type:["attachment"],readOnly:!0,json:{write:!0}})],pm.prototype,"type",void 0),u([p({type:["any","exact","exactOrNone"],json:{write:!0}})],pm.prototype,"attachmentAssociationType",void 0),u([p({json:{write:{isRequired:!0}}})],pm.prototype,"inputTypes",void 0),u([Yt("inputTypes")],pm.prototype,"castInputs",null),u([me("inputTypes")],pm.prototype,"readInputs",null),u([ge("inputTypes")],pm.prototype,"writeInputs",null),pm=u([A("esri.form.elements.inputs.attachments.AttachmentInput")],pm);const Kq=h4e(pm),l3t=pm;var vK;const c3t=h4e(l3t);let Mu=vK=class extends Db{constructor(t){super(t),this.allowUserRename=!0,this.attachmentKeyword=null,this.displayFilename=!1,this.editableExpression=null,this.filenameExpression="{attachmentKeyword}_{now}",this.input=null,this.maxAttachmentCount=null,this.minAttachmentCount=null,this.type="attachment",this.useOriginalFilename=!0}clone(){return new vK({allowUserRename:this.allowUserRename,attachmentKeyword:this.attachmentKeyword,description:this.description,displayFilename:this.displayFilename,editableExpression:this.editableExpression,filenameExpression:this.filenameExpression,input:this.input?.clone(),label:this.label,maxAttachmentCount:this.maxAttachmentCount,minAttachmentCount:this.minAttachmentCount,useOriginalFilename:this.useOriginalFilename,visibilityExpression:this.visibilityExpression})}};u([p({type:Boolean,json:{write:!0}})],Mu.prototype,"allowUserRename",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],Mu.prototype,"attachmentKeyword",void 0),u([p({type:Boolean,json:{write:!0}})],Mu.prototype,"displayFilename",void 0),u([p({type:String,json:{write:!0}})],Mu.prototype,"editableExpression",void 0),u([p({type:String,json:{write:!0}})],Mu.prototype,"filenameExpression",void 0),u([p({types:c3t.allTypes,json:{read:{source:"inputType"},write:{target:"inputType",isRequired:!0}}})],Mu.prototype,"input",void 0),u([p({type:Number,json:{write:!0}})],Mu.prototype,"maxAttachmentCount",void 0),u([p({type:Number,json:{write:!0}})],Mu.prototype,"minAttachmentCount",void 0),u([p({type:["attachment"],readOnly:!0,json:{read:!1,write:!0}})],Mu.prototype,"type",void 0),u([p({type:Boolean,json:{write:!0}})],Mu.prototype,"useOriginalFilename",void 0),Mu=vK=u([A("esri.form.elements.AttachmentElement")],Mu);const a_e=Mu;let P5=class extends ee{constructor(e){super(e),this.type=null}};u([p()],P5.prototype,"type",void 0),P5=u([A("esri.form.elements.inputs.Input")],P5);const kv=P5;let UI=class extends kv{constructor(e){super(e),this.maxLength=null,this.minLength=0}};u([p({type:Number,json:{write:!0}})],UI.prototype,"maxLength",void 0),u([p({type:Number,json:{write:!0}})],UI.prototype,"minLength",void 0),UI=u([A("esri.form.elements.inputs.TextInput")],UI);const Toe=UI;var _K;let D5=_K=class extends Toe{constructor(t){super(t),this.type="barcode-scanner"}clone(){return new _K({maxLength:this.maxLength,minLength:this.minLength})}};u([p({type:["barcode-scanner"],json:{read:!1,write:!0}})],D5.prototype,"type",void 0),D5=_K=u([A("esri.form.elements.inputs.BarcodeScannerInput")],D5);const u3t=D5;var bK;let l2=bK=class extends kv{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="combo-box"}clone(){return new bK({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};u([p({type:String,json:{write:!0}})],l2.prototype,"noValueOptionLabel",void 0),u([p({type:Boolean,json:{write:!0}})],l2.prototype,"showNoValueOption",void 0),u([p({type:["combo-box"],json:{read:!1,write:!0}})],l2.prototype,"type",void 0),l2=bK=u([A("esri.form.elements.inputs.ComboBoxInput")],l2);const h3t=l2;var wK;function l_e(t){return t??null}function c_e(t){return t??null}let am=wK=class extends kv{constructor(t){super(t),this.max=null,this.min=null,this.type="date-picker"}readMax(t,e){return l_e(e.max)}writeMax(t,e){e.max=c_e(t)}readMin(t,e){return l_e(e.min)}writeMin(t,e){e.min=c_e(t)}clone(){return new wK({max:this.max,min:this.min})}};u([p({type:String,json:{type:String,write:!0}})],am.prototype,"max",void 0),u([me("max")],am.prototype,"readMax",null),u([ge("max")],am.prototype,"writeMax",null),u([p({type:String,json:{type:String,write:!0}})],am.prototype,"min",void 0),u([me("min")],am.prototype,"readMin",null),u([ge("min")],am.prototype,"writeMin",null),u([p({type:["date-picker"],json:{read:!1,write:!0}})],am.prototype,"type",void 0),am=wK=u([A("esri.form.elements.inputs.DatePickerInput")],am);const d3t=am;var xK;function Qq(t){return t??null}function e9(t){return t??null}let Cc=xK=class extends kv{constructor(t){super(t),this.includeTimeOffset=!0,this.max=null,this.min=null,this.timeResolution="minutes",this.type="datetimeoffset-picker"}readMax(t,e){return Qq(e.max)}writeMax(t,e){e.max=e9(t)}readMin(t,e){return Qq(e.min)}writeMin(t,e){e.min=e9(t)}readTimeResolution(t,e){return Qq(e.timeResolution)}writeTimeResolution(t,e){e.timeResolution=e9(t)}clone(){return new xK({includeTimeOffset:this.includeTimeOffset,max:this.max,min:this.min,timeResolution:this.timeResolution})}};u([p({type:Boolean,json:{write:!0}})],Cc.prototype,"includeTimeOffset",void 0),u([p({type:String,json:{type:String,write:!0}})],Cc.prototype,"max",void 0),u([me("max")],Cc.prototype,"readMax",null),u([ge("max")],Cc.prototype,"writeMax",null),u([p({type:String,json:{type:String,write:!0}})],Cc.prototype,"min",void 0),u([me("min")],Cc.prototype,"readMin",null),u([ge("min")],Cc.prototype,"writeMin",null),u([p({type:String,json:{type:String,write:!0}})],Cc.prototype,"timeResolution",void 0),u([me("timeResolution")],Cc.prototype,"readTimeResolution",null),u([ge("timeResolution")],Cc.prototype,"writeTimeResolution",null),u([p({type:["datetimeoffset-picker"],json:{read:!1,write:!0}})],Cc.prototype,"type",void 0),Cc=xK=u([A("esri.form.elements.inputs.DateTimeOffsetPickerInput")],Cc);const p3t=Cc;var SK;function u_e(t){return t!=null?new Date(t):null}function h_e(t){return t?t.getTime():null}let _p=SK=class extends kv{constructor(t){super(t),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(t,e){return u_e(e.max)}writeMax(t,e){e.max=h_e(t)}readMin(t,e){return u_e(e.min)}writeMin(t,e){e.min=h_e(t)}clone(){return new SK({includeTime:this.includeTime,max:this.max,min:this.min})}};u([p({type:Boolean,json:{write:!0}})],_p.prototype,"includeTime",void 0),u([p({type:Date,json:{type:Number,write:!0}})],_p.prototype,"max",void 0),u([me("max")],_p.prototype,"readMax",null),u([ge("max")],_p.prototype,"writeMax",null),u([p({type:Date,json:{type:Number,write:!0}})],_p.prototype,"min",void 0),u([me("min")],_p.prototype,"readMin",null),u([ge("min")],_p.prototype,"writeMin",null),u([p({type:["datetime-picker"],json:{read:!1,write:!0}})],_p.prototype,"type",void 0),_p=SK=u([A("esri.form.elements.inputs.DateTimePickerInput")],_p);const f3t=_p;var TK;let c2=TK=class extends kv{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="radio-buttons"}clone(){return new TK({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};u([p({type:String,json:{write:!0}})],c2.prototype,"noValueOptionLabel",void 0),u([p({type:Boolean,json:{write:!0}})],c2.prototype,"showNoValueOption",void 0),u([p({type:["radio-buttons"],json:{read:!1,write:!0}})],c2.prototype,"type",void 0),c2=TK=u([A("esri.form.elements.inputs.RadioButtonsInput")],c2);const m3t=c2;var EK;let u2=EK=class extends kv{constructor(t){super(t),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new EK({offValue:this.offValue,onValue:this.onValue})}};u([p({type:[String,Number],json:{write:!0}})],u2.prototype,"offValue",void 0),u([p({type:[String,Number],json:{write:!0}})],u2.prototype,"onValue",void 0),u([p({type:["switch"],json:{read:!1,write:!0}})],u2.prototype,"type",void 0),u2=EK=u([A("esri.form.elements.inputs.SwitchInput")],u2);const g3t=u2;var CK;let L5=CK=class extends Toe{constructor(t){super(t),this.type="text-area"}clone(){return new CK({maxLength:this.maxLength,minLength:this.minLength})}};u([p({type:["text-area"],json:{read:!1,write:!0}})],L5.prototype,"type",void 0),L5=CK=u([A("esri.form.elements.inputs.TextAreaInput")],L5);const y3t=L5;var $K;let N5=$K=class extends Toe{constructor(t){super(t),this.type="text-box"}clone(){return new $K({maxLength:this.maxLength,minLength:this.minLength})}};u([p({type:["text-box"],json:{read:!1,write:!0}})],N5.prototype,"type",void 0),N5=$K=u([A("esri.form.elements.inputs.TextBoxInput")],N5);const v3t=N5;var AK;function t9(t){return t??null}function i9(t){return t??null}let Ou=AK=class extends kv{constructor(t){super(t),this.max=null,this.min=null,this.timeResolution="minutes",this.type="time-picker"}readMax(t,e){return t9(e.max)}writeMax(t,e){e.max=i9(t)}readMin(t,e){return t9(e.min)}writeMin(t,e){e.min=i9(t)}readTimeResolution(t,e){return t9(e.timeResolution)}writeTimeResolution(t,e){e.timeResolution=i9(t)}clone(){return new AK({max:this.max,min:this.min,timeResolution:this.timeResolution})}};u([p({type:String,json:{type:String,write:!0}})],Ou.prototype,"max",void 0),u([me("max")],Ou.prototype,"readMax",null),u([ge("max")],Ou.prototype,"writeMax",null),u([p({type:String,json:{type:String,write:!0}})],Ou.prototype,"min",void 0),u([me("min")],Ou.prototype,"readMin",null),u([ge("min")],Ou.prototype,"writeMin",null),u([p({type:String,json:{type:String,write:!0}})],Ou.prototype,"timeResolution",void 0),u([me("timeResolution")],Ou.prototype,"readTimeResolution",null),u([ge("timeResolution")],Ou.prototype,"writeTimeResolution",null),u([p({type:["time-picker"],json:{read:!1,write:!0}})],Ou.prototype,"type",void 0),Ou=AK=u([A("esri.form.elements.inputs.TimePickerInput")],Ou);const _3t=Ou,b3t={base:kv,key:"type",typeMap:{"barcode-scanner":u3t,"combo-box":h3t,"date-picker":d3t,"datetime-picker":f3t,"datetimeoffset-picker":p3t,"radio-buttons":m3t,switch:g3t,"text-area":y3t,"text-box":v3t,"time-picker":_3t}};var MK;let Rh=MK=class extends Db{constructor(t){super(t),this.domain=null,this.editable=null,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}clone(){return new MK({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};u([p({types:_$e,json:{read:{reader:rj},write:!0}})],Rh.prototype,"domain",void 0),u([p({type:Boolean,json:{write:!0}})],Rh.prototype,"editable",void 0),u([p({type:String,json:{write:!0}})],Rh.prototype,"editableExpression",void 0),u([p({type:String,json:{write:!0}})],Rh.prototype,"fieldName",void 0),u([p({type:String,json:{write:!0}})],Rh.prototype,"hint",void 0),u([p({types:b3t,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Rh.prototype,"input",void 0),u([p({type:String,json:{write:!0}})],Rh.prototype,"requiredExpression",void 0),u([p({type:String,json:{read:!1,write:!0}})],Rh.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],Rh.prototype,"valueExpression",void 0),Rh=MK=u([A("esri.form.elements.FieldElement")],Rh);const d_e=Rh;var OK;let uy=OK=class extends Db{constructor(t){super(t),this.displayCount=null,this.displayType="list",this.editableExpression=null,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new OK({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editableExpression:this.editableExpression,label:this.label,orderByFields:q(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};u([p({type:Number,json:{write:!0}})],uy.prototype,"displayCount",void 0),u([p({type:["list"],json:{write:!0}})],uy.prototype,"displayType",void 0),u([p({type:String,json:{write:!0}})],uy.prototype,"editableExpression",void 0),u([p({type:[nie],json:{write:!0}})],uy.prototype,"orderByFields",void 0),u([p({type:Number,json:{write:!0}})],uy.prototype,"relationshipId",void 0),u([p({type:["relationship"],json:{read:!1,write:!0}})],uy.prototype,"type",void 0),uy=OK=u([A("esri.form.elements.RelationshipElement")],uy);const p_e=uy;var IK;let h2=IK=class extends Db{constructor(t){super(t),this.text=null,this.textFormat="plain-text",this.type="text"}clone(){return new IK({text:this.text,textFormat:this.textFormat,visibilityExpression:this.visibilityExpression})}};u([p({type:String,json:{write:!0}})],h2.prototype,"text",void 0),u([p({type:String,json:{write:!0}})],h2.prototype,"textFormat",void 0),u([p({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],h2.prototype,"type",void 0),h2=IK=u([A("esri.form.elements.TextElement")],h2);const f_e=h2;let d2=class extends Dt.ClonableMixin(Db){constructor(e){super(e),this.associationTypes=null,this.editableExpression=null,this.type="utilityNetworkAssociations"}};u([p({type:[MCe],json:{write:{isRequired:!0}}})],d2.prototype,"associationTypes",void 0),u([p({type:String,json:{write:!0}})],d2.prototype,"editableExpression",void 0),u([p({type:["utilityNetworkAssociations"],json:{read:!1,write:!0}})],d2.prototype,"type",void 0),d2=u([A("esri.form.elements.UtilityNetworkAssociationsElement")],d2);const m_e=d2,w3t=t=>t.type==="field",x3t=t=>t.type==="group",S3t=t=>t.type==="text";function d4e(t){return{typesWithGroup:{base:Db,key:"type",typeMap:{attachment:a_e,field:d_e,group:t,relationship:p_e,text:f_e,utilityNetworkAssociations:m_e}},typesWithoutGroup:{base:Db,key:"type",typeMap:{attachment:a_e,field:d_e,relationship:p_e,text:f_e,utilityNetworkAssociations:m_e}}}}function p4e(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>r[s.type]).map(s=>r[s.type].fromJSON(s))}function f4e(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>r[s.type]).map(s=>s.toJSON())}function m4e(t,e,i=!0){return t?t.map(r=>Sd(i?e.typesWithGroup:e.typesWithoutGroup,r)):null}var RK;let fm=RK=class extends Db{constructor(t){super(t),this.elements=null,this.initialState="expanded",this.type="group"}castElements(t){return m4e(t,r9,!1)}readElements(t,e){return p4e(e.formElements,r9,!1)}writeElements(t,e){e.formElements=f4e(t,r9,!1)}clone(){return new RK({description:this.description,elements:q(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};u([p({json:{write:!0}})],fm.prototype,"elements",void 0),u([Yt("elements")],fm.prototype,"castElements",null),u([me("elements",["formElements"])],fm.prototype,"readElements",null),u([ge("elements")],fm.prototype,"writeElements",null),u([p({type:["collapsed","expanded"],json:{write:!0}})],fm.prototype,"initialState",void 0),u([p({type:String,json:{read:!1,write:!0}})],fm.prototype,"type",void 0),fm=RK=u([A("esri.form.elements.GroupElement")],fm);const r9=d4e(fm),T3t=fm;var PK;const s9=d4e(T3t);let bp=PK=class extends ee{constructor(t){super(t),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(t){return m4e(t,s9)}readElements(t,e){return p4e(e.formElements,s9)}writeElements(t,e){e.formElements=f4e(t,s9)}clone(){return new PK({description:this.description,expressionInfos:q(this.expressionInfos),elements:q(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}async getFieldsUsed(t,e){const i=new Set,{description:r,elements:s,expressionInfos:n,title:o}=this;if(KR(i,t,r),KR(i,t,o),!s)return[];const a=E3t(s,n).map(l=>Al(i,t,l));await Promise.all(a);for(const l of s)g4e(i,{fieldsIndex:t,relationships:e},l);return Array.from(i).sort()}};function g4e(t,e,i){const{fieldsIndex:r}=e;if(!r||r.fields.length!==t.size)switch(KR(t,r,i.label),KR(t,r,i.description),i.type){case"field":cc(t,r,i.fieldName);break;case"group":i.elements.forEach(s=>g4e(t,e,s));break;case"relationship":if(e.relationships){const s=e.relationships.find(n=>n.id===i.relationshipId);s&&cc(t,r,s.keyField)}iS(t,r,i.orderByFields?.map(s=>s.field));break;case"text":KR(t,r,i.text)}}function E3t(t,e){if(!e||e.length===0)return[];const i=y4e(t),r=[];for(const s of e)i.has(s.name)&&r.push(s.expression);return r}function y4e(t){const e=new Set;for(const i of t)if(mle(e,i.visibilityExpression),!S3t(i)){if(x3t(i))SP(e,y4e(i.elements));else if(mle(e,i.editableExpression),w3t(i)){const{requiredExpression:r,valueExpression:s}=i;SP(e,[r,s])}}return e}function KR(t,e,i){iS(t,e,iie(i))}u([p({type:String,json:{write:!0}})],bp.prototype,"description",void 0),u([p({json:{write:!0}})],bp.prototype,"elements",void 0),u([Yt("elements")],bp.prototype,"castElements",null),u([me("elements",["formElements"])],bp.prototype,"readElements",null),u([ge("elements")],bp.prototype,"writeElements",null),u([p({type:[s3t],json:{write:!0}})],bp.prototype,"expressionInfos",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],bp.prototype,"preserveFieldValuesWhenHidden",void 0),u([p({type:String,json:{write:!0}})],bp.prototype,"title",void 0),bp=PK=u([A("esri.form.FormTemplate")],bp);const C3t=bp;function g_e(t,e,i){if(t.hasM==null||t.hasZ)for(const r of e)for(const s of r)s.length>2&&(s[2]*=i)}function $3t(t,e,i){if(!t&&!e||!i)return;const r=Yx(i);y_e(t,i,r),y_e(e,i,r)}function y_e(t,e,i){if(t)for(const r of t)A3t(r.geometry,e,i)}function A3t(t,e,i){if(!t?.spatialReference||rs(t.spatialReference,e))return;const r=Yx(t.spatialReference)/i;if(r!==1){if("x"in t)t.z!=null&&(t.z*=r);else if("rings"in t)g_e(t,t.rings,r);else if("paths"in t)g_e(t,t.paths,r);else if("points"in t&&(t.hasM==null||t.hasZ))for(const s of t.points)s.length>2&&(s[2]*=r)}}function v_e(t,e,i){if(!i?.features||!i.hasZ)return;const r=OEe(i.geometryType,e,t.outSpatialReference);if(r!=null)for(const s of i.features)r(s.geometry)}var DK;const LK=new ei({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let oa=DK=class extends ee{constructor(t){super(t),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(t,e){return this.readFeaturesWithClass(t,e,Ml)}writeGeometryType(t,e,i,r){if(t)return void LK.write(t,e,i,r);const{features:s}=this;if(s){for(const n of s)if(n?.geometry!=null)return void LK.write(n.geometry.type,e,i,r)}}readQueryGeometry(t,e){if(!t)return null;const i=!!t.spatialReference,r=af(t);return r&&!i&&e.spatialReference&&(r.spatialReference=Ae.fromJSON(e.spatialReference)),r}writeSpatialReference(t,e){if(t)return void(e.spatialReference=t.toJSON());const{features:i}=this;if(i){for(const r of i)if(r&&r.geometry!=null&&r.geometry.spatialReference)return void(e.spatialReference=r.geometry.spatialReference.toJSON())}}clone(){return new DK(this.cloneProperties())}cloneProperties(){return q({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(t){const e=this.write();if(e.features&&Array.isArray(t)&&t.length>0)for(let i=0;i<e.features.length;i++){const r=e.features[i];if(r.geometry){const s=t?.[i];r.geometry=s?.toJSON()||r.geometry}}return e}quantize(t){const{scale:[e,i],translate:[r,s]}=t,n=c=>Math.round((c-r)/e),o=c=>Math.round((s-c)/i),a=this.features,l=this._getQuantizationFunction(this.geometryType,n,o);for(let c=0,h=a.length;c<h;c++)l?.(a[c].geometry)||(a.splice(c,1),c--,h--);return this.transform=t,this}unquantize(){const{geometryType:t,features:e,transform:i}=this;if(!i)return this;const{translate:[r,s],scale:[n,o]}=i,a=f=>f*n+r,l=f=>s-f*o;let c=null,h=null;if(this.hasZ&&i?.scale?.[2]!=null){const{translate:[,,f],scale:[,,m]}=i;c=y=>y*m+f}if(this.hasM&&i?.scale?.[3]!=null){const{translate:[,,,f],scale:[,,,m]}=i;h=y=>y==null?y:y*m+f}const d=this._getHydrationFunction(t,a,l,c,h);for(const{geometry:f}of e)f!=null&&d&&d(f);return this.transform=null,this}readFeaturesWithClass(t,e,i){const r=Ae.fromJSON(e.spatialReference),s=[];for(let n=0;n<t.length;n++){const o=t[n],a=i.fromJSON(o),l=o.geometry?.spatialReference;a.geometry==null||l||(a.geometry.spatialReference=r);const c=o.aggregateGeometries,h=a.aggregateGeometries;if(c&&h!=null)for(const d in h){const f=h[d],m=c[d],y=m?.spatialReference;f==null||y||(f.spatialReference=r)}s.push(a)}return s}_quantizePoints(t,e,i){let r,s;const n=[];for(let o=0,a=t.length;o<a;o++){const l=t[o];if(o>0){const c=e(l[0]),h=i(l[1]);c===r&&h===s||(n.push([c-r,h-s]),r=c,s=h)}else r=e(l[0]),s=i(l[1]),n.push([r,s])}return n.length>0?n:null}_getQuantizationFunction(t,e,i){return t==="point"?r=>(r.x=e(r.x),r.y=i(r.y),r):t==="polyline"||t==="polygon"?r=>{const s=nb(r)?r.rings:r.paths,n=[];for(let o=0,a=s.length;o<a;o++){const l=s[o],c=this._quantizePoints(l,e,i);c&&n.push(c)}return n.length>0?(nb(r)?r.rings=n:r.paths=n,r):null}:t==="multipoint"?r=>{const s=this._quantizePoints(r.points,e,i);return s&&s.length>0?(r.points=s,r):null}:t==="extent"?r=>r:null}_getHydrationFunction(t,e,i,r,s){return t==="point"?n=>{n.x=e(n.x),n.y=i(n.y),r&&(n.z=r(n.z))}:t==="polyline"||t==="polygon"?n=>{const o=nb(n)?n.rings:n.paths;let a,l;for(let c=0,h=o.length;c<h;c++){const d=o[c];for(let f=0,m=d.length;f<m;f++){const y=d[f];f>0?(a+=y[0],l+=y[1]):(a=y[0],l=y[1]),y[0]=e(a),y[1]=i(l)}}if(r&&s)for(let c=0,h=o.length;c<h;c++){const d=o[c];for(let f=0,m=d.length;f<m;f++){const y=d[f];y[2]=r(y[2]),y[3]=s(y[3])}}else if(r)for(let c=0,h=o.length;c<h;c++){const d=o[c];for(let f=0,m=d.length;f<m;f++){const y=d[f];y[2]=r(y[2])}}else if(s)for(let c=0,h=o.length;c<h;c++){const d=o[c];for(let f=0,m=d.length;f<m;f++){const y=d[f];y[2]=s(y[2])}}}:t==="extent"?n=>{n.xmin=e(n.xmin),n.ymin=i(n.ymin),n.xmax=e(n.xmax),n.ymax=i(n.ymax),r&&n.zmax!=null&&n.zmin!=null&&(n.zmax=r(n.zmax),n.zmin=r(n.zmin)),s&&n.mmax!=null&&n.mmin!=null&&(n.mmax=s(n.mmax),n.mmin=s(n.mmin))}:t==="multipoint"?n=>{const o=n.points;let a,l;for(let c=0,h=o.length;c<h;c++){const d=o[c];c>0?(a+=d[0],l+=d[1]):(a=d[0],l=d[1]),d[0]=e(a),d[1]=i(l)}if(r&&s)for(let c=0,h=o.length;c<h;c++){const d=o[c];d[2]=r(d[2]),d[3]=s(d[3])}else if(r)for(let c=0,h=o.length;c<h;c++){const d=o[c];d[2]=r(d[2])}else if(s)for(let c=0,h=o.length;c<h;c++){const d=o[c];d[2]=s(d[2])}}:null}};u([p({type:String,json:{write:!0}})],oa.prototype,"displayFieldName",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],oa.prototype,"exceededTransferLimit",void 0),u([p({type:[Ml],json:{write:!0}})],oa.prototype,"features",void 0),u([me("features")],oa.prototype,"readFeatures",null),u([p({type:[sj],json:{write:!0}})],oa.prototype,"fields",void 0),u([p({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:LK.read}}})],oa.prototype,"geometryType",void 0),u([ge("geometryType")],oa.prototype,"writeGeometryType",null),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],oa.prototype,"hasM",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],oa.prototype,"hasZ",void 0),u([p({types:bA,json:{write:!0}})],oa.prototype,"queryGeometry",void 0),u([me("queryGeometry")],oa.prototype,"readQueryGeometry",null),u([p({type:Ae,json:{write:!0}})],oa.prototype,"spatialReference",void 0),u([ge("spatialReference")],oa.prototype,"writeSpatialReference",null),u([p({json:{write:!0}})],oa.prototype,"transform",void 0),oa=DK=u([A("esri.rest.support.FeatureSet")],oa),oa.prototype.toJSON.isDefaultToJSON=!0;const v4e=oa;let M3t=0,Cy=class extends $l.LoadableMixin(Ub.EsriPromiseMixin(Ee)){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const i=e!=null?e.signal:null;return this.addResolvingPromise(this._startWorker(i)),Promise.resolve(this)}destroy(){this._connection?.close(),this._connection=null}get _workerGeometryType(){const e=this.layer?.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,i={}){await this.load(i);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,i);v_e(e,this.layer.spatialReference,r);const s=v4e.fromJSON(r);if(!this._requiresClientGraphicMapping())return s;const n=this.layer.objectIdField;for(const o of s.features){const a=o.attributes[n],l=this._idToClientGraphic.get(a);l&&(o.geometry=l.geometry)}return s.geometryType=this.layer.geometryType,s}async queryFeaturesJSON(e,i={}){if(this._requiresClientGraphicMapping())throw new U("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(i);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,i);return v_e(e,this.layer.spatialReference,r),r}queryFeatureCount(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,i))}queryObjectIds(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,i))}queryExtent(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,i)).then(r=>({count:r.count,extent:gi.fromJSON(r.extent)}))}querySnapping(e,i={}){return this.load(i).then(()=>this._connection.invoke("querySnapping",e,i))}async queryAttributeBins(e,i={}){return await this.load(),this._connection.invoke("queryAttributeBins",e?.toJSON(),i)}async _applyEdits(e){if(!this._connection)throw new U("feature-layer-source:edit-failure","Memory source not loaded");const i=this.layer.objectIdField;let r=null;const s=[],n=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const o=h=>"objectId"in h&&h.objectId!=null?h.objectId:"attributes"in h&&h.attributes[i]!=null?h.attributes[i]:null;if(e.addFeatures&&(r=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const h of e.deleteFeatures){const d=o(h);d!=null&&s.push(d)}const a=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const h of e.updateFeatures)if(n.push(this._serializeFeature(h)),a){const d=o(h);d!=null&&a.set(d,h)}}$3t(r?r.features:null,n,this.layer.spatialReference);const{fullExtent:l,featureEditResults:c}=await this._connection.invoke("applyEdits",{adds:r?r.features:[],updates:n,deletes:s});return this.fullExtent=l,r&&r.finish(c.uidToObjectId),this._updateClientGraphicIds(a,c),this._createEditsResult(c)}async _prepareClientMapping(e,i){if(this._layerOrSourceGeometryType!=="mesh"||e==null)return;const r=[];for(const{geometry:s}of e)s==null||s.type!=="mesh"||s.hasExtent||s.loaded||r.push(s.load({signal:i}));r.length&&await Promise.all(r)}_updateClientGraphicIds(e,i){if(this._idToClientGraphic){if(e)for(const r of i.updateResults){if(!r.success)continue;const s=e.get(r.objectId);s!=null&&this._addIdToClientGraphic(s)}for(const r of i.deleteResults)r.success&&this._idToClientGraphic.delete(r.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const i=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:i?new U("feature-layer-source:edit-failure",i.description,{code:i.code}):null}}_prepareAddFeatures(e){const i=new Map,r=new Array(e.length);let s=null;for(let o=0;o<e.length;o++){const a=e[o],l=this._serializeFeature(a);s||a.geometry==null||(s=a.geometry.type),r[o]=l,i.set(`${l.uid}`,a)}const n=this;return{features:r,inferredGeometryType:s,finish(o){const a=n.sourceJSON.objectIdField;for(const l in o){const c=o[l],h=i.get(l);h&&(h.attributes||(h.attributes={}),c===-1?delete h.attributes[a]:h.attributes[a]=c,n._addIdToClientGraphic(h))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const i=this.sourceJSON.objectIdField,r=e.attributes?.[i];r!=null&&this._idToClientGraphic.set(r,e)}get _layerOrSourceGeometryType(){return this.layer?.geometryType??this.sourceJSON?.geometryType}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this._layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:i}=e,r=this._geometryForSerialization(e),s=(M3t++).toString();return r?{uid:s,geometry:r.toJSON(),attributes:i}:{uid:s,attributes:i}}_geometryForSerialization(e){const{geometry:i}=e;return i==null?null:this._geometryRequiresClientGraphicMapping(i)?i.extent?Sa.fromExtent(i.extent):null:i}async _startWorker(e){this._connection=await yEe("MemorySourceWorker",{strategy:X("feature-layers-workers")?"dedicated":"local",signal:e,registryTarget:this});const{fields:i,spatialReference:r,objectIdField:s,hasM:n,hasZ:o,timeInfo:a,dateFieldsTimeZone:l}=this.layer,c=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const h=this._prepareAddFeatures(this.items);this.addHandles(this.on("before-changes",y=>{J.getLogger(this).error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),y.preventDefault()}));const d={features:h.features,fields:i?.map(y=>y.toJSON()),geometryType:Ule.toJSON(this._workerGeometryType),hasM:this._layerOrSourceGeometryType!=="mesh"&&n,hasZ:this._layerOrSourceGeometryType==="mesh"||o,objectIdField:s,spatialReference:c?null:r&&r.toJSON(),timeInfo:a?.toJSON()??null,dateFieldsTimeZone:l},f=await this._connection.invoke("load",d,{signal:e});for(const y of f.warnings)J.getLogger(this.layer).warn("#load()",`${y.message} (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{warning:y});f.featureErrors.length&&J.getLogger(this.layer).warn("#load()",`Encountered ${f.featureErrors.length} validation errors while loading features. (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{errors:f.featureErrors});const m=f.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(h.inferredGeometryType)&&(m.geometryType=Ule.toJSON(h.inferredGeometryType)),this.sourceJSON=m,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),h.finish(f.assignedObjectIds)}};u([fte({Type:Ml,ensureType:Is(Ml)})],Cy.prototype,"itemType",void 0),u([p()],Cy.prototype,"type",void 0),u([p({constructOnly:!0})],Cy.prototype,"layer",void 0),u([p({readOnly:!0})],Cy.prototype,"_workerGeometryType",null),u([p()],Cy.prototype,"sourceJSON",void 0),Cy=u([A("esri.layers.graphics.sources.MemorySource")],Cy);function O3t(t){return"portalItem"in t}const I3t=t=>{let e=class extends t{get apiKey(){return this._isOverridden("apiKey")?this._get("apiKey"):O3t(this)?this.portalItem?.apiKey:null}set apiKey(i){i!=null?this._override("apiKey",i):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return u([p({type:String})],e.prototype,"apiKey",null),e=u([A("esri.layers.mixins.APIKeyMixin")],e),e},R3t=t=>{let e=class extends t{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const i=gb(this.url);if(i?.title)return i.title}return this._get("title")||""}set title(i){this._set("title",i)}set url(i){this._set("url",CGe(i,J.getLogger(this)))}};return u([p()],e.prototype,"title",null),u([p({type:String})],e.prototype,"url",null),e=u([A("esri.layers.mixins.ArcGISService")],e),e};function P3t(t,e){function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i}function HC(t,e,i,r){var s=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(s,HC.prototype),s.expected=e,s.found=i,s.location=r,s.name="SyntaxError",s}function n9(t,e,i){return i=i||" ",t.length>e?t:(e-=t.length,t+(i+=i.repeat(e)).slice(0,e))}function D3t(t,e){var i,r={},s=(e=e!==void 0?e:{}).grammarSource,n={start:bg},o=bg,a="none",l=")",c=",",h="(",d="%",f="px",m="cm",y="mm",v="in",_="pt",b="pc",w="deg",x="rad",S="grad",C="turn",T="#",M=".",I="e",P=/^[ \t\n\r]/,D=/^[a-z\-]/,F=/^[0-9a-fA-F]/,L=/^[+\-]/,N=/^[0-9]/,R=Ro("none"),k=os("none",!1),W=os(")",!1),G=os(",",!1),j=Ro("whitespace"),re=au([" ","	",`
`,"\r"],!1,!1),ve=Ro("function"),xe=os("(",!1),De=Ro("identifier"),Ke=au([["a","z"],"-"],!1,!1),je=Ro("percentage"),ft=os("%",!1),At=Ro("length"),ti=os("px",!1),Tt=os("cm",!1),xt=os("mm",!1),kt=os("in",!1),Et=os("pt",!1),Ht=os("pc",!1),mt=Ro("angle"),_e=os("deg",!1),pe=os("rad",!1),we=os("grad",!1),Re=os("turn",!1),tt=Ro("number"),We=Ro("color"),ii=os("#",!1),it=au([["0","9"],["a","f"],["A","F"]],!1,!1),Fe=au(["+","-"],!1,!1),Me=au([["0","9"]],!1,!1),Ct=os(".",!1),Xt=os("e",!1),Ji=function(){return[]},Vi=function(B,he){return{type:"function",name:B,parameters:he||[]}},Di=function(B,he){return he.length>0?jv(B,he,3):[B]},Xi=function(B){return{type:"quantity",value:B.value,unit:B.unit}},yr=function(B){return{type:"color",colorType:B.type,value:B.value}},Mi=function(B){return B},Li=function(){return kd()},Mt=function(B){return{value:B,unit:"%"}},zi=function(B){return{value:B,unit:"px"}},fi=function(B){return{value:B,unit:"cm"}},Ki=function(B){return{value:B,unit:"mm"}},Qi=function(B){return{value:B,unit:"in"}},Gr=function(B){return{value:B,unit:"pt"}},er=function(B){return{value:B,unit:"pc"}},lr=function(B){return{value:B,unit:"deg"}},us=function(B){return{value:B,unit:"rad"}},Ps=function(B){return{value:B,unit:"grad"}},Io=function(B){return{value:B,unit:"turn"}},Ol=function(B){return{value:B,unit:null}},jn=function(){return{type:"hex",value:kd()}},no=function(B){return{type:"function",value:B}},vn=function(){return{type:"named",value:kd()}},hs=function(){return parseFloat(kd())},Q=0|e.peg$currPos,ci=Q,ds=[{line:1,column:1}],Ar=Q,ns=e.peg$maxFailExpected||[],nt=0|e.peg$silentFails;if(e.startRule){if(!(e.startRule in n))throw new Error(`Can't start parsing from rule "`+e.startRule+'".');o=n[e.startRule]}function kd(){return t.substring(ci,Q)}function os(B,he){return{type:"literal",text:B,ignoreCase:he}}function au(B,he,$e){return{type:"class",parts:B,inverted:he,ignoreCase:$e}}function zd(){return{type:"end"}}function Ro(B){return{type:"other",description:B}}function uL(B){var he,$e=ds[B];if($e)return $e;if(B>=ds.length)he=ds.length-1;else for(he=B;!ds[--he];);for($e={line:($e=ds[he]).line,column:$e.column};he<B;)t.charCodeAt(he)===10?($e.line++,$e.column=1):$e.column++,he++;return ds[B]=$e,$e}function hL(B,he,$e){var zt=uL(B),kr=uL(he);return{source:s,start:{offset:B,line:zt.line,column:zt.column},end:{offset:he,line:kr.line,column:kr.column}}}function qt(B){Q<Ar||(Q>Ar&&(Ar=Q,ns=[]),ns.push(B))}function iw(B,he,$e){return new HC(HC.buildMessage(B,he),B,he,$e)}function bg(){var B;return(B=eT())===r&&(B=dL()),B}function eT(){var B,he;return nt++,B=Q,Mr(),t.substr(Q,4)===a?(he=a,Q+=4):(he=r,nt===0&&qt(k)),he!==r?(Mr(),ci=B,B=Ji()):(Q=B,B=r),nt--,B===r&&nt===0&&qt(R),B}function dL(){var B,he;if(B=[],(he=Sf())!==r)for(;he!==r;)B.push(he),he=Sf();else B=r;return B}function Sf(){var B,he,$e,zt;return B=Q,Mr(),(he=ph())!==r?(Mr(),($e=Bv())===r&&($e=null),Mr(),t.charCodeAt(Q)===41?(zt=l,Q++):(zt=r,nt===0&&qt(W)),zt!==r?(Mr(),ci=B,B=Vi(he,$e)):(Q=B,B=r)):(Q=B,B=r),B}function Bv(){var B,he,$e,zt,kr,Hr,Ds,$a;if(B=Q,(he=Tf())!==r){for($e=[],zt=Q,kr=Mr(),t.charCodeAt(Q)===44?(Hr=c,Q++):(Hr=r,nt===0&&qt(G)),Hr===r&&(Hr=null),Ds=Mr(),($a=Tf())!==r?zt=kr=[kr,Hr,Ds,$a]:(Q=zt,zt=r);zt!==r;)$e.push(zt),zt=Q,kr=Mr(),t.charCodeAt(Q)===44?(Hr=c,Q++):(Hr=r,nt===0&&qt(G)),Hr===r&&(Hr=null),Ds=Mr(),($a=Tf())!==r?zt=kr=[kr,Hr,Ds,$a]:(Q=zt,zt=r);ci=B,B=Di(he,$e)}else Q=B,B=r;return B}function Tf(){var B,he;return B=Q,(he=ta())===r&&(he=Ef())===r&&(he=Vv())===r&&(he=tT()),he!==r&&(ci=B,he=Xi(he)),(B=he)===r&&(B=Q,(he=rw())!==r&&(ci=B,he=yr(he)),B=he),B}function Mr(){var B,he;for(nt++,B=[],he=t.charAt(Q),P.test(he)?Q++:(he=r,nt===0&&qt(re));he!==r;)B.push(he),he=t.charAt(Q),P.test(he)?Q++:(he=r,nt===0&&qt(re));return nt--,he=r,nt===0&&qt(j),B}function ph(){var B,he,$e;return nt++,B=Q,(he=Ud())!==r?(t.charCodeAt(Q)===40?($e=h,Q++):($e=r,nt===0&&qt(xe)),$e!==r?(ci=B,B=Mi(he)):(Q=B,B=r)):(Q=B,B=r),nt--,B===r&&(he=r,nt===0&&qt(ve)),B}function Ud(){var B,he,$e;if(nt++,B=Q,he=[],$e=t.charAt(Q),D.test($e)?Q++:($e=r,nt===0&&qt(Ke)),$e!==r)for(;$e!==r;)he.push($e),$e=t.charAt(Q),D.test($e)?Q++:($e=r,nt===0&&qt(Ke));else he=r;return he!==r&&(ci=B,he=Li()),nt--,(B=he)===r&&(he=r,nt===0&&qt(De)),B}function ta(){var B,he,$e;return nt++,B=Q,Mr(),(he=Ca())!==r?(t.charCodeAt(Q)===37?($e=d,Q++):($e=r,nt===0&&qt(ft)),$e!==r?(ci=B,B=Mt(he)):(Q=B,B=r)):(Q=B,B=r),nt--,B===r&&nt===0&&qt(je),B}function Ef(){var B,he,$e;return nt++,B=Q,Mr(),(he=Ca())!==r?(t.substr(Q,2)===f?($e=f,Q+=2):($e=r,nt===0&&qt(ti)),$e!==r?(ci=B,B=zi(he)):(Q=B,B=r)):(Q=B,B=r),B===r&&(B=Q,Mr(),(he=Ca())!==r?(t.substr(Q,2)===m?($e=m,Q+=2):($e=r,nt===0&&qt(Tt)),$e!==r?(ci=B,B=fi(he)):(Q=B,B=r)):(Q=B,B=r),B===r&&(B=Q,Mr(),(he=Ca())!==r?(t.substr(Q,2)===y?($e=y,Q+=2):($e=r,nt===0&&qt(xt)),$e!==r?(ci=B,B=Ki(he)):(Q=B,B=r)):(Q=B,B=r),B===r&&(B=Q,Mr(),(he=Ca())!==r?(t.substr(Q,2)===v?($e=v,Q+=2):($e=r,nt===0&&qt(kt)),$e!==r?(ci=B,B=Qi(he)):(Q=B,B=r)):(Q=B,B=r),B===r&&(B=Q,Mr(),(he=Ca())!==r?(t.substr(Q,2)===_?($e=_,Q+=2):($e=r,nt===0&&qt(Et)),$e!==r?(ci=B,B=Gr(he)):(Q=B,B=r)):(Q=B,B=r),B===r&&(B=Q,Mr(),(he=Ca())!==r?(t.substr(Q,2)===b?($e=b,Q+=2):($e=r,nt===0&&qt(Ht)),$e!==r?(ci=B,B=er(he)):(Q=B,B=r)):(Q=B,B=r)))))),nt--,B===r&&nt===0&&qt(At),B}function Vv(){var B,he,$e;return nt++,B=Q,(he=Ca())!==r?(t.substr(Q,3)===w?($e=w,Q+=3):($e=r,nt===0&&qt(_e)),$e!==r?(ci=B,B=lr(he)):(Q=B,B=r)):(Q=B,B=r),B===r&&(B=Q,(he=Ca())!==r?(t.substr(Q,3)===x?($e=x,Q+=3):($e=r,nt===0&&qt(pe)),$e!==r?(ci=B,B=us(he)):(Q=B,B=r)):(Q=B,B=r),B===r&&(B=Q,(he=Ca())!==r?(t.substr(Q,4)===S?($e=S,Q+=4):($e=r,nt===0&&qt(we)),$e!==r?(ci=B,B=Ps(he)):(Q=B,B=r)):(Q=B,B=r),B===r&&(B=Q,(he=Ca())!==r?(t.substr(Q,4)===C?($e=C,Q+=4):($e=r,nt===0&&qt(Re)),$e!==r?(ci=B,B=Io(he)):(Q=B,B=r)):(Q=B,B=r)))),nt--,B===r&&(he=r,nt===0&&qt(mt)),B}function tT(){var B,he;return nt++,B=Q,Mr(),(he=Ca())!==r?(ci=B,B=Ol(he)):(Q=B,B=r),nt--,B===r&&nt===0&&qt(tt),B}function rw(){var B,he,$e,zt;if(nt++,B=Q,t.charCodeAt(Q)===35?(he=T,Q++):(he=r,nt===0&&qt(ii)),he!==r){if($e=[],zt=t.charAt(Q),F.test(zt)?Q++:(zt=r,nt===0&&qt(it)),zt!==r)for(;zt!==r;)$e.push(zt),zt=t.charAt(Q),F.test(zt)?Q++:(zt=r,nt===0&&qt(it));else $e=r;$e!==r?(ci=B,B=jn()):(Q=B,B=r)}else Q=B,B=r;return B===r&&(B=Q,(he=Sf())!==r&&(ci=B,he=no(he)),(B=he)===r&&(B=Q,(he=Ud())!==r&&(ci=B,he=vn()),B=he)),nt--,B===r&&(he=r,nt===0&&qt(We)),B}function Ca(){var B,he,$e,zt,kr,Hr,Ds,$a;for(B=Q,he=t.charAt(Q),L.test(he)?Q++:(he=r,nt===0&&qt(Fe)),he===r&&(he=null),$e=Q,zt=[],kr=t.charAt(Q),N.test(kr)?Q++:(kr=r,nt===0&&qt(Me));kr!==r;)zt.push(kr),kr=t.charAt(Q),N.test(kr)?Q++:(kr=r,nt===0&&qt(Me));if(t.charCodeAt(Q)===46?(kr=M,Q++):(kr=r,nt===0&&qt(Ct)),kr!==r){if(Hr=[],Ds=t.charAt(Q),N.test(Ds)?Q++:(Ds=r,nt===0&&qt(Me)),Ds!==r)for(;Ds!==r;)Hr.push(Ds),Ds=t.charAt(Q),N.test(Ds)?Q++:(Ds=r,nt===0&&qt(Me));else Hr=r;Hr!==r?$e=zt=[zt,kr,Hr]:(Q=$e,$e=r)}else Q=$e,$e=r;if($e===r)if($e=[],zt=t.charAt(Q),N.test(zt)?Q++:(zt=r,nt===0&&qt(Me)),zt!==r)for(;zt!==r;)$e.push(zt),zt=t.charAt(Q),N.test(zt)?Q++:(zt=r,nt===0&&qt(Me));else $e=r;if($e!==r){if(zt=Q,t.charCodeAt(Q)===101?(kr=I,Q++):(kr=r,nt===0&&qt(Xt)),kr!==r){if(Hr=t.charAt(Q),L.test(Hr)?Q++:(Hr=r,nt===0&&qt(Fe)),Hr===r&&(Hr=null),Ds=[],$a=t.charAt(Q),N.test($a)?Q++:($a=r,nt===0&&qt(Me)),$a!==r)for(;$a!==r;)Ds.push($a),$a=t.charAt(Q),N.test($a)?Q++:($a=r,nt===0&&qt(Me));else Ds=r;Ds!==r?zt=kr=[kr,Hr,Ds]:(Q=zt,zt=r)}else Q=zt,zt=r;zt===r&&(zt=null),ci=B,B=hs()}else Q=B,B=r;return B}function sw(B,he){return B.map(function($e){return $e[he]})}function jv(B,he,$e){return[B].concat(sw(he,$e))}if(i=o(),e.peg$library)return{peg$result:i,peg$currPos:Q,peg$FAILED:r,peg$maxFailExpected:ns,peg$maxFailPos:Ar};if(i!==r&&Q===t.length)return i;throw i!==r&&Q<t.length&&qt(zd()),iw(ns,Ar<t.length?t.charAt(Ar):null,Ar<t.length?hL(Ar,Ar+1):hL(Ar,Ar))}function _4e(t){if(!t||t.length===0)return null;if(typeof t=="string"){const i=__e(t);return i&&i.length!==0?i:null}const e=t.map(i=>{if(!Number.isFinite(i.scale)||i.scale<=0)throw new U("effect:invalid-scale","scale must be finite and greater than 0",{stop:i});return{scale:i.scale,effects:__e(i.value)}});e.sort((i,r)=>r.effects.length-i.effects.length);for(let i=0;i<e.length-1;i++){if(!KZe(e[i].effects,e[i+1].effects))throw new U("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[i].effects,b:e[i+1].effects});QZe(e[i].effects,e[i+1].effects)}return e.sort((i,r)=>r.scale-i.scale),e}function __e(t){let e;if(!t)return[];try{e=D3t(t)}catch(i){throw new U("effect:invalid-syntax","Invalid effect syntax",{value:t,error:i})}return e.map(i=>L3t(i))}function L3t(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return N3t(t);case"opacity":return F3t(t);case"hue-rotate":return k3t(t);case"blur":return z3t(t);case"drop-shadow":return U3t(t);case"bloom":return B3t(t)}}catch(e){throw e.details.filter=t,e}throw new U("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function N3t(t){let e=1;return jA(t.parameters,1),t.parameters.length===1&&(e=Lp(t.parameters[0])),new wW(t.name,e)}function F3t(t){let e=1;return jA(t.parameters,1),t.parameters.length===1&&(e=Lp(t.parameters[0])),new q2e(e)}function k3t(t){let e=0;return jA(t.parameters,1),t.parameters.length===1&&(e=W3t(t.parameters[0])),new G2e(e)}function z3t(t){let e=0;return jA(t.parameters,1),t.parameters.length===1&&(e=$oe(t.parameters[0]),tL(e,t.parameters[0])),new z2e(e)}function U3t(t){const e=[];let i=null;for(const r of t.parameters)if(r.type==="color"){if(e.length&&Object.freeze(e),i)throw new U("effect:type-error","Accepts only one color",{});i=Z3t(r)}else{const s=$oe(r);if(Object.isFrozen(e))throw new U("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(s),e.length===3&&tL(s,r)}if(e.length<2||e.length>3)throw new U("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new V2e(e[0],e[1],e[2]||0,i||b4e("black"))}function B3t(t){let e=1,i=0,r=0;return jA(t.parameters,3),t.parameters[0]&&(e=Lp(t.parameters[0])),t.parameters[1]&&(i=$oe(t.parameters[1]),tL(i,t.parameters[1])),t.parameters[2]&&(r=Lp(t.parameters[2])),new F2e(e,i,r)}function jA(t,e){if(t.length>e)throw new U("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function RG(t){if(t.type==="color")return"<color>";if(t.unit){if(t.unit in Coe)return"<length>";if(t.unit in Eoe)return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function tL(t,e){if(t<0)throw new U("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function V3t(t){if(t.type!=="quantity"||t.unit!==null)throw new U("effect:type-error",`Expected <double>, Actual: ${RG(t)}`,{term:t})}function j3t(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new U("effect:type-error",`Expected <double> or <percentage>, Actual: ${RG(t)}`,{term:t})}P3t(HC,Error),HC.prototype.format=function(t){var e="Error: "+this.message;if(this.location){var i,r=null;for(i=0;i<t.length;i++)if(t[i].source===this.location.source){r=t[i].text.split(/\r\n|\n|\r/g);break}var s=this.location.start,n=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(s):s,o=this.location.source+":"+n.line+":"+n.column;if(r){var a=this.location.end,l=n9("",n.line.toString().length," "),c=r[s.line-1],h=(s.line===a.line?a.column:c.length+1)-s.column||1;e+=`
 --> `+o+`
`+l+` |
`+n.line+" | "+c+`
`+l+" | "+n9("",s.column-1," ")+n9("",h,"^")}else e+=`
 at `+o}return e},HC.buildMessage=function(t,e){var i={literal:function(c){return'"'+s(c.text)+'"'},class:function(c){var h=c.parts.map(function(d){return Array.isArray(d)?n(d[0])+"-"+n(d[1]):n(d)});return"["+(c.inverted?"^":"")+h.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(c){return c.description}};function r(c){return c.charCodeAt(0).toString(16).toUpperCase()}function s(c){return c.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(h){return"\\x0"+r(h)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(h){return"\\x"+r(h)})}function n(c){return c.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(h){return"\\x0"+r(h)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(h){return"\\x"+r(h)})}function o(c){return i[c.type](c)}function a(c){var h,d,f=c.map(o);if(f.sort(),f.length>0){for(h=1,d=1;h<f.length;h++)f[h-1]!==f[h]&&(f[d]=f[h],d++);f.length=d}switch(f.length){case 1:return f[0];case 2:return f[0]+" or "+f[1];default:return f.slice(0,-1).join(", ")+", or "+f[f.length-1]}}function l(c){return c?'"'+s(c)+'"':"end of input"}return"Expected "+a(t)+" but "+l(e)+" found."};const Eoe={deg:1,grad:.9,rad:180/Math.PI,turn:360};function G3t(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&Eoe[t.unit]!=null))throw new U("effect:type-error",`Expected <angle>, Actual: ${RG(t)}`,{term:t})}const Coe={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function H3t(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&Coe[t.unit]!=null))throw new U("effect:type-error",`Expected <length>, Actual: ${RG(t)}`,{term:t})}function Lp(t){j3t(t);const e=t.value;return tL(e,t),t.unit==="%"?.01*e:e}function q3t(t){return V3t(t),tL(t.value,t),t.value}function W3t(t){return G3t(t),t.value*Eoe[t.unit]||0}function $oe(t){return H3t(t),t.value*Coe[t.unit]||0}function Z3t(t){switch(t.colorType){case"hex":return lZe(t.value);case"named":return b4e(t.value);case"function":return X3t(t.value)}}function b4e(t){if(!w2e(t))throw new U("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return aZe(t)}const Y3t=/^rgba?/i,J3t=/^hsla?/i;function X3t(t){if(jA(t.parameters,4),Y3t.test(t.name))return[Lp(t.parameters[0]),Lp(t.parameters[1]),Lp(t.parameters[2]),t.parameters[3]?Lp(t.parameters[3]):1];if(J3t.test(t.name))return x2e(q3t(t.parameters[0]),Lp(t.parameters[1]),Lp(t.parameters[2]),t.parameters[3]?Lp(t.parameters[3]):1);throw new U("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function A3(t,e,i){try{return Q3t(t)}catch(r){i?.messages?.push(r)}return null}function M3(t,e,i,r){try{const s=K3t(t);to(i,s,e)}catch(s){r.messages&&r.messages.push(s)}}function K3t(t){const e=_4e(t);return e?eYe(e)?e.map(i=>i.toJSON()):e.map(({scale:i,effects:r})=>({scale:i,value:r.map(s=>s.toJSON())})):null}function Q3t(t){if(!t||t.length===0)return null;if(eDt(t)){const e=[];for(const i of t)e.push({scale:i.scale,value:b_e(i.value)});return e}return b_e(t)}function eDt(t){const e=t[0];return!!e&&"scale"in e}function b_e(t){if(!t?.length)return"";const e=[];for(const i of t){let r=[];switch(i.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":r=[kg(i,"amount")];break;case"blur":r=[kg(i,"radius","pt")];break;case"hue-rotate":r=[kg(i,"angle","deg")];break;case"drop-shadow":r=[kg(i,"xoffset","pt"),kg(i,"yoffset","pt"),kg(i,"blurRadius","pt"),tDt(i,"color")];break;case"bloom":r=[kg(i,"strength"),kg(i,"radius","pt"),kg(i,"threshold")]}const s=`${i.type}(${r.filter(Boolean).join(" ")})`;_4e(s),e.push(s)}return e.join(" ")}function kg(t,e,i){if(t[e]==null)throw new U("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});return i?t[e]+i:""+t[e]}function tDt(t,e){if(t[e]==null)throw new U("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});const i=t[e];return`rgba(${i[0]||0}, ${i[1]||0}, ${i[2]||0}, ${i[3]/255||0})`}const iDt={type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:{layerContainerTypes:Ys}},"portal-item":{read:!0,write:{layerContainerTypes:Ys}}}}},w_e={read:{reader:A3},write:{allowNull:!0,writer:M3,layerContainerTypes:Ys}},rDt={json:{read:!1,write:!1,origins:{"web-map":w_e,"portal-item":w_e}}},sDt=t=>{let e=class extends t{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return u([p(iDt)],e.prototype,"blendMode",void 0),u([p(rDt)],e.prototype,"effect",void 0),e=u([A("esri.layers.mixins.BlendLayer")],e),e},nDt=t=>{let e=class extends t{constructor(){super(...arguments),this.customParameters=null}};return u([p({type:Object,json:{write:{overridePolicy:i=>({enabled:!!(i&&Object.keys(i).length>0)})}}})],e.prototype,"customParameters",void 0),e=u([A("esri.layers.mixins.CustomParametersMixin")],e),e},x_e={write:{overridePolicy:(t,e,i)=>({enabled:!i||i.filterMode==="scale"})}};let K0=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.id=SD(),this.maxScale=0,this.minScale=0,this.title="",this.where=null}};u([p({type:String,json:{write:!0}})],K0.prototype,"id",void 0),u([p({type:Number,json:x_e})],K0.prototype,"maxScale",void 0),u([p({type:Number,json:x_e})],K0.prototype,"minScale",void 0),u([p({type:String,json:{write:!0}})],K0.prototype,"title",void 0),u([p({type:String,json:{write:!0}})],K0.prototype,"where",void 0),K0=u([A("esri.layers.support.DisplayFilter")],K0);const w4e=K0;function oDt(t,e){return{...e,filterMode:t.mode}}function Qhi(t,e){return x4e(t,e).next().value??null}function edi(t,e,i){const r=aDt(t);if(r&&(vxe(e,r[0])||d7(i,r[1])))return"";const s=Array.from(x4e(t,e,i)),n=lDt(s,e,i)?"1=1":s.map(o=>o.where||"1=1").reduce((o,a)=>EYe(o,a),"");return n&&n!=="1=1"?n:""}function aDt(t){if(S4e(t)==="manual")return null;const e=[Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY];for(const{minScale:i,maxScale:r}of t.filters)e[0]=Math.max(e[0],O3(i)),e[1]=Math.min(e[1],MB(r));return e}function*x4e(t,e,i){if(S4e(t)==="manual"){const r=t.filters.find(s=>s.id===t.activeFilterId);r&&(yield r)}else{typeof e=="object"&&(e=e.scale);for(const r of t.filters)cDt(r.minScale,r.maxScale,e,i)&&(yield r)}}function lDt(t,e,i){if(t.length===0)return!0;const r=O3(t.at(0)?.minScale),s=MB(t.at(-1)?.maxScale);if(d7(r,e)||vxe(s,i))return!0;for(let n=0;n<t.length-1;n++){const o=t[n],a=t[n+1];if(d7(O3(a.minScale),MB(o.maxScale)))return!0}return!1}function cDt(t,e,i,r){return t=O3(t),i=O3(i),e=MB(e),!(!Jc(i,t)&&(r??i)>t)&&!Sje(e,i)&&(r===void 0||!Jc(r,t))}function S4e(t){return"mode"in t?t.mode:t.filterMode}function O3(t){return t||Number.POSITIVE_INFINITY}function MB(t){return t||0}let N1=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.activeFilterId=null,this.filters=new(Ee.ofType(w4e)),this.mode="manual"}writeFilters(e,i,r,s){const n=e.toArray();this.mode==="scale"&&n.sort((o,a)=>{const l=Xat(a.minScale,o.minScale),c=o.maxScale-a.maxScale;return l===0?c:l}),i[r]=n.map(o=>o.toJSON(s))}write(e,i){return super.write(e,oDt(this,i))}};u([p({type:String,json:{write:{overridePolicy:(t,e,i)=>({enabled:i.filterMode==="manual",isRequired:!0})}}})],N1.prototype,"activeFilterId",void 0),u([p({type:Ee.ofType(w4e),nonNullable:!0,json:{write:!0}})],N1.prototype,"filters",void 0),u([ge("filters")],N1.prototype,"writeFilters",null),u([p({type:["manual","scale"],nonNullable:!0,json:{name:"filterMode",write:!0}})],N1.prototype,"mode",void 0),N1=u([A("esri.layers.support.DisplayFilterInfo")],N1);const uDt=N1,hDt=t=>{let e=class extends t{constructor(){super(...arguments),this.displayFilterEnabled=!0,this.displayFilterInfo=null}};return u([p(dDt)],e.prototype,"displayFilterEnabled",void 0),u([p(pDt)],e.prototype,"displayFilterInfo",void 0),e=u([A("esri.layers.mixins.DisplayFilteredLayer")],e),e},dDt={type:Boolean,json:{name:"layerDefinition.disableDisplayFilter",read:{reader:t=>!t},write:{layerContainerTypes:Ys,writer(t,e,i){to(i,!t,e)}},origins:{"web-scene":{write:!1,read:!1}}}},pDt={type:uDt,json:{name:"layerDefinition.displayFilterInfo",write:{enabled:!0,allowNull:!0,layerContainerTypes:Ys},origins:{"web-scene":{write:!1,read:!1}}}},NK=xst(),T4e=new Map,E4e=new Map;async function idi(t,e,i){if(!t||!i)return!1;if(!e)return!0;const r=new URL(t).host;let s=T4e.get(r);if(!s){const n=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");s=(await Ci(n,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return s===e}async function S_e(t,e,i=!1){if(!t||!e)return!0;const r=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),s=E4e.get(r)?.entries();if(s){for(const[n,o]of s)if(o.name===e){const a=!o.stack?.hasForwardEdits();if(!a&&i){const[{deleteForwardEdits:l},{default:c}]=await Promise.all([V(()=>import("./deleteForwardEdits-C4y-BxcT.js"),[]),V(()=>import("./DeleteForwardEditsParameters-DojrElVW.js"),[])]),h=await l(r,n,new c({sessionId:NK,moment:o.moment}));return h.success&&o.stack?.clearForwardEdits(),h.success}return a}}return!0}function F5(t,e){if(!t)return!1;const i=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),r=E4e.get(i)?.entries();if(r){for(const[s,n]of r)if(n.name===e)return n.lockType==="edit"}return!1}const Aoe=new ws.EventEmitter;function C4e(t){return Aoe.on("apply-edits",new WeakRef(t))}function $4e(t){return Aoe.on("update-moment",new WeakRef(t))}function T_e(t,e,i=null,r=!1){const s=Qo();return r=e==null||r,Aoe.emit("apply-edits",{serviceUrl:t,layerId:e,gdbVersion:i,mayReceiveServiceEdits:r,result:s.promise}),s}const A4e=Symbol();function rdi(t){return t!=null&&typeof t=="object"&&A4e in t}function rO(t){return t!=null&&typeof t=="object"&&"gdbVersion"in t}function QR(t,e,i){const r=new URL(t).host,s=T4e.get(r),n=o=>!o||o===s;return n(e)&&n(i)||e===i}const fDt=t=>{var e;let i=class extends t{constructor(...r){super(...r),this[e]=!0,this._applyEditsHandler=s=>{const{serviceUrl:n,layerId:o,gdbVersion:a,mayReceiveServiceEdits:l,result:c}=s,h=n===this.url,d=o!=null&&this.layerId!=null&&o===this.layerId,f=rO(this),m=rO(this)&&QR(n,a,this.gdbVersion);if(!h||f&&!m||!d&&!l)return;const y=c.then(v=>{if(this.lastEditsEventDate=new Date,d&&(v.addedFeatures.length||v.updatedFeatures.length||v.deletedFeatures.length||v.addedAttachments.length||v.updatedAttachments.length||v.deletedAttachments.length))return this.emit("edits",q(v)),v;const _=v.editedFeatures?.find(({layerId:w})=>w===this.layerId);if(_){const{adds:w,updates:x,deletes:S}=_.editedFeatures,C={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:w?w.map(({attributes:T})=>({objectId:this.objectIdField&&T[this.objectIdField],globalId:this.globalIdField&&T[this.globalIdField]})):[],deletedFeatures:S?S.map(({attributes:T})=>({objectId:this.objectIdField&&T[this.objectIdField],globalId:this.globalIdField&&T[this.globalIdField]})):[],updatedFeatures:x?x.map(({current:{attributes:T}})=>({objectId:this.objectIdField&&T[this.objectIdField],globalId:this.globalIdField&&T[this.globalIdField]})):[],editedFeatures:q(v.editedFeatures),exceededTransferLimit:!1,historicMoment:q(v.historicMoment)};return this.emit("edits",C),C}const b={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:q(v.editedFeatures),exceededTransferLimit:!1,historicMoment:q(v.historicMoment)};return"historicMoment"in this&&this._shouldUpdateHistoricMoment(n,a,b.historicMoment)&&this.emit("edits",b),b}).then(v=>("historicMoment"in this&&this._shouldUpdateHistoricMoment(n,a,v.historicMoment)&&(this.historicMoment=v.historicMoment),v));this.emit("apply-edits",{result:y})},this._updateMomentHandler=s=>{const{serviceUrl:n,gdbVersion:o,moment:a}=s,l=n===this.url,c=rO(this),h=rO(this)&&QR(n,o,this.gdbVersion),d=rO(this)&&!QR(n,this.gdbVersion,null);l&&c&&h&&d&&"historicMoment"in this&&this.historicMoment!==a&&(this.historicMoment=a)},this.when().then(()=>{this.addHandles(C4e(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles($4e(this._updateMomentHandler))},()=>{})}_shouldUpdateHistoricMoment(r,s,n){return"historicMoment"in this&&this.historicMoment!==n&&F5(r,s)}};return e=A4e,u([p()],i.prototype,"lastEditsEventDate",void 0),i=u([A("esri.layers.mixins.EditBusLayer")],i),i};var FK;const o9=new ei({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),a9=new ei({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let lm=FK=class extends ee{constructor(t){super(t),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(t={}){const{where:e,geometry:i,spatialRelationship:r,timeExtent:s,objectIds:n,units:o,distance:a}=this;return new Jm({geometry:q(i),objectIds:q(n),spatialRelationship:r,timeExtent:q(s),where:e,units:o,distance:a,...t})}clone(){const{where:t,geometry:e,spatialRelationship:i,timeExtent:r,objectIds:s,units:n,distance:o}=this;return new FK({geometry:q(e),objectIds:q(s),spatialRelationship:i,timeExtent:q(r),where:t,units:n,distance:o})}};u([p({type:String,json:{write:!0}})],lm.prototype,"where",void 0),u([p({types:bA,json:{write:!0}})],lm.prototype,"geometry",void 0),u([p({type:o9.apiValues,json:{name:"spatialRel",read:{reader:o9.read},write:{allowNull:!1,writer:o9.write,overridePolicy(){return{enabled:this.geometry!=null}}}}})],lm.prototype,"spatialRelationship",void 0),u([p({type:Number,json:{write:{overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],lm.prototype,"distance",void 0),u([p({type:[Number],json:{write:!0}})],lm.prototype,"objectIds",void 0),u([p({type:a9.apiValues,json:{read:a9.read,write:{writer:a9.write,overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],lm.prototype,"units",void 0),u([p({type:To,json:{write:!0}})],lm.prototype,"timeExtent",void 0),lm=FK=u([A("esri.layers.support.FeatureFilter")],lm);const mDt=lm;var kK;const E_e={read:{reader:A3},write:{writer:M3,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},C_e={read:{reader:A3},write:{writer:M3,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},$_e={name:"showExcludedLabels",default:!0};let F1=kK=class extends ee{constructor(t){super(t),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(t,e){const i=super.write(t,e);if(e?.origin){if(i.filter){const r=Object.keys(i.filter);if(r.length>1||r[0]!=="where")return e.messages?.push(new U("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:e.layer,effect:this})),null}if("showExcludedLabels"in i)return e.messages?.push(new U("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:e.layer,effect:this})),null}return i}clone(){return new kK({filter:this.filter!=null?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};u([p({type:mDt,json:{write:{allowNull:!0,writer(t,e,i,r){const s=t?.write({},r);s&&Object.keys(s).length!==0?to(i,s,e):to(i,null,e)}}}})],F1.prototype,"filter",void 0),u([p({json:{read:A3,write:{writer:M3,allowNull:!0},origins:{"web-map":E_e,"portal-item":E_e}}})],F1.prototype,"includedEffect",void 0),u([p({json:{read:A3,write:{writer:M3,allowNull:!0},origins:{"web-map":C_e,"portal-item":C_e}}})],F1.prototype,"excludedEffect",void 0),u([p({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":$_e,"portal-item":$_e}}})],F1.prototype,"excludedLabelsVisible",void 0),F1=kK=u([A("esri.layers.support.FeatureEffect")],F1);const gDt=F1,A_e={write:{allowNull:!0}},yDt={type:gDt,json:{origins:{"web-map":A_e,"portal-item":A_e}}},vDt=t=>{let e=class extends t{constructor(){super(...arguments),this.featureEffect=null}};return u([p(yDt)],e.prototype,"featureEffect",void 0),e=u([A("esri.layers.mixins.FeatureEffectLayer")],e),e};var zK;let BI=zK=class extends ee{constructor(t){super(t)}async collectRequiredFields(t,e){return Al(t,e,this.expression)}clone(){return new zK({expression:this.expression,title:this.title})}equals(t){return this.expression===t.expression&&this.title===t.title}};u([p({type:String,json:{write:{isRequired:!0}}})],BI.prototype,"expression",void 0),u([p({type:String,json:{write:!0}})],BI.prototype,"title",void 0),BI=zK=u([A("esri.symbols.support.FeatureExpressionInfo")],BI);const M_e=BI;var UK;const qF=Mo()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),O_e=new ei({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let hy=UK=class extends ee{constructor(t){super(t),this.featureExpressionInfo=void 0,this.offset=null}readFeatureExpressionInfo(t,e){return t??(e.featureExpression&&e.featureExpression.value===0?{expression:"0"}:void 0)}writeFeatureExpressionInfo(t,e,i,r){e[i]=t.write({},r),t.expression==="0"&&(e.featureExpression={value:0})}get mode(){const{offset:t,featureExpressionInfo:e}=this;return this._isOverridden("mode")?this._get("mode"):t!=null||e?"relative-to-ground":"on-the-ground"}set mode(t){this._override("mode",t)}set unit(t){this._set("unit",t)}write(t,e){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(t,e):null}clone(){return new UK({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(t){return this.mode===t.mode&&this.offset===t.offset&&this.unit===t.unit&&$Ve(this.featureExpressionInfo,t.featureExpressionInfo)}};u([p({type:M_e,json:{write:!0}})],hy.prototype,"featureExpressionInfo",void 0),u([me("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],hy.prototype,"readFeatureExpressionInfo",null),u([ge("featureExpressionInfo",{featureExpressionInfo:{type:M_e},"featureExpression.value":{type:[0]}})],hy.prototype,"writeFeatureExpressionInfo",null),u([p({type:qF.apiValues,nonNullable:!0,json:{type:qF.jsonValues,read:qF.read,write:{writer:qF.write,isRequired:!0}}})],hy.prototype,"mode",null),u([p({type:Number,json:{write:!0}})],hy.prototype,"offset",void 0),u([p({type:Tlt,json:{type:String,read:O_e.read,write:O_e.write}})],hy.prototype,"unit",null),hy=UK=u([A("esri.symbols.support.ElevationInfo")],hy);const _Dt=hy;let p2=class extends ee{constructor(e){super(e),this.description=null,this.label=null,this.type=null}};u([p({type:String,json:{write:!0}})],p2.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],p2.prototype,"label",void 0),u([p()],p2.prototype,"type",void 0),p2=u([A("esri.tables.elements.AttributeTableElement")],p2);const tA=p2;var BK;let VI=BK=class extends tA{constructor(t){super(t),this.displayType="auto",this.type="attachment"}clone(){return new BK({description:this.description,displayType:this.displayType,label:this.label})}};u([p({type:["auto"],json:{write:!0}})],VI.prototype,"displayType",void 0),u([p({type:["attachment"],readOnly:!0,json:{read:!1,write:!0}})],VI.prototype,"type",void 0),VI=BK=u([A("esri.tables.elements.AttributeTableAttachmentElement")],VI);const I_e=VI;var VK;let jI=VK=class extends tA{constructor(t){super(t),this.fieldName=null,this.type="field"}clone(){return new VK({description:this.description,fieldName:this.fieldName,label:this.label})}};u([p({type:String,json:{write:!0}})],jI.prototype,"fieldName",void 0),u([p({type:String,json:{read:!1,write:!0}})],jI.prototype,"type",void 0),jI=VK=u([A("esri.tables.elements.AttributeTableFieldElement")],jI);const R_e=jI;var jK;let GI=jK=class extends tA{constructor(t){super(t),this.relationshipId=null,this.type="relationship"}clone(){return new jK({description:this.description,label:this.label,relationshipId:this.relationshipId})}};u([p({type:Number,json:{write:!0}})],GI.prototype,"relationshipId",void 0),u([p({type:["relationship"],json:{read:!1,write:!0}})],GI.prototype,"type",void 0),GI=jK=u([A("esri.tables.elements.AttributeTableRelationshipElement")],GI);const P_e=GI;function M4e(t){return{typesWithGroup:{base:tA,key:"type",typeMap:{attachment:I_e,field:R_e,group:t,relationship:P_e}},typesWithoutGroup:{base:tA,key:"type",typeMap:{attachment:I_e,field:R_e,relationship:P_e}}}}function O4e(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>r[s.type]).map(s=>r[s.type].fromJSON(s))}function I4e(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>r[s.type]).map(s=>s.toJSON())}function R4e(t,e,i=!0){return t?t.map(r=>Sd(i?e.typesWithGroup:e.typesWithoutGroup,r)):null}var GK;let $y=GK=class extends tA{constructor(t){super(t),this.elements=null,this.type="group"}castElements(t){return R4e(t,l9,!1)}readElements(t,e){return O4e(e.attributeTableElements,l9,!1)}writeElements(t,e){e.attributeTableElements=I4e(t,l9,!1)}clone(){return new GK({description:this.description,elements:q(this.elements),label:this.label})}};u([p({json:{write:!0}})],$y.prototype,"elements",void 0),u([Yt("elements")],$y.prototype,"castElements",null),u([me("elements",["attributeTableElements"])],$y.prototype,"readElements",null),u([ge("elements")],$y.prototype,"writeElements",null),u([p({type:String,json:{read:!1,write:!0}})],$y.prototype,"type",void 0),$y=GK=u([A("esri.tables.elements.AttributeTableGroupElement")],$y);const l9=M4e($y),bDt=$y;var HK;const c9=M4e(bDt);let Q0=HK=class extends ee{constructor(t){super(t),this.elements=null,this.orderByFields=null}castElements(t){return R4e(t,c9)}readElements(t,e){return O4e(e.attributeTableElements,c9)}writeElements(t,e){e.attributeTableElements=I4e(t,c9)}clone(){return new HK({elements:q(this.elements),orderByFields:this.orderByFields})}};u([p({json:{write:!0}})],Q0.prototype,"elements",void 0),u([Yt("elements")],Q0.prototype,"castElements",null),u([me("elements",["attributeTableElements"])],Q0.prototype,"readElements",null),u([ge("elements")],Q0.prototype,"writeElements",null),u([p({type:[Object],json:{write:!0}})],Q0.prototype,"orderByFields",void 0),Q0=HK=u([A("esri.tables.AttributeTableTemplate")],Q0);const wDt=Q0,xDt={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:{enabled:!0,layerContainerTypes:Ys}}},PG={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(t,e)=>!e.disablePopup},write:{enabled:!0,writer(t,e,i){e[i]=!t}}}},DG={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:{enabled:!0,layerContainerTypes:Ys}}},SDt={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:Wx}}},TDt={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:{enabled:!0,layerContainerTypes:Ys}}},EDt={value:null,type:_Dt,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:{enabled:!0,layerContainerTypes:Ys}}};function ndi(t){return{type:t,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const P4e={write:{enabled:!0,layerContainerTypes:Ys},read:!0},qK={type:Number,json:{origins:{"web-document":P4e,"portal-item":{write:{layerContainerTypes:Ys}}}}},CDt={...qK,json:{...qK.json,origins:{"web-document":{...P4e,write:{enabled:!0,layerContainerTypes:Ys,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(t,e,i)=>i&&i.origin!=="service"||!e.drawingInfo||e.drawingInfo.transparency===void 0?e.layerDefinition?.drawingInfo&&e.layerDefinition.drawingInfo.transparency!==void 0?_$(e.layerDefinition.drawingInfo.transparency):void 0:_$(e.drawingInfo.transparency)}}},odi={type:gi,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(t,e)=>{const i=gi.fromJSON(t);return e.spatialReference!=null&&typeof e.spatialReference=="object"&&(i.spatialReference=Ae.fromJSON(e.spatialReference)),i}}}},read:!1}},$Dt={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},ADt={type:Number,json:{origins:{service:{write:{enabled:!1}}},name:"layerDefinition.minScale",write:{layerContainerTypes:Ys}}},MDt={type:Number,json:{origins:{service:{write:{enabled:!1}}},name:"layerDefinition.maxScale",write:{layerContainerTypes:Ys}}},D4e={json:{write:{ignoreOrigin:!0,layerContainerTypes:Ys},origins:{"web-map":{read:!1,write:!1}}}},ODt={type:wDt,json:{name:"attributeTableInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}};let dy=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.timeZone=null}};u([p()],dy.prototype,"creatorField",void 0),u([p()],dy.prototype,"creationDateField",void 0),u([p()],dy.prototype,"editorField",void 0),u([p()],dy.prototype,"editDateField",void 0),u([p()],dy.prototype,"realm",void 0),u([p(Jz("dateFieldsTimeReference",!0))],dy.prototype,"timeZone",void 0),dy=u([A("esri.layers.support.EditFieldsInfo")],dy);const IDt=dy;let mm=class extends Dt.ClonableMixin(ee){constructor(e){super(e)}};u([p({constructOnly:!0,json:{write:!0}})],mm.prototype,"name",void 0),u([p({constructOnly:!0,json:{write:!0}})],mm.prototype,"fields",void 0),u([p({constructOnly:!0,json:{write:!0}})],mm.prototype,"isAscending",void 0),u([p({constructOnly:!0,json:{write:!0}})],mm.prototype,"indexType",void 0),u([p({constructOnly:!0,json:{write:!0}})],mm.prototype,"isUnique",void 0),u([p({constructOnly:!0,json:{write:!0}})],mm.prototype,"description",void 0),mm=u([A("esri.layers.support.FeatureIndex")],mm);async function L4e(t,e,i){e=e.clone(),t.capabilities.query.supportsMaxRecordCountFactor&&(e.maxRecordCountFactor=N4e(t));const r=RDt(t),s=t.capabilities.query.supportsPagination;e.start=0,e.num=r;let n=null;for(;;){const o=await t.source.queryFeaturesJSON(e,i);if(n==null?n=o:n.features=n.features.concat(o.features),n.exceededTransferLimit=o.exceededTransferLimit,!s||!o.exceededTransferLimit)break;e.start+=r}return n}function RDt(t){return N4e(t)*PDt(t)}function PDt(t){return t.capabilities.query.maxRecordCount||2e3}function N4e(t){return t.capabilities.query.supportsMaxRecordCountFactor?Jm.MAX_MAX_RECORD_COUNT_FACTOR:1}var WK;let HI=WK=class extends ee{constructor(t){super(t),this.minValue=0,this.maxValue=0}clone(){return new WK({minValue:this.minValue,maxValue:this.maxValue})}};u([p({type:Number,json:{write:!0}})],HI.prototype,"minValue",void 0),u([p({type:Number,json:{write:!0}})],HI.prototype,"maxValue",void 0),HI=WK=u([A("esri.renderers.support.AuthoringInfoClassBreakInfo")],HI);var ZK;let w_=ZK=class extends ee{constructor(t){super(t),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=new Array}clone(){return new ZK({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:q(this.classBreakInfos)})}};u([p({type:String,json:{write:!0}})],w_.prototype,"field",void 0),u([p({type:String,json:{write:!0}})],w_.prototype,"normalizationField",void 0),u([p({type:String,json:{write:!0}})],w_.prototype,"label",void 0),u([p({type:[HI],json:{write:!0}})],w_.prototype,"classBreakInfos",void 0),w_=ZK=u([A("esri.renderers.support.AuthoringInfoFieldInfo")],w_);var YK;let f2=YK=class extends ee{constructor(t){super(t),this.label=null,this.size=null,this.value=null}clone(){return new YK({label:this.label,value:this.value,size:this.size})}};u([p({type:String,json:{write:!0}})],f2.prototype,"label",void 0),u([p({type:Number,json:{write:!0}})],f2.prototype,"size",void 0),u([p({type:Number,json:{write:!0}})],f2.prototype,"value",void 0),f2=YK=u([A("esri.renderers.support.AuthoringInfoSizeStop")],f2);const DDt=f2;var JK;const WF=new ei({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),ZF=new ei({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),D_e={key:t=>typeof t=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},L_e=["high-to-low","above-and-below","centered-on","extremes"],N_e=[...new Set(["high-to-low","above-and-below","centered-on","extremes","above","below","high-to-low","above-and-below","above","below","reference-size"])],F_e=["seconds","minutes","hours","days","months","years"],LDt=["circle","diamond","hexagon-flat","hexagon-pointy","square"];let aa=JK=class extends ee{constructor(t){super(t),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(t){return typeof t=="string"||typeof t=="number"?t:null}get normalizationField(){return this.theme==="reference-size"?this._get("normalizationField"):null}set normalizationField(t){this._set("normalizationField",t)}get referenceSizeScale(){return this.theme==="reference-size"?this._get("referenceSizeScale"):null}set referenceSizeScale(t){this._set("referenceSizeScale",t)}get referenceSizeSymbolStyle(){return this.theme==="reference-size"?this._get("referenceSizeSymbolStyle"):null}set referenceSizeSymbolStyle(t){this._set("referenceSizeSymbolStyle",t)}castStartTime(t){return typeof t=="string"||typeof t=="number"?t:null}get sizeStops(){return this.theme==="reference-size"?this._get("sizeStops"):null}set sizeStops(t){this._set("sizeStops",t)}get style(){return this.type==="color"?this._get("style"):null}set style(t){this._set("style",t)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(t){this._set("theme",t)}clone(){return new JK({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,normalizationField:this.normalizationField,referenceSizeScale:this.referenceSizeScale,referenceSizeSymbolStyle:this.referenceSizeSymbolStyle,sizeStops:q(this.sizeStops),startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};u([p({types:D_e,json:{write:!0}})],aa.prototype,"endTime",void 0),u([Yt("endTime")],aa.prototype,"castEndTime",null),u([p({type:String,json:{write:!0}})],aa.prototype,"field",void 0),u([p({type:Number,json:{write:!0}})],aa.prototype,"maxSliderValue",void 0),u([p({type:Number,json:{write:!0}})],aa.prototype,"minSliderValue",void 0),u([p({type:String,json:{origins:{"web-scene":{write:!1}},write:!0}})],aa.prototype,"normalizationField",null),u([p({type:Number,value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],aa.prototype,"referenceSizeScale",null),u([p({type:LDt,value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],aa.prototype,"referenceSizeSymbolStyle",null),u([p({types:D_e,json:{write:!0}})],aa.prototype,"startTime",void 0),u([Yt("startTime")],aa.prototype,"castStartTime",null),u([p({type:[DDt],json:{origins:{"web-scene":{write:!1}},write:!0}})],aa.prototype,"sizeStops",null),u([p({type:WF.apiValues,value:null,json:{type:WF.jsonValues,read:WF.read,write:WF.write}})],aa.prototype,"style",null),u([p({type:N_e,value:null,json:{type:N_e,origins:{"web-scene":{type:L_e,write:{writer:(t,e)=>{L_e.includes(t)&&(e.theme=t)}}}},write:!0}})],aa.prototype,"theme",null),u([p({type:ZF.apiValues,json:{type:ZF.jsonValues,read:ZF.read,write:ZF.write}})],aa.prototype,"type",void 0),u([p({type:F_e,json:{type:F_e,write:!0}})],aa.prototype,"units",void 0),aa=JK=u([A("esri.renderers.support.AuthoringInfoVisualVariable")],aa);const NDt=aa;let k5=class extends ee{constructor(e){super(e),this.type=null}};u([p({readOnly:!0,json:{read:!1,write:!0}})],k5.prototype,"type",void 0),k5=u([A("esri.rest.support.ColorRamp")],k5);const Moe=k5;var XK;let k1=XK=class extends Moe{constructor(t){super(t),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new XK({fromColor:q(this.fromColor),toColor:q(this.toColor),algorithm:this.algorithm})}};u([Ue({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],k1.prototype,"algorithm",void 0),u([p({type:qe,json:{type:[Ei],write:!0}})],k1.prototype,"fromColor",void 0),u([p({type:qe,json:{type:[Ei],write:!0}})],k1.prototype,"toColor",void 0),u([p({type:["algorithmic"]})],k1.prototype,"type",void 0),k1=XK=u([A("esri.rest.support.AlgorithmicColorRamp")],k1);const Ooe=k1;var KK;let qI=KK=class extends Moe{constructor(t){super(t),this.colorRamps=null,this.type="multipart"}clone(){return new KK({colorRamps:q(this.colorRamps)})}};u([p({type:[Ooe],json:{write:!0}})],qI.prototype,"colorRamps",void 0),u([p({type:["multipart"]})],qI.prototype,"type",void 0),qI=KK=u([A("esri.rest.support.MultipartColorRamp")],qI);const F4e=qI,FDt={key:"type",base:Moe,typeMap:{algorithmic:Ooe,multipart:F4e}};function kDt(t){return t?.type?t.type==="algorithmic"?Ooe.fromJSON(t):t.type==="multipart"?F4e.fromJSON(t):null:null}var QK;const zw=new ei({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),YF=new ei({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),k_e=new ei({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),z_e=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers"],zDt=["high-to-low","above-and-below","above","below"],UDt=["flow-line","wave-front"],BDt=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let an=QK=class extends ee{constructor(t){super(t),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const t=this._get("classificationMethod"),e=this.type;return e&&e!=="relationship"?e==="class-breaks-size"||e==="class-breaks-color"?t||"manual":null:t}set classificationMethod(t){this._set("classificationMethod",t)}readColorRamp(t){return t?kDt(t):void 0}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(t){this._set("fields",t)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(t){this._set("field1",t)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(t){this._set("field2",t)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(t){this._set("flowTheme",t)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(t){this._set("focus",t)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(t){this._set("numClasses",t)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(t){this._set("statistics",t)}get standardDeviationInterval(){const t=this.type;return t&&t!=="relationship"&&t!=="class-breaks-size"&&t!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(t){this._set("standardDeviationInterval",t)}get type(){return this._get("type")}set type(t){let e=t;t==="classed-size"?e="class-breaks-size":t==="classed-color"&&(e="class-breaks-color"),this._set("type",e)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(t){this._set("univariateSymbolStyle",t)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(t){this._set("univariateTheme",t)}clone(){return new QK({classificationMethod:this.classificationMethod,colorRamp:q(this.colorRamp),fadeRatio:q(this.fadeRatio),fields:this.fields?.slice(),field1:q(this.field1),field2:q(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(t=>t.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};u([p({type:zw.apiValues,value:null,json:{type:zw.jsonValues,read:zw.read,write:zw.write,origins:{"web-document":{default:"manual",type:zw.jsonValues,read:zw.read,write:zw.write}}}})],an.prototype,"classificationMethod",null),u([p({types:FDt,json:{write:!0}})],an.prototype,"colorRamp",void 0),u([me("colorRamp")],an.prototype,"readColorRamp",null),u([p({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],an.prototype,"fadeRatio",void 0),u([p({type:[String],value:null,json:{write:!0}})],an.prototype,"fields",null),u([p({type:w_,value:null,json:{write:!0}})],an.prototype,"field1",null),u([p({type:w_,value:null,json:{write:!0}})],an.prototype,"field2",null),u([p({type:UDt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],an.prototype,"flowTheme",null),u([p({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],an.prototype,"focus",null),u([p({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],an.prototype,"isAutoGenerated",void 0),u([p({type:Number,value:null,json:{type:Ei,write:!0}})],an.prototype,"numClasses",null),u([p({type:z_e,json:{type:z_e,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],an.prototype,"lengthUnit",void 0),u([p({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],an.prototype,"maxSliderValue",void 0),u([p({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],an.prototype,"minSliderValue",void 0),u([p({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],an.prototype,"statistics",null),u([p({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],an.prototype,"standardDeviationInterval",null),u([p({type:YF.apiValues,value:null,json:{type:YF.jsonValues,read:YF.read,write:YF.write,origins:{"web-scene":{type:k_e.jsonValues,write:{writer:k_e.write,overridePolicy:t=>({enabled:t!=="flow"})}}}}})],an.prototype,"type",null),u([p({type:[NDt],json:{write:!0}})],an.prototype,"visualVariables",void 0),u([p({type:BDt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],an.prototype,"univariateSymbolStyle",null),u([p({type:zDt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],an.prototype,"univariateTheme",null),an=QK=u([A("esri.renderers.support.AuthoringInfo")],an);const Ioe=an,u9=new ei({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let WI=class extends ee{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const i=new Set;return await this.collectRequiredFields(i,e),Array.from(i).sort()}getSymbol(e,i){}async getSymbolAsync(e,i){}get symbols(){return[]}get arcadeRequired(){return!1}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};u([p({type:Ioe,json:{write:!0}})],WI.prototype,"authoringInfo",void 0),u([p({type:u9.apiValues,readOnly:!0,json:{type:u9.jsonValues,read:!1,write:{writer:u9.write,ignoreOrigin:!0,isRequired:!0}}})],WI.prototype,"type",void 0),WI=u([A("esri.renderers.Renderer")],WI);const zv=WI;let ZI=class extends Dt.ClonableMixin(ee){constructor(){super(...arguments),this.showLegend=null,this.title=null}};u([p({type:Boolean,json:{write:!0}})],ZI.prototype,"showLegend",void 0),u([p({type:String,json:{write:!0}})],ZI.prototype,"title",void 0),ZI=u([A("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],ZI);const k4e=ZI,h9=new ei({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let wp=class extends ee{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(J.getLogger(this).error(".field: field must be a string value"),null):H3(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};u([p()],wp.prototype,"index",void 0),u([p({type:h9.apiValues,readOnly:!0,json:{read:h9.read,write:{writer:h9.write,isRequired:!0}}})],wp.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],wp.prototype,"field",void 0),u([Yt("field")],wp.prototype,"castField",null),u([p({type:String,json:{write:!0}})],wp.prototype,"valueExpression",void 0),u([p({type:String,json:{write:!0}})],wp.prototype,"valueExpressionTitle",void 0),u([p({readOnly:!0})],wp.prototype,"arcadeRequired",null),u([p({type:k4e,json:{write:!0}})],wp.prototype,"legendOptions",void 0),wp=u([A("esri.renderers.visualVariables.VisualVariable")],wp);const GA=wp;var eQ;let z1=eQ=class extends ee{constructor(t){super(t),this.color=null,this.label=null,this.value=null}writeValue(t,e,i){e[i]=t??0}clone(){return new eQ({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};u([p({type:qe,json:{type:[Ei],write:{isRequired:!0}}})],z1.prototype,"color",void 0),u([p({type:String,json:{write:!0}})],z1.prototype,"label",void 0),u([p({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],z1.prototype,"value",void 0),u([ge("value")],z1.prototype,"writeValue",null),z1=eQ=u([A("esri.renderers.visualVariables.support.ColorStop")],z1);const VDt=z1;var tQ;let U1=tQ=class extends GA{constructor(t){super(t),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value),this._set("stops",t)}clone(){return new tQ({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([p({readOnly:!0})],U1.prototype,"cache",null),u([p({type:["color"],json:{type:["colorInfo"]}})],U1.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],U1.prototype,"normalizationField",void 0),u([p({type:[VDt],json:{write:!0}})],U1.prototype,"stops",null),U1=tQ=u([A("esri.renderers.visualVariables.ColorVariable")],U1);const z4e=U1;var iQ;let e_=iQ=class extends ee{constructor(t){super(t),this.label=null,this.opacity=null,this.value=null}readOpacity(t,e){return _$(e.transparency)}writeOpacity(t,e,i){e[i]=hD(t)}clone(){return new iQ({label:this.label,opacity:this.opacity,value:this.value})}};u([p({type:String,json:{write:!0}})],e_.prototype,"label",void 0),u([p({type:Number,json:{type:Ei,write:{target:"transparency",isRequired:!0}}})],e_.prototype,"opacity",void 0),u([me("opacity",["transparency"])],e_.prototype,"readOpacity",null),u([ge("opacity")],e_.prototype,"writeOpacity",null),u([p({type:Number,json:{write:{isRequired:!0}}})],e_.prototype,"value",void 0),e_=iQ=u([A("esri.renderers.visualVariables.support.OpacityStop")],e_);const jDt=e_;var rQ;let B1=rQ=class extends GA{constructor(t){super(t),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value),this._set("stops",t)}clone(){return new rQ({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([p({readOnly:!0})],B1.prototype,"cache",null),u([p({type:["opacity"],json:{type:["transparencyInfo"]}})],B1.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],B1.prototype,"normalizationField",void 0),u([p({type:[jDt],json:{write:!0}})],B1.prototype,"stops",null),B1=rQ=u([A("esri.renderers.visualVariables.OpacityVariable")],B1);const Roe=B1;var sQ;let V1=sQ=class extends GA{constructor(t){super(t),this.axis=null,this.type="rotation",this.rotationType="geographic"}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}clone(){return new sQ({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions?.clone()})}};u([p({readOnly:!0})],V1.prototype,"cache",null),u([p({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],V1.prototype,"axis",void 0),u([p({type:["rotation"],json:{type:["rotationInfo"]}})],V1.prototype,"type",void 0),u([p({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],V1.prototype,"rotationType",void 0),V1=sQ=u([A("esri.renderers.visualVariables.RotationVariable")],V1);const U4e=V1;function GDt(t){return sr(t)}var nQ;let t_=nQ=class extends ee{constructor(t){super(t),this.label=null,this.size=null,this.value=null,this.useMinValue=null,this.useMaxValue=null}clone(){return new nQ({label:this.label,size:this.size,value:this.value,useMaxValue:this.useMaxValue,useMinValue:this.useMinValue})}};u([p({type:String,json:{write:!0}})],t_.prototype,"label",void 0),u([p({type:Number,cast:sr,json:{write:{isRequired:!0}}})],t_.prototype,"size",void 0),u([p({type:Number,json:{write:{isRequired:!0}}})],t_.prototype,"value",void 0),u([p({type:Boolean,json:{write:!1}})],t_.prototype,"useMinValue",void 0),u([p({type:Boolean,json:{write:!1}})],t_.prototype,"useMaxValue",void 0),t_=nQ=u([A("esri.renderers.visualVariables.support.SizeStop")],t_);const z5=t_;let U5=class extends k4e{constructor(){super(...arguments),this.customValues=null}};u([p({type:[Number],json:{write:!0}})],U5.prototype,"customValues",void 0),U5=u([A("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],U5);const HDt=U5;var oQ;const JF=new ei({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),aQ=new ei({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers"});function U_e(t){if(t!=null)return typeof t=="string"||typeof t=="number"?GDt(t):t.type==="size"?V2(t)?t:(delete(t={...t}).type,new Pr(t)):void 0}function B_e(t,e,i){if(typeof t!="object")return t;const r=new Pr;return r.read(t,i),r}let Pr=oQ=class extends GA{constructor(t){super(t),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:this.valueExpression!=null&&AIe.test(this.valueExpression)}}set index(t){V2(this.maxSize)&&(this.maxSize.index=`visualVariables[${t}].maxSize`),V2(this.minSize)&&(this.minSize.index=`visualVariables[${t}].minSize`),this._set("index",t)}get inputValueType(){return CIe(this)}set maxDataValue(t){t&&this.stops&&(J.getLogger(this).warn("cannot set maxDataValue when stops is not null."),t=null),this._set("maxDataValue",t)}set maxSize(t){t&&this.stops&&(J.getLogger(this).warn("cannot set maxSize when stops is not null."),t=null),this._set("maxSize",t)}castMaxSize(t){return U_e(t)}readMaxSize(t,e,i){return B_e(t,e,i)}set minDataValue(t){t&&this.stops&&(J.getLogger(this).warn("cannot set minDataValue when stops is not null."),t=null),this._set("minDataValue",t)}set minSize(t){t&&this.stops&&(J.getLogger(this).warn("cannot set minSize when stops is not null."),t=null),this._set("minSize",t)}castMinSize(t){return U_e(t)}readMinSize(t,e,i){return B_e(t,e,i)}get arcadeRequired(){return!!this.valueExpression||this.minSize!=null&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize!=null&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(t){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value):t&&(J.getLogger(this).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),t=null),this._set("stops",t)}get transformationType(){return Llt(this,this.inputValueType)}readValueExpression(t,e){return t||e.expression&&"$view.scale"}writeValueExpressionWebScene(t,e,i,r){if(t==="$view.scale"){if(r?.messages){const s=this.index,n=typeof s=="string"?s:`visualVariables[${s}]`;r.messages.push(new U("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpression",context:r}))}}else e[i]=t}readValueUnit(t){return t?aQ.read(t):null}clone(){return new oQ({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:V2(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:V2(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops?.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions?.clone()})}flipSizes(){if(this.transformationType===Ho.ClampedLinear){const{minSize:t,maxSize:e}=this;return this.minSize=e,this.maxSize=t,this}if(this.transformationType===Ho.Stops){const t=this.stops;if(!t)return this;const e=t.map(r=>r.size).reverse(),i=t.length;for(let r=0;r<i;r++)t[r].size=e[r];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops?.map(t=>t.value||0)}};u([p({readOnly:!0})],Pr.prototype,"cache",null),u([p({type:JF.apiValues,json:{type:JF.jsonValues,origins:{"web-map":{read:!1}},read:JF.read,write:JF.write}})],Pr.prototype,"axis",void 0),u([p()],Pr.prototype,"index",null),u([p({type:String,readOnly:!0})],Pr.prototype,"inputValueType",null),u([p({type:HDt,json:{write:!0}})],Pr.prototype,"legendOptions",void 0),u([p({type:Number,value:null,json:{write:!0}})],Pr.prototype,"maxDataValue",null),u([p({type:Number,value:null,json:{write:!0}})],Pr.prototype,"maxSize",null),u([Yt("maxSize")],Pr.prototype,"castMaxSize",null),u([me("maxSize")],Pr.prototype,"readMaxSize",null),u([p({type:Number,value:null,json:{write:!0}})],Pr.prototype,"minDataValue",null),u([p({type:Number,value:null,json:{write:!0}})],Pr.prototype,"minSize",null),u([Yt("minSize")],Pr.prototype,"castMinSize",null),u([me("minSize")],Pr.prototype,"readMinSize",null),u([p({type:String,json:{write:!0}})],Pr.prototype,"normalizationField",void 0),u([p({readOnly:!0})],Pr.prototype,"arcadeRequired",null),u([p({type:String})],Pr.prototype,"scaleBy",void 0),u([p({type:[z5],value:null,json:{write:!0}})],Pr.prototype,"stops",null),u([p({type:["outline"],json:{write:!0}})],Pr.prototype,"target",void 0),u([p({type:String,readOnly:!0})],Pr.prototype,"transformationType",null),u([p({type:["size"],json:{type:["sizeInfo"]}})],Pr.prototype,"type",void 0),u([p({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],Pr.prototype,"useSymbolValue",void 0),u([p({type:String,json:{write:!0}})],Pr.prototype,"valueExpression",void 0),u([me("valueExpression",["valueExpression","expression"])],Pr.prototype,"readValueExpression",null),u([ge("web-scene","valueExpression")],Pr.prototype,"writeValueExpressionWebScene",null),u([p({type:["radius","diameter","area","width","distance"],json:{write:!0}})],Pr.prototype,"valueRepresentation",void 0),u([p({type:aQ.apiValues,json:{write:aQ.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],Pr.prototype,"valueUnit",void 0),u([me("valueUnit")],Pr.prototype,"readValueUnit",null),Pr=oQ=u([A("esri.renderers.visualVariables.SizeVariable")],Pr);const LG=Pr,qDt={color:z4e,size:LG,opacity:Roe,rotation:U4e},WDt=new ei({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),ZDt=/^\[([^\]]+)\]$/i;let B5=class extends ue{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),e=e?.filter(i=>!!i),e?.length){for(const i of e)switch(i.type){case"color":this.colorVariables.push(i);break;case"opacity":this.opacityVariables.push(i);break;case"rotation":this.rotationVariables.push(i);break;case"size":this.sizeVariables.push(i)}this.sizeVariables.length&&this.sizeVariables.some(i=>!!i.target)&&e.sort((i,r)=>{let s=null;return s=i.target===r.target?0:i.target?1:-1,s});for(let i=0;i<e.length;i++)e[i].index=i;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,i,r){const{rotationExpression:s,rotationType:n}=i,o=s?.match(ZDt),a=o?.[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:n,field:a})),e)return e.map(l=>{const c=WDt.read(l.type),h=qDt[c];h||(J.getLogger(this).warn(`Unknown variable type: ${c}`),r?.messages&&r.messages.push(new sh("visual-variable:unsupported",`visualVariable of type '${c}' is not supported`,{definition:l,context:r})));const d=new h;return d.read(l,r),d})}writeVariables(e,i){const r=[];for(const s of e){const n=s.toJSON(i);n&&r.push(n)}return r}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};u([p()],B5.prototype,"visualVariables",null),B5=u([A("esri.renderers.visualVariables.VisualVariableFactory")],B5);const YDt=B5,JDt={base:GA,key:"type",typeMap:{opacity:Roe,color:z4e,rotation:U4e,size:LG}},HA=t=>{let e=class extends t{constructor(){super(...arguments),this._vvFactory=new YDt}set visualVariables(i){this._vvFactory.visualVariables=i,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(i,r,s){return this._vvFactory.readVariables(i,r,s)}writeVisualVariables(i,r,s,n){r[s]=this._vvFactory.writeVariables(i,n)}get arcadeRequiredForVisualVariables(){return this.visualVariables?.some(({arcadeRequired:i})=>i)??!1}hasVisualVariables(i,r){return i?this.getVisualVariablesForType(i,r).length>0:this.getVisualVariablesForType("size",r).length>0||this.getVisualVariablesForType("color",r).length>0||this.getVisualVariablesForType("opacity",r).length>0||this.getVisualVariablesForType("rotation",r).length>0}getVisualVariablesForType(i,r){return this.visualVariables?.filter(s=>s.type===i&&(typeof r=="string"?s.target===r:r!==!1||!s.target))??[]}async collectVVRequiredFields(i,r){let s=[];this.visualVariables&&(s=s.concat(this.visualVariables));for(const n of s)n&&(n.field&&cc(i,r,n.field),n.normalizationField&&cc(i,r,n.normalizationField),n.valueExpression&&(XDt(n.valueExpression,i,r)||await Al(i,r,n.valueExpression)))}};return u([p({types:[JDt],value:null,json:{write:!0}})],e.prototype,"visualVariables",null),u([me("visualVariables",["visualVariables","rotationType","rotationExpression"])],e.prototype,"readVisualVariables",null),u([ge("visualVariables")],e.prototype,"writeVisualVariables",null),e=u([A("esri.renderers.mixins.VisualVariablesMixin")],e),e};function XDt(t,e,i){const r=zYe(t);return r!=null&&(cc(e,i,r),!0)}const Poe=[252,146,31,255],KDt=[153,153,153,255],QDt={type:"esriSMS",style:"esriSMSCircle",size:6,color:Poe,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},eLt={type:"esriSLS",style:"esriSLSSolid",width:.75,color:Poe},tLt={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},iLt={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},rLt={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},sLt={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},nLt={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},OB=ug.fromJSON(QDt),Doe=uh.fromJSON(eLt),B4e=NS.fromJSON(tLt),oLt=AA.fromJSON(iLt);function mdi(t){if(t==null)return null;switch(t.type){case"mesh":return null;case"point":case"multipoint":return OB;case"polyline":return Doe;case"polygon":case"extent":return B4e}return null}const gdi=ug.fromJSON(rLt),ydi=uh.fromJSON(sLt),vdi=NS.fromJSON(nLt),aLt=Sm.fromSimpleMarkerSymbol(OB),lLt=LS.fromSimpleLineSymbol(Doe),cLt=Hb.fromSimpleFillSymbol(B4e),uLt=new mD({symbolLayers:new Ee([new PS({material:{color:Poe},edges:new ICe({size:$d(1),color:new qe(KDt)})})])}),hLt=new LS({symbolLayers:new Ee([new $A({material:{color:new qe([0,0,0])},size:$d(1)})])}),dLt=new Hb({symbolLayers:new Ee([new PS({outline:{color:new qe([0,0,0]),size:$d(1)}})])});function _di(t){if(t==null)return null;switch(t.type){case"mesh":return uLt;case"point":case"multipoint":return aLt;case"polyline":return lLt;case"polygon":case"extent":return cLt}return null}const V_e="#useCIMFallbackSymbology()",tE={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function pLt(t,e=tE){if(!t)return{symbol:null};const{retainId:i=tE.retainId,ignoreDrivers:r=tE.ignoreDrivers,hasLabelingContext:s=tE.hasLabelingContext,retainCIM:n=tE.retainCIM,cimFallbackEnabled:o=tE.cimFallbackEnabled}=e;let a=null;if(p$e(t)||t instanceof Cb)a=t.clone();else if(t.type==="cim"){const l=t.data?.symbol?.type;switch(l){case"CIMPointSymbol":a=n?t.clone():Sm.fromCIMSymbol(t);break;case"CIMLineSymbol":o&&(a=hLt.clone(),e?.logWarning?.(V_e,"Unsupported CIM line symbology converted to fallback 3D line symbology"));break;case"CIMPolygonSymbol":o&&(a=dLt.clone(),e?.logWarning?.(V_e,"Unsupported CIM polygon symbology converted to fallback 3D polygon symbology"))}if(!a)return{error:new U("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${l||"unknown"}' is unsupported in 3D`,{symbol:t})}}else if(t instanceof uh)a=LS.fromSimpleLineSymbol(t);else if(t instanceof ug)a=Sm.fromSimpleMarkerSymbol(t);else if(t instanceof gD)a=Sm.fromPictureMarkerSymbol(t);else if(t instanceof NS)a=e.geometryType&&e.geometryType==="mesh"?mD.fromSimpleFillSymbol(t):Hb.fromSimpleFillSymbol(t);else{if(!(t instanceof AA))return{error:new U("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};a=s?ej.fromTextSymbol(t):Sm.fromTextSymbol(t)}return i&&a&&a.type!=="cim"&&(a.id=t.id),!r||a.type==="cim"||a instanceof Cb||a.symbolLayers.forEach(l=>l.ignoreDrivers=!0),{symbol:a}}function IB(t,e,i,r){const s=V4e(t,{},{context:r,isLabelSymbol:!1});s!=null&&(e[i]=s)}function j_e(t,e,i,r){const s=V4e(t,{},{context:r,isLabelSymbol:!0});s!=null&&(e[i]=s)}function G_e(t){return p$e(t)||t instanceof Cb}function fLt(t){return t?.type==="polygon-3d"||t?.type==="line-3d"}function V4e(t,e,i){if(t==null)return null;const{context:r,isLabelSymbol:s}=i,n=r?.origin,o=r?.messages;if(n==="web-scene"&&!G_e(t)){const a=pLt(t,{retainCIM:!0,hasLabelingContext:s});return a.symbol!=null?a.symbol.write(e,r):(o?.push(new U("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:r,error:a.error})),null)}return yW(r?.layer)&&fLt(t)?(o?.push(new U("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported on layers of type '${r?.layer?.declaredClass}'.`,{symbol:t,context:r})),null):(n==="web-map"||n==="portal-item"&&!yW(r?.layer))&&G_e(t)?(o?.push(new U("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:r})),null):t.write(e,r)}function bdi(t,e){return BXe(t,null,e)}const NG={types:f$e,json:{write:{writer:IB},origins:{"web-scene":{types:Iue,write:{writer:IB},read:{reader:dA({types:Iue})}}}}},Loe=Cee({json:{origins:{"web-scene":{write:{isRequired:!0}}}}},NG),Noe={types:{base:Xa,key:"type",typeMap:{"simple-fill":H_.typeMap["simple-fill"],"picture-fill":H_.typeMap["picture-fill"],"polygon-3d":H_.typeMap["polygon-3d"],cim:H_.typeMap.cim}},json:{write:{writer:IB},origins:{"web-scene":{type:Hb,write:{writer:IB}}}}},V5={cast:t=>t==null||typeof t=="string"||typeof t=="number"?t:`${t}`,json:{type:String,write:{writer:(t,e)=>{e.value=t?.toString()}}}};var lQ;let j1=lQ=class extends HA(zv){constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(t,e){await Promise.all([this.collectSymbolFields(t,e),this.collectVVRequiredFields(t,e)])}async collectSymbolFields(t,e){await Promise.all(this.symbols.map(i=>i.collectRequiredFields(t,e)))}getSymbol(t,e){return this.symbol}async getSymbolAsync(t,e){return this.symbol}get symbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables?.reduce((t,e)=>t+e.getAttributeHash(),"")??""}getMeshHash(){return this.symbols.reduce((t,e)=>t+JSON.stringify(e),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new lQ({description:this.description,label:this.label,symbol:q(this.symbol),visualVariables:q(this.visualVariables),authoringInfo:q(this.authoringInfo)})}};u([p({type:String,json:{write:!0}})],j1.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],j1.prototype,"label",void 0),u([p(Loe)],j1.prototype,"symbol",void 0),u([Ue({simple:"simple"})],j1.prototype,"type",void 0),j1=lQ=u([A("esri.renderers.SimpleRenderer")],j1);const ev=j1,mLt=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function cQ(t){return t instanceof ue}function H_e(t){return t instanceof Ee?Object.keys(t.items):cQ(t)?El(t).keys():t?Object.keys(t):[]}function XF(t,e){return t instanceof Ee?t.items[e]:t[e]}function gLt(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.length!==e.length}function eP(t){return t?t.declaredClass:null}function j4e(t,e){const i=t.diff;if(i&&typeof i=="function")return i(t,e);const r=H_e(t),s=H_e(e);if(r.length===0&&s.length===0)return;if(!r.length||!s.length||gLt(t,e))return{type:"complete",oldValue:t,newValue:e};const n=s.filter(d=>!r.includes(d)),o=r.filter(d=>!s.includes(d)),a=r.filter(d=>s.includes(d)&&XF(t,d)!==XF(e,d)).concat(n,o).sort(),l=eP(t);if(l&&mLt.has(l)&&a.length)return{type:"complete",oldValue:t,newValue:e};let c;const h=cQ(t)&&cQ(e);for(const d of a){const f=XF(t,d),m=XF(e,d);let y;if((h||typeof f!="function"&&typeof m!="function")&&f!==m&&(f!=null||m!=null)){if(i&&i[d]&&typeof i[d]=="function")y=i[d]?.(f,m);else if(f instanceof Date&&m instanceof Date){if(f.getTime()===m.getTime())continue;y={type:"complete",oldValue:f,newValue:m}}else y=typeof f=="object"&&typeof m=="object"&&eP(f)===eP(m)?j4e(f,m):{type:"complete",oldValue:f,newValue:m};y!=null&&(c!=null?c.diff[d]=y:c={type:"partial",diff:{[d]:y}})}}return c}function wdi(t,e){return yLt(t,e)}function yLt(t,e){if(t==null)return!1;const i=e.split(".");let r=t;for(const s of i){if(r.type==="complete")return!0;if(r.type!=="partial")return!1;{const n=r.diff[s];if(!n)return!1;r=n}}return!0}function xdi(t,e){if(!t)return!1;if(t.type==="partial"){const i=Object.keys(t.diff);return i.length===1&&i[0]===e}return!1}function vLt(t,e){if(typeof t!="function"&&typeof e!="function"&&(t!=null||e!=null))return t==null||e==null||typeof t=="object"&&typeof e=="object"&&eP(t)!==eP(e)?{type:"complete",oldValue:t,newValue:e}:j4e(t,e)}function KF(t){if(t==null)return!0;switch(t.type){case"complete":return!1;case"collection":{const e=t;for(const i of e.added)if(!KF(i))return!1;for(const i of e.removed)if(!KF(i))return!1;for(const i of e.changed)if(!KF(i))return!1;return!0}case"partial":for(const e in t.diff)if(!KF(t.diff[e]))return!1;return!0}}var uQ;const _Lt=Mo()({ascendingValues:"ascending-values",descendingValues:"descending-values"});let YI=uQ=class extends Dt.ClonableMixin(ee){static from(t){return uA(uQ,t)}constructor(t){super(t),this.title=null,this.order=null}};u([p({type:String,json:{write:!0}})],YI.prototype,"title",void 0),u([Ue(_Lt)],YI.prototype,"order",void 0),YI=uQ=u([A("esri.renderers.support.RendererLegendOptions")],YI);const Foe=YI;let m2=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};u([p(V5)],m2.prototype,"value",void 0),u([p(V5)],m2.prototype,"value2",void 0),u([p(V5)],m2.prototype,"value3",void 0),m2=u([A("esri.renderers.support.UniqueValue")],m2);const qC=m2;let i_=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(e==null)return null;const i=typeof(e=Array.isArray(e)?e:[e])[0];return i==="string"||i==="number"?e.map(r=>new qC({value:r})):i==="object"?e[0]instanceof qC?e:e.map(r=>new qC(r)):null}};u([p({type:String,json:{write:!0}})],i_.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],i_.prototype,"label",void 0),u([p(NG)],i_.prototype,"symbol",void 0),u([p({type:[qC],json:{type:[[String]],read:{reader:t=>t?t.map(e=>new qC({value:e[0],value2:e[1],value3:e[2]})):null},write:{writer:(t,e)=>{const i=[];for(const r of t){const s=[r.value,r.value2,r.value3].filter(of).map(n=>n.toString());i.push(s)}e.values=i}}}})],i_.prototype,"values",void 0),u([Yt("values")],i_.prototype,"castValues",null),i_=u([A("esri.renderers.support.UniqueValueClass")],i_);const G4e=i_;let JI=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.heading=null,this.classes=null}};u([p({type:String,json:{write:!0}})],JI.prototype,"heading",void 0),u([p({type:[G4e],json:{write:{isRequired:!0}}})],JI.prototype,"classes",void 0),JI=u([A("esri.renderers.support.UniqueValueGroup")],JI);const hQ=JI;var dQ;let G1=dQ=class extends ee{constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new dQ({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol?.toJSON());return`${this.value}.${t}`}};u([p({type:String,json:{write:!0}})],G1.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],G1.prototype,"label",void 0),u([p(Loe)],G1.prototype,"symbol",void 0),u([p(V5)],G1.prototype,"value",void 0),G1=dQ=u([A("esri.renderers.support.UniqueValueInfo")],G1);const tP=G1,q_e=new Map;async function bLt(t,e){try{return{data:(await TLt(t,e)).data,baseUrl:dGe(t),styleUrl:t}}catch(i){return Vc(i),null}}function wLt(t,e,i){const r=e.portal!=null?e.portal:fn.getDefault();let s;const n=`${r.url} - ${r.user?.username} - ${t}`,o=q_e.get(n);if(o)return o;const a=xLt(t,r,i).then(l=>(s=l,l.fetchData())).then(l=>({data:l,baseUrl:s.itemUrl??"",styleName:t}));return q_e.set(n,a),a}function xLt(t,e,i){return e.load(i).then(()=>{const r=new Vp({disableExtraQuery:!0,query:`owner:${W_e} AND type:${Z_e} AND typekeywords:"${t}"`});return e.queryItems(r,i)}).then(({results:r})=>{let s=null;const n=t.toLowerCase();if(r&&Array.isArray(r)){for(const o of r)if(o.typeKeywords?.some(l=>l.toLowerCase()===n)&&o.type===Z_e&&o.owner===W_e){s=o;break}}if(!s)throw new U("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return s.load(i)})}function SLt(t,e,i){return t?.styleUrl!=null?bLt(t.styleUrl,i):t?.styleName!=null?wLt(t.styleName,e,i):Promise.reject(new U("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function Cdi(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function $di(t,e){for(const i of e)switch(i){case"cim":if(t.cimRef)return{format:i,url:encodeURI(t.cimRef)};break;case"web-gltf-basisu":{const r=d9(t,"gltf_basisu");if(r)return{format:i,url:r};break}case"web-gltf":{const r=d9(t,"gltf");if(r)return{format:i,url:r};break}case"web":{const r=d9(t,"gltf");if(r)return{format:"web-gltf",url:r};if(t.webRef)return{format:i,url:encodeURI(t.webRef)};break}}}function d9(t,e){if(!X("enable-feature:force-wosr"))return t.formatInfos?.find(i=>i.type===e)?.href}function TLt(t,e){const i={responseType:"json",query:{f:"json"},...e};return Ci(bd(t),i)}const W_e="esri_en",Z_e="Style",Adi="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";var XI;const H4e="esri.renderers.UniqueValueRenderer",b0=()=>J.getLogger(H4e),Y_e="uvInfos-watcher",J_e="uvGroups-watcher",ELt=",",CLt=Is(tP);function $Lt(t){const{field1:e,field2:i,field3:r,fieldDelimiter:s,uniqueValueInfos:n,valueExpression:o}=t,a=!(!e||!i);return[{classes:(n??[]).map(l=>{const{symbol:c,label:h,value:d,description:f}=l,[m,y,v]=a?d?.toString()?.split(s||"")||[]:[d],_=[];return(e||o)&&_.push(m),i&&_.push(y),r&&_.push(v),{symbol:c,label:h,values:[_],description:f}})}]}function iE(t){return t!=null&&t!==""&&(typeof t!="string"||t.trim()!==""&&t.toLowerCase()!=="<null>")||(t=null),t+""}let zs=XI=class extends HA(zv){constructor(t){super(t),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,i){if(!e&&!i)return;if(!e||!i)return{type:"complete",oldValue:e,newValue:i};let r=!1;const s={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<i.length;n++){const o=e.find(a=>a.value===i[n].value);o?vLt(o,i[n])?(s.changed.push({type:"complete",oldValue:o,newValue:i[n]}),r=!0):s.unchanged.push({oldValue:o,newValue:i[n]}):(s.added.push(i[n]),r=!0)}for(let n=0;n<e.length;n++)i.find(o=>o.value===e[n].value)||(s.removed.push(e[n]),r=!0);return r?s:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(t){this._set("field",t),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(t){return t==null||typeof t=="function"?t:H3(t)}writeField(t,e,i,r){typeof t=="string"?e[i]=t:r?.messages?r.messages.push(new U("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):b0().error(".field: cannot write field to JSON since it's not a string value")}set field2(t){this._set("field2",t),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(t){this._set("field3",t),this._updateUniqueValues()}set valueExpression(t){this._set("valueExpression",t),this._updateUniqueValues()}set defaultSymbol(t){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",t)}set fieldDelimiter(t){this._set("fieldDelimiter",t),this._updateUniqueValues()}readPortal(t,e,i){return i.portal||fn.getDefault()}readStyleOrigin(t,e,i){if(e.styleName)return Object.freeze({styleName:e.styleName});if(e.styleUrl){const r=yA(e.styleUrl,i);return Object.freeze({styleUrl:r})}}writeStyleOrigin(t,e,i,r){t.styleName?e.styleName=t.styleName:t.styleUrl&&(e.styleUrl=K3(t.styleUrl,r))}set uniqueValueGroups(t){this.styleOrigin?b0().error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",t),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(t){this.styleOrigin?b0().error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(t,e){if(this.styleOrigin)return void b0().error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let i;i=typeof t=="object"?CLt(t):new tP({value:t,symbol:m$e(e)}),this.uniqueValueInfos?.push(i),this._valueInfoMap[iE(i.value)]=i,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(t){if(this.styleOrigin)return void b0().error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const e=this.uniqueValueInfos;if(e)for(let i=0;i<e.length;i++){const r=e[i];if(String(r.value)===String(t)){delete this._valueInfoMap[iE(t)],e.splice(i,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(t,e){let i=e;return this.valueExpression&&e?.arcade==null&&(i={...i,arcade:await av()}),this._getUniqueValueInfo(t,i)}getSymbol(t,e){return this.valueExpression&&e?.arcade==null?void b0().error("#getSymbol()","Please use getSymbolAsync if valueExpression is used"):this._getUniqueValueInfo(t,e)?.symbol||this.defaultSymbol}async getSymbolAsync(t,e){let i=e;if(this.valueExpression&&i?.arcade==null){const s=await av(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i={...i,arcade:s}}return this._getUniqueValueInfo(t,i)?.symbol||this.defaultSymbol}get symbols(){const t=[];for(const e of this.uniqueValueInfos??[])e.symbol&&t.push(e.symbol);return this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables?.reduce((t,e)=>t+e.getAttributeHash(),"")??""}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),i=this.uniqueValueInfos?.reduce((r,s)=>r+s.getMeshHash(),"");return`${t}.${e}.${i}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const t=new XI({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:q(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:q(this.visualVariables),legendOptions:q(this.legendOptions),authoringInfo:q(this.authoringInfo),backgroundFillSymbol:q(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(t._isDefaultSymbolDerived=!0),t._set("portal",this.portal);const e=q(this.uniqueValueInfos),i=q(this.uniqueValueGroups);return this.styleOrigin&&(t._set("styleOrigin",Object.freeze(q(this.styleOrigin))),Object.freeze(e),Object.freeze(i)),t._set("uniqueValueInfos",e),t._updateValueInfoMap(),t._set("uniqueValueGroups",i),t._isInfosSource=this._isInfosSource,t._watchUniqueValueInfosAndGroups(),t}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(t,e){const i=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(i)}async collectSymbolFields(t,e){const i=[...this.symbols.map(r=>r.collectRequiredFields(t,e)),Al(t,e,this.valueExpression)];cc(t,e,this.field),cc(t,e,this.field2),cc(t,e,this.field3),await Promise.all(i)}populateFromStyle(){return SLt(this.styleOrigin,{portal:this.portal}).then(t=>{const e=[];return this._valueInfoMap={},t?.data&&Array.isArray(t.data.items)&&t.data.items.forEach(i=>{const r=new Cb({styleUrl:t.styleUrl,styleName:t.styleName,portal:this.portal,name:i.name});this.defaultSymbol||i.name!==t.data.defaultItem||(this.defaultSymbol=r,this._isDefaultSymbolDerived=!0);const s=new tP({value:i.name,symbol:r});e.push(s),this._valueInfoMap[iE(i.name)]=s}),this._set("uniqueValueInfos",Object.freeze(e)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&this.uniqueValueInfos?.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",ELt)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:t}=this;if(t)for(const e of t)this._valueInfoMap[iE(e.value)]=e}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(Y_e);const{uniqueValueInfos:t}=this;if(t){const e=[];for(const i of t)e.push(H(()=>({symbol:i.symbol,value:i.value,label:i.label,description:i.description}),(r,s)=>{r!==s&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(e,Y_e)}}_watchUniqueValueGroups(){this.removeHandles(J_e);const{uniqueValueGroups:t}=this;if(t){const e=[];for(const i of t){e.push(H(()=>({classes:i.classes}),(r,s)=>{r!==s&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const r of i.classes??[])e.push(H(()=>({symbol:r.symbol,values:r.values,label:r.label,description:r.description}),(s,n)=>{s!==n&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(e,J_e)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const t=[],{field:e,field2:i,field3:r,fieldDelimiter:s,uniqueValueGroups:n,valueExpression:o}=this;if(!e&&!o)return this._set("uniqueValueInfos",t),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!e||!i);for(const l of n)for(const c of l.classes??[]){const{symbol:h,label:d,values:f,description:m}=c;for(const y of f??[]){const{value:v,value2:_,value3:b}=y,w=[v];i&&w.push(_),r&&w.push(b);const x=a?w.join(s||""):w[0]??void 0;t.push(new tP({symbol:h,label:d,value:x,description:m}))}}this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(t=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:e,field2:i,valueExpression:r,fieldDelimiter:s,uniqueValueInfos:n}=this;if(!e&&!r||!n.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!e||!i),a=n.map(c=>{const{symbol:h,label:d,value:f,description:m}=c,[y,v,_]=o?f?.toString()?.split(s||"")||[]:[f];return new G4e({symbol:h,label:d,description:m,values:[new qC({value:y,value2:v,value3:_})]})}),l=[new hQ({classes:a})];t&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(t,e){return this.valueExpression?this._getUnqiueValueInfoForExpression(t,e):this._getUnqiueValueInfoForFields(t)}_getUnqiueValueInfoForExpression(t,e){const{viewingMode:i,scale:r,spatialReference:s,arcade:n,timeZone:o}=e??{};let a=this._cache.compiledFunc;const l=n.arcadeUtils;if(!a){const h=l.createSyntaxTree(this.valueExpression);a=l.createFunction(h),this._cache.compiledFunc=a}const c=l.executeFunction(a,l.createExecContext(t,l.getViewInfo({viewingMode:i,scale:r,spatialReference:s}),o));return this._valueInfoMap[iE(c)]}_getUnqiueValueInfoForFields(t){const e=this.field,i=t.attributes;let r;if(this.field2){const s=this.field2,n=this.field3,o=[];e&&o.push(i[e]),s&&o.push(i[s]),n&&o.push(i[n]),r=o.join(this.fieldDelimiter||"")}else e&&(r=i[e]);return this._valueInfoMap[iE(r)]}static fromPortalStyle(t,e){const i=new XI(e?.properties);i._set("styleOrigin",Object.freeze({styleName:t})),i._set("portal",e?.portal||fn.getDefault());const r=i.populateFromStyle();return r.catch(s=>{b0().error(`#fromPortalStyle('${t}'[, ...])`,"Failed to create unique value renderer from style name",s)}),r}static fromStyleUrl(t,e){const i=new XI(e?.properties);i._set("styleOrigin",Object.freeze({styleUrl:t}));const r=i.populateFromStyle();return r.catch(s=>{b0().error(`#fromStyleUrl('${t}'[, ...])`,"Failed to create unique value renderer from style URL",s)}),r}};u([p({readOnly:!0})],zs.prototype,"_cache",null),u([Ue({uniqueValue:"unique-value"})],zs.prototype,"type",void 0),u([p(Noe)],zs.prototype,"backgroundFillSymbol",void 0),u([p({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],zs.prototype,"field",null),u([Yt("field")],zs.prototype,"castField",null),u([ge("field")],zs.prototype,"writeField",null),u([p({type:String,value:null,json:{write:!0}})],zs.prototype,"field2",null),u([p({type:String,value:null,json:{write:!0}})],zs.prototype,"field3",null),u([p({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],zs.prototype,"orderByClassesEnabled",void 0),u([p({type:String,value:null,json:{write:!0}})],zs.prototype,"valueExpression",null),u([p({type:String,json:{write:!0}})],zs.prototype,"valueExpressionTitle",void 0),u([p({type:Foe,json:{write:!0}})],zs.prototype,"legendOptions",void 0),u([p({type:String,json:{write:!0}})],zs.prototype,"defaultLabel",void 0),u([p(Cee({...NG},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],zs.prototype,"defaultSymbol",null),u([p({type:String,value:null,json:{write:!0}})],zs.prototype,"fieldDelimiter",null),u([p({type:fn,readOnly:!0})],zs.prototype,"portal",void 0),u([me("portal",["styleName"])],zs.prototype,"readPortal",null),u([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],zs.prototype,"styleOrigin",void 0),u([me("styleOrigin",["styleName","styleUrl"])],zs.prototype,"readStyleOrigin",null),u([ge("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],zs.prototype,"writeStyleOrigin",null),u([p({type:[hQ],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(t,e,i)=>(e.uniqueValueGroups||$Lt(e)).map(r=>hQ.fromJSON(r,i))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],zs.prototype,"uniqueValueGroups",null),u([p({type:[tP],json:{read:!1,write:{isRequired:!0,overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0,isRequired:!0}}}}})],zs.prototype,"uniqueValueInfos",null),zs=XI=u([A(H4e)],zs);const koe=zs;var pQ;let ko=pQ=class extends ee{constructor(t){super(t),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.orderByFields=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new pQ(q({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};u([p({type:[String],json:{write:!0}})],ko.prototype,"attachmentTypes",void 0),u([p({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],ko.prototype,"attachmentsWhere",void 0),u([p({type:Boolean,json:{write:!0}})],ko.prototype,"cacheHint",void 0),u([p({type:[String],json:{write:!0}})],ko.prototype,"keywords",void 0),u([p({type:[String],json:{write:!0}})],ko.prototype,"globalIds",void 0),u([p({json:{write:!0}})],ko.prototype,"name",void 0),u([p({type:Number,json:{read:{source:"resultRecordCount"}}})],ko.prototype,"num",void 0),u([p({type:[Number],json:{write:!0}})],ko.prototype,"objectIds",void 0),u([p({type:[String],json:{write:!0}})],ko.prototype,"orderByFields",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],ko.prototype,"returnMetadata",void 0),u([p({type:[Number],json:{write:!0}})],ko.prototype,"size",void 0),u([p({type:Number,json:{read:{source:"resultOffset"}}})],ko.prototype,"start",void 0),u([ge("start"),ge("num")],ko.prototype,"writeStart",null),u([p({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],ko.prototype,"where",void 0),ko=pQ=u([A("esri.rest.support.AttachmentQuery")],ko),ko.from=Is(ko);const ALt=ko,q4e=Mo()({naturalLog:"natural-log",squareRoot:"square-root",percentOfTotal:"percent-of-total",log:"log",field:"field"}),X_e="percent-of-total",K_e="field",Mdi=t=>{let e=class extends t{constructor(){super(...arguments),this.normalizationField=null,this.normalizationMaxValue=null,this.normalizationMinValue=null,this.normalizationTotal=null}get normalizationType(){let i=this._get("normalizationType");const r=!!this.normalizationField,s=this.normalizationTotal!=null;return r||s?(i=r&&K_e||s&&X_e||null,r&&s&&J.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):i!==K_e&&i!==X_e||(i=null),i}set normalizationType(i){this._set("normalizationType",i)}};return u([p({type:String,json:{name:"parameters.normalizationField",write:!0}})],e.prototype,"normalizationField",void 0),u([p({type:Number,json:{name:"parameters.normalizationMaxValue",write:!0}})],e.prototype,"normalizationMaxValue",void 0),u([p({type:Number,json:{name:"parameters.normalizationMinValue",write:!0}})],e.prototype,"normalizationMinValue",void 0),u([p({type:Number,json:{name:"parameters.normalizationTotal",write:!0}})],e.prototype,"normalizationTotal",void 0),u([Ue(q4e,{name:"parameters.normalizationType"})],e.prototype,"normalizationType",null),e=u([A("esri.rest.support.NormalizationBinParametersMixin")],e),e};var fQ;let Ks=fQ=class extends ee{constructor(t){super(t),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(e.definitionExpression="1=1")}clone(){return new fQ(q({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};u([p({type:Boolean,json:{write:!0}})],Ks.prototype,"cacheHint",void 0),u([p({type:Mp,json:{write:!0}})],Ks.prototype,"dynamicDataSource",void 0),u([p({type:String,json:{write:!0}})],Ks.prototype,"gdbVersion",void 0),u([p({type:Number,json:{write:!0}})],Ks.prototype,"geometryPrecision",void 0),u([p({type:Date})],Ks.prototype,"historicMoment",void 0),u([ge("historicMoment")],Ks.prototype,"_writeHistoricMoment",null),u([p({type:Number,json:{write:!0}})],Ks.prototype,"maxAllowableOffset",void 0),u([p({json:{write:!0}})],Ks.prototype,"objectIds",void 0),u([p({type:[String],json:{write:!0}})],Ks.prototype,"orderByFields",void 0),u([p({type:[String],json:{write:!0}})],Ks.prototype,"outFields",void 0),u([p({type:Ae,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Ks.prototype,"outSpatialReference",void 0),u([p({json:{write:!0}})],Ks.prototype,"relationshipId",void 0),u([p({type:Number,json:{read:{source:"resultOffset"}}})],Ks.prototype,"start",void 0),u([ge("start"),ge("num")],Ks.prototype,"writeStart",null),u([p({type:Number,json:{read:{source:"resultRecordCount"}}})],Ks.prototype,"num",void 0),u([p({json:{write:!0}})],Ks.prototype,"returnGeometry",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ks.prototype,"returnM",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ks.prototype,"returnZ",void 0),u([p({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Ks.prototype,"where",void 0),Ks=fQ=u([A("esri.rest.support.RelationshipQuery")],Ks),Ks.from=Is(Ks);const zoe=Ks,Odi=Object.freeze(Object.defineProperty({__proto__:null,default:zoe},Symbol.toStringTag,{value:"Module"})),mQ=new ei({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function MLt(t,e,i,r){const s=await tw(t);if(await Uoe(t,e,r),!s.addAttachment)throw new U(r,"Layer source does not support addAttachment capability");return s.addAttachment(e,i)}function Uoe(t,e,i){const{attributes:r}=e,{objectIdField:s}=t;return t.capabilities?.data?.supportsAttachment?e?r?s&&r[s]?Promise.resolve():Promise.reject(new U(i,`feature is missing the identifying attribute ${s}`)):Promise.reject(new U(i,"'attributes' are required on a feature to query attachments")):Promise.reject(new U(i,"A feature is required to add/delete/update attachments")):Promise.reject(new U(i,"this layer doesn't support attachments"))}async function OLt(t,e,i,r,s){const n=await tw(t);if(await Uoe(t,e,s),!n.updateAttachment)throw new U(s,"Layer source does not support updateAttachment capability");return n.updateAttachment(e,i,r)}async function ILt(t,e,i){const{applyEdits:r}=await V(()=>import("./editingSupport-DEpUndvr.js"),[]),s=await t.load();let n=i;return s.type==="feature"&&s.infoFor3D&&e.deleteFeatures!=null&&s.globalIdField!=null&&(n={...n,globalIdToObjectId:await QLt(s,e.deleteFeatures,s.globalIdField)}),r(s,s.source,e,i)}async function RLt(t,e,i){const{uploadAssets:r}=await V(()=>import("./editingSupport-DEpUndvr.js"),[]),s=await t.load();return r(s,s.source,e,i)}async function PLt(t,e,i,r){const s=await tw(t);if(await Uoe(t,e,r),!s.deleteAttachments)throw new U(r,"Layer source does not support deleteAttachments capability");return s.deleteAttachments(e,i)}async function DLt(t,e,i){const r=(await t.load({signal:e?.signal})).source;if(!r.fetchRecomputedExtents)throw new U(i,"Layer source does not support fetchUpdates capability");return r.fetchRecomputedExtents(e)}async function LLt(t,e,i,r){e=ALt.from(e),await t.load();const s=t.source,n=t.capabilities;if(!n?.data?.supportsAttachment)throw new U(r,"this layer doesn't support attachments");const{attachmentTypes:o,objectIds:a,globalIds:l,num:c,size:h,start:d,where:f}=e;if(!n?.operations?.supportsQueryAttachments&&(o?.length>0||l?.length>0||h?.length>0||c||d||f))throw new U(r,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(a?.length||l?.length||f))throw new U(r,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!s.queryAttachments)throw new U(r,"Layer source does not support queryAttachments capability",e);return!n?.attachment?.supportsOrderByFields&&e.orderByFields?.length&&((e=e.clone()).orderByFields=null),s.queryAttachments(e)}async function NLt(t,e,i,r){const s=await tw(t);if(!s.queryObjectIds)throw new U(r,"Layer source does not support queryObjectIds capability");return s.queryObjectIds(Jm.from(e)??t.createQuery(),i)}async function FLt(t,e,i,r){const s=await tw(t);if(!s.queryFeatureCount)throw new U(r,"Layer source does not support queryFeatureCount capability");return s.queryFeatureCount(Jm.from(e)??t.createQuery(),i)}async function kLt(t,e,i,r){const s=await tw(t);if(!s.queryExtent)throw new U(r,"Layer source does not support queryExtent capability");return s.queryExtent(Jm.from(e)??t.createQuery(),i)}async function zLt(t,e,i,r){const s=await tw(t);if(!s.queryRelatedFeatures)throw new U(r,"Layer source does not support queryRelatedFeatures capability");return s.queryRelatedFeatures(zoe.from(e),i)}async function ULt(t,e,i,r){const s=await tw(t);if(!s.queryRelatedFeaturesCount)throw new U(r,"Layer source does not support queryRelatedFeaturesCount capability");return s.queryRelatedFeaturesCount(zoe.from(e),i)}async function BLt(t){const e=t.source;if(e?.refresh)try{const{dataChanged:i,updates:r}=await e.refresh();if(r!=null&&(t.sourceJSON={...t.sourceJSON,...r},t.read(r,{origin:"service",url:t.parsedUrl})),i)return!0}catch{}if(t.definitionExpression)try{return(await Kte(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function VLt(t){const e=new Jm,i=t.capabilities?.data,r=t.capabilities?.query;e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,r&&(e.compactGeometryEnabled=r.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),i&&(i.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),i.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];const{timeOffset:s,timeExtent:n}=t;return e.timeExtent=s!=null&&n!=null?n.offset(-s.value,s.unit):n||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function W4e(t){const{globalIdField:e,fields:i}=t;if(e)return e;if(i){for(const r of i)if(r.type==="esriFieldTypeGlobalID")return r.name}}function Z4e(t){const{objectIdField:e,fields:i}=t;if(e)return e;if(i){for(const r of i)if(r.type==="esriFieldTypeOID")return r.name}}function jLt(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}function GLt(t,e,i,r){const s=i?.feature,n=!!t.subtypes?.length;if(n&&!i?.excludeImpliedDomains){const l=qLt(t,e);if(l)return l}const o=n&&HLt(t,s);if(o){const l=o?.domains?.[e];return l?.type==="inherited"?r:l}const a=X4e(t.types,t.typeIdField,s);if(a){const l=a.domains&&a.domains[e];if(l&&l?.type!=="inherited")return l}if(r)return r;if(!i?.excludeImpliedDomains){const l=WLt(t,e);if(l)return l}return null}function HLt(t,e){const{subtypes:i,subtypeField:r}=t;if(!e?.attributes||!i?.length||!r)return null;const s=e.attributes[r];return s==null?null:i.find(n=>n.code===s)}function qLt(t,e){const{fieldsIndex:i,subtypeField:r}=t,{name:s,type:n}=i.get(e)??{};if(!s)return null;if((r&&i.get(r)?.name)===s&&t.subtypes?.length){const o=t.subtypes.map(a=>new px({code:Y4e(a.code,n),name:a.name}));if(o?.length)return new ij({codedValues:o})}return null}function WLt(t,e){const{fieldsIndex:i}=t,{name:r,type:s}=i.get(e)??{};if(!r)return null;if(("typeIdField"in t?i.get(t.typeIdField)?.name:null)===r&&"types"in t&&t.types?.length){const n=t.types.map(o=>new px({code:Y4e(o.id,s),name:o.name}));return new ij({codedValues:n})}return null}function Y4e(t,e){return e?tie({type:e})&&typeof t=="number"?`${t}`:wCe({type:e})&&typeof t=="string"?Number.parseInt(t,10):t:t}async function tw(t){return(await t.load()).source}async function Idi(t,e){if(!mr)return;const i=mr.findCredential(t);if(i)return i.userId;let r;try{const s=await Gte(t,e);s&&(r=await mr.checkSignInStatus(`${s}/sharing`))}catch{}return r?r.userId:null}async function J4e(t,e){if(!mr||mr.findCredential(t))return;let i;try{const r=await Gte(t,e);r&&(i=await mr.checkSignInStatus(`${r}/sharing`))}catch{}if(i)try{const r=e!=null?e.signal:null;await mr.getCredential(t,{signal:r})}catch{}}async function ZLt(t,e,i){const r=t.parsedUrl?.path;r&&t.authenticationTriggerEvent===e&&await J4e(r,i)}async function Rdi(t){const e=t.parsedUrl?.path;e&&YLt(t)&&await J4e(e)}function YLt(t){return JLt(t)&&("serviceDefinitionExpression"in t&&RB(t.serviceDefinitionExpression)||"definitionExpression"in t&&RB(t.definitionExpression))}function JLt(t){return!(!_2e(t)||!t.capabilities?.query.supportsCurrentUser)}function RB(t){return!!t?.toLowerCase().includes("current_user")}function XLt(t){return!j5(t)&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}const p9=dA({types:f$e});function Boe(t,e){if(t.defaultSymbol)return t.types?.length?new koe({defaultSymbol:p9(t.defaultSymbol,t,e),field:t.typeIdField,uniqueValueInfos:t.types.map(i=>({id:i.id,symbol:p9(i.symbol,i,e)}))}):new ev({symbol:p9(t.defaultSymbol,t,e)})}function KLt(t){let e=t.sourceJSON?.cacheMaxAge;if(!e)return!1;const i=t.editingInfo?.lastEditDate?.getTime();return i==null||(e*=1e3,Date.now()-i<e)}async function QLt(t,e,i){if(e==null)return null;const r=[],{objectIdField:s}=t;if(e.forEach(c=>{let h=null;if("attributes"in c){const{attributes:d}=c;h={globalId:d[i],objectId:d[s]!=null&&d[s]!==-1?d[s]:null}}else h={globalId:c.globalId,objectId:c.objectId!=null&&c.objectId!==-1?c.objectId:null};h.globalId!=null&&(h.objectId!=null&&h.objectId!==-1||r.push(h.globalId))}),r.length===0)return null;const n=t.createQuery();n.where=r.map(c=>`${i}='${c}'`).join(" OR "),n.returnGeometry=!1,n.outFields=[s,i],n.cacheHint=!1;const o=await MHe(L4e(t,n));if(!o.ok)return null;const a=new Map,l=o.value.features;for(const c of l){const h=c.attributes[i],d=c.attributes[s];h!=null&&d!=null&&d!==-1&&a.set(Sst(h),d)}return a}function X4e(t,e,i){if(!e||!i||!t)return null;const r=i.getAttribute(e);return r==null?null:t.find(s=>{const{id:n}=s;return n!=null&&n.toString()===r.toString()})??null}function j5(t){return t.sourceJSON?.isMultiServicesView||eNt(t)}function eNt(t){return!!t.sourceJSON?.capabilities?.toLowerCase().split(",").map(e=>e.trim()).includes("map")}function tNt(t,e,i){const r=e?.queryAttributeBins;if(!r)throw new U(i,"Layer source does not support binning");switch(t.binParameters.type){case"auto-interval":if(!r.supportsAutoInterval)throw new U(i,"Layer source does not support auto-interval binning");if(t.binParameters.normalizationType&&(!r.supportsNormalization||!Q_e(t.binParameters.normalizationType,r.supportedNormalizationTypes)))throw new U(i,"Layer source does not support normalization binning");break;case"date":if(!r.supportsDate)throw new U(i,"Layer source does not support date binning");if(t.binParameters.snapToData&&!r.supportsSnapToData)throw new U(i,"Layer source does not support snapToData binning");if(t.binParameters.returnFullIntervalBin&&!r.supportsReturnFullIntervalBin)throw new U(i,"Layer source does not support returnFullIntervalBin binning");break;case"fixed-boundaries":if(!r.supportsFixedBoundaries)throw new U(i,"Layer source does not support fixed-boundaries binning");break;case"fixed-interval":if(!r.supportsFixedInterval)throw new U(i,"Layer source does not support fixed-interval binning");if(t.binParameters.normalizationType&&(!r.supportsNormalization||!Q_e(t.binParameters.normalizationType,r.supportedNormalizationTypes)))throw new U(i,"Layer source does not support normalization binning")}if(t.binParameters.stackBy&&!r.supportsStackBy)throw new U(i,"Layer source does not support stackBy binning");if(t.binParameters.splitBy&&!r.supportsSplitBy)throw new U(i,"Layer source does not support splitBy binning");if(t.binParameters.firstDayOfWeek&&!r.supportsFirstDayOfWeek)throw new U(i,"Layer source does not support firstDayOfWeek binning");const s=r?.supportedStatistics;if(t.outStatistics&&s){const n=new Map([["count","count"],["sum","sum"],["min","min"],["max","max"],["avg","avg"],["stddev","stddev"],["var","var"],["percentile-continuous","percentileContinuous"],["percentile-discrete","percentileDiscrete"],["centroid-aggregate","centroid"],["convex-hull-aggregate","convexHull"],["envelope-aggregate","envelope"]]);for(const{statisticType:o}of t.outStatistics){const a=n.get(o);if(a&&!s[a])throw new U(i,`Layer source does not support ${o} statistic type`)}}}function Q_e(t,e){return t!=null&&!!e?.[q4e.toJSON(t)]}let g2=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};u([p({type:String,json:{read:{source:"shapeAreaFieldName"}}})],g2.prototype,"shapeAreaField",void 0),u([p({type:String,json:{read:{source:"shapeLengthFieldName"}}})],g2.prototype,"shapeLengthField",void 0),u([p({type:String,json:{read:t=>_6e.read(t)||b6e.read(t)}})],g2.prototype,"units",void 0),g2=u([A("esri.layers.support.GeometryFieldsInfo")],g2);const iNt=g2;var gQ;let y2=gQ=class extends ee{constructor(t){super(t),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new Ee}clone(){return new gQ({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};u([p({type:String,json:{write:{isRequired:!0}}})],y2.prototype,"floorField",void 0),u([p({json:{read:!1,write:!1}})],y2.prototype,"viewAllMode",void 0),u([p({json:{read:!1,write:!1}})],y2.prototype,"viewAllLevelIds",void 0),y2=gQ=u([A("esri.layers.support.LayerFloorInfo")],y2);const rNt=y2,ebe=new ei({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),tbe=new ei({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let Iu=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.cardinality=null,this.catalogId=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};u([p({json:{read:ebe.read,write:ebe.write}})],Iu.prototype,"cardinality",void 0),u([p({json:{name:"catalogID"}})],Iu.prototype,"catalogId",void 0),u([p({json:{read:!0,write:!0}})],Iu.prototype,"composite",void 0),u([p({json:{read:!0,write:!0}})],Iu.prototype,"id",void 0),u([p({json:{read:!0,write:!0}})],Iu.prototype,"keyField",void 0),u([p({json:{read:!0,write:!0}})],Iu.prototype,"keyFieldInRelationshipTable",void 0),u([p({json:{read:!0,write:!0}})],Iu.prototype,"name",void 0),u([p({json:{read:!0,write:!0}})],Iu.prototype,"relatedTableId",void 0),u([p({json:{read:!0,write:!0}})],Iu.prototype,"relationshipTableId",void 0),u([p({json:{read:tbe.read,write:tbe.write}})],Iu.prototype,"role",void 0),Iu=u([A("esri.layers.support.Relationship")],Iu);const sNt=Iu,nNt=[["binary","application/octet-stream","bin",""]];function Ldi(t,e){return t5e(e.name,t?.supportedFormats??[])!=null}function Ndi(t,e){if(!t)return!1;const i=oNt(e,t.supportedFormats??[]);return i!=null&&t.editFormats.includes(i)}function K4e(t,e){return joe(uNt(t,e))}function Q4e(t,e){return joe(t5e(t,e))}function Fdi(t,e){return i5e(cNt(t,e))}function oNt(t,e){return Q4e(t.name,e)??K4e(t.type,e)}function FG(t,e,i){return K4e(t,i)??Q4e(e,i)}function e5e({supportedFormats:t}){return FG("model/gltf-binary","glb",t)}function kdi(t){const e=e5e(t);return e!=null&&t.editFormats.includes(e)}function aNt({supportedFormats:t}){return FG("model/gltf+json","gltf",t)}function lNt(t){if(!t)return null;const e=e5e(t),i=aNt(t);let r=null;for(const s of t.queryFormats){if(s===e)return s;s===i&&(r=s)}return r}function zdi({supportedFormats:t}){return FG("application/esri3do-SR_world","wld",t)}function Udi({supportedFormats:t}){return FG("application/esri3do-SR_prj","prj",t)}function Voe(t){return[...nNt,...t]}function cNt(t,e){return Voe(e).find(i=>joe(i)===t)}function uNt(t,e){const i=t.toLowerCase();return Voe(e).find(r=>i5e(r)===i)}function t5e(t,e){const i=t.toLowerCase();return Voe(e).find(r=>hNt(r).some(s=>i.endsWith(s)))}function joe(t){return t?.[0]}function i5e(t){return t?.[1].toLowerCase()}function hNt(t){return t?.[2].split(",").map(e=>e.toLowerCase())??[]}function Bdi(t){return t.tables?.find(e=>e.role==="assetMaps")}function Xe(t,e,i){return!!r5e(t,e,i)}function KI(t,e,i){return r5e(t,e,i)}function r5e(t,e,i){return t&&t.hasOwnProperty(e)?t[e]:i}const dNt={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function pNt(t){const e=t?.supportedSpatialAggregationStatistics?.map(i=>i.toLowerCase());return{envelope:!!e?.includes("envelopeaggregate"),centroid:!!e?.includes("centroidaggregate"),convexHull:!!e?.includes("convexhullaggregate")}}function iL(t,e){return!!t?.supportedOperationsWithCacheHint?.map(r=>r.toLowerCase())?.includes(e.toLowerCase())}function fNt(t){const e=t?.supportedStatisticTypes?.map(i=>i.toLowerCase());return{count:!!e?.includes("count"),sum:!!e?.includes("sum"),min:!!e?.includes("min"),max:!!e?.includes("max"),avg:!!e?.includes("avg"),var:!!e?.includes("var"),stddev:!!e?.includes("stddev"),percentileContinuous:!!e?.includes("percentile_continuous"),percentileDiscrete:!!e?.includes("percentile_discrete"),envelope:!!e?.includes("envelopeaggregate"),centroid:!!e?.includes("centroidaggregate"),convexHull:!!e?.includes("convexhullaggregate")}}function mNt(t){const e=t?.supportedNormalizationTypes?.map(i=>i.toLowerCase());return{field:!!e?.includes("field"),log:!!e?.includes("log"),naturalLog:!!e?.includes("naturallog"),percentOfTotal:!!e?.includes("percentoftotal"),squareRoot:!!e?.includes("squareroot")}}function s5e(t,e){return{analytics:gNt(t),attachment:yNt(t),data:vNt(t),metadata:_Nt(t),operations:bNt(t.capabilities,t,e),query:wNt(t,e),queryAttributeBins:TNt(t),queryRelated:xNt(t),queryTopFeatures:SNt(t),editing:ENt(t)}}function gNt(t){return{supportsCacheHint:iL(t.advancedQueryCapabilities,"queryAnalytics")}}function yNt(t){const e=t.attachmentProperties,i={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:iL(t.advancedQueryCapabilities,"queryAttachments"),supportsOrderByFields:Xe(t.advancedQueryCapabilities,"supportsQueryAttachmentOrderByFields",!1),supportsResize:Xe(t,"supportsAttachmentsResizing",!1)};return e&&Array.isArray(e)&&e.forEach(r=>{const s=dNt[r.name];s&&(i[s]=!!r.isEnabled)}),i}function vNt(t){return{isVersioned:Xe(t,"isDataVersioned",!1),isBranchVersioned:Xe(t,"isDataBranchVersioned",!1),supportsAttachment:Xe(t,"hasAttachments",!1),supportsM:Xe(t,"hasM",!1),supportsZ:Xe(t,"hasZ",!1)}}function _Nt(t){return{supportsAdvancedFieldProperties:Xe(t,"supportsFieldDescriptionProperty",!1)}}function bNt(t,e,i){const r=t?t.toLowerCase().split(",").map(f=>f.trim()):[],s=i?gb(i):null,n=r.includes(s!=null&&s.serverType==="MapServer"?"data":"query"),o=r.includes("editing")&&!e.datesInUnknownTimezone;let a=o&&r.includes("create"),l=o&&r.includes("delete"),c=o&&r.includes("update");const h=r.includes("changetracking"),d=e.advancedQueryCapabilities;return o&&!(a||l||c)&&(a=l=c=!0),{supportsCalculate:Xe(e,"supportsCalculate",!1),supportsTruncate:Xe(e,"supportsTruncate",!1),supportsValidateSql:Xe(e,"supportsValidateSql",!1),supportsAdd:a,supportsDelete:l,supportsEditing:o,supportsChangeTracking:h,supportsQuery:n,supportsQueryAnalytics:Xe(d,"supportsQueryAnalytic",!1),supportsQueryAttachments:Xe(d,"supportsQueryAttachments",!1),supportsQueryBins:Xe(d,"supportsQueryBins",!1),supportsQueryTopFeatures:Xe(d,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:Xe(e,"supportsAttachmentsResizing",!1),supportsSync:r.includes("sync"),supportsUpdate:c,supportsExceedsLimitStatistics:Xe(e,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:Xe(e,"supportsAsyncConvert3D",!1)}}function wNt(t,e){const i=t.advancedQueryCapabilities,r=t.ownershipBasedAccessControlForFeatures,s=t.archivingInfo,n=t.currentVersion,o=e?.includes("MapServer"),a=!o||n>=X("mapserver-pbf-version-support"),l=Rz(e),c=new Set((t.supportedQueryFormats??"").split(",").map(h=>h.toLowerCase().trim()));return{maxRecordCount:KI(t,"maxRecordCount",void 0),maxRecordCountFactor:KI(t,"maxRecordCountFactor",void 0),standardMaxRecordCount:KI(t,"standardMaxRecordCount",void 0),supportedSpatialAggregationStatistics:pNt(i),supportsCacheHint:Xe(i,"supportsQueryWithCacheHint",!1)||iL(i,"query"),supportsCentroid:Xe(i,"supportsReturningGeometryCentroid",!1),supportsCompactGeometry:l,supportsCurrentUser:Xe(i,"supportsCurrentUserQueries",!1),supportsDefaultSpatialReference:Xe(i,"supportsDefaultSR",!1),supportsDisjointSpatialRelationship:Xe(i,"supportsDisjointSpatialRel",!1),supportsDistance:Xe(i,"supportsQueryWithDistance",!1),supportsDistinct:Xe(i,"supportsDistinct",t.supportsAdvancedQueries),supportsExtent:Xe(i,"supportsReturningQueryExtent",!1),supportsFormatPBF:a&&c.has("pbf"),supportsFullTextSearch:Xe(i,"supportsFullTextSearch",!1),supportsGeometryProperties:Xe(i,"supportsReturningGeometryProperties",!1),supportsHavingClause:Xe(i,"supportsHavingClause",!1),supportsHistoricMoment:Xe(s,"supportsQueryWithHistoricMoment",!1),supportsMaxRecordCountFactor:Xe(i,"supportsMaxRecordCountFactor",!1),supportsOrderBy:Xe(i,"supportsOrderBy",t.supportsAdvancedQueries),supportsPagination:Xe(i,"supportsPagination",!1),supportsPercentileStatistics:Xe(i,"supportsPercentileStatistics",!1),supportsQuantization:Xe(t,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:Xe(t,"supportsQuantizationEditMode",!1),supportsQueryByAnonymous:Xe(r,"allowAnonymousToQuery",!0),supportsQueryByOthers:Xe(r,"allowOthersToQuery",!0),supportsQueryGeometry:Xe(t,"supportsReturningQueryGeometry",!1),supportsResultType:Xe(i,"supportsQueryWithResultType",!1),supportsReturnMesh:!!lNt(t.infoFor3D),supportsSpatialAggregationStatistics:Xe(i,"supportsSpatialAggregationStatistics",!1),supportsSqlExpression:Xe(i,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:Xe(t,"useStandardizedQueries",!1),supportsStatistics:Xe(i,"supportsStatistics",t.supportsStatistics),supportsTopFeaturesQuery:Xe(i,"supportsTopFeaturesQuery",!1),supportsTrueCurve:Xe(i,"supportsTrueCurve",!1),tileMaxRecordCount:KI(t,"tileMaxRecordCount",void 0)}}function xNt(t){const e=t.advancedQueryCapabilities,i=Xe(e,"supportsAdvancedQueryRelated",!1);return{supportsPagination:Xe(e,"supportsQueryRelatedPagination",!1),supportsCount:i,supportsOrderBy:i,supportsCacheHint:iL(e,"queryRelated")}}function SNt(t){return{supportsCacheHint:iL(t.advancedQueryCapabilities,"queryTopFilter")}}function TNt(t){const e=t?t.queryBinsCapabilities:void 0;return{supportsDate:Xe(e,"supportsDateBin",!1),supportsFixedInterval:Xe(e,"supportsFixedIntervalBin",!1),supportsAutoInterval:Xe(e,"supportsAutoIntervalBin",!1),supportsFixedBoundaries:Xe(e,"supportsFixedBoundariesBin",!1),supportsStackBy:Xe(e,"supportsStackBy",!1),supportsSplitBy:Xe(e,"supportsSplitBy",!1),supportsSnapToData:Xe(e,"supportsSnapToData",!1),supportsReturnFullIntervalBin:Xe(e,"supportsReturnFullIntervalBin",!1),supportsFirstDayOfWeek:Xe(e,"supportsFirstDayOfWeek",!1),supportsNormalization:Xe(e,"supportsNormalization",!1),supportedStatistics:fNt(e),supportedNormalizationTypes:mNt(e)}}function ENt(t){const e=t.ownershipBasedAccessControlForFeatures,i=t?t.advancedEditingCapabilities:void 0;return{supportsGeometryUpdate:Xe(t,"allowGeometryUpdates",!0),supportsGlobalId:Xe(t,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:Xe(t,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:Xe(t,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:Xe(t,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:Xe(t,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:Xe(e,"allowAnonymousToDelete",!0),supportsDeleteByOthers:Xe(e,"allowOthersToDelete",!0),supportsUpdateByAnonymous:Xe(e,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:Xe(e,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:Xe(i,"supportsAsyncApplyEdits",!1),zDefault:KI(t,"zDefault",void 0)}}function Vdi(t){return{operations:{supportsAppend:Xe(t,"supportsAppend",!1),supportsCoverageQuery:t?.playbackInfo?.klv["0601"]??!1,supportsExportClip:Xe(t,"supportsExportClip",!1),supportsExportFrameset:Xe(t,"supportsExportFrameset",!1),supportsMensuration:Xe(t,"supportsMensuration",!1),supportsUpdate:Xe(t,"supportsUpdate",!1)}}}let py=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.code=null,this.defaultValues={},this.domains=null,this.name=null}readDomains(e){if(!e)return null;const i={};for(const r of Object.keys(e))i[r]=rj(e[r]);return i}writeDomains(e,i){if(!e)return;const r={};for(const s of Object.keys(e))e[s]&&(r[s]=e[s]?.toJSON());i.domains=r}};u([p({type:Number,json:{write:!0}})],py.prototype,"code",void 0),u([p({type:Object,json:{write:!0}})],py.prototype,"defaultValues",void 0),u([p({json:{write:!0}})],py.prototype,"domains",void 0),u([me("domains")],py.prototype,"readDomains",null),u([ge("domains")],py.prototype,"writeDomains",null),u([p({type:String,json:{write:!0}})],py.prototype,"name",void 0),py=u([A("esri.layers.support.Subtype")],py);const CNt=py,$Nt=t=>{let e=class extends t{constructor(){super(...arguments),this.copyright=null,this.capabilities=null,this.dateFieldsTimeZone=null,this.datesInUnknownTimezone=!1,this.definitionExpression=null,this.displayField=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.fieldsIndex=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.globalIdField=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.indexes=new(Ee.ofType(mm)),this.isTable=!1,this.layerId=void 0,this.maxScale=0,this.minScale=0,this.objectIdField=null,this.preferredTimeZone=null,this.relationships=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.sourceJSON=null,this.spatialReference=Ae.WGS84,this.subtypeField=null,this.subtypes=null,this.trackIdField=null,this.version=void 0}getFieldDomain(){throw new Error("Not implemented")}getField(i){return this.fieldsIndex.get(i)}get authenticationTriggerEvent(){if(!this.url)return null;const{capabilities:i}=this;if(i){const{query:s,operations:n,editing:o}=i;if(!s.supportsQueryByOthers||!s.supportsQueryByAnonymous||n.supportsEditing&&!(o.supportsUpdateByOthers&&o.supportsUpdateByAnonymous&&o.supportsDeleteByOthers&&o.supportsDeleteByAnonymous))return"load"}if(RB(this.serviceDefinitionExpression)||RB(this.definitionExpression))return"load";if(this.userHasUpdateItemPrivileges){if(KLt(this))return"load";if(this.hasUpdateItemRestrictions)return i.operations.supportsQuery?"editing":"load"}if(this.userHasFullEditingPrivileges&&this.hasFullEditingRestrictions)return"editing";const r=this.editFieldsInfo;return(r?.creatorField||r?.editorField)&&i?.operations.supportsEditing?"editing":null}readCapabilitiesFromService(i,r){return s5e(r,this.url)}readEditingInfo(i,r){const{editingInfo:s}=r;return s?{lastEditDate:s.lastEditDate!=null?new Date(s.lastEditDate):null}:null}get effectiveCapabilities(){const i=this.capabilities;if(!i)return null;const r=q(i),{operations:s,editing:n}=r;return j5(this)?(this.userHasUpdateItemPrivileges&&(s.supportsQuery=!0),r):this.userHasUpdateItemPrivileges?(s.supportsAdd=s.supportsDelete=s.supportsEditing=s.supportsQuery=s.supportsUpdate=n.supportsDeleteByOthers=n.supportsGeometryUpdate=n.supportsUpdateByOthers=!0,r):(this.userHasFullEditingPrivileges&&s.supportsEditing&&(s.supportsAdd=s.supportsDelete=s.supportsUpdate=n.supportsGeometryUpdate=!0),r)}get effectiveEditingEnabled(){return!1}readGlobalIdFieldFromService(i,r){return W4e(r)}get hasFullEditingRestrictions(){const i=this.capabilities;if(!i||j5(this))return!1;const{operations:r,editing:s}=i;return r.supportsEditing&&!(r.supportsAdd&&r.supportsDelete&&r.supportsUpdate&&s.supportsGeometryUpdate)}get hasUpdateItemRestrictions(){const i=this.capabilities;if(!i)return!1;const{operations:r,editing:s}=i;return j5(this)?!r.supportsQuery:!(r.supportsAdd&&r.supportsDelete&&r.supportsEditing&&r.supportsQuery&&r.supportsUpdate&&s.supportsDeleteByOthers&&s.supportsGeometryUpdate&&s.supportsUpdateByOthers)}readIsTableFromService(i,r){return r.type==="Table"}readMaxScale(i,r){return r.effectiveMaxScale||i||0}readMinScale(i,r){return r.effectiveMinScale||i||0}readObjectIdFieldFromService(i,r){return Z4e(r)}readServiceDefinitionExpression(i,r){return r.definitionQuery||r.definitionExpression}set url(i){if(i==null)return void this._set("url",i);const r=$Ge({layer:this,url:i,nonStandardUrlAllowed:!0,logger:J.getLogger(this)});this._set("url",r.url),r.layerId!=null&&this._set("layerId",r.layerId)}writeUrl(i,r,s,n){AGe(this,i,null,r,n)}readVersion(i,r){return jLt(r)}};return u([p({readOnly:!0})],e.prototype,"authenticationTriggerEvent",null),u([p({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],e.prototype,"copyright",void 0),u([p({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","isDataBranchVersioned","isDataVersioned","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],e.prototype,"capabilities",void 0),u([me("service","capabilities")],e.prototype,"readCapabilitiesFromService",null),u([p(Jz("dateFieldsTimeReference"))],e.prototype,"dateFieldsTimeZone",void 0),u([p({type:Boolean})],e.prototype,"datesInUnknownTimezone",void 0),u([p({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],e.prototype,"definitionExpression",void 0),u([p({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],e.prototype,"displayField",void 0),u([p({readOnly:!0,type:IDt})],e.prototype,"editFieldsInfo",void 0),u([p({readOnly:!0})],e.prototype,"editingInfo",void 0),u([me("editingInfo")],e.prototype,"readEditingInfo",null),u([p({readOnly:!0})],e.prototype,"effectiveCapabilities",null),u([p()],e.prototype,"effectiveEditingEnabled",null),u([p((()=>{const i=q(EDt),r=i.json.origins;return r["web-map"]={read:!1,write:!1},r["portal-item"]={read:!1,write:!1},i})())],e.prototype,"elevationInfo",void 0),u([p()],e.prototype,"fieldsIndex",void 0),u([p({type:rNt,json:{name:"layerDefinition.floorInfo",write:{layerContainerTypes:Ys}}})],e.prototype,"floorInfo",void 0),u([p({type:gi,json:{origins:{service:{read:{source:"extent"}}}}})],e.prototype,"fullExtent",void 0),u([p()],e.prototype,"gdbVersion",void 0),u([p({readOnly:!0,type:iNt,json:{read:{source:"geometryProperties"}}})],e.prototype,"geometryFieldsInfo",void 0),u([p({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:mQ.read}}}})],e.prototype,"geometryType",void 0),u([p({type:String})],e.prototype,"globalIdField",void 0),u([me("service","globalIdField",["globalIdField","fields"])],e.prototype,"readGlobalIdFieldFromService",null),u([p({readOnly:!0})],e.prototype,"hasFullEditingRestrictions",null),u([p({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasM",void 0),u([p({readOnly:!0})],e.prototype,"hasUpdateItemRestrictions",null),u([p({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasZ",void 0),u([p({readOnly:!0,type:Bb})],e.prototype,"heightModelInfo",void 0),u([p({type:Date})],e.prototype,"historicMoment",void 0),u([p({type:Ee.ofType(mm),readOnly:!0})],e.prototype,"indexes",void 0),u([p({readOnly:!0})],e.prototype,"isTable",void 0),u([me("service","isTable",["type"])],e.prototype,"readIsTableFromService",null),u([p({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],e.prototype,"layerId",void 0),u([p(MDt)],e.prototype,"maxScale",void 0),u([me("service","maxScale",["maxScale","effectiveMaxScale"])],e.prototype,"readMaxScale",null),u([p(ADt)],e.prototype,"minScale",void 0),u([me("service","minScale",["minScale","effectiveMinScale"])],e.prototype,"readMinScale",null),u([p({type:String})],e.prototype,"objectIdField",void 0),u([me("service","objectIdField",["objectIdField","fields"])],e.prototype,"readObjectIdFieldFromService",null),u([p(Jz("preferredTimeReference"))],e.prototype,"preferredTimeZone",void 0),u([p({type:[sNt],readOnly:!0})],e.prototype,"relationships",void 0),u([p({type:Boolean})],e.prototype,"returnM",void 0),u([p({type:Boolean})],e.prototype,"returnZ",void 0),u([p({readOnly:!0,json:{write:!1}})],e.prototype,"serverGens",void 0),u([p({readOnly:!0})],e.prototype,"serviceDefinitionExpression",void 0),u([me("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],e.prototype,"readServiceDefinitionExpression",null),u([p({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],e.prototype,"serviceItemId",void 0),u([p()],e.prototype,"sourceJSON",void 0),u([p({type:Ae,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],e.prototype,"spatialReference",void 0),u([p({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],e.prototype,"subtypeField",void 0),u([p({type:[CNt],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],e.prototype,"subtypes",void 0),u([p({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],e.prototype,"trackIdField",void 0),u([p(SDt)],e.prototype,"url",null),u([ge("url")],e.prototype,"writeUrl",null),u([p({json:{origins:{service:{read:!0}},read:!1}})],e.prototype,"version",void 0),u([me("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],e.prototype,"readVersion",null),e=u([A("esri.layers.mixins.FeatureLayerBase")],e),e};let v2=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.expression=null,this.title=null,this.returnType=null}};u([p({type:String,json:{write:!0}})],v2.prototype,"expression",void 0),u([p({type:String,json:{write:!0}})],v2.prototype,"title",void 0),u([p({type:String,json:{write:!0}})],v2.prototype,"returnType",void 0),v2=u([A("esri.layers.support.ExpressionInfo")],v2);const Goe=v2;var yQ;let fy=yQ=class extends ee{constructor(t){super(t),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new yQ({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:q(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};u([p({type:Boolean,json:{write:!0}})],fy.prototype,"isAutoGenerated",void 0),u([p({type:String,json:{write:!0}})],fy.prototype,"name",void 0),u([p({type:String,json:{write:!0}})],fy.prototype,"alias",void 0),u([p({type:String,json:{write:!0}})],fy.prototype,"onStatisticField",void 0),u([p({type:Goe,json:{write:!0}})],fy.prototype,"onStatisticExpression",void 0),u([p({type:String,json:{write:!0}})],fy.prototype,"statisticType",void 0),fy=yQ=u([A("esri.layers.support.AggregateField")],fy);const Nb=fy;let pb=class extends ee{constructor(){super(...arguments),this.type=null}};u([p({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],pb.prototype,"type",void 0),pb=u([A("esri.layers.support.FeatureReduction")],pb);var vQ;let r_=vQ=class extends ee{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(t,e){return e.value?pX(e.value):t}writeExpression(t,e,i){this.value!=null&&(t=pX(this.value)),t!=null&&(e[i]=t)}clone(){return new vQ({expression:this.expression,title:this.title,value:this.value})}};u([p({type:String,json:{write:{writerEnsuresNonNull:!0}}})],r_.prototype,"expression",void 0),u([me("expression",["expression","value"])],r_.prototype,"readExpression",null),u([ge("expression")],r_.prototype,"writeExpression",null),u([p({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],r_.prototype,"title",void 0),u([p({json:{read:!1,write:!1}})],r_.prototype,"value",void 0),r_=vQ=u([A("esri.layers.support.LabelExpressionInfo")],r_);const n5e=r_;var _Q;const QF=new ei({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function ek(t,e,i){return{enabled:!yW(i?.layer)}}function o5e(t){return!t||t.origin!=="service"&&t.layer?.type!=="map-image"}function ANt(t){return t?.type==="map-image"}function a5e(t){return!!ANt(t)&&!!t.capabilities?.exportMap?.supportsArcadeExpressionForLabeling}function MNt(t){return o5e(t)||a5e(t?.layer)}let En=_Q=class extends ee{static evaluateWhere(t,e){const i=(r,s,n)=>{switch(s){case"=":return r==n;case"<>":return r!=n;case">":return r>n;case">=":return r>=n;case"<":return r<n;case"<=":return r<=n}return!1};try{if(t==null)return!0;const r=t.split(" ");if(r.length===3)return i(e[r[0]],r[1],r[2]);if(r.length===7){const s=i(e[r[0]],r[1],r[2]),n=r[3],o=i(e[r[4]],r[5],r[6]);switch(n){case"AND":return s&&o;case"OR":return s||o}}return!1}catch{}}constructor(t){super(t),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=oLt,this.useCodedValues=void 0,this.where=null}readLabelExpression(t,e){const i=e.labelExpressionInfo;if(!i||!i.value&&!i.expression)return t}writeLabelExpression(t,e,i){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)t=x1t(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const r=$ne(this.labelExpressionInfo.expression);r&&(t="["+r+"]")}}t!=null&&(e[i]=t)}writeLabelExpressionInfo(t,e,i,r){if(t==null&&this.labelExpression!=null&&o5e(r))t=new n5e({expression:this.getLabelExpressionArcade()});else if(!t)return;const s=t.toJSON(r);s.expression&&(e[i]=s)}writeMaxScale(t,e){(t||this.minScale)&&(e.maxScale=t)}writeMinScale(t,e){(t||this.maxScale)&&(e.minScale=t)}getLabelExpression(){return _G(this)}getLabelExpressionArcade(){return S1t(this)}getLabelExpressionSingleField(){return T1t(this)}hash(){return JSON.stringify(this)}clone(){return new _Q({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:q(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:q(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};u([p({type:String,json:{write:!0}})],En.prototype,"name",void 0),u([p({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:ek}}}}})],En.prototype,"allowOverrun",void 0),u([p({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:ek}}}}})],En.prototype,"deconflictionStrategy",void 0),u([p({type:String,json:{write:{overridePolicy(t,e,i){return this.labelExpressionInfo&&i?.origin==="service"&&a5e(i.layer)?{enabled:!1}:{allowNull:!0}}}}})],En.prototype,"labelExpression",void 0),u([me("labelExpression")],En.prototype,"readLabelExpression",null),u([ge("labelExpression")],En.prototype,"writeLabelExpression",null),u([p({type:n5e,json:{write:{overridePolicy:(t,e,i)=>MNt(i)?{allowNull:!0}:{enabled:!1}}}})],En.prototype,"labelExpressionInfo",void 0),u([ge("labelExpressionInfo")],En.prototype,"writeLabelExpressionInfo",null),u([p({type:QF.apiValues,json:{type:QF.jsonValues,read:QF.read,write:QF.write}})],En.prototype,"labelPlacement",void 0),u([p({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],En.prototype,"labelPosition",void 0),u([p({type:Number})],En.prototype,"maxScale",void 0),u([ge("maxScale")],En.prototype,"writeMaxScale",null),u([p({type:Number})],En.prototype,"minScale",void 0),u([ge("minScale")],En.prototype,"writeMinScale",null),u([p({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:ek}}}}})],En.prototype,"repeatLabel",void 0),u([p({type:Number,cast:sr,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:ek}}}}})],En.prototype,"repeatLabelDistance",void 0),u([p({types:VXe,json:{origins:{"web-scene":{types:jXe,write:j_e,default:null}},write:j_e,default:null}})],En.prototype,"symbol",void 0),u([p({type:Boolean,json:{write:!0}})],En.prototype,"useCodedValues",void 0),u([p({type:String,json:{write:!0}})],En.prototype,"where",void 0),En=_Q=u([A("esri.layers.support.LabelClass")],En);const rL=En;var bQ;let s_=bQ=class extends ee{constructor(t){super(t),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new bQ({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?.clone()??null})}getMeshHash(){const t=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${t}`}};u([p({type:String,json:{write:!0}})],s_.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],s_.prototype,"label",void 0),u([p({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],s_.prototype,"minValue",void 0),u([p({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],s_.prototype,"maxValue",void 0),u([p(Loe)],s_.prototype,"symbol",void 0),s_=bQ=u([A("esri.renderers.support.ClassBreakInfo")],s_);const PB=s_;var wQ;const l5e="log",G5="percent-of-total",H5="field",tk=new ei({esriNormalizeByLog:l5e,esriNormalizeByPercentOfTotal:G5,esriNormalizeByField:H5}),ONt=Is(PB);let uo=wQ=class extends HA(zv){constructor(t){super(t),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(t,e,i){if(!Array.isArray(t))return;let r=e.minValue;return t.map(s=>{const n=new PB;return n.read(s,i),n.minValue==null&&(n.minValue=r),n.maxValue==null&&(n.maxValue=n.minValue),r=n.maxValue,n})}writeClassBreakInfos(t,e,i,r){const s=t.map(n=>n.write({},r));this._areClassBreaksConsecutive()&&s.forEach(n=>delete n.classMinValue),e[i]=s}castField(t){return t==null?t:typeof t=="function"?(J.getLogger(this).error(".field: field must be a string value"),null):H3(t)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let t=this._get("normalizationType");const e=!!this.normalizationField,i=this.normalizationTotal!=null;return e||i?(t=e&&H5||i&&G5||null,e&&i&&J.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):t!==H5&&t!==G5||(t=null),t}set normalizationType(t){this._set("normalizationType",t)}addClassBreakInfo(t,e,i){let r=null;r=typeof t=="number"?new PB({minValue:t,maxValue:e,symbol:m$e(i)}):ONt(q(t)),this.classBreakInfos.push(r),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(t,e){const i=this.classBreakInfos.length;for(let r=0;r<i;r++){const s=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(s[0]===t&&s[1]===e){this.classBreakInfos.splice(r,1);break}}}getBreakIndex(t,e){return this.valueExpression&&e?.arcade==null&&J.getLogger(this).warn(""),this.valueExpression?this._getBreakIndexForExpression(t,e):this._getBreakIndexForField(t)}async getClassBreakInfo(t,e){let i=e;this.valueExpression&&e?.arcade==null&&(i={...i,arcade:await av()});const r=this.getBreakIndex(t,i);return r!==-1?this.classBreakInfos[r]:null}getSymbol(t,e){if(this.valueExpression&&e?.arcade==null)return void J.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this.getBreakIndex(t,e);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}async getSymbolAsync(t,e){let i=e;if(this.valueExpression&&e?.arcade==null){const s=await av(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i={...i,arcade:s}}const r=this.getBreakIndex(t,i);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}get symbols(){const t=[];return this.classBreakInfos.forEach(e=>{e.symbol&&t.push(e.symbol)}),this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables?.reduce((t,e)=>t+e.getAttributeHash(),"")??""}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),i=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${t}.${e}.${this.classBreakInfos.reduce((r,s)=>r+s.getMeshHash(),"")}.${i}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new wQ({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol?.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol?.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:q(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:q(this.visualVariables),legendOptions:q(this.legendOptions),authoringInfo:q(this.authoringInfo)})}async collectRequiredFields(t,e){const i=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(i)}async collectSymbolFields(t,e){const i=[...this.symbols.map(r=>r.collectRequiredFields(t,e)),Al(t,e,this.valueExpression)];cc(t,e,this.field),cc(t,e,this.normalizationField),await Promise.all(i)}_getBreakIndexForExpression(t,e){const{viewingMode:i,scale:r,spatialReference:s,arcade:n,timeZone:o}=e??{},{valueExpression:a}=this;let l=this._compiledValueExpression.valueExpression===a?this._compiledValueExpression.compiledFunction:null;const c=n.arcadeUtils;if(!l){const d=c.createSyntaxTree(a);l=c.createFunction(d),this._compiledValueExpression.compiledFunction=l}this._compiledValueExpression.valueExpression=a;const h=c.executeFunction(l,c.createExecContext(t,c.getViewInfo({viewingMode:i,scale:r,spatialReference:s}),o));return this._getBreakIndexfromInfos(h)}_getBreakIndexForField(t){const e=this.field,i=t.attributes,r=this.normalizationType;let s=parseFloat(i[e]);if(r){const n=this.normalizationTotal,o=parseFloat(this.normalizationField?i[this.normalizationField]:void 0);if(r===l5e)s=Math.log(s)*Math.LOG10E;else if(r!==G5||n==null||isNaN(n)){if(r===H5&&!isNaN(o)){if(isNaN(s)||isNaN(o))return-1;s/=o}}else s=s/n*100}return this._getBreakIndexfromInfos(s)}_getBreakIndexfromInfos(t){const e=this.isMaxInclusive;if(t!=null&&typeof t=="number"&&!isNaN(t))for(let i=0;i<this.classBreakInfos.length;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]<=t&&(e?t<=r[1]:t<r[1]))return i}return-1}_areClassBreaksConsecutive(){const t=this.classBreakInfos,e=t.length;for(let i=1;i<e;i++)if(t[i-1].maxValue!==t[i].minValue)return!1;return!0}};u([p(Noe)],uo.prototype,"backgroundFillSymbol",void 0),u([p({type:[PB],json:{write:{isRequired:!0}}})],uo.prototype,"classBreakInfos",void 0),u([me("classBreakInfos")],uo.prototype,"readClassBreakInfos",null),u([ge("classBreakInfos")],uo.prototype,"writeClassBreakInfos",null),u([p({type:String,json:{write:!0}})],uo.prototype,"defaultLabel",void 0),u([p(NG)],uo.prototype,"defaultSymbol",void 0),u([p({type:String,json:{write:!0}})],uo.prototype,"field",void 0),u([Yt("field")],uo.prototype,"castField",null),u([p({type:Boolean})],uo.prototype,"isMaxInclusive",void 0),u([p({type:Foe,json:{write:!0}})],uo.prototype,"legendOptions",void 0),u([p({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],uo.prototype,"minValue",null),u([p({type:String,json:{write:!0}})],uo.prototype,"normalizationField",void 0),u([p({type:Number,json:{write:!0}})],uo.prototype,"normalizationTotal",void 0),u([p({type:tk.apiValues,value:null,json:{type:tk.jsonValues,read:tk.read,write:tk.write}})],uo.prototype,"normalizationType",null),u([Ue({classBreaks:"class-breaks"})],uo.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],uo.prototype,"valueExpression",void 0),u([p({type:String,json:{write:!0}})],uo.prototype,"valueExpressionTitle",void 0),uo=wQ=u([A("esri.renderers.ClassBreaksRenderer")],uo);const c5e=uo;let INt=class{constructor(e,i){this._storage=new WNe,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),i&&this._storage.registerRemoveFunc("",i)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,i,r=1){this._storage.put(this,e,i,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}};function RNt(t){return"timeZone"in t}function PNt(t){return"timeZone"in t}function DNt(t){return"dateFieldsTimeZone"in t}const LNt=new Map;let u5e=class q5{static fromJSON(e){return new q5(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new q5(e.fields??[],rbe(e))}static fromLayerJSON(e){return new q5(e.fields??[],rbe(e))}constructor(e=[],i){this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=i?new Map(i):null;const r=[];for(const s of this.fields){const n=s?.name,o=ibe(n);if(n&&o){const a=ox(n);this._fieldsMap.set(n,s),this._fieldsMap.set(a,s),this._normalizedFieldsMap.set(o,s),r.push(`${a}:${s.type}:${this._timeZoneByFieldName?.get(n)}`),xCe(s)?(this.dateFields.push(s),this._dateFieldsSet.add(s)):ZV(s)&&(this._numericFieldsSet.add(s),this.numericFields.push(s)),Tue(s)||Eue(s)||(s.editable=s.editable==null||!!s.editable,s.nullable=s.nullable==null||!!s.nullable)}}r.sort(),this.uid=r.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)Tue(e)||Eue(e)||e.nullable||uJe(e)!==void 0||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===e?.uid}has(e){return this.get(e)!=null}get(e){if(!e)return;let i=this._fieldsMap.get(e);return i||(i=this._fieldsMap.get(ox(e))??this._normalizedFieldsMap.get(ibe(e)),i&&this._fieldsMap.set(e,i),i)}getTimeZone(e){const i=this.get(e&&typeof e!="string"?e.name:e);return i?this._timeZoneByFieldName?this._timeZoneByFieldName.get(i.name):i.type==="date"||i.type==="esriFieldTypeDate"?(J.getLogger("esri.layers.support.FieldsIndex").errorOnce(new U("getTimeZone:no-timezone-information",`no time zone information for field '${i.name}'`)),wb):h5e.has(i.type)?eS:null:null}getLuxonTimeZone(e){const i=this.getTimeZone(e);return i?i===eS?Fp.instance:i===wb?ba.utcInstance:zb(LNt,i,()=>iu.create(i)):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return bJe(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){return this.get(e)?.name??void 0}toJSON(){return{fields:this.fields.map(e=>ee.isSerializable(e)?e.toJSON():e),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}};function ox(t){return t.trim().toLowerCase()}function ibe(t){return JYe(t)?.toLowerCase()??""}const h5e=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function rbe(t){const e=new Map;if(!t.fields)return e;const i=t.datesInUnknownTimezone===!0,{timeInfo:r,editFieldsInfo:s}=t,n=(r?"startField"in r?r.startField:r.startTimeField:"")??"",o=(r?"endField"in r?r.endField:r.endTimeField:"")??"",a=DNt(t)?t.dateFieldsTimeZone??null:t.dateFieldsTimeReference?Uk(t.dateFieldsTimeReference):null,l=s?RNt(s)?s.timeZone??a:s.dateFieldsTimeReference?Uk(s.dateFieldsTimeReference):a??wb:null,c=r?PNt(r)?r.timeZone??a:r.timeReference?Uk(r.timeReference):a:null,h=new Map([[ox(s?.creationDateField??""),l],[ox(s?.editDateField??""),l],[ox(n),c],[ox(o),c]]);for(const{name:d,type:f}of t.fields)if(h5e.has(f))e.set(d,eS);else if(f!=="date"&&f!=="esriFieldTypeDate")e.set(d,null);else if(i)e.set(d,eS);else{const m=h.get(ox(d??""))??a;e.set(d,m)}return e}const NNt={color:[128,128,128,1],outlinecolor:[0,0,0,1],backgroundcolor:[128,128,128,1],borderlinecolor:[0,0,0,1],tintcolor:[255,255,255,1]},xQ={CIMVectorMarker:{scalesymbolsproportionally:!1,respectframe:!0,anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMPictureMarker:{scalex:1,texturefilter:"Draft",anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMTextSymbol:{angle:0,anglex:0,angley:0,halosize:1,height:10,horizontalalignment:"Left",kerning:!0,letterspacing:0,letterwidth:100,ligatures:!0,linegap:0,offsetx:0,offsety:0,strikethrough:!1,textcase:"Normal",textstring:"",underline:!1,verticalalignment:"Bottom",enable:!0,colorlocked:!1},CIMSolidStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMPictureStroke:{texturefilter:"Draft",capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMGradientStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1,gradientMethod:"AcrossLine",gradientSize:75,gradientSizeUnits:wB.Relative,gradientType:"Discrete",interval:5},CIMSolidFill:{enable:!0,colorlocked:!1},CIMPictureFill:{offsetx:0,offsety:0,rotation:0,scalex:1,height:10,texturefilter:"Draft",enable:!0,colorlocked:!1},CIMHatchFill:{offsetx:0,offsety:0,rotation:0,separation:4,enable:!0,colorlocked:!1},CIMGradientFill:{enable:!0,angle:90,gradientMethod:"Linear",gradientSize:75,gradientSizeUnits:wB.Relative,gradientType:"Discrete",interval:5},CIMGeometricEffectAddControlPoints:{angletolerance:120},CIMGeometricEffectArrow:{arrowtype:"OpenEnded",width:5},CIMGeometricEffectBuffer:{size:1},CIMGeometricEffectCut:{begincut:1,endcut:1,middlecut:0,invert:!1},CIMGeometricEffectDashes:{customendingoffset:0,linedashending:"NoConstraint",offsetalongline:0},CIMGeometricEffectDonut:{method:"Mitered",option:"Accurate",width:2},CIMGeometricEffectJog:{angle:225,length:20,position:50},CIMGeometricEffectControlMeasureLine:{rule:"FullGeometry"},CIMGeometricEffectMove:{offsetx:1,offsety:-1},CIMGeometricEffectOffset:{method:"Square",offset:1,option:"Fast"},CIMGeometricEffectRotate:{angle:15},CIMGeometricEffectScale:{xscalefactor:1.15,yscalefactor:1.15},CIMGeometricEffectWave:{amplitude:2,period:3,seed:1,waveform:"Sinus"},CIMMarkerPlacementAlongLine:{customendingoffset:0,endings:"WithHalfGap",offsetalongline:0,placeperpart:!0,angletoline:!0,offset:0},CIMMarkerPlacementAtExtremities:{extremityplacement:"Both",offsetalongline:0,angletoline:!0,offset:0},CIMMarkerPlacementAtRatioPositions:{beginposition:0,endposition:0,flipfirst:!0,angletoline:!0,offset:0},CIMMarkerPlacementInsidePolygon:{gridangle:0,gridtype:"Fixed",offsetx:0,offsety:0,randomness:100,seed:0,shiftoddrows:!1,stepx:16,stepy:16,clipping:"ClipAtBoundary"},CIMMarkerPlacementOnLine:{relativeto:"LineMiddle",startpointoffset:0,angletoline:!0,offset:0},CIMMarkerPlacementOnVertices:{placeperpart:!0,placeoncontrolpoints:!0,placeonendpoints:!0,placeonregularvertices:!0,angletoline:!0,offset:0},CIMMarkerPlacementPolygonCenter:{method:"OnPolygon",offsetx:0,offsety:0,clipatboundary:!1},CIMAnimatedSymbolProperties:{playanimation:!1,reverseanimation:!1,randomizestarttime:!1,randomizestartseed:0,starttimeoffset:0,duration:3,endingduration:3,useendingduration:!1,repeattype:PX.Loop,repeatdelay:0,easing:DX.Linear},CIMSymbolAnimationSize:{tosize:10},CIMSymbolAnimationScale:{scalefactor:1},CIMSymbolAnimationColor:{tocolor:[255,255,255,1]},CIMSymbolAnimationTransparency:{totransparency:0},CIMSymbolAnimationRotation:{torotation:0,rotateclockwise:!1},CIMSymbolAnimationOffset:{offsetx:0,offsety:0}};function FNt(t){return typeof t=="function"}function Wdi(t,e,i,r){return FNt(t)?t(e,i,r):t}function Zdi(t){return[t.r,t.g,t.b,t.a]}const kNt=` /-,
`;function sbe(t){let e=t.length;for(;e--;)if(!kNt.includes(t.charAt(e)))return!1;return!0}function Ydi(t,e){const i=[];let r=0,s=-1;do if(s=t.indexOf("[",r),s>=r){if(s>r){const n=t.slice(r,s);i.push([n,null,sbe(n)])}if(r=s+1,s=t.indexOf("]",r),s>=r){if(s>r){const n=e[t.slice(r,s)];n&&i.push([null,n,!1])}r=s+1}}while(s!==-1);if(r<t.length){const n=t.slice(r);i.push([n,null,sbe(n)])}return i}function Jdi(t,e,i,r){let s="",n=null;for(const o of e){const[a,l,c]=o;if(a)c?n=a:(n&&(s+=n,n=null),s+=a);else{let h=l;i!=null&&(h=d5e(l,i));const d=t.attributes[h];d&&(n&&(s+=n,n=null),s+=d)}}return zNt(s,r)}function zNt(t,e){switch(typeof t!="string"&&(t=String(t)),e){case"LowerCase":return t.toLowerCase();case"Allcaps":return t.toUpperCase();default:return t}}function Xdi(t,e,i,r,s,n,o=!0){const a=e/s,l=i/n,c=Math.ceil(a/2),h=Math.ceil(l/2);for(let d=0;d<n;d++)for(let f=0;f<s;f++){const m=4*(f+(o?n-d-1:d)*s);let y=0,v=0,_=0,b=0,w=0,x=0,S=0;const C=(d+.5)*l;for(let T=Math.floor(d*l);T<(d+1)*l;T++){const M=Math.abs(C-(T+.5))/h,I=(f+.5)*a,P=M*M;for(let D=Math.floor(f*a);D<(f+1)*a;D++){let F=Math.abs(I-(D+.5))/c;const L=Math.sqrt(P+F*F);L>=-1&&L<=1&&(y=2*L*L*L-3*L*L+1,y>0&&(F=4*(D+T*e),S+=y*t[F+3],_+=y,t[F+3]<255&&(y=y*t[F+3]/250),b+=y*t[F],w+=y*t[F+1],x+=y*t[F+2],v+=y))}}r[m]=b/v,r[m+1]=w/v,r[m+2]=x/v,r[m+3]=S/_}}function UNt(t){return t?[t[0],t[1],t[2],t[3]/255]:[0,0,0,0]}function Kdi(t){return t.data?.symbol??null}function Qdi(t){return t.type==="CIMVectorMarker"||t.type==="CIMPictureMarker"||t.type==="CIMBarChartMarker"||t.type==="CIMCharacterMarker"||t.type==="CIMPieChartMarker"||t.type==="CIMStackedBarChartMarker"}function epi(t){return t.type==="CIMGradientStroke"||t.type==="CIMPictureStroke"||t.type==="CIMSolidStroke"}function tpi(t){return t!=null&&(t.type==="CIMGradientFill"||t.type==="CIMHatchFill"||t.type==="CIMPictureFill"||t.type==="CIMSolidFill"||t.type==="CIMWaterFill")}function BNt(t){return t!=null&&(t.type==="CIMMarkerPlacementAlongLineRandomSize"||t.type==="CIMMarkerPlacementAlongLineSameSize"||t.type==="CIMMarkerPlacementAlongLineVariableSize"||t.type==="CIMMarkerPlacementAtExtremities"||t.type==="CIMMarkerPlacementAtMeasuredUnits"||t.type==="CIMMarkerPlacementAtRatioPositions"||t.type==="CIMMarkerPlacementOnLine"||t.type==="CIMMarkerPlacementOnVertices")}const ipi=(t,e=0)=>t==null||isNaN(t)?e:t,rpi=(t,e)=>t??e,spi=(t,e)=>t??e,npi=t=>t.tintColor?UNt(t.tintColor):[255,255,255,1],opi=t=>{if(!t)return!1;for(const e of t)switch(e.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function api(){return V(()=>import("./geometryEngineJSON-oRyFp_Dn.js").then(t=>t.g),__vite__mapDeps([10,11,3,12]))}function lpi(t){if(!t)return"normal";switch(t.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function cpi(t){if(!t)return"normal";switch(t.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function upi(t){let e="normal",i="normal";if(t){const r=t.toLowerCase();r.includes("italic")?e="italic":r.includes("oblique")&&(e="oblique"),r.includes("bold")?i="bold":r.includes("light")&&(i="lighter")}return{style:e,weight:i}}function hpi(t){return t.underline?"underline":t.strikethrough?"line-through":"none"}function nbe(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const i=nbe(e);if(i!=null)return i}break;case"CIMTextSymbol":return nbe(t.symbol);case"CIMSolidFill":return t.color}return null}function obe(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const e=t.symbolLayers;if(e)for(const i of e){const r=obe(i);if(r!=null)return r}break}case"CIMTextSymbol":return obe(t.symbol);case"CIMSolidStroke":return t.color}}function abe(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const i=abe(e);if(i!==void 0)return i}break;case"CIMTextSymbol":return abe(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}}function dpi(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function ppi(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function fpi(t){return(t?Object.keys(t):[]).map(e=>({name:e,alias:e,type:typeof t[e]=="string"?"esriFieldTypeString":"esriFieldTypeDouble"}))}const mpi=t=>t.includes("data:image/svg+xml");function gpi(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function Hoe(t){return t&&t.charAt(0).toLowerCase()+t.slice(1)}function ypi(t,e,i,r,s,n,o=!0){const{infos:a}=n;let l=1,c=0,h=0,d=0,f=1;for(const{absoluteAnchorPoint:v,offsetX:_,offsetY:b,rotation:w,size:x,frameHeight:S,rotateClockWise:C,scaleSymbolsProportionally:T}of a)f=v?1:l,h=cbe(_,b,c,f,h),d=lbe(_,b,c,f,d),S&&(T||o)&&(l*=x/S),c=ube(w,C,c);const m=cbe(r,s,c,f,h),y=lbe(r,s,c,f,d);return{size:t*l,rotation:ube(e,i,c),offsetX:m,offsetY:y}}function VNt(t){if(t==null)return!1;if(Array.isArray(t))return t.every(e=>VNt(e));switch(typeof t){case"string":return!!t;case"number":return!isNaN(t)}}function jNt(t,e){if(e==="color"||e==="outlinecolor"||e==="backgroundcolor"||e==="borderlinecolor"||e==="tintcolor")return[...NNt[e]];const i=xQ[t];if(!i)throw new Error(`InternalError: default value for type ${t}.`);return i[e]}function GNt(t){return t.split(" ").map(e=>Number(e))}function HNt(t){return typeof t=="string"?GNt(t):t}function vpi(t){return t?.dashTemplate&&(t.dashTemplate=HNt(t.dashTemplate)),t}function SQ(t){if(t==null)return"Normal";switch(t.type){case"CIMTextSymbol":return t.textCase??"Normal";case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const e=t.symbolLayers;if(!e)return"Normal";for(const i of e)if(i.type==="CIMVectorMarker")return SQ(i)}break;case"CIMVectorMarker":{const e=t.markerGraphics;if(!e)return"Normal";for(const i of e)if(i.symbol)return SQ(i.symbol)}}return"Normal"}function _pi(t){if(t)switch(t.type){case"CIMTextSymbol":return t.height;case"CIMPointSymbol":{let e=0;if(t.symbolLayers){for(const i of t.symbolLayers)if(i)switch(i.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const r=i.size??xQ.CIMVectorMarker.size;r>e&&(e=r);break}}}return e}case"CIMLineSymbol":case"CIMPolygonSymbol":{let e=0;if(t.symbolLayers){for(const i of t.symbolLayers)if(i)switch(i.type){case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const r=i.width;r!=null&&r>e&&(e=r);break}case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":if(i.markerPlacement&&BNt(i.markerPlacement)){const r=i.size??xQ.CIMVectorMarker.size;r>e&&(e=r)}break;case"CIMPictureFill":{const r=i.height;r!=null&&r>e&&(e=r)}}}return e}}}function d5e(t,e){if(e!==null){const i=e.get(t);return i?i.name:t}return t}function bpi(t){return t.map(e=>({...e,propertyName:Hoe(e.propertyName)}))}function wpi(t){const e={};for(const i in t){const r=t[i];e[Hoe(i)]=r}return e}function lbe(t,e,i,r,s){const n=i*Math.PI/180;if(n){const o=Math.cos(n);return(Math.sin(n)*t+o*e)*r+s}return e*r+s}function cbe(t,e,i,r,s){const n=i*Math.PI/180;return n?(Math.cos(n)*t-Math.sin(n)*e)*r+s:t*r+s}function ube(t,e,i){return e?i-t:i+t}function xpi(t,e,i){const r=i==="Color"||i==="TintColor"||i==="ToColor",s=i==="Rotation"||i==="Angle"||i==="ToRotation";let n=e[Hoe(i)];if(n!=null&&(r?n=[n[0]/255,n[1]/255,n[2]/255,n[3]/255]:s&&(n*=Math.PI/180)),n==null&&(n=jNt(e.type,i.toLowerCase()),n!=null&&(r?n=[n[0]/255,n[1]/255,n[2]/255,n[3]]:s&&(n*=Math.PI/180))),e.primitiveName!=null){const o=t[e.primitiveName];if(o!=null){const a=o[i];a==null||(typeof a=="string"||typeof a=="number"||Array.isArray(a)?(n=a,n!=null&&(r?n=[n[0]/255,n[1]/255,n[2]/255,n[3]/255]:s&&(n*=Math.PI/180))):(n={valueExpressionInfo:a,defaultValue:n},n!=null&&(r?n={type:"Process",op:"ArcadeColor",value:n}:s&&(n={type:"Process",op:"Divide",left:n,right:180/Math.PI}))))}}if(n==null)throw new Error(`Failed to derive a value or an expression for "${i}".`);return n}function Spi(t,e){return Math.max(Math.min((t??e)/100,1),0)}const hbe="esri.renderers.support.DictionaryLoader",qNt={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let p5e=class{constructor(e,i,r){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new INt(100),this._dictionaryVersion=null,this._fieldIndex=null,this._dictionaryPromise=null,this.url=e,this.config=i,this.fieldMap=r}getSymbolFields(){return this._symbolFields}async getSymbolAsync(e,i){let r;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(i));try{r=await this._dictionaryPromise}catch(d){if(Xr(d))return this._dictionaryPromise=null,null}const s=this._dictionaryVersion?.greaterEqual(4,0),n={};if(this.fieldMap)for(const d of this._symbolFields){const f=d5e(this.fieldMap[d],this._fieldIndex);if(f){const m=e.attributes[f];n[d]=s?m:m!=null?""+e.attributes[f]:""}else n[d]=""}let o=null;try{o=r?.(n,i)}catch{return null}if(!o||typeof o!="string"||o==="invalid")return null;const a=o.split(";"),l=[],c=[];for(let d=0;d<a.length;d++){const f=a[d];if(f){if(f.includes("po:")){const m=f.slice(3).split("|");if(m.length===3){const y=m[0],v=m[1];let _=m[2];const b="countrylabel";if(y===b&&v==="TextString"){if(this.fieldMap!=null){let w=this.fieldMap[b];w==null&&(w=b,this.fieldMap[w]=w),e.attributes[w]=_}continue}if(v==="DashTemplate")_=_.split(" ").map(w=>Number(w));else if(v==="Color"){const w=new qe(_).toRgba();_=[w[0],w[1],w[2],255*w[3]]}else _=Number(_);c.push({primitiveName:y,propertyName:v,value:_,defaultValue:null})}}else if(f.includes("|")){for(const m of f.split("|"))if(this._itemNames.has(m)){l.push(m);break}}else if(this._itemNames.has(f))l.push(f);else if(d===0){l.length=0;let m="Invalid_P";e.geometry!=null&&(nb(e.geometry)?m="Invalid_A":AV(e.geometry)&&(m="Invalid_L")),l.push(m);break}}}const h=e.geometry==null||!e.geometry.hasZ&&e.geometry.type==="point";return this._cimPartsToCIMSymbol(e,l,c,h,i)}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void J.getLogger(hbe).error("no valid URL!");const i=Ci(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:e!=null?e.signal:null}),[{data:r}]=await Promise.all([i,av()]);if(!r)throw this._dictionaryPromise=null,new U("esri.renderers.DictionaryRenderer","Bad dictionary data!");const{authoringInfo:s,dictionary_version:n,expression:o,itemsNames:a}=r,l=o;let c=!1;n&&(this._dictionaryVersion=$D.parse(n),c=this._dictionaryVersion.greaterEqual(4,0)),this._refSymbolUrlTemplate=this.url+"/"+r.cimRefTemplateUrl,this._itemNames=new Set(a),this._symbolFields=s.symbol;const h={};if(this.config){const m=this.config;for(const y in m)h[y]=m[y]}if(s.configuration)for(const m of s.configuration)h.hasOwnProperty(m.name)||(h[m.name]=m.value);const d=[];if(e?.fields&&this.fieldMap)for(const m in this.fieldMap){const y=this.fieldMap[m],v=e.fields.filter(_=>_.name.toLowerCase()===y?.toLowerCase());v.length>0&&d.push({...v[0],type:c?v[0].type:"esriFieldTypeString"})}d.length>0&&(this._fieldIndex=new u5e(d));const f=WYe(l,e!=null?e.spatialReference:null,d,h).then(m=>{const y={scale:0};return(v,_)=>{if(m==null)return null;const b=m.repurposeFeature({geometry:null,attributes:v});return y.scale=_!=null?_.scale??void 0:void 0,m.evaluate({$feature:b,$view:y},m.services)}}).catch(m=>(J.getLogger(hbe).error("Creating dictionary expression failed:",m),null));return this._dictionaryPromise=f,f}async _cimPartsToCIMSymbol(e,i,r,s,n){const o=new Array(i.length);for(let c=0;c<i.length;c++)o[c]=this._getSymbolPart(i[c],n);let a=await Promise.all(o);const l=this.fieldMap;if(l&&a.length>0){const{OverrideHelper:c}=await V(()=>import("./OverrideHelper-DIx2mYgX.js"),__vite__mapDeps([143,144]));a=q(a);for(const h of a)c.applyDictionaryTextOverrides(h,e,l,this._fieldIndex,SQ(h))}return new jb({data:WNt(a,r,s)})}async _getSymbolPart(e,i){const r=this._symbolCache.get(e);if(r)return r;if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then(o=>o.data);const s=this._refSymbolUrlTemplate.replaceAll(/\{itemName\}/gi,e),n=Ci(s,{responseType:"json",query:{f:"json"},...i});this._ongoingRequests.set(e,n),n.finally(()=>this._ongoingRequests.delete(e));try{const o=await n;return this._symbolCache.put(e,o.data),o.data}catch(o){throw o}}};function WNt(t,e,i){if(!t||t.length===0)return null;const r={...t[0]};if(t.length>1){r.effects=null,r.symbolLayers=[];for(const s of t){const n=s;if(n.effects!=null)for(const o of n.symbolLayers)o.effects==null?o.effects=n.effects:o.effects.unshift(...n.effects);r.symbolLayers.unshift(...n.symbolLayers)}}return i&&(r.callout=qNt),{type:"CIMSymbolReference",symbol:r,primitiveOverrides:e}}var TQ;let xp=TQ=class extends HA(zv){constructor(t){super(t),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new p5e(this.url,this.config,this.fieldMap)}writeData(t,e){t&&(e.scalingExpressionInfo={expression:t,returnType:"number"})}writeVisualVariables(t,e,i,r){r?.origin||super.writeVisualVariables(t,e,i,r)}clone(){return new TQ({config:q(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:q(this.fieldMap),url:q(this.url),visualVariables:q(this.visualVariables)})}async getSymbolAsync(t,e){return this._loader.getSymbolAsync(t,e)}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e),this.scaleExpression&&await Al(t,e,this.scaleExpression);for(const i in this.fieldMap){const r=this.fieldMap[i];e.has(r)&&t.add(r)}}get arcadeRequired(){return!0}getSymbol(){return null}get symbols(){return[]}getAttributeHash(){return this.visualVariables?.reduce((t,e)=>t+e.getAttributeHash(),"")??""}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};u([p({type:p5e})],xp.prototype,"_loader",null),u([p({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],xp.prototype,"config",void 0),u([p({type:Object,json:{write:!0}})],xp.prototype,"fieldMap",void 0),u([p({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],xp.prototype,"scaleExpression",void 0),u([ge("scaleExpression")],xp.prototype,"writeData",null),u([p({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(t){return{enabled:!!t&&!!this.scaleExpression}}}}})],xp.prototype,"scaleExpressionTitle",void 0),u([p({type:String,json:{write:!0}})],xp.prototype,"url",void 0),u([ge("visualVariables")],xp.prototype,"writeVisualVariables",null),xp=TQ=u([A("esri.renderers.DictionaryRenderer")],xp);const ZNt=xp;var EQ;let my=EQ=class extends ee{constructor(t){super(t),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(t){return t==null?t:typeof t=="function"?(J.getLogger(this).error(".field: field must be a string value"),null):H3(t)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new EQ({color:this.color?.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([p({type:qe,json:{type:[Number],write:!0}})],my.prototype,"color",void 0),u([p({type:String,json:{write:!0}})],my.prototype,"field",void 0),u([Yt("field")],my.prototype,"castField",null),u([p({type:String,json:{write:!0}})],my.prototype,"label",void 0),u([p({type:String,json:{write:!0}})],my.prototype,"valueExpression",void 0),u([p({type:String,json:{write:!0}})],my.prototype,"valueExpressionTitle",void 0),my=EQ=u([A("esri.renderers.support.AttributeColorInfo")],my);const f5e=my;var CQ;let W5=CQ=class extends ee{constructor(){super(...arguments),this.unit=null}clone(){return new CQ({unit:this.unit})}};u([p({type:String,json:{write:!0}})],W5.prototype,"unit",void 0),W5=CQ=u([A("esri.renderers.support.DotDensityLegendOptions")],W5);const YNt=W5;var $Q;let $c=$Q=class extends HA(zv){constructor(t){super(t),this.attributes=null,this.backgroundColor=new qe([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new uh,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(t){if(this.referenceScale==null)return this.dotValue;const e=t/this.referenceScale*this.dotValue;return e<1?1:e}getSymbol(){return new NS({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes?.reduce((t,e)=>t+e.getAttributeHash(),"")??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new $Q({attributes:q(this.attributes),backgroundColor:q(this.backgroundColor),dotBlendingEnabled:q(this.dotBlendingEnabled),dotShape:q(this.dotShape),dotSize:q(this.dotSize),dotValue:q(this.dotValue),legendOptions:q(this.legendOptions),outline:q(this.outline),referenceScale:q(this.referenceScale),seed:q(this.seed),visualVariables:q(this.visualVariables),authoringInfo:q(this.authoringInfo)})}getControllerHash(){return`${this.attributes?.map(e=>e.field||e.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e);for(const i of this.attributes??[])i.valueExpression&&await Al(t,e,i.valueExpression),i.field&&t.add(i.field)}};u([p({type:[f5e],json:{write:!0}})],$c.prototype,"attributes",void 0),u([p({type:qe,json:{write:!0}})],$c.prototype,"backgroundColor",void 0),u([p({type:Boolean,json:{write:!0}})],$c.prototype,"dotBlendingEnabled",void 0),u([p({type:String,json:{write:!1}})],$c.prototype,"dotShape",void 0),u([p({type:Number,json:{write:!0}})],$c.prototype,"dotSize",void 0),u([p({type:YNt,json:{write:!0}})],$c.prototype,"legendOptions",void 0),u([p({type:uh,json:{default:null,write:!0}})],$c.prototype,"outline",void 0),u([p({type:Number,json:{write:!0}})],$c.prototype,"dotValue",void 0),u([p({type:Number,json:{write:!0}})],$c.prototype,"referenceScale",void 0),u([p({type:Number,json:{write:!0}})],$c.prototype,"seed",void 0),u([Ue({dotDensity:"dot-density"})],$c.prototype,"type",void 0),$c=$Q=u([A("esri.renderers.DotDensityRenderer")],$c);const JNt=$c;var AQ;let QI=AQ=class extends ee{constructor(t){super(t),this.color=null,this.ratio=null}clone(){return new AQ({color:this.color&&this.color.clone(),ratio:this.ratio})}};u([p({type:qe,json:{type:[Ei],default:null,write:{isRequired:!0}}})],QI.prototype,"color",void 0),u([p({type:Number,json:{write:{isRequired:!0}}})],QI.prototype,"ratio",void 0),QI=AQ=u([A("esri.renderers.support.HeatmapColorStop")],QI);const Z5=QI;let _2=class extends Dt.ClonableMixin(ee){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};u([p({type:String,json:{write:!0}})],_2.prototype,"minLabel",void 0),u([p({type:String,json:{write:!0}})],_2.prototype,"maxLabel",void 0),u([p({type:String,json:{write:!0}})],_2.prototype,"title",void 0),_2=u([A("esri.renderers.support.HeatmapLegendOptions")],_2);const qoe=2.4;function XNt(t){return $d(t*qoe)}function KNt(t){return tS(t)/qoe}function QNt(t,e,i,r){let{color:s,ratio:n}=e,{color:o,ratio:a}=i;a===n&&(a===1?n-=1e-6:a+=1e-6);const l=ce((r-n)/(a-n),0,1);bj(t,s.toArray(),o.toArray(),l)}function Cpi(t){const i=new Uint8ClampedArray(2048);if(t=t.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),t.length<1)return i;let r=t[0],s=t[0],n=1;const o=pi();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>s.ratio&&n<t.length;)r=s,s=t[n++];QNt(o,r,s,l),i.set(o,4*a)}return i}function $pi(t,e,i){const r=Math.sqrt(t**2+e**2)/i;return r>1?0:3/(Math.PI*i**2)*(1-r**2)**2}function Api(t){return typeof t=="function"?t:t?e=>+e[t]:()=>1}var MQ;function dbe(t){if(t!=null){const{maxDensity:e,minDensity:i,radius:r}=t;if(e!=null||i!=null||r!=null){const{blurRadius:s,maxPixelIntensity:n,minPixelIntensity:o,...a}=t;return a}}return t}let la=MQ=class extends zv{constructor(t){super(t),this.authoringInfo=null,this.colorStops=[new Z5({ratio:0,color:new qe("rgba(255, 140, 0, 0)")}),new Z5({ratio:.75,color:new qe("rgba(255, 140, 0, 1)")}),new Z5({ratio:.9,color:new qe("rgba(255, 0,   0, 1)")})],this.field=null,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null}normalizeCtorArgs(t){return dbe(t)}get blurRadius(){return KNt(this.radius)}set blurRadius(t){const e=this.maxPixelIntensity,i=this.minPixelIntensity;this._set("radius",XNt(t)),this._set("maxDensity",e*this._pixelIntensityToDensity),this._set("minDensity",i*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(t){this._set("maxDensity",t*this._pixelIntensityToDensity)}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(t){this._set("minDensity",t*this._pixelIntensityToDensity)}get _pixelIntensityToDensity(){return 24/(qoe**2*this.blurRadius**4)}read(t,e){t=dbe(t),super.read(t,e)}getSymbol(){return new ug}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol()]}async collectRequiredFields(t,e){const i=this.field,r=this.valueExpression;i&&typeof i=="string"&&cc(t,e,i),r&&typeof r=="string"&&await Al(t,e,r)}getAttributeHash(){return""}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new MQ({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:q(this.colorStops),field:this.field,legendOptions:q(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([p({type:Ioe,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],la.prototype,"authoringInfo",void 0),u([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],la.prototype,"blurRadius",null),u([p({type:[Z5],json:{write:{isRequired:!0}}})],la.prototype,"colorStops",void 0),u([p({type:String,json:{write:!0}})],la.prototype,"field",void 0),u([p({type:_2,json:{write:!0}})],la.prototype,"legendOptions",void 0),u([p({type:Number,json:{write:!0}})],la.prototype,"maxDensity",void 0),u([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],la.prototype,"maxPixelIntensity",null),u([p({type:Number,json:{write:!0}})],la.prototype,"minDensity",void 0),u([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],la.prototype,"minPixelIntensity",null),u([p({type:Number,cast:sr,json:{write:!0}})],la.prototype,"radius",void 0),u([p({type:Number,range:{min:0},json:{default:0,write:!0}})],la.prototype,"referenceScale",void 0),u([Ue({heatmap:"heatmap"})],la.prototype,"type",void 0),u([p({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],la.prototype,"valueExpression",void 0),u([p({type:String})],la.prototype,"valueExpressionTitle",void 0),u([p({readOnly:!0})],la.prototype,"_pixelIntensityToDensity",null),la=MQ=u([A("esri.renderers.HeatmapRenderer")],la);const m5e=la;let ax=class extends Dt.ClonableMixin(ee){constructor(){super(...arguments),this.color=new qe([0,0,0,0]),this.label=null,this.threshold=0}};u([p({type:qe,json:{write:!0}})],ax.prototype,"color",void 0),u([p({type:String,json:{write:!0}})],ax.prototype,"label",void 0),u([p({type:Number,range:{min:0,max:1},json:{write:!0}})],ax.prototype,"threshold",void 0),ax=u([A("esri.renderers.support.OthersCategory")],ax);const eFt={base:GA,key:"type",typeMap:{size:LG,opacity:Roe}};let Ac=class extends HA(Dt.ClonableMixin(zv)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new qe([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new ax,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart",this.visualVariables=null}getSymbol(){return new ug({size:this.size?this.size/2+(this.outline?.width||0):0})}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(of)}getAttributeHash(){return this.visualVariables?.reduce((e,i)=>e+i.getAttributeHash(),"")??""}getMeshHash(){return this.symbols.reduce((e,i)=>e+JSON.stringify(i),"")}async collectRequiredFields(e,i){await this.collectVVRequiredFields(e,i);for(const r of this.attributes)r.valueExpression&&await Al(e,i,r.valueExpression),r.field&&e.add(r.field)}};u([p({type:[f5e],json:{write:!0}})],Ac.prototype,"attributes",void 0),u([p(Noe)],Ac.prototype,"backgroundFillSymbol",void 0),u([p({type:qe,json:{write:!0}})],Ac.prototype,"defaultColor",void 0),u([p({type:String,json:{write:!0}})],Ac.prototype,"defaultLabel",void 0),u([p({type:Number,range:{min:0,max:1},json:{write:!0}})],Ac.prototype,"holePercentage",void 0),u([p({type:ax,json:{write:!0}})],Ac.prototype,"othersCategory",void 0),u([p({type:Foe,json:{write:!0}})],Ac.prototype,"legendOptions",void 0),u([p({type:uh,json:{default:null,write:!0}})],Ac.prototype,"outline",void 0),u([p({type:Number,cast:sr,json:{write:!0}})],Ac.prototype,"size",void 0),u([Ue({pieChart:"pie-chart"})],Ac.prototype,"type",void 0),u([p({types:[eFt]})],Ac.prototype,"visualVariables",void 0),Ac=u([A("esri.renderers.PieChartRenderer")],Ac);const tFt=Ac,sL={key:"type",base:zv,typeMap:{heatmap:m5e,simple:ev,"unique-value":koe,"class-breaks":c5e,"dot-density":JNt,dictionary:ZNt,"pie-chart":tFt},errorContext:"renderer"},iFt={key:"type",base:zv,typeMap:{simple:ev,"unique-value":koe,"class-breaks":c5e,heatmap:m5e},errorContext:"renderer",validate:rFt};function rFt(t){switch(t.type){case"simple":return sFt(t);case"unique-value":return nFt(t);case"class-breaks":return oFt(t);case"heatmap":return t}}function sFt(t){if(t.symbol)return t;J.getLogger("esri.renderers.support.types").error("Removed invalid 'simple' renderer without a symbol from web scene.")}function nFt(t){const e=t.uniqueValueInfos,i=e?.filter(({symbol:r,label:s},n)=>(r||J.getLogger("esri.renderers.support.types").error(`Removed invalid unique value info ([${n}] ${s}) without a symbol from web scene.`),!!r));return i?.length!==e?.length&&(t.uniqueValueInfos=i),t}function oFt(t){const e=t.classBreakInfos,i=e?.filter(({symbol:r,label:s},n)=>(r||J.getLogger("esri.renderers.support.types").error(`Removed invalid class break info ([${n}] ${s}) without a symbol from web scene.`),!!r));return i?.length!==e?.length&&(t.classBreakInfos=i),t}function Ipi(t,e){return I3(t,null,e)}const aFt=dA({types:sL});function I3(t,e,i){return t?t&&(t.styleName||t.styleUrl)&&t.type!=="uniqueValue"?(i?.messages&&i.messages.push(new sh("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+t.type+"'",{definition:t,context:i})),null):aFt(t,e,i):null}var OQ;let hl=OQ=class extends pb{constructor(t){super(t),this.type="binning",this.binType="geohash",this.fixedBinLevel=null,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.size=sr("12px"),this.fields=[],this.renderer=null}writeFields(t,e,i){const r=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());to(i,r,e)}readRenderer(t,e,i){const r=e.drawingInfo?.renderer;return r?I3(r,e,i)??void 0:Boe(e,i)}clone(){return new OQ({fields:q(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:q(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:q(this.popupTemplate),renderer:q(this.renderer),binType:q(this.binType),size:this.size})}};u([Ue({binning:"binning"})],hl.prototype,"type",void 0),u([Ue({geohash:"geohash",square:"square"}),p({type:["geohash","square"]})],hl.prototype,"binType",void 0),u([p({type:Number,json:{write:!0}})],hl.prototype,"fixedBinLevel",void 0),u([p({type:[rL],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],hl.prototype,"labelingInfo",void 0),u([p(DG)],hl.prototype,"labelsVisible",void 0),u([p({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],hl.prototype,"maxScale",void 0),u([p(PG)],hl.prototype,"popupEnabled",void 0),u([p({type:CA,json:{name:"popupInfo",write:!0}})],hl.prototype,"popupTemplate",void 0),u([p({cast:t=>t==="auto"?t:ec(sr(t))})],hl.prototype,"size",void 0),u([p({type:[Nb],json:{write:!0}})],hl.prototype,"fields",void 0),u([ge("fields")],hl.prototype,"writeFields",null),u([p({types:sL,json:{write:{target:"drawingInfo.renderer"}}})],hl.prototype,"renderer",void 0),u([me("renderer",["drawingInfo.renderer"])],hl.prototype,"readRenderer",null),hl=OQ=u([A("esri.layers.support.FeatureReductionBinning")],hl);const g5e=hl;var IQ;function pbe(t){return t.type==="simple"&&!t.visualVariables?.length}let ho=IQ=class extends ee{constructor(t){super(t),this.type="cluster",this.clusterRadius=sr("80px"),this.clusterMinSize=sr("12px"),this.clusterMaxSize=sr("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=[]}readRenderer(t,e,i){const r=e.drawingInfo?.renderer;return r?.authoringInfo?.isAutoGenerated?null:r?pbe(r)?null:I3(r,e,i)??void 0:Boe(e,i)}readSymbol(t,e,i){const r=e.drawingInfo?.renderer;return r?.authoringInfo?.isAutoGenerated?null:r&&pbe(r)?I3(r,e,i)?.symbol:null}writeSymbol(t,e,i,r){const s=this.renderer?.authoringInfo?.isAutoGenerated;if(!this.renderer||s){const n=new ev({symbol:t});e.drawingInfo={renderer:n.write({},r)}}}writeFields(t,e,i){const r=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());to(i,r,e)}readFields(t,e,i){return t.filter(r=>!r.isAutoGenerated).map(r=>Nb.fromJSON(r))}clone(){return new IQ({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:q(this.labelingInfo),labelsVisible:this.labelsVisible,fields:q(this.fields),maxScale:this.maxScale,renderer:q(this.renderer),symbol:q(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:q(this.popupTemplate)})}};u([p({type:["cluster"],readOnly:!0,json:{write:!0}})],ho.prototype,"type",void 0),u([p({cast:t=>t==="auto"?t:ec(sr(t)),json:{write:!0}})],ho.prototype,"clusterRadius",void 0),u([p({type:Number,cast:sr,json:{write:!0}})],ho.prototype,"clusterMinSize",void 0),u([p({type:Number,cast:sr,json:{write:!0}})],ho.prototype,"clusterMaxSize",void 0),u([p({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],ho.prototype,"maxScale",void 0),u([p(PG)],ho.prototype,"popupEnabled",void 0),u([p({type:CA,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],ho.prototype,"popupTemplate",void 0),u([p({types:sL,json:{write:{target:"drawingInfo.renderer"}}})],ho.prototype,"renderer",void 0),u([me("renderer",["drawingInfo.renderer"])],ho.prototype,"readRenderer",null),u([p({types:UXe})],ho.prototype,"symbol",void 0),u([me("symbol",["drawingInfo.renderer"])],ho.prototype,"readSymbol",null),u([ge("symbol")],ho.prototype,"writeSymbol",null),u([p({type:[rL],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],ho.prototype,"labelingInfo",void 0),u([p(DG)],ho.prototype,"labelsVisible",void 0),u([p({type:[Nb],json:{write:!0}})],ho.prototype,"fields",void 0),u([ge("fields")],ho.prototype,"writeFields",null),u([me("fields")],ho.prototype,"readFields",null),ho=IQ=u([A("esri.layers.support.FeatureReductionCluster")],ho);const y5e=ho;var RQ;let Y5=RQ=class extends pb{constructor(t){super(t),this.type="selection"}clone(){return new RQ}};u([p({type:["selection"]})],Y5.prototype,"type",void 0),Y5=RQ=u([A("esri.layers.support.FeatureReductionSelection")],Y5);const fbe=Y5,mbe={key:"type",base:pb,typeMap:{cluster:y5e,binning:g5e}},lFt={types:{key:"type",base:pb,typeMap:{selection:fbe,cluster:y5e,binning:g5e}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:mbe},"portal-item":{types:mbe},"web-scene":{types:{key:"type",base:pb,typeMap:{selection:fbe}},name:"layerDefinition.featureReduction",write:{layerContainerTypes:Ys}}}}},rE={Base64:0,Hex:1,String:2,Raw:3},WC=8,v5e=(1<<WC)-1;function eb(t,e){const i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function cFt(t){const e=[];for(let i=0,r=t.length*WC;i<r;i+=WC)e[i>>5]|=(t.charCodeAt(i/WC)&v5e)<<i%32;return e}function uFt(t){const e=[];for(let i=0,r=32*t.length;i<r;i+=WC)e.push(String.fromCharCode(t[i>>5]>>>i%32&v5e));return e.join("")}function hFt(t){const e="0123456789abcdef",i=[];for(let r=0,s=4*t.length;r<s;r++)i.push(e.charAt(t[r>>2]>>r%4*8+4&15)+e.charAt(t[r>>2]>>r%4*8&15));return i.join("")}function dFt(t){const e="=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=[];for(let s=0,n=4*t.length;s<n;s+=3){const o=(t[s>>2]>>s%4*8&255)<<16|(t[s+1>>2]>>(s+1)%4*8&255)<<8|t[s+2>>2]>>(s+2)%4*8&255;for(let a=0;a<4;a++)8*s+6*a>32*t.length?r.push(e):r.push(i.charAt(o>>6*(3-a)&63))}return r.join("")}function pFt(t,e){return t<<e|t>>>32-e}function kG(t,e,i,r,s,n){return eb(pFt(eb(eb(e,t),eb(r,n)),s),i)}function tl(t,e,i,r,s,n,o){return kG(e&i|~e&r,t,e,s,n,o)}function il(t,e,i,r,s,n,o){return kG(e&r|i&~r,t,e,s,n,o)}function rl(t,e,i,r,s,n,o){return kG(e^i^r,t,e,s,n,o)}function sl(t,e,i,r,s,n,o){return kG(i^(e|~r),t,e,s,n,o)}function fFt(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;let i=1732584193,r=-271733879,s=-1732584194,n=271733878;for(let o=0;o<t.length;o+=16){const a=i,l=r,c=s,h=n;i=tl(i,r,s,n,t[o],7,-680876936),n=tl(n,i,r,s,t[o+1],12,-389564586),s=tl(s,n,i,r,t[o+2],17,606105819),r=tl(r,s,n,i,t[o+3],22,-1044525330),i=tl(i,r,s,n,t[o+4],7,-176418897),n=tl(n,i,r,s,t[o+5],12,1200080426),s=tl(s,n,i,r,t[o+6],17,-1473231341),r=tl(r,s,n,i,t[o+7],22,-45705983),i=tl(i,r,s,n,t[o+8],7,1770035416),n=tl(n,i,r,s,t[o+9],12,-1958414417),s=tl(s,n,i,r,t[o+10],17,-42063),r=tl(r,s,n,i,t[o+11],22,-1990404162),i=tl(i,r,s,n,t[o+12],7,1804603682),n=tl(n,i,r,s,t[o+13],12,-40341101),s=tl(s,n,i,r,t[o+14],17,-1502002290),r=tl(r,s,n,i,t[o+15],22,1236535329),i=il(i,r,s,n,t[o+1],5,-165796510),n=il(n,i,r,s,t[o+6],9,-1069501632),s=il(s,n,i,r,t[o+11],14,643717713),r=il(r,s,n,i,t[o],20,-373897302),i=il(i,r,s,n,t[o+5],5,-701558691),n=il(n,i,r,s,t[o+10],9,38016083),s=il(s,n,i,r,t[o+15],14,-660478335),r=il(r,s,n,i,t[o+4],20,-405537848),i=il(i,r,s,n,t[o+9],5,568446438),n=il(n,i,r,s,t[o+14],9,-1019803690),s=il(s,n,i,r,t[o+3],14,-187363961),r=il(r,s,n,i,t[o+8],20,1163531501),i=il(i,r,s,n,t[o+13],5,-1444681467),n=il(n,i,r,s,t[o+2],9,-51403784),s=il(s,n,i,r,t[o+7],14,1735328473),r=il(r,s,n,i,t[o+12],20,-1926607734),i=rl(i,r,s,n,t[o+5],4,-378558),n=rl(n,i,r,s,t[o+8],11,-2022574463),s=rl(s,n,i,r,t[o+11],16,1839030562),r=rl(r,s,n,i,t[o+14],23,-35309556),i=rl(i,r,s,n,t[o+1],4,-1530992060),n=rl(n,i,r,s,t[o+4],11,1272893353),s=rl(s,n,i,r,t[o+7],16,-155497632),r=rl(r,s,n,i,t[o+10],23,-1094730640),i=rl(i,r,s,n,t[o+13],4,681279174),n=rl(n,i,r,s,t[o],11,-358537222),s=rl(s,n,i,r,t[o+3],16,-722521979),r=rl(r,s,n,i,t[o+6],23,76029189),i=rl(i,r,s,n,t[o+9],4,-640364487),n=rl(n,i,r,s,t[o+12],11,-421815835),s=rl(s,n,i,r,t[o+15],16,530742520),r=rl(r,s,n,i,t[o+2],23,-995338651),i=sl(i,r,s,n,t[o],6,-198630844),n=sl(n,i,r,s,t[o+7],10,1126891415),s=sl(s,n,i,r,t[o+14],15,-1416354905),r=sl(r,s,n,i,t[o+5],21,-57434055),i=sl(i,r,s,n,t[o+12],6,1700485571),n=sl(n,i,r,s,t[o+3],10,-1894986606),s=sl(s,n,i,r,t[o+10],15,-1051523),r=sl(r,s,n,i,t[o+1],21,-2054922799),i=sl(i,r,s,n,t[o+8],6,1873313359),n=sl(n,i,r,s,t[o+15],10,-30611744),s=sl(s,n,i,r,t[o+6],15,-1560198380),r=sl(r,s,n,i,t[o+13],21,1309151649),i=sl(i,r,s,n,t[o+4],6,-145523070),n=sl(n,i,r,s,t[o+11],10,-1120210379),s=sl(s,n,i,r,t[o+2],15,718787259),r=sl(r,s,n,i,t[o+9],21,-343485551),i=eb(i,a),r=eb(r,l),s=eb(s,c),n=eb(n,h)}return[i,r,s,n]}function _5e(t,e=rE.Hex){const i=e||rE.Base64,r=fFt(cFt(t),t.length*WC);switch(i){case rE.Raw:return r;case rE.Hex:return hFt(r);case rE.String:return uFt(r);case rE.Base64:return dFt(r)}}const mFt=()=>J.getLogger("esri.views.2d.layers.support.clusterUtils");X.add("esri-cluster-arcade-enabled",!0);const gFt=X("esri-cluster-arcade-enabled"),yFt=new Set(["simple-line","simple-fill","picture-fill"]);function gbe(t,e){let i=e.clone();if(!vFt(i))return i;if(e.symbols.some(r=>yFt.has(r.type))&&(i=new ev({symbol:new ug})),i.authoringInfo||(i.authoringInfo=new Ioe),i.authoringInfo.isAutoGenerated=!0,"visualVariables"in i){const r=(i.visualVariables||[]).filter(s=>s.valueExpression!=="$view.scale");r.forEach(s=>{s.type==="rotation"?s.field?s.field=Uw(t,s.field,"avg_angle","number"):s.valueExpression&&(s.field=sO(t,s.valueExpression,"avg_angle","number"),s.valueExpression=null):s.normalizationField?(s.field=Uw(t,s.field,"avg_norm","number",s.normalizationField),s.normalizationField=null):s.field?s.field=Uw(t,s.field,"avg","number"):s.valueExpression&&(s.field=sO(t,s.valueExpression,"avg","number"),s.valueExpression=null)}),i.visualVariables=r}switch(i.type){case"simple":break;case"pie-chart":for(const r of i.attributes)r.field?r.field=Uw(t,r.field,"sum","number"):r.valueExpression&&(r.field=sO(t,r.valueExpression,"sum","number"),r.valueExpression=null);break;case"unique-value":i.field?i.field=Uw(t,i.field,"mode","string"):i.valueExpression&&(i.field=sO(t,i.valueExpression,"mode","string"),i.valueExpression=null);break;case"class-breaks":i.normalizationField?(i.field=Uw(t,i.field,"avg_norm","number",i.normalizationField),i.normalizationField=null):i.field?i.field=Uw(t,i.field,"avg","number"):i.valueExpression&&(i.field=sO(t,i.valueExpression,"avg","number"),i.valueExpression=null)}return i}const vFt=t=>{const e=i=>mFt().error(new U("Unsupported-renderer",i,{renderer:t}));if(!t)return!1;switch(t.type){case"unique-value":if(t.field2||t.field3)return e("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(t.normalizationField){const i=t.normalizationType;if(i!=="field")return e(`FeatureReductionCluster does not support a normalizationType of ${i}`),!1}break;case"simple":case"pie-chart":break;default:return e(`FeatureReductionCluster does not support renderers of type ${t.type}`),!1}if(!gFt){if("valueExpression"in t&&t.valueExpression)return e("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in t&&t.visualVariables||[]).some(i=>!(!("valueExpression"in i)||!i.valueExpression)))return e("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function _Ft(t,e,i){switch(t){case"sum":return`cluster_sum_${e}`;case"avg":case"avg_angle":return`cluster_avg_${e}`;case"mode":return`cluster_type_${e}`;case"avg_norm":{const r=i,s="field",n=e.toLowerCase()+",norm:"+s+","+r.toLowerCase();return"cluster_avg_"+_5e(n)}}}function sO(t,e,i,r){const s=_5e(e),n=i==="mode"?`cluster_type_${s}`:i==="sum"?`cluster_sum_${s}`:`cluster_avg_${s}`;return t.some(o=>o.name===n)||t.push(new Nb({name:n,isAutoGenerated:!0,onStatisticExpression:new Goe({expression:e,returnType:r}),statisticType:i})),n}function Uw(t,e,i,r,s){if(e==="cluster_count"||t.some(o=>o.name===e))return e;const n=_Ft(i,e,s);return t.some(o=>o.name===n)||(i==="avg_norm"?t.push(new Nb({name:n,isAutoGenerated:!0,onStatisticExpression:new Goe({expression:`$feature.${e} / $feature.${s}`,returnType:r}),statisticType:"avg"})):t.push(new Nb({name:n,isAutoGenerated:!0,onStatisticField:e,statisticType:i}))),n}const bFt=t=>{let e=class extends t{constructor(...i){super(...i),this.addHandles(H(()=>this.renderer,()=>{if(this.featureReduction){const r=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",r)}},Gt))}set featureReduction(i){const r=this._normalizeFeatureReduction(i);this._set("featureReduction",r)}set renderer(i){}_withClusterVariable(i,r,s){const n=i.clone();return"visualVariables"in n&&(n.visualVariables||(n.visualVariables=[]),n.visualVariables.some(o=>o.type==="size")||n.visualVariables.push(new LG({field:"cluster_count",stops:[new z5({value:1}),new z5({useMinValue:!0,size:r}),new z5({useMaxValue:!0,size:s})]}))),n}_normalizeFeatureReduction(i){if(i?.type!=="cluster")return i;const r=i.clone(),s=[new Nb({name:"cluster_count",alias:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],n=(r.fields??[]).filter(d=>!d.isAutoGenerated),o=i.renderer&&!i.renderer.authoringInfo?.isAutoGenerated,{clusterMinSize:a,clusterMaxSize:l}=r;if(o){r.fields=[...s,...n];const d=this._withClusterVariable(r.renderer,a,l);return r.effectiveFeatureRenderer=d,r.effectiveClusterRenderer=d,r}if(i.symbol){if(r.fields=[...s,...n],r.renderer=null,!this.renderer)return r.effectiveFeatureRenderer=null,r.effectiveClusterRenderer=null,r;const d=gbe(s,this.renderer),f=this._withClusterVariable(d,a,l),m="visualVariables"in f&&f.visualVariables?f.visualVariables:[],y=new ev({symbol:i.symbol,visualVariables:m});return r.fields=[...s,...n],r.effectiveFeatureRenderer=f,r.effectiveClusterRenderer=y,r}if(!this.renderer)return i;const c=gbe(s,this.renderer);r.fields=[...s,...n],r.renderer=c;const h=this._withClusterVariable(c,a,l);return r.effectiveFeatureRenderer=h,r.effectiveClusterRenderer=h,r}};return u([p(lFt)],e.prototype,"featureReduction",null),e=u([A("esri.layers.mixins.FeatureReductionLayer")],e),e},ybe={ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GeoRSS:!0,GroupLayer:!0,KML:!0,KnowledgeGraphLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WCS:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},vbe={ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,OpenStreetMap:!0,VectorTileLayer:!0,WCS:!0,WMS:!0,WebTiledLayer:!0},_be={ArcGISFeatureLayer:!0,SubtypeGroupTable:!0},wFt={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GroupLayer:!0,IntegratedMesh3DTilesLayer:!0,Object3DTilesLayer:!0,IntegratedMeshLayer:!0,KML:!0,LineOfSightLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,PointCloudLayer:!0,RasterDataLayer:!0,VectorTileLayer:!0,ViewshedLayer:!0,Voxel:!0,WCS:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-scene/basemap":{ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WCS:!0,WMS:!0,WebTiledLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-scene/tables":{ArcGISFeatureLayer:!0},"web-map/operational-layers":ybe,"web-map/basemap":vbe,"web-map/tables":_be,"link-chart/operational-layers":{...ybe,LinkChartLayer:!0},"link-chart/basemap":vbe,"link-chart/tables":_be,"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,BuildingSceneLayer:!0,IntegratedMesh3DTilesLayer:!0,IntegratedMeshLayer:!0,MediaLayer:!0,OrientedImageryLayer:!0,PointCloudLayer:!0,SubtypeGroupLayer:!0,WCS:!0},"portal-item/tables":{ArcGISFeatureLayer:!0,SubtypeGroupTable:!0}},xFt=t=>{let e=class extends t{constructor(){super(...arguments),this.persistenceEnabled=!0,this.title=null}readId(i,r,s){return s?.portalItem?.type==="Group Layer"?void 0:i}writeListMode(i,r,s,n){(n&&n.layerContainerType==="ground"||i&&kje(this,s,{},n))&&(r[s]=i)}writeOperationalLayerType(i,r,s){i&&(r[s]=i)}writeTitle(i,r){r.title=i??"Layer"}readVisibilityTimeExtent(i){return i?To.fromArray(i):null}writeVisibilityTimeExtent(i,r,s,n){i&&n.layerContainerType!=="tables"&&(i.isEmpty?n?.messages&&n.messages.push(new U("layer:invalid-visibilityTimeExtent","visibilityTimeExtent cannot be empty")):r[s]=i.toArray())}read(i,r){r&&(r.layer=this),Nee(this,i,s=>super.read(i,s),r)}write(i,r){if(!this.persistenceEnabled&&!r?.ignorePersistenceEnabled)return null;if(r?.origin){const o=`${r.origin}/${r.layerContainerType||"operational-layers"}`;let l=!!wFt[o]?.[this.operationalLayerType];if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&o==="web-scene/operational-layers"&&(l=!1),this.operationalLayerType==="ArcGISDimensionLayer"&&o==="web-map/operational-layers"&&(l=!1),!l)return r.messages?.push(new U("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${o}'`,{layer:this})),null}const s=super.write(i,{...r,layer:this}),n=!!r&&!!r.messages&&!!r.messages.filter(o=>o instanceof U&&o.name==="web-document-write:property-required").length;return i$(s?.url)?(r?.messages?.push(new U("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&n?null:s}beforeSave(){}};return u([p({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],e.prototype,"id",void 0),u([me("id",["id"])],e.prototype,"readId",null),u([p(D4e)],e.prototype,"listMode",void 0),u([ge("listMode")],e.prototype,"writeListMode",null),u([p({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1},"web-scene":{name:"layerType",read:!1,write:{enabled:!0,ignoreOrigin:!0,layerContainerTypes:Ys,isRequired:!0}}}}})],e.prototype,"operationalLayerType",void 0),u([ge("operationalLayerType")],e.prototype,"writeOperationalLayerType",null),u([p(qK)],e.prototype,"opacity",void 0),u([p({type:Boolean,readOnly:!1})],e.prototype,"persistenceEnabled",void 0),u([p({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],e.prototype,"title",void 0),u([ge("title"),ge(["web-scene"],"title")],e.prototype,"writeTitle",null),u([p({type:To,json:{origins:{"web-scene":{write:{layerContainerTypes:Ys}}}}})],e.prototype,"visibilityTimeExtent",void 0),u([me("visibilityTimeExtent")],e.prototype,"readVisibilityTimeExtent",null),u([ge(["portal-item","web-map","web-scene"],"visibilityTimeExtent",{visibilityTimeExtent:{type:[[Ei,hA]]}})],e.prototype,"writeVisibilityTimeExtent",null),u([p({type:Boolean,json:{name:"visibility",write:{layerContainerTypes:Ys}}})],e.prototype,"visible",void 0),e=u([A("esri.layers.mixins.OperationalLayer")],e),e};var PQ;const ik=new ei({asc:"ascending",desc:"descending"});let b2=PQ=class extends ee{constructor(t){super(t),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new PQ({field:this.field,valueExpression:this.valueExpression,order:this.order})}};u([p({type:String,json:{write:!0}})],b2.prototype,"field",void 0),u([p({type:String,json:{write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],b2.prototype,"valueExpression",void 0),u([p({type:ik.apiValues,json:{type:ik.jsonValues,read:ik.read,write:ik.write}})],b2.prototype,"order",void 0),b2=PQ=u([A("esri.layers.support.OrderByInfo")],b2);const b5e=b2;function SFt(t,e,i){if(!t)return null;const r=t.find(n=>!!n.field);if(!r)return null;const s=new b5e;return s.read(r,i),[s]}function TFt(t,e,i,r){const s=t.find(n=>!!n.field);s&&to(i,[s.toJSON()],e)}const EFt={type:[b5e],json:{origins:{"web-scene":{write:!1,read:!1}},name:"layerDefinition.orderBy",read:{reader:SFt},write:{writer:TFt}}},CFt=t=>{let e=class extends t{constructor(){super(...arguments),this.orderBy=null}};return u([p(EFt)],e.prototype,"orderBy",void 0),e=u([A("esri.layers.mixins.OrderedLayer")],e),e},$Ft=t=>{let e=class extends t{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=Ce(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(i){i!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",i))}readPortalItem(i,r,s){if(r.itemId)return new eh({id:r.itemId,portal:s?.portal})}writePortalItem(i,r){i?.id&&(r.itemId=i.id)}async loadFromPortal(i,r){if(this.portalItem?.id)try{const{load:s}=await V(()=>import("./layersLoader-B3KuHVlW.js"),__vite__mapDeps([368,120,119,121]));return gt(r),await s({instance:this,supportedTypes:i.supportedTypes,validateItem:i.validateItem,supportsData:i.supportsData,layerModuleTypeMap:i.layerModuleTypeMap,populateGroupLayer:i.populateGroupLayer},r)}catch(s){throw Xr(s)||J.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${s}`),s}}async finishLoadEditablePortalLayer(i){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(i).catch(r=>(Vc(r),!0)))}async setUserPrivileges(i,r){if(!Ir.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(r);if(this.url)try{const{features:{edit:s,fullEdit:n},content:{updateItem:o}}=await this._fetchUserPrivileges(i,r);this._set("userHasEditingPrivileges",s),this._set("userHasFullEditingPrivileges",n),this._set("userHasUpdateItemPrivileges",o)}catch(s){Vc(s)}}async _fetchUserPrivileges(i,r){let s=this.portalItem;if(!i||!s||!s.loaded||s.sourceUrl)return this._fetchFallbackUserPrivileges(r);const n=!mr?.findCredential(this.url),o=i===s.id;if(o&&s.portal.user)return this._getUserPrivileges(s,n);let a,l;if(o)a=s.portal.url;else try{a=await Gte(this.url,r)}catch(f){Vc(f)}if(!a||!Dxe(a,s.portal.url))return this._fetchFallbackUserPrivileges(r);try{const f=r!=null?r.signal:null;l=await mr?.getCredential(`${a}/sharing`,{prompt:!1,signal:f})}catch(f){Vc(f)}const c=!0,h=!1,d=!1;if(!l)return{features:{edit:c,fullEdit:h},content:{updateItem:d}};try{if(o?await s.reload():(s=new eh({id:i,portal:{url:a}}),await s.load(r)),s.portal.user)return this._getUserPrivileges(s,n)}catch(f){Vc(f)}return{features:{edit:c,fullEdit:h},content:{updateItem:d}}}_getUserPrivileges(i,r){const s=IPt(i);return r&&(s.features.edit=!0),s}async _fetchFallbackUserPrivileges(i){let r=!0;try{r=await this._fetchUserHasEditingPrivileges(i)}catch(s){Vc(s)}return{features:{edit:r,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(i){const r=this.url?mr?.findCredential(this.url):null;if(!r)return!0;const s=rk.credential===r?rk.user:await this._fetchEditingUser(i);return rk.credential=r,rk.user=s,s?.privileges==null||s.privileges.includes("features:user:edit")}async _fetchEditingUser(i){const r=this.portalItem?.portal?.user;if(r)return r;const s=mr?.findServerInfo(this.url??"");if(!s?.owningSystemUrl)return null;const n=`${s.owningSystemUrl}/sharing/rest`,o=fn.getDefault();if(o&&o.loaded&&bd(o.restUrl)===bd(n))return o.user;const a=`${n}/community/self`,l=i!=null?i.signal:null,c=await lf(Ci(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?jte.fromJSON(c.value.data):null}read(i,r){r&&(r.layer=this),super.read(i,r)}write(i,r){const s=r?.portal,n=this.portalItem?.id&&(this.portalItem.portal||fn.getDefault());return s&&n&&!Lxe(n.restUrl,s.restUrl)?(r.messages&&r.messages.push(new U("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(i,{...r,layer:this})}};return u([p({type:eh})],e.prototype,"portalItem",null),u([me("web-document","portalItem",["itemId"])],e.prototype,"readPortalItem",null),u([ge("web-document","portalItem",{itemId:{type:String}})],e.prototype,"writePortalItem",null),u([p({clonable:!1})],e.prototype,"resourceReferences",void 0),u([p({type:Boolean,readOnly:!0})],e.prototype,"userHasEditingPrivileges",void 0),u([p({type:Boolean,readOnly:!0})],e.prototype,"userHasFullEditingPrivileges",void 0),u([p({type:Boolean,readOnly:!0})],e.prototype,"userHasUpdateItemPrivileges",void 0),e=u([A("esri.layers.mixins.PortalLayer")],e),e},rk={credential:null,user:null};let eR=class extends ue{constructor(){super(...arguments),this.updating=!1,this.status="unknown"}};u([p()],eR.prototype,"updating",void 0),u([p()],eR.prototype,"status",void 0),eR=u([A("esri.layers.support.PublishingInfo")],eR);const AFt=eR,MFt=Symbol(),OFt=t=>{var e;let i=class extends t{constructor(){super(...arguments),this[e]=!0}get publishingInfo(){if(this.destroyed)return null;const r=this._get("publishingInfo");if(r)return r;const s=new AFt;return this._checkPublishingStatus(s),s}_checkPublishingStatus(r){let o=0;const a=async c=>{let h;r.updating=!0;try{h=await this.fetchPublishingStatus()}catch{h="unavailable"}h!=="published"&&h!=="unavailable"||(r.status==="publishing"&&this.refresh(),l.remove()),r.status=h,r.updating=!1,l.removed||(o=setTimeout(a,c,c+125))},l={removed:!1,remove(){this.removed=!0,clearTimeout(o)}};this.when().catch(()=>l.remove()),a(250),this.addHandles(l)}};return e=MFt,u([p({readOnly:!0,clonable:!1})],i.prototype,"publishingInfo",null),i=u([A("esri.layers.mixins.PublishableLayer")],i),i},tb=new Ee,iP=new WeakMap;function IFt(t){PFt(t)&&tb.push(new WeakRef(t))}function RFt(t){const e=tb.find(i=>i.deref()===t);e&&tb.remove(e)}function PFt(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function w5e(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:w5e(e,t%e):0}let f9=0,sk=0;function DFt(){const t=Date.now();let e=!1;for(const i of tb){const r=i.deref();r?r.refreshInterval&&t-(iP.get(r)??0)+5>=6e4*r.refreshInterval&&(iP.set(r,t),r.refresh(t)):e=!0}if(e)for(let i=tb.length-1;i>=0;i--)tb.at(i).deref()||tb.removeAt(i)}cxe(()=>{const t=Date.now();let e=0;for(const i of tb){const r=i.deref();r&&(e=w5e(Math.round(6e4*r.refreshInterval),e),r.refreshInterval?iP.get(r)||iP.set(r,t):iP.delete(r))}if(e!==sk){if(sk=e,clearInterval(f9),sk===0)return void(f9=0);f9=setInterval(DFt,sk)}},Gt);function Ppi(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const bbe=.1,LFt=t=>{let e=class extends t{constructor(...i){super(...i),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=X3(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||IFt(this)},()=>{})}destroy(){RFt(this)}castRefreshInterval(i){return i>=bbe?i:i<=0?0:bbe}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(i=Date.now()){xP(this._debounceHasDataChanged()).then(r=>{r&&this._set("refreshTimestamp",i),this.emit("refresh",{dataChanged:r})},r=>{J.getLogger(this).error(r),this.emit("refresh",{dataChanged:!1,error:r})})}async hasDataChanged(){return!0}get test(){}};return u([p({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:Ys}}}}})],e.prototype,"refreshInterval",void 0),u([Yt("refreshInterval")],e.prototype,"castRefreshInterval",null),u([p({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),u([p({readOnly:!0})],e.prototype,"refreshParameters",null),e=u([A("esri.layers.mixins.RefreshableLayer")],e),e},NFt=t=>{let e=class extends t{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const i={minScale:this.minScale,maxScale:this.maxScale},r=this.parent;r&&"effectiveScaleRange"in r&&FFt(i,r.effectiveScaleRange);const s=this._get("effectiveScaleRange");return s&&s.minScale===i.minScale&&s.maxScale===i.maxScale?s:i}};return u([p({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minScale",void 0),u([p({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"maxScale",void 0),u([p({readOnly:!0})],e.prototype,"effectiveScaleRange",null),e=u([A("esri.layers.mixins.ScaleRangeLayer")],e),e};function FFt(t,e){return t.minScale=t.minScale>0?e.minScale>0?Math.min(t.minScale,e.minScale):t.minScale:e.minScale,t.maxScale=t.maxScale>0?e.maxScale>0?Math.max(t.maxScale,e.maxScale):t.maxScale:e.maxScale,t}function wbe(t,e){return _S.fromJSON({value:t,unit:e})}let Da=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeZone=null,this.trackIdField=null,this.useTime=!0,this.stops=null}readFullTimeExtent(e,i){return i.timeExtent&&Array.isArray(i.timeExtent)&&i.timeExtent.length===2?To.fromArray(i.timeExtent):null}writeFullTimeExtent(e,i){e?.start!=null&&e.end!=null?i.timeExtent=e.toArray():i.timeExtent=null}readInterval(e,i){return i.timeInterval&&i.timeIntervalUnits?wbe(i.timeInterval,i.timeIntervalUnits):i.defaultTimeInterval&&i.defaultTimeIntervalUnits?wbe(i.defaultTimeInterval,i.defaultTimeIntervalUnits):null}writeInterval(e,i){i.timeInterval=e?.toJSON().value??null,i.timeIntervalUnits=e?.toJSON().unit??null}};u([p({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],Da.prototype,"cumulative",void 0),u([p({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],Da.prototype,"endField",void 0),u([p({type:To,json:{write:{enabled:!0,allowNull:!0}}})],Da.prototype,"fullTimeExtent",void 0),u([me("fullTimeExtent",["timeExtent"])],Da.prototype,"readFullTimeExtent",null),u([ge("fullTimeExtent")],Da.prototype,"writeFullTimeExtent",null),u([p({type:Boolean,json:{write:!0}})],Da.prototype,"hasLiveData",void 0),u([p({type:_S,json:{write:{enabled:!0,allowNull:!0}}})],Da.prototype,"interval",void 0),u([me("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],Da.prototype,"readInterval",null),u([ge("interval")],Da.prototype,"writeInterval",null),u([p({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],Da.prototype,"startField",void 0),u([p(Jz("timeReference",!0))],Da.prototype,"timeZone",void 0),u([p({type:String,json:{write:{enabled:!0,allowNull:!0}}})],Da.prototype,"trackIdField",void 0),u([p({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],Da.prototype,"useTime",void 0),u([p({type:[Date],json:{read:!1}})],Da.prototype,"stops",void 0),Da=u([A("esri.layers.support.TimeInfo")],Da);const x5e=Da,kFt={type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation",layerContainerTypes:Ys}}},zFt=t=>{let e=class extends t{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(i,r){const s=r.timeInfo.exportOptions;if(!s)return null;const n=s.timeOffset,o=woe.fromJSON(s.timeOffsetUnits);return n&&o?new _S({value:n,unit:o}):null}set timeInfo(i){pCe(i,this.fieldsIndex),this._set("timeInfo",i)}};return u([p({type:To,json:{write:!1}})],e.prototype,"timeExtent",void 0),u([p({type:_S})],e.prototype,"timeOffset",void 0),u([me("service","timeOffset",["timeInfo.exportOptions"])],e.prototype,"readOffset",null),u([p({value:null,type:x5e,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.prototype,"timeInfo",null),u([p(kFt)],e.prototype,"useViewTime",void 0),e=u([A("esri.layers.mixins.TemporalLayer")],e),e};let H1=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.labelingInfo=null,this.labelsVisible=!0,this.renderer=null,this.visible=!0}};u([p({type:[rL],json:{write:!0}})],H1.prototype,"labelingInfo",void 0),u([p(DG)],H1.prototype,"labelsVisible",void 0),u([p({types:sL,json:{write:!0}})],H1.prototype,"renderer",void 0),u([p({type:Boolean,json:{write:!0}})],H1.prototype,"visible",void 0),H1=u([A("esri.layers.support.TrackPartInfo")],H1);const ZC=H1;let Mc=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.enabled=!0,this.fields=[],this.latestObservations=new ZC({renderer:new ev({symbol:OB.clone()})}),this.maxDisplayDuration=null,this.maxDisplayObservationsPerTrack=0,this.popupEnabled=!0,this.popupTemplate=null,this.previousObservations=new ZC({renderer:new ev({symbol:OB.clone()})}),this.trackLines=new ZC({renderer:new ev({symbol:Doe.clone()})}),this.timeField="startTimeField"}writeFields(e,i,r){const s=e.filter(n=>n.statisticType!=="avg_angle").map(n=>n.toJSON());to(r,s,i)}};u([p({type:Boolean,json:{write:!0}})],Mc.prototype,"enabled",void 0),u([p({type:[Nb],json:{write:!0}})],Mc.prototype,"fields",void 0),u([ge("fields")],Mc.prototype,"writeFields",null),u([p({type:ZC,json:{write:!0}})],Mc.prototype,"latestObservations",void 0),u([p({type:_S,json:{write:!0}})],Mc.prototype,"maxDisplayDuration",void 0),u([p({type:Number,json:{write:!0}})],Mc.prototype,"maxDisplayObservationsPerTrack",void 0),u([p(PG)],Mc.prototype,"popupEnabled",void 0),u([p({type:CA,json:{name:"popupInfo",write:!0}})],Mc.prototype,"popupTemplate",void 0),u([p({type:ZC,json:{write:!0}})],Mc.prototype,"previousObservations",void 0),u([p({type:ZC,json:{write:!0}})],Mc.prototype,"trackLines",void 0),u([p({type:["timeReceived","startTimeField","endTimeField"],json:{read:!0,write:!0}})],Mc.prototype,"timeField",void 0),Mc=u([A("esri.layers.support.TrackInfo")],Mc);const UFt=Mc,BFt=t=>{let e=class extends t{constructor(){super(...arguments),this.trackInfo=null}};return u([p({type:UFt})],e.prototype,"trackInfo",void 0),e=u([A("esri.layers.mixins.TrackableLayer")],e),e},xbe=new ei({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let n_=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};u([p({json:{write:!0}})],n_.prototype,"name",void 0),u([p({json:{write:!0}})],n_.prototype,"description",void 0),u([p({json:{read:xbe.read,write:xbe.write}})],n_.prototype,"drawingTool",void 0),u([p({json:{write:!0}})],n_.prototype,"prototype",void 0),u([p({json:{write:!0}})],n_.prototype,"thumbnail",void 0),n_=u([A("esri.layers.support.FeatureTemplate")],n_);const Woe=n_;let gy=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const i={};for(const r of Object.keys(e))i[r]=rj(e[r]);return i}writeDomains(e,i){const r={};for(const s of Object.keys(e))e[s]&&(r[s]=e[s]?.toJSON());i.domains=r}};u([p({json:{write:!0}})],gy.prototype,"id",void 0),u([p({json:{write:!0}})],gy.prototype,"name",void 0),u([p({json:{write:!0}})],gy.prototype,"domains",void 0),u([me("domains")],gy.prototype,"readDomains",null),u([ge("domains")],gy.prototype,"writeDomains",null),u([p({type:[Woe],json:{write:!0}})],gy.prototype,"templates",void 0),gy=u([A("esri.layers.support.FeatureType")],gy);const S5e=gy;function VFt(){return{fields:{type:[sj],value:null,set:function(t){if(t&&X("big-integer-warning-enabled")){const e=t.filter(i=>i.type==="big-integer"||i.type==="oid"&&(i.length||0)>=8);if(e.length){const i=e.map(r=>`'${r.name}'`).join(", ");J.getLogger(this).warn("#fields",`Layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}') references big-integer field(s): ${i}, support for which is experimental. Only integers less than ${Number.MAX_SAFE_INTEGER} (Number.MAX_SAFE_INTEGER) are supported.`)}}this._set("fields",t)}},fieldsIndex:{readOnly:!0,get(){return u5e.fromLayer(this)}},outFields:{type:[String],json:{read:!1},set:function(t){this._userOutFields=t,this.notifyChange("outFields")},get:function(){const t=this._userOutFields;if(!t?.length)return null;if(t.includes("*"))return["*"];if(!this.fields)return t;for(const e of t)this.fieldsIndex?.has(e)||J.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${e} found in outFields`,{layer:this,outFields:t});return WV(this.fieldsIndex,t)}}}}const m9=()=>J.getLogger("esri.layers.support.labelingInfo"),jFt=/\[([^[\]]+)\]/gi;function g9(t,e,i){return t?t.map(r=>{const s=new rL;if(s.read(r,i),s.labelExpression){const n=e.fields||e.layerDefinition?.fields||this.fields;s.labelExpression=s.labelExpression.replaceAll(jFt,(o,a)=>`[${GFt(a,n)}]`)}return s}):null}function GFt(t,e){if(!e)return t;const i=t.toLowerCase();for(let r=0;r<e.length;r++){const s=e[r].name;if(s.toLowerCase()===i)return s}return t}const HFt={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryMultiPatch:["always-horizontal"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along","above-along","below-along"],esriGeometryMultipoint:null,esriGeometryEnvelope:null};function zpi(t,e){const i=[];for(const r of t){const s=r.labelPlacement,n=HFt[e];if(!r.symbol)return m9().warn("No ILabelClass symbol specified."),[];if(!n)return m9().error(new U("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${e}' is not supported`)),[];if(n.includes(s))i.push(r);else{const o=n[0];s&&m9().warn(`Found invalid label placement type ${s} for ${e}. Defaulting to ${o}`);const a=r.clone();a.labelPlacement=o,i.push(a)}}return i}const qFt="relationships/",WFt="expression/";let Gl=class extends ue{constructor(e){super(e),this._featureUtils=null,this.effectivePopupTemplate=null}get _arcadeTask(){return this.expressionsUsedInTitle.length>0?this._get("_arcadeTask")||ag(()=>av()):null}get featureUtilsPromise(){return this._get("featureUtilsPromise")??V(()=>import("./featureUtils-nB1KYXwd.js"),__vite__mapDeps([103,6])).then(e=>this._featureUtils=e)}get calculatedExpressions(){const e=new Ee;if(!this.expressionsUsedInTitle.length)return e;if(!this._arcadeTask?.value){for(const i of this.expressionsUsedInTitle??[])e.push({name:i.name,invalid:!0});return e}for(const i of this.expressionsUsedInTitle)try{const r=this._arcadeTask.value.arcade.parseScript(i.expression,["$layer","$map","$datastore"]);if(r.isAsync){e.push({name:i.name,invalid:!0});break}e.push({name:i.name,syntax:r,invalid:!1,func:this._arcadeTask.value.arcade.compileScript(r,{vars:{$feature:"any"}})})}catch{e.push({name:i.name,invalid:!0});break}return e}get expressionsUsedInTitle(){let e=this.effectivePopupTemplate?.title??"";return typeof e!="string"?[]:(e=e.toLowerCase(),this.effectivePopupTemplate?.expressionInfos?.filter(i=>e.includes(`{expression/${i.name.toLowerCase()}}`))??[])}get fieldInfoMap(){return this._featureUtils?this._createFieldInfoMap(this._featureUtils.getAllFieldInfos(this.effectivePopupTemplate)):null}get hasBadExpressions(){return this.calculatedExpressions.some(e=>e.invalid===!0)}get requiredFields(){const e=new Set;if(this._arcadeTask?.value&&!this.hasBadExpressions)for(const r of this.calculatedExpressions?.toArray()??[])try{const s=this._arcadeTask.value.arcade.extractFieldLiterals(r.syntax);for(const n of s){const o=n.split("."),a=this.fieldsIndex.get(o.at(-1)??"");a&&e.add(a.name)}}catch{}const i=this._extractFieldNames(this.workingTitle);for(const r of i){const s=this.fieldsIndex.get(r);s&&e.add(s.name)}return e}get titleFromDisplayField(){let e="";return this.displayField&&(e=this.fieldsIndex.get(this.displayField)?.name??""),e||(e=this.fieldsIndex.get(this.objectIdField)?.name??""),e?`{${e}}`:""}get workingTitle(){const e=this.effectivePopupTemplate?this.effectivePopupTemplate.title:"";return e===""||e==null||this.hasBadExpressions||typeof e!="string"?this.titleFromDisplayField:e}async getTitle(e,i,r){try{const{attributes:s}=i,n=r?.timeZone??"system",[{substituteFieldsInLinksAndAttributes:o}]=await Promise.all([this.featureUtilsPromise,this._arcadeTask?.promise]);if(r.fetchMissingFields&&(i=await this._checkAndReQueryGraphic(e,i)),this.workingTitle&&this.fieldInfoMap){const a=this._createFormattedAttributes(e,i,n).global;return o({attributes:s,expressionAttributes:null,fieldInfoMap:this.fieldInfoMap,globalAttributes:a,layer:e,text:this.workingTitle})}return""}catch{}return""}async _checkAndReQueryGraphic(e,i){const r=i.getObjectId();if(r==null)return i;if(!AJe(this.requiredFields,i)){const s=e.createQuery();s.where="1=1",s.outFields=[...this.requiredFields],s.objectIds=[r];const n=await e.queryFeatures(s);if(n?.features.length===1)return n.features[0]}return i}_createFieldInfoMap(e){const i=new Map;if(!e)return i;for(const r of e){if(!r.fieldName)continue;const s=this.fieldsIndex.get(r.fieldName),n=s?.name??r.fieldName;r.fieldName=n,i.set(n.toLowerCase(),r)}return i}_createFormattedAttributes(e,i,r="system"){const s=this.effectivePopupTemplate?.fieldInfos??[],n={};if(!this._featureUtils)return{};if(!this.hasBadExpressions&&this.calculatedExpressions.length>0&&this._arcadeTask?.value){const a=this._arcadeTask.value.Feature.createFromGraphicLikeObject(i.geometry,i.attributes,e,null);for(const l of this.calculatedExpressions)try{n[`expression/${l.name}`]=l.func({vars:{$feature:a}})}catch{}}const o={...i.attributes,...n};return{global:this._featureUtils.formatAttributes({fieldInfos:s,attributes:o,graphic:i,timeZone:r,layer:e,fieldInfoMap:this.fieldInfoMap}),content:[]}}_extractFieldNames(e){return iie(e).filter(i=>!(i.indexOf(qFt)===0||i.indexOf(WFt)===0))}};u([p({readOnly:!0})],Gl.prototype,"_arcadeTask",null),u([p()],Gl.prototype,"_featureUtils",void 0),u([p({readOnly:!0})],Gl.prototype,"featureUtilsPromise",null),u([p({readOnly:!0})],Gl.prototype,"calculatedExpressions",null),u([p()],Gl.prototype,"displayField",void 0),u([p()],Gl.prototype,"effectivePopupTemplate",void 0),u([p()],Gl.prototype,"expressionsUsedInTitle",null),u([p()],Gl.prototype,"fieldsIndex",void 0),u([p()],Gl.prototype,"fieldInfoMap",null),u([p()],Gl.prototype,"fields",void 0),u([p()],Gl.prototype,"objectIdField",void 0),u([p()],Gl.prototype,"requiredFields",null),Gl=u([A("esri.layers.support.TitleCreator")],Gl);const ZFt=Gl,w2=[];function YFt(t,e){if(Rz(t.url??""))return!0;const{wkid:i}=e;for(const r of w2){if((t.version??0)>=r[0])return!0;if(typeof r[1]=="function"&&(r[1]=r[1]()),r[1].has(i))return!1}return!0}w2.push([10.91,()=>{const t=new Set([9709,9716,9741,9761,9766]);for(let e=9712;e<=9713;e++)t.add(e);for(let e=9748;e<=9749;e++)t.add(e);for(let e=20904;e<=20932;e++)t.add(e);for(let e=21004;e<=21032;e++)t.add(e);for(let e=21207;e<=21264;e++)t.add(e);for(let e=21307;e<=21364;e++)t.add(e);for(let e=23301;e<=23333;e++)t.add(e);for(let e=102759;e<=102760;e++)t.add(e);for(let e=102934;e<=102955;e++)t.add(e);return t}]),w2.push([10.9,()=>{const t=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let e=9356;e<=9360;e++)t.add(e);for(let e=9404;e<=9407;e++)t.add(e);for(let e=9476;e<=9482;e++)t.add(e);for(let e=9487;e<=9494;e++)t.add(e);for(let e=9697;e<=9699;e++)t.add(e);return t}]),w2.push([10.81,()=>{const t=new Set([9265,9333,103598,103699]);for(let e=9248;e<=9254;e++)t.add(e);for(let e=9271;e<=9273;e++)t.add(e);for(let e=9284;e<=9285;e++)t.add(e);for(let e=21453;e<=21463;e++)t.add(e);return t}]),w2.push([10.8,()=>{const t=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let e=8035;e<=8036;e++)t.add(e);for(let e=8455;e<=8456;e++)t.add(e);for(let e=8518;e<=8529;e++)t.add(e);for(let e=8533;e<=8536;e++)t.add(e);for(let e=8538;e<=8540;e++)t.add(e);for(let e=8677;e<=8679;e++)t.add(e);for(let e=8902;e<=8903;e++)t.add(e);for(let e=8907;e<=8910;e++)t.add(e);for(let e=8949;e<=8951;e++)t.add(e);for(let e=8972;e<=8987;e++)t.add(e);for(let e=9039;e<=9040;e++)t.add(e);for(let e=9068;e<=9069;e++)t.add(e);for(let e=9140;e<=9141;e++)t.add(e);for(let e=9148;e<=9150;e++)t.add(e);for(let e=9153;e<=9159;e++)t.add(e);for(let e=9205;e<=9218;e++)t.add(e);for(let e=9221;e<=9222;e++)t.add(e);for(let e=54098;e<=54101;e++)t.add(e);return t}]),w2.push([10.71,()=>{const t=new Set([6316]);for(let e=8351;e<=8353;e++)t.add(e);for(let e=9294;e<=9297;e++)t.add(e);for(let e=22619;e<=22621;e++)t.add(e);for(let e=103586;e<=103594;e++)t.add(e);return t}]);async function JFt(t,e,i){const r=t&&t.getAtOrigin&&t.getAtOrigin("renderer",e.origin);if(r&&r.type==="unique-value"&&r.styleOrigin){const s=await lf(r.populateFromStyle());if(gt(i),s.ok===!1){const n=s.error;e?.messages&&e.messages.push(new sh("renderer:style-reference",`Failed to create unique value renderer from style reference: ${n.message}`,{error:n,context:e})),t.clear("renderer",e?.origin)}}}function XFt({displayField:t,editFieldsInfo:e,fields:i,objectIdField:r,title:s},n){if(!i)return null;const o=tkt({editFieldsInfo:e,fields:i,objectIdField:r},n);if(!o.length)return null;const a=skt({titleBase:s,fields:i,displayField:t}),l=rkt();return new CA({title:a,content:l,fieldInfos:o})}function Bpi(t){const{title:e,graphic:i}=t??{},{attributes:r,sourceLayer:s}=i??{},n=s&&"displayField"in s?s.displayField:null,o=n?r?.[n]:null,a=o!=null?JSON.stringify(o):null,l=i?.getObjectId()?.toString();return e||a||l||""}const KFt=(t,e)=>e.visibleFieldNames?e.visibleFieldNames.has(t.name):cJe(t,e);function QFt({fields:t,ignoreFieldTypes:e,sortDisabled:i}){const r=t;return e&&(t=t.filter(s=>!e.includes(s.type))),t===r&&(t=t.slice()),i!==!0&&t.sort(ekt),t}function ekt(t,e){return t.type==="oid"?-1:e.type==="oid"?1:Sbe(t)?-1:Sbe(e)?1:(t.alias||t.name).toLocaleLowerCase().localeCompare((e.alias||e.name).toLocaleLowerCase())}function tkt(t,e){const i=e?.visibleFieldNames;return QFt({fields:t.fields??[],ignoreFieldTypes:e?.ignoreFieldTypes||nkt,sortDisabled:e?.sortDisabled}).map(r=>new rie({fieldName:r.name,isEditable:lJe(r,t),label:r.alias,format:ikt(r),visible:KFt(r,{...t,visibleFieldNames:i})}))}function ikt(t){switch(t.type){case"small-integer":case"integer":case"single":return new Jk({digitSeparator:!0,places:0});case"double":return new Jk({digitSeparator:!0,places:2});case"string":return OJe(t.name)?new Jk({digitSeparator:!0,places:0}):void 0;default:return}}function rkt(){return[new T$,new S$]}function skt(t){const e=QYe(t),{titleBase:i}=t;return e?`${i}: {${e.trim()}}`:i??""}function Sbe(t){return(t.name&&t.name.toLowerCase())==="name"?!0:t.alias?.toLowerCase()==="name"}const nkt=["geometry","blob","raster","guid","xml"],Ia="FeatureLayer";function nk(t,e){return new U("layer:unsupported",`Layer (${t.title}, ${t.id}) of type '${t.declaredClass}' ${e}`,{layer:t})}function Tbe(t){return t&&t instanceof Ee}const y9=VFt();function v9(t,e,i){const r=!!i?.writeLayerSchema;return{enabled:r,ignoreOrigin:r}}let ot=class extends $Nt(bFt(vDt(OFt(fDt(hDt(sDt(CFt(zFt(BFt(NFt(LFt(R3t(xFt($Ft(eL(nDt(I3t(Dt.ClonableMixin(qV))))))))))))))))))){constructor(...t){super(...t),this.attributeTableTemplate=null,this.charts=null,this.copyright=null,this.displayField=null,this.dynamicDataSource=null,this.fields=null,this.fieldsIndex=null,this.formTemplate=null,this.fullExtent=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.operationalLayerType="ArcGISFeatureLayer",this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.resourceInfo=null,this.screenSizePerspectiveEnabled=!0,this.spatialReference=Ae.WGS84,this.subtypeCode=null,this.supportedSourceTypes=new Set(["Feature Layer","Oriented Imagery Layer","Table","Catalog Layer"]),this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.type="feature",this.typeIdField=null,this.types=null,this.visible=!0,this._debouncedSaveOperations=X3(async(e,i,r)=>{const{save:s,saveAs:n}=await V(()=>import("./featureLayerUtils-kMtRtEXt.js"),__vite__mapDeps([369,370,120]));switch(e){case vl.SAVE:return s(this,i);case vl.SAVE_AS:return n(this,r,i)}})}destroy(){this.source?.destroy()}normalizeCtorArgs(t,e){return typeof t=="string"?{url:t,...e}:t}load(t){const e=t!=null?t.signal:null;if(this.portalItem?.loaded&&this.source)return this.addResolvingPromise(this.createGraphicsSource(e).then(r=>this.initLayerProperties(r))),Promise.resolve(this);const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Scene Service"]},t).catch(Vc).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const r=await this._fetchFirstValidLayerId(e);r!=null&&(this.layerId=r)}if(!this.url&&!this._hasMemorySource())throw new U("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this.initLayerProperties(await this.createGraphicsSource(e))}).then(()=>ZLt(this,"load",t));return this.addResolvingPromise(i),Promise.resolve(this)}get _titleCreator(){const t=this._get("_titleCreator");return Ce(t),new ZFt({fieldsIndex:this.fieldsIndex,objectIdField:this.objectIdField,fields:this.fields,displayField:this.displayField,effectivePopupTemplate:this.popupTemplate??this.defaultPopupTemplate})}readCapabilities(t,e){return e=e.layerDefinition||e,s5e(e,this.url)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")??0)+1}get editingEnabled(){return!(this.loaded&&!this.capabilities?.operations.supportsEditing)&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(t){this._overrideIfSome("editingEnabled",t)}readEditingEnabled(t,e){return this._readEditingEnabled(e,!1)}readEditingEnabledFromWebMap(t,e,i){return this._readEditingEnabled(e,!0,i)}writeEditingEnabled(t,e){this._writeEditingEnabled(t,e,!1)}writeEditingEnabledToWebMap(t,e,i,r){this._writeEditingEnabled(t,e,!0,r)}get effectiveEditingEnabled(){return XLt(this)}get featureTitleFields(){return[...this._titleCreator.requiredFields]}readIsTable(t,e){return(e=e?.layerDefinition??e).type==="Table"||!e.geometryType}writeIsTable(t,e,i,r){r?.writeLayerSchema&&to(i,t?"Table":"Feature Layer",e)}readGlobalIdField(t,e){return W4e(e.layerDefinition||e)}readObjectIdField(t,e){return Z4e(e.layerDefinition||e)}get parsedUrl(){const t=pn(this.url);return t!=null&&(this.dynamicDataSource!=null?t.path=Ed(t.path,"dynamicLayer"):this.layerId!=null&&(t.path=Ed(t.path,this.layerId.toString()))),t}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(t){xue(t,this.fieldsIndex),this._set("renderer",t)}readRenderer(t,e,i){e=e.layerDefinition||e;const r=e.drawingInfo?.renderer;if(r){const s=I3(r,e,i)??void 0;return s||J.getLogger(this).error("Failed to create renderer",{rendererDefinition:e.drawingInfo.renderer,layer:this,context:i}),s}return Boe(e,i)}set source(t){const e=this._get("source");e!==t&&(Tbe(e)&&this._resetMemorySource(e),Tbe(t)&&this._initMemorySource(t),this._set("source",t))}castSource(t){return t?Array.isArray(t)||t instanceof Ee?new Cy({layer:this,items:t}):t:null}readSource(t,e){const i=v4e.fromJSON(e.featureSet);return new Cy({layer:this,items:i?.features??[]})}readTemplates(t,e){const i=e.editFieldsInfo,r=i?.creatorField,s=i?.editorField;return t=t?.map(n=>Woe.fromJSON(n)),this._fixTemplates(t,r),this._fixTemplates(t,s),t}readTitle(t,e){const i=e.layerDefinition?.name??e.name,r=e.title||e.layerDefinition?.title;if(i){const s=this.portalItem?.title;if(this.sublayerTitleMode==="item-title")return this.url?EGe(this.url,i):i;let n=i;if(!n&&this.url){const o=gb(this.url);o!=null&&(n=o.title)}return n?(this.sublayerTitleMode==="item-title-and-service-name"&&s&&s!==n&&(n=s+" - "+n),Xee(n)):void 0}if(this.sublayerTitleMode==="item-title"&&r)return r}readTitleFromWebMap(t,e){return e.title||e.layerDefinition?.name}readTypeIdField(t,e){let i=(e=e.layerDefinition||e).typeIdField;if(i&&e.fields){i=i.toLowerCase();const r=e.fields.find(s=>s.name.toLowerCase()===i);r&&(i=r.name)}return i}readTypes(t,e){t=(e=e.layerDefinition||e).types;const i=e.editFieldsInfo,r=i?.creatorField,s=i?.editorField;return t?.map(n=>(n=S5e.fromJSON(n),this._fixTemplates(n.templates,r),this._fixTemplates(n.templates,s),n))}readVisible(t,e){return e.layerDefinition?.defaultVisibility!=null?!!e.layerDefinition.defaultVisibility:e.visibility!=null?!!e.visibility:void 0}async addAttachment(t,e){const i=await MLt(this,t,e,Ia);return this.lastEditsEventDate=new Date,i}async updateAttachment(t,e,i){const r=await OLt(this,t,e,i,Ia);return this.lastEditsEventDate=new Date,r}async applyEdits(t,e){return ILt(this,t,e)}async uploadAssets(t,e){return RLt(this,t,e)}on(t,e){return super.on(t,e)}createPopupTemplate(t){return XFt(this,t)}async createGraphicsSource(t){if(this._hasMemorySource()&&this.source)return this.source.load({signal:t});const{default:e}=await Ree(V(()=>import("./FeatureLayerSource-BHwRnupK.js"),__vite__mapDeps([371,372,373,374,29,22,375,376,41,39,40,109])),t);return new e({layer:this,supportedSourceTypes:this.supportedSourceTypes}).load({signal:t})}createQuery(){const t=VLt(this);t.dynamicDataSource=this.dynamicDataSource;const e=this.subtypeCode!=null?`${this.subtypeField} = ${this.subtypeCode}`:null,i=TYe(this.definitionExpression,e);return t.where=i||"1=1",t}async deleteAttachments(t,e){const i=await PLt(this,t,e,Ia);return this.lastEditsEventDate=new Date,i}async fetchRecomputedExtents(t){return DLt(this,t,Ia)}getFeatureTitle(t,e={timeZone:"system",fetchMissingFields:!1}){return this._titleCreator.getTitle(this,t,e)}getFeatureType(t){return X4e(this.types,this.typeIdField,t)}getFieldDomain(t,e){return GLt(this,t,e,this.getField(t)?.domain??null)}async queryAttachments(t,e){return LLt(this,t,e,Ia)}async queryFeatures(t,e){const i=await this.load(),r=await i.source.queryFeatures(Jm.from(t)??i.createQuery(),e);if(r?.features)for(const s of r.features)s.layer=s.sourceLayer=i;return r}async queryObjectIds(t,e){return(await NLt(this,t,e,Ia)).filter(v_)}async queryFeatureCount(t,e){return FLt(this,t,e,Ia)}async queryExtent(t,e){return kLt(this,t,e,Ia)}async queryRelatedFeatures(t,e){return zLt(this,t,e,Ia)}async queryRelatedFeaturesCount(t,e){return ULt(this,t,e,Ia)}async queryTopFeatures(t,e){const{source:i,capabilities:r}=await this.load();if(!i.queryTopFeatures||!r?.query?.supportsTopFeaturesQuery)throw new U(Ia,"Layer source does not support queryTopFeatures capability");const s=await V(()=>import("./TopFeaturesQuery-BI6uCROM.js"),[]),n=await i.queryTopFeatures(s.default.from(t),e);if(n?.features)for(const o of n.features)o.layer=o.sourceLayer=this;return n}async queryAttributeBins(t,e){const{source:i,capabilities:r}=await this.load();if(!i.queryAttributeBins||!r?.operations?.supportsQueryBins)throw new U(Ia,"Layer source does not support queryAttributeBins capability");tNt(t,r,Ia);const s=await V(()=>import("./AttributeBinsQuery-CUaDaAln.js"),__vite__mapDeps([174,16,12,23])),n=await i.queryAttributeBins(s.default.from(t),e);if(n.features)for(const o of n.features)o.layer=o.sourceLayer=this;return n}async queryTopObjectIds(t,e){const{source:i,capabilities:r}=await this.load();if(!i.queryTopObjectIds||!r?.query.supportsTopFeaturesQuery)throw new U(Ia,"Layer source does not support queryTopObjectIds capability");const s=await V(()=>import("./TopFeaturesQuery-BI6uCROM.js"),[]);return(await i.queryTopObjectIds(s.default.from(t),e)).filter(v_)}async queryTopFeaturesExtent(t,e){const{source:i,capabilities:r}=await this.load();if(!i.queryTopExtents||!r?.query?.supportsTopFeaturesQuery)throw new U(Ia,"Layer source does not support queryTopExtents capability");const s=await V(()=>import("./TopFeaturesQuery-BI6uCROM.js"),[]);return i.queryTopExtents(s.default.from(t),e)}async queryTopFeatureCount(t,e){const{source:i,capabilities:r}=await this.load();if(!i.queryTopCount||!r?.query?.supportsTopFeaturesQuery)throw new U(Ia,"Layer source does not support queryFeatureCount capability");const s=await V(()=>import("./TopFeaturesQuery-BI6uCROM.js"),[]);return i.queryTopCount(s.default.from(t),e)}read(t,e){const i=t.featureCollection;if((i||t.type==="Feature Collection")&&(this.resourceInfo=t),i){const r=i.layers;r&&r.length===1&&(super.read(r[0],e),i.showLegend!=null&&super.read({showLegend:i.showLegend},e))}super.read(t,e),e&&e.origin==="service"&&(this.revert(["objectIdField","fields","timeInfo","dateFieldsTimeZone"],"service"),this.spatialReference||this.revert(["spatialReference"],"service"))}write(t,e){e={...e,origin:e?.origin??void 0,writeLayerSchema:e?.writeLayerSchema??this._hasMemorySource()};const{origin:i,layerContainerType:r,messages:s}=e;if(this.dynamicDataSource)return s?.push(nk(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if((i==="web-map"||i==="web-scene")&&r!=="tables")return s?.push(nk(this,`a table source can only be written to tables, not ${r}`)),null;if(this._hasMemorySource())return s?.push(nk(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&(i==="web-map"||i==="web-scene")&&r==="tables")return s?.push(nk(this,"using a non-table source cannot be written to tables in web maps or web scenes")),null;return super.write(t,e)}clone(){if(this._hasMemorySource())throw new U(Ia,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(t){return!!this.loaded&&(this.source?.type==="memory"||YFt(this,t))}async save(t){return this._debouncedSaveOperations(vl.SAVE,t)}async saveAs(t,e){return this._debouncedSaveOperations(vl.SAVE_AS,e,t)}_readEditingEnabled(t,e,i){let r=t.layerDefinition?.capabilities;return r?this._hasEditingCapability(r):(r=t.capabilities,e&&i?.origin==="web-map"&&!this._hasMemorySource()&&r?this._hasEditingCapability(r):void 0)}_hasEditingCapability(t){return t.toLowerCase().split(",").map(e=>e.trim()).includes("editing")}_writeEditingEnabled(t,e,i,r){if(!t){const s=this.capabilities?.operations?.supportsSync?"Query,Sync":"Query";to("layerDefinition.capabilities",s,e),i&&!r?.writeLayerSchema&&(e.capabilities=s)}}_fetchFirstValidLayerId(t){return Ci(this.url??"",{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:t}).then(e=>{const i=e.data;if(i)return this.findFirstValidLayerId(i)})}async initLayerProperties(t){return this._set("source",t),t.sourceJSON&&(this.sourceJSON=t.sourceJSON,this.read(t.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl})),this._verifySource(),this._verifyFields(),xue(this.renderer,this.fieldsIndex),pCe(this.timeInfo,this.fieldsIndex),this._hasMemorySource()&&this.geometryType==="mesh"&&(this.capabilities.query.supportsReturnMesh=!0),JFt(this,{origin:"service"})}async hasDataChanged(){return BLt(this)}async fetchPublishingStatus(){const t=this.source;return t?.fetchPublishingStatus?t.fetchPublishingStatus():"unavailable"}_verifyFields(){const t=this.parsedUrl?.path??"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+t+")"),this.isTable||this._hasMemorySource()||t.search(/\/FeatureServer\//i)!==-1||this.fields?.some(e=>e.type==="geometry")||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+t+")")}_fixTemplates(t,e){t&&t.forEach(i=>{const r=i.prototype?.attributes;r&&e&&delete r[e]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new U("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new U("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(t){t.forEach(e=>{e.layer=this,e.sourceLayer=this}),this.addHandles([t.on("after-add",e=>{e.item.layer=this,e.item.sourceLayer=this}),t.on("after-remove",e=>{e.item.layer=null,e.item.sourceLayer=null})],"fl-source")}_resetMemorySource(t){t.forEach(e=>{e.layer=null,e.sourceLayer=null}),this.removeHandles("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}findFirstValidLayerId(t){return Array.isArray(t.layers)&&t.layers.length>0?t.layers[0].id:Array.isArray(t.tables)&&t.tables.length>0?t.tables[0].id:void 0}};u([p({clonable:!1,readOnly:!0})],ot.prototype,"_titleCreator",null),u([p(ODt)],ot.prototype,"attributeTableTemplate",void 0),u([me("service","capabilities")],ot.prototype,"readCapabilities",null),u([p({json:{origins:{"web-scene":{write:!1}},write:!0}})],ot.prototype,"charts",void 0),u([p({readOnly:!0})],ot.prototype,"createQueryVersion",null),u([p({json:{read:{source:"layerDefinition.copyrightText"}}})],ot.prototype,"copyright",void 0),u([p({json:{read:{source:"layerDefinition.displayField"}}})],ot.prototype,"displayField",void 0),u([p({types:H_,readOnly:!0})],ot.prototype,"defaultSymbol",void 0),u([p({type:Mp})],ot.prototype,"dynamicDataSource",void 0),u([p({type:Boolean})],ot.prototype,"editingEnabled",null),u([me(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],ot.prototype,"readEditingEnabled",null),u([me("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],ot.prototype,"readEditingEnabledFromWebMap",null),u([ge(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],ot.prototype,"writeEditingEnabled",null),u([ge("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],ot.prototype,"writeEditingEnabledToWebMap",null),u([p({readOnly:!0})],ot.prototype,"effectiveEditingEnabled",null),u([p({clonable:!1,readOnly:!0})],ot.prototype,"featureTitleFields",null),u([p({...y9.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:v9}}}}})],ot.prototype,"fields",void 0),u([p(y9.fieldsIndex)],ot.prototype,"fieldsIndex",void 0),u([p({type:C3t,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],ot.prototype,"formTemplate",void 0),u([p({json:{read:{source:"layerDefinition.extent"}}})],ot.prototype,"fullExtent",void 0),u([p({json:{origins:{"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:v9,writer(t,e,i){const r=t?mQ.toJSON(t):null;r&&to(i,r,e)}}}},read:{source:"layerDefinition.geometryType",reader:mQ.read}}})],ot.prototype,"geometryType",void 0),u([p({json:{read:{source:"layerDefinition.hasM"}}})],ot.prototype,"hasM",void 0),u([p({json:{read:{source:"layerDefinition.hasZ"}}})],ot.prototype,"hasZ",void 0),u([p($Dt)],ot.prototype,"id",void 0),u([p({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],ot.prototype,"infoFor3D",void 0),u([p({json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],ot.prototype,"isTable",void 0),u([me("service","isTable",["type","geometryType"]),me("isTable",["layerDefinition.type","layerDefinition.geometryType"])],ot.prototype,"readIsTable",null),u([ge("web-map","isTable")],ot.prototype,"writeIsTable",null),u([p(DG)],ot.prototype,"labelsVisible",void 0),u([p({type:[rL],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:g9,write:!1},"web-scene":{name:"layerDefinition.drawingInfo.labelingInfo",read:g9,write:{enabled:!0,layerContainerTypes:Ys}}},name:"layerDefinition.drawingInfo.labelingInfo",read:g9,write:!0}})],ot.prototype,"labelingInfo",void 0),u([p((()=>{const t=q(CDt);return t.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(e,i,r){to(r,hD(e),i)}}},t})())],ot.prototype,"opacity",void 0),u([p(TDt)],ot.prototype,"legendEnabled",void 0),u([p({type:["show","hide"],json:(()=>{const t=q(D4e.json);return t.origins["portal-item"]={read:!1,write:!1},t})()})],ot.prototype,"listMode",void 0),u([me("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],ot.prototype,"readGlobalIdField",null),u([p({json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:v9}}}}})],ot.prototype,"objectIdField",void 0),u([me("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],ot.prototype,"readObjectIdField",null),u([p({type:["ArcGISFeatureLayer"],json:{write:{target:"layerType",ignoreOrigin:!0,layerContainerTypes:Ys}}})],ot.prototype,"operationalLayerType",void 0),u([p(y9.outFields)],ot.prototype,"outFields",void 0),u([p({readOnly:!0})],ot.prototype,"parsedUrl",null),u([p({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],ot.prototype,"path",void 0),u([p(PG)],ot.prototype,"popupEnabled",void 0),u([p({type:CA,json:{name:"popupInfo",write:!0}})],ot.prototype,"popupTemplate",void 0),u([p({readOnly:!0})],ot.prototype,"defaultPopupTemplate",null),u([p({types:sL,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:iFt,name:"layerDefinition.drawingInfo.renderer",write:{layerContainerTypes:Ys,overridePolicy:(t,e,i)=>({ignoreOrigin:i?.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(t,e,i)=>({ignoreOrigin:i?.writeLayerSchema})}}})],ot.prototype,"renderer",null),u([me("service","renderer",["drawingInfo.renderer","defaultSymbol"]),me("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],ot.prototype,"readRenderer",null),u([p()],ot.prototype,"resourceInfo",void 0),u([p((()=>{const t=q(xDt);return t.json.origins["portal-item"]={read:!1,write:!1},t})())],ot.prototype,"screenSizePerspectiveEnabled",void 0),u([p({clonable:!1})],ot.prototype,"source",null),u([Yt("source")],ot.prototype,"castSource",null),u([me("portal-item","source",["featureSet"]),me("web-map","source",["featureSet"])],ot.prototype,"readSource",null),u([p({json:{read:{source:"layerDefinition.extent.spatialReference"}}})],ot.prototype,"spatialReference",void 0),u([p({type:Number})],ot.prototype,"subtypeCode",void 0),u([p({type:[Woe]})],ot.prototype,"templates",void 0),u([me("templates",["editFieldsInfo","creatorField","editorField","templates"])],ot.prototype,"readTemplates",null),u([p({type:x5e})],ot.prototype,"timeInfo",void 0),u([p()],ot.prototype,"title",void 0),u([me("service","title",["name"]),me("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],ot.prototype,"readTitle",null),u([me("web-map","title",["layerDefinition.name","title"])],ot.prototype,"readTitleFromWebMap",null),u([p({type:String})],ot.prototype,"sublayerTitleMode",void 0),u([p({json:{read:!1}})],ot.prototype,"type",void 0),u([p({type:String})],ot.prototype,"typeIdField",void 0),u([me("service","typeIdField"),me("typeIdField",["layerDefinition.typeIdField"])],ot.prototype,"readTypeIdField",null),u([p({type:[S5e]})],ot.prototype,"types",void 0),u([me("service","types",["types"]),me("types",["layerDefinition.types"])],ot.prototype,"readTypes",null),u([p({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],ot.prototype,"visible",void 0),u([me("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],ot.prototype,"readVisible",null),ot=u([A("esri.layers.FeatureLayer")],ot);const Zoe=ot,ok=Object.freeze(Object.defineProperty({__proto__:null,default:Zoe},Symbol.toStringTag,{value:"Module"}));let yy=class extends ee{constructor(e){super(e),this.moment=null,this.fullUpdate=!1,this.validateErrorsCreated=!1,this.exceededTransferLimit=null,this.serviceEdits=null,this.discoveredSubnetworks=null}};u([p({type:Date,json:{type:Number,write:{writer:(t,e)=>{e.moment=t?t.getTime():null}}}})],yy.prototype,"moment",void 0),u([p({type:Boolean,json:{write:!0}})],yy.prototype,"fullUpdate",void 0),u([p({type:Boolean,json:{write:!0}})],yy.prototype,"validateErrorsCreated",void 0),u([p({type:Boolean,json:{write:!0}})],yy.prototype,"exceededTransferLimit",void 0),u([p({type:[Object],json:{write:!0}})],yy.prototype,"serviceEdits",void 0),u([p({type:[Object],json:{write:!0}})],yy.prototype,"discoveredSubnetworks",void 0),yy=u([A("esri.rest.networks.support.ValidateNetworkTopologyResult")],yy);const okt=yy,akt=Mo()({Pending:"job-waiting",InProgress:"job-executing",Completed:"job-succeeded"});let o_=class extends okt{constructor(e){super(e),this.statusUrl=null,this.status=null,this.submissionTime=null,this.lastUpdatedTime=null,this._timer=void 0}destroy(){clearInterval(this._timer)}async checkJobStatus(e){const i={...e,query:{f:"json"}},{data:r}=await Ci(this.statusUrl,i);return this.read(r),this.editsResolver&&this.editsResolver.resolve({edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],exceededTransferLimit:!0,historicMoment:null}),this}async waitForJobCompletion(e={}){const{interval:i=1e3,statusCallback:r}=e;return new Promise((s,n)=>{this._clearTimer();const o=setInterval(()=>{this._timer||n(vi()),this.checkJobStatus().then(a=>{const{status:l}=a;switch(this.status=l,l){case"job-succeeded":this._clearTimer(),s(this);break;case"job-waiting":case"job-executing":r&&r(this)}},a=>{this._clearTimer(),n(a)})},i);this._timer=o})}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};u([p()],o_.prototype,"editsResolver",void 0),u([p({type:String,json:{write:!0}})],o_.prototype,"statusUrl",void 0),u([Ue(akt)],o_.prototype,"status",void 0),u([p({type:Date,json:{type:Number,write:{writer:(t,e)=>{e.submissionTime=t?t.getTime():null}}}})],o_.prototype,"submissionTime",void 0),u([p({type:Date,json:{type:Number,write:{writer:(t,e)=>{e.lastUpdatedTime=t?t.getTime():null}}}})],o_.prototype,"lastUpdatedTime",void 0),o_=u([A("esri.networks.support.TopologyValidationJobInfo")],o_);const lkt=o_;async function Ebe(t,e){if(t==="Utility Network Layer"){const{default:i}=await V(()=>Promise.resolve().then(()=>Ekt),void 0);return new i({layerUrl:e})}return null}async function ckt(t){let e="portalItem"in t?t:{portalItem:t};!e.portalItem||e.portalItem instanceof eh||(e={...e,portalItem:new eh(e.portalItem)});const i=e.portalItem;if(await i.load(),i.type!=="Feature Service")throw new U("portal:unknown-item-type","Unknown item type '${type}'",{type:i.type});const r=i.url,s=await Ci(r,{responseType:"json",query:{f:"json"}}),n="Network Layer";if(s.data.type?.includes(n))return Ebe(s.data.type,r);if(s.data.layers){const o=s.data.layers.find(a=>a.type.includes(n));if(o){const a=`${r}/${o.id}`;return Ebe(o.type,a)}}return null}let qn=class extends eL($l){static fromPortalItem(e){return ckt(e)}constructor(e){super(e),this.id=null,this.title=null,this.layerUrl=null,this.dataElement=null,this.fullExtent=null,this.spatialReference=null,this.type=null,this.sourceJSON=null,this.gdbVersion=null,this.historicMoment=null,this._sourceIdByLayerId=new Map,this._layerIdBySourceId=new Map,this._applyEditsHandler=i=>{const{serviceUrl:r,gdbVersion:s,result:n}=i,o=r===this.featureServiceUrl,a=QR(r,s,this.gdbVersion);o&&a&&n.then(l=>{F5(r,s)&&(this.historicMoment=l.historicMoment)})},this._updateMomentHandler=i=>{const{serviceUrl:r,gdbVersion:s,moment:n}=i,o=r===this.featureServiceUrl,a=QR(r,s,this.gdbVersion);o&&a&&(this.historicMoment=n)},this.when().then(()=>{this.addHandles([C4e(this._applyEditsHandler),$4e(this._updateMomentHandler)])},()=>{})}initialize(){this.when().catch(e=>{Xr(e)||J.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}get datasetName(){return this.dataElement?.name??null}get owner(){return this.dataElement?.userIdentity??null}get schemaGeneration(){return this.dataElement?.schemaGeneration??null}get parsedUrl(){return pn(this.layerUrl)}get featureServiceUrl(){return gb(this.parsedUrl.path).url.path}get networkServiceUrl(){return this.featureServiceUrl.replace(/\/FeatureServer/i,"/UtilityNetworkServer")}get layerId(){return gb(this.parsedUrl.path).sublayer}get networkSystemLayers(){return null}async load(e){return this.addResolvingPromise(this._fetchDataElement(this.featureServiceUrl,this.layerId.toString(),e)),this.addResolvingPromise(this._fetchLayerMetaData(this.layerUrl,e)),this}getLayerIdBySourceId(e){if(!this.dataElement)return null;const i=this._layerIdBySourceId.get(e);if(i!=null)return i;const r=this.dataElement.domainNetworks,s=this._traverseNetworkSources(r,this._layerIdBySourceId,"sourceId","layerId",e);return s>=0?s:null}getSourceIdByLayerId(e){if(!this.dataElement)return null;const i=this._sourceIdByLayerId.get(e);if(i!=null)return i;const r=this.dataElement.domainNetworks,s=this._traverseNetworkSources(r,this._sourceIdByLayerId,"layerId","sourceId",e);return s>=0?s:null}getObjectIdsFromElements(e){const i=[],r=new Map;for(const n of e){const o=this.getLayerIdBySourceId(n.networkSourceId);if(o==null)continue;let a=r.get(o);a===void 0&&(a=[]),a.push(n.objectId),r.set(o,a)}const s=this.featureServiceUrl;return r.forEach((n,o)=>i.push({layerUrl:`${s}/${o}`,objectIds:n})),i}async queryNamedTraceConfigurations(e,i){const[{queryNamedTraceConfigurations:r},{default:s}]=await Promise.all([V(()=>import("./queryNamedTraceConfigurations-BtAQVnLO.js"),[]),V(()=>import("./QueryNamedTraceConfigurationsParameters-BdstCCIK.js"),[])]),n=this.networkServiceUrl,o=s.from(e);return(await r(n,o,{...i}))?.namedTraceConfigurations}async validateTopology(e,i){if(!e.validateArea)throw new U("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");const[{validateNetworkTopology:r},{default:s}]=await Promise.all([V(()=>import("./validateNetworkTopology-Cm1BTn5y.js"),[]),V(()=>import("./ValidateNetworkTopologyParameters-BD-8lNRH.js"),[])]),n=s.from(e);F5(this.featureServiceUrl,this.gdbVersion||null)?(n.sessionID=NK,await S_e(this.featureServiceUrl,this.gdbVersion,!0)):n.sessionID=null,n.gdbVersion=this.gdbVersion;const o=this.networkServiceUrl,a=this.featureServiceUrl,l=T_e(a,null,this.gdbVersion,!0),c=await r(o,n,{...i});if(c?.serviceEdits){const h=[];for(const d of c.serviceEdits){const{editedFeatures:f}=d,m=f?.spatialReference?new Ae(f.spatialReference):null;h.push({layerId:d.layerId,editedFeatures:{adds:f?.adds?.map(y=>ak(y,m))||[],updates:f?.updates?.map(y=>({original:ak(y[0],m),current:ak(y[1],m)}))||[],deletes:f?.deletes?.map(y=>ak(y,m))||[],spatialReference:m}})}l.resolve({edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],editedFeatures:h,exceededTransferLimit:!1,historicMoment:c.moment})}return c}async submitTopologyValidationJob(e,i){let r=null;if(!e.validateArea)throw new U("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");if(!this.gdbVersion){const h=this.layerUrl.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");r=(await Ci(h,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}const[{submitValidateNetworkTopologyJob:s},{default:n}]=await Promise.all([V(()=>import("./validateNetworkTopology-Cm1BTn5y.js"),[]),V(()=>import("./ValidateNetworkTopologyParameters-BD-8lNRH.js"),[])]),o=n.from(e);F5(this.featureServiceUrl,this.gdbVersion||null)?(o.sessionID=NK,await S_e(this.featureServiceUrl,this.gdbVersion,!0)):o.sessionID=null,o.gdbVersion=this.gdbVersion||r;const a=this.networkServiceUrl,l=this.featureServiceUrl?T_e(this.featureServiceUrl,null,this.gdbVersion,!0):void 0,c=await s(a,o,{...i});return new lkt({statusUrl:c,editsResolver:l})}getSourceTypeById(e){if(!this.dataElement)return null;for(const i of this.dataElement.domainNetworks)for(const r of[i.edgeSources??[],i.junctionSources??[]])for(const s of r)if(s.sourceId===e)return r===i.edgeSources?"edge":"junction";return null}_traverseNetworkSources(e,i,r,s,n){for(const o of e)for(const a of[o.edgeSources??[],o.junctionSources??[]])for(const l of a)if(l[r]===n)return i.set(n,l[s]),l[s];return-1}async _fetchLayerMetaData(e,i){const r=await Ci(e,{responseType:"json",query:{f:"json"},...i});this.sourceJSON=r.data,this.read(r.data,{origin:"service"})}async _fetchDataElement(e,i,r){if(this.dataElement)return;const s=await Ci(`${e}/queryDataElements`,{responseType:"json",query:{layers:JSON.stringify([i]),f:"json"},...r}).then(n=>n.data.layerDataElements?.[0]);s&&this.read(s,{origin:"service"})}};function ak(t,e){return new Ml({attributes:t.attributes,geometry:af({...t.geometry,spatialReference:e})})}u([p({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:!0}},read:!1}})],qn.prototype,"id",void 0),u([p({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:{source:"name"}}},read:!1}})],qn.prototype,"title",void 0),u([p({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"url"},write:{target:"url",isRequired:!0}}},read:!1}})],qn.prototype,"layerUrl",void 0),u([p({type:Object,json:{origins:{service:{read:!0}},read:!1}})],qn.prototype,"dataElement",void 0),u([p({type:gi,json:{origins:{service:{read:{source:"extent"}}},read:!1}})],qn.prototype,"fullExtent",void 0),u([p({type:Ae,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:!1}})],qn.prototype,"spatialReference",void 0),u([p({type:["utility","trace"],readOnly:!0,json:{read:!1,write:!1}})],qn.prototype,"type",void 0),u([p({readOnly:!0})],qn.prototype,"datasetName",null),u([p({readOnly:!0})],qn.prototype,"owner",null),u([p({readOnly:!0})],qn.prototype,"schemaGeneration",null),u([p({readOnly:!0})],qn.prototype,"parsedUrl",null),u([p({readOnly:!0})],qn.prototype,"featureServiceUrl",null),u([p({readOnly:!0})],qn.prototype,"networkServiceUrl",null),u([p({readOnly:!0})],qn.prototype,"layerId",null),u([p()],qn.prototype,"sourceJSON",void 0),u([p({readOnly:!0})],qn.prototype,"networkSystemLayers",null),u([p()],qn.prototype,"gdbVersion",void 0),u([p({type:Date})],qn.prototype,"historicMoment",void 0),qn=u([A("esri.networks.Network")],qn);const ukt=qn;var Nc;(function(t){t[t.RTJunctionJunctionConnectivity=1]="RTJunctionJunctionConnectivity",t[t.RTContainment=2]="RTContainment",t[t.RTAttachment=3]="RTAttachment",t[t.RTJunctionEdgeConnectivity=4]="RTJunctionEdgeConnectivity",t[t.RTEdgeJunctionEdgeConnectivity=5]="RTEdgeJunctionEdgeConnectivity"})(Nc||(Nc={}));const lk=new ei({connected:"connected",upstream:"upstream",downstream:"downstream",shortestPath:"shortest-path",subnetwork:"subnetwork",subnetworkController:"subnetwork-controller",loops:"loops",isolation:"isolation"}),Hpi=new ei({junctionJunctionConnectivity:"junction-junction-connectivity",connectivity:"connectivity",attachment:"attachment",containment:"containment",junctionEdgeFromConnectivity:"junction-edge-from-connectivity",junctionEdgeMidspanConnectivity:"junction-edge-midspan-connectivity",junctionEdgeToConnectivity:"junction-edge-to-connectivity"}),hkt={connectivity:1,"junction-junction-connectivity":1,containment:2,attachment:3,"junction-edge-from-connectivity":4,"junction-edge-midspan-connectivity":5,"junction-edge-to-connectivity":6},qpi=new ei({normal:"normal",rebuild:"rebuild",forceRebuild:"force-rebuild"});let a_=class extends ee.JSONSupportMixin($l){constructor(e){super(e),this.rulesCategorized={attachment:[],containment:[],connectivity:[]},this.request=Ci}initialize(){}async load(e){const i=this.rulesLayer.load(e).then(()=>this._initializeRulesTable());return this.addResolvingPromise(i),this}getFeaturesCanAssociateWithClause(e,i,r){return this._getWhereClauseForCompatibleFeatures(e,i,r)}getFeaturesCanAssociateWith(e,i,r){return this._getFeatureSourceLayerId(e)==null?[]:i.filter(s=>this.canAssociateFeatures(e,s,r))}canAssociateFeatures(e,i,r){const[s,n]=this._getFeatureAssetCodes(e),o=this._getFeatureSourceLayerId(e),[a,l]=this._getFeatureAssetCodes(i),c=this._getFeatureSourceLayerId(i);return o!=null&&c!=null&&r.some(h=>{const{type:d,direction:f}=h;return this._getRulesForAssociationType(d).some(m=>this._getRuleFieldValuesForAssociation(m,d,f)?.some(v=>o===v?.ruleLayerIdForSource&&s===v?.ruleAssetGroupCodeForSource&&n===v?.ruleAssetTypeCodeForSource&&c===v?.ruleLayerIdForTarget&&a===v?.ruleAssetGroupCodeForTarget&&l===v?.ruleAssetTypeCodeForTarget))})}getLayersCanAssociateWith(e,i,r){return this._getFeatureSourceLayerId(e)==null?[]:i.filter(s=>this.canAssociateFeatureToLayer(e,s,r))}canAssociateFeatureToLayer(e,i,r){const s=Xh(i)?i.parent:i;if(!s)return!1;const n=s.layerId,o=Xh(i)?i.subtypeCode:null,[a,l]=this._getFeatureAssetCodes(e),c=this._getFeatureSourceLayerId(e);return c!=null&&r.some(h=>{const{type:d,direction:f}=h;return this._getRulesForAssociationType(d).some(m=>this._getRuleFieldValuesForAssociation(m,d,f)?.some(v=>c===v?.ruleLayerIdForSource&&a===v?.ruleAssetGroupCodeForSource&&l===v?.ruleAssetTypeCodeForSource&&n===v?.ruleLayerIdForTarget&&(o==null||o===v?.ruleAssetGroupCodeForTarget)))})}getFeatureSQL(e,i){const r=e.layerId.toString(),s=e.fieldsIndex?.normalizeFieldName("assetGroup"),n=e.fieldsIndex?.normalizeFieldName("assetType"),o=s?i.attributes[s]:null,a=n?i.attributes[n]:null,l=this.rulesHash[r];if(l){const c=l.assetGroupHash[o];if(c)return c.assetTypeHash[a]||null}return null}async _initializeRulesTable(){const e={};let i;(function(s){s[s.from=0]="from",s[s.to=1]="to",s[s.via=2]="via"})(i||(i={}));const r=[{networkSourceId:"fromNetworkSource",assetGroupId:"fromAssetGroup",assetTypeId:"fromAssetType"},{networkSourceId:"toNetworkSource",assetGroupId:"toAssetGroup",assetTypeId:"toAssetType"},{networkSourceId:"viaNetworkSource",assetGroupId:"viaAssetGroup",assetTypeId:"viaAssetType"}];this.rulesCategorized={attachment:[],containment:[],connectivity:[]};for(const s of this.rules){if(s.ruleType===Nc.RTAttachment){this.rulesCategorized.attachment.push(s);continue}if(s.ruleType===Nc.RTContainment){this.rulesCategorized.containment.push(s);continue}if(s.ruleType===Nc.RTJunctionJunctionConnectivity){this.rulesCategorized.connectivity.push(s);continue}this.rulesCategorized.connectivity.push(s);let n=[[i.from,i.to],[i.to,i.from]];s.ruleType===Nc.RTEdgeJunctionEdgeConnectivity&&(n=[[i.from,i.via],[i.via,i.from],[i.to,i.via],[i.via,i.to]]);for(const o of n){const a=o.shift(),l=o.shift();let c=!1;switch(s.ruleType){case Nc.RTEdgeJunctionEdgeConnectivity:c=a===i.from||a===i.to;break;case Nc.RTJunctionEdgeConnectivity:c=a===i.to}const h=r[a],d=s[h.networkSourceId]?.layerId.toString()??"",f=s[h.assetGroupId]?.assetGroupCode?.toString(),m=s[h.assetTypeId],y=m?.assetTypeCode?.toString(),v=r[l],_=s[v.networkSourceId]?.layerId.toString()??"",b=s[v.assetGroupId]?.assetGroupCode?.toString(),w=s[v.assetTypeId],x=w?.assetTypeCode?.toString(),S=e[d]??{assetGroupHash:{}};if(!(f&&y&&b&&x))continue;const C=S.assetGroupHash[f]??{assetTypeHash:{}},T=C.assetTypeHash[y]??{};if(T[_]=T[_]??{},c){T[d]=T[d]??{};const I=`(assetgroup = ${f} AND assettype = ${y})`;w?.connectivityPolicy==="esriNECPEndVertex"?T[d].endVertex=T[d]?.endVertex?`${T[d].endVertex}`:`${I}`:T[d].anyVertex=T[d].anyVertex?`${T[d].anyVertex}`:`${I}`}const M=`(assetgroup = ${b} AND assettype = ${x})`;w?.connectivityPolicy==="esriNECPEndVertex"?T[_].endVertex=T[_]?.endVertex?`${T[_].endVertex} OR ${M}`:`${M}`:T[_].anyVertex=T[_]?.anyVertex?`${T[_].anyVertex} OR ${M}`:`${M}`,C.assetTypeHash[y]=T,S.assetGroupHash[f]=C,e[d]=S}}this._set("rulesHash",e)}_getRuleFieldValuesForAssociation(e,i,r="from"){switch(i){case"attachment":case"containment":return r==="from"?[{ruleLayerIdForSource:e.fromNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.fromAssetType?.assetTypeCode,ruleLayerIdForTarget:e.toNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.toAssetType?.assetTypeCode}]:[{ruleLayerIdForSource:e.toNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.toAssetType?.assetTypeCode,ruleLayerIdForTarget:e.fromNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.fromAssetType?.assetTypeCode}];case"connectivity":case"junction-junction-connectivity":return[{ruleLayerIdForSource:e.fromNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.fromAssetType?.assetTypeCode,ruleLayerIdForTarget:e.toNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.toAssetType?.assetTypeCode},{ruleLayerIdForSource:e.toNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.toAssetType?.assetTypeCode,ruleLayerIdForTarget:e.fromNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.fromAssetType?.assetTypeCode}];case"junction-edge-from-connectivity":case"junction-edge-midspan-connectivity":case"junction-edge-to-connectivity":return e.ruleType===Nc.RTEdgeJunctionEdgeConnectivity?[{ruleLayerIdForSource:e.fromNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.fromAssetType?.assetTypeCode,ruleLayerIdForTarget:e.viaNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.viaAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.viaAssetType?.assetTypeCode},{ruleLayerIdForSource:e.viaNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.viaAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.viaAssetType?.assetTypeCode,ruleLayerIdForTarget:e.fromNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.fromAssetType?.assetTypeCode},{ruleLayerIdForSource:e.toNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.toAssetType?.assetTypeCode,ruleLayerIdForTarget:e.viaNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.viaAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.viaAssetType?.assetTypeCode},{ruleLayerIdForSource:e.viaNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.viaAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.viaAssetType?.assetTypeCode,ruleLayerIdForTarget:e.toNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.toAssetType?.assetTypeCode}]:[{ruleLayerIdForSource:e.fromNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.fromAssetType?.assetTypeCode,ruleLayerIdForTarget:e.toNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.toAssetType?.assetTypeCode},{ruleLayerIdForSource:e.toNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.toAssetType?.assetTypeCode,ruleLayerIdForTarget:e.fromNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.fromAssetType?.assetTypeCode}];default:return[]}}_getWhereClauseForCompatibleFeatures(e,i,r){const s=new Map,[n,o]=this._getAssetFieldNames(e.sourceLayer),[a,l]=this._getFeatureAssetCodes(e),c=this._getFeatureSourceLayerId(e),h=Xh(i)?i.parent:i,d=Xh(i)?i.subtypeCode:null;r.forEach(m=>{const{type:y,direction:v}=m;this._getRulesForAssociationType(y).forEach(_=>{this._getRuleFieldValuesForAssociation(_,y,v).forEach(b=>{if(b.ruleAssetGroupCodeForTarget!=null&&b.ruleAssetTypeCodeForTarget!=null&&c===b?.ruleLayerIdForSource&&a===b?.ruleAssetGroupCodeForSource&&l===b?.ruleAssetTypeCodeForSource&&h.layerId===b?.ruleLayerIdForTarget&&(d==null||d===b?.ruleAssetGroupCodeForTarget)){const w=s.get(b.ruleAssetGroupCodeForTarget)??new Set;w.add(b.ruleAssetTypeCodeForTarget),s.set(b.ruleAssetGroupCodeForTarget,w)}})})});let f=[];return this._mergeAssetCodes(s).forEach((m,y)=>f.push(`${n} IN (${y}) AND ${o} IN (${Array.from(m).sort().join(", ")})`)),f.length>1&&(f=f.map(m=>`(${m})`)),f.join(" OR ")}_getRulesForAssociationType(e){const{rulesCategorized:i}=this;switch(e){case"attachment":return i.attachment;case"containment":return i.containment;case"connectivity":case"junction-junction-connectivity":return i.connectivity.filter(r=>r.ruleType===Nc.RTJunctionJunctionConnectivity);case"junction-edge-from-connectivity":case"junction-edge-midspan-connectivity":case"junction-edge-to-connectivity":return i.connectivity.filter(r=>r.ruleType===Nc.RTJunctionEdgeConnectivity||r.ruleType===Nc.RTEdgeJunctionEdgeConnectivity);default:return[]}}_getFeatureSourceLayerId(e){const{sourceLayer:i}=e;let r;return jWe(i)?r=i.layerId:Xh(i)&&(r=i.parent?.layerId),r??null}_getAssetFieldNames(e){return!e||!("fieldsIndex"in e)?[null,null]:[e.fieldsIndex.normalizeFieldName("assetGroup")??null,e.fieldsIndex.normalizeFieldName("assetType")??null]}_getFeatureAssetCodes(e){const[i,r]=this._getAssetFieldNames(e.sourceLayer);return[i?e.attributes[i]:null,r?e.attributes[r]:null]}_areSetsEqual(e,i){if(e.size!==i.size)return!1;for(const r of e)if(!i.has(r))return!1;return!0}_mergeAssetCodes(e){const i=new Map,r=new Set;for(const[s,n]of e){const o=new Set([s]);for(const[l,c]of e)s!==l&&!r.has(l)&&this._areSetsEqual(n,c)&&(o.add(l),r.add(l));const a=Array.from(o).sort().join(", ");i.set(a,n)}return i}};u([p({constructOnly:!0})],a_.prototype,"rulesLayer",void 0),u([p({constructOnly:!0})],a_.prototype,"rules",void 0),u([p({readOnly:!0})],a_.prototype,"rulesHash",void 0),u([p()],a_.prototype,"rulesCategorized",void 0),u([p({constructOnly:!0})],a_.prototype,"request",void 0),a_=u([A("esri.networks.RulesTable")],a_);const dkt=a_;let Ph=class extends ee{constructor(e){super(e),this.conditionBarriers=[],this.outputConditions=[],this.functions=[],this.functionBarriers=[],this.traversabilityScope=null,this.shortestPathNetworkAttributeName=null,this.includeBarriers=null,this.validateConsistency=null,this.ignoreBarriersAtStartingPoints=null}};u([p({type:[Object],json:{write:!0}})],Ph.prototype,"conditionBarriers",void 0),u([p({type:[Object],json:{write:!0}})],Ph.prototype,"outputConditions",void 0),u([p({type:[Object],json:{write:!0}})],Ph.prototype,"functions",void 0),u([p({type:[Object],json:{write:!0}})],Ph.prototype,"functionBarriers",void 0),u([p({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],Ph.prototype,"traversabilityScope",void 0),u([p({type:String,json:{write:!0}})],Ph.prototype,"shortestPathNetworkAttributeName",void 0),u([p({type:Boolean,json:{write:!0}})],Ph.prototype,"includeBarriers",void 0),u([p({type:Boolean,json:{write:!0}})],Ph.prototype,"validateConsistency",void 0),u([p({type:Boolean,json:{write:!0}})],Ph.prototype,"ignoreBarriersAtStartingPoints",void 0),Ph=u([A("esri.networks.support.TraceConfiguration")],Ph);const Yoe=Ph;let Qs=class extends Yoe{constructor(e){super(e),this.filterBarriers=[],this.arcadeExpressionBarrier=null,this.domainNetworkName=null,this.filterBitsetNetworkAttributeName=null,this.filterFunctionBarriers=[],this.filterScope=null,this.includeContainers=null,this.includeContent=null,this.includeIsolated=null,this.includeStructures=null,this.allowIndeterminateFlow=null,this.includeUpToFirstSpatialContainer=null,this.nearestNeighbor=null,this.outputFilterCategories=[],this.outputFilters=[],this.propagators=[],this.subnetworkName=null,this.targetTierName=null,this.diagramTemplateName=null,this.tierName=null,this.validateLocatability=null}};u([p({type:[Object],json:{write:!0}})],Qs.prototype,"filterBarriers",void 0),u([p({type:String,json:{write:!0}})],Qs.prototype,"arcadeExpressionBarrier",void 0),u([p({type:String,json:{write:!0}})],Qs.prototype,"domainNetworkName",void 0),u([p({type:String,json:{write:!0}})],Qs.prototype,"filterBitsetNetworkAttributeName",void 0),u([p({type:[Object],json:{write:!0}})],Qs.prototype,"filterFunctionBarriers",void 0),u([p({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],Qs.prototype,"filterScope",void 0),u([p({type:Boolean,json:{write:!0}})],Qs.prototype,"includeContainers",void 0),u([p({type:Boolean,json:{write:!0}})],Qs.prototype,"includeContent",void 0),u([p({type:Boolean,json:{write:!0}})],Qs.prototype,"includeIsolated",void 0),u([p({type:Boolean,json:{write:!0}})],Qs.prototype,"includeStructures",void 0),u([p({type:Boolean,json:{write:!0}})],Qs.prototype,"allowIndeterminateFlow",void 0),u([p({type:Boolean,json:{write:!0}})],Qs.prototype,"includeUpToFirstSpatialContainer",void 0),u([p({type:Object,json:{write:!0}})],Qs.prototype,"nearestNeighbor",void 0),u([p({type:[Object],json:{write:!0}})],Qs.prototype,"outputFilterCategories",void 0),u([p({type:[Object],json:{write:!0}})],Qs.prototype,"outputFilters",void 0),u([p({type:[Object],json:{write:!0}})],Qs.prototype,"propagators",void 0),u([p({type:String,json:{write:!0}})],Qs.prototype,"subnetworkName",void 0),u([p({type:String,json:{write:!0}})],Qs.prototype,"targetTierName",void 0),u([p({type:String,json:{write:!0}})],Qs.prototype,"diagramTemplateName",void 0),u([p({type:String,json:{write:!0}})],Qs.prototype,"tierName",void 0),u([p({type:Boolean,json:{write:!0}})],Qs.prototype,"validateLocatability",void 0),Qs=u([A("esri.networks.support.UNTraceConfiguration")],Qs);const pkt=Qs;let Oc=class extends $3{constructor(e){super(e),this.globalId=null,this.title=null,this.traceConfiguration=null,this.creationDate=null,this.creator=null,this.description=null,this.minStartingPoints=null,this.resultTypes=[],this.tags=[],this.traceType=null}readTraceConfiguration(e,i){return e.tierName!==void 0?pkt.fromJSON(e):Yoe.fromJSON(e)}};u([p({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"id"},write:{target:"id",isRequired:!0}},service:{read:{source:"globalId"},write:{target:"globalId",isRequired:!0}}},read:!1}})],Oc.prototype,"globalId",void 0),u([p({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"title"},write:{target:"title",isRequired:!0}},service:{read:{source:"name"},write:{target:"name",isRequired:!0}}},read:!1}})],Oc.prototype,"title",void 0),u([p({type:Yoe,json:{origins:{service:{read:!0,write:!0}},read:!1}})],Oc.prototype,"traceConfiguration",void 0),u([me("service","traceConfiguration")],Oc.prototype,"readTraceConfiguration",null),u([p({type:Date,json:{origins:{service:{read:!0,write:!0}},read:!1}})],Oc.prototype,"creationDate",void 0),u([p({type:String,json:{origins:{service:{read:!0,write:!0}},read:!1}})],Oc.prototype,"creator",void 0),u([p({type:String,json:{origins:{service:{read:!0,write:!0}},read:!1}})],Oc.prototype,"description",void 0),u([p({type:["none","one","many"],json:{origins:{service:{read:{source:"minNumStartingPoints"},write:{target:"minNumStartingPoints"}}},read:!1}})],Oc.prototype,"minStartingPoints",void 0),u([p({json:{origins:{service:{read:!0,write:!0}},read:!1}})],Oc.prototype,"resultTypes",void 0),u([p({type:[String],json:{origins:{service:{read:!0,write:!0}},read:!1}})],Oc.prototype,"tags",void 0),u([p({type:lk.apiValues,json:{type:lk.jsonValues,origins:{service:{read:lk.read,write:lk.write}},read:!1}})],Oc.prototype,"traceType",void 0),Oc=u([A("esri.networks.support.NamedTraceConfiguration")],Oc);const fkt=Oc;function mkt(t){const e=t?.fieldsIndex,i="fromnetworksourceid",r="fromglobalid",s="fromterminalid",n="tonetworksourceid",o="toglobalid",a="toterminalid",l="status",c="associationtype",h="iscontentvisible",d="percentalong",f="globalid";return{fromNetworkSourceId:e?.get(i)?.name??i,fromGlobalId:e?.get(r)?.name??r,fromTerminalId:e?.get(s)?.name??s,toNetworkSourceId:e?.get(n)?.name??n,toGlobalId:e?.get(o)?.name??o,toTerminalId:e?.get(a)?.name??a,status:e?.get(l)?.name??l,associationType:e?.get(c)?.name??c,isContentVisible:e?.get(h)?.name??h,percentAlong:e?.get(d)?.name??d,globalId:e?.get(t?.globalIdField??f)?.name??f}}function Xpi(t,e){if(e.type!=="feature"&&e.type!=="subtype-group")return[];if(!e.url)return[];const i="utilityNetworks"in t.map?t.map.utilityNetworks??[]:[];for(const r of i)if(r.isUtilityLayer(e)){const s=e.fieldsIndex.get("assetgroup"),n=e.fieldsIndex.get("assettype");return[s?.name,n?.name].filter(o=>o!=null)}return[]}let Dh=class extends ue{constructor(e){super(e),this.rulesTableId=null,this.rulesTableUrl=null,this.subnetworksTableId=null,this.subnetworksTableUrl=null,this.dirtyAreasLayerId=null,this.dirtyAreasLayerUrl=null,this.associationsTable=null,this.associationsTableId=null,this.associationsTableUrl=null}destroy(){this.associationsTable?.destroy()}async loadAssociationsTable(){if(!this.associationsTable){const{associationsTableUrl:e}=this;if(!e)throw new U("utility-network-system-layers:missing-associations-table-url","Unable to load the associations table, as the `associationsTableUrl` is not set.");this.associationsTable=new Zoe({url:e})}return await this.associationsTable.load(),this.associationsTable}};u([p({constructOnly:!0})],Dh.prototype,"rulesTableId",void 0),u([p({constructOnly:!0})],Dh.prototype,"rulesTableUrl",void 0),u([p({constructOnly:!0})],Dh.prototype,"subnetworksTableId",void 0),u([p({constructOnly:!0})],Dh.prototype,"subnetworksTableUrl",void 0),u([p({constructOnly:!0})],Dh.prototype,"dirtyAreasLayerId",void 0),u([p({constructOnly:!0})],Dh.prototype,"dirtyAreasLayerUrl",void 0),u([p()],Dh.prototype,"associationsTable",void 0),u([p({constructOnly:!0})],Dh.prototype,"associationsTableId",void 0),u([p({constructOnly:!0})],Dh.prototype,"associationsTableUrl",void 0),Dh=u([A("esri.networks.support.NetworkSystemLayers")],Dh);const gkt=Dh;let x2=class extends ee{constructor(e){super(e),this.id=null,this.name=null}};u([p({type:Number,json:{read:{source:"terminalId"},write:{target:"terminalId"}}})],x2.prototype,"id",void 0),u([p({type:String,json:{read:{source:"terminalName"},write:{target:"terminalName"}}})],x2.prototype,"name",void 0),u([p({type:Boolean,json:{write:!0}})],x2.prototype,"isUpstreamTerminal",void 0),x2=u([A("esri.networks.support.Terminal")],x2);const ykt=x2,ck=new ei({esriUNTMBidirectional:"bidirectional",esriUNTMDirectional:"directional"});let l_=class extends ee{constructor(e){super(e),this.defaultConfiguration=null,this.id=null,this.name=null,this.terminals=[],this.traversabilityModel=null}};u([p({type:String,json:{write:!0}})],l_.prototype,"defaultConfiguration",void 0),u([p({type:Number,json:{read:{source:"terminalConfigurationId"},write:{target:"terminalConfigurationId"}}})],l_.prototype,"id",void 0),u([p({type:String,json:{read:{source:"terminalConfigurationName"},write:{target:"terminalConfigurationName"}}})],l_.prototype,"name",void 0),u([p({type:[ykt],json:{write:!0}})],l_.prototype,"terminals",void 0),u([p({type:ck.apiValues,json:{type:ck.jsonValues,read:ck.read,write:ck.write}})],l_.prototype,"traversabilityModel",void 0),l_=u([A("esri.networks.support.TerminalConfiguration")],l_);const Cbe=l_;let S2=class extends ee{constructor(e){super(e),this.line=null,this.multipoint=null,this.polygon=null}};u([p({type:fd,json:{write:!0},readOnly:!0})],S2.prototype,"line",void 0),u([p({type:CS,json:{read:{source:"point"},write:{target:"point"}},readOnly:!0})],S2.prototype,"multipoint",void 0),u([p({type:Sa,json:{write:!0},readOnly:!0})],S2.prototype,"polygon",void 0),S2=u([A("esri.rest.networks.support.AggregatedGeometry")],S2);const vkt=S2;let T2=class extends ee{constructor(e){super(e),this.functionType=null,this.networkAttributeName=null,this.result=null}};u([p({type:["add","subtract","average","count","min","max"],json:{write:!0},readOnly:!0})],T2.prototype,"functionType",void 0),u([p({type:String,json:{write:!0},readOnly:!0})],T2.prototype,"networkAttributeName",void 0),u([p({type:Number,json:{write:!0},readOnly:!0})],T2.prototype,"result",void 0),T2=u([A("esri.rest.networks.support.FunctionResult")],T2);const _kt=T2;let Sp=class extends ee{constructor(e){super(e),this.assetGroupCode=null,this.assetTypeCode=null,this.globalId=null,this.networkSourceId=null,this.objectId=null,this.positionFrom=null,this.positionTo=null,this.terminalId=null}};u([p({type:Number,json:{write:!0}})],Sp.prototype,"assetGroupCode",void 0),u([p({type:Number,json:{write:!0}})],Sp.prototype,"assetTypeCode",void 0),u([p({type:String,json:{write:!0}})],Sp.prototype,"globalId",void 0),u([p({type:Number,json:{write:!0}})],Sp.prototype,"networkSourceId",void 0),u([p({type:Number,json:{write:!0}})],Sp.prototype,"objectId",void 0),u([p({type:Number,json:{write:!0}})],Sp.prototype,"positionFrom",void 0),u([p({type:Number,json:{write:!0}})],Sp.prototype,"positionTo",void 0),u([p({type:Number,json:{write:!0}})],Sp.prototype,"terminalId",void 0),Sp=u([A("esri.rest.networks.support.NetworkElement")],Sp);const bkt=Sp;let vy=class extends ee{constructor(e){super(e),this.aggregatedGeometry=null,this.elements=null,this.globalFunctionResults=null,this.kFeaturesForKNNFound=!1,this.startingPointsIgnored=!1,this.warnings=null}};u([p({type:vkt,json:{write:!0},readOnly:!0})],vy.prototype,"aggregatedGeometry",void 0),u([p({type:[bkt],json:{write:!0},readOnly:!0})],vy.prototype,"elements",void 0),u([p({type:[_kt],json:{write:!0},readOnly:!0})],vy.prototype,"globalFunctionResults",void 0),u([p({type:Boolean,json:{write:!0},readOnly:!0})],vy.prototype,"kFeaturesForKNNFound",void 0),u([p({type:Boolean,json:{write:!0},readOnly:!0})],vy.prototype,"startingPointsIgnored",void 0),u([p({type:[String],json:{write:!0},readOnly:!0})],vy.prototype,"warnings",void 0),vy=u([A("esri.rest.networks.support.TraceResult")],vy);const wkt=vy,xkt=Mo()({Pending:"job-waiting",InProgress:"job-executing",Completed:"job-succeeded"});let q1=class extends wkt{constructor(e){super(e),this.statusUrl=null,this.status=null,this.submissionTime=null,this.lastUpdatedTime=null,this._timer=void 0}destroy(){clearInterval(this._timer)}async checkJobStatus(e){const i={...e,query:{f:"json"}},{data:r}=await Ci(this.statusUrl,i),s=r.traceResults?{...r.traceResults,...r}:r;return this.read(s),this}async waitForJobCompletion(e={}){const{interval:i=1e3,statusCallback:r}=e;return new Promise((s,n)=>{this._clearTimer();const o=setInterval(()=>{this._timer||n(vi()),this.checkJobStatus().then(a=>{const{status:l}=a;switch(this.status=l,l){case"job-succeeded":this._clearTimer(),s(this);break;case"job-waiting":case"job-executing":r&&r(this)}},a=>{this._clearTimer(),n(a)})},i);this._timer=o})}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};u([p({type:String,json:{write:!0}})],q1.prototype,"statusUrl",void 0),u([Ue(xkt)],q1.prototype,"status",void 0),u([p({type:Date,json:{type:Number,write:{writer:(t,e)=>{e.submissionTime=t?t.getTime():null}}}})],q1.prototype,"submissionTime",void 0),u([p({type:Date,json:{type:Number,write:{writer:(t,e)=>{e.lastUpdatedTime=t?t.getTime():null}}}})],q1.prototype,"lastUpdatedTime",void 0),q1=u([A("esri.networks.support.TraceJobInfo")],q1);const Skt=q1;let _y=class extends ukt{constructor(e){super(e),this.sharedNamedTraceConfigurations=[],this.type="utility",this._terminalById=new Map}get serviceTerritoryFeatureLayerId(){return this.dataElement?.serviceTerritoryFeatureLayerId??null}get networkSystemLayers(){return new gkt({rulesTableId:this.sourceJSON?.systemLayers.rulesTableId,rulesTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.rulesTableId}`:null,subnetworksTableId:this.sourceJSON?.systemLayers.subnetworksTableId,subnetworksTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.subnetworksTableId}`:null,dirtyAreasLayerId:this.sourceJSON?.systemLayers.dirtyAreasLayerId,dirtyAreasLayerUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.dirtyAreasLayerId}`:null,associationsTableId:this.sourceJSON?.systemLayers.associationsTableId,associationsTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.associationsTableId}`:null})}get terminalConfigurations(){return this.dataElement?.terminalConfigurations.map(e=>Cbe.fromJSON(e))||[]}get domainNetworkNames(){return this.dataElement?.domainNetworks.map(e=>e.domainNetworkName)||[]}get _utilityLayerList(){const e=new Set;return this.dataElement?.domainNetworks?.map(i=>{i?.edgeSources?.map(({layerId:r,sourceId:s})=>{this._layerIdBySourceId.set(s,r),this._sourceIdByLayerId.set(r,s),e.add(r)}),i?.junctionSources?.map(({layerId:r,sourceId:s})=>{this._layerIdBySourceId.set(s,r),this._sourceIdByLayerId.set(r,s),e.add(r)})}),e}async load(e){return this.addResolvingPromise(super.load(e)),this.addResolvingPromise(this._loadNamedTraceConfigurationsFromNetwork(e)),this}getTerminalConfiguration(e){let i=null,r=null;const s=e.layer;let n=null;if(s?.type==="feature"){if(n=s.layerId,n===null)return null}else if(s?.type!=="subtype-sublayer"||(n=s?.parent?.layerId??null,n===null))return null;const o=e.attributes;if(o==null)return null;for(const c of Object.keys(o))c.toUpperCase()==="ASSETGROUP"&&(i=e.getAttribute(c)),c.toUpperCase()==="ASSETTYPE"&&(r=e.getAttribute(c));if(!this.dataElement)return null;let a=null;const l=this.dataElement.domainNetworks;for(const c of l){const h=c.junctionSources?.find(d=>d.layerId===n);if(h){const d=h.assetGroups?.find(f=>f.assetGroupCode===i);if(d){const f=d.assetTypes?.find(m=>m.assetTypeCode===r);if(f?.isTerminalConfigurationSupported){a=f.terminalConfigurationId;break}}}}if(a!=null){const c=this.dataElement.terminalConfigurations,h=c?.find(d=>d.terminalConfigurationId===a);return h?Cbe.fromJSON(h):null}return null}getTierNames(e){return this.dataElement?.domainNetworks.find(r=>r.domainNetworkName===e)?.tiers.map(r=>r.name)||[]}async getRulesTable(){return this._sharedRulesTable||(this._sharedRulesTable=this._createRulesTable()),await this._sharedRulesTable}getTerminalById(e){if(!this.dataElement||e==null)return null;const i=this._terminalById.get(e);return i??(this.terminalConfigurations.forEach(r=>{r.terminals.forEach(s=>{this._terminalById.set(s.id,s)})}),this._terminalById.get(e))}isUtilityLayer(e){return"layerId"in e?this._utilityLayerList.has(e?.layerId)&&(e.url?.startsWith(this.featureServiceUrl)??!1):!(e.type!=="subtype-sublayer"||!e.parent)&&this._utilityLayerList.has(e.parent.layerId)&&(e.parent.url?.startsWith(this.featureServiceUrl)??!1)}async queryAssociations(e,i){const[{queryAssociations:r},{default:s}]=await Promise.all([V(()=>import("./queryAssociations-DbN0_do5.js"),__vite__mapDeps([377,378])),V(()=>import("./QueryAssociationsParameters-B-42fvec.js"),[])]),n=s.from(e);return n.gdbVersion=this.gdbVersion,n.moment=this.historicMoment,(await r(this.networkServiceUrl,n,i)).associations}async synthesizeAssociationGeometries(e){const[{synthesizeAssociationGeometries:i},{default:r}]=await Promise.all([V(()=>import("./synthesizeAssociationGeometries-B-aTcLpB.js"),__vite__mapDeps([379,378])),V(()=>import("./SynthesizeAssociationGeometriesParameters-CVDXNkfc.js"),[])]),s=r.from(e);return s.gdbVersion=this.gdbVersion,s.moment=this.historicMoment,i(this.networkServiceUrl,s)}async trace(e){const[{trace:i},{default:r}]=await Promise.all([V(()=>import("./trace-gxM0fyMV.js"),[]),V(()=>import("./TraceParameters-DiqkOWVT.js"),[])]),s=r.from(e);return s.gdbVersion=this.gdbVersion,s.moment=this.historicMoment,i(this.networkServiceUrl,s)}async submitTraceJob(e){const[{submitTraceJob:i},{default:r}]=await Promise.all([V(()=>import("./trace-gxM0fyMV.js"),[]),V(()=>import("./TraceParameters-DiqkOWVT.js"),[])]),s=r.from(e);s.gdbVersion=this.gdbVersion,s.moment=this.historicMoment;const n=await i(this.networkServiceUrl,s);return new Skt({statusUrl:n})}async canAddAssociation(e){const i=await this.getRulesTable();if(!i)return!1;await i.load();const r=(c,h)=>c?c.terminalId===1?!h?.terminalId||h?.terminalId===c.terminalId:c.terminalId===h?.terminalId:!h?.terminalId,s=c=>({fromRuleElement:{networkSource:c.fromNetworkSource,assetGroup:c.fromAssetGroup,assetType:c.fromAssetType,terminal:c.fromTerminal},viaRuleElement:c.viaNetworkSource?{networkSource:c.viaNetworkSource,assetGroup:c.viaAssetGroup,assetType:c.viaAssetType,terminal:c.viaTerminal}:void 0,toRuleElement:{networkSource:c.toNetworkSource,assetGroup:c.toAssetGroup,assetType:c.toAssetType,terminal:c.toTerminal}}),n=(c,h,d=!0)=>c.networkSource?.sourceId===h.networkSourceId&&c.assetGroup?.assetGroupCode===h.assetGroupCode&&c.assetType?.assetTypeCode===h.assetTypeCode&&(!d||r(c.terminal,h)),o=(c,h)=>{const{fromRuleElement:d,toRuleElement:f}=s(c);return n(d,h.fromNetworkElement,!1)&&n(f,h.toNetworkElement,!1)},a=(c,h)=>{const{fromRuleElement:d,toRuleElement:f}=s(c);return n(d,h.fromNetworkElement)&&n(f,h.toNetworkElement)||n(d,h.toNetworkElement)&&n(f,h.fromNetworkElement)},l=(c,h)=>{const{fromRuleElement:d,toRuleElement:f,viaRuleElement:m}=s(c);return n(d,h.fromNetworkElement)&&n(m,h.toNetworkElement)||n(d,h.toNetworkElement)&&n(m,h.fromNetworkElement)||n(m,h.fromNetworkElement)&&n(f,h.toNetworkElement)||n(m,h.toNetworkElement)&&n(f,h.fromNetworkElement)};return e.associationType==="containment"?i.rulesCategorized.containment.some(c=>o(c,e)):e.associationType==="attachment"?i.rulesCategorized.attachment.some(c=>o(c,e)):i.rulesCategorized.connectivity.some(c=>c.ruleType===Nc.RTEdgeJunctionEdgeConnectivity?l(c,e):a(c,e))}generateAddAssociations(e){const{associationsTable:i}=this.networkSystemLayers,{fromNetworkSourceId:r,fromGlobalId:s,fromTerminalId:n,toNetworkSourceId:o,toGlobalId:a,toTerminalId:l,associationType:c,isContentVisible:h,percentAlong:d,globalId:f}=mkt(i);return{addFeatures:e.map(m=>new Ml({attributes:{[r]:m.fromNetworkElement?.networkSourceId,[s]:m.fromNetworkElement?.globalId,[n]:m.fromNetworkElement?.terminalId,[o]:m.toNetworkElement?.networkSourceId,[a]:m.toNetworkElement?.globalId,[l]:m.toNetworkElement?.terminalId,[c]:hkt[m.associationType],[h]:m.isContentVisible==null?void 0:m.isContentVisible?1:0,[d]:m.percentAlong,[f]:m.globalId}})),id:this.networkSystemLayers.associationsTableId,identifierFields:{globalIdField:i?.globalIdField??"globalid",objectIdField:i?.objectIdField??"objectid"}}}generateDeleteAssociations(e){const{associationsTable:i,associationsTableId:r}=this.networkSystemLayers;return{deleteFeatures:e.map(s=>({globalId:s.globalId})),id:r,identifierFields:{globalIdField:i?.globalIdField??"globalid",objectIdField:i?.objectIdField??"objectid"}}}async loadAssociationsTable(){return this.networkSystemLayers.loadAssociationsTable()}async _loadNamedTraceConfigurationsFromNetwork(e){if(this.sharedNamedTraceConfigurations?.length===0)return;const i=this.sharedNamedTraceConfigurations.map(s=>s.globalId),r=await this.queryNamedTraceConfigurations({globalIds:i},e);for(const s of this.sharedNamedTraceConfigurations){const n=r?.find(o=>o.globalId===s.globalId);if(n){const o=n.write({},{origin:"service"});s.read(o,{origin:"service"})}}}async _createRulesTable(){const e=this.networkSystemLayers.rulesTableUrl,i=new Zoe({url:e});await i.load();const r=this.dataElement?.domainNetworks;if(!r)return null;const s=r.flatMap(o=>[...o.edgeSources||[],...o.junctionSources||[]]),n=(await Tkt(i)).map(o=>this._hydrateRuleInfo(i,s,o));return new dkt({rulesLayer:i,rules:n})}_hydrateRuleInfo(e,i,r){const s=e.fieldsIndex,n=s.get("RULETYPE"),o=s.get("CREATIONDATE"),a=s.get("FROMNETWORKSOURCEID"),l=s.get("FROMASSETGROUP"),c=s.get("FROMASSETTYPE"),h=s.get("FROMTERMINALID"),d=s.get("TONETWORKSOURCEID"),f=s.get("TOASSETGROUP"),m=s.get("TOASSETTYPE"),y=s.get("TOTERMINALID"),v=s.get("VIANETWORKSOURCEID"),_=s.get("VIAASSETGROUP"),b=s.get("VIAASSETTYPE"),w=s.get("VIATERMINALID"),x=r.attributes[n.name],S=new Date(r.attributes[o.name]),C=[{networkSourceId:r.attributes[a.name],assetGroupId:r.attributes[l.name],assetTypeId:r.attributes[c.name],terminalId:r.attributes[h.name]},{networkSourceId:r.attributes[d.name],assetGroupId:r.attributes[f.name],assetTypeId:r.attributes[m.name],terminalId:r.attributes[y.name]},{networkSourceId:r.attributes[v.name],assetGroupId:r.attributes[_.name],assetTypeId:r.attributes[b.name],terminalId:r.attributes[w.name]}];let T;(function(I){I[I.from=0]="from",I[I.to=1]="to",I[I.via=2]="via"})(T||(T={}));const M={ruleType:x,creationDate:S};for(const I of[T.from,T.to,T.via]){if(x!==Nc.RTEdgeJunctionEdgeConnectivity&&I===T.via)continue;const P=C[I],D=i.find(k=>k.sourceId===P.networkSourceId),F=D?.assetGroups.find(k=>k.assetGroupCode===P.assetGroupId),L=F?.assetTypes.find(k=>k.assetTypeCode===P.assetTypeId),N=this._getTerminal(L,P);let R="";switch(I){case T.from:R="from";break;case T.to:R="to";break;case T.via:R="via"}M[`${R}NetworkSource`]=D,M[`${R}AssetGroup`]=F,M[`${R}AssetType`]=L,M[`${R}Terminal`]=N?.toJSON()}return M}_getTerminal(e,i){const r=e?.terminalConfigurationId;return this.terminalConfigurations?.find(n=>n.id===r)?.terminals?.find(n=>n.id===i.terminalId)??null}};async function Tkt(t){const e=new Jm({where:"1=1",outFields:["*"]});return(await L4e(t,e)).features}u([p({type:[fkt],json:{origins:{"web-map":{read:{source:"traceConfigurations"},write:{target:"traceConfigurations"}},service:{read:{source:"traceConfigurations"}}},read:!1}})],_y.prototype,"sharedNamedTraceConfigurations",void 0),u([p({type:["utility"],readOnly:!0,json:{read:!1,write:!1}})],_y.prototype,"type",void 0),u([p({readOnly:!0})],_y.prototype,"serviceTerritoryFeatureLayerId",null),u([p({readOnly:!0})],_y.prototype,"networkSystemLayers",null),u([p({readOnly:!0})],_y.prototype,"terminalConfigurations",null),u([p({readOnly:!0})],_y.prototype,"domainNetworkNames",null),_y=u([A("esri.networks.UtilityNetwork")],_y);const T5e=_y,Ekt=Object.freeze(Object.defineProperty({__proto__:null,default:T5e},Symbol.toStringTag,{value:"Module"}));let E2=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.expression=null,this.returnType="string",this.title=null}};u([p({type:String,json:{write:{isRequired:!0}}})],E2.prototype,"expression",void 0),u([p({type:["number","string"],json:{write:!0}})],E2.prototype,"returnType",void 0),u([p({type:String,json:{write:!0}})],E2.prototype,"title",void 0),E2=u([A("esri.webdoc.geotriggersInfo.ExpressionInfo")],E2);const E5e=E2,uk=new ei({deviceLocation:"device-location"});let tR=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.filterExpression=null,this.type="device-location"}};u([p({type:E5e,json:{write:!0}})],tR.prototype,"filterExpression",void 0),u([p({type:uk.apiValues,readOnly:!0,json:{type:uk.jsonValues,read:uk.read,write:uk.write}})],tR.prototype,"type",void 0),tR=u([A("esri.webdoc.geotriggersInfo.DeviceLocationFeed")],tR);const Ckt=tR;let iR=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.geometry=null,this.where=null}};u([p({types:bA,json:{read:af,write:!0}})],iR.prototype,"geometry",void 0),u([p({type:String,json:{write:!0}})],iR.prototype,"where",void 0),iR=u([A("esri.webdoc.geotriggersInfo.FeatureFilter")],iR);const $kt=iR;let C2=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.layerId=null,this.layerUrl=null,this.type="feature-layer"}};u([p({type:String,json:{write:{overridePolicy(){return{isRequired:this.layerUrl===null}}}}})],C2.prototype,"layerId",void 0),u([p({type:String,json:{write:{overridePolicy(){return{isRequired:this.layerId===null}}}}})],C2.prototype,"layerUrl",void 0),u([Ue({featureLayer:"feature-layer"},{readOnly:!0})],C2.prototype,"type",void 0),C2=u([A("esri.webdoc.geotriggersInfo.FeatureLayerSource")],C2);const Akt=C2;let W1=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.fenceSource=null,this.filter=null,this.bufferDistance=null,this.type="features"}};u([p({type:Akt,json:{write:{isRequired:!0}}})],W1.prototype,"fenceSource",void 0),u([p({type:$kt,json:{write:!0}})],W1.prototype,"filter",void 0),u([p({type:Number,json:{write:!0}})],W1.prototype,"bufferDistance",void 0),u([Ue({features:"features"},{readOnly:!0})],W1.prototype,"type",void 0),W1=u([A("esri.webdoc.geotriggersInfo.FeatureFenceParameters")],W1);const Mkt=W1;let J5=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.type="fence"}};u([Ue({fence:"fence"},{readOnly:!0})],J5.prototype,"type",void 0),J5=u([A("esri.webdoc.geotriggersInfo.Geotrigger")],J5);const C5e=J5;let rR=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.expressionInfo=null,this.requestedActions=null}};u([p({type:E5e,json:{write:!0}})],rR.prototype,"expressionInfo",void 0),u([p({type:[String],json:{write:!0}})],rR.prototype,"requestedActions",void 0),rR=u([A("esri.webdoc.geotriggersInfo.GeotriggerNotificationOptions")],rR);const Okt=rR,Ikt=new ei({enterContainsAndExitDoesNotContain:"enter-contains-and-exit-does-not-contain",enterContainsAndExitDoesNotIntersect:"enter-contains-and-exit-does-not-intersect",enterIntersectsAndExitDoesNotIntersect:"enter-intersects-and-exit-does-not-intersect"}),Rkt=new ei({useGeometry:"use-geometry",useGeometryWithAccuracy:"use-geometry-with-accuracy"}),hk=new ei({enter:"enter",enterOrExit:"enter-or-exit",exit:"exit"});let Tp=class extends C5e{constructor(e){super(e),this.enterExitRule="enter-contains-and-exit-does-not-intersect",this.feed=null,this.feedAccuracyMode="use-geometry",this.fenceNotificationRule=null,this.fenceParameters=null,this.name=null,this.notificationOptions=null,this.type="fence"}};u([Ue(Ikt)],Tp.prototype,"enterExitRule",void 0),u([p({type:Ckt,json:{write:{isRequired:!0}}})],Tp.prototype,"feed",void 0),u([Ue(Rkt)],Tp.prototype,"feedAccuracyMode",void 0),u([p({type:hk.apiValues,json:{type:hk.jsonValues,read:hk.read,write:{writer:hk.write,isRequired:!0}}})],Tp.prototype,"fenceNotificationRule",void 0),u([p({type:Mkt,json:{write:{isRequired:!0}}})],Tp.prototype,"fenceParameters",void 0),u([p({type:String,json:{write:!0}})],Tp.prototype,"name",void 0),u([p({type:Okt,json:{write:!0}})],Tp.prototype,"notificationOptions",void 0),u([Ue({fence:"fence"},{readOnly:!0})],Tp.prototype,"type",void 0),Tp=u([A("esri.webdoc.geotriggersInfo.FenceGeotrigger")],Tp);const Pkt=Tp,Dkt={base:C5e,key:"type",typeMap:{fence:Pkt}};let X5=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.geotriggers=null}};u([p({types:[Dkt],json:{write:{isRequired:!0}}})],X5.prototype,"geotriggers",void 0),X5=u([A("esri.webdoc.GeotriggersInfo")],X5);const Lkt=X5;let $2=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.portalItem=null}readPortalItem(e,i,r){const{itemId:s}=i;if(s)return new eh({id:s,portal:r?.portal})}writePortalItem(e,i){e?.id&&(i.itemId=e.id)}};u([p({type:eh,json:{write:{isRequired:!0}}})],$2.prototype,"portalItem",void 0),u([me("portalItem",["itemId"])],$2.prototype,"readPortalItem",null),u([ge("portalItem",{itemId:{type:String}})],$2.prototype,"writePortalItem",null),$2=u([A("esri.webdoc.ips.PositioningService")],$2);const Nkt=$2;let K5=class extends Dt.ClonableMixin(ee){constructor(e){super(e),this.positioningService=null}};u([p({type:Nkt,json:{write:{isRequired:!0}}})],K5.prototype,"positioningService",void 0),K5=u([A("esri.webdoc.IPSInfo")],K5);const Fkt=K5,kkt={currentVersion:nOe,createInitialViewProperties:()=>new AB,parseVersion:$C.parse,itemType:"Web Map",name:"webmap",origin:"web-map"},zkt=Ee.ofType(T5e);let c_=class extends r3t{constructor(e){super(e),this.geotriggersInfo=null,this.ipsInfo=null,this.presentation=null,this.utilityNetworks=null}destroy(){if(this.utilityNetworks){const e=this.utilityNetworks.removeAll();for(const i of e)i.destroy();this.utilityNetworks.destroy()}}get context(){return kkt}loadAll(){return cD(this,e=>{e(this.ground,this.basemap,this.layers,this.tables,this.ipsInfo?.positioningService?.portalItem)})}static fromJSON(e){if(e)return new this({resourceInfo:e});throw new U("webmap:empty-resource","Expected a JSON resource but got nothing")}};c_.VERSION=nOe,u([p({type:Lkt,json:{write:!0}})],c_.prototype,"geotriggersInfo",void 0),u([p({type:Fkt,json:{write:!0,name:"mapIPSInfo"}})],c_.prototype,"ipsInfo",void 0),u([p({json:{write:!0}})],c_.prototype,"presentation",void 0),u([p({type:zkt,json:{read:!0,write:!0}})],c_.prototype,"utilityNetworks",void 0),c_=u([A("esri.WebMap")],c_);const Ukt=c_;function Bkt(t){return t&&"getAtOrigin"in t&&"originOf"in t}function DQ(t){t?.writtenProperties&&t.writtenProperties.forEach(({target:e,propName:i,newOrigin:r})=>{Bkt(e)&&r&&e.originOf(i)!==r&&e.updateOrigin(i,r)})}const Vkt=Symbol("WebScene");async function jkt(t,e={},i){await t.load(i);const r=Ed(t.itemUrl,"resources"),{start:s=1,num:n=10,sortOrder:o="asc",sortField:a="resource"}=e,l={query:{start:s,num:n,sortOrder:o,sortField:a,token:t.apiKey},signal:i?.signal},c=await t.portal.request(r,l);return{total:c.total,nextStart:c.nextStart,resources:c.resources.map(({created:h,size:d,resource:f})=>({created:new Date(h),size:d,resource:t.resourceFromPath(f)}))}}async function Gkt(t,e,i,r){const s=new Map;for(const{resource:o,content:a,compress:l,access:c}of e){if(!o.hasPath())throw new U(`portal-item-resource-${i}:invalid-path`,"Resource does not have a valid path");const[h,d]=$5e(o.path),f=`${h}/${l??""}/${c??""}`;s.has(f)||s.set(f,{prefix:h,compress:l,access:c,files:[]}),s.get(f).files.push({fileName:d,content:a})}await t.load(r);const n=Ed(t.userItemUrl,i==="add"?"addResources":"updateResources");for(const{prefix:o,compress:a,access:l,files:c}of s.values())for(let d=0;d<c.length;d+=25){const f=c.slice(d,d+25),m=new FormData;o&&o!=="."&&m.append("resourcesPrefix",o),a&&m.append("compress","true"),l&&m.append("access",l);let y=0;for(const{fileName:v,content:_}of f)m.append("file"+ ++y,_,v);m.append("f","json"),await t.portal.request(n,{method:"post",body:m,signal:r?.signal})}}async function Hkt(t,e,i){if(!e.hasPath())throw new U("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await t.load(i);const r=Ed(t.userItemUrl,"removeResources");await t.portal.request(r,{method:"post",query:{resource:e.path},signal:i?.signal}),e.portalItem=null}async function qkt(t,e){await t.load(e);const i=Ed(t.userItemUrl,"removeResources");return t.portal.request(i,{method:"post",query:{deleteAll:!0},signal:e?.signal})}function $5e(t){const e=t.lastIndexOf("/");return e===-1?[".",t]:[t.slice(0,e),t.slice(e+1)]}function Joe(t){const[e,i]=Wkt(t),[r,s]=$5e(e);return[r,s,i]}function Wkt(t){const e=yGe(t);return e==null?[t,""]:[t.slice(0,t.length-e.length-1),`.${e}`]}async function Q5(t){return t.type==="blob"?t.blob:t.type==="json"?new Blob([t.jsonString],{type:"application/json"}):(await Ci(t.url,{responseType:"blob"})).data}function Zkt(t,e){if(!t.hasPath())return null;const[i,,r]=Joe(t.path);return t.portalItem.resourceFromPath(Ed(i,e+r))}function A5e(t,e){if(!t.hasPath())return null;const[i,,r]=Joe(t.path);return t.portalItem.resourceFromPath(Ed(i,e+r))}const uC=Object.freeze(Object.defineProperty({__proto__:null,addOrUpdateResources:Gkt,contentToBlob:Q5,fetchResources:jkt,getSiblingOfSameType:Zkt,getSiblingOfSameTypeI:A5e,removeAllResources:qkt,removeResource:Hkt,splitPrefixFileNameAndExtension:Joe},Symbol.toStringTag,{value:"Module"}));async function Xoe(t,e,i){const r=await M5e(t,e,i);await O5e(r,e,i)}async function Ykt(t,e,i,r,s){const n=await M5e(i,r,s);await t.update({data:e}),await O5e(n,r,s)}async function M5e(t,e,i){if(!e?.resources)return;const r=e.portalItem===t.portalItem?new Set(t.paths):new Set;t.paths.length=0,t.portalItem=e.portalItem;const s=new Set(e.resources.toKeep.map(d=>d.resource.path)),n=new Set,o=[];s.forEach(d=>{r.delete(d),t.paths.push(d)});const a=[],l=[],c=[];for(const d of e.resources.toUpdate)if(r.delete(d.resource.path),s.has(d.resource.path)||n.has(d.resource.path)){const{resource:f,content:m,finish:y}=d,v=A5e(f,SD());t.paths.push(v.path),a.push({resource:v,content:await Q5(m),compress:d.compress}),y&&c.push(()=>y(v))}else{t.paths.push(d.resource.path),l.push({resource:d.resource,content:await Q5(d.content),compress:d.compress});const f=d.finish;f&&c.push(()=>f(d.resource)),n.add(d.resource.path)}for(const d of e.resources.toAdd)if(t.paths.push(d.resource.path),r.has(d.resource.path))r.delete(d.resource.path);else{a.push({resource:d.resource,content:await Q5(d.content),compress:d.compress});const f=d.finish;f&&c.push(()=>f(d.resource))}if(a.length||l.length){const{addOrUpdateResources:d}=await V(()=>Promise.resolve().then(()=>uC),void 0);await d(e.portalItem,a,"add",i),await d(e.portalItem,l,"update",i)}if(c.forEach(d=>d()),o.length===0)return r;const h=await HVe(o);if(gt(i),h.length>0)throw new U("save:resources","Failed to save one or more resources",{errors:h});return r}async function O5e(t,e,i){if(!t||!e.portalItem)return;const r=[];for(const s of t){const n=e.portalItem.resourceFromPath(s);r.push(n.portalItem.removeResource(n,i))}await yV(r)}async function I5e(t){const e=[];for(const i of t.allLayers)if("beforeSave"in i&&typeof i.beforeSave=="function"){const r=i.beforeSave();r&&e.push(r)}await Promise.allSettled(e)}const Jkt=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);function Koe(t,e,i){let r=(t.messages??[]).filter(({type:s})=>s==="error").map(({name:s,message:n,details:o})=>new U(s,n,o));if(t.blockedRelativeUrls&&(r=r.concat(t.blockedRelativeUrls.map(s=>new U("url:unsupported",`Relative url '${s}' is not supported`)))),i){const{ignoreUnsupported:s,supplementalUnsupportedErrors:n=[],requiredPropertyChecksDisabled:o}=i;s&&(r=r.filter(({name:a})=>!(Jkt.has(a)||n.includes(a)))),o&&(r=r.filter(a=>a.name!=="web-document-write:property-required"))}if(r.length>0)throw new U(e.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:r})}const Xkt=["NatGeo_World_Map","Ocean_Basemap","USA_Topo_Maps","World_Imagery","World_Street_Map","World_Terrain_Base","World_Topo_Map","World_Hillshade","Canvas/World_Light_Gray_Base","Canvas/World_Light_Gray_Reference","Canvas/World_Dark_Gray_Base","Canvas/World_Dark_Gray_Reference","Ocean/World_Ocean_Base","Ocean/World_Ocean_Reference","Reference/World_Boundaries_and_Places","Reference/World_Reference_Overlay","Reference/World_Transportation"].map(t=>t.toLowerCase());async function Kkt(t,e,i){i??={},e4t(t,e),await Cd(()=>!e.updatingFromView),await e.load(),await D5e(e),await I5e(e),await P5e(t,e);const r=e.portalItem,{json:s,jsonContext:n}=await Qoe(e,r,t.origin);return Koe(n,{errorName:`${t.name}:save`},i),await L5e(e,r),await x4t(t,e,r,s,n),await Promise.all([e.updateItemThumbnail(),Xoe(e.resourceReferences,n)]),r}async function Qoe(t,e,i){const r=aK(e,i,!0),s=t.write({},r);return await Promise.all(r.resources.pendingOperations),{json:s,jsonContext:r}}async function Qkt(t,e,i,r){r??={};const s=t4t(t,i);await Cd(()=>!e.updatingFromView),await e.load(),await D5e(e),await I5e(e),await P5e(t,e);const{json:n,jsonContext:o}=await Qoe(e,s,t.origin);Koe(o,{errorName:`${t.name}:save`},r),await n4t(e,s);const a=e.getThumbnailState();return await S4t(t,e,s,n,o,r)&&(e.resourceReferences.portalItem=s),e.restoreThumbnailFromState(a),await Promise.all([e.updateItemThumbnail(),Xoe(e.resourceReferences,o)]),s}function e4t(t,e){if(!e.portalItem)throw new U(`${t.name}:portal-item-not-set`,"Portal item to save to has not been set on the WebMap");R5e(t,e.portalItem)}function R5e(t,e){if(e.type!==t.itemType)throw new U(`${t.name}:portal-item-wrong-type`,`Portal item needs to have type "${t.itemType}"`)}async function P5e(t,e){if(t.name==="linkchart")return;if(!e.basemap?.baseLayers.length)throw new U(`${t.name}:save`,"Map does not have a valid basemap with a base layer.");let i=null;if(await Cd(()=>{const r=Y2e(e.initialViewProperties,e.basemap);return i=r.spatialReference,!r.updating}),!rs(i,e.initialViewProperties.spatialReference))throw new U(`${t.name}:save`,"The spatial reference of the basemap is not compatible with the one from the map.",{expected:e.initialViewProperties.spatialReference,actual:i})}function t4t(t,e){let i=eh.from(e);return i.id&&(i=i.clone(),i.id=null),i.type||(i.type=t.itemType),i.portal||(i.portal=fn.getDefault()),R5e(t,i),i}function D5e(t){const e=[];return t.basemap&&e.push(t.basemap.load()),t.ground&&e.push(t.ground.load()),Promise.allSettled(e).then(()=>{})}async function L5e(t,e){e.extent=await m4t(t.portalItem,t.initialViewProperties.viewpoint.targetGeometry),await o4t(t,e)}const i4t=vS.JSAPI,N5e="CollectorDisabled",$be="Collector",Abe="Data Editing",F5e="OfflineDisabled",Mbe="Offline",k5e="Workforce Project",z5e="Workforce Worker",U5e="Workforce Dispatcher",r4t="Offline Map Areas",s4t="FieldMapsDisabled",Obe=vS.DEVELOPER_BASEMAP,Ibe="UtilityNetwork",Rbe="IPS";async function n4t(t,e){Yl(e,N5e),Yl(e,s4t),Yl(e,vS.METADATA),Yl(e,F5e),Yl(e,r4t),Yl(e,U5e),Yl(e,k5e),Yl(e,z5e),await L5e(t,e)}async function o4t(t,e){ew(e,i4t),await a4t(t),c4t(t,e),u4t(t,e),h4t(t,e),d4t(t,e),p4t(t,e),f4t(t,e),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((i,r,s)=>s.indexOf(i)===r))}function a4t(t){const e=eae(t).map(i=>i.load()).toArray();return Promise.allSettled(e).then(()=>{})}function eae(t){return t.allLayers.concat(t.allTables)}function B5e(t){return eae(t).some(e=>e.loaded&&v2e(e)&&e.capabilities.operations.supportsEditing&&e.editingEnabled&&(e.type!=="subtype-group"||e.sublayers.some(i=>i.editingEnabled)))}function l4t(t){return eae(t).filter(e=>e.type!=="group").every(e=>e.loaded&&v4t(t,e))}function c4t(t,e){xx(e,N5e)||xx(e,k5e)||xx(e,z5e)||xx(e,U5e)||!B5e(t)?Yl(e,$be):ew(e,$be)}function u4t(t,e){B5e(t)?ew(e,Abe):Yl(e,Abe)}function h4t(t,e){!xx(e,F5e)&&l4t(t)?ew(e,Mbe):Yl(e,Mbe)}function d4t(t,e){xW(t.basemap)?ew(e,Obe):Yl(e,Obe)}function p4t(t,e){t.utilityNetworks?.length?ew(e,Ibe):Yl(e,Ibe)}function f4t(t,e){t.ipsInfo?ew(e,Rbe):Yl(e,Rbe)}async function m4t(t,e){const i=e.clone().normalize();let r;if(i.length>1)for(const s of i)r?s.width>r.width&&(r=s):r=s;else r=i[0];return g4t(t,r)}async function g4t(t,e){const i=e.spatialReference;if(i.isWGS84)return e.clone();if(i.isWebMercator)return ux(e);const{getGeometryServiceURL:r}=await V(()=>import("./geometryServiceUtils-DDNHyfMa.js"),[]),s=await r(t),n=new xoe({geometries:[e],outSpatialReference:Ae.WGS84});return(await n4e(s,n))[0]}function y4t(t){return uD(t)||t.type==="map-notes"||t.type==="route"}function v4t(t,e){return v2e(e)&&e.capabilities.operations.supportsSync||y4t(e)&&!e.portalItem||_4t(e)&&!b4t(e)&&e.spatialReference.equals(t.initialViewProperties.spatialReference)}function _4t(t){return(t.type==="tile"||t.type==="vector-tile")&&(t.capabilities.operations.supportsExportTiles||w4t(t)||Z2e(t))}function b4t(t){return t.type==="vector-tile"&&Object.keys(t.sourceNameToSource).length>1}function w4t(t){return t.type==="tile"&&MGe(t.url)&&Xkt.some(e=>t.url?.toLowerCase().includes("/"+e+"/"))}async function x4t(t,e,i,r,s){await i.update({data:r}),V5e(t,e,i,r,s)}async function S4t(t,e,i,r,s,n){const o=e.portalItem,a={item:o,authenticated:!(!o?.id||!o.portal.user)},l=i.portal;await l.signIn();const{copyAllowed:c,itemReloaded:h}=await tae(a,l);if(a.authenticated||=h,!c)throw new U(`${t.name}:save-as-copy-not-allowed`,"Owner of this map does not allow others to save a copy");const d=await iae(i,a,r,n);return e.portalItem=i,V5e(t,e,i,r,s),d}async function tae(t,e){const{item:i,authenticated:r}=t;return i?.id&&i.typeKeywords?.includes("useOnly")?i.portal.portalHostname!==e.portalHostname?{copyAllowed:!1,itemReloaded:!1}:(r||await i.reload(),{copyAllowed:i.itemControl==="admin"||i.itemControl==="update",itemReloaded:!0}):{copyAllowed:!0,itemReloaded:!1}}async function iae(t,e,i,r){const s=t.portal,{item:n}=e,{folder:o,copyAllResources:a}=r;let l=!1;if(a&&n?.id&&Dxe(n.portal.url,s.url)&&parseInt(n.portal.currentVersion,10)>=2023){const{total:c}=await n.fetchResources();l=!!c}if(l){const c=await n.copy({copyResources:"all",folder:o});t.id=c.id,t.portal=c.portal;const h=t.toJSON();await t.load(),t.read(h),await t.update({data:i})}else await s.user.addItem({item:t,folder:o,data:i});return l}function V5e(t,e,i,r,s){$3.prototype.read.call(e,{version:r.version,authoringApp:r.authoringApp,authoringAppVersion:r.authoringAppVersion},{origin:t.origin,ignoreDefaults:!0,url:i.itemUrl?pn(i.itemUrl):void 0}),DQ(s),e.resourceInfo=r}const T4t=Object.freeze(Object.defineProperty({__proto__:null,createJSON:Qoe,initializeNewItem:iae,isCopyAllowed:tae,save:Kkt,saveAs:Qkt},Symbol.toStringTag,{value:"Module"}));var LQ;let ez=LQ=class extends ee{constructor(t){super(t),this.viewing=null}clone(){return new LQ({viewing:this.viewing?.clone()??null})}};u([p({type:c4e,json:{write:!0}})],ez.prototype,"viewing",void 0),ez=LQ=u([A("esri.webscene.ApplicationProperties")],ez);const E4t=ez;var NQ;let u_=NQ=class extends ee{constructor(t){super(t),this.environment=new W$,this.spatialReference=null,this.viewpoint=null,this.timeExtent=null}set viewingMode(t){this._set("viewingMode",t)}clone(){return new NQ({environment:this.environment.clone(),spatialReference:this.spatialReference?.clone()??null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?.clone()??null,timeExtent:this.timeExtent?.clone()??null})}};u([p({type:W$,json:{write:{isRequired:!0}}})],u_.prototype,"environment",void 0),u([p({type:Ae})],u_.prototype,"spatialReference",void 0),u([p({type:["local","global"]})],u_.prototype,"viewingMode",null),u([p({type:Jr,json:{write:{isRequired:!0}}})],u_.prototype,"viewpoint",void 0),u([p(Soe)],u_.prototype,"timeExtent",void 0),u_=NQ=u([A("esri.webscene.InitialViewProperties")],u_);const DB=u_;var FQ;let tz=FQ=class extends ee{constructor(){super(...arguments),this.text=""}clone(){return new FQ({text:this.text})}};u([p({type:String,json:{write:{isRequired:!0}}})],tz.prototype,"text",void 0),tz=FQ=u([A("esri.webscene.support.Description")],tz);const iz=tz;var kQ;let rz=kQ=class extends ee{constructor(t){super(t),this.visible=!1}clone(){return new kQ({visible:this.visible})}cloneConstructProperties(){return{visible:this.visible}}};u([p({type:Boolean,json:{default:!1,write:!0}})],rz.prototype,"visible",void 0),rz=kQ=u([A("esri.webscene.SlideLegendInfo")],rz);const C4t=rz;var zQ;let sz=zQ=class extends ee{constructor(){super(...arguments),this.legendInfo=null}clone(){return new zQ({legendInfo:q(this.legendInfo)})}};u([p({type:C4t,json:{write:!0}})],sz.prototype,"legendInfo",void 0),sz=zQ=u([A("esri.webscene.support.SlideElements")],sz);const $4t=sz;var UQ;let hC=UQ=class extends ee{constructor(){super(...arguments),this.lighting=new mS,this.weather=new JU}clone(){return new UQ({lighting:q(this.lighting),weather:q(this.weather)})}};u([p({types:uLe,json:{write:!0}})],hC.prototype,"lighting",void 0),u([p({types:Lse,json:{write:!0}})],hC.prototype,"weather",void 0),hC=UQ=u([A("esri.webscene.Environment")],hC);var nz;let oz=nz=class extends ee{constructor(){super(...arguments),this.opacity=null}clone(){return new nz({opacity:this.opacity})}cloneAndApplyTo(t){return this.opacity==null||((t=t?.clone()??new FP).opacity=this.opacity),t}static fromGround(t){return new nz({opacity:t.opacity})}};u([p({type:Number,json:{type:Ei,read:{reader:_$,source:"transparency"},write:{writer:(t,e)=>{e.transparency=hD(t)},target:"transparency"}}})],oz.prototype,"opacity",void 0),oz=nz=u([A("esri.webscene.support.SlideGround")],oz);const j5e=oz;var BQ;let dC=BQ=class extends ee{constructor(t){super(t),this.id="",this.sublayerIds=null}clone(){return new BQ({id:this.id,sublayerIds:q(this.sublayerIds)})}};u([p({type:String,json:{write:!0}})],dC.prototype,"id",void 0),u([p({type:[Ei],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],dC.prototype,"sublayerIds",void 0),dC=BQ=u([A("esri.webscene.support.SlideVisibleLayer")],dC);var VQ;let az=VQ=class extends ee{constructor(){super(...arguments),this.text=""}clone(){return new VQ({text:this.text})}};u([p({type:String,json:{write:{isRequired:!0}}})],az.prototype,"text",void 0),az=VQ=u([A("esri.webscene.support.Title")],az);const rP=az;let A4t=0;const jQ=Ee.ofType(dC),M4t=["caption","cover","none"];let Wn=class extends Dt.ClonableMixin(ee){constructor(t){super(t),this.id=Date.now().toString(16)+"-slide-"+A4t++,this.title=new rP,this.description=new iz,this.hidden=!1,this.thumbnail=new nc,this.viewpoint=null,this.basemap=null,this.ground=null,this.layout="caption",this.environment=new hC,this.timeExtent=null,this.elements=null,this.visibleLayers=new jQ}destroy(){this.visibleLayers.removeAll(),this.basemap=null,this.thumbnail=Ce(this.thumbnail),this.description=null,this.title=null,this.thumbnail=null,this.elements=null}castTitle(t){return typeof t=="string"?new rP({text:t}):Is(rP,t)}castDescription(t){return typeof t=="string"?new iz({text:t}):Is(iz,t)}castThumbnail(t){return typeof t=="string"?new nc({url:t}):Is(nc,t)}castBasemap(t){return HV(t)}set visibleLayers(t){this._set("visibleLayers",df(t,this._get("visibleLayers"),jQ))}castVisibleLayers(t){return t&&typeof t.map=="function"?t.map(e=>{if(typeof e=="string")return{id:e};if(e instanceof qV){const i=Pbe(e);return{id:e.id,sublayerIds:i}}return e.id?{id:e.id,sublayerIds:"sublayerIds"in e?e.sublayerIds:void 0}:(J.getLogger(this).warn('Invalid visible layer, expected { id }, Layer or "id"'),e)}):null}async _updateVisibleLayersFrom(t){const e=[];await Promise.allSettled(this._getLayers(t.map).map(i=>t.whenLayerView(i).then(r=>{if(r.visible){const s=Pbe(i);e.push(new dC({id:r.layer.id,sublayerIds:s}))}})).toArray()),this.visibleLayers.removeAll(),this.visibleLayers.addMany(e)}updateFrom(t,e){const i={format:"png",quality:80,width:120,height:75,disableDecorations:!0,...e?.screenshot};return t.when(()=>(this.viewpoint=t.viewpoint.clone(),this.environment.lighting=t.environment.lighting.type==="virtual"?HD.prototype.clone.apply(t.environment.lighting):mS.prototype.clone.apply(t.environment.lighting),this.environment.weather=t.environment.weather.clone(),this.basemap=t.map.basemap?.clone()||null,this.ground=t.map.ground?j5e.fromGround(t.map.ground):null,this.timeExtent=t.timeExtent?.clone()??null,this._updateVisibleLayersFrom(t))).then(()=>t.takeScreenshot(i)).then(r=>(this.thumbnail=new nc({url:r.dataUrl}),this))}async applyTo(t,e){this._applyToController!=null&&this._applyToController.abort();let i=new AbortController;this._applyToController=i;const r=J3(e,()=>i?.abort()),s=()=>{this._applyToController===i&&(this._applyToController=null),i=null,r?.remove()};try{await Cd(()=>t.ready,i.signal)}catch(h){throw s(),h}if(i.signal.aborted)throw s(),vi();const n=t.resourceController.scheduler.registerTask(at.SLIDE);let o=!1;const a={animate:!0,...e,signal:this._applyToController.signal},l=async()=>{await Promise.all([n.schedule(async()=>o=await this._setViewpointOfInterest(t,a)),n.schedule(()=>this._applyBasemap(t,a),a.signal),n.schedule(()=>this._loadLayersWithSublayerVisibility(t))]),await Promise.all([n.schedule(()=>this._applyLayerVisibility(t),a.signal),n.schedule(()=>this._applyGround(t),a.signal),n.schedule(()=>this._applyViewpoint(t,a),a.signal),n.schedule(()=>t.timeExtent=this.timeExtent?.clone()??null,a.signal),n.schedule(()=>t.environment.weather=this.environment.weather.clone())])},c=await lf(t.addUpdatingPromise(l()));if(o&&(t.contentCamera=null),n.remove(),s(),c.ok===!1)throw c.error;return this}async _applyBasemap(t,e){if(this.basemap){try{await this.basemap.load(e)}catch(i){if(Xr(i))throw i}t.map.basemap=dYe(this.basemap,t.map.basemap)}}_applyGround(t){this.ground&&(t.map.ground=this.ground.cloneAndApplyTo(t.map.ground))}_getLayers(t){const e=new Ee;return this._collectLayers(t,e),this._collectLayers(t.ground,e),e}_collectLayers(t,e){t.layers.forEach(i=>{i.persistenceEnabled&&(e.add(i),"layers"in i&&this._collectLayers(i,e))})}async _loadLayersWithSublayerVisibility(t){this.visibleLayers&&await Promise.allSettled(this._getLayers(t.map).items.map(e=>this.visibleLayers.find(r=>r.id===e.id)?.sublayerIds?e.load():null))}_applyLayerVisibility(t){this.visibleLayers&&this._getLayers(t.map).forEach(e=>{const i=this.visibleLayers.find(n=>n.id===e.id);e.visible=i!=null;const r=i?.sublayerIds,s=G5e(e);r&&s&&s.forEach(n=>n.visible=r.includes(n.id))})}async _setViewpointOfInterest(t,e){if(t.state.fixedContentCamera||!this.viewpoint||e?.ignoreViewpoint||!e?.useDestinationCamera)return!1;const{toCameraAsync:i}=await V(()=>Promise.resolve().then(()=>Hbt),void 0),r=await i(t,this.viewpoint);return t.contentCamera=r,r!=null}async _applyViewpoint(t,e){if(this._applyCachedCameraTrackingEnabled(t),this.viewpoint&&!e.ignoreViewpoint){const i=this.environment.lighting;if(e.animate&&i.type==="sun"&&i.date)return this._animateToLighting(t,e);e.animate&&(t.environment.applyLighting(i.clone()),await t.goTo(this.viewpoint,e)),t.viewpoint=this.viewpoint}t.environment.applyLighting(this.environment.lighting.clone())}async _animateToLighting(t,e){let i=null;return t.environment.lighting.type!=="virtual"&&this.environment.lighting.type!=="virtual"&&(t.viewingMode==="global"&&(i=this._animateLightingWithCamera(t,t.environment.lighting,this.environment.lighting)),t.environment.cachedCameraTrackingEnabled=t.environment.lighting.cameraTrackingEnabled,t.environment.lighting.cameraTrackingEnabled=!1),t.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled,this.environment.lighting.type==="virtual"||t.environment.lighting.type==="virtual"?(t.environment.applyLighting(this.environment.lighting.clone()),t.environment.lighting.type!=="virtual"&&(t.environment.cachedCameraTrackingEnabled=t.environment.lighting.cameraTrackingEnabled,t.environment.lighting.cameraTrackingEnabled=!1)):this.environment.lighting.displayUTCOffset!=null&&(t.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset),t.goTo(this.viewpoint,e).then(()=>{this._applyCachedCameraTrackingEnabled(t),t.environment.applyLighting(this.environment.lighting.clone())}).catch(r=>{throw t.animation==null&&this._applyCachedCameraTrackingEnabled(t),r}).finally(()=>{Hi(i)})}_applyCachedCameraTrackingEnabled(t){t.environment.cachedCameraTrackingEnabled!=null&&(t.environment.lighting.cameraTrackingEnabled=t.environment.cachedCameraTrackingEnabled,t.environment.cachedCameraTrackingEnabled=null)}_getTime(t){return[t.getTime(),3600*t.getUTCHours()+60*t.getUTCMinutes()+t.getUTCSeconds()]}_setTime(t,e,i){return t.setTime(e),t.setUTCHours(i/3600),t.setUTCMinutes(i%3600/60),t.setUTCSeconds(i%3600%60),t}_animateLightingWithCamera(t,e,i){const r=new Date(e.date.toString()),[s,n]=this._getTime(r),[o,a]=this._getTime(i.date),l=R4t(n,a),c=t.renderCoordsHelper,h=$();c.toRenderCoords(t.camera.position,h);const d=$(),f=$();this.viewpoint.camera!=null&&c.toRenderCoords(this.viewpoint.camera.position,d);const m=new Date;return gn(()=>t.camera,y=>{c.toRenderCoords(y.position,f);const v=ro(h,f),_=ro(d,f);let b=0;v+_!==0&&(b=v/(v+_));const w=s+(o-s)*b,x=P4t(n,l*b);e.date=this._setTime(m,w,x)})}static createFrom(t,e){return new this().updateFrom(t,e)}};u([p({type:String,json:{write:{isRequired:!0}}})],Wn.prototype,"id",void 0),u([p({type:rP,json:{default:()=>new rP({text:""}),write:{isRequired:!0}}})],Wn.prototype,"title",void 0),u([Yt("title")],Wn.prototype,"castTitle",null),u([p({type:iz,json:{write:{overridePolicy:t=>({enabled:!(!t||!t.text)})}}})],Wn.prototype,"description",void 0),u([Yt("description")],Wn.prototype,"castDescription",null),u([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!1}})],Wn.prototype,"hidden",void 0),u([p({type:nc,json:{default:()=>new nc({url:""}),write:{isRequired:!0}}})],Wn.prototype,"thumbnail",void 0),u([Yt("thumbnail")],Wn.prototype,"castThumbnail",null),u([p({type:Jr,nonNullable:!0,json:{write:{isRequired:!0}}})],Wn.prototype,"viewpoint",void 0),u([p({type:qy,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],Wn.prototype,"basemap",void 0),u([Yt("basemap")],Wn.prototype,"castBasemap",null),u([p({type:j5e,json:{write:!0}})],Wn.prototype,"ground",void 0),u([p({type:M4t,json:{write:!0,default:"caption"},nonNullable:!0})],Wn.prototype,"layout",void 0),u([p({type:jQ,json:{write:{isRequired:!0}}})],Wn.prototype,"visibleLayers",null),u([Yt("visibleLayers")],Wn.prototype,"castVisibleLayers",null),u([p({type:hC,json:{write:!0}})],Wn.prototype,"environment",void 0),u([p(Soe)],Wn.prototype,"timeExtent",void 0),u([p({type:$4t,json:{write:!0}})],Wn.prototype,"elements",void 0),Wn=u([A("esri.webscene.Slide")],Wn);const O4t=Wn;function G5e(t){if(t.type==="building-scene"||t.type==="map-image")return t.allSublayers.toArray()}function Pbe(t){const e=G5e(t);if(e)return e.filter(i=>i.visible).map(i=>i.id)}const GQ=86400,I4t=43200;function R4t(t,e){let i=e-t;return i>I4t&&(i-=GQ),i<-43200&&(i+=GQ),i}function P4t(t,e){return Aje(t+e,GQ)}const HQ=Ee.ofType(O4t);let lz=class extends ee{constructor(e){super(e),this.slides=new HQ}destroy(){this.slides.forEach(e=>e.destroy()),this.slides.removeAll()}set slides(e){e&&(e=e.filter(i=>!!i.viewpoint)),this._set("slides",df(e,this._get("slides"),HQ))}clone(){return new this.constructor({slides:this.slides.clone()})}};u([p({type:HQ,nonNullable:!0,json:{write:!0}}),Yt(Vte)],lz.prototype,"slides",null),lz=u([A("esri.webscene.Presentation")],lz);const H5e=lz;var qQ;let A2=qQ=class extends ee{constructor(t){super(t)}clone(){return new qQ({name:this.name,path:this.path,title:this.title})}};u([p({type:String,json:{write:{isRequired:!0}}})],A2.prototype,"name",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],A2.prototype,"path",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],A2.prototype,"title",void 0),A2=qQ=u([A("esri.webscene.TransportationNetwork")],A2);const D4t=A2;let LB=class extends $D{constructor(e,i){super(e,i,"webscene")}get supportsGround(){return this.greaterEqual(1,8)}get supportsVisibleElevationLayersInSlides(){return this.lessThan(1,8)}};var q5e;const Bx=new LB(1,36),L4t=()=>{const e=[],i=Bx.major;for(let r=8;r<=Bx.minor;r++)e.push(`${i}.${r}`);return e},_9="Web Scene";let vr=class extends $l.LoadableMixin(Ub.EsriPromiseMixin(eL(Xte))){constructor(t){super(t),this[q5e]=!0,this._layersIdGCTimeoutId=void 0,this._updateFromPromise=null,this.applicationProperties=null,this.clippingArea=null,this.clippingEnabled=!1,this.floorInfo=null,this.heightModelInfo=void 0,this.sourceVersion=null,this.transportationNetworks=null,this.presentation=new H5e,this.initialViewProperties=new DB,this.portalItem=null,this.resourceInfo=null,this.widgets=null,this._debouncedSaveOperations=X3(async(e,i,r)=>{switch(e){case vl.SAVE:return this._saveImpl(i);case vl.SAVE_AS:return this._saveAsImpl(r,i)}}),this._resourceReferences={portalItem:null,paths:[]},this.authoringApp=null,this.authoringAppVersion=null,this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1}initialize(){if(this.when().catch(t=>{J.getLogger(this).error("#load()","Failed to load web scene",t)}),this.resourceInfo){let t;try{t=this._validateJSON(this.resourceInfo)}catch(e){return void this.addResolvingPromise(Promise.reject(e))}this.read(t),this.addResolvingPromise(this._validateSpatialReference()),this.addResolvingPromise(this._validateHeightModelInfo())}this.addHandles(io(()=>this.allLayers,"change",()=>this._scheduleLayersIdGC()))}destroy(){this._unscheduleLayersIdGC(),this.presentation&&this.presentation.destroy(),this.portalItem=Ce(this.portalItem)}writeClippingArea(t,e){e.clippingArea||(e.clippingArea={}),e.clippingArea.geometry=t.toJSON()}readClippingEnabled(t,e){return!!e.clippingArea&&!!e.clippingArea.clip}writeClippingEnabled(t,e){this.clippingArea&&(e.clippingArea||(e.clippingArea={}),e.clippingArea.clip=t)}writeLayers(t,e,i,r){e[i]=this._layersToJSON(t,"operational-layers",r)}readSourceVersion(t,e){const[i,r]=e.version.split(".");return new LB(parseInt(i,10),parseInt(r,10))}writeSourceVersion(t,e,i){e[i]=`${Bx.major}.${Bx.minor}`}writeTables(t,e,i,r){const s=this._layersToJSON(t,"tables",r);s.length&&(e[i]=s)}get thumbnailUrl(){return this.portalItem?.thumbnailUrl??null}set thumbnailUrl(t){t?this._override("thumbnailUrl",t):(this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}set authoringApp(t){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",t)}writeAuthoringApp(t,e){t&&this._isAuthoringAppSetByUser?e.authoringApp=t:e.authoringApp="ArcGIS API for JavaScript"}set authoringAppVersion(t){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",t)}writeAuthoringAppVersion(t,e){t&&this._isAuthoringAppVersionSetByUser?e.authoringAppVersion=t:e.authoringAppVersion=Wee}writeGround(t,e,i,r){e[i]=t?t.write({},r):{transparency:0,layers:[]}}readInitialViewProperties(t,e){const i={};e.initialState?.environment&&(i.environment=W$.fromJSON(e.initialState.environment)),i.spatialReference=e.spatialReference?Ae.fromJSON(e.spatialReference):Ae.WebMercator,i.viewingMode=e.viewingMode??"global",e.initialState?.viewpoint&&(i.viewpoint=Jr.fromJSON(e.initialState.viewpoint));const r=e.initialState?.timeExtent;return r!=null&&(i.timeExtent=To.fromArray(r)),new DB(i)}get spatialReference(){return this.initialViewProperties?.spatialReference??Ae.WebMercator}get viewingMode(){return this.initialViewProperties?.viewingMode??"global"}load(t){const e=this.ground;return this.addResolvingPromise(this._loadFromSource().then(()=>{e&&e!==this.ground&&e.destroy(),this._validateFeatureLayerSymbolVisibility()})),Promise.resolve(this)}loadAll(){return cD(this,t=>{const e=this.presentation&&this.presentation.slides;t(this.ground,this.basemap,this.layers,e&&e.map(i=>i.basemap),this.tables)})}read(t,e){e={...e,origin:"web-scene"};const i=this._isAuthoringAppVersionSetByUser,r=this._isAuthoringAppSetByUser;if(Nee(this,t,s=>super.read(t,s),e),r||(this._isAuthoringAppSetByUser=!1),i||(this._isAuthoringAppVersionSetByUser=!1),t.baseMap&&Array.isArray(t.baseMap.elevationLayers)&&this.sourceVersion?.supportsVisibleElevationLayersInSlides){const s=t.baseMap.elevationLayers.map(l=>({id:l.id})),n=this.presentation.slides,o=(l,c)=>l.visibleLayers.some(h=>h.id===c),a=s.filter(l=>!n.some(c=>o(c,l.id)));n.forEach(l=>{l.visibleLayers.addMany(a)})}}_writeBasemapElevationLayers(t){const e=t.ground?.layers;!t.baseMap&&e?.length&&(t.baseMap={title:"Basemap",baseMapLayers:[]}),t.baseMap&&(t.baseMap.elevationLayers=q(e))}_layersToJSON(t,e,i){const r={...i,layerContainerType:e};return t.map(s=>this._verifyWritableLayer(s,i)?s.write({},r):null).filter(s=>!!s).toArray()}_verifyWritableLayer(t,e){return!!t.persistenceEnabled&&("write"in t||(e?.messages&&e.messages.push(new U("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted in web scenes`,{layer:t})),!1))}write(t,e){if(this.loadStatus!=="loaded"){const s=new U("webscene:not-loaded","Web scene must be loaded before it can be serialized");throw J.getLogger(this).error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus),s}this._runLayersIdGC();const i=!e?.messages;e={messages:[],...e,origin:"web-scene"};const r=super.write(t,e);if(i){const s=e.messages?.filter(n=>n.name==="web-document-write:property-required")??[];if(s.length){const n=new U("web-document:property-required","One or more properties that are required in the webscene JSON are missing, see details for the specific errors",{errors:s});throw J.getLogger(this).error("#toJSON()","One or more properties that are required in the webscene JSON are missing",s),n}}return this._writeBasemapElevationLayers(r),r}async save(t){return this._debouncedSaveOperations(vl.SAVE,t)}async _saveImpl(t){if(!this.portalItem)throw new U("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene");if(this.portalItem?.type!==_9)throw new U("webscene:portal-item-wrong-type",`Portal item needs to have type "${_9}"`);const e=this._updateFromPromise;await this._ensureLoadBeforeSave();const i=this._enableVerifyItemRelativeUrls(aK(this.portalItem,"web-scene",!0)),r=this.write({},i);return await Promise.all(i.resources.pendingOperations),await this._verifySave(r,i,vl.SAVE,t),this._updateTypeKeywords(this.portalItem),await Ykt(this.portalItem,r,this._resourceReferences,i),DQ(i),e&&await e,await this._saveThumbnail(),this.portalItem}async saveAs(t,e){return this._debouncedSaveOperations(vl.SAVE_AS,e,t)}async _saveAsImpl(t,e){let i=eh.from(t);if(!i)throw new U("webscene:portal-item-required","saveAs requires a portal item to save to");i.id&&(i=i.clone(),i.id=null);const r=i.portal||fn.getDefault();await this._ensureLoadBeforeSave(),i.type=_9,i.portal=r;const s=this._enableVerifyItemRelativeUrls(aK(i,"web-scene",!0)),n=this.write({},s);await Promise.all(s.resources.pendingOperations),await this._verifySaveAs(n,s,e);const o=this.thumbnailUrl,a=!this._isOverridden("thumbnailUrl");this._updateTypeKeywords(i),await r.signIn();const l=this.portalItem,c={item:l,authenticated:!(!l?.id||!l.portal.user)},{copyAllowed:h,itemReloaded:d}=await tae(c,r);if(c.authenticated||=d,!h)throw new U(`${s.name}:save-as-copy-not-allowed`,"Owner of this map does not allow others to save a copy");const f={...e,copyAllResources:!0};return await iae(i,c,n,f)&&(this._resourceReferences.portalItem=i),await Xoe(this._resourceReferences,s),this.portalItem=i,$3.prototype.read.call(this,{version:n.version,authoringApp:n.authoringApp,authoringAppVersion:n.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:i.itemUrl?pn(i.itemUrl):void 0}),DQ(s),o&&(this.thumbnailUrl=a?qee(o,"w","8192"):o),s.portalItem=i,await this._saveThumbnail(),i}async _saveThumbnail(){this._isOverridden("thumbnailUrl")&&(await this.portalItem?.updateThumbnail({thumbnail:this.thumbnailUrl}),this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}async _verifySave(t,e,i,r){if(!xV(this.spatialReference))throw new U("webscene:unsupported-spatial-reference","Webscenes using spatial reference systems from Mars or Moon can not be saved currently.");const{ignoreUnsupported:s,requiredPropertyChecksDisabled:n,strictSchemaValidationEnabled:o}=r||{};Koe(e,{errorName:"webscene:save"},{ignoreUnsupported:s,supplementalUnsupportedErrors:["scenemodification:unsupported"],requiredPropertyChecksDisabled:n})}_verifySaveAs(t,e,i){return this._verifySave(t,e,vl.SAVE_AS,i)}verifySaveAs(t){const e=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),i=this.write({},e);return this._verifySaveAs(i,e,t)}canNotSaveAs(){return!1}async updateFrom(t,e={}){const i=this._updateFrom(t,e);this._updateFromPromise=i,await i,this._updateFromPromise===i&&(this._updateFromPromise=null)}async _updateFrom(t,e={}){if(await t.whenReady(),!e.environmentExcluded&&t.environment&&(this.initialViewProperties.environment=W$.prototype.clone.apply(t.environment)),!e.viewpointExcluded&&t.viewpoint&&(this.initialViewProperties.viewpoint=t.viewpoint.clone()),this.initialViewProperties.spatialReference=t.spatialReference.clone(),this.initialViewProperties.viewingMode=t.viewingMode,this.initialViewProperties.timeExtent=t.timeExtent?.clone()??null,t.clippingArea!=null?t.clippingArea!==this.clippingArea&&(this.clippingArea=t.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,t.heightModelInfo&&(this.heightModelInfo=t.heightModelInfo.clone()),t.map===this)for(const i of t.allLayerViews){const r="visible";r in i&&r in i.layer&&i._isOverridden(r)&&(i.layer[r]=i[r])}if(!e.widgetsExcluded)for(const i of t.persistableViewModels)i.updateWebDocument(this);(e.thumbnailExcluded===!1||e.thumbnailExcluded==null&&!e.viewpointExcluded)&&await this._updateFromThumbnail(t,e.thumbnailSize??void 0)}async _updateFromThumbnail(t,e){const i=r4e(t,e),r=await t.takeScreenshot({format:"jpg",width:i.width,height:i.height,disableDecorations:!0});this.thumbnailUrl=r.dataUrl}_loadFromSource(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):this.portalItem?.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()}_readAndLoadFromJSON(t,e){const i=this._validateJSON(t);return this.read(i,e),this._loadFromJSON(i,e)}_extractOperationalLayers(t){const e=[];if(!this.sourceVersion?.supportsGround&&t.baseMap&&Array.isArray(t.baseMap.elevationLayers))for(const s of t.baseMap.elevationLayers)e.push(s);const i=[],r=s=>(s.layers&&(s.layers=s.layers.filter(r)),s.layerType!=="ArcGISTiledElevationServiceLayer"||(this.sourceVersion?.supportsGround||i.push(s),!1));return{operationalLayers:t.operationalLayers?t.operationalLayers.filter(r):[],operationalElevationLayers:i,basemapElevationLayers:e}}async _loadFromJSON(t,e){const i=new Ee;await this._validateSpatialReference(),await this._validateHeightModelInfo();const{populateOperationalLayers:r}=await V(()=>import("./layersCreator-oRwakYTV.js"),__vite__mapDeps([118,119,120,121,122,123])),{operationalLayers:s,operationalElevationLayers:n,basemapElevationLayers:o}=this._extractOperationalLayers(t),a=[],l={context:{...e,layerContainerType:"operational-layers"}};if(this.portalItem&&(l.context.portal=this.portalItem.portal||fn.getDefault()),o.length>0){const c={...l,context:{...l.context,layerContainerType:"ground"}};c.defaultLayerType="ArcGISTiledElevationServiceLayer",a.push(r(this.ground.layers,o,c))}if(n.length>0){const c={...l,context:{...l.context,layerContainerType:"ground"}};c.defaultLayerType="ArcGISTiledElevationServiceLayer",a.push(r(i,n,c))}s&&s.length>0&&a.push(r(this.layers,s,l)),t.tables?.length&&a.push(r(this.tables,t.tables,{...l,context:{...l.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"})),await Promise.allSettled(a),await this._loadObjectsWithLayers(),this.ground.layers.addMany(i.filter(c=>c.type==="base-elevation"||c.type==="elevation"))}async _ensureLoadBeforeSave(){await this.load(),await this._loadObjectsWithLayers();const t=[],e=[...this.allLayers.items];for(const{basemap:i}of this.presentation.slides.items)i&&(e.push(...i.baseLayers.items),e.push(...i.referenceLayers.items));for(const i of e)if("beforeSave"in i&&typeof i.beforeSave=="function"){const r=i.beforeSave();r&&t.push(r)}await Promise.allSettled(t)}async _loadObjectsWithLayers(){const t=[];this.ground&&t.push(this.ground.load()),this.basemap&&t.push(this.basemap.load()),this.presentation.slides.forEach(e=>{e.basemap&&t.push(e.basemap.load())}),await Promise.allSettled(t)}async _loadFromItem(t){if(await t.load().catch(r=>{throw new U("webscene:load-portal-item","Failed to load portal item",{error:r})}),t.type!=="Web Scene")throw new U("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:t.type});const e=await t.fetchData();this.resourceInfo=e;const i={origin:"web-scene",url:pn(t.itemUrl),portal:t.portal||fn.getDefault(),portalItem:t,readResourcePaths:[]};await this._readAndLoadFromJSON(e,i),this._resourceReferences={portalItem:t,paths:i.readResourcePaths??[]}}_validateSpatialReference(){const t=this.initialViewProperties,e=this._sceneSpatialReference;let i;if(t.viewingMode!=="local"){if(!H$(e,Be.Global))return Promise.reject(new U("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:e,viewingMode:t.viewingMode}));i=a=>!a||ru(a,e)}else{if(!H$(e,Be.Local))return Promise.reject(new U("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:e,viewingMode:t.viewingMode}));i=a=>!a||a.equals(e)}const r=a=>a?.camera?.position.spatialReference??a?.targetGeometry?.spatialReference,s=t.viewpoint,n=r(s);if(n&&!i(n))return Promise.reject(new U("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:n,sceneSpatialReference:e,viewingMode:t.viewingMode}));const o=this.presentation.slides.find(a=>!i(r(a.viewpoint)));if(o){const a=r(o.viewpoint);return Promise.reject(new U("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:a,sceneSpatialReference:e,viewingMode:t.viewingMode}))}return Promise.resolve()}_validateHeightModelInfo(){const t=this._sceneSpatialReference,e=zKe(this.heightModelInfo,t);return e?Promise.reject(e):Promise.resolve()}_validateFeatureLayerSymbolVisibility(){this.sourceVersion?.greaterEqual(1,35)||this.layers.forEach(t=>{t.type==="feature"&&t.addHandles(H(()=>t.loaded,()=>{t.elevationInfo?.mode==="on-the-ground"&&t.renderer?.type==="simple"&&t.renderer.symbol?.type==="polygon-3d"&&t.renderer.symbol.symbolLayers.some(e=>e.type==="fill"&&e.material!=null&&(!e.material.color||e.material.color.a*t.opacity<Yr)&&(t.loadWarnings.push(new sh("feature-layer:invisible-draped-symbols","FeatureLayer has fully transparent symbols which will no longer render or highlight",{layer:t})),!0))},{once:!0,sync:!0}))})}_validateJSON(t){const e=LB.parse(t.version||"","webscene");return Bx.validate(e),t.version=`${e.major}.${e.minor}`,e.major===1&&e.minor<=2&&(t.spatialReference=Ae.WebMercator.toJSON()),t}_updateTypeKeywords(t){e_e(t,vS.LOCAL_SCENE,this.initialViewProperties.viewingMode==="local"),e_e(t,vS.DEVELOPER_BASEMAP,xW(this.basemap)||this.presentation.slides.some(({basemap:e})=>!!e&&xW(e))),t.typeKeywords&&(t.typeKeywords=t.typeKeywords.filter((e,i,r)=>r.indexOf(e)===i))}get _sceneSpatialReference(){return this.initialViewProperties.spatialReference||Ae.WebMercator}get _verifyItemRelativeRootPath(){return this.portalItem?.itemUrl?pn(this.portalItem.itemUrl).path:null}_enableVerifyItemRelativeUrls(t){const e=this._verifyItemRelativeRootPath;return e&&(t.verifyItemRelativeUrls={rootPath:e,writtenUrls:[]}),t}_unscheduleLayersIdGC(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)}_scheduleLayersIdGC(){this._unscheduleLayersIdGC(),this._layersIdGCTimeoutId=setTimeout(()=>{this._layersIdGCTimeoutId=0,this._runLayersIdGC()},3e3)}_runLayersIdGC(){this._unscheduleLayersIdGC();const t=this.applicationProperties?.viewing?.search,e=r=>this.allLayers.some(s=>s.id===r&&s.persistenceEnabled);t?.layers&&(t.layers=t.layers.filter(r=>e(r.id)));const i=this.presentation&&this.presentation.slides;i&&i.forEach(r=>{r.visibleLayers&&(r.visibleLayers=r.visibleLayers.filter(s=>e(s.id)))})}static fromJSON(t){if(!t)throw new U("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:t})}};q5e=Vkt,vr.version=`${Bx.major}.${Bx.minor}`,u([p({type:E4t,json:{write:!0}})],vr.prototype,"applicationProperties",void 0),u([p({type:gi,json:{read:{source:"clippingArea.geometry",reader:af},write:{target:"clippingArea.geometry"}}})],vr.prototype,"clippingArea",void 0),u([ge("clippingArea")],vr.prototype,"writeClippingArea",null),u([p({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],vr.prototype,"clippingEnabled",void 0),u([me("clippingEnabled",["clippingArea"])],vr.prototype,"readClippingEnabled",null),u([ge("clippingEnabled")],vr.prototype,"writeClippingEnabled",null),u([p({type:t4e,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],vr.prototype,"floorInfo",void 0),u([p({type:Bb,json:{write:!0}})],vr.prototype,"heightModelInfo",void 0),u([p({json:{write:{target:"operationalLayers",ignoreOrigin:!0}}})],vr.prototype,"layers",void 0),u([ge("layers")],vr.prototype,"writeLayers",null),u([p({readOnly:!0,type:LB,json:{type:L4t(),write:{ignoreOrigin:!0,target:"version",isRequired:!0,overridePolicy:()=>({enabled:!0,allowNull:!0,ignoreOrigin:!0})}}})],vr.prototype,"sourceVersion",void 0),u([me("sourceVersion",["version"])],vr.prototype,"readSourceVersion",null),u([ge("sourceVersion")],vr.prototype,"writeSourceVersion",null),u([p({json:{read:!1,write:{enabled:!0,ignoreOrigin:!0}}})],vr.prototype,"tables",void 0),u([ge("tables")],vr.prototype,"writeTables",null),u([p()],vr.prototype,"thumbnailUrl",null),u([p({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],vr.prototype,"authoringApp",null),u([ge("authoringApp")],vr.prototype,"writeAuthoringApp",null),u([p({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],vr.prototype,"authoringAppVersion",null),u([ge("authoringAppVersion")],vr.prototype,"writeAuthoringAppVersion",null),u([p({json:{write:{isRequired:!0,allowNull:!0,ignoreOrigin:!0,enabled:!0}}})],vr.prototype,"ground",void 0),u([ge("ground")],vr.prototype,"writeGround",null),u([p({type:Ee.ofType(D4t),json:{write:!0}})],vr.prototype,"transportationNetworks",void 0),u([p({type:H5e,nonNullable:!0,json:{write:{ignoreOrigin:!0,writer:(t,e,i,r)=>{if(t.slides&&t.slides.length>0){const s={...r,isPresentation:!0};e.presentation=t.write({},s)}}}}})],vr.prototype,"presentation",void 0),u([p({type:DB,nonNullable:!0,json:{write:{target:"initialState",isRequired:!0,ignoreOrigin:!0},default:()=>new DB({viewingMode:"global",spatialReference:Ae.WebMercator})}})],vr.prototype,"initialViewProperties",void 0),u([me("initialViewProperties",["initialState.timeExtent","initialState.environment","initialState.viewpoint","spatialReference","viewingMode"])],vr.prototype,"readInitialViewProperties",null),u([p({type:Ae,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],vr.prototype,"spatialReference",null),u([p({type:["local","global"],json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],vr.prototype,"viewingMode",null),u([p({type:eh})],vr.prototype,"portalItem",void 0),u([p()],vr.prototype,"resourceInfo",void 0),u([p({type:i4e,json:{write:!0}})],vr.prototype,"widgets",void 0),vr=u([A("esri.WebScene")],vr);const N4t=vr;function F4t(t){return t!=null&&typeof t=="object"&&t.type==="2d"&&t.view2dType==="linkchart"}async function k4t(t,e={}){const{basemap:i,view:r}=t;await i.load(e),U4t(i),await V4t(i,r,e),gt(e)}async function z4t(t,e={}){const{basemap:i,view:r}=t;gt(e);const s=i.baseLayers.find(a=>a.type==="unknown")?.loadError;if(s!=null)throw s;if(!r||"spatialReferenceLocked"in r&&!r.spatialReferenceLocked||(await i.load(e),gt(e),i.baseLayers.length===0))return;const n=i.baseLayers.at(0);if(!EC(n))return;if(i.spatialReference){if(r.spatialReference.equals(i.spatialReference))return;Dbe()}await n.load(e),gt(e);const o=(("supportedSpatialReferences"in n?n.supportedSpatialReferences:null)||["tileInfo"in n?n.tileInfo?.spatialReference:null]).filter(of);o.length!==0&&o.every(a=>!r.spatialReference.equals(a))&&Dbe()}function Dbe(){throw new U("basemap-compatibility:incompatible-spatial-reference","Basemap spatial reference is not compatible with the view")}function U4t(t){if(t.baseLayers.length===0&&t.referenceLayers.length===0)return;const e=t.baseLayers.concat(t.referenceLayers).toArray().filter(i=>!VWe(i)).map(i=>B4t(i));if(e.length)throw e[0]}function B4t(t){return new U("basemap-compatibility:unsupported-basemap-layer-type","Unsupported basemap layer type ${operationalLayerType}",{layer:t,operationalLayerType:t.operationalLayerType||"unknown"})}async function V4t(t,e,i){if(t.baseLayers.length===0)return;const r=t.baseLayers.at(0);if(y2e(r)){try{await r.load(i)}catch(s){const n="basemap-compatibility:unknown-error",o="Unknown basemap compatibility error",{name:a=n,message:l=o,details:c}=s;throw new U(a,l,c)}j4t(r,e)}}function j4t(t,e){const i=e.state.viewingMode;if(!i)return;let r,s;if(t?.type==="wmts"){const a=sFe(t,e.spatialReference,i);if(a.tileInfo==null)throw new U("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view");r=a.tileInfo,s=a.fullExtent}else r=t.tileInfo,s=t.fullExtent;if(r==null)return;if(!H$(r.spatialReference,i))throw new U(`basemapgalleryitem:spatial-reference-unsupported-${$R(i)}`,`Basemap spatial reference is unsupported in ${$R(i)} mode`);const n=t?.type==="vector-tile"?r.getCompatibleForVTL(256):null;if(i===Be.Global){let a=T3(r,s,null,i);if(a&&t?.type==="vector-tile"&&s!=null&&n&&!T3(n,s,null,i)&&(a=null),a){const l=r.spatialReference.isWebMercator?"web-mercator":"wgs84";throw new U(`basemapgalleryitem:tiling-scheme-unsupported-${l}-global`,"Basemap tiling scheme is unsupported in global mode",{error:a})}}else if(rc.checkUnsupported(r))throw new U("basemapgalleryitem:tiling-scheme-unsupported-local","Basemap tiling scheme is unsupported in local mode");const o=e.basemapTerrain?.tilingScheme;if(o&&!o.compatibleWith(r)&&(t?.type!=="vector-tile"||!n||!o.compatibleWith(n)))throw new U("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view")}let cm=class extends OS.IdentifiableMixin(ue){constructor(e){super(e),this.compatibilityFunction=null,this.error=null,this.state="loading",this.view=null}initialize(){const e=()=>this.refresh();this.addHandles([H(()=>this.basemap?.loadStatus,e),H(()=>this.compatibilityFunction,e),H(()=>this.view&&"basemapTerrain"in this.view&&this.view.basemapTerrain?.tilingScheme,e),H(()=>this.view?.ready,e),H(()=>this.view?.spatialReference,e)]),this.refresh()}destroy(){this._cancelRefresh(),this.basemap=null,this.compatibilityFunction=null,this.view=null}get _spatialReferenceTask(){return Y2e(this.view,this.basemap)}set basemap(e){e&&e.load().catch(()=>{}),this._set("basemap",e)}get spatialReference(){return this._spatialReferenceTask.spatialReference}refresh(){this._cancelRefresh(),this._set("state","loading");const e=this.basemap?.loadStatus;if(e!=="loaded"&&e!=="failed")return;if(!this.compatibilityFunction)return void(e==="loaded"?(this._set("state","ready"),this._set("error",null)):(this._set("state","error"),this._set("error",this.basemap.loadError)));const i=new AbortController,{signal:r}=i;this.compatibilityFunction(this,{signal:r}).then(()=>Cd(()=>!this._spatialReferenceTask.updating,r)).then(()=>{this._set("state","ready"),this._set("error",null)}).catch(s=>{Xr(s)||(this._set("state","error"),this._set("error",s))}),this._refreshController=i}_cancelRefresh(){this._refreshController&&(this._refreshController.abort(),this._refreshController=null)}};u([p({readOnly:!0})],cm.prototype,"_spatialReferenceTask",null),u([p()],cm.prototype,"basemap",null),u([p()],cm.prototype,"compatibilityFunction",void 0),u([p({readOnly:!0})],cm.prototype,"error",void 0),u([p({readOnly:!0})],cm.prototype,"spatialReference",null),u([p({readOnly:!0})],cm.prototype,"state",void 0),u([p()],cm.prototype,"view",void 0),cm=u([A("esri.widgets.BasemapGallery.support.BasemapGalleryItem")],cm);const W5e=cm,Z5e=Ee.ofType(qy);let sR=class extends ue{constructor(e){super(e),this.basemaps=new Z5e}destroy(){this.basemaps.forEach(e=>e.destroy())}get state(){return"ready"}refresh(){}};u([p({type:Z5e})],sR.prototype,"basemaps",void 0),u([p({readOnly:!0})],sR.prototype,"state",null),sR=u([A("esri.widgets.BasemapGallery.support.LocalBasemapsSource")],sR);const Y5e=sR,J5e=Ee.ofType(qy);let um=class extends $l.LoadableMixin(Ub.EsriPromiseMixin(Y5e)){constructor(t){super(t),this._lastPortalBasemapFetchController=null,this.basemaps=new J5e,this.filterFunction=null,this.portal=fn.getDefault(),this.query=null,this.updateBasemapsCallback=null,this.viewType=null}initialize(){this.addHandles(H(()=>[this.filterFunction,this.loadStatus,this.portal?.basemapGalleryGroupQuery,this.portal?.basemapGalleryGroupQuery3D,this.portal?.user,this.query,this.updateBasemapsCallback],()=>this.refresh(),Nt))}destroy(){this.filterFunction=null,this.portal=null,this.basemaps.forEach(t=>t.destroy())}get state(){return this.loadStatus==="not-loaded"?"not-loaded":this.loadStatus==="loading"||this._lastPortalBasemapFetchController?"loading":"ready"}load(t){return this.addResolvingPromise(this.portal.load(t)),Promise.resolve(this)}async refresh(){if(this.loadStatus!=="loaded")return;this._lastPortalBasemapFetchController&&(this._lastPortalBasemapFetchController.abort(),this._lastPortalBasemapFetchController=null);const t=this.portal,e=new AbortController;this._lastPortalBasemapFetchController=e,this.notifyChange("state");try{const i=await t.fetchBasemaps(this._toQueryString(this.query),{signal:e.signal,include3d:this.viewType==="3d"||void 0});await this._updateBasemaps(i)}catch(i){if(Xr(i))throw i;J.getLogger(this).warn(new U("basemap-source:fetch-basemaps-error","Could not fetch basemaps from portal.",{error:i})),await this._updateBasemaps()}this._lastPortalBasemapFetchController=null,this.notifyChange("state")}_toQueryString(t){return t&&typeof t!="string"?Object.keys(t).map(e=>`${e}:${t[e]}`).join(" AND "):t}async _updateBasemaps(t=[]){let e=await this._filterBasemaps(t);e=this.updateBasemapsCallback?await this.updateBasemapsCallback(e):e,this.basemaps.removeAll(),this.basemaps.addMany(e)}async _filterBasemaps(t){if(!this.filterFunction)return t;const e=t.map(this.filterFunction),i=await Promise.all(e);return t.filter((r,s)=>i[s])}};u([p({readOnly:!0,type:J5e})],um.prototype,"basemaps",void 0),u([p()],um.prototype,"filterFunction",void 0),u([p({type:fn})],um.prototype,"portal",void 0),u([p()],um.prototype,"query",void 0),u([p({readOnly:!0})],um.prototype,"state",null),u([p()],um.prototype,"updateBasemapsCallback",void 0),u([p()],um.prototype,"viewType",void 0),um=u([A("esri.widgets.BasemapGallery.support.PortalBasemapsSource")],um);const pC=um,X5e=Ee.ofType(W5e);function G4t(t){return t&&t.declaredClass==="esri.portal.Portal"}function H4t(t){return t&&!(t instanceof pC)&&(!!t.portal||!!t.query)}function q4t(t){return t&&"basemaps"in t&&"state"in t&&"refresh"in t}let Ru=class extends $l{constructor(t){super(t),this._loadingProjectionEngine=!1,this.items=new X5e,this.source=new pC,this.view=null}initialize(){const t=()=>this._recreateItems();this.addHandles([H(()=>this.state==="ready"?this.compatibilityFunction:null,()=>this._updateItems()),io(()=>this.source?.basemaps,"change",t,{onListenerAdd:t}),gn(()=>this.view,()=>{this.source instanceof pC&&(this.source.viewType=this.view?.type)},{once:!0})])}destroy(){const t=this.source.basemaps.find(e=>e===this.activeBasemap);t&&this.source.basemaps.remove(t),this.source?.destroy()}get activeBasemap(){return this.view?.map?.basemap??null}set activeBasemap(t){const e=this.view;if(!e?.map)return;if(!t||!e.ready)return e.map.basemap=t,void this._clearOverride("activeBasemap");const i=t.spatialReference||this.items?.find(r=>this.basemapEquals(t,r.basemap))?.spatialReference;if(i&&"spatialReferenceLocked"in e&&!e.spatialReferenceLocked){const r=e.spatialReference;if(i!=null&&!rs(r,i)&&!ru(e.spatialReference,i)&&!$v())return this._override("activeBasemap",t),this._loadingProjectionEngine=!0,void nv().then(()=>{this._get("activeBasemap")===t&&(e.map.basemap=t,e.spatialReference=i,this._clearOverride("activeBasemap"))},()=>{}).then(()=>{this._loadingProjectionEngine=!1});e.map.basemap=t,this._clearOverride("activeBasemap"),i==null||rs(e.spatialReference,i)||(e.spatialReference=i)}else e.map.basemap=t,this._clearOverride("activeBasemap")}castActiveBasemap(t){return HV(t)}get activeBasemapIndex(){const{state:t,activeBasemap:e}=this;return t!=="ready"?-1:this._findBasemapIndex(e)}get compatibilityFunction(){return this.view?.type==="3d"?k4t:z4t}set compatibilityFunction(t){this._overrideIfSome("compatibilityFunction",t)}castSource(t){return Array.isArray(t)||Ee.isCollection(t)?new Y5e({basemaps:Array.isArray(t)?new Ee(t):t}):G4t(t)?new pC({portal:t}):H4t(t)?new pC(t):q4t(t)?t:null}get state(){return this.view?.ready&&this.source?F4t(this.view)&&!this.view.inGeographicLayout?"unsupported":this._loadingProjectionEngine?"loading":"ready":"disabled"}basemapEquals(t,e){return nYe(t,e)}refresh(){this._recreateItems()}load(){return this.loadSource()}loadSource(t){return this.addResolvingPromise($l.isLoadable(this.source)?this.source.load(t):null),Promise.resolve(this)}_findBasemapIndex(t){const{items:e}=this,i=e.findIndex(r=>r.basemap===t);return i===-1?e.findIndex(r=>this.basemapEquals(r.basemap,t)):i}_recreateItems(){const t=this.source?.basemaps??[],{view:e,compatibilityFunction:i}=this,r=new Map(this.items.map(n=>[n.basemap,n])),s=t.map(n=>{const o=r.get(n);return o?(r.delete(n),o):new W5e({basemap:n,compatibilityFunction:i,view:e})});this.items.removeAll(),this.items.addMany(s),r.forEach(n=>n.destroy())}_updateItems(){for(const t of this.items)t.compatibilityFunction=this.compatibilityFunction,t.view=this.view}};u([p()],Ru.prototype,"_loadingProjectionEngine",void 0),u([p({type:qy})],Ru.prototype,"activeBasemap",null),u([Yt("activeBasemap")],Ru.prototype,"castActiveBasemap",null),u([p({readOnly:!0})],Ru.prototype,"activeBasemapIndex",null),u([p()],Ru.prototype,"compatibilityFunction",null),u([p({readOnly:!0,type:X5e})],Ru.prototype,"items",void 0),u([p()],Ru.prototype,"source",void 0),u([Yt("source")],Ru.prototype,"castSource",null),u([p({readOnly:!0})],Ru.prototype,"state",null),u([p()],Ru.prototype,"view",void 0),Ru=u([A("esri.widgets.BasemapGallery.BasemapGalleryViewModel")],Ru);const W4t=Ru,tp="esri-basemap-gallery",ip={base:tp,sourceLoading:`${tp}--source-loading`,loader:`${tp}__loader`,item:`${tp}__item`,itemContainer:`${tp}__item-container`,itemContent:`${tp}__item-content`,itemTitle:`${tp}__item-title`,itemTagsContainer:`${tp}__item-tags-container`,itemThumbnail:`${tp}__item-thumbnail`,selectedItem:`${tp}__item--selected`,itemError:`${tp}__item--error`};function Lbe({level:t,class:e,...i},r){const s=K5e(t);return Zt(`h${s}`,{...i,"aria-level":String(s),class:s2e(Wo.heading,e),role:"heading"},r)}function K5e(t){return ce(Math.ceil(t),1,6)}function Sfi(t,e=1){return K5e(t+e)}let Ic=class extends zS{constructor(e,i){super(e,i),this.disabled=!1,this.headingLevel=2,this.messages=null,this.viewModel=new W4t,this._focusBasemapItemEnabled=!1,xVe(J.getLogger(this),"Basemap Gallery","arcgis-basemap-gallery",{version:"4.32"})}initialize(){this.addHandles(gn(()=>this.source,()=>this.viewModel.loadSource(),{sync:!0,initial:!0}))}loadDependencies(){return CD({scrim:()=>V(()=>Promise.resolve().then(()=>rUt),void 0),chip:()=>V(()=>import("./index-BbC7Y_Wo.js"),[])})}get activeBasemap(){return this.viewModel.activeBasemap}set activeBasemap(e){this.viewModel.activeBasemap=e}get icon(){return"basemap"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get source(){return this.viewModel.source}set source(e){this.viewModel.source=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e=this.source.state==="loading",i=this.disabled||this.viewModel.state==="disabled",r={[ip.sourceLoading]:e,[Wo.disabled]:i};return Zt("div",{class:this.classes(ip.base,Wo.widget,Wo.panel,r),key:"container"},this._getContext())}_getContext(){if(this.viewModel.state==="unsupported")return Zt("div",{class:Wo.empty,key:"empty-message"},Zt(Lbe,{level:this.headingLevel},this.messages.unsupported));if(this.source.state==="loading")return Zt("div",{class:ip.loader,key:"loader"});const e=this.viewModel.items;return e.length>0?Zt("ul",{"aria-disabled":this.disabled,"aria-label":this.label,bind:this,class:ip.itemContainer,key:"item-container",onkeydown:this._handleKeyDown,role:"radiogroup"},e.map((i,r)=>this._renderBasemapGalleryItem(i,r)).toArray()):Zt("div",{class:Wo.empty,key:"empty-message"},Zt(Lbe,{level:this.headingLevel},this.messages.noBasemaps))}_getRoundRobinIndex(e,i){return(e+i)%i}_handleKeyDown(e){const{key:i}=e;if(!["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(i))return;e.preventDefault();const{items:r,activeBasemapIndex:s}=this.viewModel,n=i==="ArrowUp"||i==="ArrowLeft"?this._getRoundRobinIndex(Math.max(s-1,-1),r.length):this._getRoundRobinIndex(s+1,r.length),o=r.at(n);o?.state==="ready"&&(this.viewModel.activeBasemap=o.basemap),this._focusBasemapItemEnabled=!0}_focusBasemapItem(e){this._focusBasemapItemEnabled&&e.tabIndex===0&&(e.focus(),this._focusBasemapItemEnabled=!1)}_handleClick(e){const i=e.currentTarget["data-item"];i.state==="ready"&&(this.viewModel.activeBasemap=i.basemap)}_renderBasemapGalleryItem(e,i){const r=lYe(e.basemap)||gs("esri/themes/base/images/basemap-toggle-64.svg"),s=e.basemap.title,n=e.basemap.portalItem?.snippet,o=e.error?.message||n||s,{viewModel:{state:a,activeBasemapIndex:l}}=this,c=this.disabled||a==="disabled",h=l===i,d=h||l===-1&&i===0?0:-1,f=a==="loading",m={[ip.selectedItem]:h,[ip.itemError]:e.state==="error"},y=`basemapgallery-item-${e.uid}`;return Zt("li",{afterUpdate:this._focusBasemapItem,"aria-checked":h.toString(),"aria-disabled":c.toString(),"aria-labelledby":y,bind:this,class:this.classes(ip.item,m),"data-item":e,key:e.uid,onclick:this._handleClick,onkeydown:this._handleClick,role:"radio",tabIndex:d,title:o},Zt("img",{alt:"",class:ip.itemThumbnail,src:r}),Zt("div",{class:ip.itemContent,key:"content"},Zt("div",{class:ip.itemTitle,key:"title"},Zt("span",{id:y},s)),iYe(e.basemap)?this._renderTags(e.basemap):null),e.state==="loading"||h&&f?Zt("calcite-scrim",null,Zt("span",{"aria-hidden":"true",class:Wo.loaderAnimation,key:"loader",role:"presentation"})):null)}_renderTags(e){return Zt("div",{class:ip.itemTagsContainer,key:"tag"},this._render3DTag(),rYe(e)?this._renderBetaTag():null)}_render3DTag(){const{messages:e}=this;return Zt("calcite-chip",{key:"tag-3d",label:e.tag3D,scale:"s"},this.messages.tag3D)}_renderBetaTag(){const{messages:e}=this;return Zt("calcite-chip",{appearance:"outline-fill",key:"tag-beta",label:e.tagBeta,scale:"s"},this.messages.tagBeta)}};u([p()],Ic.prototype,"activeBasemap",null),u([p()],Ic.prototype,"disabled",void 0),u([p()],Ic.prototype,"headingLevel",void 0),u([p()],Ic.prototype,"icon",null),u([p()],Ic.prototype,"label",null),u([p(),dv("esri/widgets/BasemapGallery/t9n/BasemapGallery")],Ic.prototype,"messages",void 0),u([p()],Ic.prototype,"source",null),u([p()],Ic.prototype,"view",null),u([p()],Ic.prototype,"viewModel",void 0),u([p()],Ic.prototype,"_focusBasemapItemEnabled",void 0),u([QMe()],Ic.prototype,"_handleClick",null),Ic=u([A("esri.widgets.BasemapGallery")],Ic);const Z4t=Ic;let h_=class extends ue{constructor(t){super(t),this._viewpointHandle=null,this.group=null}initialize(){this.addHandles(io(()=>this.view?.ui,"expand",t=>{const{target:e}=t;e&&e!==this&&e.expanded&&e.group&&e.group===this.group&&this._collapse()}))}destroy(){this._viewpointHandle=null,this.view=null}set autoCollapse(t){this._set("autoCollapse",t),this._watchViewpoint()}set expanded(t){const e=!!t;this._set("expanded",e);const i=this.view?.ui;i&&i.emit("expand",{target:this}),this._viewpointHandleChange(e)}get state(){return this.view?.ready?"ready":"disabled"}set view(t){this._get("view")!==t&&(this._set("view",t),t&&gn(()=>t.ready,()=>{this.view===t&&this._watchViewpoint()},{once:!0,initial:!0}))}_viewpointHandleChange(t){this._viewpointHandle&&(t?gn(()=>this.view?.stationary,()=>this._viewpointHandle?.resume(),{once:!0,initial:!0}):this._viewpointHandle.pause())}_watchViewpoint(){const t="viewpoint";this.removeHandles(t),this._viewpointHandle=null;const{autoCollapse:e,view:i}=this;if(!i||!e)return;const r=IHe(()=>i.type==="3d"?i.camera:i.viewpoint,()=>this._collapse());this.addHandles(r,t),this._viewpointHandle=r}_collapse(){this.expanded=!1}};u([p({value:!1})],h_.prototype,"autoCollapse",null),u([p({value:!1})],h_.prototype,"expanded",null),u([p()],h_.prototype,"group",void 0),u([p({readOnly:!0})],h_.prototype,"state",null),u([p({value:null})],h_.prototype,"view",null),h_=u([A("esri.widgets.Expand.ExpandViewModel")],h_);const Q5e=h_;function b9(t){return t&&typeof t.render=="function"}function Y4t(t){return t&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}const w0="esri-expand",yu={base:w0,toggle:`${w0}__toggle`,popoverContent:`${w0}__popover-content`,panel:`${w0}__panel`,panelContent:`${w0}__panel-content`,sheet:`${w0}__sheet`,contentContainer:`${w0}__content-container`,icon:"esri-collapse__icon",iconFlip:"esri-collapse__icon-flip",iconNumber:`${w0}__icon-number`},Nbe="chevrons-left",Fbe="chevrons-right";let Us=class extends zS{constructor(t,e){super(t,e),this.closeOnEsc=!0,this.collapseTooltip="",this.content="",this.expandTooltip="",this.focusTrapDisabled=!1,this.iconNumber=0,this.messages=null,this.messagesCommon=null,this.mode="auto",this.placement=null,this.viewModel=new Q5e,this.toggle=()=>{this.viewModel.expanded=!this.viewModel.expanded},this._handlePopoverClose=i=>{i.target===this._popoverEl&&(this.viewModel.expanded=i.currentTarget.open)},this._handleSheetClose=i=>{this.viewModel.expanded=i.currentTarget.open},this._handlePanelClose=i=>{this.viewModel.expanded=!i.currentTarget.closed},this._handleKeyDown=i=>{this.viewModel.expanded&&i.key==="Escape"&&!this._willCloseOnEsc(i)&&i.preventDefault()},this._storeToggleActionEl=i=>{this._toggleActionEl=i},this._storePopoverEl=i=>{this._popoverEl=i}}initialize(){this.addHandles(H(()=>this.viewModel?.view?.size,()=>this._popoverEl?.reposition(),Nt))}loadDependencies(){return CD({action:()=>V(()=>Promise.resolve().then(()=>yjt),void 0),icon:()=>V(()=>Promise.resolve().then(()=>vze),void 0),panel:()=>V(()=>Promise.resolve().then(()=>gGt),void 0),popover:()=>V(()=>Promise.resolve().then(()=>uGt),void 0),sheet:()=>V(()=>import("./index-jZnFjr-R.js"),__vite__mapDeps([380,381,382]))})}get expandTitle(){const{expanded:t,messagesCommon:e,collapseTooltip:i,expandTooltip:r}=this;return(t?i||e?.collapse:r||e?.expand)??""}get _displaySheet(){switch(this.mode){case"drawer":return!0;case"auto":return this.viewModel.view?.widthBreakpoint==="xsmall";default:return!1}}get autoCollapse(){return this.viewModel.autoCollapse}set autoCollapse(t){this.viewModel.autoCollapse=t}get collapseIcon(){return Fbe}set collapseIcon(t){this._overrideIfSome("collapseIcon",t)}get expanded(){return this.viewModel.expanded}set expanded(t){this.viewModel.expanded=t}get expandIcon(){return b9(this.content)?this.content.icon:Nbe}set expandIcon(t){this._overrideIfSome("expandIcon",t)}get group(){return this.viewModel.group}set group(t){this.viewModel.group=t}get icon(){return null}get label(){return(b9(this.content)?this.content.label:null)??this.messages?.widgetLabel??""}set label(t){this._overrideIfSome("label",t)}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}expand(){this.viewModel.expanded=!0}collapse(){this.viewModel.expanded=!1}render(){const{_displaySheet:t,_toggleActionEl:e,viewModel:{expanded:i},label:r,placement:s}=this;return Zt("div",{class:this.classes(yu.base,Wo.widget)},this._renderToggle(),t?Zt("calcite-sheet",{class:yu.sheet,heightScale:"l",label:r,onkeydown:this._handleKeyDown,open:i,position:"block-end",onCalciteSheetClose:this._handleSheetClose},Zt("calcite-panel",{class:yu.panel,closable:!0,closed:!i,heading:r,onkeydown:this._handleKeyDown,onCalcitePanelClose:this._handlePanelClose},Zt("div",{class:yu.panelContent},this._renderContent()))):e?Zt("calcite-popover",{afterCreate:this._storePopoverEl,afterUpdate:this._storePopoverEl,focusTrapDisabled:this.focusTrapDisabled,label:r,onkeydown:this._handleKeyDown,open:i,overlayPositioning:"fixed",placement:s??this._getPlacement(),referenceElement:e,onCalcitePopoverClose:this._handlePopoverClose},Zt("div",{class:yu.popoverContent},this._renderContent())):null)}_getPlacement(){const{container:t,view:e}=this,i=t&&e?e.ui.getPosition(t):null;if(!i||i==="manual")return"auto";const[r,s]=i.split("-");return`${s==="right"?"left":"right"}-${r==="bottom"?"end":"start"}`}_willCloseOnEsc(t){const{closeOnEsc:e}=this;return typeof e=="function"?e(t):e}_renderBadgeNumber(){const{expanded:t,iconNumber:e}=this;return e&&!t?Zt("span",{class:yu.iconNumber,key:"expand__icon-number"},e):null}_renderToggleButton(){const{expanded:t,expandTitle:e,expandIcon:i,collapseIcon:r}=this,s=t?r:i,n=s===Nbe||s===Fbe;return Zt("calcite-action",{afterCreate:this._storeToggleActionEl,afterUpdate:this._storeToggleActionEl,class:Wo.widgetButton,onclick:this.toggle,scale:"s",text:e,title:e},s?Zt("calcite-icon",{class:this.classes(yu.icon,n&&yu.iconFlip),icon:s,scale:"s"}):null)}_renderToggle(){return Zt("div",{class:yu.toggle},this._renderToggleButton(),this._renderBadgeNumber())}_renderContent(){const{content:t}=this;return typeof t=="string"?Zt("div",{class:yu.contentContainer,innerHTML:t,key:"content__string"}):b9(t)?Zt("div",{class:yu.contentContainer,key:"content__widget"},t.render()):t instanceof HTMLElement?Zt("div",{afterCreate:this._attachToNode,bind:t,class:yu.contentContainer,key:"content__html-element"}):Y4t(t)?Zt("div",{afterCreate:this._attachToNode,bind:t.domNode,class:yu.contentContainer,key:"content__node"}):null}_attachToNode(t){const e=this;t.appendChild(e)}};u([p({readOnly:!0})],Us.prototype,"expandTitle",null),u([p()],Us.prototype,"_toggleActionEl",void 0),u([p()],Us.prototype,"_displaySheet",null),u([p()],Us.prototype,"autoCollapse",null),u([p()],Us.prototype,"closeOnEsc",void 0),u([p()],Us.prototype,"collapseIcon",null),u([p()],Us.prototype,"collapseTooltip",void 0),u([p()],Us.prototype,"content",void 0),u([p()],Us.prototype,"expanded",null),u([p()],Us.prototype,"expandIcon",null),u([p()],Us.prototype,"expandTooltip",void 0),u([p()],Us.prototype,"focusTrapDisabled",void 0),u([p()],Us.prototype,"group",null),u([p()],Us.prototype,"icon",null),u([p()],Us.prototype,"iconNumber",void 0),u([p()],Us.prototype,"label",null),u([p(),dv("esri/widgets/Expand/t9n/Expand")],Us.prototype,"messages",void 0),u([p(),dv("esri/t9n/common")],Us.prototype,"messagesCommon",void 0),u([p()],Us.prototype,"mode",void 0),u([p()],Us.prototype,"placement",void 0),u([p()],Us.prototype,"view",null),u([p({type:Q5e})],Us.prototype,"viewModel",void 0),Us=u([A("esri.widgets.Expand")],Us);const J4t=Us;var X4t=Object.defineProperty,K4t=Object.getOwnPropertyDescriptor,zG=(t,e,i,r)=>{for(var s=r>1?void 0:r?K4t(e,i):e,n=t.length-1,o;n>=0;n--)(o=t[n])&&(s=(r?o(e,i,s):o(s))||s);return r&&s&&X4t(e,i,s),s};let iA=class extends Xp{constructor(){super(...arguments),this.view=null,this.extentJson="",this.scale=null,this.extentHandle=null,this.scaleHandle=null}connectedCallback(){super.connectedCallback(),this.setupWatchers()}disconnectedCallback(){super.disconnectedCallback(),this.cleanupWatchers()}updated(t){t.has("view")&&(this.cleanupWatchers(),this.setupWatchers(),this.updateExtentAndScale())}setupWatchers(){this.view&&(this.extentHandle=H(()=>this.view.extent,()=>this.updateExtentAndScale()),this.scaleHandle=H(()=>this.view.scale,()=>this.updateExtentAndScale()),this.updateExtentAndScale())}cleanupWatchers(){this.extentHandle?.remove?.(),this.scaleHandle?.remove?.(),this.extentHandle=null,this.scaleHandle=null}updateExtentAndScale(){if(!this.view)return;const t=this.view.extent;if(t){const{xmin:e,ymin:i,xmax:r,ymax:s,spatialReference:n}=t;this.extentJson=JSON.stringify({xmin:e,ymin:i,xmax:r,ymax:s,spatialReference:n},null,2)}this.scale=this.view.scale??null}async copyExtent(){try{await navigator.clipboard.writeText(this.extentJson)}catch{const t=document.createElement("textarea");t.value=this.extentJson,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}}render(){return le`
      <span class="extent-label">Current Extent</span>
      <div class="extent-json">${this.extentJson}</div>
      <button @click=${this.copyExtent}>Copy as JSON</button>
      <div class="scale">Scale: <b>${this.scale?Math.round(this.scale):"N/A"}</b></div>
    `}};iA.styles=Js`
    :host {
      position: absolute;
      bottom: 20px;
      right: 20px;
      z-index: 30;
      background: white;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 12px 16px;
      font-size: 13px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      min-width: 260px;
      max-width: 350px;
      user-select: text;
    }
    .extent-label {
      font-weight: bold;
      margin-bottom: 4px;
      display: block;
    }
    .extent-json {
      font-family: monospace;
      font-size: 12px;
      background: #f7f7f7;
      padding: 4px 6px;
      border-radius: 4px;
      margin-bottom: 6px;
      word-break: break-all;
      white-space: pre-wrap;
    }
    button {
      font-size: 12px;
      padding: 3px 10px;
      border-radius: 4px;
      border: 1px solid #aaa;
      background: #f3f3f3;
      cursor: pointer;
      margin-top: 4px;
    }
    .scale {
      margin-top: 6px;
      color: #555;
    }
  `;zG([cA({attribute:!1})],iA.prototype,"view",2);zG([Cv()],iA.prototype,"extentJson",2);zG([Cv()],iA.prototype,"scale",2);iA=zG([cV("view-extent")],iA);var Q4t=Object.defineProperty,e5t=Object.getOwnPropertyDescriptor,nL=(t,e,i,r)=>{for(var s=r>1?void 0:r?e5t(e,i):e,n=t.length-1,o;n>=0;n--)(o=t[n])&&(s=(r?o(e,i,s):o(s))||s);return r&&s&&Q4t(e,i,s),s};let bS=class extends Xp{constructor(){super(...arguments),this.view=null,this.inputJson="",this.error="",this.drawing=!1,this.graphic=null,this.sketch=null,this.graphicsLayer=null}async firstUpdated(){if(!this.view)return;const[t,e]=await Promise.all([V(()=>import("./GraphicsLayer-BaW3rFbI.js"),[]),V(()=>import("./Sketch-B3HpmcYe.js").then(i=>i.S),__vite__mapDeps([383,384,385,158,386,223,288,290,287,291,387,329,111,268,286,328,338,314,11,3,315,168,112,1]))]);this.graphicsLayer=new t.default,this.view.map.add(this.graphicsLayer),this.sketch=new e.default({view:this.view,layer:this.graphicsLayer,creationMode:"single",availableCreateTools:["rectangle"],visibleElements:{createTools:{point:!1,polyline:!1,polygon:!1,circle:!1}}}),this.sketch.on("create",async i=>{if(i.state==="complete"&&this.graphic===null){if(this.clearGraphics(),this.sketch&&this.sketch.layer&&i.graphic&&this.sketch.layer.graphics.includes(i.graphic)&&this.sketch.layer.remove(i.graphic),this.sketch.visible=!1,this.graphicsLayer&&i.graphic&&i.graphic.geometry){const[r]=await Promise.all([V(()=>Promise.resolve().then(()=>Rue),void 0)]),s=new r.default({geometry:i.graphic.geometry.clone(),symbol:i.graphic.symbol,popupTemplate:{title:"Drawn Extent",content:`<pre>${JSON.stringify(i.graphic.geometry.toJSON(),null,2)}</pre>`}});this.graphicsLayer.add(s),this.graphic=s}if(this.graphic&&this.graphic.geometry&&this.view)if(this.view.type==="3d"&&this.graphic.geometry.extent){const r=this.graphic.geometry.extent;await this.view.goTo({target:r,tilt:0,heading:0})}else await this.view.goTo(this.graphic.geometry);this.dispatchExtent(),this.drawing=!1,this.view&&this.view.popup&&typeof this.view.popup.open=="function"&&this.graphic&&this.view.popup.open({features:[this.graphic],location:this.graphic.geometry})}}),this.sketch.visible=!1,this.view.ui.add(this.sketch,"top-right")}updated(t){t.has("view")&&this.view&&(this.clearGraphics(),this.graphicsLayer&&this.view.map.add(this.graphicsLayer),this.sketch&&(this.sketch.view=this.view,this.view.ui.add(this.sketch,"top-right")),this.view.ui.find(e=>e===this)||this.view.ui.add(this,"bottom-left"))}connectedCallback(){super.connectedCallback(),this.view&&this.view.ui&&!this.view.ui.find(t=>t===this)&&this.view.ui.add(this,"bottom-left")}clearGraphics(){this.graphicsLayer&&this.graphicsLayer.removeAll(),this.graphic=null}async handleDraw(){this.error="",this.drawing=!0,this.sketch&&(this.sketch.visible=!0,this.sketch.create("rectangle"))}handleInput(t){this.inputJson=t.target.value}async handlePasteExtent(){this.error="",this.clearGraphics();let t;try{if(t=JSON.parse(this.inputJson),typeof t.xmin!="number"||typeof t.ymin!="number"||typeof t.xmax!="number"||typeof t.ymax!="number"||!t.spatialReference)throw new Error("Invalid extent JSON")}catch{this.error="Invalid extent JSON";return}const[e,i]=await Promise.all([V(()=>Promise.resolve().then(()=>Rue),void 0),V(()=>Promise.resolve().then(()=>U6e),void 0)]);let r=t.spatialReference;typeof r=="number"&&(r={wkid:r});const s=new i.default({xmin:t.xmin,ymin:t.ymin,xmax:t.xmax,ymax:t.ymax,spatialReference:r});this.graphic=new e.default({geometry:s,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[0,0,0,1],width:2}},popupTemplate:{title:"Extent from JSON",content:`<pre>${JSON.stringify(s.toJSON(),null,2)}</pre>`}}),this.graphicsLayer.add(this.graphic),this.view&&(await this.view.goTo(s),this.view.popup&&this.view.popup.open({features:[this.graphic],location:s})),this.dispatchExtent()}dispatchExtent(){this.graphic&&this.dispatchEvent(new CustomEvent("extent-drawn",{detail:{extent:this.graphic.geometry.toJSON()},bubbles:!0,composed:!0}))}render(){return le`
      <span class="section-label">Draw or Paste Extent</span>
      <textarea
        placeholder="Paste extent JSON here"
        .value=${this.inputJson}
        @input=${this.handleInput}
      ></textarea>
      <div>
        <button @click=${this.handlePasteExtent}>Draw from JSON</button>
        <button @click=${this.handleDraw} ?disabled=${this.drawing}>Draw on Map</button>
        <button @click=${this.clearGraphics.bind(this)}>Clear</button>
      </div>
      ${this.error?le`<div class="error">${this.error}</div>`:""}
    `}};bS.styles=Js`
    :host {
      display: block;
      background: white;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 12px 16px;
      font-size: 13px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      min-width: 260px;
      max-width: 350px;
      user-select: text;
    }
    textarea {
      width: 100%;
      min-height: 60px;
      font-family: monospace;
      font-size: 12px;
      margin-bottom: 6px;
      border-radius: 4px;
      border: 1px solid #aaa;
      padding: 4px;
      resize: vertical;
    }
    button {
      font-size: 12px;
      padding: 3px 10px;
      border-radius: 4px;
      border: 1px solid #aaa;
      background: #f3f3f3;
      cursor: pointer;
      margin-right: 6px;
      margin-bottom: 6px;
    }
    .error {
      color: #b00;
      font-size: 12px;
      margin-bottom: 6px;
    }
    .section-label {
      font-weight: bold;
      margin-bottom: 4px;
      display: block;
    }
  `;nL([cA({attribute:!1})],bS.prototype,"view",2);nL([Cv()],bS.prototype,"inputJson",2);nL([Cv()],bS.prototype,"error",2);nL([Cv()],bS.prototype,"drawing",2);bS=nL([cV("draw-extent")],bS);/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */function t5t(t){return t.map(e=>{let i="";for(let r=0;r<e;r++)i+=((1+Math.random())*65536|0).toString(16).substring(1);return i}).join("-")}const XS=()=>t5t([2,1,1,1,3]),i5t=t=>(...e)=>{const i=RMe(),r=new t(...e),s=r.exports;IMe(i.at(-1));const n=r.component.manager;n.W(r,s),r.watchExports(n.W.bind(n,r)),Wst(r);const o=[r.component,...i].reverse();return PMe(o,a=>a===void 0?void 0:r5t(r,a,s),s)},r5t=(t,{host:e,key:i,isReactive:r},s)=>{const n=e,o=n[i]!==t.exports,a=n[i]!==s,l=s!==t.exports;if(o&&!a&&l&&(n[i]=t.exports),e===t.component){if(r){const d=t.component.manager;a&&d.W(t,n[i]),t.onUpdate(f=>{if(f.has(i)){const m=n[i];m!==t.exports&&d.W(t,m)}})}t.O=r?void 0:i}const h=t.component.constructor.elementProperties.get(i)?.readOnly;t.watchExports(()=>{n[i]!==t.exports&&(h?Xst(()=>{n[i]=t.exports}):n[i]=t.exports)})},s5t=t=>eze(void 0,t),n5t=t=>e=>eze(e,t);class o5t extends Jie{constructor(e,i){super(e);const r=this.exports;try{N2(this.component);const s=i(this.component,this),n=this.exports!==r;if(qst(s)){n||this.setProvisionalExports(s);const o=s.then(a=>{this.exports=a,super.catchUpLifecycle()}).catch(a=>{this.P.reject(a),console.error(a)});this.onLoad(async()=>await o)}else(!n||s!==void 0)&&(this.exports=s),queueMicrotask(()=>super.catchUpLifecycle())}catch(s){this.P.reject(s),console.error(s)}}catchUpLifecycle(){}}const eze=i5t(o5t),tze=(t,e)=>new a5t(t,e);class a5t extends Jie{#e;#t;#i;constructor(e,i){super(),this.#t=e,this.#i=i,this.#e=new MutationObserver(r=>{r.forEach(s=>{e.includes(s.attributeName)&&i.call(this.component,this.component.el.getAttribute(s.attributeName),s.oldValue,s.attributeName)})})}hostConnected(){this.#t.forEach(e=>{this.component.el.hasAttribute(e)&&this.#i.call(this.component,null,this.component.el.getAttribute(e),e)}),this.#e.observe(this.component.el,{attributes:!0,attributeOldValue:!0,attributeFilter:this.#t})}hostDisconnected(){this.#e.disconnect()}}const l5t=t=>(e={})=>s5t((i,r)=>{const s=MMe(i.el),n={_lang:s.lang,_t9nLocale:s.t9nLocale,_loading:!0},o=i;r.onLifecycle(()=>zst(i.el,()=>t("./assets"),({t9nLocale:l,t9nStrings:c,lang:h})=>{const d={...c,_lang:h,_t9nLocale:l,_loading:!1};r.exports=d;const f=c.componentLabel;typeof f=="string"&&"label"in i&&i.label==null&&(i.label??=f),a(o.messageOverrides)},e.name));const a=l=>{const c=r.exports,h=c._original??c,d=ize(h,l);l&&(d._original=h),r.exports=d};return"messageOverrides"in o&&r.onUpdate(l=>{l.has("messageOverrides")&&a(o.messageOverrides)}),e.blocking?(r.setProvisionalExports(n,!1),r.ready):n}),ize=(t,e)=>{if(!e)return t;const i={...t};return Object.entries(e).forEach(([r,s])=>{typeof s=="object"?i[r]=ize(t[r],s):i[r]=s??t[r]}),i};/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const Fd=l5t(jMe);/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const sE={percentage:"percentage",progressRing:"ring--progress",ring:"ring",rings:"rings",text:"text",trackRing:"ring--track"},c5t=Js`:host{position:relative;margin-inline:auto;display:flex;align-items:center;justify-content:center;opacity:1;flex-direction:column;min-block-size:var(--calcite-loader-size);font-size:var(--calcite-loader-font-size);stroke-width:var(--calcite-internal-stroke-width);fill:none;transform:scale(1);padding-block:var(--calcite-loader-spacing, 4rem)}:host([scale=s]){--calcite-internal-stroke-width: 3;--calcite-internal-text-offset: var(--calcite-spacing-xxs);--calcite-internal-loader-font-size: var(--calcite-font-size--3);--calcite-internal-loader-size: 2rem;--calcite-internal-loader-size-inline: .75rem;--calcite-internal-loader-value-line-height: .625rem}:host([scale=m]){--calcite-internal-stroke-width: 6;--calcite-internal-text-offset: var(--calcite-spacing-sm);--calcite-internal-loader-font-size: var(--calcite-font-size-0);--calcite-internal-loader-size: 4rem;--calcite-internal-loader-size-inline: 1rem;--calcite-internal-loader-value-line-height: 1.375rem}:host([scale=l]){--calcite-internal-stroke-width: 8;--calcite-internal-text-offset: var(--calcite-spacing-md);--calcite-internal-loader-font-size: var(--calcite-font-size-2);--calcite-internal-loader-size: 6rem;--calcite-internal-loader-size-inline: 1.5rem;--calcite-internal-loader-value-line-height: 1.71875rem}.text{display:block;text-align:center;font-size:var(--calcite-font-size--2);line-height:1rem;margin-block-start:var(--calcite-loader-text-spacing, var(--calcite-internal-text-offset));font-weight:var(--calcite-loader-text-weight, var(--calcite-font-weight-normal));color:var(--calcite-loader-text-color, var(--calcite-color-text-1))}.percentage{display:block;text-align:center;font-size:var(--calcite-loader-font-size);inline-size:var(--calcite-loader-size, var(--calcite-internal-loader-size));line-height:var(--calcite-internal-loader-value-line-height);align-self:center;color:var(--calcite-loader-text-color, var(--calcite-color-text-1))}.rings{position:relative;display:flex;overflow:visible;opacity:1;inline-size:var(--calcite-loader-size, var(--calcite-internal-loader-size));block-size:var(--calcite-loader-size, var(--calcite-internal-loader-size))}.ring{position:absolute;inset-block-start:0px;transform-origin:center;overflow:visible;inset-inline-start:0;inline-size:var(--calcite-loader-size, var(--calcite-internal-loader-size));block-size:var(--calcite-loader-size, var(--calcite-internal-loader-size))}.ring--track{stroke:var(--calcite-loader-track-color, var(--calcite-color-transparent-press))}.ring--progress{stroke:var(--calcite-loader-progress-color, var(--calcite-color-brand));transform:rotate(-90deg);transition:all var(--calcite-internal-animation-timing-fast) linear}:host([type=indeterminate]) .ring--progress{animation:loader-clockwise calc(var(--calcite-internal-animation-timing-slow) / var(--calcite-internal-duration-factor) * 2 / var(--calcite-internal-duration-factor)) linear infinite}:host([inline]){--calcite-internal-stroke-width: 2;position:relative;margin:0;stroke:currentColor;stroke-width:2;padding-block:0px;block-size:var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline)));min-block-size:var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline)));inline-size:var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline)));vertical-align:calc(var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline))) * -1 * .2)}:host([inline]) .rings{inset-block-start:0px;margin:0;inset-inline-start:0;inline-size:var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline)));block-size:var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline)))}:host([inline]) .ring{inline-size:var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline)));block-size:var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline)))}:host([inline]) .ring--progress{stroke:var(--calcite-loader-progress-color-inline, currentColor)}:host([complete]){opacity:0;transform:scale(.75);transform-origin:center;transition:opacity var(--calcite-internal-animation-timing-medium) linear 1s,transform var(--calcite-internal-animation-timing-medium) linear 1s}:host([complete]) .rings{opacity:0;transform:scale(.75);transform-origin:center;transition:opacity calc(.18s * var(--calcite-internal-duration-factor)) linear .8s,transform calc(.18s * var(--calcite-internal-duration-factor)) linear .8s}:host([complete]) .percentage{color:var(--calcite-color-brand);transform:scale(1.05);transform-origin:center;transition:color var(--calcite-internal-animation-timing-medium) linear,transform var(--calcite-internal-animation-timing-medium) linear}@keyframes loader-clockwise{0%{transform:rotate(0)}to{transform:rotate(360deg)}}:host([hidden]){display:none}[hidden]{display:none}`;class rze extends Vn{constructor(){super(...arguments),this.messages=Fd({name:null}),this.complete=!1,this.inline=!1,this.scale="m",this.text="",this.type="indeterminate",this.value=0}static{this.properties={complete:[7,{},{reflect:!0,type:Boolean}],inline:[7,{},{reflect:!0,type:Boolean}],label:1,scale:[3,{},{reflect:!0}],text:1,type:[3,{},{reflect:!0}],value:[9,{},{type:Number}]}}static{this.styles=c5t}connectedCallback(){super.connectedCallback(),this.updateFormatter()}load(){requestAnimationFrame(()=>this.valueChangeHandler())}willUpdate(e){e.has("value")&&(this.hasUpdated||this.value!==0)&&this.valueChangeHandler(),(e.has("type")&&(this.hasUpdated||this.type!=="indeterminate")||e.has("messages"))&&this.updateFormatter()}valueChangeHandler(){this.complete=this.type.startsWith("determinate")&&this.value===100}formatValue(){return this.type!=="determinate-value"?`${this.value}`:this.formatter.format(this.value/100)}getSize(e){return{s:32,m:64,l:96}[e]}getInlineSize(e){return{s:12,m:16,l:24}[e]}updateFormatter(){this.type!=="determinate-value"||this.formatter?.resolvedOptions().locale===this.messages._lang||(this.formatter=new Intl.NumberFormat(this.messages._lang,{style:"percent"}))}render(){const{el:e,inline:i,label:r,text:s,type:n,value:o}=this,a=e.id||XS(),l=n!=="indeterminate",c=Math.floor(o);return this.el.ariaLabel=r,this.el.ariaValueMax=l?"100":void 0,this.el.ariaValueMin=l?"0":void 0,this.el.ariaValueNow=l?c.toString():void 0,mj(this.el,"id",a),this.el.role="progressbar",le`<div class=${fe(sE.rings)}>${this.renderRing("track")}${this.renderRing("progress")}${!i&&l&&le`<div class=${fe(sE.percentage)}>${this.formatValue()}</div>`||""}</div>${!i&&s&&le`<div class=${fe(sE.text)}>${s}</div>`||""}`}renderRing(e){const{inline:i,scale:r,value:s}=this,n=i?this.getInlineSize(r):this.getSize(r),a=n*.45;let l;if(e==="progress"){const c=2*a*Math.PI,h=(this.type.startsWith("determinate")?s:24)/100*c,d=c-h;l={"stroke-dasharray":`${h} ${d}`}}return le`<svg aria-hidden=true class=${fe({[sE.ring]:!0,[sE.trackRing]:e==="track",[sE.progressRing]:e==="progress"})} style=${UMe(l)} viewBox=${`0 0 ${n} ${n}`}>${gP`<circle cx=${n/2} cy=${n/2} r=${a??Ze} />`}</svg>`}}Oo("calcite-loader",rze);const Efi=Object.freeze(Object.defineProperty({__proto__:null,Loader:rze},Symbol.toStringTag,{value:"Module"}));/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 *//*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var u5t=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],WQ=u5t.join(","),sze=typeof Element>"u",R3=sze?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,NB=!sze&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t?.ownerDocument},FB=function t(e,i){var r;i===void 0&&(i=!0);var s=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"inert"),n=s===""||s==="true",o=n||i&&e&&t(e.parentNode);return o},h5t=function(e){var i,r=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"contenteditable");return r===""||r==="true"},d5t=function(e,i,r){if(FB(e))return[];var s=Array.prototype.slice.apply(e.querySelectorAll(WQ));return i&&R3.call(e,WQ)&&s.unshift(e),s=s.filter(r),s},p5t=function t(e,i,r){for(var s=[],n=Array.from(e);n.length;){var o=n.shift();if(!FB(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=t(l,!0,r);r.flatten?s.push.apply(s,c):s.push({scopeParent:o,candidates:c})}else{var h=R3.call(o,WQ);h&&r.filter(o)&&(i||!e.includes(o))&&s.push(o);var d=o.shadowRoot||typeof r.getShadowRoot=="function"&&r.getShadowRoot(o),f=!FB(d,!1)&&(!r.shadowRootFilter||r.shadowRootFilter(o));if(d&&f){var m=t(d===!0?o.children:d.children,!0,r);r.flatten?s.push.apply(s,m):s.push({scopeParent:o,candidates:m})}else n.unshift.apply(n,o.children)}}return s},nze=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},oze=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||h5t(e))&&!nze(e)?0:e.tabIndex},f5t=function(e,i){var r=oze(e);return r<0&&i&&!nze(e)?0:r},m5t=function(e,i){return e.tabIndex===i.tabIndex?e.documentOrder-i.documentOrder:e.tabIndex-i.tabIndex},aze=function(e){return e.tagName==="INPUT"},g5t=function(e){return aze(e)&&e.type==="hidden"},y5t=function(e){var i=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(r){return r.tagName==="SUMMARY"});return i},v5t=function(e,i){for(var r=0;r<e.length;r++)if(e[r].checked&&e[r].form===i)return e[r]},_5t=function(e){if(!e.name)return!0;var i=e.form||NB(e),r=function(a){return i.querySelectorAll('input[type="radio"][name="'+a+'"]')},s;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")s=r(window.CSS.escape(e.name));else try{s=r(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var n=v5t(s,e.form);return!n||n===e},b5t=function(e){return aze(e)&&e.type==="radio"},w5t=function(e){return b5t(e)&&!_5t(e)},x5t=function(e){var i,r=e&&NB(e),s=(i=r)===null||i===void 0?void 0:i.host,n=!1;if(r&&r!==e){var o,a,l;for(n=!!((o=s)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(s)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!n&&s;){var c,h,d;r=NB(s),s=(c=r)===null||c===void 0?void 0:c.host,n=!!((h=s)!==null&&h!==void 0&&(d=h.ownerDocument)!==null&&d!==void 0&&d.contains(s))}}return n},kbe=function(e){var i=e.getBoundingClientRect(),r=i.width,s=i.height;return r===0&&s===0},S5t=function(e,i){var r=i.displayCheck,s=i.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var n=R3.call(e,"details>summary:first-of-type"),o=n?e.parentElement:e;if(R3.call(o,"details:not([open]) *"))return!0;if(!r||r==="full"||r==="legacy-full"){if(typeof s=="function"){for(var a=e;e;){var l=e.parentElement,c=NB(e);if(l&&!l.shadowRoot&&s(l)===!0)return kbe(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=a}if(x5t(e))return!e.getClientRects().length;if(r!=="legacy-full")return!0}else if(r==="non-zero-area")return kbe(e);return!1},T5t=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var i=e.parentElement;i;){if(i.tagName==="FIELDSET"&&i.disabled){for(var r=0;r<i.children.length;r++){var s=i.children.item(r);if(s.tagName==="LEGEND")return R3.call(i,"fieldset[disabled] *")?!0:!s.contains(e)}return!0}i=i.parentElement}return!1},E5t=function(e,i){return!(i.disabled||FB(i)||g5t(i)||S5t(i,e)||y5t(i)||T5t(i))},zbe=function(e,i){return!(w5t(i)||oze(i)<0||!E5t(e,i))},C5t=function(e){var i=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(i)||i>=0)},$5t=function t(e){var i=[],r=[];return e.forEach(function(s,n){var o=!!s.scopeParent,a=o?s.scopeParent:s,l=f5t(a,o),c=o?t(s.candidates):a;l===0?o?i.push.apply(i,c):i.push(a):r.push({documentOrder:n,tabIndex:l,item:s,isScope:o,content:c})}),r.sort(m5t).reduce(function(s,n){return n.isScope?s.push.apply(s,n.content):s.push(n.content),s},[]).concat(i)},A5t=function(e,i){i=i||{};var r;return i.getShadowRoot?r=p5t([e],i.includeContainer,{filter:zbe.bind(null,i),flatten:!1,getShadowRoot:i.getShadowRoot,shadowRootFilter:C5t}):r=d5t(e,i.includeContainer,zbe.bind(null,i)),$5t(r)};const lze={getShadowRoot:!0};function Cfi(t){return t?t.id=t.id||`${t.tagName.toLowerCase()}-${XS()}`:""}function $fi(t){return Array.isArray(t)?t:Array.from(t)}function Afi(t){const e=KS(t,`.${IR.darkMode}, .${IR.lightMode}, .${IR.autoMode}`);return e?.classList.contains("calcite-mode-dark")||e?.classList.contains("calcite-mode-auto")&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function oL(t){const e="dir",i=`[${e}]`,r=KS(t,i);return r?r.getAttribute(e):"ltr"}function UG(t){return t.getRootNode()}function Mfi(t){const e=UG(t);return"host"in e?e:null}function cze(t){return t.host||null}function BG(t,{selector:e,id:i}){if(!t)return null;t.assignedSlot&&(t=t.assignedSlot);const r=UG(t);return(i?"getElementById"in r?r.getElementById(i):null:e?r.querySelector(e):null)||BG(cze(r),{selector:e,id:i})}function KS(t,e){return t?t.closest(e)||KS(cze(UG(t)),e):null}function M5t(t){return typeof t?.setFocus=="function"}async function P3(t){if(t)return M5t(t)?t.setFocus():t.focus()}function uze(t){if(t)return A5t(t,lze)[0]??t}function VG(t){uze(t)?.focus()}function Ofi(t,e){return Array.from(t.children).filter(i=>i.matches(e))}function O5t(t,e){return t.filter(i=>i.matches(e))}function rA(t,e,i){if(typeof e=="string"&&e!=="")return e;if(e===""||e===!0)return t[i]}function jG(t){return(!!t).toString()}function I5t(t){return $s(t)||D5t(t)}function R5t(t){return L5t(t).filter(e=>e.nodeType===Node.TEXT_NODE).map(e=>e.textContent).join("").trim()}function P5t(t){for(const e of t.childNodes)if(e.nodeType===Node.TEXT_NODE&&e.textContent?.trim()!==""||e.nodeType===Node.ELEMENT_NODE)return!0;return!1}function D5t(t){return!!R5t(t)}function L5t(t){return t.currentTarget.assignedNodes({flatten:!0})}function $s(t){return!!ZQ(t).length}function ZQ(t,e){return N5t(t.target,e)}function N5t(t,e){const i=t.assignedElements({flatten:!0});return e?O5t(i,e):i}function F5t(t){return!!(t.isPrimary&&t.button===0)}function k5t(t){return t.detail===0}const dk=(t,e,i,r=!0)=>{const s=t.indexOf(e),n=s===0,o=s===t.length-1;r&&(i=i==="previous"&&n?"last":i==="next"&&o?"first":i);let a;return i==="previous"?a=t[s-1]||t[r?t.length-1:s]:i==="next"?a=t[s+1]||t[r?0:s]:i==="last"?a=t[t.length-1]:a=t[0],P3(a),a};function z5t(t,e){if(t.parentNode!==e.parentNode)return!1;const i=Array.from(t.parentNode.children);return i.indexOf(t)<i.indexOf(e)}async function Ifi(t,e,i,r){return hze(t,e,"animation",i,r)}async function U5t(t,e,i,r){return hze(t,e,"transition",i,r)}async function B5t(t,e){await YQ(),t?.(),await YQ(),e?.()}function Ube(t,e,i){const r=e==="transition"?"transitionProperty":"animationName";return t.getAnimations().find(s=>s[r]===i)}async function hze(t,e,i,r,s){let n=Ube(t,i,e);if(n||(await YQ(),n=Ube(t,i,e)),!n)return B5t(r,s);r?.();try{await n.finished}catch{}finally{s?.()}}function YQ(){return new Promise(t=>requestAnimationFrame(()=>t()))}function Rfi(t){switch(!0){case t.endsWith("px"):return parseFloat(t);case t.endsWith("vw"):return window.innerWidth/100*parseFloat(t);case t.endsWith("vh"):return window.innerHeight/100*parseFloat(t);default:return 0}}/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */function vf(t,e,i){const r=V5t(t);return new r(e,i)}function V5t(t){class e extends window.MutationObserver{constructor(r){super(r),this.observedEntry=[],this.callback=r}observe(r,s){return this.observedEntry.push({target:r,options:s}),super.observe(r,s)}unobserve(r){const s=this.observedEntry.filter(n=>n.target!==r);this.observedEntry=[],this.callback(super.takeRecords(),this),this.disconnect(),s.forEach(n=>this.observe(n.target,n.options))}}return function(){return t==="intersection"?window.IntersectionObserver:t==="mutation"?e:window.ResizeObserver}()}/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const Bbe=new Set,Vbe={trace:0,debug:1,info:2,warn:4,error:8,off:10};function j5t(t){return Vbe[t]>=Vbe[xnt]}function M2(t,...e){if(!j5t(t))return;console[t].call(this,"%ccalcite","background: #007AC2; color: #fff; border-radius: 4px; padding: 2px 4px;",...e)}let w9;const dze={debug:t=>M2("debug",t),info:t=>M2("info",t),warn:t=>M2("warn",t),error:t=>M2("error",t),trace:t=>M2("trace",t),deprecated:G5t};function G5t(t,{component:e,name:i,suggested:r,removalVersion:s}){const n=`${t}:${t==="component"?"":e}${i}`;if(Bbe.has(n))return;Bbe.add(n);const o=Array.isArray(r);o&&!w9&&(w9=new Intl.ListFormat("en",{style:"long",type:"disjunction"}));const a=`[${i}] ${t} is deprecated and will be removed in ${s==="future"?"a future version":`v${s}`}.${r?` Use ${o?w9.format(r.map(l=>`"${l}"`)):`"${r}"`} instead.`:""}`;M2("warn",a)}/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const H5t={flipRtl:"flip-rtl"},pze={},x9={},fze={s:16,m:24,l:32};function mze({icon:t,scale:e}){const i=fze[e],r=Z5t(t),s=r.charAt(r.length-1)==="F";return`${s?r.substring(0,r.length-1):r}${i}${s?"F":""}`}async function q5t(t){const e=mze(t),i=gze(e);if(i)return i;x9[e]||(x9[e]=fetch(jMe(`./assets/icon/${e}.json`)).then(s=>s.json()).catch(()=>(dze.error(`${t.icon} (${t.scale}) icon failed to load`),"")));const r=await x9[e];return pze[e]=r,r}function W5t(t){return gze(mze(t))}function gze(t){return pze[t]}function Z5t(t){const e=!isNaN(Number(t.charAt(0))),i=t.split("-");if(i.length>0){const s=/[a-z]/i;t=i.map((n,o)=>n.replace(s,function(l,c){return o===0&&c===0?l:l.toUpperCase()})).join("")}return e?`i${t}`:t}const Y5t=Js`:host{display:inline-flex;color:var(--calcite-icon-color, var(--calcite-ui-icon-color, currentColor))}:host([scale=s]){inline-size:16px;block-size:16px;min-inline-size:16px;min-block-size:16px}:host([scale=m]){inline-size:24px;block-size:24px;min-inline-size:24px;min-block-size:24px}:host([scale=l]){inline-size:32px;block-size:32px;min-inline-size:32px;min-block-size:32px}.flip-rtl{transform:scaleX(-1)}.svg{display:block}:host([hidden]){display:none}[hidden]{display:none}`;class yze extends Vn{constructor(){super(...arguments),this.visible=!1,this.flipRtl=!1,this.icon=null,this.preload=!1,this.scale="m"}static{this.properties={pathData:[16,{},{state:!0}],visible:[16,{},{state:!0}],flipRtl:[7,{},{reflect:!0,type:Boolean}],icon:[3,{},{reflect:!0}],preload:[7,{},{reflect:!0,type:Boolean}],scale:[3,{},{reflect:!0}],textLabel:1}}static{this.styles=Y5t}connectedCallback(){if(super.connectedCallback(),this.preload){this.visible=!0,this.loadIconPathData();return}this.visible||this.waitUntilVisible(()=>{this.visible=!0,this.loadIconPathData()})}willUpdate(e){(e.has("icon")&&(this.hasUpdated||this.icon!==null)||e.has("scale")&&(this.hasUpdated||this.scale!=="m"))&&this.loadIconPathData()}disconnectedCallback(){super.disconnectedCallback(),this.intersectionObserver?.disconnect(),this.intersectionObserver=null}async loadIconPathData(){const{icon:e,scale:i,visible:r}=this;if(!e||!r)return;const s={icon:e,scale:i},n=W5t(s)||await q5t(s);e===this.icon&&(this.pathData=n)}waitUntilVisible(e){if(this.intersectionObserver=vf("intersection",i=>{i.forEach(r=>{r.isIntersecting&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null,e())})},{rootMargin:"50px"}),!this.intersectionObserver){e();return}this.intersectionObserver.observe(this.el)}render(){const{el:e,flipRtl:i,pathData:r,scale:s,textLabel:n}=this,o=oL(e),a=fze[s],l=!!n,c=[].concat(r||"");return this.el.ariaHidden=jG(!l),this.el.ariaLabel=l?n:null,this.el.role=l?"img":null,le`<svg aria-hidden=true class=${fe({[H5t.flipRtl]:o==="rtl"&&i,svg:!0})} fill=currentColor height=100% viewBox=${`0 0 ${a} ${a}`} width=100% xmlns=http://www.w3.org/2000/svg>${c.map(h=>typeof h=="string"?gP`<path d=${h??Ze} />`:gP`<path d=${h.d??Ze} opacity=${("opacity"in h?h.opacity:1)??Ze} />`)}</svg>`}}Oo("calcite-icon",yze);const vze=Object.freeze(Object.defineProperty({__proto__:null,Icon:yze},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const sP=(t,e)=>{const i=t._$AN;if(i===void 0)return!1;for(const r of i)r._$AO?.(e,!1),sP(r,e);return!0},kB=t=>{let e,i;do{if((e=t._$AM)===void 0)break;i=e._$AN,i.delete(t),t=e}while(i?.size===0)},_ze=t=>{for(let e;e=t._$AM;t=e){let i=e._$AN;if(i===void 0)e._$AN=i=new Set;else if(i.has(t))break;i.add(t),K5t(e)}};function J5t(t){this._$AN!==void 0?(kB(this),this._$AM=t,_ze(this)):this._$AM=t}function X5t(t,e=!1,i=0){const r=this._$AH,s=this._$AN;if(s!==void 0&&s.size!==0)if(e)if(Array.isArray(r))for(let n=i;n<r.length;n++)sP(r[n],!1),kB(r[n]);else r!=null&&(sP(r,!1),kB(r));else sP(this,t)}const K5t=t=>{t.type==Oy.CHILD&&(t._$AP??=X5t,t._$AQ??=J5t)};class Q5t extends ED{constructor(){super(...arguments),this._$AN=void 0}_$AT(e,i,r){super._$AT(e,i,r),_ze(this),this.isConnected=e._$AU}_$AO(e,i=!0){e!==this.isConnected&&(this.isConnected=e,e?this.reconnected?.():this.disconnected?.()),i&&(sP(this,e),kB(this))}setValue(e){if(kMe(this._$Ct))this._$Ct._$AI(e,this);else{const i=[...this._$Ct._$AH];i[this._$Ci]=e,this._$Ct._$AI(i,this,0)}}disconnected(){}reconnected(){}}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Gc=()=>new ezt;class ezt{}const S9=new WeakMap,wr=TD(class extends Q5t{render(t){return Ze}update(t,[e]){const i=e!==this.G;return i&&this.G!==void 0&&this.rt(void 0),(i||this.lt!==this.ct)&&(this.G=e,this.ht=t.options?.host,this.rt(this.ct=t.element)),Ze}rt(t){if(this.isConnected||(t=void 0),typeof this.G=="function"){const e=this.ht??globalThis;let i=S9.get(e);i===void 0&&(i=new WeakMap,S9.set(e,i)),i.get(this.G)!==void 0&&this.G.call(this.ht,void 0),i.set(this.G,t),t!==void 0&&this.G.call(this.ht,t)}else this.G.value=t}get lt(){return typeof this.G=="function"?S9.get(this.ht??globalThis)?.get(this.G):this.G?.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}});/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const rae=Symbol.for(""),tzt=t=>{if(t?.r===rae)return t?._$litStatic$},izt=t=>({_$litStatic$:t,r:rae}),D3=(t,...e)=>({_$litStatic$:e.reduce((i,r,s)=>i+(n=>{if(n._$litStatic$!==void 0)return n._$litStatic$;throw Error(`Value passed to 'literal' function must be a 'literal' result: ${n}. Use 'unsafeStatic' to pass non-literal values, but
            take care to ensure page security.`)})(r)+t[s+1],t[0]),r:rae}),jbe=new Map,rzt=t=>(e,...i)=>{const r=i.length;let s,n;const o=[],a=[];let l,c=0,h=!1;for(;c<r;){for(l=e[c];c<r&&(n=i[c],(s=tzt(n))!==void 0);)l+=s+e[++c],h=!0;c!==r&&a.push(n),o.push(l),c++}if(c===r&&o.push(e[r]),h){const d=o.join("$$lit$$");(e=jbe.get(d))===void 0&&(o.raw=o,jbe.set(d,e=o)),i=a}return t(e,...i)},sae=rzt(le);/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const szt=["calcite-input","calcite-input-number","calcite-input-text","calcite-text-area"];function nzt(t){return`${t.split("-").map((r,s)=>s===0?r:`${r[0].toUpperCase()}${r.slice(1)}`).join("")}${szt.includes(t)?"Input":"Change"}`}const JQ="hidden-form-input";function nae(t){return"checked"in t}const XQ=new WeakMap,oae=new WeakSet;function ozt(t,e){if(KS(e.parentElement,"[form]"))return!0;const r="calciteInternalFormComponentRegister";let s=!1;return t.addEventListener(r,n=>{s=n.composedPath().some(o=>oae.has(o)),n.stopPropagation()},{once:!0}),e.dispatchEvent(new CustomEvent(r,{bubbles:!0,composed:!0})),s}function azt(t,{status:e,message:i,icon:r}){"status"in t&&(t.status=e),"validationIcon"in t&&typeof t.validationIcon!="string"&&(t.validationIcon=r),"validationMessage"in t&&!t.validationMessage&&(t.validationMessage=i)}function bze(t){return t.nodeName==="CALCITE-RADIO-BUTTON"?KS(t,"calcite-radio-button-group"):t}const lzt=new CustomEvent("calciteInvalid",{bubbles:!0,composed:!0});function Gbe(t){const e=t?.target,i=e?.validationMessage,r=bze(e?.parentElement);if(!r)return;const s=r?.nodeName?.toLowerCase(),n=s?.split("-");if(n.length<2||n[0]!=="calcite")return;t?.preventDefault(),"validity"in r&&(r.validity=e?.validity),r.dispatchEvent(lzt),azt(r,{message:i,icon:!0,status:"invalid"});const o=nzt(s);r.addEventListener(o,()=>{"status"in r&&(r.status="idle"),"validationIcon"in r&&(r.validationIcon===""||r.validationIcon===!0)&&(r.validationIcon=!1),"validationMessage"in r&&r.validationMessage===i&&(r.validationMessage=""),"validity"in r&&(r.validity=e?.validity)},{once:!0})}function wze(t){const{formEl:e}=t;return e?(e.addEventListener("invalid",Gbe,!0),e.requestSubmit(),e.removeEventListener("invalid",Gbe,!0),requestAnimationFrame(()=>{const i=e.querySelectorAll("[status=invalid]");for(const r of i)if(r?.validationMessage){r?.setFocus();break}}),!0):!1}function czt(t){t.formEl?.reset()}function uzt(t){const{el:e,value:i}=t,r=xze(t);if(!r||ozt(r,e))return;t.formEl=r,t.defaultValue=i,nae(t)&&(t.defaultChecked=t.checked);const s=hzt.bind(t);r.addEventListener("reset",s),XQ.set(t.el,s),oae.add(e)}function xze(t){const{el:e,form:i}=t;return i?BG(e,{id:i}):KS(e,"form")}function hzt(){if("status"in this&&(this.status="idle"),"validationIcon"in this&&(this.validationIcon=!1),"validationMessage"in this&&(this.validationMessage=""),nae(this)){this.checked=this.defaultChecked;return}this.value=this.defaultValue,this.onFormReset?.()}function dzt(t){const{el:e,formEl:i}=t;if(!i)return;const r=XQ.get(e);i.removeEventListener("reset",r),XQ.delete(e),t.formEl=null,oae.delete(e)}const KQ="calciteInternalHiddenInputInput",Sze=t=>{t.target.dispatchEvent(new CustomEvent(KQ,{bubbles:!0}))},Hbe=t=>t.removeEventListener("input",Sze);function pzt(t){const{el:e,formEl:i,name:r,value:s}=t,{ownerDocument:n}=e,o=e.querySelectorAll(`input[slot="${JQ}"]`);if(!i||!r){o.forEach(d=>{Hbe(d),d.remove()});return}const a=Array.isArray(s)?s:[s],l=[],c=new Set;o.forEach(d=>{const f=a.find(m=>m==d.value);f!=null?(c.add(f),qbe(t,d,f)):l.push(d)});let h;a.forEach(d=>{if(c.has(d))return;let f=l.pop();f||(f=n.createElement("input"),f.ariaHidden="true",f.slot=JQ),h||(h=n.createDocumentFragment()),h.append(f),f.addEventListener("input",Sze),qbe(t,f,d)}),h&&e.append(h),l.forEach(d=>{Hbe(d),d.remove()})}function qbe(t,e,i){const{defaultValue:r,disabled:s,form:n,name:o,required:a}=t;e.defaultValue=r,e.disabled=s,e.name=o,e.required=a,e.tabIndex=-1,n?e.setAttribute("form",n):e.removeAttribute("form"),nae(t)?(e.checked=t.checked,e.defaultChecked=t.defaultChecked,e.value=t.checked?i||"on":""):e.value=i||"",t.syncHiddenFormInput?.(e);const l=bze(t.el);if(l&&"validity"in l)for(const c in{...e?.validity})l.validity[c]=e.validity[c]}const fzt=({component:t})=>(pzt(t),le`<slot name=${JQ}></slot>`);/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */function mzt(){const{disabled:t}=this;t||HTMLElement.prototype.click.call(this)}function Tze(t){t.target.disabled&&t.preventDefault()}const Eze=["mousedown","mouseup","click"];function Cze(t){t.target.disabled&&(t.stopImmediatePropagation(),t.preventDefault())}const zB={capture:!0};function yg(t){if(t.disabled){t.el.setAttribute("aria-disabled","true"),t.el.contains(document.activeElement)&&document.activeElement.blur(),gzt(t);return}vzt(t),t.el.removeAttribute("aria-disabled")}function gzt(t){t.el.click=mzt,yzt(t.el)}function yzt(t){t.addEventListener("pointerdown",Tze,zB),Eze.forEach(e=>t.addEventListener(e,Cze,zB))}function vzt(t){delete t.el.click,_zt(t.el)}function _zt(t){t.removeEventListener("pointerdown",Tze,zB),Eze.forEach(e=>t.removeEventListener(e,Cze,zB))}const bzt={container:"interaction-container"},vg=({children:t,disabled:e})=>le`<div class=${fe(bzt.container)} .inert=${e}>${t}</div>`;/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const $ze="calciteInternalLabelClick",aae="calciteInternalLabelConnected",QQ="calciteInternalLabelDisconnected",Wbe="calcite-label",sA=new WeakMap,nP=new WeakMap,L3=new WeakMap,UB=new WeakMap,Vx=new Set,wzt=t=>{const{id:e}=t,i=e&&BG(t,{selector:`${Wbe}[for="${e}"]`});if(i)return i;const r=KS(t,Wbe);return!r||xzt(r,t)?null:r};function xzt(t,e){let i;const r="custom-element-ancestor-check",s=o=>{o.stopImmediatePropagation();const a=o.composedPath();i=a.slice(a.indexOf(e),a.indexOf(t))};return t.addEventListener(r,s,{once:!0}),e.dispatchEvent(new CustomEvent(r,{composed:!0,bubbles:!0})),t.removeEventListener(r,s),i.filter(o=>o!==e&&o!==t).filter(o=>o.tagName?.includes("-")).length>0}function GG(t){if(!t)return;const e=wzt(t.el);if(nP.has(e)&&e===t.labelEl||!e&&Vx.has(t))return;const i=Tzt.bind(t);if(e){t.labelEl=e;const r=sA.get(e)||[];r.push(t),sA.set(e,r.sort(Mze)),nP.has(t.labelEl)||(nP.set(t.labelEl,Zbe),t.labelEl.addEventListener($ze,Zbe)),Vx.delete(t),document.removeEventListener(aae,L3.get(t)),UB.set(t,i),document.addEventListener(QQ,i)}else Vx.has(t)||(i(),document.removeEventListener(QQ,UB.get(t)))}function Aze(t){if(!t||(Vx.delete(t),document.removeEventListener(aae,L3.get(t)),document.removeEventListener(QQ,UB.get(t)),L3.delete(t),UB.delete(t),!t.labelEl))return;const e=sA.get(t.labelEl);e.length===1&&(t.labelEl.removeEventListener($ze,nP.get(t.labelEl)),nP.delete(t.labelEl)),sA.set(t.labelEl,e.filter(i=>i!==t).sort(Mze)),t.labelEl=null}function Mze(t,e){return z5t(t.el,e.el)?-1:1}function eee(t){return t.label||t.labelEl?.textContent?.trim()||""}function Zbe(t){const e=t.detail.sourceEvent.target,i=sA.get(this),r=i.find(o=>o.el===e);if(i.includes(r))return;const n=i[0];n.disabled||n.onLabelClick(t)}function Szt(){Vx.has(this)&&GG(this)}function Tzt(){Vx.add(this);const t=L3.get(this)||Szt.bind(this);L3.set(this,t),document.addEventListener(aae,t)}async function Pfi(t){if(await t.componentOnReady(),sA.has(t))return;const i=t.ownerDocument?.getElementById(t.for);i&&requestAnimationFrame(()=>{for(const r of Vx)if(r.el===i){GG(r);break}})}/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */function Wa(t){return t==="l"?"m":"s"}async function dh(t){await t.componentOnReady(),await t.updateComplete}/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const vu={buttonLoader:"calcite-button--loader",content:"content",contentSlotted:"content--slotted",icon:"icon",iconStart:"icon--start",iconEnd:"icon--end",loadingIn:"loading-in",loadingOut:"loading-out",iconStartEmpty:"icon-start-empty",iconEndEmpty:"icon-end-empty",buttonPadding:"button-padding",buttonPaddingShrunk:"button-padding--shrunk"},Ezt=Js`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:inline-block;inline-size:auto;vertical-align:middle;border-radius:var(--calcite-button-corner-radius, var(--calcite-internal-button-corner-radius, 0))}:host a,:host button{--calcite-internal-button-content-margin: .5rem;--calcite-internal-button-padding-x: 7px;--calcite-internal-button-padding-y: 3px;position:relative;box-sizing:border-box;display:flex;block-size:100%;inline-size:100%;cursor:pointer;-webkit-user-select:none;user-select:none;appearance:none;align-items:center;justify-content:center;border-style:none;text-align:center;font-family:inherit;font-weight:var(--calcite-font-weight-normal);text-decoration-line:none;outline-color:transparent;background-color:var(--calcite-button-background-color, var(--calcite-internal-button-background-color, var(--calcite-color-transparent)));border-block-start-color:var(--calcite-button-border-color, var(--calcite-internal-button-border-block-start-color, var(--calcite-internal-button-border-color, var(--calcite-color-transparent))));border-block-end-color:var(--calcite-button-border-color, var(--calcite-internal-button-border-block-end-color, var(--calcite-internal-button-border-color, var(--calcite-color-transparent))));border-inline-start-color:var(--calcite-button-border-color, var(--calcite-internal-button-border-inline-start-color, var(--calcite-internal-button-border-color, var(--calcite-color-transparent))));border-inline-end-color:var(--calcite-button-border-color, var(--calcite-internal-button-border-inline-end-color, var(--calcite-internal-button-border-color, var(--calcite-color-transparent))));border-style:solid;border-width:var(--calcite-border-width-sm);box-shadow:inset 0 0 0 0 var(--calcite-button-shadow-color, var(--calcite-internal-button-shadow-color, var(--calcite-color-transparent)));border-radius:var(--calcite-button-corner-radius, var(--calcite-internal-button-corner-radius, 0));color:var(--calcite-button-text-color, var(--calcite-internal-button-text-color, currentColor));padding-block:var(--calcite-internal-button-padding-y);padding-inline:var(--calcite-internal-button-padding-x);transition:color var(--calcite-animation-timing) ease-in-out,background-color var(--calcite-animation-timing) ease-in-out,box-shadow var(--calcite-animation-timing) ease-in-out,outline-color var(--calcite-internal-animation-timing-fast) ease-in-out}:host a:hover,:host button:hover{text-decoration-line:none}:host a:focus,:host button:focus{outline:2px solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline-offset:calc(2px*(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}:host a span,:host button span{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}:host a calcite-loader,:host button calcite-loader{color:var(--calcite-button-loader-color, var(--calcite-internal-button-loader-color, var(--calcite-button-text-color, var(--calcite-internal-button-text-color))))}:host([round]){--calcite-internal-button-corner-radius: 50px}.content{margin-inline:var(--calcite-internal-button-content-margin)}.icon-start-empty .content{margin-inline-start:unset}.icon-end-empty .content{margin-inline-end:unset}:host([scale=m]) button,:host([scale=m]) a{--calcite-internal-button-content-margin: .75rem}:host([scale=l]) button,:host([scale=l]) a{--calcite-internal-button-content-margin: 1rem}:host([width=auto]){inline-size:auto}:host([width=half]){inline-size:50%}:host([width=full]){inline-size:100%}:host([alignment=center]:not([width=auto])) a,:host([alignment=center]:not([width=auto])) button{justify-content:center}:host([alignment=start]:not([width=auto])) a,:host([alignment=start]:not([width=auto])) button{justify-content:flex-start}:host([alignment=end]:not([width=auto])) a,:host([alignment=end]:not([width=auto])) button{justify-content:flex-end}:host([alignment*=space-between]:not([width=auto])) a,:host([alignment*=space-between]:not([width=auto])) button{justify-content:space-between}:host([alignment=icon-start-space-between]:not([width=auto])) .icon--start{margin-inline-end:auto}:host([alignment=icon-start-space-between]:not([width=auto])) a,:host([alignment=icon-start-space-between]:not([width=auto])) button{text-align:unset}:host([alignment=icon-end-space-between]:not([width=auto])) .icon--end{margin-inline-start:auto}:host([alignment=icon-end-space-between]:not([width=auto])) a,:host([alignment=icon-end-space-between]:not([width=auto])) button{text-align:unset}:host([alignment=center]) a:not(.content--slotted) .icon--start+.icon--end,:host([alignment=center]) button:not(.content--slotted) .icon--start+.icon--end{margin-inline-start:var(--calcite-internal-button-content-margin)}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}@keyframes loader-in{0%{inline-size:0;opacity:0;transform:scale(.5)}to{inline-size:1em;opacity:1;transform:scale(1)}}@keyframes loader-out{0%{inline-size:1em;opacity:1;transform:scale(1)}to{inline-size:0;opacity:0;transform:scale(.5)}}.calcite-button--loader{display:flex}.calcite-button--loader calcite-loader{margin:0}:host([loading]) button.content--slotted .calcite-button--loader calcite-loader,:host([loading]) a.content--slotted .calcite-button--loader calcite-loader{margin-inline-end:var(--calcite-internal-button-content-margin)}:host([loading]) button:not(.content--slotted) .icon--start,:host([loading]) button:not(.content--slotted) .icon--end,:host([loading]) a:not(.content--slotted) .icon--start,:host([loading]) a:not(.content--slotted) .icon--end{display:none}:host([appearance]) button,:host([appearance]) a{--calcite-internal-button-border-color: var(--calcite-color-transparent);border-style:solid;border-width:var(--calcite-button-border-size, 1px)}:host([kind=brand]) button,:host([kind=brand]) a{--calcite-internal-button-text-color: var(--calcite-color-text-inverse);--calcite-internal-button-background-color: var(--calcite-color-brand);--calcite-internal-button-loader-color: var(--calcite-color-text-inverse)}:host([kind=brand]) button:hover,:host([kind=brand]) a:hover{--calcite-internal-button-background-color: var(--calcite-color-brand-hover)}:host([kind=brand]) button:active,:host([kind=brand]) a:active{--calcite-internal-button-background-color: var(--calcite-color-brand-press)}:host([kind=danger]) button,:host([kind=danger]) a{--calcite-internal-button-text-color: var(--calcite-color-text-inverse);--calcite-internal-button-background-color: var(--calcite-color-status-danger);--calcite-internal-button-loader-color: var(--calcite-color-text-inverse)}:host([kind=danger]) button:hover,:host([kind=danger]) a:hover{--calcite-internal-button-background-color: var(--calcite-color-status-danger-hover)}:host([kind=danger]) button:active,:host([kind=danger]) a:active{--calcite-internal-button-background-color: var(--calcite-color-status-danger-press)}:host([kind=neutral]) button,:host([kind=neutral]) a{--calcite-internal-button-text-color: var(--calcite-color-text-1);--calcite-internal-button-background-color: var(--calcite-color-foreground-3);--calcite-internal-button-loader-color: var(--calcite-color-text-1)}:host([kind=neutral]) button:hover,:host([kind=neutral]) a:hover{--calcite-internal-button-background-color: var(--calcite-color-foreground-2)}:host([kind=neutral]) button:active,:host([kind=neutral]) a:active{--calcite-internal-button-background-color: var(--calcite-color-foreground-1)}:host([kind=inverse]) button,:host([kind=inverse]) a{--calcite-internal-button-text-color: var(--calcite-color-text-inverse);--calcite-internal-button-background-color: var(--calcite-color-inverse);--calcite-internal-button-loader-color: var(--calcite-color-text-inverse)}:host([kind=inverse]) button:hover,:host([kind=inverse]) a:hover{--calcite-internal-button-background-color: var(--calcite-color-inverse-hover)}:host([kind=inverse]) button:active,:host([kind=inverse]) a:active{--calcite-internal-button-background-color: var(--calcite-color-inverse-press)}:host([appearance=outline-fill]) button,:host([appearance=outline-fill]) a{--calcite-internal-button-background-color: var(--calcite-color-foreground-1);border-style:solid;border-width:var(--calcite-button-border-size, 1px)}:host([appearance=outline-fill]) button:hover,:host([appearance=outline-fill]) a:hover{--calcite-internal-button-background-color: var(--calcite-color-foreground-2)}:host([appearance=outline-fill]) button:active,:host([appearance=outline-fill]) a:active{--calcite-internal-button-background-color: var(--calcite-color-foreground-3)}:host([appearance=outline-fill][kind=brand]) button,:host([appearance=outline-fill][kind=brand]) a{--calcite-internal-button-border-color: var(--calcite-color-brand);--calcite-internal-button-text-color: var(--calcite-color-brand);--calcite-internal-button-loader-color: var(--calcite-color-brand)}:host([appearance=outline-fill][kind=brand]) button:hover,:host([appearance=outline-fill][kind=brand]) a:hover{--calcite-internal-button-border-color: var(--calcite-color-brand-hover);--calcite-internal-button-text-color: var(--calcite-color-brand-hover);--calcite-internal-button-shadow-color: var(--calcite-color-brand-hover)}:host([appearance=outline-fill][kind=brand]) button:focus,:host([appearance=outline-fill][kind=brand]) a:focus{--calcite-internal-button-border-color: var(--calcite-color-brand);--calcite-internal-button-text-color: var(--calcite-color-brand);--calcite-internal-button-shadow-color: var(--calcite-color-brand)}:host([appearance=outline-fill][kind=brand]) button:active,:host([appearance=outline-fill][kind=brand]) a:active{--calcite-internal-button-border-color: var(--calcite-color-brand-press);--calcite-internal-button-text-color: var(--calcite-color-brand-press);--calcite-internal-button-shadow-color: var(--calcite-color-brand-press)}:host([appearance=outline-fill][kind=brand]) button calcite-loader,:host([appearance=outline-fill][kind=brand]) a calcite-loader{--calcite-internal-button-loader-color: var(--calcite-color-brand)}:host([appearance=outline-fill][kind=danger]) button,:host([appearance=outline-fill][kind=danger]) a{--calcite-internal-button-border-color: var(--calcite-color-status-danger);--calcite-internal-button-text-color: var(--calcite-color-status-danger);--calcite-internal-button-loader-color: var(--calcite-color-status-danger)}:host([appearance=outline-fill][kind=danger]) button:hover,:host([appearance=outline-fill][kind=danger]) a:hover{--calcite-internal-button-border-color: var(--calcite-color-status-danger-hover);--calcite-internal-button-text-color: var(--calcite-color-status-danger-hover);--calcite-internal-button-shadow-color: var(--calcite-color-status-danger-hover)}:host([appearance=outline-fill][kind=danger]) button:focus,:host([appearance=outline-fill][kind=danger]) a:focus{--calcite-internal-button-border-color: var(--calcite-color-status-danger);--calcite-internal-button-text-color: var(--calcite-color-status-danger);--calcite-internal-button-shadow-color: var(--calcite-color-status-danger)}:host([appearance=outline-fill][kind=danger]) button:active,:host([appearance=outline-fill][kind=danger]) a:active{--calcite-internal-button-border-color: var(--calcite-color-status-danger-press);--calcite-internal-button-text-color: var(--calcite-color-status-danger-press);--calcite-internal-button-shadow-color: var(--calcite-color-status-danger-press)}:host([appearance=outline-fill][kind=danger]) button calcite-loader,:host([appearance=outline-fill][kind=danger]) a calcite-loader{--calcite-internal-button-loader-color: var(--calcite-color-status-danger)}:host([appearance=outline-fill][kind=neutral]) button,:host([appearance=outline-fill][kind=neutral]) a{--calcite-internal-button-border-color: var(--calcite-color-border-1);--calcite-internal-button-text-color: var(--calcite-color-text-1);--calcite-internal-button-loader-color: var(--calcite-color-text-1)}:host([appearance=outline-fill][kind=neutral]) button:hover,:host([appearance=outline-fill][kind=neutral]) a:hover{--calcite-internal-button-shadow-color: var(--calcite-color-foreground-3);--calcite-internal-button-border-color: var(--calcite-color-border-input)}:host([appearance=outline-fill][kind=neutral]) button:focus,:host([appearance=outline-fill][kind=neutral]) a:focus{--calcite-internal-button-shadow-color: var(--calcite-color-foreground-3)}:host([appearance=outline-fill][kind=neutral]) button:active,:host([appearance=outline-fill][kind=neutral]) a:active{--calcite-internal-button-shadow-color: var(--calcite-color-foreground-3);--calcite-internal-button-border-color: var(--calcite-color-text-3)}:host([appearance=solid][kind=neutral]) button:hover,:host([appearance=solid][kind=neutral]) a:hover{--calcite-internal-button-background-color: var(--calcite-color-border-3)}:host([appearance=solid][kind=neutral]) button:active,:host([appearance=solid][kind=neutral]) a:active{--calcite-internal-button-background-color: var(--calcite-color-border-2)}:host([appearance=outline-fill][kind=inverse]) button,:host([appearance=outline-fill][kind=inverse]) a{--calcite-internal-button-text-color: var(--calcite-color-text-1);--calcite-internal-button-border-color: var(--calcite-color-inverse);--calcite-internal-button-loader-color: var(--calcite-color-text-1)}:host([appearance=outline-fill][kind=inverse]) button:hover,:host([appearance=outline-fill][kind=inverse]) a:hover{--calcite-internal-button-border-color: var(--calcite-color-inverse-hover);--calcite-internal-button-shadow-color: var(--calcite-color-inverse-hover)}:host([appearance=outline-fill][kind=inverse]) button:focus,:host([appearance=outline-fill][kind=inverse]) a:focus{--calcite-internal-button-border-color: var(--calcite-color-inverse);--calcite-internal-button-shadow-color: var(--calcite-color-inverse)}:host([appearance=outline-fill][kind=inverse]) button:active,:host([appearance=outline-fill][kind=inverse]) a:active{--calcite-internal-button-border-color: var(--calcite-color-inverse-press);--calcite-internal-button-shadow-color: var(--calcite-color-inverse-press)}:host([appearance=outline]) button,:host([appearance=outline]) a{--calcite-internal-button-background-color: var(--calcite-color-transparent);border-style:solid;border-width:var(--calcite-button-border-size, 1px)}:host([appearance=outline]) button:hover,:host([appearance=outline]) a:hover{--calcite-internal-button-background-color: var(--calcite-color-transparent-hover)}:host([appearance=outline]) button:active,:host([appearance=outline]) a:active{--calcite-internal-button-background-color: var(--calcite-color-transparent-press)}:host([appearance=outline][kind=brand]) button,:host([appearance=outline][kind=brand]) a{--calcite-internal-button-border-color: var(--calcite-color-brand);--calcite-internal-button-text-color: var(--calcite-color-brand);--calcite-internal-button-loader-color: var(--calcite-color-brand)}:host([appearance=outline][kind=brand]) button:hover,:host([appearance=outline][kind=brand]) a:hover{--calcite-internal-button-border-color: var(--calcite-color-brand-hover);--calcite-internal-button-text-color: var(--calcite-color-brand-hover);--calcite-internal-button-shadow-color: var(--calcite-color-brand-hover)}:host([appearance=outline][kind=brand]) button:focus,:host([appearance=outline][kind=brand]) a:focus{--calcite-internal-button-border-color: var(--calcite-color-brand);--calcite-internal-button-text-color: var(--calcite-color-brand);--calcite-internal-button-shadow-color: var(--calcite-color-brand)}:host([appearance=outline][kind=brand]) button:active,:host([appearance=outline][kind=brand]) a:active{--calcite-internal-button-border-color: var(--calcite-color-brand-press);--calcite-internal-button-text-color: var(--calcite-color-brand-press);--calcite-internal-button-shadow-color: var(--calcite-color-brand-press)}:host([appearance=outline][kind=brand]) button calcite-loader,:host([appearance=outline][kind=brand]) a calcite-loader{--calcite-internal-button-loader-color: var(--calcite-color-brand)}:host([appearance=outline][kind=danger]) button,:host([appearance=outline][kind=danger]) a{--calcite-internal-button-border-color: var(--calcite-color-status-danger);--calcite-internal-button-text-color: var(--calcite-color-status-danger);--calcite-internal-button-loader-color: var(--calcite-color-status-danger)}:host([appearance=outline][kind=danger]) button:hover,:host([appearance=outline][kind=danger]) a:hover{--calcite-internal-button-border-color: var(--calcite-color-status-danger-hover);--calcite-internal-button-text-color: var(--calcite-color-status-danger-hover);--calcite-internal-button-shadow-color: var(--calcite-color-status-danger-hover)}:host([appearance=outline][kind=danger]) button:focus,:host([appearance=outline][kind=danger]) a:focus{--calcite-internal-button-border-color: var(--calcite-color-status-danger);--calcite-internal-button-text-color: var(--calcite-color-status-danger);--calcite-internal-button-shadow-color: var(--calcite-color-status-danger)}:host([appearance=outline][kind=danger]) button:active,:host([appearance=outline][kind=danger]) a:active{--calcite-internal-button-border-color: var(--calcite-color-status-danger-press);--calcite-internal-button-text-color: var(--calcite-color-status-danger-press);--calcite-internal-button-shadow-color: var(--calcite-color-status-danger-press)}:host([appearance=outline][kind=danger]) button calcite-loader,:host([appearance=outline][kind=danger]) a calcite-loader{--calcite-internal-button-loader-color: var(--calcite-color-status-danger)}:host([appearance=outline][kind=neutral]) button,:host([appearance=outline][kind=neutral]) a{--calcite-internal-button-text-color: var(--calcite-color-text-1);--calcite-internal-button-border-color: var(--calcite-color-border-1);--calcite-internal-button-loader-color: var(--calcite-color-text-1)}:host([appearance=outline][kind=neutral]) button:hover,:host([appearance=outline][kind=neutral]) a:hover{--calcite-internal-button-shadow-color: var(--calcite-color-foreground-3);--calcite-internal-button-border-color: var(--calcite-color-border-input)}:host([appearance=outline][kind=neutral]) button:focus,:host([appearance=outline][kind=neutral]) a:focus{--calcite-internal-button-shadow-color: var(--calcite-color-foreground-3)}:host([appearance=outline][kind=neutral]) button:active,:host([appearance=outline][kind=neutral]) a:active{--calcite-internal-button-shadow-color: var(--calcite-color-foreground-3);--calcite-internal-button-border-color: var(--calcite-color-text-3)}:host([appearance=outline][kind=inverse]) button,:host([appearance=outline][kind=inverse]) a{--calcite-internal-button-text-color: var(--calcite-color-text-1);--calcite-internal-button-border-color: var(--calcite-color-inverse);--calcite-internal-button-loader-color: var(--calcite-color-text-1)}:host([appearance=outline][kind=inverse]) button:hover,:host([appearance=outline][kind=inverse]) a:hover{--calcite-internal-button-border-color: var(--calcite-color-inverse-hover);--calcite-internal-button-shadow-color: var(--calcite-color-inverse-hover)}:host([appearance=outline][kind=inverse]) button:focus,:host([appearance=outline][kind=inverse]) a:focus{--calcite-internal-button-border-color: var(--calcite-color-inverse);--calcite-internal-button-shadow-color: var(--calcite-color-inverse)}:host([appearance=outline][kind=inverse]) button:active,:host([appearance=outline][kind=inverse]) a:active{--calcite-internal-button-border-color: var(--calcite-color-inverse-press);--calcite-internal-button-shadow-color: var(--calcite-color-inverse-press)}:host([appearance=outline-fill][split-child=primary]) button,:host([appearance=outline][split-child=primary]) button,:host([appearance=outline-fill][split-child=primary]) a,:host([appearance=outline][split-child=primary]) a{border-inline-end-width:0;border-inline-start-width:1px}:host([appearance=outline-fill][split-child=secondary]) button,:host([appearance=outline][split-child=secondary]) button,:host([appearance=outline-fill][split-child=secondary]) a,:host([appearance=outline][split-child=secondary]) a{border-inline-start-width:0;border-inline-end-width:1px}:host([appearance=transparent]) button,:host([appearance=transparent]) a{--calcite-internal-button-background-color: var(--calcite-color-transparent)}:host([appearance=transparent]) button:hover,:host([appearance=transparent]) button:focus,:host([appearance=transparent]) a:hover,:host([appearance=transparent]) a:focus{--calcite-internal-button-background-color: var(--calcite-color-transparent-hover)}:host([appearance=transparent]) button:active,:host([appearance=transparent]) a:active{--calcite-internal-button-background-color: var(--calcite-color-transparent-press)}:host([appearance=transparent]:not(.enable-editing-button)) button,:host([appearance=transparent]:not(.enable-editing-button)) a{background-color:var(--calcite-color-transparent)}:host([appearance=transparent]:not(.enable-editing-button)) button:hover,:host([appearance=transparent]:not(.enable-editing-button)) a:hover{background-color:var(--calcite-color-transparent-hover)}:host([appearance=transparent]:not(.enable-editing-button)) button:active,:host([appearance=transparent]:not(.enable-editing-button)) a:active{background-color:var(--calcite-color-transparent-press)}:host([appearance=transparent][kind=brand]) button,:host([appearance=transparent][kind=brand]) a{--calcite-internal-button-text-color: var(--calcite-color-brand);--calcite-internal-button-loader-color: var(--calcite-color-brand)}:host([appearance=transparent][kind=brand]) button:hover,:host([appearance=transparent][kind=brand]) a:hover{--calcite-internal-button-text-color: var(--calcite-color-brand-hover)}:host([appearance=transparent][kind=brand]) button:focus,:host([appearance=transparent][kind=brand]) a:focus{--calcite-internal-button-text-color: var(--calcite-color-brand)}:host([appearance=transparent][kind=brand]) button:active,:host([appearance=transparent][kind=brand]) a:active{--calcite-internal-button-text-color: var(--calcite-color-brand-press)}:host([appearance=transparent][kind=brand]) button calcite-loader,:host([appearance=transparent][kind=brand]) a calcite-loader{--calcite-internal-button-loader-color: var(--calcite-color-brand)}:host([appearance=transparent][kind=danger]) button,:host([appearance=transparent][kind=danger]) a{--calcite-internal-button-text-color: var(--calcite-color-status-danger);--calcite-internal-button-loader-color: var(--calcite-color-status-danger)}:host([appearance=transparent][kind=danger]) button:hover,:host([appearance=transparent][kind=danger]) a:hover{--calcite-internal-button-text-color: var(--calcite-color-status-danger-hover)}:host([appearance=transparent][kind=danger]) button:focus,:host([appearance=transparent][kind=danger]) a:focus{--calcite-internal-button-text-color: var(--calcite-color-status-danger)}:host([appearance=transparent][kind=danger]) button:active,:host([appearance=transparent][kind=danger]) a:active{--calcite-internal-button-text-color: var(--calcite-color-status-danger-press)}:host([appearance=transparent][kind=danger]) button calcite-loader,:host([appearance=transparent][kind=danger]) a calcite-loader{--calcite-internal-button-loader-color: var(--calcite-color-status-danger)}:host([appearance=transparent][kind=neutral]:not(.cancel-editing-button)) button,:host([appearance=transparent][kind=neutral]:not(.cancel-editing-button)) a,:host([appearance=transparent][kind=neutral]:not(.cancel-editing-button)) calcite-loader{--calcite-internal-button-text-color: var(--calcite-color-text-1)}:host([appearance=transparent][kind=neutral].cancel-editing-button) button{--calcite-internal-button-text-color: var(--calcite-color-text-3)}:host([appearance=transparent][kind=neutral].cancel-editing-button) button:hover{--calcite-internal-button-text-color: var(--calcite-color-text-1);--calcite-internal-button-padding-y: 0}:host(.confirm-changes-button) button:focus,:host(.cancel-editing-button) button:focus,:host(.enable-editing-button) button:focus{outline-offset:-2px}:host([appearance=transparent][kind=inverse]) button:hover,:host([appearance=transparent][kind=inverse]) a:hover{background-color:var(--calcite-color-transparent-inverse-hover)}:host([appearance=transparent][kind=inverse]) button:active,:host([appearance=transparent][kind=inverse]) a:active{background-color:var(--calcite-color-transparent-inverse-press)}:host([appearance=transparent][kind=inverse]) button calcite-loader,:host([appearance=transparent][kind=inverse]) a calcite-loader{--calcite-internal-button-text-color: var(--calcite-color-text-inverse)}:host([scale=s]) button.content--slotted,:host([scale=s]) a.content--slotted{font-size:var(--calcite-font-size--2);line-height:1rem}:host([scale=s][appearance=transparent]) button.content--slotted,:host([scale=s][appearance=transparent]) a.content--slotted{--calcite-internal-button-padding-x: .5rem}:host([scale=s]) button,:host([scale=s]) a{--calcite-internal-button-padding-y: 3px}:host([scale=m]) button.content--slotted,:host([scale=m]) a.content--slotted{--calcite-internal-button-padding-x: 11px;font-size:var(--calcite-font-size--1);line-height:1rem}:host([scale=m]) button,:host([scale=m]) a{--calcite-internal-button-padding-y: 7px}:host([scale=m][appearance=transparent]) button.content--slotted,:host([scale=m][appearance=transparent]) a.content--slotted{--calcite-internal-button-padding-x: .75rem}:host([scale=l]) button.content--slotted,:host([scale=l]) a.content--slotted{--calcite-internal-button-padding-x: 15px;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=l]) .button-padding{--calcite-internal-button-padding-x: 1rem;--calcite-internal-button-padding-y: 11px}:host([scale=l]) .button-padding--shrunk{--calcite-internal-button-padding-y: 9px}:host([scale=s]) button:not(.content--slotted),:host([scale=s]) a:not(.content--slotted){--calcite-internal-button-padding-x: .125rem;--calcite-internal-button-padding-y: 3px;inline-size:1.5rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-block-size:1.5rem}:host([scale=m]) button:not(.content--slotted),:host([scale=m]) a:not(.content--slotted){--calcite-internal-button-padding-x: .125rem;--calcite-internal-button-padding-y: 7px;inline-size:2rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-block-size:2rem}:host([scale=l]) button:not(.content--slotted),:host([scale=l]) a:not(.content--slotted){--calcite-internal-button-padding-x: .125rem;--calcite-internal-button-padding-y: 9px;inline-size:2.75rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-block-size:2.75rem}:host(:is([scale=s],[scale=m],[scale=l])[width=full]) a:not(.content--slotted),:host(:is([scale=s],[scale=m],[scale=l])[width=full]) button:not(.content--slotted){inline-size:var(--calcite-container-size-content-fluid)}:host([scale=l][appearance=transparent]) button:not(.content--slotted),:host([scale=l][appearance=transparent]) a:not(.content--slotted){--calcite-internal-button-padding-y: .625rem}:host([scale=s][icon-start][icon-end]) button:not(.content--slotted),:host([scale=s][icon-start][icon-end]) a:not(.content--slotted){--calcite-internal-button-padding-x: 23px;block-size:1.5rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=s][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=s][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-internal-button-padding-x: 1.5rem}:host([scale=m][icon-start][icon-end]) button:not(.content--slotted),:host([scale=m][icon-start][icon-end]) a:not(.content--slotted){--calcite-internal-button-padding-x: 2rem;block-size:2rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=m][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=m][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-internal-button-padding-x: 33px}:host([scale=l][icon-start][icon-end]) button:not(.content--slotted),:host([scale=l][icon-start][icon-end]) a:not(.content--slotted){--calcite-internal-button-padding-x: 43px;block-size:2.75rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=l][icon-start][icon-end]) button:not(.content--slotted) .icon--start+.icon--end,:host([scale=l][icon-start][icon-end]) a:not(.content--slotted) .icon--start+.icon--end{margin-inline-start:1rem}:host([scale=l][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=l][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-internal-button-padding-x: 2.75rem}:host([hidden]){display:none}[hidden]{display:none}`;class Oze extends Vn{constructor(){super(...arguments),this.attributeWatch=tze(["aria-expanded"],this.handleGlobalAttributesChanged),this.contentEl=Gc(),this.mutationObserver=vf("mutation",()=>this.updateHasContent()),this.resizeObserver=vf("resize",()=>this.setTooltipText()),this.messages=Fd(),this.hasContent=!1,this.alignment="center",this.appearance="solid",this.disabled=!1,this.download=!1,this.kind="brand",this.loading=!1,this.round=!1,this.scale="m",this.splitChild=!1,this.type="button",this.width="auto"}static{this.properties={hasContent:[16,{},{state:!0}],tooltipText:[16,{},{state:!0}],alignment:[3,{},{reflect:!0}],appearance:[3,{},{reflect:!0}],disabled:[7,{},{reflect:!0,type:Boolean}],download:[3,{converter:ZP},{reflect:!0}],form:[3,{},{reflect:!0}],href:[3,{},{reflect:!0}],iconEnd:[3,{},{reflect:!0}],iconFlipRtl:[3,{},{reflect:!0}],iconStart:[3,{},{reflect:!0}],kind:[3,{},{reflect:!0}],label:1,loading:[7,{},{reflect:!0,type:Boolean}],messageOverrides:[0,{},{attribute:!1}],name:[3,{},{reflect:!0}],rel:[3,{},{reflect:!0}],round:[7,{},{reflect:!0,type:Boolean}],scale:[3,{},{reflect:!0}],splitChild:[3,{},{reflect:!0}],target:[3,{},{reflect:!0}],type:[3,{},{reflect:!0}],width:[3,{},{reflect:!0}]}}static{this.styles=Ezt}async setFocus(){await dh(this),this.childEl?.focus()}connectedCallback(){super.connectedCallback(),this.setupTextContentObserver(),GG(this),this.formEl=xze(this)}async load(){this.updateHasContent()}updated(){yg(this)}loaded(){this.setTooltipText()}disconnectedCallback(){super.disconnectedCallback(),this.mutationObserver?.disconnect(),Aze(this),this.resizeObserver?.disconnect(),this.formEl=null}handleGlobalAttributesChanged(){this.requestUpdate()}updateHasContent(){this.hasContent=P5t(this.el)}setupTextContentObserver(){this.mutationObserver?.observe(this.el,{childList:!0,subtree:!0})}onLabelClick(){this.handleClick(),this.setFocus()}handleClick(){const{type:e}=this;this.href||(e==="submit"?wze(this):e==="reset"&&czt(this))}setTooltipText(){const{contentEl:{value:e}}=this;e&&(this.tooltipText=e.offsetWidth<e.scrollWidth&&this.el.innerText||null)}setChildEl(e){this.childEl=e,e&&this.resizeObserver?.observe(e)}render(){const e=this.href?"a":"button",i=this.href?D3`a`:D3`button`,r=this.loading?le`<div class=${fe(vu.buttonLoader)}><calcite-loader class=${fe(this.loading?vu.loadingIn:vu.loadingOut)} inline .label=${this.messages.loading} .scale=${this.scale==="l"?"m":"s"}></calcite-loader></div>`:null,s=!this.iconStart&&!this.iconEnd,n=le`<calcite-icon class=${fe({[vu.icon]:!0,[vu.iconStart]:!0})} .flipRtl=${this.iconFlipRtl==="start"||this.iconFlipRtl==="both"} .icon=${this.iconStart} .scale=${Wa(this.scale)}></calcite-icon>`,o=le`<calcite-icon class=${fe({[vu.icon]:!0,[vu.iconEnd]:!0})} .flipRtl=${this.iconFlipRtl==="end"||this.iconFlipRtl==="both"} .icon=${this.iconEnd} .scale=${Wa(this.scale)}></calcite-icon>`,a=le`<span class=${fe(vu.content)} ${wr(this.contentEl)}><slot></slot></span>`;return vg({disabled:this.disabled,children:sae`<${i} .ariaBusy=${this.loading} .ariaExpanded=${this.el.ariaExpanded?this.el.ariaExpanded:null} .ariaLabel=${this.loading?this.messages.loading:eee(this)} aria-live=polite class=${fe({[vu.buttonPadding]:s,[vu.buttonPaddingShrunk]:!s,[vu.contentSlotted]:this.hasContent,[vu.iconStartEmpty]:!this.iconStart,[vu.iconEndEmpty]:!this.iconEnd})} .disabled=${e==="button"?this.disabled:null} download=${(e==="a"?this.download===!0||this.download===""?"":this.download||null:null)??Ze} href=${(e==="a"&&this.href)??Ze} name=${(e==="button"&&this.name)??Ze} @click=${this.handleClick} rel=${(e==="a"&&this.rel)??Ze} tabindex=${(this.disabled?-1:null)??Ze} target=${(e==="a"&&this.target)??Ze} title=${this.tooltipText??Ze} type=${(e==="button"?this.type:null)??Ze} ${wr(this.setChildEl)}>${r}${this.iconStart?n:null}${this.hasContent?a:null}${this.iconEnd?o:null}</${i}>`})}}Oo("calcite-button",Oze);const lae=Object.freeze(Object.defineProperty({__proto__:null,Button:Oze},Symbol.toStringTag,{value:"Module"}));/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const Ybe={valid:"check-circle",invalid:"exclamation-mark-triangle",idle:"information"},Czt=Js`:host{box-sizing:border-box;display:flex;block-size:auto;inline-size:100%;align-items:center;font-weight:var(--calcite-font-weight-medium);color:var(--calcite-color-text-1);opacity:1;transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out;margin-block-start:var(--calcite-input-message-spacing, var(--calcite-input-message-spacing-value, var(--calcite-spacing-xxs)))}.calcite-input-message-icon{pointer-events:none;display:inline-flex;flex-shrink:0;transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out;margin-inline-end:var(--calcite-spacing-sm)}:host([status=invalid]) .calcite-input-message-icon{color:var(--calcite-input-message-icon-color, var(--calcite-icon-color, var(--calcite-color-status-danger)))}:host([status=warning]) .calcite-input-message-icon{color:var(--calcite-input-message-icon-color, var(--calcite-icon-color, var(--calcite-color-status-warning)))}:host([status=valid]) .calcite-input-message-icon{color:var(--calcite-input-message-icon-color, var(--calcite-icon-color, var(--calcite-color-status-success)))}:host([status=idle]) .calcite-input-message-icon{color:var(--calcite-input-message-icon-color, var(--calcite-icon-color, var(--calcite-color-brand)))}:host([scale=s]){font-size:var(--calcite-font-size--3);line-height:.75rem}:host([scale=m]){font-size:var(--calcite-font-size--2);line-height:1rem}:host([scale=l]){font-size:var(--calcite-font-size--1);line-height:1rem}:host([hidden]){display:none}[hidden]{display:none}`;class Ize extends Vn{constructor(){super(...arguments),this.iconFlipRtl=!1,this.scale="m",this.status="idle"}static{this.properties={icon:[3,{converter:ZP},{reflect:!0}],iconFlipRtl:[7,{},{reflect:!0,type:Boolean}],scale:[3,{},{reflect:!0}],status:[3,{},{reflect:!0}]}}static{this.styles=Czt}connectedCallback(){super.connectedCallback(),this.requestedIcon=rA(Ybe,this.icon,this.status)}willUpdate(e){(e.has("status")&&(this.hasUpdated||this.status!=="idle")||e.has("icon"))&&(this.requestedIcon=rA(Ybe,this.icon,this.status))}render(){const e=this.el.hidden;return mj(this.el,"calcite-hydrated-hidden",e),le`${this.renderIcon(this.requestedIcon)}<slot></slot>`}renderIcon(e){if(e)return le`<calcite-icon class="calcite-input-message-icon" .flipRtl=${this.iconFlipRtl} .icon=${e} scale=s></calcite-icon>`}}Oo("calcite-input-message",Ize);const Dfi=Object.freeze(Object.defineProperty({__proto__:null,InputMessage:Ize},Symbol.toStringTag,{value:"Module"}));/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const $zt=Js`:host{position:relative;display:block;inline-size:100%}.track,.bar{position:absolute;inset-block-start:0px;block-size:2px}.track{z-index:var(--calcite-z-index);inline-size:100%;overflow:hidden;background-color:var(--calcite-progress-background-color, var(--calcite-color-border-3))}.bar{z-index:var(--calcite-z-index);background-color:var(--calcite-progress-fill-color, var(--calcite-color-brand))}@media (forced-colors: active){.track{background-color:highlightText}.bar{background-color:linkText}}.indeterminate{inline-size:20%;animation:looping-progress-bar-ani calc(var(--calcite-internal-animation-timing-medium) / var(--calcite-internal-duration-factor) * 11 / var(--calcite-internal-duration-factor)) linear infinite}.indeterminate.calcite--rtl{animation-name:looping-progress-bar-ani-rtl}.reversed{animation-direction:reverse}.text{padding-inline:0px;padding-block:1rem 0px;text-align:center;font-size:var(--calcite-font-size--2);line-height:1rem;font-weight:var(--calcite-font-weight-medium);color:var(--calcite-progress-text-color, var(--calcite-color-text-2))}@keyframes looping-progress-bar-ani{0%{transform:translate3d(-100%,0,0)}50%{inline-size:40%}to{transform:translate3d(600%,0,0)}}@keyframes looping-progress-bar-ani-rtl{0%{transform:translate3d(100%,0,0)}50%{inline-size:40%}to{transform:translate3d(-600%,0,0)}}:host([hidden]){display:none}[hidden]{display:none}`;class Azt extends Vn{constructor(){super(...arguments),this.reversed=!1,this.type="determinate",this.value=0}static{this.properties={label:1,reversed:[7,{},{reflect:!0,type:Boolean}],text:1,type:[3,{},{reflect:!0}],value:[9,{},{type:Number}]}}static{this.styles=$zt}render(){const e=this.type==="determinate",i=e?{width:`${this.value}%`}:{},r=oL(this.el);return le`<div .ariaLabel=${this.label||this.text} .ariaValueMax=${e?"100":void 0} .ariaValueMin=${e?"0":void 0} .ariaValueNow=${e?this.value:void 0} role=progressbar><div class="track"><div class=${fe({bar:!0,indeterminate:this.type==="indeterminate",[IR.rtl]:r==="rtl",reversed:this.reversed})} style=${UMe(i)}></div></div>${this.text?le`<div class="text">${this.text}</div>`:null}</div>`}}Oo("calcite-progress",Azt);/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Zi=TD(class extends ED{constructor(){super(...arguments),this.key=Ze}render(t,e){return this.key=t,e}update(t,[e,i]){return e!==this.key&&(zMe(t),this.key=e),i}});/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */function cae(t){return t==="Enter"||t===" "}const HG=["0","1","2","3","4","5","6","7","8","9"];/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const Mzt=new RegExp("\\.(0+)?$"),Ozt=new RegExp("0+$");class Cs{static{this.DECIMALS=100}static{this.ROUNDED=!0}static{this.SHIFT=BigInt("1"+"0".repeat(this.DECIMALS))}constructor(e){if(e instanceof Cs)return e;const[i,r]=zzt(e).split(".").concat("");this.value=BigInt(i+r.padEnd(Cs.DECIMALS,"0").slice(0,Cs.DECIMALS))+BigInt(Cs.ROUNDED&&r[Cs.DECIMALS]>="5"),this.isNegative=e.charAt(0)==="-"}static{this._divRound=(e,i)=>Cs.fromBigInt(e/i+(Cs.ROUNDED?e*BigInt(2)/i%BigInt(2):BigInt(0)))}static{this.fromBigInt=e=>Object.assign(Object.create(Cs.prototype),{value:e,isNegative:e<BigInt(0)})}getIntegersAndDecimals(){const e=this.value.toString().replace("-","").padStart(Cs.DECIMALS+1,"0"),i=e.slice(0,-Cs.DECIMALS),r=e.slice(-Cs.DECIMALS).replace(Ozt,"");return{integers:i,decimals:r}}toString(){const{integers:e,decimals:i}=this.getIntegersAndDecimals();return`${this.isNegative?"-":""}${e}${i.length?"."+i:""}`}formatToParts(e){const{integers:i,decimals:r}=this.getIntegersAndDecimals(),s=e.numberFormatter.formatToParts(BigInt(i));return this.isNegative&&s.unshift({type:"minusSign",value:e.minusSign}),r.length&&(s.push({type:"decimal",value:e.decimal}),r.split("").forEach(n=>s.push({type:"fraction",value:n}))),s}format(e){const{integers:i,decimals:r}=this.getIntegersAndDecimals(),s=`${this.isNegative?e.minusSign:""}${e.numberFormatter.format(BigInt(i))}`,n=r.length?`${e.decimal}${r.split("").map(o=>e.numberFormatter.format(Number(o))).join("")}`:"";return`${s}${n}`}add(e){return Cs.fromBigInt(this.value+new Cs(e).value)}subtract(e){return Cs.fromBigInt(this.value-new Cs(e).value)}multiply(e){return Cs._divRound(this.value*new Cs(e).value,Cs.SHIFT)}divide(e){return Cs._divRound(this.value*Cs.SHIFT,new Cs(e).value)}}function Ly(t){return!(!t||isNaN(Number(t)))}function Izt(t){return!t||!Uzt(t)?"":BB(t,e=>{let i=!1;const r=e.split("").filter((s,n)=>s.match(/\./g)&&!i?(i=!0,!0):s.match(/-/g)&&n===0?!0:HG.includes(s)).join("");return Ly(r)?new Cs(r).toString():""})}const Rze=/^([-0])0+(?=\d)/,Rzt=/(?!^\.)\.$/,Pzt=/(?!^-)-/g,Dzt=/^-\b0\b\.?0*$/,Lzt=/0*$/,Nzt=new Set(["e","E","-",",",".",...HG]),Fzt=t=>{const e=Array.from(t).filter(i=>Nzt.has(i)).join("");return BB(e,i=>{const r=i.replace(Pzt,"").replace(Rzt,"").replace(Rze,"$1");return Ly(r)?Dzt.test(r)?r:kzt(r):i})};function kzt(t){const e=t.split(".")[1],i=new Cs(t).toString(),[r,s]=i.split(".");return e&&s!==e?`${r}.${e}`:i}function BB(t,e){if(!t)return t;const i=t.toLowerCase().indexOf("e")+1;return i?t.replace(/[eE]*$/g,"").substring(0,i).concat(t.slice(i).replace(/[eE]/g,"")).split(/[eE]/).map((r,s)=>e(s===1?r.replace(/\./g,""):r)).join("e").replace(/^e/,"1e"):e(t)}function zzt(t){const e=t.split(/[eE]/);if(e.length===1)return t;const i=+t;if(Number.isSafeInteger(i))return`${i}`;const r=t.charAt(0)==="-",s=+e[1],n=e[0].split("."),o=(r?n[0].substring(1):n[0])||"",a=n[1]||"",l=(d,f)=>{const m=Math.abs(f)-d.length,y=m>0?`${"0".repeat(m)}${d}`:d;return`${y.slice(0,f)}.${y.slice(f)}`},c=(d,f)=>{const m=f>d.length?`${d}${"0".repeat(f-d.length)}`:d;return`${m.slice(0,f)}.${m.slice(f)}`},h=s>0?`${o}${c(a,s)}`:`${l(o,s)}${a}`;return`${r?"-":""}${h.charAt(0)==="."?"0":""}${h.replace(Mzt,"").replace(Rze,"")}`}function Uzt(t){return HG.some(e=>t.includes(e))}function Bzt(t,e,i){const r=e.split(".")[1];if(r){const s=r.match(Lzt)[0];if(s&&i.delocalize(t).length!==e.length&&r.indexOf("e")===-1){const n=i.decimal;return t=t.includes(n)?t:`${t}${n}`,t.padEnd(t.length+s.length,i.localize("0"))}}return t}const VB="en",Vzt=["ar","bg","bs","ca","cs","da","de","de-AT","de-CH","el",VB,"en-AU","en-CA","en-GB","es","es-MX","et","fi","fr","fr-CH","he","hi","hr","hu","id","it","it-CH","ja","ko","lt","lv","mk","no","nl","pl","pt","pt-PT","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-CN","zh-HK","zh-TW"];new Map(Object.entries({bg:{am:"пр.об.",pm:"сл.об."},bs:{am:"prijepodne",pm:"popodne"},ca:{am:"a. m.",pm:"p. m."},cs:{am:"dop.",pm:"odp."},es:{am:"a. m.",pm:"p. m."},"es-mx":{am:"a.m.",pm:"p.m."},"es-MX":{am:"a.m.",pm:"p.m."},fi:{am:"ap.",pm:"ip."},he:{am:"לפנה״צ",pm:"אחה״צ"},hu:{am:"de. ",pm:"du."},lt:{am:"priešpiet",pm:"popiet"},lv:{am:"priekšpusdienā",pm:"pēcpusdienā"},mk:{am:"претпл.",pm:"попл."},no:{am:"a.m.",pm:"p.m."},nl:{am:"a.m.",pm:"p.m."},"pt-pt":{am:"da manhã",pm:"da tarde"},"pt-PT":{am:"da manhã",pm:"da tarde"},ro:{am:"a.m.",pm:"p.m."},sl:{am:"dop.",pm:"pop."},sv:{am:"fm",pm:"em"},th:{am:"ก่อนเที่ยง",pm:"หลังเที่ยง"},tr:{am:"ÖÖ",pm:"ÖS"},uk:{am:"дп",pm:"пп"},vi:{am:"SA",pm:"CH"}}));const jzt=["arab","arabext","latn"],T9=[...Vzt],Pze=t=>jzt.includes(t),E9=new Intl.NumberFormat().resolvedOptions().numberingSystem,Dze=E9==="arab"||!Pze(E9)?"latn":E9,Gzt=t=>Pze(t)?t:Dze;function Hzt(t){return t?T9.includes(t)?t:(t=t.toLowerCase(),t.includes("-")&&(t=t.replace(/(\w+)-(\w+)/,(e,i,r)=>`${i}-${r.toUpperCase()}`),T9.includes(t)||(t=t.split("-")[0])),t==="nb"||t==="nn"?"no":t==="zh"?"zh-CN":T9.includes(t)?t:(console.warn(`Translations for the "${t}" locale are not available and will fall back to the default, English (en).`),VB)):VB}class qzt{constructor(){this.delocalize=e=>this._numberFormatOptions?BB(e,i=>i.replace(new RegExp(`[${this._minusSign}]`,"g"),"-").replace(new RegExp(`[${this._group}]`,"g"),"").replace(new RegExp(`[${this._decimal}]`,"g"),".").replace(new RegExp(`[${this._digits.join("")}]`,"g"),this._getDigitIndex)):e,this.localize=e=>this._numberFormatOptions?BB(e,i=>Ly(i.trim())?new Cs(i.trim()).format(this).replace(new RegExp(`[${this._actualGroup}]`,"g"),this._group):i):e}get group(){return this._group}get decimal(){return this._decimal}get minusSign(){return this._minusSign}get digits(){return this._digits}get numberFormatter(){return this._numberFormatter}get numberFormatOptions(){return this._numberFormatOptions}set numberFormatOptions(e){if(e.locale=Hzt(e?.locale),e.numberingSystem=Gzt(e?.numberingSystem),!this._numberFormatOptions&&e.locale===VB&&e.numberingSystem===Dze&&Object.keys(e).length===2||JSON.stringify(this._numberFormatOptions)===JSON.stringify(e))return;this._numberFormatOptions=e,this._numberFormatter=new Intl.NumberFormat(this._numberFormatOptions.locale,this._numberFormatOptions),this._digits=[...new Intl.NumberFormat(this._numberFormatOptions.locale,{useGrouping:!1,numberingSystem:this._numberFormatOptions.numberingSystem}).format(9876543210)].reverse();const i=new Map(this._digits.map((s,n)=>[s,n])),r=new Intl.NumberFormat(this._numberFormatOptions.locale,{numberingSystem:this._numberFormatOptions.numberingSystem}).formatToParts(-123456789e-1);this._actualGroup=r.find(s=>s.type==="group").value,this._group=this._actualGroup.trim().length===0||this._actualGroup==" "?" ":this._actualGroup,this._decimal=e.locale==="bs"||e.locale==="mk"?",":r.find(s=>s.type==="decimal").value,this._minusSign=r.find(s=>s.type==="minusSign").value,this._getDigitIndex=s=>i.get(s)}}const Fh=new qzt;/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const Wzt={validationContainer:"validation-container"},Zzt=()=>{},Yzt=({scale:t,status:e,id:i,icon:r,message:s,ref:n})=>le`<div class=${fe(Wzt.validationContainer)} ${wr(n||Zzt)}><calcite-input-message aria-live=polite .icon=${r} id=${i??Ze} .scale=${t} .status=${e}>${s}</calcite-input-message></div>`;/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const Jzt=["date","datetime-local","month","number","range","time","week"],Xzt=["email","password","search","tel","text","url"],Kzt=["email","password","search","tel","text","textarea","url"];function nE(t,e,i,r){const s=i.toLowerCase(),n=t[i];r&&n!=null?e.setAttribute(s,`${n}`):e.removeAttribute(s)}function Qzt(t,e,i){i.type=t==="textarea"?"text":t;const r=Jzt.includes(t),s=e;nE(s,i,"min",r),nE(s,i,"max",r),nE(s,i,"step",r);const n=Kzt.includes(t),o=e;nE(o,i,"minLength",n),nE(o,i,"maxLength",n);const a=Xzt.includes(t);nE(o,i,"pattern",a)}/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const Ra={loader:"loader",clearButton:"clear-button",editingEnabled:"editing-enabled",inlineChild:"inline-child",inputIcon:"icon",prefix:"prefix",suffix:"suffix",numberButtonWrapper:"number-button-wrapper",buttonItemHorizontal:"number-button-item--horizontal",wrapper:"element-wrapper",inputWrapper:"wrapper",actionWrapper:"action-wrapper",numberButtonItem:"number-button-item",hasSuffix:"has-suffix",hasPrefix:"has-prefix"},C9={validationMessage:"inputValidationMessage"},Jbe={tel:"phone",password:"lock",email:"email-address",date:"calendar",time:"clock",search:"search"},eUt={action:"action"},tUt=Js`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:block}:host([scale=s]) input,:host([scale=s]) .prefix,:host([scale=s]) .suffix{block-size:1.5rem;padding-inline:.5rem;font-size:var(--calcite-font-size--2);line-height:1rem}:host([scale=s]) input[type=file],:host([scale=s]) textarea{min-block-size:1.5rem}:host([scale=s]) .number-button-wrapper,:host([scale=s]) .action-wrapper calcite-button,:host([scale=s]) .action-wrapper calcite-button button{block-size:1.5rem}:host([scale=s]) .clear-button{min-block-size:1.5rem;min-inline-size:1.5rem}:host([scale=s]) textarea{block-size:auto;padding-block:.25rem;padding-inline:.5rem;font-size:var(--calcite-font-size--2);line-height:1rem}:host([scale=m]) input,:host([scale=m]) .prefix,:host([scale=m]) .suffix{block-size:2rem;padding-inline:.75rem;font-size:var(--calcite-font-size--1);line-height:1rem}:host([scale=m]) textarea,:host([scale=m]) input[type=file]{min-block-size:2rem}:host([scale=m]) .number-button-wrapper,:host([scale=m]) .action-wrapper calcite-button,:host([scale=m]) .action-wrapper calcite-button button{block-size:2rem}:host([scale=m]) .clear-button{min-block-size:2rem;min-inline-size:2rem}:host([scale=m]) textarea{block-size:auto;padding-block:.5rem;padding-inline:.75rem;font-size:var(--calcite-font-size--1);line-height:1rem}:host([scale=l]) input,:host([scale=l]) .prefix,:host([scale=l]) .suffix{block-size:2.75rem;padding-inline:1rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=l]) textarea,:host([scale=l]) input[type=file]{min-block-size:2.75rem}:host([scale=l]) .number-button-wrapper,:host([scale=l]) .action-wrapper calcite-button,:host([scale=l]) .action-wrapper calcite-button button{block-size:2.75rem}:host([scale=l]) .clear-button{min-block-size:2.75rem;min-inline-size:2.75rem}:host([scale=l]) textarea{block-size:auto;padding-block:.75rem;padding-inline:1rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([disabled]) textarea{resize:none}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}textarea,input{position:relative;margin:0;box-sizing:border-box;display:flex;max-block-size:100%;inline-size:100%;max-inline-size:100%;flex:1 1 0%;text-overflow:ellipsis;border-width:1px;border-style:solid;font-family:inherit;font-weight:var(--calcite-font-weight-normal);border-color:var(--calcite-input-border-color, var(--calcite-color-border-input));background-color:var(--calcite-input-background-color, var(--calcite-color-foreground-1));color:var(--calcite-input-text-color, var(--calcite-color-text-1));transition:var(--calcite-animation-timing),block-size 0,outline-offset 0s;-webkit-appearance:none}textarea:placeholder-shown,input:placeholder-shown{text-overflow:ellipsis}textarea{border-radius:var(--calcite-input-corner-radius, var(--calcite-corner-radius-sharp))}input{border-start-start-radius:var(--calcite-input-corner-radius, var(--calcite-corner-radius-sharp));border-start-end-radius:var(--calcite-input-corner-radius, var(--calcite-corner-radius-sharp));border-end-start-radius:var(--calcite-input-corner-radius, var(--calcite-corner-radius-sharp));border-end-end-radius:var(--calcite-input-corner-radius, var(--calcite-corner-radius-sharp))}.has-prefix input{border-start-start-radius:0;border-end-start-radius:0}.has-suffix input,.element-wrapper:has(.clear-button) input,:host([number-button-type=vertical][type=number]) input,:host([number-button-type=horizontal]) .has-suffix .suffix,:host([number-button-type=vertical][type=number]) .has-suffix .suffix,:host([number-button-type=vertical][type=number]) .clear-button,:host([number-button-type=horizontal][type=number]) .clear-button{border-start-end-radius:0;border-end-end-radius:0}:host([number-button-type=horizontal]) input{border-start-start-radius:0;border-start-end-radius:0;border-end-start-radius:0;border-end-end-radius:0}.has-prefix .prefix:first-child,:host([number-button-type=horizontal]) .number-button-item[data-adjustment=down]{border-start-start-radius:var(--calcite-input-corner-radius, var(--calcite-corner-radius-sharp));border-end-start-radius:var(--calcite-input-corner-radius, var(--calcite-corner-radius-sharp))}.has-suffix .suffix,:host([number-button-type=vertical][type=number][read-only]) .has-suffix .suffix,:host([clearable]) .clear-button,:host([number-button-type=horizontal]) .number-button-item[data-adjustment=up]{border-end-end-radius:var(--calcite-input-corner-radius, var(--calcite-corner-radius-sharp));border-start-end-radius:var(--calcite-input-corner-radius, var(--calcite-corner-radius-sharp))}:host([clearable]) .has-suffix .clear-button{border-end-end-radius:0;border-start-end-radius:0}:host([number-button-type=vertical]) .number-button-item[data-adjustment=down]{border-block-start-width:0px;border-end-end-radius:var(--calcite-input-corner-radius, var(--calcite-corner-radius-sharp))}:host([number-button-type=vertical]) .number-button-item[data-adjustment=up]{border-start-end-radius:var(--calcite-input-corner-radius, var(--calcite-corner-radius-sharp))}input[type=search]::-webkit-search-decoration{-webkit-appearance:none}input:focus,textarea:focus{border-color:var(--calcite-color-brand);color:var(--calcite-input-text-color, var(--calcite-color-text-1))}input[readonly],textarea[readonly]{font-weight:var(--calcite-font-weight-medium);background-color:var(--calcite-input-background-color, var(--calcite-color-background))}input[readonly]:focus,textarea[readonly]:focus{color:var(--calcite-input-text-color, var(--calcite-color-text-1))}textarea,input{outline-color:transparent}textarea:focus,input:focus{outline:2px solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline-offset:calc(-2px*(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}:host([status=invalid]) input,:host([status=invalid]) textarea{border-color:var(--calcite-color-status-danger)}:host([status=invalid]) input:focus,:host([status=invalid]) textarea:focus{outline:2px solid var(--calcite-color-status-danger);outline-offset:calc(-2px*(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}:host([scale=s]) .icon{inset-inline-start:.5rem}:host([scale=m]) .icon{inset-inline-start:.75rem}:host([scale=l]) .icon{inset-inline-start:1rem}:host([icon][scale=s]) input{padding-inline-start:2rem}:host([icon][scale=m]) input{padding-inline-start:2.5rem}:host([icon][scale=l]) input{padding-inline-start:3.5rem}.element-wrapper{position:relative;order:3;display:inline-flex;flex:1 1 0%;align-items:center}.icon{pointer-events:none;position:absolute;display:block;transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out;color:var(--calcite-input-icon-color, var(--calcite-color-text-3));z-index:var(--calcite-z-index)}input[type=text]::-ms-clear,input[type=text]::-ms-reveal{display:none;block-size:0px;inline-size:0px}input[type=search]::-webkit-search-decoration,input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-results-button,input[type=search]::-webkit-search-results-decoration,input[type=date]::-webkit-clear-button,input[type=time]::-webkit-clear-button{display:none}.clear-button{pointer-events:initial;order:4;margin:0;box-sizing:border-box;display:flex;min-block-size:100%;cursor:pointer;align-items:center;justify-content:center;align-self:stretch;border-width:1px;border-style:solid;outline-color:transparent;transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out;border-color:var(--calcite-input-border-color, var(--calcite-color-border-input));background-color:var(--calcite-input-actions-background-color, var(--calcite-color-foreground-1));border-inline-start-width:0px}.clear-button calcite-icon{transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out;color:var(--calcite-input-actions-icon-color, var(--calcite-color-text-3))}.clear-button:hover{background-color:var(--calcite-input-actions-background-color-hover, var(--calcite-color-foreground-2))}.clear-button:hover calcite-icon{color:var(--calcite-input-actions-icon-color-hover, var(--calcite-color-text-1))}.clear-button:active{background-color:var(--calcite-input-actions-background-color-press, var(--calcite-color-foreground-3))}.clear-button:active calcite-icon{color:var(--calcite-input-actions-icon-color-press, var(--calcite-color-text-1))}.clear-button:focus{outline:2px solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline-offset:calc(-2px*(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}.clear-button:disabled{opacity:var(--calcite-opacity-disabled)}.loader{inset-block-start:1px;inset-inline:1px;pointer-events:none;position:absolute;display:block;--calcite-progress-background-color: var(--calcite-input-loading-background-color);--calcite-progress-fill-color: var(--calcite-input-loading-fill-color)}.action-wrapper{order:7;display:flex}.prefix,.suffix{box-sizing:border-box;display:flex;block-size:auto;min-block-size:100%;-webkit-user-select:none;user-select:none;align-content:center;align-items:center;overflow-wrap:break-word;border-width:1px;border-style:solid;font-weight:var(--calcite-font-weight-medium);line-height:1;border-color:var(--calcite-input-border-color, var(--calcite-color-border-input))}.prefix{order:2;border-inline-end-width:0px;inline-size:var(--calcite-input-prefix-size, auto);background-color:var(--calcite-input-prefix-background-color, var(--calcite-color-background));color:var(--calcite-input-prefix-text-color, var(--calcite-color-text-2))}.suffix{order:5;border-inline-start-width:0px;inline-size:var(--calcite-input-suffix-size, auto);background-color:var(--calcite-input-suffix-background-color, var(--calcite-color-background));color:var(--calcite-input-suffix-text-color, var(--calcite-color-text-2))}:host([alignment=start]) textarea,:host([alignment=start]) input{text-align:start}:host([alignment=end]) textarea,:host([alignment=end]) input{text-align:end}input[type=number]{-moz-appearance:textfield}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{-webkit-appearance:none;-moz-appearance:textfield;margin:0}.number-button-wrapper{pointer-events:none;order:6;box-sizing:border-box;display:flex;flex-direction:column;transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out}:host([number-button-type=vertical]) .wrapper{flex-direction:row;display:flex}:host([number-button-type=vertical]) input,:host([number-button-type=vertical]) textarea{order:2}:host([number-button-type=horizontal]) .calcite--rtl .number-button-item[data-adjustment=down] calcite-icon{transform:rotate(-90deg)}:host([number-button-type=horizontal]) .calcite--rtl .number-button-item[data-adjustment=up] calcite-icon{transform:rotate(-90deg)}.number-button-item.number-button-item--horizontal{border-color:var(--calcite-input-border-color, var(--calcite-color-border-input));order:1;max-block-size:100%;min-block-size:100%;align-self:stretch;border-width:1px;border-style:solid}.number-button-item.number-button-item--horizontal[data-adjustment=down] calcite-icon,.number-button-item.number-button-item--horizontal[data-adjustment=up] calcite-icon{transform:rotate(90deg)}.number-button-item.number-button-item--horizontal[data-adjustment=down]{border-inline-end-width:0px}.number-button-item.number-button-item--horizontal[data-adjustment=up]{border-inline-start-width:0px;order:5}.number-button-item{max-block-size:50%;min-block-size:50%;pointer-events:initial;margin:0;box-sizing:border-box;display:flex;cursor:pointer;align-items:center;align-self:center;border-width:1px;border-style:solid;background-color:var(--calcite-color-foreground-1);padding-block:0px;padding-inline:.5rem;transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out;border-color:var(--calcite-input-border-color, var(--calcite-color-border-input));background-color:var(--calcite-input-actions-background-color, var(--calcite-color-foreground-1));border-inline-start-width:0px}.number-button-item calcite-icon{pointer-events:none;transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out;color:var(--calcite-input-actions-icon-color, var(--calcite-color-text-3))}.number-button-item:hover{background-color:var(--calcite-input-actions-background-color-hover, var(--calcite-color-foreground-2))}.number-button-item:hover calcite-icon{color:var(--calcite-input-actions-icon-color-hover, var(--calcite-color-text-1))}.number-button-item:active{background-color:var(--calcite-input-actions-background-color-press, var(--calcite-color-foreground-3))}.number-button-item:active calcite-icon{color:var(--calcite-input-actions-icon-color-press, var(--calcite-color-text-1))}.number-button-item:disabled{pointer-events:none}.wrapper{position:relative;display:flex;flex-direction:row;align-items:center;border-radius:var(--calcite-input-corner-radius, var(--calcite-corner-radius-sharp));box-shadow:var(--calcite-input-shadow, var(--calcite-shadow-none))}input[type=date]::-webkit-input-placeholder{visibility:hidden!important}:host([type=color]) input{padding:.25rem}:host([type=file]) input{cursor:pointer;border-width:1px;border-style:dashed;background-color:var(--calcite-color-foreground-1);text-align:center;border-color:var(--calcite-input-border-color, var(--calcite-color-border-input));block-size:initial}:host([type=file][scale=s]) input{padding-block:1px;padding-inline:.5rem}:host([type=file][scale=m]) input{padding-block:.25rem;padding-inline:.75rem}:host([type=file][scale=l]) input{padding-block:.5rem;padding-inline:1rem}:host(.no-bottom-border) input{border-block-end-width:0px}:host(.border-top-color-one) input{border-block-start-color:var(--calcite-color-border-1)}input.inline-child{background-color:transparent;transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out}input.inline-child .editing-enabled{background-color:inherit}input.inline-child:not(.editing-enabled){display:flex;cursor:pointer;text-overflow:ellipsis;border-color:transparent;padding-inline-start:0}.validation-container{display:flex;flex-direction:column;align-items:flex-start;align-self:stretch}:host([scale=m]) .validation-container,:host([scale=l]) .validation-container{padding-block-start:.5rem}:host([scale=s]) .validation-container{padding-block-start:.25rem}::slotted(input[slot=hidden-form-input]){margin:0!important;opacity:0!important;outline:none!important;padding:0!important;position:absolute!important;inset:0!important;transform:none!important;-webkit-appearance:none!important;z-index:-1!important}:host([hidden]){display:none}[hidden]{display:none}::placeholder{font-weight:var(--calcite-font-weight-normal);color:var(--calcite-input-placeholder-text-color, var(--calcite-color-text-3))}`;class Lze extends Vn{constructor(){super(),this.actionWrapperEl=Gc(),this.attributeWatch=tze(["autofocus","enterkeyhint","inputmode","spellcheck"],this.handleGlobalAttributesChanged),this.childElType="input",this.inputWrapperEl=Gc(),this.onHiddenFormInputInput=e=>{e.target.name===this.name&&this.setValue({value:e.target.value,origin:"direct"}),this.setFocus(),e.stopPropagation()},this.previousValueOrigin="initial",this.userChangedValue=!1,this._value="",this.messages=Fd(),this.slottedActionElDisabledInternally=!1,this.alignment="start",this.clearable=!1,this.disabled=!1,this.editingEnabled=!1,this.groupSeparator=!1,this.iconFlipRtl=!1,this.loading=!1,this.localeFormat=!1,this.multiple=!1,this.numberButtonType="vertical",this.readOnly=!1,this.required=!1,this.scale="m",this.status="idle",this.type="text",this.validity={valid:!1,badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1},this.calciteInputChange=Ut({cancelable:!1}),this.calciteInputInput=Ut(),this.calciteInternalInputBlur=Ut({cancelable:!1}),this.calciteInternalInputFocus=Ut({cancelable:!1}),this.listen("click",this.clickHandler),this.listen("keydown",this.keyDownHandler)}static{this.properties={displayedValue:[16,{},{state:!0}],slottedActionElDisabledInternally:[16,{},{state:!0}],accept:1,alignment:[3,{},{reflect:!0}],autocomplete:[0,{},{attribute:!1}],clearable:[7,{},{reflect:!0,type:Boolean}],disabled:[7,{},{reflect:!0,type:Boolean}],editingEnabled:[7,{},{reflect:!0,type:Boolean}],files:[0,{},{attribute:!1}],form:[3,{},{reflect:!0}],groupSeparator:[7,{},{reflect:!0,type:Boolean}],icon:[3,{converter:ZP},{reflect:!0}],iconFlipRtl:[7,{},{reflect:!0,type:Boolean}],label:1,loading:[7,{},{reflect:!0,type:Boolean}],localeFormat:[5,{},{type:Boolean}],max:[11,{},{reflect:!0,type:Number}],maxLength:[11,{},{reflect:!0,type:Number}],messageOverrides:[0,{},{attribute:!1}],min:[11,{},{reflect:!0,type:Number}],minLength:[11,{},{reflect:!0,type:Number}],multiple:[5,{},{type:Boolean}],name:[3,{},{reflect:!0}],numberButtonType:[3,{},{reflect:!0}],numberingSystem:[3,{},{reflect:!0}],pattern:1,placeholder:1,prefixText:1,readOnly:[7,{},{reflect:!0,type:Boolean}],required:[7,{},{reflect:!0,type:Boolean}],scale:[3,{},{reflect:!0}],status:[3,{},{reflect:!0}],step:[3,{},{reflect:!0}],suffixText:1,type:[3,{},{reflect:!0}],validationIcon:[3,{converter:ZP},{reflect:!0}],validationMessage:1,validity:[0,{},{attribute:!1}],value:1}}static{this.styles=tUt}get value(){return this._value}set value(e){const i=this._value;e!==i&&(this._value=e,this.valueWatcher(e,i),e&&this._value===""&&this.setValue({origin:"reset",value:i}))}async selectText(){this.type==="number"?this.childNumberEl?.select():this.childEl?.select()}async setFocus(){await dh(this),VG(this.type==="number"?this.childNumberEl:this.childEl)}connectedCallback(){super.connectedCallback(),this.inlineEditableEl=this.el.closest("calcite-inline-editable"),this.inlineEditableEl&&(this.editingEnabled=this.inlineEditableEl.editingEnabled||!1),GG(this),uzt(this),this.el.addEventListener(KQ,this.onHiddenFormInputInput)}async load(){this.childElType=this.type==="textarea"?"textarea":"input",this.maxString=this.max?.toString(),this.minString=this.min?.toString(),this.requestedIcon=rA(Jbe,this.icon,this.type),this.setPreviousEmittedValue(this.value),this.setPreviousValue(this.value),this.type==="number"&&(this.value==="Infinity"||this.value==="-Infinity"?(this.displayedValue=this.value,this.previousEmittedValue=this.value):(this.warnAboutInvalidNumberValue(this.value),this.setValue({origin:"connected",value:Ly(this.value)?this.value:""})))}willUpdate(e){e.has("max")&&(this.maxString=this.max?.toString()||null),e.has("min")&&(this.minString=this.min?.toString()||null),(e.has("icon")||e.has("type")&&(this.hasUpdated||this.type!=="text"))&&(this.requestedIcon=rA(Jbe,this.icon,this.type))}updated(){yg(this)}disconnectedCallback(){super.disconnectedCallback(),Aze(this),dzt(this),this.el.removeEventListener(KQ,this.onHiddenFormInputInput)}get isClearable(){return!this.isTextarea&&(this.clearable||this.type==="search")&&this.value?.length>0}get isTextarea(){return this.childElType==="textarea"}handleGlobalAttributesChanged(){this.requestUpdate()}valueWatcher(e,i){if(!this.userChangedValue){if(this.type==="number"&&(e==="Infinity"||e==="-Infinity")){this.displayedValue=e,this.previousEmittedValue=e;return}this.setValue({origin:"direct",previousValue:i,value:e==null||e==""?"":this.type==="number"?Ly(e)?e:this.previousValue||"":e}),this.warnAboutInvalidNumberValue(e)}this.userChangedValue=!1}keyDownHandler(e){this.readOnly||this.disabled||e.defaultPrevented||(this.isClearable&&e.key==="Escape"&&(this.clearInputValue(e),e.preventDefault()),e.key==="Enter"&&wze(this)&&e.preventDefault())}onLabelClick(){this.setFocus()}incrementOrDecrementNumberValue(e,i,r,s){const{value:n}=this;if(n==="Infinity"||n==="-Infinity")return;const o=e==="up"?1:-1,a=this.step==="any"?1:Math.abs(this.step||1),c=new Cs(n!==""?n:"0").add(`${a*o}`),h=()=>typeof r=="number"&&!isNaN(r)&&c.subtract(`${r}`).isNegative,d=()=>typeof i=="number"&&!isNaN(i)&&!c.subtract(`${i}`).isNegative,f=h()?`${r}`:d()?`${i}`:c.toString();this.setValue({committing:!0,nativeEvent:s,origin:"user",value:f})}clearInputValue(e){this.setValue({committing:!0,nativeEvent:e,origin:"user",value:""})}emitChangeIfUserModified(){this.previousValueOrigin==="user"&&this.value!==this.previousEmittedValue&&(this.calciteInputChange.emit(),this.setPreviousEmittedValue(this.value))}inputBlurHandler(){window.clearInterval(this.nudgeNumberValueIntervalId),this.calciteInternalInputBlur.emit(),this.emitChangeIfUserModified()}clickHandler(e){if(this.disabled)return;const i=e.composedPath();!i.includes(this.inputWrapperEl.value)||i.includes(this.actionWrapperEl.value)||this.setFocus()}inputFocusHandler(){this.calciteInternalInputFocus.emit()}inputInputHandler(e){this.disabled||this.readOnly||(this.type==="file"&&(this.files=this.childEl.files),this.setValue({nativeEvent:e,origin:"user",value:e.target.value}))}inputKeyDownHandler(e){this.disabled||this.readOnly||e.key==="Enter"&&this.emitChangeIfUserModified()}inputNumberInputHandler(e){if(this.disabled||this.readOnly||this.value==="Infinity"||this.value==="-Infinity")return;const i=e.target.value;Fh.numberFormatOptions={locale:this.messages._lang,numberingSystem:this.numberingSystem,useGrouping:this.groupSeparator};const r=Fh.delocalize(i);e.inputType==="insertFromPaste"?(Ly(r)||e.preventDefault(),this.setValue({nativeEvent:e,origin:"user",value:Izt(r)}),this.childNumberEl.value=this.displayedValue):this.setValue({nativeEvent:e,origin:"user",value:r})}inputNumberKeyDownHandler(e){if(this.type!=="number"||this.disabled||this.readOnly)return;if(this.value==="Infinity"||this.value==="-Infinity"){e.preventDefault(),(e.key==="Backspace"||e.key==="Delete")&&this.clearInputValue(e);return}if(e.key==="ArrowUp"){e.preventDefault(),this.nudgeNumberValue("up",e);return}if(e.key==="ArrowDown"){this.nudgeNumberValue("down",e);return}const i=[...HG,"ArrowLeft","ArrowRight","Backspace","Delete","Enter","Escape","Tab"];if(e.altKey||e.ctrlKey||e.metaKey)return;const r=e.shiftKey&&e.key==="Tab";if(i.includes(e.key)||r){e.key==="Enter"&&this.emitChangeIfUserModified();return}Fh.numberFormatOptions={locale:this.messages._lang,numberingSystem:this.numberingSystem,useGrouping:this.groupSeparator},!(e.key===Fh.decimal&&(!this.value&&!this.childNumberEl.value||this.value&&this.childNumberEl.value.indexOf(Fh.decimal)===-1))&&(/[eE]/.test(e.key)&&(!this.value&&!this.childNumberEl.value||this.value&&!/[eE]/.test(this.childNumberEl.value))||e.key==="-"&&(!this.value&&!this.childNumberEl.value||this.value&&this.childNumberEl.value.split("-").length<=2)||e.preventDefault())}nudgeNumberValue(e,i){if(i instanceof KeyboardEvent&&i.repeat||this.type!=="number")return;const r=this.maxString?parseFloat(this.maxString):null,s=this.minString?parseFloat(this.minString):null,n=150;this.incrementOrDecrementNumberValue(e,r,s,i),this.nudgeNumberValueIntervalId&&window.clearInterval(this.nudgeNumberValueIntervalId);let o=!0;this.nudgeNumberValueIntervalId=window.setInterval(()=>{if(o){o=!1;return}this.incrementOrDecrementNumberValue(e,r,s,i)},n)}numberButtonPointerUpAndOutHandler(){window.clearInterval(this.nudgeNumberValueIntervalId)}numberButtonPointerDownHandler(e){if(!F5t(e))return;e.preventDefault();const i=e.target.dataset.adjustment;this.disabled||this.nudgeNumberValue(i,e)}syncHiddenFormInput(e){Qzt(this.type,this,e)}setChildElRef(e){this.childEl=e}setChildNumberElRef(e){this.childNumberEl=e}setInputValue(e){this.type==="number"&&this.childNumberEl?this.childNumberEl.value=e:this.childEl&&(this.childEl.value=e)}setPreviousEmittedValue(e){this.previousEmittedValue=this.normalizeValue(e)}normalizeValue(e){return this.type==="number"?Ly(e)?e:"":e}setPreviousValue(e){this.previousValue=this.normalizeValue(e)}setValue({committing:e=!1,nativeEvent:i,origin:r,previousValue:s,value:n}){if(this.setPreviousValue(s??this.value),this.previousValueOrigin=r,this.type==="number"){Fh.numberFormatOptions={locale:this.messages._lang,numberingSystem:this.numberingSystem,useGrouping:this.groupSeparator,signDisplay:"never"};const o=this.previousValue?.length>n.length||this.value?.length>n.length,a=n.charAt(n.length-1)===".",l=a&&o?n:Fzt(n),c=n&&!l?Ly(this.previousValue)?this.previousValue:"":l;let h=Fh.localize(c);r!=="connected"&&!a&&(h=Bzt(h,c,Fh)),this.displayedValue=a&&o?`${h}${Fh.decimal}`:h,this.userChangedValue=r==="user"&&this.value!==c,this.value=["-","."].includes(c)?"":c}else this.userChangedValue=r==="user"&&this.value!==n,this.value=n;r==="direct"&&(this.setInputValue(n),this.previousEmittedValue=n),i&&(this.calciteInputInput.emit().defaultPrevented?(this.value=this.previousValue,this.displayedValue=this.type==="number"?Fh.localize(this.previousValue):this.previousValue):e&&this.emitChangeIfUserModified())}inputKeyUpHandler(){window.clearInterval(this.nudgeNumberValueIntervalId)}warnAboutInvalidNumberValue(e){this.type==="number"&&e&&!Ly(e)&&console.warn(`The specified value "${e}" cannot be parsed, or is out of range.`)}render(){const e=oL(this.el),i=le`<div class=${fe(Ra.loader)}><calcite-progress .label=${this.messages.loading} type=indeterminate></calcite-progress></div>`,r=le`<button .ariaLabel=${this.messages.clear} class=${fe(Ra.clearButton)} .disabled=${this.disabled||this.readOnly} @click=${this.clearInputValue} tabindex=-1 type=button><calcite-icon icon=x .scale=${Wa(this.scale)}></calcite-icon></button>`,s=le`<calcite-icon class=${fe(Ra.inputIcon)} .flipRtl=${this.iconFlipRtl} .icon=${this.requestedIcon} .scale=${Wa(this.scale)}></calcite-icon>`,n=this.numberButtonType==="horizontal",o=le`<button aria-hidden=true class=${fe({[Ra.numberButtonItem]:!0,[Ra.buttonItemHorizontal]:n})} data-adjustment=up .disabled=${this.disabled||this.readOnly} @pointerdown=${this.numberButtonPointerDownHandler} @pointerout=${this.numberButtonPointerUpAndOutHandler} @pointerup=${this.numberButtonPointerUpAndOutHandler} tabindex=-1 type=button><calcite-icon icon=chevron-up .scale=${Wa(this.scale)}></calcite-icon></button>`,a=le`<button aria-hidden=true class=${fe({[Ra.numberButtonItem]:!0,[Ra.buttonItemHorizontal]:n})} data-adjustment=down .disabled=${this.disabled||this.readOnly} @pointerdown=${this.numberButtonPointerDownHandler} @pointerout=${this.numberButtonPointerUpAndOutHandler} @pointerup=${this.numberButtonPointerUpAndOutHandler} tabindex=-1 type=button><calcite-icon icon=chevron-down .scale=${Wa(this.scale)}></calcite-icon></button>`,l=le`<div class=${fe(Ra.numberButtonWrapper)}>${o}${a}</div>`,c=le`<div class=${fe(Ra.prefix)}>${this.prefixText}</div>`,h=le`<div class=${fe(Ra.suffix)}>${this.suffixText}</div>`,d=this.el.autofocus,f=this.el.enterKeyHint,m=this.el.inputMode,y=this.type==="number"?Zi("localized-input",le`<input accept=${this.accept??Ze} aria-errormessage=${C9.validationMessage} .ariaInvalid=${this.status==="invalid"} .ariaLabel=${eee(this)} autocomplete=${this.autocomplete??Ze} .autofocus=${d} value=${this.defaultValue??Ze} .disabled=${this.disabled?!0:null} enterkeyhint=${f??Ze} inputmode=${m??Ze} maxlength=${this.maxLength??Ze} minlength=${this.minLength??Ze} .multiple=${this.multiple} name=${Ze} @blur=${this.inputBlurHandler} @focus=${this.inputFocusHandler} @input=${this.inputNumberInputHandler} @keydown=${this.inputNumberKeyDownHandler} @keyup=${this.inputKeyUpHandler} pattern=${this.pattern??Ze} placeholder=${(this.placeholder||"")??Ze} .readOnly=${this.readOnly} type=text .value=${Khe(this.displayedValue??"")} ${wr(this.setChildNumberElRef)}>`):null,v=this.childElType==="input"?D3`input`:D3`textarea`,_=this.type!=="number"?sae`<${v} accept=${this.accept??Ze} aria-errormessage=${C9.validationMessage} .ariaInvalid=${this.status==="invalid"} .ariaLabel=${eee(this)} autocomplete=${this.autocomplete??Ze} .autofocus=${d} class=${fe({[Ra.editingEnabled]:this.editingEnabled,[Ra.inlineChild]:!!this.inlineEditableEl})} .defaultValue=${this.defaultValue??""} .disabled=${this.disabled?!0:null} enterkeyhint=${f??Ze} inputmode=${m??Ze} max=${this.maxString??Ze} maxlength=${this.maxLength??Ze} min=${this.minString??Ze} minlength=${this.minLength??Ze} .multiple=${this.multiple} name=${this.name??Ze} @blur=${this.inputBlurHandler} @focus=${this.inputFocusHandler} @input=${this.inputInputHandler} @keydown=${this.inputKeyDownHandler} @keyup=${this.inputKeyUpHandler} pattern=${this.pattern??Ze} placeholder=${(this.placeholder||"")??Ze} .readOnly=${this.readOnly} .required=${this.required?!0:null} spellcheck=${this.el.spellcheck??Ze} step=${this.step??Ze} tabindex=${(this.disabled||this.inlineEditableEl&&!this.editingEnabled?-1:null)??Ze} type=${this.type??Ze} .value=${Khe(this.value??"")} ${wr(this.setChildElRef)}></${v}>`:null;return vg({disabled:this.disabled,children:le`<div class=${fe({[Ra.inputWrapper]:!0,[IR.rtl]:e==="rtl",[Ra.hasSuffix]:this.suffixText,[Ra.hasPrefix]:this.prefixText})} ${wr(this.inputWrapperEl)}>${this.type==="number"&&this.numberButtonType==="horizontal"&&!this.readOnly?a:null}${this.prefixText?c:null}<div class=${fe(Ra.wrapper)}>${y}${_}${this.isClearable?r:null}${this.requestedIcon?s:null}${this.loading?i:null}</div><div class=${fe(Ra.actionWrapper)} ${wr(this.actionWrapperEl)}><slot name=${eUt.action}></slot></div>${this.type==="number"&&this.numberButtonType==="vertical"&&!this.readOnly?l:null}${this.suffixText?h:null}${this.type==="number"&&this.numberButtonType==="horizontal"&&!this.readOnly?o:null}${fzt({component:this})}</div>${this.validationMessage&&this.status==="invalid"?Yzt({icon:this.validationIcon,id:C9.validationMessage,message:this.validationMessage,scale:this.scale,status:this.status}):null}`})}}Oo("calcite-input",Lze);const Lfi=Object.freeze(Object.defineProperty({__proto__:null,Input:Lze},Symbol.toStringTag,{value:"Module"}));/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const Xbe={scrim:"scrim",content:"content"},Kbe={s:72,l:480},iUt=Js`:host{position:absolute;inset:0;z-index:var(--calcite-z-index-overlay);display:flex;block-size:100%;inline-size:100%;flex-direction:column;align-items:stretch}@keyframes calcite-scrim-fade-in{0%{--tw-bg-opacity: 0 }to{--tw-text-opacity: 1 }}.scrim{position:absolute;inset:0;display:flex;flex-direction:column;align-content:center;align-items:center;justify-content:center;overflow:hidden;animation:calcite-scrim-fade-in var(--calcite-internal-animation-timing-medium) ease-in-out;background-color:var(--calcite-scrim-background, var(--calcite-color-transparent-scrim))}.content{padding:1rem}:host([hidden]){display:none}[hidden]{display:none}`;class Nze extends Vn{constructor(){super(...arguments),this.resizeObserver=vf("resize",()=>this.handleResize()),this.messages=Fd(),this.hasContent=!1,this.loading=!1}static{this.properties={hasContent:[16,{},{state:!0}],loaderScale:[16,{},{state:!0}],loading:[7,{},{reflect:!0,type:Boolean}],messageOverrides:[0,{},{attribute:!1}]}}static{this.styles=iUt}connectedCallback(){super.connectedCallback(),this.resizeObserver?.observe(this.el)}disconnectedCallback(){super.disconnectedCallback(),this.resizeObserver?.disconnect()}handleDefaultSlotChange(e){this.hasContent=I5t(e)}storeLoaderEl(e){this.loaderEl=e,this.handleResize()}getScale(e){return e<Kbe.s?"s":e>=Kbe.l?"l":"m"}handleResize(){const{loaderEl:e,el:i}=this;e&&(this.loaderScale=this.getScale(Math.min(i.clientHeight,i.clientWidth)??0))}render(){const{hasContent:e,loading:i,messages:r}=this;return le`<div class=${fe(Xbe.scrim)}>${i?le`<calcite-loader .label=${r.loading} .scale=${this.loaderScale} ${wr(this.storeLoaderEl)}></calcite-loader>`:null}<div class=${fe(Xbe.content)} .hidden=${!e}><slot @slotchange=${this.handleDefaultSlotChange}></slot></div></div>`}}Oo("calcite-scrim",Nze);const rUt=Object.freeze(Object.defineProperty({__proto__:null,Scrim:Nze},Symbol.toStringTag,{value:"Module"}));/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const oE={container:"container",actionsStart:"actions-start",contentStart:"content-start",content:"content",contentEnd:"content-end",actionsEnd:"actions-end"},fC={actionsStart:"actions-start",contentStart:"content-start",contentEnd:"content-end",actionsEnd:"actions-end"};/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const sUt=Js`:host([disabled]) .content{cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) .content *,:host([disabled]) .content ::slotted(*){pointer-events:none}:host{display:flex;flex:1 1 0%;flex-direction:column}.container{display:flex;flex:1 1 auto;align-items:stretch;font-weight:var(--calcite-font-weight-normal);color:var(--calcite-color-text-2)}.content{display:flex;flex:1 1 auto;flex-direction:column;justify-content:center;font-size:var(--calcite-font-size--2);line-height:1.375;padding-inline:var(--calcite-stack-padding-inline, .75rem);padding-block:var(--calcite-stack-padding-block, .5rem)}.content-start{justify-content:flex-start}.content-end{justify-content:flex-end}.content-start,.content-end{flex:0 1 auto}.content-start ::slotted(calcite-icon),.content-end ::slotted(calcite-icon){margin-inline:.75rem;align-self:center}.actions-start,.actions-end,.content-start,.content-end{display:flex;align-items:center}.actions-start ::slotted(calcite-action),.actions-start ::slotted(calcite-action-menu),.actions-start ::slotted(calcite-handle),.actions-start ::slotted(calcite-dropdown),.actions-end ::slotted(calcite-action),.actions-end ::slotted(calcite-action-menu),.actions-end ::slotted(calcite-handle),.actions-end ::slotted(calcite-dropdown){align-self:stretch;color:inherit}:host([hidden]){display:none}[hidden]{display:none}`;class nUt extends Vn{constructor(){super(...arguments),this.hasActionsEnd=!1,this.hasActionsStart=!1,this.hasContentEnd=!1,this.hasContentStart=!1,this.disabled=!1}static{this.properties={hasActionsEnd:[16,{},{state:!0}],hasActionsStart:[16,{},{state:!0}],hasContentEnd:[16,{},{state:!0}],hasContentStart:[16,{},{state:!0}],disabled:[7,{},{reflect:!0,type:Boolean}]}}static{this.styles=sUt}handleActionsStartSlotChange(e){this.hasActionsStart=$s(e)}handleActionsEndSlotChange(e){this.hasActionsEnd=$s(e)}handleContentStartSlotChange(e){this.hasContentStart=$s(e)}handleContentEndSlotChange(e){this.hasContentEnd=$s(e)}renderActionsStart(){const{hasActionsStart:e}=this;return Zi("actions-start-container",le`<div class=${fe(oE.actionsStart)} .hidden=${!e}><slot name=${fC.actionsStart} @slotchange=${this.handleActionsStartSlotChange}></slot></div>`)}renderActionsEnd(){const{hasActionsEnd:e}=this;return Zi("actions-end-container",le`<div class=${fe(oE.actionsEnd)} .hidden=${!e}><slot name=${fC.actionsEnd} @slotchange=${this.handleActionsEndSlotChange}></slot></div>`)}renderContentStart(){const{hasContentStart:e}=this;return le`<div class=${fe(oE.contentStart)} .hidden=${!e}><slot name=${fC.contentStart} @slotchange=${this.handleContentStartSlotChange}></slot></div>`}renderDefaultContent(){return le`<div class=${fe(oE.content)}><slot></slot></div>`}renderContentEnd(){const{hasContentEnd:e}=this;return le`<div class=${fe(oE.contentEnd)} .hidden=${!e}><slot name=${fC.contentEnd} @slotchange=${this.handleContentEndSlotChange}></slot></div>`}render(){return le`<div class=${fe(oE.container)}>${this.renderActionsStart()}${this.renderContentStart()}${this.renderDefaultContent()}${this.renderContentEnd()}${this.renderActionsEnd()}</div>`}}Oo("calcite-stack",nUt);var Fze=typeof global=="object"&&global&&global.Object===Object&&global,oUt=typeof self=="object"&&self&&self.Object===Object&&self,uae=Fze||oUt||Function("return this")(),nA=uae.Symbol,kze=Object.prototype,aUt=kze.hasOwnProperty,lUt=kze.toString,nO=nA?nA.toStringTag:void 0;function cUt(t){var e=aUt.call(t,nO),i=t[nO];try{t[nO]=void 0;var r=!0}catch{}var s=lUt.call(t);return r&&(e?t[nO]=i:delete t[nO]),s}var uUt=Object.prototype,hUt=uUt.toString;function dUt(t){return hUt.call(t)}var pUt="[object Null]",fUt="[object Undefined]",Qbe=nA?nA.toStringTag:void 0;function qG(t){return t==null?t===void 0?fUt:pUt:Qbe&&Qbe in Object(t)?cUt(t):dUt(t)}function WG(t){return t!=null&&typeof t=="object"}var mUt="[object Symbol]";function zze(t){return typeof t=="symbol"||WG(t)&&qG(t)==mUt}function gUt(t,e){for(var i=-1,r=t==null?0:t.length,s=Array(r);++i<r;)s[i]=e(t[i],i,t);return s}var Uze=Array.isArray,ewe=nA?nA.prototype:void 0,twe=ewe?ewe.toString:void 0;function Bze(t){if(typeof t=="string")return t;if(Uze(t))return gUt(t,Bze)+"";if(zze(t))return twe?twe.call(t):"";var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}var yUt=/\s/;function vUt(t){for(var e=t.length;e--&&yUt.test(t.charAt(e)););return e}var _Ut=/^\s+/;function bUt(t){return t&&t.slice(0,vUt(t)+1).replace(_Ut,"")}function N3(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var iwe=NaN,wUt=/^[-+]0x[0-9a-f]+$/i,xUt=/^0b[01]+$/i,SUt=/^0o[0-7]+$/i,TUt=parseInt;function rwe(t){if(typeof t=="number")return t;if(zze(t))return iwe;if(N3(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=N3(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=bUt(t);var i=xUt.test(t);return i||SUt.test(t)?TUt(t.slice(2),i?2:8):wUt.test(t)?iwe:+t}function EUt(t){return t}var CUt="[object AsyncFunction]",$Ut="[object Function]",AUt="[object GeneratorFunction]",MUt="[object Proxy]";function OUt(t){if(!N3(t))return!1;var e=qG(t);return e==$Ut||e==AUt||e==CUt||e==MUt}var IUt=9007199254740991,RUt=/^(?:0|[1-9]\d*)$/;function PUt(t,e){var i=typeof t;return e=e??IUt,!!e&&(i=="number"||i!="symbol"&&RUt.test(t))&&t>-1&&t%1==0&&t<e}var DUt=9007199254740991;function Vze(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=DUt}function LUt(t){return t!=null&&Vze(t.length)&&!OUt(t)}var NUt=Object.prototype;function FUt(t){var e=t&&t.constructor,i=typeof e=="function"&&e.prototype||NUt;return t===i}function kUt(t,e){for(var i=-1,r=Array(t);++i<t;)r[i]=e(i);return r}var zUt="[object Arguments]";function swe(t){return WG(t)&&qG(t)==zUt}var jze=Object.prototype,UUt=jze.hasOwnProperty,BUt=jze.propertyIsEnumerable,VUt=swe(function(){return arguments}())?swe:function(t){return WG(t)&&UUt.call(t,"callee")&&!BUt.call(t,"callee")};function jUt(){return!1}var Gze=typeof exports=="object"&&exports&&!exports.nodeType&&exports,nwe=Gze&&typeof module=="object"&&module&&!module.nodeType&&module,GUt=nwe&&nwe.exports===Gze,owe=GUt?uae.Buffer:void 0,HUt=owe?owe.isBuffer:void 0,qUt=HUt||jUt,WUt="[object Arguments]",ZUt="[object Array]",YUt="[object Boolean]",JUt="[object Date]",XUt="[object Error]",KUt="[object Function]",QUt="[object Map]",eBt="[object Number]",tBt="[object Object]",iBt="[object RegExp]",rBt="[object Set]",sBt="[object String]",nBt="[object WeakMap]",oBt="[object ArrayBuffer]",aBt="[object DataView]",lBt="[object Float32Array]",cBt="[object Float64Array]",uBt="[object Int8Array]",hBt="[object Int16Array]",dBt="[object Int32Array]",pBt="[object Uint8Array]",fBt="[object Uint8ClampedArray]",mBt="[object Uint16Array]",gBt="[object Uint32Array]",Vs={};Vs[lBt]=Vs[cBt]=Vs[uBt]=Vs[hBt]=Vs[dBt]=Vs[pBt]=Vs[fBt]=Vs[mBt]=Vs[gBt]=!0;Vs[WUt]=Vs[ZUt]=Vs[oBt]=Vs[YUt]=Vs[aBt]=Vs[JUt]=Vs[XUt]=Vs[KUt]=Vs[QUt]=Vs[eBt]=Vs[tBt]=Vs[iBt]=Vs[rBt]=Vs[sBt]=Vs[nBt]=!1;function yBt(t){return WG(t)&&Vze(t.length)&&!!Vs[qG(t)]}function vBt(t){return function(e){return t(e)}}var Hze=typeof exports=="object"&&exports&&!exports.nodeType&&exports,oP=Hze&&typeof module=="object"&&module&&!module.nodeType&&module,_Bt=oP&&oP.exports===Hze,$9=_Bt&&Fze.process,awe=function(){try{var t=oP&&oP.require&&oP.require("util").types;return t||$9&&$9.binding&&$9.binding("util")}catch{}}(),lwe=awe&&awe.isTypedArray,bBt=lwe?vBt(lwe):yBt;function wBt(t,e){var i=Uze(t),r=!i&&VUt(t),s=!i&&!r&&qUt(t),n=!i&&!r&&!s&&bBt(t),o=i||r||s||n,a=o?kUt(t.length,String):[],l=a.length;for(var c in t)o&&(c=="length"||s&&(c=="offset"||c=="parent")||n&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||PUt(c,l))||a.push(c);return a}function xBt(t){var e=[];if(t!=null)for(var i in Object(t))e.push(i);return e}var SBt=Object.prototype,TBt=SBt.hasOwnProperty;function EBt(t){if(!N3(t))return xBt(t);var e=FUt(t),i=[];for(var r in t)r=="constructor"&&(e||!TBt.call(t,r))||i.push(r);return i}function CBt(t){return LUt(t)?wBt(t):EBt(t)}function $Bt(t){return t==null?"":Bze(t)}function ABt(t){return function(e,i,r){for(var s=-1,n=Object(e),o=r(e),a=o.length;a--;){var l=o[++s];if(i(n[l],l,n)===!1)break}return e}}var MBt=ABt(),A9=function(){return uae.Date.now()},OBt="Expected a function",IBt=Math.max,RBt=Math.min;function hae(t,e,i){var r,s,n,o,a,l,c=0,h=!1,d=!1,f=!0;if(typeof t!="function")throw new TypeError(OBt);e=rwe(e)||0,N3(i)&&(h=!!i.leading,d="maxWait"in i,n=d?IBt(rwe(i.maxWait)||0,e):n,f="trailing"in i?!!i.trailing:f);function m(T){var M=r,I=s;return r=s=void 0,c=T,o=t.apply(I,M),o}function y(T){return c=T,a=setTimeout(b,e),h?m(T):o}function v(T){var M=T-l,I=T-c,P=e-M;return d?RBt(P,n-I):P}function _(T){var M=T-l,I=T-c;return l===void 0||M>=e||M<0||d&&I>=n}function b(){var T=A9();if(_(T))return w(T);a=setTimeout(b,v(T))}function w(T){return a=void 0,f&&r?m(T):(r=s=void 0,o)}function x(){a!==void 0&&clearTimeout(a),c=0,r=l=s=a=void 0}function S(){return a===void 0?o:w(A9())}function C(){var T=A9(),M=_(T);if(r=arguments,s=this,l=T,M){if(a===void 0)return y(l);if(d)return clearTimeout(a),a=setTimeout(b,e),m(l)}return a===void 0&&(a=setTimeout(b,e)),o}return C.cancel=x,C.flush=S,C}function PBt(t){return typeof t=="function"?t:EUt}var qze=/[\\^$.*+?()[\]{}|]/g,DBt=RegExp(qze.source);function LBt(t){return t=$Bt(t),t&&DBt.test(t)?t.replace(qze,"\\$&"):t}function NBt(t,e){return t==null?t:MBt(t,PBt(e),CBt)}/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const M9=(t,e,i)=>{const r=LBt(e),s=new RegExp(r,"i");t.length===0&&console.warn(`No data was passed to the filter function.
    The data argument should be an array of objects`);const n=(o,a,l)=>{if(o?.constant||o?.filterDisabled)return!0;let c=!1;return NBt(o,(h,d)=>{typeof h=="function"||h==null||l&&!l.includes(d)||(Array.isArray(h)||typeof h=="object"&&h!==null?n(h,a)&&(c=!0):a.test(h)&&(c=!0))}),c};return t.filter(o=>n(o,s,i))};/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const FBt={container:"container"},kBt={search:"search"},zBt=Js`:host{box-sizing:border-box;background-color:var(--calcite-color-foreground-1);color:var(--calcite-color-text-2);font-size:var(--calcite-font-size--1)}:host *{box-sizing:border-box}:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:flex;inline-size:100%}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}.container{display:flex;inline-size:100%}:host([scale=s]) .container{padding:var(--calcite-filter-content-space, var(--calcite-spacing-sm))}:host([scale=m]) .container{padding:var(--calcite-filter-content-space, var(--calcite-spacing-md))}:host([scale=l]) .container{padding:var(--calcite-filter-content-space, var(--calcite-spacing-lg))}label{position:relative;margin-block:0px;display:flex;inline-size:100%;align-items:center;overflow:hidden}calcite-input{inline-size:100%;--calcite-input-background-color: var(--calcite-filter-input-background-color);--calcite-input-border-color: var(--calcite-filter-input-border-color);--calcite-input-corner-radius: var(--calcite-filter-input-corner-radius);--calcite-input-shadow: var(--calcite-filter-input-shadow);--calcite-input-icon-color: var(--calcite-filter-input-icon-color);--calcite-input-text-color: var(--calcite-filter-input-text-color);--calcite-input-placeholder-text-color: var(--calcite-filter-input-placeholder-text-color);--calcite-input-actions-background-color: var(--calcite-filter-input-actions-background-color);--calcite-input-actions-background-color-hover: var(--calcite-filter-input-actions-background-color-hover);--calcite-input-actions-background-color-press: var(--calcite-filter-input-actions-background-color-press);--calcite-input-actions-icon-color: var(--calcite-filter-input-actions-icon-color);--calcite-input-actions-icon-color-hover: var(--calcite-filter-input-actions-icon-color-hover);--calcite-input-actions-icon-color-press: var(--calcite-filter-input-actions-icon-color-press)}:host([hidden]){display:none}[hidden]{display:none}`;class UBt extends Vn{constructor(){super(...arguments),this.filterDebounced=hae((e,i=!1,r)=>this.updateFiltered(M9(this.items??[],e,this.filterProps),i,r),xU.filter),this.textInput=Gc(),this._value="",this.messages=Fd(),this.disabled=!1,this.filteredItems=[],this.items=[],this.scale="m",this.calciteFilterChange=Ut({cancelable:!1})}static{this.properties={disabled:[7,{},{reflect:!0,type:Boolean}],filterProps:[0,{},{attribute:!1}],filteredItems:[0,{},{attribute:!1}],items:[0,{},{attribute:!1}],label:1,messageOverrides:[0,{},{attribute:!1}],placeholder:1,scale:[3,{},{reflect:!0}],value:1}}static{this.shadowRootOptions={mode:"open",delegatesFocus:!0}}static{this.styles=zBt}get value(){return this._value}set value(e){const i=this._value;e!==i&&(this._value=e,this.valueHandler(e))}async filter(e=this.value){return new Promise(i=>{this.value=e,this.updateFiltered(M9(this.items??[],e,this.filterProps),!1,i)})}async setFocus(){return await dh(this),this.textInput.value?.setFocus()}async load(){this.updateFiltered(M9(this.items??[],this.value,this.filterProps))}willUpdate(e){(e.has("items")&&(this.hasUpdated||this.items?.length>0)||e.has("filterProps"))&&this.filterDebounced(this.value)}updated(){yg(this)}disconnectedCallback(){super.disconnectedCallback(),this.filterDebounced.cancel()}valueHandler(e){this.filterDebounced(e)}inputHandler(e){const i=e.target;this.value=i.value,this.filterDebounced(i.value,!0)}keyDownHandler(e){e.defaultPrevented||(e.key==="Escape"&&(this.clear(),e.preventDefault()),e.key==="Enter"&&e.preventDefault())}clear(){this.value="",this.filterDebounced("",!0),this.setFocus()}updateFiltered(e,i=!1,r){this.filteredItems=e,i&&this.calciteFilterChange.emit(),r?.()}render(){const{disabled:e,scale:i}=this;return vg({disabled:e,children:le`<div class=${fe(FBt.container)}><label><calcite-input clearable .disabled=${e} .icon=${kBt.search} .label=${this.label??this.messages.label} .messageOverrides=${{clear:this.messages.clear}} @keydown=${this.keyDownHandler} @calciteInputInput=${this.inputHandler} .placeholder=${this.placeholder} .scale=${i} type=text .value=${this.value} ${wr(this.textInput)}></calcite-input></label></div>`})}}Oo("calcite-filter",UBt);/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const aP="calcite-list",jB="calcite-list-item-group",Vy="calcite-list-item";function Wze(t){const e=t.parentElement?.closest(Vy);e&&(e.open=!0,Wze(e))}function BBt(t){const e=t.assignedElements({flatten:!0}),i=e.filter(n=>n?.matches(jB)).map(n=>Array.from(n.querySelectorAll(Vy))).flat(),r=e.filter(n=>n?.matches(Vy));return{lists:e.filter(n=>n?.matches(aP)),items:i.concat(r)}}function VBt(t){const e=t.assignedElements({flatten:!0}).filter(r=>r.matches(Vy)),i=e.filter(r=>!r.filterHidden);e.forEach(r=>{const s=i.indexOf(r);r.setPosition=s===-1?void 0:s+1,r.setSize=s===-1?void 0:i.length})}function jBt(t,e=!1){const i=e?"ancestor::calcite-list-item | ancestor::calcite-list-item-group":"ancestor::calcite-list-item";return document.evaluate(i,t,null,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null).snapshotLength}function cwe(t){return t.tagName==="CALCITE-LIST-ITEM"}/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function uwe(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),i.push.apply(i,r)}return i}function rg(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?uwe(Object(i),!0).forEach(function(r){GBt(t,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):uwe(Object(i)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))})}return t}function cz(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?cz=function(e){return typeof e}:cz=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cz(t)}function GBt(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Tv(){return Tv=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},Tv.apply(this,arguments)}function HBt(t,e){if(t==null)return{};var i={},r=Object.keys(t),s,n;for(n=0;n<r.length;n++)s=r[n],!(e.indexOf(s)>=0)&&(i[s]=t[s]);return i}function qBt(t,e){if(t==null)return{};var i=HBt(t,e),r,s;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);for(s=0;s<n.length;s++)r=n[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}var WBt="1.15.6";function tv(t){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(t)}var Uv=tv(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),aL=tv(/Edge/i),hwe=tv(/firefox/i),lP=tv(/safari/i)&&!tv(/chrome/i)&&!tv(/android/i),dae=tv(/iP(ad|od|hone)/i),Zze=tv(/chrome/i)&&tv(/android/i),Yze={capture:!1,passive:!1};function _r(t,e,i){t.addEventListener(e,i,!Uv&&Yze)}function ur(t,e,i){t.removeEventListener(e,i,!Uv&&Yze)}function GB(t,e){if(e){if(e[0]===">"&&(e=e.substring(1)),t)try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch{return!1}return!1}}function Jze(t){return t.host&&t!==document&&t.host.nodeType?t.host:t.parentNode}function Np(t,e,i,r){if(t){i=i||document;do{if(e!=null&&(e[0]===">"?t.parentNode===i&&GB(t,e):GB(t,e))||r&&t===i)return t;if(t===i)break}while(t=Jze(t))}return null}var dwe=/\s+/g;function Pu(t,e,i){if(t&&e)if(t.classList)t.classList[i?"add":"remove"](e);else{var r=(" "+t.className+" ").replace(dwe," ").replace(" "+e+" "," ");t.className=(r+(i?" "+e:"")).replace(dwe," ")}}function ni(t,e,i){var r=t&&t.style;if(r){if(i===void 0)return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(i=t.currentStyle),e===void 0?i:i[e];!(e in r)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),r[e]=i+(typeof i=="string"?"":"px")}}function YC(t,e){var i="";if(typeof t=="string")i=t;else do{var r=ni(t,"transform");r&&r!=="none"&&(i=r+" "+i)}while(!e&&(t=t.parentNode));var s=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return s&&new s(i)}function Xze(t,e,i){if(t){var r=t.getElementsByTagName(e),s=0,n=r.length;if(i)for(;s<n;s++)i(r[s],s);return r}return[]}function Vm(){var t=document.scrollingElement;return t||document.documentElement}function vo(t,e,i,r,s){if(!(!t.getBoundingClientRect&&t!==window)){var n,o,a,l,c,h,d;if(t!==window&&t.parentNode&&t!==Vm()?(n=t.getBoundingClientRect(),o=n.top,a=n.left,l=n.bottom,c=n.right,h=n.height,d=n.width):(o=0,a=0,l=window.innerHeight,c=window.innerWidth,h=window.innerHeight,d=window.innerWidth),(e||i)&&t!==window&&(s=s||t.parentNode,!Uv))do if(s&&s.getBoundingClientRect&&(ni(s,"transform")!=="none"||i&&ni(s,"position")!=="static")){var f=s.getBoundingClientRect();o-=f.top+parseInt(ni(s,"border-top-width")),a-=f.left+parseInt(ni(s,"border-left-width")),l=o+n.height,c=a+n.width;break}while(s=s.parentNode);if(r&&t!==window){var m=YC(s||t),y=m&&m.a,v=m&&m.d;m&&(o/=v,a/=y,d/=y,h/=v,l=o+h,c=a+d)}return{top:o,left:a,bottom:l,right:c,width:d,height:h}}}function pwe(t,e,i){for(var r=ib(t,!0),s=vo(t)[e];r;){var n=vo(r)[i],o=void 0;if(o=s>=n,!o)return r;if(r===Vm())break;r=ib(r,!1)}return!1}function oA(t,e,i,r){for(var s=0,n=0,o=t.children;n<o.length;){if(o[n].style.display!=="none"&&o[n]!==oi.ghost&&(r||o[n]!==oi.dragged)&&Np(o[n],i.draggable,t,!1)){if(s===e)return o[n];s++}n++}return null}function pae(t,e){for(var i=t.lastElementChild;i&&(i===oi.ghost||ni(i,"display")==="none"||e&&!GB(i,e));)i=i.previousElementSibling;return i||null}function Bh(t,e){var i=0;if(!t||!t.parentNode)return-1;for(;t=t.previousElementSibling;)t.nodeName.toUpperCase()!=="TEMPLATE"&&t!==oi.clone&&(!e||GB(t,e))&&i++;return i}function fwe(t){var e=0,i=0,r=Vm();if(t)do{var s=YC(t),n=s.a,o=s.d;e+=t.scrollLeft*n,i+=t.scrollTop*o}while(t!==r&&(t=t.parentNode));return[e,i]}function ZBt(t,e){for(var i in t)if(t.hasOwnProperty(i)){for(var r in e)if(e.hasOwnProperty(r)&&e[r]===t[i][r])return Number(i)}return-1}function ib(t,e){if(!t||!t.getBoundingClientRect)return Vm();var i=t,r=!1;do if(i.clientWidth<i.scrollWidth||i.clientHeight<i.scrollHeight){var s=ni(i);if(i.clientWidth<i.scrollWidth&&(s.overflowX=="auto"||s.overflowX=="scroll")||i.clientHeight<i.scrollHeight&&(s.overflowY=="auto"||s.overflowY=="scroll")){if(!i.getBoundingClientRect||i===document.body)return Vm();if(r||e)return i;r=!0}}while(i=i.parentNode);return Vm()}function YBt(t,e){if(t&&e)for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}function O9(t,e){return Math.round(t.top)===Math.round(e.top)&&Math.round(t.left)===Math.round(e.left)&&Math.round(t.height)===Math.round(e.height)&&Math.round(t.width)===Math.round(e.width)}var cP;function Kze(t,e){return function(){if(!cP){var i=arguments,r=this;i.length===1?t.call(r,i[0]):t.apply(r,i),cP=setTimeout(function(){cP=void 0},e)}}}function JBt(){clearTimeout(cP),cP=void 0}function Qze(t,e,i){t.scrollLeft+=e,t.scrollTop+=i}function eUe(t){var e=window.Polymer,i=window.jQuery||window.Zepto;return e&&e.dom?e.dom(t).cloneNode(!0):i?i(t).clone(!0)[0]:t.cloneNode(!0)}function tUe(t,e,i){var r={};return Array.from(t.children).forEach(function(s){var n,o,a,l;if(!(!Np(s,e.draggable,t,!1)||s.animated||s===i)){var c=vo(s);r.left=Math.min((n=r.left)!==null&&n!==void 0?n:1/0,c.left),r.top=Math.min((o=r.top)!==null&&o!==void 0?o:1/0,c.top),r.right=Math.max((a=r.right)!==null&&a!==void 0?a:-1/0,c.right),r.bottom=Math.max((l=r.bottom)!==null&&l!==void 0?l:-1/0,c.bottom)}}),r.width=r.right-r.left,r.height=r.bottom-r.top,r.x=r.left,r.y=r.top,r}var Zc="Sortable"+new Date().getTime();function XBt(){var t=[],e;return{captureAnimationState:function(){if(t=[],!!this.options.animation){var r=[].slice.call(this.el.children);r.forEach(function(s){if(!(ni(s,"display")==="none"||s===oi.ghost)){t.push({target:s,rect:vo(s)});var n=rg({},t[t.length-1].rect);if(s.thisAnimationDuration){var o=YC(s,!0);o&&(n.top-=o.f,n.left-=o.e)}s.fromRect=n}})}},addAnimationState:function(r){t.push(r)},removeAnimationState:function(r){t.splice(ZBt(t,{target:r}),1)},animateAll:function(r){var s=this;if(!this.options.animation){clearTimeout(e),typeof r=="function"&&r();return}var n=!1,o=0;t.forEach(function(a){var l=0,c=a.target,h=c.fromRect,d=vo(c),f=c.prevFromRect,m=c.prevToRect,y=a.rect,v=YC(c,!0);v&&(d.top-=v.f,d.left-=v.e),c.toRect=d,c.thisAnimationDuration&&O9(f,d)&&!O9(h,d)&&(y.top-d.top)/(y.left-d.left)===(h.top-d.top)/(h.left-d.left)&&(l=QBt(y,f,m,s.options)),O9(d,h)||(c.prevFromRect=h,c.prevToRect=d,l||(l=s.options.animation),s.animate(c,y,d,l)),l&&(n=!0,o=Math.max(o,l),clearTimeout(c.animationResetTimer),c.animationResetTimer=setTimeout(function(){c.animationTime=0,c.prevFromRect=null,c.fromRect=null,c.prevToRect=null,c.thisAnimationDuration=null},l),c.thisAnimationDuration=l)}),clearTimeout(e),n?e=setTimeout(function(){typeof r=="function"&&r()},o):typeof r=="function"&&r(),t=[]},animate:function(r,s,n,o){if(o){ni(r,"transition",""),ni(r,"transform","");var a=YC(this.el),l=a&&a.a,c=a&&a.d,h=(s.left-n.left)/(l||1),d=(s.top-n.top)/(c||1);r.animatingX=!!h,r.animatingY=!!d,ni(r,"transform","translate3d("+h+"px,"+d+"px,0)"),this.forRepaintDummy=KBt(r),ni(r,"transition","transform "+o+"ms"+(this.options.easing?" "+this.options.easing:"")),ni(r,"transform","translate3d(0,0,0)"),typeof r.animated=="number"&&clearTimeout(r.animated),r.animated=setTimeout(function(){ni(r,"transition",""),ni(r,"transform",""),r.animated=!1,r.animatingX=!1,r.animatingY=!1},o)}}}}function KBt(t){return t.offsetWidth}function QBt(t,e,i,r){return Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))/Math.sqrt(Math.pow(e.top-i.top,2)+Math.pow(e.left-i.left,2))*r.animation}var aE=[],I9={initializeByDefault:!0},lL={mount:function(e){for(var i in I9)I9.hasOwnProperty(i)&&!(i in e)&&(e[i]=I9[i]);aE.forEach(function(r){if(r.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),aE.push(e)},pluginEvent:function(e,i,r){var s=this;this.eventCanceled=!1,r.cancel=function(){s.eventCanceled=!0};var n=e+"Global";aE.forEach(function(o){i[o.pluginName]&&(i[o.pluginName][n]&&i[o.pluginName][n](rg({sortable:i},r)),i.options[o.pluginName]&&i[o.pluginName][e]&&i[o.pluginName][e](rg({sortable:i},r)))})},initializePlugins:function(e,i,r,s){aE.forEach(function(a){var l=a.pluginName;if(!(!e.options[l]&&!a.initializeByDefault)){var c=new a(e,i,e.options);c.sortable=e,c.options=e.options,e[l]=c,Tv(r,c.defaults)}});for(var n in e.options)if(e.options.hasOwnProperty(n)){var o=this.modifyOption(e,n,e.options[n]);typeof o<"u"&&(e.options[n]=o)}},getEventProperties:function(e,i){var r={};return aE.forEach(function(s){typeof s.eventProperties=="function"&&Tv(r,s.eventProperties.call(i[s.pluginName],e))}),r},modifyOption:function(e,i,r){var s;return aE.forEach(function(n){e[n.pluginName]&&n.optionListeners&&typeof n.optionListeners[i]=="function"&&(s=n.optionListeners[i].call(e[n.pluginName],r))}),s}};function eVt(t){var e=t.sortable,i=t.rootEl,r=t.name,s=t.targetEl,n=t.cloneEl,o=t.toEl,a=t.fromEl,l=t.oldIndex,c=t.newIndex,h=t.oldDraggableIndex,d=t.newDraggableIndex,f=t.originalEvent,m=t.putSortable,y=t.extraEventProperties;if(e=e||i&&i[Zc],!!e){var v,_=e.options,b="on"+r.charAt(0).toUpperCase()+r.substr(1);window.CustomEvent&&!Uv&&!aL?v=new CustomEvent(r,{bubbles:!0,cancelable:!0}):(v=document.createEvent("Event"),v.initEvent(r,!0,!0)),v.to=o||i,v.from=a||i,v.item=s||i,v.clone=n,v.oldIndex=l,v.newIndex=c,v.oldDraggableIndex=h,v.newDraggableIndex=d,v.originalEvent=f,v.pullMode=m?m.lastPutMode:void 0;var w=rg(rg({},y),lL.getEventProperties(r,e));for(var x in w)v[x]=w[x];i&&i.dispatchEvent(v),_[b]&&_[b].call(e,v)}}var tVt=["evt"],wc=function(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=r.evt,n=qBt(r,tVt);lL.pluginEvent.bind(oi)(e,i,rg({dragEl:ze,parentEl:Cn,ghostEl:wi,rootEl:en,nextEl:Z1,lastDownEl:uz,cloneEl:ln,cloneHidden:N_,dragStarted:nR,putSortable:La,activeSortable:oi.active,originalEvent:s,oldIndex:mC,oldDraggableIndex:uP,newIndex:Fu,newDraggableIndex:x_,hideGhostForTarget:nUe,unhideGhostForTarget:oUe,cloneNowHidden:function(){N_=!0},cloneNowShown:function(){N_=!1},dispatchSortableEvent:function(a){Hl({sortable:i,name:a,originalEvent:s})}},n))};function Hl(t){eVt(rg({putSortable:La,cloneEl:ln,targetEl:ze,rootEl:en,oldIndex:mC,oldDraggableIndex:uP,newIndex:Fu,newDraggableIndex:x_},t))}var ze,Cn,wi,en,Z1,uz,ln,N_,mC,Fu,uP,x_,pk,La,O2=!1,HB=!1,qB=[],Bw,rp,R9,P9,mwe,gwe,nR,lE,hP,dP=!1,fk=!1,hz,nl,D9=[],tee=!1,WB=[],ZG=typeof document<"u",mk=dae,ywe=aL||Uv?"cssFloat":"float",iVt=ZG&&!Zze&&!dae&&"draggable"in document.createElement("div"),iUe=function(){if(ZG){if(Uv)return!1;var t=document.createElement("x");return t.style.cssText="pointer-events:auto",t.style.pointerEvents==="auto"}}(),rUe=function(e,i){var r=ni(e),s=parseInt(r.width)-parseInt(r.paddingLeft)-parseInt(r.paddingRight)-parseInt(r.borderLeftWidth)-parseInt(r.borderRightWidth),n=oA(e,0,i),o=oA(e,1,i),a=n&&ni(n),l=o&&ni(o),c=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+vo(n).width,h=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+vo(o).width;if(r.display==="flex")return r.flexDirection==="column"||r.flexDirection==="column-reverse"?"vertical":"horizontal";if(r.display==="grid")return r.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(n&&a.float&&a.float!=="none"){var d=a.float==="left"?"left":"right";return o&&(l.clear==="both"||l.clear===d)?"vertical":"horizontal"}return n&&(a.display==="block"||a.display==="flex"||a.display==="table"||a.display==="grid"||c>=s&&r[ywe]==="none"||o&&r[ywe]==="none"&&c+h>s)?"vertical":"horizontal"},rVt=function(e,i,r){var s=r?e.left:e.top,n=r?e.right:e.bottom,o=r?e.width:e.height,a=r?i.left:i.top,l=r?i.right:i.bottom,c=r?i.width:i.height;return s===a||n===l||s+o/2===a+c/2},sVt=function(e,i){var r;return qB.some(function(s){var n=s[Zc].options.emptyInsertThreshold;if(!(!n||pae(s))){var o=vo(s),a=e>=o.left-n&&e<=o.right+n,l=i>=o.top-n&&i<=o.bottom+n;if(a&&l)return r=s}}),r},sUe=function(e){function i(n,o){return function(a,l,c,h){var d=a.options.group.name&&l.options.group.name&&a.options.group.name===l.options.group.name;if(n==null&&(o||d))return!0;if(n==null||n===!1)return!1;if(o&&n==="clone")return n;if(typeof n=="function")return i(n(a,l,c,h),o)(a,l,c,h);var f=(o?a:l).options.group.name;return n===!0||typeof n=="string"&&n===f||n.join&&n.indexOf(f)>-1}}var r={},s=e.group;(!s||cz(s)!="object")&&(s={name:s}),r.name=s.name,r.checkPull=i(s.pull,!0),r.checkPut=i(s.put),r.revertClone=s.revertClone,e.group=r},nUe=function(){!iUe&&wi&&ni(wi,"display","none")},oUe=function(){!iUe&&wi&&ni(wi,"display","")};ZG&&!Zze&&document.addEventListener("click",function(t){if(HB)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),HB=!1,!1},!0);var Vw=function(e){if(ze){e=e.touches?e.touches[0]:e;var i=sVt(e.clientX,e.clientY);if(i){var r={};for(var s in e)e.hasOwnProperty(s)&&(r[s]=e[s]);r.target=r.rootEl=i,r.preventDefault=void 0,r.stopPropagation=void 0,i[Zc]._onDragOver(r)}}},nVt=function(e){ze&&ze.parentNode[Zc]._isOutsideThisEl(e.target)};function oi(t,e){if(!(t&&t.nodeType&&t.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.el=t,this.options=e=Tv({},e),t[Zc]=this;var i={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(t.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return rUe(t,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(o,a){o.setData("Text",a.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:oi.supportPointer!==!1&&"PointerEvent"in window&&(!lP||dae),emptyInsertThreshold:5};lL.initializePlugins(this,t,i);for(var r in i)!(r in e)&&(e[r]=i[r]);sUe(e);for(var s in this)s.charAt(0)==="_"&&typeof this[s]=="function"&&(this[s]=this[s].bind(this));this.nativeDraggable=e.forceFallback?!1:iVt,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?_r(t,"pointerdown",this._onTapStart):(_r(t,"mousedown",this._onTapStart),_r(t,"touchstart",this._onTapStart)),this.nativeDraggable&&(_r(t,"dragover",this),_r(t,"dragenter",this)),qB.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),Tv(this,XBt())}oi.prototype={constructor:oi,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(lE=null)},_getDirection:function(e,i){return typeof this.options.direction=="function"?this.options.direction.call(this,e,i,ze):this.options.direction},_onTapStart:function(e){if(e.cancelable){var i=this,r=this.el,s=this.options,n=s.preventOnFilter,o=e.type,a=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,l=(a||e).target,c=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||l,h=s.filter;if(pVt(r),!ze&&!(/mousedown|pointerdown/.test(o)&&e.button!==0||s.disabled)&&!c.isContentEditable&&!(!this.nativeDraggable&&lP&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=Np(l,s.draggable,r,!1),!(l&&l.animated)&&uz!==l)){if(mC=Bh(l),uP=Bh(l,s.draggable),typeof h=="function"){if(h.call(this,e,l,this)){Hl({sortable:i,rootEl:c,name:"filter",targetEl:l,toEl:r,fromEl:r}),wc("filter",i,{evt:e}),n&&e.preventDefault();return}}else if(h&&(h=h.split(",").some(function(d){if(d=Np(c,d.trim(),r,!1),d)return Hl({sortable:i,rootEl:d,name:"filter",targetEl:l,fromEl:r,toEl:r}),wc("filter",i,{evt:e}),!0}),h)){n&&e.preventDefault();return}s.handle&&!Np(c,s.handle,r,!1)||this._prepareDragStart(e,a,l)}}},_prepareDragStart:function(e,i,r){var s=this,n=s.el,o=s.options,a=n.ownerDocument,l;if(r&&!ze&&r.parentNode===n){var c=vo(r);if(en=n,ze=r,Cn=ze.parentNode,Z1=ze.nextSibling,uz=r,pk=o.group,oi.dragged=ze,Bw={target:ze,clientX:(i||e).clientX,clientY:(i||e).clientY},mwe=Bw.clientX-c.left,gwe=Bw.clientY-c.top,this._lastX=(i||e).clientX,this._lastY=(i||e).clientY,ze.style["will-change"]="all",l=function(){if(wc("delayEnded",s,{evt:e}),oi.eventCanceled){s._onDrop();return}s._disableDelayedDragEvents(),!hwe&&s.nativeDraggable&&(ze.draggable=!0),s._triggerDragStart(e,i),Hl({sortable:s,name:"choose",originalEvent:e}),Pu(ze,o.chosenClass,!0)},o.ignore.split(",").forEach(function(h){Xze(ze,h.trim(),L9)}),_r(a,"dragover",Vw),_r(a,"mousemove",Vw),_r(a,"touchmove",Vw),o.supportPointer?(_r(a,"pointerup",s._onDrop),!this.nativeDraggable&&_r(a,"pointercancel",s._onDrop)):(_r(a,"mouseup",s._onDrop),_r(a,"touchend",s._onDrop),_r(a,"touchcancel",s._onDrop)),hwe&&this.nativeDraggable&&(this.options.touchStartThreshold=4,ze.draggable=!0),wc("delayStart",this,{evt:e}),o.delay&&(!o.delayOnTouchOnly||i)&&(!this.nativeDraggable||!(aL||Uv))){if(oi.eventCanceled){this._onDrop();return}o.supportPointer?(_r(a,"pointerup",s._disableDelayedDrag),_r(a,"pointercancel",s._disableDelayedDrag)):(_r(a,"mouseup",s._disableDelayedDrag),_r(a,"touchend",s._disableDelayedDrag),_r(a,"touchcancel",s._disableDelayedDrag)),_r(a,"mousemove",s._delayedDragTouchMoveHandler),_r(a,"touchmove",s._delayedDragTouchMoveHandler),o.supportPointer&&_r(a,"pointermove",s._delayedDragTouchMoveHandler),s._dragStartTimer=setTimeout(l,o.delay)}else l()}},_delayedDragTouchMoveHandler:function(e){var i=e.touches?e.touches[0]:e;Math.max(Math.abs(i.clientX-this._lastX),Math.abs(i.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){ze&&L9(ze),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;ur(e,"mouseup",this._disableDelayedDrag),ur(e,"touchend",this._disableDelayedDrag),ur(e,"touchcancel",this._disableDelayedDrag),ur(e,"pointerup",this._disableDelayedDrag),ur(e,"pointercancel",this._disableDelayedDrag),ur(e,"mousemove",this._delayedDragTouchMoveHandler),ur(e,"touchmove",this._delayedDragTouchMoveHandler),ur(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,i){i=i||e.pointerType=="touch"&&e,!this.nativeDraggable||i?this.options.supportPointer?_r(document,"pointermove",this._onTouchMove):i?_r(document,"touchmove",this._onTouchMove):_r(document,"mousemove",this._onTouchMove):(_r(ze,"dragend",this),_r(en,"dragstart",this._onDragStart));try{document.selection?dz(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,i){if(O2=!1,en&&ze){wc("dragStarted",this,{evt:i}),this.nativeDraggable&&_r(document,"dragover",nVt);var r=this.options;!e&&Pu(ze,r.dragClass,!1),Pu(ze,r.ghostClass,!0),oi.active=this,e&&this._appendGhost(),Hl({sortable:this,name:"start",originalEvent:i})}else this._nulling()},_emulateDragOver:function(){if(rp){this._lastX=rp.clientX,this._lastY=rp.clientY,nUe();for(var e=document.elementFromPoint(rp.clientX,rp.clientY),i=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(rp.clientX,rp.clientY),e!==i);)i=e;if(ze.parentNode[Zc]._isOutsideThisEl(e),i)do{if(i[Zc]){var r=void 0;if(r=i[Zc]._onDragOver({clientX:rp.clientX,clientY:rp.clientY,target:e,rootEl:i}),r&&!this.options.dragoverBubble)break}e=i}while(i=Jze(i));oUe()}},_onTouchMove:function(e){if(Bw){var i=this.options,r=i.fallbackTolerance,s=i.fallbackOffset,n=e.touches?e.touches[0]:e,o=wi&&YC(wi,!0),a=wi&&o&&o.a,l=wi&&o&&o.d,c=mk&&nl&&fwe(nl),h=(n.clientX-Bw.clientX+s.x)/(a||1)+(c?c[0]-D9[0]:0)/(a||1),d=(n.clientY-Bw.clientY+s.y)/(l||1)+(c?c[1]-D9[1]:0)/(l||1);if(!oi.active&&!O2){if(r&&Math.max(Math.abs(n.clientX-this._lastX),Math.abs(n.clientY-this._lastY))<r)return;this._onDragStart(e,!0)}if(wi){o?(o.e+=h-(R9||0),o.f+=d-(P9||0)):o={a:1,b:0,c:0,d:1,e:h,f:d};var f="matrix(".concat(o.a,",").concat(o.b,",").concat(o.c,",").concat(o.d,",").concat(o.e,",").concat(o.f,")");ni(wi,"webkitTransform",f),ni(wi,"mozTransform",f),ni(wi,"msTransform",f),ni(wi,"transform",f),R9=h,P9=d,rp=n}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!wi){var e=this.options.fallbackOnBody?document.body:en,i=vo(ze,!0,mk,!0,e),r=this.options;if(mk){for(nl=e;ni(nl,"position")==="static"&&ni(nl,"transform")==="none"&&nl!==document;)nl=nl.parentNode;nl!==document.body&&nl!==document.documentElement?(nl===document&&(nl=Vm()),i.top+=nl.scrollTop,i.left+=nl.scrollLeft):nl=Vm(),D9=fwe(nl)}wi=ze.cloneNode(!0),Pu(wi,r.ghostClass,!1),Pu(wi,r.fallbackClass,!0),Pu(wi,r.dragClass,!0),ni(wi,"transition",""),ni(wi,"transform",""),ni(wi,"box-sizing","border-box"),ni(wi,"margin",0),ni(wi,"top",i.top),ni(wi,"left",i.left),ni(wi,"width",i.width),ni(wi,"height",i.height),ni(wi,"opacity","0.8"),ni(wi,"position",mk?"absolute":"fixed"),ni(wi,"zIndex","100000"),ni(wi,"pointerEvents","none"),oi.ghost=wi,e.appendChild(wi),ni(wi,"transform-origin",mwe/parseInt(wi.style.width)*100+"% "+gwe/parseInt(wi.style.height)*100+"%")}},_onDragStart:function(e,i){var r=this,s=e.dataTransfer,n=r.options;if(wc("dragStart",this,{evt:e}),oi.eventCanceled){this._onDrop();return}wc("setupClone",this),oi.eventCanceled||(ln=eUe(ze),ln.removeAttribute("id"),ln.draggable=!1,ln.style["will-change"]="",this._hideClone(),Pu(ln,this.options.chosenClass,!1),oi.clone=ln),r.cloneId=dz(function(){wc("clone",r),!oi.eventCanceled&&(r.options.removeCloneOnHide||en.insertBefore(ln,ze),r._hideClone(),Hl({sortable:r,name:"clone"}))}),!i&&Pu(ze,n.dragClass,!0),i?(HB=!0,r._loopId=setInterval(r._emulateDragOver,50)):(ur(document,"mouseup",r._onDrop),ur(document,"touchend",r._onDrop),ur(document,"touchcancel",r._onDrop),s&&(s.effectAllowed="move",n.setData&&n.setData.call(r,s,ze)),_r(document,"drop",r),ni(ze,"transform","translateZ(0)")),O2=!0,r._dragStartId=dz(r._dragStarted.bind(r,i,e)),_r(document,"selectstart",r),nR=!0,window.getSelection().removeAllRanges(),lP&&ni(document.body,"user-select","none")},_onDragOver:function(e){var i=this.el,r=e.target,s,n,o,a=this.options,l=a.group,c=oi.active,h=pk===l,d=a.sort,f=La||c,m,y=this,v=!1;if(tee)return;function _(j,re){wc(j,y,rg({evt:e,isOwner:h,axis:m?"vertical":"horizontal",revert:o,dragRect:s,targetRect:n,canSort:d,fromSortable:f,target:r,completed:w,onMove:function(xe,De){return gk(en,i,ze,s,xe,vo(xe),e,De)},changed:x},re))}function b(){_("dragOverAnimationCapture"),y.captureAnimationState(),y!==f&&f.captureAnimationState()}function w(j){return _("dragOverCompleted",{insertion:j}),j&&(h?c._hideClone():c._showClone(y),y!==f&&(Pu(ze,La?La.options.ghostClass:c.options.ghostClass,!1),Pu(ze,a.ghostClass,!0)),La!==y&&y!==oi.active?La=y:y===oi.active&&La&&(La=null),f===y&&(y._ignoreWhileAnimating=r),y.animateAll(function(){_("dragOverAnimationComplete"),y._ignoreWhileAnimating=null}),y!==f&&(f.animateAll(),f._ignoreWhileAnimating=null)),(r===ze&&!ze.animated||r===i&&!r.animated)&&(lE=null),!a.dragoverBubble&&!e.rootEl&&r!==document&&(ze.parentNode[Zc]._isOutsideThisEl(e.target),!j&&Vw(e)),!a.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),v=!0}function x(){Fu=Bh(ze),x_=Bh(ze,a.draggable),Hl({sortable:y,name:"change",toEl:i,newIndex:Fu,newDraggableIndex:x_,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),r=Np(r,a.draggable,i,!0),_("dragOver"),oi.eventCanceled)return v;if(ze.contains(e.target)||r.animated&&r.animatingX&&r.animatingY||y._ignoreWhileAnimating===r)return w(!1);if(HB=!1,c&&!a.disabled&&(h?d||(o=Cn!==en):La===this||(this.lastPutMode=pk.checkPull(this,c,ze,e))&&l.checkPut(this,c,ze,e))){if(m=this._getDirection(e,r)==="vertical",s=vo(ze),_("dragOverValid"),oi.eventCanceled)return v;if(o)return Cn=en,b(),this._hideClone(),_("revert"),oi.eventCanceled||(Z1?en.insertBefore(ze,Z1):en.appendChild(ze)),w(!0);var S=pae(i,a.draggable);if(!S||cVt(e,m,this)&&!S.animated){if(S===ze)return w(!1);if(S&&i===e.target&&(r=S),r&&(n=vo(r)),gk(en,i,ze,s,r,n,e,!!r)!==!1)return b(),S&&S.nextSibling?i.insertBefore(ze,S.nextSibling):i.appendChild(ze),Cn=i,x(),w(!0)}else if(S&&lVt(e,m,this)){var C=oA(i,0,a,!0);if(C===ze)return w(!1);if(r=C,n=vo(r),gk(en,i,ze,s,r,n,e,!1)!==!1)return b(),i.insertBefore(ze,C),Cn=i,x(),w(!0)}else if(r.parentNode===i){n=vo(r);var T=0,M,I=ze.parentNode!==i,P=!rVt(ze.animated&&ze.toRect||s,r.animated&&r.toRect||n,m),D=m?"top":"left",F=pwe(r,"top","top")||pwe(ze,"top","top"),L=F?F.scrollTop:void 0;lE!==r&&(M=n[D],dP=!1,fk=!P&&a.invertSwap||I),T=uVt(e,r,n,m,P?1:a.swapThreshold,a.invertedSwapThreshold==null?a.swapThreshold:a.invertedSwapThreshold,fk,lE===r);var N;if(T!==0){var R=Bh(ze);do R-=T,N=Cn.children[R];while(N&&(ni(N,"display")==="none"||N===wi))}if(T===0||N===r)return w(!1);lE=r,hP=T;var k=r.nextElementSibling,W=!1;W=T===1;var G=gk(en,i,ze,s,r,n,e,W);if(G!==!1)return(G===1||G===-1)&&(W=G===1),tee=!0,setTimeout(aVt,30),b(),W&&!k?i.appendChild(ze):r.parentNode.insertBefore(ze,W?k:r),F&&Qze(F,0,L-F.scrollTop),Cn=ze.parentNode,M!==void 0&&!fk&&(hz=Math.abs(M-vo(r)[D])),x(),w(!0)}if(i.contains(ze))return w(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){ur(document,"mousemove",this._onTouchMove),ur(document,"touchmove",this._onTouchMove),ur(document,"pointermove",this._onTouchMove),ur(document,"dragover",Vw),ur(document,"mousemove",Vw),ur(document,"touchmove",Vw)},_offUpEvents:function(){var e=this.el.ownerDocument;ur(e,"mouseup",this._onDrop),ur(e,"touchend",this._onDrop),ur(e,"pointerup",this._onDrop),ur(e,"pointercancel",this._onDrop),ur(e,"touchcancel",this._onDrop),ur(document,"selectstart",this)},_onDrop:function(e){var i=this.el,r=this.options;if(Fu=Bh(ze),x_=Bh(ze,r.draggable),wc("drop",this,{evt:e}),Cn=ze&&ze.parentNode,Fu=Bh(ze),x_=Bh(ze,r.draggable),oi.eventCanceled){this._nulling();return}O2=!1,fk=!1,dP=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),iee(this.cloneId),iee(this._dragStartId),this.nativeDraggable&&(ur(document,"drop",this),ur(i,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),lP&&ni(document.body,"user-select",""),ni(ze,"transform",""),e&&(nR&&(e.cancelable&&e.preventDefault(),!r.dropBubble&&e.stopPropagation()),wi&&wi.parentNode&&wi.parentNode.removeChild(wi),(en===Cn||La&&La.lastPutMode!=="clone")&&ln&&ln.parentNode&&ln.parentNode.removeChild(ln),ze&&(this.nativeDraggable&&ur(ze,"dragend",this),L9(ze),ze.style["will-change"]="",nR&&!O2&&Pu(ze,La?La.options.ghostClass:this.options.ghostClass,!1),Pu(ze,this.options.chosenClass,!1),Hl({sortable:this,name:"unchoose",toEl:Cn,newIndex:null,newDraggableIndex:null,originalEvent:e}),en!==Cn?(Fu>=0&&(Hl({rootEl:Cn,name:"add",toEl:Cn,fromEl:en,originalEvent:e}),Hl({sortable:this,name:"remove",toEl:Cn,originalEvent:e}),Hl({rootEl:Cn,name:"sort",toEl:Cn,fromEl:en,originalEvent:e}),Hl({sortable:this,name:"sort",toEl:Cn,originalEvent:e})),La&&La.save()):Fu!==mC&&Fu>=0&&(Hl({sortable:this,name:"update",toEl:Cn,originalEvent:e}),Hl({sortable:this,name:"sort",toEl:Cn,originalEvent:e})),oi.active&&((Fu==null||Fu===-1)&&(Fu=mC,x_=uP),Hl({sortable:this,name:"end",toEl:Cn,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){wc("nulling",this),en=ze=Cn=wi=Z1=ln=uz=N_=Bw=rp=nR=Fu=x_=mC=uP=lE=hP=La=pk=oi.dragged=oi.ghost=oi.clone=oi.active=null,WB.forEach(function(e){e.checked=!0}),WB.length=R9=P9=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":ze&&(this._onDragOver(e),oVt(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],i,r=this.el.children,s=0,n=r.length,o=this.options;s<n;s++)i=r[s],Np(i,o.draggable,this.el,!1)&&e.push(i.getAttribute(o.dataIdAttr)||dVt(i));return e},sort:function(e,i){var r={},s=this.el;this.toArray().forEach(function(n,o){var a=s.children[o];Np(a,this.options.draggable,s,!1)&&(r[n]=a)},this),i&&this.captureAnimationState(),e.forEach(function(n){r[n]&&(s.removeChild(r[n]),s.appendChild(r[n]))}),i&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,i){return Np(e,i||this.options.draggable,this.el,!1)},option:function(e,i){var r=this.options;if(i===void 0)return r[e];var s=lL.modifyOption(this,e,i);typeof s<"u"?r[e]=s:r[e]=i,e==="group"&&sUe(r)},destroy:function(){wc("destroy",this);var e=this.el;e[Zc]=null,ur(e,"mousedown",this._onTapStart),ur(e,"touchstart",this._onTapStart),ur(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(ur(e,"dragover",this),ur(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(i){i.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),qB.splice(qB.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!N_){if(wc("hideClone",this),oi.eventCanceled)return;ni(ln,"display","none"),this.options.removeCloneOnHide&&ln.parentNode&&ln.parentNode.removeChild(ln),N_=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(N_){if(wc("showClone",this),oi.eventCanceled)return;ze.parentNode==en&&!this.options.group.revertClone?en.insertBefore(ln,ze):Z1?en.insertBefore(ln,Z1):en.appendChild(ln),this.options.group.revertClone&&this.animate(ze,ln),ni(ln,"display",""),N_=!1}}};function oVt(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move"),t.cancelable&&t.preventDefault()}function gk(t,e,i,r,s,n,o,a){var l,c=t[Zc],h=c.options.onMove,d;return window.CustomEvent&&!Uv&&!aL?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=e,l.from=t,l.dragged=i,l.draggedRect=r,l.related=s||e,l.relatedRect=n||vo(e),l.willInsertAfter=a,l.originalEvent=o,t.dispatchEvent(l),h&&(d=h.call(c,l,o)),d}function L9(t){t.draggable=!1}function aVt(){tee=!1}function lVt(t,e,i){var r=vo(oA(i.el,0,i.options,!0)),s=tUe(i.el,i.options,wi),n=10;return e?t.clientX<s.left-n||t.clientY<r.top&&t.clientX<r.right:t.clientY<s.top-n||t.clientY<r.bottom&&t.clientX<r.left}function cVt(t,e,i){var r=vo(pae(i.el,i.options.draggable)),s=tUe(i.el,i.options,wi),n=10;return e?t.clientX>s.right+n||t.clientY>r.bottom&&t.clientX>r.left:t.clientY>s.bottom+n||t.clientX>r.right&&t.clientY>r.top}function uVt(t,e,i,r,s,n,o,a){var l=r?t.clientY:t.clientX,c=r?i.height:i.width,h=r?i.top:i.left,d=r?i.bottom:i.right,f=!1;if(!o){if(a&&hz<c*s){if(!dP&&(hP===1?l>h+c*n/2:l<d-c*n/2)&&(dP=!0),dP)f=!0;else if(hP===1?l<h+hz:l>d-hz)return-hP}else if(l>h+c*(1-s)/2&&l<d-c*(1-s)/2)return hVt(e)}return f=f||o,f&&(l<h+c*n/2||l>d-c*n/2)?l>h+c/2?1:-1:0}function hVt(t){return Bh(ze)<Bh(t)?1:-1}function dVt(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,i=e.length,r=0;i--;)r+=e.charCodeAt(i);return r.toString(36)}function pVt(t){WB.length=0;for(var e=t.getElementsByTagName("input"),i=e.length;i--;){var r=e[i];r.checked&&WB.push(r)}}function dz(t){return setTimeout(t,0)}function iee(t){return clearTimeout(t)}ZG&&_r(document,"touchmove",function(t){(oi.active||O2)&&t.cancelable&&t.preventDefault()});oi.utils={on:_r,off:ur,css:ni,find:Xze,is:function(e,i){return!!Np(e,i,e,!1)},extend:YBt,throttle:Kze,closest:Np,toggleClass:Pu,clone:eUe,index:Bh,nextTick:dz,cancelNextTick:iee,detectDirection:rUe,getChild:oA,expando:Zc};oi.get=function(t){return t[Zc]};oi.mount=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];e[0].constructor===Array&&(e=e[0]),e.forEach(function(r){if(!r.prototype||!r.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(r));r.utils&&(oi.utils=rg(rg({},oi.utils),r.utils)),lL.mount(r)})};oi.create=function(t,e){return new oi(t,e)};oi.version=WBt;var fo=[],oR,ree,see=!1,N9,F9,ZB,aR;function fVt(){function t(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return t.prototype={dragStarted:function(i){var r=i.originalEvent;this.sortable.nativeDraggable?_r(document,"dragover",this._handleAutoScroll):this.options.supportPointer?_r(document,"pointermove",this._handleFallbackAutoScroll):r.touches?_r(document,"touchmove",this._handleFallbackAutoScroll):_r(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(i){var r=i.originalEvent;!this.options.dragOverBubble&&!r.rootEl&&this._handleAutoScroll(r)},drop:function(){this.sortable.nativeDraggable?ur(document,"dragover",this._handleAutoScroll):(ur(document,"pointermove",this._handleFallbackAutoScroll),ur(document,"touchmove",this._handleFallbackAutoScroll),ur(document,"mousemove",this._handleFallbackAutoScroll)),vwe(),pz(),JBt()},nulling:function(){ZB=ree=oR=see=aR=N9=F9=null,fo.length=0},_handleFallbackAutoScroll:function(i){this._handleAutoScroll(i,!0)},_handleAutoScroll:function(i,r){var s=this,n=(i.touches?i.touches[0]:i).clientX,o=(i.touches?i.touches[0]:i).clientY,a=document.elementFromPoint(n,o);if(ZB=i,r||this.options.forceAutoScrollFallback||aL||Uv||lP){k9(i,this.options,a,r);var l=ib(a,!0);see&&(!aR||n!==N9||o!==F9)&&(aR&&vwe(),aR=setInterval(function(){var c=ib(document.elementFromPoint(n,o),!0);c!==l&&(l=c,pz()),k9(i,s.options,c,r)},10),N9=n,F9=o)}else{if(!this.options.bubbleScroll||ib(a,!0)===Vm()){pz();return}k9(i,this.options,ib(a,!1),!1)}}},Tv(t,{pluginName:"scroll",initializeByDefault:!0})}function pz(){fo.forEach(function(t){clearInterval(t.pid)}),fo=[]}function vwe(){clearInterval(aR)}var k9=Kze(function(t,e,i,r){if(e.scroll){var s=(t.touches?t.touches[0]:t).clientX,n=(t.touches?t.touches[0]:t).clientY,o=e.scrollSensitivity,a=e.scrollSpeed,l=Vm(),c=!1,h;ree!==i&&(ree=i,pz(),oR=e.scroll,h=e.scrollFn,oR===!0&&(oR=ib(i,!0)));var d=0,f=oR;do{var m=f,y=vo(m),v=y.top,_=y.bottom,b=y.left,w=y.right,x=y.width,S=y.height,C=void 0,T=void 0,M=m.scrollWidth,I=m.scrollHeight,P=ni(m),D=m.scrollLeft,F=m.scrollTop;m===l?(C=x<M&&(P.overflowX==="auto"||P.overflowX==="scroll"||P.overflowX==="visible"),T=S<I&&(P.overflowY==="auto"||P.overflowY==="scroll"||P.overflowY==="visible")):(C=x<M&&(P.overflowX==="auto"||P.overflowX==="scroll"),T=S<I&&(P.overflowY==="auto"||P.overflowY==="scroll"));var L=C&&(Math.abs(w-s)<=o&&D+x<M)-(Math.abs(b-s)<=o&&!!D),N=T&&(Math.abs(_-n)<=o&&F+S<I)-(Math.abs(v-n)<=o&&!!F);if(!fo[d])for(var R=0;R<=d;R++)fo[R]||(fo[R]={});(fo[d].vx!=L||fo[d].vy!=N||fo[d].el!==m)&&(fo[d].el=m,fo[d].vx=L,fo[d].vy=N,clearInterval(fo[d].pid),(L!=0||N!=0)&&(c=!0,fo[d].pid=setInterval(function(){r&&this.layer===0&&oi.active._onTouchMove(ZB);var k=fo[this.layer].vy?fo[this.layer].vy*a:0,W=fo[this.layer].vx?fo[this.layer].vx*a:0;typeof h=="function"&&h.call(oi.dragged.parentNode[Zc],W,k,t,ZB,fo[this.layer].el)!=="continue"||Qze(fo[this.layer].el,W,k)}.bind({layer:d}),24))),d++}while(e.bubbleScroll&&f!==l&&(f=ib(f,!1)));see=c}},30),aUe=function(e){var i=e.originalEvent,r=e.putSortable,s=e.dragEl,n=e.activeSortable,o=e.dispatchSortableEvent,a=e.hideGhostForTarget,l=e.unhideGhostForTarget;if(i){var c=r||n;a();var h=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:i,d=document.elementFromPoint(h.clientX,h.clientY);l(),c&&!c.el.contains(d)&&(o("spill"),this.onSpill({dragEl:s,putSortable:r}))}};function fae(){}fae.prototype={startIndex:null,dragStart:function(e){var i=e.oldDraggableIndex;this.startIndex=i},onSpill:function(e){var i=e.dragEl,r=e.putSortable;this.sortable.captureAnimationState(),r&&r.captureAnimationState();var s=oA(this.sortable.el,this.startIndex,this.options);s?this.sortable.el.insertBefore(i,s):this.sortable.el.appendChild(i),this.sortable.animateAll(),r&&r.animateAll()},drop:aUe};Tv(fae,{pluginName:"revertOnSpill"});function mae(){}mae.prototype={onSpill:function(e){var i=e.dragEl,r=e.putSortable,s=r||this.sortable;s.captureAnimationState(),i.parentNode&&i.parentNode.removeChild(i),s.animateAll()},drop:aUe};Tv(mae,{pluginName:"removeOnSpill"});oi.mount(new fVt);oi.mount(mae,fae);/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const YG=new Set,mVt={ghostClass:"calcite-sortable--ghost",chosenClass:"calcite-sortable--chosen",dragClass:"calcite-sortable--drag",fallbackClass:"calcite-sortable--fallback"};function gVt(t){if(cUe(t))return;lUe(t),YG.add(t);const e="id",{group:i,handleSelector:r,dragSelector:s}=t;t.sortable=oi.create(t.el,{dataIdAttr:e,...mVt,...!!s&&{draggable:s},...!!i&&{group:{name:i,...!!t.canPull&&{pull:(n,o,a,{newDraggableIndex:l,oldDraggableIndex:c})=>t.canPull({toEl:n.el,fromEl:o.el,dragEl:a,newIndex:l,oldIndex:c})},...!!t.canPut&&{put:(n,o,a,{newDraggableIndex:l,oldDraggableIndex:c})=>t.canPut({toEl:n.el,fromEl:o.el,dragEl:a,newIndex:l,oldIndex:c})}}},onMove:({from:n,dragged:o,to:a,related:l})=>{t.onDragMove&&t.onDragMove({fromEl:n,dragEl:o,toEl:a,relatedEl:l})},handle:r,filter:`${r}[disabled]`,onStart:({from:n,item:o,to:a,newDraggableIndex:l,oldDraggableIndex:c})=>{nee.active=!0,yVt(),t.onDragStart({fromEl:n,dragEl:o,toEl:a,newIndex:l,oldIndex:c})},onEnd:({from:n,item:o,to:a,newDraggableIndex:l,oldDraggableIndex:c})=>{nee.active=!1,vVt(),t.onDragEnd({fromEl:n,dragEl:o,toEl:a,newIndex:l,oldIndex:c})},onSort:({from:n,item:o,to:a,newDraggableIndex:l,oldDraggableIndex:c})=>{t.onDragSort({fromEl:n,dragEl:o,toEl:a,newIndex:l,oldIndex:c})}})}function lUe(t){cUe(t)||(YG.delete(t),t.sortable?.destroy(),t.sortable=null)}const nee={active:!1};function cUe(t){return t.dragEnabled&&nee.active}function yVt(){Array.from(YG).forEach(t=>t.onGlobalDragStart())}function vVt(){Array.from(YG).forEach(t=>t.onGlobalDragEnd())}/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const x0={container:"container",table:"table",scrim:"scrim",stack:"stack",tableContainer:"table-container",sticky:"sticky-pos",assistiveText:"assistive-text"},z9={filterNoResults:"filter-no-results",filterActionsStart:"filter-actions-start",filterActionsEnd:"filter-actions-end"},_Vt=Js`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:block}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}.container{position:relative;background-color:var(--calcite-list-background-color, var(--calcite-color-foreground-1))}.table-container{box-sizing:border-box;display:flex;inline-size:100%;flex-direction:column;background-color:transparent}.table-container *{box-sizing:border-box}.table{inline-size:100%}.stack{--calcite-stack-padding-inline: 0;--calcite-stack-padding-block: 0}.sticky-pos{position:sticky;inset-block-start:0px;z-index:var(--calcite-z-index-sticky);background-color:var(--calcite-list-background-color, var(--calcite-color-foreground-1))}.assistive-text{position:absolute;inline-size:1px;block-size:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}:host([hidden]){display:none}[hidden]{display:none}`,bVt=`${jB}, ${Vy}`;class uUe extends Vn{constructor(){super(),this.dragSelector=Vy,this.focusableItems=[],this.handleSelector="calcite-sort-handle",this.listItems=[],this.listItemGroups=[],this.mutationObserver=vf("mutation",()=>{this.willPerformFilter=!0,this.updateListItems()}),this.updateListItems=hae(()=>{this.updateGroupItems();const{selectionAppearance:e,selectionMode:i,interactionMode:r,dragEnabled:s,el:n,filterEl:o,moveToItems:a,displayMode:l,scale:c}=this,h=Array.from(this.el.querySelectorAll(Vy));if(h.forEach(d=>{d.scale=c,d.selectionAppearance=e,d.selectionMode=i,d.interactionMode=r,d.closest(aP)===n&&(d.moveToItems=a.filter(f=>f.element!==n&&!d.contains(f.element)),d.dragHandle=s,d.displayMode=l)}),this.parentListEl){this.setUpSorting();return}this.listItems=h,this.filterEnabled&&this.willPerformFilter&&(this.willPerformFilter=!1,this.dataForFilter=this.getItemData(),o&&(o.items=this.dataForFilter,this.filterAndUpdateData())),this.visibleItems=this.listItems.filter(d=>!d.closed&&!d.hidden),this.updateFilteredItems(),this.borderItems(),this.focusableItems=this.filteredItems.filter(d=>!d.disabled),this.setActiveListItem(),this.updateSelectedItems(),this.setUpSorting()},xU.nextTick),this.visibleItems=[],this.willFilterEmit=!1,this.willPerformFilter=!1,this.messages=Fd({blocking:!0}),this.dataForFilter=[],this.hasFilterActionsEnd=!1,this.hasFilterActionsStart=!1,this.hasFilterNoResults=!1,this.moveToItems=[],this.disabled=!1,this.dragEnabled=!1,this.filterEnabled=!1,this.filteredData=[],this.filteredItems=[],this.interactionMode="interactive",this.loading=!1,this.displayMode="flat",this.scale="m",this.selectedItems=[],this.selectionAppearance="icon",this.selectionMode="none",this.calciteInternalListDefaultSlotChange=Ut({cancelable:!1}),this.calciteListChange=Ut({cancelable:!1}),this.calciteListDragEnd=Ut({cancelable:!1}),this.calciteListDragStart=Ut({cancelable:!1}),this.calciteListFilter=Ut({cancelable:!1}),this.calciteListMoveHalt=Ut({cancelable:!1}),this.calciteListOrderChange=Ut({cancelable:!1}),this.listen("calciteInternalListItemToggle",this.handleCalciteListItemToggle),this.listen("calciteInternalFocusPreviousItem",this.handleCalciteInternalFocusPreviousItem),this.listen("calciteInternalListItemActive",this.handleCalciteInternalListItemActive),this.listen("calciteListItemSelect",this.handleCalciteListItemSelect),this.listen("calciteInternalAssistiveTextChange",this.handleCalciteInternalAssistiveTextChange),this.listen("calciteSortHandleReorder",this.handleSortReorder),this.listen("calciteSortHandleMove",this.handleSortMove),this.listen("calciteInternalListItemSelect",this.handleCalciteInternalListItemSelect),this.listen("calciteInternalListItemSelectMultiple",this.handleCalciteInternalListItemSelectMultiple),this.listen("calciteInternalListItemChange",this.handleCalciteInternalListItemChange),this.listen("calciteInternalListItemGroupDefaultSlotChange",this.handleCalciteInternalListItemGroupDefaultSlotChange)}static{this.properties={assistiveText:[16,{},{state:!0}],dataForFilter:[16,{},{state:!0}],hasFilterActionsEnd:[16,{},{state:!0}],hasFilterActionsStart:[16,{},{state:!0}],hasFilterNoResults:[16,{},{state:!0}],moveToItems:[16,{},{state:!0}],hasActiveFilter:[16,{},{state:!0}],showNoResultsContainer:[16,{},{state:!0}],canPull:[0,{},{attribute:!1}],canPut:[0,{},{attribute:!1}],disabled:[7,{},{reflect:!0,type:Boolean}],dragEnabled:[7,{},{reflect:!0,type:Boolean}],filterEnabled:[7,{},{reflect:!0,type:Boolean}],filterPredicate:[0,{},{attribute:!1}],filterLabel:[3,{},{reflect:!0}],filterPlaceholder:[3,{},{reflect:!0}],filterProps:[0,{},{attribute:!1}],filterText:[3,{},{reflect:!0}],filteredData:[0,{},{attribute:!1}],filteredItems:[0,{},{attribute:!1}],group:[3,{},{reflect:!0}],interactionMode:[3,{},{reflect:!0}],label:1,loading:[7,{},{reflect:!0,type:Boolean}],messageOverrides:[0,{},{attribute:!1}],displayMode:[3,{},{reflect:!0}],numberingSystem:1,scale:[3,{},{reflect:!0}],selectedItems:[0,{},{attribute:!1}],selectionAppearance:[3,{},{reflect:!0}],selectionMode:[3,{},{reflect:!0}]}}static{this.styles=_Vt}get hasActiveFilter(){return this.filterEnabled&&this.filterText&&this.filteredItems.length!==this.visibleItems.length}get showNoResultsContainer(){return this.filterEnabled&&this.filterText&&this.hasFilterNoResults&&this.visibleItems.length&&!this.filteredItems.length}putFailed(e){this.calciteListMoveHalt.emit(e)}async setFocus(){return await dh(this),this.filterEnabled?this.filterEl?.setFocus():this.focusableItems.find(e=>e.active)?.setFocus()}connectedCallback(){super.connectedCallback(),this.connectObserver(),this.willPerformFilter=!0,this.updateListItems(),this.setUpSorting(),this.setParentList(),this.setListItemGroups()}async load(){this.handleInteractionModeWarning()}willUpdate(e){(e.has("filterText")||e.has("filterProps")||e.has("filterPredicate"))&&this.performFilter(),(e.has("filterEnabled")&&(this.hasUpdated||this.filterEnabled!==!1)||e.has("group")||e.has("dragEnabled")&&(this.hasUpdated||this.dragEnabled!==!1)||e.has("selectionMode")&&(this.hasUpdated||this.selectionMode!=="none")||e.has("selectionAppearance")&&(this.hasUpdated||this.selectionAppearance!=="icon")||e.has("displayMode")&&this.hasUpdated||e.has("scale")&&this.hasUpdated||e.has("filterPredicate")&&this.hasUpdated)&&this.handleListItemChange()}updated(){yg(this)}disconnectedCallback(){super.disconnectedCallback(),this.disconnectObserver(),lUe(this)}handleListItemChange(){this.willPerformFilter=!0,this.updateListItems()}handleCalciteListItemToggle(e){this.parentListEl||(e.stopPropagation(),this.borderItems())}handleCalciteInternalFocusPreviousItem(e){if(this.parentListEl)return;e.stopPropagation();const{focusableItems:i}=this,s=i.findIndex(n=>n.active)-1;i[s]&&this.focusRow(i[s])}handleCalciteInternalListItemActive(e){if(this.parentListEl)return;e.stopPropagation();const i=e.target,{listItems:r}=this;r.forEach(s=>{s.active=s===i})}handleCalciteListItemSelect(){this.parentListEl||this.updateSelectedItems(!0)}handleCalciteInternalAssistiveTextChange(e){this.assistiveText=e.detail.message,e.stopPropagation()}handleSortReorder(e){this.parentListEl||e.defaultPrevented||(e.preventDefault(),this.handleReorder(e))}handleSortMove(e){this.parentListEl||e.defaultPrevented||(e.preventDefault(),this.handleMove(e))}handleCalciteInternalListItemSelect(e){if(this.parentListEl)return;e.stopPropagation();const i=e.target,{listItems:r,selectionMode:s}=this;i.selected&&(s==="single"||s==="single-persist")&&r.forEach(n=>n.selected=n===i),this.updateSelectedItems()}handleCalciteInternalListItemSelectMultiple(e){if(this.parentListEl)return;e.stopPropagation();const{target:i,detail:r}=e,{focusableItems:s,lastSelectedInfo:n}=this,o=i;if(r.selectMultiple&&n){const a=s.indexOf(o),l=s.indexOf(n.selectedItem),c=Math.min(l,a),h=Math.max(l,a);s.slice(c,h+1).forEach(d=>d.selected=n.selected)}else this.lastSelectedInfo={selectedItem:o,selected:o.selected}}handleCalciteInternalListItemChange(e){this.parentListEl||(e.stopPropagation(),this.updateListItems())}handleCalciteInternalListItemGroupDefaultSlotChange(e){e.stopPropagation()}connectObserver(){this.mutationObserver?.observe(this.el,{childList:!0,subtree:!0})}disconnectObserver(){this.mutationObserver?.disconnect()}setUpSorting(){const{dragEnabled:e,defaultSlotEl:i}=this;e&&(i&&VBt(i),gVt(this))}onGlobalDragStart(){this.disconnectObserver()}onGlobalDragEnd(){this.connectObserver()}onDragEnd(e){this.calciteListDragEnd.emit(e)}onDragStart(e){e.dragEl.sortHandleOpen=!1,this.calciteListDragStart.emit(e)}onDragSort(e){this.setParentList(),this.updateListItems(),this.calciteListOrderChange.emit(e)}setParentList(){this.parentListEl=this.el.parentElement?.closest(aP)}handleDefaultSlotChange(){this.parentListEl&&this.calciteInternalListDefaultSlotChange.emit()}setListItemGroups(){this.listItemGroups=Array.from(this.el.querySelectorAll(jB))}handleFilterActionsStartSlotChange(e){this.hasFilterActionsStart=$s(e)}handleFilterActionsEndSlotChange(e){this.hasFilterActionsEnd=$s(e)}handleFilterNoResultsSlotChange(e){this.hasFilterNoResults=$s(e)}setActiveListItem(){const{focusableItems:e}=this;e.some(i=>i.active)||e[0]&&(e[0].active=!0)}async updateSelectedItems(e=!1){await this.updateComplete,this.selectedItems=this.visibleItems.filter(i=>i.selected),e&&this.calciteListChange.emit()}filterElements({el:e,filteredItems:i,visibleParents:r}){const s=!r.has(e)&&!i.includes(e);e.filterHidden=s;const n=e.parentElement.closest(bVt);n&&(s||r.add(n),this.filterElements({el:n,filteredItems:i,visibleParents:r}))}allParentListItemsExpanded(e){const i=e.parentElement?.closest(Vy);if(i){if(!i.expanded)return!1}else return!0;return this.allParentListItemsExpanded(i)}borderItems(){const e=this.visibleItems.filter(i=>!i.filterHidden&&this.allParentListItemsExpanded(i));e.forEach(i=>i.bordered=i!==e[e.length-1])}updateFilteredItems(){const{visibleItems:e,filteredData:i,filterText:r,filterPredicate:s}=this,n=e?.filter(l=>e.every(c=>c===l||!l.contains(c))),o=s?e.filter(s):r?i.map(l=>l.el):e||[],a=new WeakSet;n.forEach(l=>this.filterElements({el:l,filteredItems:o,visibleParents:a})),this.filteredItems=o,this.willFilterEmit&&(this.willFilterEmit=!1,this.calciteListFilter.emit())}updateFilteredData(){const{filterEl:e}=this;e&&(e.filteredItems&&(this.filteredData=e.filteredItems),this.updateListItems())}async filterAndUpdateData(){await this.filterEl?.filter(this.filterText),this.updateFilteredData()}get effectiveFilterProps(){return this.filterProps?this.filterProps.filter(e=>e!=="el"):["description","label","metadata","heading"]}performFilter(){const{filterEl:e,filterText:i,effectiveFilterProps:r}=this;e&&(e.value=i,e.filterProps=r,this.filterAndUpdateData())}setDefaultSlotEl(e){this.defaultSlotEl=e}setFilterEl(e){this.filterEl=e,this.performFilter()}handleFilterChange(e){e.stopPropagation();const{value:i}=e.currentTarget;this.filterText=i,this.willFilterEmit=!0,this.updateFilteredData()}getItemData(){return this.listItems.map(e=>({label:e.label,description:e.description,metadata:e.metadata,heading:this.getGroupHeading(e),el:e}))}getGroupHeading(e){return this.listItemGroups.filter(r=>r.contains(e)).map(r=>r.heading)}updateGroupItems(){const{el:e,group:i,scale:r}=this,s=UG(e),n=i?Array.from(s.querySelectorAll(`${aP}[group="${i}"]`)).filter(a=>!a.disabled&&a.dragEnabled):[];this.moveToItems=n.map(a=>({element:a,label:a.label??a.id,id:XS()})),Array.from(this.el.querySelectorAll(jB)).forEach(a=>{a.scale=r})}focusRow(e){const{focusableItems:i}=this;e&&(i.forEach(r=>r.active=r===e),e.setFocus())}isNavigable(e){const i=e.parentElement?.closest(Vy);return i?i.expanded&&this.isNavigable(i):!0}handleListKeydown(e){if(e.defaultPrevented||this.parentListEl)return;const{key:i}=e,r=this.focusableItems.filter(n=>this.isNavigable(n)),s=r.findIndex(n=>n.active);if(i==="ArrowDown"){e.preventDefault();const n=e.target===this.filterEl?0:s+1;r[n]&&this.focusRow(r[n])}else if(i==="ArrowUp"){if(e.preventDefault(),s===0&&this.filterEnabled){this.filterEl?.setFocus();return}const n=s-1;r[n]&&this.focusRow(r[n])}else if(i==="Home"){e.preventDefault();const n=r[0];n&&this.focusRow(n)}else if(i==="End"){e.preventDefault();const n=r[r.length-1];n&&this.focusRow(n)}}handleInteractionModeWarning(){this.interactionMode==="static"&&this.selectionMode!=="none"&&this.selectionAppearance==="border"&&console.warn('selection-appearance="border" requires interaction-mode="interactive"')}handleMove(e){const{moveTo:i}=e.detail,r=e.target,s=r?.parentElement,n=i.element,a=Array.from(s.children).filter(cwe).indexOf(r),l=0;if(s){if(s.canPull?.({toEl:n,fromEl:s,dragEl:r,newIndex:l,oldIndex:a})===!1){this.calciteListMoveHalt.emit({toEl:n,fromEl:s,dragEl:r,oldIndex:a,newIndex:l});return}if(n.canPut?.({toEl:n,fromEl:s,dragEl:r,newIndex:l,oldIndex:a})===!1){n.putFailed({toEl:n,fromEl:s,dragEl:r,oldIndex:a,newIndex:l});return}r.sortHandleOpen=!1,this.disconnectObserver(),n.prepend(r),Wze(r),this.updateListItems(),this.connectObserver(),this.calciteListOrderChange.emit({dragEl:r,fromEl:s,toEl:n,newIndex:l,oldIndex:a})}}handleReorder(e){const{reorder:i}=e.detail,r=e.target,s=r?.parentElement;if(!s)return;r.sortHandleOpen=!1;const n=Array.from(s.children).filter(cwe),o=n.length-1,a=n.indexOf(r);let l=a;switch(i){case"top":l=0;break;case"bottom":l=o;break;case"up":l=a===0?0:a-1;break;case"down":l=a===o?o:a+1;break}this.disconnectObserver();const c=i==="up"||i==="top"?n[l]:n[l].nextSibling;s.insertBefore(r,c),this.updateListItems(),this.connectObserver(),this.calciteListOrderChange.emit({dragEl:r,fromEl:s,toEl:s,newIndex:l,oldIndex:a})}render(){const{loading:e,label:i,disabled:r,dataForFilter:s,filterEnabled:n,filterPlaceholder:o,filterText:a,filterLabel:l,hasFilterActionsStart:c,hasFilterActionsEnd:h,effectiveFilterProps:d}=this;return vg({disabled:this.disabled,children:le`<div class=${fe(x0.container)}>${this.dragEnabled?le`<span aria-live=assertive class=${fe(x0.assistiveText)}>${this.assistiveText}</span>`:null}${this.renderItemAriaLive()}${e?le`<calcite-scrim class=${fe(x0.scrim)} .loading=${e}></calcite-scrim>`:null}<div .ariaBusy=${e} .ariaLabel=${i||""} class=${fe(x0.table)} @keydown=${this.handleListKeydown} role=treegrid>${n||c||h?le`<div class=${fe(x0.sticky)} role=rowgroup><div role=row><div role=columnheader><calcite-stack class=${fe(x0.stack)}><slot name=${z9.filterActionsStart} @slotchange=${this.handleFilterActionsStartSlotChange} slot=${fC.actionsStart}></slot><calcite-filter .ariaLabel=${o} .disabled=${r} .filterProps=${d} .items=${s} .label=${l} @calciteFilterChange=${this.handleFilterChange} .placeholder=${o} .scale=${this.scale} .value=${a} ${wr(this.setFilterEl)}></calcite-filter><slot name=${z9.filterActionsEnd} @slotchange=${this.handleFilterActionsEndSlotChange} slot=${fC.actionsEnd}></slot></calcite-stack></div></div></div>`:null}<div class=${fe(x0.tableContainer)} role=rowgroup><slot @slotchange=${this.handleDefaultSlotChange} ${wr(this.setDefaultSlotEl)}></slot></div></div><div aria-live=polite data-test-id=no-results-container .hidden=${!this.showNoResultsContainer}><slot name=${z9.filterNoResults} @slotchange=${this.handleFilterNoResultsSlotChange}></slot></div></div>`})}renderItemAriaLive(){const{messages:e,filteredItems:i,parentListEl:r,messages:{_lang:s},numberingSystem:n}=this;return Fh.numberFormatOptions={locale:s,numberingSystem:n},r?null:le`<div aria-live=polite class=${fe(x0.assistiveText)}>${this.hasActiveFilter?Zi("aria-filter-enabled",le`<div>${e.filterEnabled}</div>`):null}${Zi("aria-item-count",le`<div>${e.total.replace("{count}",Fh.localize(i.length.toString()))}</div>`)}${i.length?Zi("aria-item-list",le`<ol>${i.map(o=>le`<li>${o.label}</li>`)}</ol>`):null}</div>`}}Oo("calcite-list",uUe);const Nfi=Object.freeze(Object.defineProperty({__proto__:null,List:uUe},Symbol.toStringTag,{value:"Module"})),hUe=["top","right","bottom","left"],_we=["start","end"],bwe=hUe.reduce((t,e)=>t.concat(e,e+"-"+_we[0],e+"-"+_we[1]),[]),aA=Math.min,jx=Math.max,YB=Math.round,yk=Math.floor,jm=t=>({x:t,y:t}),wVt={left:"right",right:"left",bottom:"top",top:"bottom"},xVt={start:"end",end:"start"};function oee(t,e,i){return jx(t,aA(e,i))}function QS(t,e){return typeof t=="function"?t(e):t}function Ev(t){return t.split("-")[0]}function Gm(t){return t.split("-")[1]}function dUe(t){return t==="x"?"y":"x"}function gae(t){return t==="y"?"height":"width"}function rb(t){return["top","bottom"].includes(Ev(t))?"y":"x"}function yae(t){return dUe(rb(t))}function pUe(t,e,i){i===void 0&&(i=!1);const r=Gm(t),s=yae(t),n=gae(s);let o=s==="x"?r===(i?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[n]>e.floating[n]&&(o=XB(o)),[o,XB(o)]}function SVt(t){const e=XB(t);return[JB(t),e,JB(e)]}function JB(t){return t.replace(/start|end/g,e=>xVt[e])}function TVt(t,e,i){const r=["left","right"],s=["right","left"],n=["top","bottom"],o=["bottom","top"];switch(t){case"top":case"bottom":return i?e?s:r:e?r:s;case"left":case"right":return e?n:o;default:return[]}}function EVt(t,e,i,r){const s=Gm(t);let n=TVt(Ev(t),i==="start",r);return s&&(n=n.map(o=>o+"-"+s),e&&(n=n.concat(n.map(JB)))),n}function XB(t){return t.replace(/left|right|bottom|top/g,e=>wVt[e])}function CVt(t){return{top:0,right:0,bottom:0,left:0,...t}}function fUe(t){return typeof t!="number"?CVt(t):{top:t,right:t,bottom:t,left:t}}function KB(t){const{x:e,y:i,width:r,height:s}=t;return{width:r,height:s,top:i,left:e,right:e+r,bottom:i+s,x:e,y:i}}function wwe(t,e,i){let{reference:r,floating:s}=t;const n=rb(e),o=yae(e),a=gae(o),l=Ev(e),c=n==="y",h=r.x+r.width/2-s.width/2,d=r.y+r.height/2-s.height/2,f=r[a]/2-s[a]/2;let m;switch(l){case"top":m={x:h,y:r.y-s.height};break;case"bottom":m={x:h,y:r.y+r.height};break;case"right":m={x:r.x+r.width,y:d};break;case"left":m={x:r.x-s.width,y:d};break;default:m={x:r.x,y:r.y}}switch(Gm(e)){case"start":m[o]-=f*(i&&c?-1:1);break;case"end":m[o]+=f*(i&&c?-1:1);break}return m}const $Vt=async(t,e,i)=>{const{placement:r="bottom",strategy:s="absolute",middleware:n=[],platform:o}=i,a=n.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(e));let c=await o.getElementRects({reference:t,floating:e,strategy:s}),{x:h,y:d}=wwe(c,r,l),f=r,m={},y=0;for(let v=0;v<a.length;v++){const{name:_,fn:b}=a[v],{x:w,y:x,data:S,reset:C}=await b({x:h,y:d,initialPlacement:r,placement:f,strategy:s,middlewareData:m,rects:c,platform:o,elements:{reference:t,floating:e}});h=w??h,d=x??d,m={...m,[_]:{...m[_],...S}},C&&y<=50&&(y++,typeof C=="object"&&(C.placement&&(f=C.placement),C.rects&&(c=C.rects===!0?await o.getElementRects({reference:t,floating:e,strategy:s}):C.rects),{x:h,y:d}=wwe(c,f,l)),v=-1)}return{x:h,y:d,placement:f,strategy:s,middlewareData:m}};async function F3(t,e){var i;e===void 0&&(e={});const{x:r,y:s,platform:n,rects:o,elements:a,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:h="viewport",elementContext:d="floating",altBoundary:f=!1,padding:m=0}=QS(e,t),y=fUe(m),_=a[f?d==="floating"?"reference":"floating":d],b=KB(await n.getClippingRect({element:(i=await(n.isElement==null?void 0:n.isElement(_)))==null||i?_:_.contextElement||await(n.getDocumentElement==null?void 0:n.getDocumentElement(a.floating)),boundary:c,rootBoundary:h,strategy:l})),w=d==="floating"?{x:r,y:s,width:o.floating.width,height:o.floating.height}:o.reference,x=await(n.getOffsetParent==null?void 0:n.getOffsetParent(a.floating)),S=await(n.isElement==null?void 0:n.isElement(x))?await(n.getScale==null?void 0:n.getScale(x))||{x:1,y:1}:{x:1,y:1},C=KB(n.convertOffsetParentRelativeRectToViewportRelativeRect?await n.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:w,offsetParent:x,strategy:l}):w);return{top:(b.top-C.top+y.top)/S.y,bottom:(C.bottom-b.bottom+y.bottom)/S.y,left:(b.left-C.left+y.left)/S.x,right:(C.right-b.right+y.right)/S.x}}const AVt=t=>({name:"arrow",options:t,async fn(e){const{x:i,y:r,placement:s,rects:n,platform:o,elements:a,middlewareData:l}=e,{element:c,padding:h=0}=QS(t,e)||{};if(c==null)return{};const d=fUe(h),f={x:i,y:r},m=yae(s),y=gae(m),v=await o.getDimensions(c),_=m==="y",b=_?"top":"left",w=_?"bottom":"right",x=_?"clientHeight":"clientWidth",S=n.reference[y]+n.reference[m]-f[m]-n.floating[y],C=f[m]-n.reference[m],T=await(o.getOffsetParent==null?void 0:o.getOffsetParent(c));let M=T?T[x]:0;(!M||!await(o.isElement==null?void 0:o.isElement(T)))&&(M=a.floating[x]||n.floating[y]);const I=S/2-C/2,P=M/2-v[y]/2-1,D=aA(d[b],P),F=aA(d[w],P),L=D,N=M-v[y]-F,R=M/2-v[y]/2+I,k=oee(L,R,N),W=!l.arrow&&Gm(s)!=null&&R!==k&&n.reference[y]/2-(R<L?D:F)-v[y]/2<0,G=W?R<L?R-L:R-N:0;return{[m]:f[m]+G,data:{[m]:k,centerOffset:R-k-G,...W&&{alignmentOffset:G}},reset:W}}});function MVt(t,e,i){return(t?[...i.filter(s=>Gm(s)===t),...i.filter(s=>Gm(s)!==t)]:i.filter(s=>Ev(s)===s)).filter(s=>t?Gm(s)===t||(e?JB(s)!==s:!1):!0)}const OVt=function(t){return t===void 0&&(t={}),{name:"autoPlacement",options:t,async fn(e){var i,r,s;const{rects:n,middlewareData:o,placement:a,platform:l,elements:c}=e,{crossAxis:h=!1,alignment:d,allowedPlacements:f=bwe,autoAlignment:m=!0,...y}=QS(t,e),v=d!==void 0||f===bwe?MVt(d||null,m,f):f,_=await F3(e,y),b=((i=o.autoPlacement)==null?void 0:i.index)||0,w=v[b];if(w==null)return{};const x=pUe(w,n,await(l.isRTL==null?void 0:l.isRTL(c.floating)));if(a!==w)return{reset:{placement:v[0]}};const S=[_[Ev(w)],_[x[0]],_[x[1]]],C=[...((r=o.autoPlacement)==null?void 0:r.overflows)||[],{placement:w,overflows:S}],T=v[b+1];if(T)return{data:{index:b+1,overflows:C},reset:{placement:T}};const M=C.map(D=>{const F=Gm(D.placement);return[D.placement,F&&h?D.overflows.slice(0,2).reduce((L,N)=>L+N,0):D.overflows[0],D.overflows]}).sort((D,F)=>D[1]-F[1]),P=((s=M.filter(D=>D[2].slice(0,Gm(D[0])?2:3).every(F=>F<=0))[0])==null?void 0:s[0])||M[0][0];return P!==a?{data:{index:b+1,overflows:C},reset:{placement:P}}:{}}}},IVt=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var i,r;const{placement:s,middlewareData:n,rects:o,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:h=!0,crossAxis:d=!0,fallbackPlacements:f,fallbackStrategy:m="bestFit",fallbackAxisSideDirection:y="none",flipAlignment:v=!0,..._}=QS(t,e);if((i=n.arrow)!=null&&i.alignmentOffset)return{};const b=Ev(s),w=rb(a),x=Ev(a)===a,S=await(l.isRTL==null?void 0:l.isRTL(c.floating)),C=f||(x||!v?[XB(a)]:SVt(a)),T=y!=="none";!f&&T&&C.push(...EVt(a,v,y,S));const M=[a,...C],I=await F3(e,_),P=[];let D=((r=n.flip)==null?void 0:r.overflows)||[];if(h&&P.push(I[b]),d){const R=pUe(s,o,S);P.push(I[R[0]],I[R[1]])}if(D=[...D,{placement:s,overflows:P}],!P.every(R=>R<=0)){var F,L;const R=(((F=n.flip)==null?void 0:F.index)||0)+1,k=M[R];if(k&&(!(d==="alignment"?w!==rb(k):!1)||D.every(j=>j.overflows[0]>0&&rb(j.placement)===w)))return{data:{index:R,overflows:D},reset:{placement:k}};let W=(L=D.filter(G=>G.overflows[0]<=0).sort((G,j)=>G.overflows[1]-j.overflows[1])[0])==null?void 0:L.placement;if(!W)switch(m){case"bestFit":{var N;const G=(N=D.filter(j=>{if(T){const re=rb(j.placement);return re===w||re==="y"}return!0}).map(j=>[j.placement,j.overflows.filter(re=>re>0).reduce((re,ve)=>re+ve,0)]).sort((j,re)=>j[1]-re[1])[0])==null?void 0:N[0];G&&(W=G);break}case"initialPlacement":W=a;break}if(s!==W)return{reset:{placement:W}}}return{}}}};function xwe(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function Swe(t){return hUe.some(e=>t[e]>=0)}const RVt=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:i}=e,{strategy:r="referenceHidden",...s}=QS(t,e);switch(r){case"referenceHidden":{const n=await F3(e,{...s,elementContext:"reference"}),o=xwe(n,i.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:Swe(o)}}}case"escaped":{const n=await F3(e,{...s,altBoundary:!0}),o=xwe(n,i.floating);return{data:{escapedOffsets:o,escaped:Swe(o)}}}default:return{}}}}};async function PVt(t,e){const{placement:i,platform:r,elements:s}=t,n=await(r.isRTL==null?void 0:r.isRTL(s.floating)),o=Ev(i),a=Gm(i),l=rb(i)==="y",c=["left","top"].includes(o)?-1:1,h=n&&l?-1:1,d=QS(e,t);let{mainAxis:f,crossAxis:m,alignmentAxis:y}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof y=="number"&&(m=a==="end"?y*-1:y),l?{x:m*h,y:f*c}:{x:f*c,y:m*h}}const DVt=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var i,r;const{x:s,y:n,placement:o,middlewareData:a}=e,l=await PVt(e,t);return o===((i=a.offset)==null?void 0:i.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:s+l.x,y:n+l.y,data:{...l,placement:o}}}}},LVt=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:i,y:r,placement:s}=e,{mainAxis:n=!0,crossAxis:o=!1,limiter:a={fn:_=>{let{x:b,y:w}=_;return{x:b,y:w}}},...l}=QS(t,e),c={x:i,y:r},h=await F3(e,l),d=rb(Ev(s)),f=dUe(d);let m=c[f],y=c[d];if(n){const _=f==="y"?"top":"left",b=f==="y"?"bottom":"right",w=m+h[_],x=m-h[b];m=oee(w,m,x)}if(o){const _=d==="y"?"top":"left",b=d==="y"?"bottom":"right",w=y+h[_],x=y-h[b];y=oee(w,y,x)}const v=a.fn({...e,[f]:m,[d]:y});return{...v,data:{x:v.x-i,y:v.y-r,enabled:{[f]:n,[d]:o}}}}}};function JG(){return typeof window<"u"}function qA(t){return mUe(t)?(t.nodeName||"").toLowerCase():"#document"}function ih(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function _g(t){var e;return(e=(mUe(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function mUe(t){return JG()?t instanceof Node||t instanceof ih(t).Node:!1}function _f(t){return JG()?t instanceof Element||t instanceof ih(t).Element:!1}function sg(t){return JG()?t instanceof HTMLElement||t instanceof ih(t).HTMLElement:!1}function Twe(t){return!JG()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof ih(t).ShadowRoot}function cL(t){const{overflow:e,overflowX:i,overflowY:r,display:s}=bf(t);return/auto|scroll|overlay|hidden|clip/.test(e+r+i)&&!["inline","contents"].includes(s)}function NVt(t){return["table","td","th"].includes(qA(t))}function XG(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function KG(t){const e=vae(),i=_f(t)?bf(t):t;return["transform","translate","scale","rotate","perspective"].some(r=>i[r]?i[r]!=="none":!1)||(i.containerType?i.containerType!=="normal":!1)||!e&&(i.backdropFilter?i.backdropFilter!=="none":!1)||!e&&(i.filter?i.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(r=>(i.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(i.contain||"").includes(r))}function FVt(t){let e=Fb(t);for(;sg(e)&&!lA(e);){if(KG(e))return e;if(XG(e))return null;e=Fb(e)}return null}function vae(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function lA(t){return["html","body","#document"].includes(qA(t))}function bf(t){return ih(t).getComputedStyle(t)}function QG(t){return _f(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Fb(t){if(qA(t)==="html")return t;const e=t.assignedSlot||t.parentNode||Twe(t)&&t.host||_g(t);return Twe(e)?e.host:e}function gUe(t){const e=Fb(t);return lA(e)?t.ownerDocument?t.ownerDocument.body:t.body:sg(e)&&cL(e)?e:gUe(e)}function k3(t,e,i){var r;e===void 0&&(e=[]),i===void 0&&(i=!0);const s=gUe(t),n=s===((r=t.ownerDocument)==null?void 0:r.body),o=ih(s);if(n){const a=aee(o);return e.concat(o,o.visualViewport||[],cL(s)?s:[],a&&i?k3(a):[])}return e.concat(s,k3(s,[],i))}function aee(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function yUe(t){const e=bf(t);let i=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const s=sg(t),n=s?t.offsetWidth:i,o=s?t.offsetHeight:r,a=YB(i)!==n||YB(r)!==o;return a&&(i=n,r=o),{width:i,height:r,$:a}}function _ae(t){return _f(t)?t:t.contextElement}function JC(t){const e=_ae(t);if(!sg(e))return jm(1);const i=e.getBoundingClientRect(),{width:r,height:s,$:n}=yUe(e);let o=(n?YB(i.width):i.width)/r,a=(n?YB(i.height):i.height)/s;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const kVt=jm(0);function vUe(t){const e=ih(t);return!vae()||!e.visualViewport?kVt:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function zVt(t,e,i){return e===void 0&&(e=!1),!i||e&&i!==ih(t)?!1:e}function wS(t,e,i,r){e===void 0&&(e=!1),i===void 0&&(i=!1);const s=t.getBoundingClientRect(),n=_ae(t);let o=jm(1);e&&(r?_f(r)&&(o=JC(r)):o=JC(t));const a=zVt(n,i,r)?vUe(n):jm(0);let l=(s.left+a.x)/o.x,c=(s.top+a.y)/o.y,h=s.width/o.x,d=s.height/o.y;if(n){const f=ih(n),m=r&&_f(r)?ih(r):r;let y=f,v=aee(y);for(;v&&r&&m!==y;){const _=JC(v),b=v.getBoundingClientRect(),w=bf(v),x=b.left+(v.clientLeft+parseFloat(w.paddingLeft))*_.x,S=b.top+(v.clientTop+parseFloat(w.paddingTop))*_.y;l*=_.x,c*=_.y,h*=_.x,d*=_.y,l+=x,c+=S,y=ih(v),v=aee(y)}}return KB({width:h,height:d,x:l,y:c})}function bae(t,e){const i=QG(t).scrollLeft;return e?e.left+i:wS(_g(t)).left+i}function _Ue(t,e,i){i===void 0&&(i=!1);const r=t.getBoundingClientRect(),s=r.left+e.scrollLeft-(i?0:bae(t,r)),n=r.top+e.scrollTop;return{x:s,y:n}}function UVt(t){let{elements:e,rect:i,offsetParent:r,strategy:s}=t;const n=s==="fixed",o=_g(r),a=e?XG(e.floating):!1;if(r===o||a&&n)return i;let l={scrollLeft:0,scrollTop:0},c=jm(1);const h=jm(0),d=sg(r);if((d||!d&&!n)&&((qA(r)!=="body"||cL(o))&&(l=QG(r)),sg(r))){const m=wS(r);c=JC(r),h.x=m.x+r.clientLeft,h.y=m.y+r.clientTop}const f=o&&!d&&!n?_Ue(o,l,!0):jm(0);return{width:i.width*c.x,height:i.height*c.y,x:i.x*c.x-l.scrollLeft*c.x+h.x+f.x,y:i.y*c.y-l.scrollTop*c.y+h.y+f.y}}function BVt(t){return Array.from(t.getClientRects())}function VVt(t){const e=_g(t),i=QG(t),r=t.ownerDocument.body,s=jx(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),n=jx(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let o=-i.scrollLeft+bae(t);const a=-i.scrollTop;return bf(r).direction==="rtl"&&(o+=jx(e.clientWidth,r.clientWidth)-s),{width:s,height:n,x:o,y:a}}function jVt(t,e){const i=ih(t),r=_g(t),s=i.visualViewport;let n=r.clientWidth,o=r.clientHeight,a=0,l=0;if(s){n=s.width,o=s.height;const c=vae();(!c||c&&e==="fixed")&&(a=s.offsetLeft,l=s.offsetTop)}return{width:n,height:o,x:a,y:l}}function GVt(t,e){const i=wS(t,!0,e==="fixed"),r=i.top+t.clientTop,s=i.left+t.clientLeft,n=sg(t)?JC(t):jm(1),o=t.clientWidth*n.x,a=t.clientHeight*n.y,l=s*n.x,c=r*n.y;return{width:o,height:a,x:l,y:c}}function Ewe(t,e,i){let r;if(e==="viewport")r=jVt(t,i);else if(e==="document")r=VVt(_g(t));else if(_f(e))r=GVt(e,i);else{const s=vUe(t);r={x:e.x-s.x,y:e.y-s.y,width:e.width,height:e.height}}return KB(r)}function bUe(t,e){const i=Fb(t);return i===e||!_f(i)||lA(i)?!1:bf(i).position==="fixed"||bUe(i,e)}function HVt(t,e){const i=e.get(t);if(i)return i;let r=k3(t,[],!1).filter(a=>_f(a)&&qA(a)!=="body"),s=null;const n=bf(t).position==="fixed";let o=n?Fb(t):t;for(;_f(o)&&!lA(o);){const a=bf(o),l=KG(o);!l&&a.position==="fixed"&&(s=null),(n?!l&&!s:!l&&a.position==="static"&&!!s&&["absolute","fixed"].includes(s.position)||cL(o)&&!l&&bUe(t,o))?r=r.filter(h=>h!==o):s=a,o=Fb(o)}return e.set(t,r),r}function qVt(t){let{element:e,boundary:i,rootBoundary:r,strategy:s}=t;const o=[...i==="clippingAncestors"?XG(e)?[]:HVt(e,this._c):[].concat(i),r],a=o[0],l=o.reduce((c,h)=>{const d=Ewe(e,h,s);return c.top=jx(d.top,c.top),c.right=aA(d.right,c.right),c.bottom=aA(d.bottom,c.bottom),c.left=jx(d.left,c.left),c},Ewe(e,a,s));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function WVt(t){const{width:e,height:i}=yUe(t);return{width:e,height:i}}function ZVt(t,e,i){const r=sg(e),s=_g(e),n=i==="fixed",o=wS(t,!0,n,e);let a={scrollLeft:0,scrollTop:0};const l=jm(0);function c(){l.x=bae(s)}if(r||!r&&!n)if((qA(e)!=="body"||cL(s))&&(a=QG(e)),r){const m=wS(e,!0,n,e);l.x=m.x+e.clientLeft,l.y=m.y+e.clientTop}else s&&c();n&&!r&&s&&c();const h=s&&!r&&!n?_Ue(s,a):jm(0),d=o.left+a.scrollLeft-l.x-h.x,f=o.top+a.scrollTop-l.y-h.y;return{x:d,y:f,width:o.width,height:o.height}}function U9(t){return bf(t).position==="static"}function Cwe(t,e){if(!sg(t)||bf(t).position==="fixed")return null;if(e)return e(t);let i=t.offsetParent;return _g(t)===i&&(i=i.ownerDocument.body),i}function wUe(t,e){const i=ih(t);if(XG(t))return i;if(!sg(t)){let s=Fb(t);for(;s&&!lA(s);){if(_f(s)&&!U9(s))return s;s=Fb(s)}return i}let r=Cwe(t,e);for(;r&&NVt(r)&&U9(r);)r=Cwe(r,e);return r&&lA(r)&&U9(r)&&!KG(r)?i:r||FVt(t)||i}const YVt=async function(t){const e=this.getOffsetParent||wUe,i=this.getDimensions,r=await i(t.floating);return{reference:ZVt(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function JVt(t){return bf(t).direction==="rtl"}const lee={convertOffsetParentRelativeRectToViewportRelativeRect:UVt,getDocumentElement:_g,getClippingRect:qVt,getOffsetParent:wUe,getElementRects:YVt,getClientRects:BVt,getDimensions:WVt,getScale:JC,isElement:_f,isRTL:JVt};function xUe(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function XVt(t,e){let i=null,r;const s=_g(t);function n(){var a;clearTimeout(r),(a=i)==null||a.disconnect(),i=null}function o(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),n();const c=t.getBoundingClientRect(),{left:h,top:d,width:f,height:m}=c;if(a||e(),!f||!m)return;const y=yk(d),v=yk(s.clientWidth-(h+f)),_=yk(s.clientHeight-(d+m)),b=yk(h),x={rootMargin:-y+"px "+-v+"px "+-_+"px "+-b+"px",threshold:jx(0,aA(1,l))||1};let S=!0;function C(T){const M=T[0].intersectionRatio;if(M!==l){if(!S)return o();M?o(!1,M):r=setTimeout(()=>{o(!1,1e-7)},1e3)}M===1&&!xUe(c,t.getBoundingClientRect())&&o(),S=!1}try{i=new IntersectionObserver(C,{...x,root:s.ownerDocument})}catch{i=new IntersectionObserver(C,x)}i.observe(t)}return o(!0),n}function KVt(t,e,i,r){r===void 0&&(r={});const{ancestorScroll:s=!0,ancestorResize:n=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,c=_ae(t),h=s||n?[...c?k3(c):[],...k3(e)]:[];h.forEach(b=>{s&&b.addEventListener("scroll",i,{passive:!0}),n&&b.addEventListener("resize",i)});const d=c&&a?XVt(c,i):null;let f=-1,m=null;o&&(m=new ResizeObserver(b=>{let[w]=b;w&&w.target===c&&m&&(m.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var x;(x=m)==null||x.observe(e)})),i()}),c&&!l&&m.observe(c),m.observe(e));let y,v=l?wS(t):null;l&&_();function _(){const b=wS(t);v&&!xUe(v,b)&&i(),v=b,y=requestAnimationFrame(_)}return i(),()=>{var b;h.forEach(w=>{s&&w.removeEventListener("scroll",i),n&&w.removeEventListener("resize",i)}),d?.(),(b=m)==null||b.disconnect(),m=null,l&&cancelAnimationFrame(y)}}const QVt=DVt,ejt=OVt,tjt=LVt,$we=IVt,ijt=RVt,rjt=AVt,sjt=(t,e,i)=>{const r=new Map,s={platform:lee,...i},n={...s.platform,_c:r};return $Vt(t,e,{...s,platform:n})};function njt(t){return ojt(t)}function B9(t){return t.assignedSlot?t.assignedSlot:t.parentNode instanceof ShadowRoot?t.parentNode.host:t.parentNode}function ojt(t){for(let e=t;e;e=B9(e))if(e instanceof Element&&getComputedStyle(e).display==="none")return null;for(let e=B9(t);e;e=B9(e)){if(!(e instanceof Element))continue;const i=getComputedStyle(e);if(i.display!=="contents"&&(i.position!=="static"||KG(i)||e.tagName==="BODY"))return e}return null}/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */(function(){{const e=lee.getOffsetParent;lee.getOffsetParent=i=>e(i,njt)}})();function Awe(t){const e=window.devicePixelRatio||1;return Math.round(t*e)/e}const SUe=async(t,{referenceEl:e,floatingEl:i,overlayPositioning:r="absolute",placement:s,flipDisabled:n,flipPlacements:o,offsetDistance:a,offsetSkidding:l,arrowEl:c,type:h})=>{if(!e||!i)return;const d=oL(i)==="rtl",{x:f,y:m,placement:y,strategy:v,middlewareData:_}=await sjt(e,i,{strategy:r,placement:s==="auto"||s==="auto-start"||s==="auto-end"?void 0:Owe(s,d),middleware:cjt({placement:s,flipDisabled:n,flipPlacements:o?.map(S=>Owe(S,d)),offsetDistance:a,offsetSkidding:l,arrowEl:c,type:h})});if(c&&_.arrow){const{x:S,y:C}=_.arrow,T=y.split("-")[0],M=S!=null?"left":"top",I=hjt[T],P={left:"",top:"",bottom:"",right:""};"floatingLayout"in t&&(t.floatingLayout=T==="left"||T==="right"?"horizontal":"vertical"),Object.assign(c.style,{...P,[M]:`${M=="left"?S:C}px`,[T]:"100%",transform:I})}const w=_.hide?.referenceHidden?"hidden":null,x=w?"none":null;i.setAttribute(ajt,y),Object.assign(i.style,{pointerEvents:x,position:v,transform:`translate(${Awe(f)}px,${Awe(m)}px)`,visibility:w})},ajt="data-placement",Mwe=["top","bottom","right","left","top-start","top-end","bottom-start","bottom-end","right-start","right-end","left-start","left-end","leading","trailing","leading-start","leading-end","trailing-start","trailing-end"],cee="bottom-start",ljt="bottom-end",QB={animation:"calcite-floating-ui-anim",animationActive:"calcite-floating-ui-anim--active"};function cjt({placement:t,flipDisabled:e,flipPlacements:i,offsetDistance:r,offsetSkidding:s,arrowEl:n,type:o}){const a=[tjt(),ijt()];return o==="menu"&&a.push($we({fallbackPlacements:i||["top-start","top","top-end","bottom-start","bottom","bottom-end"]})),a.push(QVt({mainAxis:typeof r=="number"?r:0,crossAxis:typeof s=="number"?s:0})),t==="auto"||t==="auto-start"||t==="auto-end"?a.push(ejt({alignment:t==="auto-start"?"start":t==="auto-end"?"end":null})):e||a.push($we(i?{fallbackPlacements:i}:{})),n&&a.push(rjt({element:n})),a}function TUe(t,e){const i=t.filter(r=>Mwe.includes(r));return i.length!==t.length&&console.warn(`${e.tagName}: Invalid value found in: flipPlacements. Try any of these: ${Mwe.map(r=>`"${r}"`).join(", ").trim()}`,{el:e}),i}function Owe(t,e=!1){const i=["left","right"];return e&&i.reverse(),t.replace(/leading/gi,i[0]).replace(/trailing/gi,i[1])}async function EUe(t,e,i=!1){if(!t.open||!e.floatingEl||!e.referenceEl)return;if(Object.assign(e.floatingEl.style,{display:"block",position:e.overlayPositioning??"absolute"}),!z3.get(t))return CUe(t);await(i?ujt(t):SUe)(t,e)}function ujt(t){let e=eV.get(t);return e||(e=hae(SUe,xU.reposition,{leading:!0,maxWait:xU.reposition}),eV.set(t,e),e)}const hjt={top:"",left:"rotate(-90deg)",bottom:"rotate(180deg)",right:"rotate(90deg)"},z3=new WeakMap,eV=new WeakMap;async function CUe(t){const{referenceEl:e,floatingEl:i}=t;if(!i.isConnected)return;const r=KVt;z3.set(t,{state:"pending"});let s;const n=r(e,i,()=>{const o=t.reposition();s||(s=o)});return z3.set(t,{state:"active",cleanUp:n}),s}function wae(t){const{floatingEl:e}=t;e&&Object.assign(e.style,{display:"",pointerEvents:"",position:"",transform:"",visibility:""})}async function lR(t){const{floatingEl:e,referenceEl:i}=t;if(wae(t),!(!e||!i)&&(xae(t),!!t.open))return CUe(t)}function xae(t){const e=z3.get(t);e?.state==="active"&&e.cleanUp(),z3.delete(t),eV.get(t)?.cancel(),eV.delete(t)}const Iwe=4,Rwe=Math.ceil(Math.hypot(Iwe,Iwe));/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */function Pwe(t){return t[t.openProp||"open"]}function Sae(t){requestAnimationFrame(()=>{t.transitionEl&&U5t(t.transitionEl,t.transitionProp,()=>{Pwe(t)?t.onBeforeOpen():t.onBeforeClose()},()=>{Pwe(t)?t.onOpen():t.onClose()})})}/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */function djt(t,e,i){return e?`${t}-${e}`:i?`${t}-${i}`:`${t}-m`}/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const pjt={dropdownTrigger:"trigger"},Dwe={content:"calcite-dropdown-content",wrapper:"calcite-dropdown-wrapper"},fjt=Js`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:inline-block}.calcite-dropdown-wrapper{--calcite-floating-ui-z-index: var(--calcite-z-index-dropdown);inline-size:max-content;display:none;max-inline-size:100vw;max-block-size:100vh;inset-block-start:0;left:0;z-index:var(--calcite-floating-ui-z-index)}.calcite-dropdown-wrapper .calcite-floating-ui-anim{position:relative;transition:var(--calcite-floating-ui-transition);transition-property:inset,left,opacity;opacity:0;box-shadow:0 0 16px #00000029;z-index:var(--calcite-z-index);border-radius:.25rem}.calcite-dropdown-wrapper[data-placement^=bottom] .calcite-floating-ui-anim{inset-block-start:-5px}.calcite-dropdown-wrapper[data-placement^=top] .calcite-floating-ui-anim{inset-block-start:5px}.calcite-dropdown-wrapper[data-placement^=left] .calcite-floating-ui-anim{left:5px}.calcite-dropdown-wrapper[data-placement^=right] .calcite-floating-ui-anim{left:-5px}.calcite-dropdown-wrapper[data-placement] .calcite-floating-ui-anim--active{opacity:1;inset-block-start:0;left:0}.calcite-dropdown-content{max-height:45vh;width:auto;overflow-y:auto;overflow-x:hidden;inline-size:var(--calcite-dropdown-width, var(--calcite-internal-dropdown-width));background-color:var(--calcite-dropdown-background-color, var(--calcite-color-foreground-1))}.calcite-trigger-container{position:relative;display:flex;height:100%;flex:1 1 auto;word-wrap:break-word;word-break:break-word}.width-s{--calcite-internal-dropdown-width: 12rem}.width-m{--calcite-internal-dropdown-width: 14rem}.width-l{--calcite-internal-dropdown-width: 16rem}@media (forced-colors: active){:host([open]) .calcite-dropdown-wrapper{border:var(--calcite-border-width-sm) solid canvasText}}:host([hidden]){display:none}[hidden]{display:none}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}`;class $Ue extends Vn{constructor(){super(),this.focusLastDropdownItem=!1,this.groups=[],this.guid=`calcite-dropdown-${XS()}`,this.items=[],this.mutationObserver=vf("mutation",()=>this.updateItems()),this.transitionProp="opacity",this.resizeObserver=vf("resize",e=>this.resizeObserverCallback(e)),this.closeOnSelectDisabled=!1,this.disabled=!1,this.maxItems=0,this.offsetDistance=0,this.offsetSkidding=0,this.open=!1,this.overlayPositioning="absolute",this.placement=cee,this.scale="m",this.selectedItems=[],this.type="click",this.calciteDropdownBeforeClose=Ut({cancelable:!1}),this.calciteDropdownBeforeOpen=Ut({cancelable:!1}),this.calciteDropdownClose=Ut({cancelable:!1}),this.calciteDropdownOpen=Ut({cancelable:!1}),this.calciteDropdownSelect=Ut({cancelable:!1}),this.listenOn(window,"click",this.closeCalciteDropdownOnClick),this.listen("calciteInternalDropdownCloseRequest",this.closeCalciteDropdownOnEvent),this.listenOn(window,"calciteDropdownOpen",this.closeCalciteDropdownOnOpenEvent),this.listen("pointerenter",this.pointerEnterHandler),this.listen("pointerleave",this.pointerLeaveHandler),this.listen("calciteInternalDropdownItemKeyEvent",this.calciteInternalDropdownItemKeyEvent),this.listen("calciteInternalDropdownItemSelect",this.handleItemSelect)}static{this.properties={closeOnSelectDisabled:[7,{},{reflect:!0,type:Boolean}],disabled:[7,{},{reflect:!0,type:Boolean}],flipPlacements:[0,{},{attribute:!1}],maxItems:[11,{},{reflect:!0,type:Number}],offsetDistance:[11,{},{type:Number,reflect:!0}],offsetSkidding:[11,{},{reflect:!0,type:Number}],open:[7,{},{reflect:!0,type:Boolean}],overlayPositioning:[3,{},{reflect:!0}],placement:[3,{},{reflect:!0}],scale:[3,{},{reflect:!0}],selectedItems:[0,{},{attribute:!1}],type:[3,{},{reflect:!0}],widthScale:[3,{},{reflect:!0}],width:[3,{},{reflect:!0}]}}static{this.shadowRootOptions={mode:"open",delegatesFocus:!0}}static{this.styles=fjt}async reposition(e=!1){const{filteredFlipPlacements:i,floatingEl:r,offsetDistance:s,offsetSkidding:n,overlayPositioning:o,placement:a,referenceEl:l}=this;return EUe(this,{floatingEl:r,referenceEl:l,offsetDistance:s,offsetSkidding:n,overlayPositioning:o,placement:a,flipPlacements:i,type:"menu"},e)}async setFocus(){await dh(this),VG(this.referenceEl)}connectedCallback(){super.connectedCallback(),this.mutationObserver?.observe(this.el,{childList:!0,subtree:!0}),this.setFilteredPlacements(),this.updateItems(),lR(this)}willUpdate(e){e.has("open")&&(this.hasUpdated||this.open!==!1)&&this.openHandler(),e.has("disabled")&&(this.hasUpdated||this.disabled!==!1)&&this.handleDisabledChange(this.disabled),e.has("flipPlacements")&&this.flipPlacementsHandler(),e.has("maxItems")&&this.hasUpdated&&this.setMaxScrollerHeight(),this.hasUpdated&&(e.has("offsetDistance")&&this.offsetDistance!==0||e.has("offsetSkidding")&&this.offsetSkidding!==0||e.has("overlayPositioning")&&this.overlayPositioning!=="absolute"||e.has("placement")&&this.placement!==cee)&&this.reposition(!0),e.has("scale")&&(this.hasUpdated||this.scale!=="m")&&this.handlePropsChange()}updated(){yg(this)}loaded(){this.updateSelectedItems(),lR(this)}disconnectedCallback(){super.disconnectedCallback(),this.mutationObserver?.disconnect(),this.resizeObserver?.disconnect(),xae(this)}openHandler(){Sae(this),!this.disabled&&this.reposition(!0)}handleDisabledChange(e){e||(this.open=!1)}flipPlacementsHandler(){this.setFilteredPlacements(),this.reposition(!0)}handlePropsChange(){this.updateItems(),this.updateGroupProps()}closeCalciteDropdownOnClick(e){this.disabled||!this.open||e.composedPath().includes(this.el)||this.closeCalciteDropdown(!1)}closeCalciteDropdownOnEvent(e){this.closeCalciteDropdown(),e.stopPropagation()}closeCalciteDropdownOnOpenEvent(e){e.composedPath().includes(this.el)||(this.open=!1)}pointerEnterHandler(){this.disabled||this.type!=="hover"||this.toggleDropdown()}pointerLeaveHandler(){this.disabled||this.type!=="hover"||this.closeCalciteDropdown()}getTraversableItems(){return this.items.filter(e=>!e.disabled&&!e.hidden)}calciteInternalDropdownItemKeyEvent(e){const{keyboardEvent:i}=e.detail,r=i.target,s=this.getTraversableItems();switch(i.key){case"Tab":this.open=!1,this.updateTabIndexOfItems(r);break;case"ArrowDown":dk(s,r,"next");break;case"ArrowUp":dk(s,r,"previous");break;case"Home":dk(s,r,"first");break;case"End":dk(s,r,"last");break}e.stopPropagation()}handleItemSelect(e){this.updateSelectedItems(),e.stopPropagation(),this.calciteDropdownSelect.emit(),(!this.closeOnSelectDisabled||e.detail.requestedDropdownGroup.selectionMode==="none")&&this.closeCalciteDropdown(),e.stopPropagation()}setFilteredPlacements(){const{el:e,flipPlacements:i}=this;this.filteredFlipPlacements=i?TUe(i,e):null}updateTriggers(e){this.triggers=e.target.assignedElements({flatten:!0}),this.reposition(!0)}updateItems(){this.items=this.groups.map(e=>Array.from(e?.querySelectorAll("calcite-dropdown-item"))).reduce((e,i)=>[...e,...i],[]),this.updateSelectedItems(),this.reposition(!0),this.items.forEach(e=>e.scale=this.scale)}updateGroups(e){const i=e.target.assignedElements({flatten:!0}).filter(r=>r?.matches("calcite-dropdown-group"));this.groups=i,this.updateItems(),this.updateGroupProps()}updateGroupProps(){this.groups.forEach((e,i)=>{e.scale=this.scale,e.position=i})}resizeObserverCallback(e){e.forEach(i=>{const{target:r}=i;this.hasUpdated&&(r===this.referenceEl?this.setDropdownWidth():r===this.scrollerEl&&this.setMaxScrollerHeight())})}setDropdownWidth(){const{referenceEl:e,scrollerEl:i}=this,r=e?.clientWidth;i.style.minWidth=`${r}px`}setMaxScrollerHeight(){const e=this.getMaxScrollerHeight();this.scrollerEl.style.maxBlockSize=e>0?`${e}px`:"",this.reposition(!0)}setScrollerAndTransitionEl(e){e&&(this.resizeObserver?.observe(e),this.scrollerEl=e,this.transitionEl=e)}onBeforeOpen(){this.calciteDropdownBeforeOpen.emit()}async onOpen(){this.focusOnFirstActiveOrDefaultItem(),this.calciteDropdownOpen.emit()}onBeforeClose(){this.calciteDropdownBeforeClose.emit()}onClose(){this.calciteDropdownClose.emit(),wae(this)}setReferenceEl(e){this.referenceEl=e,lR(this),e&&this.resizeObserver?.observe(e)}setFloatingEl(e){this.floatingEl=e,lR(this)}keyDownHandler(e){if(!e.composedPath().includes(this.referenceEl))return;const{defaultPrevented:i,key:r}=e;if(!i){if(r==="Escape"){this.closeCalciteDropdown(),e.preventDefault();return}if(this.open&&e.shiftKey&&r==="Tab"){this.closeCalciteDropdown(),e.preventDefault();return}cae(r)?(this.toggleDropdown(),e.preventDefault()):(r==="ArrowDown"||r==="ArrowUp")&&(e.preventDefault(),this.focusLastDropdownItem=r==="ArrowUp",this.open=!0)}}updateSelectedItems(){this.selectedItems=this.items.filter(e=>e.selected)}getMaxScrollerHeight(){const{maxItems:e,items:i}=this;return i.length>=e&&e>0?this.getYDistance(this.scrollerEl,i[e-1]):0}getYDistance(e,i){const r=e.getBoundingClientRect();return i.getBoundingClientRect().bottom-r.top}closeCalciteDropdown(e=!0){this.open=!1,e&&P3(this.triggers[0])}focusOnFirstActiveOrDefaultItem(){const i=this.getTraversableItems().find(r=>r.selected)||(this.focusLastDropdownItem?this.items[this.items.length-1]:this.items[0]);this.focusLastDropdownItem=!1,i&&P3(i)}toggleDropdown(){this.open=!this.open}updateTabIndexOfItems(e){this.items.forEach(i=>{i.tabIndex=e!==i?-1:0})}render(){const{open:e,guid:i}=this;return vg({disabled:this.disabled,children:le`<div class="calcite-trigger-container" .id=${`${i}-menubutton`} @click=${this.toggleDropdown} @keydown=${this.keyDownHandler} ${wr(this.setReferenceEl)}><slot aria-controls=${`${i}-menu`} .ariaExpanded=${e} aria-haspopup=menu name=${pjt.dropdownTrigger} @slotchange=${this.updateTriggers}></slot></div><div .ariaHidden=${!e} class=${fe({[Dwe.wrapper]:!0,[djt("width",this.width,this.widthScale)]:!!(this.width||this.widthScale)})} ${wr(this.setFloatingEl)}><div aria-labelledby=${`${i}-menubutton`} class=${fe({[Dwe.content]:!0,[QB.animation]:!0,[QB.animationActive]:e})} .id=${`${i}-menu`} role=menu ${wr(this.setScrollerAndTransitionEl)}><slot @slotchange=${this.updateGroups}></slot></div></div>`})}}Oo("calcite-dropdown",$Ue);const Ffi=Object.freeze(Object.defineProperty({__proto__:null,Dropdown:$Ue},Symbol.toStringTag,{value:"Module"}));/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const sp={button:"button",buttonTextVisible:"button--text-visible",buttonCompact:"button--compact",indicatorText:"indicator-text",iconContainer:"icon-container",slotContainer:"slot-container",slotContainerHidden:"slot-container--hidden",textContainer:"text-container",textContainerVisible:"text-container--visible",indicatorWithIcon:"indicator-with-icon",indicatorWithoutIcon:"indicator-without-icon"},mjt={tooltip:"tooltip"},gjt=Js`:host{box-sizing:border-box;background-color:var(--calcite-color-foreground-1);color:var(--calcite-color-text-2);font-size:var(--calcite-font-size--1)}:host *{box-sizing:border-box}:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:flex;cursor:pointer;background-color:transparent;--calcite-internal-action-text-color: var(--calcite-color-text-3);border-radius:var(--calcite-action-corner-radius, var(--calcite-action-corner-radius-start-start, var(--calcite-corner-radius)) var(--calcite-action-corner-radius-start-end, var(--calcite-corner-radius)) var(--calcite-action-corner-radius-end-end, var(--calcite-corner-radius)) var(--calcite-action-corner-radius-end-start, var(--calcite-corner-radius)))}.interaction-container{border-radius:inherit}:host([drag-handle]){cursor:move;--calcite-internal-action-text-color: var(--calcite-color-border-input);--calcite-internal-action-padding-inline: var(--calcite-spacing-xxs)}.button{border-radius:inherit;position:relative;margin:0;display:flex;inline-size:auto;align-items:center;justify-content:flex-start;border-style:none;font-family:var(--calcite-font-family);font-size:var(--calcite-font-size--2);line-height:1rem;font-weight:var(--calcite-font-weight-medium);outline-color:transparent;background-color:var(--calcite-action-background-color, var(--calcite-color-foreground-1));color:var(--calcite-action-text-color, var(--calcite-internal-action-text-color));text-align:unset;flex:1 0 auto;cursor:inherit}.button:hover{background-color:var(--calcite-action-background-color-hover, var(--calcite-color-foreground-2));color:var(--calcite-action-text-color-press, var(--calcite-action-text-color-pressed, var(--calcite-color-text-1)))}.button:focus{outline:2px solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline-offset:calc(-2px*(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}.button:active{background-color:var(--calcite-action-background-color-press, var(--calcite-action-background-color-pressed, var(--calcite-color-foreground-3)))}.icon-container{pointer-events:none;margin:0;display:flex;align-items:center;justify-content:center;min-inline-size:1rem;min-block-size:1.5rem}.text-container{margin:0;inline-size:0px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;line-height:1.5rem;opacity:0;transition-property:opacity;transition-duration:.15s;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-property:margin;transition-property:inline-size}.text-container--visible{inline-size:auto;flex:1 1 auto;opacity:1}:host([active]) .button,:host([active]) .button:hover,:host([active]) .button:focus{color:var(--calcite-action-text-color-press, var(--calcite-action-text-color-pressed, var(--calcite-color-text-1)));background-color:var(--calcite-action-background-color-press, var(--calcite-action-background-color-pressed, var(--calcite-color-foreground-3)))}:host([active]) .button:active{background-color:var(--calcite-action-background-color, var(--calcite-color-foreground-1))}:host([loading]) .button:hover,:host([loading]) .button:focus{background-color:var(--calcite-action-background-color, var(--calcite-color-foreground-1))}:host([loading]) .text-container{opacity:var(--calcite-opacity-disabled)}:host([loading]) calcite-loader[inline]{margin-inline-end:0px}:host([appearance=transparent]):host([active]) .button{background-color:var(--calcite-color-transparent-press)}:host([appearance=transparent]) .button{background-color:transparent;transition-property:box-shadow;transition-duration:.15s;transition-timing-function:cubic-bezier(.4,0,.2,1)}:host([appearance=transparent]) .button:hover{background-color:var(--calcite-color-transparent-hover)}:host([appearance=transparent]) .button:active{background-color:var(--calcite-color-transparent-press)}:host([data-active]) .button{outline:2px solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline-offset:calc(-2px*(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}:host([scale=s]) .button{font-size:var(--calcite-font-size--2);line-height:1rem;font-weight:var(--calcite-font-weight-normal);padding-inline:var(--calcite-internal-action-padding-inline, .5rem);padding-block:var(--calcite-internal-action-padding-block, var(--calcite-spacing-xxs))}:host([scale=s]) .button--text-visible .icon-container{margin-inline-end:.5rem}:host([scale=m]) .button{font-size:var(--calcite-font-size--1);line-height:1rem;font-weight:var(--calcite-font-weight-normal);padding-inline:var(--calcite-internal-action-padding-inline, 1rem);padding-block:var(--calcite-internal-action-padding-block, var(--calcite-spacing-md))}:host([scale=m]) .button--text-visible .icon-container{margin-inline-end:.75rem}:host([scale=l]) .button{font-size:var(--calcite-font-size-0);line-height:1.25rem;font-weight:var(--calcite-font-weight-normal);padding-inline:var(--calcite-internal-action-padding-inline, 1.25rem);padding-block:var(--calcite-internal-action-padding-block, var(--calcite-spacing-xl))}:host([scale=l]) .button--text-visible .icon-container{margin-inline-end:1rem}:host([alignment=center]) .button{justify-content:center}:host([alignment=end]) .button{justify-content:flex-end}:host([alignment=center]) .button .text-container--visible,:host([alignment=end]) .button .text-container--visible{flex:0 1 auto}:host([scale=s][compact]) .button,:host([scale=m][compact]) .button,:host([scale=l][compact]) .button{padding-inline:0px}.slot-container{display:flex}.slot-container--hidden{display:none}.button--text-visible{inline-size:100%}.indicator-with-icon{position:relative}.indicator-with-icon:after{content:"";position:absolute;block-size:.5rem;inline-size:.5rem;border-radius:9999px;inset-block-end:-.275rem;inset-inline-end:-.275rem;background-color:var(--calcite-action-indicator-color, var(--calcite-color-brand))}.indicator-without-icon{margin-inline:.25rem;inline-size:1rem;position:relative}.indicator-without-icon:after{content:"";position:absolute;block-size:.5rem;inline-size:.5rem;border-radius:9999px;inset-block-end:-.275rem;inset-inline-end:-.275rem;background-color:var(--calcite-action-indicator-color, var(--calcite-color-brand))}.indicator-text{position:absolute;inline-size:1px;block-size:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}:host([hidden]){display:none}[hidden]{display:none}:host([disabled]) .button,:host([disabled]) .button:hover,:host([disabled]) .button:focus{cursor:default;opacity:var(--calcite-opacity-disabled);background-color:var(--calcite-action-background-color, var(--calcite-action-background-color, var(--calcite-color-foreground-1)))}:host([disabled]):host([active]) .button,:host([disabled]):host([active]) .button:hover,:host([disabled]):host([active]) .button:focus{opacity:var(--calcite-opacity-disabled);background-color:var(--calcite-action-background-color-press, var(--calcite-action-background-color-press, var(--calcite-action-background-color-pressed, var(--calcite-color-foreground-3))))}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}`;class AUe extends Vn{constructor(){super(...arguments),this.guid=`calcite-action-${XS()}`,this.buttonEl=Gc(),this.buttonId=`${this.guid}-button`,this.indicatorId=`${this.guid}-indicator`,this.mutationObserver=vf("mutation",()=>this.requestUpdate()),this.messages=Fd({blocking:!0}),this.active=!1,this.appearance="solid",this.compact=!1,this.disabled=!1,this.dragHandle=!1,this.iconFlipRtl=!1,this.indicator=!1,this.loading=!1,this.scale="m",this.textEnabled=!1}static{this.properties={active:[7,{},{reflect:!0,type:Boolean}],alignment:[3,{},{reflect:!0}],appearance:[3,{},{reflect:!0}],compact:[7,{},{reflect:!0,type:Boolean}],disabled:[7,{},{reflect:!0,type:Boolean}],dragHandle:[7,{},{reflect:!0,type:Boolean}],icon:[3,{},{reflect:!0}],iconFlipRtl:[7,{},{reflect:!0,type:Boolean}],indicator:[7,{},{reflect:!0,type:Boolean}],label:1,loading:[7,{},{reflect:!0,type:Boolean}],messageOverrides:[0,{},{attribute:!1}],scale:[3,{},{reflect:!0}],text:1,textEnabled:[7,{},{reflect:!0,type:Boolean}]}}static{this.styles=gjt}async setFocus(){await dh(this),this.buttonEl.value?.focus()}connectedCallback(){super.connectedCallback(),this.mutationObserver?.observe(this.el,{childList:!0,subtree:!0})}updated(){yg(this)}disconnectedCallback(){super.disconnectedCallback(),this.mutationObserver?.disconnect()}handleTooltipSlotChange(e){const r=e.target.assignedElements({flatten:!0}).filter(s=>s?.matches("calcite-tooltip"))[0];r&&(r.referenceElement=this.buttonEl.value)}renderTextContainer(){const{text:e,textEnabled:i}=this,r={[sp.textContainer]:!0,[sp.textContainerVisible]:i};return e?Zi("text-container",le`<div class=${fe(r)}>${e}</div>`):null}renderIndicatorText(){const{indicator:e,messages:i,indicatorId:r,buttonId:s}=this;return le`<div aria-labelledby=${s??Ap} aria-live=polite class=${fe(sp.indicatorText)} id=${r??Ap} role=region>${e?i.indicator:null}</div>`}renderIconContainer(){const{loading:e,icon:i,scale:r,el:s,iconFlipRtl:n,indicator:o}=this,a=r==="l"?"l":"m",l=e?le`<calcite-loader inline .label=${this.messages.loading} .scale=${a}></calcite-loader>`:null,c=i?le`<calcite-icon class=${fe({[sp.indicatorWithIcon]:o})} .flipRtl=${n} .icon=${i} .scale=${Wa(this.scale)}></calcite-icon>`:null,h=l||c,d=h||s.children?.length,f=le`<div class=${fe({[sp.slotContainer]:!0,[sp.slotContainerHidden]:e})}><slot></slot></div>`;return d?Zi("icon-container",le`<div aria-hidden=true class=${fe(sp.iconContainer)}>${h}${f}</div>`):null}renderButton(){const{active:e,compact:i,disabled:r,icon:s,loading:n,textEnabled:o,label:a,text:l,indicator:c,indicatorId:h,buttonId:d,messages:f}=this,m=a||l||"",y=c?f.indicatorLabel.replace("{label}",m):m,v={[sp.button]:!0,[sp.buttonTextVisible]:o,[sp.buttonCompact]:i},_=le`${this.renderIconContainer()}${this.renderTextContainer()}${!s&&c&&Zi("indicator-no-icon",le`<div class=${fe(sp.indicatorWithoutIcon)}></div>`)||""}`;return this.dragHandle?le`<span aria-controls=${(c?h:null)??Ap} .ariaBusy=${n} .ariaDisabled=${this.disabled?this.disabled:null} .ariaLabel=${y} .ariaPressed=${e} class=${fe(v)} id=${d??Ap} role=button tabindex=${(this.disabled?null:0)??Ap} ${wr(this.buttonEl)}>${_}</span>`:le`<button aria-controls=${(c?h:null)??Ap} .ariaBusy=${n} .ariaLabel=${y} .ariaPressed=${e} class=${fe(v)} .disabled=${r} id=${d??Ap} tabindex=${(r?null:0)??Ap} ${wr(this.buttonEl)}>${_}</button>`}render(){return vg({disabled:this.disabled,children:le`${this.renderButton()}<slot name=${mjt.tooltip} @slotchange=${this.handleTooltipSlotChange}></slot>${this.renderIndicatorText()}`})}}Oo("calcite-action",AUe);const yjt=Object.freeze(Object.defineProperty({__proto__:null,Action:AUe},Symbol.toStringTag,{value:"Module"}));/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const d_={container:"container",containerNone:"container--none-selection",icon:"dropdown-item-icon",iconEnd:"dropdown-item-icon--end",iconStart:"dropdown-item-icon--start",itemContent:"dropdown-item-content",link:"dropdown-link"};/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const vjt=Js`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{position:relative;display:flex;flex-grow:1;align-items:center;outline-color:transparent}.container{position:relative;display:flex;flex-grow:1;cursor:pointer;align-items:center;text-decoration-line:none;color:var(--calcite-dropdown-item-text-color, var(--calcite-color-text-3));text-align:start;outline-color:transparent}.container a{outline:none;position:relative;display:flex;flex-grow:1;cursor:pointer;align-items:center;text-decoration-line:none;color:var(--calcite-dropdown-item-text-color, var(--calcite-color-text-3))}.dropdown-item-content{flex:1 1 auto;padding-block:.125rem}.dropdown-item-icon{position:relative;opacity:0;transition-duration:.15s;transition-timing-function:cubic-bezier(.4,0,.2,1);transform:scale(.9)}:host([scale=s]) .container{padding-block:.25rem;padding-inline:.5rem;font-size:var(--calcite-font-size--2);line-height:1rem}:host([scale=s]) .dropdown-item-icon,:host([scale=s]) .dropdown-item-icon--start{padding-inline-end:var(--calcite-spacing-sm)}:host([scale=s]) .dropdown-item-icon--end{padding-inline-start:var(--calcite-spacing-sm)}:host([scale=m]) .container{padding-block:.5rem;padding-inline:.75rem;font-size:var(--calcite-font-size--1);line-height:1rem}:host([scale=m]) .dropdown-item-icon,:host([scale=m]) .dropdown-item-icon--start{padding-inline-end:var(--calcite-spacing-md)}:host([scale=m]) .dropdown-item-icon--end{padding-inline-start:var(--calcite-spacing-md)}:host([scale=l]) .container{padding-block:.625rem;padding-inline:1rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=l]) .dropdown-item-icon,:host([scale=l]) .dropdown-item-icon--start{padding-inline-end:var(--calcite-spacing-lg)}:host([scale=l]) .dropdown-item-icon--end{padding-inline-start:var(--calcite-spacing-lg)}:host(:focus) .container{text-decoration-line:none;outline:2px solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline-offset:calc(-2px*(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}:host(:hover:not([disabled])) .container{background-color:var(--calcite-dropdown-item-background-color-hover, var(--calcite-color-foreground-2))}:host(:active:not([disabled])) .container{background-color:var(--calcite-dropdown-item-background-color-press, var(--calcite-color-foreground-3))}:host(:hover:not([disabled])) .container,:host(:active:not([disabled])) .container{text-decoration-line:none;color:var(--calcite-dropdown-item-text-color-press, var(--calcite-color-text-1))}:host(:hover:not([disabled])) .dropdown-link,:host(:active:not([disabled])) .dropdown-link{color:var(--calcite-dropdown-item-text-color-press, var(--calcite-color-text-1))}:host([selected]) .container:not(.container--none-selection),:host([selected]) .dropdown-link{font-weight:var(--calcite-font-weight-medium);color:var(--calcite-dropdown-item-text-color-press, var(--calcite-color-text-1))}:host([selected]) .container:not(.container--none-selection) calcite-icon,:host([selected]) .dropdown-link calcite-icon{color:var(--calcite-dropdown-item-icon-color-press, var(--calcite-color-brand))}:host(:hover:not([disabled])) .dropdown-item-icon{color:var(--calcite-dropdown-item-icon-color-hover)}:host([selected]) .dropdown-item-icon{opacity:1}:host([hidden]){display:none}[hidden]{display:none}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}`;class MUe extends Vn{constructor(){super(),this.childLink=Gc(),this.disabled=!1,this.scale="m",this.selected=!1,this.selectionMode="single",this.calciteDropdownItemSelect=Ut({cancelable:!1}),this.calciteInternalDropdownCloseRequest=Ut({cancelable:!1}),this.calciteInternalDropdownItemKeyEvent=Ut({cancelable:!1}),this.calciteInternalDropdownItemSelect=Ut({cancelable:!1}),this.listen("click",this.onClick),this.listen("keydown",this.keyDownHandler),this.listenOn(document.body,"calciteInternalDropdownItemChange",this.updateActiveItemOnChange)}static{this.properties={disabled:[7,{},{reflect:!0,type:Boolean}],href:[3,{},{reflect:!0}],iconEnd:[3,{},{reflect:!0}],iconFlipRtl:[3,{},{reflect:!0}],iconStart:[3,{},{reflect:!0}],label:1,rel:[3,{},{reflect:!0}],scale:[3,{},{reflect:!0}],selected:[7,{},{reflect:!0,type:Boolean}],selectionMode:1,target:[3,{},{reflect:!0}]}}static{this.styles=vjt}async setFocus(){await dh(this),this.el?.focus()}connectedCallback(){super.connectedCallback(),this.initialize()}load(){this.initialize()}updated(){yg(this)}onClick(){this.emitRequestedItem()}keyDownHandler(e){switch(e.key){case" ":case"Enter":this.emitRequestedItem(),this.href&&this.childLink.value.click(),e.preventDefault();break;case"Escape":this.calciteInternalDropdownCloseRequest.emit(),e.preventDefault();break;case"Tab":this.calciteInternalDropdownItemKeyEvent.emit({keyboardEvent:e});break;case"ArrowUp":case"ArrowDown":case"Home":case"End":e.preventDefault(),this.calciteInternalDropdownItemKeyEvent.emit({keyboardEvent:e});break}}updateActiveItemOnChange(e){e.composedPath().includes(this.parentDropdownGroupEl)&&(this.requestedDropdownGroup=e.detail.requestedDropdownGroup,this.requestedDropdownItem=e.detail.requestedDropdownItem,this.determineActiveItem()),e.stopPropagation()}initialize(){this.parentDropdownGroupEl=this.el.closest("calcite-dropdown-group"),this.selectionMode==="none"&&(this.selected=!1)}determineActiveItem(){switch(this.selectionMode){case"multiple":this.el===this.requestedDropdownItem&&(this.selected=!this.selected);break;case"single":this.el===this.requestedDropdownItem?this.selected=!0:this.requestedDropdownGroup===this.parentDropdownGroupEl&&(this.selected=!1);break;case"none":this.selected=!1;break}}emitRequestedItem(){this.calciteDropdownItemSelect.emit(),this.calciteInternalDropdownItemSelect.emit({requestedDropdownItem:this.el,requestedDropdownGroup:this.parentDropdownGroupEl})}render(){const{href:e,selectionMode:i,label:r,iconFlipRtl:s}=this,n=le`<calcite-icon class=${fe(d_.iconStart)} .flipRtl=${s==="start"||s==="both"} .icon=${this.iconStart} .scale=${Wa(this.scale)}></calcite-icon>`,o=le`<span class=${fe(d_.itemContent)}><slot></slot></span>`,a=le`<calcite-icon class=${fe(d_.iconEnd)} .flipRtl=${s==="end"||s==="both"} .icon=${this.iconEnd} .scale=${Wa(this.scale)}></calcite-icon>`,l=this.iconStart&&this.iconEnd?[n,o,a]:this.iconStart?[n,o]:this.iconEnd?[o,a]:o,c=e?le`<a .ariaLabel=${r} class=${fe(d_.link)} href=${e??Ap} rel=${this.rel??Ap} tabindex=-1 target=${this.target??Ap} ${wr(this.childLink)}>${l}</a>`:l,h=e?null:i==="single"?"menuitemradio":i==="multiple"?"menuitemcheckbox":"menuitem",d=i!=="none"?jG(this.selected):null,{disabled:f}=this;return this.el.ariaChecked=d,this.el.ariaLabel=e?"":r,this.el.role=h,mj(this.el,"tabIndex",f?-1:0),vg({disabled:f,children:le`<div class=${fe({[d_.container]:!0,[d_.containerNone]:i==="none"})}>${i!=="none"?le`<calcite-icon class=${fe(d_.icon)} .icon=${i==="multiple"?"check":"bullet-point"} .scale=${Wa(this.scale)}></calcite-icon>`:null}${c}</div>`})}}Oo("calcite-dropdown-item",MUe);const kfi=Object.freeze(Object.defineProperty({__proto__:null,DropdownItem:MUe},Symbol.toStringTag,{value:"Module"}));/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const Lwe={title:"dropdown-title",separator:"dropdown-separator"},_jt=Js`:host{display:block}.container{text-align:start}.dropdown-title{margin-block-end:-1px;display:block;cursor:default;overflow-wrap:break-word;border-width:0px;border-block-end-width:1px;border-style:solid;font-weight:var(--calcite-font-weight-bold);border-color:var(--calcite-dropdown-group-border-color, var(--calcite-color-border-3));color:var(--calcite-dropdown-group-title-text-color, var(--calcite-color-text-2))}.dropdown-separator{display:block;block-size:1px;background-color:var(--calcite-dropdown-group-border-color, var(--calcite-color-border-3))}:host([scale=s]){font-size:var(--calcite-font-size--2);line-height:1rem}:host([scale=s]) .dropdown-title{padding:.5rem}:host([scale=m]){font-size:var(--calcite-font-size--1);line-height:1rem}:host([scale=m]) .dropdown-title{padding:.75rem}:host([scale=l]){font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=l]) .dropdown-title{padding:1rem}:host([hidden]){display:none}[hidden]{display:none}`;class OUe extends Vn{constructor(){super(),this.mutationObserver=vf("mutation",()=>this.updateItems()),this.position=-1,this.scale="m",this.selectionMode="single",this.calciteInternalDropdownItemChange=Ut({cancelable:!1}),this.listen("calciteInternalDropdownItemSelect",this.updateActiveItemOnChange)}static{this.properties={groupTitle:[3,{},{reflect:!0}],position:[9,{},{type:Number}],scale:[3,{},{reflect:!0}],selectionMode:[3,{},{reflect:!0}]}}static{this.shadowRootOptions={mode:"open",delegatesFocus:!0}}static{this.styles=_jt}connectedCallback(){super.connectedCallback(),this.updateItems(),this.mutationObserver?.observe(this.el,{childList:!0})}willUpdate(e){e.has("selectionMode")&&(this.hasUpdated||this.selectionMode!=="single")&&this.updateItems()}disconnectedCallback(){super.disconnectedCallback(),this.mutationObserver?.disconnect()}updateActiveItemOnChange(e){this.requestedDropdownGroup=e.detail.requestedDropdownGroup,this.requestedDropdownItem=e.detail.requestedDropdownItem,this.calciteInternalDropdownItemChange.emit({requestedDropdownGroup:this.requestedDropdownGroup,requestedDropdownItem:this.requestedDropdownItem})}updateItems(){Array.from(this.el.querySelectorAll("calcite-dropdown-item")).forEach(e=>e.selectionMode=this.selectionMode)}render(){const e=this.groupTitle?le`<span aria-hidden=true class=${fe(Lwe.title)}>${this.groupTitle}</span>`:null,i=this.position>0?le`<div class=${fe(Lwe.separator)} role=separator></div>`:null;return this.el.ariaLabel=this.groupTitle,this.el.role="group",le`<div class=${fe({[d_.container]:!0})}>${i}${e}<slot></slot></div>`}}Oo("calcite-dropdown-group",OUe);const zfi=Object.freeze(Object.defineProperty({__proto__:null,DropdownGroup:OUe},Symbol.toStringTag,{value:"Module"}));/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const Nwe={handle:"handle",dropdown:"dropdown"},Fwe={drag:"drag",blank:"blank"},V9={label:"{label}",position:"{position}",total:"{total}"},kwe=["top","up","down","bottom"],bjt=Js`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:flex}.dropdown{block-size:100%}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}:host([hidden]){display:none}[hidden]{display:none}`;class wjt extends Vn{constructor(){super(...arguments),this.disabled=!1,this.messages=Fd({blocking:!0}),this.moveToItems=[],this.open=!1,this.overlayPositioning="absolute",this.placement=cee,this.scale="m",this.calciteSortHandleBeforeClose=Ut({cancelable:!1}),this.calciteSortHandleBeforeOpen=Ut({cancelable:!1}),this.calciteSortHandleClose=Ut({cancelable:!1}),this.calciteSortHandleMove=Ut({cancelable:!0}),this.calciteSortHandleOpen=Ut({cancelable:!1}),this.calciteSortHandleReorder=Ut({cancelable:!0})}static{this.properties={hasSetInfo:[16,{},{state:!0}],isSetDisabled:[16,{},{state:!0}],disabled:[7,{},{reflect:!0,type:Boolean}],flipPlacements:[0,{},{attribute:!1}],label:1,messageOverrides:[0,{},{attribute:!1}],messages:[0,{},{attribute:!1}],moveToItems:[0,{},{attribute:!1}],open:[7,{},{reflect:!0,type:Boolean}],overlayPositioning:[3,{},{reflect:!0}],placement:[3,{},{reflect:!0}],scale:[3,{},{reflect:!0}],setPosition:[9,{},{type:Number}],setSize:[9,{},{type:Number}],widthScale:[3,{},{reflect:!0}]}}static{this.styles=bjt}get hasSetInfo(){return typeof this.setPosition=="number"&&typeof this.setSize=="number"}get isSetDisabled(){const{setPosition:e,setSize:i,moveToItems:r}=this;return this.hasSetInfo?e<1||i<1||i<2&&r.length<1:!1}async setFocus(){await dh(this),this.dropdownEl?.setFocus()}willUpdate(e){e.has("open")&&(this.hasUpdated||this.open!==!1)&&this.openHandler()}updated(){yg(this)}openHandler(){if(this.disabled){this.open=!1;return}this.dropdownEl&&(this.dropdownEl.open=this.open)}setDropdownEl(e){e&&(this.dropdownEl=e,this.openHandler())}getLabel(){const{label:e,messages:i,setPosition:r,setSize:s}=this;if(!this.hasSetInfo)return e??"";let n=e?i.repositionLabel.replace(V9.label,e):i.reposition;return n=n.replace(V9.position,r?r.toString():""),n.replace(V9.total,s?s.toString():"")}handleBeforeOpen(e){e.stopPropagation(),this.calciteSortHandleBeforeOpen.emit()}handleOpen(e){e.stopPropagation(),this.calciteSortHandleOpen.emit(),this.open=!0}handleBeforeClose(e){e.stopPropagation(),this.calciteSortHandleBeforeClose.emit()}handleClose(e){e.stopPropagation(),this.calciteSortHandleClose.emit(),this.open=!1}handleReorder(e){this.calciteSortHandleReorder.emit({reorder:e.target.dataset.value})}handleMoveTo(e){const i=e.target.dataset.id,r=this.moveToItems.find(s=>s.id===i);this.calciteSortHandleMove.emit({moveTo:r})}render(){const{disabled:e,flipPlacements:i,open:r,overlayPositioning:s,placement:n,scale:o,widthScale:a}=this,l=this.getLabel(),c=e||this.isSetDisabled;return vg({disabled:e,children:le`<calcite-dropdown class=${fe(Nwe.dropdown)} .disabled=${c} .flipPlacements=${i} @calciteDropdownBeforeClose=${this.handleBeforeClose} @calciteDropdownBeforeOpen=${this.handleBeforeOpen} @calciteDropdownClose=${this.handleClose} @calciteDropdownOpen=${this.handleOpen} .overlayPositioning=${s} .placement=${n} .scale=${o} .widthScale=${a} ${wr(this.setDropdownEl)}><calcite-action .active=${r} appearance=transparent class=${fe(Nwe.handle)} .dragHandle=${!0} .icon=${e?Fwe.blank:Fwe.drag} .label=${l} .scale=${o} slot=trigger .text=${l} title=${l??Ze}></calcite-action>${this.renderGroup()}${this.renderMoveToGroup()}</calcite-dropdown>`})}renderMoveToItem(e){return Zi(e.id,le`<calcite-dropdown-item data-id=${e.id??Ze} .label=${e.label} @calciteDropdownItemSelect=${this.handleMoveTo}>${e.label}</calcite-dropdown-item>`)}renderGroup(){return this.hasSetInfo?Zi("reorder",le`<calcite-dropdown-group .groupTitle=${this.messages.reorder} .scale=${this.scale} selection-mode=none>${this.renderTop()}${this.renderUp()}${this.renderDown()}${this.renderBottom()}</calcite-dropdown-group>`):null}renderMoveToGroup(){const{messages:e,moveToItems:i,scale:r}=this;return i.length?Zi("move-to-items",le`<calcite-dropdown-group .groupTitle=${e.moveTo} .scale=${r} selection-mode=none>${i.map(s=>this.renderMoveToItem(s))}</calcite-dropdown-group>`):null}renderDropdownItem(e,i){return Zi(kwe[e],le`<calcite-dropdown-item data-value=${kwe[e]??Ze} .label=${i} @calciteDropdownItemSelect=${this.handleReorder}>${i}</calcite-dropdown-item>`)}renderTop(){const{setPosition:e}=this;return e!==1&&e!==2?this.renderDropdownItem(0,this.messages.moveToTop):null}renderUp(){return this.setPosition!==1?this.renderDropdownItem(1,this.messages.moveUp):null}renderDown(){return this.setPosition!==this.setSize?this.renderDropdownItem(2,this.messages.moveDown):null}renderBottom(){const{setPosition:e,setSize:i}=this;return e!==i&&e!==i-1?this.renderDropdownItem(3,this.messages.moveToBottom):null}}Oo("calcite-sort-handle",wjt);/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const xjt=Js`:host(.calcite-sortable--ghost){position:relative;overflow:hidden}:host(.calcite-sortable--ghost):before{content:"";position:absolute;inset-block:0px;inset-inline-start:0px;inset-inline-end:0px;z-index:var(--calcite-z-index);box-sizing:border-box;border-width:1px;border-style:dashed;border-color:var(--calcite-color-brand);background-color:var(--calcite-color-foreground-2)}:host(.calcite-sortable--drag){--tw-shadow: 0 6px 20px -4px rgba(0, 0, 0, .1), 0 4px 12px -2px rgba(0, 0, 0, .08);--tw-shadow-colored: 0 6px 20px -4px var(--tw-shadow-color), 0 4px 12px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}`;/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const cr={actionsEnd:"actions-end",actionsStart:"actions-start",description:"description",close:"close",container:"container",containerHover:"container--hover",containerBorder:"container--border",containerBorderSelected:"container--border-selected",containerBorderUnselected:"container--border-unselected",content:"content",contentBottom:"content-bottom",contentContainer:"content-container",contentContainerHasCenterContent:"content-container--has-center-content",contentContainerSelectable:"content-container--selectable",contentContainerUnavailable:"content-container--unavailable",contentContainerWrapper:"content-container-wrapper",contentContainerWrapperBordered:"content-container-wrapper--bordered",contentEnd:"content-end",contentStart:"content-start",customContent:"custom-content",expandedContainer:"expanded-container",dragContainer:"drag-container",gridCell:"grid-cell",icon:"icon",nestedContainer:"nested-container",nestedContainerExpanded:"nested-container--expanded",label:"label",row:"row",selectionContainer:"selection-container",selectionContainerSingle:"selection-container--single",wrapper:"wrapper",wrapperBordered:"wrapper--bordered"},cE={actionsStart:"actions-start",contentStart:"content-start",content:"content",contentBottom:"content-bottom",contentEnd:"content-end",actionsEnd:"actions-end"},Ufi=0,zg={selectedMultiple:"check-square-f",selectedSingle:"circle-inset-large",unselectedMultiple:"square",unselectedSingle:"circle",collapsedLTR:"chevron-right",collapsedRTL:"chevron-left",open:"chevron-down",blank:"blank",close:"x"},zwe="data-test-active";/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const Sjt=Js`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:flex;flex-direction:column}:host([filter-hidden]),:host([closed]){display:none}.wrapper--bordered{border-block-end:1px solid var(--calcite-list-border-color, var(--calcite-color-border-3))}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}.container{box-sizing:border-box;display:flex;flex:1 1 0%;overflow:hidden;background-color:var(--calcite-list-background-color, var(--calcite-color-foreground-1))}.container *{box-sizing:border-box}.container--hover:hover{cursor:pointer;background-color:var(--calcite-list-background-color-hover, var(--calcite-color-foreground-2))}.container:active{background-color:var(--calcite-list-background-color-press, var(--calcite-color-foreground-3))}.container--border{position:relative}.container--border:before{position:absolute;inline-size:var(--calcite-border-width-lg);inset-block:0;inset-inline-start:0;background-color:transparent;content:""}.container--border-selected:before{background-color:var(--calcite-list-selection-border-color, var(--calcite-color-brand))}.container--border-selected:focus{box-shadow:inset var(--calcite-border-width-lg) 0 0 0 var(--calcite-list-selection-border-color, var(--calcite-color-brand))}.nested-container{display:none;flex-direction:column;border-width:0px;border-style:solid;border-color:1px solid var(--calcite-list-border-color, var(--calcite-color-border-3));margin-inline-start:var(--calcite-list-spacing-indent, 1.5rem)}.nested-container--expanded{display:flex}.selection-container{display:flex;padding-block:0px;color:var(--calcite-list-icon-color, var(--calcite-color-border-input))}:host(:not([disabled]):not([selected])) .container:hover .selection-container--single{color:var(--calcite-list-icon-color, var(--calcite-color-border-input))}:host([selected]:hover) .selection-container,:host([selected]:hover) .selection-container--single,:host([selected]) .selection-container{color:var(--calcite-list-icon-color, var(--calcite-color-brand))}.content-container-wrapper{display:flex;flex:1 1 auto}.content-container-wrapper--bordered{border-block-end:1px solid var(--calcite-list-border-color, var(--calcite-color-border-3))}.content-container{display:flex;flex:1 1 auto;-webkit-user-select:none;user-select:none;align-items:stretch;font-weight:var(--calcite-font-weight-normal);color:var(--calcite-list-content-text-color, var(--calcite-color-text-2))}.content-container--unavailable{opacity:var(--calcite-opacity-disabled)}.row,.grid-cell{outline-color:transparent}.row{position:relative}.row:focus,.grid-cell:focus{outline:2px solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline-offset:calc(-2px*(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}.content,.custom-content{display:flex;flex:1 1 auto;flex-direction:column;justify-content:center;line-height:var(--calcite-font-line-height-relative-snug)}.label{color:var(--calcite-list-label-text-color, var(--calcite-color-text-1))}.description{color:var(--calcite-list-description-text-color, var(--calcite-color-text-3))}.icon{align-self:center;color:var(--calcite-list-icon-color, var(--calcite-color-text-3))}.icon:hover,.icon:active{color:var(--calcite-color-text-1)}:host([display-mode=flat][drag-handle]:is([selection-mode=none],[selection-appearance=border])) .drag-container{padding-inline-end:var(--calcite-spacing-xxs)}:host([scale=s]) .actions-start{padding-inline-end:var(--calcite-spacing-sm)}:host([scale=s]) .content-container{gap:var(--calcite-spacing-sm);min-block-size:32px;padding-block:var(--calcite-spacing-xxs);padding-inline-end:var(--calcite-spacing-sm)}:host([scale=s]) .content,:host([scale=s]) .custom-content,:host([scale=s]) .label{font-size:var(--calcite-font-size--2)}:host([scale=s]) .description{font-size:var(--calcite-font-size--3)}:host([scale=s][display-mode=flat]:not([drag-handle])) .container{padding-inline-start:var(--calcite-spacing-sm)}:host([scale=s][display-mode=flat]:not([drag-handle])) .selection-container{padding-inline-end:var(--calcite-spacing-sm)}:host([scale=s][display-mode=flat][drag-handle]) .selection-container{padding-inline:var(--calcite-spacing-xxs) var(--calcite-spacing-sm)}:host([scale=s][display-mode=nested]) .selection-container{padding-inline-end:var(--calcite-spacing-xxs)}:host([scale=s][display-mode=nested][selection-appearance=icon]:not([selection-mode=none]):not([drag-handle])) .container{padding-inline-start:var(--calcite-spacing-sm)}:host([scale=s][display-mode=nested][selection-appearance=icon]:not([selection-mode=none]):not([drag-handle])) .selection-container{padding-inline-end:var(--calcite-spacing-xxs)}:host([scale=s][display-mode=nested][drag-handle]) .selection-container{padding-inline:var(--calcite-spacing-xxs)}:host([scale=m]) .actions-start{padding-inline-end:var(--calcite-spacing-sm)}:host([scale=m]) .content-container{gap:var(--calcite-spacing-sm);min-block-size:40px;padding-block:var(--calcite-spacing-sm);padding-inline-end:var(--calcite-spacing-md)}:host([scale=m]) .content,:host([scale=m]) .custom-content{font-size:var(--calcite-font-size--2)}:host([scale=m]) .label{font-size:var(--calcite-font-size--1)}:host([scale=m]) .description{font-size:var(--calcite-font-size--2)}:host([scale=m][display-mode=flat]) .container{padding-inline-start:var(--calcite-spacing-md)}:host([scale=m][display-mode=flat]) .selection-container{padding-inline-end:var(--calcite-spacing-sm)}:host([scale=m][display-mode=flat][drag-handle]) .container{padding-inline-start:0}:host([scale=m][display-mode=flat][drag-handle]) .selection-container{padding-inline:var(--calcite-spacing-xxs) var(--calcite-spacing-sm)}:host([scale=m][display-mode=nested]) .container{padding-inline-start:var(--calcite-spacing-xxs)}:host([scale=m][display-mode=nested]) .selection-container{padding-inline-end:var(--calcite-spacing-xxs)}:host([scale=m][display-mode=nested][selection-appearance=icon]:not([selection-mode=none]):not([drag-handle])) .container{padding-inline-start:var(--calcite-spacing-md)}:host([scale=m][display-mode=nested][drag-handle]) .container{padding-inline-start:0}:host([scale=m][display-mode=nested][drag-handle]) .selection-container{padding-inline:var(--calcite-spacing-xxs)}:host([scale=l]) .actions-start{padding-inline-end:var(--calcite-spacing-md)}:host([scale=l]) .content-container{gap:var(--calcite-spacing-md);min-block-size:56px;padding-block:.625rem;padding-inline-end:var(--calcite-spacing-lg)}:host([scale=l]) .content,:host([scale=l]) .custom-content,:host([scale=l]) .label{font-size:var(--calcite-font-size-0)}:host([scale=l]) .description{font-size:var(--calcite-font-size--1)}:host([scale=l]) .nested-container{margin-inline-start:1.75rem}:host([scale=l][display-mode=flat]) .container{padding-inline-start:var(--calcite-spacing-lg)}:host([scale=l][display-mode=flat]) .selection-container{padding-inline-end:var(--calcite-spacing-md)}:host([scale=l][display-mode=flat][drag-handle]) .container{padding-inline-start:0}:host([scale=l][display-mode=flat][drag-handle]) .selection-container{padding-inline-end:var(--calcite-spacing-md)}:host([scale=l][display-mode=nested]) .container{padding-inline-start:var(--calcite-spacing-xxs)}:host([scale=l][display-mode=nested][drag-handle]) .container{padding-inline-start:0}:host([scale=l][display-mode=nested][selection-appearance=icon]:not([selection-mode=none]):not([drag-handle])) .container{padding-inline-start:var(--calcite-spacing-lg)}.label,.description,.content-bottom{font-family:var(--calcite-font-family);font-weight:var(--calcite-font-weight-normal);word-wrap:break-word;word-break:break-word}:host([selected]) .label{font-weight:var(--calcite-font-weight-medium)}:host([selected]) .icon{color:var(--calcite-list-icon-color, var(--calcite-color-text-1))}:host([selected]) .description{color:var(--calcite-list-description-text-color, var(--calcite-color-text-2))}.content-start{justify-content:flex-start}.content-end{justify-content:flex-end}.content-start,.content-end{flex:1 1 auto}.content-start ::slotted(calcite-icon),.content-end ::slotted(calcite-icon){align-self:center}.content-bottom{display:flex;flex-direction:column}.content-container--has-center-content .content-start,.content-container--has-center-content .content-end{flex:0 1 auto}.expanded-container{color:var(--calcite-list-icon-color, var(--calcite-color-text-3));padding-inline:var(--calcite-spacing-xxs)}:host(:not([disabled])) .expanded-container:hover{color:var(--calcite-list-icon-color, var(--calcite-color-text-1))}.actions-start,.actions-end,.content-start,.content-end,.selection-container,.drag-container,.expanded-container{display:flex;align-items:center}.actions-start calcite-action,.actions-start calcite-sort-handle,.actions-end calcite-action,.actions-end calcite-sort-handle,.content-start calcite-action,.content-start calcite-sort-handle,.content-end calcite-action,.content-end calcite-sort-handle,.selection-container calcite-action,.selection-container calcite-sort-handle,.drag-container calcite-action,.drag-container calcite-sort-handle,.expanded-container calcite-action,.expanded-container calcite-sort-handle{align-self:stretch}.drag-container,.selection-container,.expanded-container{padding-block-end:var(--calcite-spacing-px)}.expanded-container,.selection-container{cursor:pointer}.actions-start,.actions-end{position:relative;padding:0}.actions-start ::slotted(calcite-action),.actions-start ::slotted(calcite-action-menu),.actions-start ::slotted(calcite-sort-handle),.actions-start ::slotted(calcite-dropdown),.actions-end ::slotted(calcite-action),.actions-end ::slotted(calcite-action-menu),.actions-end ::slotted(calcite-sort-handle),.actions-end ::slotted(calcite-dropdown){align-self:stretch;color:inherit}.row:focus .actions-start,.row:focus .actions-end{inset-block:.125rem}.row:focus .actions-start .close,.row:focus .actions-start ::slotted(calcite-action),.row:focus .actions-start ::slotted(calcite-action-menu),.row:focus .actions-start ::slotted(calcite-sort-handle),.row:focus .actions-start ::slotted(calcite-dropdown),.row:focus .actions-end .close,.row:focus .actions-end ::slotted(calcite-action),.row:focus .actions-end ::slotted(calcite-action-menu),.row:focus .actions-end ::slotted(calcite-sort-handle),.row:focus .actions-end ::slotted(calcite-dropdown){block-size:calc(100% - .25rem)}.row:focus:after,.row:focus:before{position:absolute;content:"";inline-size:.125rem;z-index:var(--calcite-z-index-header);background-color:var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));inset-block:0}.row:focus:before{inset-inline-start:0}.row:focus:after{inset-inline-end:0}.container--border:focus:before{display:none}::slotted(calcite-list:empty){border-block-start-width:0px}:host([hidden]){display:none}[hidden]{display:none}`,j9=new Map;class IUe extends Vn{constructor(){super(),this.actionsEndEl=Gc(),this.actionsStartEl=Gc(),this.containerEl=Gc(),this.contentEl=Gc(),this.defaultSlotEl=Gc(),this.handleGridEl=Gc(),this.messages=Fd(),this.hasActionsEnd=!1,this.hasActionsStart=!1,this.hasContentBottom=!1,this.hasContentEnd=!1,this.hasContentStart=!1,this.hasCustomContent=!1,this.level=null,this.expandable=!1,this.active=!1,this.bordered=!1,this.closable=!1,this.closed=!1,this.disabled=!1,this.dragDisabled=!1,this.dragHandle=!1,this.expanded=!1,this.filterHidden=!1,this.interactionMode=null,this.displayMode="flat",this.moveToItems=[],this.scale="m",this.selected=!1,this.selectionAppearance=null,this.selectionMode=null,this.sortHandleOpen=!1,this.unavailable=!1,this.calciteInternalFocusPreviousItem=Ut({cancelable:!1}),this.calciteInternalListItemActive=Ut({cancelable:!1}),this.calciteInternalListItemChange=Ut({cancelable:!1}),this.calciteInternalListItemSelect=Ut({cancelable:!1}),this.calciteInternalListItemSelectMultiple=Ut({cancelable:!1}),this.calciteInternalListItemToggle=Ut({cancelable:!1}),this.calciteListItemClose=Ut({cancelable:!1}),this.calciteListItemSelect=Ut({cancelable:!1}),this.calciteListItemSortHandleBeforeClose=Ut({cancelable:!1}),this.calciteListItemSortHandleBeforeOpen=Ut({cancelable:!1}),this.calciteListItemSortHandleClose=Ut({cancelable:!1}),this.calciteListItemSortHandleOpen=Ut({cancelable:!1}),this.calciteListItemToggle=Ut({cancelable:!1}),this.listen("calciteInternalListItemGroupDefaultSlotChange",this.handleCalciteInternalListDefaultSlotChanges),this.listen("calciteInternalListDefaultSlotChange",this.handleCalciteInternalListDefaultSlotChanges)}static{this.properties={hasActionsEnd:[16,{},{state:!0}],hasActionsStart:[16,{},{state:!0}],hasContentBottom:[16,{},{state:!0}],hasContentEnd:[16,{},{state:!0}],hasContentStart:[16,{},{state:!0}],hasCustomContent:[16,{},{state:!0}],level:[16,{},{state:!0}],expandable:[16,{},{state:!0}],parentListEl:[16,{},{state:!0}],active:[5,{},{type:Boolean}],bordered:[5,{},{type:Boolean}],closable:[7,{},{reflect:!0,type:Boolean}],closed:[7,{},{reflect:!0,type:Boolean}],description:1,disabled:[7,{},{reflect:!0,type:Boolean}],dragDisabled:[7,{},{reflect:!0,type:Boolean}],dragHandle:[7,{},{reflect:!0,type:Boolean}],expanded:[7,{},{reflect:!0,type:Boolean}],filterHidden:[7,{},{reflect:!0,type:Boolean}],interactionMode:1,label:1,messageOverrides:[0,{},{attribute:!1}],metadata:[0,{},{attribute:!1}],displayMode:[3,{},{reflect:!0}],moveToItems:[0,{},{attribute:!1}],open:[7,{},{reflect:!0,type:Boolean}],scale:[3,{},{reflect:!0}],selected:[7,{},{reflect:!0,type:Boolean}],selectionAppearance:[3,{},{reflect:!0}],selectionMode:[3,{},{reflect:!0}],setPosition:[9,{},{type:Number}],setSize:[9,{},{type:Number}],sortHandleOpen:[7,{},{reflect:!0,type:Boolean}],unavailable:[7,{},{reflect:!0,type:Boolean}],value:1,iconStart:[3,{},{reflect:!0}],iconEnd:[3,{},{reflect:!0}],iconFlipRtl:[3,{},{reflect:!0}]}}static{this.styles=[Sjt,xjt]}get open(){return this.expanded}set open(e){dze.deprecated("property",{name:"open",removalVersion:4,suggested:"expanded"}),this.expanded=e}async setFocus(){await dh(this);const{containerEl:{value:e},parentListEl:i}=this,r=j9.get(i);if(typeof r=="number"){const s=this.getGridCells();s[r]?this.focusCell(s[r]):e?.focus();return}e?.focus()}connectedCallback(){super.connectedCallback();const{el:e}=this;this.parentListEl=e.closest(aP),this.level=jBt(e)+1,this.setSelectionDefaults()}willUpdate(e){e.has("active")&&(this.hasUpdated||this.active!==!1)&&this.activeHandler(this.active),e.has("closed")&&(this.hasUpdated||this.closed!==!1)&&this.handleClosedChange(),e.has("disabled")&&(this.hasUpdated||this.disabled!==!1)&&this.handleDisabledChange(),e.has("expanded")&&(this.hasUpdated||this.expanded!==!1)&&this.handleExpandedChange(),e.has("selected")&&(this.hasUpdated||this.selected!==!1)&&this.handleSelectedChange(),e.has("sortHandleOpen")&&(this.hasUpdated||this.sortHandleOpen!==!1)&&this.sortHandleOpenHandler(),e.has("displayMode")&&this.hasUpdated&&this.handleExpandableChange(this.defaultSlotEl.value)}updated(){yg(this)}activeHandler(e){e||this.focusCell(null,!1)}handleClosedChange(){this.emitCalciteInternalListItemChange()}handleDisabledChange(){this.emitCalciteInternalListItemChange()}handleExpandedChange(){this.emitCalciteInternalListItemToggle()}handleSelectedChange(){this.calciteInternalListItemSelect.emit()}sortHandleOpenHandler(){this.sortHandleEl&&(this.sortHandleEl.open=this.sortHandleOpen)}handleCalciteInternalListDefaultSlotChanges(e){e.stopPropagation(),this.handleExpandableChange(this.defaultSlotEl.value)}setSortHandleEl(e){this.sortHandleEl=e,this.sortHandleOpenHandler()}handleSortHandleBeforeOpen(e){e.stopPropagation(),this.calciteListItemSortHandleBeforeOpen.emit()}handleSortHandleBeforeClose(e){e.stopPropagation(),this.calciteListItemSortHandleBeforeClose.emit()}handleSortHandleClose(e){e.stopPropagation(),this.sortHandleOpen=!1,this.calciteListItemSortHandleClose.emit()}handleSortHandleOpen(e){e.stopPropagation(),this.sortHandleOpen=!0,this.calciteListItemSortHandleOpen.emit()}emitInternalListItemActive(){this.calciteInternalListItemActive.emit()}emitCalciteInternalListItemToggle(){this.calciteInternalListItemToggle.emit()}emitCalciteInternalListItemChange(){this.calciteInternalListItemChange.emit()}handleCloseClick(){this.closed=!0,this.calciteListItemClose.emit()}handleContentSlotChange(e){this.hasCustomContent=$s(e)}handleActionsStartSlotChange(e){this.hasActionsStart=$s(e)}handleActionsEndSlotChange(e){this.hasActionsEnd=$s(e)}handleContentStartSlotChange(e){this.hasContentStart=$s(e)}handleContentEndSlotChange(e){this.hasContentEnd=$s(e)}handleContentBottomSlotChange(e){this.hasContentBottom=$s(e)}setSelectionDefaults(){const{parentListEl:e,selectionMode:i,selectionAppearance:r}=this;e&&(i||(this.selectionMode=e.selectionMode),r||(this.selectionAppearance=e.selectionAppearance))}handleExpandableChange(e){if(!e)return;const i=BBt(e);i.lists.forEach(r=>{r.displayMode=this.displayMode}),this.expandable=this.displayMode==="nested"&&(i.lists.length>0||i.items.length>0)}handleDefaultSlotChange(e){this.handleExpandableChange(e.target)}handleToggleClick(){this.toggle()}toggle(e=!this.expanded){this.expanded=e,this.calciteListItemToggle.emit()}handleItemClick(e){e.defaultPrevented||this.toggleSelected(e.shiftKey)}async toggleSelected(e){const{selectionMode:i,selected:r}=this;this.disabled||(i==="multiple"||i==="single"?this.selected=!r:i==="single-persist"&&(this.selected=!0),this.calciteInternalListItemSelectMultiple.emit({selectMultiple:e&&i==="multiple"}),await this.updateComplete,this.calciteListItemSelect.emit())}getGridCells(){return[this.handleGridEl.value,this.actionsStartEl.value,this.contentEl.value,this.actionsEndEl.value].filter(e=>e&&!e.hidden)}handleItemKeyDown(e){if(e.defaultPrevented)return;const{key:i}=e,r=e.composedPath(),{containerEl:{value:s},actionsStartEl:{value:n},actionsEndEl:{value:o},expanded:a,expandable:l}=this,c=this.getGridCells(),h=c.findIndex(d=>r.includes(d));if(i==="Enter"&&!r.includes(n)&&!r.includes(o))e.preventDefault(),this.toggleSelected(e.shiftKey);else if(i==="ArrowRight"){e.preventDefault();const d=h+1;h===-1?!a&&l?(this.toggle(!0),this.focusCell(null)):c[0]&&this.focusCell(c[0]):c[h]&&c[d]&&this.focusCell(c[d])}else if(i==="ArrowLeft"){e.preventDefault();const d=h-1;h===-1?(this.focusCell(null),a&&l?this.toggle(!1):this.calciteInternalFocusPreviousItem.emit()):h===0?(this.focusCell(null),s.focus()):c[h]&&c[d]&&this.focusCell(c[d])}}focusCellNull(){this.focusCell(null)}setFocusCell(e,i,r){const{parentListEl:s}=this;r&&j9.set(s,null);const n=this.getGridCells();n.forEach(o=>{o.removeAttribute("tabindex"),o.removeAttribute(zwe)}),e&&(e===i?e.tabIndex=0:e.removeAttribute("tabindex"),e.setAttribute(zwe,""),r&&j9.set(s,n.indexOf(e)))}focusCell(e,i=!0){const r=uze(e);this.setFocusCell(e,r,i),r?.focus()}renderSelected(){const{selected:e,selectionMode:i,selectionAppearance:r}=this;return i==="none"||r==="border"?null:Zi("selection-container",le`<div class=${fe({[cr.selectionContainer]:!0,[cr.selectionContainerSingle]:i==="single"||i==="single-persist"})} @click=${this.handleItemClick}><calcite-icon .icon=${e?i==="multiple"?zg.selectedMultiple:zg.selectedSingle:i==="multiple"?zg.unselectedMultiple:zg.unselectedSingle} .scale=${Wa(this.scale)}></calcite-icon></div>`)}renderDragHandle(){const{label:e,dragHandle:i,dragDisabled:r,setPosition:s,setSize:n,moveToItems:o}=this;return i?Zi("drag-handle-container",le`<div .ariaLabel=${e} class=${fe({[cr.dragContainer]:!0,[cr.gridCell]:!0})} role=gridcell ${wr(this.handleGridEl)}><calcite-sort-handle .disabled=${r} .label=${e} .moveToItems=${o} @calciteSortHandleBeforeClose=${this.handleSortHandleBeforeClose} @calciteSortHandleBeforeOpen=${this.handleSortHandleBeforeOpen} @calciteSortHandleClose=${this.handleSortHandleClose} @calciteSortHandleOpen=${this.handleSortHandleOpen} overlay-positioning=fixed .scale=${this.scale} .setPosition=${s} .setSize=${n} ${wr(this.setSortHandleEl)}></calcite-sort-handle></div>`):null}renderExpanded(){const{el:e,expanded:i,expandable:r,messages:s,displayMode:n,scale:o}=this;if(n!=="nested")return null;const a=oL(e),l=r?i?zg.open:a==="rtl"?zg.collapsedRTL:zg.collapsedLTR:zg.blank,c=Wa(o),h=r?i?s.collapse:s.expand:void 0,d=r?this.handleToggleClick:void 0;return Zi("expanded-container",le`<div class=${fe(cr.expandedContainer)} @click=${d} title=${h??Ze}>${Zi(l,le`<calcite-icon .icon=${l} .scale=${c}></calcite-icon>`)}</div>`)}renderActionsStart(){const{label:e,hasActionsStart:i}=this;return Zi("actions-start-container",le`<div .ariaLabel=${e} class=${fe({[cr.actionsStart]:!0,[cr.gridCell]:!0})} .hidden=${!i} role=gridcell ${wr(this.actionsStartEl)}><slot name=${cE.actionsStart} @slotchange=${this.handleActionsStartSlotChange}></slot></div>`)}renderActionsEnd(){const{label:e,hasActionsEnd:i,closable:r,messages:s}=this;return Zi("actions-end-container",le`<div .ariaLabel=${e} class=${fe({[cr.actionsEnd]:!0,[cr.gridCell]:!0})} .hidden=${!(i||r)} role=gridcell ${wr(this.actionsEndEl)}><slot name=${cE.actionsEnd} @slotchange=${this.handleActionsEndSlotChange}></slot>${r?Zi("close-action",le`<calcite-action appearance=transparent class=${fe(cr.close)} .icon=${zg.close} .label=${s.close} @click=${this.handleCloseClick} .scale=${this.scale} .text=${s.close}></calcite-action>`):null}</div>`)}renderContentStart(){const{hasContentStart:e}=this;return le`<div class=${fe(cr.contentStart)} .hidden=${!e}><slot name=${cE.contentStart} @slotchange=${this.handleContentStartSlotChange}></slot></div>`}renderCustomContent(){const{hasCustomContent:e}=this;return le`<div class=${fe(cr.customContent)} .hidden=${!e}><slot name=${cE.content} @slotchange=${this.handleContentSlotChange}></slot></div>`}renderIconStart(){const{iconStart:e,iconFlipRtl:i,scale:r}=this;return e?Zi("icon-start",le`<calcite-icon class=${fe(cr.icon)} .flipRtl=${i==="both"||i==="start"} .icon=${e} .scale=${Wa(r)}></calcite-icon>`):null}renderIconEnd(){const{iconEnd:e,iconFlipRtl:i,scale:r}=this;return e?Zi("icon-end",le`<calcite-icon class=${fe(cr.icon)} .flipRtl=${i==="both"||i==="end"} .icon=${e} .scale=${Wa(r)}></calcite-icon>`):null}renderContentEnd(){const{hasContentEnd:e}=this;return le`<div class=${fe(cr.contentEnd)} .hidden=${!e}><slot name=${cE.contentEnd} @slotchange=${this.handleContentEndSlotChange}></slot></div>`}renderContentBottom(){const{hasContentBottom:e}=this;return le`<div class=${fe(cr.contentBottom)} .hidden=${!e}><slot name=${cE.contentBottom} @slotchange=${this.handleContentBottomSlotChange}></slot></div>`}renderDefaultContainer(){return le`<div class=${fe({[cr.nestedContainer]:!0,[cr.nestedContainerExpanded]:this.expandable&&this.expanded})}><slot @slotchange=${this.handleDefaultSlotChange} ${wr(this.defaultSlotEl)}></slot></div>`}renderContentProperties(){const{label:e,description:i,hasCustomContent:r}=this;return!r&&(e||i)?Zi("content",le`<div class=${fe(cr.content)}>${e?Zi("label",le`<div class=${fe(cr.label)}>${e}</div>`):null}${i?Zi("description",le`<div class=${fe(cr.description)}>${i}</div>`):null}</div>`):null}renderContentContainer(){const{description:e,label:i,selectionMode:r,hasCustomContent:s,unavailable:n}=this,o=s||!!i||!!e,a=[this.renderContentStart(),this.renderCustomContent(),this.renderIconStart(),this.renderContentProperties(),this.renderIconEnd(),this.renderContentEnd()];return Zi("content-container",le`<div .ariaLabel=${i} class=${fe({[cr.gridCell]:!0,[cr.contentContainer]:!0,[cr.contentContainerUnavailable]:n,[cr.contentContainerSelectable]:r!=="none",[cr.contentContainerHasCenterContent]:o})} @click=${this.handleItemClick} role=gridcell ${wr(this.contentEl)}>${a}</div>`)}render(){const{expandable:e,expanded:i,level:r,active:s,label:n,selected:o,selectionAppearance:a,selectionMode:l,interactionMode:c,closed:h,filterHidden:d,bordered:f,disabled:m,hasContentBottom:y}=this,v=f&&y,_=f&&!y,b=l!=="none"&&a==="border",w=b&&o,x=b&&!o,S=c==="interactive"||c==="static"&&l!=="none"&&a==="border";return vg({disabled:m,children:le`<div class=${fe({[cr.wrapper]:!0,[cr.wrapperBordered]:v})}><div .ariaExpanded=${e?i:null} .ariaLabel=${n} .ariaLevel=${r} .ariaSelected=${o} class=${fe({[cr.row]:!0,[cr.container]:!0,[cr.containerHover]:S,[cr.containerBorder]:b,[cr.containerBorderSelected]:w,[cr.containerBorderUnselected]:x})} .hidden=${h||d} @focus=${this.focusCellNull} @focusin=${this.emitInternalListItemActive} @keydown=${this.handleItemKeyDown} role=row .tabIndex=${s?0:-1} ${wr(this.containerEl)}>${this.renderDragHandle()}${this.renderSelected()}${this.renderExpanded()}<div class=${fe({[cr.contentContainerWrapper]:!0,[cr.contentContainerWrapperBordered]:_})}>${this.renderActionsStart()}${this.renderContentContainer()}${this.renderActionsEnd()}</div></div>${this.renderContentBottom()}</div>${this.renderDefaultContainer()}`})}}Oo("calcite-list-item",IUe);const Bfi=Object.freeze(Object.defineProperty({__proto__:null,ListItem:IUe},Symbol.toStringTag,{value:"Module"}));/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const Uwe={brand:"lightbulb",danger:"exclamationMarkTriangle",info:"information",success:"checkCircle",warning:"exclamationMarkTriangle"};/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const vk={title:"title",message:"message",link:"link",actionsEnd:"actions-end"},oO={actionsEnd:"actions-end",close:"notice-close",container:"container",content:"notice-content",icon:"notice-icon"},Tjt=Js`:host([scale=s]){--calcite-notice-spacing-token-small: .5rem;--calcite-notice-spacing-token-large: .75rem}:host([scale=s]) .container slot[name=title]::slotted(*),:host([scale=s]) .container *::slotted([slot=title]){margin-block:.125rem;font-size:var(--calcite-font-size--1);line-height:1.375}:host([scale=s]) .container slot[name=message]::slotted(*),:host([scale=s]) .container *::slotted([slot=message]){margin-block:.125rem;font-size:var(--calcite-font-size--2);line-height:1.375}:host([scale=s]) ::slotted(calcite-link){margin-block:.125rem;font-size:var(--calcite-font-size--2);line-height:1.375}:host([scale=s]) .notice-close{padding:.5rem}:host([scale=m]){--calcite-notice-spacing-token-small: .75rem;--calcite-notice-spacing-token-large: 1rem}:host([scale=m]) .container slot[name=title]::slotted(*),:host([scale=m]) .container *::slotted([slot=title]){margin-block:.125rem;font-size:var(--calcite-font-size-0);line-height:1.375}:host([scale=m]) .container slot[name=message]::slotted(*),:host([scale=m]) .container *::slotted([slot=message]){margin-block:.125rem;font-size:var(--calcite-font-size--1);line-height:1.375}:host([scale=m]) ::slotted(calcite-link){margin-block:.125rem;font-size:var(--calcite-font-size--1);line-height:1.375}:host([scale=l]){--calcite-notice-spacing-token-small: 1rem;--calcite-notice-spacing-token-large: 1.25rem}:host([scale=l]) .container slot[name=title]::slotted(*),:host([scale=l]) .container *::slotted([slot=title]){margin-block:.125rem;font-size:var(--calcite-font-size-1);line-height:1.375}:host([scale=l]) .container slot[name=message]::slotted(*),:host([scale=l]) .container *::slotted([slot=message]){margin-block:.125rem;font-size:var(--calcite-font-size-0);line-height:1.375}:host([scale=l]) ::slotted(calcite-link){margin-block:.125rem;font-size:var(--calcite-font-size-0);line-height:1.375}:host([width=auto]){--calcite-notice-width: auto}:host([width=half]){--calcite-notice-width: 50%}:host([width=full]){--calcite-notice-width: 100%}:host{margin-inline:auto;display:none;max-inline-size:100%;align-items:center;inline-size:var(--calcite-notice-width)}.container{pointer-events:none;margin-block:0px;box-sizing:border-box;display:flex;inline-size:100%;opacity:0;overflow:hidden;max-block-size:0;transition-property:opacity,max-block-size;transition-duration:var(--calcite-animation-timing);text-align:start;border-inline-start:var(--calcite-border-width-md) solid;box-shadow:0 0 0 0 transparent;background-color:var(--calcite-notice-background-color, var(--calcite-color-foreground-1))}.notice-close{outline-color:transparent}.notice-close:focus{outline:2px solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline-offset:calc(-2px*(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}:host{display:flex}:host([open]) .container{pointer-events:auto;max-block-size:100%;align-items:center;opacity:1;--tw-shadow: 0 4px 8px -1px rgba(0, 0, 0, .08), 0 2px 4px -1px rgba(0, 0, 0, .04);--tw-shadow-colored: 0 4px 8px -1px var(--tw-shadow-color), 0 2px 4px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow);overflow:visible}.container slot[name=title]::slotted(*),.container *::slotted([slot=title]){margin:0;font-weight:var(--calcite-font-weight-medium);color:var(--calcite-notice-title-text-color, var(--calcite-color-text-1))}.container slot[name=message]::slotted(*),.container *::slotted([slot=message]){margin:0;display:inline;font-weight:var(--calcite-font-weight-normal);margin-inline-end:var(--calcite-notice-spacing-token-small);color:var(--calcite-notice-content-text-color, var(--calcite-color-text-2))}.notice-content{box-sizing:border-box;transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out;padding-inline:var(--calcite-notice-spacing-token-large);flex:0 0 auto;display:flex;min-inline-size:0px;flex-direction:column;overflow-wrap:break-word;flex:1 1 0;padding-block:var(--calcite-notice-spacing-token-small);padding-inline:0 var(--calcite-notice-spacing-token-small)}.notice-content:first-of-type:not(:only-child){padding-inline-start:var(--calcite-notice-spacing-token-large)}.notice-content:only-of-type{padding-block:var(--calcite-notice-spacing-token-small);padding-inline:var(--calcite-notice-spacing-token-large)}.notice-icon{display:flex;align-items:center;box-sizing:border-box;transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out;padding-block:var(--calcite-notice-spacing-token-small);padding-inline:var(--calcite-notice-spacing-token-large);flex:0 0 auto}.notice-close{display:flex;cursor:pointer;align-items:center;align-self:stretch;border-style:none;background-color:transparent;outline:2px solid transparent;outline-offset:2px;box-sizing:border-box;transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out;padding-block:var(--calcite-notice-spacing-token-small);padding-inline:var(--calcite-notice-spacing-token-large);flex:0 0 auto;-webkit-appearance:none;color:var(--calcite-notice-close-icon-color, var(--calcite-color-text-3))}.notice-close:hover,.notice-close:focus{background-color:var(--calcite-notice-close-background-color-focus, var(--calcite-color-foreground-2));color:var(--calcite-notice-close-icon-color-hover, var(--calcite-color-text-1))}.notice-close:active{background-color:var(--calcite-notice-close-background-color-press, var(--calcite-color-foreground-3))}.actions-end{display:flex;align-self:stretch}:host([kind=brand]) .container{border-color:var(--calcite-color-brand)}:host([kind=brand]) .container .notice-icon{color:var(--calcite-color-brand)}:host([kind=info]) .container{border-color:var(--calcite-color-status-info)}:host([kind=info]) .container .notice-icon{color:var(--calcite-color-status-info)}:host([kind=danger]) .container{border-color:var(--calcite-color-status-danger)}:host([kind=danger]) .container .notice-icon{color:var(--calcite-color-status-danger)}:host([kind=success]) .container{border-color:var(--calcite-color-status-success)}:host([kind=success]) .container .notice-icon{color:var(--calcite-color-status-success)}:host([kind=warning]) .container{border-color:var(--calcite-color-status-warning)}:host([kind=warning]) .container .notice-icon{color:var(--calcite-color-status-warning)}:host([hidden]){display:none}[hidden]{display:none}`;class RUe extends Vn{constructor(){super(...arguments),this.closeButton=Gc(),this.transitionProp="opacity",this.messages=Fd(),this.hasActionEnd=!1,this.closable=!1,this.iconFlipRtl=!1,this.kind="brand",this.open=!1,this.scale="m",this.width="auto",this.calciteNoticeBeforeClose=Ut({cancelable:!1}),this.calciteNoticeBeforeOpen=Ut({cancelable:!1}),this.calciteNoticeClose=Ut({cancelable:!1}),this.calciteNoticeOpen=Ut({cancelable:!1})}static{this.properties={hasActionEnd:[16,{},{state:!0}],closable:[7,{},{reflect:!0,type:Boolean}],icon:[3,{converter:ZP},{reflect:!0}],iconFlipRtl:[7,{},{reflect:!0,type:Boolean}],kind:[3,{},{reflect:!0}],messageOverrides:[0,{},{attribute:!1}],open:[7,{},{reflect:!0,type:Boolean}],scale:[3,{},{reflect:!0}],width:[3,{},{reflect:!0}]}}static{this.styles=Tjt}async setFocus(){await dh(this);const e=this.el.querySelector("calcite-link");if(!(!this.closeButton.value&&!e)){if(e)return e.setFocus();this.closeButton.value&&this.closeButton.value.focus()}}async load(){this.requestedIcon=rA(Uwe,this.icon,this.kind)}willUpdate(e){e.has("open")&&(this.hasUpdated||this.open!==!1)&&Sae(this),(e.has("icon")||e.has("kind")&&(this.hasUpdated||this.kind!=="brand"))&&(this.requestedIcon=rA(Uwe,this.icon,this.kind))}onBeforeClose(){this.calciteNoticeBeforeClose.emit()}onBeforeOpen(){this.calciteNoticeBeforeOpen.emit()}onClose(){this.calciteNoticeClose.emit()}onOpen(){this.calciteNoticeOpen.emit()}setTransitionEl(e){e&&(this.transitionEl=e)}close(){this.open=!1}handleActionsEndSlotChange(e){this.hasActionEnd=$s(e)}render(){const e=le`<button .ariaLabel=${this.messages.close} class=${fe(oO.close)} @click=${this.close} ${wr(this.closeButton)}><calcite-icon icon=x .scale=${Wa(this.scale)}></calcite-icon></button>`;return le`<div class=${fe(oO.container)} ${wr(this.setTransitionEl)}>${this.requestedIcon?le`<div class=${fe(oO.icon)}><calcite-icon .flipRtl=${this.iconFlipRtl} .icon=${this.requestedIcon} .scale=${Wa(this.scale)}></calcite-icon></div>`:null}<div class=${fe(oO.content)}><slot name=${vk.title}></slot><slot name=${vk.message}></slot><slot name=${vk.link}></slot></div><div class=${fe(oO.actionsEnd)} .hidden=${!this.hasActionEnd}><slot name=${vk.actionsEnd} @slotchange=${this.handleActionsEndSlotChange}></slot></div>${this.closable?e:null}</div>`}}Oo("calcite-notice",RUe);const Vfi=Object.freeze(Object.defineProperty({__proto__:null,Notice:RUe},Symbol.toStringTag,{value:"Module"}));var Ejt=Object.defineProperty,Cjt=Object.getOwnPropertyDescriptor,WA=(t,e,i,r)=>{for(var s=r>1?void 0:r?Cjt(e,i):e,n=t.length-1,o;n>=0;n--)(o=t[n])&&(s=(r?o(e,i,s):o(s))||s);return r&&s&&Ejt(e,i,s),s};let kb=class extends Xp{constructor(){super(...arguments),this.view=null,this.otherView=null,this.layers=[],this.inputUrl="",this.error="",this._layersWatcher=null,this._otherLayersWatcher=null}updated(t){if(t.has("view")&&this.view){if(!this.otherView){const e=window.appViews;e&&(e.mapView===this.view||e.sceneView===this.view)&&(this.otherView=e.mapView===this.view?e.sceneView:e.mapView)}this.refreshLayers(),this.view.ui.find(e=>e===this)||(this.view.ui.add(this,"manual"),this.style.position="absolute",this.style.left="50%",this.style.bottom="30px",this.style.transform="translateX(-50%)"),this.view.when&&this.view.when(()=>{this.refreshLayers()}),this.view.map&&this.view.map.layers&&!this._layersWatcher&&(this._layersWatcher=this.view.map.layers.on("change",()=>this.refreshLayers())),setTimeout(()=>this.refreshLayers(),0)}}disconnectedCallback(){super.disconnectedCallback(),this._layersWatcher?.remove?.(),this._otherLayersWatcher?.remove?.()}refreshLayers(){if(!this.view||!this.view.map){this.layers=[];return}this.layers=this.view.map.layers.toArray()}async handleAddLayer(){this.error="";const t=this.inputUrl.trim();if(!t)return;let e=null;try{const r=await fetch(t+(t.includes("?")?"&":"?")+"f=json");if(!r.ok)throw new Error("Service not found");if(e=await r.json(),e.error)throw new Error(e.error.message||"Service error")}catch(r){this.error="Could not load service: "+(r?.message||r);return}let i;try{e.type==="Feature Layer"||/FeatureServer/i.test(t)?i=(await V(async()=>{const{default:r}=await Promise.resolve().then(()=>ok);return{default:r}},void 0)).default:e.type==="Map Service"||/MapServer/i.test(t)?i=(await V(async()=>{const{default:r}=await import("./MapImageLayer-DqW1aytC.js");return{default:r}},__vite__mapDeps([388,389,375,376,41,39,40,109,169,205,167,390]))).default:e.type==="Image Service"||/ImageServer/i.test(t)?i=(await V(async()=>{const{default:r}=await import("./ImageryLayer-B6RnnUDZ.js");return{default:r}},__vite__mapDeps([391,195,392,79,80,81,3,8,104,105,390,199,393,376,41,39,40,109]))).default:e.type==="Scene Service"||/SceneServer/i.test(t)?i=(await V(async()=>{const{default:r}=await import("./SceneLayer-D3aN2zdt.js");return{default:r}},__vite__mapDeps([394,395,373,396,247,121,246,248,122,255,256,88,77,170]))).default:/VectorTileServer/i.test(t)?i=(await V(async()=>{const{default:r}=await import("./VectorTileLayer-Cd1iYfz-.js");return{default:r}},__vite__mapDeps([397,114,115,116,94]))).default:/TileServer/i.test(t)||/\/tiles\//i.test(t)?i=(await V(async()=>{const{default:r}=await import("./TileLayer-Bggtom7-.js");return{default:r}},__vite__mapDeps([398,114,115,116,389,375,376,41,39,40,109,169,390]))).default:i=(await V(async()=>{const{default:r}=await Promise.resolve().then(()=>ok);return{default:r}},void 0)).default}catch(r){this.error="Could not load layer type: "+(r?.message||r);return}try{const r=new i({url:t});if(this.view.map.add(r),this.otherView&&this.otherView.map&&!this.otherView.map.layers.find(s=>s.url===t)){const s=new i({url:t});this.otherView.map.add(s)}r.when(()=>this.refreshLayers()),this.inputUrl=""}catch(r){this.error="Could not add layer: "+(r?.message||r)}}handleInput(t){this.inputUrl=t.target.value}handleRemoveLayer(t){try{const e=t.url;if(this.view&&this.view.map&&e){const i=this.view.map.layers.find(r=>r.url===e);i&&this.view.map.layers.remove(i)}if(this.otherView&&this.otherView.map&&e){const i=this.otherView.map.layers.find(r=>r.url===e);i&&this.otherView.map.layers.remove(i)}this.refreshLayers()}catch(e){this.error="Could not remove layer: "+(e?.message||e)}}async handleLayerChange(t,e){if(!(!e||!e.map)){if(t.added&&t.added.length){for(const i of t.added)if(i.url&&!e.map.layers.find(r=>r.url===i.url)){let r;try{r=i.declaredClass?(await V(()=>import(`@arcgis/core/layers/${i.declaredClass.split(".").pop()}`),[])).default:(await V(async()=>{const{default:s}=await Promise.resolve().then(()=>ok);return{default:s}},void 0)).default}catch{r=(await V(async()=>{const{default:s}=await Promise.resolve().then(()=>ok);return{default:s}},void 0)).default}try{const s=new r({url:i.url});e.map.layers.add(s)}catch(s){this.error="Could not sync added layer: "+(s?.message||s)}}}if(t.removed&&t.removed.length){for(const i of t.removed)if(i.url){const r=e.map.layers.find(s=>s.url===i.url);r&&e.map.layers.remove(r)}}this.refreshLayers()}}async showFeatureLayerExtent(t){if(!(!t||!t.queryExtent))try{const e=await t.queryExtent();if(e&&e.extent){const i=new Ml({geometry:gi.fromJSON(e.extent.toJSON()),symbol:{type:"simple-fill",color:[0,0,255,.08],outline:{color:[0,0,255,1],width:2}},popupTemplate:{title:"FeatureLayer Query Extent",content:`<pre>${JSON.stringify(e.extent.toJSON(),null,2)}</pre>`}});let r=this.view.map.findLayerById("feature-query-extent-layer");if(!r){const[s]=await Promise.all([V(()=>import("./GraphicsLayer-BaW3rFbI.js"),[])]);r=new s.default({id:"feature-query-extent-layer"}),this.view.map.add(r)}r.removeAll(),r.add(i),await this.view.goTo(e.extent),this.view.popup&&typeof this.view.popup.open=="function"&&this.view.popup.open({features:[i],location:e.extent.center})}}catch(e){this.error="Could not show query extent: "+(e?.message||e)}}render(){return le`
      <div class="layer-list">
        <calcite-list>
          ${this.layers.length===0?le`<calcite-list-item disabled><span slot="content"><div class="empty">No operational layers</div></span></calcite-list-item>`:this.layers.map(t=>le`
                  <calcite-list-item
                    label=${t.title||t.id||t.url||"Layer"}
                    description=${t.url||""}
                    value=${t.id||t.url||""}
                  >
                    ${t.type==="feature"&&t.queryExtent?le`<calcite-button
                          slot="actions-end"
                          appearance="outline"
                          color="yellow"
                          scale="s"
                          icon-start="bounding-rectangle"
                          aria-label="Show Query Extent"
                          @click=${()=>this.showFeatureLayerExtent(t)}
                        >Extent</calcite-button>`:""}
                    <calcite-button
                      slot="actions-end"
                      appearance="outline"
                      color="blue"
                      scale="s"
                      icon-start="launch"
                      aria-label="Open REST URL"
                      @click=${()=>window.open(t.url,"_blank","noopener")}
                    >Open</calcite-button>
                    <calcite-button
                      slot="actions-end"
                      appearance="outline"
                      color="red"
                      scale="s"
                      icon-start="trash"
                      aria-label="Remove layer"
                      @click=${()=>this.handleRemoveLayer(t)}
                    >Remove</calcite-button>
                  </calcite-list-item>
                `)}
        </calcite-list>
      </div>
      <div class="add-row">
        <calcite-input
          type="text"
          placeholder="Add layer by REST URL"
          .value=${this.inputUrl}
          @input=${this.handleInput}
          @keydown=${t=>{t.key==="Enter"&&this.handleAddLayer()}}
          aria-label="Layer URL"
          scale="m"
        ></calcite-input>
        <calcite-button
          appearance="solid"
          color="blue"
          scale="m"
          icon-start="plus"
          @click=${this.handleAddLayer}
          >Add</calcite-button>
      </div>
      ${this.error?le`<calcite-notice open color="red" icon="exclamation-mark-triangle-f" scale="s">
            <div slot="message">${this.error}</div>
          </calcite-notice>`:""}
    `}};kb.styles=Js`
    :host {
      display: block;
      position: absolute;
      left: 50%;
      bottom: 30px;
      transform: translateX(-50%);
      z-index: 40;
      min-width: 350px;
      max-width: 600px;
      background: white;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      padding: 12px 18px 16px 18px;
      font-size: 14px;
      user-select: text;
    }
    .layer-list {
      max-height: 220px;
      overflow-y: auto;
      margin-bottom: 10px;
    }
    .layer-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
      border-bottom: 1px solid #eee;
      padding-bottom: 3px;
    }
    .layer-title {
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      margin-right: 10px;
    }
    .remove-btn {
      background: #e74c3c;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 2px 10px;
      cursor: pointer;
      font-size: 12px;
    }
    .add-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 10px;
    }
    input[type="text"] {
      flex: 1;
      padding: 5px 8px;
      font-size: 13px;
      border-radius: 4px;
      border: 1px solid #aaa;
    }
    .add-btn {
      background: #3498db;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 5px 14px;
      cursor: pointer;
      font-size: 13px;
    }
    .error {
      color: #b00;
      font-size: 12px;
      margin-top: 4px;
    }
    .empty {
      color: #888;
      font-size: 13px;
      text-align: center;
      margin: 12px 0;
    }
  `;WA([cA({attribute:!1})],kb.prototype,"view",2);WA([cA({attribute:!1})],kb.prototype,"otherView",2);WA([Cv()],kb.prototype,"layers",2);WA([Cv()],kb.prototype,"inputUrl",2);WA([Cv()],kb.prototype,"error",2);kb=WA([cV("layer-manager")],kb);/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const PUe=({children:t,...e})=>{const i=e.level?izt(`h${e.level}`):D3`div`;return Zi(e.key,sae`<${i} class=${fe(e.class)}>${t}</${i}>`)};/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const Bwe={arrow:"calcite-floating-ui-arrow",arrowStroke:"calcite-floating-ui-arrow__stroke"},$jt={width:12,height:6,strokeWidth:1},Ajt=({floatingLayout:t,key:e,ref:i})=>{const{width:r,height:s,strokeWidth:n}=$jt,o=r/2,a=t==="vertical",l=`M0,0 H${r} L${r-o},${s} Q${o},${s} ${o},${s} Z`;return Zi(e,le`<svg aria-hidden=true class=${fe(Bwe.arrow)} height=${r} viewBox=${`0 0 ${r} ${r+(a?0:n)}`} width=${r+(a?n:0)} ${wr(i)}>${gP`${gP`<path class=${fe(Bwe.arrowStroke)} d=${l??Ze} fill=none stroke-width=${n+1} />`||""}<path d=${l??Ze} stroke=none />`}</svg>`)};/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var DUe=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],tV=DUe.join(","),LUe=typeof Element>"u",xS=LUe?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,iV=!LUe&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t?.ownerDocument},rV=function t(e,i){var r;i===void 0&&(i=!0);var s=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"inert"),n=s===""||s==="true",o=n||i&&e&&t(e.parentNode);return o},Mjt=function(e){var i,r=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"contenteditable");return r===""||r==="true"},NUe=function(e,i,r){if(rV(e))return[];var s=Array.prototype.slice.apply(e.querySelectorAll(tV));return i&&xS.call(e,tV)&&s.unshift(e),s=s.filter(r),s},FUe=function t(e,i,r){for(var s=[],n=Array.from(e);n.length;){var o=n.shift();if(!rV(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=t(l,!0,r);r.flatten?s.push.apply(s,c):s.push({scopeParent:o,candidates:c})}else{var h=xS.call(o,tV);h&&r.filter(o)&&(i||!e.includes(o))&&s.push(o);var d=o.shadowRoot||typeof r.getShadowRoot=="function"&&r.getShadowRoot(o),f=!rV(d,!1)&&(!r.shadowRootFilter||r.shadowRootFilter(o));if(d&&f){var m=t(d===!0?o.children:d.children,!0,r);r.flatten?s.push.apply(s,m):s.push({scopeParent:o,candidates:m})}else n.unshift.apply(n,o.children)}}return s},kUe=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},lx=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||Mjt(e))&&!kUe(e)?0:e.tabIndex},Ojt=function(e,i){var r=lx(e);return r<0&&i&&!kUe(e)?0:r},Ijt=function(e,i){return e.tabIndex===i.tabIndex?e.documentOrder-i.documentOrder:e.tabIndex-i.tabIndex},zUe=function(e){return e.tagName==="INPUT"},Rjt=function(e){return zUe(e)&&e.type==="hidden"},Pjt=function(e){var i=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(r){return r.tagName==="SUMMARY"});return i},Djt=function(e,i){for(var r=0;r<e.length;r++)if(e[r].checked&&e[r].form===i)return e[r]},Ljt=function(e){if(!e.name)return!0;var i=e.form||iV(e),r=function(a){return i.querySelectorAll('input[type="radio"][name="'+a+'"]')},s;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")s=r(window.CSS.escape(e.name));else try{s=r(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var n=Djt(s,e.form);return!n||n===e},Njt=function(e){return zUe(e)&&e.type==="radio"},Fjt=function(e){return Njt(e)&&!Ljt(e)},kjt=function(e){var i,r=e&&iV(e),s=(i=r)===null||i===void 0?void 0:i.host,n=!1;if(r&&r!==e){var o,a,l;for(n=!!((o=s)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(s)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!n&&s;){var c,h,d;r=iV(s),s=(c=r)===null||c===void 0?void 0:c.host,n=!!((h=s)!==null&&h!==void 0&&(d=h.ownerDocument)!==null&&d!==void 0&&d.contains(s))}}return n},Vwe=function(e){var i=e.getBoundingClientRect(),r=i.width,s=i.height;return r===0&&s===0},zjt=function(e,i){var r=i.displayCheck,s=i.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var n=xS.call(e,"details>summary:first-of-type"),o=n?e.parentElement:e;if(xS.call(o,"details:not([open]) *"))return!0;if(!r||r==="full"||r==="legacy-full"){if(typeof s=="function"){for(var a=e;e;){var l=e.parentElement,c=iV(e);if(l&&!l.shadowRoot&&s(l)===!0)return Vwe(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=a}if(kjt(e))return!e.getClientRects().length;if(r!=="legacy-full")return!0}else if(r==="non-zero-area")return Vwe(e);return!1},Ujt=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var i=e.parentElement;i;){if(i.tagName==="FIELDSET"&&i.disabled){for(var r=0;r<i.children.length;r++){var s=i.children.item(r);if(s.tagName==="LEGEND")return xS.call(i,"fieldset[disabled] *")?!0:!s.contains(e)}return!0}i=i.parentElement}return!1},sV=function(e,i){return!(i.disabled||rV(i)||Rjt(i)||zjt(i,e)||Pjt(i)||Ujt(i))},uee=function(e,i){return!(Fjt(i)||lx(i)<0||!sV(e,i))},Bjt=function(e){var i=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(i)||i>=0)},Vjt=function t(e){var i=[],r=[];return e.forEach(function(s,n){var o=!!s.scopeParent,a=o?s.scopeParent:s,l=Ojt(a,o),c=o?t(s.candidates):a;l===0?o?i.push.apply(i,c):i.push(a):r.push({documentOrder:n,tabIndex:l,item:s,isScope:o,content:c})}),r.sort(Ijt).reduce(function(s,n){return n.isScope?s.push.apply(s,n.content):s.push(n.content),s},[]).concat(i)},jjt=function(e,i){i=i||{};var r;return i.getShadowRoot?r=FUe([e],i.includeContainer,{filter:uee.bind(null,i),flatten:!1,getShadowRoot:i.getShadowRoot,shadowRootFilter:Bjt}):r=NUe(e,i.includeContainer,uee.bind(null,i)),Vjt(r)},Gjt=function(e,i){i=i||{};var r;return i.getShadowRoot?r=FUe([e],i.includeContainer,{filter:sV.bind(null,i),flatten:!0,getShadowRoot:i.getShadowRoot}):r=NUe(e,i.includeContainer,sV.bind(null,i)),r},uE=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return xS.call(e,tV)===!1?!1:uee(i,e)},Hjt=DUe.concat("iframe").join(","),G9=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return xS.call(e,Hjt)===!1?!1:sV(i,e)};/*!
* focus-trap 7.6.5
* @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
*/function hee(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,r=Array(e);i<e;i++)r[i]=t[i];return r}function qjt(t){if(Array.isArray(t))return hee(t)}function Wjt(t,e,i){return(e=Kjt(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Zjt(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Yjt(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jwe(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),i.push.apply(i,r)}return i}function Gwe(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?jwe(Object(i),!0).forEach(function(r){Wjt(t,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):jwe(Object(i)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))})}return t}function Jjt(t){return qjt(t)||Zjt(t)||Qjt(t)||Yjt()}function Xjt(t,e){if(typeof t!="object"||!t)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var r=i.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Kjt(t){var e=Xjt(t,"string");return typeof e=="symbol"?e:e+""}function Qjt(t,e){if(t){if(typeof t=="string")return hee(t,e);var i={}.toString.call(t).slice(8,-1);return i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set"?Array.from(t):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?hee(t,e):void 0}}var Hwe={activateTrap:function(e,i){if(e.length>0){var r=e[e.length-1];r!==i&&r._setPausedState(!0)}var s=e.indexOf(i);s===-1||e.splice(s,1),e.push(i)},deactivateTrap:function(e,i){var r=e.indexOf(i);r!==-1&&e.splice(r,1),e.length>0&&!e[e.length-1]._isManuallyPaused()&&e[e.length-1]._setPausedState(!1)}},eGt=function(e){return e.tagName&&e.tagName.toLowerCase()==="input"&&typeof e.select=="function"},tGt=function(e){return e?.key==="Escape"||e?.key==="Esc"||e?.keyCode===27},pP=function(e){return e?.key==="Tab"||e?.keyCode===9},iGt=function(e){return pP(e)&&!e.shiftKey},rGt=function(e){return pP(e)&&e.shiftKey},qwe=function(e){return setTimeout(e,0)},aO=function(e){for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];return typeof e=="function"?e.apply(void 0,r):e},_k=function(e){return e.target.shadowRoot&&typeof e.composedPath=="function"?e.composedPath()[0]:e.target},sGt=[],nGt=function(e,i){var r=i?.document||document,s=i?.trapStack||sGt,n=Gwe({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0,isKeyForward:iGt,isKeyBackward:rGt},i),o={containers:[],containerGroups:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,manuallyPaused:!1,delayInitialFocusTimer:void 0,recentNavEvent:void 0},a,l=function(N,R,k){return N&&N[R]!==void 0?N[R]:n[k||R]},c=function(N,R){var k=typeof R?.composedPath=="function"?R.composedPath():void 0;return o.containerGroups.findIndex(function(W){var G=W.container,j=W.tabbableNodes;return G.contains(N)||k?.includes(G)||j.find(function(re){return re===N})})},h=function(N){var R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},k=R.hasFallback,W=k===void 0?!1:k,G=R.params,j=G===void 0?[]:G,re=n[N];if(typeof re=="function"&&(re=re.apply(void 0,Jjt(j))),re===!0&&(re=void 0),!re){if(re===void 0||re===!1)return re;throw new Error("`".concat(N,"` was specified but was not a node, or did not return a node"))}var ve=re;if(typeof re=="string"){try{ve=r.querySelector(re)}catch(xe){throw new Error("`".concat(N,'` appears to be an invalid selector; error="').concat(xe.message,'"'))}if(!ve&&!W)throw new Error("`".concat(N,"` as selector refers to no known node"))}return ve},d=function(){var N=h("initialFocus",{hasFallback:!0});if(N===!1)return!1;if(N===void 0||N&&!G9(N,n.tabbableOptions))if(c(r.activeElement)>=0)N=r.activeElement;else{var R=o.tabbableGroups[0],k=R&&R.firstTabbableNode;N=k||h("fallbackFocus")}else N===null&&(N=h("fallbackFocus"));if(!N)throw new Error("Your focus-trap needs to have at least one focusable element");return N},f=function(){if(o.containerGroups=o.containers.map(function(N){var R=jjt(N,n.tabbableOptions),k=Gjt(N,n.tabbableOptions),W=R.length>0?R[0]:void 0,G=R.length>0?R[R.length-1]:void 0,j=k.find(function(xe){return uE(xe)}),re=k.slice().reverse().find(function(xe){return uE(xe)}),ve=!!R.find(function(xe){return lx(xe)>0});return{container:N,tabbableNodes:R,focusableNodes:k,posTabIndexesFound:ve,firstTabbableNode:W,lastTabbableNode:G,firstDomTabbableNode:j,lastDomTabbableNode:re,nextTabbableNode:function(De){var Ke=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,je=R.indexOf(De);return je<0?Ke?k.slice(k.indexOf(De)+1).find(function(ft){return uE(ft)}):k.slice(0,k.indexOf(De)).reverse().find(function(ft){return uE(ft)}):R[je+(Ke?1:-1)]}}}),o.tabbableGroups=o.containerGroups.filter(function(N){return N.tabbableNodes.length>0}),o.tabbableGroups.length<=0&&!h("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times");if(o.containerGroups.find(function(N){return N.posTabIndexesFound})&&o.containerGroups.length>1)throw new Error("At least one node with a positive tabindex was found in one of your focus-trap's multiple containers. Positive tabindexes are only supported in single-container focus-traps.")},m=function(N){var R=N.activeElement;if(R)return R.shadowRoot&&R.shadowRoot.activeElement!==null?m(R.shadowRoot):R},y=function(N){if(N!==!1&&N!==m(document)){if(!N||!N.focus){y(d());return}N.focus({preventScroll:!!n.preventScroll}),o.mostRecentlyFocusedNode=N,eGt(N)&&N.select()}},v=function(N){var R=h("setReturnFocus",{params:[N]});return R||(R===!1?!1:N)},_=function(N){var R=N.target,k=N.event,W=N.isBackward,G=W===void 0?!1:W;R=R||_k(k),f();var j=null;if(o.tabbableGroups.length>0){var re=c(R,k),ve=re>=0?o.containerGroups[re]:void 0;if(re<0)G?j=o.tabbableGroups[o.tabbableGroups.length-1].lastTabbableNode:j=o.tabbableGroups[0].firstTabbableNode;else if(G){var xe=o.tabbableGroups.findIndex(function(ti){var Tt=ti.firstTabbableNode;return R===Tt});if(xe<0&&(ve.container===R||G9(R,n.tabbableOptions)&&!uE(R,n.tabbableOptions)&&!ve.nextTabbableNode(R,!1))&&(xe=re),xe>=0){var De=xe===0?o.tabbableGroups.length-1:xe-1,Ke=o.tabbableGroups[De];j=lx(R)>=0?Ke.lastTabbableNode:Ke.lastDomTabbableNode}else pP(k)||(j=ve.nextTabbableNode(R,!1))}else{var je=o.tabbableGroups.findIndex(function(ti){var Tt=ti.lastTabbableNode;return R===Tt});if(je<0&&(ve.container===R||G9(R,n.tabbableOptions)&&!uE(R,n.tabbableOptions)&&!ve.nextTabbableNode(R))&&(je=re),je>=0){var ft=je===o.tabbableGroups.length-1?0:je+1,At=o.tabbableGroups[ft];j=lx(R)>=0?At.firstTabbableNode:At.firstDomTabbableNode}else pP(k)||(j=ve.nextTabbableNode(R))}}else j=h("fallbackFocus");return j},b=function(N){var R=_k(N);if(!(c(R,N)>=0)){if(aO(n.clickOutsideDeactivates,N)){a.deactivate({returnFocus:n.returnFocusOnDeactivate});return}aO(n.allowOutsideClick,N)||N.preventDefault()}},w=function(N){var R=_k(N),k=c(R,N)>=0;if(k||R instanceof Document)k&&(o.mostRecentlyFocusedNode=R);else{N.stopImmediatePropagation();var W,G=!0;if(o.mostRecentlyFocusedNode)if(lx(o.mostRecentlyFocusedNode)>0){var j=c(o.mostRecentlyFocusedNode),re=o.containerGroups[j].tabbableNodes;if(re.length>0){var ve=re.findIndex(function(xe){return xe===o.mostRecentlyFocusedNode});ve>=0&&(n.isKeyForward(o.recentNavEvent)?ve+1<re.length&&(W=re[ve+1],G=!1):ve-1>=0&&(W=re[ve-1],G=!1))}}else o.containerGroups.some(function(xe){return xe.tabbableNodes.some(function(De){return lx(De)>0})})||(G=!1);else G=!1;G&&(W=_({target:o.mostRecentlyFocusedNode,isBackward:n.isKeyBackward(o.recentNavEvent)})),y(W||o.mostRecentlyFocusedNode||d())}o.recentNavEvent=void 0},x=function(N){var R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;o.recentNavEvent=N;var k=_({event:N,isBackward:R});k&&(pP(N)&&N.preventDefault(),y(k))},S=function(N){(n.isKeyForward(N)||n.isKeyBackward(N))&&x(N,n.isKeyBackward(N))},C=function(N){tGt(N)&&aO(n.escapeDeactivates,N)!==!1&&(N.preventDefault(),a.deactivate())},T=function(N){var R=_k(N);c(R,N)>=0||aO(n.clickOutsideDeactivates,N)||aO(n.allowOutsideClick,N)||(N.preventDefault(),N.stopImmediatePropagation())},M=function(){if(o.active)return Hwe.activateTrap(s,a),o.delayInitialFocusTimer=n.delayInitialFocus?qwe(function(){y(d())}):y(d()),r.addEventListener("focusin",w,!0),r.addEventListener("mousedown",b,{capture:!0,passive:!1}),r.addEventListener("touchstart",b,{capture:!0,passive:!1}),r.addEventListener("click",T,{capture:!0,passive:!1}),r.addEventListener("keydown",S,{capture:!0,passive:!1}),r.addEventListener("keydown",C),a},I=function(){if(o.active)return r.removeEventListener("focusin",w,!0),r.removeEventListener("mousedown",b,!0),r.removeEventListener("touchstart",b,!0),r.removeEventListener("click",T,!0),r.removeEventListener("keydown",S,!0),r.removeEventListener("keydown",C),a},P=function(N){var R=N.some(function(k){var W=Array.from(k.removedNodes);return W.some(function(G){return G===o.mostRecentlyFocusedNode})});R&&y(d())},D=typeof window<"u"&&"MutationObserver"in window?new MutationObserver(P):void 0,F=function(){D&&(D.disconnect(),o.active&&!o.paused&&o.containers.map(function(N){D.observe(N,{subtree:!0,childList:!0})}))};return a={get active(){return o.active},get paused(){return o.paused},activate:function(N){if(o.active)return this;var R=l(N,"onActivate"),k=l(N,"onPostActivate"),W=l(N,"checkCanFocusTrap");W||f(),o.active=!0,o.paused=!1,o.nodeFocusedBeforeActivation=m(r),R?.();var G=function(){W&&f(),M(),F(),k?.()};return W?(W(o.containers.concat()).then(G,G),this):(G(),this)},deactivate:function(N){if(!o.active)return this;var R=Gwe({onDeactivate:n.onDeactivate,onPostDeactivate:n.onPostDeactivate,checkCanReturnFocus:n.checkCanReturnFocus},N);clearTimeout(o.delayInitialFocusTimer),o.delayInitialFocusTimer=void 0,I(),o.active=!1,o.paused=!1,F(),Hwe.deactivateTrap(s,a);var k=l(R,"onDeactivate"),W=l(R,"onPostDeactivate"),G=l(R,"checkCanReturnFocus"),j=l(R,"returnFocus","returnFocusOnDeactivate");k?.();var re=function(){qwe(function(){j&&y(v(o.nodeFocusedBeforeActivation)),W?.()})};return j&&G?(G(v(o.nodeFocusedBeforeActivation)).then(re,re),this):(re(),this)},pause:function(N){return o.active?(o.manuallyPaused=!0,this._setPausedState(!0,N)):this},unpause:function(N){return o.active?(o.manuallyPaused=!1,s[s.length-1]!==this?this:this._setPausedState(!1,N)):this},updateContainerElements:function(N){var R=[].concat(N).filter(Boolean);return o.containers=R.map(function(k){return typeof k=="string"?r.querySelector(k):k}),o.active&&f(),F(),this}},Object.defineProperties(a,{_isManuallyPaused:{value:function(){return o.manuallyPaused}},_setPausedState:{value:function(N,R){if(o.paused===N)return this;if(o.paused=N,N){var k=l(R,"onPause"),W=l(R,"onPostPause");k?.(),I(),F(),W?.()}else{var G=l(R,"onUnpause"),j=l(R,"onPostUnpause");G?.(),f(),M(),F(),j?.()}return this}}}),a.updateContainerElements(e),a};/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const bk=new WeakSet;function oGt(t,e){const i=e?.fallbackFocus||t,r=e?.clickOutsideDeactivates??!0;return{fallbackFocus:i,setReturnFocus:s=>(bk.has(t)||P3(s),!1),...e,document:t.ownerDocument,tabbableOptions:lze,trapStack:wnt,clickOutsideDeactivates:s=>(bk.has(t)||bk.add(t),typeof r=="function"?r(s):r),onPostDeactivate:()=>{bk.delete(t)}}}function Wwe(t,{focusTrapOptions:e},i){return!e?.extraContainers&&!i?t:[t,...Zwe(e?.extraContainers),...Zwe(i)]}function Zwe(t=[]){return Array.isArray(t)?t:[t]}const aGt=t=>n5t((e,i)=>{let r,s,n;const o=t.focusTrapOptions;i.onConnected(()=>{e[t.triggerProp]&&r&&a.activate()}),i.onUpdate(l=>{e.hasUpdated&&l.has("focusTrapDisabled")&&(e.focusTrapDisabled?a.deactivate():a.activate())}),i.onDisconnected(()=>a.deactivate());const a={activate:()=>{const l=s||e.el;if(l.isConnected){if(!r){const c={...o,...e.focusTrapOptions};n||=Wwe(l,e),r=nGt(n,oGt(l,c))}(typeof e.focusTrapDisabledOverride=="function"?!e.focusTrapDisabledOverride():!e.focusTrapDisabled)&&r.activate()}},deactivate:()=>r?.deactivate(),overrideFocusTrapEl:l=>{if(r)throw new Error("Focus trap already created");s=l},setExtraContainers:l=>{const c=s||e.el;n=Wwe(c,e,l)},updateContainerElements:()=>r?.updateContainerElements(n)};return a});/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */class lGt{constructor(){this.registeredElements=new Map,this.registeredElementCount=0,this.queryPopover=e=>{const{registeredElements:i}=this,r=e.find(s=>i.has(s));return i.get(r)},this.togglePopovers=e=>{const i=e.composedPath(),r=this.queryPopover(i);r&&!r.triggerDisabled&&(r.open=!r.open),Array.from(this.registeredElements.values()).filter(s=>s!==r&&s.autoClose&&s.open&&!i.includes(s)).forEach(s=>s.open=!1)},this.keyDownHandler=e=>{e.defaultPrevented||(e.key==="Escape"?this.closeAllPopovers():cae(e.key)&&this.togglePopovers(e))},this.clickHandler=e=>{k5t(e)||e.defaultPrevented||this.togglePopovers(e)}}registerElement(e,i){this.registeredElementCount++,this.registeredElements.set(e,i),this.registeredElementCount===1&&this.addListeners()}unregisterElement(e){this.registeredElements.delete(e)&&this.registeredElementCount--,this.registeredElementCount===0&&this.removeListeners()}closeAllPopovers(){Array.from(this.registeredElements.values()).forEach(e=>e.open=!1)}addListeners(){window.addEventListener("click",this.clickHandler),window.addEventListener("keydown",this.keyDownHandler)}removeListeners(){window.removeEventListener("click",this.clickHandler),window.removeEventListener("keydown",this.keyDownHandler)}}const np={positionContainer:"position-container",container:"container",closeButtonContainer:"close-button-container",closeButton:"close-button",content:"content",hasHeader:"has-header",header:"header",headerContainer:"header-container",heading:"heading"},Ywe="auto",Jwe="aria-controls",Xwe="aria-expanded",cGt=Js`:host{display:contents;--calcite-floating-ui-z-index: var(--calcite-popover-z-index, var(--calcite-z-index-popup))}.position-container{inline-size:max-content;display:none;max-inline-size:100vw;max-block-size:100vh;inset-block-start:0;left:0;z-index:var(--calcite-floating-ui-z-index)}.position-container .calcite-floating-ui-anim{position:relative;transition:var(--calcite-floating-ui-transition);transition-property:inset,left,opacity;opacity:0;box-shadow:0 0 16px #00000029;z-index:var(--calcite-z-index);border-radius:.25rem}.position-container[data-placement^=bottom] .calcite-floating-ui-anim{inset-block-start:-5px}.position-container[data-placement^=top] .calcite-floating-ui-anim{inset-block-start:5px}.position-container[data-placement^=left] .calcite-floating-ui-anim{left:5px}.position-container[data-placement^=right] .calcite-floating-ui-anim{left:-5px}.position-container[data-placement] .calcite-floating-ui-anim--active{opacity:1;inset-block-start:0;left:0}.calcite-floating-ui-arrow{pointer-events:none;position:absolute;z-index:calc(var(--calcite-z-index) * -1);fill:var(--calcite-color-foreground-1)}.calcite-floating-ui-arrow__stroke{stroke:var(--calcite-color-border-3)}:host([scale=s]) .heading{padding:.5rem .75rem;font-size:var(--calcite-font-size--1);line-height:1.375}:host([scale=m]) .heading{padding:.75rem 1rem;font-size:var(--calcite-font-size-0);line-height:1.375}:host([scale=l]) .heading{padding:1rem 1.25rem;font-size:var(--calcite-font-size-1);line-height:1.375}.position-container .calcite-floating-ui-anim{border-width:1px;border-style:solid;background-color:var(--calcite-popover-background-color, var(--calcite-color-foreground-1));border-color:var(--calcite-popover-border-color, var(--calcite-color-border-3));border-radius:var(--calcite-popover-corner-radius, var(--calcite-corner-radius-round))}.calcite-floating-ui-arrow{fill:var(--calcite-popover-background-color, var(--calcite-color-foreground-1))}.calcite-floating-ui-arrow__stroke{stroke:var(--calcite-popover-border-color, var(--calcite-color-border-3))}.header{display:flex;flex:1 1 auto;align-items:stretch;justify-content:flex-start;border-width:0px;border-bottom-width:1px;border-style:solid;border-block-end-color:var(--calcite-popover-border-color, var(--calcite-color-border-3))}.heading{margin:0;display:block;flex:1 1 auto;align-self:center;white-space:normal;font-weight:var(--calcite-font-weight-medium);word-wrap:break-word;word-break:break-word;color:var(--calcite-popover-text-color, var(--calcite-color-text-1))}.header-container{position:relative;display:flex;height:100%;flex-direction:row;flex-wrap:nowrap;border-radius:.25rem;color:var(--calcite-popover-text-color, var(--calcite-color-text-1))}.header-container.has-header{flex-direction:column}.content{display:flex;height:100%;width:100%;flex-direction:column;flex-wrap:nowrap;align-self:center;word-wrap:break-word;word-break:break-word}.close-button-container{display:flex;overflow:hidden;flex:0 0 auto;border-start-end-radius:var(--calcite-popover-corner-radius, var(--calcite-corner-radius-round));border-end-end-radius:var(--calcite-popover-corner-radius, var(--calcite-corner-radius-round));--calcite-action-corner-radius-start-end: var(--calcite-popover-corner-radius, var(--calcite-corner-radius-sharp));--calcite-action-corner-radius-end-end: var(--calcite-popover-corner-radius, var(--calcite-corner-radius-sharp))}::slotted(calcite-panel),::slotted(calcite-flow){height:100%}:host([hidden]){display:none}[hidden]{display:none}`,Kwe=new lGt;class UUe extends Vn{constructor(){super(...arguments),this.closeButtonEl=Gc(),this.focusTrap=aGt({triggerProp:"open",focusTrapOptions:{allowOutsideClick:!0,escapeDeactivates:e=>(e.defaultPrevented||(this.open=!1,e.preventDefault()),!1)}})(this),this.guid=`calcite-popover-${XS()}`,this.hasLoaded=!1,this.mutationObserver=vf("mutation",()=>this.focusTrap.updateContainerElements()),this.transitionProp="opacity",this.messages=Fd(),this.floatingLayout="vertical",this.autoClose=!1,this.closable=!1,this.flipDisabled=!1,this.focusTrapDisabled=!1,this.offsetDistance=Rwe,this.offsetSkidding=0,this.open=!1,this.overlayPositioning="absolute",this.placement=Ywe,this.pointerDisabled=!1,this.scale="m",this.triggerDisabled=!1,this.calcitePopoverBeforeClose=Ut({cancelable:!1}),this.calcitePopoverBeforeOpen=Ut({cancelable:!1}),this.calcitePopoverClose=Ut({cancelable:!1}),this.calcitePopoverOpen=Ut({cancelable:!1})}static{this.properties={floatingLayout:[16,{},{state:!0}],referenceEl:[16,{},{state:!0}],autoClose:[7,{},{reflect:!0,type:Boolean}],closable:[7,{},{reflect:!0,type:Boolean}],flipDisabled:[7,{},{reflect:!0,type:Boolean}],flipPlacements:[0,{},{attribute:!1}],focusTrapDisabled:[7,{},{reflect:!0,type:Boolean}],focusTrapOptions:[0,{},{attribute:!1}],heading:1,headingLevel:[11,{},{type:Number,reflect:!0}],label:1,messageOverrides:[0,{},{attribute:!1}],offsetDistance:[11,{},{type:Number,reflect:!0}],offsetSkidding:[11,{},{reflect:!0,type:Number}],open:[7,{},{reflect:!0,type:Boolean}],overlayPositioning:[3,{},{reflect:!0}],placement:[3,{},{reflect:!0}],pointerDisabled:[7,{},{reflect:!0,type:Boolean}],referenceElement:1,scale:[3,{},{reflect:!0}],triggerDisabled:[7,{},{reflect:!0,type:Boolean}]}}static{this.styles=cGt}async reposition(e=!1){const{referenceEl:i,placement:r,overlayPositioning:s,flipDisabled:n,filteredFlipPlacements:o,offsetDistance:a,offsetSkidding:l,arrowEl:c,floatingEl:h}=this;return EUe(this,{floatingEl:h,referenceEl:i,overlayPositioning:s,placement:r,flipDisabled:n,flipPlacements:o,offsetDistance:a,offsetSkidding:l,arrowEl:c,type:"popover"},e)}async setFocus(){await dh(this),this.requestUpdate(),VG(this.el)}async updateFocusTrapElements(){this.focusTrap.updateContainerElements()}connectedCallback(){super.connectedCallback(),this.mutationObserver?.observe(this.el,{childList:!0,subtree:!0}),this.setFilteredPlacements(),requestAnimationFrame(()=>this.setUpReferenceElement(this.hasLoaded))}willUpdate(e){e.has("flipPlacements")&&this.flipPlacementsHandler(),e.has("open")&&(this.hasUpdated||this.open!==!1)&&this.openHandler(),(e.has("offsetDistance")&&(this.hasUpdated||this.offsetDistance!==Rwe)||e.has("offsetSkidding")&&(this.hasUpdated||this.offsetSkidding!==0)||e.has("overlayPositioning")&&(this.hasUpdated||this.overlayPositioning!=="absolute")||e.has("placement")&&(this.hasUpdated||this.placement!==Ywe))&&this.reposition(!0),e.has("referenceElement")&&this.referenceElementHandler()}loaded(){this.referenceElement&&!this.referenceEl&&this.setUpReferenceElement(),this.hasLoaded=!0}disconnectedCallback(){super.disconnectedCallback(),this.mutationObserver?.disconnect(),this.removeReferences(),xae(this)}flipPlacementsHandler(){this.setFilteredPlacements(),this.reposition(!0)}openHandler(){Sae(this),this.reposition(!0),this.setExpandedAttr()}referenceElementHandler(){this.setUpReferenceElement(),this.reposition(!0)}setFloatingEl(e){this.floatingEl=e,e&&requestAnimationFrame(()=>this.setUpReferenceElement())}setTransitionEl(e){e&&(this.transitionEl=e)}setFilteredPlacements(){const{el:e,flipPlacements:i}=this;this.filteredFlipPlacements=i?TUe(i,e):null}setUpReferenceElement(e=!0){this.removeReferences(),this.referenceEl=this.getReferenceElement(),lR(this);const{el:i,referenceElement:r,referenceEl:s}=this;e&&r&&!s&&console.warn(`${i.tagName}: reference-element id "${r}" was not found.`,{el:i}),this.addReferences()}getId(){return this.el.id||this.guid}setExpandedAttr(){const{referenceEl:e,open:i}=this;e&&"setAttribute"in e&&e.setAttribute(Xwe,jG(i))}addReferences(){const{referenceEl:e}=this;if(!e)return;const i=this.getId();"setAttribute"in e&&e.setAttribute(Jwe,i),Kwe.registerElement(e,this.el),this.setExpandedAttr()}removeReferences(){const{referenceEl:e}=this;e&&("removeAttribute"in e&&(e.removeAttribute(Jwe),e.removeAttribute(Xwe)),Kwe.unregisterElement(e))}getReferenceElement(){const{referenceElement:e,el:i}=this;return(typeof e=="string"?BG(i,{id:e}):e)||null}hide(){this.open=!1}onBeforeOpen(){this.calcitePopoverBeforeOpen.emit()}onOpen(){this.calcitePopoverOpen.emit(),this.focusTrap.activate()}onBeforeClose(){this.calcitePopoverBeforeClose.emit()}onClose(){this.calcitePopoverClose.emit(),wae(this),this.focusTrap.deactivate()}storeArrowEl(e){this.arrowEl=e,this.reposition(!0)}renderCloseButton(){const{messages:e,closable:i}=this;return i?Zi(np.closeButtonContainer,le`<div class=${fe(np.closeButtonContainer)}><calcite-action appearance=transparent class=${fe(np.closeButton)} @click=${this.hide} .scale=${this.scale} .text=${e.close} ${wr(this.closeButtonEl)}><calcite-icon icon=x .scale=${Wa(this.scale)}></calcite-icon></calcite-action></div>`):null}renderHeader(){const{heading:e,headingLevel:i}=this,r=e?PUe({class:np.heading,level:i,children:e}):null;return r?Zi(np.header,le`<div class=${fe(np.header)}>${r}${this.renderCloseButton()}</div>`):null}render(){const{referenceEl:e,heading:i,label:r,open:s,pointerDisabled:n,floatingLayout:o}=this,a=e&&s,l=!a,c=n?null:Zi("floating-arrow",Ajt({floatingLayout:o,ref:this.storeArrowEl}));return this.el.inert=l,this.el.ariaLabel=r,this.el.ariaLive="polite",mj(this.el,"id",this.getId()),this.el.role="dialog",le`<div class=${fe(np.positionContainer)} ${wr(this.setFloatingEl)}><div class=${fe({[np.container]:!0,[QB.animation]:!0,[QB.animationActive]:a})} ${wr(this.setTransitionEl)}>${c}<div class=${fe({[np.hasHeader]:!!i,[np.headerContainer]:!0})}>${this.renderHeader()}<div class=${fe(np.content)}><slot></slot></div>${i?null:this.renderCloseButton()}</div></div></div>`}}Oo("calcite-popover",UUe);const uGt=Object.freeze(Object.defineProperty({__proto__:null,Popover:UUe},Symbol.toStringTag,{value:"Module"}));/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */function Qwe(t,e){return(t+e)%e}/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const e1e={menu:"menu",defaultTrigger:"default-trigger"},dee={tooltip:"tooltip",trigger:"trigger"},hGt={menu:"ellipsis"},dGt="data-active";/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const pGt=Js`:host{box-sizing:border-box;display:flex;flex-direction:column;font-size:var(--calcite-font-size-1)}::slotted(calcite-action-group:not(:last-of-type)){border-block-end-width:var(--calcite-border-width-sm)}.default-trigger{position:relative;block-size:100%;flex:0 1 auto;align-self:stretch}slot[name=trigger]::slotted(calcite-action),calcite-action::slotted([slot=trigger]){position:relative;block-size:100%;flex:0 1 auto;align-self:stretch}.menu{display:flex;max-block-size:45vh;flex-direction:column;flex-wrap:nowrap;overflow-y:auto;overflow-x:hidden;outline:2px solid transparent;outline-offset:2px;gap:var(--calcite-action-menu-items-space, 0)}:host([hidden]){display:none}[hidden]{display:none}`,fGt=["ArrowUp","ArrowDown","End","Home"];class BUe extends Vn{constructor(){super(...arguments),this.guid=`calcite-action-menu-${XS()}`,this.actionElements=[],this.menuButtonClick=()=>{this.toggleOpen()},this.menuButtonId=`${this.guid}-menu-button`,this.menuButtonKeyDown=e=>{const{key:i}=e,{actionElements:r,activeMenuItemIndex:s,open:n}=this;if(r.length){if(cae(i)){if(e.preventDefault(),!n){this.toggleOpen();return}const o=r[s];o?o.click():this.toggleOpen(!1)}if(i==="Tab"){this.open=!1;return}if(i==="Escape"){this.toggleOpen(!1),e.preventDefault();return}this.handleActionNavigation(e,i,r)}},this.menuId=`${this.guid}-menu`,this._open=!1,this.updateAction=(e,i)=>{const{guid:r,activeMenuItemIndex:s}=this,n=`${r}-action-${i}`;e.tabIndex=-1,e.setAttribute("role","menuitem"),e.id||(e.id=n),e.toggleAttribute(dGt,i===s)},this.activeMenuItemIndex=-1,this.appearance="solid",this.expanded=!1,this.overlayPositioning="absolute",this.placement="auto",this.scale="m",this.calciteActionMenuOpen=Ut({cancelable:!1})}static{this.properties={activeMenuItemIndex:[16,{},{state:!0}],menuButtonEl:[16,{},{state:!0}],appearance:[3,{},{reflect:!0}],expanded:[7,{},{reflect:!0,type:Boolean}],flipPlacements:[0,{},{attribute:!1}],label:1,open:[7,{},{reflect:!0,type:Boolean}],overlayPositioning:[3,{},{reflect:!0}],placement:[3,{},{reflect:!0}],scale:[3,{},{reflect:!0}]}}static{this.styles=pGt}get open(){return this._open}set open(e){const i=this._open;e!==i&&(this._open=e,this.openHandler(e))}async setFocus(){return await dh(this),P3(this.menuButtonEl)}connectedCallback(){super.connectedCallback(),this.connectMenuButtonEl()}willUpdate(e){e.has("expanded")&&(this.hasUpdated||this.expanded!==!1)&&this.expandedHandler(),e.has("activeMenuItemIndex")&&(this.hasUpdated||this.activeMenuItemIndex!==-1)&&this.updateActions(this.actionElements)}disconnectedCallback(){super.disconnectedCallback(),this.disconnectMenuButtonEl()}expandedHandler(){this.open=!1,this.setTooltipReferenceElement()}openHandler(e){this.menuButtonEl&&(this.menuButtonEl.active=e),this.popoverEl&&(this.popoverEl.open=e),this.activeMenuItemIndex=this.open?0:-1,this.calciteActionMenuOpen.emit(),this.setTooltipReferenceElement()}connectMenuButtonEl(){const{menuButtonId:e,menuId:i,open:r,label:s}=this,n=this.slottedMenuButtonEl||this.defaultMenuButtonEl;this.menuButtonEl!==n&&(this.disconnectMenuButtonEl(),this.menuButtonEl=n,this.setTooltipReferenceElement(),n&&(n.active=r,n.setAttribute("aria-controls",i),n.setAttribute("aria-expanded",jG(r)),n.setAttribute("aria-haspopup","true"),n.id||(n.id=e),n.label||(n.label=s),n.text||(n.text=s),n.addEventListener("click",this.menuButtonClick),n.addEventListener("keydown",this.menuButtonKeyDown)))}disconnectMenuButtonEl(){const{menuButtonEl:e}=this;e&&(e.removeEventListener("click",this.menuButtonClick),e.removeEventListener("keydown",this.menuButtonKeyDown),this.menuButtonEl=null)}setMenuButtonEl(e){const i=e.target.assignedElements({flatten:!0}).filter(r=>r?.matches("calcite-action"));this.slottedMenuButtonEl=i[0],this.connectMenuButtonEl()}setDefaultMenuButtonEl(e){this.defaultMenuButtonEl=e,e&&this.connectMenuButtonEl()}setPopoverEl(e){e&&(this.popoverEl=e,e.open=this.open)}handleCalciteActionClick(){this.open=!1,this.setFocus()}updateTooltip(e){const i=e.target.assignedElements({flatten:!0}).filter(r=>r?.matches("calcite-tooltip"));this.tooltipEl=i[0],this.setTooltipReferenceElement()}setTooltipReferenceElement(){const{tooltipEl:e,expanded:i,menuButtonEl:r,open:s}=this;e&&(e.referenceElement=!i&&!s?r:null)}updateActions(e){e?.forEach(this.updateAction)}handleDefaultSlotChange(e){const i=e.target.assignedElements({flatten:!0}).reduce((r,s)=>s?.matches("calcite-action")?(r.push(s),r):s?.matches("calcite-action-group")?r.concat(Array.from(s.querySelectorAll("calcite-action"))):r,[]);this.actionElements=i.filter(r=>!r.disabled&&!r.hidden)}isValidKey(e,i){return!!i.find(r=>r===e)}handleActionNavigation(e,i,r){if(!this.isValidKey(i,fGt))return;if(e.preventDefault(),!this.open){this.toggleOpen(),(i==="Home"||i==="ArrowDown")&&(this.activeMenuItemIndex=0),(i==="End"||i==="ArrowUp")&&(this.activeMenuItemIndex=r.length-1);return}i==="Home"&&(this.activeMenuItemIndex=0),i==="End"&&(this.activeMenuItemIndex=r.length-1);const s=this.activeMenuItemIndex;i==="ArrowUp"&&(this.activeMenuItemIndex=Qwe(Math.max(s-1,-1),r.length)),i==="ArrowDown"&&(this.activeMenuItemIndex=Qwe(s+1,r.length))}toggleOpen(e=!this.open){this.open=e}handlePopoverOpen(e){e.stopPropagation(),this.open=!0,this.setFocus()}handlePopoverClose(e){e.stopPropagation(),this.open=!1}renderMenuButton(){const{appearance:e,label:i,scale:r,expanded:s}=this;return le`<slot name=${dee.trigger} @slotchange=${this.setMenuButtonEl}><calcite-action .appearance=${e} class=${fe(e1e.defaultTrigger)} .icon=${hGt.menu} .scale=${r} .text=${i} .textEnabled=${s} ${wr(this.setDefaultMenuButtonEl)}></calcite-action></slot>`}renderMenuItems(){const{actionElements:e,activeMenuItemIndex:i,menuId:r,menuButtonEl:s,label:n,placement:o,overlayPositioning:a,flipPlacements:l}=this,h=e[i]?.id||null;return le`<calcite-popover auto-close .flipPlacements=${l} focus-trap-disabled .label=${n} offset-distance=0 @calcitePopoverClose=${this.handlePopoverClose} @calcitePopoverOpen=${this.handlePopoverOpen} .overlayPositioning=${a} .placement=${o} pointer-disabled .referenceElement=${s} trigger-disabled ${wr(this.setPopoverEl)}><div aria-activedescendant=${h??Ze} aria-labelledby=${s?.id??Ze} class=${fe(e1e.menu)} id=${r??Ze} @click=${this.handleCalciteActionClick} role=menu tabindex=-1><slot @slotchange=${this.handleDefaultSlotChange}></slot></div></calcite-popover>`}render(){return le`${this.renderMenuButton()}${this.renderMenuItems()}<slot name=${dee.tooltip} @slotchange=${this.updateTooltip}></slot>`}}Oo("calcite-action-menu",BUe);const jfi=Object.freeze(Object.defineProperty({__proto__:null,ActionMenu:BUe},Symbol.toStringTag,{value:"Module"}));/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const Xs={actionBarContainer:"action-bar-container",container:"container",contentBottom:"content-bottom",contentTop:"content-top",header:"header",headerContainer:"header-container",headerContainerBorderEnd:"header-container--border-end",heading:"heading",description:"description",headerContent:"header-content",headerActions:"header-actions",headerActionsEnd:"header-actions--end",headerActionsStart:"header-actions--start",contentWrapper:"content-wrapper",fabContainer:"fab-container",footer:"footer",footerContent:"footer-content",footerActions:"footer-actions",footerStart:"footer-start",footerEnd:"footer-end",headerSlottedContent:"header-slotted-content",menuAction:"menu-action"},t1e={close:"close",collapse:"collapse"},wk={close:"x",menu:"ellipsis",expand:"chevron-down",collapse:"chevron-up"},_u={actionBar:"action-bar",alerts:"alerts",contentBottom:"content-bottom",contentTop:"content-top",headerActionsStart:"header-actions-start",headerActionsEnd:"header-actions-end",headerMenuActions:"header-menu-actions",headerContent:"header-content",fab:"fab",footer:"footer",footerEnd:"footer-end",footerStart:"footer-start",footerActions:"footer-actions"};/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const mGt=Js`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{position:relative;box-sizing:border-box;display:flex;block-size:100%;inline-size:100%;flex:1 1 auto;overflow:hidden;--calcite-min-header-height: calc(var(--calcite-icon-size) * 3);border-radius:var(--calcite-panel-corner-radius, var(--calcite-corner-radius-sharp))}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}.header{margin:0;display:flex;align-content:space-between;align-items:center;fill:var(--calcite-color-text-2);color:var(--calcite-color-text-2)}.heading{margin:0;padding:0;font-weight:var(--calcite-font-weight-medium)}.header .heading{flex:1 1 auto;padding:.5rem}:host([scale=s]){--calcite-internal-panel-default-space: var(--calcite-spacing-sm);--calcite-internal-panel-header-vertical-padding: var(--calcite-spacing-sm-plus)}:host([scale=s]) .header-content .heading{font-size:var(--calcite-font-size--1)}:host([scale=s]) .header-content .description{font-size:var(--calcite-font-size--2)}:host([scale=m]){--calcite-internal-panel-default-space: var(--calcite-spacing-md);--calcite-internal-panel-header-vertical-padding: var(--calcite-spacing-md-plus)}:host([scale=m]) .header-content .heading{font-size:var(--calcite-font-size-0)}:host([scale=m]) .header-content .description{font-size:var(--calcite-font-size--1)}:host([scale=l]){--calcite-internal-panel-default-space: var(--calcite-spacing-lg);--calcite-internal-panel-header-vertical-padding: var(--calcite-spacing-xl)}:host([scale=l]) .header-content .heading{font-size:var(--calcite-font-size-1)}:host([scale=l]) .header-content .description{font-size:var(--calcite-font-size-0)}.content-top,.content-bottom{display:flex;align-items:flex-start;align-self:stretch;padding:var(--calcite-internal-panel-default-space);border-block-start:1px solid var(--calcite-panel-border-color, var(--calcite-color-border-3));background-color:var(--calcite-panel-background-color, var(--calcite-color-foreground-1))}.container{position:relative;margin:0;display:flex;inline-size:100%;flex:1 1 auto;flex-direction:column;align-items:stretch;overflow:hidden;background-color:var(--calcite-color-background);padding:0;color:var(--calcite-color-text-2);transition:max-block-size var(--calcite-animation-timing),inline-size var(--calcite-animation-timing);box-sizing:border-box;font-size:var(--calcite-font-size--1)}.container *{box-sizing:border-box}.container[hidden]{display:none}.header{z-index:var(--calcite-z-index-header);display:flex;flex-direction:column;background-color:var(--calcite-panel-header-background-color, var(--calcite-color-foreground-1));border-block-end:1px solid var(--calcite-panel-border-color, var(--calcite-panel-header-border-block-end, var(--calcite-color-border-3)))}.header-container{display:flex;inline-size:100%;flex-direction:row;align-items:stretch;justify-content:flex-start;flex:0 0 auto}.header-container--border-end{border-block-end:1px solid var(--calcite-panel-border-color, var(--calcite-color-border-3))}.action-bar-container{inline-size:100%}.action-bar-container ::slotted(calcite-action-bar){inline-size:100%}.header-content{display:flex;flex-direction:column;overflow:hidden;padding-inline:.75rem;padding-block:.875rem;margin-inline-end:auto;justify-content:center}.header-content .heading,.header-content .description{display:block;flex:none;overflow-wrap:break-word;padding:0;line-height:var(--calcite-font-line-height-relative-snug)}.header-content .heading{font-weight:var(--calcite-font-weight-medium);color:var(--calcite-panel-heading-text-color, var(--calcite-color-text-1))}.header-content .heading:only-child{margin-block-end:0px}.header-content .description{color:var(--calcite-panel-description-text-color, var(--calcite-color-text-2))}#close,#collapse,.back-button,calcite-action-menu{--calcite-action-background-color: var(--calcite-panel-header-action-background-color);--calcite-action-background-color-hover: var(--calcite-panel-header-action-background-color-hover);--calcite-action-background-color-press: var(--calcite-panel-header-action-background-color-press);--calcite-action-text-color: var(--calcite-panel-header-action-text-color);--calcite-action-text-color-press: var(--calcite-panel-header-action-text-color-press)}.back-button{border-width:0px;border-style:solid;border-inline-end-width:1px;border-color:var(--calcite-panel-border-color, var(--calcite-color-border-3))}.header-actions{display:flex;flex-direction:row;flex-wrap:nowrap;align-items:stretch}.header-actions--end{margin-inline-start:auto}.content-wrapper{position:relative;display:flex;block-size:100%;flex:1 1 auto;flex-direction:column;flex-wrap:nowrap;align-items:stretch;overflow:auto;color:var(--calcite-color-text-2);outline-color:transparent;padding:var(--calcite-panel-space, var(--calcite-panel-content-space, 0));background:var(--calcite-panel-background-color, var(--calcite-color-background))}.content-wrapper:focus-visible{outline:2px solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline-offset:calc(-2px*(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}.header-content{flex:1 1 auto;justify-content:center;padding-block:var(--calcite-internal-panel-header-vertical-padding);padding-inline:var(--calcite-internal-panel-default-space)}.header-content.header-slotted-content{padding:var(--calcite-panel-header-content-space, var(--calcite-internal-panel-header-vertical-padding) var(--calcite-internal-panel-default-space))}.footer{margin-block-start:auto;display:flex;flex-direction:row;align-content:space-between;align-items:center;justify-content:center;font-size:var(--calcite-font-size--2);line-height:1.375;border-block-start:1px solid var(--calcite-panel-border-color, var(--calcite-color-border-3));padding:var(--calcite-panel-footer-space, var(--calcite-panel-footer-padding, var(--calcite-internal-panel-default-space)));background-color:var(--calcite-panel-footer-background-color, var(--calcite-color-foreground-1))}.footer-content{display:flex;flex:1 1 0%;flex-direction:row;align-items:center;justify-content:center}.footer-actions{display:flex;flex:1 1 0%;flex-direction:row;align-items:center;justify-content:space-evenly;gap:var(--calcite-internal-panel-default-space)}.footer-start{display:flex;flex:1 1 0%;flex-direction:row;align-items:center;justify-content:flex-start;margin-inline-end:auto;gap:var(--calcite-internal-panel-default-space)}.footer-end{display:flex;flex:1 1 0%;flex-direction:row;align-items:center;justify-content:flex-end;margin-inline-start:auto;gap:var(--calcite-internal-panel-default-space)}.fab-container{position:sticky;inset-block-end:0px;z-index:var(--calcite-z-index-sticky);margin-block:0px;margin-inline:auto;display:block;padding:.5rem;inset-inline:0;inline-size:fit-content}:host([hidden]){display:none}[hidden]{display:none}`;class VUe extends Vn{constructor(){super(),this.resizeObserver=vf("resize",()=>this.resizeHandler()),this.messages=Fd(),this.hasActionBar=!1,this.hasContentBottom=!1,this.hasContentTop=!1,this.hasEndActions=!1,this.hasFab=!1,this.hasFooterActions=!1,this.hasFooterContent=!1,this.hasFooterEndContent=!1,this.hasFooterStartContent=!1,this.hasHeaderContent=!1,this.hasMenuItems=!1,this.hasStartActions=!1,this.isClosed=!1,this.showHeaderContent=!1,this.closable=!1,this.closed=!1,this.collapseDirection="down",this.collapsed=!1,this.collapsible=!1,this.disabled=!1,this.loading=!1,this.menuOpen=!1,this.menuPlacement=ljt,this.overlayPositioning="absolute",this.scale="m",this.calcitePanelClose=Ut({cancelable:!1}),this.calcitePanelScroll=Ut({cancelable:!1}),this.calcitePanelToggle=Ut({cancelable:!1}),this.listen("keydown",this.panelKeyDownHandler)}static{this.properties={hasActionBar:[16,{},{state:!0}],hasContentBottom:[16,{},{state:!0}],hasContentTop:[16,{},{state:!0}],hasEndActions:[16,{},{state:!0}],hasFab:[16,{},{state:!0}],hasFooterActions:[16,{},{state:!0}],hasFooterContent:[16,{},{state:!0}],hasFooterEndContent:[16,{},{state:!0}],hasFooterStartContent:[16,{},{state:!0}],hasHeaderContent:[16,{},{state:!0}],hasMenuItems:[16,{},{state:!0}],hasStartActions:[16,{},{state:!0}],isClosed:[16,{},{state:!0}],showHeaderContent:[16,{},{state:!0}],beforeClose:[0,{},{attribute:!1}],closable:[7,{},{reflect:!0,type:Boolean}],closed:[7,{},{reflect:!0,type:Boolean}],collapseDirection:1,collapsed:[7,{},{reflect:!0,type:Boolean}],collapsible:[7,{},{reflect:!0,type:Boolean}],description:1,disabled:[7,{},{reflect:!0,type:Boolean}],heading:1,headingLevel:[11,{},{type:Number,reflect:!0}],loading:[7,{},{reflect:!0,type:Boolean}],menuFlipPlacements:[0,{},{attribute:!1}],menuOpen:[7,{},{reflect:!0,type:Boolean}],menuPlacement:[3,{},{reflect:!0}],messageOverrides:[0,{},{attribute:!1}],overlayPositioning:[3,{},{reflect:!0}],scale:[3,{},{reflect:!0}]}}static{this.styles=mGt}async scrollContentTo(e){this.panelScrollEl?.scrollTo(e)}async setFocus(){await dh(this),VG(this.containerEl)}async load(){this.isClosed=this.closed}willUpdate(e){e.has("closed")&&this.hasUpdated&&(this.closed?this.close():this.open())}updated(){yg(this)}disconnectedCallback(){super.disconnectedCallback(),this.resizeObserver?.disconnect()}resizeHandler(){const{panelScrollEl:e}=this;if(!e||typeof e.scrollHeight!="number"||typeof e.offsetHeight!="number")return;e.scrollHeight>e.offsetHeight?e.setAttribute("tabindex","0"):e.removeAttribute("tabindex")}setContainerRef(e){this.containerEl=e}panelKeyDownHandler(e){this.closable&&e.key==="Escape"&&!e.defaultPrevented&&(this.handleUserClose(),e.preventDefault())}handleUserClose(){this.closed=!0,this.calcitePanelClose.emit()}open(){this.isClosed=!1}async close(){const e=this.beforeClose??(()=>Promise.resolve());try{await e()}catch{requestAnimationFrame(()=>{this.closed=!1});return}this.isClosed=!0}collapse(){this.collapsed=!this.collapsed,this.calcitePanelToggle.emit()}panelScrollHandler(){this.calcitePanelScroll.emit()}handleHeaderActionsStartSlotChange(e){this.hasStartActions=$s(e)}handleHeaderActionsEndSlotChange(e){this.hasEndActions=$s(e)}handleHeaderMenuActionsSlotChange(e){this.hasMenuItems=$s(e)}handleActionBarSlotChange(e){const i=ZQ(e).filter(r=>r?.matches("calcite-action-bar"));i.forEach(r=>r.layout="horizontal"),this.hasActionBar=!!i.length}handleHeaderContentSlotChange(e){this.hasHeaderContent=$s(e)}handleFabSlotChange(e){this.hasFab=$s(e)}handleFooterActionsSlotChange(e){this.hasFooterActions=$s(e)}handleFooterEndSlotChange(e){this.hasFooterEndContent=$s(e)}handleFooterStartSlotChange(e){this.hasFooterStartContent=$s(e)}handleFooterSlotChange(e){this.hasFooterContent=$s(e)}contentBottomSlotChangeHandler(e){this.hasContentBottom=$s(e)}contentTopSlotChangeHandler(e){this.hasContentTop=$s(e)}setPanelScrollEl(e){this.panelScrollEl=e,this.resizeObserver?.disconnect(),e&&(this.resizeObserver?.observe(e),this.resizeHandler())}handleAlertsSlotChange(e){ZQ(e)?.map(i=>{i.nodeName==="CALCITE-ALERT"&&(i.embedded=!0)})}renderHeaderContent(){const{heading:e,headingLevel:i,description:r,hasHeaderContent:s}=this,n=e?PUe({class:Xs.heading,level:i,children:e}):null,o=r?le`<span class=${fe(Xs.description)}>${r}</span>`:null;return!s&&(n||o)?Zi("header-content",le`<div class=${fe(Xs.headerContent)}>${n}${o}</div>`):null}renderActionBar(){return le`<div class=${fe(Xs.actionBarContainer)} .hidden=${!this.hasActionBar}><slot name=${_u.actionBar} @slotchange=${this.handleActionBarSlotChange}></slot></div>`}renderHeaderSlottedContent(){return Zi("slotted-header-content",le`<div class=${fe({[Xs.headerContent]:!0,[Xs.headerSlottedContent]:!0})} .hidden=${!this.hasHeaderContent}><slot name=${_u.headerContent} @slotchange=${this.handleHeaderContentSlotChange}></slot></div>`)}renderHeaderStartActions(){const{hasStartActions:e}=this;return Zi("header-actions-start",le`<div class=${fe({[Xs.headerActionsStart]:!0,[Xs.headerActions]:!0})} .hidden=${!e}><slot name=${_u.headerActionsStart} @slotchange=${this.handleHeaderActionsStartSlotChange}></slot></div>`)}renderHeaderActionsEnd(){const{hasEndActions:e,messages:i,closable:r,collapsed:s,collapseDirection:n,collapsible:o,hasMenuItems:a}=this,{collapse:l,expand:c,close:h}=i,d=[wk.expand,wk.collapse];n==="up"&&d.reverse();const f=o?le`<calcite-action .ariaExpanded=${!s} .ariaLabel=${l} .icon=${s?d[0]:d[1]} id=${t1e.collapse} @click=${this.collapse} .scale=${this.scale} .text=${l} title=${(s?c:l)??Ze}></calcite-action>`:null,m=r?le`<calcite-action .ariaLabel=${h} .icon=${wk.close} id=${t1e.close} @click=${this.handleUserClose} .scale=${this.scale} .text=${h} title=${h??Ze}></calcite-action>`:null,y=le`<slot name=${_u.headerActionsEnd} @slotchange=${this.handleHeaderActionsEndSlotChange}></slot>`,v=e||f||m||a;return Zi("header-actions-end",le`<div class=${fe({[Xs.headerActionsEnd]:!0,[Xs.headerActions]:!0})} .hidden=${!v}>${y}${this.renderMenu()}${f}${m}</div>`)}renderMenu(){const{hasMenuItems:e,messages:i,menuOpen:r,menuFlipPlacements:s,menuPlacement:n}=this;return Zi("menu",le`<calcite-action-menu .flipPlacements=${s??["top","bottom"]} .hidden=${!e} .label=${i.options} .open=${r} .overlayPositioning=${this.overlayPositioning} .placement=${n}><calcite-action class=${fe(Xs.menuAction)} .icon=${wk.menu} .scale=${this.scale} slot=${dee.trigger} .text=${i.options}></calcite-action><slot name=${_u.headerMenuActions} @slotchange=${this.handleHeaderMenuActionsSlotChange}></slot></calcite-action-menu>`)}renderHeaderNode(){const{hasHeaderContent:e,hasStartActions:i,hasEndActions:r,closable:s,collapsible:n,hasMenuItems:o,hasActionBar:a}=this,l=this.renderHeaderContent(),c=e||!!l||i||r||n||s||o;return this.showHeaderContent=c,le`<header class=${fe(Xs.header)} .hidden=${!(c||a)}><div class=${fe({[Xs.headerContainer]:!0,[Xs.headerContainerBorderEnd]:a})} .hidden=${!c}>${this.renderHeaderStartActions()}${this.renderHeaderSlottedContent()}${l}${this.renderHeaderActionsEnd()}</div>${this.renderActionBar()}${this.renderContentTop()}</header>`}renderFooterNode(){const{hasFooterEndContent:e,hasFooterStartContent:i,hasFooterContent:r,hasFooterActions:s}=this,n=i||e||r||s;return le`<footer class=${fe(Xs.footer)} .hidden=${!n}><div class=${fe(Xs.footerContent)} .hidden=${!r}><slot name=${_u.footer} @slotchange=${this.handleFooterSlotChange}></slot></div><div class=${fe(Xs.footerStart)} .hidden=${r||!i}><slot name=${_u.footerStart} @slotchange=${this.handleFooterStartSlotChange}></slot></div><div class=${fe(Xs.footerEnd)} .hidden=${r||!e}><slot name=${_u.footerEnd} @slotchange=${this.handleFooterEndSlotChange}></slot></div><div class=${fe(Xs.footerActions)} .hidden=${r||!s}>${Zi("footer-actions-slot",le`<slot name=${_u.footerActions} @slotchange=${this.handleFooterActionsSlotChange}></slot>`)}</div></footer>`}renderContent(){return le`<div class=${fe(Xs.contentWrapper)} .hidden=${this.collapsible&&this.collapsed} @scroll=${this.panelScrollHandler} ${wr(this.setPanelScrollEl)}><slot></slot>${this.renderFab()}</div>`}renderContentBottom(){return le`<div class=${fe(Xs.contentBottom)} .hidden=${!this.hasContentBottom}><slot name=${_u.contentBottom} @slotchange=${this.contentBottomSlotChangeHandler}></slot></div>`}renderContentTop(){return le`<div class=${fe(Xs.contentTop)} .hidden=${!this.hasContentTop}><slot name=${_u.contentTop} @slotchange=${this.contentTopSlotChangeHandler}></slot></div>`}renderFab(){return le`<div class=${fe(Xs.fabContainer)} .hidden=${!this.hasFab}><slot name=${_u.fab} @slotchange=${this.handleFabSlotChange}></slot></div>`}render(){const{disabled:e,loading:i,isClosed:r}=this,s=le`<article .ariaBusy=${i} class=${fe(Xs.container)} .hidden=${r} ${wr(this.setContainerRef)}>${this.renderHeaderNode()}${this.renderContent()}${this.renderContentBottom()}${this.renderFooterNode()}${Zi("alerts",le`<slot name=${_u.alerts} @slotchange=${this.handleAlertsSlotChange}></slot>`)}</article>`;return vg({disabled:e,children:le`${i?le`<calcite-scrim .loading=${i}></calcite-scrim>`:null}${s}`})}}Oo("calcite-panel",VUe);const gGt=Object.freeze(Object.defineProperty({__proto__:null,Panel:VUe},Symbol.toStringTag,{value:"Module"})),Wi=new sot({container:"mapViewContainer",map:new Ukt({portalItem:{id:"7ee3c8a93f254753a83ac0195757f137"}}),center:[-122.4376,37.7728],zoom:12}),Bs=new $Pt({container:"sceneViewContainer",map:new N4t({portalItem:{id:"c8cf26d7acab4e45afcd5e20080983c1"}}),center:[-122.4376,37.7728],zoom:12});window.appViews={mapView:Wi,sceneView:Bs};const yGt=new fn,vGt=new pC({portal:yGt,query:{id:"bdb9d65e0b5c480c8dcc6916e7f4e099"}}),pee=new Z4t({view:Wi,source:vGt,container:document.createElement("div")}),S_=new J4t({view:Wi,content:pee,expandIcon:"basemap",group:"top-left"});Wi.ui.add(S_,"top-left");const T_=document.createElement("view-extent");T_.view=Wi;Wi.ui.add(T_,"bottom-right");const E_=document.createElement("draw-extent");E_.view=Wi;Wi.ui.add(E_,"bottom-left");const Im=document.createElement("calcite-panel");Im.style.margin="10px";Im.heading="Spatial Reference";Im.id="srPanel";Im.innerHTML='<div id="srPanelContent" style="font-size:16px;padding:4px 0;"></div>';function SS(t){const e=Im.querySelector("#srPanelContent");e&&(e.innerHTML=`map.spatialReference.wkid = <b>${t.spatialReference?.wkid}</b>`)}H(()=>Wi.spatialReference,()=>SS(Wi));H(()=>Bs.spatialReference,()=>SS(Bs));Wi.on("layerview-create",()=>SS(Wi));Bs.on("layerview-create",()=>SS(Bs));SS(Wi);Wi.ui.add(Im,"top-right");Wi.ui.add(S_,{position:"top-right",index:1});const XC=document.querySelector("view-switcher");XC.setView(Wi);Wi.ui.add(XC,"top-left");Bs.ui.add(XC,"top-left");const ld=document.createElement("layer-manager");ld.view=Wi;Wi.ui.add(ld,"manual");function i1e(t,e){if(!t?.map||!e?.map)return;const i=t.map.layers.map(r=>r.url).filter(r=>!!r);e.map.layers.filter(r=>r.url&&!i.includes(r.url)).forEach(r=>e.map.layers.remove(r)),t.map.layers.forEach(r=>{if(r.url&&!e.map.layers.find(s=>s.url===r.url)){const s=r.declaredClass?require(`@arcgis/core/layers/${r.declaredClass.split(".").pop()}`).default:require("@arcgis/core/layers/FeatureLayer").default;try{const n=new s({url:r.url});e.map.layers.add(n)}catch{}}}),t.extent&&e.goTo(t.extent).catch(()=>{})}XC.addEventListener("view-switch",t=>{const e=t.detail.is3D,i=document.getElementById("mapViewContainer"),r=document.getElementById("sceneViewContainer");e?(i.style.display="none",r.style.display="",XC.setView(Bs),Wi.ui.remove(S_),Bs.ui.add(S_,{position:"top-right",index:1}),S_.view=Bs,pee.view=Bs,SS(Bs),Wi.ui.remove(Im),Bs.ui.add(Im,"top-right"),Wi.ui.remove(T_),Bs.ui.add(T_,"bottom-right"),T_.view=Bs,Wi.ui.remove(E_),Bs.ui.add(E_,"bottom-left"),E_.view=Bs,Wi.ui.remove(ld),Bs.ui.add(ld,"manual"),ld.view=Bs,i1e(Wi,Bs)):(r.style.display="none",i.style.display="",XC.setView(Wi),Bs.ui.remove(S_),Wi.ui.add(S_,{position:"top-right",index:1}),S_.view=Wi,pee.view=Wi,SS(Wi),Bs.ui.remove(Im),Wi.ui.add(Im,"top-right"),Bs.ui.remove(T_),Wi.ui.add(T_,"bottom-right"),T_.view=Wi,Bs.ui.remove(E_),Wi.ui.add(E_,"bottom-left"),E_.view=Wi,Bs.ui.remove(ld),Wi.ui.add(ld,"manual"),ld.view=Wi,i1e(Bs,Wi))});document.getElementById("sceneViewContainer").style.display="none";document.getElementById("mapViewContainer").style.display="";ld.style.position="absolute";ld.style.left="50%";ld.style.bottom="30px";ld.style.transform="translateX(-50%)";const _Gt=Object.freeze(Object.defineProperty({__proto__:null,build:zPe},Symbol.toStringTag,{value:"Module"})),bGt=Object.freeze(Object.defineProperty({__proto__:null,build:UPe,getRadius:tG},Symbol.toStringTag,{value:"Module"})),wGt=Object.freeze(Object.defineProperty({__proto__:null,build:ZPe},Symbol.toStringTag,{value:"Module"})),xGt=Object.freeze(Object.defineProperty({__proto__:null,build:JPe},Symbol.toStringTag,{value:"Module"})),SGt=Object.freeze(Object.defineProperty({__proto__:null,build:g3e},Symbol.toStringTag,{value:"Module"})),TGt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:Fse,blurSize:kse,build:m3e,gridCellPixelSize:X_,outlineSize:n3},Symbol.toStringTag,{value:"Module"})),EGt=Object.freeze(Object.defineProperty({__proto__:null,build:y3e},Symbol.toStringTag,{value:"Module"})),CGt=Object.freeze(Object.defineProperty({__proto__:null,build:v3e},Symbol.toStringTag,{value:"Module"})),$Gt=Object.freeze(Object.defineProperty({__proto__:null,SingleHighlightBlurDrawParameters:zse,build:_3e},Symbol.toStringTag,{value:"Module"})),AGt=Object.freeze(Object.defineProperty({__proto__:null,build:W3e,ribbonlineNumRoundJoinSubdivisions:a3},Symbol.toStringTag,{value:"Module"})),MGt=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:Nse,build:d3e},Symbol.toStringTag,{value:"Module"})),OGt=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:Wse,build:K3e},Symbol.toStringTag,{value:"Module"})),IGt=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaColorPassParameters:Jse,build:nDe},Symbol.toStringTag,{value:"Module"})),RGt=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaMaskDrawParameters:Xse,build:oDe},Symbol.toStringTag,{value:"Module"})),PGt=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:nne,build:VDe,cubeMapSize:zC},Symbol.toStringTag,{value:"Module"})),DGt=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:one,build:jDe},Symbol.toStringTag,{value:"Module"})),LGt=Object.freeze(Object.defineProperty({__proto__:null,build:WDe},Symbol.toStringTag,{value:"Module"})),NGt=Object.freeze(Object.defineProperty({__proto__:null,build:QLe,calculateAnchorPosition:y3},Symbol.toStringTag,{value:"Module"})),FGt=Object.freeze(Object.defineProperty({__proto__:null,build:nNe},Symbol.toStringTag,{value:"Module"})),kGt=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:Hne,build:pFe},Symbol.toStringTag,{value:"Module"})),zGt=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return Sv},build:LFe},Symbol.toStringTag,{value:"Module"})),UGt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:BFe,ColorizerStretchUniforms:UFe,ColorizerUniforms:EG,build:VFe},Symbol.toStringTag,{value:"Module"})),BGt=Object.freeze(Object.defineProperty({__proto__:null,build:nke},Symbol.toStringTag,{value:"Module"})),VGt=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:aoe,build:ake},Symbol.toStringTag,{value:"Module"})),jGt=Object.freeze(Object.defineProperty({__proto__:null,build:lke},Symbol.toStringTag,{value:"Module"})),GGt=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:loe,build:cke},Symbol.toStringTag,{value:"Module"})),HGt=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:uoe,SimpleAtmospherePassParameters:$G,build:uke},Symbol.toStringTag,{value:"Module"})),qGt=Object.freeze(Object.defineProperty({__proto__:null,build:mke},Symbol.toStringTag,{value:"Module"})),WGt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:AG,build:_ke},Symbol.toStringTag,{value:"Module"})),ZGt=Object.freeze(Object.defineProperty({__proto__:null,HazeCompositingPassParameters:poe,build:wke},Symbol.toStringTag,{value:"Module"})),YGt=Object.freeze(Object.defineProperty({__proto__:null,build:xke},Symbol.toStringTag,{value:"Module"})),JGt=Object.freeze(Object.defineProperty({__proto__:null,build:Ske},Symbol.toStringTag,{value:"Module"})),XGt=Object.freeze(Object.defineProperty({__proto__:null,MagnifierPassParameters:moe,build:Tke},Symbol.toStringTag,{value:"Module"})),KGt=Object.freeze(Object.defineProperty({__proto__:null,build:Eke},Symbol.toStringTag,{value:"Module"})),QGt=Object.freeze(Object.defineProperty({__proto__:null,build:Cke},Symbol.toStringTag,{value:"Module"})),e6t=Object.freeze(Object.defineProperty({__proto__:null,build:$ke},Symbol.toStringTag,{value:"Module"})),t6t=Object.freeze(Object.defineProperty({__proto__:null,build:Ake},Symbol.toStringTag,{value:"Module"})),i6t=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:goe,build:Oke},Symbol.toStringTag,{value:"Module"})),r6t=Object.freeze(Object.defineProperty({__proto__:null,OITBlendPassParameters:voe,build:Vke},Symbol.toStringTag,{value:"Module"})),s6t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:_oe,build:qke},Symbol.toStringTag,{value:"Module"})),n6t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:QD,build:Hke},Symbol.toStringTag,{value:"Module"}));export{Cfi as $,Js as A,rZt as A$,QYe as A0,b9 as A1,VJe as A2,BJe as A3,aie as A4,M7 as A5,B8t as A6,O7 as A7,Fz as A8,Nz as A9,RTt as AA,L9t as AB,$V as AC,fii as AD,Kie as AE,Qct as AF,Yot as AG,w$ as AH,xpi as AI,DX as AJ,rpi as AK,_pi as AL,Zdi as AM,npi as AN,ipi as AO,jNt as AP,spi as AQ,abe as AR,nbe as AS,obe as AT,hpi as AU,upi as AV,SSt as AW,ppi as AX,dpi as AY,eZt as AZ,VNt as A_,BLe as Aa,WHt as Ab,qHt as Ac,u6e as Ad,M$e as Ae,ije as Af,tje as Ag,gst as Ah,Mqt as Ai,Ho as Aj,N$ as Ak,Cpi as Al,TWt as Am,Eye as An,EYe as Ao,Bqt as Ap,EZt as Aq,Rdi as Ar,Bae as As,Kqt as At,CZt as Au,VX as Av,nXe as Aw,MTt as Ax,A1e as Ay,z6t as Az,Oo as B,$ye as B$,lhi as B0,HNt as B1,QWt as B2,Xdi as B3,wrt as B4,KWt as B5,Fhe as B6,AWt as B7,MWt as B8,TSt as B9,Bye as BA,w8t as BB,Wye as BC,hve as BD,dve as BE,pve as BF,aHe as BG,u8t as BH,G6e as BI,L7 as BJ,fve as BK,h8t as BL,get as BM,tpi as BN,mpi as BO,Spi as BP,f8t as BQ,SNe as BR,cpi as BS,lpi as BT,xve as BU,Nye as BV,Tve as BW,wve as BX,Zye as BY,Mye as BZ,Aye as B_,sZt as Ba,nZt as Bb,fZt as Bc,mZt as Bd,zWt as Be,gZt as Bf,yZt as Bg,nrt as Bh,crt as Bi,GDe as Bj,fa as Bk,WWt as Bl,vBe as Bm,uv as Bn,G$t as Bo,SMe as Bp,oZt as Bq,Uxe as Br,ZOt as Bs,xet as Bt,Gye as Bu,zye as Bv,V6e as Bw,Uye as Bx,$Se as By,rve as Bz,R3t as C,bi as C$,Lye as C0,QV as C1,opi as C2,api as C3,b6e as C4,_6e as C5,e8t as C6,PBe as C7,IJe as C8,tqt as C9,f7 as CA,SZt as CB,xZt as CC,wZt as CD,Irt as CE,oMe as CF,BWt as CG,UWt as CH,Si as CI,Art as CJ,TZt as CK,SWt as CL,vQe as CM,ar as CN,By as CO,Y_ as CP,zD as CQ,Z_ as CR,wse as CS,sG as CT,Se as CU,E as CV,FA as CW,pt as CX,$t as CY,Bi as CZ,Fi as C_,iqt as Ca,Mii as Cb,rie as Cc,Tk as Cd,DJe as Ce,kP as Cf,UP as Cg,T$ as Ch,PJe as Ci,R6t as Cj,Xh as Ck,Y4t as Cl,Ynt as Cm,R8t as Cn,J8 as Co,X8 as Cp,trt as Cq,ete as Cr,kxt as Cs,y8t as Ct,edi as Cu,ssi as Cv,jHe as Cw,xdi as Cx,wdi as Cy,The as Cz,xFt as D,vei as D$,_i as D0,Ddt as D1,vJ as D2,gse as D3,UU as D4,Ai as D5,Gj as D6,sPe as D7,hse as D8,WRe as D9,Va as DA,DD as DB,kj as DC,hXe as DD,lXe as DE,rni as DF,Vsi as DG,vX as DH,LOe as DI,_Yt as DJ,bYt as DK,yYt as DL,JHt as DM,uc as DN,cse as DO,sse as DP,yHt as DQ,hS as DR,pgt as DS,nyt as DT,fv as DU,Ua as DV,VU as DW,Fn as DX,LD as DY,FR as DZ,H3e as D_,NA as Da,Rdt as Db,_s as Dc,zm as Dd,Jo as De,te as Df,Fj as Dg,PD as Dh,Pdt as Di,adt as Dj,FRe as Dk,ept as Dl,zj as Dm,Ydt as Dn,P9t as Do,cXe as Dp,k9t as Dq,jXt as Dr,yPe as Ds,_se as Dt,Co as Du,Ese as Dv,fc as Dw,Qc as Dx,Zb as Dy,ND as Dz,Un as E,bt as E$,upt as E0,ope as E1,Od as E2,cpt as E3,opt as E4,npt as E5,pu as E6,KJt as E7,dS as E8,Dpt as E9,Iqt as EA,ebt as EB,hre as EC,fot as ED,RAe as EE,AZe as EF,VZe as EG,cre as EH,Jy as EI,Hgt as EJ,fr as EK,jo as EL,EA as EM,eG as EN,mse as EO,Wte as EP,ea as EQ,Yht as ER,fg as ES,MPe as ET,FD as EU,so as EV,gft as EW,Jb as EX,hd as EY,xf as EZ,ut as E_,Xj as Ea,Lx as Eb,XJt as Ec,Mht as Ed,Md as Ee,TOe as Ef,Oqt as Eg,fYt as Eh,lg as Ei,Nte as Ej,cIe as Ek,Ib as El,Cr as Em,use as En,JJt as Eo,Kdt as Ep,pse as Eq,D9t as Er,Rli as Es,Ili as Et,Vvt as Eu,Kse as Ev,rte as Ew,s0e as Ex,cat as Ey,POe as Ez,$Ft as F,hKt as F$,ipt as F0,rpt as F1,Ld as F2,U$ as F3,PPe as F4,cXt as F5,Km as F6,lXt as F7,or as F8,Yb as F9,QIe as FA,Ja as FB,Yc as FC,ou as FD,bke as FE,ya as FF,hYt as FG,ipe as FH,mot as FI,Z2 as FJ,mJt as FK,I9t as FL,fct as FM,QPe as FN,dct as FO,Wdi as FP,P2 as FQ,ysi as FR,uKt as FS,nti as FT,Eri as FU,Tri as FV,U1t as FW,z1t as FX,Xlt as FY,Fm as FZ,Tde as F_,yke as Fa,EOt as Fb,Jde as Fc,hoe as Fd,Dht as Fe,Ly as Ff,Fh as Fg,Cs as Fh,Izt as Fi,HG as Fj,Fzt as Fk,Bzt as Fl,Zri as Fm,XYt as Fn,_8t as Fo,f1e as Fp,Hoi as Fq,d8t as Fr,Yri as Fs,rc as Ft,Hb as Fu,Sge as Fv,Oh as Fw,Qb as Fx,R$ as Fy,cdt as Fz,Dr as G,vct as G$,k1t as G0,Cre as G1,P1t as G2,Ppt as G3,aKt as G4,z3e as G5,VYt as G6,uXe as G7,zH as G8,wri as G9,hU as GA,_ct as GB,_Ht as GC,rQe as GD,UH as GE,wpt as GF,Zj as GG,Ose as GH,Jj as GI,hCt as GJ,yse as GK,xse as GL,nse as GM,j$ as GN,iG as GO,edt as GP,rG as GQ,V$ as GR,mv as GS,_t as GT,hf as GU,udt as GV,eo as GW,LH as GX,Yde as GY,lPe as GZ,yct as G_,xIe as Ga,Iht as Gb,Mct as Gc,got as Gd,Ede as Ge,Uht as Gf,mct as Gg,HS as Gh,Eht as Gi,WYt as Gj,VCe as Gk,dht as Gl,jJt as Gm,IAe as Gn,ght as Go,Uft as Gp,kft as Gq,Rp as Gr,AH as Gs,bri as Gt,tJt as Gu,pKt as Gv,RYt as Gw,nJt as Gx,Fdt as Gy,Rde as Gz,U as H,pct as H0,DIe as H1,sXe as H2,xYt as H3,k4 as H4,s3 as H5,_ri as H6,Gft as H7,Q3e as H8,hQt as H9,Y8t as HA,X8t as HB,gM as HC,zYt as HD,Odi as HE,ok as HF,Efi as HG,vze as HH,lae as HI,Dfi as HJ,Lfi as HK,Nfi as HL,Ffi as HM,yjt as HN,kfi as HO,zfi as HP,Bfi as HQ,Vfi as HR,uGt as HS,jfi as HT,dQt as Ha,Bei as Hb,fQt as Hc,fSt as Hd,tC as He,yX as Hf,CSt as Hg,t$e as Hh,PXe as Hi,Asi as Hj,lSt as Hk,cSt as Hl,$si as Hm,vSt as Hn,uSt as Ho,F1t as Hp,Tsi as Hq,Csi as Hr,MQt as Hs,BPe as Ht,Imt as Hu,eg as Hv,rxe as Hw,pQt as Hx,P$ as Hy,Zei as Hz,vg as I,Vc as J,Ci as K,Vn as L,$P as M,gt as N,qV as O,Nt as P,me as Q,Bb as R,eL as S,SDt as T,aGt as U,vf as V,VG as W,Sae as X,oL as Y,Rfi as Z,V as _,HDe as a,pLt as a$,mj as a0,Zi as a1,djt as a2,IR as a3,jZt as a4,VZt as a5,sDt as a6,zFt as a7,NFt as a8,LFt as a9,J as aA,NS as aB,Ml as aC,qe as aD,dt as aE,Sm as aF,Ee as aG,QCe as aH,mie as aI,DS as aJ,RXe as aK,AA as aL,q2 as aM,cb as aN,vLt as aO,H as aP,Gt as aQ,UYt as aR,BYt as aS,Clt as aT,$i as aU,Jm as aV,St as aW,KYt as aX,gsi as aY,AYe as aZ,tE as a_,I3t as aa,nDt as ab,z_ as ac,Ti as ad,OYt as ae,zz as af,To as ag,gi as ah,cD as ai,YFt as aj,Xr as ak,Jz as al,ge as am,Ei as an,Ae as ao,pn as ap,gb as aq,Rz as ar,zHt as as,Hc as at,Yt as au,yR as av,ru as aw,boi as ax,sne as ay,wa as az,u as b,ke as b$,of as b0,s9t as b1,WV as b2,Y$ as b3,Jt as b4,W9 as b5,b6t as b6,Jit as b7,d1e as b8,Aqt as b9,hWe as bA,zb as bB,U3 as bC,Pm as bD,q3 as bE,TS as bF,W8t as bG,H8t as bH,q8t as bI,Zm as bJ,uA as bK,fd as bL,Xsi as bM,C2e as bN,cd as bO,jP as bP,eQe as bQ,wy as bR,uU as bS,Bo as bT,U$e as bU,ud as bV,rD as bW,It as bX,Jc as bY,a$ as bZ,CS as b_,xx as ba,eh as bb,fn as bc,mr as bd,fle as be,CR as bf,_Dt as bg,$W as bh,G3 as bi,hV as bj,aD as bk,LV as bl,twt as bm,pr as bn,_V as bo,mG as bp,fb as bq,Qn as br,rs as bs,mc as bt,$ as bu,He as bv,oQe as bw,_Qe as bx,ne as by,se as bz,A as c,wpi as c$,TYe as c0,IYt as c1,v4e as c2,Q$e as c3,Pj as c4,X as c5,Cl as c6,sj as c7,ee as c8,ei as c9,Ope as cA,RZe as cB,Sl as cC,N2e as cD,Dd as cE,N1e as cF,kHt as cG,pV as cH,K3 as cI,AP as cJ,Bkt as cK,Ku as cL,bGe as cM,i$ as cN,Yee as cO,wGe as cP,_5e as cQ,SD as cR,Ed as cS,RHt as cT,yGe as cU,Dhe as cV,_U as cW,$Zt as cX,B$t as cY,Rx as cZ,vpi as c_,Ue as ca,Kdi as cb,epi as cc,Qdi as cd,BNt as ce,UNt as cf,$Dt as cg,X3 as ch,EGe as ci,Xee as cj,$Ge as ck,AGe as cl,aK as cm,Xoe as cn,DQ as co,Ykt as cp,Koe as cq,p$ as cr,ymt as cs,Le as ct,JH as cu,is as cv,RQt as cw,PQt as cx,Ve as cy,LU as cz,Dm as d,av as d$,bpi as d0,q as d1,fpi as d2,Jqt as d3,NAt as d4,Ydi as d5,Jdi as d6,Hoe as d7,ZSe as d8,XWt as d9,x1e as dA,Qh as dB,yAe as dC,lc as dD,GL as dE,pte as dF,dte as dG,nb as dH,AV as dI,b8t as dJ,K$e as dK,Qt as dL,fx as dM,OSe as dN,PX as dO,sHt as dP,Ya as dQ,di as dR,vt as dS,Qe as dT,N8t as dU,o9e as dV,OJe as dW,U8t as dX,ZWe as dY,AJe as dZ,bJe as d_,art as da,Nre as db,_4e as dc,KZe as dd,QZe as de,hxt as df,fxt as dg,pxt as dh,dxt as di,p4 as dj,xa as dk,Hz as dl,Hi as dm,Xo as dn,J3 as dp,Qo as dq,vi as dr,mA as ds,nu as dt,OZt as du,wSt as dv,Pi as dw,Zs as dx,gf as dy,Ui as dz,Gc as e,df as e$,nSt as e0,yA as e1,dGe as e2,TLt as e3,Cdi as e4,bdi as e5,p$e as e6,ER as e7,wZ as e8,SLt as e9,xoe as eA,n4e as eB,Nd as eC,z as eD,jj as eE,Ldt as eF,OWe as eG,sh as eH,W9e as eI,mB as eJ,KOe as eK,Gi as eL,INt as eM,q_ as eN,QGe as eO,Lri as eP,Api as eQ,mue as eR,$pi as eS,tS as eT,xP as eU,Tr as eV,N9t as eW,osi as eX,ch as eY,sv as eZ,gn as e_,$di as ea,Adi as eb,yt as ec,BL as ed,z8t as ee,k8t as ef,F8t as eg,xCe as eh,l9t as ei,c9t as ej,wb as ek,VKe as el,Cd as em,w7t as en,h2t as eo,goi as ep,SPt as eq,Thi as er,jni as es,T3 as et,Ppi as eu,Ub as ev,ws as ew,io as ex,Q3 as ey,Ir as ez,Fd as f,ye as f$,Vte as f0,Id as f1,$v as f2,nv as f3,Ao as f4,T7 as f5,Gs as f6,kz as f7,S7 as f8,C7 as f9,OD as fA,Ea as fB,Nn as fC,Wt as fD,tre as fE,Be as fF,oc as fG,gr as fH,A9e as fI,th as fJ,li as fK,dQe as fL,lh as fM,Eo as fN,Ysi as fO,nn as fP,LEe as fQ,jp as fR,Rqt as fS,uYt as fT,mne as fU,RA as fV,Pn as fW,Ob as fX,Zr as fY,$Yt as fZ,Br as f_,DEe as fa,$J as fb,Shi as fc,ag as fd,hc as fe,Xqt as ff,MJe as fg,Chi as fh,Jti as fi,m3 as fj,Xti as fk,ff as fl,BP as fm,lt as fn,ae as fo,h$ as fp,Mo as fq,v_ as fr,at as fs,mDt as ft,ce as fu,$r as fv,nr as fw,rS as fx,$he as fy,WWe as fz,ue as g,oZ as g$,wYt as g0,D$ as g1,Te as g2,mYt as g3,de as g4,ie as g5,oe as g6,Er as g7,FOe as g8,Dx as g9,Zsi as gA,wt as gB,Dt as gC,$Ve as gD,ec as gE,tD as gF,Hpi as gG,bkt as gH,FQe as gI,kQe as gJ,wkt as gK,qit as gL,vWt as gM,bWt as gN,AZt as gO,Xm as gP,t9e as gQ,af as gR,bA as gS,sKe as gT,rKe as gU,Is as gV,gs as gW,CA as gX,Ipi as gY,ev as gZ,a6 as g_,yd as ga,vj as gb,lyt as gc,LAt as gd,vJt as ge,Iv as gf,A4 as gg,emt as gh,wd as gi,nG as gj,EQt as gk,SQt as gl,TQt as gm,Iyt as gn,pYt as go,xr as gp,on as gq,Ne as gr,Zte as gs,$2e as gt,jS as gu,Ri as gv,Xn as gw,dni as gx,fni as gy,pni as gz,Hy as h,lb as h$,x8t as h0,kCe as h1,F9t as h2,Ihi as h3,e_e as h4,Yl as h5,vS as h6,Hm as h7,q9 as h8,v2e as h9,yie as hA,uJe as hB,a9t as hC,qxt as hD,Wxt as hE,iD as hF,_Ne as hG,esi as hH,Qri as hI,JYe as hJ,ZV as hK,eu as hL,wJe as hM,d9t as hN,qu as hO,h9t as hP,tie as hQ,$je as hR,tSe as hS,Kee as hT,JGe as hU,tsi as hV,Mxt as hW,lO as hX,uRe as hY,Bn as hZ,MY as h_,ew as ha,oNt as hb,FG as hc,QDt as hd,eLt as he,tLt as hf,rdi as hg,T_e as hh,WQe as hi,JWe as hj,LZt as hk,qx as hl,kdi as hm,u9t as hn,yb as ho,okt as hp,qpi as hq,Y3 as hr,Xc as hs,O6t as ht,gXt as hu,qht as hv,Fv as hw,nct as hx,aSe as hy,u5e as hz,Ut as i,xjt as i$,jc as i0,Uc as i1,CVe as i2,G6t as i3,kxe as i4,t$ as i5,Hee as i6,lD as i7,YSe as i8,TGe as i9,ini as iA,Qsi as iB,tni as iC,EDt as iD,Tz as iE,Zoe as iF,vC as iG,U9e as iH,Tx as iI,to as iJ,B7 as iK,Jh as iL,B$e as iM,jb as iN,$d as iO,ove as iP,ive as iQ,n8t as iR,u$ as iS,mii as iT,hae as iU,ZQ as iV,xU as iW,dee as iX,Ze as iY,dze as iZ,ljt as i_,DHt as ia,lAt as ib,j3 as ic,Tee as id,zPt as ie,JFt as ig,TDt as ih,uh as ii,Xa as ij,ug as ik,gD as il,wYe as im,_Ye as io,pYe as ip,vl as iq,Vkt as ir,vW as is,I5e as it,El as iu,$o as iv,st as iw,uSe as ix,MAe as iy,OAe as iz,Sa as j,Ksi as j$,PUe as j0,aae as j1,Pfi as j2,QQ as j3,P3 as j4,GG as j5,uzt as j6,Aze as j7,dzt as j8,Qwe as j9,Ifi as jA,_u as jB,Ufi as jC,yEe as jD,XAt as jE,Nri as jF,Fri as jG,j9t as jH,gpi as jI,g6t as jJ,QC as jK,DZe as jL,M1e as jM,U6t as jN,GHt as jO,y6t as jP,v6t as jQ,HHt as jR,Vb as jS,jqt as jT,og as jU,Gqt as jV,Vqt as jW,ux as jX,qqt as jY,Gy as jZ,Ree as j_,eee as ja,fzt as jb,ZP as jc,Yzt as jd,Ap as je,gP as jf,M_ as jg,Cie as jh,Wat as ji,ytt as jj,XS as jk,Rwe as jl,EUe as jm,xae as jn,wae as jo,lR as jp,Ajt as jq,QB as jr,BG as js,Mfi as jt,Fdi as ju,OHt as jv,FHt as jw,v_e as jx,R9t as jy,U9t as jz,dh as k,Qhi as k$,GVe as k0,vP as k1,n5t as k2,F6t as k3,J9t as k4,Zu as k5,mte as k6,b_e as k7,Rte as k8,VS as k9,wl as kA,gJt as kB,bs as kC,_b as kD,fs as kE,Gse as kF,lf as kG,In as kH,z7 as kI,$3 as kJ,ndi as kK,$l as kL,XFt as kM,GLt as kN,VFt as kO,iFt as kP,PG as kQ,wEe as kR,ms as kS,K as kT,mO as kU,Ex as kV,xi as kW,F6 as kX,Kte as kY,gDt as kZ,Xpi as k_,xee as ka,See as kb,T6t as kc,Vht as kd,YJt as ke,Ln as kf,Bht as kg,S6t as kh,iHe as ki,RP as kj,xat as kk,Hut as kl,HQe as km,jWt as kn,IX as ko,RX as kp,xQ as kq,gHt as kr,tZt as ks,Ik as kt,nW as ku,I2 as kv,EV as kw,S8t as kx,ES as ky,Zo as kz,yg as l,mV as l$,Idi as l0,o9t as l1,Qqt as l2,i9t as l3,e9t as l4,r9t as l5,iS as l6,t9t as l7,n9t as l8,cc as l9,Kbt as lA,TVe as lB,pkt as lC,lk as lD,yV as lE,ng as lF,fA as lG,ate as lH,D6e as lI,ka as lJ,wo as lK,G9e as lL,gR as lM,Ole as lN,LHt as lO,ZLt as lP,$3t as lQ,S_e as lR,F5 as lS,idi as lT,NK as lU,Pee as lV,kIe as lW,Bdi as lX,fkt as lY,d2t as lZ,uti as l_,FYt as la,NYt as lb,RU as lc,Hsi as ld,EU as le,Tre as lf,Ere as lg,PSe as lh,ac as li,OA as lj,xs as lk,bD as ll,vet as lm,vD as ln,e$ as lo,Rt as lp,EG as lq,ast as lr,Qbt as ls,KHt as lt,kp as lu,zot as lv,Yo as lw,TYt as lx,uJt as ly,L$ as lz,p as m,xDt as m$,Y9e as m0,k7 as m1,uS as m2,Yre as m3,P7 as m4,Iie as m5,dIe as m6,wHt as m7,mIe as m8,FS as m9,G$ as mA,Dse as mB,Jlt as mC,Ix as mD,A6t as mE,M6t as mF,$6t as mG,e3 as mH,MD as mI,k_ as mJ,qm as mK,TPt as mL,FNe as mM,Wx as mN,CFt as mO,hDt as mP,bFt as mQ,vDt as mR,BFt as mS,xue as mT,pCe as mU,ODt as mV,DG as mW,g9 as mX,rL as mY,qK as mZ,sL as m_,Uz as ma,vA as mb,_A as mc,JYt as md,bHt as me,mn as mf,Kn as mg,_lt as mh,kn as mi,pc as mj,$b as mk,MYt as ml,xV as mm,$j as mn,iU as mo,Gri as mp,OEe as mq,wxt as mr,age as ms,_6t as mt,Bri as mu,_d as mv,Rs as mw,Cm as mx,dYt as my,Iat as mz,OS as n,$$ as n$,Woe as n0,I6t as n1,E$ as n2,O9t as n3,PNe as n4,Ule as n5,S5e as n6,sb as n7,pGe as n8,Wm as n9,UZt as nA,zZt as nB,kZt as nC,BZt as nD,pd as nE,zMe as nF,dk as nG,$D as nH,Ohi as nI,s5e as nJ,$ee as nK,SE as nL,X4e as nM,ALt as nN,zpi as nO,rNt as nP,SFt as nQ,b5e as nR,sNt as nS,Mp as nT,rh as nU,g3 as nV,eje as nW,Mlt as nX,DYt as nY,ZYt as nZ,VP as n_,bd as na,I3 as nb,Boe as nc,MDt as nd,ADt as ne,PEe as nf,CDt as ng,qsi as nh,mdi as ni,C$ as nj,U_ as nk,HWe as nl,xPt as nm,jWe as nn,M8t as no,Yx as np,LTt as nq,ro as nr,So as ns,zoe as nt,d6e as nu,s6e as nv,_Se as nw,TD as nx,ED as ny,Oy as nz,VD as o,Q1 as o$,Xri as o0,Ft as o1,E7t as o2,uj as o3,sS as o4,dj as o5,br as o6,hj as o7,zhe as o8,lw as o9,Uee as oA,Wee as oB,m6t as oC,Yi as oD,Ni as oE,lAe as oF,pD as oG,gIe as oH,Xz as oI,BD as oJ,oFe as oK,Y as oL,be as oM,P2t as oN,hht as oO,pht as oP,fht as oQ,mht as oR,Esi as oS,Tne as oT,mei as oU,qU as oV,CXt as oW,Tl as oX,yei as oY,gei as oZ,vs as o_,ba as oa,Wy as ob,Y$e as oc,ym as od,ZIe as oe,wP as of,Go as og,P6t as oh,vm as oi,Pqt as oj,Rj as ok,iXe as ol,$6e as om,l$ as on,FTt as oo,Wri as op,Wp as oq,bie as or,vYt as os,DOe as ot,dr as ou,WU as ov,$3e as ow,Use as ox,pPt as oy,rr as oz,cae as p,x5e as p$,Yu as p0,iCe as p1,Vt as p2,_o as p3,aEt as p4,qat as p5,tB as p6,js as p7,Pre as p8,ani as p9,Lxe as pA,sr as pB,dA as pC,c5e as pD,koe as pE,zv as pF,Lli as pG,ZFt as pH,VLt as pI,qLt as pJ,B4e as pK,Doe as pL,OB as pM,wDt as pN,Ys as pO,XLt as pP,MLt as pQ,OLt as pR,PLt as pS,DLt as pT,HLt as pU,LLt as pV,NLt as pW,FLt as pX,kLt as pY,zLt as pZ,ULt as p_,Bet as pa,Vet as pb,gOe as pc,PEt as pd,Yni as pe,OEt as pf,CAe as pg,r3 as ph,Dn as pi,TXt as pj,W$e as pk,Fr as pl,F$ as pm,Qm as pn,ese as po,fIe as pp,vRe as pq,bRe as pr,$Xt as ps,zRe as pt,C3t as pu,$Nt as pv,fDt as pw,ILt as px,BLt as py,Axe as pz,$s as q,Eii as q$,Vdi as q0,UHt as q1,kje as q2,pii as q3,xhi as q4,Jf as q5,IHe as q6,o8t as q7,CSe as q8,lNt as q9,IZe as qA,lot as qB,mci as qC,Ws as qD,dOt as qE,Qdt as qF,Rn as qG,Yr as qH,vci as qI,Uj as qJ,Wei as qK,CRe as qL,tse as qM,Qre as qN,QHt as qO,Bz as qP,XHt as qQ,p6e as qR,YS as qS,dii as qT,_ii as qU,Sii as qV,rwt as qW,gG as qX,xii as qY,Cii as qZ,wii as q_,bye as qa,Che as qb,NWt as qc,LWt as qd,DWt as qe,PWt as qf,kWt as qg,FWt as qh,RWt as qi,IWt as qj,lte as qk,f6 as ql,xxt as qm,BCe as qn,kce as qo,u2t as qp,oct as qq,Hj as qr,cni as qs,HZt as qt,qZt as qu,znt as qv,cSe as qw,_D as qx,US as qy,nh as qz,YRt as r,$$t as r$,bii as r0,Tii as r1,$ii as r2,Aii as r3,Tb as r4,Tm as r5,NTt as r6,Mli as r7,ere as r8,fJt as r9,zYe as rA,Sst as rB,MHe as rC,L4e as rD,xX as rE,Fet as rF,LX as rG,P_ as rH,$2t as rI,A2t as rJ,qb as rK,pA as rL,BS as rM,Zti as rN,pv as rO,rn as rP,ure as rQ,Ad as rR,rre as rS,CZe as rT,sn as rU,bet as rV,OWt as rW,qP as rX,z$t as rY,m$t as rZ,P$t as r_,V$t as ra,O as rb,CGe as rc,ixe as rd,nHt as re,Udi as rf,zdi as rg,e5e as rh,K4e as ri,Sk as rj,nsi as rk,pNe as rl,yNe as rm,mNe as rn,Kri as ro,oge as rp,asi as rq,I6e as rr,k6e as rs,vNe as rt,eD as ru,r8t as rv,eRe as rw,Ry as rx,ple as ry,tHt as rz,KRt as s,qri as s$,I$t as s0,bai as s1,y$t as s2,j$t as s3,OX as s4,Pai as s5,wye as s6,yLt as s7,Za as s8,kS as s9,vlt as sA,wY as sB,Bot as sC,are as sD,mf as sE,Vti as sF,DSe as sG,Xie as sH,Ko as sI,cS as sJ,DNe as sK,Wsi as sL,mD as sM,PS as sN,Sni as sO,NP as sP,k6t as sQ,H_ as sR,Hqt as sS,xde as sT,Dlt as sU,Dri as sV,qSe as sW,Y6e as sX,c8t as sY,KV as sZ,Wc as s_,Rb as sa,Cpe as sb,Lee as sc,uHt as sd,cHt as se,rsi as sf,isi as sg,oje as sh,nje as si,p8t as sj,MZt as sk,jHt as sl,zS as sm,CD as sn,Zt as so,dv as sp,ZZt as sq,Wo as sr,Bpi as ss,Eb as st,Xde as su,YYt as sv,glt as sw,hIe as sx,blt as sy,xMt as sz,fe as t,zai as t$,vIe as t0,bxt as t1,mst as t2,J7e as t3,xBe as t4,IHt as t5,Wje as t6,bV as t7,NHt as t8,Lm as t9,_S as tA,QLt as tB,Ndi as tC,Ldi as tD,eni as tE,fbe as tF,pb as tG,_$ as tH,kFt as tI,Ehe as tJ,ISe as tK,_et as tL,$re as tM,vxt as tN,kri as tO,mxt as tP,zri as tQ,Uri as tR,gU as tS,qWt as tT,GWt as tU,HWt as tV,ort as tW,ydi as tX,vdi as tY,gdi as tZ,ki as t_,Prt as ta,Lrt as tb,Nrt as tc,F4t as td,BHt as te,lv as tf,mb as tg,Mje as th,ewt as ti,Kh as tj,drt as tk,VA as tl,ZWt as tm,JWt as tn,D_ as to,Bp as tp,xB as tq,YWt as tr,Mdi as ts,hii as tt,gii as tu,yii as tv,wSe as tw,sat as tx,UOe as ty,Zet as tz,Ce as u,GP as u$,wf as u0,Nxe as u1,$Ze as u2,fOe as u3,Ore as u4,Wu as u5,wRe as u6,_Re as u7,Bj as u8,Kre as u9,V$e as uA,vHt as uB,PHt as uC,txe as uD,zJe as uE,Aje as uF,s2e as uG,m1e as uH,zxe as uI,MHt as uJ,lSe as uK,wle as uL,Hxe as uM,NNe as uN,OTt as uO,Jsi as uP,h6e as uQ,PQe as uR,Sie as uS,Qr as uT,Eut as uU,dut as uV,W6e as uW,a8t as uX,iZt as uY,D6t as uZ,dAe as u_,rse as ua,Xre as ub,jt as uc,x6t as ud,h1e as ue,w6t as uf,jre as ug,gYt as uh,qre as ui,Jre as uj,bat as uk,JP as ul,mg as um,hg as un,uie as uo,aXe as up,BQt as uq,jr as ur,su as us,pi as ut,YKt as uu,odt as uv,tMe as uw,frt as ux,oei as uy,un as uz,le as v,MU as v$,wie as v0,Yqt as v1,Z5 as v2,Z$e as v3,Tie as v4,wQe as v5,aj as v6,Jce as v7,ZAt as v8,KD as v9,ov as vA,Wet as vB,hsi as vC,bo as vD,_a as vE,vni as vF,Y3e as vG,O_ as vH,Wh as vI,KF as vJ,Jri as vK,zce as vL,jri as vM,N1t as vN,ej as vO,_di as vP,oSt as vQ,Cb as vR,Ij as vS,Yy as vT,INe as vU,wre as vV,Foe as vW,VDt as vX,M$ as vY,CYt as vZ,zTt as v_,TXe as va,B9t as vb,Zqt as vc,AS as vd,Fp as ve,BYe as vf,xHt as vg,M9t as vh,rXe as vi,jee as vj,PZe as vk,O2e as vl,utt as vm,OQt as vn,Nv as vo,Qie as vp,act as vq,IQt as vr,gQt as vs,jCe as vt,sSt as vu,K1t as vv,J1t as vw,Ylt as vx,lQt as vy,aQt as vz,yi as w,_ai as w$,za as w0,PTt as w1,g8t as w2,m8t as w3,$li as w4,Dli as w5,Bue as w6,zue as w7,ITt as w8,_Jt as w9,put as wA,Rai as wB,Cli as wC,YAt as wD,uM as wE,Ey as wF,Fai as wG,Nai as wH,Lai as wI,Dai as wJ,Qd as wK,YHt as wL,ZHt as wM,O$ as wN,RHe as wO,pf as wP,ryt as wQ,Eee as wR,d7t as wS,gIt as wT,o3 as wU,nTe as wV,dEe as wW,wet as wX,Aai as wY,roe as wZ,SB as w_,bJt as wa,Uue as wb,A2e as wc,Kct as wd,Oli as we,ooe as wf,b$ as wg,yJt as wh,Ide as wi,Ali as wj,L8t as wk,VHt as wl,RCe as wm,odi as wn,n5e as wo,bb as wp,iDt as wq,dDt as wr,pDt as ws,rDt as wt,yDt as wu,lFt as wv,EFt as ww,rE as wx,Sut as wy,aot as wz,gg as x,HLe as x$,Cai as x0,NFe as x1,Mai as x2,$ai as x3,tc as x4,FX as x5,kX as x6,NX as x7,Iai as x8,xai as x9,$8t as xA,rHt as xB,YU as xC,OP as xD,xb as xE,LYt as xF,r3e as xG,i3e as xH,GYt as xI,hRe as xJ,vot as xK,J_ as xL,xm as xM,QZ as xN,cEt as xO,jge as xP,RDt as xQ,tut as xR,KIe as xS,yRt as xT,VWt as xU,Lhe as xV,$Wt as xW,Wnt as xX,jLe as xY,Jr as xZ,cj as x_,Tai as xa,_1e as xb,bBe as xc,qde as xd,nni as xe,kne as xf,fF as xg,R3e as xh,Z8t as xi,lS as xj,sJt as xk,es as xl,td as xm,MIe as xn,OIe as xo,QYt as xp,Ba as xq,Nm as xr,qgt as xs,Xxe as xt,XOe as xu,aS as xv,Rat as xw,Pli as xx,EXt as xy,KAt as xz,Wa as y,X9t as y$,qLe as y0,oAe as y1,cAe as y2,KQe as y3,C7t as y4,aet as y5,zn as y6,$7t as y7,HA as y8,Ioe as y9,dc as yA,HIe as yB,Cct as yC,Xct as yD,z9t as yE,eJt as yF,N3 as yG,Afi as yH,tze as yI,KQ as yJ,rA as yK,wze as yL,Qzt as yM,Khe as yN,N5t as yO,Ofi as yP,$fi as yQ,jG as yR,F5t as yS,UMe as yT,px as yU,ij as yV,Mte as yW,iHt as yX,b$e as yY,C6t as yZ,aAe as y_,kDt as ya,FDt as yb,LG as yc,U4e as yd,Hlt as ye,IIe as yf,PB as yg,F4e as yh,tP as yi,vii as yj,cxe as yk,XKe as yl,KKe as ym,Sj as yn,lQe as yo,bj as yp,oS as yq,gQe as yr,oj as ys,ore as yt,ab as yu,SYt as yv,AU as yw,Hot as yx,l8t as yy,JS as yz,wr as z,Ehi as z$,K9t as z0,Q9t as z1,Rm as z2,ahi as z3,xQe as z4,Uhe as z5,aMe as z6,aZt as z7,lZt as z8,cZt as z9,cf as zA,eS as zB,lsi as zC,hZt as zD,QAe as zE,H7e as zF,fst as zG,p9t as zH,HDt as zI,Lbe as zJ,Sfi as zK,s8t as zL,Oai as zM,wB as zN,ypi as zO,pZt as zP,dZt as zQ,EWt as zR,CWt as zS,Sye as zT,eqt as zU,v8t as zV,NQe as zW,Cqt as zX,$qt as zY,Eqt as zZ,Tqt as z_,uZt as za,Hxt as zb,Drt as zc,xZe as zd,Nj as ze,Lqt as zf,Lie as zg,PYt as zh,yH as zi,Nqt as zj,pU as zk,EYt as zl,Fot as zm,Cat as zn,f$ as zo,vat as zp,vre as zq,IOe as zr,Td as zs,j$e as zt,w1t as zu,R1t as zv,dXe as zw,csi as zx,wv as zy,xv as zz};
